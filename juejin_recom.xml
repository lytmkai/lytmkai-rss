<?xml version="1.0" encoding="UTF-8"?><rss version="2.0">  <channel>      <title>æ˜é‡‘æ–‡ç« æ¨è</title>      <link>https://juejin.cn/recommended?sort=newest</link>      <description>ä¸€ä¸ªå¸®åŠ©å¼€å‘è€…æˆé•¿çš„ç¤¾åŒº</description>      <generator>python juejin_recom.py @Pi20</generator>      <item>    <title><![CDATA[å¹çˆ† OpenClawï¼ä¸€ä¸ªäºº +6 ä¸ª AI åŠ©ç†ï¼Œæˆ‘å†ä¹Ÿä¸æƒ³æ‹›äººäº†]]></title>    <link>https://juejin.cn/post/7604037348607180838</link>    <guid>https://juejin.cn/post/7604037348607180838</guid>    <pubDate>2026-02-08T11:03:44.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7604037348607180838" data-draft-id="7603721514203824137" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="å¹çˆ† OpenClawï¼ä¸€ä¸ªäºº +6 ä¸ª AI åŠ©ç†ï¼Œæˆ‘å†ä¹Ÿä¸æƒ³æ‹›äººäº†"/> <meta itemprop="keywords" content="Agent,OpenAI,AIç¼–ç¨‹"/> <meta itemprop="datePublished" content="2026-02-08T11:03:44.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å­Ÿå¥AIç¼–ç¨‹"/> <meta itemprop="url" content="https://juejin.cn/user/4212984287073895"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            å¹çˆ† OpenClawï¼ä¸€ä¸ªäºº +6 ä¸ª AI åŠ©ç†ï¼Œæˆ‘å†ä¹Ÿä¸æƒ³æ‹›äººäº†
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4212984287073895/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å­Ÿå¥AIç¼–ç¨‹
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-08T11:03:44.000Z" title="Sun Feb 08 2026 11:03:44 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»6åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>å¤§å®¶å¥½ï¼Œæˆ‘æ˜¯å­Ÿå¥ã€‚</p>
<p><strong>ä¸€ä¸ªäººï¼Œ6 ä¸ª AI åŠ©ç†ï¼Œè´¢åŠ¡ã€æ³•åŠ¡ã€å†…å®¹ã€å¼€å‘ã€å¢é•¿å…¨å¹²äº†ã€‚æœˆæˆæœ¬ 200 åˆ€ï¼ˆClaude Max æ‹‰æ»¡ï¼‰ã€‚</strong></p>
<p>ä¸æ˜¯ç”»é¥¼ï¼Œä¸æ˜¯æ¦‚å¿µå›¾ï¼Œæ˜¯ä»Šå¤©å·²ç»åœ¨è·‘çš„ä¸œè¥¿ã€‚æ‰“å¼€æˆ‘çš„ Telegramï¼Œä½ ä¼šçœ‹åˆ° 6 ä¸ª"å‘˜å·¥"åœ¨çº¿å¾…å‘½â€”â€”è´¢åŠ¡åŠ©ç†å¸®æˆ‘ç®—è´¦ã€æ³•åŠ¡åŠ©ç†å®¡åˆåŒã€å†…å®¹åŠ©ç†å†™æ–‡ç« ã€å¼€å‘åŠ©ç†æ”¹ä»£ç ã€å¢é•¿åŠ©ç†ç›¯æ•°æ®ã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/19787c597e1546618af534dfe50ae928~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2f5YGlQUnnvJbnqIs=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771153424&amp;x-signature=kqwWbiCASRkSQvIQ2kSfkqmAoOc%3D" alt="" loading="lazy"/></p>
<p>è€Œæˆ‘ï¼Œåªéœ€è¦åœ¨ç¾¤é‡Œ@ä¸€ä¸‹ï¼Œæ´»å°±å¹²äº†ã€‚</p>
<p><strong>ä»¥å‰æ‹›ä¸€ä¸ªå®ä¹ ç”Ÿï¼Œæœˆè–ª 5000ï¼Œè¿˜å¾—åŸ¹è®­ã€ç®¡ç†ã€æ²Ÿé€šã€‚ç°åœ¨è¿™ 6 ä½ï¼Œæœˆæˆæœ¬ 200 åˆ€ï¼ˆçº¦ 1500 å—ï¼‰ï¼Œ7Ã—24 åœ¨çº¿ï¼Œä¸è¯·å‡ï¼Œä¸æ‘¸é±¼ï¼Œä¸éœ€è¦å›¢å»ºã€‚</strong></p>
<h2 data-id="heading-0">è¿™ä¸æ˜¯ ChatGPT å¥—å£³</h2>
<p>å¾ˆå¤šäººä¸€å¬"AI åŠ©ç†"å°±è§‰å¾—æ˜¯ ChatGPT åŒ…äº†å±‚çš®ã€‚ä¸æ˜¯çš„ã€‚</p>
<p>ChatGPT æ˜¯ä½ é—®ä¸€å¥ç­”ä¸€å¥çš„å·¥å…·ã€‚æˆ‘æ­çš„è¿™å¥—ç³»ç»Ÿï¼Œæ˜¯ä¸€ä¸ª<strong>æœ‰è®°å¿†ã€æœ‰åˆ†å·¥ã€èƒ½ä¸»åŠ¨å¹²æ´»çš„å›¢é˜Ÿ</strong>ã€‚</p>
<p>åŒºåˆ«åœ¨å“ªï¼Ÿ</p>
<ul>
<li>
<p><strong>æœ‰è®°å¿†</strong>ï¼šå®ƒè®°å¾—æˆ‘ä¸Šå‘¨è¯´äº†ä»€ä¹ˆï¼Œè®°å¾—æˆ‘çš„åå¥½ï¼Œè®°å¾—é¡¹ç›®è¿›åº¦</p>
</li>
<li>
<p><strong>æœ‰åˆ†å·¥</strong>ï¼šè´¢åŠ¡çš„å½’è´¢åŠ¡ï¼Œæ³•åŠ¡çš„å½’æ³•åŠ¡ï¼Œä¸ä¼šä¸²å°</p>
</li>
<li>
<p><strong>èƒ½ä¸»åŠ¨</strong>ï¼šä¸ç”¨æˆ‘é—®ï¼Œå®ƒä¼šå®šæ—¶æ£€æŸ¥é‚®ç®±ã€æ‰«æ—¥å†ã€ç›¯æ•°æ®å¼‚å¸¸</p>
</li>
<li>
<p><strong>èƒ½åä½œ</strong>ï¼šå†…å®¹åŠ©ç†å†™å®Œåˆç¨¿ï¼Œå¯ä»¥è‡ªåŠ¨è®©å¢é•¿åŠ©ç†ä¼˜åŒ–æ ‡é¢˜</p>
</li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a5f70fd0c8f64836b673625841998551~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2f5YGlQUnnvJbnqIs=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771153424&amp;x-signature=iqAhX9rsxA%2FOTcDGh5eS1w55RDU%3D" alt="" loading="lazy"/></p>
<p>è¿™å¥—ä¸œè¥¿å« <strong>OpenClaw</strong>ï¼Œä¸€ä¸ªå¼€æºçš„ AI Agent æ¡†æ¶ã€‚ä½ å¯ä»¥ç†è§£ä¸ºâ€”â€”<strong>ç»™ AI åŠ©ç†æ­äº†ä¸€ä¸ªå…¬å¸ç»„ç»‡æ¶æ„</strong>ã€‚</p>
<h2 data-id="heading-1">6 ä¸ª"å‘˜å·¥"ï¼Œå„å¸å…¶èŒ</h2>
<p>æˆ‘ç°åœ¨çš„å›¢é˜Ÿé•¿è¿™æ ·ï¼š</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/19a08916caf34202932af884be52ccb4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2f5YGlQUnnvJbnqIs=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771153424&amp;x-signature=lqh04J%2FlBvJE2gI%2FVoHqJNw5xpY%3D" alt="" loading="lazy"/></p>
<p><strong>ğŸˆâ¬› å°å¢¨ï¼ˆæ€»åŠ©/ COO ï¼‰</strong> æˆ‘çš„æ ¸å¿ƒåŠ©ç†ï¼Œä»€ä¹ˆéƒ½ç®¡ã€‚æ—¥ç¨‹ã€æé†’ã€éšæ‰‹æŸ¥ä¸ªä¸œè¥¿ã€å¸®æˆ‘æƒ³ä¸ªæ–¹æ¡ˆã€‚ç›¸å½“äºåˆ›ä¸šå…¬å¸çš„ COOï¼Œå“ªé‡Œéœ€è¦è¡¥å“ªé‡Œã€‚</p>
<p><strong>ğŸ’° è´¢åŠ¡åŠ©ç†</strong> è®°è´¦ã€å¯¹è´¦ã€ç®— ROIã€‚æˆ‘æ¯ä¸ªå‡ºæµ·äº§å“çš„æ”¶å…¥æ”¯å‡ºï¼Œå®ƒå¸®æˆ‘æŒ‰é¡¹ç›®åˆ†ç±»ï¼Œæœˆåº•è‡ªåŠ¨å‡ºæŠ¥è¡¨ã€‚</p>
<p><strong>âœï¸ å†…å®¹åŠ©ç†</strong> å†™å…¬å·ã€å†™æ¨æ–‡ã€å†™äº§å“æ–‡æ¡ˆã€‚å®ƒç†Ÿæ‚‰æˆ‘çš„å†™ä½œé£æ ¼ï¼Œåˆç¨¿è´¨é‡å·²ç»èƒ½åˆ° 90 åˆ†ï¼Œæˆ‘æ”¹æ”¹å°±èƒ½å‘ã€‚</p>
<p><strong>ğŸ’» å¼€å‘åŠ©ç†</strong> Review ä»£ç ã€ä¿® Bugã€å†™è„šæœ¬ã€‚æˆ‘ä¸¢ä¸€ä¸ª GitHub Issue è¿‡å»ï¼Œå®ƒèƒ½ç›´æ¥å¼€å¹²ã€‚</p>
<p><strong>ğŸ“ˆ å¢é•¿åŠ©ç†</strong> ç›¯ SEO æ•°æ®ã€åˆ†ææµé‡ã€ä¼˜åŒ–å…³é”®è¯ã€‚æˆ‘çš„ 9 ä¸ªå‡ºæµ·ç«™ç‚¹ï¼Œæ¯å¤©çš„æ’åå˜åŒ–å®ƒéƒ½åœ¨çœ‹ã€‚</p>
<p><strong>âš–ï¸ æ³•åŠ¡åŠ©ç†</strong> å®¡åˆåŒã€æŸ¥æ¡æ¬¾ã€å‡ºæµ·åˆè§„å’¨è¯¢ã€‚è™½ç„¶ä¸èƒ½æ›¿ä»£å¾‹å¸ˆï¼Œä½† 90%çš„å¸¸è§„é—®é¢˜å®ƒèƒ½æå®šã€‚</p>
<h2 data-id="heading-2">æ­å»ºåªèŠ±äº†ä¸€å¤©</h2>
<p>æ²¡æœ‰å†™ä¸€è¡Œä»£ç ã€‚</p>
<p>OpenClaw çš„è®¾è®¡ç†å¿µå°±æ˜¯<strong>é…ç½®é©±åŠ¨</strong>â€”â€”ä½ å†™ä¸€ä»½"äººè®¾æ–‡ä»¶"ï¼Œå®šä¹‰è¿™ä¸ª Agent æ˜¯è°ã€æ“…é•¿ä»€ä¹ˆã€èƒ½ç”¨ä»€ä¹ˆå·¥å…·ï¼Œå®ƒå°±èƒ½ä¸Šå²—ã€‚</p>
<p>æ ¸å¿ƒå°±ä¸‰æ­¥ï¼š</p>
<ol>
<li>
<p><strong>è£…å¥½ OpenClaw</strong>ï¼ˆä¸€è¡Œå‘½ä»¤ï¼‰</p>
</li>
<li>
<p><strong>å®šä¹‰ Agent</strong>ï¼ˆå†™ä¸€ä¸ª Markdown æ–‡ä»¶ï¼Œæè¿°è§’è‰²å’Œèƒ½åŠ›ï¼‰</p>
</li>
<li>
<p><strong>ç»‘å®šåˆ°æ¶ˆæ¯æ¸ é“</strong>ï¼ˆTelegramã€é£ä¹¦ã€ä¼å¾®ã€QQ éƒ½è¡Œï¼‰</p>
</li>
</ol>
<p>æ¯ä¸ª Agent æœ‰è‡ªå·±çš„è®°å¿†ç©ºé—´ã€å·¥å…·æƒé™ã€å¯¹è¯å†å²ã€‚è´¢åŠ¡åŠ©ç†çœ‹ä¸åˆ°å¼€å‘åŠ©ç†çš„ä»£ç ï¼Œå¼€å‘åŠ©ç†ç¢°ä¸åˆ°è´¢åŠ¡æ•°æ®ã€‚<strong>è·ŸçœŸå®å…¬å¸çš„æƒé™ç®¡ç†ä¸€æ¨¡ä¸€æ ·ã€‚</strong></p>
<h2 data-id="heading-3">ä¸€ä¸ªçœŸå®çš„å·¥ä½œåœºæ™¯</h2>
<p>æ˜¨å¤©ä¸‹åˆï¼Œæˆ‘åœ¨å¤–é¢å¼€ä¼šã€‚æ‰‹æœºä¸Šçš„æ“ä½œï¼š</p>
<ol>
<li>
<p>ç»™å†…å®¹åŠ©ç†å‘äº†ä¸€å¥ï¼šã€Œå¸®æˆ‘çœ‹çœ‹è¿™å‘¨ AI ç¼–ç¨‹åœˆæœ‰ä»€ä¹ˆçƒ­ç‚¹ï¼Œåˆ— 5 ä¸ªé€‰é¢˜ã€</p>
</li>
<li>
<p>ç»™å¢é•¿åŠ©ç†å‘äº†ä¸€å¥ï¼šã€Œkirkify.net è¿™å‘¨æµé‡æ€ä¹ˆæ ·ï¼Ÿæœ‰æ²¡æœ‰æ–°çš„å…³é”®è¯æœºä¼šï¼Ÿã€</p>
</li>
<li>
<p>ç»™è´¢åŠ¡åŠ©ç†å‘äº†ä¸€å¥ï¼šã€ŒæŠŠä¸Šä¸ªæœˆæ‰€æœ‰äº§å“çš„ Stripe æ”¶å…¥æ±‡æ€»ä¸€ä¸‹ã€</p>
</li>
</ol>
<p><strong>ç­‰æˆ‘å¼€å®Œä¼šï¼Œä¸‰ä»½æŠ¥å‘Šéƒ½èººåœ¨èŠå¤©é‡Œäº†ã€‚</strong></p>
<p>ä»¥å‰è¿™äº›äº‹ï¼Œè¦ä¹ˆæˆ‘è‡ªå·±èŠ± 2 å°æ—¶åšï¼Œè¦ä¹ˆæ‰¾ 3 ä¸ªä¸åŒçš„äººåˆ†åˆ«æ²Ÿé€šã€‚ç°åœ¨ï¼Œ30 ç§’å‘å®Œæ¶ˆæ¯ï¼Œå›æ¥å°±çœ‹ç»“æœã€‚</p>
<p><strong>è¿™å°±æ˜¯ æ æ† ã€‚ä¸æ˜¯çœäº†ä¸€ç‚¹æ—¶é—´ï¼Œæ˜¯çœäº†ä¸€ä¸ªé‡çº§ã€‚</strong></p>
<h2 data-id="heading-4">ä¸ºä»€ä¹ˆæ˜¯"ä¸€äººå…¬å¸"è€Œä¸æ˜¯"ä¸€ä¸ªå·¥å…·"</h2>
<p>å·¥å…·æ˜¯ä½ å»ç”¨å®ƒã€‚</p>
<p><strong>ä¸€äººå…¬å¸ æ˜¯å®ƒæ¥æ‰¾ä½ ã€‚</strong></p>
<p>æˆ‘çš„å°å¢¨æ¯å¤©æ—©ä¸Šä¼šä¸»åŠ¨æ£€æŸ¥ï¼šæœ‰æ²¡æœ‰é‡è¦é‚®ä»¶ï¼Ÿä»Šå¤©æ—¥å†ä¸Šæœ‰ä»€ä¹ˆï¼Ÿå‡ºæµ·ç«™ç‚¹æœ‰æ²¡æœ‰å¼‚å¸¸ï¼Ÿå¦‚æœæœ‰ï¼Œå®ƒä¼šç›´æ¥å‘æ¶ˆæ¯æé†’æˆ‘ã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b4d2f230126d49b19f3736689adfe69f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2f5YGlQUnnvJbnqIs=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771153424&amp;x-signature=JlDGbX2mLOQYkNvWA4Sia8LG1yw%3D" alt="" loading="lazy"/></p>
<p>å¢é•¿åŠ©ç†å‘ç°æŸä¸ªå…³é”®è¯æ’åæ‰äº†ï¼Œä¼šä¸»åŠ¨å‘Šè­¦ã€‚</p>
<p>å†…å®¹åŠ©ç†åˆ°äº†å‘æ–‡æ—¶é—´ï¼Œä¼šä¸»åŠ¨æé†’æˆ‘è¯¥å®¡ç¨¿äº†ã€‚</p>
<p><strong>ä½ ä¸æ˜¯åœ¨"ä½¿ç”¨ AI"ï¼Œä½ æ˜¯åœ¨"ç®¡ç†ä¸€ä¸ªå›¢é˜Ÿ"ã€‚</strong> åªä¸è¿‡è¿™ä¸ªå›¢é˜Ÿçš„äººåŠ›æˆæœ¬çº¦ç­‰äºé›¶ã€‚</p>
<h2 data-id="heading-5">è¿™å¥—ä½“ç³»é€‚åˆè°ï¼Ÿ</h2>
<p>è¯´å®è¯ï¼Œä¸æ˜¯æ‰€æœ‰äººéƒ½éœ€è¦è¿™ä¹ˆæã€‚</p>
<p><strong>é€‚åˆçš„äººï¼š</strong></p>
<ul>
<li>
<p>ç‹¬ç«‹å¼€å‘è€…/ä¸€äººåˆ›ä¸šè€…â€”â€”èº«å…¼æ•°èŒï¼Œåˆ†èº«ä¹æœ¯</p>
</li>
<li>
<p>è‡ªç”±èŒä¸šè€…â€”â€”æ²¡æœ‰å›¢é˜Ÿä½†éœ€è¦å›¢é˜Ÿçš„äº§å‡º</p>
</li>
<li>
<p>å°å›¢é˜Ÿ Leaderâ€”â€”æƒ³è®© 3 ä¸ªäººå¹²å‡º 10 ä¸ªäººçš„æ´»</p>
</li>
<li>
<p>è‡ªåª’ä½“äººâ€”â€”å†…å®¹ç”Ÿäº§ã€æ•°æ®åˆ†æã€ç²‰ä¸è¿è¥å…¨é è‡ªå·±</p>
</li>
</ul>
<p><strong>ä¸é€‚åˆçš„äººï¼š</strong></p>
<ul>
<li>
<p>å¯¹ AI å®Œå…¨æ²¡æ„Ÿè§‰ã€ä¸æ„¿æ„èŠ±æ—¶é—´è°ƒè¯•çš„</p>
</li>
<li>
<p>æœŸæœ›"ä¸€é”®æå®šæ‰€æœ‰äº‹"çš„â€”â€”AI æ˜¯å‘˜å·¥ï¼Œä¸æ˜¯é­”æ³•</p>
</li>
</ul>
<h2 data-id="heading-6">æƒ³è‡ªå·±æ­ä¸€å¥—ï¼Ÿ</h2>
<p>æˆ‘çŸ¥é“ä½ åœ¨æƒ³ä»€ä¹ˆï¼šè¿™ä¸œè¥¿æˆ‘ä¹Ÿèƒ½æ­å—ï¼Ÿ</p>
<p>èƒ½ã€‚</p>
<p>ä½†è¯´å®è¯ï¼Œä»é›¶æŠ˜è…¾ç¯å¢ƒã€è¸©éƒ¨ç½²çš„å‘ã€æé€šæ¸ é“å¯¹æ¥ã€è°ƒè¯•è®°å¿†ç³»ç»Ÿâ€¦â€¦è‡ªå·±æ‘¸ç´¢å¯èƒ½è¦ä¸€ä¸¤å‘¨ï¼Œè¿˜ä¸ä¸€å®šè·‘é€šã€‚</p>
<p>æ‰€ä»¥æˆ‘å’Œä¸¤ä½æ­æ¡£ï¼ˆä¿Šå“¥ã€æ³¢ç‰¹ï¼‰ä¸€èµ·ï¼Œ<strong>æŠŠå®Œæ•´çš„æ­å»ºæµç¨‹å½•æˆäº†è§†é¢‘è¯¾</strong>ï¼š</p>
<p><strong>ã€ŠOpenClaw å®æˆ˜è®­ç»ƒè¥ï¼š7 å¤©æ‰“é€ ä½ çš„ AI ç§äººåŠ©ç†ã€‹</strong></p>
<p>17 èŠ‚è§†é¢‘è¯¾ï¼Œä»å®‰è£…åˆ°ä¸Šçº¿ï¼Œä»äººæ ¼å®šåˆ¶åˆ°è‡ªåŠ¨åŒ–åœºæ™¯ï¼Œæ‰‹æŠŠæ‰‹å¸¦ä½ è·‘é€šã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ae9c120e42634b15b9ba8fa8970d8042~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2f5YGlQUnnvJbnqIs=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771153424&amp;x-signature=jWO%2BwVOOaNcdzAkVvTPs0FsOuL8%3D" alt="photo_2026-02-08_12-06-51.jpg" loading="lazy"/></p>
<p>è¯¾ç¨‹äº®ç‚¹ï¼š</p>
<ul>
<li>
<p><strong>å›½å†…ç”¨æˆ·ä¸“å±</strong>ï¼šç½‘ç»œé—®é¢˜ã€å›½äº§æ¨¡å‹æ¥å…¥ã€é£ä¹¦/ä¼å¾®/QQ å¯¹æ¥ï¼Œå…¨éƒ¨è¦†ç›–</p>
</li>
<li>
<p><strong>çº¯å®æ“</strong>ï¼šæ¯èŠ‚è¯¾éƒ½æœ‰å¯è·Ÿåšçš„æ¼”ç¤ºï¼Œæ‹’ç»çº¯ç†è®º</p>
</li>
<li>
<p><strong>ä¸‰ä½è®²å¸ˆ</strong>ï¼šå‰è…¾è®¯/å­—èŠ‚/ä¸–ç•Œ 500 å¼ºæŠ€æœ¯è´Ÿè´£äººï¼Œåˆè®¡ 20 å¹´+ä¸€çº¿ç»éªŒ</p>
</li>
<li>
<p><strong>æ°¸ä¹…æœ‰æ•ˆ</strong>ï¼šä¹°ä¸€æ¬¡ï¼Œåç»­æ›´æ–°å…è´¹åŒæ­¥</p>
</li>
</ul>
<p>å­¦å®Œä½ ä¼šæ‹¥æœ‰ï¼š</p>
<ul>
<li>
<p>âœ… ä¸€ä¸ª 7Ã—24 åœ¨çº¿çš„ AI ç§äººåŠ©ç†ï¼Œæ‰‹æœºéšæ—¶ä¸‹æŒ‡ä»¤</p>
</li>
<li>
<p>âœ… æ‰“é€šé£ä¹¦/ä¼å¾®/QQ/Telegramï¼Œåœ¨ä½ å¸¸ç”¨çš„ App é‡Œç›´æ¥å’Œ AI å¯¹è¯</p>
</li>
<li>
<p>âœ… è·‘é€šè‡³å°‘ 3 ä¸ªè‡ªåŠ¨åŒ–åœºæ™¯ï¼šå®šæ—¶æ¨é€ã€è‡ªåŠ¨å†™æ–‡æ¡£ã€è¿œç¨‹ç¼–ç¨‹</p>
</li>
<li>
<p>âœ… ä¼šå®‰è£…å’Œå¼€å‘ Skillsï¼Œæ— é™æ‰©å±• AI çš„èƒ½åŠ›è¾¹ç•Œ</p>
</li>
</ul>
<p>è¯¾ç¨‹é…å¥— GitHub æ¨¡æ¿ä»“åº“ã€é€ŸæŸ¥æ‰‹å†Œã€FAQ æ–‡æ¡£ï¼Œå¼€ç®±å³ç”¨ã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6c976e04b093459b9e30ca20d2700ed4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2f5YGlQUnnvJbnqIs=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771153424&amp;x-signature=SoYNMwyJKnP7WjMVAdUZApHWPDg%3D" alt="" loading="lazy"/></p>
<hr/>
<p><strong>ä¸€ä¸ªäººå¹²ä¸è¿‡ä¸€ä¸ªå›¢é˜Ÿï¼Ÿé‚£æ˜¯ä»¥å‰ã€‚ ç°åœ¨ï¼Œä¸€ä¸ªäºº +6 ä¸ª AIï¼Œå°±æ˜¯ä¸€ä¸ªå›¢é˜Ÿã€‚</strong></p>
<p>å·¥å…·å°±æ‘†åœ¨é‚£é‡Œã€‚ç”¨ä¸ç”¨ï¼Œæ˜¯ä½ çš„äº‹ã€‚</p>
<hr/>
<hr/>
<p>å¦‚æœè¿™ç¯‡å¯¹ä½ æœ‰å¸®åŠ©ï¼Œæ¬¢è¿ç‚¹èµã€æ”¶è—ã€å…³æ³¨ï¼Œä½ çš„æ”¯æŒæ˜¯æˆ‘æŒç»­è¾“å‡ºçš„åŠ¨åŠ› âœ¨</p>
<hr/>
<p>æˆ‘çš„å…¶ä»–å¹³å°è´¦å·å’Œå¼€æºé¡¹ç›®åœ¨ä¸ªäººä¸»é¡µä¸­ï¼Œæ¬¢è¿äº¤æµ ğŸ¤</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Python å¼‚æ­¥ç”Ÿå­˜æ‰‹å†Œï¼šç»™è¢« JS async/await å® åçš„å…¨æ ˆå·¥ç¨‹å¸ˆ]]></title>    <link>https://juejin.cn/post/7603688142005354505</link>    <guid>https://juejin.cn/post/7603688142005354505</guid>    <pubDate>2026-02-08T11:54:31.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7603688142005354505" data-draft-id="7603946518372581414" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Python å¼‚æ­¥ç”Ÿå­˜æ‰‹å†Œï¼šç»™è¢« JS async/await å® åçš„å…¨æ ˆå·¥ç¨‹å¸ˆ"/> <meta itemprop="keywords" content="åç«¯,Python"/> <meta itemprop="datePublished" content="2026-02-08T11:54:31.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å…‰å¤´è€çŸ³"/> <meta itemprop="url" content="https://juejin.cn/user/2963939077135006"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Python å¼‚æ­¥ç”Ÿå­˜æ‰‹å†Œï¼šç»™è¢« JS async/await å® åçš„å…¨æ ˆå·¥ç¨‹å¸ˆ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2963939077135006/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å…‰å¤´è€çŸ³
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-08T11:54:31.000Z" title="Sun Feb 08 2026 11:54:31 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»5åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>è¿˜è®°å¾—å½“åˆè¢« JavaScript çš„ <code>async/await</code> æƒŠè‰³åˆ°çš„æ—¶åˆ»å—ï¼Ÿä¸€ä¸ª <code>await</code>ï¼Œå°±æŠŠé‚£äº›ç¹ççš„å›è°ƒåœ°ç‹±ï¼ˆCallback Hellï¼‰å˜æˆäº†ä¼˜é›…çš„åŒæ­¥ä»£ç ï¼Œè®© Web UI å§‹ç»ˆä¿æŒæµç•…ã€‚ä½ å¯èƒ½å¿ƒé‡Œæš—æƒ³ï¼šâ€œPython è¦æ˜¯æœ‰è¿™ç©æ„å„¿å°±å¥½äº†ã€‚â€</p>
<p>æ­å–œä½ ï¼ŒPython 3.5+ ä¸ä»…æœ‰äº†ï¼Œè€Œä¸”åœ¨ FastAPI çš„åŠ æŒä¸‹ï¼Œå®ƒæ­£ä»¥ä¸€ç§å‰æ‰€æœªæœ‰çš„å§¿æ€ï¼ŒæŒ‘æˆ˜ç€é«˜å¹¶å‘ Web æœåŠ¡çš„æé™ã€‚ç„¶è€Œï¼Œå½“ä½ æŠŠ JS é‡Œçš„å¼‚æ­¥ç›´æ¥å¹³ç§»åˆ° Pythonï¼Œå¾ˆå¯èƒ½ä¼šå‘ç°ï¼š<strong>â€œä¸ºä»€ä¹ˆæˆ‘çš„ Python å¼‚æ­¥ï¼Œæ²¡æˆ‘æƒ³è±¡çš„é‚£ä¹ˆå¿«ï¼Ÿâ€</strong></p>
<p>åˆ«æ€¥ï¼Œè¿™æœ¬â€œç”Ÿå­˜æ‰‹å†Œâ€å°±æ˜¯ä¸ºä½ å‡†å¤‡çš„ã€‚</p>
<h3 data-id="heading-0">1. è¯­æ³•å¾ˆåƒï¼Œä½†â€œè„¾æ°”â€æœ‰ç‚¹ä¸åŒ</h3>
<p>é¦–å…ˆï¼Œæˆ‘ä»¬è¦æ‰¿è®¤ï¼ŒPython çš„ <code>async/await</code> åœ¨è¯­æ³•å±‚é¢ä¸Šï¼Œå’Œ ES6 ç®€ç›´æ˜¯åŒèƒèƒï¼š</p>
<p><strong>JavaScript (React/Node.js):</strong></p>
<pre><code class="hljs language-jsx" lang="jsx"><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">fetchData</span>(<span class="hljs-params">userId</span>) {
    <span class="hljs-keyword">const</span> user = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(<span class="hljs-string">`/api/users/<span class="hljs-subst">${userId}</span>`</span>); <span class="hljs-comment">// ç½‘ç»œè¯·æ±‚</span>
    <span class="hljs-keyword">const</span> orders = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(<span class="hljs-string">`/api/orders?user=<span class="hljs-subst">${user.id}</span>`</span>); <span class="hljs-comment">// ä¾èµ–ä¸Šä¸€ä¸ªç»“æœ</span>
    <span class="hljs-keyword">return</span> { <span class="hljs-attr">user</span>: <span class="hljs-keyword">await</span> user.<span class="hljs-title function_">json</span>(), <span class="hljs-attr">orders</span>: <span class="hljs-keyword">await</span> orders.<span class="hljs-title function_">json</span>() };
}
</code></pre>
<p><strong>Python (FastAPI):</strong></p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> httpx <span class="hljs-comment"># å¼‚æ­¥ HTTP å®¢æˆ·ç«¯</span>

<span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">fetch_data</span>(<span class="hljs-params">user_id: <span class="hljs-built_in">int</span></span>):
    <span class="hljs-keyword">async</span> <span class="hljs-keyword">with</span> httpx.AsyncClient() <span class="hljs-keyword">as</span> client:
        user_resp = <span class="hljs-keyword">await</span> client.get(<span class="hljs-string">f"http://api.internal/users/<span class="hljs-subst">{user_id}</span>"</span>) <span class="hljs-comment"># ç½‘ç»œè¯·æ±‚</span>
        user_data = user_resp.json()
        orders_resp = <span class="hljs-keyword">await</span> client.get(<span class="hljs-string">f"http://api.internal/orders?user=<span class="hljs-subst">{user_data[<span class="hljs-string">'id'</span>]}</span>"</span>) <span class="hljs-comment"># ä¾èµ–ä¸Šä¸€ä¸ªç»“æœ</span>
        <span class="hljs-keyword">return</span> {<span class="hljs-string">"user"</span>: user_data, <span class="hljs-string">"orders"</span>: orders_resp.json()}
</code></pre>
<p>ä½ çœ‹ï¼Œä»£ç é€»è¾‘å‡ ä¹ä¸€æ¨¡ä¸€æ ·ã€‚ä¸€ä¸ª <code>await</code>ï¼Œå°±èƒ½è®©ä½ åœ¨ç­‰å¾…ç½‘ç»œè¯·æ±‚ã€æ•°æ®åº“æŸ¥è¯¢ã€æ–‡ä»¶è¯»å†™ï¼ˆè¿™äº›éƒ½æ˜¯ I/O å¯†é›†å‹æ“ä½œï¼‰æ—¶ï¼ŒæŠŠ CPU çš„æ§åˆ¶æƒäº¤å‡ºå»ï¼Œè®© Event Loop å»å¤„ç†åˆ«çš„è¯·æ±‚ã€‚</p>
<p><strong>æ ¸å¿ƒæ€æƒ³ï¼š</strong> å¼‚æ­¥ä¸æ˜¯è®©ä½ çš„ä»£ç è·‘å¾—æ›´å¿«ï¼Œè€Œæ˜¯è®©ä½ çš„<strong>æœåŠ¡å™¨åœ¨ç­‰å¾… I/O æ—¶ä¸å†å‘å‘†ï¼Œä»è€Œèƒ½åŒæ—¶å¤„ç†æ›´å¤šçš„è¯·æ±‚ã€‚</strong></p>
<h3 data-id="heading-1">2. è­¦æƒ•â€œä¼ªå¼‚æ­¥â€ï¼šPython å¼‚æ­¥çš„éšå½¢æ€æ‰‹</h3>
<p>å½“ä½ å…´å¥‹åœ°ç»™ FastAPI çš„è·¯ç”±åŠ ä¸Š <code>async def</code>ï¼Œå¹¶å¼€å§‹è°ƒè¯•æ—¶ï¼Œå¦‚æœå‘ç°æœåŠ¡çš„å¹¶å‘èƒ½åŠ›å¹¶æ²¡æœ‰æ˜¾è‘—æå‡ï¼Œç”šè‡³æœ‰æ—¶å€™è¿˜ä¼šå¡é¡¿ï¼Œé‚£å¾ˆå¯èƒ½å°±æ˜¯ä½ é‡åˆ°äº†â€œä¼ªå¼‚æ­¥â€ã€‚</p>
<p><strong>ä»€ä¹ˆæ˜¯â€œä¼ªå¼‚æ­¥â€ï¼Ÿ</strong>
ç®€å•æ¥è¯´ï¼Œå°±æ˜¯åœ¨å¼‚æ­¥å‡½æ•° <code>async def</code> å†…éƒ¨ï¼Œæ‰§è¡Œäº†<strong>åŒæ­¥é˜»å¡</strong>çš„æ“ä½œã€‚</p>
<p>æ¯”å¦‚ï¼Œå¦‚æœä½ åœ¨ <code>async def</code> å‡½æ•°é‡Œä½¿ç”¨äº†ï¼š</p>
<ul>
<li><code>time.sleep(2)</code>ï¼ˆæ¨¡æ‹Ÿè€—æ—¶æ“ä½œï¼Œä½†å®ƒæ˜¯é˜»å¡çš„ï¼‰</li>
<li><code>requests.get('...')</code>ï¼ˆPython ä¼ ç»ŸåŒæ­¥ HTTP åº“ï¼‰</li>
<li><code>json.dumps(huge_object)</code>ï¼ˆå¤„ç†è¶…å¤§ JSON å¯¹è±¡çš„ CPU å¯†é›†å‹æ“ä½œï¼‰</li>
<li>æŸäº›æ•°æ®åº“ ORM çš„åŒæ­¥ç‰ˆæœ¬æ–¹æ³•ï¼ˆå¦‚ <code>session.query().all()</code>ï¼‰</li>
</ul>
<p>è¿™äº›æ“ä½œï¼Œæ— è®ºä½ å¤–å±‚ç”¨å¤šå°‘ <code>async/await</code> åŒ…è£…ï¼Œå®ƒéƒ½ä¼š<strong>ç›´æ¥é˜»å¡æ•´ä¸ªäº‹ä»¶å¾ªç¯ï¼ˆEvent Loopï¼‰</strong>ã€‚ä½ å¯ä»¥æŠŠå®ƒæƒ³è±¡æˆåœ¨ JS çš„ <code>async</code> å‡½æ•°é‡Œç›´æ¥è°ƒç”¨ä¸€ä¸ªåŒæ­¥çš„ã€è€—æ—¶ 5 ç§’çš„å¾ªç¯è®¡ç®—â€”â€”é‚£ä½ çš„ Node.js æœåŠ¡ä¹Ÿä¼šç¬é—´å¡æ­»ã€‚</p>
<p><strong>ç”Ÿå­˜æ³•åˆ™ä¸€ï¼šå¼‚æ­¥å‡½æ•°ä¸­ï¼Œåªç”¨å¼‚æ­¥åº“ã€‚</strong>
å½“ä½ åœ¨ <code>async def</code> å‡½æ•°ä¸­ä½¿ç”¨ä»»ä½•å¯èƒ½é˜»å¡çš„ I/O æ“ä½œæ—¶ï¼Œè¯·åŠ¡å¿…å¯»æ‰¾å¯¹åº”çš„<strong>å¼‚æ­¥ç‰ˆæœ¬åº“</strong>ã€‚ä¾‹å¦‚ï¼š</p>
<ul>
<li>ç”¨ <code>asyncio.sleep()</code> æ›¿ä»£ <code>time.sleep()</code>ã€‚</li>
<li>ç”¨ <code>httpx</code> æˆ– <code>aiohttp</code> æ›¿ä»£ <code>requests</code>ã€‚</li>
<li>ç”¨ <code>asyncpg</code>ã€<code>motor</code>ï¼ˆMongoDBï¼‰ç­‰å¼‚æ­¥æ•°æ®åº“é©±åŠ¨ï¼Œæˆ–è€… ORMï¼ˆå¦‚ <code>SQLAlchemy</code> 2.0+ï¼‰çš„å¼‚æ­¥æ¨¡å¼ã€‚</li>
</ul>
<h3 data-id="heading-2">3. CPU å¯†é›†å‹ä»»åŠ¡çš„â€œé€ƒç”Ÿèˆ±â€</h3>
<p>å¼‚æ­¥ç¼–ç¨‹æ“…é•¿å¤„ç† I/O å¯†é›†å‹ä»»åŠ¡ï¼Œä½†å®ƒå¯¹ <strong>CPU å¯†é›†å‹ä»»åŠ¡</strong>å´æ— èƒ½ä¸ºåŠ›ã€‚å› ä¸º CPU å¯†é›†å‹ä»»åŠ¡çš„ç“¶é¢ˆåœ¨äº CPU æœ¬èº«ï¼Œè€Œä¸æ˜¯ç­‰å¾…ã€‚</p>
<p>å¦‚æœä½ åœ¨ <code>async def</code> å‡½æ•°ä¸­æ‰§è¡Œä¸€ä¸ªé•¿è¾¾å‡ ç§’çš„å¤æ‚è®¡ç®—ï¼ˆæ¯”å¦‚å¤§é‡çš„å­—ç¬¦ä¸²å¤„ç†ã€å›¾åƒå¤„ç†ã€æœºå™¨å­¦ä¹ æ¨ç†ç­‰ï¼‰ï¼Œå®ƒä¾ç„¶ä¼šéœ¸å  Event Loopï¼Œå¯¼è‡´å…¶ä»–ç­‰å¾…ä¸­çš„å¼‚æ­¥ä»»åŠ¡æ— æ³•å¾—åˆ°è°ƒåº¦ã€‚</p>
<p><strong>ç”Ÿå­˜æ³•åˆ™äºŒï¼šè®¡ç®—ä»»åŠ¡ï¼Œäº¤ç»™çº¿ç¨‹æ± æˆ–è¿›ç¨‹æ± ã€‚</strong></p>
<p>FastAPI æ¡†æ¶éå¸¸èªæ˜ã€‚å¦‚æœä½ å®šä¹‰çš„è·¯ç”±å‡½æ•°æ˜¯æ™®é€šçš„ <code>def</code>ï¼ŒFastAPI ä¼šè‡ªåŠ¨å°†å®ƒæ”¾åˆ°ä¸€ä¸ªç‹¬ç«‹çš„<strong>çº¿ç¨‹æ± </strong>ä¸­è¿è¡Œï¼Œè¿™æ ·å°±ä¸ä¼šé˜»å¡ä¸» Event Loopã€‚</p>
<p>ä½†å¦‚æœä½ çš„è®¡ç®—é€»è¾‘å°±åœ¨ <code>async def</code> å†…éƒ¨ï¼Œä¸”ä½ ä¸æƒ³è®©å®ƒé˜»å¡ Event Loopï¼Œä½ å°±éœ€è¦æ‰‹åŠ¨ä½¿ç”¨ <code>run_in_executor</code> æ¥å°†å®ƒâ€œå¸è½½â€åˆ°çº¿ç¨‹æ± æˆ–è¿›ç¨‹æ± ä¸­ï¼š</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> asyncio
<span class="hljs-keyword">from</span> concurrent.futures <span class="hljs-keyword">import</span> ThreadPoolExecutor

executor = ThreadPoolExecutor(max_workers=<span class="hljs-number">4</span>) <span class="hljs-comment"># å¯ä»¥é…ç½®çº¿ç¨‹æ•°</span>

<span class="hljs-keyword">def</span> <span class="hljs-title function_">very_heavy_cpu_task</span>(<span class="hljs-params">data</span>):
    <span class="hljs-comment"># æ¨¡æ‹Ÿè€—æ—¶è®¡ç®—</span>
    result = <span class="hljs-built_in">sum</span>(<span class="hljs-built_in">range</span>(data))
    <span class="hljs-keyword">return</span> result

<span class="hljs-meta">@app.post(<span class="hljs-params"><span class="hljs-string">"/process_data"</span></span>)</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">process_data</span>(<span class="hljs-params">data: <span class="hljs-built_in">int</span></span>):
    <span class="hljs-comment"># å°† CPU å¯†é›†å‹ä»»åŠ¡æäº¤åˆ°çº¿ç¨‹æ± æ‰§è¡Œï¼Œä¸é˜»å¡ Event Loop</span>
    result = <span class="hljs-keyword">await</span> asyncio.get_event_loop().run_in_executor(
        executor, very_heavy_cpu_task, data
    )
    <span class="hljs-keyword">return</span> {<span class="hljs-string">"result"</span>: result}
</code></pre>
<h3 data-id="heading-3">4. ä» WSGI åˆ° ASGIï¼šåç«¯æ¶æ„çš„æ·±åº¦è¿›åŒ–</h3>
<p>ä½ å¯èƒ½å·²ç»ç”¨è¿‡ Flask æˆ– Djangoï¼Œå®ƒä»¬æ˜¯åŸºäº <strong>WSGI (Web Server Gateway Interface)</strong> æ ‡å‡†çš„ã€‚WSGI çš„è®¾è®¡ç†å¿µæ˜¯â€œè¯·æ±‚-å“åº”â€æ¨¡å‹ï¼Œé€šå¸¸æ¯ä¸ªè¯·æ±‚ä¼šå ç”¨ä¸€ä¸ªç‹¬ç«‹çš„çº¿ç¨‹ã€‚</p>
<p>è€Œ FastAPI æ˜¯åŸºäº <strong>ASGI (Asynchronous Server Gateway Interface)</strong> æ ‡å‡†çš„ã€‚ASGI å…è®¸ä¸€ä¸ªè¿›ç¨‹å†…çš„ Event Loop é«˜æ•ˆè°ƒåº¦æˆåƒä¸Šä¸‡ä¸ªè½»é‡çº§åç¨‹ã€‚è¿™å°±åƒï¼š</p>
<ul>
<li><strong>WSGIï¼š</strong> æ¯ä¸€ä¸ªè®¢å•ï¼ˆè¯·æ±‚ï¼‰éƒ½éœ€è¦ä¸€ä¸ªä¸“å±æœåŠ¡å‘˜ï¼ˆçº¿ç¨‹ï¼‰ä»å¤´è·Ÿåˆ°å°¾ã€‚æœåŠ¡å‘˜ä¸€æ—¦å»ä»“åº“ï¼ˆæ•°æ®åº“ I/Oï¼‰ï¼Œå°±å¾—ç­‰åœ¨ä»“åº“é—¨å£ã€‚</li>
<li><strong>ASGIï¼š</strong> ä¸€ä¸ªæ€»è°ƒåº¦å‘˜ï¼ˆEvent Loopï¼‰åŒæ—¶ç®¡ç†å¾ˆå¤šè®¢å•ã€‚å½“ä¸€ä¸ªè®¢å•éœ€è¦ç­‰ä»“åº“ï¼ˆI/Oï¼‰æ—¶ï¼Œè°ƒåº¦å‘˜ä¼šç«‹åˆ»å»å¤„ç†ä¸‹ä¸€ä¸ªè®¢å•ï¼Œç­‰ä»“åº“é‚£è¾¹å«ä»–äº†å†å›æ¥å¤„ç†ã€‚</li>
</ul>
<p>è¿™ç§åº•å±‚æ¶æ„çš„æ¼”è¿›ï¼Œè®© Python åœ¨å¤„ç†é•¿è¿æ¥ã€æµå¼æ•°æ®ï¼ˆå¦‚ LLM çš„æµå¼è¾“å‡ºï¼‰ã€é«˜å¹¶å‘ API ç­‰ç°ä»£ Web åœºæ™¯æ—¶ï¼Œæ‹¥æœ‰äº†å’Œ Node.js åª²ç¾çš„èƒ½åŠ›ã€‚</p>
<h3 data-id="heading-4">å†™åœ¨æœ€åï¼šåˆ«è®©ä½ çš„ Python å¼‚æ­¥ï¼Œè¾“åœ¨â€œç­‰å¾…â€ä¸Š</h3>
<p>è¢« JS çš„ <code>async/await</code> å® åï¼Œæ˜¯å¥½äº‹ã€‚å®ƒä¸ºä½ æ‰“å¼€äº†éé˜»å¡ç¼–ç¨‹çš„å¤§é—¨ã€‚å½“ä½ å¸¦ç€è¿™ç§ç›´è§‰æ¥åˆ° Pythonï¼Œå¹¶ç»“åˆ FastAPI çš„å·¥ç¨‹å®è·µï¼Œä½ å°†å‘ç° Python åœ¨é«˜å¹¶å‘æœåŠ¡é¢†åŸŸçš„å·¨å¤§æ½œåŠ›ã€‚</p>
<p>è®°ä½è¿™æœ¬â€œç”Ÿå­˜æ‰‹å†Œâ€çš„æ ¸å¿ƒï¼š<strong>å¼‚æ­¥ä¸æ˜¯è®©ä½ å†™ä»£ç æ›´é…·ï¼Œè€Œæ˜¯è®©ä½ çš„æœåŠ¡å™¨åœ¨é¢å¯¹ I/O ç­‰å¾…æ—¶ï¼Œèƒ½å¤Ÿæ›´â€œèªæ˜â€åœ°å·¥ä½œã€‚</strong> é‚£äº›è¢«æµªè´¹åœ¨ç­‰å¾…ä¸Šçš„ CPU å‘¨æœŸï¼Œå¦‚ä»Šéƒ½èƒ½è¢«æ¦¨å–å‡ºæœ€å¤§çš„ä»·å€¼ã€‚</p>
<p>ç°åœ¨ï¼Œæ˜¯æ—¶å€™åœ¨ä½ çš„ Python æœåŠ¡é‡Œï¼ŒçœŸæ­£é‡Šæ”¾å¼‚æ­¥çš„åŠ›é‡äº†ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Hook æœºåˆ¶å®æˆ˜:è®© ClaudeCode ä¸»åŠ¨é€šçŸ¥ä½ ]]></title>    <link>https://juejin.cn/post/7603911453704159275</link>    <guid>https://juejin.cn/post/7603911453704159275</guid>    <pubDate>2026-02-08T10:05:40.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7603911453704159275" data-draft-id="7603911453704126507" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Hook æœºåˆ¶å®æˆ˜:è®© ClaudeCode ä¸»åŠ¨é€šçŸ¥ä½ "/> <meta itemprop="keywords" content="Claude,AIç¼–ç¨‹"/> <meta itemprop="datePublished" content="2026-02-08T10:05:40.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å†¬å¥‡Lab"/> <meta itemprop="url" content="https://juejin.cn/user/1857501105781193"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Hook æœºåˆ¶å®æˆ˜:è®© ClaudeCode ä¸»åŠ¨é€šçŸ¥ä½ 
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1857501105781193/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å†¬å¥‡Lab
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-08T10:05:40.000Z" title="Sun Feb 08 2026 10:05:40 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»7åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">å¼•è¨€</h2>
<p>ä½ æœ‰æ²¡æœ‰é‡åˆ°è¿‡è¿™æ ·çš„åœºæ™¯?</p>
<blockquote>
<p><strong>åœºæ™¯ 1: å¤šç»ˆç«¯åä½œ</strong></p>
<pre><code class="hljs language-makefile" lang="makefile">[ä½ å¼€äº† 3 ä¸ªç»ˆç«¯,è®© AI å¹¶è¡Œå¤„ç†ä»»åŠ¡]
<span class="hljs-section">ç»ˆç«¯1: æ­£åœ¨é‡æ„ç”¨æˆ·æ¨¡å—...</span>
<span class="hljs-section">ç»ˆç«¯2: æ­£åœ¨æ·»åŠ æµ‹è¯•...</span>
<span class="hljs-section">ç»ˆç«¯3: æ­£åœ¨ä¼˜åŒ–æ€§èƒ½...</span>

[20åˆ†é’Ÿå,ä½ å›æ¥æ£€æŸ¥]
<span class="hljs-section">ä½ : "ç­‰ç­‰,å“ªä¸ªä»»åŠ¡å®Œæˆäº†?æˆ‘æ€ä¹ˆçŸ¥é“?"</span>
[éœ€è¦é€ä¸ªç»ˆç«¯æŸ¥çœ‹,æ•ˆç‡ä½ä¸‹]
</code></pre>
</blockquote>
<blockquote>
<p><strong>åœºæ™¯ 2: éœ€è¦äººå·¥ç¡®è®¤çš„å…³é”®æ“ä½œ</strong></p>
<pre><code class="hljs language-vbnet" lang="vbnet">ä½ : <span class="hljs-string">"å¸®æˆ‘éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒ"</span>

<span class="hljs-symbol">AI:</span> [å®Œæˆæ‰“åŒ…ã€æµ‹è¯•]
<span class="hljs-symbol">AI:</span> <span class="hljs-string">"æ‰€æœ‰æ£€æŸ¥é€šè¿‡,å‡†å¤‡éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒ"</span>
<span class="hljs-symbol">AI:</span> âš ï¸  [ç­‰å¾…ç”¨æˆ·ç¡®è®¤] è¯·è¾“å…¥ <span class="hljs-comment">'deploy' ç»§ç»­,æˆ– 'abort' å–æ¶ˆ</span>

[æ­¤æ—¶ä½ éœ€è¦æ”¶åˆ°é€šçŸ¥,è€Œä¸æ˜¯ä¸€ç›´ç›¯ç€å±å¹•]
</code></pre>
</blockquote>
<blockquote>
<p><strong>åœºæ™¯ 3: ä»£ç è´¨é‡ä¿éšœ</strong></p>
<pre><code class="hljs language-vbnet" lang="vbnet">ä½ : <span class="hljs-string">"å®ç°ç”¨æˆ·ç™»å½•åŠŸèƒ½"</span>

<span class="hljs-symbol">AI:</span> [ç”Ÿæˆä»£ç ...]
<span class="hljs-symbol">AI:</span> <span class="hljs-string">"âœ… ä»£ç å·²ç”Ÿæˆ"</span>

[ä½ å¿˜è®°æ‰§è¡Œä»£ç å®¡æŸ¥...]
[ä»£ç è´¨é‡æœ‰é—®é¢˜,éœ€è¦è¿”å·¥]
</code></pre>
</blockquote>
<p>è¿™äº›é—®é¢˜çš„æ ¹æºåœ¨äº:</p>
<ul>
<li><strong>ç¼ºå°‘é€šçŸ¥æœºåˆ¶</strong>: ä»»åŠ¡å®Œæˆåæ— æ³•åŠæ—¶æ„ŸçŸ¥,éœ€è¦äººå·¥ç›¯ç€</li>
<li><strong>ç¼ºå°‘è‡ªåŠ¨åŒ–æµç¨‹</strong>: é‡å¤æ€§å·¥ä½œéœ€è¦æ‰‹åŠ¨æ‰§è¡Œ,å®¹æ˜“é—æ¼</li>
</ul>
<p><strong>ç­”æ¡ˆæ˜¯</strong>: <strong>Hook æœºåˆ¶</strong></p>
<p>Hook(é’©å­)æ˜¯ Claude Code æä¾›çš„äº‹ä»¶è§¦å‘æœºåˆ¶,å…è®¸ä½ åœ¨ç‰¹å®šäº‹ä»¶å‘ç”Ÿæ—¶è‡ªåŠ¨æ‰§è¡Œè‡ªå®šä¹‰è„šæœ¬æˆ– LLM è¯„ä¼°ã€‚Claude Code æ”¯æŒ 12 ç§ Hook äº‹ä»¶ç±»å‹,å¸¸è§çš„æœ‰:</p>
<ul>
<li><strong>Stop</strong>: Claude å®Œæˆå“åº”æ—¶è§¦å‘,å¯ç”¨äºéªŒè¯ä»»åŠ¡å®Œæˆã€è‡ªåŠ¨ç»§ç»­å¤šè½®å·¥ä½œ</li>
<li><strong>Notification</strong>: é€šçŸ¥å‘é€æ—¶è§¦å‘,å¯ç”¨äºæ¡Œé¢/Slack é€šçŸ¥</li>
<li><strong>PreToolUse</strong>: å·¥å…·æ‰§è¡Œå‰è§¦å‘,å¯ç”¨äºæƒé™æ§åˆ¶ã€å‚æ•°ä¿®æ”¹</li>
<li><strong>PostToolUse</strong>: å·¥å…·æˆåŠŸæ‰§è¡Œåè§¦å‘,å¯ç”¨äºè‡ªåŠ¨ä»£ç æ ¼å¼åŒ–ã€è¿è¡Œ lint</li>
<li><strong>UserPromptSubmit</strong>: ç”¨æˆ·æäº¤æç¤ºè¯å‰è§¦å‘,å¯ç”¨äºéªŒè¯/è¿‡æ»¤è¾“å…¥</li>
</ul>
<p><strong>æ ¸å¿ƒç†å¿µ</strong>: <strong>è®© AI åœ¨å…³é”®æ—¶åˆ»ä¸»åŠ¨é€šçŸ¥ä½ ,è€Œä¸æ˜¯è¢«åŠ¨ç­‰å¾…</strong></p>
<p>æœ¬æ–‡å°†æ·±å…¥æ¢è®¨ Claude Code çš„ Hook æœºåˆ¶,è®©ä½ çš„ AI è¾…åŠ©å¼€å‘ä½“éªŒæ›´åŠ è‡ªåŠ¨åŒ–å’Œé«˜æ•ˆã€‚</p>
<p>é˜…è¯»æœ¬æ–‡å,ä½ å°†å­¦ä¼š:</p>
<ul>
<li>ç†è§£ Hook çš„å·¥ä½œåŸç†å’Œé…ç½®æ–¹å¼</li>
<li>æŒæ¡æ‰€æœ‰ 12 ç§ Hook äº‹ä»¶ç±»å‹</li>
<li>é…ç½®ä»»åŠ¡å®Œæˆè‡ªåŠ¨é€šçŸ¥å’Œè‡ªåŠ¨åŒ–å·¥ä½œæµ</li>
<li>æŒæ¡ Hook çš„æœ€ä½³å®è·µ</li>
</ul>
<hr/>
<h2 data-id="heading-1">ä¸€ã€Hook æœºåˆ¶åŸºç¡€</h2>
<h3 data-id="heading-2">1.1 Hook çš„å·¥ä½œåŸç†</h3>
<p>**Hook(é’©å­)**æ˜¯ Claude Code æä¾›çš„äº‹ä»¶è§¦å‘æœºåˆ¶,å…è®¸ä½ åœ¨ç‰¹å®šäº‹ä»¶å‘ç”Ÿæ—¶è‡ªåŠ¨æ‰§è¡Œè‡ªå®šä¹‰è„šæœ¬æˆ– LLM è¯„ä¼°ã€‚</p>
<p><strong>æ ¸å¿ƒæ¦‚å¿µ</strong>:</p>
<pre><code class="hljs">äº‹ä»¶å‘ç”Ÿ â†’ è§¦å‘ Hook â†’ æ‰§è¡Œè„šæœ¬/LLMè¯„ä¼° â†’ è¿”å›ç»“æœ â†’ ç»§ç»­æˆ–ä¸­æ–­
</code></pre>
<p><strong>Hook çš„ç”Ÿå‘½å‘¨æœŸ</strong>:</p>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-bullet">1.</span> æ³¨å†Œ Hook
   â†“
<span class="hljs-bullet">2.</span> ç›‘å¬äº‹ä»¶
   â†“
<span class="hljs-bullet">3.</span> äº‹ä»¶è§¦å‘
   â†“
<span class="hljs-bullet">4.</span> æ‰§è¡Œ Hook è„šæœ¬/LLMè¯„ä¼°
   â†“
<span class="hljs-bullet">5.</span> è·å–è¿”å›å€¼
   â†“
<span class="hljs-bullet">6.</span> æ ¹æ®è¿”å›å€¼å†³å®šæ˜¯å¦ç»§ç»­(å¯é˜»æ­¢çš„ Hook)
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1973aa18d13243018865d8f634278790~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Yas5aWHTGFi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771149943&amp;x-signature=UX7RGpg%2FRYefp6TS32MfmEN6osk%3D" alt="05-01-hook-lifecycle.png" loading="lazy"/></p>
<h3 data-id="heading-3">1.2 Hook é…ç½®æ–¹å¼</h3>
<p>Hook å¯ä»¥é€šè¿‡ä¸¤ç§æ–¹å¼é…ç½®:</p>
<h4 data-id="heading-4">æ–¹å¼ 1: é€šè¿‡ <code>/hooks</code> å‘½ä»¤é…ç½®(äº¤äº’å¼)</h4>
<p>åœ¨ Claude Code äº¤äº’å¼ç»ˆç«¯ä¸­è¾“å…¥:</p>
<pre><code class="hljs language-bash" lang="bash">&gt; /hooks
</code></pre>
<p>è¿™ä¼šæ‰“å¼€ Hook ç®¡ç†ç•Œé¢,ä½ å¯ä»¥:</p>
<ul>
<li>æŸ¥çœ‹å·²é…ç½®çš„ Hook</li>
<li>æ·»åŠ æ–°çš„ Hook è§„åˆ™</li>
<li>ç¼–è¾‘æˆ–åˆ é™¤ç°æœ‰ Hook</li>
</ul>
<h4 data-id="heading-5">æ–¹å¼ 2: é€šè¿‡ JSON é…ç½®æ–‡ä»¶(æ¨è)</h4>
<p><strong>å…¨å±€é…ç½®</strong> (<code>~/.claude/settings.json</code>):</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"hooks"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"Stop"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"hooks"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"prompt"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"prompt"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Check if all tasks complete. $ARGUMENTS"</span>
      <span class="hljs-punctuation">}</span><span class="hljs-punctuation">]</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"Notification"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"matcher"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"permission_prompt"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"hooks"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"command"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"command"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"notify-send 'Claude Code' 'Permission needed'"</span>
      <span class="hljs-punctuation">}</span><span class="hljs-punctuation">]</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"PostToolUse"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"matcher"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Edit|Write"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"hooks"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"command"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"command"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"npx prettier --write"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"async"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span>
      <span class="hljs-punctuation">}</span><span class="hljs-punctuation">]</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">]</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p><strong>é¡¹ç›®çº§é…ç½®</strong> (<code>.claude/settings.json</code> æˆ– <code>.claude/settings.local.json</code>):</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"hooks"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"PreToolUse"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"matcher"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Bash"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"hooks"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"command"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"command"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"./.claude/hooks/validate-bash.sh"</span>
      <span class="hljs-punctuation">}</span><span class="hljs-punctuation">]</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">]</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p><strong>é…ç½®ä¼˜å…ˆçº§</strong>:</p>
<pre><code class="hljs">é¡¹ç›®é…ç½® &gt; å…¨å±€é…ç½® &gt; é»˜è®¤ç­–ç•¥
</code></pre>
<h3 data-id="heading-6">1.3 Hook é…ç½®ç±»å‹</h3>
<p>Hook æ”¯æŒä¸‰ç§é…ç½®ç±»å‹:</p>

























<table><thead><tr><th align="left">ç±»å‹</th><th align="left">ç”¨é€”</th><th align="left">ç¤ºä¾‹</th></tr></thead><tbody><tr><td align="left"><strong>command</strong></td><td align="left">æ‰§è¡Œ shell è„šæœ¬</td><td align="left"><code>{"type": "command", "command": "./script.sh"}</code></td></tr><tr><td align="left"><strong>prompt</strong></td><td align="left">å¿«é€Ÿ LLM è¯„ä¼°</td><td align="left"><code>{"type": "prompt", "prompt": "Check if done"}</code></td></tr><tr><td align="left"><strong>agent</strong></td><td align="left">å®Œæ•´ä»£ç†éªŒè¯</td><td align="left"><code>{"type": "agent", "prompt": "Run tests"}</code></td></tr></tbody></table>
<hr/>
<h2 data-id="heading-7">äºŒã€Hook äº‹ä»¶ç±»å‹è¯¦è§£</h2>
<p>Claude Code æ”¯æŒ 12 ç§ Hook äº‹ä»¶ç±»å‹,ä»¥ä¸‹æ˜¯å®Œæ•´è¯´æ˜:</p>
<h3 data-id="heading-8">2.1 Hook ç±»å‹æ€»è§ˆ</h3>



















































































<table><thead><tr><th align="left">äº‹ä»¶åç§°</th><th align="left">è§¦å‘æ—¶æœº</th><th align="center">å¯é˜»æ­¢</th><th align="left">ç”¨é€”åˆ†ç±»</th></tr></thead><tbody><tr><td align="left"><strong>SessionStart</strong></td><td align="left">ä¼šè¯å¼€å§‹/æ¢å¤</td><td align="center">å¦</td><td align="left">åˆå§‹åŒ–/ä¸Šä¸‹æ–‡æ³¨å…¥</td></tr><tr><td align="left"><strong>UserPromptSubmit</strong></td><td align="left">ç”¨æˆ·æäº¤æç¤ºè¯å‰</td><td align="center">æ˜¯</td><td align="left">éªŒè¯/è¿‡æ»¤</td></tr><tr><td align="left"><strong>PreToolUse</strong></td><td align="left">å·¥å…·æ‰§è¡Œå‰</td><td align="center">æ˜¯</td><td align="left">æƒé™æ§åˆ¶/å‚æ•°ä¿®æ”¹</td></tr><tr><td align="left"><strong>PermissionRequest</strong></td><td align="left">æƒé™å¯¹è¯æ˜¾ç¤ºæ—¶</td><td align="center">æ˜¯</td><td align="left">è‡ªåŠ¨åŒ–æƒé™å†³ç­–</td></tr><tr><td align="left"><strong>PostToolUse</strong></td><td align="left">å·¥å…·æˆåŠŸæ‰§è¡Œå</td><td align="center">å¦</td><td align="left">æ ¼å¼åŒ–/éªŒè¯</td></tr><tr><td align="left"><strong>PostToolUseFailure</strong></td><td align="left">å·¥å…·æ‰§è¡Œå¤±è´¥å</td><td align="center">å¦</td><td align="left">é”™è¯¯å¤„ç†/å‘Šè­¦</td></tr><tr><td align="left"><strong>Notification</strong></td><td align="left">é€šçŸ¥å‘é€æ—¶</td><td align="center">å¦</td><td align="left">æ¡Œé¢/Slack é€šçŸ¥</td></tr><tr><td align="left"><strong>SubagentStart</strong></td><td align="left">å­ä»£ç†ç”Ÿæˆæ—¶</td><td align="center">å¦</td><td align="left">ä¸Šä¸‹æ–‡æ³¨å…¥</td></tr><tr><td align="left"><strong>SubagentStop</strong></td><td align="left">å­ä»£ç†å®Œæˆæ—¶</td><td align="center">æ˜¯</td><td align="left">ç»“æœéªŒè¯</td></tr><tr><td align="left"><strong>Stop</strong></td><td align="left">Claude å®Œæˆå“åº”æ—¶</td><td align="center">æ˜¯</td><td align="left">è‡ªåŠ¨ç»§ç»­/éªŒè¯å®Œæˆ</td></tr><tr><td align="left"><strong>PreCompact</strong></td><td align="left">ä¸Šä¸‹æ–‡å‹ç¼©å‰</td><td align="center">å¦</td><td align="left">å¤‡ä»½/æ¸…ç†</td></tr><tr><td align="left"><strong>SessionEnd</strong></td><td align="left">ä¼šè¯ç»“æŸæ—¶</td><td align="center">å¦</td><td align="left">æ¸…ç†/æ—¥å¿—</td></tr></tbody></table>
<h3 data-id="heading-9">2.2 è¯¦ç»†è¯´æ˜</h3>
<h4 data-id="heading-10">SessionStart</h4>
<p><strong>è§¦å‘æ¥æº</strong>: <code>startup</code>(æ–°å»º) | <code>resume</code>(æ¢å¤) | <code>clear</code>(/clearå) | <code>compact</code>(å‹ç¼©å)</p>
<p><strong>ç”¨é€”</strong>: åŠ è½½å¼€å‘ä¸Šä¸‹æ–‡ã€è®¾ç½®ç¯å¢ƒå˜é‡ã€åˆå§‹åŒ–å·¥å…·é“¾</p>
<p><strong>é…ç½®ç¤ºä¾‹</strong>:</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"hooks"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"SessionStart"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"matcher"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"startup"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"hooks"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"command"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"command"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"echo 'Session started'"</span>
      <span class="hljs-punctuation">}</span><span class="hljs-punctuation">]</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">]</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h4 data-id="heading-11">UserPromptSubmit</h4>
<p><strong>ç”¨é€”</strong>: éªŒè¯æç¤ºè¯ã€é˜»æ­¢æ•æ„Ÿè¯·æ±‚ã€æ·»åŠ åŠ¨æ€ä¸Šä¸‹æ–‡</p>
<p><strong>è¾“å‡ºæ§åˆ¶</strong>: é€€å‡ºç  2 æˆ– <code>"decision": "block"</code> å¯é˜»æ­¢æç¤º</p>
<p><strong>é…ç½®ç¤ºä¾‹</strong>:</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"hooks"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"UserPromptSubmit"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"hooks"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"command"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"command"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"./.claude/hooks/validate-prompt.sh"</span>
      <span class="hljs-punctuation">}</span><span class="hljs-punctuation">]</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">]</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h4 data-id="heading-12">PreToolUse</h4>
<p><strong>æ”¯æŒåŒ¹é…</strong>: <code>Bash</code> | <code>Edit</code> | <code>Write</code> | <code>Read</code> | <code>Glob</code> | <code>Grep</code> | <code>mcp__*</code></p>
<p><strong>å†³ç­–ç±»å‹</strong>: <code>allow</code> | <code>deny</code> | <code>ask</code></p>
<p><strong>é…ç½®ç¤ºä¾‹</strong>:</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"hooks"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"PreToolUse"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"matcher"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Bash"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"hooks"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"command"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"command"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"./.claude/hooks/validate-bash.sh"</span>
      <span class="hljs-punctuation">}</span><span class="hljs-punctuation">]</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">]</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h4 data-id="heading-13">PermissionRequest</h4>
<p><strong>ç”¨é€”</strong>: åœ¨ CI/CD æˆ–æ— å¤´æ¨¡å¼ä¸‹è‡ªåŠ¨æ‰¹å‡†/æ‹’ç»æƒé™è¯·æ±‚</p>
<p><strong>é…ç½®ç¤ºä¾‹</strong>:</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"hooks"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"PermissionRequest"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"hooks"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"command"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"command"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"./.claude/hooks/auto-permission.sh"</span>
      <span class="hljs-punctuation">}</span><span class="hljs-punctuation">]</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">]</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h4 data-id="heading-14">PostToolUse</h4>
<p><strong>ç”¨é€”</strong>: è‡ªåŠ¨ä»£ç æ ¼å¼åŒ–ã€è¿è¡Œ lintã€æ—¥å¿—è®°å½•</p>
<p><strong>é…ç½®ç¤ºä¾‹</strong>:</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"hooks"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"PostToolUse"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"matcher"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Edit|Write"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"hooks"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"command"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"command"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"npx prettier --write"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"async"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span>
      <span class="hljs-punctuation">}</span><span class="hljs-punctuation">]</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">]</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h4 data-id="heading-15">PostToolUseFailure</h4>
<p><strong>ç”¨é€”</strong>: é”™è¯¯æ—¥å¿—è®°å½•ã€å‘é€å‘Šè­¦ã€æ•…éšœè¯Šæ–­</p>
<p><strong>é…ç½®ç¤ºä¾‹</strong>:</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"hooks"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"PostToolUseFailure"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"hooks"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"command"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"command"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"./.claude/hooks/log-error.sh"</span>
      <span class="hljs-punctuation">}</span><span class="hljs-punctuation">]</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">]</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h4 data-id="heading-16">Notification</h4>
<p><strong>é€šçŸ¥ç±»å‹</strong>: <code>permission_prompt</code> | <code>idle_prompt</code> | <code>auth_success</code> | <code>elicitation_dialog</code></p>
<p><strong>é…ç½®ç¤ºä¾‹</strong>:</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"hooks"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"Notification"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"matcher"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"permission_prompt"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"hooks"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"command"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"command"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"notify-send 'Claude Code' 'Permission needed'"</span>
      <span class="hljs-punctuation">}</span><span class="hljs-punctuation">]</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">]</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h4 data-id="heading-17">SubagentStart</h4>
<p><strong>åŒ¹é…å€¼</strong>: <code>Bash</code> | <code>Explore</code> | <code>Plan</code> æˆ–è‡ªå®šä¹‰ä»£ç†å</p>
<p><strong>ç”¨é€”</strong>: ä¸ºå­ä»£ç†æ³¨å…¥å®‰å…¨ç­–ç•¥å’Œä¸Šä¸‹æ–‡</p>
<p><strong>é…ç½®ç¤ºä¾‹</strong>:</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"hooks"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"SubagentStart"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"matcher"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Bash"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"hooks"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"command"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"command"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"./.claude/hooks/inject-context.sh"</span>
      <span class="hljs-punctuation">}</span><span class="hljs-punctuation">]</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">]</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h4 data-id="heading-18">SubagentStop</h4>
<p><strong>ç”¨é€”</strong>: éªŒè¯å­ä»£ç†ç»“æœ,å†³å®šæ˜¯å¦ç»§ç»­/åœæ­¢</p>
<p><strong>é…ç½®ç¤ºä¾‹</strong>:</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"hooks"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"SubagentStop"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"hooks"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"prompt"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"prompt"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Verify subagent result: $ARGUMENTS"</span>
      <span class="hljs-punctuation">}</span><span class="hljs-punctuation">]</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">]</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h4 data-id="heading-19">Stop</h4>
<p><strong>ç”¨é€”</strong>: éªŒè¯ä»»åŠ¡å®Œæˆã€è‡ªåŠ¨ç»§ç»­å¤šè½®å·¥ä½œ</p>
<p><strong>é…ç½®ç¤ºä¾‹</strong>:</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"hooks"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"Stop"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"hooks"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"prompt"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"prompt"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Check if all tasks complete. $ARGUMENTS"</span>
      <span class="hljs-punctuation">}</span><span class="hljs-punctuation">]</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">]</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h4 data-id="heading-20">PreCompact</h4>
<p><strong>è§¦å‘å™¨</strong>: <code>manual</code>(/compactå‘½ä»¤) | <code>auto</code>(è‡ªåŠ¨å‹ç¼©)</p>
<p><strong>ç”¨é€”</strong>: å¤‡ä»½é‡è¦ä¸Šä¸‹æ–‡ã€æ¸…ç†ä¸´æ—¶æ–‡ä»¶</p>
<p><strong>é…ç½®ç¤ºä¾‹</strong>:</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"hooks"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"PreCompact"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"hooks"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"command"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"command"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"./.claude/hooks/backup-context.sh"</span>
      <span class="hljs-punctuation">}</span><span class="hljs-punctuation">]</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">]</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h4 data-id="heading-21">SessionEnd</h4>
<p><strong>ç»“æŸåŸå› </strong>: <code>clear</code> | <code>logout</code> | <code>prompt_input_exit</code> | <code>other</code></p>
<p><strong>ç”¨é€”</strong>: æ¸…ç†ä¸´æ—¶æ–‡ä»¶ã€ä¿å­˜ä¼šè¯ç»Ÿè®¡</p>
<p><strong>é…ç½®ç¤ºä¾‹</strong>:</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"hooks"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"SessionEnd"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"hooks"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"command"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"command"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"./.claude/hooks/cleanup.sh"</span>
      <span class="hljs-punctuation">}</span><span class="hljs-punctuation">]</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">]</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<hr/>
<h2 data-id="heading-22">ä¸‰ã€å®æˆ˜æ¡ˆä¾‹</h2>
<h3 data-id="heading-23">3.1 æ¡ˆä¾‹ 1: ä»»åŠ¡å®Œæˆè‡ªåŠ¨é€šçŸ¥</h3>
<p><strong>éœ€æ±‚</strong>: å¤šç»ˆç«¯åä½œæ—¶,ä»»åŠ¡å®Œæˆè‡ªåŠ¨å‘é€ç³»ç»Ÿé€šçŸ¥</p>
<p><strong>å®ç°</strong>: ä½¿ç”¨ <code>Stop</code> Hook è§¦å‘é€šçŸ¥</p>
<p><strong>æ­¥éª¤ 1: åˆ›å»ºé€šçŸ¥è„šæœ¬</strong></p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># ~/.claude/hooks/notify-complete.sh</span>
<span class="hljs-comment">#!/bin/bash</span>

<span class="hljs-comment"># æ ¹æ®æ“ä½œç³»ç»Ÿé€‰æ‹©é€šçŸ¥æ–¹å¼</span>
OS=$(<span class="hljs-built_in">uname</span> -s)

<span class="hljs-keyword">case</span> <span class="hljs-string">"<span class="hljs-variable">$OS</span>"</span> <span class="hljs-keyword">in</span>
    Darwin)  <span class="hljs-comment"># macOS</span>
        osascript -e <span class="hljs-string">'display notification "ä»»åŠ¡å®Œæˆ" with title "Claude Code"'</span>
        ;;
    Linux)
        notify-send <span class="hljs-string">"Claude Code"</span> <span class="hljs-string">"âœ… ä»»åŠ¡å®Œæˆ"</span>
        ;;
    *)
        <span class="hljs-built_in">echo</span> <span class="hljs-string">"Unsupported OS: <span class="hljs-variable">$OS</span>"</span>
        ;;
<span class="hljs-keyword">esac</span>

<span class="hljs-built_in">exit</span> 0
</code></pre>
<p><strong>æ­¥éª¤ 2: èµ‹äºˆæ‰§è¡Œæƒé™</strong></p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">chmod</span> +x ~/.claude/hooks/notify-complete.sh
</code></pre>
<p><strong>æ­¥éª¤ 3: é…ç½® Hook</strong></p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"hooks"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"Stop"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"hooks"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"command"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"command"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"~/.claude/hooks/notify-complete.sh"</span>
      <span class="hljs-punctuation">}</span><span class="hljs-punctuation">]</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">]</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h3 data-id="heading-24">3.2 æ¡ˆä¾‹ 2: æƒé™è¯·æ±‚è‡ªåŠ¨é€šçŸ¥</h3>
<p><strong>éœ€æ±‚</strong>: å½“éœ€è¦æƒé™ç¡®è®¤æ—¶,è‡ªåŠ¨å‘é€é€šçŸ¥æé†’</p>
<p><strong>å®ç°</strong>: ä½¿ç”¨ <code>Notification</code> Hook</p>
<p><strong>é…ç½®ç¤ºä¾‹</strong>:</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"hooks"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"Notification"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"matcher"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"permission_prompt"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"hooks"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"command"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"command"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"notify-send -u critical 'Claude Code' 'éœ€è¦æƒé™ç¡®è®¤'"</span>
      <span class="hljs-punctuation">}</span><span class="hljs-punctuation">]</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">]</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h3 data-id="heading-25">3.3 æ¡ˆä¾‹ 3: ä»£ç è‡ªåŠ¨æ ¼å¼åŒ–</h3>
<p><strong>éœ€æ±‚</strong>: æ¯æ¬¡ç¼–è¾‘æˆ–å†™å…¥æ–‡ä»¶å,è‡ªåŠ¨è¿è¡Œæ ¼å¼åŒ–å·¥å…·</p>
<p><strong>å®ç°</strong>: ä½¿ç”¨ <code>PostToolUse</code> Hook</p>
<p><strong>é…ç½®ç¤ºä¾‹</strong>:</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"hooks"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"PostToolUse"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"matcher"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Edit|Write"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"hooks"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"command"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"command"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"npx prettier --write $ARGUMENTS"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"async"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span>
      <span class="hljs-punctuation">}</span><span class="hljs-punctuation">]</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">]</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p><strong>æ³¨æ„</strong>: ä½¿ç”¨ <code>"async": true</code> è®©æ ¼å¼åŒ–åœ¨åå°æ‰§è¡Œ,ä¸é˜»å¡ä¸»æµç¨‹ã€‚</p>
<h3 data-id="heading-26">3.4 æ¡ˆä¾‹ 4: ä»»åŠ¡å®ŒæˆéªŒè¯</h3>
<p><strong>éœ€æ±‚</strong>: ä»»åŠ¡å®Œæˆåè‡ªåŠ¨éªŒè¯æ˜¯å¦æ‰€æœ‰ä»»åŠ¡éƒ½å·²å®Œæˆ</p>
<p><strong>å®ç°</strong>: ä½¿ç”¨ <code>Stop</code> Hook + <code>prompt</code> ç±»å‹</p>
<p><strong>é…ç½®ç¤ºä¾‹</strong>:</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"hooks"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"Stop"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"hooks"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"prompt"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"prompt"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"æ£€æŸ¥ä»¥ä¸‹ä»»åŠ¡æ˜¯å¦å…¨éƒ¨å®Œæˆ:\n$ARGUMENTS\nå¦‚æœè¿˜æœ‰æœªå®Œæˆçš„ä»»åŠ¡,è¯·ç»§ç»­æ‰§è¡Œã€‚"</span>
      <span class="hljs-punctuation">}</span><span class="hljs-punctuation">]</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">]</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<hr/>
<h2 data-id="heading-27">å››ã€æœ€ä½³å®è·µ</h2>
<h3 data-id="heading-28">4.1 Hook é…ç½®æœ€ä½³å®è·µ</h3>
<p><strong>âœ… DO(æ¨èåšæ³•)</strong></p>
<ol>
<li><strong>ä½¿ç”¨é¡¹ç›®çº§é…ç½®</strong>: é¡¹ç›®ç‰¹å®šçš„ Hook æ”¾åœ¨ <code>.claude/settings.local.json</code>,ä¸æäº¤åˆ° Git</li>
<li><strong>å¼‚æ­¥æ‰§è¡Œè€—æ—¶æ“ä½œ</strong>: å¯¹äºæ ¼å¼åŒ–ã€lint ç­‰è€—æ—¶æ“ä½œ,ä½¿ç”¨ <code>"async": true</code></li>
<li><strong>åˆç†ä½¿ç”¨ matcher</strong>: ç²¾ç¡®åŒ¹é…å·¥å…·ç±»å‹,é¿å…ä¸å¿…è¦çš„ Hook è§¦å‘</li>
<li><strong>é”™è¯¯å¤„ç†</strong>: Hook è„šæœ¬åº”åŒ…å«é”™è¯¯å¤„ç†,é¿å…å›  Hook å¤±è´¥å½±å“ä¸»æµç¨‹</li>
<li><strong>æ—¥å¿—è®°å½•</strong>: é‡è¦æ“ä½œè®°å½•æ—¥å¿—,ä¾¿äºè°ƒè¯•å’Œå®¡è®¡</li>
</ol>
<p><strong>âŒ DON'T(é¿å…çš„åšæ³•)</strong></p>
<ol>
<li><strong>Hook æ‰§è¡Œæ—¶é—´è¿‡é•¿</strong>: Hook è„šæœ¬åº”å¿«é€Ÿæ‰§è¡Œ(å»ºè®® &lt; 5 ç§’),è€—æ—¶æ“ä½œä½¿ç”¨å¼‚æ­¥</li>
<li><strong>é˜»å¡å…³é”®æµç¨‹</strong>: å¯é˜»æ­¢çš„ Hook(å¦‚ <code>PreToolUse</code>)åº”è°¨æ…ä½¿ç”¨,é¿å…è¯¯æ‹¦æˆª</li>
<li><strong>æ•æ„Ÿä¿¡æ¯æ³„éœ²</strong>: Hook è„šæœ¬ä¸­ä¸è¦ç¡¬ç¼–ç æ•æ„Ÿä¿¡æ¯,ä½¿ç”¨ç¯å¢ƒå˜é‡</li>
<li><strong>è¿‡åº¦ä¾èµ– Hook</strong>: Hook æ˜¯è¾…åŠ©å·¥å…·,ä¸åº”æ›¿ä»£æ­£å¸¸çš„æƒé™ç®¡ç†å’Œä»£ç å®¡æŸ¥æµç¨‹</li>
</ol>
<h3 data-id="heading-29">4.2 Hook ç±»å‹é€‰æ‹©æŒ‡å—</h3>













































<table><thead><tr><th align="left">åœºæ™¯</th><th align="left">æ¨è Hook</th><th align="left">è¯´æ˜</th></tr></thead><tbody><tr><td align="left"><strong>ä»»åŠ¡å®Œæˆé€šçŸ¥</strong></td><td align="left"><code>Stop</code></td><td align="left">Claude å®Œæˆå“åº”æ—¶è§¦å‘</td></tr><tr><td align="left"><strong>æƒé™è¯·æ±‚é€šçŸ¥</strong></td><td align="left"><code>Notification</code></td><td align="left">æƒé™å¯¹è¯æ˜¾ç¤ºæ—¶è§¦å‘</td></tr><tr><td align="left"><strong>ä»£ç è‡ªåŠ¨æ ¼å¼åŒ–</strong></td><td align="left"><code>PostToolUse</code></td><td align="left">å·¥å…·æˆåŠŸæ‰§è¡Œåè§¦å‘</td></tr><tr><td align="left"><strong>å±é™©å‘½ä»¤æ‹¦æˆª</strong></td><td align="left"><code>PreToolUse</code></td><td align="left">å·¥å…·æ‰§è¡Œå‰æ‹¦æˆª</td></tr><tr><td align="left"><strong>è¾“å…¥éªŒè¯</strong></td><td align="left"><code>UserPromptSubmit</code></td><td align="left">ç”¨æˆ·æäº¤å‰éªŒè¯</td></tr><tr><td align="left"><strong>é”™è¯¯å‘Šè­¦</strong></td><td align="left"><code>PostToolUseFailure</code></td><td align="left">å·¥å…·å¤±è´¥æ—¶å‘Šè­¦</td></tr><tr><td align="left"><strong>ä¼šè¯åˆå§‹åŒ–</strong></td><td align="left"><code>SessionStart</code></td><td align="left">ä¼šè¯å¼€å§‹æ—¶åŠ è½½ä¸Šä¸‹æ–‡</td></tr></tbody></table>
<h3 data-id="heading-30">4.3 é…ç½®ç®¡ç†æœ€ä½³å®è·µ</h3>
<p><strong>1. é…ç½®æ–‡ä»¶ç‰ˆæœ¬ç®¡ç†</strong></p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># é¡¹ç›®çº§é…ç½®æäº¤åˆ° Git</span>
git add .claude/settings.json
git commit -m <span class="hljs-string">"feat: add Claude Code hooks config"</span>

<span class="hljs-comment"># å…¨å±€é…ç½®ä¸æäº¤(ä¸ªäººè®¾ç½®)</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"~/.claude/settings.json"</span> &gt;&gt; ~/.gitignore_global
</code></pre>
<p><strong>2. Hook è„šæœ¬ç»„ç»‡</strong></p>
<pre><code class="hljs language-python" lang="python">.claude/
â”œâ”€â”€ settings.json              <span class="hljs-comment"># é¡¹ç›®é…ç½®(æäº¤åˆ° Git)</span>
â”œâ”€â”€ settings.local.json        <span class="hljs-comment"># æœ¬åœ°é…ç½®(ä¸æäº¤)</span>
â””â”€â”€ hooks/
    â”œâ”€â”€ notify-complete.sh     <span class="hljs-comment"># é€šçŸ¥è„šæœ¬</span>
    â”œâ”€â”€ validate-bash.sh       <span class="hljs-comment"># éªŒè¯è„šæœ¬</span>
    â””â”€â”€ auto-<span class="hljs-built_in">format</span>.sh         <span class="hljs-comment"># æ ¼å¼åŒ–è„šæœ¬</span>
</code></pre>
<p><strong>3. è°ƒè¯•æŠ€å·§</strong></p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># æµ‹è¯• Hook è„šæœ¬ç‹¬ç«‹è¿è¡Œ</span>
~/.claude/hooks/notify-complete.sh

<span class="hljs-comment"># æŸ¥çœ‹ Hook æ‰§è¡Œæ—¥å¿—</span>
<span class="hljs-built_in">tail</span> -f ~/.claude/logs/hook-execution.log

<span class="hljs-comment"># ä½¿ç”¨ shellcheck æ£€æŸ¥è„šæœ¬è¯­æ³•</span>
shellcheck ~/.claude/hooks/*.sh
</code></pre>
<h3 data-id="heading-31">4.4 æ€§èƒ½ä¼˜åŒ–</h3>
<p><strong>1. å¼‚æ­¥æ‰§è¡Œ</strong></p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"hooks"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"PostToolUse"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"matcher"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Edit|Write"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"hooks"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"command"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"command"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"./format.sh"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"async"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span>
      <span class="hljs-punctuation">}</span><span class="hljs-punctuation">]</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">]</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p><strong>2. ç²¾ç¡®åŒ¹é…</strong></p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"hooks"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"PreToolUse"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"matcher"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Bash"</span><span class="hljs-punctuation">,</span>  <span class="hljs-comment">// åªåŒ¹é… Bash,ä¸åŒ¹é…å…¶ä»–å·¥å…·</span>
      <span class="hljs-attr">"hooks"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>...<span class="hljs-punctuation">]</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">]</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p><strong>3. å¿«é€Ÿé€€å‡º</strong></p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-meta">#!/bin/bash</span>
<span class="hljs-comment"># Hook è„šæœ¬å¼€å¤´å¿«é€Ÿæ£€æŸ¥,ä¸æ»¡è¶³æ¡ä»¶ç«‹å³é€€å‡º</span>
<span class="hljs-keyword">if</span> [ <span class="hljs-string">"<span class="hljs-variable">$1</span>"</span> != <span class="hljs-string">"important-task"</span> ]; <span class="hljs-keyword">then</span>
    <span class="hljs-built_in">exit</span> 0
<span class="hljs-keyword">fi</span>
<span class="hljs-comment"># ç»§ç»­æ‰§è¡Œ...</span>
</code></pre>
<hr/>
<h2 data-id="heading-32">äº”ã€å¸¸è§é—®é¢˜ä¸è°ƒè¯•</h2>
<h3 data-id="heading-33">5.1 Hook æœªè§¦å‘</h3>
<p><strong>æ’æŸ¥æ­¥éª¤</strong>:</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 1. æ£€æŸ¥é…ç½®æ–‡ä»¶æ ¼å¼</span>
jq . ~/.claude/settings.json

<span class="hljs-comment"># 2. æ£€æŸ¥ Hook è„šæœ¬æƒé™</span>
<span class="hljs-built_in">ls</span> -l ~/.claude/hooks/*.sh
<span class="hljs-built_in">chmod</span> +x ~/.claude/hooks/*.sh

<span class="hljs-comment"># 3. æµ‹è¯•è„šæœ¬ç‹¬ç«‹è¿è¡Œ</span>
~/.claude/hooks/notify-complete.sh

<span class="hljs-comment"># 4. æŸ¥çœ‹ Hook æ‰§è¡Œæ—¥å¿—</span>
<span class="hljs-built_in">tail</span> -f ~/.claude/logs/hook-execution.log
</code></pre>
<h3 data-id="heading-34">5.2 Hook æ‰§è¡Œå¤±è´¥</h3>
<p><strong>è°ƒè¯•æŠ€å·§</strong>:</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 1. æ·»åŠ è°ƒè¯•è¾“å‡º</span>
<span class="hljs-built_in">set</span> -x
<span class="hljs-comment"># è„šæœ¬å†…å®¹...</span>
<span class="hljs-built_in">set</span> +x

<span class="hljs-comment"># 2. é‡å®šå‘é”™è¯¯åˆ°æ—¥å¿—</span>
./hook.sh 2&gt;&gt; ~/.claude/logs/hook-errors.log

<span class="hljs-comment"># 3. ä½¿ç”¨ shellcheck æ£€æŸ¥è¯­æ³•</span>
shellcheck ~/.claude/hooks/*.sh
</code></pre>
<h3 data-id="heading-35">5.3 æ€§èƒ½é—®é¢˜</h3>
<p><strong>ä¼˜åŒ–æ–¹æ³•</strong>:</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 1. å¼‚æ­¥æ‰§è¡Œè€—æ—¶æ“ä½œ</span>
<span class="hljs-built_in">command</span> &amp;  <span class="hljs-comment"># åå°æ‰§è¡Œ</span>

<span class="hljs-comment"># 2. æ·»åŠ è¶…æ—¶é™åˆ¶</span>
<span class="hljs-built_in">timeout</span> 5s ./slow-script.sh

<span class="hljs-comment"># 3. å¿«é€Ÿé€€å‡ºéå…³é”®åœºæ™¯</span>
<span class="hljs-keyword">if</span> [ <span class="hljs-string">"<span class="hljs-variable">$condition</span>"</span> != <span class="hljs-string">"important"</span> ]; <span class="hljs-keyword">then</span>
    <span class="hljs-built_in">exit</span> 0
<span class="hljs-keyword">fi</span>
</code></pre>
<hr/>
<h2 data-id="heading-36">å…­ã€æ€»ç»“</h2>
<h3 data-id="heading-37">6.1 æ ¸å¿ƒè¦ç‚¹å›é¡¾</h3>
<p>é€šè¿‡æœ¬æ–‡,æˆ‘ä»¬æ·±å…¥æ¢è®¨äº† Claude Code çš„ Hook æœºåˆ¶:</p>
<p><strong>Hook æœºåˆ¶</strong></p>
<ul>
<li><strong>åŸç†</strong>: äº‹ä»¶é©±åŠ¨,åœ¨ç‰¹å®šæ—¶æœºè‡ªåŠ¨æ‰§è¡Œè„šæœ¬æˆ– LLM è¯„ä¼°</li>
<li><strong>ç±»å‹</strong>: 12 ç§ Hook äº‹ä»¶ç±»å‹,è¦†ç›–å®Œæ•´çš„å¼€å‘ç”Ÿå‘½å‘¨æœŸ</li>
<li><strong>é…ç½®</strong>: é€šè¿‡ <code>/hooks</code> å‘½ä»¤æˆ– JSON é…ç½®æ–‡ä»¶</li>
<li><strong>åº”ç”¨</strong>: æ™ºèƒ½é€šçŸ¥ã€è‡ªåŠ¨åŒ– QAã€å®‰å…¨æ‹¦æˆªã€å·¥ä½œæµè‡ªåŠ¨åŒ–</li>
</ul>
<h3 data-id="heading-38">6.2 å¿«é€Ÿé…ç½®æŒ‡å—</h3>
<p><strong>ç¬¬ 1 æ­¥: åˆ›å»º Hook è„šæœ¬</strong></p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">mkdir</span> -p ~/.claude/hooks

<span class="hljs-built_in">cat</span> &gt; ~/.claude/hooks/notify-complete.sh &lt;&lt; <span class="hljs-string">'EOF'</span>
<span class="hljs-comment">#!/bin/bash</span>
notify-send <span class="hljs-string">"Claude Code"</span> <span class="hljs-string">"âœ… ä»»åŠ¡å®Œæˆ"</span>
<span class="hljs-built_in">exit</span> 0
EOF

<span class="hljs-built_in">chmod</span> +x ~/.claude/hooks/notify-complete.sh
</code></pre>
<p><strong>ç¬¬ 2 æ­¥: é…ç½® Hook</strong></p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"hooks"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"Stop"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"hooks"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"command"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"command"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"~/.claude/hooks/notify-complete.sh"</span>
      <span class="hljs-punctuation">}</span><span class="hljs-punctuation">]</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">]</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p><strong>ç¬¬ 3 æ­¥: éªŒè¯é…ç½®</strong></p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># å¯åŠ¨ Claude Code</span>
claude

<span class="hljs-comment"># æ‰§è¡Œä¸€ä¸ªä»»åŠ¡,å®Œæˆååº”è¯¥æ”¶åˆ°é€šçŸ¥</span>
&gt; å¸®æˆ‘åˆ›å»ºä¸€ä¸ª hello.txt æ–‡ä»¶
</code></pre>
<hr/>
<h2 data-id="heading-39">å‚è€ƒèµ„æ–™</h2>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fcode.claude.com%2Fdocs%2Fzh-CN%2Fhooks" target="_blank" title="https://code.claude.com/docs/zh-CN/hooks" ref="nofollow noopener noreferrer">Claude Code Hooks å‚è€ƒ</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgoogle.github.io%2Fstyleguide%2Fshellguide.html" target="_blank" title="https://google.github.io/styleguide/shellguide.html" ref="nofollow noopener noreferrer">Bash Scripting Best Practices</a></li>
</ul>
<hr/>
<blockquote>
<p>ğŸ’¡ <strong>æ€è€ƒé¢˜</strong>: ä½ çš„å¼€å‘æµç¨‹ä¸­,æœ‰å“ªäº›æ“ä½œå¯ä»¥é€šè¿‡ Hook è‡ªåŠ¨åŒ–?å¦‚æœè®©ä½ è®¾è®¡ä¸€ä¸ª Hook,ä½ ä¼šé€‰æ‹©ä»€ä¹ˆè§¦å‘æ—¶æœº?</p>
</blockquote>
<p>ğŸ”— <strong>ç›¸å…³æ–‡ç« </strong>:</p>
<ul>
<li><a href="https://juejin.cn/post/7603219519666749459" target="_blank" title="https://juejin.cn/post/7603219519666749459">ä¸Šä¸€ç¯‡: æƒé™ç®¡ç†å®æˆ˜</a></li>
</ul>
<hr/>
<p><em>å¦‚æœè¿™ç¯‡æ–‡ç« å¯¹ä½ æœ‰å¸®åŠ©,æ¬¢è¿ç‚¹èµã€æ”¶è—ã€åˆ†äº«!æœ‰ä»»ä½•é—®é¢˜æˆ–å»ºè®®,æ¬¢è¿åœ¨è¯„è®ºåŒºç•™è¨€è®¨è®ºã€‚è®©æˆ‘ä»¬ä¸€èµ·å­¦ä¹ ,ä¸€èµ·æˆé•¿!</em></p>
<p><em>ä¹Ÿæ¬¢è¿è®¿é—®æˆ‘çš„<a href="https://link.juejin.cn?target=https%3A%2F%2Fhome.wonlab.top" target="_blank" title="https://home.wonlab.top" ref="nofollow noopener noreferrer">ä¸ªäººä¸»é¡µ</a>å‘ç°æ›´å¤šå®è—èµ„æº</em></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[MCP (Model Context Protocol) æŠ€æœ¯ç†è§£ - ç¬¬ä¸€ç¯‡]]></title>    <link>https://juejin.cn/post/7604037348607082534</link>    <guid>https://juejin.cn/post/7604037348607082534</guid>    <pubDate>2026-02-08T10:07:19.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7604037348607082534" data-draft-id="7593171168259571721" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="MCP (Model Context Protocol) æŠ€æœ¯ç†è§£ - ç¬¬ä¸€ç¯‡"/> <meta itemprop="keywords" content="åç«¯,AIGC,MCP"/> <meta itemprop="datePublished" content="2026-02-08T10:07:19.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="æƒ³ç”¨offeræ‰“ç‰Œ"/> <meta itemprop="url" content="https://juejin.cn/user/578781641968972"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            MCP (Model Context Protocol) æŠ€æœ¯ç†è§£ - ç¬¬ä¸€ç¯‡
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/578781641968972/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    æƒ³ç”¨offeræ‰“ç‰Œ
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-08T10:07:19.000Z" title="Sun Feb 08 2026 10:07:19 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»5åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.8;font-weight:400;font-size:16px;word-spacing:2px;letter-spacing:2px;overflow-x:hidden;color:#3e3e3e;background-image:linear-gradient(90deg,rgba(50,0,0,.05) 3%,transparent 0),linear-gradient(1turn,rgba(50,0,0,.05) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:30px;margin-bottom:5px}.markdown-body h2{padding-bottom:12px;font-size:24px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:18px;padding-bottom:0}.markdown-body h4{font-size:1.2em;border-bottom:2px solid #ef7060;word-spacing:0!important;letter-spacing:0!important;font-size:inherit;line-height:inherit;display:block;font-weight:400;background:#ef7060;color:#fff;padding:10px;border-top-right-radius:3px;border-top-left-radius:3px;margin-right:3px}.markdown-body h5{font-size:15px}.markdown-body h6{margin-top:5px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="monokai">.markdown-body pre,.markdown-body pre&gt;code.hljs{background:#272822;color:#ddd}.hljs-keyword,.hljs-literal,.hljs-name,.hljs-selector-tag,.hljs-strong,.hljs-tag{color:#f92672}.hljs-code{color:#66d9ef}.hljs-class .hljs-title{color:#fff}.hljs-attribute,.hljs-link,.hljs-regexp,.hljs-symbol{color:#bf79db}.hljs-addition,.hljs-built_in,.hljs-builtin-name,.hljs-bullet,.hljs-emphasis,.hljs-section,.hljs-selector-attr,.hljs-selector-pseudo,.hljs-string,.hljs-subst,.hljs-template-tag,.hljs-template-variable,.hljs-title,.hljs-type,.hljs-variable{color:#a6e22e}.hljs-comment,.hljs-deletion,.hljs-meta,.hljs-quote{color:#75715e}.hljs-doctag,.hljs-keyword,.hljs-literal,.hljs-section,.hljs-selector-id,.hljs-selector-tag,.hljs-title,.hljs-type{font-weight:700}</style><h2 data-id="heading-0">å¼•è¨€</h2>
<p>æˆ‘ä¸€ç›´ä¸ºç½‘ä¸Šæ²¡æœ‰å¾ˆå¥½ä¸”é€šä¿—æ˜“æ‡‚çš„MCPæŠ€æœ¯æ–‡æ¡£è€Œçƒ¦æ¼ï¼Œæ‰€ä»¥æˆ‘é€šè¿‡è®°å½•è‡ªå·±æŸ¥é˜…å®˜æ–¹æ–‡æ¡£æ¥å†™ä¸€ä»½é€šä¿—æ˜“æ‡‚çš„MCPæŠ€æœ¯æ–‡æ¡£ï¼Œä»æ¶æ„åˆ°å®æˆ˜ï¼Œæ—¢æœ‰æŠ€æœ¯æ·±åº¦ï¼Œåˆèƒ½è®©å°ç™½ä¸€å¬å°±æ‡‚ã€‚è¿™å¯¹æˆ‘æ˜¯ä¸€ç§æŒ‘æˆ˜ï¼Œå¦‚æœç¬”è¯¯å¯ä»¥åœ¨è¯„è®ºåŒºæŒ‡å‡ºï¼Œè°¢è°¢ï¼</p>
<h2 data-id="heading-1">MCPæ˜¯ä»€ä¹ˆ</h2>
<p>Model Context Protocol (MCP) æ˜¯ Anthropic äº 2024 å¹´ 11 æœˆå‘å¸ƒçš„<strong>å¼€æ”¾æ ‡å‡†åè®®</strong>,æ—¨åœ¨ä¸º LLM åº”ç”¨æä¾›ç»Ÿä¸€çš„æ–¹å¼æ¥è¿æ¥å¤–éƒ¨æ•°æ®æºå’Œå·¥å…·ã€‚å®ƒè¢«ç§°ä¸º"AI çš„ type-cæ¥å£"ã€‚</p>
<p>ä½†æ˜¯æˆ‘è§‰å¾—å¦‚æœå°±å°†å®ƒæ¯”å–»æˆtype-cæ¥å£ï¼Œæˆ‘è§‰å¾—å¤ªè‰ç‡ã€‚</p>
<p>æˆ‘ä»¬å…ˆæ ‡å‡ºé‡ç‚¹ï¼Œ<strong>MCPå®ƒæ˜¯ä¸€ç§åè®®ï¼Œä¸€ç§æ ‡å‡†ï¼</strong> MCPæ˜¯ä¸€ç§åè®®ï¼ŒMCPæ˜¯ä¸€ç§åè®®ï¼ŒMCPæ˜¯ä¸€ç§åè®®ï¼Œé‡è¦çš„äº‹æƒ…è¯´ä¸‰éã€‚</p>
<p>é‚£ä¹ˆå®ƒåˆ°åº•æ˜¯å¹²äº†ä»€ä¹ˆï¼Ÿè¿™é‡Œç›´æ¥é€šä¿—æ˜“æ‡‚æ¥è¯´å§ï¼Œ<strong>å‡å¦‚è¯´LLMæ˜¯å¤§è„‘ï¼Œé‚£ä¹ˆLLMå¯ä»¥é€šè¿‡MCPåè®®é•¿å‡ºæ‰‹è„š</strong>ï¼Œå¯ä»¥åšåˆ°è®¿é—®èµ„æºï¼Œè°ƒç”¨å·¥å…·ï¼Œé¢„åˆ¶æ¨¡æ¿çš„äº‹æƒ…ç­‰ã€‚</p>
<p>ä¸ºä»€ä¹ˆè¿™ä¹ˆè¯´ï¼Ÿåœ¨å¤æ—©æ—¶æœŸï¼Œä¹Ÿå°±æ˜¯Chat-GPTæ¨ªç©ºå‡ºä¸–çš„æ—¶å€™ï¼Œä»–ä¹Ÿå°±æ˜¯ä¸€ä¸ªç®€å•çš„chatbotï¼Œé ç€ä»¥å¾€çš„çŸ¥è¯†åº“å›ç­”é—®é¢˜ï¼Œè€Œä¸èƒ½å®æ—¶å»è®¿é—®webä¸Šçš„èµ„æºå’Œä½ è‡ªå·±çš„çŸ¥è¯†åº“ï¼Œä¹Ÿä¸èƒ½å»å¸®ä½ å‘é‚®ä»¶ï¼Œè®¢èˆªç­ç­‰ç­‰ã€‚æœ‰äº†MCPï¼Œæˆ‘ä»¬å°±æœ‰äº†ä¸€ç§æ ‡å‡†å»åšè¿™äº›äº‹ã€‚æˆ‘ä»¬åªè¦å»å®ç°äº†æ ‡å‡†MCPçš„æ¥å£ï¼Œæ•°æ®å‘é€å’Œæ¥æ”¶éƒ½æ˜¯è§£æç›¸åŒæ ¼å¼çš„æ•°æ®ï¼Œé‚£ä¹ˆæŒ‰ç…§ç†è®ºæ¥è¯´ï¼Œæˆ‘ä»¬å°±èƒ½è®©AIåº”ç”¨å¸®æˆ‘ä»¬åšä»»ä½•äº‹æƒ…(å½“å‰ä¸è®¨è®ºç‰©ç†ä¸–ç•Œçš„åŠ³åŠ¨)ã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7de8c446fe4c4e9f8572ca5b9ca4a1c1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oOz55Sob2ZmZXLmiZPniYw=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771150068&amp;x-signature=FS2HAhCeUY3J0dcLOin0YMVC5Z8%3D" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-2">MCPåˆ°åº•è§£å†³ä»€ä¹ˆé—®é¢˜ï¼Ÿ</h2>
<p>æˆ‘ä»¬ä¸Šé¢è®¨è®ºäº†MCPèƒ½å¸®æˆ‘ä»¬å®ç°çš„äº‹æƒ…ï¼Œé‚£ä¹ˆMCPå®ƒæœ¬è´¨ä¸Šåˆ°åº•è§£å†³äº†ä»€ä¹ˆé—®é¢˜ï¼Ÿéš¾é“æˆ‘ä»¬ä»¥å‰æ²¡æœ‰MCPå°±æ— æ³•æŸ¥çœ‹webä¸Šé¢çš„èµ„æºæˆ–è€…çŸ¥è¯†åº“å—ï¼Ÿè®©æˆ‘ä»¬ä¸‹é¢ä¸€èµ·è®¨è®ºä¸€ä¸‹ã€‚</p>
<p>ä¼ ç»Ÿä¸Šï¼Œæˆ‘ä»¬ä¹Ÿæ˜¯å¯ä»¥å®ç°MCPçš„åŠŸèƒ½ï¼Œä½†æ˜¯è¿™æ ·æœ‰ä¸ªé—®é¢˜ï¼Œæ¯ä¸ªä¼ä¸šæ‰€åˆ›é€ å‡ºæ¥çš„è½¯ä»¶æˆ–è€…è¯´åº”ç”¨ç¨‹åºï¼Œå®ƒéƒ½ä¸æ˜¯ä¸€ä¸ªç»Ÿä¸€çš„æ¥å£æ¥è¿›è¡Œtool callingçš„ï¼Œéƒ½æ˜¯<strong>è‡ªæˆä¸€æ´¾</strong>ã€‚è¿™æ ·å°±ä¼šå¯¼è‡´é›†æˆéå¸¸ç¹æ‚ã€‚</p>
<p>ä¸Šä»£ç æ¥è§£é‡Šä¸€ä¸‹è¿™ç§ç°è±¡ï¼Ÿ</p>
<p><strong>ä¼ ç»Ÿæ–¹å¼çš„ç—›ç‚¹:</strong></p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># æ¯ä¸ªé›†æˆéƒ½éœ€è¦è‡ªå®šä¹‰ä»£ç </span>
<span class="hljs-keyword">if</span> service == <span class="hljs-string">"github"</span>:
    github_client = GitHubClient(token)
    data = github_client.get_issues()
<span class="hljs-keyword">elif</span> service == <span class="hljs-string">"slack"</span>:
    slack_client = SlackClient(token)
    data = slack_client.get_messages()
<span class="hljs-keyword">elif</span> service == <span class="hljs-string">"database"</span>:
    db_client = DatabaseClient(connection_string)
    data = db_client.query(<span class="hljs-string">"SELECT * FROM users"</span>)
<span class="hljs-comment"># ... æ¯ä¸ªæœåŠ¡éƒ½ä¸åŒ</span>
</code></pre>
<p><strong>ä½¿ç”¨MCPç»Ÿä¸€äº†ä¹‹åï¼š</strong></p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># ç»Ÿä¸€æ¥å£,æ ‡å‡†åŒ–åè®®</span>
mcp_client = McpClient()

<span class="hljs-comment"># æ‰€æœ‰æœåŠ¡ä½¿ç”¨ç›¸åŒçš„åè®®</span>
resources = mcp_client.list_resources()  <span class="hljs-comment"># è·å–å¯ç”¨èµ„æº</span>
tools = mcp_client.list_tools()          <span class="hljs-comment"># è·å–å¯ç”¨å·¥å…·</span>
result = mcp_client.call_tool(<span class="hljs-string">"search"</span>, args)  <span class="hljs-comment"># è°ƒç”¨å·¥å…·</span>
</code></pre>
<p><strong>è¿™é‡Œæˆ‘ä»¬å¼ºè°ƒä¸€ä¸‹MCPçš„ä¸‰å¤§æ ¸å¿ƒèƒ½åŠ›å§</strong>ï¼Œåˆ†åˆ«æ˜¯<strong>è®¿é—®èµ„æºï¼Œè°ƒç”¨å·¥å…·ï¼Œé¢„åˆ¶æ¨¡æ¿</strong>ï¼Œä¸‹é¢çš„è¡¨æ ¼è§£é‡Šäº†å®ƒå„è‡ªçš„ç‰¹ç‚¹ä¸ä½œç”¨</p>





























<table><thead><tr><th>èƒ½åŠ›</th><th>è¯´æ˜</th><th>æ§åˆ¶æ–¹</th><th>ç¤ºä¾‹</th></tr></thead><tbody><tr><td><strong>Resources</strong></td><td>åªè¯»æ•°æ®æº</td><td>Application</td><td>æ–‡ä»¶å†…å®¹ã€æ•°æ®åº“è®°å½•ã€API å“åº”</td></tr><tr><td><strong>Tools</strong></td><td>å¯æ‰§è¡Œå‡½æ•°</td><td>Model</td><td>æœç´¢èˆªç­ã€å‘é€æ¶ˆæ¯ã€åˆ›å»ºæ—¥å†äº‹ä»¶</td></tr><tr><td><strong>Prompts</strong></td><td>é¢„åˆ¶æ¨¡æ¿</td><td>User</td><td>è®¡åˆ’æ—…è¡Œã€æ€»ç»“ä¼šè®®ã€èµ·è‰é‚®ä»¶</td></tr></tbody></table>
<p>ç†è§£ä¸‰å¤§èƒ½åŠ›æ˜¯éå¸¸é‡è¦çš„ï¼Œå…³ä¹MCPçš„å¼€å‘èƒ½åŠ›ã€‚</p>
<h2 data-id="heading-3">MCPçš„æ¶æ„</h2>
<p>ç°åœ¨æˆ‘ä»¬ä¸€èµ·æ¥çœ‹çœ‹MCPçš„æ¶æ„æ˜¯æ€ä¹ˆæ ·çš„ã€‚</p>
<p>MCP é‡‡ç”¨å®¢æˆ·ç«¯-æœåŠ¡å™¨æ¶æ„ï¼Œå…¶ä¸­ MCP ä¸»æœºï¼ˆä¾‹å¦‚Claude Codeæˆ–Claude Desktopç­‰ AI åº”ç”¨ï¼‰ä¸ä¸€ä¸ªæˆ–å¤šä¸ª MCP æœåŠ¡å™¨å»ºç«‹è¿æ¥ã€‚MCP ä¸»æœºé€šè¿‡ä¸ºæ¯ä¸ª MCP æœåŠ¡å™¨åˆ›å»ºä¸€ä¸ª MCP å®¢æˆ·ç«¯æ¥å®ç°è¿™ä¸€ç‚¹ã€‚æ¯ä¸ª MCP å®¢æˆ·ç«¯ä¸å…¶å¯¹åº”çš„ MCP æœåŠ¡å™¨ä¿æŒä¸“ç”¨è¿æ¥ã€‚ä½¿ç”¨ STDIO ä¼ è¾“çš„æœ¬åœ° MCP æœåŠ¡å™¨é€šå¸¸æœåŠ¡äºå•ä¸ª MCP å®¢æˆ·ç«¯ï¼Œè€Œä½¿ç”¨ Streamable HTTP ä¼ è¾“çš„è¿œç¨‹ MCP æœåŠ¡å™¨é€šå¸¸æœåŠ¡äºå¤šä¸ª MCP å®¢æˆ·ç«¯ã€‚MCPæ¶æ„çš„å…³é”®å‚ä¸è€…åŒ…æ‹¬ï¼š</p>
<ul>
<li><strong>MCP ä¸»æœº</strong>ï¼šç”¨äºåè°ƒå’Œç®¡ç†ä¸€ä¸ªæˆ–å¤šä¸ª MCP å®¢æˆ·ç«¯çš„ AI åº”ç”¨ç¨‹åº</li>
<li><strong>MCP å®¢æˆ·ç«¯</strong>ï¼šä¸€ä¸ªç»´æŠ¤ä¸ MCP æœåŠ¡å™¨è¿æ¥å¹¶ä» MCP æœåŠ¡å™¨è·å–ä¸Šä¸‹æ–‡ä»¥ä¾› MCP ä¸»æœºä½¿ç”¨çš„ç»„ä»¶ã€‚</li>
<li><strong>MCP æœåŠ¡å™¨</strong>ï¼šä¸€ä¸ªä¸º MCP å®¢æˆ·ç«¯æä¾›ä¸Šä¸‹æ–‡ä¿¡æ¯çš„ç¨‹åº</li>
</ul>
<p>è¿™é‡Œå¼•ç”¨å®˜æ–¹æ–‡æ¡£çš„ä¾‹å­ï¼š</p>
<p><strong>ä¾‹å¦‚</strong>ï¼šVisual Studio Code å……å½“ MCP ä¸»æœºã€‚å½“ Visual Studio Code ä¸ MCP æœåŠ¡å™¨ï¼ˆä¾‹å¦‚Sentry MCP æœåŠ¡å™¨ï¼‰å»ºç«‹è¿æ¥æ—¶ï¼ŒVisual Studio Code è¿è¡Œæ—¶ä¼šå®ä¾‹åŒ–ä¸€ä¸ª MCP å®¢æˆ·ç«¯å¯¹è±¡æ¥ç»´æŠ¤ä¸ Sentry MCP æœåŠ¡å™¨çš„è¿æ¥ã€‚éšåï¼Œå½“ Visual Studio Code è¿æ¥åˆ°å¦ä¸€ä¸ª MCP æœåŠ¡å™¨ï¼ˆä¾‹å¦‚æœ¬åœ°æ–‡ä»¶ç³»ç»ŸæœåŠ¡å™¨ï¼‰æ—¶ï¼ŒVisual Studio Code è¿è¡Œæ—¶ä¼šå®ä¾‹åŒ–å¦ä¸€ä¸ª MCP å®¢æˆ·ç«¯å¯¹è±¡æ¥ç»´æŠ¤æ­¤è¿æ¥ã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1175bce98b984503942606e4f14729ab~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oOz55Sob2ZmZXLmiZPniYw=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771150068&amp;x-signature=TzpnLzD1wWltwmNdRfZ0IFUK5J0%3D" alt="image.png" loading="lazy"/></p>
<p>è¯·æ³¨æ„ï¼Œ<strong>MCP æœåŠ¡å™¨</strong>æŒ‡çš„æ˜¯æä¾›ä¸Šä¸‹æ–‡æ•°æ®çš„ç¨‹åºï¼Œæ— è®ºå…¶è¿è¡Œä½ç½®å¦‚ä½•ã€‚MCP æœåŠ¡å™¨å¯ä»¥æœ¬åœ°è¿è¡Œï¼Œä¹Ÿå¯ä»¥è¿œç¨‹è¿è¡Œã€‚ä¾‹å¦‚ï¼Œå½“ Claude Desktop å¯åŠ¨æ–‡ä»¶ç³»ç»ŸæœåŠ¡å™¨æ—¶ï¼Œç”±äºå®ƒä½¿ç”¨ STDIO ä¼ è¾“ï¼Œå› æ­¤æœåŠ¡å™¨è¿è¡Œåœ¨åŒä¸€å°æœºå™¨ä¸Šã€‚è¿™é€šå¸¸è¢«ç§°ä¸ºâ€œæœ¬åœ°â€MCP æœåŠ¡å™¨ã€‚å®˜æ–¹çš„Â Sentry MCP æœåŠ¡å™¨è¿è¡Œåœ¨ Sentry å¹³å°ä¸Šï¼Œå¹¶ä½¿ç”¨ Streamable HTTP ä¼ è¾“ã€‚è¿™é€šå¸¸è¢«ç§°ä¸ºâ€œè¿œç¨‹â€MCP æœåŠ¡å™¨ã€‚</p>
<h2 data-id="heading-4">å°ç»“</h2>
<p>ç¬¬ä¸€ç¯‡æˆ‘ä»¬å°±å…ˆè§£æMCPçš„æ¦‚å¿µï¼Œè§£å†³çš„é—®é¢˜ï¼Œè¿˜æœ‰æ¶æ„ã€‚æ¥ä¸‹æ¥æˆ‘ä»¬ç»§ç»­è§£æé€šä¿¡åè®®å’Œæ•°æ®æ ¼å¼ç­‰ï¼Œæœ‰å…´è¶£çš„å¯ä»¥å…³æ³¨æ­¤æ ç›®</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ä¸€å¤©ä¸€ä¸ªå¼€æºé¡¹ç›®ï¼ˆç¬¬16ç¯‡ï¼‰ï¼šCode2Video - ç”¨ä»£ç ç”Ÿæˆé«˜è´¨é‡æ•™å­¦è§†é¢‘çš„æ™ºèƒ½æ¡†æ¶]]></title>    <link>https://juejin.cn/post/7603643044035248164</link>    <guid>https://juejin.cn/post/7603643044035248164</guid>    <pubDate>2026-02-08T10:09:43.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7603643044035248164" data-draft-id="7603769956975575081" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ä¸€å¤©ä¸€ä¸ªå¼€æºé¡¹ç›®ï¼ˆç¬¬16ç¯‡ï¼‰ï¼šCode2Video - ç”¨ä»£ç ç”Ÿæˆé«˜è´¨é‡æ•™å­¦è§†é¢‘çš„æ™ºèƒ½æ¡†æ¶"/> <meta itemprop="keywords" content="AIGC,éŸ³è§†é¢‘å¼€å‘,å¼€æº"/> <meta itemprop="datePublished" content="2026-02-08T10:09:43.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å†¬å¥‡Lab"/> <meta itemprop="url" content="https://juejin.cn/user/1857501105781193"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ä¸€å¤©ä¸€ä¸ªå¼€æºé¡¹ç›®ï¼ˆç¬¬16ç¯‡ï¼‰ï¼šCode2Video - ç”¨ä»£ç ç”Ÿæˆé«˜è´¨é‡æ•™å­¦è§†é¢‘çš„æ™ºèƒ½æ¡†æ¶
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1857501105781193/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å†¬å¥‡Lab
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-08T10:09:43.000Z" title="Sun Feb 08 2026 10:09:43 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»22åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">å¼•è¨€</h2>
<blockquote>
<p>"å¦‚æœç”Ÿæˆæ•™å­¦è§†é¢‘å°±åƒå†™ä»£ç ä¸€æ ·ç®€å•ï¼Œé‚£è¯¥å¤šå¥½ï¼Ÿ"</p>
</blockquote>
<p>è¿™æ˜¯"ä¸€å¤©ä¸€ä¸ªå¼€æºé¡¹ç›®"ç³»åˆ—çš„ç¬¬16ç¯‡æ–‡ç« ã€‚ä»Šå¤©å¸¦ä½ äº†è§£çš„é¡¹ç›®æ˜¯ <strong>Code2Video</strong>ï¼ˆ<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fshowlab%2FCode2Video" target="_blank" title="https://github.com/showlab/Code2Video" ref="nofollow noopener noreferrer">GitHub</a>ï¼‰ã€‚</p>
<p>åœ¨AIè§†é¢‘ç”Ÿæˆé¢†åŸŸï¼Œå¤§å¤šæ•°æ¨¡å‹éƒ½æ˜¯åŸºäºåƒç´ çš„æ–‡æœ¬åˆ°è§†é¢‘ç”Ÿæˆï¼Œè™½ç„¶èƒ½äº§ç”Ÿè§†è§‰æ•ˆæœï¼Œä½†åœ¨æ•™è‚²åœºæ™¯ä¸­å¾€å¾€ç¼ºä¹æ¸…æ™°åº¦ã€è¿è´¯æ€§å’Œå¯é‡ç°æ€§ã€‚Code2Video æå‡ºäº†ä¸€ä¸ªé©å‘½æ€§çš„ä»£ç ä¸­å¿ƒèŒƒå¼ï¼šä½¿ç”¨å¯æ‰§è¡Œçš„ Manim ä»£ç ä½œä¸ºç»Ÿä¸€åª’ä»‹ï¼Œé€šè¿‡å¤šæ™ºèƒ½ä½“ç³»ç»Ÿè‡ªåŠ¨ç”Ÿæˆé«˜è´¨é‡çš„æ•™å­¦è§†é¢‘ã€‚æ— è®ºæ˜¯æ±‰è¯ºå¡”é—®é¢˜ã€å¤§è¯­è¨€æ¨¡å‹åŸç†ï¼Œè¿˜æ˜¯å‚…é‡Œå¶çº§æ•°ï¼Œéƒ½èƒ½é€šè¿‡ä»£ç è‡ªåŠ¨ç”Ÿæˆæ¸…æ™°ã€ç¾è§‚ã€å¯é‡ç°çš„æ•™è‚²è§†é¢‘ã€‚</p>
<p><strong>ä¸ºä»€ä¹ˆé€‰æ‹©è¿™ä¸ªé¡¹ç›®ï¼Ÿ</strong></p>
<ul>
<li>ğŸ¬ <strong>ä»£ç ä¸­å¿ƒèŒƒå¼</strong>ï¼šå¯æ‰§è¡Œä»£ç ä½œä¸ºè§†é¢‘ç”Ÿæˆçš„ç»Ÿä¸€åª’ä»‹ï¼Œç¡®ä¿æ¸…æ™°åº¦å’Œå¯é‡ç°æ€§</li>
<li>ğŸ¤– <strong>ä¸‰æ™ºèƒ½ä½“ç³»ç»Ÿ</strong>ï¼šPlannerï¼ˆæ•…äº‹æ¿æ‰©å±•ï¼‰ã€Coderï¼ˆå¯è°ƒè¯•ä»£ç åˆæˆï¼‰ã€Criticï¼ˆå¸ƒå±€ä¼˜åŒ–ï¼‰ååŒå·¥ä½œ</li>
<li>ğŸ“š <strong>MMMCåŸºå‡†æµ‹è¯•</strong>ï¼šé¦–ä¸ªä»£ç é©±åŠ¨è§†é¢‘ç”ŸæˆåŸºå‡†ï¼Œæ¶µç›–117ä¸ªç²¾é€‰å­¦ä¹ ä¸»é¢˜</li>
<li>ğŸ“ <strong>æ•™è‚²åœºæ™¯ä¼˜åŒ–</strong>ï¼šä¸“ä¸ºæ•™å­¦è§†é¢‘è®¾è®¡ï¼Œå‚è€ƒ3Blue1Brownçš„é«˜è´¨é‡æ ‡å‡†</li>
<li>ğŸ† <strong>å­¦æœ¯è®¤å¯</strong>ï¼šå·²è¢«NeurIPS 2025çš„Deep Learning for Code (DL4C) Workshopæ¥å—</li>
<li>ğŸ§ª <strong>å¤šç»´åº¦è¯„ä¼°</strong>ï¼šç³»ç»Ÿæ€§è¯„ä¼°æ•ˆç‡ã€ç¾å­¦å’Œç«¯åˆ°ç«¯çŸ¥è¯†ä¼ é€’</li>
</ul>
<h3 data-id="heading-1">ä½ å°†å­¦åˆ°ä»€ä¹ˆ</h3>
<ul>
<li>Code2Video çš„ä»£ç ä¸­å¿ƒèŒƒå¼å’Œè®¾è®¡ç†å¿µ</li>
<li>ä¸‰æ™ºèƒ½ä½“ç³»ç»Ÿï¼ˆPlannerã€Coderã€Criticï¼‰çš„å·¥ä½œåŸç†</li>
<li>å¦‚ä½•ä½¿ç”¨ Manim ä»£ç ç”Ÿæˆæ•™å­¦è§†é¢‘</li>
<li>MMMC åŸºå‡†æµ‹è¯•çš„æ„å»ºå’Œè¯„ä¼°æ–¹æ³•</li>
<li>å¦‚ä½•é…ç½®å’Œä½¿ç”¨ Code2Video ç”Ÿæˆè§†é¢‘</li>
<li>ä¸å…¶ä»–è§†é¢‘ç”Ÿæˆæ–¹æ³•çš„å¯¹æ¯”åˆ†æ</li>
<li>å®é™…æ•™è‚²åœºæ™¯ä¸­çš„åº”ç”¨æ¡ˆä¾‹</li>
</ul>
<h3 data-id="heading-2">å‰ç½®çŸ¥è¯†</h3>
<ul>
<li>å¯¹AIè§†é¢‘ç”Ÿæˆæœ‰åŸºæœ¬äº†è§£</li>
<li>äº†è§£å¤šæ™ºèƒ½ä½“ç³»ç»Ÿæ¦‚å¿µ</li>
<li>ç†Ÿæ‚‰Pythonç¼–ç¨‹ï¼ˆå¯é€‰ï¼Œæœ‰åŠ©äºç†è§£ä»£ç ç”Ÿæˆï¼‰</li>
<li>å¯¹æ•™è‚²è§†é¢‘è®¾è®¡æœ‰åŸºæœ¬æ¦‚å¿µï¼ˆå¯é€‰ï¼‰</li>
</ul>
<hr/>
<h2 data-id="heading-3">é¡¹ç›®èƒŒæ™¯</h2>
<h3 data-id="heading-4">é¡¹ç›®ç®€ä»‹</h3>
<p><strong>Code2Video</strong> æ˜¯ä¸€ä¸ª<strong>ä»¥ä»£ç ä¸ºä¸­å¿ƒçš„æ™ºèƒ½ä½“æ¡†æ¶</strong>ï¼Œç”¨äºä»çŸ¥è¯†ç‚¹ç”Ÿæˆé«˜è´¨é‡çš„æ•™å­¦è§†é¢‘ã€‚ä¸åŸºäºåƒç´ çš„æ–‡æœ¬åˆ°è§†é¢‘æ¨¡å‹ä¸åŒï¼ŒCode2Video åˆ©ç”¨å¯æ‰§è¡Œçš„ <strong>Manim ä»£ç </strong>æ¥ç¡®ä¿è§†é¢‘çš„æ¸…æ™°åº¦ã€è¿è´¯æ€§å’Œå¯é‡ç°æ€§ã€‚é€šè¿‡ä¸‰æ™ºèƒ½ä½“ç³»ç»Ÿï¼ˆPlannerã€Coderã€Criticï¼‰çš„ååŒå·¥ä½œï¼Œè‡ªåŠ¨å°†çŸ¥è¯†ç‚¹è½¬æ¢ä¸ºç»“æ„åŒ–çš„æ•™å­¦è§†é¢‘ã€‚</p>
<p><strong>é¡¹ç›®è§£å†³çš„æ ¸å¿ƒé—®é¢˜</strong>ï¼š</p>
<ul>
<li>ä¼ ç»Ÿæ–‡æœ¬åˆ°è§†é¢‘æ¨¡å‹ç”Ÿæˆçš„æ•™å­¦è§†é¢‘ç¼ºä¹æ¸…æ™°åº¦å’Œè¿è´¯æ€§</li>
<li>è§†é¢‘ç”Ÿæˆè¿‡ç¨‹ä¸å¯é‡ç°ï¼Œéš¾ä»¥è°ƒè¯•å’Œä¼˜åŒ–</li>
<li>ç¼ºä¹ä¸“é—¨é’ˆå¯¹æ•™è‚²åœºæ™¯çš„è§†é¢‘ç”Ÿæˆå·¥å…·</li>
<li>è§†é¢‘è´¨é‡è¯„ä¼°ç¼ºä¹ç³»ç»Ÿæ€§æ ‡å‡†</li>
<li>éœ€è¦å¤§é‡äººå·¥å·¥ä½œæ¥åˆ›å»ºé«˜è´¨é‡æ•™å­¦è§†é¢‘</li>
</ul>
<p><strong>é¢å‘çš„ç”¨æˆ·ç¾¤ä½“</strong>ï¼š</p>
<ul>
<li>æ•™è‚²å·¥ä½œè€…å’Œè¯¾ç¨‹è®¾è®¡å¸ˆ</li>
<li>åœ¨çº¿æ•™è‚²å¹³å°å¼€å‘è€…</li>
<li>AIè§†é¢‘ç”Ÿæˆç ”ç©¶è€…</li>
<li>éœ€è¦æ‰¹é‡ç”Ÿæˆæ•™å­¦è§†é¢‘çš„æœºæ„</li>
<li>å¯¹ä»£ç é©±åŠ¨è§†é¢‘ç”Ÿæˆæ„Ÿå…´è¶£çš„æŠ€æœ¯äººå‘˜</li>
</ul>
<h3 data-id="heading-5">ä½œè€…/å›¢é˜Ÿä»‹ç»</h3>
<p><strong>å›¢é˜Ÿï¼šShow Lab @ National University of Singapore</strong></p>
<ul>
<li><strong>ä¸»è¦ä½œè€…</strong>ï¼š
<ul>
<li>Yanzhe Chenï¼ˆé™ˆå½¦å“²ï¼‰</li>
<li>Kevin Qinghong Linï¼ˆæ—åº†å®ï¼‰</li>
<li>Mike Zheng Shouï¼ˆæŒ‡å¯¼æ•™æˆï¼‰</li>
</ul>
</li>
<li><strong>èƒŒæ™¯</strong>ï¼šæ–°åŠ å¡å›½ç«‹å¤§å­¦ Show Labï¼Œä¸“æ³¨äºè§†é¢‘ç†è§£å’Œç”Ÿæˆç ”ç©¶</li>
<li><strong>é¡¹ç›®åˆ›å»ºæ—¶é—´</strong>ï¼š2025å¹´</li>
<li><strong>å­¦æœ¯æˆæœ</strong>ï¼šå·²è¢« NeurIPS 2025 çš„ Deep Learning for Code (DL4C) Workshop æ¥å—</li>
<li><strong>ç†å¿µ</strong>ï¼šç”¨ä»£ç åˆ›é€ æ¸…æ™°ã€ç¾è§‚ã€å¯é‡ç°çš„æ•™è‚²è§†é¢‘</li>
</ul>
<h3 data-id="heading-6">é¡¹ç›®æ•°æ®</h3>
<ul>
<li>â­ <strong>GitHub Stars</strong>: 1.5k+ï¼ˆæŒç»­å¢é•¿ä¸­ï¼‰</li>
<li>ğŸ´ <strong>Forks</strong>: 203+</li>
<li>ğŸ“¦ <strong>ç‰ˆæœ¬</strong>: æŒç»­æ›´æ–°ä¸­ï¼ˆ95+ commitsï¼‰</li>
<li>ğŸ“„ <strong>License</strong>: MITï¼ˆå®Œå…¨å¼€æºï¼Œè‡ªç”±ä½¿ç”¨ï¼‰</li>
<li>ğŸŒ <strong>é¡¹ç›®ç½‘ç«™</strong>: <a href="https://link.juejin.cn?target=https%3A%2F%2Fshowlab.github.io%2FCode2Video%2F" target="_blank" title="https://showlab.github.io/Code2Video/" ref="nofollow noopener noreferrer">showlab.github.io/Code2Video</a></li>
<li>ğŸ“„ <strong>è®ºæ–‡</strong>: <a href="https://link.juejin.cn?target=https%3A%2F%2Farxiv.org%2Fabs%2F2510.01174" target="_blank" title="https://arxiv.org/abs/2510.01174" ref="nofollow noopener noreferrer">arXiv:2510.01174</a></li>
<li>ğŸ’¬ <strong>ç¤¾åŒº</strong>: GitHub Issues æ´»è·ƒï¼Œ1ä¸ªå¼€æ”¾ Issue</li>
<li>ğŸ‘¥ <strong>è´¡çŒ®è€…</strong>: 3ä½æ ¸å¿ƒè´¡çŒ®è€…</li>
</ul>
<p><strong>é¡¹ç›®å‘å±•å†ç¨‹</strong>ï¼š</p>
<ul>
<li>2025å¹´9æœˆï¼šé¡¹ç›®åˆ›å»ºï¼Œå‘å¸ƒåˆå§‹ç‰ˆæœ¬</li>
<li>2025å¹´9æœˆ22æ—¥ï¼šè¢« NeurIPS 2025 çš„ DL4C Workshop æ¥å—</li>
<li>2025å¹´10æœˆ2æ—¥ï¼šå‘å¸ƒ arXiv è®ºæ–‡ã€ä»£ç å’Œæ•°æ®é›†</li>
<li>2025å¹´10æœˆ3æ—¥ï¼šåœ¨ Twitter ä¸Šè·å¾—å¹¿æ³›å…³æ³¨</li>
<li>2025å¹´10æœˆ6æ—¥ï¼šæ›´æ–° MMMC æ•°æ®é›†çš„çœŸå®äººå·¥åˆ¶ä½œè§†é¢‘å’Œå…ƒæ•°æ®</li>
<li>2025å¹´10æœˆ11æ—¥ï¼šæ›´æ–°å›¾æ ‡æ”¶é›†æºï¼ˆä» IconFinder åˆ° MMMCï¼‰</li>
<li>2025å¹´11æœˆ6æ—¥ï¼šä¼˜åŒ– requirements.txtï¼Œå®‰è£…æ—¶é—´å‡å°‘80-90%</li>
<li>2025å¹´11æœˆ25æ—¥ï¼šè¾¾åˆ° 1000 stars é‡Œç¨‹ç¢‘</li>
<li>æŒç»­ç»´æŠ¤ï¼šé¡¹ç›®æŒç»­æ´»è·ƒï¼Œç¤¾åŒºè´¡çŒ®ä¸æ–­</li>
</ul>
<hr/>
<h2 data-id="heading-7">ä¸»è¦åŠŸèƒ½</h2>
<h3 data-id="heading-8">æ ¸å¿ƒä½œç”¨</h3>
<p>Code2Video çš„æ ¸å¿ƒä½œç”¨æ˜¯<strong>é€šè¿‡ä»£ç è‡ªåŠ¨ç”Ÿæˆé«˜è´¨é‡çš„æ•™å­¦è§†é¢‘</strong>ï¼Œä¸»è¦åŠŸèƒ½åŒ…æ‹¬ï¼š</p>
<ol>
<li><strong>çŸ¥è¯†ç‚¹åˆ°è§†é¢‘çš„è‡ªåŠ¨è½¬æ¢</strong>ï¼šè¾“å…¥çŸ¥è¯†ç‚¹ï¼Œè‡ªåŠ¨ç”Ÿæˆå®Œæ•´çš„æ•™å­¦è§†é¢‘</li>
<li><strong>ä¸‰æ™ºèƒ½ä½“ååŒå·¥ä½œ</strong>ï¼šPlanner è§„åˆ’æ•…äº‹æ¿ï¼ŒCoder ç”Ÿæˆ Manim ä»£ç ï¼ŒCritic ä¼˜åŒ–å¸ƒå±€å’Œç¾å­¦</li>
<li><strong>å¯æ‰§è¡Œä»£ç ç”Ÿæˆ</strong>ï¼šç”Ÿæˆå¯è°ƒè¯•ã€å¯ä¿®æ”¹çš„ Manim ä»£ç ï¼Œè€Œéåƒç´ çº§è§†é¢‘</li>
<li><strong>å¤šä¸»é¢˜æ”¯æŒ</strong>ï¼šæ”¯æŒæ•°å­¦ã€è®¡ç®—æœºç§‘å­¦ã€ç‰©ç†ç­‰å¤šä¸ªé¢†åŸŸçš„æ•™å­¦ä¸»é¢˜</li>
<li><strong>é«˜è´¨é‡è¾“å‡º</strong>ï¼šå‚è€ƒ 3Blue1Brown çš„æ ‡å‡†ï¼Œç”Ÿæˆæ¸…æ™°ã€ç¾è§‚çš„æ•™å­¦è§†é¢‘</li>
<li><strong>ç³»ç»Ÿæ€§è¯„ä¼°</strong>ï¼šæä¾›çŸ¥è¯†ä¼ é€’ã€ç¾å­¦è´¨é‡ã€æ•ˆç‡ç­‰å¤šç»´åº¦è¯„ä¼°</li>
</ol>
<h3 data-id="heading-9">ä½¿ç”¨åœºæ™¯</h3>
<p>Code2Video é€‚ç”¨äºå¤šç§æ•™è‚²åœºæ™¯ï¼š</p>
<ol>
<li>
<p><strong>åœ¨çº¿è¯¾ç¨‹åˆ¶ä½œ</strong></p>
<ul>
<li>å¿«é€Ÿä¸ºåœ¨çº¿è¯¾ç¨‹ç”Ÿæˆæ•™å­¦è§†é¢‘</li>
<li>æ‰¹é‡ç”Ÿæˆå¤šä¸ªçŸ¥è¯†ç‚¹çš„è§†é¢‘å†…å®¹</li>
<li>ä¿æŒè§†é¢‘é£æ ¼çš„ä¸€è‡´æ€§</li>
</ul>
</li>
<li>
<p><strong>æ•™è‚²å†…å®¹åˆ›ä½œ</strong></p>
<ul>
<li>æ•™è‚²å·¥ä½œè€…å¿«é€Ÿåˆ¶ä½œæ•™å­¦è§†é¢‘</li>
<li>å°†å¤æ‚æ¦‚å¿µå¯è§†åŒ–</li>
<li>åˆ›å»ºäº¤äº’å¼æ•™å­¦å†…å®¹</li>
</ul>
</li>
<li>
<p><strong>ç ”ç©¶å’Œè¯„ä¼°</strong></p>
<ul>
<li>ç ”ç©¶ä»£ç é©±åŠ¨è§†é¢‘ç”Ÿæˆæ–¹æ³•</li>
<li>è¯„ä¼°ä¸åŒè§†é¢‘ç”ŸæˆæŠ€æœ¯çš„æ•ˆæœ</li>
<li>æ„å»ºæ•™è‚²è§†é¢‘ç”ŸæˆåŸºå‡†æµ‹è¯•</li>
</ul>
</li>
<li>
<p><strong>è‡ªåŠ¨åŒ–å†…å®¹ç”Ÿäº§</strong></p>
<ul>
<li>æ•™è‚²å¹³å°æ‰¹é‡ç”Ÿæˆè§†é¢‘å†…å®¹</li>
<li>å°†æ–‡æœ¬è¯¾ç¨‹è‡ªåŠ¨è½¬æ¢ä¸ºè§†é¢‘è¯¾ç¨‹</li>
<li>å¤šè¯­è¨€æ•™è‚²å†…å®¹çš„å¿«é€Ÿç”Ÿæˆ</li>
</ul>
</li>
</ol>
<h3 data-id="heading-10">å¿«é€Ÿå¼€å§‹</h3>
<h4 data-id="heading-11">å®‰è£…æ–¹å¼</h4>
<p>Code2Video çš„å®‰è£…éœ€è¦å‡ ä¸ªæ­¥éª¤ï¼š</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 1. å…‹éš†é¡¹ç›®</span>
git <span class="hljs-built_in">clone</span> https://github.com/showlab/Code2Video.git
<span class="hljs-built_in">cd</span> Code2Video/src

<span class="hljs-comment"># 2. å®‰è£…ä¾èµ–</span>
pip install -r requirements.txt

<span class="hljs-comment"># 3. å®‰è£… Manim Community v0.19.0</span>
<span class="hljs-comment"># å‚è€ƒå®˜æ–¹å®‰è£…æŒ‡å—ï¼šhttps://docs.manim.community/en/stable/installation.html</span>
</code></pre>
<p><strong>ä¸»è¦ä¾èµ–</strong>ï¼š</p>
<ul>
<li><code>manim</code>ï¼šæ•°å­¦åŠ¨ç”»å¼•æ“ï¼ˆManim Community v0.19.0ï¼‰</li>
<li>LLM APIï¼šç”¨äº Planner å’Œ Coderï¼ˆæ¨è Claude-4-Opusï¼‰</li>
<li>VLM APIï¼šç”¨äº Criticï¼ˆæ¨è gemini-2.5-pro-preview-05-06ï¼‰</li>
<li>å…¶ä»– Python ä¾èµ–ï¼ˆè§ requirements.txtï¼‰</li>
</ul>
<h4 data-id="heading-12">é…ç½® API Keys</h4>
<p>åœ¨ <code>api_config.json</code> ä¸­é…ç½® API å‡­è¯ï¼š</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"LLM_API"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"provider"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"anthropic"</span><span class="hljs-punctuation">,</span>  <span class="hljs-comment">// æˆ–å…¶ä»– LLM æä¾›å•†</span>
    <span class="hljs-attr">"api_key"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"your-api-key-here"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"claude-4-opus"</span>  <span class="hljs-comment">// æ¨èä½¿ç”¨ Claude-4-Opus è·å¾—æœ€ä½³ä»£ç è´¨é‡</span>
  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"VLM_API"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"provider"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"google"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"api_key"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"your-api-key-here"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"gemini-2.5-pro-preview-05-06"</span>  <span class="hljs-comment">// ç”¨äºå¸ƒå±€å’Œç¾å­¦ä¼˜åŒ–</span>
  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"ICONFINDER_API_KEY"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"your-iconfinder-api-key"</span>  <span class="hljs-comment">// å¯é€‰ï¼Œç”¨äºä¸°å¯Œè§†é¢‘å›¾æ ‡</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h4 data-id="heading-13">æœ€ç®€å•çš„ä½¿ç”¨ç¤ºä¾‹</h4>
<p>ç”Ÿæˆå•ä¸ªçŸ¥è¯†ç‚¹çš„è§†é¢‘ï¼š</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># ä½¿ç”¨ run_agent_single.sh è„šæœ¬</span>
sh run_agent_single.sh --knowledge_point <span class="hljs-string">"Linear transformations and matrices"</span>
</code></pre>
<p>è¿™ä¸ªå‘½ä»¤ä¼šï¼š</p>
<ul>
<li>Planner æ™ºèƒ½ä½“è§„åˆ’è§†é¢‘æ•…äº‹æ¿</li>
<li>Coder æ™ºèƒ½ä½“ç”Ÿæˆ Manim ä»£ç </li>
<li>Critic æ™ºèƒ½ä½“ä¼˜åŒ–å¸ƒå±€å’Œç¾å­¦</li>
<li>æ‰§è¡Œ Manim ä»£ç ç”Ÿæˆè§†é¢‘</li>
<li>ä¿å­˜åˆ° <code>CASES/TEST-single/</code> ç›®å½•</li>
</ul>
<h4 data-id="heading-14">å¸¸ç”¨å‘½ä»¤ç¤ºä¾‹</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># ç”Ÿæˆå•ä¸ªçŸ¥è¯†ç‚¹è§†é¢‘</span>
sh run_agent_single.sh --knowledge_point <span class="hljs-string">"Hanoi Problem"</span>

<span class="hljs-comment"># æ‰¹é‡ç”Ÿæˆå¤šä¸ªä¸»é¢˜ï¼ˆä½¿ç”¨ long_video_topics_list.jsonï¼‰</span>
sh run_agent.sh

<span class="hljs-comment"># åœ¨ run_agent.sh ä¸­å¯ä»¥é…ç½®çš„å‚æ•°ï¼š</span>
<span class="hljs-comment"># - API: æŒ‡å®šä½¿ç”¨çš„ LLM</span>
<span class="hljs-comment"># - FOLDER_PREFIX: è¾“å‡ºæ–‡ä»¶å¤¹å‰ç¼€ï¼ˆå¦‚ TEST-LISTï¼‰</span>
<span class="hljs-comment"># - MAX_CONCEPTS: åŒ…å«çš„æ¦‚å¿µæ•°é‡ï¼ˆ-1 è¡¨ç¤ºå…¨éƒ¨ï¼‰</span>
<span class="hljs-comment"># - PARALLEL_GROUP_NUM: å¹¶è¡Œè¿è¡Œçš„ç»„æ•°</span>
</code></pre>
<h3 data-id="heading-15">æ ¸å¿ƒç‰¹æ€§</h3>
<p>Code2Video çš„æ ¸å¿ƒç‰¹æ€§åŒ…æ‹¬ï¼š</p>
<ol>
<li>
<p><strong>ä»£ç ä¸­å¿ƒèŒƒå¼</strong></p>
<ul>
<li>ä½¿ç”¨å¯æ‰§è¡Œçš„ Manim ä»£ç ä½œä¸ºè§†é¢‘ç”Ÿæˆåª’ä»‹</li>
<li>ä»£ç å¯è°ƒè¯•ã€å¯ä¿®æ”¹ã€å¯é‡ç°</li>
<li>ç¡®ä¿è§†é¢‘çš„æ¸…æ™°åº¦å’Œè¿è´¯æ€§</li>
</ul>
</li>
<li>
<p><strong>ä¸‰æ™ºèƒ½ä½“ç³»ç»Ÿ</strong></p>
<ul>
<li><strong>Planner</strong>ï¼šå°†çŸ¥è¯†ç‚¹æ‰©å±•ä¸ºè¯¦ç»†çš„æ•…äº‹æ¿</li>
<li><strong>Coder</strong>ï¼šæ ¹æ®æ•…äº‹æ¿ç”Ÿæˆå¯æ‰§è¡Œçš„ Manim ä»£ç </li>
<li><strong>Critic</strong>ï¼šä½¿ç”¨è§†è§‰è¯­è¨€æ¨¡å‹ä¼˜åŒ–å¸ƒå±€å’Œç¾å­¦</li>
</ul>
</li>
<li>
<p><strong>MMMC åŸºå‡†æµ‹è¯•</strong></p>
<ul>
<li>é¦–ä¸ªä»£ç é©±åŠ¨è§†é¢‘ç”Ÿæˆçš„åŸºå‡†æµ‹è¯•</li>
<li>æ¶µç›– 117 ä¸ªç²¾é€‰å­¦ä¹ ä¸»é¢˜</li>
<li>å‚è€ƒ 3Blue1Brown çš„é«˜è´¨é‡æ ‡å‡†</li>
<li>åŒ…å«çœŸå®äººå·¥åˆ¶ä½œè§†é¢‘ä½œä¸ºè¯„ä¼°æ ‡å‡†</li>
</ul>
</li>
<li>
<p><strong>å¤šç»´åº¦è¯„ä¼°</strong></p>
<ul>
<li><strong>çŸ¥è¯†ä¼ é€’ï¼ˆTeachQuizï¼‰</strong>ï¼šè¯„ä¼°è§†é¢‘çš„æ•™å­¦æ•ˆæœ</li>
<li><strong>ç¾å­¦å’Œç»“æ„è´¨é‡ï¼ˆAESï¼‰</strong>ï¼šè¯„ä¼°è§†é¢‘çš„è§†è§‰è´¨é‡</li>
<li><strong>æ•ˆç‡æŒ‡æ ‡</strong>ï¼šè¯„ä¼° Token ä½¿ç”¨å’Œæ‰§è¡Œæ—¶é—´</li>
</ul>
</li>
<li>
<p><strong>æ¨¡å—åŒ–è®¾è®¡</strong></p>
<ul>
<li>æ™ºèƒ½ä½“ç³»ç»Ÿå¯ç‹¬ç«‹ä½¿ç”¨</li>
<li>æ”¯æŒè‡ªå®šä¹‰æç¤ºæ¨¡æ¿</li>
<li>çµæ´»çš„é…ç½®ç³»ç»Ÿ</li>
</ul>
</li>
<li>
<p><strong>é«˜è´¨é‡è¾“å‡º</strong></p>
<ul>
<li>å‚è€ƒ 3Blue1Brown çš„è®¾è®¡æ ‡å‡†</li>
<li>æ”¯æŒå›¾æ ‡å’Œè§†è§‰èµ„æºé›†æˆ</li>
<li>ç”Ÿæˆæ¸…æ™°ã€ç¾è§‚çš„æ•™å­¦è§†é¢‘</li>
</ul>
</li>
</ol>
<h3 data-id="heading-16">é¡¹ç›®ä¼˜åŠ¿</h3>
<p>ä¸å…¶ä»–è§†é¢‘ç”Ÿæˆæ–¹æ³•ç›¸æ¯”ï¼ŒCode2Video çš„ä¼˜åŠ¿ï¼š</p>





















































<table><thead><tr><th align="left">å¯¹æ¯”é¡¹</th><th align="left">Code2Video</th><th align="left">ä¼ ç»Ÿæ–‡æœ¬åˆ°è§†é¢‘æ¨¡å‹</th><th align="left">æ‰‹åŠ¨åˆ¶ä½œè§†é¢‘</th></tr></thead><tbody><tr><td align="left"><strong>æ¸…æ™°åº¦</strong></td><td align="left">é«˜ï¼ˆä»£ç ç”Ÿæˆï¼‰</td><td align="left">ä¸­ä½ï¼ˆåƒç´ ç”Ÿæˆï¼‰</td><td align="left">é«˜ï¼ˆäººå·¥æ§åˆ¶ï¼‰</td></tr><tr><td align="left"><strong>å¯é‡ç°æ€§</strong></td><td align="left">å®Œå…¨å¯é‡ç°</td><td align="left">ä¸å¯é‡ç°</td><td align="left">å¯é‡ç°ä½†è€—æ—¶</td></tr><tr><td align="left"><strong>å¯è°ƒè¯•æ€§</strong></td><td align="left">å¯è°ƒè¯•ä»£ç </td><td align="left">ä¸å¯è°ƒè¯•</td><td align="left">å¯ç¼–è¾‘ä½†å¤æ‚</td></tr><tr><td align="left"><strong>ç”Ÿæˆé€Ÿåº¦</strong></td><td align="left">å¿«ï¼ˆè‡ªåŠ¨åŒ–ï¼‰</td><td align="left">å¿«</td><td align="left">æ…¢ï¼ˆäººå·¥åˆ¶ä½œï¼‰</td></tr><tr><td align="left"><strong>æˆæœ¬</strong></td><td align="left">ä½ï¼ˆAPIè°ƒç”¨ï¼‰</td><td align="left">ä¸­ï¼ˆè®¡ç®—èµ„æºï¼‰</td><td align="left">é«˜ï¼ˆäººåŠ›æˆæœ¬ï¼‰</td></tr><tr><td align="left"><strong>ä¸€è‡´æ€§</strong></td><td align="left">é«˜ï¼ˆä»£ç æ§åˆ¶ï¼‰</td><td align="left">ä¸­ä½</td><td align="left">å–å†³äºåˆ¶ä½œè€…</td></tr><tr><td align="left"><strong>æ•™è‚²é€‚ç”¨æ€§</strong></td><td align="left">ä¸“é—¨ä¼˜åŒ–</td><td align="left">é€šç”¨ä½†ä¸å¤Ÿæ¸…æ™°</td><td align="left">é«˜è´¨é‡ä½†è€—æ—¶</td></tr></tbody></table>
<p><strong>ä¸ºä»€ä¹ˆé€‰æ‹© Code2Videoï¼Ÿ</strong></p>
<ul>
<li>âœ… <strong>ä»£ç é©±åŠ¨</strong>ï¼šç”Ÿæˆå¯æ‰§è¡Œã€å¯è°ƒè¯•çš„ä»£ç ï¼Œè€Œéåƒç´ </li>
<li>âœ… <strong>æ•™è‚²ä¼˜åŒ–</strong>ï¼šä¸“é—¨ä¸ºæ•™å­¦è§†é¢‘è®¾è®¡ï¼Œå‚è€ƒæœ€ä½³å®è·µ</li>
<li>âœ… <strong>æ™ºèƒ½ä½“ç³»ç»Ÿ</strong>ï¼šä¸‰æ™ºèƒ½ä½“ååŒï¼Œè‡ªåŠ¨åŒ–ç¨‹åº¦é«˜</li>
<li>âœ… <strong>ç³»ç»Ÿæ€§è¯„ä¼°</strong>ï¼šæä¾›å®Œæ•´çš„è¯„ä¼°æ¡†æ¶å’ŒåŸºå‡†æµ‹è¯•</li>
<li>âœ… <strong>å­¦æœ¯è®¤å¯</strong>ï¼šå·²è¢« NeurIPS 2025 æ¥å—</li>
<li>âœ… <strong>å¼€æºå…è´¹</strong>ï¼šMIT è®¸å¯è¯ï¼Œå®Œå…¨å¼€æº</li>
</ul>
<hr/>
<h2 data-id="heading-17">é¡¹ç›®è¯¦ç»†å‰–æ</h2>
<h3 data-id="heading-18">æ¶æ„è®¾è®¡</h3>
<p>Code2Video çš„æ•´ä½“æ¶æ„é‡‡ç”¨ä¸‰æ™ºèƒ½ä½“ååŒè®¾è®¡ï¼š</p>
<pre><code class="hljs language-scss" lang="scss">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Planner   â”‚â”€â”€â”€â”€â–¶â”‚    Coder    â”‚â”€â”€â”€â”€â–¶â”‚   Critic    â”‚
â”‚  (æ•…äº‹æ¿)   â”‚     â”‚  (ä»£ç ç”Ÿæˆ) â”‚     â”‚ (å¸ƒå±€ä¼˜åŒ–)  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚                    â”‚                    â”‚
      â–¼                    â–¼                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            Manim ä»£ç æ‰§è¡Œå’Œè§†é¢‘ç”Ÿæˆ                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚
      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  è§†é¢‘è¾“å‡º   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<p><strong>æ ¸å¿ƒæµç¨‹</strong>ï¼š</p>
<ol>
<li><strong>Planner é˜¶æ®µ</strong>ï¼šå°†çŸ¥è¯†ç‚¹æ‰©å±•ä¸ºè¯¦ç»†çš„æ•…äº‹æ¿ï¼ŒåŒ…æ‹¬åœºæ™¯ã€åŠ¨ç”»ã€è¯´æ˜ç­‰</li>
<li><strong>Coder é˜¶æ®µ</strong>ï¼šæ ¹æ®æ•…äº‹æ¿ç”Ÿæˆå¯æ‰§è¡Œçš„ Manim ä»£ç </li>
<li><strong>Critic é˜¶æ®µ</strong>ï¼šä½¿ç”¨è§†è§‰è¯­è¨€æ¨¡å‹è¯„ä¼°å’Œä¼˜åŒ–ä»£ç çš„å¸ƒå±€å’Œç¾å­¦</li>
<li><strong>æ‰§è¡Œé˜¶æ®µ</strong>ï¼šè¿è¡Œ Manim ä»£ç ç”Ÿæˆæœ€ç»ˆè§†é¢‘</li>
<li><strong>è¯„ä¼°é˜¶æ®µ</strong>ï¼šä½¿ç”¨å¤šç»´åº¦æŒ‡æ ‡è¯„ä¼°è§†é¢‘è´¨é‡</li>
</ol>
<h3 data-id="heading-19">æ ¸å¿ƒæ¨¡å—åˆ†æ</h3>
<h4 data-id="heading-20">1. Planner æ™ºèƒ½ä½“</h4>
<p>Planner è´Ÿè´£å°†çŸ¥è¯†ç‚¹æ‰©å±•ä¸ºè¯¦ç»†çš„æ•…äº‹æ¿ï¼š</p>
<p><strong>åŠŸèƒ½</strong>ï¼š</p>
<ul>
<li>åˆ†æçŸ¥è¯†ç‚¹çš„æ ¸å¿ƒæ¦‚å¿µ</li>
<li>è§„åˆ’è§†é¢‘çš„ç»“æ„å’Œæµç¨‹</li>
<li>ç¡®å®šéœ€è¦å±•ç¤ºçš„åŠ¨ç”»å’Œå¯è§†åŒ–</li>
<li>ç”Ÿæˆè¯¦ç»†çš„æ•…äº‹æ¿æè¿°</li>
</ul>
<p><strong>å®ç°æ–¹å¼</strong>ï¼š</p>
<ul>
<li>ä½¿ç”¨ LLMï¼ˆæ¨è Claude-4-Opusï¼‰è¿›è¡Œæ•…äº‹æ¿æ‰©å±•</li>
<li>åŸºäºæç¤ºæ¨¡æ¿ç”Ÿæˆç»“æ„åŒ–æ•…äº‹æ¿</li>
<li>è€ƒè™‘æ•™è‚²è§†é¢‘çš„æœ€ä½³å®è·µ</li>
</ul>
<h4 data-id="heading-21">2. Coder æ™ºèƒ½ä½“</h4>
<p>Coder è´Ÿè´£æ ¹æ®æ•…äº‹æ¿ç”Ÿæˆ Manim ä»£ç ï¼š</p>
<p><strong>åŠŸèƒ½</strong>ï¼š</p>
<ul>
<li>å°†æ•…äº‹æ¿è½¬æ¢ä¸º Manim ä»£ç </li>
<li>ç”Ÿæˆå¯æ‰§è¡Œçš„åŠ¨ç”»ä»£ç </li>
<li>ç¡®ä¿ä»£ç çš„æ­£ç¡®æ€§å’Œå¯è¯»æ€§</li>
<li>å¤„ç†å¤æ‚çš„æ•°å­¦å’Œå¯è§†åŒ–éœ€æ±‚</li>
</ul>
<p><strong>å®ç°æ–¹å¼</strong>ï¼š</p>
<ul>
<li>ä½¿ç”¨ LLM ç”Ÿæˆ Manim ä»£ç </li>
<li>ä»£ç å¯ä»¥ç›´æ¥æ‰§è¡Œå’Œè°ƒè¯•</li>
<li>æ”¯æŒ Manim Community v0.19.0 çš„è¯­æ³•</li>
</ul>
<p><strong>Manim ä»£ç ç¤ºä¾‹</strong>ï¼š</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># ç”Ÿæˆçš„ Manim ä»£ç ç¤ºä¾‹ï¼ˆç®€åŒ–ç‰ˆï¼‰</span>
<span class="hljs-keyword">from</span> manim <span class="hljs-keyword">import</span> *

<span class="hljs-keyword">class</span> <span class="hljs-title class_">LinearTransformation</span>(<span class="hljs-title class_ inherited__">Scene</span>):
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">construct</span>(<span class="hljs-params">self</span>):
        <span class="hljs-comment"># åˆ›å»ºçŸ©é˜µ</span>
        matrix = Matrix([[<span class="hljs-number">2</span>, <span class="hljs-number">1</span>], [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>]])
        self.play(Create(matrix))
        
        <span class="hljs-comment"># å±•ç¤ºçº¿æ€§å˜æ¢</span>
        vector = Arrow(ORIGIN, [<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>], buff=<span class="hljs-number">0</span>)
        self.play(Create(vector))
        
        <span class="hljs-comment"># åº”ç”¨å˜æ¢</span>
        transformed = matrix @ vector.get_end()
        self.play(Transform(vector, Arrow(ORIGIN, transformed, buff=<span class="hljs-number">0</span>)))
</code></pre>
<h4 data-id="heading-22">3. Critic æ™ºèƒ½ä½“</h4>
<p>Critic è´Ÿè´£ä¼˜åŒ–ä»£ç çš„å¸ƒå±€å’Œç¾å­¦ï¼š</p>
<p><strong>åŠŸèƒ½</strong>ï¼š</p>
<ul>
<li>ä½¿ç”¨è§†è§‰è¯­è¨€æ¨¡å‹è¯„ä¼°ç”Ÿæˆçš„ä»£ç </li>
<li>ä¼˜åŒ–å¸ƒå±€å’Œè§†è§‰å…ƒç´ çš„ä½ç½®</li>
<li>ç¡®ä¿ç¾å­¦è´¨é‡å’Œè§†è§‰æ¸…æ™°åº¦</li>
<li>ä½¿ç”¨é”šç‚¹ï¼ˆanchorsï¼‰è¿›è¡Œå¸ƒå±€ä¼˜åŒ–</li>
</ul>
<p><strong>å®ç°æ–¹å¼</strong>ï¼š</p>
<ul>
<li>ä½¿ç”¨ VLMï¼ˆæ¨è gemini-2.5-pro-preview-05-06ï¼‰</li>
<li>åˆ†æä»£ç ç”Ÿæˆçš„è§†è§‰æ•ˆæœ</li>
<li>æä¾›å¸ƒå±€ä¼˜åŒ–å»ºè®®</li>
<li>è¿­ä»£æ”¹è¿›ä»£ç è´¨é‡</li>
</ul>
<h4 data-id="heading-23">4. MMMC åŸºå‡†æµ‹è¯•</h4>
<p>MMMCï¼ˆManim-based Multi-topic Multi-quality Codeï¼‰æ˜¯é¦–ä¸ªä»£ç é©±åŠ¨è§†é¢‘ç”Ÿæˆçš„åŸºå‡†æµ‹è¯•ï¼š</p>
<p><strong>ç‰¹ç‚¹</strong>ï¼š</p>
<ul>
<li>æ¶µç›– 117 ä¸ªç²¾é€‰å­¦ä¹ ä¸»é¢˜</li>
<li>å‚è€ƒ 3Blue1Brown çš„é«˜è´¨é‡æ ‡å‡†</li>
<li>åŒ…å«çœŸå®äººå·¥åˆ¶ä½œè§†é¢‘ä½œä¸ºè¯„ä¼°æ ‡å‡†</li>
<li>æ¶µç›–æ•°å­¦ã€è®¡ç®—æœºç§‘å­¦ã€ç‰©ç†ç­‰å¤šä¸ªé¢†åŸŸ</li>
</ul>
<p><strong>è¯„ä¼°ç»´åº¦</strong>ï¼š</p>
<ol>
<li><strong>çŸ¥è¯†ä¼ é€’ï¼ˆTeachQuizï¼‰</strong>ï¼šè¯„ä¼°è§†é¢‘çš„æ•™å­¦æ•ˆæœ</li>
<li><strong>ç¾å­¦å’Œç»“æ„è´¨é‡ï¼ˆAESï¼‰</strong>ï¼šè¯„ä¼°è§†é¢‘çš„è§†è§‰è´¨é‡</li>
<li><strong>æ•ˆç‡æŒ‡æ ‡</strong>ï¼šToken ä½¿ç”¨å’Œæ‰§è¡Œæ—¶é—´</li>
</ol>
<p><strong>ä½¿ç”¨æ–¹å¼</strong>ï¼š</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># è¯„ä¼°çŸ¥è¯†ä¼ é€’</span>
python3 eval_TQ.py

<span class="hljs-comment"># è¯„ä¼°ç¾å­¦å’Œç»“æ„è´¨é‡</span>
python3 eval_AES.py
</code></pre>
<h3 data-id="heading-24">å…³é”®æŠ€æœ¯å®ç°</h3>
<h4 data-id="heading-25">1. ä»£ç ä¸­å¿ƒèŒƒå¼</h4>
<p>Code2Video çš„æ ¸å¿ƒåˆ›æ–°æ˜¯ä½¿ç”¨ä»£ç ä½œä¸ºè§†é¢‘ç”Ÿæˆçš„ç»Ÿä¸€åª’ä»‹ï¼š</p>
<p><strong>ä¼˜åŠ¿</strong>ï¼š</p>
<ul>
<li><strong>å¯é‡ç°æ€§</strong>ï¼šä»£ç å¯ä»¥é‡å¤æ‰§è¡Œï¼Œç”Ÿæˆç›¸åŒçš„è§†é¢‘</li>
<li><strong>å¯è°ƒè¯•æ€§</strong>ï¼šå¯ä»¥ä¿®æ”¹ä»£ç æ¥è°ƒæ•´è§†é¢‘æ•ˆæœ</li>
<li><strong>æ¸…æ™°åº¦</strong>ï¼šä»£ç ç”Ÿæˆçš„è§†é¢‘æ¯”åƒç´ ç”Ÿæˆæ›´æ¸…æ™°</li>
<li><strong>å¯æ‰©å±•æ€§</strong>ï¼šå¯ä»¥è½»æ¾æ·»åŠ æ–°çš„åŠ¨ç”»å’Œæ•ˆæœ</li>
</ul>
<p><strong>å®ç°</strong>ï¼š</p>
<ul>
<li>ä½¿ç”¨ Manim ä½œä¸ºä»£ç æ‰§è¡Œå¼•æ“</li>
<li>ç”Ÿæˆçš„ä»£ç ç¬¦åˆ Manim Community æ ‡å‡†</li>
<li>æ”¯æŒå¤æ‚çš„æ•°å­¦å’Œå¯è§†åŒ–éœ€æ±‚</li>
</ul>
<h4 data-id="heading-26">2. å¤šæ™ºèƒ½ä½“ååŒ</h4>
<p>ä¸‰æ™ºèƒ½ä½“ç³»ç»Ÿé€šè¿‡æ¨¡å—åŒ–è®¾è®¡å®ç°ååŒå·¥ä½œï¼š</p>
<p><strong>Planner â†’ Coder â†’ Critic æµç¨‹</strong>ï¼š</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># ç®€åŒ–çš„å·¥ä½œæµç¨‹</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">generate_video</span>(<span class="hljs-params">knowledge_point</span>):
    <span class="hljs-comment"># 1. Planner ç”Ÿæˆæ•…äº‹æ¿</span>
    storyboard = planner.expand(knowledge_point)
    
    <span class="hljs-comment"># 2. Coder ç”Ÿæˆä»£ç </span>
    manim_code = coder.generate(storyboard)
    
    <span class="hljs-comment"># 3. Critic ä¼˜åŒ–ä»£ç </span>
    optimized_code = critic.optimize(manim_code)
    
    <span class="hljs-comment"># 4. æ‰§è¡Œä»£ç ç”Ÿæˆè§†é¢‘</span>
    video = execute_manim(optimized_code)
    
    <span class="hljs-keyword">return</span> video
</code></pre>
<p><strong>æ™ºèƒ½ä½“é—´çš„ä¿¡æ¯ä¼ é€’</strong>ï¼š</p>
<ul>
<li>Planner è¾“å‡ºç»“æ„åŒ–æ•…äº‹æ¿</li>
<li>Coder æ¥æ”¶æ•…äº‹æ¿ï¼Œç”Ÿæˆä»£ç </li>
<li>Critic æ¥æ”¶ä»£ç ï¼Œæä¾›ä¼˜åŒ–å»ºè®®</li>
<li>æ”¯æŒè¿­ä»£ä¼˜åŒ–</li>
</ul>
<h4 data-id="heading-27">3. æç¤ºå·¥ç¨‹</h4>
<p>Code2Video ä½¿ç”¨ç²¾å¿ƒè®¾è®¡çš„æç¤ºæ¨¡æ¿æ¥æŒ‡å¯¼æ™ºèƒ½ä½“ï¼š</p>
<p><strong>æç¤ºæ¨¡æ¿ä½ç½®</strong>ï¼š<code>prompts/</code> ç›®å½•</p>
<p><strong>æç¤ºç±»å‹</strong>ï¼š</p>
<ul>
<li>Planner æç¤ºï¼šæŒ‡å¯¼æ•…äº‹æ¿æ‰©å±•</li>
<li>Coder æç¤ºï¼šæŒ‡å¯¼ä»£ç ç”Ÿæˆ</li>
<li>Critic æç¤ºï¼šæŒ‡å¯¼å¸ƒå±€ä¼˜åŒ–</li>
</ul>
<p><strong>æç¤ºä¼˜åŒ–</strong>ï¼š</p>
<ul>
<li>åŸºäºæ•™è‚²è§†é¢‘æœ€ä½³å®è·µ</li>
<li>å‚è€ƒ 3Blue1Brown çš„è®¾è®¡æ ‡å‡†</li>
<li>æ”¯æŒè‡ªå®šä¹‰å’Œæ‰©å±•</li>
</ul>
<hr/>
<h2 data-id="heading-28">å®é™…ä½¿ç”¨æ¡ˆä¾‹</h2>
<h3 data-id="heading-29">æ¡ˆä¾‹1ï¼šåœ¨çº¿æ•°å­¦è¯¾ç¨‹åˆ¶ä½œ</h3>
<p><strong>åœºæ™¯</strong>ï¼šåœ¨çº¿æ•™è‚²å¹³å°éœ€è¦ä¸ºçº¿æ€§ä»£æ•°è¯¾ç¨‹æ‰¹é‡ç”Ÿæˆæ•™å­¦è§†é¢‘ã€‚</p>
<p><strong>å®ç°æ­¥éª¤</strong>ï¼š</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 1. å‡†å¤‡çŸ¥è¯†ç‚¹åˆ—è¡¨ï¼ˆlong_video_topics_list.jsonï¼‰</span>
<span class="hljs-comment"># åŒ…å«ï¼šçº¿æ€§å˜æ¢ã€çŸ©é˜µè¿ç®—ã€ç‰¹å¾å€¼ç­‰ä¸»é¢˜</span>

<span class="hljs-comment"># 2. é…ç½®æ‰¹é‡ç”Ÿæˆè„šæœ¬</span>
sh run_agent.sh

<span class="hljs-comment"># 3. é…ç½®å‚æ•°</span>
<span class="hljs-comment"># API: claude-4-opus</span>
<span class="hljs-comment"># FOLDER_PREFIX: LinearAlgebra-Course</span>
<span class="hljs-comment"># MAX_CONCEPTS: -1  # ç”Ÿæˆæ‰€æœ‰æ¦‚å¿µ</span>
<span class="hljs-comment"># PARALLEL_GROUP_NUM: 4  # å¹¶è¡Œç”Ÿæˆ4ä¸ªè§†é¢‘</span>
</code></pre>
<p><strong>æ•ˆæœ</strong>ï¼šè‡ªåŠ¨ç”Ÿæˆä¸€ç³»åˆ—é£æ ¼ç»Ÿä¸€ã€æ¸…æ™°ç¾è§‚çš„çº¿æ€§ä»£æ•°æ•™å­¦è§†é¢‘ï¼Œå¤§å¤§å‡å°‘äººå·¥åˆ¶ä½œæ—¶é—´ã€‚</p>
<h3 data-id="heading-30">æ¡ˆä¾‹2ï¼šè®¡ç®—æœºç§‘å­¦æ¦‚å¿µå¯è§†åŒ–</h3>
<p><strong>åœºæ™¯</strong>ï¼šä¸º"å¤§è¯­è¨€æ¨¡å‹åŸç†"ä¸»é¢˜ç”Ÿæˆæ•™å­¦è§†é¢‘ã€‚</p>
<p><strong>å®ç°æ­¥éª¤</strong>ï¼š</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># ç”Ÿæˆå•ä¸ªçŸ¥è¯†ç‚¹è§†é¢‘</span>
sh run_agent_single.sh --knowledge_point <span class="hljs-string">"Large Language Model"</span>

<span class="hljs-comment"># ç³»ç»Ÿä¼šè‡ªåŠ¨ï¼š</span>
<span class="hljs-comment"># 1. Planner åˆ†æLLMçš„æ ¸å¿ƒæ¦‚å¿µï¼ˆæ³¨æ„åŠ›æœºåˆ¶ã€Transformerç­‰ï¼‰</span>
<span class="hljs-comment"># 2. Coder ç”Ÿæˆå±•ç¤ºLLMæ¶æ„çš„Manimä»£ç </span>
<span class="hljs-comment"># 3. Critic ä¼˜åŒ–å¸ƒå±€ï¼Œç¡®ä¿æ¸…æ™°åº¦</span>
<span class="hljs-comment"># 4. ç”Ÿæˆæœ€ç»ˆè§†é¢‘</span>
</code></pre>
<p><strong>æ•ˆæœ</strong>ï¼šç”Ÿæˆæ¸…æ™°å±•ç¤ºLLMå·¥ä½œåŸç†çš„è§†é¢‘ï¼ŒåŒ…æ‹¬æ³¨æ„åŠ›æœºåˆ¶çš„å¯è§†åŒ–ã€Transformeræ¶æ„çš„åŠ¨ç”»ç­‰ã€‚</p>
<h3 data-id="heading-31">æ¡ˆä¾‹3ï¼šç‰©ç†æ¦‚å¿µæ•™å­¦</h3>
<p><strong>åœºæ™¯</strong>ï¼šä¸ºå‚…é‡Œå¶çº§æ•°ç”Ÿæˆæ•™å­¦è§†é¢‘ã€‚</p>
<p><strong>å®ç°æ­¥éª¤</strong>ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">sh run_agent_single.sh --knowledge_point <span class="hljs-string">"Pure Fourier Series"</span>

<span class="hljs-comment"># ç”Ÿæˆçš„è§†é¢‘ä¼šå±•ç¤ºï¼š</span>
<span class="hljs-comment"># - å‚…é‡Œå¶çº§æ•°çš„æ•°å­¦å…¬å¼</span>
<span class="hljs-comment"># - ä¸åŒé¢‘ç‡åˆ†é‡çš„å åŠ è¿‡ç¨‹</span>
<span class="hljs-comment"># - ä»æ–¹æ³¢åˆ°æ­£å¼¦æ³¢çš„åˆ†è§£åŠ¨ç”»</span>
</code></pre>
<p><strong>æ•ˆæœ</strong>ï¼šé€šè¿‡åŠ¨ç”»ç›´è§‚å±•ç¤ºå‚…é‡Œå¶çº§æ•°çš„æ•°å­¦åŸç†ï¼Œå¸®åŠ©å­¦ç”Ÿç†è§£æŠ½è±¡æ¦‚å¿µã€‚</p>
<h3 data-id="heading-32">æ¡ˆä¾‹4ï¼šæ‰¹é‡è¯¾ç¨‹å†…å®¹ç”Ÿæˆ</h3>
<p><strong>åœºæ™¯</strong>ï¼šæ•™è‚²æœºæ„éœ€è¦ä¸ºå¤šä¸ªå­¦ç§‘ç”Ÿæˆæ•™å­¦è§†é¢‘ã€‚</p>
<p><strong>å®ç°æ­¥éª¤</strong>ï¼š</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 1. å‡†å¤‡å¤šå­¦ç§‘ä¸»é¢˜åˆ—è¡¨</span>
<span class="hljs-comment"># æ•°å­¦ã€ç‰©ç†ã€è®¡ç®—æœºç§‘å­¦ç­‰117ä¸ªä¸»é¢˜</span>

<span class="hljs-comment"># 2. æ‰¹é‡ç”Ÿæˆ</span>
sh run_agent.sh

<span class="hljs-comment"># 3. ä½¿ç”¨å¹¶è¡Œå¤„ç†åŠ é€Ÿ</span>
PARALLEL_GROUP_NUM=8  <span class="hljs-comment"># 8ä¸ªå¹¶è¡Œä»»åŠ¡</span>
</code></pre>
<p><strong>æ•ˆæœ</strong>ï¼šå¿«é€Ÿç”Ÿæˆå¤§é‡é«˜è´¨é‡æ•™å­¦è§†é¢‘ï¼Œä¿æŒé£æ ¼ä¸€è‡´æ€§ï¼Œé€‚åˆå¤§è§„æ¨¡åœ¨çº¿è¯¾ç¨‹åˆ¶ä½œã€‚</p>
<hr/>
<h2 data-id="heading-33">é«˜çº§é…ç½®æŠ€å·§</h2>
<h3 data-id="heading-34">1. è‡ªå®šä¹‰æç¤ºæ¨¡æ¿</h3>
<p>Code2Video ä½¿ç”¨æç¤ºæ¨¡æ¿æ¥æŒ‡å¯¼æ™ºèƒ½ä½“ï¼Œä½ å¯ä»¥è‡ªå®šä¹‰è¿™äº›æ¨¡æ¿ï¼š</p>
<p><strong>æç¤ºæ¨¡æ¿ä½ç½®</strong>ï¼š<code>prompts/</code> ç›®å½•</p>
<p><strong>è‡ªå®šä¹‰ Planner æç¤º</strong>ï¼š</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># prompts/planner_prompt.txt</span>
ä½ æ˜¯ä¸€ä¸ªæ•™è‚²è§†é¢‘è§„åˆ’ä¸“å®¶ã€‚è¯·ä¸ºä»¥ä¸‹çŸ¥è¯†ç‚¹åˆ›å»ºè¯¦ç»†çš„æ•…äº‹æ¿ï¼š

çŸ¥è¯†ç‚¹ï¼š{knowledge_point}

è¦æ±‚ï¼š
<span class="hljs-number">1.</span> åˆ†æçŸ¥è¯†ç‚¹çš„æ ¸å¿ƒæ¦‚å¿µ
<span class="hljs-number">2.</span> è§„åˆ’è§†é¢‘ç»“æ„ï¼ˆå¼•è¨€ã€ä¸»ä½“ã€æ€»ç»“ï¼‰
<span class="hljs-number">3.</span> ç¡®å®šéœ€è¦å±•ç¤ºçš„åŠ¨ç”»å’Œå¯è§†åŒ–
<span class="hljs-number">4.</span> è€ƒè™‘æ•™è‚²è§†é¢‘çš„æœ€ä½³å®è·µ
<span class="hljs-number">5.</span> å‚è€ƒ3Blue1Brownçš„é£æ ¼

è¯·ç”Ÿæˆè¯¦ç»†çš„æ•…äº‹æ¿...
</code></pre>
<p><strong>è‡ªå®šä¹‰ Coder æç¤º</strong>ï¼š</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># prompts/coder_prompt.txt</span>
ä½ æ˜¯ä¸€ä¸ªManimä»£ç ç”Ÿæˆä¸“å®¶ã€‚è¯·æ ¹æ®ä»¥ä¸‹æ•…äº‹æ¿ç”ŸæˆManimä»£ç ï¼š

æ•…äº‹æ¿ï¼š{storyboard}

è¦æ±‚ï¼š
<span class="hljs-number">1.</span> ä½¿ç”¨Manim Community v0<span class="hljs-number">.19</span><span class="hljs-number">.0</span>è¯­æ³•
<span class="hljs-number">2.</span> ä»£ç è¦æ¸…æ™°ã€å¯è¯»ã€å¯æ‰§è¡Œ
<span class="hljs-number">3.</span> åŒ…å«å¿…è¦çš„åŠ¨ç”»å’Œå¯è§†åŒ–
<span class="hljs-number">4.</span> éµå¾ªManimæœ€ä½³å®è·µ

è¯·ç”Ÿæˆå®Œæ•´çš„Manimä»£ç ...
</code></pre>
<h3 data-id="heading-35">2. ä¼˜åŒ– API é…ç½®</h3>
<p><strong>é€‰æ‹©æœ€ä½³ LLM</strong>ï¼š</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"LLM_API"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"provider"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"anthropic"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"api_key"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"your-key"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"claude-4-opus"</span><span class="hljs-punctuation">,</span>  <span class="hljs-comment">// æœ€ä½³ä»£ç è´¨é‡</span>
    <span class="hljs-attr">"temperature"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0.7</span><span class="hljs-punctuation">,</span>  <span class="hljs-comment">// æ§åˆ¶åˆ›é€ æ€§</span>
    <span class="hljs-attr">"max_tokens"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">4000</span>   <span class="hljs-comment">// æ§åˆ¶è¾“å‡ºé•¿åº¦</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p><strong>é…ç½® VLM ç”¨äº Critic</strong>ï¼š</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"VLM_API"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"provider"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"google"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"api_key"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"your-key"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"gemini-2.5-pro-preview-05-06"</span><span class="hljs-punctuation">,</span>  <span class="hljs-comment">// æœ€ä½³è§†è§‰ç†è§£</span>
    <span class="hljs-attr">"temperature"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0.3</span>  <span class="hljs-comment">// è¾ƒä½æ¸©åº¦ç¡®ä¿ä¸€è‡´æ€§</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h3 data-id="heading-36">3. æ‰¹é‡ç”Ÿæˆä¼˜åŒ–</h3>
<p><strong>å¹¶è¡Œå¤„ç†é…ç½®</strong>ï¼š</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># åœ¨ run_agent.sh ä¸­é…ç½®</span>
PARALLEL_GROUP_NUM=8  <span class="hljs-comment"># æ ¹æ®CPUæ ¸å¿ƒæ•°è°ƒæ•´</span>

<span class="hljs-comment"># é™åˆ¶ç”Ÿæˆæ•°é‡ï¼ˆç”¨äºæµ‹è¯•ï¼‰</span>
MAX_CONCEPTS=10  <span class="hljs-comment"># åªç”Ÿæˆå‰10ä¸ªæ¦‚å¿µ</span>
</code></pre>
<p><strong>è¾“å‡ºç»„ç»‡</strong>ï¼š</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># ä½¿ç”¨æœ‰æ„ä¹‰çš„æ–‡ä»¶å¤¹å‰ç¼€</span>
FOLDER_PREFIX=<span class="hljs-string">"Math-Course-2026"</span>

<span class="hljs-comment"># è¾“å‡ºç»“æ„ï¼š</span>
<span class="hljs-comment"># CASES/</span>
<span class="hljs-comment">#   â””â”€â”€ Math-Course-2026/</span>
<span class="hljs-comment">#       â”œâ”€â”€ concept_1/</span>
<span class="hljs-comment">#       â”‚   â”œâ”€â”€ video.mp4</span>
<span class="hljs-comment">#       â”‚   â”œâ”€â”€ manim_code.py</span>
<span class="hljs-comment">#       â”‚   â””â”€â”€ storyboard.json</span>
<span class="hljs-comment">#       â””â”€â”€ concept_2/</span>
<span class="hljs-comment">#           â””â”€â”€ ...</span>
</code></pre>
<h3 data-id="heading-37">4. Manim ä»£ç åå¤„ç†</h3>
<p>ç”Ÿæˆçš„ Manim ä»£ç å¯ä»¥è¿›ä¸€æ­¥ä¼˜åŒ–ï¼š</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># ç”Ÿæˆçš„ä»£ç ç¤ºä¾‹</span>
<span class="hljs-keyword">from</span> manim <span class="hljs-keyword">import</span> *

<span class="hljs-keyword">class</span> <span class="hljs-title class_">GeneratedVideo</span>(<span class="hljs-title class_ inherited__">Scene</span>):
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">construct</span>(<span class="hljs-params">self</span>):
        <span class="hljs-comment"># å¯ä»¥æ‰‹åŠ¨ç¼–è¾‘å’Œä¼˜åŒ–</span>
        title = Text(<span class="hljs-string">"Linear Transformations"</span>)
        self.play(Write(title))
        <span class="hljs-comment"># ... æ›´å¤šä»£ç </span>
</code></pre>
<p><strong>ä¼˜åŒ–æŠ€å·§</strong>ï¼š</p>
<ul>
<li>è°ƒæ•´åŠ¨ç”»æ—¶é•¿å’Œç¼“åŠ¨å‡½æ•°</li>
<li>ä¼˜åŒ–é¢œè‰²å’Œå­—ä½“é€‰æ‹©</li>
<li>æ·»åŠ æ›´å¤šè§†è§‰æ•ˆæœ</li>
<li>æ”¹è¿›å¸ƒå±€å’Œæ’ç‰ˆ</li>
</ul>
<h3 data-id="heading-38">5. é›†æˆåˆ°å·¥ä½œæµ</h3>
<p><strong>Python API é›†æˆ</strong>ï¼š</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># åœ¨ä½ çš„ Python é¡¹ç›®ä¸­ä½¿ç”¨</span>
<span class="hljs-keyword">from</span> agent <span class="hljs-keyword">import</span> Code2VideoAgent

<span class="hljs-comment"># åˆå§‹åŒ–æ™ºèƒ½ä½“</span>
agent = Code2VideoAgent(
    llm_api_key=<span class="hljs-string">"your-key"</span>,
    vlm_api_key=<span class="hljs-string">"your-key"</span>
)

<span class="hljs-comment"># ç”Ÿæˆè§†é¢‘</span>
video_path = agent.generate_video(
    knowledge_point=<span class="hljs-string">"Linear transformations and matrices"</span>,
    output_dir=<span class="hljs-string">"./output"</span>
)

<span class="hljs-built_in">print</span>(<span class="hljs-string">f"è§†é¢‘å·²ç”Ÿæˆï¼š<span class="hljs-subst">{video_path}</span>"</span>)
</code></pre>
<p><strong>è‡ªåŠ¨åŒ–è„šæœ¬</strong>ï¼š</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment">#!/usr/bin/env python3</span>
<span class="hljs-comment"># auto_generate.py</span>

<span class="hljs-keyword">import</span> subprocess
<span class="hljs-keyword">import</span> json

<span class="hljs-comment"># è¯»å–ä¸»é¢˜åˆ—è¡¨</span>
<span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">'long_video_topics_list.json'</span>, <span class="hljs-string">'r'</span>) <span class="hljs-keyword">as</span> f:
    topics = json.load(f)

<span class="hljs-comment"># æ‰¹é‡ç”Ÿæˆ</span>
<span class="hljs-keyword">for</span> topic <span class="hljs-keyword">in</span> topics[:<span class="hljs-number">10</span>]:  <span class="hljs-comment"># ç”Ÿæˆå‰10ä¸ª</span>
    knowledge_point = topic[<span class="hljs-string">'name'</span>]
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"ç”Ÿæˆè§†é¢‘ï¼š<span class="hljs-subst">{knowledge_point}</span>"</span>)
    
    subprocess.run([
        <span class="hljs-string">'sh'</span>, <span class="hljs-string">'run_agent_single.sh'</span>,
        <span class="hljs-string">'--knowledge_point'</span>, knowledge_point
    ])
    
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"âœ“ å®Œæˆï¼š<span class="hljs-subst">{knowledge_point}</span>\n"</span>)
</code></pre>
<hr/>
<h2 data-id="heading-39">è¯„ä¼°æ–¹æ³•è¯¦è§£</h2>
<h3 data-id="heading-40">1. çŸ¥è¯†ä¼ é€’è¯„ä¼°ï¼ˆTeachQuizï¼‰</h3>
<p><strong>ç›®çš„</strong>ï¼šè¯„ä¼°è§†é¢‘çš„æ•™å­¦æ•ˆæœï¼Œå³å­¦ç”Ÿèƒ½å¦ä»è§†é¢‘ä¸­å­¦ä¹ åˆ°çŸ¥è¯†ã€‚</p>
<p><strong>è¯„ä¼°æ–¹æ³•</strong>ï¼š</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># è¿è¡Œè¯„ä¼°è„šæœ¬</span>
python3 eval_TQ.py
</code></pre>
<p><strong>è¯„ä¼°æµç¨‹</strong>ï¼š</p>
<ol>
<li>ä¸ºæ¯ä¸ªè§†é¢‘ç”Ÿæˆæµ‹è¯•é¢˜ç›®</li>
<li>è®©å­¦ç”Ÿè§‚çœ‹è§†é¢‘åå›ç­”é—®é¢˜</li>
<li>è®¡ç®—æ­£ç¡®ç‡ä½œä¸ºçŸ¥è¯†ä¼ é€’æŒ‡æ ‡</li>
</ol>
<p><strong>è¯„ä¼°æŒ‡æ ‡</strong>ï¼š</p>
<ul>
<li><strong>æ­£ç¡®ç‡</strong>ï¼šå­¦ç”Ÿç­”é¢˜çš„æ­£ç¡®ç‡</li>
<li><strong>ç†è§£æ·±åº¦</strong>ï¼šå­¦ç”Ÿå¯¹æ¦‚å¿µçš„ç†è§£ç¨‹åº¦</li>
<li><strong>çŸ¥è¯†ä¿ç•™</strong>ï¼šä¸€æ®µæ—¶é—´åçš„çŸ¥è¯†ä¿ç•™ç‡</li>
</ul>
<h3 data-id="heading-41">2. ç¾å­¦å’Œç»“æ„è´¨é‡è¯„ä¼°ï¼ˆAESï¼‰</h3>
<p><strong>ç›®çš„</strong>ï¼šè¯„ä¼°è§†é¢‘çš„è§†è§‰è´¨é‡å’Œç»“æ„åˆç†æ€§ã€‚</p>
<p><strong>è¯„ä¼°æ–¹æ³•</strong>ï¼š</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># è¿è¡Œè¯„ä¼°è„šæœ¬</span>
python3 eval_AES.py
</code></pre>
<p><strong>è¯„ä¼°ç»´åº¦</strong>ï¼š</p>
<ul>
<li><strong>è§†è§‰æ¸…æ™°åº¦</strong>ï¼šæ–‡å­—ã€å›¾å½¢æ˜¯å¦æ¸…æ™°</li>
<li><strong>å¸ƒå±€åˆç†æ€§</strong>ï¼šå…ƒç´ ä½ç½®æ˜¯å¦åˆç†</li>
<li><strong>åŠ¨ç”»æµç•…æ€§</strong>ï¼šåŠ¨ç”»æ˜¯å¦æµç•…è‡ªç„¶</li>
<li><strong>æ•´ä½“ç¾è§‚åº¦</strong>ï¼šè§†é¢‘æ•´ä½“æ˜¯å¦ç¾è§‚</li>
</ul>
<p><strong>è¯„ä¼°æ ‡å‡†</strong>ï¼š</p>
<ul>
<li>å‚è€ƒ 3Blue1Brown çš„è§†é¢‘è´¨é‡æ ‡å‡†</li>
<li>ä½¿ç”¨çœŸå®äººå·¥åˆ¶ä½œè§†é¢‘ä½œä¸ºåŸºå‡†</li>
<li>å¤šç»´åº¦ç»¼åˆè¯„åˆ†</li>
</ul>
<h3 data-id="heading-42">3. æ•ˆç‡æŒ‡æ ‡</h3>
<p><strong>ç›®çš„</strong>ï¼šè¯„ä¼°ç”Ÿæˆè¿‡ç¨‹çš„æ•ˆç‡å’Œæˆæœ¬ã€‚</p>
<p><strong>è¯„ä¼°æŒ‡æ ‡</strong>ï¼š</p>
<ol>
<li>
<p><strong>Token ä½¿ç”¨é‡</strong></p>
<ul>
<li>Planner ä½¿ç”¨çš„ Token æ•°</li>
<li>Coder ä½¿ç”¨çš„ Token æ•°</li>
<li>Critic ä½¿ç”¨çš„ Token æ•°</li>
<li>æ€» Token ä½¿ç”¨é‡</li>
</ul>
</li>
<li>
<p><strong>æ‰§è¡Œæ—¶é—´</strong></p>
<ul>
<li>æ•…äº‹æ¿ç”Ÿæˆæ—¶é—´</li>
<li>ä»£ç ç”Ÿæˆæ—¶é—´</li>
<li>ä»£ç æ‰§è¡Œæ—¶é—´ï¼ˆManim æ¸²æŸ“ï¼‰</li>
<li>æ€»ç”Ÿæˆæ—¶é—´</li>
</ul>
</li>
<li>
<p><strong>æˆæœ¬ä¼°ç®—</strong></p>
<ul>
<li>API è°ƒç”¨æˆæœ¬</li>
<li>è®¡ç®—èµ„æºæˆæœ¬</li>
<li>æ€»æˆæœ¬</li>
</ul>
</li>
</ol>
<p><strong>ä¼˜åŒ–å»ºè®®</strong>ï¼š</p>
<ul>
<li>ä½¿ç”¨æ›´é«˜æ•ˆçš„ LLMï¼ˆå¦‚ Claude-4-Opusï¼‰</li>
<li>ä¼˜åŒ–æç¤ºæ¨¡æ¿å‡å°‘ Token ä½¿ç”¨</li>
<li>å¹¶è¡Œå¤„ç†æé«˜æ•ˆç‡</li>
<li>ç¼“å­˜ä¸­é—´ç»“æœé¿å…é‡å¤è®¡ç®—</li>
</ul>
<h3 data-id="heading-43">4. ä¸åŸºå‡†å¯¹æ¯”</h3>
<p>Code2Video åœ¨ MMMC åŸºå‡†æµ‹è¯•ä¸­ä¸ä»¥ä¸‹æ–¹æ³•å¯¹æ¯”ï¼š</p>








































<table><thead><tr><th align="left">æ–¹æ³•</th><th align="left">çŸ¥è¯†ä¼ é€’</th><th align="left">ç¾å­¦è´¨é‡</th><th align="left">ç”Ÿæˆé€Ÿåº¦</th><th align="left">å¯é‡ç°æ€§</th></tr></thead><tbody><tr><td align="left"><strong>Code2Video</strong></td><td align="left">é«˜</td><td align="left">é«˜</td><td align="left">ä¸­</td><td align="left">å®Œå…¨å¯é‡ç°</td></tr><tr><td align="left">Veo3</td><td align="left">ä¸­</td><td align="left">ä¸­</td><td align="left">å¿«</td><td align="left">ä¸å¯é‡ç°</td></tr><tr><td align="left">Wan2.2</td><td align="left">ä¸­</td><td align="left">ä¸­</td><td align="left">å¿«</td><td align="left">ä¸å¯é‡ç°</td></tr><tr><td align="left">äººå·¥åˆ¶ä½œ</td><td align="left">é«˜</td><td align="left">é«˜</td><td align="left">æ…¢</td><td align="left">å¯é‡ç°ä½†è€—æ—¶</td></tr></tbody></table>
<p><strong>Code2Video çš„ä¼˜åŠ¿</strong>ï¼š</p>
<ul>
<li>åœ¨çŸ¥è¯†ä¼ é€’å’Œç¾å­¦è´¨é‡ä¸Šæ¥è¿‘äººå·¥åˆ¶ä½œ</li>
<li>ç”Ÿæˆé€Ÿåº¦æ¯”äººå·¥åˆ¶ä½œå¿«å¾—å¤š</li>
<li>å®Œå…¨å¯é‡ç°ï¼Œå¯ä»¥è°ƒè¯•å’Œä¼˜åŒ–</li>
<li>æˆæœ¬è¿œä½äºäººå·¥åˆ¶ä½œ</li>
</ul>
<hr/>
<h2 data-id="heading-44">ä¸å…¶ä»–è§†é¢‘ç”Ÿæˆå·¥å…·çš„å¯¹æ¯”</h2>
<h3 data-id="heading-45">Code2Video vs ä¼ ç»Ÿæ–‡æœ¬åˆ°è§†é¢‘æ¨¡å‹</h3>
<p><strong>ä¼ ç»Ÿæ–‡æœ¬åˆ°è§†é¢‘æ¨¡å‹</strong>ï¼ˆå¦‚ Veo3ã€Wan2.2ï¼‰ï¼š</p>
<p><strong>ä¼˜åŠ¿</strong>ï¼š</p>
<ul>
<li>ç”Ÿæˆé€Ÿåº¦å¿«</li>
<li>æ”¯æŒå¤šç§é£æ ¼</li>
<li>ä¸éœ€è¦ç¼–ç¨‹çŸ¥è¯†</li>
</ul>
<p><strong>åŠ£åŠ¿</strong>ï¼š</p>
<ul>
<li>ç”Ÿæˆè§†é¢‘ä¸å¯é‡ç°</li>
<li>æ¸…æ™°åº¦ä¸å¤Ÿé«˜</li>
<li>ä¸é€‚åˆæ•™è‚²åœºæ™¯</li>
<li>éš¾ä»¥è°ƒè¯•å’Œä¼˜åŒ–</li>
</ul>
<p><strong>Code2Video</strong>ï¼š</p>
<p><strong>ä¼˜åŠ¿</strong>ï¼š</p>
<ul>
<li>ç”Ÿæˆä»£ç å¯é‡ç°ã€å¯è°ƒè¯•</li>
<li>æ¸…æ™°åº¦é«˜ï¼Œé€‚åˆæ•™è‚²</li>
<li>ä¸“é—¨ä¸ºæ•™å­¦è§†é¢‘ä¼˜åŒ–</li>
<li>å¯ä»¥è¿­ä»£æ”¹è¿›</li>
</ul>
<p><strong>åŠ£åŠ¿</strong>ï¼š</p>
<ul>
<li>éœ€è¦ Manim ç¯å¢ƒ</li>
<li>ç”Ÿæˆé€Ÿåº¦ç›¸å¯¹è¾ƒæ…¢</li>
<li>ä¸»è¦é€‚ç”¨äºæ•™è‚²åœºæ™¯</li>
</ul>
<h3 data-id="heading-46">Code2Video vs æ‰‹åŠ¨è§†é¢‘åˆ¶ä½œ</h3>
<p><strong>æ‰‹åŠ¨åˆ¶ä½œ</strong>ï¼ˆå¦‚ä½¿ç”¨ After Effectsã€Premiereï¼‰ï¼š</p>
<p><strong>ä¼˜åŠ¿</strong>ï¼š</p>
<ul>
<li>å®Œå…¨æ§åˆ¶æ¯ä¸ªç»†èŠ‚</li>
<li>å¯ä»¥åˆ›å»ºå¤æ‚æ•ˆæœ</li>
<li>è´¨é‡æœ€é«˜</li>
</ul>
<p><strong>åŠ£åŠ¿</strong>ï¼š</p>
<ul>
<li>è€—æ—¶è€—åŠ›</li>
<li>éœ€è¦ä¸“ä¸šæŠ€èƒ½</li>
<li>æˆæœ¬é«˜</li>
<li>éš¾ä»¥æ‰¹é‡ç”Ÿäº§</li>
</ul>
<p><strong>Code2Video</strong>ï¼š</p>
<p><strong>ä¼˜åŠ¿</strong>ï¼š</p>
<ul>
<li>è‡ªåŠ¨åŒ–ç¨‹åº¦é«˜</li>
<li>å¯ä»¥æ‰¹é‡ç”Ÿæˆ</li>
<li>æˆæœ¬ä½</li>
<li>é£æ ¼ä¸€è‡´</li>
</ul>
<p><strong>åŠ£åŠ¿</strong>ï¼š</p>
<ul>
<li>çµæ´»æ€§ä¸å¦‚æ‰‹åŠ¨åˆ¶ä½œ</li>
<li>å¤æ‚æ•ˆæœæ”¯æŒæœ‰é™</li>
<li>éœ€è¦è°ƒè¯•å’Œä¼˜åŒ–</li>
</ul>
<h3 data-id="heading-47">é€‚ç”¨åœºæ™¯é€‰æ‹©</h3>
<p><strong>é€‰æ‹© Code2Video å½“</strong>ï¼š</p>
<ul>
<li>âœ… éœ€è¦æ‰¹é‡ç”Ÿæˆæ•™å­¦è§†é¢‘</li>
<li>âœ… è¦æ±‚è§†é¢‘æ¸…æ™°ã€å¯é‡ç°</li>
<li>âœ… éœ€è¦å¿«é€Ÿè¿­ä»£å’Œä¼˜åŒ–</li>
<li>âœ… é¢„ç®—æœ‰é™ä½†éœ€è¦é«˜è´¨é‡</li>
</ul>
<p><strong>é€‰æ‹©ä¼ ç»Ÿæ–‡æœ¬åˆ°è§†é¢‘å½“</strong>ï¼š</p>
<ul>
<li>âœ… éœ€è¦å¿«é€Ÿç”Ÿæˆé€šç”¨è§†é¢‘</li>
<li>âœ… ä¸éœ€è¦å¯é‡ç°æ€§</li>
<li>âœ… éæ•™è‚²åœºæ™¯</li>
</ul>
<p><strong>é€‰æ‹©æ‰‹åŠ¨åˆ¶ä½œå½“</strong>ï¼š</p>
<ul>
<li>âœ… éœ€è¦å®Œå…¨æ§åˆ¶ç»†èŠ‚</li>
<li>âœ… éœ€è¦å¤æ‚ç‰¹æ•ˆ</li>
<li>âœ… é¢„ç®—å……è¶³ä¸”æ—¶é—´å……è£•</li>
</ul>
<hr/>
<h2 data-id="heading-48">å¸¸è§é—®é¢˜è§£å†³</h2>
<h3 data-id="heading-49">é—®é¢˜1ï¼šManim å®‰è£…å¤±è´¥</h3>
<p><strong>ç—‡çŠ¶</strong>ï¼šå®‰è£… Manim Community v0.19.0 æ—¶å‡ºé”™ã€‚</p>
<p><strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼š</p>
<ol>
<li>
<p><strong>æ£€æŸ¥ç³»ç»Ÿä¾èµ–</strong>ï¼š</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># Ubuntu/Debian</span>
sudo apt-get install build-essential python3-dev libcairo2-dev libpango1.0-dev

<span class="hljs-comment"># macOS</span>
brew install cairo pango
</code></pre>
</li>
<li>
<p><strong>ä½¿ç”¨è™šæ‹Ÿç¯å¢ƒ</strong>ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">python3 -m venv venv
<span class="hljs-built_in">source</span> venv/bin/activate  <span class="hljs-comment"># Linux/macOS</span>
<span class="hljs-comment"># æˆ–</span>
venv\Scripts\activate  <span class="hljs-comment"># Windows</span>
pip install manim
</code></pre>
</li>
<li>
<p><strong>å‚è€ƒå®˜æ–¹æ–‡æ¡£</strong>ï¼š</p>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.manim.community%2Fen%2Fstable%2Finstallation.html" target="_blank" title="https://docs.manim.community/en/stable/installation.html" ref="nofollow noopener noreferrer">Manim å®‰è£…æŒ‡å—</a></li>
</ul>
</li>
</ol>
<h3 data-id="heading-50">é—®é¢˜2ï¼šAPI è°ƒç”¨å¤±è´¥</h3>
<p><strong>ç—‡çŠ¶</strong>ï¼šLLM æˆ– VLM API è°ƒç”¨å¤±è´¥ã€‚</p>
<p><strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼š</p>
<ol>
<li>
<p><strong>æ£€æŸ¥ API Key</strong>ï¼š</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"LLM_API"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"api_key"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"your-actual-api-key"</span>  <span class="hljs-comment">// ç¡®ä¿æ­£ç¡®</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
</li>
<li>
<p><strong>æ£€æŸ¥ç½‘ç»œè¿æ¥</strong>ï¼š</p>
<ul>
<li>ç¡®ä¿å¯ä»¥è®¿é—® API æœåŠ¡</li>
<li>æ£€æŸ¥é˜²ç«å¢™è®¾ç½®</li>
</ul>
</li>
<li>
<p><strong>æ£€æŸ¥ API é…é¢</strong>ï¼š</p>
<ul>
<li>ç¡®è®¤ API è´¦æˆ·æœ‰è¶³å¤Ÿé…é¢</li>
<li>æ£€æŸ¥æ˜¯å¦æœ‰é€Ÿç‡é™åˆ¶</li>
</ul>
</li>
</ol>
<h3 data-id="heading-51">é—®é¢˜3ï¼šç”Ÿæˆçš„ä»£ç æ‰§è¡Œå¤±è´¥</h3>
<p><strong>ç—‡çŠ¶</strong>ï¼šManim ä»£ç ç”Ÿæˆåæ‰§è¡Œå‡ºé”™ã€‚</p>
<p><strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼š</p>
<ol>
<li>
<p><strong>æ£€æŸ¥ Manim ç‰ˆæœ¬</strong>ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">manim --version  <span class="hljs-comment"># åº”è¯¥æ˜¯ 0.19.0</span>
</code></pre>
</li>
<li>
<p><strong>æ‰‹åŠ¨è°ƒè¯•ä»£ç </strong>ï¼š</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># æŸ¥çœ‹ç”Ÿæˆçš„ä»£ç </span>
<span class="hljs-comment"># CASES/TEST-single/concept_name/manim_code.py</span>

<span class="hljs-comment"># æ‰‹åŠ¨è¿è¡Œæµ‹è¯•</span>
manim -pql manim_code.py GeneratedVideo
</code></pre>
</li>
<li>
<p><strong>æ£€æŸ¥ä¾èµ–</strong>ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">pip install -r requirements.txt
</code></pre>
</li>
</ol>
<h3 data-id="heading-52">é—®é¢˜4ï¼šè§†é¢‘è´¨é‡ä¸ç†æƒ³</h3>
<p><strong>ç—‡çŠ¶</strong>ï¼šç”Ÿæˆçš„è§†é¢‘æ¸…æ™°åº¦æˆ–ç¾è§‚åº¦ä¸å¤Ÿã€‚</p>
<p><strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼š</p>
<ol>
<li>
<p><strong>ä½¿ç”¨æ›´å¥½çš„ LLM</strong>ï¼š</p>
<ul>
<li>æ¨èä½¿ç”¨ Claude-4-Opus</li>
<li>ç¡®ä¿ API é…ç½®æ­£ç¡®</li>
</ul>
</li>
<li>
<p><strong>ä¼˜åŒ–æç¤ºæ¨¡æ¿</strong>ï¼š</p>
<ul>
<li>åœ¨ <code>prompts/</code> ç›®å½•ä¸­è‡ªå®šä¹‰æç¤º</li>
<li>å‚è€ƒ 3Blue1Brown çš„é£æ ¼è¦æ±‚</li>
</ul>
</li>
<li>
<p><strong>ä½¿ç”¨ Critic ä¼˜åŒ–</strong>ï¼š</p>
<ul>
<li>ç¡®ä¿ VLM API é…ç½®æ­£ç¡®</li>
<li>ä½¿ç”¨ gemini-2.5-pro-preview-05-06</li>
</ul>
</li>
<li>
<p><strong>æ‰‹åŠ¨åå¤„ç†</strong>ï¼š</p>
<ul>
<li>ç¼–è¾‘ç”Ÿæˆçš„ Manim ä»£ç </li>
<li>è°ƒæ•´é¢œè‰²ã€å­—ä½“ã€å¸ƒå±€ç­‰</li>
</ul>
</li>
</ol>
<h3 data-id="heading-53">é—®é¢˜5ï¼šç”Ÿæˆé€Ÿåº¦æ…¢</h3>
<p><strong>ç—‡çŠ¶</strong>ï¼šè§†é¢‘ç”Ÿæˆéœ€è¦å¾ˆé•¿æ—¶é—´ã€‚</p>
<p><strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼š</p>
<ol>
<li>
<p><strong>ä½¿ç”¨å¹¶è¡Œå¤„ç†</strong>ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">PARALLEL_GROUP_NUM=8  <span class="hljs-comment"># å¢åŠ å¹¶è¡Œæ•°</span>
</code></pre>
</li>
<li>
<p><strong>ä¼˜åŒ– Manim æ¸²æŸ“</strong>ï¼š</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># ä½¿ç”¨ä½è´¨é‡é¢„è§ˆ</span>
manim -pql  <span class="hljs-comment"># ä½è´¨é‡ï¼Œå¿«é€Ÿé¢„è§ˆ</span>
<span class="hljs-comment"># é«˜è´¨é‡æ¸²æŸ“</span>
manim -pqh  <span class="hljs-comment"># é«˜è´¨é‡ï¼Œè¾ƒæ…¢</span>
</code></pre>
</li>
<li>
<p><strong>å‡å°‘æ¦‚å¿µæ•°é‡</strong>ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">MAX_CONCEPTS=5  <span class="hljs-comment"># å…ˆæµ‹è¯•å°‘é‡æ¦‚å¿µ</span>
</code></pre>
</li>
</ol>
<h3 data-id="heading-54">é—®é¢˜6ï¼šå†…å­˜ä¸è¶³</h3>
<p><strong>ç—‡çŠ¶</strong>ï¼šç”Ÿæˆå¤§å‹è§†é¢‘æ—¶å†…å­˜æº¢å‡ºã€‚</p>
<p><strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼š</p>
<ol>
<li>
<p><strong>å‡å°‘è§†é¢‘å¤æ‚åº¦</strong>ï¼š</p>
<ul>
<li>ç®€åŒ–æ•…äº‹æ¿</li>
<li>å‡å°‘åŒæ—¶æ˜¾ç¤ºçš„å…ƒç´ </li>
</ul>
</li>
<li>
<p><strong>åˆ†æ‰¹å¤„ç†</strong>ï¼š</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># åˆ†æ‰¹ç”Ÿæˆï¼Œé¿å…åŒæ—¶å¤„ç†å¤ªå¤š</span>
MAX_CONCEPTS=10
</code></pre>
</li>
<li>
<p><strong>å¢åŠ ç³»ç»Ÿå†…å­˜</strong>ï¼š</p>
<ul>
<li>å¦‚æœå¯èƒ½ï¼Œå¢åŠ ç³»ç»Ÿ RAM</li>
<li>ä½¿ç”¨æ›´å¼ºå¤§çš„æœºå™¨</li>
</ul>
</li>
</ol>
<hr/>
<h2 data-id="heading-55">é¡¹ç›®åœ°å€ä¸èµ„æº</h2>
<h3 data-id="heading-56">å®˜æ–¹èµ„æº</h3>
<ul>
<li>ğŸŒŸ <strong>GitHub</strong>: <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fshowlab%2FCode2Video" target="_blank" title="https://github.com/showlab/Code2Video" ref="nofollow noopener noreferrer">github.com/showlab/Codâ€¦</a></li>
<li>ğŸŒ <strong>é¡¹ç›®ç½‘ç«™</strong>: <a href="https://link.juejin.cn?target=https%3A%2F%2Fshowlab.github.io%2FCode2Video%2F" target="_blank" title="https://showlab.github.io/Code2Video/" ref="nofollow noopener noreferrer">showlab.github.io/Code2Video</a></li>
</ul>
<hr/>
<h2 data-id="heading-57">é€‚ç”¨äººç¾¤</h2>
<p>Code2Video é€‚åˆä»¥ä¸‹äººç¾¤ï¼š</p>
<h3 data-id="heading-58">1. æ•™è‚²å·¥ä½œè€…å’Œè¯¾ç¨‹è®¾è®¡å¸ˆ</h3>
<ul>
<li>âœ… éœ€è¦å¿«é€Ÿåˆ¶ä½œæ•™å­¦è§†é¢‘çš„æ•™å¸ˆ</li>
<li>âœ… åœ¨çº¿è¯¾ç¨‹å¹³å°çš„å†…å®¹åˆ›ä½œè€…</li>
<li>âœ… å¸Œæœ›å°†å¤æ‚æ¦‚å¿µå¯è§†åŒ–çš„æ•™è‚²å·¥ä½œè€…</li>
</ul>
<h3 data-id="heading-59">2. åœ¨çº¿æ•™è‚²å¹³å°å¼€å‘è€…</h3>
<ul>
<li>âœ… éœ€è¦æ‰¹é‡ç”Ÿæˆè§†é¢‘å†…å®¹çš„å¹³å°</li>
<li>âœ… å¸Œæœ›è‡ªåŠ¨åŒ–å†…å®¹ç”Ÿäº§çš„å›¢é˜Ÿ</li>
<li>âœ… éœ€è¦ä¿æŒè§†é¢‘é£æ ¼ä¸€è‡´æ€§çš„æœºæ„</li>
</ul>
<h3 data-id="heading-60">3. AI è§†é¢‘ç”Ÿæˆç ”ç©¶è€…</h3>
<ul>
<li>âœ… ç ”ç©¶ä»£ç é©±åŠ¨è§†é¢‘ç”Ÿæˆæ–¹æ³•</li>
<li>âœ… è¯„ä¼°ä¸åŒè§†é¢‘ç”ŸæˆæŠ€æœ¯</li>
<li>âœ… æ„å»ºæ•™è‚²è§†é¢‘ç”ŸæˆåŸºå‡†æµ‹è¯•</li>
</ul>
<h3 data-id="heading-61">4. æŠ€æœ¯çˆ±å¥½è€…å’Œå¼€å‘è€…</h3>
<ul>
<li>âœ… å¯¹å¤šæ™ºèƒ½ä½“ç³»ç»Ÿæ„Ÿå…´è¶£</li>
<li>âœ… å¸Œæœ›å­¦ä¹ ä»£ç ç”ŸæˆæŠ€æœ¯</li>
<li>âœ… æƒ³è¦æ¢ç´¢ AI åœ¨æ•™è‚²ä¸­çš„åº”ç”¨</li>
</ul>
<h3 data-id="heading-62">5. å†…å®¹åˆ›ä½œè€…</h3>
<ul>
<li>âœ… éœ€è¦åˆ¶ä½œæ•™å­¦å†…å®¹çš„ YouTuber</li>
<li>âœ… å¸Œæœ›æé«˜è§†é¢‘åˆ¶ä½œæ•ˆç‡çš„åˆ›ä½œè€…</li>
<li>âœ… éœ€è¦å°†çŸ¥è¯†å¯è§†åŒ–çš„åšä¸»</li>
</ul>
<hr/>
<h2 data-id="heading-63">æ€»ç»“</h2>
<p>Code2Video æ˜¯ä¸€ä¸ªåˆ›æ–°çš„ä»£ç é©±åŠ¨è§†é¢‘ç”Ÿæˆæ¡†æ¶ï¼Œå®ƒé€šè¿‡å¯æ‰§è¡Œçš„ Manim ä»£ç å’Œå¤šæ™ºèƒ½ä½“ç³»ç»Ÿï¼Œä¸ºæ•™è‚²è§†é¢‘ç”Ÿæˆæä¾›äº†ä¸€ä¸ªå…¨æ–°çš„èŒƒå¼ã€‚</p>
<hr/>
<p><em>æ¬¢è¿æ¥æˆ‘ä¸­çš„<a href="https://link.juejin.cn?target=https%3A%2F%2Fhome.wonlab.top" target="_blank" title="https://home.wonlab.top" ref="nofollow noopener noreferrer">ä¸ªäººä¸»é¡µ</a>æ‰¾åˆ°æ›´å¤šæœ‰ç”¨çš„çŸ¥è¯†å’Œæœ‰è¶£çš„äº§å“</em></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ä½¿ç”¨ Go + Gin + Fx æ„å»ºå·¥ç¨‹åŒ–åç«¯æœåŠ¡æ¨¡æ¿ï¼ˆgin-app å®è·µï¼‰]]></title>    <link>https://juejin.cn/post/7603946518372466726</link>    <guid>https://juejin.cn/post/7603946518372466726</guid>    <pubDate>2026-02-08T10:34:07.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7603946518372466726" data-draft-id="7603688142005190665" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ä½¿ç”¨ Go + Gin + Fx æ„å»ºå·¥ç¨‹åŒ–åç«¯æœåŠ¡æ¨¡æ¿ï¼ˆgin-app å®è·µï¼‰"/> <meta itemprop="keywords" content="åç«¯,Go,å‰ç«¯"/> <meta itemprop="datePublished" content="2026-02-08T10:34:07.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="æ¢¦æƒ³å¾ˆå¤§å¾ˆå¤§"/> <meta itemprop="url" content="https://juejin.cn/user/1248673297886535"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ä½¿ç”¨ Go + Gin + Fx æ„å»ºå·¥ç¨‹åŒ–åç«¯æœåŠ¡æ¨¡æ¿ï¼ˆgin-app å®è·µï¼‰
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1248673297886535/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    æ¢¦æƒ³å¾ˆå¤§å¾ˆå¤§
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-08T10:34:07.000Z" title="Sun Feb 08 2026 10:34:07 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»9åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>é¡¹ç›®åœ°å€ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2F1111mp%2Fgin-app" target="_blank" title="https://github.com/1111mp/gin-app" ref="nofollow noopener noreferrer">github.com/1111mp/gin-â€¦</a></p>
</blockquote>
<hr/>
<h2 data-id="heading-0">ä¸€ã€å†™åœ¨å‰é¢ï¼šè¿™æ˜¯ä¸€æ¬¡çœŸå®çš„å·¥ç¨‹æ¢ç´¢ç»å†</h2>
<p>è¿™ç¯‡æ–‡ç« å¹¶ä¸æ˜¯ä¸€ç¯‡â€œæ¶æ„è®¾è®¡è¯´æ˜æ–‡æ¡£â€ï¼Œè€Œæ›´åƒæ˜¯ä¸€æ¬¡<strong>ä¸ªäººå·¥ç¨‹æ¢ç´¢çš„è®°å½•</strong>ã€‚</p>
<p>æˆ‘åœ¨ä½¿ç”¨ Node.js å†™åç«¯æœåŠ¡çš„è¿‡ç¨‹ä¸­ï¼Œä¸€ç›´å¾ˆå–œæ¬¢ <strong>NestJS</strong> é‚£ç§å·¥ç¨‹åŒ–çš„ä»£ç ç»„ç»‡æ–¹å¼ï¼š</p>
<ul>
<li>æ¨¡å—åŒ–ç»“æ„æ¸…æ™°</li>
<li>é¡¹ç›®å±‚æ¬¡åˆ†æ˜</li>
<li>ä¾èµ–å…³ç³»æ˜ç¡®</li>
<li>å·¥ç¨‹è§„èŒƒå¤©ç„¶ç»Ÿä¸€</li>
</ul>
<p>å½“é¡¹ç›®è§„æ¨¡å˜å¤§æ—¶ï¼Œè¿™ç§ç»“æ„éå¸¸â€œç¨³â€ï¼Œä¸å®¹æ˜“ä¹±ã€‚</p>
<p>åæ¥åœ¨è½¬å‘ Go åšåç«¯é¡¹ç›®æ—¶ï¼Œæˆ‘å‘ç° Go ç”Ÿæ€å¹¶æ²¡æœ‰ç±»ä¼¼ NestJS è¿™ç§â€œå¼€ç®±å³ç”¨â€çš„å·¥ç¨‹å‹æ¡†æ¶ã€‚æ›´å¤šæ˜¯ï¼š</p>
<ul>
<li>Gin / Echo / Fiber è§£å†³ Web</li>
<li>å„ç§åº“ç»„åˆæ—¥å¿—ã€é…ç½®ã€æ•°æ®åº“ã€é‰´æƒ</li>
<li>æ¶æ„è‡ªç”±ï¼Œä½†ç¼ºå°‘ç»Ÿä¸€èŒƒå¼</li>
</ul>
<p>ä¸€å¼€å§‹æˆ‘ä¹Ÿå°è¯•è¿‡å¾ˆå¤šç»„åˆæ–¹å¼ï¼Œè¯´å®è¯ï¼š<strong>é¡¹ç›®è§„æ¨¡å°çš„æ—¶å€™æ²¡é—®é¢˜ï¼Œä¸€æ—¦é¡¹ç›®å¼€å§‹å¤æ‚ï¼Œç»“æ„å¾ˆå®¹æ˜“å¤±æ§</strong>ï¼š</p>
<ul>
<li>ç›®å½•å¼€å§‹å˜ä¹±</li>
<li>æ¨¡å—è¾¹ç•Œå¼€å§‹æ¨¡ç³Š</li>
<li>ä¾èµ–å¼€å§‹äº’ç›¸å¼•ç”¨</li>
<li>æµ‹è¯•è¶Šæ¥è¶Šéš¾å†™</li>
<li>æ–°äººè¶Šæ¥è¶Šéš¾ä¸Šæ‰‹</li>
</ul>
<p>äºæ˜¯æˆ‘å¼€å§‹æœ‰æ„è¯†åœ°å»æ€è€ƒä¸€ä¸ªé—®é¢˜ï¼š</p>
<blockquote>
<p>Go é‡Œèƒ½ä¸èƒ½ä¹Ÿåšä¸€å¥—â€œå·¥ç¨‹çº§ç»“æ„æ¨¡æ¿â€ï¼Ÿ<br/>
ä¸è¿½æ±‚æ¡†æ¶èƒ½åŠ›ï¼Œè€Œæ˜¯è§£å†³å·¥ç¨‹ç»„ç»‡é—®é¢˜ã€‚</p>
</blockquote>
<p>åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œæˆ‘ä¹Ÿå‚è€ƒè¿‡ä¸€äº›ä¼˜ç§€é¡¹ç›®ï¼Œæ¯”å¦‚ï¼š<br/>
ğŸ‘‰ <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fevrone%2Fgo-clean-template" target="_blank" title="https://github.com/evrone/go-clean-template" ref="nofollow noopener noreferrer">github.com/evrone/go-câ€¦</a></p>
<p>å®ƒåœ¨åˆ†å±‚æ€æƒ³å’Œä¾èµ–æ–¹å‘æ§åˆ¶ä¸Šç»™äº†æˆ‘å¾ˆå¤šå¯å‘ï¼Œä½†æ•´ä½“æ›´åç†è®ºå‹æ¶æ„è®¾è®¡ï¼Œå¹¶ä¸æ˜¯æˆ‘æƒ³è¦çš„é‚£ç§â€œå·¥ç¨‹æ¨¡æ¿å‹ç»“æ„â€ã€‚</p>
<p>åæ¥é€æ­¥å°è¯•å°† <strong>Gin + Uber Fx</strong> ç»„åˆåœ¨ä¸€èµ·ï¼Œä¸€è¾¹å†™é¡¹ç›®ï¼Œä¸€è¾¹è°ƒæ•´ç»“æ„ï¼Œæ…¢æ…¢å½¢æˆäº†ä¸€å¥—ç›¸å¯¹ç¨³å®šçš„å·¥ç¨‹ç»„ç»‡æ–¹å¼ï¼Œä¹Ÿå°±æ˜¯ç°åœ¨çš„ï¼š</p>
<blockquote>
<p><strong>gin-app</strong><br/>
<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2F1111mp%2Fgin-app" target="_blank" title="https://github.com/1111mp/gin-app" ref="nofollow noopener noreferrer">github.com/1111mp/gin-â€¦</a></p>
</blockquote>
<p>å®ƒä¸æ˜¯ä¸€ä¸ªæ¡†æ¶é¡¹ç›®ï¼Œæ›´åƒæ˜¯ï¼š</p>
<blockquote>
<p>æˆ‘åœ¨çœŸå®é¡¹ç›®ä¸­ä¸€æ­¥æ­¥è¯•å‡ºæ¥çš„ä¸€å¥— Go å·¥ç¨‹æ¨¡æ¿ç»“æ„</p>
</blockquote>
<hr/>
<h2 data-id="heading-1">äºŒã€æˆ‘æƒ³è§£å†³çš„ï¼Œå…¶å®ä¸æ˜¯â€œæŠ€æœ¯é—®é¢˜â€</h2>
<p>è¯´å®è¯ï¼Œè¿™ä¸ªé¡¹ç›®ä¸€å¼€å§‹å¹¶ä¸æ˜¯ä¸ºäº†è¿½æ±‚æŠ€æœ¯å¤æ‚åº¦ï¼Œè€Œæ˜¯ä¸ºäº†è§£å†³å‡ ä¸ªå¾ˆç°å®çš„é—®é¢˜ï¼š</p>
<ul>
<li>é¡¹ç›®ä¸€å¤§ï¼Œç»“æ„å°±ä¹±</li>
<li>äººä¸€å¤šï¼Œé£æ ¼å°±ä¹±</li>
<li>æ¨¡å—å¤šäº†ä¹‹åï¼Œä¾èµ–å°±å¼€å§‹ä¹±</li>
<li>æ²¡æœ‰ç»Ÿä¸€ç»“æ„è§„èŒƒï¼Œé‡æ„æˆæœ¬æé«˜</li>
</ul>
<p>æ‰€ä»¥ <code>gin-app</code> çš„æ ¸å¿ƒç›®æ ‡å…¶å®å¾ˆç®€å•ï¼š</p>
<blockquote>
<p>è®© Go é¡¹ç›®åœ¨è§„æ¨¡å¢é•¿æ—¶ï¼Œä¾ç„¶èƒ½ä¿æŒç»“æ„æ¸…æ™°</p>
</blockquote>
<p>è€Œä¸æ˜¯ï¼š</p>
<blockquote>
<p>å†™ä»£ç æ›´ç‚«ã€æŠ€æœ¯æ›´å¤æ‚</p>
</blockquote>
<hr/>
<h2 data-id="heading-2">ä¸‰ã€ä¸ºä»€ä¹ˆé€‰æ‹© Gin + Fx</h2>
<h3 data-id="heading-3">Gin</h3>
<p>è¿™ä¸ªæ²¡ä»€ä¹ˆèŠ±å“¨ç†ç”±ï¼šæˆç†Ÿã€ç¨³å®šã€ç”Ÿæ€å¥½ï¼Œç”¨èµ·æ¥é¡ºæ‰‹ã€‚</p>
<h3 data-id="heading-4">Fx</h3>
<p>Fx ä¸€å¼€å§‹æˆ‘ä¹Ÿåªæ˜¯å½“ä½œ DI å·¥å…·åœ¨ç”¨ï¼Œä½†çœŸæ­£ç”¨åˆ°å·¥ç¨‹é‡Œä¹‹åå‘ç°ï¼š</p>
<p>å®ƒæ›´åƒæ˜¯ä¸€ä¸ª<strong>é¡¹ç›®å¯åŠ¨è°ƒåº¦å™¨</strong>ï¼š</p>
<ul>
<li>ç»Ÿä¸€ç®¡ç†ç»„ä»¶åˆå§‹åŒ–</li>
<li>ç»Ÿä¸€ç®¡ç†å¯åŠ¨æµç¨‹</li>
<li>ç»Ÿä¸€ç®¡ç†ç”Ÿå‘½å‘¨æœŸ</li>
<li>è‡ªåŠ¨å¤„ç†ä¾èµ–é¡ºåº</li>
</ul>
<p>æ…¢æ…¢å‘ç°ï¼Œå®ƒæ›´é€‚åˆåšâ€œå·¥ç¨‹ç»“æ„å·¥å…·â€ï¼Œè€Œä¸åªæ˜¯â€œä¾èµ–æ³¨å…¥å·¥å…·â€ã€‚</p>
<hr/>
<h2 data-id="heading-5">å››ã€ç°åœ¨çš„å·¥ç¨‹ç»“æ„</h2>
<p>ç›®å‰é¡¹ç›®ç»“æ„æ˜¯è¿™æ ·ç»„ç»‡çš„ï¼š</p>
<pre><code class="hljs language-csharp" lang="csharp">cmd/
  app/                 <span class="hljs-meta"># åº”ç”¨å¯åŠ¨å…¥å£</span>
<span class="hljs-keyword">internal</span>/
  config/              <span class="hljs-meta"># é…ç½®ç®¡ç†</span>
  modules/             <span class="hljs-meta"># ä¸šåŠ¡æ¨¡å—ï¼ˆuserã€postã€auth ç­‰ï¼‰</span>
  router/              <span class="hljs-meta"># è·¯ç”±å±‚</span>
  middleware/          <span class="hljs-meta"># HTTP ä¸­é—´ä»¶ï¼ˆé‰´æƒã€æ—¥å¿—ã€è·¨åŸŸç­‰ï¼‰</span>
  dto/                 <span class="hljs-meta"># æ•°æ®ä¼ è¾“å¯¹è±¡ï¼ˆè¯·æ±‚/å“åº”æ¨¡å‹ï¼‰</span>
pkg/
  logger/              <span class="hljs-meta"># æ—¥å¿—æ¨¡å—</span>
  postgres/            <span class="hljs-meta"># PostgreSQL å®¢æˆ·ç«¯</span>
  redis/               <span class="hljs-meta"># Redis å®¢æˆ·ç«¯</span>
  jwt/                 <span class="hljs-meta"># JWT å·¥å…·åº“</span>
  oauth2/              <span class="hljs-meta"># OAuth2ï¼ˆGitHub / Google ç™»å½•ï¼‰</span>
ent/
  schema/              <span class="hljs-meta"># Ent ORM æ¨¡å‹å®šä¹‰</span>
  migrate/             <span class="hljs-meta"># æ•°æ®åº“è¿ç§»æ–‡ä»¶</span>
docs/                  <span class="hljs-meta"># Swagger æ–‡æ¡£</span>
</code></pre>
<p>æˆ‘ç°åœ¨çš„æ ¸å¿ƒä¹ æƒ¯æ˜¯ï¼š</p>
<ul>
<li>æŒ‰<strong>ä¸šåŠ¡åŸŸæ‹†æ¨¡å—</strong>ï¼Œè€Œä¸æ˜¯æŒ‰æŠ€æœ¯æ‹†å±‚</li>
<li>router åªåšè·¯ç”±ç»‘å®š</li>
<li>modules åªåšä¸šåŠ¡é€»è¾‘</li>
<li>middleware ç‹¬ç«‹</li>
<li>dto å•ç‹¬ç®¡ç†è¾“å…¥è¾“å‡ºæ¨¡å‹</li>
<li>pkg æ”¾é€šç”¨åŸºç¡€è®¾æ–½èƒ½åŠ›</li>
</ul>
<p>æ¨¡å—ç»“æ„ä¿æŒç±»ä¼¼ NestJS çš„é£æ ¼ï¼š</p>
<pre><code class="hljs language-go" lang="go">modules/user
  user.controller.<span class="hljs-keyword">go</span>
  user.service.<span class="hljs-keyword">go</span>
  user.repository.<span class="hljs-keyword">go</span>
  user.module.<span class="hljs-keyword">go</span>
</code></pre>
<p>è¿™ç§ç»“æ„çš„å¥½å¤„å¾ˆç›´æ¥ï¼š</p>
<blockquote>
<p>æ‰¾åŠŸèƒ½ = æ‰¾æ¨¡å—ï¼Œä¸æ˜¯ç¿»ç›®å½•</p>
</blockquote>
<blockquote>
<p><code>user.controller.go</code> è¿™æ ·çš„æ–‡ä»¶å‘½åæ–¹å¼åº”è¯¥æ˜¯ä¸ç¬¦åˆ Go çš„å¼€å‘è§„èŒƒçš„ï¼Œä½†æ˜¯ç›®å‰å¥½åƒä¹Ÿæ²¡é‡åˆ°ä»€ä¹ˆé—®é¢˜ï¼Œæ‰€ä»¥...ğŸ˜Š</p>
</blockquote>
<hr/>
<h2 data-id="heading-6">äº”ã€Fx åœ¨å·¥ç¨‹é‡Œçš„çœŸå®ä½œç”¨</h2>
<p>ç°åœ¨åœ¨è¿™ä¸ªé¡¹ç›®é‡Œï¼ŒFx æ›´åƒæ˜¯ï¼š</p>
<blockquote>
<p>ä¸€ä¸ªâ€œå·¥ç¨‹å¯åŠ¨è°ƒåº¦å™¨â€</p>
</blockquote>
<p>å®ƒå¸®æˆ‘è§£å†³çš„æ˜¯ï¼š</p>
<ul>
<li>è°å…ˆåˆå§‹åŒ–</li>
<li>è°ä¾èµ–è°</li>
<li>è°ä»€ä¹ˆæ—¶å€™å¯åŠ¨</li>
<li>è°ä»€ä¹ˆæ—¶å€™å…³é—­</li>
</ul>
<p>è€Œä¸æ˜¯â€œæˆ‘æ€ä¹ˆ new ä¸€ä¸ªå¯¹è±¡â€ã€‚</p>
<p>åœ¨ <code>gin-app</code> é‡Œï¼ŒFx çš„ä½¿ç”¨æ–¹å¼ä¹Ÿæ¯”è¾ƒåå·¥ç¨‹åŒ–ï¼Œè€Œä¸æ˜¯é›¶æ•£æ³¨å…¥ã€‚</p>
<h3 data-id="heading-7">1. å¯åŠ¨å…¥å£ç»Ÿä¸€è°ƒåº¦</h3>
<p>æ•´ä¸ªç³»ç»Ÿçš„å¯åŠ¨å…¥å£é›†ä¸­åœ¨ <code>internal/app/app.go</code> çš„ <code>Run()</code> æ–¹æ³•ä¸­ï¼Œè¿™é‡Œä¸æ˜¯ç®€å•åœ° <code>main()</code> + ä¸€å †åˆå§‹åŒ–å‡½æ•°è°ƒç”¨ï¼Œè€Œæ˜¯é€šè¿‡ <code>fx.New()</code> ä½œä¸º<strong>ç³»ç»Ÿæ€»è°ƒåº¦ä¸­å¿ƒ</strong>ï¼š</p>
<pre><code class="hljs language-go" lang="go">fx.New(
  fx.Supply(...),
  fx.Provide(
      NewLogger,
      NewPostgresDB,
      NewRedis,
      NewOauth2Client,
      ...
  ),
  modules.APIModule,
  fx.Invoke(startHTTPServer),
).Run()
</code></pre>
<p>è¿™é‡Œçš„ç»“æ„éå¸¸æ¸…æ™°ï¼š</p>
<h4 data-id="heading-8">ï¼ˆ1ï¼‰<code>fx.Supply</code> â€”â€” å¤–éƒ¨é…ç½®æ³¨å…¥</h4>
<pre><code class="hljs language-go" lang="go">fx.Supply(
  fx.Annotate(cfg, fx.As(<span class="hljs-built_in">new</span>(config.ConfigInterface))),
)
</code></pre>
<p>é…ç½®å¯¹è±¡ä½œä¸ºâ€œå¤–éƒ¨è¾“å…¥â€è¿›å…¥ç³»ç»Ÿå®¹å™¨ï¼Œè€Œä¸æ˜¯åœ¨å†…éƒ¨åˆ°å¤„è¯»å–é…ç½®æ–‡ä»¶ã€‚</p>
<h4 data-id="heading-9">ï¼ˆ2ï¼‰<code>fx.Provide</code> â€”â€” åŸºç¡€è®¾æ–½ç»Ÿä¸€æ³¨å†Œ</h4>
<p>åŒ…æ‹¬ï¼š</p>
<ul>
<li>Logger</li>
<li>Postgres</li>
<li>Redis</li>
<li>JWT</li>
<li>OAuth2ï¼ˆGithub / Googleï¼‰</li>
<li>Gin Router</li>
<li>API Router</li>
<li>OpenAPI Router</li>
<li>HTTP Server</li>
</ul>
<p>å…¨éƒ¨é›†ä¸­æ³¨å†Œåœ¨ä¸€ä¸ªåœ°æ–¹ï¼Œå½¢æˆï¼š</p>
<blockquote>
<p>åŸºç¡€è®¾æ–½å±‚ç»Ÿä¸€åˆå§‹åŒ–ä¸­å¿ƒ</p>
</blockquote>
<p>ä¾‹å¦‚æ•°æ®åº“æ³¨å†Œï¼š</p>
<pre><code class="hljs language-go" lang="go">fx.Annotate(
  <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(cfg config.ConfigInterface, logger logger.Interface)</span></span> (*postgres.Postgres, <span class="hljs-type">error</span>) {
    pg, err := postgres.New(...)
    ...
    <span class="hljs-keyword">return</span> pg, <span class="hljs-literal">nil</span>
  },
  fx.OnStop(<span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(logger logger.Interface, pg *postgres.Postgres)</span></span> <span class="hljs-type">error</span> {
    pg.Close()
    <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>
  }),
)
</code></pre>
<p>åŒæ—¶æŠŠ<strong>ç”Ÿå‘½å‘¨æœŸç®¡ç†</strong>ä¹Ÿç»‘å®šåœ¨æ³¨å†Œé˜¶æ®µå®Œæˆã€‚</p>
<h4 data-id="heading-10">ï¼ˆ3ï¼‰<code>modules.APIModule</code> â€”â€” ä¸šåŠ¡ç³»ç»Ÿæ•´ä½“æŒ‚è½½</h4>
<pre><code class="hljs">modules.APIModule,
</code></pre>
<p>ä¸šåŠ¡æ¨¡å—ä¸æ˜¯æ•£è½æ³¨å†Œï¼Œè€Œæ˜¯ä½œä¸ºä¸€ä¸ªå®Œæ•´æ¨¡å—æ ‘æŒ‚è½½è¿›ç³»ç»Ÿå®¹å™¨ã€‚</p>
<h4 data-id="heading-11">ï¼ˆ4ï¼‰<code>fx.Invoke(startHTTPServer)</code> â€”â€” å¯åŠ¨è¡Œä¸ºå£°æ˜</h4>
<pre><code class="hljs language-go" lang="go">fx.Invoke(startHTTPServer)
</code></pre>
<p>ç³»ç»Ÿâ€œå¯åŠ¨åšä»€ä¹ˆäº‹â€é€šè¿‡å£°æ˜å¼ç»‘å®šï¼š</p>
<ul>
<li>ä¸åœ¨ <code>main</code> é‡Œå†™å¯åŠ¨é€»è¾‘</li>
<li>ä¸åœ¨æ„é€ å‡½æ•°é‡Œå¯åŠ¨æœåŠ¡</li>
<li>ä¸é  init() éšå¼è¡Œä¸º</li>
</ul>
<p>è€Œæ˜¯é€šè¿‡ <code>Invoke</code> æ˜¾å¼å£°æ˜ç³»ç»Ÿå¯åŠ¨åŠ¨ä½œã€‚</p>
<p>é…åˆ <code>Lifecycle</code>ï¼š</p>
<pre><code class="hljs language-php" lang="php">lc.<span class="hljs-title function_ invoke__">Append</span>(fx.Hook{
  <span class="hljs-attr">OnStart</span>: ...
  <span class="hljs-attr">OnStop</span>:  ...
})
</code></pre>
<p>å½¢æˆå®Œæ•´çš„ï¼š</p>
<blockquote>
<p>æ„å»ºæœŸï¼ˆProvideï¼‰ â†’ è£…é…æœŸï¼ˆModuleï¼‰ â†’ å¯åŠ¨æœŸï¼ˆInvokeï¼‰ â†’ ç”Ÿå‘½å‘¨æœŸç®¡ç†ï¼ˆLifecycleï¼‰</p>
</blockquote>
<p>è¿™ä½¿æ•´ä¸ªç³»ç»Ÿä»â€œè¿‡ç¨‹å¼å¯åŠ¨â€å˜æˆäº†<strong>å£°æ˜å¼å¯åŠ¨æ¨¡å‹</strong>ã€‚</p>
<p>ä¸æ˜¯â€œæˆ‘åœ¨ main é‡Œæ‰‹åŠ¨æ§åˆ¶é¡ºåºâ€ï¼Œè€Œæ˜¯ï¼š</p>
<blockquote>
<p>ç³»ç»Ÿç»“æ„å†³å®šå¯åŠ¨é¡ºåº</p>
</blockquote>
<blockquote>
<p>ä¾èµ–å…³ç³»å†³å®šåˆå§‹åŒ–é¡ºåº</p>
</blockquote>
<p>Fx åœ¨è¿™é‡Œæ›´åƒæ˜¯ä¸€ä¸ªï¼š<strong>å·¥ç¨‹å¯åŠ¨è°ƒåº¦æ¡†æ¶</strong>ï¼Œè€Œä¸ä»…æ˜¯ä¾èµ–æ³¨å…¥å·¥å…·ã€‚</p>
<h3 data-id="heading-12">2. æ¨¡å—åŒ–æ³¨å†Œæ–¹å¼ï¼ˆä¸šåŠ¡æ¨¡å—å³è·¯ç”±å•å…ƒï¼‰</h3>
<p>åœ¨è¿™ä¸ªé¡¹ç›®é‡Œï¼Œ<strong>æ¨¡å—ä¸ä»…æ˜¯ä¸šåŠ¡å•å…ƒï¼ŒåŒæ—¶ä¹Ÿæ˜¯è·¯ç”±æ³¨å†Œå•å…ƒ</strong>ã€‚</p>
<p>æ¯ä¸ªä¸šåŠ¡æ¨¡å—éƒ½æœ‰è‡ªå·±çš„ <code>module.go</code>ï¼Œä¸ä»…è´Ÿè´£ä¾èµ–æ³¨å†Œï¼Œä¹Ÿè´Ÿè´£è·¯ç”±æŒ‚è½½ï¼Œä¾‹å¦‚ <code>user.module.go</code>ï¼š</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">var</span> Module = fx.Module(
  <span class="hljs-string">"user"</span>,

  fx.Provide(
    <span class="hljs-comment">// user repository</span>
    fx.Annotate(
      NewUserRepository,
      fx.As(<span class="hljs-built_in">new</span>(UserRepository)),
    ),
    <span class="hljs-comment">// user service</span>
    fx.Annotate(
      NewUserService,
      fx.As(<span class="hljs-built_in">new</span>(UserService)),
    ),
    <span class="hljs-comment">// user controller</span>
    NewUserController,
  ),

  <span class="hljs-comment">// register router</span>
  fx.Invoke(<span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(
    router api_router.APIRouterParams,
    userController *UserController,
  )</span></span> {
    <span class="hljs-comment">// public routers</span>
    {
      userGroup := router.Public.Group(<span class="hljs-string">"/users"</span>)
      userGroup.POST(<span class="hljs-string">""</span>, userController.CreateOne)
    }

    <span class="hljs-comment">// private routers</span>
    {
      userGroup := router.Private.Group(<span class="hljs-string">"/users"</span>)
      userGroup.GET(<span class="hljs-string">":id"</span>, userController.GetById)
    }
  }),
)
</code></pre>
<p>è¿™é‡Œæœ‰ä¸€ä¸ªéå¸¸é‡è¦çš„è®¾è®¡ç‚¹ï¼š</p>
<blockquote>
<p><strong>è·¯ç”±æ³¨å†Œè·Ÿç€ä¸šåŠ¡æ¨¡å—èµ°ï¼Œè€Œä¸æ˜¯é›†ä¸­åœ¨ router ç›®å½•ç»Ÿä¸€ç®¡ç†ã€‚</strong></p>
</blockquote>
<p>ä¹Ÿå°±æ˜¯è¯´ï¼š</p>
<ul>
<li>ä¸€ä¸ªæ¨¡å— = ä¸€ç»„ä¸šåŠ¡èƒ½åŠ›</li>
<li>ä¸€ä¸ªæ¨¡å— = ä¸€ç»„è·¯ç”±å®šä¹‰</li>
<li>ä¸€ä¸ªæ¨¡å— = ä¸€ç»„ Controller + Service + Repository</li>
</ul>
<p>æ¨¡å—æœ¬èº«å°±æ˜¯ä¸€ä¸ª<strong>å®Œæ•´ä¸šåŠ¡é—­ç¯å•å…ƒ</strong>ã€‚</p>
<p>è¿™æ ·å¸¦æ¥çš„æ•ˆæœéå¸¸ç›´è§‚ï¼š</p>
<ul>
<li>æ–°å¢åŠŸèƒ½ = æ–°å¢æ¨¡å—</li>
<li>åˆ é™¤åŠŸèƒ½ = åˆ é™¤æ¨¡å—</li>
<li>æŸ¥åŠŸèƒ½ = æŸ¥æ¨¡å—</li>
</ul>
<p>è€Œä¸æ˜¯åœ¨ <code>router.go</code> é‡Œç¿»å‡ åä¸ªè·¯ç”±å®šä¹‰æ–‡ä»¶ã€‚</p>
<p>ä»å·¥ç¨‹ä½“éªŒä¸Šæ¥è¯´ï¼Œè¿™ç§æ–¹å¼éå¸¸æ¥è¿‘ NestJS çš„ Module + Controller ç»„ç»‡æ¨¡å¼ï¼Œåªä¸è¿‡æ˜¯ç”¨ Fx çš„ Module æœºåˆ¶å®ç°ã€‚</p>
<hr/>
<h3 data-id="heading-13">3. è·¯ç”±ç³»ç»Ÿçš„åˆå§‹åŒ–è§£è€¦è®¾è®¡</h3>
<p><code>internal/router</code> ç›®å½•åªè´Ÿè´£ä¸€ä»¶äº‹ï¼š<strong>Gin æœ¬èº«çš„åˆå§‹åŒ–ä¸ä¸­é—´ä»¶è£…é…</strong>ï¼Œä¸å…³å¿ƒä»»ä½•ä¸šåŠ¡è·¯ç”±ã€‚</p>
<h4 data-id="heading-14">Gin åˆå§‹åŒ–ï¼ˆç³»ç»Ÿå±‚ï¼‰</h4>
<pre><code class="hljs language-go" lang="go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">NewRouter</span><span class="hljs-params">(
  cfg config.ConfigInterface,
  logger logger.Interface,
)</span></span> *gin.Engine {
  app := gin.Default()

  <span class="hljs-comment">// middlewares</span>
  app.Use(requestid.New())
  app.Use(cors.New(...))
  app.Use(ginzap.GinzapWithConfig(...))
  app.Use(ginzap.RecoveryWithZap(...))
  app.Use(timeout.Timeout(...))
  app.Use(middleware.ErrorHandler(logger))

  <span class="hljs-comment">// Swagger</span>
  <span class="hljs-keyword">if</span> cfg.Swagger().Enabled {
    app.GET(<span class="hljs-string">"/swagger/*any"</span>, ginSwagger.WrapHandler(swaggerfiles.Handler))
  }

  <span class="hljs-keyword">return</span> app
}
</code></pre>
<p>è¿™ä¸€å±‚åªåšç³»ç»Ÿçº§èƒ½åŠ›ï¼š</p>
<ul>
<li>ä¸­é—´ä»¶è£…é…</li>
<li>æ—¥å¿—ç³»ç»Ÿ</li>
<li>è·¨åŸŸ</li>
<li>è¶…æ—¶æ§åˆ¶</li>
<li>Swagger</li>
</ul>
<p>å®Œå…¨ä¸å‡ºç°ä»»ä½•ä¸šåŠ¡è·¯ç”±ã€‚</p>
<h4 data-id="heading-15">API Router æŠ½è±¡å±‚</h4>
<p>é€šè¿‡ Fx æ„é€  API Routerï¼š</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">type</span> APIRouter <span class="hljs-keyword">struct</span> {
  fx.Out

  Public  *gin.RouterGroup <span class="hljs-string">`name:"api:public"`</span>
  Private *gin.RouterGroup <span class="hljs-string">`name:"api:private"`</span>
}

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">NewAPIRouter</span><span class="hljs-params">(
  cfg config.ConfigInterface,
  jwt jwt.JWTManagerInterface,
  app *gin.Engine,
)</span></span> APIRouter {
  public := app.Group(<span class="hljs-string">"/api/v1"</span>)
  private := public.Group(<span class="hljs-string">"/"</span>)

  private.Use(middleware.APIAuthHandler(jwt, cfg.HTTP().CookieName))

  <span class="hljs-keyword">return</span> APIRouter{
    Public:  public,
    Private: private,
  }
}
</code></pre>
<p>é€šè¿‡ <code>fx.Out</code> + <code>name tag</code>ï¼š</p>
<ul>
<li>ç³»ç»Ÿçº§ Router è´Ÿè´£åˆ†ç»„</li>
<li>æ¨¡å—çº§ Router åªæ¶ˆè´¹åˆ†ç»„</li>
</ul>
<p>ä¸šåŠ¡æ¨¡å—åªå…³å¿ƒï¼š</p>
<pre><code class="hljs language-go" lang="go">router.Public
router.Private
</code></pre>
<p>è€Œä¸å…³å¿ƒï¼š</p>
<ul>
<li>Gin Engine ä»å“ªé‡Œæ¥</li>
<li>ä¸­é—´ä»¶æ€ä¹ˆè£…</li>
<li>JWT é‰´æƒæ€ä¹ˆæŒ‚</li>
</ul>
<p>å½¢æˆæ¸…æ™°åˆ†å±‚ï¼š</p>
<blockquote>
<p>ç³»ç»Ÿå±‚ï¼šRouter åˆå§‹åŒ– + ä¸­é—´ä»¶ + åˆ†ç»„ç­–ç•¥<br/>
æ¨¡å—å±‚ï¼šæ¶ˆè´¹ RouterGroupï¼Œæ³¨å†Œä¸šåŠ¡è·¯ç”±</p>
</blockquote>
<p>è¿™è®©æ•´ä¸ªç³»ç»Ÿçš„è·¯ç”±ç»„ç»‡æ–¹å¼å˜æˆï¼š</p>
<blockquote>
<p>ç³»ç»Ÿæä¾›â€œè·¯ç”±èƒ½åŠ›â€<br/>
æ¨¡å—å£°æ˜â€œè·¯ç”±è¡Œä¸ºâ€</p>
</blockquote>
<p>è€Œä¸æ˜¯ä¼ ç»Ÿçš„ï¼š</p>
<blockquote>
<p>ä¸€ä¸ª router ç›®å½•ç®¡ç†å…¨ä¸–ç•Œè·¯ç”±</p>
</blockquote>
<p>æ¯ä¸ªä¸šåŠ¡æ¨¡å—éƒ½æœ‰è‡ªå·±çš„ <code>module.go</code>ï¼Œç±»ä¼¼ï¼š</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">var</span> Module = fx.Module(
  <span class="hljs-string">"user"</span>,
  fx.Provide(
    NewUserService,
    NewUserRepository,
    NewUserController,
  ),
)
</code></pre>
<p>æ¨¡å—åªå…³å¿ƒï¼š</p>
<ul>
<li>è‡ªå·±æä¾›ä»€ä¹ˆèƒ½åŠ›</li>
<li>è‡ªå·±ä¾èµ–ä»€ä¹ˆèƒ½åŠ›</li>
</ul>
<p>ä¸å…³å¿ƒï¼š</p>
<ul>
<li>è°æ¥è°ƒç”¨æˆ‘</li>
<li>è°å…ˆå¯åŠ¨ç³»ç»Ÿ</li>
</ul>
<h3 data-id="heading-16">3. è·¯ç”±æ³¨å†Œè§£è€¦</h3>
<p>è·¯ç”±å±‚é€šè¿‡ <code>fx.Invoke</code> ç»Ÿä¸€æ³¨å†Œï¼š</p>
<pre><code class="hljs language-go" lang="go">fx.Invoke(RegisterRouter)
</code></pre>
<p>Router å±‚åªä¾èµ– Controllerï¼Œä¸åå‘ä¾èµ–ä¸šåŠ¡æ¨¡å—å®ç°ï¼Œå½¢æˆæ¸…æ™°ä¾èµ–æ–¹å‘ã€‚</p>
<h3 data-id="heading-17">4. ç”Ÿå‘½å‘¨æœŸç»Ÿä¸€ç®¡ç†</h3>
<p>é€šè¿‡ Fx çš„ <code>Lifecycle</code> æœºåˆ¶ç»Ÿä¸€ç®¡ç†æœåŠ¡ç”Ÿå‘½å‘¨æœŸï¼š</p>
<pre><code class="hljs language-go" lang="go">lc.Append(fx.Hook{
  OnStart: <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(ctx context.Context)</span></span> <span class="hljs-type">error</span> {
    <span class="hljs-keyword">return</span> server.Start()
  },
  OnStop: <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(ctx context.Context)</span></span> <span class="hljs-type">error</span> {
    <span class="hljs-keyword">return</span> server.Stop()
  },
})
</code></pre>
<p>è¿™è®©ï¼š</p>
<ul>
<li>æœåŠ¡å¯åŠ¨é¡ºåºå¯æ§</li>
<li>èµ„æºåˆå§‹åŒ–æœ‰åº</li>
<li>æ”¯æŒä¼˜é›…å…³é—­</li>
<li>ç³»ç»ŸçŠ¶æ€ç»Ÿä¸€ç®¡ç†</li>
</ul>
<p>åœ¨å®é™…ä½¿ç”¨ä¸­ï¼ŒFx å¸¦æ¥çš„æœ€å¤§ä»·å€¼ä¸æ˜¯â€œçœå‡ è¡Œä»£ç â€ï¼Œè€Œæ˜¯ï¼š</p>
<blockquote>
<p>æŠŠç³»ç»Ÿç»“æ„ä»â€œæ‰‹åŠ¨ç»„ç»‡â€å˜æˆâ€œå£°æ˜å¼ç»„ç»‡â€</p>
</blockquote>
<p>ç³»ç»Ÿä»â€œäººè„‘è°ƒåº¦â€å˜æˆâ€œç³»ç»Ÿè°ƒåº¦â€ã€‚</p>
<hr/>
<h2 data-id="heading-18">å…­ã€æ¨¡å—åŒ–çš„çœŸå®ä½“éªŒ</h2>
<p>æ¨¡å—åŒ–ä¹‹åï¼Œä¸€ä¸ªå¾ˆç›´è§‚çš„æ„Ÿå—æ˜¯ï¼š</p>
<ul>
<li>æ¨¡å—è¾¹ç•Œæ¸…æ™°</li>
<li>æ”¹ä»£ç ä¸å®¹æ˜“è¯¯ä¼¤å…¶ä»–æ¨¡å—</li>
<li>é‡æ„æ›´å®‰å…¨</li>
<li>ä¾èµ–å…³ç³»æ›´æ¸…æ¥š</li>
</ul>
<p>æ¨¡å—ä¸å†æ˜¯â€œæ–‡ä»¶åˆ†ç±»â€ï¼Œè€Œæ˜¯<strong>ä¸šåŠ¡å•å…ƒ</strong>ã€‚</p>
<hr/>
<h2 data-id="heading-19">ä¸ƒã€è¿™å¥—ç»“æ„å¸¦æ¥çš„çœŸå®å˜åŒ–</h2>
<p>ç”¨è¿™å¥—ç»“æ„å†™é¡¹ç›®ä¹‹åï¼Œæœ€å¤§çš„å˜åŒ–ä¸æ˜¯â€œå†™å¾—æ›´å¿«â€ï¼Œè€Œæ˜¯ï¼š</p>
<ul>
<li>é¡¹ç›®ç»“æ„æ›´ç¨³</li>
<li>ç»´æŠ¤å‹åŠ›æ›´å°</li>
<li>é‡æ„æˆæœ¬æ›´ä½</li>
<li>æ–°äººæ›´å®¹æ˜“ç†è§£é¡¹ç›®</li>
<li>å¿ƒç†è´Ÿæ‹…æ›´å°ï¼ˆç¬‘ï¼‰</li>
</ul>
<hr/>
<h2 data-id="heading-20">å…«ã€å†™åœ¨æœ€å</h2>
<p><code>gin-app</code> å¯¹æˆ‘æ¥è¯´ï¼Œä¸æ˜¯ä¸€ä¸ªâ€œä½œå“â€ï¼Œè€Œæ›´åƒæ˜¯ï¼š</p>
<blockquote>
<p>ä¸€å¥—åœ¨çœŸå®é¡¹ç›®ä¸­ä¸æ–­è¯•é”™ã€è°ƒæ•´ã€æ¼”åŒ–å‡ºæ¥çš„å·¥ç¨‹ç»“æ„</p>
</blockquote>
<p>å®ƒä¸æ˜¯æ ‡å‡†ç­”æ¡ˆï¼Œä¹Ÿä¸æ˜¯æœ€ä½³å®è·µï¼Œåªæ˜¯ä¸€ä¸ªï¼š</p>
<blockquote>
<p>å½“å‰é˜¶æ®µè®©æˆ‘ç”¨èµ·æ¥æœ€èˆ’æœçš„ä¸€ç§ Go å·¥ç¨‹ç»„ç»‡æ–¹å¼</p>
</blockquote>
<p>å¦‚æœä½ ä¹Ÿåœ¨åš Go é¡¹ç›®å·¥ç¨‹åŒ–ï¼Œå¯èƒ½ä½ ä¹Ÿä¼šé‡åˆ°ç±»ä¼¼çš„é—®é¢˜ã€‚</p>
<p>è¿™ç¯‡æ–‡ç« åªæ˜¯ä¸€æ¬¡ä¸ªäººå®è·µåˆ†äº«ï¼Œå¸Œæœ›èƒ½æä¾›ä¸€äº›æ€è·¯å‚è€ƒï¼Œè€Œä¸æ˜¯èŒƒå¼æ ‡å‡†ã€‚</p>
<hr/>
<h2 data-id="heading-21">é¡¹ç›®åœ°å€</h2>
<p>GitHubï¼š<br/>
<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2F1111mp%2Fgin-app" target="_blank" title="https://github.com/1111mp/gin-app" ref="nofollow noopener noreferrer">github.com/1111mp/gin-â€¦</a></p>
<hr/>
<blockquote>
<p>å¦‚æœä½ ä¹Ÿåœ¨åš Go å·¥ç¨‹åŒ–æ¢ç´¢ï¼Œæ¬¢è¿äº¤æµå®è·µç»éªŒ ğŸ™Œ</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[å†è°ˆAgent Loopï¼šå¤§æ¨¡å‹ â€œèƒ½åšäº‹â€ çš„æ ¸å¿ƒæœºåˆ¶]]></title>    <link>https://juejin.cn/post/7603643044035330084</link>    <guid>https://juejin.cn/post/7603643044035330084</guid>    <pubDate>2026-02-08T10:39:19.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7603643044035330084" data-draft-id="7603643044035297316" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="å†è°ˆAgent Loopï¼šå¤§æ¨¡å‹ â€œèƒ½åšäº‹â€ çš„æ ¸å¿ƒæœºåˆ¶"/> <meta itemprop="keywords" content="Agent,AIç¼–ç¨‹"/> <meta itemprop="datePublished" content="2026-02-08T10:39:19.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å‘¨æœ«ç¨‹åºçŒ¿"/> <meta itemprop="url" content="https://juejin.cn/user/3245414056989757"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            å†è°ˆAgent Loopï¼šå¤§æ¨¡å‹ â€œèƒ½åšäº‹â€ çš„æ ¸å¿ƒæœºåˆ¶
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3245414056989757/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å‘¨æœ«ç¨‹åºçŒ¿
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-08T10:39:19.000Z" title="Sun Feb 08 2026 10:39:19 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»8åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>ä¸Šä¸€ç¯‡æ–‡ç« ä»‹ç»äº†ã€Šä»0å¼€å‘å¤§æ¨¡å‹ä¹‹å®ç°Agentï¼ˆBash åˆ° SKILLï¼‰ã€‹ï¼Œæœ‰äº›è¯»è€…åé¦ˆæ–‡ç« å¤ªé•¿äº†ï¼Œæ‰€ä»¥è¿™ç¯‡æ–‡ç« ä¸»è¦ä»‹ç» Agent Loopã€‚</p>
<h2 data-id="heading-0">Agent Loop æ˜¯ä»€ä¹ˆï¼Ÿ</h2>
<p><strong>Agent Loop = è°ƒç”¨æ¨¡å‹ â†’ åˆ¤æ–­æ˜¯å¦è¦ç”¨å·¥å…· â†’ æ‰§è¡Œå·¥å…· â†’ æŠŠç»“æœå›å–‚ç»™æ¨¡å‹ â†’ é‡å¤</strong><br/>
ç›´åˆ°æ¨¡å‹è®¤ä¸ºä¿¡æ¯è¶³å¤Ÿï¼Œè¾“å‡ºæœ€ç»ˆç­”æ¡ˆä¸ºæ­¢ã€‚<br/>
å®ƒæŠŠå¤§æ¨¡å‹ä»â€œæ–‡æœ¬ç”Ÿæˆå™¨â€å‡çº§ä¸ºâ€œèƒ½å®Œæˆä»»åŠ¡çš„æ‰§è¡Œç³»ç»Ÿâ€ã€‚</p>
<p>è¿˜æ˜¯ç”¨ä¹‹å‰æœ€ç®€å•æ‰§è¡Œ Bash çš„ Agent ä½œä¸ºæ ·ä¾‹ä»£ç ï¼š</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span>Â sys
<span class="hljs-keyword">import</span>Â os
<span class="hljs-keyword">import</span>Â traceback
<span class="hljs-keyword">from</span>Â llm_factoryÂ <span class="hljs-keyword">import</span>Â LLMFactory, LLMChatAdapter
<span class="hljs-keyword">from</span>Â util.mylogÂ <span class="hljs-keyword">import</span>Â logger
<span class="hljs-keyword">from</span>Â utilsÂ <span class="hljs-keyword">import</span>Â run_bash, BASH_TOOLS

<span class="hljs-comment"># åˆå§‹åŒ– API å®¢æˆ·ç«¯</span>
<span class="hljs-comment"># ä½¿ç”¨ LLMFactory åˆ›å»º LLM å®ä¾‹</span>
llm = LLMFactory.create(
Â  Â  model_type=<span class="hljs-string">"openai"</span>,
Â  Â  model_name=<span class="hljs-string">"deepseek-v3.2"</span>,Â <span class="hljs-comment"># ä½¿ç”¨æ”¯æŒçš„æ¨¡å‹</span>
Â  Â  temperature=<span class="hljs-number">0.0</span>,
Â  Â  max_tokens=<span class="hljs-number">8192</span>
)
client = LLMChatAdapter(llm)

<span class="hljs-comment"># ç³»ç»Ÿæç¤ºè¯</span>
SYSTEM =Â <span class="hljs-string">f"""ä½ æ˜¯ä¸€ä¸ªä½äºÂ <span class="hljs-subst">{os.getcwd()}</span>Â çš„ CLI ä»£ç†ï¼Œç³»ç»Ÿä¸ºÂ <span class="hljs-subst">{sys.platform}</span>ã€‚ä½¿ç”¨ bash å‘½ä»¤è§£å†³é—®é¢˜ã€‚

## è§„åˆ™ï¼š
- ä¼˜å…ˆä½¿ç”¨å·¥å…·è€Œä¸æ˜¯æ–‡å­—æè¿°ã€‚å…ˆè¡ŒåŠ¨ï¼Œåç®€è¦è§£é‡Šã€‚
- è¯»å–æ–‡ä»¶ï¼šcat, grep, find, rg, ls, head, tail
- å†™å…¥æ–‡ä»¶ï¼šecho '...' &gt; file, sed -i, æˆ– cat &lt;&lt; 'EOF' &gt; file
- é¿å…å±é™©æ“ä½œï¼Œå¦‚ rm -rfç­‰åˆ é™¤æˆ–è€…æ¸…ç†æ–‡ä»¶, æˆ–æ ¼å¼åŒ–æŒ‚è½½ç‚¹ï¼Œæˆ–å¯¹ç³»ç»Ÿæ–‡ä»¶è¿›è¡Œå†™æ“ä½œ

## è¦æ±‚
- ä¸ä½¿ç”¨å…¶ä»–å·¥å…·ï¼Œä»…ä½¿ç”¨ bash å‘½ä»¤æˆ–è€… shell è„šæœ¬
- å­ä»£ç†å¯ä»¥é€šè¿‡ç”Ÿæˆ shell ä»£ç æ‰§è¡Œ
- å¦‚æœå½“å‰ä»»åŠ¡è¶…è¿‡ bash çš„å¤„ç†èŒƒå›´ï¼Œåˆ™ç»ˆæ­¢ä¸å¤„ç†
"""</span>

<span class="hljs-keyword">def</span>Â <span class="hljs-title function_">extract_bash_commands</span>(<span class="hljs-params">text</span>):
Â  Â Â <span class="hljs-string">"""ä» LLM å“åº”ä¸­æå– bash å‘½ä»¤"""</span>
Â  Â Â <span class="hljs-keyword">import</span>Â re
Â  Â  pattern =Â <span class="hljs-string">r'```bash\n(.*?)\n```'</span>
Â  Â  matches = re.findall(pattern, text, re.DOTALL)
Â  Â Â <span class="hljs-keyword">return</span>Â [cmd.strip()Â <span class="hljs-keyword">for</span>Â cmdÂ <span class="hljs-keyword">in</span>Â matchesÂ <span class="hljs-keyword">if</span>Â cmd.strip()]

<span class="hljs-keyword">def</span>Â <span class="hljs-title function_">chat</span>(<span class="hljs-params">prompt, history=<span class="hljs-literal">None</span>, max_steps=<span class="hljs-number">10</span></span>):
Â  Â Â <span class="hljs-keyword">if</span>Â historyÂ isNone:
Â  Â  Â  Â  history = []
Â  Â Â 
Â  Â Â <span class="hljs-comment"># æ£€æŸ¥å†å²è®°å½•ä¸­æ˜¯å¦å·²æœ‰ç³»ç»Ÿæç¤ºè¯ï¼ˆä½œä¸ºç³»ç»Ÿæ¶ˆæ¯ï¼‰</span>
Â  Â  has_system = <span class="hljs-built_in">any</span>(msg.get(<span class="hljs-string">"role"</span>) ==Â <span class="hljs-string">"system"</span><span class="hljs-keyword">for</span>Â msgÂ <span class="hljs-keyword">in</span>Â history)
Â  Â Â ifnotÂ has_system:
Â  Â  Â  Â  Â <span class="hljs-comment"># åœ¨å¼€å¤´æ·»åŠ ç³»ç»Ÿæç¤ºè¯ä½œä¸ºç³»ç»Ÿæ¶ˆæ¯</span>
Â  Â  Â  Â  Â history.insert(<span class="hljs-number">0</span>, {<span class="hljs-string">"role"</span>:Â <span class="hljs-string">"system"</span>,Â <span class="hljs-string">"content"</span>: SYSTEM})

Â  Â  history.append({<span class="hljs-string">"role"</span>:Â <span class="hljs-string">"user"</span>,Â <span class="hljs-string">"content"</span>: prompt})

Â  Â  step =Â <span class="hljs-number">0</span>
Â  Â Â <span class="hljs-keyword">while</span>Â step &lt; max_steps:
Â  Â  Â  Â  step +=Â <span class="hljs-number">1</span>
Â  Â  Â  Â Â <span class="hljs-comment"># 1. è°ƒç”¨æ¨¡å‹ï¼ˆä¼ é€’ tools å‚æ•°ï¼‰</span>
Â  Â  Â  Â Â <span class="hljs-comment"># ä½¿ç”¨ chat_with_tools æ¥å£ï¼Œæ”¯æŒ function calling</span>
Â  Â  Â  Â  response = client.chat_with_tools(
Â  Â  Â  Â  Â  Â  prompt=prompt,
Â  Â  Â  Â  Â  Â  messages=history,
Â  Â  Â  Â  Â  Â  tools=BASH_TOOLS
Â  Â  Â  Â  )
Â  Â  Â  Â Â <span class="hljs-keyword">if</span>Â step ==Â <span class="hljs-number">1</span>:
Â  Â  Â  Â  Â  Â  prompt =Â <span class="hljs-string">'ç»§ç»­'</span>

Â  Â  Â  Â Â <span class="hljs-comment"># 2. è§£æå“åº”å†…å®¹</span>
Â  Â  Â  Â  assistant_text = []
Â  Â  Â  Â  tool_calls = []
Â  Â  Â  Â Â 
Â  Â  Â  Â  logger.info(<span class="hljs-string">f"ç¬¬Â <span class="hljs-subst">{step}</span>Â æ­¥å“åº”:Â <span class="hljs-subst">{response}</span>"</span>)

Â  Â  Â  Â Â <span class="hljs-comment"># chat_with_tools è¿”å›çš„æ˜¯ Response å¯¹è±¡ï¼ŒåŒ…å« content åˆ—è¡¨</span>
Â  Â  Â  Â Â <span class="hljs-keyword">for</span>Â blockÂ <span class="hljs-keyword">in</span>Â response.content:
Â  Â  Â  Â  Â  Â Â <span class="hljs-keyword">if</span>Â <span class="hljs-built_in">getattr</span>(block,Â <span class="hljs-string">"type"</span>,Â <span class="hljs-string">""</span>) ==Â <span class="hljs-string">"text"</span>:
Â  Â  Â  Â  Â  Â  Â  Â  assistant_text.append(block.text)
Â  Â  Â  Â  Â  Â Â <span class="hljs-keyword">elif</span>Â <span class="hljs-built_in">getattr</span>(block,Â <span class="hljs-string">"type"</span>,Â <span class="hljs-string">""</span>) ==Â <span class="hljs-string">"tool_use"</span>:
Â  Â  Â  Â  Â  Â  Â  Â  tool_calls.append(block)

Â  Â  Â  Â Â <span class="hljs-comment"># è®°å½•åŠ©æ‰‹æ–‡æœ¬å›å¤</span>
Â  Â  Â  Â  full_text =Â <span class="hljs-string">"\n"</span>.join(assistant_text)
Â  Â  Â  Â Â <span class="hljs-keyword">if</span>Â full_text:
Â  Â  Â  Â  Â  Â  logger.info(<span class="hljs-string">f"åŠ©æ‰‹:Â <span class="hljs-subst">{full_text}</span>"</span>)
Â  Â  Â  Â  Â  Â  history.append({<span class="hljs-string">"role"</span>:Â <span class="hljs-string">"assistant"</span>,Â <span class="hljs-string">"content"</span>: full_text})
Â  Â  Â  Â Â <span class="hljs-keyword">elif</span>Â tool_calls:
Â  Â  Â  Â  Â  Â Â <span class="hljs-comment"># å¦‚æœåªæœ‰å·¥å…·è°ƒç”¨æ²¡æœ‰æ–‡æœ¬ï¼Œæ·»åŠ ä¸€ä¸ªå ä½æ–‡æœ¬åˆ°å†å²ï¼Œä¿æŒå¯¹è¯è¿è´¯</span>
Â  Â  Â  Â  Â  Â  history.append({<span class="hljs-string">"role"</span>:Â <span class="hljs-string">"assistant"</span>,Â <span class="hljs-string">"content"</span>:Â <span class="hljs-string">"(Executing tools...)"</span>})
Â  Â  Â  Â Â 
Â  Â  Â  Â Â <span class="hljs-comment"># 3. å¦‚æœæ²¡æœ‰å·¥å…·è°ƒç”¨ï¼Œç›´æ¥è¿”å›å†…å®¹</span>
Â  Â  Â  Â Â ifnotÂ tool_calls:
Â  Â  Â  Â  Â  Â  logger.info(<span class="hljs-string">f"ç¬¬Â <span class="hljs-subst">{step}</span>Â æ­¥ç»“æŸï¼Œæ— å·¥å…·è°ƒç”¨"</span>)
Â  Â  Â  Â  Â  Â Â <span class="hljs-keyword">if</span>Â response.stop_reason ==Â <span class="hljs-string">"end_turn"</span>:
Â  Â  Â  Â  Â  Â  Â  Â Â <span class="hljs-keyword">return</span>Â full_text
Â  Â  Â  Â  Â  Â Â <span class="hljs-comment"># å¦‚æœå¼‚å¸¸ç»“æŸï¼Œä¹Ÿè¿”å›</span>
Â  Â  Â  Â  Â  Â Â <span class="hljs-keyword">return</span>Â full_textÂ o<span class="hljs-string">r"(No response)"</span>

Â  Â  Â  Â Â <span class="hljs-comment"># 4. æ‰§è¡Œå·¥å…·</span>
Â  Â  Â  Â  logger.info(<span class="hljs-string">f"ç¬¬Â <span class="hljs-subst">{step}</span>Â æ­¥å·¥å…·è°ƒç”¨:Â <span class="hljs-subst">{tool_calls}</span>"</span>)
Â  Â  Â  Â  all_outputs = []
Â  Â  Â  Â Â <span class="hljs-keyword">for</span>Â tcÂ <span class="hljs-keyword">in</span>Â tool_calls:
Â  Â  Â  Â  Â  Â Â <span class="hljs-keyword">if</span>Â tc.name ==Â <span class="hljs-string">"bash"</span>:
Â  Â  Â  Â  Â  Â  Â  Â  cmd = tc.<span class="hljs-built_in">input</span>.get(<span class="hljs-string">"command"</span>)
Â  Â  Â  Â  Â  Â  Â  Â Â <span class="hljs-keyword">if</span>Â cmd:
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  logger.info(<span class="hljs-string">f"[ä½¿ç”¨å·¥å…·]Â <span class="hljs-subst">{cmd}</span>"</span>) Â <span class="hljs-comment"># é»„è‰²æ˜¾ç¤ºå‘½ä»¤</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  output = run_bash(cmd)
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  all_outputs.append(<span class="hljs-string">f"$Â <span class="hljs-subst">{cmd}</span>\n<span class="hljs-subst">{output}</span>"</span>)
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â <span class="hljs-comment"># å¦‚æœè¾“å‡ºå¤ªé•¿åˆ™æˆªæ–­æ‰“å°</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â <span class="hljs-keyword">if</span>Â <span class="hljs-built_in">len</span>(output) &gt;Â <span class="hljs-number">200</span>:
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  logger.info(<span class="hljs-string">f"è¾“å‡º:Â <span class="hljs-subst">{output[:<span class="hljs-number">200</span>]}</span>... (å·²æˆªæ–­)"</span>)
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â <span class="hljs-keyword">else</span>:
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  logger.info(<span class="hljs-string">f"è¾“å‡º:Â <span class="hljs-subst">{output}</span>"</span>)
Â  Â  Â  Â  Â  Â Â <span class="hljs-keyword">else</span>:
Â  Â  Â  Â  Â  Â  Â  Â  logger.warning(<span class="hljs-string">f"Unknown tool:Â <span class="hljs-subst">{tc.name}</span>"</span>)
Â  Â  Â  Â Â 
Â  Â  Â  Â Â <span class="hljs-comment"># 5. å°†å‘½ä»¤æ‰§è¡Œç»“æœæ·»åŠ åˆ°å†å²è®°å½•ä¸­</span>
Â  Â  Â  Â Â <span class="hljs-keyword">if</span>Â all_outputs:
Â  Â  Â  Â  Â  Â  combined_output =Â <span class="hljs-string">"\n"</span>.join(all_outputs)
Â  Â  Â  Â  Â  Â  history.append({<span class="hljs-string">"role"</span>:Â <span class="hljs-string">"user"</span>,Â <span class="hljs-string">"content"</span>:Â <span class="hljs-string">f"æ‰§è¡Œç»“æœï¼š\n<span class="hljs-subst">{combined_output}</span>\n\nè¯·ç»§ç»­å¤„ç†ã€‚"</span>})
Â  Â  Â  Â Â <span class="hljs-keyword">else</span>:
Â  Â  Â  Â  Â  Â Â <span class="hljs-comment"># æœ‰å·¥å…·è°ƒç”¨ä½†æ²¡äº§ç”Ÿè¾“å‡ºï¼ˆå¯èƒ½æ˜¯è§£æå¤±è´¥æˆ–ç©ºå‘½ä»¤ï¼‰</span>
Â  Â  Â  Â  Â  Â  history.append({<span class="hljs-string">"role"</span>:Â <span class="hljs-string">"user"</span>,Â <span class="hljs-string">"content"</span>:Â <span class="hljs-string">"Error: Tool call failed or produced no output."</span>})

Â  Â Â <span class="hljs-keyword">return</span><span class="hljs-string">"è¾¾åˆ°æœ€å¤§æ‰§è¡Œæ­¥æ•°é™åˆ¶ï¼Œåœæ­¢æ‰§è¡Œã€‚"</span>

<span class="hljs-keyword">if</span>Â __name__ ==Â <span class="hljs-string">"__main__"</span>:
Â  Â Â <span class="hljs-keyword">if</span>Â <span class="hljs-built_in">len</span>(sys.argv) &gt;Â <span class="hljs-number">1</span>:
Â  Â  Â  Â  logger.info(chat(sys.argv[<span class="hljs-number">1</span>]))
Â  Â Â <span class="hljs-keyword">else</span>:
Â  Â  Â  Â Â <span class="hljs-comment"># äº¤äº’æ¨¡å¼</span>
Â  Â  Â  Â  logger.info(<span class="hljs-string">"Bash ä»£ç†å·²å¯åŠ¨ã€‚è¾“å…¥ 'exit' é€€å‡ºã€‚"</span>)
Â  Â  Â  Â  history = []
Â  Â  Â  Â Â whileTrue:
Â  Â  Â  Â  Â  Â Â <span class="hljs-keyword">try</span>:
Â  Â  Â  Â  Â  Â  Â  Â  user_input = <span class="hljs-built_in">input</span>(<span class="hljs-string">"&gt; "</span>)
Â  Â  Â  Â  Â  Â  Â  Â Â <span class="hljs-keyword">if</span>Â user_input.lower()Â <span class="hljs-keyword">in</span>Â [<span class="hljs-string">'exit'</span>,Â <span class="hljs-string">'quit'</span>]:
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â <span class="hljs-keyword">break</span>
Â  Â  Â  Â  Â  Â  Â  Â  chat(user_input, history)
Â  Â  Â  Â  Â  Â Â <span class="hljs-keyword">except</span>Â KeyboardInterrupt:
Â  Â  Â  Â  Â  Â  Â  Â  logger.info(<span class="hljs-string">"\næ­£åœ¨é€€å‡º..."</span>)
Â  Â  Â  Â  Â  Â  Â  Â Â <span class="hljs-keyword">break</span>
Â  Â  Â  Â  Â  Â Â <span class="hljs-keyword">except</span>Â ExceptionÂ <span class="hljs-keyword">as</span>Â e:
Â  Â  Â  Â  Â  Â  Â  Â  logger.info(<span class="hljs-string">f"\né”™è¯¯:Â <span class="hljs-subst">{e}</span>"</span>)
Â  Â  Â  Â  Â  Â  Â  Â  traceback.print_exc()
</code></pre>
<hr/>
<h2 data-id="heading-1">Agent Loop æ€ä¹ˆå·¥ä½œï¼Ÿï¼ˆæ ¸å¿ƒå¾ªç¯ï¼‰</h2>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e026af4c1c3b4b62af54fc8fe76bc3f3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZGo5pyr56iL5bqP54y_:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771151960&amp;x-signature=H3PIAgO3gpowXhvwv8bVgyNZhQU%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<p>å¯ä»¥æŠŠ Agent Loop ç†è§£æˆä¸€ä¸ªé€’å½’çš„å·¥ä½œæµï¼ˆå¯¹åº”ä¸Šé¢çš„ä»£ç å°±æ˜¯ while å¾ªç¯ï¼Œä¸æ–­å°†å†å²æ•°æ®å’Œæ‰§è¡Œç»“æœä¿¡æ¯è¾“å…¥ç»™LLMï¼‰ï¼š</p>
<ol>
<li><strong>æ¨¡å‹æ€è€ƒ</strong>ï¼šåŸºäºå½“å‰ä¸Šä¸‹æ–‡ç†è§£ä»»åŠ¡ã€åˆ¶å®šä¸‹ä¸€æ­¥ï¼›</li>
<li><strong>é€‰æ‹©å·¥å…·</strong>ï¼šå¦‚æœç¼ºä¿¡æ¯æˆ–éœ€è¦æ‰§è¡ŒåŠ¨ä½œï¼Œå°±å‘èµ·å·¥å…·è°ƒç”¨è¯·æ±‚ï¼›</li>
<li><strong>æ‰§è¡Œå·¥å…·</strong>ï¼šç³»ç»Ÿæ ¹æ®å·¥å…·å®šä¹‰ï¼ˆschemaï¼‰æ ¡éªŒå‚æ•°å¹¶è¿è¡Œå·¥å…·ï¼›</li>
<li><strong>ç»“æœå›ä¼ </strong>ï¼šæŠŠå·¥å…·ç»“æœä½œä¸ºæ–°æ¶ˆæ¯åŠ å…¥å¯¹è¯å†å²ï¼›</li>
<li>å›åˆ°ç¬¬ 1 æ­¥ï¼Œç»§ç»­è¿­ä»£ï¼Œç›´åˆ°è¾“å‡ºæœ€ç»ˆå›ç­”ï¼›</li>
</ol>
<p>æ ¸å¿ƒçš„ä¸œè¥¿ï¼š<strong>ä¸Šä¸‹æ–‡ä¼šç´¯ç§¯</strong>ï¼Œæ¨¡å‹ä¸ä»…çœ‹åˆ°ç”¨æˆ·æœ€åˆçš„é—®é¢˜ï¼Œè¿˜èƒ½çœ‹åˆ°è‡ªå·±è°ƒç”¨è¿‡å“ªäº›å·¥å…·ã€æ‹¿åˆ°äº†å“ªäº›ç»“æœï¼Œä»è€Œå®Œæˆå¤šæ­¥æ¨ç†ä¸å†³ç­–ã€‚</p>
<hr/>
<h2 data-id="heading-2">ä¸€ä¸ªå…·ä½“ä¾‹å­ï¼šæ‰«æä»£ç åº“å®‰å…¨æ¼æ´</h2>
<p>ç”¨æˆ·è¯´ï¼šâ€œå¸®æˆ‘åˆ†æè¿™ä¸ªä»£ç åº“æœ‰æ²¡æœ‰å®‰å…¨æ¼æ´ã€‚â€</p>
<p>å•æ¬¡å›ç­”ä¸å¯èƒ½å®Œæˆï¼Œå› ä¸ºéœ€è¦è¯»ä»£ç ã€æœç´¢ã€å½’çº³ï¼ŒAgent Loop ä¼šè¿™æ ·è·‘ï¼š</p>
<ol>
<li>æ¨¡å‹å…ˆéœ€è¦äº†è§£é¡¹ç›®ç»“æ„ â†’ è°ƒç”¨<strong>ç›®å½•åˆ—ä¸¾å·¥å…·</strong></li>
<li>çœ‹åˆ°ç›®å½•ç»“æ„åï¼Œå®šä½å…¥å£æ–‡ä»¶ â†’ è°ƒç”¨<strong>æ–‡ä»¶è¯»å–å·¥å…·</strong></li>
<li>å‘ç°æœ‰æ•°æ®åº“æŸ¥è¯¢ â†’ å†è¯»æ•°æ®åº“æ¨¡å— â†’ å†æ¬¡è°ƒç”¨<strong>æ–‡ä»¶è¯»å–å·¥å…·</strong></li>
<li>è¯†åˆ«å‡ºç–‘ä¼¼ SQL æ³¨å…¥ï¼ˆç”¨æˆ·è¾“å…¥ç›´æ¥æ‹¼æ¥ SQLï¼‰â†’ ä¸ºç¡®è®¤å½±å“é¢ï¼Œè°ƒç”¨<strong>ä»£ç æœç´¢å·¥å…·</strong>æ‰¾è°ƒç”¨ç‚¹</li>
<li>å·¥å…·è¿”å› 12 å¤„è°ƒç”¨ â†’ æ¨¡å‹è®¤ä¸ºä¿¡æ¯è¶³å¤Ÿ â†’ è¾“å‡º<strong>æœ€ç»ˆæŠ¥å‘Š</strong>ï¼ˆæ¼æ´è¯´æ˜ã€ä½ç½®ã€ä¿®å¤å»ºè®®ï¼‰</li>
</ol>
<p>æ¯ä¸€è½®éƒ½éµå¾ªåŒä¸€ä¸ªæ¨¡å¼ï¼š<strong>æ‹¿åˆ°æ–°ä¿¡æ¯ â†’ å†³å®šç»§ç»­è¡ŒåŠ¨è¿˜æ˜¯ç»“æŸè¾“å‡º</strong>ï¼Œè€Œä¸”è¿™äº›å†³å®šæ˜¯æ¨¡å‹åŸºäºå½“å‰ä¸Šä¸‹æ–‡â€œè‡ªä¸»åšçš„â€ã€‚</p>
<hr/>
<h2 data-id="heading-3">Agent Loop é‡Œæ¶ˆæ¯é•¿ä»€ä¹ˆæ ·ï¼Ÿï¼ˆå¯¹è¯å†å²=å·¥ä½œè®°å¿†ï¼‰</h2>
<p>Agent Loop ä¸»è¦ç»´æŠ¤ä¸€ä»½â€œå¯¹è¯å†å²â€ï¼Œå®ƒæ˜¯æ¨¡å‹çš„ä¸´æ—¶å·¥ä½œè®°å¿†ã€‚æ¶ˆæ¯é€šå¸¸åˆ†ä¸¤ç±»è§’è‰²ï¼š</p>
<ul>
<li><strong>user</strong>ï¼šç”¨æˆ·è¾“å…¥ã€åç»­æŒ‡ä»¤ã€ä»¥åŠï¼ˆå¸¸è§å®ç°é‡Œï¼‰å·¥å…·ç»“æœä¹Ÿå¯èƒ½ä»¥ç”¨æˆ·/ç³»ç»Ÿå½¢å¼æ³¨å…¥</li>
<li><strong>assistant</strong>ï¼šæ¨¡å‹è¾“å‡ºï¼Œå¯èƒ½æ˜¯ï¼š</li>
<li>
<ul>
<li>ç»™ç”¨æˆ·çš„æ–‡æœ¬å›ç­”</li>
<li>å·¥å…·è°ƒç”¨è¯·æ±‚ï¼ˆè¦ç”¨å“ªä¸ªå·¥å…·ã€å‚æ•°æ˜¯ä»€ä¹ˆï¼‰ -ï¼ˆéƒ¨åˆ†æ¨¡å‹æ”¯æŒï¼‰æ¨ç†ç—•è¿¹</li>
</ul>
</li>
</ul>
<p>å¯¹è¯å†å²ä¼šè¶Šç§¯è¶Šå¤šï¼Œå› æ­¤é€šå¸¸éœ€è¦ â€œå¯¹è¯ç®¡ç†â€ ç­–ç•¥æ¥é¿å…è¶…å‡ºä¸Šä¸‹æ–‡çª—å£ï¼ˆåé¢ä¼šæåˆ°å¸¸è§é—®é¢˜ï¼‰ã€‚</p>
<hr/>
<h2 data-id="heading-4">å·¥å…·æ‰§è¡Œå‘ç”Ÿäº†ä»€ä¹ˆï¼Ÿ</h2>
<p>å½“æ¨¡å‹è¯·æ±‚ç”¨å·¥å…·æ—¶ï¼Œæ‰§è¡Œç³»ç»Ÿä¸€èˆ¬ä¼šåšè¿™äº›äº‹ï¼š</p>
<ol>
<li>å¯¹å·¥å…·è¿›è¡Œï¼š<strong>æ ¡éªŒå‚æ•°</strong>ï¼Œä¸€èˆ¬å·¥å…·éµå¾ªå¦‚ä¸‹æ ¼å¼ï¼š</li>
</ol>

<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
Â  Â Â <span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span>Â <span class="hljs-string">"tool_use"</span><span class="hljs-punctuation">,</span>
Â  Â Â <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span>Â <span class="hljs-string">"toolu_01A09q90qw90lq917835123"</span><span class="hljs-punctuation">,</span>
Â  Â Â <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span>Â <span class="hljs-string">"my_function_name"</span><span class="hljs-punctuation">,</span>
Â  Â Â <span class="hljs-attr">"input"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
Â  Â  Â  Â Â <span class="hljs-attr">"query"</span><span class="hljs-punctuation">:</span>Â <span class="hljs-string">"Latest developments in quantum computing"</span>
Â  Â  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>2.  åœ¨å·¥å…·æ³¨å†Œè¡¨é‡Œæ‰¾åˆ°å¯¹åº”å·¥å…·
3.  <strong>æ‰§è¡Œå·¥å…·</strong>ï¼Œå¹¶åšå¥½é”™è¯¯å¤„ç†
4.  æŠŠæˆåŠŸç»“æœæˆ–å¤±è´¥ä¿¡æ¯ï¼Œç»Ÿä¸€å°è£…æˆ â€œå·¥å…·ç»“æœæ¶ˆæ¯â€ å›ä¼ ç»™æ¨¡å‹</p>
<p>é‡ç‚¹ï¼š<strong>å·¥å…·å¤±è´¥ä¸ä¼šç›´æ¥è®©å¾ªç¯å´©æ‰</strong>ï¼Œè€Œæ˜¯æŠŠé”™è¯¯è¿”å›ç»™æ¨¡å‹ï¼Œè®©å®ƒæœ‰æœºä¼šè°ƒæ•´ç­–ç•¥ã€æ¢å·¥å…·æˆ–é‡è¯•ã€‚</p>
<hr/>
<h2 data-id="heading-5">ä»€ä¹ˆæ—¶å€™ç»“æŸå¾ªç¯ï¼Ÿï¼ˆStop Reasonsï¼‰</h2>
<p>æ¯æ¬¡è°ƒç”¨æ¨¡å‹éƒ½ä¼šå¸¦ä¸€ä¸ª â€œåœæ­¢åŸå› â€ï¼Œå†³å®š Loop ä¸‹ä¸€æ­¥æ€ä¹ˆèµ°ï¼Œå¸¸è§åŒ…æ‹¬ï¼š</p>
<ul>
<li><strong>end turn</strong>ï¼šæ¨¡å‹å·²å®Œæˆ â†’ æ­£å¸¸ç»“æŸå¹¶è¿”å›æœ€ç»ˆç­”æ¡ˆ</li>
<li><strong>tool use</strong>ï¼šæ¨¡å‹è¦ç”¨å·¥å…· â†’ æ‰§è¡Œå·¥å…·åç»§ç»­ä¸‹ä¸€è½®</li>
<li><strong>max tokens</strong>ï¼šè¾“å‡ºè¢« token ä¸Šé™æˆªæ–­ â†’ é€šå¸¸ä¸å¯æ¢å¤ï¼Œéœ€è¦æŠ¥é”™æˆ–æ‹†åˆ†ä»»åŠ¡</li>
<li><strong>stop sequence</strong>ï¼šé‡åˆ°é¢„è®¾åœæ­¢ç¬¦ â†’ æ­£å¸¸ç»“æŸ</li>
<li><strong>content filtered / guardrail intervention</strong>ï¼šè§¦å‘å®‰å…¨/ç­–ç•¥æ‹¦æˆª â†’ æŒ‰äº§å“è§„åˆ™å¤„ç†</li>
</ul>
<hr/>
<h2 data-id="heading-6">å¸¸è§å‘ä¸è§£å†³æ€è·¯</h2>
<h3 data-id="heading-7">1ï¼‰ä¸Šä¸‹æ–‡çª—å£è€—å°½</h3>
<p>å¾ªç¯æ¬¡æ•°å¤šã€å·¥å…·è¾“å‡ºé•¿ï¼Œä¼šæŠŠå¯¹è¯å†å²æ’‘çˆ†ï¼Œå¯¼è‡´è¾“å…¥è¿‡é•¿æˆ–æ¨¡å‹è¡¨ç°å˜å·®ã€‚</p>
<p>åº”å¯¹æ–¹æ³•ï¼š</p>
<ul>
<li>è®©å·¥å…·è¿”å›<strong>æ‘˜è¦/å…³é”®ç‰‡æ®µ</strong>ï¼Œä¸è¦ä¸€è‚¡è„‘è¿”å›å…¨é‡</li>
<li>ç®€åŒ–å·¥å…· schemaï¼ˆå¤æ‚åµŒå¥—ä¹Ÿå¾ˆåƒ tokenï¼‰</li>
<li>ç”¨å¯¹è¯ç®¡ç†ç­–ç•¥ï¼šæ»‘åŠ¨çª—å£ã€æ€»ç»“å‹ç¼©ç­‰</li>
<li>æŠŠå¤§ä»»åŠ¡<strong>æ‹†æˆå¤šä¸ªå­ä»»åŠ¡</strong>ï¼Œåˆ†æ®µè·‘ã€åˆ†æ®µæ€»ç»“</li>
</ul>
<h3 data-id="heading-8">2ï¼‰æ¨¡å‹è€é€‰é”™å·¥å…·</h3>
<p>é€šå¸¸æ˜¯å·¥å…·æè¿°ä¸æ¸…æˆ–é‡å ï¼Œæ¨¡å‹ä¸çŸ¥é“æ€ä¹ˆé€‰ã€‚</p>
<p>åº”å¯¹æ–¹æ³•ï¼š</p>
<ul>
<li>å†™æ¸…æ¥šå·¥å…· â€œé€‚ç”¨åœºæ™¯ã€è¾“å…¥è¾“å‡ºã€è¾¹ç•Œâ€</li>
<li>é¿å…å¤šä¸ªå·¥å…·æè¿°é«˜åº¦ç›¸ä¼¼</li>
</ul>
<h3 data-id="heading-9">3ï¼‰MaxTokensReachedï¼ˆè¾“å‡ºå¤ªé•¿ï¼‰</h3>
<p>å¯èƒ½æ˜¯å›ç­”å¤ªé•¿ã€æˆ–ä¸Šä¸‹æ–‡å¤ªæ»¡å¯¼è‡´ç•™ç»™è¾“å‡ºçš„ç©ºé—´ä¸å¤Ÿã€‚</p>
<p>åº”å¯¹æ–¹æ³•ï¼š</p>
<ul>
<li>å¢åŠ  token ä¸Šé™ï¼ˆå¦‚æœå¯æ§ï¼‰</li>
<li>ç¼©çŸ­ä¸Šä¸‹æ–‡/å·¥å…·è¾“å‡º</li>
<li>æ‹†åˆ†ä»»åŠ¡ä¸ºå­ä»»åŠ¡ï¼Œè®©å­ä»»åŠ¡æ‰§è¡Œå‡å°‘ä¸Šä¸‹æ–‡çª—å£</li>
</ul>
<h3 data-id="heading-10">4ï¼‰å¤æ‚çš„ä»»åŠ¡ä¸è¦å…¨éƒ¨ä¾èµ–å¤§æ¨¡å‹å†³ç­–</h3>
<p>å¯ä»¥å‚è€ƒè¿™ç¯‡æ–‡ç« ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FZhc-GDTJSQy69goSDRkfEQ" target="_blank" title="https://mp.weixin.qq.com/s/Zhc-GDTJSQy69goSDRkfEQ" ref="nofollow noopener noreferrer">mp.weixin.qq.com/s/Zhc-GDTJSâ€¦</a> ï¼Œè®²çš„æ˜¯ä¸ºä»€ä¹ˆå¤§æ¨¡å‹ä¸èƒ½å‡†ç¡®æ‰§è¡Œæ‰€æœ‰çš„ skills (è¿™é‡Œå…¶å®å°±æ˜¯å¯¹åº”å·¥å…·)ï¼Œä¸»è¦åŸå› å¦‚ä¸‹ï¼š</p>
<ul>
<li>å·¥å…·å¤ªå¤šï¼Œä¼šé€ æˆå™ªå£°ï¼Œå¤§æ¨¡å‹è‡ªä¸»å†³ç­–ä¸ä¸€å®šèƒ½æŒ‰ç…§ä½ æƒ³è¦çš„æ–¹å¼è°ƒç”¨å·¥å…·é“¾ï¼›</li>
<li>æ²¡æœ‰å†³ç­–ç‚¹ï¼Œå¤§æ¨¡å‹ä¼šæ‰¾åˆ°æœ€ç›¸è¿‘çš„å·¥å…·ï¼Œä½†æ˜¯æœ‰äº›æ—¶å€™ç›¸è¿‘çš„å·¥å…·ä¸ä¸€å®šæ˜¯æœ€ä½³å·¥å…·ï¼›</li>
<li>æ²¡æœ‰æ’åºï¼Œå¤§æ¨¡å‹è‡ªå·±å†³ç­–ï¼šA -&gt; B -&gt; Cï¼Œä½†æ˜¯ä¸ä¸€å®šç¬¦åˆä½ è°ƒç”¨çš„è¦æ±‚ï¼›</li>
</ul>
<p><strong>é‚£è¯¥æ€ä¹ˆåšï¼Ÿ</strong></p>
<ul>
<li>åœ¨æç¤ºè¯æˆ–è€… rules.md ä¸­å¢åŠ ä½ å½“å‰ä»»åŠ¡å¤§æ¦‚éœ€è¦ç”¨åˆ°å“ªäº›å·¥å…·ï¼Œæˆ–è€…å¼ºåˆ¶ä½¿ç”¨å“ªäº›å·¥å…·ï¼›</li>
<li>æŒ‡å‡ºå…·ä½“ä»»åŠ¡è°ƒç”¨çš„å·¥å…·é¡ºåºå¯èƒ½æ˜¯æ€ä¹ˆæ ·çš„ï¼Ÿè™½ç„¶çœ‹èµ·æ¥åƒäººå·¥å†³ç­–ï¼Œä½†æ˜¯å¾€å¾€èƒ½æœ‰æ•ˆçš„è§£å†³ä½ æƒ³è¦è§£å†³çš„é—®é¢˜ï¼›</li>
</ul>
<hr/>
<h2 data-id="heading-11">å‚è€ƒ</h2>
<p>ï¼ˆ1ï¼‰<a href="https://link.juejin.cn?target=https%3A%2F%2Fstrandsagents.com%2Flatest%2Fdocumentation%2Fdocs%2Fuser-guide%2Fconcepts%2Fagents%2Fagent-loop%2F" target="_blank" title="https://strandsagents.com/latest/documentation/docs/user-guide/concepts/agents/agent-loop/" ref="nofollow noopener noreferrer">strandsagents.com/latest/docuâ€¦</a><br/>
ï¼ˆ2ï¼‰<a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FZhc-GDTJSQy69goSDRkfEQ" target="_blank" title="https://mp.weixin.qq.com/s/Zhc-GDTJSQy69goSDRkfEQ" ref="nofollow noopener noreferrer">mp.weixin.qq.com/s/Zhc-GDTJSâ€¦</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[30å²æŠ€æœ¯äººå¯¹èŒä¸šå’Œç”Ÿæ´»çš„æ€è€ƒ]]></title>    <link>https://juejin.cn/post/7603688142005256201</link>    <guid>https://juejin.cn/post/7603688142005256201</guid>    <pubDate>2026-02-08T10:43:15.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7603688142005256201" data-draft-id="7603771025855152179" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="30å²æŠ€æœ¯äººå¯¹èŒä¸šå’Œç”Ÿæ´»çš„æ€è€ƒ"/> <meta itemprop="keywords" content="å¹´ç»ˆæ€»ç»“,å‰ç«¯,åç«¯"/> <meta itemprop="datePublished" content="2026-02-08T10:43:15.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å…ƒå…®"/> <meta itemprop="url" content="https://juejin.cn/user/1433418891795806"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            30å²æŠ€æœ¯äººå¯¹èŒä¸šå’Œç”Ÿæ´»çš„æ€è€ƒ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1433418891795806/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å…ƒå…®
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-08T10:43:15.000Z" title="Sun Feb 08 2026 10:43:15 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»8åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#383838;font-size:15px;line-height:30px;letter-spacing:2px;word-break:break-word;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Open Sans,Helvetica Neue,sans-serif;scroll-behavior:smooth;background-image:linear-gradient(0deg,transparent 24%,rgba(201,195,195,.329) 25%,hsla(0,8%,80.4%,.05) 26%,transparent 27%,transparent 74%,hsla(0,5.2%,81%,.185) 75%,rgba(180,176,176,.05) 76%,transparent 77%,transparent),linear-gradient(90deg,transparent 24%,rgba(204,196,196,.226) 25%,hsla(0,4%,66.1%,.05) 26%,transparent 27%,transparent 74%,hsla(0,5.2%,81%,.185) 75%,rgba(180,176,176,.05) 76%,transparent 77%,transparent);background-color:#fff;background-size:50px 50px;padding-bottom:60px}.markdown-body ::selection{color:#fff;background-color:#a862ea}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{margin:24px 0 12px;color:#a862ea}.markdown-body h1{line-height:2;font-size:1.4em}.markdown-body h1~p:first-of-type:first-letter{color:#a862ea;float:left;font-size:2em;margin-right:.4em;font-weight:bolder}.markdown-body h2{font-size:1.2em}.markdown-body h3{font-size:1.1em}.markdown-body ol,.markdown-body ul{padding-left:2em}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;padding-left:.2em}.markdown-body ol li::marker,.markdown-body ul li::marker{color:#a862ea}.markdown-body ol li.task-list-item,.markdown-body ul li.task-list-item{list-style:none}.markdown-body ol li.task-list-item ol,.markdown-body ol li.task-list-item ul,.markdown-body ul li.task-list-item ol,.markdown-body ul li.task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:10px}.markdown-body a,.markdown-body code,.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6,.markdown-body li,.markdown-body p{opacity:.85;vertical-align:baseline;transition:all .1s ease}.markdown-body a:hover,.markdown-body code:hover,.markdown-body h1:hover,.markdown-body h2:hover,.markdown-body h3:hover,.markdown-body h4:hover,.markdown-body h5:hover,.markdown-body h6:hover,.markdown-body li:hover,.markdown-body p:hover{opacity:1}.markdown-body a{display:inline-block;color:#a862ea;cursor:pointer;text-decoration:none;position:relative}.markdown-body a:after{content:"";position:absolute;width:98%;height:1px;bottom:0;left:0;transform:scaleX(0);background-color:#a862ea;transform-origin:bottom right;transition:transform .3s ease-in-out}.markdown-body a:hover:after{transform:scaleX(1);transform-origin:bottom left}.markdown-body a:active,.markdown-body a:link{color:#a862ea}.markdown-body img{max-width:100%;user-select:none;margin:1em 0;transition:transform .2s ease 0s;background-color:#f8f5ff;box-shadow:0 0 10px #e7daff}.markdown-body img:hover{opacity:1;box-shadow:0 0 20px #e7daff;transform:translateY(-1px)}.markdown-body blockquote{padding:.5em 1em;margin:12px 0;border-top-left-radius:2px;border-bottom-left-radius:2px;border-left:3px solid #a862ea;background-color:#f8f5ff}.markdown-body blockquote&gt;p{margin:0}.markdown-body .math{font-style:italic;margin:12px 0;padding:.5em 1em;background-color:#f8f5ff}.markdown-body .math&gt;p{margin:0}.markdown-body code{padding:2px .4em;overflow-x:auto;color:#a862ea;font-weight:700;word-break:break-word;font-family:Operator Mono,Consolas,Monaco,Menlo,monospace;background-color:#f8f5ff}.markdown-body pre{margin:2em 0}.markdown-body pre&gt;code{display:block;padding:1.5em;word-break:normal;font-size:.9em;font-style:normal;font-weight:400;font-family:Operator Mono,Consolas,Monaco,Menlo,monospace;line-height:18px;color:#383838;border-radius:2px;scroll-behavior:smooth;box-shadow:0 0 10px #e7daff}.markdown-body pre&gt;code:hover{box-shadow:0 0 20px #e7daff}.markdown-body pre&gt;code::-webkit-scrollbar{height:6px;background-color:#f8f5ff}.markdown-body pre&gt;code::-webkit-scrollbar-thumb{background-color:#e7daff;border-bottom-left-radius:3px;border-bottom-right-radius:3px}.markdown-body hr{margin:2em 0;border-top:1px solid #a862ea}.markdown-body table{width:100%;font-size:12px;max-width:100%;overflow:auto;border-collapse:collapse}.markdown-body thead{color:#a862ea;background:#f8f5ff}.markdown-body td,.markdown-body th{padding:.5em;border:1px solid #e7daff}.markdown-body tr{background-color:#f8f5ff}@media (max-width:720px){.markdown-body{font-size:12px}}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>æŒ‰ç…§å¾€å¹´çš„ä¹ æƒ¯ï¼Œ2025å¹´çš„å¹´åº¦æ€è€ƒåº”è¯¥æ—©å†™å®Œäº†ï¼Œå¯èƒ½æ˜¯ç”±äºå…³é”®è¯å¤ªå¤šï¼ŸåŠ ç­å¤ªå¤šæ²¡ç©ºï¼Ÿæ‰¾ä¸åˆ°è½ç¬”å¤„ä¸çŸ¥ä»ä½•è¯´èµ·ï¼Ÿæˆ‘æƒ³æˆ–å¤šæˆ–å°‘ç¦»ä¸å¼€è¿™äº›å› ç´ ã€‚</p>
<p>æ€»çš„æ¥è¯´ï¼Œç»„ç»‡å˜åŠ¨ï¼ˆè£å‘˜ï¼‰ã€äºŒæ¬¡æ·±æ¼‚ã€996å¸¸æ€ã€æ‹¥æŠ±AIã€æ¶¨è–ªæˆä¸ºäº†è¿‘ä¸€å¹´çš„å…³é”®è¯ï¼Œæœ‰é—æ†¾ï¼Œä¹Ÿæœ‰æƒŠå–œã€‚</p>
<h2 data-id="heading-0">è£å‘˜</h2>
<p>ä¸ŠåŠå¹´æˆ‘ä¸»è¦åœ¨å…¬å…±æ”¯æ’‘ç»„åšGoæœåŠ¡ç«¯å¼€å‘ï¼Œåšç®—æ³•æ•ˆæœçš„æ¥å£æ”¯æŒï¼Œä¹Ÿå°±æ˜¯åŸºäºç¾å›¾çš„ç®—æ³•æœåŠ¡ï¼Œå°è£…ä¸€å±‚ä¸­é—´å±‚ç»™ä¸šåŠ¡è°ƒç”¨ã€‚æœŸé—´ä¹Ÿè´Ÿè´£æ•ˆæœæ–¹é¢çš„æœåŠ¡è¿ç§»ï¼ŒåŒ…æ‹¬æ•°æ®è¿ç§»ï¼ˆMySQL -&gt; MongoDBï¼‰ã€æ¥å£æµé‡è½¬å‘ï¼Œæ¶‰åŠæœ€å¤šçš„æ•°æ®è¾¾åˆ°å‡ ä¸ªäº¿ï¼Œè¿˜æ˜¯å­˜åœ¨ä¸€ä¸ªDBä¸€ä¸ªè¡¨ä¸­ï¼Œå½“æ—¶è¿ç§»æ•°æ®éƒ½èŠ±äº†ä¸€å‘¨çš„æ—¶é—´ã€‚</p>
<blockquote>
<p>è¿™æ—¶å€™æœ‰äººä¼šé—®ï¼šå‡ ä¸ªäº¿çš„æ•°æ®ä¸è¿›è¡Œåˆ†è¡¨åˆ†åº“ï¼Ÿæ²¡é”™ï¼ŒåŸå› æœ‰ä¸¤ä¸ªï¼šæœ¬èº«é€»è¾‘æœ‰é—®é¢˜ï¼Œä¸€ä¸ªç”¨æˆ·åªéœ€è¦ç”Ÿæˆä¸€ä¸ªç‰ˆæœ¬è®°å½•å³å¯ï¼Œä½†å®é™…ä¸Šç”Ÿæˆäº†å¤šä¸ªï¼ˆå‡çº§å¤šæ¬¡APPç‰ˆæœ¬ï¼‰ã€‚
å¦å¤–åŠ ä¸Šé¢‘ç¹çš„äººå‘˜ã€ç»„ç»‡å˜åŠ¨ï¼Œä¼°è®¡å½“æ—¶å†™è¿™ä¸ªé€»è¾‘çš„äººéƒ½ä¸åœ¨äº†ï¼Œæ‰€ä»¥æ²¡äººçŸ¥é“è¿™ä¸ªè¡¨æ•°æ®é‡ä¸€ç›´åœ¨çŒ›å¢ï¼Œæ›´åˆ«è¯´åˆ†åº“åˆ†è¡¨äº†ã€‚</p>
</blockquote>
<p>è¯´åˆ°è¿™ä¸ªæ•°æ®ã€æœåŠ¡è¿ç§»ï¼Œä¹‹å‰æ²¡æœ‰åšè¿‡MySQL-&gt;MongoDBæ•°æ®è¿ç§»å®è·µï¼Œå¹¶ä¸”è¡Œä¸šçš„æ–¹æ¡ˆä¹Ÿæ¯”è¾ƒå°‘ï¼Œå…¬å¸çš„æ•°æ®ä¹Ÿä¸å…è®¸ç”¨ç¬¬ä¸‰æ–¹çš„è¿ç§»å¹³å°ï¼ŒæœŸé—´å¿ƒæ™ºè´Ÿæ‹…è¿˜æ˜¯è›®å¤§çš„ã€‚æœ€åæ˜¯é€šè¿‡è‡ªå·±å†™è„šæœ¬æ¥å®ç°çš„ï¼Œå®æ—¶æ€§å’Œå‡†ç¡®æ€§éƒ½å¾—åˆ°äº†ä¿è¯ã€‚</p>
<p>è¿ç§»å®Œæ²¡å‡ å¤©å°±è¿æ¥äº†ç»„ç»‡æ¶æ„è°ƒæ•´ï¼Œæ•´ä¸ªæµ·å¤–éƒ¨é—¨éƒ½éœ€è¦åˆå¹¶åˆ°æ€»éƒ¨ï¼Œå‘ä½ä¸å¤Ÿæ€ä¹ˆåŠï¼Ÿè´¢æºï¼ˆè£å‘˜ï¼‰å¹¿è¿›å˜›ï¼ï¼ï¼</p>
<p>æœŸé—´å¤§å®¶éƒ½æ²¡åº•ã€å†…å¿ƒå¿å¿‘ï¼Œä¸çŸ¥é“æ¯”ä¾‹ï¼Œèº«è¾¹çš„åŒäº‹åšå¥½äº†é‡æ–°å‡ºå»é¢è¯•çš„å‡†å¤‡ã€‚æœ€åæ˜¯æˆ‘ä»¬ç»„çš„åŸºæœ¬éƒ½ç•™äº†ä¸‹æ¥ï¼Œä½†ä¸å°‘è®¤è¯†çš„å°ä¼™ä¼´éƒ½æ”¶åˆ°äº†é€šçŸ¥ï¼Œæœ‰ä¸ªå…³ç³»æ¯”è¾ƒå¥½çš„ï¼Œä¼šå†™Nestå’ŒGoï¼Œæœ€åä¹Ÿæ‰¾åˆ°äº†ä¸é”™çš„å·¥ä½œï¼Œbaseä¹Ÿæ¶¨äº†ï¼Œæ‰€ä»¥è¿™å¹´å¤´å¤šç‚¹æŠ€èƒ½å°±æ˜¯æ¯”è¾ƒæŠ—æ‰“ã€‚</p>
<p>æ®ç»Ÿè®¡ï¼Œæˆ‘ä»¬å…¬å¸åªä¼šå‰ç«¯æˆ–è€…åç«¯çš„å¼€å‘å¾ˆå°‘ï¼ŒåŸºæœ¬ä¸Šéƒ½æ˜¯ä¼šå¥½å‡ é—¨æŠ€æœ¯æ ˆçš„ï¼Œæœ‰äº›å¤¸å¼ çš„å…­è¾¹å½¢æˆ˜å£«ï¼Œä¼š6ã€7ä¸ªæŠ€æœ¯æ ˆï¼Œç„¶åä»–ä»¬çš„ç¨³å®šæ€§ä¹Ÿå¾ˆé«˜ã€‚</p>
<h2 data-id="heading-1">äºŒæ¬¡æ·±æ¼‚ä¸996</h2>
<p>ç¬¬ä¸€æ¬¡æ·±æ¼‚åº”è¯¥æ˜¯æˆ‘2014å¹´ä¸­è€ƒæ¯•ä¸šçš„æ—¶å€™ï¼Œå½“æ—¶è¿›çš„æ˜¯å·¥å‚ï¼Œå¹²çš„æ˜¯æµæ°´çº¿ï¼Œè®¡ä»¶çš„ï¼Œä¸€ä¸ªæœˆ3000ã€‚è¢«å‹æ¦¨çš„40å¤©ä¸­ï¼Œæœ‰25å¤©éƒ½æ˜¯ä¸Šå¤œç­ï¼Œç™½å¤©æ—©ä¸Šä¸‹ç­ä¹‹åï¼Œåƒå®Œä¸€ç¢—ç±³ç²‰å°±ç¡è§‰ä¸‹åˆäº”å…­ç‚¹ï¼Œèµ·æ¥å†åƒå®Œé¥­åˆç»§ç»­ä¸Šå¤œç­ï¼Œå°±è¿™æ ·åšæŒäº†å¿«ä¸€ä¸ªæœˆï¼Œæœ€åæ‹¿ç€4000å—å»ä¸Šäº†å¤§å­¦ã€‚</p>
<p>ç¬¬äºŒæ¬¡å°±æ˜¯2024å¹´æ¥äº†æ·±åœ³çš„offeråï¼Œç»è¿‡ä¸€å¹´çš„äº§å“æ´—ç‰Œï¼Œäººå‘˜æµåŠ¨è¶‹äºç›¸å¯¹ç¨³å®šçš„çŠ¶æ€ï¼Œä¸ä¼šæœ‰å¤ªå¤§çš„æ¶æ„å˜åŠ¨ï¼Œæ— éæ˜¯ç«‹é¡¹å¤šä¸€ä¸ªæ–°çš„AIé¡¹ç›®ï¼Œç„¶åæŠŠå½“å‰é¡¹ç›®ç»„çš„äººå‘˜all inè¿›å»ï¼Œåˆ›æ–°å°±æ˜¯å¦‚æ­¤ï¼</p>
<p>è½¬çœ¼é—´ç”œç­’ä¹Ÿå¿«ä¸‰å²äº†ï¼Œä»–çš„æˆ·å£åœ¨å—å±±ï¼Œä»¥åä¸Šå­¦ä¹Ÿæ˜¯åœ¨å—å±±ã€‚2å¹´å‰æˆ‘ä»¬ä»å¹¿å·æ¬åˆ°ä½›å±±æ–°å®¶ï¼Œæˆ‘ä»¥ä¸ºé‚£å°†ä¼šæ˜¯æœ€åä¸€æ¬¡ï¼Œæœ‰è‡ªå·±çš„çªä»¥åä¸ç”¨æŠ˜è…¾äº†ï¼Œä½†äº‹å®æ˜¯ä»é‚£ä¹‹åæˆ‘å‡ ä¹æ˜¯ä¸€å¹´ä¸€æ¢ï¼Œè¿‡å‡ ä¸ªæœˆåˆè¦æ¬äº†ï¼Œä½†å€¼å¾—è¯´çš„æ˜¯ä¸€æ¬¡æ¯”ä¸€æ¬¡ä½çš„ç¯å¢ƒå¥½ï¼Œè¿™æˆ–è®¸æ˜¯å˜åŒ–å¸¦æ¥çš„ç¦éŸ³å§ï¼</p>
<p>è®¡åˆ’èµ¶ä¸ä¸Šå˜åŒ–ï¼Œå…¶å®æ˜¯ç”Ÿæ´»æœ€åŸæœ¬çš„æ¨¡æ ·ï¼åé¢æˆ‘å»äº†æ–°çš„é¡¹ç›®ç»„ï¼Œä¸»è¦æ˜¯åšAgentä¿®å›¾çš„ï¼Œæˆ‘ä¸€ä¸ªæœåŠ¡ç«¯åŠ ä¸Šå…­ä¸ªå®¢æˆ·ç«¯ï¼Œ996æ˜¯æ—¥å¸¸åº•è‰²ï¼Œä¸¤ä¸ªå¤šæœˆæŠŠiOSèµ¶å‡ºæ¥ï¼Œè¿™å¾—ç›ŠäºAI Codingçš„å¨åŠ›ã€‚å¤šä¸ªæ—¶å€™æˆ‘ä¸€å¤©éƒ½coveräº†å‡ ä¸ªéœ€æ±‚ï¼ŒåŠå¹´ä¸‹æ¥å¹²äº†æœ‰70+éœ€æ±‚ï¼Œå½“ç„¶è¿™å¹¶ä¸å€¼å¾—æ­Œé¢‚ï¼Œæˆ‘ä»¬åœ¨å¾—åˆ°ç›¸å¯¹å¥½ç»©æ•ˆåŒæ—¶ï¼Œä¹Ÿå¿…ç„¶æ„å‘³ç€ä¼šèˆå¼ƒäº›é™ªä¼´å®¶äººçš„æ—¶é—´ã€èº«ä½“çš„é€æ”¯ï¼Œè¿™ä¾¿æ˜¯Work Life Balanceçš„çŸ›ç›¾ï¼Œä¸€ä¸ªè¾©è¯çš„è¿‡ç¨‹ï¼Œæ— è®ºæˆ‘ä»¬å¦‚ä½•é€‰æ‹©ï¼ŒçŸ›ç›¾å¹¶ä¸ä¼šæ¶ˆå¤±ï¼Œå®ƒå¿…å°†è½¬åŒ–æˆ–å‡çº§ä¸ºå¦ä¸€ä¸ªçŸ›ç›¾ï¼Œç­‰ç€æˆ‘ä»¬å†æ¬¡æŠ‰æ‹©ã€‚</p>
<blockquote>
<p>é‚£è¾¾åˆ°Work Life Balanceçš„å”¯ä¸€è§£æ˜¯ä»€ä¹ˆ? æˆ‘æƒ³åº”è¯¥æ˜¯åœ¨å½“å‰å¹³è¡¡è¢«æ‰“ç ´æ—¶ï¼Œä¾¿éœ€è¦åœ¨æ›´é«˜çš„æ°´å¹³ä¸Šé‡å¡‘æ–°çš„å¹³è¡¡ï¼Œä»¥æ›´å¥½çš„å¿ƒæ€ã€çŠ¶æ€å’Œè®¤çŸ¥ç»´æŒå®ƒã€‚</p>
</blockquote>
<h2 data-id="heading-2">AIå¸¦æ¥çš„ç„¦è™‘</h2>
<p>æœ€è¿‘ç½‘ä¸Šæœ‰ä¸ªåç§°ç«äº†ï¼Œå«<code>FOMO</code>ï¼Œæ„ä¸º<code>é”™å¤±ææƒ§ç—‡</code>ï¼Œå®ƒå½¢å®¹ç”±äºæ‹…å¿ƒé”™è¿‡ä»–äººæ­£åœ¨ä½“éªŒçš„æœ‰è¶£äº‹ç‰©ã€ç¤¾äº¤æ´»åŠ¨æˆ–æŠ•èµ„æœºä¼šï¼Œè€Œäº§ç”Ÿçš„ä¸€ç§æŒç»­æ€§ç„¦è™‘å’Œä¸å®‰æ„Ÿã€‚</p>
<p>è¿™ç§å¿ƒç†åå·®é€šå¸¸ä¼šå¯¼è‡´<code>éç†æ€§</code>çš„å†³ç­–ï¼Œå¸¸è§çš„å°±æ˜¯å»ä¹°å„ç§AIç¼–ç¨‹è¯¾ç¨‹ã€Agentå¼€å‘æ•™ç¨‹ã€æŠ¥åAIçŸ¥è¯†ç›¸å…³çš„åŸ¹è®­ï¼ŒçŸ¥è¯†ä»˜è´¹æ²¡æœ‰é”™ï¼ŒåŸå› åœ¨äºæ‰§è¡ŒåŠ›ä¸æœŸå¾…çš„ToDo Listä¸åŒ¹é…ï¼Œæœ¬è´¨ä¸Šæ˜¯æ­£åé¦ˆç¼ºå¤±ã€‚æ‰€ä»¥ï¼Œæ²‰æµ¸äºè‡ªå·±å®Œæˆæ‰€æœ‰Todo Listçš„é‚£ç§å…´å¥‹æ˜¯è™šæ„çš„ï¼Œè€Œå®è·µä¸­é‚£ç§ç—›è‹¦ã€æ— åŠ©æ‰æ˜¯æˆ‘ä»¬æœ€çœŸå®çš„æ„Ÿå—ï¼Œæ¯å½“æˆ‘èŒç”Ÿå­¦äº†å°±ç­‰äºä¼šäº†çš„å¿µå¤´ï¼Œéƒ½ä¼šæƒ³åˆ°è¿™å¥è¯ã€‚</p>
<p>ç„¦è™‘æ˜¯æ­£å¸¸çš„ï¼Œä»£è¡¨ç€å½“ä¸‹æˆ‘ä»¬çš„çŠ¶æ€ä¸é¢„æœŸå­˜åœ¨å·®å¼‚ï¼Œå¹¶ä¸”åœ¨ä¸€å®šæ—¶é—´å†…æ— æ³•è¾¾åˆ°é¢„æœŸï¼Œä½œä¸ºäººä½“å†…åœ¨çš„ä¸€ç§æœºåˆ¶ï¼Œè¿™æ˜¯å®é™…ä¸Šåœ¨æˆ‘æœ€å¿™çš„å‡ ä¸ªæœˆä¸­ï¼Œç½‘ä¸Šå„ç§æ¦‚å¿µå±‚å‡ºä¸ç©·ï¼Œå„å‚å•†LLMçš„ç‰ˆæœ¬è¿­ä»£æ—¥æ–°æœˆå¼‚ï¼Œä»€ä¹ˆMcpã€langChainã€langGraphã€æ‰‹æ“ai agentã€SDDã€Skillsã€Spec Kitã€Open Specã€Open Codeç­‰ç­‰ï¼Œæˆ‘ä¼šç„¦è™‘æ¯å¤©æ²¡æœ‰æ—¶é—´äº†è§£è¿™äº›æ–°çš„å˜åŒ–ï¼Œä½†å—é™äºæ¯å¤©å¸¦å®½æœ‰é™ï¼Œäº†è§£çš„ç¨‹åº¦æœ‰é™ï¼Œåªèƒ½å°†è‡ªèº«è°ƒæ•´ä¸ºä¸€ç§æ–°çš„çŠ¶æ€å¹¶ç»´æŒå…¶å¹³è¡¡ï¼Œè®©è‡ªå·±å¤„äºä¸€ç§<strong>é•¿æœŸä¹è§‚ã€çŸ­æœŸç—›è‹¦ã€å½“ä¸‹å¿«ä¹</strong>çš„èˆ’é€‚åŒºè¾¹ç¼˜ä¸­ï¼Œ<code>å¤ªç”¨åŠ›çš„äººåè€Œè·‘ä¸è¿œ</code>ã€‚</p>
<p>æœ€è¿‘ä¸å‡ºç‰ˆç¤¾çš„ç¼–è¾‘åœ¨èŠå¤©ï¼Œé—®æˆ‘æƒ³ä¸æƒ³å†å‡ºå¤šä¸€æœ¬ä¹¦ï¼Œå…³äºAIç¼–ç¨‹æ–¹é¢ï¼ˆæ‰£å­ï¼‰ï¼Œå®é™…ä¸Šç«™åœ¨æˆ‘çš„è§’åº¦è¿™æœ‰ç‚¹ä¸ºäº†å†™è€Œå†™ï¼Œå› ä¸ºæˆ‘åœ¨å·¥ä½œä¸­å¹¶ä¸ä¼šç”¨åˆ°è¿™ç©æ„ï¼Œå¹¶ä¸”ç²‰ä¸ç¾¤ä½“ä¹Ÿå¾ˆå°‘æœ‰è¿™æ–¹é¢éœ€æ±‚ï¼Œä½†å†™å‡ºæ¥ä¹‹ååˆä¸å¾—ä¸ä¸ºäº†é”€é‡è€Œè¿›è¡Œè¥é”€ï¼Œæˆ‘æƒ³è¿™æœ‰ç‚¹èƒŒç¦»æˆ‘å†™ä½œçš„æœ¬æ„ï¼Œä¹Ÿä¸æ˜¯çœŸæ­£çš„åˆ©ä»–ï¼ˆæˆ–è®¸ä¹Ÿæ˜¯åŸºäºæˆ‘å¯¹æ‰£å­ä¸å¤Ÿäº†è§£ï¼‰ã€‚å®é™…ä¸Šæ‡‚AI Codingï¼ŒAI Agentå¼€å‘å¯¹äºç›®å‰çš„å…¨æ ˆå¼€å‘æ¥è¯´æ›´èƒ½å¤Ÿæå‡ä¸ªäººä»·å€¼ï¼Œæˆ‘ä¹Ÿåœ¨<strong>ç€æ‰‹å‡†å¤‡å†™<code>AI Codingï¼ŒAI Agent</code>è¿™ä¸¤æ–¹é¢çš„åˆé›†</strong>ã€‚</p>
<h2 data-id="heading-3">æ¶¨è–ª</h2>
<p>è¿™æ®µæ—¶é—´ç»©æ•ˆé¢è°ˆå®Œæ”¶åˆ°æ¶¨è–ªçš„æ¶ˆæ¯ï¼Œæ¯”è¾ƒæ„å¤–ã€‚åŸæœ¬å¯¹äºå…¬å¸æ˜¯å¦æœ‰æ¶¨è–ªçš„åŠ¨ä½œæˆ‘æ˜¯ä¸æŠ±ä»»ä½•æœŸå¾…çš„ï¼Œå¯èƒ½æ˜¯å› ä¸ºæˆ‘ä¸Šä¸€å®¶ç»å¸¸è¿å·¥èµ„éƒ½å‘ä¸å‡ºï¼Œæ— å½¢ä¹‹ä¸­é™ä½äº†æˆ‘çš„é¢„æœŸï¼Œè¿™ç§ä½é¢„æœŸç®¡ç†å¸¦æ¥çš„ç»“æœå¾€å¾€æ˜¯æƒŠå–œè¾ƒå¤šï¼ˆèšŠå­è…¿ä¹Ÿæ˜¯è‚‰ï¼‰ã€‚</p>
<h2 data-id="heading-4">è§‰é†’</h2>
<p>å…³äºæˆé•¿ï¼Œé‡å¤è¯»äº†<code>ã€Šæ¯›é€‰ã€‹ã€ã€ŠçŸ›ç›¾è®ºã€‹</code>ï¼Œè§£å¼€äº†å¾ˆå¤šæˆ‘èŒåœºå’Œç”Ÿæ´»ä¸­çš„çƒ¦æ¼å’Œç–‘æƒ‘ï¼Œæ‰€ä»¥å¹³æ—¶æˆ‘éƒ½æ˜¯èººä¸‹å°±ç¡ï¼Œå¾ˆå°‘å› ä¸ºæŸä»¶äº‹æƒ…è€Œå¤±çœ ï¼›ä½†ä¹Ÿé—æ†¾æœ‰äº›äº‹æƒ…æ˜¯çŸ­æ—¶é—´å†…æ— æ³•è§£å†³çš„ï¼Œæ¯”å¦‚å°å®¶åº­ä¸å¤§å®¶åº­ä¹‹é—´çš„çŸ›ç›¾ï¼Œä½†æ€»éœ€è¦åœ¨åˆé€‚çš„æ—¶é—´æ‰“ç ´å½“å‰çš„å¹³è¡¡ï¼Œåˆ›é€ åˆé€‚çš„æ¡ä»¶ï¼Œè®©çŸ›ç›¾å¾€æœ‰åˆ©çš„æ–¹å‘å‘å±•ã€‚</p>
<p>å¦‚æœä½ æƒ³æé«˜è‡ªå·±çš„è®¤çŸ¥èƒ½åŠ›ï¼Œå¿˜è®°è¿‡å»çŠ¯è¿‡çš„é”™è¯¯æ˜¯åšå†³ä¸è¡Œçš„ã€‚æ–°è¯»äº†<code>ã€Šæ®µæ°¸å¹³æŠ•èµ„é—®ç­”å½•ã€‹</code>ï¼Œå›æƒ³è¿‡å»å‡ å¹´ä¸ç®¡æ˜¯èŒåœºè¿˜æ˜¯ç”Ÿæ´»ï¼Œæˆ‘éƒ½è¿èƒŒäº†<code>ä¸æ‡‚ä¸åš</code>å’Œ<code>ä¸marginï¼ˆæ æ†ï¼‰</code>çš„åŸåˆ™ï¼Œæ‰€ä»¥è®©æˆ‘çš„ç”Ÿæ´»å‡ºç°çš„æ¯”è¾ƒå¤§çš„èµ·ä¼ã€‚</p>
<p>å‰å‡ å¹´æˆ‘åœ¨æ²¡æœ‰åšä»»ä½•äº†è§£ä¹‹å‰è´¸ç„¶èƒŒä¸Šäº†æˆ¿è´·ï¼Œäº¤æ˜“å¤§å…åæ»¡äº†<code>æ‰˜</code>ï¼Œè¿™æ˜¯å¼€å‘å•†æ”¾çš„çƒŸé›¾å¼¹ï¼Œæˆ‘ä¸æ‡‚ï¼Œç°åœºå°±äº¤å®šé‡‘ã€‚è´·æ¬¾åˆ©ç‡<code>5.88%</code>ï¼Œæˆ‘æ²¡äº†è§£è¿™æ˜¯ä»€ä¹ˆæ°´å¹³å’Œæ¦‚å¿µï¼Œå•çº¯è®¤ä¸ºå‡ åƒå—çš„æœˆä¾›æˆ‘èƒ½å¤Ÿcoverã€‚</p>
<p><code>é¦–ä»˜è´·</code>ï¼Œæˆ‘ä¹Ÿä¸äº†è§£ï¼ŒåªçŸ¥é“æœ‰äººæ”¯ä»˜ç»™æˆ‘20wä»˜é¦–ä»˜ï¼Œ<code>10%</code>çš„åˆ©ç‡æ— æ‰€è°“ï¼Œå†ä¸Šæ æ†ï¼Œå¹²å°±å®Œäº†ï¼ä¸ºæ­¤ï¼Œæˆ‘èŠ±äº†ä¸€å¹´åŠæ—¶é—´æ‰è¿˜å®Œè¿™ä¸ªè®¤çŸ¥å€ºã€‚</p>
<p>è¡¥å……äº†<code>è´¢åŠ¡çŸ¥è¯†</code>ï¼Œå‰å‡ å¹´ç¦»èŒå»all inäº†å…¶ä»–è¡Œä¸šï¼Œç»å†äº†å¾ˆå¤šäº‹æƒ…ï¼Œçœ‹æ‡‚äººæ€§å†·æš–ï¼Œä¹Ÿé‡æ–°ç†è§£äº†ç†è´¢æ˜¯å¿…ä¸å¯å°‘çš„ã€‚å¦å¤–ï¼Œä¹Ÿç†è§£äº†å‘½è¿ï¼Œæˆ‘ä¸€ç”Ÿä¸­ï¼Œæ³¨å®šæ˜¯ä¸å¹³å‡¡çš„ã€‚</p>
<p>è¿‘åŠå¹´ä¸ºäº†ä¸<code>é‚ªæ¶çš„ç‰©ä¸š</code>åšæ–—äº‰ï¼Œäº¤æˆ¿3å¹´ï¼Œç®¡ç†æœåŠ¡ç¼ºå¤±ï¼Œè½¦ä½è¿Ÿè¿Ÿä¸äº¤ï¼Œæˆ‘æ‹’ç»ç¼´çº³ç‰©ä¸šè´¹ã€‚è¯»å®Œäº†<code>ã€Šç‰©ä¸šç®¡ç†æ¡ä¾‹ã€‹ã€ã€Šç‰©ä¸šçº çº·ä¸€ç«™å¼æ³•å¾‹æŒ‡å¼•ã€‹</code>ï¼Œæˆ‘æ—¶åˆ»éƒ½åœ¨å‡†å¤‡ç€ã€‚</p>
<h2 data-id="heading-5">æ€»ç»“ï¼šäººç”Ÿæ²¡æœ‰ä¸€æ­¥æ˜¯ç™½èµ°çš„</h2>
<p>äººç”Ÿä»æ¥ä¸æ˜¯ä¸€æ¡å¹³æ»‘å‘ä¸Šçš„ç›´çº¿ï¼Œè€Œæ˜¯åœ¨ä¸€æ¬¡æ¬¡å¹³è¡¡è¢«æ‰“ç ´åï¼Œé‡æ–°å»ºç«‹æ›´é«˜é˜¶çš„å¹³è¡¡ã€‚</p>
<p>æœ€åï¼Œè´´ä¸Šä¸€å¥æ•™å‘˜çš„ä¸‡èƒ½è§£å†³é—®é¢˜æ€è·¯ï¼š</p>
<blockquote>
<p>ä½ å¯¹äºé‚£ä¸ªé—®é¢˜ä¸èƒ½è§£å†³å—ï¼Ÿé‚£æœ«ï¼Œä½ å°±å»è°ƒæŸ¥é‚£ä¸ªé—®é¢˜çš„ç°çŠ¶å’Œå®ƒçš„å†å²å§ï¼ä½ å®Œå®Œå…¨å…¨è°ƒæŸ¥æ˜ç™½äº†ï¼Œä½ å¯¹é‚£ä¸ªé—®é¢˜å°±æœ‰è§£å†³çš„åŠæ³•äº†</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[è™šæ‹Ÿåˆ—è¡¨ï¼šæ”¯æŒâ€œå‘ä¸ŠåŠ è½½â€çš„å†å²æ¶ˆæ¯ï¼ˆVue 3 & React åŒç‰ˆæœ¬ï¼‰]]></title>    <link>https://juejin.cn/post/7603946518372515878</link>    <guid>https://juejin.cn/post/7603946518372515878</guid>    <pubDate>2026-02-08T11:00:11.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7603946518372515878" data-draft-id="7603946518372450342" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="è™šæ‹Ÿåˆ—è¡¨ï¼šæ”¯æŒâ€œå‘ä¸ŠåŠ è½½â€çš„å†å²æ¶ˆæ¯ï¼ˆVue 3 &amp; React åŒç‰ˆæœ¬ï¼‰"/> <meta itemprop="keywords" content="å‰ç«¯,é¢è¯•,JavaScript"/> <meta itemprop="datePublished" content="2026-02-08T11:00:11.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å‘ç°ä¸€åªå¤§å‘†ç“œ"/> <meta itemprop="url" content="https://juejin.cn/user/180747382561607"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            è™šæ‹Ÿåˆ—è¡¨ï¼šæ”¯æŒâ€œå‘ä¸ŠåŠ è½½â€çš„å†å²æ¶ˆæ¯ï¼ˆVue 3 &amp; React åŒç‰ˆæœ¬ï¼‰
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/180747382561607/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å‘ç°ä¸€åªå¤§å‘†ç“œ
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-08T11:00:11.000Z" title="Sun Feb 08 2026 11:00:11 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»11åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h3 data-id="heading-0">å‰è¨€</h3>
<p>åœ¨AIèŠå¤©äº§å“ä¸­ï¼Œå‘ä¸Šæ»šåŠ¨åŠ è½½å†å²æ¶ˆæ¯æ˜¯ä¸€ä¸ªç»å…¸åœºæ™¯ã€‚å¦‚æœç›´æ¥æ¸²æŸ“ä¸‡çº§èŠå¤©è®°å½•ï¼Œé¡µé¢å¿…å¡æ— ç–‘ã€‚è€Œä½¿ç”¨è™šæ‹Ÿåˆ—è¡¨æ—¶ï¼Œ<strong>å‘ä¸Šæ’å…¥æ•°æ®å¯¼è‡´çš„ä½ç½®åç§»</strong>æ˜¯æœ€å¤§çš„æŠ€æœ¯ç—›ç‚¹ã€‚æœ¬æ–‡å°†åˆ†äº«å¦‚ä½•å®ç°ä¸€ä¸ªæ”¯æŒâ€œæ»šåŠ¨ä½ç½®é”å®šâ€å’Œâ€œåŠ¨æ€é«˜åº¦è¡¥å¿â€çš„è™šæ‹Ÿåˆ—è¡¨æ–¹æ¡ˆã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/97bb245233ce41d89a9de7e4c60bd87e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y-R546w5LiA5Y-q5aSn5ZGG55Oc:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771153211&amp;x-signature=%2Bkaio29XJ8HeFLo6mXLCcFZ%2FA0Y%3D" alt="reactè™šæ‹Ÿåˆ—è¡¨å‘ä¸ŠåŠ è½½.gif" loading="lazy"/></p>
<h2 data-id="heading-1">ä¸€ã€ æ ¸å¿ƒå›°éš¾ç‚¹ï¼šä¸ºä»€ä¹ˆå‘ä¸ŠåŠ è½½è¿™ä¹ˆéš¾ï¼Ÿ</h2>
<ol>
<li><strong>æ»šåŠ¨ä½ç½®ä¸¢å¤±</strong>ï¼šå½“ä½ å‘æ•°ç»„å¤´éƒ¨æ’å…¥ 5 æ¡æ–°æ¶ˆæ¯æ—¶ï¼Œæ€»é«˜åº¦ä¼šå¢åŠ ã€‚å¦‚æœä¸å¤„ç†ï¼Œæµè§ˆå™¨ä¼šåœç•™åœ¨åŸæ¥çš„ <code>scrollTop</code>ï¼Œå¯¼è‡´ç”¨æˆ·çœ‹åˆ°çš„å†…å®¹è¢«â€œé¡¶èµ°â€ã€‚</li>
<li><strong>åŠ¨æ€é«˜åº¦è®¡ç®—</strong>ï¼šèŠå¤©å†…å®¹ï¼ˆå›¾ç‰‡ã€é•¿æ–‡æœ¬ï¼‰é«˜åº¦ä¸ä¸€ï¼Œå¿…é¡»åœ¨ DOM æ¸²æŸ“åé€šè¿‡ <code>ResizeObserver</code> å®æ—¶ä¿®æ­£ã€‚</li>
<li><strong>ç´¢å¼•åç§»</strong>ï¼šæ’å…¥æ•°æ®åï¼ŒåŸæ¥çš„ç´¢å¼•å…¨éƒ¨å¤±æ•ˆï¼Œå¿…é¡»ä¾èµ–â€œç´¯è®¡é«˜åº¦æ•°ç»„â€å’ŒäºŒåˆ†æŸ¥æ‰¾é‡æ–°å®šä½ã€‚</li>
</ol>
<hr/>
<h2 data-id="heading-2">äºŒã€ å®ç°æ€è·¯</h2>
<h4 data-id="heading-3">1ã€ç¬¬ä¸€æ­¥ï¼šæ­ä¸ªâ€œæˆå°å­â€ï¼ˆåŸºç¡€ç»“æ„ï¼‰</h4>
<p>æˆ‘ä»¬è¦æ­ä¸€ä¸ªä¸‰å±‚åµŒå¥—çš„æˆå°ï¼Œæ¯ä¸€å±‚éƒ½æœ‰å®ƒçš„â€œä½¿å‘½â€ï¼š</p>
<ol>
<li><strong>å¤–å±‚å¤§ç®¡å®¶</strong>ï¼šå›ºå®šå¥½é«˜åº¦ï¼Œåˆ«è®©åˆ—è¡¨æŠŠé¡µé¢æ’‘åäº†ã€‚</li>
<li><strong>â€œè™šèƒ–â€å ä½å±‚</strong>ï¼šè¿™æ˜¯ä¸ªç©ºç›’å­ï¼Œé«˜åº¦è®¾ä¸º <code>totalHeight</code>ã€‚å®ƒçš„å”¯ä¸€ä½œç”¨æ˜¯<strong>æ¬ºéª—æµè§ˆå™¨</strong>ï¼Œè®©æ»šåŠ¨æ¡ä»¥ä¸ºè¿™é‡Œæœ‰æˆåƒä¸Šä¸‡æ¡æ•°æ®ï¼Œä»è€Œäº§ç”ŸçœŸå®çš„æ»šåŠ¨æ„Ÿã€‚</li>
<li><strong>èˆå°ä¸­å¿ƒï¼ˆå¯è§†åŒºï¼‰</strong> ï¼šç»å¯¹å®šä½ã€‚å®ƒä¼šåƒç”µæ¢¯ä¸€æ ·ï¼Œè·Ÿç€ä½ çš„æ»šåŠ¨è·ç¦»é€šè¿‡ <code>translateY</code> çµæ´»ä½ç§»ï¼Œæ°¸è¿œä¿è¯è‡ªå·±å‡ºç°åœ¨è§‚ä¼—è§†çº¿å†…ã€‚</li>
</ol>
<h4 data-id="heading-4">2ã€ç¬¬äºŒæ­¥ï¼šå‡†å¤‡æ ¸å¿ƒæ•°æ®</h4>
<p>ä¸ºäº†è®©â€œæˆâ€ä¸æ¼”ç ¸ï¼Œæˆ‘ä»¬éœ€è¦æŒæ¡è¿™äº›æƒ…æŠ¥ï¼š</p>
<ul>
<li><strong>é¢„åˆ¤å€¼</strong>ï¼š<code>MIN_ITEM_HEIGHT</code>ï¼ˆå“ªæ€•ä¸çŸ¥é“å¤šé«˜ï¼Œä¹Ÿå¾—æœ‰ä¸ªä¿åº•å€¼ï¼‰å’Œ <code>BUFFER_SIZE</code>ï¼ˆå¤šæ¸²æŸ“å‡ è¡Œï¼Œåˆ«è®©ç”¨æˆ·ä¸€æ»‘å°±çœ‹åˆ°ç™½å±ï¼‰ã€‚</li>
<li><strong>é›·è¾¾ç«™</strong>ï¼š<code>LOAD_THRESHOLD</code>ï¼ˆè·ç¦»é¡¶éƒ¨è¿˜æœ‰å¤šè¿œæ—¶ï¼Œèµ¶ç´§å»åå°æ¬æ•‘å…µ/åŠ è½½æ•°æ®ï¼‰ã€‚</li>
<li><strong>è®°è´¦æœ¬</strong>ï¼šç”¨ä¸€ä¸ª <code>Map</code> è®°å½•æ¯ä¸ªæ¶ˆæ¯çš„çœŸå®é«˜åº¦ï¼Œå†æ•´ä¸€ä¸ª <code>cumulativeHeights</code>ï¼ˆç´¯è®¡é«˜åº¦æ•°ç»„ï¼‰ï¼Œè®°å½•æ¯ä¸€æ¡æ¶ˆæ¯è·ç¦»é¡¶éƒ¨çš„è·ç¦»ã€‚</li>
</ul>
<h4 data-id="heading-5">3ã€ç¬¬ä¸‰æ­¥ï¼šç´¢å¼•è®¡ç®—</h4>
<ul>
<li><strong>æ‰¾èµ·ç‚¹</strong>ï¼šç”¨<strong>äºŒåˆ†æŸ¥æ‰¾</strong>åœ¨â€œè®°è´¦æœ¬â€é‡Œæœä¸€ä¸‹ï¼Œçœ‹ç°åœ¨çš„æ»šåŠ¨ä½ç½®å¯¹åº”å“ªä¸€è¡Œçš„åœ°ç›˜ã€‚</li>
<li><strong>å®šç»ˆç‚¹</strong>ï¼šèµ·ç‚¹åŠ ä¸Šä½ èƒ½çœ‹åˆ°çš„è¡Œæ•°ï¼Œå†ç®—ä¸Šâ€œç¼“å†²åŒºâ€çš„å‡ ä½ï¼Œå°±æ˜¯è¿™ä¸€å¹•çš„ç»“æŸã€‚</li>
<li><strong>å®šä½ç½®</strong>ï¼šç®—å‡ºèµ·ç‚¹é¡¹å¯¹åº”çš„ç´¯è®¡é«˜åº¦ï¼ŒæŠŠèˆå°ä¸€æ¨ï¼ˆ<code>offsetY</code>ï¼‰ï¼Œæå®šï¼</li>
</ul>
<h4 data-id="heading-6">4ã€ç¬¬å››æ­¥ï¼šæ—¶é—´å›æº¯ï¼ˆå‘ä¸ŠåŠ è½½çš„æ ¸å¿ƒï¼æ ¸å¿ƒï¼ï¼‰</h4>
<p>è¿™æ˜¯å®ç°å‘ä¸ŠåŠ è½½æœ€éš¾çš„åœ°æ–¹ï¼šå¾€å¼€å¤´å¡äº†æ–°èƒ¶ç‰‡ï¼Œæ€ä¹ˆä¿è¯è§‚ä¼—çœ‹åˆ°çš„ç”»é¢ä¸è·³åŠ¨ï¼Ÿ</p>
<ol>
<li><strong>åšæ ‡è®°</strong>ï¼šè§¦å‘åŠ è½½å‰ï¼Œå…ˆæ­»æ­»è®°ä½ç°åœ¨çš„ <code>scrollHeight</code>ï¼ˆæ€»é«˜ï¼‰å’Œ <code>scrollTop</code>ï¼ˆè¿›åº¦ï¼‰ã€‚</li>
<li><strong>å¡æ•°æ®</strong>ï¼šæŠŠæ–°æ¶ˆæ¯â€œç °â€åœ°ä¸€ä¸‹æ’åˆ° <code>listData</code> çš„æœ€å‰é¢ã€‚</li>
<li><strong>ç¥æ“ä½œï¼ˆé«˜åº¦è¡¥å¿ï¼‰</strong> ï¼šæ•°æ®å¡è¿›å»åï¼Œæ€»é«˜åº¦è‚¯å®šå˜äº†ã€‚è¿™æ—¶å€™èµ¶ç´§ç®—ä¸€ä¸‹ï¼š<code>æ–°é«˜åº¦ - æ—§é«˜åº¦ = å¢åŠ çš„é«˜åº¦</code>ã€‚</li>
<li><strong>ç¬é—´å¹³ç§»</strong>ï¼šæŠŠæ»šåŠ¨æ¡ä½ç½®å¼ºåˆ¶ä¿®æ”¹ä¸º <code>æ—§è¿›åº¦ + å¢åŠ çš„é«˜åº¦</code>ã€‚è¿™å¥—åŠ¨ä½œè¦åœ¨æµè§ˆå™¨åˆ·æ–°å‰å®Œæˆï¼Œç”¨æˆ·åªä¼šè§‰å¾—åŠ è½½äº†æ–°å†…å®¹ï¼Œä½†çœ¼å‰çš„ç”»é¢çº¹ä¸ä¸åŠ¨ã€‚</li>
</ol>
<h4 data-id="heading-7">5ã€ç¬¬äº”æ­¥ï¼šå®æ—¶ç›‘æ§ï¼ˆé«˜åº¦çº æ­£ï¼‰</h4>
<p>ä¸‡ä¸€æŸæ¡æ¶ˆæ¯é‡Œçªç„¶è¹¦å‡ºä¸€å¼ å¤§å›¾ï¼Œé«˜åº¦å˜äº†æ€ä¹ˆåŠï¼Ÿ</p>
<ul>
<li><strong>æ´¾å‡ºä¾¦å¯Ÿå…µ</strong>ï¼šå­ç»„ä»¶è‡ªå¸¦ <code>ResizeObserver</code>ï¼Œä¸€æ—¦å‘ç°è‡ªå·±é•¿é«˜äº†ï¼Œç«‹é©¬æŠ¥å‘Šç»™çˆ¶ç»„ä»¶ã€‚</li>
<li><strong>ç²¾å‡†æ‰“å‡»</strong>ï¼šçˆ¶ç»„ä»¶æ”¶åˆ°æŠ¥å‘Šï¼Œæ›´æ–°è´¦æœ¬ã€‚å¦‚æœè¿™ä¸ªå˜é«˜çš„é¡¹åœ¨è§‚ä¼—è§†çº¿<strong>ä¸Šæ–¹</strong>ï¼Œè¿˜å¾—æ‰‹åŠ¨æŠŠæ»šåŠ¨æ¡å†æ¨ä¸€æ¨ï¼Œé˜²æ­¢å†…å®¹åœ¨çœ¼çš®å­åº•ä¸‹â€œä¹±è·³â€ã€‚</li>
</ul>
<h4 data-id="heading-8">6ã€ç»ˆç« ï¼šå¼€å¹•ä»ªå¼ï¼ˆåˆå§‹åŒ–ï¼‰</h4>
<ol>
<li><strong>ä¸€æ»šåˆ°åº•</strong>ï¼šèŠå¤©å®¤å˜›ï¼Œè¿›åœºè‚¯å®šå¾—çœ‹æœ€ä¸‹é¢ï¼ˆæœ€æ–°æ¶ˆæ¯ï¼‰ã€‚</li>
<li><strong>åŒé‡ä¿é™©</strong>ï¼šè°ƒç”¨ <code>scrollToBottom</code> æ—¶ï¼Œå…ˆç”¨ <code>requestAnimationFrame</code> è¯·æµè§ˆå™¨é…åˆï¼Œå†åŠ ä¸ª <code>setTimeout</code> å…œåº•ï¼Œç¡®ä¿æ— è®ºç½‘ç»œå¤šæ…¢ï¼Œéƒ½èƒ½å‡†ç¡®é™è½åœ¨åˆ—è¡¨åº•éƒ¨ã€‚</li>
</ol>
<hr/>
<h2 data-id="heading-9">ä¸‰ã€ Vue 3 + TailwindCSS å®ç°</h2>
<h3 data-id="heading-10">1.  è™šæ‹Ÿåˆ—è¡¨ç»„ä»¶ï¼š</h3>
<pre><code class="hljs language-vue" lang="vue">&lt;template&gt;
  &lt;div
    class="min-h-screen bg-gradient-to-br from-indigo-600 to-purple-600 py-10 px-5"
  &gt;
    &lt;div
      class="bg-white mt-10 rounded-xl border shadow-lg relative"
      ref="containerRef"
    &gt;
      &lt;div
        ref="virtualListRef"
        class="h-full overflow-auto relative overflow-anchor-none"
        @scroll="handleScroll"
      &gt;
        &lt;!-- é¡¶éƒ¨åŠ è½½æç¤º --&gt;
        &lt;div
          v-if="isLoading"
          class="sticky top-0 z-10 py-2 flex justify-center items-center text-sm text-gray-500"
        &gt;
          &lt;div class="flex items-center space-x-2"&gt;
            &lt;span&gt;æ­£åœ¨åŠ è½½...&lt;/span&gt;
          &lt;/div&gt;
        &lt;/div&gt;

        &lt;div :style="{ height: `${totalHeight}px` }"&gt;&lt;/div&gt;
        &lt;div
          class="absolute top-0 left-0 right-0"
          :style="{ transform: `translateY(${offsetY}px)` }"
        &gt;
          &lt;VirtualListItem
            v-for="item in visibleList"
            :key="item.id"
            :item="item"
            @update-height="handleItemHeightUpdate"
          /&gt;
        &lt;/div&gt;
      &lt;/div&gt;
    &lt;/div&gt;
  &lt;/div&gt;
&lt;/template&gt;

&lt;script setup lang="ts"&gt;
import { ref, onMounted, computed, nextTick, watch } from 'vue';
import VirtualListItem from './listItem.vue';

const MIN_ITEM_HEIGHT = 80; //é¢„è®¾è™šæ‹Ÿåˆ—è¡¨é¡¹æœ€å°é«˜åº¦
const BUFFER_SIZE = 5; // ç¼“å†²åŒºå¤§å°ï¼Œç”¨äºé¢„åŠ è½½é¡¹
const LOAD_THRESHOLD = 50; // åŠ è½½æ¶ˆæ¯è§¦å‘è·ç¦»

const virtualListRef = ref&lt;HTMLDivElement | null&gt;(null); // è™šæ‹Ÿåˆ—è¡¨å®¹å™¨å¼•ç”¨
const listData = ref&lt;any[]&gt;([]); // åˆ—è¡¨æ•°æ®
const itemHeights = ref&lt;Map&lt;number, number&gt;&gt;(new Map()); // åˆ—è¡¨é¡¹é«˜åº¦æ•°ç»„ï¼šå­˜å‚¨æ¯ä¸ªé¡¹çš„é«˜åº¦
const scrollTop = ref(0); // æ»šåŠ¨ä½ç½®ï¼šå½“å‰æ»šåŠ¨çš„å‚ç›´åç§»é‡
const isLoading = ref(false); // æ˜¯å¦æ­£åœ¨åŠ è½½æ›´å¤šæ•°æ®
const isInitialized = ref(false); // æ˜¯å¦å·²åˆå§‹åŒ–ï¼šç”¨äºåˆ¤æ–­æ˜¯å¦å·²åŠ è½½åˆå§‹æ•°æ®
const hasMore = ref(true); // æ˜¯å¦æœ‰æ›´å¤šæ•°æ®å¯åŠ è½½
const containerRef = ref&lt;HTMLDivElement | null&gt;(null);

let minId = 10000; // æ¨¡æ‹Ÿç”Ÿæˆæ¶ˆæ¯ID

// è®¡ç®—ç´¯è®¡é«˜åº¦æ•°ç»„,å¯¹åº”äº†æ¯ä¸ªå…ƒç´ åœ¨åˆ—è¡¨ä¸­çš„å‚ç›´ä½ç½®
const cumulativeHeights = computed(() =&gt; {
  const heights: number[] = [0];
  let currentSum = 0;
  for (const item of listData.value) {
    const h = itemHeights.value.get(item.id) || MIN_ITEM_HEIGHT;
    currentSum += h;
    heights.push(currentSum);
  }
  return heights;
});

// åˆ—è¡¨æ€»é«˜åº¦ï¼šåˆ—è¡¨æ‰€æœ‰é¡¹çš„ç´¯è®¡é«˜åº¦
const totalHeight = computed(() =&gt; {
  const len = cumulativeHeights.value.length;
  return len &gt; 0 ? cumulativeHeights.value[len - 1] : 0;
});

// èµ·å§‹ç´¢å¼•
const startIndex = computed(() =&gt; {
  let low = 0,
    high = cumulativeHeights.value.length - 1;
  // æ ¸å¿ƒï¼šæ ¹æ®äºŒåˆ†æŸ¥æ‰¾æ³•å‡ºå¯è§†åŒºå†…ç¬¬ä¸€ä¸ªå¯è§é¡¹çš„ç´¢å¼•!!!!!
  while (low &lt;= high) {
    const mid = Math.floor((low + high) / 2);
    if (cumulativeHeights.value[mid] &lt; scrollTop.value) {
      low = mid + 1;
    } else {
      high = mid - 1;
    }
  }
  return Math.max(0, low - 1 - BUFFER_SIZE);
});

// ç»“æŸç´¢å¼•
const endIndex = computed(() =&gt; {
  if (!virtualListRef.value) return 10;
  const t = scrollTop.value + virtualListRef.value.clientHeight; // å¯è§†åŒºåº•éƒ¨åœ¨åˆ—è¡¨ä¸­çš„å‚ç›´ä½ç½®`
  let low = 0,
    high = cumulativeHeights.value.length - 1;
  // æ ¸å¿ƒï¼šæ ¹æ®äºŒåˆ†æŸ¥æ‰¾æ³•å‡ºå¯è§†åŒºå†…æœ€åä¸€ä¸ªå¯è§é¡¹çš„ç´¢å¼•!!!!!
  while (low &lt;= high) {
    const mid = Math.floor((low + high) / 2);
    if (cumulativeHeights.value[mid] &lt; t) {
      low = mid + 1;
    } else {
      high = mid - 1;
    }
  }
  return Math.min(listData.value.length, low + BUFFER_SIZE);
});

// å¯è§åˆ—è¡¨é¡¹ï¼šæ ¹æ®èµ·å§‹ç´¢å¼•å’Œç»“æŸç´¢å¼•æˆªå–åˆ—è¡¨æ•°æ®
const visibleList = computed(() =&gt; {
  return listData.value.slice(startIndex.value, endIndex.value);
});

// åç§»é‡ï¼šæ ¹æ®èµ·å§‹ç´¢å¼•è®¡ç®—åˆ—è¡¨é¡¹çš„å‚ç›´åç§»é‡
const offsetY = computed(() =&gt; {
  if (startIndex.value === 0) return 0;
  return cumulativeHeights.value[startIndex.value];
});

// mockçœŸå®æ•°æ®
const generateData = (count: number) =&gt; {
  const arr = [];
  for (let i = 0; i &lt; count; i++) {
    minId--;
    arr.push({
      id: minId,
      content: `å†å²æ¶ˆæ¯ ${minId}`,
      timestamp: new Date().toLocaleTimeString(),
    });
  }
  return arr;
};

// åˆå§‹åŒ–æ•°æ®
const initData = async () =&gt; {
  const initialData = await new Promise&lt;any[]&gt;(
    (resolve) =&gt; setTimeout(() =&gt; resolve(generateData(20)), 100) // æ¨¡æ‹Ÿå¼‚æ­¥æ•°æ®åŠ è½½ï¼Œåˆå§‹åŠ è½½æ—¶åŠ è½½20æ¡æ•°æ®é˜²æ­¢æ•°æ®é‡è¿‡å°‘æ’‘ä¸èµ·å®¹å™¨
  );
  listData.value = initialData.reverse();
  await nextTick(); // ç­‰å¾…listDataæ¸²æŸ“åˆ°DOMä¸­
  await nextTick(); // å†æ¬¡ç­‰å¾…å­ç»„ä»¶å®Œå…¨æ¸²æŸ“å¹¶è®¡ç®—å¥½å®é™…é«˜åº¦

  isInitialized.value = true;
  scrollToBottom(); // æ»šåŠ¨åˆ°åº•éƒ¨æ˜¾ç¤ºæœ€æ–°æ¶ˆæ¯
};

// æ»šåŠ¨åˆ°åº•
const scrollToBottom = () =&gt; {
  if (!virtualListRef.value) return;
  const scroll = () =&gt; {
    nextTick(() =&gt; {
      if (virtualListRef.value) {
        const scrollHeight = virtualListRef.value.scrollHeight;
        const clientHeight = virtualListRef.value.clientHeight;
        virtualListRef.value.scrollTop = scrollHeight - clientHeight;
        scrollTop.value = virtualListRef.value.scrollTop;
      }
    });
  };

  // åŒé‡ä¿éšœï¼šå…ˆä½¿ç”¨requestAnimationFrameç­‰å¾…æµè§ˆå™¨å®Œæˆä¸€æ¬¡é‡ç»˜ï¼Œæ­¤æ—¶ scrollHeight å’Œ clientHeight å·²æ­£ç¡®è®¡ç®—ï¼Œ
  // å†ç”¨setTimeoutå…œåº•ç¡®ä¿å³ä½¿ requestAnimationFrame å¤±æ•ˆä¹Ÿèƒ½æ‰§è¡Œ
  requestAnimationFrame(() =&gt; {
    scroll();
    // å…œåº•æ–¹æ¡ˆï¼Œç¡®ä¿æ»šåŠ¨æ‰§è¡Œ
    setTimeout(() =&gt; {
      scroll();
    }, 100);
  });
};

// ç›‘å¬totalHeightå˜åŒ–ï¼Œåˆå§‹åŒ–æ—¶ç¡®ä¿æ»šåŠ¨åˆ°åº•éƒ¨
watch(
  totalHeight,
  (newVal, oldVal) =&gt; {
    if (isInitialized.value &amp;&amp; oldVal === 0 &amp;&amp; newVal &gt; 0) {
      scrollToBottom();
    }
  },
  { immediate: true }
);

// åŠ è½½æ–°æ¶ˆæ¯
const loadNewMessages = async () =&gt; {
  if (isLoading.value || !hasMore.value || !isInitialized.value) return;
  isLoading.value = true;
  try {
    await new Promise((resolve) =&gt; setTimeout(resolve, 1000));    // æ¨¡æ‹Ÿ1ç§’å»¶è¿Ÿ
    const newData = generateData(5); // æ¯æ¬¡åŠ è½½5æ¡æ–°æ¶ˆæ¯
    const currentScrollHeight = virtualListRef.value?.scrollHeight || 0;    // è®°å½•å½“å‰æ»šåŠ¨çŠ¶æ€ï¼Œä¸ºæœªåŠ è½½å‰æ•´ä¸ªåˆ—è¡¨çš„é«˜åº¦ï¼ˆå«ä¸å¯è§ï¼‰ï¼ï¼ï¼
    const currentScrollTop = scrollTop.value;
    listData.value = [...newData, ...listData.value];    // åœ¨é¡¶éƒ¨æ·»åŠ æ–°æ•°æ®
    await nextTick();    // ç­‰å¾…DOMæ›´æ–°
    // ä¿æŒæ»šåŠ¨ä½ç½®ï¼Œè®©ç”¨æˆ·åœç•™åœ¨åŸæ¥çš„åœ°æ–¹
    if (virtualListRef.value) {
      const newScrollHeight = virtualListRef.value.scrollHeight;
      const heightAdded = newScrollHeight - currentScrollHeight;
      virtualListRef.value.scrollTop = currentScrollTop + heightAdded;
      scrollTop.value = virtualListRef.value.scrollTop;
    }
    // æ¨¡æ‹Ÿæ²¡æœ‰æ›´å¤šæ•°æ®çš„æƒ…å†µ
    if (minId &lt;= 9000) {
      hasMore.value = false;
    }
  } catch (error) {
    console.error('åŠ è½½æ¶ˆæ¯å¤±è´¥:', error);
  } finally {
    isLoading.value = false;
  }
};

// å¤„ç†é¡¹ç›®é«˜åº¦æ›´æ–°
const handleItemHeightUpdate = (id: number, realHeight: number) =&gt; {
  const oldHeight = itemHeights.value.get(id) || MIN_ITEM_HEIGHT;
  const diff = realHeight - oldHeight;
  if (Math.abs(diff) &lt; 1) return;

  itemHeights.value.set(id, realHeight);
  // å¦‚æœé¡¹ç›®åœ¨å¯è§†åŒºåŸŸä¸Šæ–¹ï¼Œè°ƒæ•´æ»šåŠ¨ä½ç½®
  const index = listData.value.findIndex((item) =&gt; item.id === id);
  if (index &lt; 0) return;

  const itemTop = cumulativeHeights.value[index];
  const viewportTop = scrollTop.value;

  if (itemTop &lt; viewportTop &amp;&amp; virtualListRef.value) {
    virtualListRef.value.scrollTop += diff;
    scrollTop.value = virtualListRef.value.scrollTop;
  }
};

// å¤„ç†æ»šåŠ¨äº‹ä»¶
const handleScroll = (e: Event) =&gt; {
  const target = e.target as HTMLDivElement;
  scrollTop.value = target.scrollTop;

  // å½“æ»šåŠ¨åˆ°è·ç¦»é¡¶éƒ¨LOAD_THRESHOLDåƒç´ æ—¶ï¼ŒåŠ è½½æ›´å¤šæ¶ˆæ¯
  if (
    scrollTop.value &lt;= LOAD_THRESHOLD &amp;&amp;
    !isLoading.value &amp;&amp;
    hasMore.value &amp;&amp;
    isInitialized.value
  ) {
    loadNewMessages();
  }
};


// åˆå§‹åŒ–
onMounted(() =&gt; {
  // è®¡ç®—å®¹å™¨é«˜åº¦ï¼šè§†å£é«˜åº¦å‡å»ä¸Šä¸‹è¾¹è·å’Œæ ‡é¢˜åŒºåŸŸ
  if (containerRef.value) {
    const computedHeight = window.innerHeight - 200; // ç­‰ä»·äº calc(100vh - 200px)
    containerRef.value.style.height = `${Math.max(200, computedHeight)}px`; // é˜²æ­¢è´Ÿæ•°æˆ–å¤ªå°
  }
  // ç¡®ä¿DOMå®Œå…¨æŒ‚è½½åå†åˆå§‹åŒ–æ•°æ®
  nextTick(() =&gt; {
    initData();
  });
});
&lt;/script&gt;

&lt;style scoped&gt;
.overflow-anchor-none {
  overflow-anchor: none;
}
&lt;/style&gt;

</code></pre>
<h3 data-id="heading-11">2. å­ç»„ä»¶ï¼š</h3>
<pre><code class="hljs language-vue" lang="vue">&lt;template&gt;
  &lt;div
    ref="itemRef"
    class="py-2 px-4 border-b border-gray-200"
    :class="{
      'bg-pink-200': item.id % 2 !== 0,
      'bg-green-200': item.id % 2 === 0,
    }"
    :style="{ height: item.id % 2 === 0 ? '150px' : '100px' }"
  &gt;
    {{ item.content }}
  &lt;/div&gt;
&lt;/template&gt;

&lt;script setup lang="ts"&gt;
import { ref, onMounted, onUpdated, onUnmounted, watch, nextTick } from 'vue';

// å®šä¹‰propsï¼šæ¥æ”¶çˆ¶ç»„ä»¶ä¼ é€’çš„itemæ•°æ®
const props = defineProps&lt;{
  item: {
    id: number;
    content: string;
  };
}&gt;();

// å®šä¹‰emitï¼šå‘çˆ¶ç»„ä»¶ä¼ é€’é«˜åº¦æ›´æ–°äº‹ä»¶
const emit = defineEmits&lt;{
  (e: 'update-height', id: number, height: number): void;
}&gt;();

const itemRef = ref&lt;HTMLDivElement | null&gt;(null);
let resizeObserver: ResizeObserver | null = null;

// è®¡ç®—å¹¶å‘é€å½“å‰ç»„ä»¶çš„é«˜åº¦
const sendItemHeight = () =&gt; {
  if (!itemRef.value) return;
  const realHeight = itemRef.value.offsetHeight;
  emit('update-height', props.item.id, realHeight);
};

// ç›‘å¬ç»„ä»¶æŒ‚è½½ï¼šé¦–æ¬¡å‘é€é«˜åº¦ + ç›‘å¬é«˜åº¦å˜åŒ–
onMounted(() =&gt; {
  // é¦–æ¬¡æ¸²æŸ“å®Œæˆåå‘é€é«˜åº¦
  nextTick(() =&gt; {
    sendItemHeight();
  });

  // ç›‘å¬å…ƒç´ é«˜åº¦å˜åŒ–ï¼ˆé€‚é…åŠ¨æ€å†…å®¹å¯¼è‡´çš„é«˜åº¦å˜åŒ–ï¼‰
  if (window.ResizeObserver) {
    resizeObserver = new ResizeObserver(() =&gt; {
      sendItemHeight();
    });
    if (itemRef.value) {
      resizeObserver.observe(itemRef.value);
    }
  }
});

// ç»„ä»¶æ›´æ–°åé‡æ–°å‘é€é«˜åº¦ï¼ˆæ¯”å¦‚å†…å®¹å˜åŒ–ï¼‰
onUpdated(() =&gt; {
  nextTick(() =&gt; {
    sendItemHeight();
  });
});

// ç»„ä»¶å¸è½½ï¼šæ¸…ç†ç›‘å¬
onUnmounted(() =&gt; {
  if (resizeObserver) {
    resizeObserver.disconnect();
    resizeObserver = null;
  }
});

// ç›‘å¬itemå˜åŒ–ï¼šå¦‚æœitemæ›¿æ¢ï¼Œé‡æ–°è®¡ç®—é«˜åº¦
watch(
  () =&gt; props.item.id,
  () =&gt; {
    nextTick(() =&gt; {
      sendItemHeight();
    });
  }
);
&lt;/script&gt;

</code></pre>
<h3 data-id="heading-12">3. æ•ˆæœå›¾ï¼š</h3>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e215fba6c3644a5fb642682382953bb7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y-R546w5LiA5Y-q5aSn5ZGG55Oc:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771153211&amp;x-signature=OzJ2Deey2TPyP%2FPxvP0KN1S5pj8%3D" alt="vueè™šæ‹Ÿåˆ—è¡¨å‘ä¸ŠåŠ è½½.gif" loading="lazy"/></p>
<hr/>
<h2 data-id="heading-13">å››ã€ React + TailwindCSSå®ç°</h2>
<p>åœ¨Reactä¸­æˆ‘ä»¬éœ€è¦åˆ©ç”¨ <code>useMemo</code> ä¼˜åŒ–ç´¢å¼•è®¡ç®—ï¼Œå¹¶åˆ©ç”¨ <code>useLayoutEffect</code> å¤„ç†æ»šåŠ¨ä½ç½®ï¼Œé¿å…è§†è§‰é—ªçƒã€‚</p>
<h3 data-id="heading-14">1.  è™šæ‹Ÿåˆ—è¡¨ç»„ä»¶ï¼š</h3>
<pre><code class="hljs language-tsx" lang="tsx"><span class="hljs-keyword">import</span> <span class="hljs-title class_">React</span>, {
  useState,
  useRef,
  useEffect,
  useMemo,
  useCallback,
} <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>;
<span class="hljs-keyword">import</span> <span class="hljs-title class_">VirtualListItem</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'./VirtualListItem'</span>;

<span class="hljs-keyword">const</span> <span class="hljs-variable constant_">MIN_ITEM_HEIGHT</span> = <span class="hljs-number">80</span>; <span class="hljs-comment">// æ¯ä¸ªåˆ—è¡¨é¡¹çš„æœ€å°é«˜åº¦</span>
<span class="hljs-keyword">const</span> <span class="hljs-variable constant_">BUFFER_SIZE</span> = <span class="hljs-number">5</span>; <span class="hljs-comment">// ç¼“å†²åŒºå¤§å°ï¼Œç”¨äºé¢„åŠ è½½</span>
<span class="hljs-keyword">const</span> <span class="hljs-variable constant_">LOAD_THRESHOLD</span> = <span class="hljs-number">30</span>; <span class="hljs-comment">// è§¦å‘åŠ è½½çš„pxå€¼</span>
<span class="hljs-keyword">const</span> <span class="hljs-variable constant_">NEW_DATA_COUNT</span> = <span class="hljs-number">5</span>; <span class="hljs-comment">// æ¯æ¬¡åŠ è½½çš„æ–°æ•°æ®æ•°é‡</span>
<span class="hljs-keyword">const</span> <span class="hljs-variable constant_">PRE_LOAD_OFFSET</span> = <span class="hljs-number">100</span>; <span class="hljs-comment">// é¢„åŠ è½½åç§»é‡ï¼Œç”¨äºæå‰åŠ è½½éƒ¨åˆ†æ•°æ®</span>

<span class="hljs-comment">// åˆ—è¡¨é¡¹ç±»å‹å®šä¹‰</span>
<span class="hljs-keyword">interface</span> <span class="hljs-title class_">ListItem</span> {
  <span class="hljs-attr">id</span>: <span class="hljs-built_in">number</span>; <span class="hljs-comment">// åˆ—è¡¨é¡¹çš„å”¯ä¸€æ ‡è¯†ç¬¦</span>
  <span class="hljs-attr">content</span>: <span class="hljs-built_in">string</span>; <span class="hljs-comment">// åˆ—è¡¨é¡¹çš„å†…å®¹</span>
  <span class="hljs-attr">timestamp</span>: <span class="hljs-built_in">string</span>; <span class="hljs-comment">// åˆ—è¡¨é¡¹çš„æ—¶é—´æˆ³</span>
}

<span class="hljs-keyword">const</span> <span class="hljs-title class_">VirtualList</span>: <span class="hljs-title class_">React</span>.<span class="hljs-property">FC</span> = <span class="hljs-function">() =&gt;</span> {
  <span class="hljs-keyword">const</span> virtualListRef = useRef&lt;<span class="hljs-title class_">HTMLDivElement</span>&gt;(<span class="hljs-literal">null</span>); <span class="hljs-comment">// è™šæ‹Ÿåˆ—è¡¨å®¹å™¨å¼•ç”¨</span>
  <span class="hljs-keyword">const</span> containerRef = useRef&lt;<span class="hljs-title class_">HTMLDivElement</span>&gt;(<span class="hljs-literal">null</span>); <span class="hljs-comment">// åˆ—è¡¨å®¹å™¨å¼•ç”¨</span>
  <span class="hljs-keyword">const</span> loadTimerRef = useRef&lt;<span class="hljs-title class_">ReturnType</span>&lt;<span class="hljs-keyword">typeof</span> <span class="hljs-built_in">setTimeout</span>&gt; | <span class="hljs-literal">null</span>&gt;(<span class="hljs-literal">null</span>); <span class="hljs-comment">// åŠ è½½å®šæ—¶å™¨å¼•ç”¨</span>
  <span class="hljs-keyword">const</span> initScrollAttemptsRef = <span class="hljs-title function_">useRef</span>(<span class="hljs-number">0</span>); <span class="hljs-comment">// åˆå§‹åŒ–æ»šåŠ¨å°è¯•æ¬¡æ•°å¼•ç”¨ï¼Œæœ€å¤š10æ¬¡</span>
  <span class="hljs-keyword">const</span> [listData, setListData] = useState&lt;<span class="hljs-title class_">ListItem</span>[]&gt;([]); <span class="hljs-comment">// åˆ—è¡¨æ•°æ®çŠ¶æ€ï¼Œåˆå§‹ä¸ºç©ºæ•°ç»„</span>
  <span class="hljs-keyword">const</span> [itemHeights, setItemHeights] = useState&lt;<span class="hljs-title class_">Map</span>&lt;<span class="hljs-built_in">number</span>, <span class="hljs-built_in">number</span>&gt;&gt;(
    <span class="hljs-keyword">new</span> <span class="hljs-title class_">Map</span>()
  ); <span class="hljs-comment">// åˆ—è¡¨é¡¹é«˜åº¦æ˜ å°„Map</span>
  <span class="hljs-keyword">const</span> [scrollTop, setScrollTop] = useState&lt;<span class="hljs-built_in">number</span>&gt;(<span class="hljs-number">0</span>); <span class="hljs-comment">// æ»šåŠ¨ä½ç½®çŠ¶æ€ï¼Œåˆå§‹ä¸º0</span>
  <span class="hljs-keyword">const</span> [isLoading, setIsLoading] = useState&lt;<span class="hljs-built_in">boolean</span>&gt;(<span class="hljs-literal">false</span>); <span class="hljs-comment">// åŠ è½½çŠ¶æ€ï¼Œåˆå§‹ä¸ºfalse</span>
  <span class="hljs-keyword">const</span> [isInitialized, setIsInitialized] = useState&lt;<span class="hljs-built_in">boolean</span>&gt;(<span class="hljs-literal">false</span>); <span class="hljs-comment">// åˆå§‹åŒ–çŠ¶æ€ï¼Œåˆå§‹ä¸ºfalse</span>
  <span class="hljs-keyword">const</span> [hasMore, setHasMore] = useState&lt;<span class="hljs-built_in">boolean</span>&gt;(<span class="hljs-literal">true</span>); <span class="hljs-comment">// æ˜¯å¦è¿˜æœ‰æ›´å¤šæ•°æ®çŠ¶æ€ï¼Œåˆå§‹ä¸ºtrue</span>

  <span class="hljs-keyword">const</span> minIdRef = <span class="hljs-title function_">useRef</span>(<span class="hljs-number">10000</span>); <span class="hljs-comment">// æœ€å°IDå¼•ç”¨ï¼Œåˆå§‹ä¸º10000</span>
  <span class="hljs-keyword">const</span> isLoadingRef = <span class="hljs-title function_">useRef</span>(<span class="hljs-literal">false</span>); <span class="hljs-comment">// æ­£åœ¨åŠ è½½çŠ¶æ€</span>
  <span class="hljs-keyword">const</span> hasMoreRef = <span class="hljs-title function_">useRef</span>(<span class="hljs-literal">true</span>); <span class="hljs-comment">// æ˜¯å¦è¿˜æœ‰æ›´å¤šæ•°æ®</span>
  <span class="hljs-keyword">const</span> isFirstInitRef = <span class="hljs-title function_">useRef</span>(<span class="hljs-literal">true</span>); <span class="hljs-comment">// æ˜¯å¦ç¬¬ä¸€æ¬¡åˆå§‹åŒ–</span>
  <span class="hljs-keyword">const</span> scrollStateRef = useRef&lt;{
    <span class="hljs-attr">isManualScroll</span>: <span class="hljs-built_in">boolean</span>;
    <span class="hljs-attr">lastScrollTop</span>: <span class="hljs-built_in">number</span>;
  }&gt;({
    <span class="hljs-attr">isManualScroll</span>: <span class="hljs-literal">false</span>,
    <span class="hljs-attr">lastScrollTop</span>: <span class="hljs-number">0</span>,
  }); <span class="hljs-comment">// æ»šåŠ¨çŠ¶æ€å¼•ç”¨</span>

  <span class="hljs-comment">// åŒæ­¥ ref å’Œ state</span>
  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> {
    isLoadingRef.<span class="hljs-property">current</span> = isLoading;
    hasMoreRef.<span class="hljs-property">current</span> = hasMore;
  }, [isLoading, hasMore]);

  <span class="hljs-comment">// è®¡ç®—ç´¯è®¡é«˜åº¦</span>
  <span class="hljs-keyword">const</span> cumulativeHeights = <span class="hljs-title function_">useMemo</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">const</span> <span class="hljs-attr">heights</span>: <span class="hljs-built_in">number</span>[] = [<span class="hljs-number">0</span>];
    <span class="hljs-keyword">let</span> currentSum = <span class="hljs-number">0</span>;
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> item <span class="hljs-keyword">of</span> listData) {
      <span class="hljs-keyword">const</span> h = itemHeights.<span class="hljs-title function_">get</span>(item.<span class="hljs-property">id</span>) || <span class="hljs-variable constant_">MIN_ITEM_HEIGHT</span>;
      currentSum += h;
      heights.<span class="hljs-title function_">push</span>(currentSum);
    }
    <span class="hljs-keyword">return</span> heights;
  }, [listData, itemHeights]);

  <span class="hljs-comment">// åˆ—è¡¨æ€»é«˜åº¦</span>
  <span class="hljs-keyword">const</span> totalHeight = <span class="hljs-title function_">useMemo</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">return</span> cumulativeHeights[cumulativeHeights.<span class="hljs-property">length</span> - <span class="hljs-number">1</span>] || <span class="hljs-number">0</span>;
  }, [cumulativeHeights]);

  <span class="hljs-comment">// èµ·å§‹ç´¢å¼•</span>
  <span class="hljs-keyword">const</span> startIndex = <span class="hljs-title function_">useMemo</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">if</span> (!virtualListRef.<span class="hljs-property">current</span> || listData.<span class="hljs-property">length</span> === <span class="hljs-number">0</span>) <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
    <span class="hljs-keyword">let</span> low = <span class="hljs-number">0</span>,
      high = cumulativeHeights.<span class="hljs-property">length</span> - <span class="hljs-number">1</span>;
    <span class="hljs-keyword">while</span> (low &lt;= high) {
      <span class="hljs-keyword">const</span> mid = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">floor</span>((low + high) / <span class="hljs-number">2</span>);
      <span class="hljs-keyword">if</span> (cumulativeHeights[mid] &lt; scrollTop) {
        low = mid + <span class="hljs-number">1</span>;
      } <span class="hljs-keyword">else</span> {
        high = mid - <span class="hljs-number">1</span>;
      }
    }

    <span class="hljs-keyword">const</span> baseIndex = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">max</span>(<span class="hljs-number">0</span>, low - <span class="hljs-number">1</span>);
    <span class="hljs-keyword">return</span> <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">max</span>(<span class="hljs-number">0</span>, baseIndex - <span class="hljs-variable constant_">BUFFER_SIZE</span>);
  }, [cumulativeHeights, scrollTop, listData.<span class="hljs-property">length</span>]);

  <span class="hljs-comment">// ç»“æŸç´¢å¼•</span>
  <span class="hljs-keyword">const</span> endIndex = <span class="hljs-title function_">useMemo</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">if</span> (!virtualListRef.<span class="hljs-property">current</span> || listData.<span class="hljs-property">length</span> === <span class="hljs-number">0</span>)
      <span class="hljs-keyword">return</span> <span class="hljs-variable constant_">BUFFER_SIZE</span> * <span class="hljs-number">2</span>;
    <span class="hljs-keyword">const</span> clientHeight = virtualListRef.<span class="hljs-property">current</span>.<span class="hljs-property">clientHeight</span>;
    <span class="hljs-keyword">const</span> t = scrollTop + clientHeight + <span class="hljs-variable constant_">PRE_LOAD_OFFSET</span>;
    <span class="hljs-keyword">let</span> low = <span class="hljs-number">0</span>,
      high = cumulativeHeights.<span class="hljs-property">length</span> - <span class="hljs-number">1</span>;
    <span class="hljs-keyword">while</span> (low &lt;= high) {
      <span class="hljs-keyword">const</span> mid = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">floor</span>((low + high) / <span class="hljs-number">2</span>);
      <span class="hljs-keyword">if</span> (cumulativeHeights[mid] &lt; t) {
        low = mid + <span class="hljs-number">1</span>;
      } <span class="hljs-keyword">else</span> {
        high = mid - <span class="hljs-number">1</span>;
      }
    }

    <span class="hljs-keyword">return</span> <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">min</span>(listData.<span class="hljs-property">length</span>, low + <span class="hljs-variable constant_">BUFFER_SIZE</span>);
  }, [cumulativeHeights, scrollTop, listData.<span class="hljs-property">length</span>]);

  <span class="hljs-comment">// å¯è§åˆ—è¡¨é¡¹</span>
  <span class="hljs-keyword">const</span> visibleList = <span class="hljs-title function_">useMemo</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">return</span> listData.<span class="hljs-title function_">slice</span>(startIndex, endIndex);
  }, [listData, startIndex, endIndex]);

  <span class="hljs-comment">// åç§»é‡</span>
  <span class="hljs-keyword">const</span> offsetY = <span class="hljs-title function_">useMemo</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">return</span> startIndex === <span class="hljs-number">0</span> ? <span class="hljs-number">0</span> : cumulativeHeights[startIndex];
  }, [cumulativeHeights, startIndex]);

  <span class="hljs-comment">// ç”Ÿæˆæ¨¡æ‹Ÿæ•°æ®</span>
  <span class="hljs-keyword">const</span> generateData = <span class="hljs-title function_">useCallback</span>(
    <span class="hljs-function">(<span class="hljs-params">count: <span class="hljs-built_in">number</span>, isInitialLoad: <span class="hljs-built_in">boolean</span> = <span class="hljs-literal">false</span></span>) =&gt;</span> {
      <span class="hljs-keyword">const</span> <span class="hljs-attr">arr</span>: <span class="hljs-title class_">ListItem</span>[] = [];
      <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; count; i++) {
        minIdRef.<span class="hljs-property">current</span>--;
        arr.<span class="hljs-title function_">push</span>({
          <span class="hljs-attr">id</span>: minIdRef.<span class="hljs-property">current</span>,
          <span class="hljs-attr">content</span>: <span class="hljs-string">`å†å²æ¶ˆæ¯ <span class="hljs-subst">${minIdRef.current}</span>`</span>,
          <span class="hljs-attr">timestamp</span>: <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>().<span class="hljs-title function_">toLocaleTimeString</span>(),
        });
      }
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'ç”Ÿæˆæ•°æ®:'</span>, arr);
      <span class="hljs-keyword">if</span> (!isInitialLoad) {
        arr.<span class="hljs-title function_">reverse</span>();
      }
      <span class="hljs-keyword">return</span> arr;
    },
    []
  );

  <span class="hljs-comment">// æ»šåŠ¨åˆ°åº•éƒ¨</span>
  <span class="hljs-keyword">const</span> scrollToBottom = <span class="hljs-title function_">useCallback</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">if</span> (!virtualListRef.<span class="hljs-property">current</span>) <span class="hljs-keyword">return</span>;

    <span class="hljs-keyword">const</span> scrollEl = virtualListRef.<span class="hljs-property">current</span>;

    <span class="hljs-comment">// ä½¿ç”¨å¤šæ¬¡å°è¯•ï¼Œç›´åˆ°æˆåŠŸæ»šåŠ¨åˆ°åº•éƒ¨</span>
    <span class="hljs-keyword">const</span> <span class="hljs-title function_">attemptScroll</span> = (<span class="hljs-params"/>) =&gt; {
      <span class="hljs-title function_">requestAnimationFrame</span>(<span class="hljs-function">() =&gt;</span> {
        <span class="hljs-keyword">const</span> scrollHeight = scrollEl.<span class="hljs-property">scrollHeight</span>;
        <span class="hljs-keyword">const</span> clientHeight = scrollEl.<span class="hljs-property">clientHeight</span>;

        <span class="hljs-keyword">if</span> (scrollHeight &gt; clientHeight) {
          <span class="hljs-keyword">const</span> targetScrollTop = scrollHeight - clientHeight;
          <span class="hljs-keyword">const</span> currentScrollTop = scrollEl.<span class="hljs-property">scrollTop</span>;

          <span class="hljs-comment">// å¦‚æœè¿˜æ²¡åˆ°åº•éƒ¨ï¼Œç»§ç»­æ»šåŠ¨</span>
          <span class="hljs-keyword">if</span> (<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">abs</span>(currentScrollTop - targetScrollTop) &gt; <span class="hljs-number">1</span>) {
            scrollEl.<span class="hljs-property">scrollTop</span> = targetScrollTop;
            <span class="hljs-title function_">setScrollTop</span>(targetScrollTop);

            <span class="hljs-comment">// å¢åŠ å°è¯•æ¬¡æ•°</span>
            initScrollAttemptsRef.<span class="hljs-property">current</span>++;

            <span class="hljs-comment">// æœ€å¤šå°è¯•10æ¬¡ï¼Œæ¯æ¬¡é—´éš”50ms</span>
            <span class="hljs-keyword">if</span> (initScrollAttemptsRef.<span class="hljs-property">current</span> &lt; <span class="hljs-number">10</span>) {
              <span class="hljs-built_in">setTimeout</span>(attemptScroll, <span class="hljs-number">50</span>);
            } <span class="hljs-keyword">else</span> {
              <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'åˆå§‹åŒ–æ»šåŠ¨åˆ°åº•éƒ¨å®Œæˆ'</span>);
              isFirstInitRef.<span class="hljs-property">current</span> = <span class="hljs-literal">false</span>;
            }
          } <span class="hljs-keyword">else</span> {
            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'å·²ç»æ»šåŠ¨åˆ°åº•éƒ¨'</span>);
            isFirstInitRef.<span class="hljs-property">current</span> = <span class="hljs-literal">false</span>;
          }
        } <span class="hljs-keyword">else</span> {
          isFirstInitRef.<span class="hljs-property">current</span> = <span class="hljs-literal">false</span>; <span class="hljs-comment">// å†…å®¹é«˜åº¦å°äºå®¹å™¨é«˜åº¦ï¼Œä¸éœ€è¦æ»šåŠ¨</span>
        }
      });
    };

    <span class="hljs-comment">// é‡ç½®å°è¯•æ¬¡æ•°å¹¶å¼€å§‹æ»šåŠ¨</span>
    initScrollAttemptsRef.<span class="hljs-property">current</span> = <span class="hljs-number">0</span>;
    <span class="hljs-title function_">attemptScroll</span>();
  }, []);

  <span class="hljs-comment">// åˆå§‹åŒ–æ•°æ®</span>
  <span class="hljs-keyword">const</span> initData = <span class="hljs-title function_">useCallback</span>(<span class="hljs-keyword">async</span> () =&gt; {
    <span class="hljs-keyword">try</span> {
      <span class="hljs-keyword">const</span> initialData = <span class="hljs-keyword">await</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-title class_">ListItem</span>[]&gt;(<span class="hljs-function">(<span class="hljs-params">resolve</span>) =&gt;</span>
        <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">resolve</span>(<span class="hljs-title function_">generateData</span>(<span class="hljs-number">20</span>, <span class="hljs-literal">true</span>)), <span class="hljs-number">100</span>)
      );
      <span class="hljs-title function_">setListData</span>(initialData);
      <span class="hljs-title function_">setIsInitialized</span>(<span class="hljs-literal">true</span>);
    } <span class="hljs-keyword">catch</span> (error) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'åˆå§‹åŒ–æ•°æ®å¤±è´¥:'</span>, error);
    }
  }, [generateData]);

  <span class="hljs-comment">// æ ¸å¿ƒï¼šåŠ è½½æ–°æ¶ˆæ¯</span>
  <span class="hljs-keyword">const</span> loadNewMessages = <span class="hljs-title function_">useCallback</span>(<span class="hljs-keyword">async</span> () =&gt; {
    <span class="hljs-keyword">if</span> (isLoadingRef.<span class="hljs-property">current</span> || !hasMoreRef.<span class="hljs-property">current</span> || !isInitialized) <span class="hljs-keyword">return</span>;

    isLoadingRef.<span class="hljs-property">current</span> = <span class="hljs-literal">true</span>;
    <span class="hljs-title function_">setIsLoading</span>(<span class="hljs-literal">true</span>);

    <span class="hljs-keyword">try</span> {
      <span class="hljs-keyword">await</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve</span>) =&gt;</span> <span class="hljs-built_in">setTimeout</span>(resolve, <span class="hljs-number">1000</span>));
      <span class="hljs-keyword">const</span> newData = <span class="hljs-title function_">generateData</span>(<span class="hljs-variable constant_">NEW_DATA_COUNT</span>, <span class="hljs-literal">false</span>);

      <span class="hljs-keyword">const</span> scrollEl = virtualListRef.<span class="hljs-property">current</span>;
      <span class="hljs-keyword">if</span> (!scrollEl) <span class="hljs-keyword">return</span>;

      <span class="hljs-comment">// 1. è®°å½•åŠ è½½å‰çš„æ»šåŠ¨ä½ç½®</span>
      <span class="hljs-keyword">const</span> beforeScrollTop = scrollEl.<span class="hljs-property">scrollTop</span>;
      <span class="hljs-keyword">const</span> beforeScrollHeight = scrollEl.<span class="hljs-property">scrollHeight</span>;

      <span class="hljs-comment">// 2. æ›´æ–°æ•°æ®</span>
      <span class="hljs-title function_">setListData</span>(<span class="hljs-function">(<span class="hljs-params">prev</span>) =&gt;</span> [...newData, ...prev]);

      <span class="hljs-comment">// 3. ç­‰å¾…DOMæ›´æ–°åè°ƒæ•´æ»šåŠ¨ä½ç½®</span>
      <span class="hljs-title function_">requestAnimationFrame</span>(<span class="hljs-function">() =&gt;</span> {
        <span class="hljs-keyword">if</span> (scrollEl) {
          <span class="hljs-keyword">const</span> afterScrollHeight = scrollEl.<span class="hljs-property">scrollHeight</span>;
          <span class="hljs-keyword">const</span> heightAdded = afterScrollHeight - beforeScrollHeight;

          <span class="hljs-comment">// å…³é”®ä¿®å¤ï¼šæ£€æŸ¥å½“å‰æ˜¯å¦ä»åœ¨é¡¶éƒ¨é™„è¿‘</span>
          <span class="hljs-keyword">const</span> isStillNearTop = scrollEl.<span class="hljs-property">scrollTop</span> &lt;= <span class="hljs-variable constant_">LOAD_THRESHOLD</span> + <span class="hljs-number">50</span>;

          <span class="hljs-comment">// åªæœ‰å½“ç”¨æˆ·æ²¡æœ‰æ‰‹åŠ¨æ»šåŠ¨ä¸”ä»åœ¨é¡¶éƒ¨æ—¶æ‰è°ƒæ•´</span>
          <span class="hljs-keyword">if</span> (!scrollStateRef.<span class="hljs-property">current</span>.<span class="hljs-property">isManualScroll</span> &amp;&amp; isStillNearTop) {
            scrollEl.<span class="hljs-property">scrollTop</span> = beforeScrollTop + heightAdded;
            <span class="hljs-title function_">setScrollTop</span>(scrollEl.<span class="hljs-property">scrollTop</span>);
          }
        }
      });

      <span class="hljs-comment">// æ¨¡æ‹Ÿæ²¡æœ‰æ›´å¤šæ•°æ®</span>
      <span class="hljs-keyword">if</span> (minIdRef.<span class="hljs-property">current</span> &lt;= <span class="hljs-number">9000</span>) {
        hasMoreRef.<span class="hljs-property">current</span> = <span class="hljs-literal">false</span>;
        <span class="hljs-title function_">setHasMore</span>(<span class="hljs-literal">false</span>);
      }
    } <span class="hljs-keyword">catch</span> (error) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'åŠ è½½æ¶ˆæ¯å¤±è´¥:'</span>, error);
    } <span class="hljs-keyword">finally</span> {
      isLoadingRef.<span class="hljs-property">current</span> = <span class="hljs-literal">false</span>;
      <span class="hljs-title function_">setIsLoading</span>(<span class="hljs-literal">false</span>);
    }
  }, [generateData, isInitialized]);

  <span class="hljs-comment">// å¤„ç†åˆ—è¡¨é¡¹é«˜åº¦æ›´æ–°</span>
  <span class="hljs-keyword">const</span> handleItemHeightUpdate = <span class="hljs-title function_">useCallback</span>(
    <span class="hljs-function">(<span class="hljs-params">id: <span class="hljs-built_in">number</span>, realHeight: <span class="hljs-built_in">number</span></span>) =&gt;</span> {
      <span class="hljs-title function_">setItemHeights</span>(<span class="hljs-function">(<span class="hljs-params">prev</span>) =&gt;</span> {
        <span class="hljs-keyword">const</span> newHeights = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Map</span>(prev);
        <span class="hljs-keyword">const</span> oldHeight = newHeights.<span class="hljs-title function_">get</span>(id) || <span class="hljs-variable constant_">MIN_ITEM_HEIGHT</span>;
        <span class="hljs-keyword">const</span> diff = realHeight - oldHeight;

        <span class="hljs-keyword">if</span> (<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">abs</span>(diff) &lt; <span class="hljs-number">1</span>) <span class="hljs-keyword">return</span> prev;

        newHeights.<span class="hljs-title function_">set</span>(id, realHeight);

        <span class="hljs-comment">// è‡ªåŠ¨è°ƒæ•´æ»šåŠ¨ä½ç½®</span>
        <span class="hljs-keyword">if</span> (
          virtualListRef.<span class="hljs-property">current</span> &amp;&amp;
          !isFirstInitRef.<span class="hljs-property">current</span> &amp;&amp;
          !scrollStateRef.<span class="hljs-property">current</span>.<span class="hljs-property">isManualScroll</span>
        ) {
          <span class="hljs-keyword">const</span> scrollEl = virtualListRef.<span class="hljs-property">current</span>;
          <span class="hljs-keyword">const</span> index = listData.<span class="hljs-title function_">findIndex</span>(<span class="hljs-function">(<span class="hljs-params">item</span>) =&gt;</span> item.<span class="hljs-property">id</span> === id);

          <span class="hljs-keyword">if</span> (index &gt;= <span class="hljs-number">0</span>) {
            <span class="hljs-keyword">const</span> itemTop = cumulativeHeights[index];
            <span class="hljs-keyword">const</span> viewportTop = scrollEl.<span class="hljs-property">scrollTop</span>;

            <span class="hljs-comment">// ä»…å½“å…ƒç´ åœ¨è§†å£ä¸Šæ–¹æ—¶è°ƒæ•´</span>
            <span class="hljs-keyword">if</span> (itemTop &lt; viewportTop) {
              scrollEl.<span class="hljs-property">scrollTop</span> += diff;
              <span class="hljs-title function_">setScrollTop</span>(scrollEl.<span class="hljs-property">scrollTop</span>);
            }
          }
        }

        <span class="hljs-keyword">return</span> newHeights;
      });
    },
    [listData, cumulativeHeights]
  );

  <span class="hljs-comment">// å¤„ç†æ»šåŠ¨äº‹ä»¶</span>
  <span class="hljs-keyword">const</span> handleScroll = <span class="hljs-title function_">useCallback</span>(
    <span class="hljs-function">(<span class="hljs-params">e: React.UIEvent&lt;HTMLDivElement&gt;</span>) =&gt;</span> {
      <span class="hljs-keyword">const</span> target = e.<span class="hljs-property">target</span> <span class="hljs-keyword">as</span> <span class="hljs-title class_">HTMLDivElement</span>;
      <span class="hljs-keyword">const</span> currentScrollTop = target.<span class="hljs-property">scrollTop</span>;
      <span class="hljs-title function_">setScrollTop</span>(currentScrollTop);

      <span class="hljs-comment">// æ ‡è®°æ‰‹åŠ¨æ»šåŠ¨</span>
      scrollStateRef.<span class="hljs-property">current</span> = {
        <span class="hljs-attr">isManualScroll</span>: <span class="hljs-literal">true</span>,
        <span class="hljs-attr">lastScrollTop</span>: currentScrollTop,
      };

      <span class="hljs-comment">// æ£€æŸ¥æ˜¯å¦éœ€è¦åŠ è½½</span>
      <span class="hljs-keyword">const</span> shouldLoad = currentScrollTop &lt;= <span class="hljs-variable constant_">LOAD_THRESHOLD</span>;

      <span class="hljs-keyword">if</span> (
        shouldLoad &amp;&amp;
        !isLoadingRef.<span class="hljs-property">current</span> &amp;&amp;
        hasMoreRef.<span class="hljs-property">current</span> &amp;&amp;
        isInitialized
      ) {
        <span class="hljs-comment">// æ¸…é™¤ä¹‹å‰çš„é˜²æŠ–è®¡æ—¶å™¨</span>
        <span class="hljs-keyword">if</span> (loadTimerRef.<span class="hljs-property">current</span>) {
          <span class="hljs-built_in">clearTimeout</span>(loadTimerRef.<span class="hljs-property">current</span>);
        }

        <span class="hljs-comment">// é˜²æŠ–å¤„ç†</span>
        loadTimerRef.<span class="hljs-property">current</span> = <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
          <span class="hljs-keyword">if</span> (target.<span class="hljs-property">scrollTop</span> &lt;= <span class="hljs-variable constant_">LOAD_THRESHOLD</span> &amp;&amp; !isLoadingRef.<span class="hljs-property">current</span>) {
            <span class="hljs-title function_">loadNewMessages</span>();
          }
        }, <span class="hljs-number">100</span>);
      }
    },
    [isInitialized, loadNewMessages]
  );

  <span class="hljs-comment">// åˆå§‹åŒ–</span>
  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'ç»„ä»¶æŒ‚è½½ï¼Œå¼€å§‹åˆå§‹åŒ–'</span>);

    <span class="hljs-comment">// è®¾ç½®å®¹å™¨é«˜åº¦</span>
    <span class="hljs-keyword">if</span> (containerRef.<span class="hljs-property">current</span>) {
      <span class="hljs-keyword">const</span> computedHeight = <span class="hljs-variable language_">window</span>.<span class="hljs-property">innerHeight</span> - <span class="hljs-number">200</span>;
      containerRef.<span class="hljs-property">current</span>.<span class="hljs-property">style</span>.<span class="hljs-property">height</span> = <span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-built_in">Math</span>.max(<span class="hljs-number">200</span>, computedHeight)}</span>px`</span>;
    }

    <span class="hljs-title function_">initData</span>();

    <span class="hljs-comment">// æ¸…ç†å‡½æ•°</span>
    <span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'ç»„ä»¶å¸è½½ï¼Œæ¸…ç†å®šæ—¶å™¨'</span>);
      <span class="hljs-keyword">if</span> (loadTimerRef.<span class="hljs-property">current</span>) {
        <span class="hljs-built_in">clearTimeout</span>(loadTimerRef.<span class="hljs-property">current</span>);
      }
    };
  }, [initData]);

  <span class="hljs-comment">// ç›‘å¬æ€»é«˜åº¦å˜åŒ–ï¼Œåœ¨æ•°æ®å®Œå…¨æ¸²æŸ“åæ»šåŠ¨åˆ°åº•éƒ¨</span>
  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">if</span> (isInitialized &amp;&amp; totalHeight &gt; <span class="hljs-number">0</span> &amp;&amp; isFirstInitRef.<span class="hljs-property">current</span>) {
      <span class="hljs-comment">// å»¶è¿Ÿä¸€æ®µæ—¶é—´ç¡®ä¿DOMå®Œå…¨æ¸²æŸ“</span>
      <span class="hljs-keyword">const</span> timer = <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
        <span class="hljs-title function_">scrollToBottom</span>();
      }, <span class="hljs-number">300</span>); <span class="hljs-comment">// å¢åŠ å»¶è¿Ÿæ—¶é—´ï¼Œç¡®ä¿æ‰€æœ‰åˆ—è¡¨é¡¹éƒ½å·²æ¸²æŸ“å¹¶æµ‹é‡é«˜åº¦</span>

      <span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">clearTimeout</span>(timer);
    }
  }, [isInitialized, totalHeight, scrollToBottom]);

  <span class="hljs-comment">// ç›‘å¬åˆ—è¡¨æ•°æ®å˜åŒ–ï¼Œç¡®ä¿åœ¨é«˜åº¦æµ‹é‡åæ»šåŠ¨</span>
  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">if</span> (listData.<span class="hljs-property">length</span> &gt; <span class="hljs-number">0</span> &amp;&amp; isInitialized &amp;&amp; isFirstInitRef.<span class="hljs-property">current</span>) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'åˆ—è¡¨æ•°æ®æ›´æ–°ï¼Œå½“å‰æ•°æ®é‡:'</span>, listData.<span class="hljs-property">length</span>);

      <span class="hljs-comment">// å†ç»™ä¸€äº›æ—¶é—´è®©æ‰€æœ‰åˆ—è¡¨é¡¹å®Œæˆé«˜åº¦æµ‹é‡</span>
      <span class="hljs-keyword">const</span> timer = <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
        <span class="hljs-keyword">if</span> (isFirstInitRef.<span class="hljs-property">current</span>) {
          <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'é«˜åº¦æµ‹é‡åå°è¯•æ»šåŠ¨'</span>);
          <span class="hljs-title function_">scrollToBottom</span>();
        }
      }, <span class="hljs-number">500</span>);

      <span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">clearTimeout</span>(timer);
    }
  }, [listData.<span class="hljs-property">length</span>, isInitialized, scrollToBottom]);

  <span class="hljs-comment">// é‡ç½®æ‰‹åŠ¨æ»šåŠ¨æ ‡è®°</span>
  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">const</span> timer = <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
      scrollStateRef.<span class="hljs-property">current</span>.<span class="hljs-property">isManualScroll</span> = <span class="hljs-literal">false</span>;
    }, <span class="hljs-number">500</span>);
    <span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">clearTimeout</span>(timer);
  }, [scrollTop]);

  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"h-full bg-gradient-to-br from-indigo-600 to-purple-600 py-10 px-5"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span>
        <span class="hljs-attr">ref</span>=<span class="hljs-string">{containerRef}</span>
        <span class="hljs-attr">className</span>=<span class="hljs-string">"bg-white mt-10 rounded-xl border shadow-lg relative"</span>
      &gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span>
          <span class="hljs-attr">ref</span>=<span class="hljs-string">{virtualListRef}</span>
          <span class="hljs-attr">className</span>=<span class="hljs-string">"h-full overflow-auto relative"</span>
          <span class="hljs-attr">onScroll</span>=<span class="hljs-string">{handleScroll}</span>
          <span class="hljs-attr">style</span>=<span class="hljs-string">{{</span>
            <span class="hljs-attr">overflowAnchor:</span> '<span class="hljs-attr">none</span>',
            <span class="hljs-attr">overscrollBehavior:</span> '<span class="hljs-attr">contain</span>',
            <span class="hljs-attr">scrollBehavior:</span> '<span class="hljs-attr">auto</span>',
          }}
        &gt;</span>
          {/* åŠ è½½æç¤ºï¼ˆç»å¯¹å®šä½ï¼Œä¸å½±å“å¸ƒå±€ï¼‰ */}
          {isLoading &amp;&amp; (
            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"absolute top-0 left-0 right-0 z-10 py-2 flex justify-center items-center text-sm text-gray-500 "</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"flex items-center space-x-2"</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"w-4 h-4 border-2 border-blue-500 border-t-transparent rounded-full animate-spin"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>æ­£åœ¨åŠ è½½å†å²æ¶ˆæ¯...<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
              <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
          )}

          {/* åˆ—è¡¨å ä½å®¹å™¨ */}
          <span class="hljs-tag">&lt;<span class="hljs-name">div</span>
            <span class="hljs-attr">style</span>=<span class="hljs-string">{{</span>
              <span class="hljs-attr">height:</span> `${<span class="hljs-attr">totalHeight</span>}<span class="hljs-attr">px</span>`,
              <span class="hljs-attr">pointerEvents:</span> '<span class="hljs-attr">none</span>',
              <span class="hljs-attr">opacity:</span> <span class="hljs-attr">0</span>,
            }}
          &gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>

          {/* å¯è§†åŒºåŸŸå†…å®¹ */}
          <span class="hljs-tag">&lt;<span class="hljs-name">div</span>
            <span class="hljs-attr">className</span>=<span class="hljs-string">"absolute top-0 left-0 right-0"</span>
            <span class="hljs-attr">style</span>=<span class="hljs-string">{{</span>
              <span class="hljs-attr">transform:</span> `<span class="hljs-attr">translateY</span>(${<span class="hljs-attr">offsetY</span>}<span class="hljs-attr">px</span>)`,
              <span class="hljs-attr">width:</span> '<span class="hljs-attr">100</span>%',
            }}
          &gt;</span>
            {visibleList.length === 0 ? (
              <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"py-4 text-center text-gray-400"</span>&gt;</span>
                {listData.length === 0
                  ? 'æ­£åœ¨åˆå§‹åŒ–...'
                  : 'åŠ è½½æ›´å¤šå†å²æ¶ˆæ¯...'}
              <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
            ) : (
              visibleList.map((item) =&gt; (
                <span class="hljs-tag">&lt;<span class="hljs-name">VirtualListItem</span>
                  <span class="hljs-attr">key</span>=<span class="hljs-string">{item.id}</span>
                  <span class="hljs-attr">item</span>=<span class="hljs-string">{item}</span>
                  <span class="hljs-attr">onUpdateHeight</span>=<span class="hljs-string">{handleItemHeightUpdate}</span>
                /&gt;</span>
              ))
            )}
          <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>

          {/* æ²¡æœ‰æ›´å¤šæ•°æ®çš„æç¤º */}
          {!hasMore &amp;&amp; (
            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"absolute bottom-0 left-0 right-0 py-2 text-center text-sm text-gray-400 bg-white border-t"</span>&gt;</span>
              æ²¡æœ‰æ›´å¤šå†å²æ¶ˆæ¯äº†
            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
          )}
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  );
};

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title class_">VirtualList</span>;

</code></pre>
<h3 data-id="heading-15">2. å­ç»„ä»¶ï¼š</h3>
<pre><code class="hljs language-tsx" lang="tsx"><span class="hljs-keyword">import</span> <span class="hljs-title class_">React</span>, {
  useEffect,
  useRef,
  forwardRef,
  useImperativeHandle,
} <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">ListItemProps</span> {
  <span class="hljs-attr">item</span>: {
    <span class="hljs-attr">id</span>: <span class="hljs-built_in">number</span>;
    <span class="hljs-attr">content</span>: <span class="hljs-built_in">string</span>;
    <span class="hljs-attr">timestamp</span>: <span class="hljs-built_in">string</span>;
  };
  <span class="hljs-attr">onUpdateHeight</span>: <span class="hljs-function">(<span class="hljs-params">id: <span class="hljs-built_in">number</span>, height: <span class="hljs-built_in">number</span></span>) =&gt;</span> <span class="hljs-built_in">void</span>;
}

<span class="hljs-keyword">const</span> <span class="hljs-title class_">VirtualListItem</span> = forwardRef&lt;<span class="hljs-title class_">HTMLDivElement</span>, <span class="hljs-title class_">ListItemProps</span>&gt;(
  <span class="hljs-function">(<span class="hljs-params">{ item, onUpdateHeight }, ref</span>) =&gt;</span> {
    <span class="hljs-keyword">const</span> itemRef = useRef&lt;<span class="hljs-title class_">HTMLDivElement</span>&gt;(<span class="hljs-literal">null</span>);
    <span class="hljs-keyword">const</span> resizeObserverRef = useRef&lt;<span class="hljs-title class_">ResizeObserver</span> | <span class="hljs-literal">null</span>&gt;(<span class="hljs-literal">null</span>);

    <span class="hljs-title function_">useImperativeHandle</span>(ref, <span class="hljs-function">() =&gt;</span> {
      <span class="hljs-keyword">if</span> (itemRef.<span class="hljs-property">current</span>) {
        <span class="hljs-keyword">return</span> itemRef.<span class="hljs-property">current</span>;
      }
      <span class="hljs-comment">// æä¾›ä¸€ä¸ªå®‰å…¨çš„é»˜è®¤å€¼</span>
      <span class="hljs-keyword">const</span> emptyDiv = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createElement</span>(<span class="hljs-string">'div'</span>);
      <span class="hljs-keyword">return</span> emptyDiv;
    });

    <span class="hljs-comment">// ä½¿ç”¨ ResizeObserver ç›‘å¬å°ºå¯¸å˜åŒ–</span>
    <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> {
      <span class="hljs-keyword">const</span> <span class="hljs-title function_">updateHeight</span> = (<span class="hljs-params"/>) =&gt; {
        <span class="hljs-keyword">if</span> (itemRef.<span class="hljs-property">current</span>) {
          <span class="hljs-keyword">const</span> height = itemRef.<span class="hljs-property">current</span>.<span class="hljs-property">offsetHeight</span>;
          <span class="hljs-title function_">onUpdateHeight</span>(item.<span class="hljs-property">id</span>, height);
        }
      };

      <span class="hljs-comment">// ç«‹å³æ‰§è¡Œä¸€æ¬¡åˆå§‹æµ‹é‡</span>
      <span class="hljs-title function_">updateHeight</span>();

      <span class="hljs-keyword">if</span> (!resizeObserverRef.<span class="hljs-property">current</span>) {
        resizeObserverRef.<span class="hljs-property">current</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ResizeObserver</span>(<span class="hljs-function">() =&gt;</span> {
          <span class="hljs-comment">// é˜²æŠ–å¤„ç†ï¼Œé¿å…é¢‘ç¹è§¦å‘</span>
          <span class="hljs-keyword">if</span> (itemRef.<span class="hljs-property">current</span>) {
            <span class="hljs-title function_">requestAnimationFrame</span>(updateHeight);
          }
        });
      }

      <span class="hljs-keyword">if</span> (itemRef.<span class="hljs-property">current</span> &amp;&amp; resizeObserverRef.<span class="hljs-property">current</span>) {
        resizeObserverRef.<span class="hljs-property">current</span>.<span class="hljs-title function_">observe</span>(itemRef.<span class="hljs-property">current</span>);
      }

      <span class="hljs-comment">// é¢å¤–çš„åˆå§‹å»¶è¿Ÿæµ‹é‡ï¼Œç¡®ä¿æ ·å¼å·²åº”ç”¨</span>
      <span class="hljs-keyword">const</span> timer = <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
        <span class="hljs-title function_">updateHeight</span>();
      }, <span class="hljs-number">10</span>);

      <span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> {
        <span class="hljs-keyword">if</span> (resizeObserverRef.<span class="hljs-property">current</span> &amp;&amp; itemRef.<span class="hljs-property">current</span>) {
          resizeObserverRef.<span class="hljs-property">current</span>.<span class="hljs-title function_">unobserve</span>(itemRef.<span class="hljs-property">current</span>);
        }
        <span class="hljs-built_in">clearTimeout</span>(timer);
      };
    }, [item.<span class="hljs-property">id</span>, onUpdateHeight]);

    <span class="hljs-comment">// æ¨¡æ‹Ÿä¸åŒçš„å†…å®¹é«˜åº¦</span>
    <span class="hljs-keyword">const</span> <span class="hljs-attr">itemStyle</span>: <span class="hljs-title class_">React</span>.<span class="hljs-property">CSSProperties</span> = {
      <span class="hljs-attr">height</span>: item.<span class="hljs-property">id</span> % <span class="hljs-number">2</span> === <span class="hljs-number">0</span> ? <span class="hljs-string">'150px'</span> : <span class="hljs-string">'100px'</span>,
    };

    <span class="hljs-keyword">const</span> itemClass = <span class="hljs-string">`<span class="hljs-subst">${item.id % <span class="hljs-number">2</span> !== <span class="hljs-number">0</span> ? <span class="hljs-string">'bg-pink-200'</span> : <span class="hljs-string">'bg-green-200'</span>}</span>`</span>;

    <span class="hljs-keyword">return</span> (
      <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">{itemRef}</span> <span class="hljs-attr">className</span>=<span class="hljs-string">{itemClass}</span> <span class="hljs-attr">style</span>=<span class="hljs-string">{itemStyle}</span>&gt;</span>
        {item.id}
      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
    );
  }
);

<span class="hljs-title class_">VirtualListItem</span>.<span class="hljs-property">displayName</span> = <span class="hljs-string">'VirtualListItem'</span>;
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title class_">VirtualListItem</span>;

</code></pre>
<h3 data-id="heading-16">3. æ•ˆæœå›¾ï¼š</h3>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fefe968eb5944d8ebbe117392accb166~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y-R546w5LiA5Y-q5aSn5ZGG55Oc:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771153211&amp;x-signature=wa5927FGRiU2sQbFSSoCw9Y0hIo%3D" alt="reactè™šæ‹Ÿåˆ—è¡¨å‘ä¸ŠåŠ è½½.gif" loading="lazy"/></p>
<hr/>
<h2 data-id="heading-17">äº”ã€ æ³¨æ„äº‹é¡¹</h2>
<ul>
<li>
<p><strong>æµè§ˆå™¨å¹²æ‰°</strong>ï¼šå¿…é¡»è®¾ç½® <code>overflow-anchor: none</code>ã€‚ç°ä»£æµè§ˆå™¨å°è¯•è‡ªåŠ¨è°ƒæ•´æ»šåŠ¨ä½ç½®ï¼Œè¿™ä¼šä¸æˆ‘ä»¬çš„æ‰‹åŠ¨è¡¥å¿å†²çªã€‚</p>
</li>
<li>
<p><strong>ç´¢å¼•è¾¹ç•Œæ£€æŸ¥</strong>ï¼šå¯¹åˆ‡ç‰‡ç´¢å¼•æ‰§è¡Œ <code>Math.max(0, ...)</code> ä¸ <code>Math.min(total, ...)</code> çš„åŒºé—´æ”¶æ•›ï¼Œé˜²æ­¢å›  <code>startIndex</code> æˆ– <code>endIndex</code> è¶Šç•Œå¯¼è‡´çš„æ¸²æŸ“å¼‚å¸¸ã€‚</p>
</li>
<li>
<p><strong>åˆå§‹åŒ–æ—¶æœº</strong>ï¼šé¦–æ¬¡åŠ è½½æ•°æ®åï¼Œåº”è°ƒç”¨ <code>scrollToBottom()</code>ã€‚ä¸ºäº†ç¡®ä¿æ¸²æŸ“å®Œæˆï¼Œå»ºè®®é‡‡ç”¨ <code>requestAnimationFrame</code> + <code>setTimeout</code> çš„åŒé‡ä¿é™©ã€‚</p>
</li>
<li>
<p><strong>æ— æ„ŸåŠ è½½ç­–ç•¥</strong>ï¼šæ‰§è¡Œå¤´éƒ¨æ•°æ®æ’å…¥å‰ï¼Œéœ€å¿«ç…§è®°å½•å½“å‰çš„ <code>scrollHeight</code>ã€‚æ•°æ®æ¨é€è‡³æ¸²æŸ“å¼•æ“åï¼Œé€šè¿‡ <code>newScrollHeight - oldScrollHeight</code> ç®—å¾— <strong>ç©ºé—´å¢é‡</strong>ï¼Œå¹¶å°†å…¶ç´¯åŠ è‡³å½“å‰æ»šåŠ¨åç§»é‡ä¸Šã€‚è¯¥è¡¥å¿é€»è¾‘éœ€åœ¨æ¸²æŸ“åˆ·æ–°å‰å®Œæˆï¼Œä»¥å®ç°â€œæ— æ„ŸåŠ è½½â€</p>
</li>
<li>
<p><strong>æ€§èƒ½ç“¶é¢ˆ</strong>ï¼šéšç€ <code>listData</code> å¢åŠ åˆ°æ•°ä¸‡æ¡ï¼Œ<code>cumulativeHeights</code> çš„è®¡ç®—å¯èƒ½å˜æ…¢ã€‚æ­¤æ—¶å¯è€ƒè™‘<strong>åˆ†æ®µè®¡ç®—</strong>ç»´æŠ¤é«˜åº¦ã€‚</p>
</li>
</ul>
<hr/></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[è¯·æ±‚å¤´è®¾ç½®æ²¡æœ‰ç”Ÿæ•ˆ]]></title>    <link>https://juejin.cn/post/7603688142005026825</link>    <guid>https://juejin.cn/post/7603688142005026825</guid>    <pubDate>2026-02-08T08:58:23.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7603688142005026825" data-draft-id="7604037348606951462" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="è¯·æ±‚å¤´è®¾ç½®æ²¡æœ‰ç”Ÿæ•ˆ"/> <meta itemprop="keywords" content="åç«¯,Java"/> <meta itemprop="datePublished" content="2026-02-08T08:58:23.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ä½•ä¸­åº”"/> <meta itemprop="url" content="https://juejin.cn/user/1435305504958535"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            è¯·æ±‚å¤´è®¾ç½®æ²¡æœ‰ç”Ÿæ•ˆ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1435305504958535/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ä½•ä¸­åº”
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-08T08:58:23.000Z" title="Sun Feb 08 2026 08:58:23 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»1åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>è¯´æ˜ï¼šè®°å½•ä¸€æ¬¡ä½¿ç”¨kong.unirestå‘èµ·httpè¯·æ±‚ï¼Œæ·»åŠ è¯·æ±‚å¤´çš„å‘ã€‚</p>
<h2 data-id="heading-0">åœºæ™¯</h2>
<p>å‘èµ·ä¸€ä¸ªhttpè¯·æ±‚ï¼Œéœ€è¦å¸¦ä¸Šç­¾åç­‰è¯·æ±‚å¤´ï¼Œå¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-java" lang="java">	<span class="hljs-meta">@Override</span>
	<span class="hljs-keyword">protected</span> String <span class="hljs-title function_">run</span><span class="hljs-params">()</span> {
	   <span class="hljs-type">String</span> <span class="hljs-variable">dataString</span> <span class="hljs-operator">=</span> JSON.toJSONString(data);
	   <span class="hljs-type">String</span> <span class="hljs-variable">signature</span> <span class="hljs-operator">=</span> åŠ å¯†å·¥å…·ï¼Œç”Ÿæˆç­¾å(signPrivateKey, dataString);
	   <span class="hljs-comment">// å°†ç­¾åæ”¾åˆ°è¯·æ±‚å¤´ä¸­</span>
	   Unirest.config().getDefaultHeaders().add(<span class="hljs-string">"sign"</span>, sign);
	   HttpResponse&lt;String&gt; response = Unirest.post(url.toString())
	           .queryString(<span class="hljs-string">"type"</span>, type)
	           .contentType(ContentType.APPLICATION_JSON.toString())
	           .body(dataString)
	           .asString();
	
	   <span class="hljs-keyword">if</span> (response.isSuccess()) {
	       <span class="hljs-keyword">return</span> <span class="hljs-string">"è°ƒç”¨æˆåŠŸ"</span>;
	   }
	
	   <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Exception</span>(<span class="hljs-string">"è°ƒç”¨å¤±è´¥"</span>);
	}
</code></pre>
<p>æˆ‘ä½¿ç”¨ <code>Unirest.config().getDefaultHeaders().add("sign", sign);</code> çš„æ–¹å¼ï¼Œå°†æ•°æ®åŠ åˆ°è¯·æ±‚å¤´ä¸Šçš„ã€‚ç„¶ååœ¨è°ƒè¯•æ—¶ï¼Œå‘ç°é¦–æ¬¡é€šè¿‡éªŒè¯åï¼Œåé¢å–ç­¾åéªŒè¯ï¼Œéƒ½éªŒè¯ä¸é€šè¿‡ï¼Œå¾ˆç–‘æƒ‘ã€‚</p>
<h2 data-id="heading-1">è§£å†³</h2>
<p>å¢åŠ æ‰“å°æ—¥å¿—åï¼Œå‘ç°é™¤äº†é¦–æ¬¡ï¼Œåé¢ä¼ é€’è¿‡å»çš„ç­¾åè¯·æ±‚å¤´ <code>sign</code> éƒ½æ˜¯é¦–æ¬¡çš„æ•°æ®ã€‚è€Œçœ‹æˆ‘ä¸Šé¢çš„ä»£ç ï¼Œæ˜¯éœ€è¦æ ¹æ®æ¯æ¬¡çš„æ•°æ®å†…å®¹ï¼Œäº§ç”Ÿç­¾åï¼Œç„¶ååŠ åˆ°è¯·æ±‚å¤´ä¸Šã€‚å°±æ˜¯è¯´ï¼Œåé¢äº§ç”Ÿçš„<code>sign</code>ï¼Œæ²¡æœ‰è¦†ç›–ä¸Šä¸€æ¬¡è¯·æ±‚çš„<code>sign</code>ã€‚</p>
<p>ä¸èƒ½ç”¨ä¸Šé¢è¿™ç§æ–¹å¼ï¼Œè¦ç”¨ä¸‹é¢è¿™ç§ï¼š</p>
<pre><code class="hljs language-java" lang="java">	<span class="hljs-meta">@Override</span>
	<span class="hljs-keyword">protected</span> String <span class="hljs-title function_">run</span><span class="hljs-params">()</span> {
	    <span class="hljs-type">String</span> <span class="hljs-variable">dataString</span> <span class="hljs-operator">=</span> JSON.toJSONString(data);
	    <span class="hljs-type">String</span> <span class="hljs-variable">signature</span> <span class="hljs-operator">=</span> åŠ å¯†å·¥å…·ï¼Œç”Ÿæˆç­¾å(signPrivateKey, dataString);
	    HttpResponse&lt;String&gt; response = Unirest.post(url.toString())
	            .queryString(<span class="hljs-string">"type"</span>, type)
	            .contentType(ContentType.APPLICATION_JSON.toString())
	        	.header(<span class="hljs-string">"sign"</span>, sign)
	            .body(dataString)
	            .asString();
	
	    <span class="hljs-keyword">if</span> (response.isSuccess()) {
	        <span class="hljs-keyword">return</span> <span class="hljs-string">"è°ƒç”¨æˆåŠŸ"</span>;
	    }
	
	    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Exception</span>(<span class="hljs-string">"è°ƒç”¨å¤±è´¥"</span>);
	}
</code></pre>
<p>æ·»åŠ è¯·æ±‚å¤´ï¼Œè¦æ”¾åˆ°<code>Unirest.post</code>å‘èµ·è°ƒç”¨æ—¶</p>
<h2 data-id="heading-2">é¦–æ¬¡å‘å¸ƒ</h2>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fhezhongying.blog.csdn.net%2Farticle%2Fdetails%2F144166548" target="_blank" title="https://hezhongying.blog.csdn.net/article/details/144166548" ref="nofollow noopener noreferrer">hezhongying.blog.csdn.net/article/detâ€¦</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[è®©ä½ çš„æ•°æ®æˆä¸ºâ€œæ“ä½œæ—¥å¿—â€å’Œâ€œæ¨¡å‹é¥²æ–™â€ï¼šäº‹ä»¶æº¯æºã€CQRSä¸DataFrameæ¼«è°ˆ]]></title>    <link>https://juejin.cn/post/7603688142005010441</link>    <guid>https://juejin.cn/post/7603688142005010441</guid>    <pubDate>2026-02-08T08:58:17.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7603688142005010441" data-draft-id="7603651855237021705" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="è®©ä½ çš„æ•°æ®æˆä¸ºâ€œæ“ä½œæ—¥å¿—â€å’Œâ€œæ¨¡å‹é¥²æ–™â€ï¼šäº‹ä»¶æº¯æºã€CQRSä¸DataFrameæ¼«è°ˆ"/> <meta itemprop="keywords" content="æ¶æ„"/> <meta itemprop="datePublished" content="2026-02-08T08:58:17.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ä¸€ä¸ªéª‡å®¢"/> <meta itemprop="url" content="https://juejin.cn/user/644760908336608"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            è®©ä½ çš„æ•°æ®æˆä¸ºâ€œæ“ä½œæ—¥å¿—â€å’Œâ€œæ¨¡å‹é¥²æ–™â€ï¼šäº‹ä»¶æº¯æºã€CQRSä¸DataFrameæ¼«è°ˆ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/644760908336608/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ä¸€ä¸ªéª‡å®¢
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-08T08:58:17.000Z" title="Sun Feb 08 2026 08:58:17 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»8åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>èŠåˆ°æ•°æ®åº“ç±»å‹ï¼Œä½ å¤§æ¦‚ç†Ÿæ‚‰è§„è§„çŸ©çŸ©çš„è¡¨æ ¼ï¼ˆå…³ç³»å‹ï¼‰æˆ–è‡ªç”±æ•£æ¼«çš„æ–‡æ¡£ï¼ˆNoSQLï¼‰ã€‚ä½†ä»Šå¤©ï¼Œæˆ‘ä»¬æ¢è®¿ä¸¤ä¸ªæ›´â€œæœ‰æ€§æ ¼â€çš„é¢†åŸŸï¼šä¸€ä¸ªè®©æ•°æ®æˆä¸ºä¸€æœ¬å¯éšæ—¶æŸ¥é˜…ã€æ°¸ä¸ç£¨ç­çš„â€œæ“ä½œæ—¥å¿—â€ï¼Œå¦ä¸€ä¸ªåˆ™å°†æ•°æ®é‡å¡‘ä¸ºæœºå™¨å­¦ä¹ ç®—æ³•æœ€çˆ±çš„â€œæ ‡å‡†é¤â€ã€‚å®ƒä»¬å°±æ˜¯ <strong>äº‹ä»¶æº¯æºï¼ˆEvent Sourcingï¼‰</strong> ä¸ <strong>DataFrame</strong>ã€‚</p>
<h2 data-id="heading-0">ç¬¬ä¸€éƒ¨åˆ†ï¼šç»™æ•°æ®ä¸€æœ¬â€œä¸å¯ç¯¡æ”¹çš„è´¦ç°¿â€ â€”â€” äº‹ä»¶æº¯æºä¸ CQRS</h2>
<p>æƒ³è±¡ä½ åœ¨ç©ä¸€æ¬¾ç­–ç•¥æ¸¸æˆã€‚ä¼˜ç§€çš„æ¸¸æˆä¸ä»…ä¿å­˜æœ€ç»ˆå­˜æ¡£ï¼Œæ›´ä¼šå®Œæ•´è®°å½•ä½ çš„æ¯ä¸€æ­¥æ“ä½œï¼šâ€œç¬¬3å›åˆï¼Œåœ¨Aåœ°å»ºé€ äº†å†œåœºâ€ï¼Œâ€œç¬¬7å›åˆï¼Œä¸Bå›½ç­¾ç½²äº†è´¸æ˜“åå®šâ€ã€‚å‡­å€Ÿè¿™ä»½è¯¦å°½çš„â€œæˆ˜æŠ¥â€ï¼Œä½ ä¸ä»…èƒ½å¤ç›˜ä»»ä½•æ—¶åˆ»çš„å±€åŠ¿ï¼Œè¿˜èƒ½æ·±åº¦åˆ†ææ¯ä¸ªå†³ç­–çš„ä¼˜åŠ£ã€‚è¿™æ­£æ˜¯ <strong>äº‹ä»¶æº¯æº</strong> çš„æ ¸å¿ƒç†å¿µã€‚</p>
<p><strong>äº‹ä»¶æº¯æºï¼ˆEvent Sourcing, ESï¼‰</strong> ä¸»å¼ ï¼š<strong>ä¸ç›´æ¥å­˜å‚¨ç³»ç»Ÿçš„å½“å‰çŠ¶æ€ï¼ˆå¦‚è´¦æˆ·ä½™é¢ã€åº“å­˜é‡ï¼‰ï¼Œè€Œæ˜¯å­˜å‚¨æ‰€æœ‰å¯¼è‡´çŠ¶æ€å˜åŒ–çš„å†å²äº‹ä»¶ï¼ˆEventsï¼‰</strong>ã€‚æ¯ä¸ªäº‹ä»¶éƒ½æ˜¯è¿‡å»å‘ç”Ÿçš„ã€ä¸å¯æ›´æ”¹çš„äº‹å®ï¼Œä¾‹å¦‚ <code>ç”¨æˆ·æ³¨å†Œ</code>ã€<code>è´¦æˆ·å……å€¼200å…ƒ</code>ã€<code>å•†å“å‡ºåº“5ä»¶</code>ã€‚</p>
<h3 data-id="heading-1">CQRSï¼šè®©â€œä¼šè®¡â€ä¸â€œåˆ†æå¸ˆâ€å„å¸å…¶èŒ</h3>
<p>ä»…æœ‰è¯¦ç»†â€œæˆ˜æŠ¥â€è¿˜ä¸å¤Ÿï¼Œæˆ‘ä»¬è¿˜éœ€å¿«é€Ÿå›ç­”è¯¸å¦‚â€œæˆ‘å½“å‰æœ‰å¤šå°‘èµ„æºï¼Ÿâ€ã€â€œä¸Šå‘¨å“ªç§èµ„æºæ¶ˆè€—æœ€å¿«ï¼Ÿâ€ç­‰é—®é¢˜ã€‚è¿™æ—¶ï¼Œå®ƒçš„é»„é‡‘æ­æ¡£ <strong>å‘½ä»¤æŸ¥è¯¢èŒè´£åˆ†ç¦»ï¼ˆCommand Query Responsibility Segregation, CQRSï¼‰</strong> ä¾¿é—ªäº®ç™»åœºã€‚</p>
<pre><code class="hljs language-mermaid" lang="mermaid">flowchart TD
    subgraph ClientLayer [å®¢æˆ·å±‚]
        A[Web/ç§»åŠ¨ç«¯] --&gt; B[APIç½‘å…³]
        C[ç®¡ç†åå°] --&gt; B
    end

    subgraph CommandSide [å‘½ä»¤å±‚]
        B --&gt; D{å‘½ä»¤è·¯ç”±å™¨}
        D --&gt; E[è´¦æˆ·å‘½ä»¤å¤„ç†å™¨]
        D --&gt; F[äº¤æ˜“å‘½ä»¤å¤„ç†å™¨]
        D --&gt; G[è®¢å•å‘½ä»¤å¤„ç†å™¨]
        
        E --&gt; H[è´¦æˆ·é¢†åŸŸæ¨¡å‹]
        F --&gt; I[äº¤æ˜“é¢†åŸŸæ¨¡å‹]
        G --&gt; J[è®¢å•é¢†åŸŸæ¨¡å‹]
        
        H --&gt; K[ç”Ÿæˆäº‹ä»¶]
        I --&gt; K
        J --&gt; K
        
        K --&gt; L[(äº‹ä»¶å­˜å‚¨&lt;br&gt;Event Store)]
    end

    subgraph EventProcessing [äº‹ä»¶å¤„ç†å±‚]
        L --&gt; M[äº‹ä»¶æ€»çº¿/æ¶ˆæ¯é˜Ÿåˆ—]
        M --&gt; N[è´¦æˆ·ä½™é¢æŠ•å½±]
        M --&gt; O[äº¤æ˜“å†å²æŠ•å½±]
        M --&gt; P[å®¢æˆ·ç”»åƒæŠ•å½±]
        M --&gt; Q[å®æ—¶ä»ªè¡¨ç›˜æŠ•å½±]
    end

    subgraph QuerySide [æŸ¥è¯¢å±‚]
        N --&gt; R[(è´¦æˆ·ä½™é¢è§†å›¾)]
        O --&gt; S[(äº¤æ˜“å†å²è§†å›¾)]
        P --&gt; T[(å®¢æˆ·ç”»åƒè§†å›¾)]
        Q --&gt; U[(å®æ—¶ä»ªè¡¨ç›˜è§†å›¾)]
        
        R --&gt; V[è´¦æˆ·æŸ¥è¯¢æœåŠ¡]
        S --&gt; V
        T --&gt; V
        U --&gt; V
        
        V --&gt; B
    end

    style CommandSide fill:#e1f5fe
    style EventProcessing fill:#fff3e0
    style QuerySide fill:#f3e5f5
</code></pre>
<p>ä¸Šé¢çš„æ¶æ„å±•ç¤ºäº†CQRSåœ¨é‡‘èæˆ–ç”µå•†ç³»ç»Ÿä¸­çš„å®é™…åº”ç”¨ï¼š</p>
<ul>
<li><strong>å‘½ä»¤ç«¯ï¼ˆCommand Sideï¼‰</strong>ï¼šä½œä¸ºä¸¥è°¨çš„"ä¼šè®¡éƒ¨é—¨"ï¼Œå®ƒï¼š
<ul>
<li>é€šè¿‡APIç½‘å…³æ¥æ”¶ç”¨æˆ·çš„å†™æ“ä½œæŒ‡ä»¤ï¼ˆå¦‚"è½¬è´¦"ã€"ä¸‹å•"ï¼‰</li>
<li>ç”±ä¸“é—¨çš„å‘½ä»¤å¤„ç†å™¨éªŒè¯ä¸šåŠ¡è§„åˆ™</li>
<li>é€šè¿‡é¢†åŸŸæ¨¡å‹æ‰§è¡Œä¸šåŠ¡é€»è¾‘ï¼Œç”Ÿæˆå¯¹åº”çš„äº‹ä»¶</li>
<li>å°†æ‰€æœ‰äº‹ä»¶æŒä¹…åŒ–åˆ°<strong>äº‹ä»¶å­˜å‚¨ï¼ˆEvent Storeï¼‰</strong>Â ä¸­</li>
</ul>
</li>
<li><strong>äº‹ä»¶å¤„ç†å±‚ï¼ˆEvent Processingï¼‰</strong>ï¼šè¿™æ˜¯è¿æ¥ä¼šè®¡éƒ¨é—¨ä¸åˆ†æéƒ¨é—¨çš„æ¡¥æ¢ï¼š
<ul>
<li>äº‹ä»¶å­˜å‚¨ä¸­çš„æ–°äº‹ä»¶è¢«å‘å¸ƒåˆ°äº‹ä»¶æ€»çº¿æˆ–æ¶ˆæ¯é˜Ÿåˆ—</li>
<li>å¤šä¸ª<strong>æŠ•å½±å¤„ç†å™¨ï¼ˆProjection Handlerï¼‰</strong>Â ç›‘å¬è¿™äº›äº‹ä»¶</li>
<li>æ¯ä¸ªå¤„ç†å™¨è´Ÿè´£ç»´æŠ¤ç‰¹å®šç”¨é€”çš„ç‰©åŒ–è§†å›¾</li>
</ul>
</li>
<li><strong>æŸ¥è¯¢ç«¯ï¼ˆQuery Sideï¼‰</strong>ï¼šä½œä¸ºçµæ´»çš„"åˆ†æéƒ¨é—¨"ï¼Œå®ƒï¼š
<ul>
<li>ç»´æŠ¤ç€å„ç§ä¼˜åŒ–åçš„ç‰©åŒ–è§†å›¾ï¼ˆå¦‚è´¦æˆ·ä½™é¢ã€äº¤æ˜“å†å²ã€å®¢æˆ·ç”»åƒï¼‰</li>
<li>æä¾›ä¸“é—¨çš„æŸ¥è¯¢æœåŠ¡ï¼Œå“åº”å®¢æˆ·ç«¯çš„è¯»è¯·æ±‚</li>
<li>æ¯ä¸ªè§†å›¾éƒ½å¯ä»¥ä½¿ç”¨æœ€é€‚åˆå…¶æŸ¥è¯¢æ¨¡å¼çš„æ•°æ®å­˜å‚¨æŠ€æœ¯</li>
</ul>
</li>
</ul>
<p><strong>è¿™å¥—â€œä¼šè®¡+åˆ†æå¸ˆâ€çš„æ¶æ„ä¸ºä½•å¼ºå¤§ï¼Ÿ</strong></p>
<ol>
<li><strong>å®Œæ•´çš„çœŸç›¸ä¹‹æº</strong>ï¼šäº‹ä»¶æ—¥å¿—æ˜¯ç³»ç»Ÿçš„å”¯ä¸€äº‹å®æ¥æºã€‚ä»»ä½•æŸ¥è¯¢ç»“æœï¼ˆç‰©åŒ–è§†å›¾ï¼‰éƒ½å¯ä»¥é€šè¿‡â€œé‡æ’­â€æ‰€æœ‰äº‹ä»¶æ¥é‡æ–°è®¡ç®—å’ŒéªŒè¯ã€‚å½“æŸä»½â€œæŠ¥è¡¨â€å‡ºé”™æ—¶ï¼Œåªéœ€è®©å¯¹åº”çš„åˆ†æå¸ˆ<strong>æ ¹æ®åŸå§‹è´¦ç°¿é‡ç®—ä¸€é</strong>å³å¯ã€‚è¿™åœ¨å¤æ‚çš„ä¸šåŠ¡ç³»ç»Ÿä¸­æä¾›äº†â€œæ—¶é—´æ—…è¡Œâ€èˆ¬çš„è°ƒè¯•èƒ½åŠ›ã€‚</li>
<li><strong>èŒè´£åˆ†ç¦»ï¼Œæè‡´ä¼˜åŒ–</strong>ï¼šè¯»å†™è·¯å¾„å®Œå…¨åˆ†ç¦»ï¼Œå…è®¸å„è‡ªç‹¬ç«‹æ‰©å±•ä¸ä¼˜åŒ–ã€‚å†™å…¥ç«¯å¯ä»¥ä¸“æ³¨äºé«˜ååçš„äº‹ä»¶è®°å½•ï¼Œè¯»å–ç«¯åˆ™å¯ä»¥é’ˆå¯¹ä¸åŒçš„æŸ¥è¯¢æ¨¡å¼æ„å»ºæœ€åˆé€‚çš„ç´¢å¼•ä¸å­˜å‚¨ç»“æ„ã€‚</li>
<li><strong>æ— ä¸ä¼¦æ¯”çš„å¯æ¼”è¿›æ€§</strong>ï¼šå½“éœ€è¦ä¸€ä¸ªæ–°çš„æ•°æ®è§†è§’ï¼ˆå¦‚æ–°çš„æŠ¥è¡¨ï¼‰æ—¶ï¼Œä½ æ— éœ€ä¿®æ”¹å·²æœ‰çš„â€œè®°è´¦â€é€»è¾‘ï¼Œåªéœ€æ–°å¢ä¸€ä¸ªâ€œåˆ†æå¸ˆâ€ï¼ˆæ–°çš„ç‰©åŒ–è§†å›¾ï¼‰ï¼Œè®©ä»–ä»å†å²äº‹ä»¶ä¸­æ¨å¯¼å‡ºæ–°æŠ¥è¡¨ã€‚ç³»ç»Ÿå¯¹ä¸šåŠ¡å˜åŒ–çš„é€‚åº”èƒ½åŠ›æå¼ºã€‚</li>
<li><strong>å†…ç½®çš„å®¡è®¡çº¿ç´¢</strong>ï¼šå®Œæ•´çš„äº‹ä»¶åºåˆ—æœ¬èº«å°±æ˜¯æœ€å¤©ç„¶çš„å®¡è®¡æ—¥å¿—ï¼Œæ»¡è¶³äº†é‡‘èã€åŒ»ç–—ç­‰å¼ºç›‘ç®¡é¢†åŸŸçš„åˆè§„æ€§è¦æ±‚ã€‚</li>
</ol>
<p><strong>å½“ç„¶ï¼Œå®ƒä¹Ÿä¸æ˜¯ç‚¹çŸ³æˆé‡‘çš„é­”æ³•ï¼š</strong></p>
<ul>
<li><strong>â€œé‡æ”¾â€çš„ä¸€è‡´æ€§æŒ‘æˆ˜</strong>ï¼šå¦‚æœäº‹ä»¶å¤„ç†é€»è¾‘ä¾èµ–äºå¤–éƒ¨æœåŠ¡ï¼ˆå¦‚è°ƒç”¨æ±‡ç‡æ¥å£ï¼‰ï¼Œé‚£ä¹ˆâ€œé‡æ”¾â€å†å²äº‹ä»¶æ—¶å¿…é¡»èƒ½è·å–åˆ°<strong>å½“æ—¶</strong>çš„æ±‡ç‡ï¼Œå¦åˆ™è®¡ç®—ç»“æœä¼šâ€œç©¿è¶Šâ€ã€‚</li>
<li><strong>éšç§æ•°æ®çš„â€œæ©¡çš®æ“¦â€éš¾é¢˜</strong>ï¼šæ³•è§„è¦æ±‚åˆ é™¤ç”¨æˆ·ä¸ªäººæ•°æ®ã€‚ä½†äº‹ä»¶ä¸å¯å˜ï¼Œå¦‚ä½•â€œæ“¦é™¤â€ï¼Ÿè¿™éœ€è¦ç²¾å·§çš„è®¾è®¡ï¼Œæ¯”å¦‚åªå­˜å‚¨æ•°æ®å¼•ç”¨ï¼Œæˆ–åœ¨å­˜å‚¨æ—¶è¿›è¡ŒåŠ å¯†å¹¶ä¿ç®¡å¥½å¯†é’¥ï¼ˆCrypto-Shreddingï¼‰ã€‚</li>
<li><strong>å°å¿ƒâ€œé‡å¤é€šçŸ¥â€</strong>ï¼šé‡æ”¾äº‹ä»¶æ—¶ï¼Œå¿…é¡»ç¡®ä¿ä¸ä¼šå†æ¬¡è§¦å‘å‘é€é‚®ä»¶ã€çŸ­ä¿¡ç­‰å¤–éƒ¨å‰¯ä½œç”¨ã€‚</li>
</ul>
<h2 data-id="heading-2">ç¬¬äºŒéƒ¨åˆ†ï¼šæŠŠæ•°æ®åšæˆâ€œæœºå™¨å­¦ä¹ æ ‡å‡†é¤â€ â€”â€” DataFrameã€çŸ©é˜µä¸æ•°ç»„</h2>
<p>ç°åœ¨ï¼Œè®©æˆ‘ä»¬ä»è®°å½•ä¸€åˆ‡çš„â€œå†å²å­¦å®¶â€ï¼Œåˆ‡æ¢åˆ°ä¸ºæœºå™¨å­¦ä¹ æ¨¡å‹å‡†å¤‡â€œè¥å…»é¤â€çš„â€œæ•°æ®å¨å¸ˆâ€ã€‚</p>
<p>æ•°æ®ç§‘å­¦å®¶å’Œåˆ†æå¸ˆä»¬é’Ÿçˆ±çš„å·¥å…· <strong>DataFrame</strong>ï¼Œå¯ä»¥è¢«çœ‹ä½œä¸€ä¸ª<strong>åŠŸèƒ½å¼ºå¤§çš„å†…å­˜ä¸­çš„æ™ºèƒ½è¡¨æ ¼</strong>ï¼ˆPythonçš„Pandasã€Rè¯­è¨€ã€Apache Sparkä¸­çš„æ ¸å¿ƒæ¦‚å¿µï¼‰ã€‚</p>
<p>DataFrame çš„æ ¸å¿ƒä»»åŠ¡æ˜¯<strong>æ•°æ®è§„æ•´ï¼ˆData Wranglingï¼‰</strong>ï¼šå¦‚åŒå¨å¸ˆå¤„ç†é£Ÿæï¼Œå®ƒè¿›è¡Œæ¸…æ´—ã€åˆ‡ç‰‡ã€è°ƒå‘³â€”â€”åŒ…æ‹¬è¿‡æ»¤ã€è½¬æ¢æ ¼å¼ã€åˆå¹¶ã€åˆ†ç»„èšåˆç­‰æ“ä½œï¼Œå°†åŸå§‹æ‚ä¹±çš„â€œç”Ÿæ•°æ®â€ï¼Œçƒ¹é¥ªæˆå¹²å‡€ã€ç»“æ„åŒ–çš„â€œå¯ç”¨æ•°æ®â€ã€‚</p>
<h3 data-id="heading-3">ä»è¡¨æ ¼åˆ°â€œæ•°å­—é­”æ–¹â€ï¼šçŸ©é˜µä¸æ•°ç»„çš„è½¬æ¢è‰ºæœ¯</h3>
<p>DataFrame æœ€ç¥å¥‡çš„èƒ½åŠ›ä¹‹ä¸€ï¼Œæ˜¯èƒ½è½»æ¾åœ°å°†å…³ç³»å‹è¡¨æ ¼æ•°æ®ï¼Œè½¬æ¢æˆæœºå™¨å­¦ä¹ å’Œæ•°å€¼è®¡ç®—æ‰€éœ€çš„â€œæ ‡å‡†æ ¼å¼â€â€”â€”<strong>çŸ©é˜µï¼ˆMatrixï¼‰</strong> å’Œ<strong>å¤šç»´æ•°ç»„ï¼ˆArrayï¼‰</strong>ã€‚</p>
<p>ä¸ºäº†æ›´ç›´è§‚åœ°ç†è§£è¿™ä¸ªè¿‡ç¨‹ï¼Œè®©æˆ‘ä»¬é€šè¿‡ä¸€ä¸ª"é¡¾å®¢-å•†å“è´­ä¹°è®°å½•"çš„å®é™…ä¾‹å­æ¥çœ‹çœ‹DataFrameå¦‚ä½•å°†è¡¨æ ¼æ•°æ®è½¬æ¢ä¸ºçŸ©é˜µï¼š</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># åŸå§‹è´­ä¹°è®°å½•è¡¨ï¼ˆå…³ç³»å‹è¡¨ç¤ºï¼‰</span>
purchase_records = [
    {<span class="hljs-string">"customer_id"</span>: <span class="hljs-string">"C001"</span>, <span class="hljs-string">"product_id"</span>: <span class="hljs-string">"P100"</span>, <span class="hljs-string">"purchase_count"</span>: <span class="hljs-number">2</span>},
    {<span class="hljs-string">"customer_id"</span>: <span class="hljs-string">"C001"</span>, <span class="hljs-string">"product_id"</span>: <span class="hljs-string">"P205"</span>, <span class="hljs-string">"purchase_count"</span>: <span class="hljs-number">1</span>},
    {<span class="hljs-string">"customer_id"</span>: <span class="hljs-string">"C002"</span>, <span class="hljs-string">"product_id"</span>: <span class="hljs-string">"P100"</span>, <span class="hljs-string">"purchase_count"</span>: <span class="hljs-number">1</span>},
    {<span class="hljs-string">"customer_id"</span>: <span class="hljs-string">"C003"</span>, <span class="hljs-string">"product_id"</span>: <span class="hljs-string">"P880"</span>, <span class="hljs-string">"purchase_count"</span>: <span class="hljs-number">5</span>},
    {<span class="hljs-string">"customer_id"</span>: <span class="hljs-string">"C003"</span>, <span class="hljs-string">"product_id"</span>: <span class="hljs-string">"P205"</span>, <span class="hljs-string">"purchase_count"</span>: <span class="hljs-number">3</span>},
]

<span class="hljs-comment"># è½¬æ¢ä¸ºDataFrame</span>
<span class="hljs-keyword">import</span> pandas <span class="hljs-keyword">as</span> pd
df = pd.DataFrame(purchase_records)
<span class="hljs-built_in">print</span>(<span class="hljs-string">"åŸå§‹è´­ä¹°è®°å½•è¡¨ï¼š"</span>)
<span class="hljs-built_in">print</span>(df)

<span class="hljs-comment"># ä½¿ç”¨pivotæ“ä½œè½¬æ¢ä¸ºçŸ©é˜µå½¢å¼</span>
matrix_df = df.pivot(index=<span class="hljs-string">'customer_id'</span>, 
                     columns=<span class="hljs-string">'product_id'</span>, 
                     values=<span class="hljs-string">'purchase_count'</span>).fillna(<span class="hljs-number">0</span>)
<span class="hljs-built_in">print</span>(<span class="hljs-string">"\nè½¬æ¢åçš„é¡¾å®¢-å•†å“çŸ©é˜µï¼š"</span>)
<span class="hljs-built_in">print</span>(matrix_df)
</code></pre>
<p>è¿è¡Œè¿™æ®µä»£ç ï¼Œä½ ä¼šçœ‹åˆ°è¿™æ ·çš„è½¬æ¢ç»“æœï¼š</p>
<pre><code class="hljs">åŸå§‹è´­ä¹°è®°å½•è¡¨ï¼š
  customer_id product_id  purchase_count
0        C001       P100               2
1        C001       P205               1
2        C002       P100               1
3        C003       P880               5
4        C003       P205               3

è½¬æ¢åçš„é¡¾å®¢-å•†å“çŸ©é˜µï¼š
product_id   P100  P205  P880
customer_id                  
C001          2.0   1.0   0.0
C002          1.0   0.0   0.0
C003          0.0   3.0   5.0
</code></pre>
<p>åœ¨è¿™ä¸ªçŸ©é˜µä¸­ï¼Œ<strong>è¡Œæ˜¯é¡¾å®¢ï¼Œåˆ—æ˜¯å•†å“ï¼Œå•å…ƒæ ¼çš„å€¼æ˜¯è´­ä¹°æ¬¡æ•°</strong>ã€‚è¿™ä¸ªçŸ©é˜µé€šå¸¸æ˜¯<strong>ç¨€ç–ï¼ˆSparseï¼‰</strong> çš„ï¼Œå› ä¸ºå¤§å¤šæ•°é¡¾å®¢åªè´­ä¹°è¿‡å°‘æ•°å•†å“ã€‚</p>
<p>ä¸ºäº†"å–‚ç»™"æ¨èç³»ç»Ÿç­‰æœºå™¨å­¦ä¹ ç®—æ³•ï¼Œæˆ‘ä»¬è¿˜éœ€å°†æ–‡æœ¬ç±»ä¿¡æ¯ï¼ˆå¦‚å•†å“ç±»åˆ«"ç”µå­äº§å“"ã€"å›¾ä¹¦"ï¼‰è½¬åŒ–ä¸ºæ•°å­—ã€‚å¸¸ç”¨æŠ€å·§æ˜¯<strong>ç‹¬çƒ­ç¼–ç ï¼ˆOne-Hot Encodingï¼‰</strong>ï¼šä¸ºæ¯ä¸ªç±»åˆ«åˆ›å»ºä¸€ä¸ªæ–°çš„äºŒè¿›åˆ¶åˆ—ã€‚</p>
<p>æœ€ç»ˆï¼Œæˆ‘ä»¬å¾—åˆ°ä¸€ä¸ªçº¯ç²¹çš„ã€é«˜ç»´çš„æ•°å€¼çŸ©é˜µï¼Œè¿™æ­£æ˜¯ååŒè¿‡æ»¤ã€åˆ†ç±»ã€èšç±»ç­‰ä¼—å¤šæœºå™¨å­¦ä¹ ç®—æ³•å¯ç›´æ¥æ¶ˆåŒ–çš„"æ ‡å‡†è¾“å…¥"ã€‚</p>
<h3 data-id="heading-4">ä¸“ä¸šâ€œå†·åº“â€ï¼šæ•°ç»„æ•°æ®åº“</h3>
<p>å½“æ•°æ®å¤©ç”Ÿå°±æ˜¯æµ·é‡ã€è§„æ•´çš„å¤šç»´æ•°å­—æ—¶ï¼ˆå¦‚å«æ˜Ÿå½±åƒæ•°æ®ã€åŸºå› åºåˆ—ã€é‡‘èæ—¶é—´åºåˆ—ï¼‰ï¼Œä¸“é—¨çš„ <strong>æ•°ç»„æ•°æ®åº“ï¼ˆArray Databaseï¼‰</strong>ï¼Œå¦‚TileDBï¼Œä¾¿å¤§æ˜¾èº«æ‰‹ã€‚å®ƒä»¬å¦‚åŒä¸ºç‰¹å®šå½¢çŠ¶è®¾è®¡çš„è¶…çº§å†°æŸœï¼Œèƒ½æè‡´é«˜æ•ˆåœ°å­˜å‚¨å’ŒæŸ¥è¯¢è¿™äº›åºå¤§çš„å¤šç»´æ•°å€¼â€œæ•°æ®å—â€ã€‚</p>
<p><strong>DataFrameçš„é­…åŠ›åœ¨äºï¼š</strong>
å®ƒæ˜¯ä¸€åº§<strong>åŠ¨æ€çš„ã€å¼ºå¤§çš„æ¡¥æ¢</strong>ï¼Œä¼˜é›…åœ°è¿æ¥ç€å­˜å‚¨åŸå§‹æ•°æ®çš„â€œä¸šåŠ¡ä¸–ç•Œâ€ä¸éœ€è¦æ•°å€¼åŒ–è¾“å…¥çš„â€œç®—æ³•ä¸–ç•Œâ€ã€‚æ•°æ®ç§‘å­¦å®¶åœ¨æ­¤æ¡¥ä¸Šå®Œæˆä»æ•°æ®è·å–ã€æ¸…æ´—ã€è½¬æ¢åˆ°æ¨¡å‹è¾“å…¥çš„å…¨æµç¨‹ã€‚</p>
<h2 data-id="heading-5">æ€»ç»“ï¼šé€‰æ‹©ä½ çš„â€œæ•°æ®è¶…èƒ½åŠ›â€</h2>
<p>æˆ‘ä»¬å¿«é€Ÿé¢†ç•¥äº†æ•°æ®æ¨¡å‹å®‡å®™çš„ä¸€è§’ï¼š</p>
<ul>
<li><strong>äº‹ä»¶æº¯æº + CQRS</strong> èµ‹äºˆä½  <strong>â€œå®Œæ•´å†å²å›æº¯â€ä¸â€œè¯»å†™è§£è€¦ä¼˜åŒ–â€</strong> çš„è¶…èƒ½åŠ›ã€‚å®ƒæ˜¯å¤æ‚ä¸šåŠ¡ç³»ç»Ÿã€äº¤æ˜“å¹³å°ã€éœ€è¦å¼ºå®¡è®¡è¿½æº¯åœºæ™¯çš„åˆ©å™¨ã€‚</li>
<li><strong>DataFrameä¸çŸ©é˜µ</strong> èµ‹äºˆä½  <strong>â€œæ•æ·æ•°æ®æ¢ç´¢â€ä¸â€œæ— ç¼ç®—æ³•å¯¹æ¥â€</strong> çš„è¶…èƒ½åŠ›ã€‚å®ƒæ˜¯æ•°æ®ç§‘å­¦ã€æœºå™¨å­¦ä¹ æµæ°´çº¿ä¸Šæ— å¯æ›¿ä»£çš„æ ¸å¿ƒå·¥å…·ã€‚</li>
</ul>
<p>æ²¡æœ‰ä¸‡èƒ½çš„æ•°æ®æ¨¡å‹ã€‚å…³ç³»æ¨¡å‹æ˜¯ç¨³å¥çš„åŸºçŸ³ï¼Œæ–‡æ¡£æ¨¡å‹å¤„ç†æ ‘å½¢æ•°æ®å¾—å¿ƒåº”æ‰‹ï¼Œå›¾æ¨¡å‹æ“…é•¿æŒ–æ˜å¤æ‚å…³ç³»ã€‚è€Œäº‹ä»¶æº¯æºå’ŒDataFrameï¼Œåˆ™åœ¨è§£å†³â€œå®Œæ•´å†å²â€ä¸â€œçµæ´»åˆ†æâ€è¿™ä¸¤ç±»ç‰¹å®šç—›ç‚¹ä¸Šï¼Œå±•ç°äº†å…¶ç‹¬ç‰¹è€Œå¼ºå¤§çš„ä»·å€¼ã€‚</p>
<p>ä¸‹æ¬¡å½“ä½ è®¾è®¡ç³»ç»Ÿæˆ–åˆ†ææ•°æ®æ—¶ï¼Œä¸å¦¨æ€è€ƒï¼šæˆ‘çš„æ•°æ®ï¼Œæ›´éœ€è¦ä¸€æœ¬å¯ä¾›éšæ—¶è¿½æº¯ã€æ¨æ¼”çš„â€œæ°¸æ’æ—¥å¿—â€ï¼Œè¿˜æ˜¯ä¸€ä¸ªå¯ä»¥è‡ªç”±å¡‘å½¢ã€ç›´æ¥å–‚å…»æ™ºèƒ½æ¨¡å‹çš„â€œæ•°å­—å¨æˆ¿â€ï¼Ÿç­”æ¡ˆå°†æŒ‡å¼•ä½ æ‰¾åˆ°æœ€åˆé€‚çš„â€œè¶…èƒ½åŠ›â€ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[solidityè¿›é˜¶]]></title>    <link>https://juejin.cn/post/7603769956975509545</link>    <guid>https://juejin.cn/post/7603769956975509545</guid>    <pubDate>2026-02-08T09:23:32.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7603769956975509545" data-draft-id="7603643044035117092" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="solidityè¿›é˜¶"/> <meta itemprop="keywords" content="Solidity"/> <meta itemprop="datePublished" content="2026-02-08T09:23:32.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="unturn"/> <meta itemprop="url" content="https://juejin.cn/user/3810252135601915"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            solidityè¿›é˜¶
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3810252135601915/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    unturn
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-08T09:23:32.000Z" title="Sun Feb 08 2026 09:23:32 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    5
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»36åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h3 data-id="heading-0">1ã€å‡½æ•°é‡è½½</h3>
<h4 data-id="heading-1">1.1å‡½æ•°é‡è½½</h4>
<p>solidityä¸­å…è®¸å‡½æ•°è¿›è¡Œé‡è½½ï¼Œå³åå­—ç›¸åŒä½†è¾“å…¥å‚æ•°ç±»å‹ä¸åŒçš„å‡½æ•°å¯ä»¥åŒæ—¶å­˜åœ¨ï¼Œä»–ä»¬è¢«è§†ä¸ºä¸åŒçš„å‡½æ•°ï¼Œæ³¨æ„ï¼Œsilidityä¸å…è®¸ä¿®é¥°å™¨é‡è½½ã€‚</p>
<p>æˆ‘ä»¬å®šä¹‰ä¸¤ä¸ªéƒ½å«saySomething() çš„å‡½æ•°ï¼Œä¸€ä¸ªæ²¡æœ‰ä»»ä½•å‚æ•°ï¼Œè¾“å‡ºNothingï¼›å¦ä¸€ä¸ªæ¥æ”¶ä¸€ä¸ªstringå‚æ•°ï¼Œè¾“å‡ºè¿™ä¸ªstring</p>
<pre><code class="hljs language-solidity" lang="solidity">function saySomething() public pure returns(string memory){
		return("Nothing")
}
function saySomething(string memory something) public pure returns(string memory){
		return("something")
}
</code></pre>
<p>è¿”å›äº†ä¸åŒçš„ç»“æœï¼Œè¢«åŒºåˆ†ä¸ºä¸åŒçš„å‡½æ•°ã€‚</p>
<p>1.2å®å‚åŒ¹é…</p>
<p>åœ¨è°ƒç”¨é‡è½½å‡½æ•°æ—¶ï¼Œä¼šæŠŠè¾“å…¥çš„å®é™…å‚æ•°å’Œå‡½æ•°å‚æ•°çš„å˜é‡ç±»å‹åšåŒ¹é…ã€‚å¦‚æœå‡ºç°å¤šä¸ªåŒ¹é…çš„</p>
<h3 data-id="heading-2">2ã€åº“åˆçº¦</h3>
<p>æˆ‘ä»¬ç”¨Stringsåº“åˆçº¦çš„toHexString()`æ¥æ¼”ç¤ºä¸¤ç§ä½¿ç”¨åº“åˆçº¦ä¸­å‡½æ•°çš„åŠæ³•ã€‚</p>
<ol>
<li>åˆ©ç”¨using foræŒ‡ä»¤ æŒ‡ä»¤using A for B;å¯ç”¨äºé™„åŠ åº“åˆçº¦ï¼ˆä»åº“ Aï¼‰åˆ°ä»»ä½•ç±»å‹ï¼ˆBï¼‰ã€‚æ·»åŠ å®ŒæŒ‡ä»¤åï¼Œåº“Aä¸­çš„å‡½æ•°ä¼šè‡ªåŠ¨æ·»åŠ ä¸ºBç±»å‹å˜é‡çš„æˆå‘˜ï¼Œå¯ä»¥ç›´æ¥è°ƒç”¨ã€‚æ³¨æ„ï¼šåœ¨è°ƒç”¨çš„æ—¶å€™ï¼Œè¿™ä¸ªå˜é‡ä¼šè¢«å½“ä½œç¬¬ä¸€ä¸ªå‚æ•°ä¼ é€’ç»™å‡½æ•°ï¼š</li>
</ol>
<pre><code class="hljs language-solidity" lang="solidity">// åˆ©ç”¨using foræŒ‡ä»¤
using Strings for uint256;
function getString1(uint256 _number) public pure returns(string memory){
    // åº“åˆçº¦ä¸­çš„å‡½æ•°ä¼šè‡ªåŠ¨æ·»åŠ ä¸ºuint256å‹å˜é‡çš„æˆå‘˜
    return _number.toHexString();
}
</code></pre>
<p>2.é€šè¿‡åº“åˆçº¦åç§°è°ƒç”¨å‡½æ•°</p>
<pre><code class="hljs language-solidity" lang="solidity">// ç›´æ¥é€šè¿‡åº“åˆçº¦åè°ƒç”¨
function getString2(uint256 _number) public pure returns(string memory){
    return Strings.toHexString(_number);
}
</code></pre>
<h3 data-id="heading-3">3ã€Import</h3>
<p>æ–¹å¼ 1ï¼šç›¸å¯¹è·¯å¾„ç›´æ¥å¯¼å…¥ï¼ˆæœ€å¸¸ç”¨ï¼Œæœ¬åœ°æ–‡ä»¶ï¼‰</p>
<pre><code class="hljs language-solidity" lang="solidity">// ç¤ºä¾‹ï¼šå½“å‰æ–‡ä»¶åœ¨ ./contracts/ ä¸‹ï¼Œå¯¼å…¥åŒç›®å½•çš„ IERC20.sol æ¥å£
import "./IERC20.sol";

// ç¤ºä¾‹ï¼šå¯¼å…¥ä¸Šçº§ç›®å½•çš„ utils/Context.sol
import "../utils/Context.sol";

// ç¤ºä¾‹ï¼šå¯¼å…¥å­ç›®å½•çš„ library/SafeMath.sol
import "./library/SafeMath.sol";

contract MyERC20 is IERC20 { // ç›´æ¥ä½¿ç”¨å¯¼å…¥çš„æ¥å£
    // ...
}
</code></pre>
<p>æ–¹å¼ 2ï¼šæŒ‰éœ€å¯¼å…¥æŒ‡å®šå†…å®¹</p>
<pre><code class="hljs language-solidity" lang="solidity">// ç¤ºä¾‹ï¼šä» ERC20.sol ä¸­ä»…å¯¼å…¥ ERC20 åˆçº¦å’Œ IERC20 æ¥å£ï¼Œå…¶ä»–å†…å®¹ä¸å¯¼å…¥
import { ERC20, IERC20 } from "./ERC20.sol";

// ç¤ºä¾‹ï¼šä»å…¬å…±æ–‡ä»¶ä¸­å¯¼å…¥ç»“æ„ä½“å’Œæšä¸¾
import { TokenType, TokenInfo } from "./common/Structs.sol";

contract MyToken is ERC20 { // ç›´æ¥ä½¿ç”¨æŒ‰éœ€å¯¼å…¥çš„åˆçº¦
    TokenInfo public tokenInfo; // ç›´æ¥ä½¿ç”¨å¯¼å…¥çš„ç»“æ„ä½“
}
</code></pre>
<p>æ–¹å¼ 3ï¼šnpm åŒ…è·¯å¾„å¯¼å…¥ï¼ˆç”Ÿäº§ä¸»æµï¼Œç¬¬ä¸‰æ–¹åº“ï¼‰</p>
<pre><code class="hljs language-solidity" lang="solidity">// ç¤ºä¾‹1ï¼šå¯¼å…¥ OpenZeppelin çš„ ERC20 æ ‡å‡†åˆçº¦ï¼ˆæœ€å¸¸ç”¨ï¼‰
import "@openzeppelin/contracts/token/ERC20/ERC20.sol";
// ç¤ºä¾‹2ï¼šå¯¼å…¥ OpenZeppelin çš„å®‰å…¨è½¬è´¦åº“
import "@openzeppelin/contracts/token/ERC20/utils/SafeERC20.sol";
// ç¤ºä¾‹3ï¼šå¯¼å…¥ Uniswap V2 å·¥å‚åˆçº¦æ¥å£
import "@uniswap/v2-core/contracts/interfaces/IUniswapV2Factory.sol";

contract MyOpenZeppelinToken is ERC20 {
    constructor() ERC20("OZToken", "OZT") {
        _mint(msg.sender, 1000 * 10 ** decimals());
    }
}
</code></pre>
<h3 data-id="heading-4">4ã€æ¥æ”¶ETH</h3>
<h4 data-id="heading-5">4.1 æ¥æ”¶ETH  receive</h4>
<p>receive()å‡½æ•°æ˜¯åˆçº¦æ”¶åˆ°ETHè½¬è´¦æ—¶è¢«è°ƒç”¨å¾—å‡½æ•°ã€‚ä¸€ä¸ªåˆçº¦æœ€å¤šæœ‰ä¸€ä¸ªreceive()å‡½æ•°ï¼Œå£°æ˜æ–¹å¼ä¸ä¸€èˆ¬å‡½æ•°ä¸ä¸€æ ·ï¼Œä¸éœ€è¦functionå…³é”®å­—ï¼šreceive() external payable{...}.receive() å‡½æ•°ä¸èƒ½æœ‰ä»»ä½•çš„å‚æ•°ï¼Œä¸èƒ½è¿”å›ä»»ä½•å€¼ï¼Œå¿…é¡»åŒ…å«external å’Œ payable.</p>
<p>å½“åˆçº¦æ¥æ”¶ETHçš„æ—¶å€™ï¼Œreceive() ä¼šè¢«è§¦å‘ã€‚receive()æœ€åä¸è¦æ‰§è¡Œå¤ªå¤šçš„é€»è¾‘å› ä¸ºå¦‚æœåˆ«äººç”¨send å’Œ transfer æ–¹æ³•å‘é€ETHçš„è¯ï¼Œgasä¼šé™åˆ¶åœ¨ 2300ï¼Œreceive()å¤ªå¤æ‚å¯èƒ½ä¼šè§¦å‘Out of GasæŠ¥é”™ã€‚å¦‚æœç”¨callå°±å¯ä»¥è‡ªå®šä¹‰gasæ‰§è¡Œæ›´å¤æ‚çš„é€»è¾‘ï¼ˆè¿™ä¸‰ç§å‘é€ETHçš„æ–¹æ³•æˆ‘ä»¬ä¹‹åä¼šè®²åˆ°ï¼‰ã€‚</p>
<p>æˆ‘ä»¬åœ¨receive() é‡Œå‘é€ä¸€ä¸ªevent,ä¾‹å¦‚ï¼š</p>
<pre><code class="hljs language-solidity" lang="solidity">// å®šä¹‰äº‹ä»¶
event Received(address Sender, uint Value);
// æ¥æ”¶ETHæ—¶é‡Šæ”¾Receivedäº‹ä»¶
receive() external payable {
    emit Received(msg.sender, msg.value);
}
</code></pre>
<h4 data-id="heading-6">4.2 å›é€€å‡½æ•°fallback</h4>
<p>fallback()å‡½æ•°ä¼šåœ¨è°ƒç”¨åˆçº¦ä¸å­˜åœ¨çš„å‡½æ•°æ—¶è§¦å‘ã€‚å¯ç”¨äºæ¥æ”¶ETH,ä¹Ÿå¯ä»¥ç”¨äºä»£ç†åˆçº¦proxy contract. fallback() å£°æ˜æ—¶ä¸éœ€è¦functionå…³é”®å­—ï¼Œå¿…é¡»ç”±externalä¿®é¥°ï¼Œä¸€èˆ¬ä¹Ÿä¼šç”¨payableä¿®é¥°ï¼Œç”¨äºæ¥æ”¶æ¥æ”¶ETH: fallback() external payable{...}.</p>
<p>æˆ‘ä»¬å®šä¹‰ä¸€ä¸ªfallback()å‡½æ•°ï¼Œè¢«è§¦å‘æ—¶å€™ä¼šé‡Šæ”¾fallbackCalledäº‹ä»¶ï¼Œå¹¶è¾“å‡ºmsg.senderï¼Œmsg.valueå’Œmsg.data:</p>
<pre><code class="hljs language-solidity" lang="solidity">event fallbackCalled(address Sender, uint Value, bytes Data);

// fallback
fallback() external payable{
    emit fallbackCalled(msg.sender, msg.value, msg.data);
}
</code></pre>
<h4 data-id="heading-7">4.3 receiveå’Œfallbackçš„åŒºåˆ«</h4>
<p>receiveå’Œfallbackéƒ½èƒ½å¤Ÿç”¨äºæ¥æ”¶ETHï¼Œä»–ä»¬è§¦å‘çš„è§„åˆ™å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-scss" lang="scss">è§¦å‘<span class="hljs-built_in">fallback</span>() è¿˜æ˜¯ <span class="hljs-built_in">receive</span>()?
           æ¥æ”¶ETH
              |
         msg<span class="hljs-selector-class">.data</span>æ˜¯ç©ºï¼Ÿ
            /  \
          æ˜¯    å¦
          /      \
<span class="hljs-built_in">receive</span>()å­˜åœ¨?   <span class="hljs-built_in">fallback</span>()
        / \
       æ˜¯  å¦
      /     \
<span class="hljs-built_in">receive</span>()   <span class="hljs-built_in">fallback</span>()

</code></pre>
<p>ç®€å•æ¥è¯´ï¼Œåˆçº¦æ¥æ”¶ETHæ—¶ï¼Œmsg.dataä¸ºç©ºä¸”å­˜åœ¨receive()æ—¶ï¼Œä¼šè§¦å‘receive()ï¼›msg.dataä¸ä¸ºç©ºæˆ–ä¸å­˜åœ¨receive()æ—¶ï¼Œä¼šè§¦å‘fallback()ï¼Œæ­¤æ—¶fallback()å¿…é¡»ä¸ºpayableã€‚</p>
<p>receive()å’Œpayable fallback()å‡ä¸å­˜åœ¨çš„æ—¶å€™ï¼Œå‘åˆçº¦ç›´æ¥å‘é€ETHå°†ä¼šæŠ¥é”™ï¼ˆä½ ä»å¯ä»¥é€šè¿‡å¸¦æœ‰payableçš„å‡½æ•°å‘åˆçº¦å‘é€ETHï¼‰ã€‚</p>
<p>æ¡ˆä¾‹</p>
<pre><code class="hljs language-solidity" lang="solidity">// SPDX-License-Identifier: MIT
pragma solidity ^0.8.20;

// receive/Fallback  æ¡ˆä¾‹
contract ReceiveFallbackTest{
    //è®°å½•receive çš„è§¦å‘
    event ReceiveTriggered(address indexed sender, uint256 amount);

    //è®°å½•fallback çš„è§¦å‘
    event FaballTriggered(address indexed sender, uint256 amount, bytes data);

    //æ— calldataçš„è½¬è´¦
    receive() external payable { 
        emit ReceiveTriggered(msg.sender, msg.value); //è§¦å‘äº‹ä»¶ï¼Œæ‰“å°å‘é€è€…å’ŒETHé‡‘é¢
    }

    fallback() external payable {
        emit FaballTriggered(msg.sender, msg.value, msg.data); //æ‰“å°å‘é€è€…ã€é‡‘é¢ã€é™„å¸¦çš„calldata
    }

    function getContractBalance() external view returns (uint256) {
        return address(this).balance;
    }


}
</code></pre>
<h3 data-id="heading-8">5ã€å‘é€ETH</h3>
<p>callæ²¡æœ‰gasé™åˆ¶ï¼Œæœ€ä¸ºçµæ´»ï¼Œæ˜¯æœ€æå€¡çš„æ–¹æ³•</p>
<p>ç”¨æ³•æ˜¯æ¥æ”¶æ–¹åœ°å€.call{value: å‘é€ETHæ•°é¢}("")ã€‚
call()æ²¡æœ‰gasé™åˆ¶ï¼Œå¯ä»¥æ”¯æŒå¯¹æ–¹åˆçº¦fallback()æˆ–receive()å‡½æ•°å®ç°å¤æ‚é€»è¾‘ã€‚
call()å¦‚æœè½¬è´¦å¤±è´¥ï¼Œä¸ä¼šrevertã€‚
call()çš„è¿”å›å€¼æ˜¯(bool, bytes)ï¼Œå…¶ä¸­boolä»£è¡¨ç€è½¬è´¦æˆåŠŸæˆ–å¤±è´¥ï¼Œéœ€è¦é¢å¤–ä»£ç å¤„ç†ä¸€ä¸‹ã€‚</p>
<p>ç»“åˆæ¥æ”¶ETHçš„æ¡ˆä¾‹</p>
<pre><code class="hljs language-solidity" lang="solidity">// SPDX-License-Identifier: MIT
pragma solidity ^0.8.20;

contract CallTest{
    //äº‹ä»¶: è®°å½•callè°ƒç”¨ç»“æœ
    event CallResult(address indexed target,bool success, uint256 sendAmount, bytes data);

    //åœºæ™¯ä¸€ï¼šç”¨callçº¯è½¬ETH(è§¦å‘ç›®æ ‡åˆçº¦receive)
    //å‚æ•°ï¼š_target ç›®æ ‡åˆçº¦åœ°å€(è§¦å‘ç›®æ ‡åˆçº¦çš„receive)
    //å‚æ•°ï¼š_amount è½¬ETHé‡‘é¢
    function callTransferETH(address payable _target, uint256 _amount) external payable {
        //æ ¸å¿ƒï¼šcallçº¯è½¬ETH,calldataä¼ ç©ºå­—ç¬¦ä¸²
        (bool success, bytes memory data) = _target.call{value:_amount}("");

        //å¿…é¡»åˆ¤æ–­success,å¤±è´¥åˆ™å›æ»š
        require(success,"Call transfer ETH failed");

        //è§¦å‘äº‹ä»¶ï¼Œè®°å½•è°ƒç”¨ç»“æœ
        emit CallResult(_target,success, _amount,data);
    }

    // åœºæ™¯ä¸€ï¼šç”¨callçº¯è½¬ETH(è§¦å‘ç›®æ ‡åˆçº¦fallback)
    // å‚æ•°ï¼š_target ç›®æ ‡åˆçº¦åœ°å€ï¼›_amount è½¬ETHé‡‘é¢ï¼›_data è‡ªå®šä¹‰calldataï¼ˆæ¯”å¦‚0x1234ï¼‰
    function callTransferETHWithData(address payable _target, uint256 _amount, bytes calldata _data) external payable {
        // æ ¸å¿ƒï¼šcallå¸¦calldataè½¬ETHï¼Œä¼ å…¥è‡ªå®šä¹‰_data
        (bool success, bytes memory data) = _target.call{value: _amount}(_data);
        
        require(success, "Call transfer ETH with data failed");

        emit CallResult(_target, success, _amount, data);
    }

    // è¾…åŠ©å‡½æ•°ï¼šæŸ¥è¯¢å½“å‰CallTeståˆçº¦çš„ETHä½™é¢ï¼ˆæµ‹è¯•åéªŒè¯ï¼‰
    function getCallContractBalance() external view returns (uint256) {
        return address(this).balance;
    }
}
</code></pre>
<h3 data-id="heading-9">6ã€è°ƒç”¨å…¶ä»–åˆçº¦</h3>
<p>4ä¸ªè°ƒç”¨åˆçº¦çš„ä¾‹å­</p>
<pre><code class="hljs language-solidity" lang="solidity">// SPDX-License-Identifier: MIT
pragma solidity ^0.8.20;

contract OtherContract {
    uint256 private _x = 0;
    //æ”¶åˆ°EThçš„äº‹ä»¶ï¼Œè®°å½•amount å’Œ gas
    event Log(uint amount, uint gas);

    //è¿”å›åˆçº¦ETHä½™é¢
    function getBalance() view public returns (uint) {
        return address(this).balance;
    }

    //å¯ä»¥è°ƒæ•´çŠ¶æ€å˜é‡_xçš„å‡½æ•°ï¼Œå¹¶ä¸”å¯ä»¥å¾€åˆçº¦è½¬ETH(payable)
    function setX(uint256 x) external payable {
        _x = x;
        //å¦‚æœè½¬å…¥ETH, åˆ™é‡Šæ”¾Logäº‹ä»¶
        if(msg.value &gt; 0 ){
            emit Log(msg.value, gasleft());
        }
    }

    //è¯»å–_x
    function getX() external view returns(uint x){
        x = _x;
    }
}

contract CallContract{
    //1.ä¼ å…¥åˆçº¦åœ°å€
    //å¤åˆ¶OtherContractåˆçº¦çš„åœ°å€ï¼Œå¡«å…¥callSetXå‡½æ•°çš„å‚æ•°ä¸­ï¼ŒæˆåŠŸè°ƒç”¨åï¼Œè°ƒç”¨OtherContractåˆçº¦ä¸­çš„getXéªŒè¯xå˜ä¸º123
    function callSetX(address _Address,uint256 x) external {
        OtherContract(_Address).setX(x);
    }
    //2.ä¼ å…¥åˆçº¦å˜é‡
    //å¤åˆ¶OtherContractåˆçº¦çš„åœ°å€ï¼Œå¡«å…¥callGetXå‡½æ•°çš„å‚æ•°ä¸­ï¼Œè°ƒç”¨åæˆåŠŸè·å–xçš„å€¼
    function callCetX(OtherContract _Address) external view returns(uint x) {
        x = _Address.getX();
    }
    //3.åˆ›å»ºåˆçº¦å˜é‡
    //å¤åˆ¶OtherContractåˆçº¦çš„åœ°å€ï¼Œå¡«å…¥callGetX2å‡½æ•°çš„å‚æ•°ä¸­ï¼Œè°ƒç”¨åæˆåŠŸè·å–xçš„å€¼
    function callGetX2(address _Address) external view returns (uint x){
        OtherContract oc = OtherContract(_Address);
        x = oc.getX();
    }
    //4.è°ƒç”¨åˆçº¦å¹¶å‘é€ETH
    //å¤åˆ¶OtherContractåˆçº¦çš„åœ°å€ï¼Œå¡«å…¥setXTransferETHå‡½æ•°çš„å‚æ•°ä¸­ï¼Œå¹¶è½¬å…¥10ETH
    function setXtransferETH(address otherContract,uint256 x) payable external {
        OtherContract(otherContract).setX{value:msg.value}(x);
    }
}
</code></pre>
<p>æ¡ˆä¾‹</p>
<pre><code class="hljs language-solidity" lang="solidity">// SPDX-License-Identifier: MIT
pragma solidity ^0.8.20;
// è¢«è°ƒç”¨åˆçº¦ï¼šç®€å•è®¡ç®—å™¨
contract Calculator {
    function add(uint256 a, uint256 b) external pure returns (uint256) {
        return a + b;
    }
}

contract CalculatorCaller {
    Calculator public calculator;

    constructor(address _calcAddress) {
        calculator = Calculator(_calcAddress);
    }

    // è°ƒç”¨è®¡ç®—å™¨çš„ add å‡½æ•°ï¼Œç›´æ¥è¿”å›ç»“æœ
    function callAdd(uint256 a, uint256 b) external view returns (uint256) {
        return calculator.add(a, b);
    }
}
</code></pre>
<h3 data-id="heading-10">7ã€call</h3>
<p>callæ˜¯addressç±»å‹çš„ä½çº§æˆå‘˜å‡½æ•°ï¼Œå®ƒç”¨æ¥ä¸å…¶ä»–åˆçº¦äº¤äº’ã€‚å®ƒçš„è¿”å›å€¼ä¸º(bool,bytes memory),åˆ†åˆ«å¯¹åº”callæ˜¯å¦æˆåŠŸä»¥åŠå‡½æ•°çš„è¿”å›å€¼ã€‚</p>
<p>â€‹	callæ˜¯solidityå®˜æ–¹æ¨èé€šè¿‡è§¦å‘fallbackæˆ–è€…receiveå‡½æ•°å‘é€ETHçš„æ–¹æ³•ã€‚</p>
<p>â€‹	ä¸æ¨èç”¨callæ¥è°ƒç”¨å¦ä¸€ä¸ªåˆçº¦ï¼Œå› ä¸ºå½“ä½ è°ƒç”¨ä¸å®‰å…¨åˆçº¦çš„å‡½æ•°æ—¶ï¼Œä½ å°±æŠŠä¸»åŠ¨æƒäº¤ç»™äº†å®ƒã€‚æ¨èçš„æ–¹æ³•ä»æ˜¯å£°æ˜åˆçº¦å˜é‡åè°ƒç”¨å‡½æ•°ã€‚</p>
<p>â€‹	å½“æˆ‘ä»¬ä¸çŸ¥é“å¯¹æ–¹åˆçº¦çš„æºä»£ç æˆ–ABI,å°±æ²¡æ³•ç”Ÿæˆåˆçº¦å˜é‡ï¼›è¿™æ—¶ï¼Œæˆ‘ä»¬ä»å¯ä»¥é€šè¿‡callè°ƒç”¨å¯¹æ–¹åˆçº¦çš„å‡½æ•°ã€‚</p>
<h4 data-id="heading-11">callçš„ä½¿ç”¨è§„åˆ™</h4>
<pre><code class="hljs language-ini" lang="ini">ç›®æ ‡åˆçº¦åœ°å€.call(å­—èŠ‚ç )<span class="hljs-comment">;</span>
</code></pre>
<p>â€‹    å­—èŠ‚ç åˆ©ç”¨ç»“æ„åŒ–ç¼–ç¨‹å‡½æ•°abi.encodeWithSignatureè·å¾—ï¼š</p>
<pre><code class="hljs language-arduino" lang="arduino">abi.<span class="hljs-built_in">encodeWithSignature</span>(<span class="hljs-string">"å‡½æ•°ç­¾å"</span>,é€—å·åˆ†éš”çš„å…·ä½“å‚æ•°)

å‡½æ•°ç­¾åä¸º â€œå‡½æ•°åï¼ˆé€—å·åˆ†éš”çš„å‚æ•°ç±»å‹ï¼‰â€ã€‚ ä¾‹å¦‚abi.<span class="hljs-built_in">encodeWithSignature</span>(<span class="hljs-string">"f(uint256,address)"</span>,_x,_addr)
</code></pre>
<p>å¦å¤–callåœ¨è°ƒç”¨åˆçº¦æ—¶å¯ä»¥æŒ‡å®šäº¤æ˜“å‘é€çš„ETHæ•°é¢å’Œgasæ•°é¢ï¼š</p>
<pre><code class="hljs language-css" lang="css">ç›®æ ‡åˆçº¦åœ°å€<span class="hljs-selector-class">.call</span>{value:å‘é€æ•°é¢ï¼Œgas:gasæ•°é¢}(å­—èŠ‚ç );
</code></pre>
<h4 data-id="heading-12">æ¡ˆä¾‹</h4>
<p>ç›®æ ‡åˆçº¦</p>
<pre><code class="hljs language-solidity" lang="solidity">contract OtherContract {
//                    è¿”å›å€¼å«ä¹‰                   å•ä½     ç±»å‹
//msg.value	          è°ƒç”¨å‡½æ•°æ—¶é™„å¸¦è½¬å…¥çš„ ETH æ•°é‡	   wei	 uint256
//address(this).balance	     åˆçº¦å½“å‰çš„ ETH ä½™é¢	  wei	uint256
//gasleft()         æ‰§è¡Œåˆ°å½“å‰è¡Œçš„å‰©ä½™å¯ä½¿ç”¨ Gas é‡    gas 	uint256

    uint256 private _x = 0; // çŠ¶æ€å˜é‡x
    // æ”¶åˆ°ethçš„äº‹ä»¶ï¼Œè®°å½•amountå’Œgas
    event Log(uint amount, uint gas);X
    
    fallback() external payable{}

    // è¿”å›åˆçº¦ETHä½™é¢
    function getBalance() view public returns(uint) {
        return address(this).balance;
    }

    // å¯ä»¥è°ƒæ•´çŠ¶æ€å˜é‡_xçš„å‡½æ•°ï¼Œå¹¶ä¸”å¯ä»¥å¾€åˆçº¦è½¬ETH (payable)
    function setX(uint256 x) external payable{
        _x = x;
        // å¦‚æœè½¬å…¥ETHï¼Œåˆ™é‡Šæ”¾Logäº‹ä»¶
        if(msg.value &gt; 0){
            emit Log(msg.value, gasleft());
        }
    }

    // è¯»å–x
    function getX() external view returns(uint x){
        x = _x;
    }
}
</code></pre>
<h4 data-id="heading-13">åˆ©ç”¨callè°ƒç”¨ç›®æ ‡åˆçº¦</h4>
<pre><code class="hljs language-solidity" lang="solidity">contract call {
    // å®šä¹‰Responseäº‹ä»¶ï¼Œè¾“å‡ºcallè¿”å›çš„ç»“æœsuccesså’Œdata
    event Response(bool success, bytes data);

    function callSetX(address payable _addr, uint256 x) public payable {
    // call setX()ï¼ŒåŒæ—¶å¯ä»¥å‘é€ETH
    (bool success, bytes memory data) = _addr.call{value: msg.value}(
        abi.encodeWithSignature("setX(uint256)", x)
    );

    emit Response(success, data); //é‡Šæ”¾äº‹ä»¶
}
    function callGetX(address _addr) external returns(uint256){
    // call getX()
    (bool success, bytes memory data) = _addr.call(
        abi.encodeWithSignature("getX()")
    );

    emit Response(success, data); //é‡Šæ”¾äº‹ä»¶
    return abi.decode(data, (uint256));
}

function callNonExist(address _addr) external{
    // call ä¸å­˜åœ¨çš„å‡½æ•°
    (bool success, bytes memory data) = _addr.call(
        abi.encodeWithSignature("foo(uint256)")
    );

    emit Response(success, data); //é‡Šæ”¾äº‹ä»¶
}

}
</code></pre>
<h5 data-id="heading-14">1.è°ƒç”¨setXå‡½æ•°</h5>
<p>è°ƒç”¨callSetXæŠŠçŠ¶æ€å˜é‡_xæ”¹ä¸º5ï¼Œå‚æ•°ä¸ºOtherContractåœ°å€å’Œ5ï¼Œç”±äºç›®æ ‡å‡½æ•°setX()æ²¡æœ‰è¿”å›å€¼ï¼Œå› æ­¤Responseäº‹ä»¶è¾“å‡ºçš„dataä¸º0xï¼Œä¹Ÿå°±æ˜¯ç©ºã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/36c4f63f5c034ab3a687b68688f0396c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgdW50dXJu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771148048&amp;x-signature=AEYNMbe%2FW5vMwlhgqqWTEigxRwo%3D" alt="22-1" loading="lazy"/></p>
<h5 data-id="heading-15">2.è°ƒç”¨getXå‡½æ•°</h5>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8b320896f3884d3e820d3c4ad1775b65~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgdW50dXJu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771148048&amp;x-signature=HTboQov9LFNoClQmu7AxIX6%2BRFY%3D" alt="img" loading="lazy"/></p>
<h5 data-id="heading-16">4.è°ƒç”¨ä¸å­˜åœ¨çš„å‡½æ•°</h5>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6243fc0a708b40deb9eb9c0684d7cb0d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgdW50dXJu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771148048&amp;x-signature=4z%2FdtqGDH96zHO8v46awCayHvMQ%3D" alt="22-3" loading="lazy"/></p>
<p>ä¸Šé¢ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬calläº†ä¸å­˜åœ¨çš„fooå‡½æ•°ã€‚callä»èƒ½æ‰§è¡ŒæˆåŠŸï¼Œå¹¶è¿”å›successï¼Œä½†å…¶å®è°ƒç”¨çš„ç›®æ ‡åˆçº¦fallbackå‡½æ•°ã€‚</p>
<h3 data-id="heading-17">8ã€delegatecall</h3>



































<table><thead><tr><th>ç‰¹æ€§</th><th><code>call</code>ï¼ˆæ™®é€šå¤–éƒ¨è°ƒç”¨ï¼‰</th><th><code>delegatecall</code>ï¼ˆå§”æ‰˜è°ƒç”¨ï¼‰</th></tr></thead><tbody><tr><td><strong>å­˜å‚¨ï¼ˆStorageï¼‰</strong></td><td>æ‰§è¡Œç›®æ ‡åˆçº¦çš„ä»£ç ï¼Œè¯»å†™<strong>ç›®æ ‡åˆçº¦</strong>çš„å­˜å‚¨</td><td>æ‰§è¡Œç›®æ ‡åˆçº¦çš„ä»£ç ï¼Œè¯»å†™<strong>å½“å‰åˆçº¦</strong>çš„å­˜å‚¨</td></tr><tr><td><strong>ä¸Šä¸‹æ–‡ï¼ˆContextï¼‰</strong></td><td><code>msg.sender</code> = å½“å‰åˆçº¦åœ°å€ï¼›<code>msg.value</code> ä¼ é€’</td><td><code>msg.sender</code> = åŸå§‹è°ƒç”¨è€…åœ°å€ï¼›<code>msg.value</code> ä¿ç•™</td></tr><tr><td><strong>ä»£ç å½’å±</strong></td><td>æ‰§è¡Œçš„æ˜¯ç›®æ ‡åˆçº¦çš„ä»£ç ï¼Œé€»è¾‘å½’å±ç›®æ ‡åˆçº¦</td><td>æ‰§è¡Œçš„æ˜¯ç›®æ ‡åˆçº¦çš„ä»£ç ï¼Œé€»è¾‘å½’å±å½“å‰åˆçº¦</td></tr><tr><td><strong>æ ¸å¿ƒç”¨é€”</strong></td><td>æ™®é€šè°ƒç”¨å¤–éƒ¨åˆçº¦åŠŸèƒ½ï¼ˆå¦‚è°ƒç”¨ ERC20 è½¬è´¦ï¼‰</td><td>ä»£ç å¤ç”¨ã€å¯å‡çº§åˆçº¦ï¼ˆä»£ç†æ¨¡å¼ï¼‰</td></tr><tr><td><strong>å­˜å‚¨å¸ƒå±€è¦æ±‚</strong></td><td>æ— å¼ºåˆ¶è¦æ±‚ï¼ˆç›®æ ‡åˆçº¦è‡ªæœ‰å­˜å‚¨ï¼‰</td><td>ä¸¥æ ¼åŒ¹é…ï¼ˆå½“å‰åˆçº¦ä¸é€»è¾‘åˆçº¦å­˜å‚¨æ§½ä½éœ€ä¸€è‡´ï¼‰</td></tr></tbody></table>
<h4 data-id="heading-18">1.é€»è¾‘åˆçº¦ï¼ˆè¢«è°ƒç”¨æ–¹ï¼šæä¾›ä»£ç é€»è¾‘ï¼‰</h4>
<pre><code class="hljs language-solidity" lang="solidity">pragma solidity ^0.8.20;

// é€»è¾‘åˆçº¦ï¼šåªæä¾›ä»£ç ï¼Œä¸å­˜å‚¨æ•°æ®
contract LogicContract {
    // æ³¨æ„ï¼šå˜é‡çš„é¡ºåº/ç±»å‹å¿…é¡»å’Œè°ƒç”¨åˆçº¦å®Œå…¨åŒ¹é…ï¼ˆå­˜å‚¨æ§½ä½å¯¹åº”ï¼‰
    uint public num;       // å­˜å‚¨æ§½ä½ 0
    address public sender; // å­˜å‚¨æ§½ä½ 1

    // ä¿®æ”¹çŠ¶æ€çš„å‡½æ•°
    function setVars(uint _num) public {
        num = _num;
        // delegatecall ä¸­ï¼Œmsg.sender æ˜¯ã€Œå¤–éƒ¨è°ƒç”¨è€…ã€ï¼Œè€Œéè°ƒç”¨åˆçº¦åœ°å€
        sender = msg.sender;
    }

    // çº¯è®¡ç®—å‡½æ•°ï¼ˆæ— çŠ¶æ€ä¿®æ”¹ï¼‰
    function add(uint a, uint b) public pure returns (uint) {
        return a + b;
    }
}
</code></pre>
<h4 data-id="heading-19">2.è°ƒç”¨åˆçº¦ï¼ˆè°ƒç”¨æ–¹ï¼šæä¾›å­˜å‚¨ï¼Œå€Ÿç”¨é€»è¾‘ï¼‰</h4>
<pre><code class="hljs language-solidity" lang="solidity">pragma solidity ^0.8.20;

// è°ƒç”¨åˆçº¦ï¼šå­˜å‚¨æ•°æ®ï¼Œé€šè¿‡ delegatecall å€Ÿç”¨ LogicContract çš„é€»è¾‘
contract CallerContract {
    // å­˜å‚¨å¸ƒå±€å¿…é¡»å’Œ LogicContract å®Œå…¨ä¸€è‡´ï¼ï¼ˆé¡ºåºã€ç±»å‹ï¼‰
    uint public num;       // å­˜å‚¨æ§½ä½ 0
    address public sender; // å­˜å‚¨æ§½ä½ 1
    address public logicAddr; // ä¿å­˜é€»è¾‘åˆçº¦åœ°å€

    // è®¾ç½®é€»è¾‘åˆçº¦åœ°å€
    function setLogicAddr(address _logic) public {
        logicAddr = _logic;
    }

    // ç”¨ delegatecall è°ƒç”¨ LogicContract çš„ setVars å‡½æ•°
    function delegateSetVars(uint _num) public returns (bool, bytes memory) {
        // delegatecall è¯­æ³•ï¼šç›®æ ‡åœ°å€.delegatecall(ABIç¼–ç çš„å‡½æ•°è°ƒç”¨)
        (bool success, bytes memory data) = logicAddr.delegatecall(
            abi.encodeWithSignature("setVars(uint256)", _num)
        );
        return (success, data); // è¿”å›è°ƒç”¨ç»“æœå’Œæ•°æ®
    }

    // ç”¨ delegatecall è°ƒç”¨ LogicContract çš„ add å‡½æ•°
    function delegateAdd(uint a, uint b) public returns (bool, bytes memory) {
        (bool success, bytes memory data) = logicAddr.delegatecall(
            abi.encodeWithSignature("add(uint256,uint256)", a, b)
        );
        return (success, data);
    }
}
</code></pre>
<h4 data-id="heading-20">3. æµ‹è¯•æ­¥éª¤ä¸æ•ˆæœ</h4>
<ol>
<li>éƒ¨ç½² <code>LogicContract</code>ï¼Œè®°å½•å…¶åœ°å€ï¼ˆå¦‚ <code>0x123...</code>ï¼‰ï¼›</li>
<li>éƒ¨ç½² <code>CallerContract</code>ï¼Œè°ƒç”¨ <code>setLogicAddr(0x123...)</code> å…³è”é€»è¾‘åˆçº¦ï¼›</li>
<li>è°ƒç”¨ <code>delegateSetVars(100)</code>ï¼Œç„¶åæŸ¥è¯¢ <code>CallerContract</code> çš„ <code>num</code> â†’ ç»“æœä¸º <code>100</code>ï¼ˆæ•°æ®å­˜åœ¨ CallerContract ä¸­ï¼‰ï¼›</li>
<li>æŸ¥è¯¢ <code>CallerContract</code> çš„ <code>sender</code> â†’ ç»“æœä¸º<strong>ä½ çš„é’±åŒ…åœ°å€</strong>ï¼ˆè€Œé CallerContract åœ°å€ï¼Œä¿ç•™äº†åŸå§‹ä¸Šä¸‹æ–‡ï¼‰ï¼›</li>
<li>è°ƒç”¨ <code>delegateAdd(5, 3)</code>ï¼Œè§£ç è¿”å›çš„ <code>data</code> â†’ ç»“æœä¸º <code>8</code>ï¼ˆå¤ç”¨äº† LogicContract çš„è®¡ç®—é€»è¾‘ï¼‰ã€‚</li>
</ol>
<h4 data-id="heading-21">4.ä»£ç†åˆçº¦æ¡ˆä¾‹</h4>
<pre><code class="hljs language-solidity" lang="solidity">contract Proxy{
	address public implementation;
	address public owner;
	
	constructor(address _logic){
		implementation = _logic;
		owner = msg.sender;
	}
	
	modifier onlyOnwner(){
	 	require(msg.sender == owner, "Proxy: not owner");
	 	_;
	}
	
	function upgradeTo(address _newLogic) public onlyOwner{
		implementation = _newLogic;
	}
	
	//å›é€€å‡½æ•°ï¼šè°ƒç”¨ä»£ç†åˆçº¦ä¸å­˜åœ¨çš„å‡½æ•°æ—¶ï¼Œè‡ªåŠ¨è½¬å‘ç»™é€»è¾‘åˆçº¦
	fallback() external payable {
		(bool success,) implementation.delegatecall(msg.data);
        require(success, "Proxy: delegatecall failed");
	}
	
    // æ¥æ”¶ ETH
    receive() external payable {}
}

pragma solidity ^0.8.20;

// é€»è¾‘åˆçº¦ V1ï¼šå®ç°åŸºç¡€åŠŸèƒ½
contract LogicV1 {
    // å­˜å‚¨å¸ƒå±€å¿…é¡»å’Œ Proxy å®Œå…¨åŒ¹é…ï¼ˆæ–°å¢å˜é‡åªèƒ½åŠ åœ¨æœ«å°¾ï¼‰
    address public implementation; // å­˜å‚¨æ§½ä½ 0
    address public owner;          // å­˜å‚¨æ§½ä½ 1
    uint public count;             // å­˜å‚¨æ§½ä½ 2ï¼ˆæ–°å¢çŠ¶æ€ï¼‰

    // è®¡æ•°+1
    function increment() public {
        count += 1;
    }

    // è·å–è®¡æ•°
    function getCount() public view returns (uint) {
        return count;
    }
}

pragma solidity ^0.8.20;

// é€»è¾‘åˆçº¦ V2ï¼šåœ¨ V1 åŸºç¡€ä¸Šæ–°å¢åŠŸèƒ½
contract LogicV2 {
    // å­˜å‚¨å¸ƒå±€å¿…é¡»å’Œ Proxy/LogicV1 å®Œå…¨ä¸€è‡´ï¼
    address public implementation; // å­˜å‚¨æ§½ä½ 0
    address public owner;          // å­˜å‚¨æ§½ä½ 1
    uint public count;             // å­˜å‚¨æ§½ä½ 2

    // ä¿ç•™ V1 åŠŸèƒ½
    function increment() public {
        count += 1;
    }

    // æ–°å¢åŠŸèƒ½ï¼šè®¡æ•°-1
    function decrement() public {
        require(count &gt; 0, "LogicV2: count is zero");
        count -= 1;
    }

    // ä¿ç•™ V1 åŠŸèƒ½
    function getCount() public view returns (uint) {
        return count;
    }
}
</code></pre>
<ol>
<li>éƒ¨ç½² <code>LogicV1</code>ï¼Œå¾—åˆ°åœ°å€ <code>LogicV1Addr</code>ï¼›</li>
<li>éƒ¨ç½² <code>Proxy</code>ï¼Œä¼ å…¥ <code>LogicV1Addr</code> ä½œä¸ºåˆå§‹é€»è¾‘åˆçº¦ï¼›</li>
<li>è°ƒç”¨ <code>Proxy.increment()</code> â†’ è°ƒç”¨ <code>Proxy.getCount()</code> å¾—åˆ° <code>1</code>ï¼ˆçŠ¶æ€å­˜åœ¨ Proxy ä¸­ï¼‰ï¼›</li>
<li>éƒ¨ç½² <code>LogicV2</code>ï¼Œå¾—åˆ°åœ°å€ <code>LogicV2Addr</code>ï¼›</li>
<li>è°ƒç”¨ <code>Proxy.upgradeTo(LogicV2Addr)</code>ï¼ˆä»… owner å¯æ“ä½œï¼‰ï¼Œå®Œæˆå‡çº§ï¼›</li>
<li>è°ƒç”¨ <code>Proxy.decrement()</code> â†’ è°ƒç”¨ <code>Proxy.getCount()</code> å¾—åˆ° <code>0</code>ï¼ˆæ–°å¢åŠŸèƒ½ç”Ÿæ•ˆï¼ŒçŠ¶æ€æœªä¸¢å¤±ï¼‰ã€‚</li>
</ol>
<h3 data-id="heading-22">9ã€åœ¨åˆçº¦ä¸­åˆ›å»ºæ–°åˆçº¦ï¼ˆå·¥å‚åˆçº¦ï¼‰</h3>
<p>å·¥å‚åˆçº¦æ˜¯<strong>ä¸“é—¨ç”¨äºéƒ¨ç½²å…¶ä»–åˆçº¦ï¼ˆç§°ä¸ºã€Œå­åˆçº¦ / ç›®æ ‡åˆçº¦ã€ï¼‰çš„æ™ºèƒ½åˆçº¦</strong>ï¼Œå®ƒçš„æ ¸å¿ƒèŒè´£æ˜¯ï¼š</p>
<ol>
<li>å°è£…å­åˆçº¦çš„éƒ¨ç½²é€»è¾‘ï¼ˆæ¯”å¦‚ç”¨ <code>new</code> å…³é”®å­—ï¼‰ï¼›</li>
<li>å¯¹å¤–æä¾›ç»Ÿä¸€çš„éƒ¨ç½²æ¥å£ï¼›</li>
<li>é€šå¸¸ä¼šè®°å½•æ‰€æœ‰å·²éƒ¨ç½²çš„å­åˆçº¦åœ°å€ï¼ˆæ–¹ä¾¿ç®¡ç† / è¿½æº¯ï¼‰ã€‚</li>
</ol>
<p>createçš„ç”¨æ³•å¾ˆç®€å•ï¼Œå°±æ˜¯newä¸€ä¸ªåˆçº¦ï¼Œå¹¶ä¼ å…¥æ–°åˆçº¦æ„é€ å‡½æ•°æ‰€éœ€çš„å‚æ•°ï¼š</p>
<p>Contract x = new Contract{value: _value}(params)
å…¶ä¸­Contractæ˜¯è¦åˆ›å»ºçš„åˆçº¦åï¼Œxæ˜¯åˆçº¦å¯¹è±¡ï¼ˆåœ°å€ï¼‰ï¼Œå¦‚æœæ„é€ å‡½æ•°æ˜¯payableï¼Œå¯ä»¥åˆ›å»ºæ—¶è½¬å…¥_valueæ•°é‡çš„ETHï¼Œparamsæ˜¯æ–°åˆçº¦æ„é€ å‡½æ•°çš„å‚æ•°ã€‚</p>
<h4 data-id="heading-23">1.ç›®æ ‡åˆçº¦</h4>
<p>æ ¸å¿ƒåŠŸèƒ½ï¼šå­˜å‚¨ç”¨æˆ·åã€è®°å½•åˆçº¦éƒ¨ç½²è€…ï¼ˆå³å·¥å‚åˆçº¦åœ°å€ï¼‰ï¼Œæ”¯æŒä¿®æ”¹ç”¨æˆ·åï¼Œæ— æ„é€ å‡½æ•°ã€‚</p>
<pre><code class="hljs language-solidity" lang="solidity">pragma solidity ^0.8.20;

// ç”¨æˆ·ä¿¡æ¯åˆçº¦ï¼ˆæ— æ„é€ å‡½æ•°ï¼ŒåŸºç¡€çŠ¶æ€è¯»å†™ï¼‰
contract UserInfoContract {
    // çŠ¶æ€å˜é‡ï¼šç”¨æˆ·å + éƒ¨ç½²è€…ï¼ˆå·¥å‚åˆçº¦åœ°å€ï¼‰
    string public userName;
    address public deployer; // éƒ¨ç½²è¯¥åˆçº¦çš„å·¥å‚åˆçº¦åœ°å€

    // åˆå§‹åŒ–å‡½æ•°ï¼šè®¾ç½®ç”¨æˆ·å + è®°å½•éƒ¨ç½²è€…ï¼ˆé¦–æ¬¡è°ƒç”¨ï¼‰
    function initUser(string memory _userName) public {
        // ä»…å…è®¸é¦–æ¬¡åˆå§‹åŒ–ï¼ˆé¿å…é‡å¤ä¿®æ”¹éƒ¨ç½²è€…ï¼‰
        require(deployer == address(0), "UserInfo: already initialized");
        userName = _userName;
        deployer = msg.sender; // msg.sender = å·¥å‚åˆçº¦åœ°å€
    }

    // ä¿®æ”¹ç”¨æˆ·åï¼ˆä»»æ„åœ°å€å¯è°ƒç”¨ï¼Œä»…æ¼”ç¤ºåŸºç¡€åŠŸèƒ½ï¼‰
    function updateUserName(string memory _newName) public {
        userName = _newName;
    }

    // æ‰¹é‡è·å–ä¿¡æ¯ï¼ˆç®€åŒ–è°ƒç”¨ï¼‰
    function getUserInfo() public view returns (string memory, address) {
        return (userName, deployer);
    }
}
</code></pre>
<h4 data-id="heading-24">2.å·¥å‚åˆçº¦</h4>
<p>ä¸“é—¨éƒ¨ç½² <code>UserInfoContract</code> çš„åˆçº¦</p>
<pre><code class="hljs language-solidity" lang="solidity">pragma solidity ^0.8.20;

import "./UserInfoContract.sol";

// å…¸å‹çš„å·¥å‚åˆçº¦ç»“æ„
contract UserInfoFactory {
    // ç‰¹å¾1ï¼šè®°å½•æ‰€æœ‰å·²éƒ¨ç½²çš„å­åˆçº¦åœ°å€ï¼ˆå¯è¿½æº¯ã€æ˜“ç®¡ç†ï¼‰
    address[] public deployedUserContracts;

    // ç‰¹å¾2ï¼šå¯¹å¤–æä¾›ç»Ÿä¸€çš„éƒ¨ç½²æ¥å£ï¼ˆå°è£…éƒ¨ç½²é€»è¾‘ï¼‰
    function deployUserContract() public returns (address) {
        // æ ¸å¿ƒï¼šç”¨ new éƒ¨ç½²å­åˆçº¦ï¼ˆå·¥å‚åˆçº¦çš„æ ¸å¿ƒåŠ¨ä½œï¼‰
        UserInfoContract newUserContract = new UserInfoContract();
        // ç‰¹å¾3ï¼šè®°å½•æ–°éƒ¨ç½²çš„å­åˆçº¦åœ°å€
        deployedUserContracts.push(address(newUserContract));
        // ç‰¹å¾4ï¼šè¿”å›å­åˆçº¦åœ°å€ï¼ˆæ–¹ä¾¿è°ƒç”¨æ–¹ç›´æ¥ä½¿ç”¨ï¼‰
        return address(newUserContract);
    }

    // ç‰¹å¾5ï¼šè¾…åŠ©ç®¡ç†å‡½æ•°ï¼ˆæŸ¥çœ‹éƒ¨ç½²æ•°é‡ï¼‰
    function getDeployedCount() public view returns (uint) {
        return deployedUserContracts.length;
    }
}
</code></pre>
<p>æ­¥éª¤ 1ï¼šéƒ¨ç½²å·¥å‚åˆçº¦</p>
<p>æ­¥éª¤ 2ï¼šç”¨å·¥å‚éƒ¨ç½² UserInfoContract</p>
<ol>
<li>åœ¨ <code>UserInfoFactory</code> å®ä¾‹ä¸­ï¼Œæ‰¾åˆ° <code>deployUserContract</code> å‡½æ•°ï¼Œç‚¹å‡»ã€Œtransactã€ï¼›</li>
<li>äº¤æ˜“æˆåŠŸåï¼Œå¤åˆ¶è¿”å›çš„ <code>UserInfoContract</code> åœ°å€ï¼ˆå¦‚ <code>0x8A791620dd6260079BF849Dc5567aDC3F2FdC318</code>ï¼‰ï¼›</li>
<li>éªŒè¯ï¼šè°ƒç”¨ <code>UserInfoFactory</code> çš„ <code>getDeployedCount()</code>ï¼Œè¿”å› <code>1</code>ï¼ˆè¡¨ç¤ºå·²éƒ¨ç½² 1 ä¸ªåˆçº¦ï¼‰ï¼›è°ƒç”¨ <code>deployedUserContracts(0)</code>ï¼Œè¿”å›ä¸Šè¿°å¤åˆ¶çš„åœ°å€ï¼ˆéªŒè¯è®°å½•æˆåŠŸï¼‰ã€‚</li>
</ol>
<p>æ­¥éª¤ 3ï¼šæ“ä½œå¹¶éªŒè¯ UserInfoContract</p>
<ol>
<li>åœ¨ã€ŒDeploy &amp; Run Transactionsã€çš„ã€ŒAt Addressã€è¾“å…¥æ¡†ç²˜è´´æ­¥éª¤ 4 å¤åˆ¶çš„åœ°å€ï¼Œã€ŒContractã€ä¸‹æ‹‰æ¡†é€‰æ‹© <code>UserInfoContract</code>ï¼Œç‚¹å‡»ã€ŒAt Addressã€åŠ è½½åˆçº¦å®ä¾‹ï¼›</li>
<li>åˆå§‹åŒ–ç”¨æˆ·ä¿¡æ¯
<ul>
<li>è°ƒç”¨ <code>initUser</code> å‡½æ•°ï¼Œå‚æ•°è¾“å…¥ä½ çš„ç”¨æˆ·åï¼ˆå¦‚ <code>"Alice"</code>ï¼‰ï¼Œç‚¹å‡»ã€Œtransactã€ï¼›</li>
<li>è°ƒç”¨ <code>getUserInfo</code> å‡½æ•°ï¼Œç‚¹å‡»ã€Œcallã€ï¼Œè¿”å›ç»“æœä¸º <code>("Alice", å·¥å‚åˆçº¦åœ°å€)</code>ï¼ˆéªŒè¯éƒ¨ç½²è€…å’Œç”¨æˆ·åè®¾ç½®æˆåŠŸï¼‰ï¼›</li>
</ul>
</li>
<li>ä¿®æ”¹ç”¨æˆ·å
<ul>
<li>è°ƒç”¨ <code>updateUserName</code> å‡½æ•°ï¼Œå‚æ•°è¾“å…¥ <code>"Bob"</code>ï¼Œç‚¹å‡»ã€Œtransactã€ï¼›</li>
<li>å†æ¬¡è°ƒç”¨ <code>getUserInfo</code>ï¼Œè¿”å› <code>("Bob", å·¥å‚åˆçº¦åœ°å€)</code>ï¼ˆéªŒè¯ç”¨æˆ·åä¿®æ”¹æˆåŠŸï¼‰ï¼›</li>
</ul>
</li>
<li><strong>é‡å¤åˆå§‹åŒ–éªŒè¯</strong>ï¼šå†æ¬¡è°ƒç”¨ <code>initUser("Charlie")</code>ï¼Œäº¤æ˜“ä¼šå¤±è´¥ï¼ˆæç¤º <code>UserInfo: already initialized</code>ï¼ŒéªŒè¯åˆå§‹åŒ–ä»…å…è®¸ä¸€æ¬¡ï¼‰ã€‚</li>
</ol>
<h4 data-id="heading-25">3.å·¥å‚åˆçº¦çš„ 5 ä¸ªæ ¸å¿ƒç‰¹å¾ï¼ˆå¯¹åº”æ¡ˆä¾‹ï¼‰</h4>



































<table><thead><tr><th>ç‰¹å¾</th><th>æ¡ˆä¾‹ä¸­çš„ä½“ç°</th><th>å®é™…ä»·å€¼</th></tr></thead><tbody><tr><td>1. å°è£…éƒ¨ç½²é€»è¾‘</td><td>æ‰€æœ‰éƒ¨ç½² <code>UserInfoContract</code> çš„é€»è¾‘éƒ½åœ¨ <code>deployUserContract</code> ä¸­</td><td>è°ƒç”¨æ–¹æ— éœ€çŸ¥é“ã€Œæ€ä¹ˆéƒ¨ç½²ã€ï¼Œåªéœ€è°ƒç”¨å‡½æ•°å³å¯</td></tr><tr><td>2. æ‰¹é‡éƒ¨ç½²</td><td>å¤šæ¬¡è°ƒç”¨ <code>deployUserContract</code> å¯åˆ›å»ºå¤šä¸ª <code>UserInfoContract</code> å®ä¾‹</td><td>ä¸€é”®æ‰¹é‡ç”ŸæˆåŒæ¬¾åˆçº¦ï¼Œæ— éœ€é‡å¤éƒ¨ç½²å·¥å‚</td></tr><tr><td>3. å¯è¿½æº¯</td><td><code>deployedUserContracts</code> æ•°ç»„è®°å½•æ‰€æœ‰å­åˆçº¦åœ°å€</td><td>éšæ—¶æŸ¥çœ‹ / ç®¡ç†æ‰€æœ‰å·²éƒ¨ç½²çš„å­åˆçº¦</td></tr><tr><td>4. æ ‡å‡†åŒ–</td><td>æ‰€æœ‰å­åˆçº¦éƒ½åŸºäºåŒä¸€ç‰ˆ <code>UserInfoContract</code> ä»£ç </td><td>é¿å…æ‰‹åŠ¨éƒ¨ç½²æ—¶çš„ä»£ç ç‰ˆæœ¬ä¸ä¸€è‡´</td></tr><tr><td>5. ç®€åŒ–è°ƒç”¨</td><td>è¿”å›å­åˆçº¦åœ°å€ï¼Œè°ƒç”¨æ–¹ç›´æ¥ç”¨ <code>At Address</code> åŠ è½½</td><td>æ— éœ€æ‰‹åŠ¨å¤åˆ¶å­—èŠ‚ç ã€å¤„ç†åº•å±‚éƒ¨ç½²ç»†èŠ‚</td></tr></tbody></table>
<h3 data-id="heading-26">10ã€create2</h3>
<h4 data-id="heading-27">1.CREATE2 vs CREATEï¼ˆnewï¼‰æ ¸å¿ƒå¯¹æ¯”</h4>



































<table><thead><tr><th>ç‰¹æ€§</th><th><code>CREATE2</code></th><th><code>CREATE</code>ï¼ˆ<code>new</code> åº•å±‚ï¼‰</th></tr></thead><tbody><tr><td>åœ°å€ç”Ÿæˆä¾æ®</td><td>å·¥å‚åœ°å€ + salt + å­åˆçº¦å­—èŠ‚ç å“ˆå¸Œ</td><td>å·¥å‚åœ°å€ + å·¥å‚ nonceï¼ˆéƒ¨ç½²æ¬¡æ•°ï¼‰</td></tr><tr><td>åœ°å€å¯é¢„æµ‹æ€§</td><td>âœ… éƒ¨ç½²å‰å¯ç²¾ç¡®è®¡ç®—</td><td>âŒ ä¸å¯é¢„æµ‹ï¼ˆnonce éšéƒ¨ç½²å˜åŒ–ï¼‰</td></tr><tr><td>Solidity å°è£…è¯­æ³•</td><td><code>new åˆçº¦å{salt: _salt}()</code></td><td><code>new åˆçº¦å()</code></td></tr><tr><td>æ ¸å¿ƒä¼˜åŠ¿</td><td>åœ°å€ç¡®å®šã€æå‰è§„åˆ’</td><td>ç®€å•ã€æ— éœ€è‡ªå®šä¹‰ salt</td></tr><tr><td>é€‚ç”¨åœºæ™¯</td><td>éœ€æå‰çŸ¥åœ°å€çš„åœºæ™¯ï¼ˆè·¨é“¾ã€DEXï¼‰</td><td>æ™®é€šæ‰¹é‡éƒ¨ç½²ï¼ˆæ— åœ°å€é¢„åˆ¤éœ€æ±‚ï¼‰</td></tr></tbody></table>
<h4 data-id="heading-28">2.æ¡ˆä¾‹</h4>
<ol>
<li>
<p>å­åˆçº¦ï¼ˆä¿æŒä¸å˜ï¼Œå¤ç”¨ä¹‹å‰çš„ <code>UserInfoContract</code>ï¼‰</p>
</li>
<li>
<p><code>CREATE2</code> å·¥å‚åˆçº¦ï¼ˆæ ¸å¿ƒï¼‰</p>
</li>
</ol>
<pre><code class="hljs language-solidity" lang="solidity">pragma solidity ^0.8.20;

import "./UserInfoContract.sol";

// CREATE2 ç‰ˆæœ¬çš„ç”¨æˆ·ä¿¡æ¯åˆçº¦å·¥å‚ï¼ˆæ”¯æŒé¢„è®¡ç®—åœ°å€ï¼‰
contract UserInfoFactoryCreate2 {
    // è®°å½•å·²éƒ¨ç½²çš„å­åˆçº¦ï¼ˆsalt =&gt; åˆçº¦åœ°å€ï¼‰ï¼Œæ–¹ä¾¿è¿½æº¯
    mapping(uint256 =&gt; address) public saltToContract;

    // ========== æ ¸å¿ƒ1ï¼šç”¨ CREATE2 éƒ¨ç½²å­åˆçº¦ï¼ˆé«˜çº§å°è£…æ–¹å¼ï¼‰ ==========
    function deployWithCREATE2(uint256 _salt) public returns (address) {
        // è¯­æ³•ï¼šnew åˆçº¦å{salt: ç›å€¼}() â€”â€” åº•å±‚è°ƒç”¨ CREATE2
        UserInfoContract newUserContract = new UserInfoContract{salt: bytes(_salt)}();
        address contractAddr = address(newUserContract);
        
        // è®°å½• salt å’Œåˆçº¦åœ°å€çš„æ˜ å°„
        saltToContract[_salt] = contractAddr;
        
        return contractAddr;
    }

    // ========== æ ¸å¿ƒ2ï¼šé¢„è®¡ç®—åˆçº¦åœ°å€ï¼ˆéƒ¨ç½²å‰å°±èƒ½çŸ¥é“åœ°å€ï¼‰ ==========
    function computeContractAddress(uint256 _salt) public view returns (address) {
        // æ­¥éª¤1ï¼šè·å–å­åˆçº¦çš„åˆå§‹åŒ–å­—èŠ‚ç ï¼ˆç¼–è¯‘åç”Ÿæˆï¼Œå›ºå®šå€¼ï¼‰
        bytes memory bytecode = type(UserInfoContract).creationCode;
        // æ­¥éª¤2ï¼šè®¡ç®—å­—èŠ‚ç çš„ keccak256 å“ˆå¸Œ
        bytes32 bytecodeHash = keccak256(bytecode);
        
        // æ­¥éª¤3ï¼šæŒ‰ CREATE2 åœ°å€è§„åˆ™è®¡ç®—ï¼ˆæ ¸å¿ƒå…¬å¼ï¼‰
        address predictedAddr = address(
            uint160( // è½¬æˆ 160 ä½åœ°å€æ ¼å¼
                uint256(
                    keccak256(
                        abi.encodePacked(
                            bytes1(0xff), // å›ºå®šå‰ç¼€
                            address(this), // å·¥å‚åˆçº¦åœ°å€
                            _salt, // ç›å€¼
                            bytecodeHash // å­åˆçº¦å­—èŠ‚ç å“ˆå¸Œ
                        )
                    )
                )
            )
        );
        
        return predictedAddr;
    }
}
</code></pre>
<p>æ­¥éª¤ 1ï¼šéƒ¨ç½² <code>CREATE2</code> å·¥å‚åˆçº¦</p>
<p>æ­¥éª¤ 3ï¼šé¢„è®¡ç®—å­åˆçº¦åœ°å€ï¼ˆæ ¸å¿ƒéªŒè¯ï¼‰</p>
<ol>
<li>åœ¨å·¥å‚åˆçº¦å®ä¾‹ä¸­ï¼Œæ‰¾åˆ° <code>computeContractAddress</code> å‡½æ•°ï¼Œè¾“å…¥ salt å€¼ <code>12345</code>ï¼Œç‚¹å‡»ã€Œcallã€ï¼›</li>
<li>è®°å½•è¿”å›çš„<strong>é¢„è®¡ç®—åœ°å€</strong>ï¼ˆæ¯”å¦‚ <code>0x8626f6940E2eb28930eFb4CeF49B2d1F2C9C1199</code>ï¼‰ï¼›</li>
<li>æ­¤æ—¶è¯¥åœ°å€è¿˜æœªéƒ¨ç½²ä»»ä½•åˆçº¦ï¼ˆåªæ˜¯é¢„è®¡ç®—ç»“æœï¼‰ã€‚</li>
</ol>
<p>æ­¥éª¤ 4ï¼šç”¨ <code>CREATE2</code> éƒ¨ç½²å­åˆçº¦ï¼ˆéªŒè¯åœ°å€ä¸€è‡´ï¼‰</p>
<ol>
<li>åœ¨å·¥å‚åˆçº¦å®ä¾‹ä¸­ï¼Œæ‰¾åˆ° <code>deployWithCREATE2</code> å‡½æ•°ï¼Œè¾“å…¥ç›¸åŒçš„ salt å€¼ <code>12345</code>ï¼Œç‚¹å‡»ã€Œtransactã€ï¼›</li>
<li>äº¤æ˜“æˆåŠŸåï¼Œå¤åˆ¶è¿”å›çš„<strong>å®é™…éƒ¨ç½²åœ°å€</strong>ï¼›</li>
<li>å¯¹æ¯”ã€Œé¢„è®¡ç®—åœ°å€ã€å’Œã€Œå®é™…éƒ¨ç½²åœ°å€ã€â€”â€” ä¸¤è€…å®Œå…¨ä¸€è‡´ï¼ˆ<code>CREATE2</code> æ ¸å¿ƒä¼˜åŠ¿ä½“ç°ï¼‰ã€‚</li>
</ol>
<p>æ­¥éª¤ 5ï¼šéªŒè¯å­åˆçº¦åŠŸèƒ½</p>
<ol>
<li>åœ¨ã€ŒAt Addressã€è¾“å…¥å®é™…éƒ¨ç½²åœ°å€ï¼Œé€‰æ‹© <code>UserInfoContract</code>ï¼ŒåŠ è½½åˆçº¦å®ä¾‹ï¼›</li>
<li>è°ƒç”¨ <code>initUser("Charlie")</code>ï¼Œå†è°ƒç”¨ <code>getUserInfo()</code> â†’ è¿”å› <code>("Charlie", å·¥å‚åˆçº¦åœ°å€)</code>ï¼›</li>
<li>è°ƒç”¨ <code>updateUserName("Dave")</code> â†’ éªŒè¯ç”¨æˆ·åä¿®æ”¹æˆåŠŸã€‚</li>
</ol>
<h3 data-id="heading-29">11ã€åˆ é™¤åˆçº¦</h3>
<h4 data-id="heading-30">1ã€é”€æ¯åˆçº¦çš„æ ¸å¿ƒåŸç†ï¼ˆ<code>selfdestruct</code>ï¼‰</h4>
<p>Solidity ä¸­é”€æ¯åˆçº¦çš„å”¯ä¸€æ–¹å¼æ˜¯è°ƒç”¨ <code>selfdestruct(address payable recipient)</code>ï¼ˆæ—§ç§° <code>suicide</code>ï¼Œå·²åºŸå¼ƒï¼‰ï¼Œè¿™æ˜¯ EVM çº§åˆ«çš„ä½çº§æ“ä½œï¼Œæ ¸å¿ƒç‰¹æ€§å¦‚ä¸‹ï¼š</p>
<ol>
<li>æ ¸å¿ƒè¡Œä¸º
<ul>
<li>æ°¸ä¹…é”€æ¯å½“å‰åˆçº¦çš„<strong>ä»£ç </strong>å’Œ<strong>å­˜å‚¨æ•°æ®</strong>ï¼ˆæ‰€æœ‰çŠ¶æ€å˜é‡è¢«æ¸…ç©ºï¼Œæ— æ³•æ¢å¤ï¼‰ï¼›</li>
<li>å°†åˆçº¦è´¦æˆ·ä¸­å‰©ä½™çš„æ‰€æœ‰ ETH è½¬ç§»åˆ°æŒ‡å®šçš„ <code>recipient</code> åœ°å€ï¼›</li>
<li>åˆçº¦åœ°å€ä¸ä¼šæ¶ˆå¤±ï¼Œä½†åœ°å€å¯¹åº”çš„ä»£ç  / å­˜å‚¨è¢«æ¸…ç©ºï¼Œåç»­è°ƒç”¨è¯¥åœ°å€çš„ä»»ä½•å‡½æ•°éƒ½ä¼šå¤±è´¥ã€‚</li>
</ul>
</li>
<li><strong>æƒé™è¦æ±‚</strong>ï¼šä»…èƒ½ç”±åˆçº¦<strong>è‡ªèº«</strong>è°ƒç”¨ï¼ˆæˆ–é€šè¿‡åˆçº¦å†…çš„å‡½æ•°é—´æ¥è°ƒç”¨ï¼Œéœ€åŠ æƒé™æ§åˆ¶ï¼‰ï¼›</li>
<li><strong>ä¸å¯é€†æ€§</strong>ï¼šé”€æ¯åæ— æ³•æ¢å¤ï¼Œæ˜¯æ°¸ä¹…æ€§æ“ä½œï¼Œéœ€è°¨æ…ä½¿ç”¨ã€‚</li>
</ol>
<h4 data-id="heading-31">2.æ¡ˆä¾‹</h4>
<p>å¯é”€æ¯çš„å­åˆçº¦ï¼ˆ<code>DestructibleUserInfo</code>ï¼‰</p>
<pre><code class="hljs language-solidity" lang="solidity">// SPDX-License-Identifier: MIT
pragma solidity ^0.8.20;

contract DestructibleUserInfo {
    string public userName;
    address public deployer;
    bool public isDestroyed;

    modifier onlyDeployer() {
        require(msg.sender == deployer, "Only deploy can call");
        _;
    }

    modifier notDestroyed() {
        require(!isDestroyed, "Contract already destroyed");
        _;
    }

    function updateUserName(string memory _newName) public notDestroyed {
        userName = _newName;
    }

    function getUserInfo() public view returns (string memory, address){
        return (userName,deployer);
    }

    function destroyContract(address payable  _recipient) public onlyDeployer notDestroyed {
        isDestroyed = true;
        selfdestruct(_recipient);
    }

    receive() external payable {}
}
</code></pre>
<ol start="2">
<li>ç®¡ç†é”€æ¯çš„å·¥å‚åˆçº¦ï¼ˆ<code>DestructibleUserInfoFactory</code>ï¼‰</li>
</ol>
<pre><code class="hljs language-solidity" lang="solidity">// SPDX-License-Identifier: MIT
pragma solidity ^0.8.20;

import "./DestructibleUserInfo.sol";

// å·¥å‚åˆçº¦ï¼šéƒ¨ç½²+é”€æ¯ å¯é”€æ¯çš„ç”¨æˆ·ä¿¡æ¯åˆçº¦
contract DestructibleUserInfoFactory {
    // è®°å½•å·²éƒ¨ç½²çš„å­åˆçº¦åœ°å€ï¼ˆé˜²æ­¢é”€æ¯åè¯¯æ“ä½œï¼‰
    address[] public deployedContracts;
    // æ ‡è®°å­åˆçº¦æ˜¯å¦å·²é”€æ¯
    mapping(address =&gt; bool) public isContractDestroyed;

      // éƒ¨ç½²å¹¶åˆå§‹åŒ–å­åˆçº¦ï¼ˆè®©å·¥å‚æˆä¸º deployerï¼‰
    function deployAndInitContract(string memory _userName) public returns (address) {
        DestructibleUserInfo newContract = new DestructibleUserInfo();
        // å·¥å‚åˆçº¦è°ƒç”¨ initUser â†’ å­åˆçº¦çš„ deployer = å·¥å‚åœ°å€
        newContract.initUser(_userName); 
        deployedContracts.push(address(newContract));
        return address(newContract);
    }

    // å·¥å‚è§¦å‘å­åˆçº¦é”€æ¯ï¼ˆæ ¸å¿ƒï¼šè°ƒç”¨å­åˆçº¦çš„destroyContractï¼‰
    function destroyUserContract(address payable _contractAddr, address payable _recipient) public {
        // æ£€æŸ¥åˆçº¦æ˜¯å¦ç”±æœ¬å·¥å‚éƒ¨ç½²
        bool isDeployed = false;
        for (uint i = 0; i &lt; deployedContracts.length; i++) {
            if (deployedContracts[i] == _contractAddr) {
                isDeployed = true;
                break;
            }
        }
        require(isDeployed, "Contract not deployed by this factory");
        // æ£€æŸ¥åˆçº¦æœªè¢«é”€æ¯
        require(!isContractDestroyed[_contractAddr], "Contract already destroyed");

        // ç°åœ¨ç±»å‹åŒ¹é…ï¼Œç¼–è¯‘é€šè¿‡
        DestructibleUserInfo(_contractAddr).destroyContract(_recipient);
        // æ ‡è®°é”€æ¯çŠ¶æ€
        isContractDestroyed[_contractAddr] = true;
    }

    // ç»™å­åˆçº¦è½¬ETHï¼ˆæµ‹è¯•é”€æ¯æ—¶çš„ETHè½¬ç§»ï¼‰
    function sendEthToContract(address _contractAddr) public payable {
        require(msg.value &gt; 0, "ETH amount must be &gt; 0");
        (bool success, ) = _contractAddr.call{value: msg.value}("");
        require(success, "ETH transfer failed");
    }
}
</code></pre>
<p>æ­¥éª¤ 1ï¼šéƒ¨ç½²å·¥å‚åˆçº¦</p>
<ol>
<li>åœ¨ Remix ä¸­é€‰æ‹© <strong>DestructibleUserInfoFactory</strong> åˆçº¦</li>
<li>ç‚¹å‡»ã€ŒDeployã€æŒ‰é’®éƒ¨ç½²åˆçº¦</li>
<li>ç­‰å¾…äº¤æ˜“ç¡®è®¤ï¼Œè·å¾—å·¥å‚åˆçº¦åœ°å€</li>
</ol>
<p>æ­¥éª¤ 2ï¼šè°ƒç”¨å·¥å‚çš„ deployAndInitContract</p>
<ol>
<li>åœ¨å·²éƒ¨ç½²çš„å·¥å‚åˆçº¦ç•Œé¢ï¼Œæ‰¾åˆ° <code>deployAndInitContract</code> å‡½æ•°</li>
<li>è¾“å…¥å‚æ•° <code>_userName: "TestFactory"</code></li>
<li>ç‚¹å‡»ã€Œtransactã€æ‰§è¡Œäº¤æ˜“</li>
<li>ç­‰å¾…äº¤æ˜“æˆåŠŸï¼Œå¤åˆ¶è¿”å›çš„å­åˆçº¦åœ°å€</li>
</ol>
<p>æ­¥éª¤ 3ï¼šéªŒè¯å­åˆçº¦ deployer</p>
<ol>
<li>åœ¨ Remix çš„ã€ŒAt Addressã€è¾“å…¥æ¡†ä¸­ç²˜è´´å­åˆçº¦åœ°å€</li>
<li>ä»ä¸‹æ‹‰èœå•ä¸­é€‰æ‹© <strong>DestructibleUserInfo</strong> åˆçº¦ç±»å‹</li>
<li>ç‚¹å‡»ã€ŒAt Addressã€æŒ‰é’®åŠ è½½å­åˆçº¦</li>
<li>è°ƒç”¨å­åˆçº¦çš„ <code>deployer()</code> å‡½æ•°</li>
<li>éªŒè¯è¿”å›çš„åœ°å€æ˜¯å¦ä¸ºå·¥å‚åˆçº¦åœ°å€</li>
</ol>
<p>æ­¥éª¤ 4ï¼šæµ‹è¯•å·¥å‚é”€æ¯å­åˆçº¦</p>
<p>4.1 å‘å­åˆçº¦å‘é€ ETH</p>
<ol>
<li>è°ƒç”¨å·¥å‚çš„ <code>sendEthToContract</code> å‡½æ•°</li>
<li>å‚æ•° <code>_contractAddr</code>: ç²˜è´´å­åˆçº¦åœ°å€</li>
<li>åœ¨ Value å­—æ®µè¾“å…¥ <code>1</code></li>
<li>å•ä½é€‰æ‹© <strong>ether</strong></li>
<li>ç‚¹å‡»ã€Œtransactã€æ‰§è¡Œäº¤æ˜“</li>
</ol>
<p>4.2 é”€æ¯å­åˆçº¦</p>
<ol>
<li>è°ƒç”¨å·¥å‚çš„ <code>destroyUserContract</code> å‡½æ•°</li>
<li>å‚æ•° <code>_contractAddr</code>: å­åˆçº¦åœ°å€ï¼ˆpayable ç±»å‹ï¼‰</li>
<li>å‚æ•° <code>_recipient</code>: ä½ çš„é’±åŒ…åœ°å€</li>
<li>ç‚¹å‡»ã€Œtransactã€æ‰§è¡Œäº¤æ˜“</li>
<li>ç­‰å¾…äº¤æ˜“æˆåŠŸç¡®è®¤</li>
</ol>
<h3 data-id="heading-32">12ã€ABIç¼–ç è§£ç </h3>
<p><code>ABI</code> (Application Binary Interfaceï¼Œåº”ç”¨äºŒè¿›åˆ¶æ¥å£)æ˜¯ä¸ä»¥å¤ªåŠæ™ºèƒ½åˆçº¦äº¤äº’çš„æ ‡å‡†ã€‚æ•°æ®åŸºäºä»–ä»¬çš„ç±»å‹ç¼–ç ï¼›å¹¶ä¸”ç”±äºç¼–ç åä¸åŒ…å«ç±»å‹ä¿¡æ¯ï¼Œè§£ç æ—¶éœ€è¦æ³¨æ˜å®ƒä»¬çš„ç±»å‹ã€‚</p>
<p><code>Solidity</code>ä¸­ï¼Œ<code>ABIç¼–ç </code>æœ‰4ä¸ªå‡½æ•°ï¼š<code>abi.encode</code>, <code>abi.encodePacked</code>, <code>abi.encodeWithSignature</code>, <code>abi.encodeWithSelector</code>ã€‚è€Œ<code>ABIè§£ç </code>æœ‰1ä¸ªå‡½æ•°ï¼š<code>abi.decode</code>ï¼Œç”¨äºè§£ç <code>abi.encode</code>çš„æ•°æ®ã€‚</p>
<h4 data-id="heading-33">ABIç¼–ç </h4>
<p>æˆ‘ä»¬å°†ç¼–ç 4ä¸ªå˜é‡ï¼Œä»–ä»¬çš„ç±»å‹åˆ†åˆ«æ˜¯<code>uint256</code>ï¼ˆåˆ«å uintï¼‰, <code>address</code>, <code>string</code>, <code>uint256[2]</code>ï¼š</p>
<pre><code class="hljs language-solidity" lang="solidity">uint x = 10;
address addr = 0x7A58c0Be72BE218B41C608b7Fe7C5bB630736C71;
string name = "0xAA";
uint[2] array = [5, 6];
</code></pre>
<h5 data-id="heading-34"><code>abi.encode</code></h5>
<p>å°†ç»™å®šå‚æ•°åˆ©ç”¨<a href="https://link.juejin.cn?target=https%3A%2F%2Flearnblockchain.cn%2Fdocs%2Fsolidity%2Fabi-spec.html" target="_blank" title="https://learnblockchain.cn/docs/solidity/abi-spec.html" ref="nofollow noopener noreferrer">ABIè§„åˆ™</a>ç¼–ç ã€‚<code>ABI</code>è¢«è®¾è®¡å‡ºæ¥è·Ÿæ™ºèƒ½åˆçº¦äº¤äº’ï¼Œä»–å°†æ¯ä¸ªå‚æ•°å¡«å……ä¸º32å­—èŠ‚çš„æ•°æ®ï¼Œå¹¶æ‹¼æ¥åœ¨ä¸€èµ·ã€‚å¦‚æœä½ è¦å’Œåˆçº¦äº¤äº’ï¼Œä½ è¦ç”¨çš„å°±æ˜¯<code>abi.encode</code>ã€‚</p>
<pre><code class="hljs language-solidity" lang="solidity">function encode() public view returns(bytes memory result) {
    result = abi.encode(x, addr, name, array);
}
</code></pre>
<p>ç¼–ç çš„ç»“æœä¸º<code>0x000000000000000000000000000000000000000000000000000000000000000a0000000000000000000000007a58c0be72be218b41c608b7fe7c5bb630736c7100000000000000000000000000000000000000000000000000000000000000a00000000000000000000000000000000000000000000000000000000000000005000000000000000000000000000000000000000000000000000000000000000600000000000000000000000000000000000000000000000000000000000000043078414100000000000000000000000000000000000000000000000000000000</code>ï¼Œè¯¦ç»†è§£é‡Šä¸‹ç¼–ç çš„ç»†èŠ‚ï¼š</p>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-number">000000000000000000000000000000000000000000000000000000000000000</span>a    <span class="hljs-comment">// x</span>
<span class="hljs-number">0000000000000000000000007</span>a58c0be72be218b41c608b7fe7c5bb630736c71    <span class="hljs-comment">// addr</span>
<span class="hljs-number">00000000000000000000000000000000000000000000000000000000000000</span>a0    <span class="hljs-comment">// name å‚æ•°çš„åç§»é‡</span>
<span class="hljs-number">0000000000000000000000000000000000000000000000000000000000000005</span>    <span class="hljs-comment">// array[0]</span>
<span class="hljs-number">0000000000000000000000000000000000000000000000000000000000000006</span>    <span class="hljs-comment">// array[1]</span>
<span class="hljs-number">0000000000000000000000000000000000000000000000000000000000000004</span>    <span class="hljs-comment">// name å‚æ•°çš„é•¿åº¦ä¸º4å­—èŠ‚</span>
<span class="hljs-number">3078414100000000000000000000000000000000000000000000000000000000</span>    <span class="hljs-comment">// name</span>
</code></pre>
<p>å…¶ä¸­ <code>name</code> å‚æ•°è¢«è½¬æ¢ä¸ºUTF-8çš„å­—èŠ‚å€¼ <code>0x30784141</code>ï¼Œåœ¨ abi ç¼–ç è§„èŒƒä¸­ï¼Œstring å±äºåŠ¨æ€ç±»å‹ ï¼ŒåŠ¨æ€ç±»å‹çš„å‚æ•°éœ€è¦å€ŸåŠ©åç§»é‡è¿›è¡Œç¼–ç ï¼Œå¯ä»¥å‚è€ƒ<a href="https://link.juejin.cn?target=https%3A%2F%2Flearnblockchain.cn%2Fdocs%2Fsolidity%2Fabi-spec.html%23id9" target="_blank" title="https://learnblockchain.cn/docs/solidity/abi-spec.html#id9" ref="nofollow noopener noreferrer">åŠ¨æ€ç±»å‹çš„ä½¿ç”¨</a>ã€‚ç”±äº abi.encode ä¼šå°†æ¯ä¸ªå‚ä¸ç¼–ç çš„å‚æ•°å…ƒç´ ï¼ˆåŒ…æ‹¬åç§»é‡ï¼Œé•¿åº¦ï¼‰éƒ½å¡«å……ä¸º32å­—èŠ‚ï¼ˆevmå­—é•¿ä¸º32å­—èŠ‚ï¼‰ï¼Œæ‰€ä»¥å¯ä»¥çœ‹åˆ°ç¼–ç åçš„æ•°æ®ä¸­æœ‰å¾ˆå¤šå¡«å……çš„ 0 ã€‚</p>
<h5 data-id="heading-35"><code>abi.encodePacked</code></h5>
<p>å°†ç»™å®šå‚æ•°æ ¹æ®å…¶æ‰€éœ€æœ€ä½ç©ºé—´ç¼–ç ã€‚å®ƒç±»ä¼¼ <code>abi.encode</code>ï¼Œä½†æ˜¯ä¼šæŠŠå…¶ä¸­å¡«å……çš„å¾ˆå¤š<code>0</code>çœç•¥ã€‚æ¯”å¦‚ï¼Œåªç”¨1å­—èŠ‚æ¥ç¼–ç <code>uint8</code>ç±»å‹ã€‚å½“ä½ æƒ³çœç©ºé—´ï¼Œå¹¶ä¸”ä¸ä¸åˆçº¦äº¤äº’çš„æ—¶å€™ï¼Œå¯ä»¥ä½¿ç”¨<code>abi.encodePacked</code>ï¼Œä¾‹å¦‚ç®—ä¸€äº›æ•°æ®çš„<code>hash</code>æ—¶ã€‚éœ€è¦æ³¨æ„ï¼Œ<code>abi.encodePacked</code>å› ä¸ºä¸ä¼šåšå¡«å……ï¼Œæ‰€ä»¥ä¸åŒçš„è¾“å…¥åœ¨æ‹¼æ¥åå¯èƒ½ä¼šäº§ç”Ÿç›¸åŒçš„ç¼–ç ç»“æœï¼Œå¯¼è‡´å†²çªï¼Œè¿™ä¹Ÿå¸¦æ¥äº†æ½œåœ¨çš„å®‰å…¨é£é™©ã€‚</p>
<pre><code class="hljs language-solidity" lang="solidity">function encodePacked() public view returns(bytes memory result) {
    result = abi.encodePacked(x, addr, name, array);
}
</code></pre>
<p>ç¼–ç çš„ç»“æœä¸º<code>0x000000000000000000000000000000000000000000000000000000000000000a7a58c0be72be218b41c608b7fe7c5bb630736c713078414100000000000000000000000000000000000000000000000000000000000000050000000000000000000000000000000000000000000000000000000000000006</code>ï¼Œç”±äº<code>abi.encodePacked</code>å¯¹ç¼–ç è¿›è¡Œäº†å‹ç¼©ï¼Œé•¿åº¦æ¯”<code>abi.encode</code>çŸ­å¾ˆå¤šã€‚</p>
<h5 data-id="heading-36"><code>abi.encodeWithSignature</code></h5>
<p>ä¸<code>abi.encode</code>åŠŸèƒ½ç±»ä¼¼ï¼Œåªä¸è¿‡ç¬¬ä¸€ä¸ªå‚æ•°ä¸º<code>å‡½æ•°ç­¾å</code>ï¼Œæ¯”å¦‚<code>"foo(uint256,address,string,uint256[2])"</code>ã€‚å½“è°ƒç”¨å…¶ä»–åˆçº¦çš„æ—¶å€™å¯ä»¥ä½¿ç”¨ã€‚</p>
<pre><code class="hljs language-solidity" lang="solidity">function encodeWithSignature() public view returns(bytes memory result) {
    result = abi.encodeWithSignature("foo(uint256,address,string,uint256[2])", x, addr, name, array);
}
</code></pre>
<p>ç¼–ç çš„ç»“æœä¸º<code>0xe87082f1000000000000000000000000000000000000000000000000000000000000000a0000000000000000000000007a58c0be72be218b41c608b7fe7c5bb630736c7100000000000000000000000000000000000000000000000000000000000000a00000000000000000000000000000000000000000000000000000000000000005000000000000000000000000000000000000000000000000000000000000000600000000000000000000000000000000000000000000000000000000000000043078414100000000000000000000000000000000000000000000000000000000</code>ï¼Œç­‰åŒäºåœ¨<code>abi.encode</code>ç¼–ç ç»“æœå‰åŠ ä¸Šäº†4å­—èŠ‚çš„<code>å‡½æ•°é€‰æ‹©å™¨</code><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.wtf.academy%2Fzh%2Fcourse%2Fsolidity102%2FABIEncode%23user-content-fn-%25E8%25AF%25B4%25E6%2598%258E" target="_blank" title="https://www.wtf.academy/zh/course/solidity102/ABIEncode#user-content-fn-%E8%AF%B4%E6%98%8E" ref="nofollow noopener noreferrer">1</a>ã€‚</p>
<h5 data-id="heading-37"><code>abi.encodeWithSelector</code></h5>
<p>ä¸<code>abi.encodeWithSignature</code>åŠŸèƒ½ç±»ä¼¼ï¼Œåªä¸è¿‡ç¬¬ä¸€ä¸ªå‚æ•°ä¸º<code>å‡½æ•°é€‰æ‹©å™¨</code>ï¼Œä¸º<code>å‡½æ•°ç­¾å</code>Keccakå“ˆå¸Œçš„å‰4ä¸ªå­—èŠ‚ã€‚</p>
<pre><code class="hljs language-solidity" lang="solidity">function encodeWithSelector() public view returns(bytes memory result) {
    result = abi.encodeWithSelector(bytes4(keccak256("foo(uint256,address,string,uint256[2])")), x, addr, name, array);
}
</code></pre>
<p>ç¼–ç çš„ç»“æœä¸º<code>0xe87082f1000000000000000000000000000000000000000000000000000000000000000a0000000000000000000000007a58c0be72be218b41c608b7fe7c5bb630736c7100000000000000000000000000000000000000000000000000000000000000a00000000000000000000000000000000000000000000000000000000000000005000000000000000000000000000000000000000000000000000000000000000600000000000000000000000000000000000000000000000000000000000000043078414100000000000000000000000000000000000000000000000000000000</code>ï¼Œä¸<code>abi.encodeWithSignature</code>ç»“æœä¸€æ ·ã€‚</p>
<h4 data-id="heading-38">ABIè§£ç </h4>
<h4 data-id="heading-39"><code>abi.decode</code></h4>
<p><code>abi.decode</code>ç”¨äºè§£ç <code>abi.encode</code>ç”Ÿæˆçš„äºŒè¿›åˆ¶ç¼–ç ï¼Œå°†å®ƒè¿˜åŸæˆåŸæœ¬çš„å‚æ•°ã€‚</p>
<pre><code class="hljs language-solidity" lang="solidity">function decode(bytes memory data) public pure returns(uint dx, address daddr, string memory dname, uint[2] memory darray) {
    (dx, daddr, dname, darray) = abi.decode(data, (uint, address, string, uint[2]));
}
</code></pre>
<h4 data-id="heading-40">ä»£ç </h4>
<pre><code class="hljs language-solidity" lang="solidity">// SPDX-License-Identifier: MIT
pragma solidity ^0.8.21;

contract ABIEncode{
    uint x = 10;
    address addr = 0x7A58c0Be72BE218B41C608b7Fe7C5bB630736C71;
    string name = "0xAA";
    uint[2] array = [5, 6]; 

    function encode() public view returns(bytes memory result) {
        result = abi.encode(x, addr, name, array);
    }

    function encodePacked() public view returns(bytes memory result) {
        result = abi.encodePacked(x, addr, name, array);
    }

    function encodeWithSignature() public view returns(bytes memory result) {
        result = abi.encodeWithSignature("foo(uint256,address,string,uint256[2])", x, addr, name, array);
    }

    function encodeWithSelector() public view returns(bytes memory result) {
        result = abi.encodeWithSelector(bytes4(keccak256("foo(uint256,address,string,uint256[2])")), x, addr, name, array);
    }
    function decode(bytes memory data) public pure returns(uint dx, address daddr, string memory dname, uint[2] memory darray) {
        (dx, daddr, dname, darray) = abi.decode(data, (uint, address, string, uint[2]));
    }
}
</code></pre>
<h3 data-id="heading-41">13.é€‰æ‹©å™¨</h3>
<h4 data-id="heading-42">1.msg.data</h4>
<p><code>msg.data</code>æ˜¯<code>Solidity</code>ä¸­çš„ä¸€ä¸ªå…¨å±€å˜é‡ï¼Œå€¼ä¸ºå®Œæ•´çš„<code>calldata</code>ï¼ˆè°ƒç”¨å‡½æ•°æ—¶ä¼ å…¥çš„æ•°æ®ï¼‰ã€‚</p>
<p>åœ¨ä¸‹é¢çš„ä»£ç ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡<code>Log</code>äº‹ä»¶æ¥è¾“å‡ºè°ƒç”¨<code>mint</code>å‡½æ•°çš„<code>calldata</code>ï¼š</p>
<pre><code class="hljs language-solidity" lang="solidity">// event è¿”å›msg.data
event Log(bytes data);

function mint(address to) external{
    emit Log(msg.data);
}
</code></pre>
<p>å½“å‚æ•°ä¸º<code>0x2c44b726ADF1963cA47Af88B284C06f30380fC78</code>æ—¶ï¼Œè¾“å‡ºçš„<code>calldata</code>ä¸º</p>
<pre><code class="hljs">0x6a6278420000000000000000000000002c44b726adf1963ca47af88b284c06f30380fc78
</code></pre>
<p>è¿™æ®µå¾ˆä¹±çš„å­—èŠ‚ç å¯ä»¥åˆ†æˆä¸¤éƒ¨åˆ†ï¼š</p>
<pre><code class="hljs">å‰4ä¸ªå­—èŠ‚ä¸ºå‡½æ•°é€‰æ‹©å™¨selectorï¼š
0x6a627842

åé¢32ä¸ªå­—èŠ‚ä¸ºè¾“å…¥çš„å‚æ•°ï¼š
0x0000000000000000000000002c44b726adf1963ca47af88b284c06f30380fc78
</code></pre>
<p>å…¶å®<code>calldata</code>å°±æ˜¯å‘Šè¯‰æ™ºèƒ½åˆçº¦ï¼Œæˆ‘è¦è°ƒç”¨å“ªä¸ªå‡½æ•°ï¼Œä»¥åŠå‚æ•°æ˜¯ä»€ä¹ˆã€‚</p>
<h4 data-id="heading-43">2.method idã€selectorå’Œå‡½æ•°ç­¾å</h4>
<p><code>method id</code>å®šä¹‰ä¸º<code>å‡½æ•°ç­¾å</code>çš„<code>Keccak</code>å“ˆå¸Œåçš„å‰4ä¸ªå­—èŠ‚ï¼Œå½“<code>selector</code>ä¸<code>method id</code>ç›¸åŒ¹é…æ—¶ï¼Œå³è¡¨ç¤ºè°ƒç”¨è¯¥å‡½æ•°ï¼Œé‚£ä¹ˆ<code>å‡½æ•°ç­¾å</code>æ˜¯ä»€ä¹ˆï¼Ÿ</p>
<p>å‡½æ•°ç­¾åï¼Œä¸º<code>"å‡½æ•°åï¼ˆé€—å·åˆ†éš”çš„å‚æ•°ç±»å‹)"</code>ä¸¾ä¸ªä¾‹å­ï¼Œä¸Šé¢ä»£ç ä¸­<code>mint</code>çš„å‡½æ•°ç­¾åä¸º<code>"mint(address)"</code>ã€‚åœ¨åŒä¸€ä¸ªæ™ºèƒ½åˆçº¦ä¸­ï¼Œä¸åŒçš„å‡½æ•°æœ‰ä¸åŒçš„å‡½æ•°ç­¾åï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥é€šè¿‡å‡½æ•°ç­¾åæ¥ç¡®å®šè¦è°ƒç”¨å“ªä¸ªå‡½æ•°ã€‚</p>
<p><strong>æ³¨æ„</strong>ï¼Œåœ¨å‡½æ•°ç­¾åä¸­ï¼Œ<code>uint</code>å’Œ<code>int</code>è¦å†™ä¸º<code>uint256</code>å’Œ<code>int256</code>ã€‚</p>
<p>æˆ‘ä»¬å†™ä¸€ä¸ªå‡½æ•°ï¼Œæ¥éªŒè¯<code>mint</code>å‡½æ•°çš„<code>method id</code>æ˜¯å¦ä¸º<code>0x6a627842</code>ã€‚å¤§å®¶å¯ä»¥è¿è¡Œä¸‹é¢çš„å‡½æ•°ï¼Œçœ‹çœ‹ç»“æœã€‚</p>
<pre><code class="hljs language-solidity" lang="solidity">function mintSelector() external pure returns(bytes4 mSelector){
    return bytes4(keccak256("mint(address)"));
}
</code></pre>
<p>ç»“æœæ­£æ˜¯0x6a627842</p>
<p>ç”±äºè®¡ç®—<code>method id</code>æ—¶ï¼Œéœ€è¦é€šè¿‡å‡½æ•°åå’Œå‡½æ•°çš„å‚æ•°ç±»å‹æ¥è®¡ç®—ã€‚åœ¨<code>Solidity</code>ä¸­ï¼Œå‡½æ•°çš„å‚æ•°ç±»å‹ä¸»è¦åˆ†ä¸ºï¼šåŸºç¡€ç±»å‹å‚æ•°ï¼Œå›ºå®šé•¿åº¦ç±»å‹å‚æ•°ï¼Œå¯å˜é•¿åº¦ç±»å‹å‚æ•°å’Œæ˜ å°„ç±»å‹å‚æ•°ã€‚</p>
<h5 data-id="heading-44">åŸºç¡€ç±»å‹å‚æ•°</h5>
<p><code>solidity</code>ä¸­ï¼ŒåŸºç¡€ç±»å‹çš„å‚æ•°æœ‰ï¼š<code>uint256</code>(<code>uint8</code>, ... , <code>uint256</code>)ã€<code>bool</code>, <code>address</code>ç­‰ã€‚åœ¨è®¡ç®—<code>method id</code>æ—¶ï¼Œåªéœ€è¦è®¡ç®—<code>bytes4(keccak256("å‡½æ•°å(å‚æ•°ç±»å‹1,å‚æ•°ç±»å‹2,...)"))</code>ã€‚ä¾‹å¦‚ï¼Œå¦‚ä¸‹å‡½æ•°ï¼Œå‡½æ•°åä¸º<code>elementaryParamSelector</code>ï¼Œå‚æ•°ç±»å‹åˆ†åˆ«ä¸º<code>uint256</code>å’Œ<code>bool</code>ã€‚æ‰€ä»¥ï¼Œåªéœ€è¦è®¡ç®—<code>bytes4(keccak256("elementaryParamSelector(uint256,bool)"))</code>ä¾¿å¯å¾—åˆ°æ­¤å‡½æ•°çš„<code>method id</code>ã€‚</p>
<pre><code class="hljs language-solidity" lang="solidity">// elementaryï¼ˆåŸºç¡€ï¼‰ç±»å‹å‚æ•°selector
    // è¾“å…¥ï¼šparam1: 1ï¼Œparam2: 0
    // elementaryParamSelector(uint256,bool) : 0x3ec37834
    function elementaryParamSelector(uint256 param1, bool param2) external returns(bytes4 selectorWithElementaryParam){
        emit SelectorEvent(this.elementaryParamSelector.selector);
        return bytes4(keccak256("elementaryParamSelector(uint256,bool)"));
    }
</code></pre>
<h5 data-id="heading-45">å›ºå®šé•¿åº¦ç±»å‹å‚æ•°</h5>
<p>å›ºå®šé•¿åº¦çš„å‚æ•°ç±»å‹é€šå¸¸ä¸ºå›ºå®šé•¿åº¦çš„æ•°ç»„ï¼Œä¾‹å¦‚ï¼š<code>uint256[5]</code>ç­‰ã€‚ä¾‹å¦‚ï¼Œå¦‚ä¸‹å‡½æ•°<code>fixedSizeParamSelector</code>çš„å‚æ•°ä¸º<code>uint256[3]</code>ã€‚å› æ­¤ï¼Œåœ¨è®¡ç®—è¯¥å‡½æ•°çš„<code>method id</code>æ—¶ï¼Œåªéœ€è¦é€šè¿‡<code>bytes4(keccak256("fixedSizeParamSelector(uint256[3])"))</code>å³å¯ã€‚</p>
<pre><code class="hljs language-solidity" lang="solidity">// fixed sizeï¼ˆå›ºå®šé•¿åº¦ï¼‰ç±»å‹å‚æ•°selector
    // è¾“å…¥ï¼š param1: [1,2,3]
    // fixedSizeParamSelector(uint256[3]) : 0xead6b8bd
    function fixedSizeParamSelector(uint256[3] memory param1) external returns(bytes4 selectorWithFixedSizeParam){
        emit SelectorEvent(this.fixedSizeParamSelector.selector);
        return bytes4(keccak256("fixedSizeParamSelector(uint256[3])"));
    }
</code></pre>
<h5 data-id="heading-46">å¯å˜é•¿åº¦ç±»å‹å‚æ•°</h5>
<p>å¯å˜é•¿åº¦å‚æ•°ç±»å‹é€šå¸¸ä¸ºå¯å˜é•¿çš„æ•°ç»„ï¼Œä¾‹å¦‚ï¼š<code>address[]</code>ã€<code>uint8[]</code>ã€<code>string</code>ç­‰ã€‚ä¾‹å¦‚ï¼Œå¦‚ä¸‹å‡½æ•°<code>nonFixedSizeParamSelector</code>çš„å‚æ•°ä¸º<code>uint256[]</code>å’Œ<code>string</code>ã€‚å› æ­¤ï¼Œåœ¨è®¡ç®—è¯¥å‡½æ•°çš„<code>method id</code>æ—¶ï¼Œåªéœ€è¦é€šè¿‡<code>bytes4(keccak256("nonFixedSizeParamSelector(uint256[],string)"))</code>å³å¯ã€‚</p>
<pre><code class="hljs language-solidity" lang="solidity">// non-fixed sizeï¼ˆå¯å˜é•¿åº¦ï¼‰ç±»å‹å‚æ•°selector
    // è¾“å…¥ï¼š param1: [1,2,3]ï¼Œ param2: "abc"
    // nonFixedSizeParamSelector(uint256[],string) : 0xf0ca01de
    function nonFixedSizeParamSelector(uint256[] memory param1,string memory param2) external returns(bytes4 selectorWithNonFixedSizeParam){
        emit SelectorEvent(this.nonFixedSizeParamSelector.selector);
        return bytes4(keccak256("nonFixedSizeParamSelector(uint256[],string)"));
    }
</code></pre>
<h5 data-id="heading-47">æ˜ å°„ç±»å‹å‚æ•°</h5>
<p>æ˜ å°„ç±»å‹å‚æ•°é€šå¸¸æœ‰ï¼š<code>contract</code>ã€<code>enum</code>ã€<code>struct</code>ç­‰ã€‚åœ¨è®¡ç®—<code>method id</code>æ—¶ï¼Œéœ€è¦å°†è¯¥ç±»å‹è½¬åŒ–æˆä¸º<code>ABI</code>ç±»å‹ã€‚</p>
<p>ä¾‹å¦‚ï¼Œå¦‚ä¸‹å‡½æ•°<code>mappingParamSelector</code>ä¸­<code>DemoContract</code>éœ€è¦è½¬åŒ–ä¸º<code>address</code>ï¼Œç»“æ„ä½“<code>User</code>éœ€è¦è½¬åŒ–ä¸º<code>tuple</code>ç±»å‹<code>(uint256,bytes)</code>ï¼Œæšä¸¾ç±»å‹<code>School</code>éœ€è¦è½¬åŒ–ä¸º<code>uint8</code>ã€‚å› æ­¤ï¼Œè®¡ç®—è¯¥å‡½æ•°çš„<code>method id</code>çš„ä»£ç ä¸º<code>bytes4(keccak256("mappingParamSelector(address,(uint256,bytes),uint256[],uint8)"))</code>ã€‚</p>
<pre><code class="hljs language-solidity" lang="solidity">contract DemoContract {
    // empty contract
}

contract Selector{
    // Struct User
    struct User {
        uint256 uid;
        bytes name;
    }
    // Enum School
    enum School { SCHOOL1, SCHOOL2, SCHOOL3 }
    ...
    // mappingï¼ˆæ˜ å°„ï¼‰ç±»å‹å‚æ•°selector
    // è¾“å…¥ï¼šdemo: 0x9D7f74d0C41E726EC95884E0e97Fa6129e3b5E99ï¼Œ user: [1, "0xa0b1"], count: [1,2,3], mySchool: 1
    // mappingParamSelector(address,(uint256,bytes),uint256[],uint8) : 0xe355b0ce
    function mappingParamSelector(DemoContract demo, User memory user, uint256[] memory count, School mySchool) external returns(bytes4 selectorWithMappingParam){
        emit SelectorEvent(this.mappingParamSelector.selector);
        return bytes4(keccak256("mappingParamSelector(address,(uint256,bytes),uint256[],uint8)"));
    }
    ...
}
</code></pre>
<h4 data-id="heading-48">3.ä½¿ç”¨selector</h4>
<p>æˆ‘ä»¬å¯ä»¥åˆ©ç”¨<code>selector</code>æ¥è°ƒç”¨ç›®æ ‡å‡½æ•°ã€‚ä¾‹å¦‚æˆ‘æƒ³è°ƒç”¨<code>elementaryParamSelector</code>å‡½æ•°ï¼Œæˆ‘åªéœ€è¦åˆ©ç”¨<code>abi.encodeWithSelector</code>å°†<code>elementaryParamSelector</code>å‡½æ•°çš„<code>method id</code>ä½œä¸º<code>selector</code>å’Œå‚æ•°æ‰“åŒ…ç¼–ç ï¼Œä¼ ç»™<code>call</code>å‡½æ•°ï¼š</p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-comment">// ä½¿ç”¨selectoræ¥è°ƒç”¨å‡½æ•°</span>
    function <span class="hljs-built_in">callWithSignature</span>() external{
	...
        <span class="hljs-comment">// è°ƒç”¨elementaryParamSelectorå‡½æ•°</span>
        (bool success1, bytes memory data1) = <span class="hljs-selector-tag">address</span>(this)<span class="hljs-selector-class">.call</span>(abi.encodeWithSelector(<span class="hljs-number">0</span>x3ec37834, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>));
	...
    }
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[corepack ä½œç”¨]]></title>    <link>https://juejin.cn/post/7603769956975280169</link>    <guid>https://juejin.cn/post/7603769956975280169</guid>    <pubDate>2026-02-08T07:06:50.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7603769956975280169" data-draft-id="7603677143214669839" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="corepack ä½œç”¨"/> <meta itemprop="keywords" content="å‰ç«¯"/> <meta itemprop="datePublished" content="2026-02-08T07:06:50.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="code_YuJun"/> <meta itemprop="url" content="https://juejin.cn/user/3615612462441358"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            corepack ä½œç”¨
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3615612462441358/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    code_YuJun
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-08T07:06:50.000Z" title="Sun Feb 08 2026 07:06:50 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    8
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»2åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><code>corepack</code> å¯ä»¥æŠŠå®ƒç†è§£æˆ <strong>Node.js è‡ªå¸¦çš„â€œåŒ…ç®¡ç†å™¨ç®¡ç†å™¨â€</strong> ã€‚<br/>
<strong>corepack ç”¨æ¥ç®¡ç†å’Œé”å®šé¡¹ç›®ä½¿ç”¨çš„åŒ…ç®¡ç†å™¨ï¼ˆæ¯”å¦‚ pnpm / yarnï¼‰ï¼Œè€Œä¸æ˜¯ç®¡ç†ä¾èµ–æœ¬èº«ã€‚</strong></p>
<h2 data-id="heading-0">ä¸ºä»€ä¹ˆä¼šæœ‰ corepack</h2>
<p>ä»¥å‰çš„æƒ…å†µå¾ˆä¹±ï¼š</p>
<ul>
<li>æœ‰çš„äººç”¨ <code>npm</code></li>
<li>æœ‰çš„äººç”¨ <code>yarn</code></li>
<li>æœ‰çš„äººç”¨ <code>pnpm</code></li>
<li>åŒä¸€ä¸ªé¡¹ç›®é‡Œï¼Œä¸åŒäººç”¨çš„ <strong>åŒ…ç®¡ç†å™¨ç‰ˆæœ¬è¿˜ä¸ä¸€æ ·</strong></li>
</ul>
<p>ç»“æœå°±æ˜¯ï¼š</p>
<blockquote>
<p>â€œæˆ‘è¿™èƒ½è·‘ï¼Œä½ é‚£ä¸ºå•¥è£…ä¸èµ·æ¥ï¼Ÿâ€</p>
</blockquote>
<p><code>corepack</code> çš„å‡ºç°ï¼Œå°±æ˜¯ä¸ºäº†è§£å†³ <strong>â€œåˆ°åº•ç”¨å“ªä¸ªåŒ…ç®¡ç†å™¨ã€ç”¨å“ªä¸ªç‰ˆæœ¬â€</strong> è¿™ä¸ªé—®é¢˜ã€‚</p>
<h2 data-id="heading-1">corepack èƒ½å¹²ä»€ä¹ˆ</h2>
<h3 data-id="heading-2">1ï¸âƒ£ ç»Ÿä¸€é¡¹ç›®ä½¿ç”¨çš„åŒ…ç®¡ç†å™¨</h3>
<p>åœ¨ <code>package.json</code> é‡Œå¯ä»¥å†™ï¼š</p>
<pre><code class="hljs language-perl" lang="perl">{
  <span class="hljs-string">"packageManager"</span>: <span class="hljs-string">"pnpm@8.15.4"</span>
}
</code></pre>
<p>å«ä¹‰æ˜¯ï¼š</p>
<blockquote>
<p>è¿™ä¸ªé¡¹ç›® <strong>å¿…é¡»</strong> ç”¨ <code>pnpm</code>ï¼Œè€Œä¸”ç‰ˆæœ¬æ˜¯ <code>8.15.4</code></p>
</blockquote>
<p>è¿™æ—¶å€™ï¼š</p>
<ul>
<li>ä½  <code>pnpm install</code></li>
<li>åŒäº‹ <code>npm install</code></li>
<li>CI é‡Œè·‘ <code>pnpm install</code></li>
</ul>
<p>ğŸ‘‰ <strong>corepack ä¼šè‡ªåŠ¨å¸®ä½ ä¸‹è½½å¹¶ä½¿ç”¨æ­£ç¡®ç‰ˆæœ¬çš„ pnpm</strong></p>
<p>ä¸ç”¨å¤§å®¶æ‰‹åŠ¨è£…ã€‚</p>
<hr/>
<h3 data-id="heading-3">2ï¸âƒ£ è‡ªåŠ¨å®‰è£… &amp; åˆ‡æ¢ yarn / pnpm</h3>
<p>ä½ ç”šè‡³ä¸éœ€è¦æå‰å…¨å±€è£… pnpmï¼š</p>
<pre><code class="hljs language-bash" lang="bash">corepack <span class="hljs-built_in">enable</span>
pnpm install
</code></pre>
<p>å¦‚æœé¡¹ç›®å£°æ˜çš„æ˜¯ï¼š</p>
<pre><code class="hljs language-perl" lang="perl"><span class="hljs-string">"packageManager"</span>: <span class="hljs-string">"yarn@3.6.1"</span>
</code></pre>
<p>corepack ä¼šï¼š</p>
<ul>
<li>è‡ªåŠ¨ä¸‹è½½ yarn 3.6.1</li>
<li>ç”¨å®ƒæ¥æ‰§è¡Œå‘½ä»¤</li>
</ul>
<p>ä½ æœ¬åœ°æœ‰æ²¡æœ‰ yarn ğŸ‘‰ <strong>ä¸é‡è¦</strong></p>
<hr/>
<h3 data-id="heading-4">3ï¸âƒ£ é˜²æ­¢â€œåŒ…ç®¡ç†å™¨ç‰ˆæœ¬ä¸ä¸€è‡´â€çš„å‘</h3>
<p>æ¯”å¦‚ï¼š</p>
<ul>
<li>A ç”¨ pnpm 7</li>
<li>B ç”¨ pnpm 8</li>
<li>lock æ–‡ä»¶ç»“æ„éƒ½ä¸ä¸€æ ·</li>
</ul>
<p>corepack å¯ä»¥ <strong>å¼ºåˆ¶ç‰ˆæœ¬ä¸€è‡´</strong>ï¼Œä»æºå¤´é¿å…ï¼š</p>
<ul>
<li>lockfile è¢«åå¤æ”¹</li>
<li>CI è·‘ä¸è¿‡</li>
<li>â€œæˆ‘è¿™æ²¡é—®é¢˜å•Šâ€çš„ç„å­¦ bug</li>
</ul>
<hr/>
<h2 data-id="heading-5">corepack å’Œ npm / yarn / pnpm çš„å…³ç³»</h2>
<p>å¯ä»¥è¿™ä¹ˆç†è§£ğŸ‘‡</p>
<pre><code class="hljs">corepack
  â”œâ”€â”€ ç®¡ç† pnpm
  â”œâ”€â”€ ç®¡ç† yarn
  â””â”€â”€ ç®¡ç† npmï¼ˆé—´æ¥ï¼‰
</code></pre>
<ul>
<li><strong>npm / yarn / pnpm</strong>ï¼šçœŸæ­£å¹²æ´»çš„</li>
<li><strong>corepack</strong>ï¼šè´Ÿè´£â€œå‘å·¥å…·ã€ç®¡ç‰ˆæœ¬ã€åšåè°ƒâ€</li>
</ul>
<hr/>
<h2 data-id="heading-6">å¸¸ç”¨å‘½ä»¤é€Ÿè§ˆ ğŸ§ </h2>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># å¯ç”¨ corepackï¼ˆNode 16+ è‡ªå¸¦ï¼‰</span>
corepack <span class="hljs-built_in">enable</span>

<span class="hljs-comment"># æŸ¥çœ‹å½“å‰ corepack ç‰ˆæœ¬</span>
corepack --version

<span class="hljs-comment"># æŒ‡å®šå¹¶æ¿€æ´»æŸä¸ªåŒ…ç®¡ç†å™¨ç‰ˆæœ¬</span>
corepack prepare pnpm@8.15.4 --activate
</code></pre>
<hr/>
<h2 data-id="heading-7">ä»€ä¹ˆæ—¶å€™ä¸€å®šè¦ç”¨ corepack</h2>
<p>éå¸¸æ¨èç”¨åœ¨è¿™äº›åœºæ™¯ğŸ‘‡</p>
<ul>
<li>å›¢é˜Ÿåä½œé¡¹ç›®</li>
<li>monorepoï¼ˆpnpm / yarn workspaceï¼‰</li>
<li>CI / Docker / çº¿ä¸Šæ„å»º</li>
<li>ä½ å·²ç»è¢« â€œlockfile ä¸€ç›´å˜â€ æŠ˜ç£¨è¿‡ ğŸ˜…</li>
</ul>
<hr/>
<h2 data-id="heading-8">ä¸€å¥è¯æ€»ç»“</h2>
<blockquote>
<p><strong>corepack ä¸æ˜¯ç”¨æ¥è£…ä¾èµ–çš„ï¼Œæ˜¯ç”¨æ¥â€œç®¡åŒ…ç®¡ç†å™¨çš„ç‰ˆæœ¬å’Œä½¿ç”¨æƒâ€çš„ã€‚</strong><br/>
å®ƒè®©â€œè¿™ä¸ªé¡¹ç›®è¯¥ç”¨å“ªä¸ªåŒ…ç®¡ç†å™¨ã€å“ªä¸ªç‰ˆæœ¬â€å˜æˆä¸€ä»¶ç¡®å®šçš„äº‹ã€‚</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[pnpm-workspace.yaml]]></title>    <link>https://juejin.cn/post/7603781883973615635</link>    <guid>https://juejin.cn/post/7603781883973615635</guid>    <pubDate>2026-02-08T07:32:43.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7603781883973615635" data-draft-id="7603644943351955462" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="pnpm-workspace.yaml"/> <meta itemprop="keywords" content="å‰ç«¯"/> <meta itemprop="datePublished" content="2026-02-08T07:32:43.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="code_YuJun"/> <meta itemprop="url" content="https://juejin.cn/user/3615612462441358"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            pnpm-workspace.yaml
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3615612462441358/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    code_YuJun
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-08T07:32:43.000Z" title="Sun Feb 08 2026 07:32:43 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    3
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»1åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><code>pnpm-workspace.yaml</code> æ˜¯ <strong>pnpm çš„â€œé¡¹ç›®ç»„ç»‡ä¸è°ƒåº¦ä¸­æ¢â€</strong>ï¼Œå‘Šè¯‰ pnpmï¼šå“ªäº›ç›®å½•æ˜¯åŒä¸€ä¸ª workspaceï¼Œä»¥åŠè¿™äº›åŒ…ä¹‹é—´å¦‚ä½•ååŒå·¥ä½œã€‚</p>
<h2 data-id="heading-0">å®šä¹‰å“ªäº›åŒ…å±äºåŒä¸€ä¸ªä»“åº“</h2>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">packages:</span>
  <span class="hljs-bullet">-</span> <span class="hljs-string">packages/*</span>
  <span class="hljs-bullet">-</span> <span class="hljs-string">apps/*</span>
</code></pre>
<ul>
<li><code>packages/*</code> ä¸‹é¢æ¯ä¸ªæœ‰ <code>package.json</code> çš„ç›®å½•ï¼Œéƒ½æ˜¯ä¸€ä¸ªåŒ…</li>
<li><code>apps/*</code> ä¸‹é¢æ¯ä¸ª app ä¹Ÿæ˜¯ä¸€ä¸ªåŒ…</li>
</ul>
<h2 data-id="heading-1">Workspace å†…åŒ…æœ¬åœ°äº’ç›¸å¼•ç”¨</h2>
<pre><code class="hljs language-js" lang="js">packages/
  utils/
  ui/
apps/
  admin/
</code></pre>
<p>åœ¨ <code>apps/admin/package.json</code> é‡Œï¼š</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"dependencies"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"@my/utils"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"workspace:*"</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>æ•ˆæœæ˜¯ï¼š</p>
<ul>
<li>ä¸å» npm ä¸‹è½½</li>
<li>ç›´æ¥ <strong>è½¯é“¾æ¥åˆ°æœ¬åœ° packages/utils</strong></li>
<li>æ”¹ä»£ç ç«‹åˆ»ç”Ÿæ•ˆ</li>
</ul>
<p>è¿™æ˜¯ monorepo çš„çµé­‚èƒ½åŠ›ã€‚</p>
<h2 data-id="heading-2">ä¾èµ–ç»Ÿä¸€å®‰è£…ã€ç»Ÿä¸€é”å®š</h2>
<p>åœ¨æ ¹ç›®å½•æ‰§è¡Œ<code>pnpm install</code><br/>
pnpm ä¼šï¼š</p>
<ul>
<li>æ‰«æ <code>pnpm-workspace.yaml</code> é‡Œçš„æ‰€æœ‰åŒ…</li>
<li>ç»Ÿä¸€ç”Ÿæˆ <strong>ä¸€ä»½ <code>pnpm-lock.yaml</code></strong></li>
<li>æ‰€æœ‰åŒ…å…±äº«åŒä¸€ä¸ªä¾èµ–æ ‘</li>
</ul>
<h2 data-id="heading-3">æ”¯æŒ catalog</h2>
<p>pnpm-workspace.yaml é‡Œå¯ä»¥è¿™æ ·å†™ï¼š</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">catalog:</span>
  <span class="hljs-attr">vite:</span> <span class="hljs-string">^5.1.0</span>
  <span class="hljs-attr">vue:</span> <span class="hljs-string">^3.4.0</span>
  <span class="hljs-attr">typescript:</span> <span class="hljs-string">^5.3.3</span>
</code></pre>
<p>å­åŒ…ä¸­ï¼š</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-attr">"devDependencies"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"vite"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"catalog:"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"vue"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"catalog:"</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>ç‰ˆæœ¬é›†ä¸­ç®¡ç†ï¼Œä¼ä¸šçº§å·¥ç¨‹æ ‡é….</p>
<h2 data-id="heading-4">æ”¯æŒ workspace åè®®ï¼ˆworkspace:*ï¼‰</h2>
<pre><code class="hljs language-js" lang="js"><span class="hljs-string">"@my/ui"</span>: <span class="hljs-string">"workspace:*"</span>     <span class="hljs-comment">// ä»»æ„ç‰ˆæœ¬</span>
<span class="hljs-string">"@my/ui"</span>: <span class="hljs-string">"workspace:^"</span>     <span class="hljs-comment">// éµå¾ª semver</span>
<span class="hljs-string">"@my/ui"</span>: <span class="hljs-string">"workspace:~"</span>
</code></pre>
<h2 data-id="heading-5">æ‰¹é‡æ‰§è¡Œå‘½ä»¤</h2>
<pre><code class="hljs language-js" lang="js">pnpm -r build
pnpm -r test
pnpm -r lint
</code></pre>
<ul>
<li><code>-r</code> = recursive</li>
<li>å¯¹ workspace é‡Œçš„ <strong>æ‰€æœ‰åŒ…</strong> æ‰§è¡Œ</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Koa.js æ•™ç¨‹ | ä¸€ä»½ä¸å¯å¤šå¾—çš„ Node.js çš„ Web æ¡†æ¶ Koa.js æ•™ç¨‹]]></title>    <link>https://juejin.cn/post/7603771025856692275</link>    <guid>https://juejin.cn/post/7603771025856692275</guid>    <pubDate>2026-02-08T07:49:56.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7603771025856692275" data-draft-id="7603721514203136009" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Koa.js æ•™ç¨‹ | ä¸€ä»½ä¸å¯å¤šå¾—çš„ Node.js çš„ Web æ¡†æ¶ Koa.js æ•™ç¨‹  "/> <meta itemprop="keywords" content="å‰ç«¯,åç«¯,é¢è¯•"/> <meta itemprop="datePublished" content="2026-02-08T07:49:56.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="åƒå¯»girling"/> <meta itemprop="url" content="https://juejin.cn/user/2276467567770442"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Koa.js æ•™ç¨‹ | ä¸€ä»½ä¸å¯å¤šå¾—çš„ Node.js çš„ Web æ¡†æ¶ Koa.js æ•™ç¨‹  
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2276467567770442/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    åƒå¯»girling
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-08T07:49:56.000Z" title="Sun Feb 08 2026 07:49:56 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»9åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;color:rgba(46,36,36,.87);overflow-x:hidden}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{margin-bottom:5px;font-size:30px;font-weight:500}.markdown-body h1:before{content:"#";margin-right:10px;color:#1976d2}.markdown-body h2{font-size:28px;font-weight:400;border-left:5px solid #454545;margin-top:20px;padding-left:10px;transition:all .3s ease-in-out}.markdown-body h2:hover{border-color:#1976d2}.markdown-body h3{font-size:24px;font-weight:400;margin-top:15px;padding-bottom:0}.markdown-body h4{font-size:20px;font-weight:500}.markdown-body h5{font-size:16px}.markdown-body h6{margin-top:5px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body h2:first-letter,.markdown-body h3:first-letter,.markdown-body p:first-letter{text-transform:capitalize}.markdown-body em{text-emphasis:dot;text-emphasis-position:under}.markdown-body img{display:block;margin:0 auto!important;max-width:100%;border-radius:2px;box-shadow:0 2px 4px -1px rgba(0,0,0,.2),0 4px 5px 0 rgba(0,0,0,.14),0 1px 10px 0 rgba(0,0,0,.12)!important}.markdown-body hr{position:relative;width:98%;height:1px;border:none;margin-top:32px;margin-bottom:32px;background-image:linear-gradient(90deg,#ddd,#999,#ddd);overflow:visible}.markdown-body hr:after{content:"";position:absolute;margin:auto;left:0;right:0;bottom:0;top:0;display:inline-block;width:60px;height:20px;background:#fff;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAgCAYAAABgrToAAAADoklEQVRYR82XTYgcRRTHf2933Q1RjAa9eFO8JHoJ8RQVBQ2iBwXBET0YEUTXNVmNQtTpmeqaWV0XNRq/o4KoECSCEPSg4CF+BYUkIIiCoCJCPIhC/Ihh2Z0nVV27VnZnenumW9i6ddV7//frV69fVQurfMgq56NawFTPAU6QyomqXrw6wIZeyhCPebA5buNR+akKyGoAjd6BshthnYdSjqNcRVuOlIUsD2j0SuA94IwuMHdh5ZUykOUBXfSGbmKI54EtAeYIHSZoy5dl4JxvNYBOKdW1KE8BQ8AkVk6WhasWsAiN0TX9gveXQaPP+Aytpc4u+bMI06JNohsYYYYOR2lJWtS3OKDRfcAtQfgDoI6Vo4UCGb0OmAEuDvZvYmVbEd/igC3dzDz7gQu8sPA9kJDK27mBmjqBeLjTg90PDFOjWawFFQd06kZHEfaj3LAIpTRpSXsZ5E06zEYP9sDimnAApYaV2SLZG/wjMeqAkijwW4xQJ5Gf/ZzRC8OW3hiBTGGlURRswW55Bh/Ssxljrwew8l1PQaM14GngvGDzBUKdDsMeTtgU5o8B92PFlUf3YXUrHa7Fys6lBqcCGnX15YQ2A18FyPd7Crd1A3M8C1wdbH4DD3hWeP6IEXbQkG97ajR1HPFnuPP5jFFq1OWX7hl8WM9l1AO648uNfwLk7tytMeogty+xeQ4rO3r6bdcx1nuwOGsHmaXGtPzae4uzGnLH1kQkvpdZGrHjssBZJrL+pqS05KWc8tgITAPXRzYvYOXe/C2OV43eDcRBDtIhoS2f9wzc0Cv8Wls+zoFzUC5zF0U241h5uZtPfptp6OUM8wbK+cH5GEpCS17P3fJei0Z3+npTxryJ8CPzbKMtn/ZyWbkPGl0PuFPkmkjkcb4h4R2ZLwRq1H0ALmvjkf2HwK1Y+T1PY2XABe/sHJ6MxN5lnoSpnC/UGbsTaI5phK2R7x6s3Ffk5YoDOrWm3onwJHBmEP86bPmBrsGaenNoIdnxCH+gPEhLXi0Cl1VBvyPVLSh7gEuC62yAfOIUqabWEaaiucMIk6RyqJ+Q/QM69V26jjW86Gvov/EaoyT8zRCn+Xq7PVrbx0nuYUaO9wM3WAbjCE1NEUw09Um4UV+2OKfYfu5/S19gsAzGKqm6LE5FrShbdS0ku465DjDwKA/oQht19ejqbaEVuRbiLhuHByYLjtUAZpDutzP7cYdHsPJXWbjyNVgFwQoa1WXwf4Jd9YD/Ap80+yE7+u9aAAAAAElFTkSuQmCC);background-repeat:no-repeat;background-size:auto 100%;background-position-x:center}.markdown-body code{font-weight:900;word-break:break-word;border-radius:2px;overflow-x:auto;font-size:.87em;padding:.065em .4em;background-color:#fbe5e1;color:#c0341d}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75;border-radius:0 4px}.markdown-body pre&gt;code{font-weight:400;font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{margin:0 4px;text-decoration:none;color:#027fff;transition:all .3s ease-in-out;padding-bottom:4px;border-bottom:2px solid transparent}.markdown-body a:after{content:"";display:inline-block;width:18px;height:18px;margin-left:4px;vertical-align:middle;background-image:url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyMiIgaGVpZ2h0PSIyMiI+PGcgZmlsbD0ibm9uZSIgZmlsbC1ydWxlPSJldmVub2RkIiBzdHJva2U9IiMwMjdGRkYiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCI+PHBhdGggZD0iTTkuODE1IDYuNDQ4bDEuOTM2LTEuOTM2YzEuMzM3LTEuMzM2IDMuNTgtMS4yNTkgNS4wMTMuMTczIDEuNDMyIDEuNDMyIDEuNTEgMy42NzYuMTczIDUuMDEzbC0xLjQ1MiAxLjQ1Mi0uOTY4Ljk2OGMtMS4zMzcgMS4zMzYtMy41ODEgMS4yNTktNS4wMTMtLjE3MyIvPjxwYXRoIGQ9Ik0xMS4yNjcgMTUuMzY3bC0xLjkzNiAxLjkzNmMtMS4zMzYgMS4zMzctMy41OCAxLjI2LTUuMDEyLS4xNzMtMS40MzItMS40MzItMS41MS0zLjY3Ni0uMTczLTUuMDEybDEuNDUyLTEuNDUyLjk2OC0uOTY4YzEuMzM2LTEuMzM3IDMuNTgtMS4yNiA1LjAxMi4xNzMiLz48L2c+PC9zdmc+);background-size:cover;background-repeat:no-repeat}.markdown-body a:hover{border-color:#027fff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body a.footnote-backref:after,.markdown-body a.footnote-ref:after,.markdown-body sup a:after{display:none!important}.markdown-body table{margin:0 auto 10px;font-size:12px;width:auto;max-width:100%;overflow:auto;border:2px solid #c6c6c6}.markdown-body table img{box-shadow:none!important}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body del{color:rgba(0,0,0,.6)}.markdown-body blockquote{position:relative;color:#666;padding:5px 23px 1px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:hsla(0,0%,78.4%,.12);transition:all .2s ease-in-out}.markdown-body blockquote:hover{border-color:#1976d2}.markdown-body blockquote:after,.markdown-body blockquote:before{position:absolute;font-size:24px;font-weight:800;line-height:24px;color:#cbcbcb;opacity:.6}.markdown-body blockquote:before{content:"â€œ";top:4px;left:6px}.markdown-body blockquote:after{content:"â€";right:8px;bottom:-8px}.markdown-body blockquote&gt;p,.markdown-body blockquote blockquote{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body details{outline:none;border:none;border-left:4px solid #1976d2;padding-left:10px;margin-left:4px}.markdown-body details summary{cursor:pointer;border:none;outline:none;background:#fff;margin:0 -17px}.markdown-body details summary:hover::-webkit-details-marker{color:#1976d2}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">ç¬¬ä¸€ç«  å®‰è£…å’Œé…ç½® koa</h2>
<p>Koa æ˜¯ä¸€ä¸ªè½»é‡çº§ã€ç°ä»£åŒ–çš„æ¡†æ¶, ç”± Express åŸç­äººé©¬å¼€å‘</p>
<p>åˆå§‹åŒ–é…ç½®æ–‡ä»¶ package.json</p>
<pre><code class="hljs language-js" lang="js">npm init -y
</code></pre>
<p>é…ç½® package.json (ESMè§„èŒƒ)</p>
<pre><code class="hljs language-js" lang="js">{
Â  Â  Â <span class="hljs-string">"type"</span>: <span class="hljs-string">"module"</span>,
Â  Â  Â <span class="hljs-string">"name"</span>: <span class="hljs-string">"demo"</span>,
Â  Â  Â <span class="hljs-string">"version"</span>: <span class="hljs-string">"1.0.0"</span>,
Â  Â  Â <span class="hljs-string">"main"</span>: <span class="hljs-string">"index.js"</span>,
Â  Â  Â <span class="hljs-string">"scripts"</span>: {
Â  Â  Â  Â  Â Â <span class="hljs-string">"dev"</span>:<span class="hljs-string">"nodemon index.js"</span>,
Â  Â  Â  Â  Â  Â <span class="hljs-string">"test"</span>: <span class="hljs-string">"echo \"Error: no test specified\" &amp;&amp; exit 1"</span>
Â  Â  Â },
Â  Â  Â <span class="hljs-string">"keywords"</span>: [],
Â  Â  Â <span class="hljs-string">"author"</span>: <span class="hljs-string">""</span>,
Â  Â  Â <span class="hljs-string">"license"</span>: <span class="hljs-string">"ISC"</span>,
Â  Â  Â <span class="hljs-string">"description"</span>: <span class="hljs-string">""</span>
}
</code></pre>
<p>npm å®˜ç½‘</p>
<p>Â  Â  Â <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.npmjs.com%2F" target="_blank" title="https://www.npmjs.com/" ref="nofollow noopener noreferrer">www.npmjs.com</a></p>
<p>å®‰è£…koa
Â  Â  Â </p>
<pre><code class="hljs language-css" lang="css">npm <span class="hljs-selector-tag">i</span> koa
</code></pre>
<blockquote>
<p>Â  Â  Â å…¨å±€å®‰è£… nodemon</p>
<p>Â  .Â Â <code>npm i nodemon -g</code></p>
<p>Â  Â  Â å½“ nodemon æ£€æµ‹åˆ°ç›‘è§†çš„æ–‡ä»¶å‘ç”Ÿæ›´æ”¹æ—¶, ä¼šè‡ªåŠ¨é‡æ–°å¯åŠ¨åº”ç”¨</p>
</blockquote>
<h2 data-id="heading-1">ç¬¬äºŒç«  åˆ›å»ºå¹¶å¯åŠ¨ http æœåŠ¡å™¨</h2>
<h3 data-id="heading-2">ä¸­é—´ä»¶</h3>
<p>ä¸­é—´ä»¶æ˜¯å¤„ç† HTTP è¯·æ±‚å’Œå“åº”çš„å‡½æ•°ï¼Œå®ƒä»¬å¯ä»¥åšä»¥ä¸‹æ“ä½œï¼š</p>
<ul>
<li>å¤„ç†è¯·æ±‚ï¼ˆä¾‹å¦‚è§£æè¯·æ±‚ä½“ã€éªŒè¯ç”¨æˆ·èº«ä»½ç­‰ï¼‰</li>
<li>ä¿®æ”¹å“åº”ï¼ˆä¾‹å¦‚è®¾ç½®å“åº”å¤´ã€å‘é€å“åº”ä½“ç­‰ï¼‰</li>
<li>æ‰§è¡Œåç»­ä¸­é—´ä»¶</li>
</ul>
<blockquote>
<p>ä¸­é—´ä»¶ - å¾ˆé‡è¦çš„æ¦‚å¿µ !!!!!!!</p>
</blockquote>
<p>æ³¨æ„ : app.use() æ–¹æ³•ç”¨äºæ³¨å†Œ <strong>ä¸­é—´ä»¶</strong></p>
<blockquote>
<p><strong>ä¸­é—´ä»¶</strong> æ˜¯å¤„ç† http è¯·æ±‚å’Œå“åº”çš„å‡½æ•°  ,
å½“ä¸€ä¸ªè¯·æ±‚åˆ°è¾¾æœåŠ¡å™¨æ—¶, ä¼šä»ç¬¬ä¸€ä¸ªä¸­é—´ä»¶å¼€å§‹æ‰§è¡Œ, ç›´åˆ°æœ€åä¸€ä¸ªä¸­é—´ä»¶</p>
</blockquote>
<h3 data-id="heading-3">ä¸Šä¸‹æ–‡å¯¹è±¡ ctx</h3>
<p>åœ¨Â <a href="https://link.juejin.cn?target=https%3A%2F%2Fcaijiao.org%2Fkoa%2F" target="_blank" title="https://caijiao.org/koa/" ref="nofollow noopener noreferrer">Koa</a>Â ä¸­ï¼Œ<code>ctx</code>ï¼ˆä¸Šä¸‹æ–‡ï¼‰å¯¹è±¡æ˜¯æ¯ä¸ªä¸­é—´ä»¶å‡½æ•°çš„æ ¸å¿ƒï¼Œå®ƒåŒ…å«äº†è¯·æ±‚å’Œå“åº”çš„æ‰€æœ‰ä¿¡æ¯ã€‚æ‰€æœ‰çš„ HTTP è¯·æ±‚å’Œå“åº”éƒ½é€šè¿‡Â <code>ctx</code>Â è¿›è¡Œå¤„ç†ã€‚</p>
<blockquote>
<p>ä¸Šä¸‹æ–‡å¯¹è±¡ ctx ( context ) åŒ…å«äº†ä¸å½“å‰ http è¯·æ±‚ç›¸å…³çš„æ‰€æœ‰ä¿¡æ¯</p>
<p>å¦‚: httpæ–¹æ³•ã€urlã€è¯·æ±‚å¤´ã€è¯·æ±‚ä½“ã€æŸ¥è¯¢å‚æ•°ç­‰</p>
</blockquote>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> <span class="hljs-title class_">Koa</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'koa'</span>

<span class="hljs-keyword">const</span> hostname = <span class="hljs-string">"127.0.0.1"</span> <span class="hljs-comment">//æœåŠ¡å™¨ç›‘å¬çš„ipåœ°å€</span>
<span class="hljs-keyword">const</span> port = <span class="hljs-number">8008</span> <span class="hljs-comment">//æœåŠ¡å™¨ç›‘å¬çš„ç«¯å£å·</span>

<span class="hljs-comment">/*
    å®ä¾‹åŒ–ä¸€ä¸ª Koa å¯¹è±¡
    å®ä¾‹åŒ–æ˜¯æŒ‡æ ¹æ®ä¸€ä¸ªç±»åˆ›å»ºå…·ä½“å¯¹è±¡çš„è¿‡ç¨‹
*/</span>
<span class="hljs-keyword">const</span> app = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Koa</span>()

app.<span class="hljs-title function_">use</span>(<span class="hljs-keyword">async</span> ctx =&gt; {
    ctx.<span class="hljs-property">body</span> = <span class="hljs-string">"juejin.cn"</span> <span class="hljs-comment">// ä½¿ç”¨ ctx.body è®¾ç½®å“åº”ä½“çš„å†…å®¹</span>
})

<span class="hljs-comment">//å¯åŠ¨ http æœåŠ¡å™¨, å¹¶åœ¨æŒ‡å®šçš„ipåœ°å€(127.0.0.1)å’Œç«¯å£(8008)ä¸Šç›‘å¬è¿æ¥è¯·æ±‚</span>
app.<span class="hljs-title function_">listen</span>(port, hostname, <span class="hljs-function">() =&gt;</span> {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`æœåŠ¡å™¨å·²å¯åŠ¨: http://<span class="hljs-subst">${hostname}</span>:<span class="hljs-subst">${port}</span>`</span>)
})
</code></pre>
<h2 data-id="heading-4">ç¬¬ä¸‰ç«  æ´‹è‘±æ¨¡å‹</h2>
<h3 data-id="heading-5">æ´‹è‘±æ¨¡å‹</h3>
<p>å½“ä½ å¤„ç†ä¸€ä¸ªè¯·æ±‚æ—¶,</p>
<p>å¯ä»¥æƒ³è±¡æˆæ˜¯åœ¨ "å‰¥æ´‹è‘±" ,ä»å¤–å‘å†…ä¸€å±‚ä¸€å±‚åœ°å¾€é‡Œå‰¥,ç›´åˆ°å‰¥åˆ°ä¸­å¿ƒéƒ¨åˆ†</p>
<p>è¿™ä¸ªè¿‡ç¨‹æ¶‰åŠå¯¹ <strong>è¯·æ±‚</strong> çš„å¤šä¸ªå±‚é¢è¿›è¡Œè§£æã€éªŒè¯ã€å¤„ç†</p>
<p>åœ¨å¤„ç†å®Œæ´‹è‘±(<strong>è¯·æ±‚</strong>)å,</p>
<p>æ„å»º <strong>å“åº”</strong> çš„è¿‡ç¨‹å°±åƒæ˜¯ä»ç²¾å¿ƒå‡†å¤‡çš„é£Ÿæ ( <strong>å¤„ç†è¯·æ±‚</strong> åå¾—åˆ°çš„æ•°æ®) å¼€å§‹,</p>
<p>ä»å†…å‘å¤–é€å±‚æ·»åŠ è°ƒæ–™(æ ¼å¼åŒ–ã€å°è£…ç­‰),æœ€ç»ˆå½¢æˆä¸€é“è‰²é¦™å‘³ä¿±ä½³çš„èœè‚´(<strong>å“åº”</strong>)</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e1994778ec0f4f0881f16b64bb9298a3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y2D5a-7Z2lybGluZw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771141796&amp;x-signature=i0WpLyNKGUcwji%2B%2FE6Kaq4UvRCs%3D" alt="image.png" loading="lazy"/></p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> <span class="hljs-title class_">Koa</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'koa'</span>

<span class="hljs-keyword">const</span> hostname = <span class="hljs-string">"127.0.0.1"</span> <span class="hljs-comment">//æœåŠ¡å™¨ç›‘å¬çš„ipåœ°å€</span>
<span class="hljs-keyword">const</span> port = <span class="hljs-number">8008</span> <span class="hljs-comment">//æœåŠ¡å™¨ç›‘å¬çš„ç«¯å£å·</span>

<span class="hljs-comment">/*
    å®ä¾‹åŒ–ä¸€ä¸ª Koa å¯¹è±¡
    å®ä¾‹åŒ–æ˜¯æŒ‡æ ¹æ®ä¸€ä¸ªç±»åˆ›å»ºå…·ä½“å¯¹è±¡çš„è¿‡ç¨‹
*/</span>
<span class="hljs-keyword">const</span> app = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Koa</span>()

<span class="hljs-comment">/*
    app.use() æ–¹æ³•ç”¨äºæ³¨å†Œä¸­é—´ä»¶
    ä¸­é—´ä»¶æ˜¯å¤„ç† http è¯·æ±‚å’Œå“åº”çš„å‡½æ•°
    å½“ä¸€ä¸ªè¯·æ±‚åˆ°è¾¾æœåŠ¡å™¨æ—¶, ä¼šä»ç¬¬ä¸€ä¸ªä¸­é—´ä»¶å¼€å§‹æ‰§è¡Œ, ç›´åˆ°æœ€åä¸€ä¸ªä¸­é—´ä»¶
    
    ä¸Šä¸‹æ–‡å¯¹è±¡ ctx(context) åŒ…å«äº†ä¸å½“å‰ http è¯·æ±‚ç›¸å…³çš„æ‰€æœ‰ä¿¡æ¯
    å¦‚: httpæ–¹æ³•ã€urlã€è¯·æ±‚å¤´ã€è¯·æ±‚ä½“ã€æŸ¥è¯¢å‚æ•°ç­‰
*/</span>
app.<span class="hljs-title function_">use</span>(<span class="hljs-keyword">async</span> (ctx,next) =&gt; {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-number">1</span>)
    <span class="hljs-keyword">await</span> <span class="hljs-title function_">next</span>() <span class="hljs-comment">//è‹¥ä¸­é—´ä»¶è°ƒç”¨äº†next(),ä¼šæš‚åœå½“å‰ä¸­é—´ä»¶çš„æ‰§è¡Œ,å°†æ§åˆ¶æƒä¼ é€’ç»™ä¸‹ä¸€ä¸ªä¸­é—´ä»¶</span>
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-number">2</span>)
})

app.<span class="hljs-title function_">use</span>(<span class="hljs-keyword">async</span> (ctx,next) =&gt; { 
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-number">3</span>)
    <span class="hljs-keyword">await</span> <span class="hljs-title function_">next</span>()
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-number">4</span>)
})

<span class="hljs-comment">//å½“ä¸­é—´ä»¶æ²¡æœ‰å†è°ƒç”¨next(),åˆ™ä¸éœ€è¦å†å°†æ§åˆ¶æƒä¼ é€’ç»™ä¸‹ä¸€ä¸ªä¸­é—´ä»¶,æ§åˆ¶æƒä¼šæŒ‰ç…§ç›¸åçš„é¡ºåºæ‰§è¡Œ</span>
app.<span class="hljs-title function_">use</span>(<span class="hljs-keyword">async</span> (ctx,next) =&gt; {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-number">5</span>)
    ctx.<span class="hljs-property">body</span> = <span class="hljs-string">"dengruicode.com"</span> <span class="hljs-comment">// ä½¿ç”¨ ctx.body è®¾ç½®å“åº”ä½“çš„å†…å®¹</span>
})

<span class="hljs-comment">//å¯åŠ¨ http æœåŠ¡å™¨, å¹¶åœ¨æŒ‡å®šçš„ipåœ°å€(127.0.0.1)å’Œç«¯å£(8008)ä¸Šç›‘å¬è¿æ¥è¯·æ±‚</span>
app.<span class="hljs-title function_">listen</span>(port, hostname, <span class="hljs-function">() =&gt;</span> {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`æœåŠ¡å™¨å·²å¯åŠ¨: http://<span class="hljs-subst">${hostname}</span>:<span class="hljs-subst">${port}</span>`</span>)
})
</code></pre>
<h2 data-id="heading-6">ç¬¬å››ç«  å®‰è£…å’Œé…ç½®è·¯ç”± - getè¯·æ±‚</h2>
<p>åœ¨ Koa ä¸­ï¼Œ<code>koa-router</code>Â æ˜¯ä¸€ä¸ªè½»é‡çº§çš„è·¯ç”±ä¸­é—´ä»¶ï¼Œå®ƒå¯ä»¥å¸®åŠ©ä½ å®šä¹‰è·¯ç”±ã€å¤„ç† HTTP è¯·æ±‚å¹¶è§£æè¯·æ±‚å‚æ•°ã€‚é€šè¿‡ä½¿ç”¨Â <code>koa-router</code>ï¼Œä½ å¯ä»¥åˆ›å»ºä¸€ä¸ªçµæ´»çš„è·¯ç”±ç³»ç»Ÿï¼Œè½»æ¾åœ°ç»„ç»‡å’Œç®¡ç†Â <a href="https://link.juejin.cn?target=https%3A%2F%2Fcaijiao.org%2Fkoa%2F" target="_blank" title="https://caijiao.org/koa/" ref="nofollow noopener noreferrer">Koa</a>Â åº”ç”¨çš„å„ä¸ªéƒ¨åˆ†ã€‚</p>
<h3 data-id="heading-7">å®‰è£… koa-router</h3>
<p>é¦–å…ˆï¼Œä½ éœ€è¦å®‰è£…Â <code>koa-router</code>ï¼š</p>
<pre><code class="hljs language-ruby" lang="ruby">npm install <span class="hljs-variable">@koa</span>/router       <span class="hljs-comment"># æ³¨æ„ï¼šæ–°ç‰ˆ koa-router åŒ…åæ˜¯ <span class="hljs-doctag">@koa</span>/router</span>
</code></pre>

<pre><code class="hljs language-dart" lang="dart"><span class="hljs-keyword">import</span> Koa from <span class="hljs-string">'koa'</span>
<span class="hljs-keyword">import</span> Router from <span class="hljs-string">'@koa/router'</span>

<span class="hljs-keyword">const</span> hostname = <span class="hljs-string">"127.0.0.1"</span>
<span class="hljs-keyword">const</span> port = <span class="hljs-number">8008</span>

<span class="hljs-keyword">const</span> app = <span class="hljs-keyword">new</span> Koa()
<span class="hljs-keyword">const</span> router = <span class="hljs-keyword">new</span> Router() <span class="hljs-comment">//å®ä¾‹åŒ–ä¸€ä¸ª Router å¯¹è±¡</span>

<span class="hljs-comment">//------ getè¯·æ±‚</span>
<span class="hljs-comment">//è·¯ç”±æ˜¯æ ¹æ®å®¢æˆ·ç«¯å‘é€çš„è¯·æ±‚(åŒ…æ‹¬è¯·æ±‚çš„è·¯å¾„ã€æ–¹æ³•ç­‰)è°ƒç”¨ä¸ä¹‹åŒ¹é…çš„å¤„ç†å‡½æ•°</span>
<span class="hljs-comment">//æ ¹è·¯ç”± http://127.0.0.1:8008/</span>
router.<span class="hljs-keyword">get</span>(<span class="hljs-string">'/'</span>, <span class="hljs-keyword">async</span> ctx =&gt; { <span class="hljs-comment">//getè¯·æ±‚</span>
    ctx.body = <span class="hljs-string">"dengruicode.com"</span>
})

<span class="hljs-comment">//æŸ¥è¯¢å‚æ•° http://127.0.0.1:8008/test?id=001&amp;web=dengruicode.com</span>
router.<span class="hljs-keyword">get</span>(<span class="hljs-string">'/test'</span>, <span class="hljs-keyword">async</span> ctx =&gt; { <span class="hljs-comment">//getè¯·æ±‚</span>
    let id = ctx.query.id
    let web = ctx.query.web
    ctx.body = id + <span class="hljs-string">" : "</span> + web
})

<span class="hljs-comment">//è·¯å¾„å‚æ•° http://127.0.0.1:8008/test2/id/002/web/www.dengruicode.com</span>
router.<span class="hljs-keyword">get</span>(<span class="hljs-string">'/test2/id/:id/web/:web'</span>, <span class="hljs-keyword">async</span> ctx =&gt; {
    let id = ctx.params.id
    let web = ctx.params.web
    ctx.body = id + <span class="hljs-string">" : "</span> + web
})

<span class="hljs-comment">//é‡å®šå‘è·¯ç”± http://127.0.0.1:8008/test3</span>
router.redirect(<span class="hljs-string">'/test3'</span>, <span class="hljs-string">'https://www.baidu.com'</span>)

app.use(router.routes()) <span class="hljs-comment">//å°†å®šä¹‰åœ¨ router å¯¹è±¡ä¸­çš„è·¯ç”±è§„åˆ™æ·»åŠ åˆ° app å®ä¾‹ä¸­</span>

<span class="hljs-comment">//------ è·¯ç”±åˆ†ç»„</span>
<span class="hljs-comment">//http://127.0.0.1:8008/user/add</span>
<span class="hljs-comment">//http://127.0.0.1:8008/user/del</span>

<span class="hljs-keyword">const</span> userRouter = <span class="hljs-keyword">new</span> Router({ prefix: <span class="hljs-string">'/user'</span> })
userRouter.<span class="hljs-keyword">get</span>(<span class="hljs-string">'/add'</span>, <span class="hljs-keyword">async</span> ctx =&gt; {
    ctx.body = <span class="hljs-string">"æ·»åŠ ç”¨æˆ·"</span>
})
userRouter.<span class="hljs-keyword">get</span>(<span class="hljs-string">'/del'</span>, <span class="hljs-keyword">async</span> ctx =&gt; {
    ctx.body = <span class="hljs-string">"åˆ é™¤ç”¨æˆ·"</span>
})
app.use(userRouter.routes())

<span class="hljs-comment">// åœ¨æ‰€æœ‰è·¯ç”±ä¹‹åæ·»åŠ 404å¤„ç†å‡½æ•°</span>
app.use(<span class="hljs-keyword">async</span> ctx =&gt; {
    <span class="hljs-keyword">if</span> (!ctx.body) { <span class="hljs-comment">//è‹¥æ²¡æœ‰è®¾ç½® ctx.body, åˆ™è¯´æ˜æ²¡æœ‰åˆ°åŒ¹é…ä»»ä½•è·¯ç”±</span>
        ctx.status = <span class="hljs-number">404</span>
        ctx.body = <span class="hljs-string">'404 Not Found'</span>
    }
})

app.listen(port, hostname, () =&gt; {
    console.log(`æœåŠ¡å™¨å·²å¯åŠ¨: http:<span class="hljs-comment">//${hostname}:${port}`)</span>
})
</code></pre>
<h2 data-id="heading-8">ç¬¬äº”ç«  postè¯·æ±‚</h2>
<h3 data-id="heading-9">å®‰è£…Â koa-body</h3>
<p>Koa åŸç”Ÿä¸æ”¯æŒè§£æ POST è¯·æ±‚ä½“ï¼Œéœ€å®‰è£… <code>koa-body</code> ä¸­é—´ä»¶ï¼š</p>
<pre><code class="hljs language-css" lang="css">npm install koa-<span class="hljs-selector-tag">body</span>
</code></pre>
<p>POST è¯·æ±‚å¤„ç†ç¤ºä¾‹</p>
<p>ä¿®æ”¹ <code>src/index.js</code>ï¼Œæ–°å¢ POST è·¯ç”±ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> <span class="hljs-title class_">Koa</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'koa'</span>;
<span class="hljs-keyword">import</span> <span class="hljs-title class_">Router</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'@koa/router'</span>;
<span class="hljs-keyword">import</span> { koaBody } <span class="hljs-keyword">from</span> <span class="hljs-string">'koa-body'</span>;

<span class="hljs-keyword">const</span> app = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Koa</span>();
<span class="hljs-keyword">const</span> router = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Router</span>();
<span class="hljs-keyword">const</span> port = <span class="hljs-number">8008</span>;

<span class="hljs-comment">// æ³¨å†Œ koa-body ä¸­é—´ä»¶ï¼šè§£æ JSONã€è¡¨å•ã€æ–‡ä»¶ç±»å‹çš„ POST æ•°æ®</span>
app.<span class="hljs-title function_">use</span>(<span class="hljs-title function_">koaBody</span>({
  <span class="hljs-attr">multipart</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// æ”¯æŒæ–‡ä»¶ä¸Šä¼ ï¼ˆåç»­ç¬¬å…«ç« ç”¨ï¼‰</span>
  <span class="hljs-attr">json</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// è§£æ JSON æ ¼å¼</span>
  <span class="hljs-attr">urlencoded</span>: <span class="hljs-literal">true</span> <span class="hljs-comment">// è§£æè¡¨å•æ ¼å¼ï¼ˆapplication/x-www-form-urlencodedï¼‰</span>
}));

<span class="hljs-comment">// 1. å¤„ç† JSON æ ¼å¼ POST è¯·æ±‚</span>
router.<span class="hljs-title function_">post</span>(<span class="hljs-string">'/api/json'</span>, <span class="hljs-keyword">async</span> (ctx) =&gt; {
  <span class="hljs-keyword">const</span> { name, age } = ctx.<span class="hljs-property">request</span>.<span class="hljs-property">body</span>;
  ctx.<span class="hljs-property">body</span> = {       <span class="hljs-comment">// ctx.request.body æ˜¯ koa-body è§£æåçš„ POST æ•°æ®</span>
    <span class="hljs-attr">code</span>: <span class="hljs-number">200</span>,
    <span class="hljs-attr">msg</span>: <span class="hljs-string">"JSON æ•°æ®æ¥æ”¶æˆåŠŸ"</span>,
    <span class="hljs-attr">data</span>: { name, age }
  };
});

<span class="hljs-comment">// 2. å¤„ç†è¡¨å•æ ¼å¼ POST è¯·æ±‚</span>
router.<span class="hljs-title function_">post</span>(<span class="hljs-string">'/api/form'</span>, <span class="hljs-keyword">async</span> (ctx) =&gt; {
  <span class="hljs-keyword">const</span> { username, password } = ctx.<span class="hljs-property">request</span>.<span class="hljs-property">body</span>;
  ctx.<span class="hljs-property">body</span> = {
    <span class="hljs-attr">code</span>: <span class="hljs-number">200</span>,
    <span class="hljs-attr">msg</span>: <span class="hljs-string">"è¡¨å•æ•°æ®æ¥æ”¶æˆåŠŸ"</span>,
    <span class="hljs-attr">data</span>: { username, password }
  };
});

app.<span class="hljs-title function_">use</span>(router.<span class="hljs-title function_">routes</span>());

<span class="hljs-comment">// 404 å¤„ç†</span>
app.<span class="hljs-title function_">use</span>(<span class="hljs-keyword">async</span> (ctx) =&gt; {
  ctx.<span class="hljs-property">status</span> = <span class="hljs-number">404</span>;
  ctx.<span class="hljs-property">body</span> = <span class="hljs-string">'404 Not Found'</span>;
});

app.<span class="hljs-title function_">listen</span>(port, <span class="hljs-function">() =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`POST æœåŠ¡å™¨å¯åŠ¨ï¼šhttp://localhost:<span class="hljs-subst">${port}</span>`</span>);
});
</code></pre>
<p>æµ‹è¯• POST è¯·æ±‚ï¼ˆä¸¤ç§æ–¹å¼ï¼‰</p>
<p>æ–¹å¼ 1ï¼šPostman æµ‹è¯•</p>
<ul>
<li>
<p>è¯·æ±‚åœ°å€ï¼š<code>http://localhost:8008/api/json</code></p>
</li>
<li>
<p>è¯·æ±‚æ–¹æ³•ï¼šPOST</p>
</li>
<li>
<p>è¯·æ±‚ä½“ï¼šé€‰æ‹© <code>raw &gt; JSON</code>ï¼Œè¾“å…¥ï¼š</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span> <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"å¼ ä¸‰"</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"age"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">20</span> <span class="hljs-punctuation">}</span>
</code></pre>
</li>
<li>
<p>å“åº”ï¼š<code>{"code":200,"msg":"JSON æ•°æ®æ¥æ”¶æˆåŠŸ","data":{"name":"å¼ ä¸‰","age":20}}</code></p>
</li>
</ul>
<p>æ–¹å¼ 2ï¼šcurl å‘½ä»¤æµ‹è¯•</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># æµ‹è¯• JSON æ ¼å¼</span>
curl -X POST -H <span class="hljs-string">"Content-Type: application/json"</span> -d <span class="hljs-string">'{"name":"å¼ ä¸‰","age":20}'</span> http://localhost:8008/api/json

<span class="hljs-comment"># æµ‹è¯•è¡¨å•æ ¼å¼</span>
curl -X POST -d <span class="hljs-string">"username=admin&amp;password=123456"</span> http://localhost:8008/api/form
</code></pre>
<h2 data-id="heading-10">ç¬¬å…­ç«  é”™è¯¯å¤„ç†</h2>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> <span class="hljs-title class_">Koa</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'koa'</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">Router</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'@koa/router'</span>

<span class="hljs-keyword">const</span> hostname = <span class="hljs-string">"127.0.0.1"</span>
<span class="hljs-keyword">const</span> port = <span class="hljs-number">8008</span>

<span class="hljs-keyword">const</span> app = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Koa</span>()
<span class="hljs-keyword">const</span> router = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Router</span>()

<span class="hljs-comment">//http://127.0.0.1:8008/</span>
router.<span class="hljs-title function_">get</span>(<span class="hljs-string">'/'</span>, <span class="hljs-keyword">async</span> ctx =&gt; {
    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">"æµ‹è¯•"</span>)
})

<span class="hljs-comment">/*
    å°† 'é”™è¯¯å¤„ç†ä¸­é—´ä»¶' æ”¾åœ¨ 'è·¯ç”±å¤„ç†ä¸­é—´ä»¶' ä¹‹å‰, å½“ä¸€ä¸ªè¯·æ±‚åˆ°è¾¾æ—¶,
    ä¼šå…ˆç»è¿‡ 'é”™è¯¯å¤„ç†ä¸­é—´ä»¶', ç„¶åæ‰ä¼šè¿›å…¥ 'è·¯ç”±å¤„ç†ä¸­é—´ä»¶',
    æ˜¯ä¸ºäº†ç¡®ä¿å¯ä»¥æ•è·é”™è¯¯
*/</span>
app.<span class="hljs-title function_">use</span>(<span class="hljs-keyword">async</span> (ctx, next) =&gt; {  <span class="hljs-comment">// é”™è¯¯å¤„ç†ä¸­é—´ä»¶</span>
    <span class="hljs-keyword">try</span> {
        <span class="hljs-keyword">await</span> <span class="hljs-title function_">next</span>()
    } <span class="hljs-keyword">catch</span> (err) {
        <span class="hljs-comment">//console.log('err:', err)</span>
        ctx.<span class="hljs-property">status</span> = <span class="hljs-number">500</span>
        ctx.<span class="hljs-property">body</span> = <span class="hljs-string">'err: '</span> + err.<span class="hljs-property">message</span>
    }
})

app.<span class="hljs-title function_">use</span>(router.<span class="hljs-title function_">routes</span>())   <span class="hljs-comment">// è·¯ç”±å¤„ç†ä¸­é—´ä»¶</span>

app.<span class="hljs-title function_">listen</span>(port, hostname, <span class="hljs-function">() =&gt;</span> {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`æœåŠ¡å™¨å·²å¯åŠ¨: http://<span class="hljs-subst">${hostname}</span>:<span class="hljs-subst">${port}</span>`</span>)
})
</code></pre>
<h2 data-id="heading-11">ç¬¬ä¸ƒç«  å…è®¸è·¨åŸŸè¯·æ±‚</h2>
<p>å®‰è£…è·¨åŸŸä¸­é—´ä»¶</p>
<pre><code class="hljs language-bash" lang="bash">npm install @koa/cors
</code></pre>
<p>è·¨åŸŸé…ç½®ç¤ºä¾‹</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> <span class="hljs-title class_">Koa</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'koa'</span>;
<span class="hljs-keyword">import</span> <span class="hljs-title class_">Router</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'@koa/router'</span>;
<span class="hljs-keyword">import</span> <span class="hljs-title class_">Cors</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'@koa/cors'</span>;

<span class="hljs-keyword">const</span> app = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Koa</span>();
<span class="hljs-keyword">const</span> router = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Router</span>();
<span class="hljs-keyword">const</span> port = <span class="hljs-number">8008</span>;

app.<span class="hljs-title function_">use</span>(<span class="hljs-title class_">Cors</span>()) <span class="hljs-comment">//å…è®¸è·¨åŸŸè¯·æ±‚</span>

<span class="hljs-comment">// æµ‹è¯•è·¨åŸŸè·¯ç”±</span>
router.<span class="hljs-title function_">get</span>(<span class="hljs-string">'/api/cors'</span>, <span class="hljs-keyword">async</span> (ctx) =&gt; {
  ctx.<span class="hljs-property">body</span> = {
    <span class="hljs-attr">code</span>: <span class="hljs-number">200</span>,
    <span class="hljs-attr">msg</span>: <span class="hljs-string">"è·¨åŸŸè¯·æ±‚æˆåŠŸ"</span>
  };
});

app.<span class="hljs-title function_">use</span>(router.<span class="hljs-title function_">routes</span>());

app.<span class="hljs-title function_">listen</span>(port, <span class="hljs-function">() =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`è·¨åŸŸæœåŠ¡å™¨å¯åŠ¨ï¼šhttp://localhost:<span class="hljs-subst">${port}</span>`</span>);
});
</code></pre>
<p>æµ‹è¯•è·¨åŸŸ</p>
<p>åœ¨ä»»æ„å‰ç«¯é¡¹ç›®ï¼ˆå¦‚ Vue / React / HTML æ–‡ä»¶ï¼‰ä¸­å‘é€è¯·æ±‚ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// å‰ç«¯ä»£ç ç¤ºä¾‹</span>
<span class="hljs-title function_">fetch</span>(<span class="hljs-string">'http://localhost:8008/api/cors'</span>)
  .<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">res</span> =&gt;</span> res.<span class="hljs-title function_">json</span>())
  .<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">data</span> =&gt;</span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(data)) <span class="hljs-comment">// è¾“å‡º {code:200, msg:"è·¨åŸŸè¯·æ±‚æˆåŠŸ"}</span>
  .<span class="hljs-keyword">catch</span>(<span class="hljs-function"><span class="hljs-params">err</span> =&gt;</span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(err));
</code></pre>
<p>æ— è·¨åŸŸæŠ¥é”™å³é…ç½®æˆåŠŸã€‚</p>
<h2 data-id="heading-12">ç¬¬å…«ç«  ä¸Šä¼ å›¾ç‰‡</h2>
<p>ä¾èµ–å‡†å¤‡ï¼ˆå¤ç”¨ koa-bodyï¼‰</p>
<p><code>koa-body</code> å·²æ”¯æŒæ–‡ä»¶ä¸Šä¼ ï¼Œæ— éœ€é¢å¤–å®‰è£…ä¾èµ–ï¼Œåªéœ€ç¡®ä¿é…ç½® <code>multipart: true</code>ã€‚</p>
<p>å›¾ç‰‡ä¸Šä¼ ç¤ºä¾‹</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> <span class="hljs-title class_">Koa</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'koa'</span>;
<span class="hljs-keyword">import</span> <span class="hljs-title class_">Router</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'@koa/router'</span>;
<span class="hljs-keyword">import</span> { koaBody } <span class="hljs-keyword">from</span> <span class="hljs-string">'koa-body'</span>;
<span class="hljs-keyword">import</span> fs <span class="hljs-keyword">from</span> <span class="hljs-string">'fs'</span>;
<span class="hljs-keyword">import</span> path <span class="hljs-keyword">from</span> <span class="hljs-string">'path'</span>;

<span class="hljs-keyword">const</span> app = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Koa</span>();
<span class="hljs-keyword">const</span> router = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Router</span>();
<span class="hljs-keyword">const</span> port = <span class="hljs-number">8008</span>;

<span class="hljs-comment">// 1. åˆ›å»ºä¸Šä¼ ç›®å½•ï¼ˆä¸å­˜åœ¨åˆ™åˆ›å»ºï¼‰</span>
<span class="hljs-keyword">const</span> uploadDir = path.<span class="hljs-title function_">join</span>(__dirname, <span class="hljs-string">'uploads'</span>);
<span class="hljs-keyword">if</span> (!fs.<span class="hljs-title function_">existsSync</span>(uploadDir)) {
  fs.<span class="hljs-title function_">mkdirSync</span>(uploadDir, { <span class="hljs-attr">recursive</span>: <span class="hljs-literal">true</span> });
}

<span class="hljs-comment">// 2. é…ç½® koa-body æ”¯æŒæ–‡ä»¶ä¸Šä¼ </span>
app.<span class="hljs-title function_">use</span>(<span class="hljs-title function_">koaBody</span>({
  <span class="hljs-attr">multipart</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// å¼€å¯æ–‡ä»¶ä¸Šä¼ </span>
  <span class="hljs-attr">formidable</span>: {
    <span class="hljs-attr">uploadDir</span>: uploadDir, <span class="hljs-comment">// ä¸´æ—¶å­˜å‚¨ç›®å½•</span>
    <span class="hljs-attr">keepExtensions</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// ä¿ç•™æ–‡ä»¶æ‰©å±•åï¼ˆå¦‚ .png/.jpgï¼‰</span>
    <span class="hljs-attr">maxFieldsSize</span>: <span class="hljs-number">2</span> * <span class="hljs-number">1024</span> * <span class="hljs-number">1024</span>, <span class="hljs-comment">// é™åˆ¶æ–‡ä»¶å¤§å° 2MB</span>
    <span class="hljs-attr">filename</span>: <span class="hljs-function">(<span class="hljs-params">name, ext, part, form</span>) =&gt;</span> {
      <span class="hljs-comment">// è‡ªå®šä¹‰æ–‡ä»¶åï¼šæ—¶é—´æˆ³ + åŸæ‰©å±•åï¼Œé¿å…é‡å¤</span>
      <span class="hljs-keyword">return</span> <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>() + ext;
    }
  }
}));

<span class="hljs-comment">// 3. å›¾ç‰‡ä¸Šä¼ æ¥å£</span>
router.<span class="hljs-title function_">post</span>(<span class="hljs-string">'/api/upload'</span>, <span class="hljs-keyword">async</span> (ctx) =&gt; {
  <span class="hljs-comment">// ctx.request.files æ˜¯ä¸Šä¼ çš„æ–‡ä»¶å¯¹è±¡</span>
  <span class="hljs-keyword">const</span> file = ctx.<span class="hljs-property">request</span>.<span class="hljs-property">files</span>.<span class="hljs-property">file</span>; <span class="hljs-comment">// å‰ç«¯ä¸Šä¼ çš„æ–‡ä»¶å­—æ®µåéœ€ä¸º file</span>
  <span class="hljs-keyword">if</span> (!file) {
    ctx.<span class="hljs-property">status</span> = <span class="hljs-number">400</span>;
    ctx.<span class="hljs-property">body</span> = { <span class="hljs-attr">code</span>: <span class="hljs-number">400</span>, <span class="hljs-attr">msg</span>: <span class="hljs-string">"è¯·é€‰æ‹©ä¸Šä¼ çš„å›¾ç‰‡"</span> };
    <span class="hljs-keyword">return</span>;
  }

  <span class="hljs-comment">// è¿”å›æ–‡ä»¶ä¿¡æ¯</span>
  ctx.<span class="hljs-property">body</span> = {
    <span class="hljs-attr">code</span>: <span class="hljs-number">200</span>,
    <span class="hljs-attr">msg</span>: <span class="hljs-string">"å›¾ç‰‡ä¸Šä¼ æˆåŠŸ"</span>,
    <span class="hljs-attr">data</span>: {
      <span class="hljs-attr">filename</span>: file.<span class="hljs-property">newFilename</span>, <span class="hljs-comment">// è‡ªå®šä¹‰åçš„æ–‡ä»¶å</span>
      <span class="hljs-attr">path</span>: <span class="hljs-string">`/uploads/<span class="hljs-subst">${file.newFilename}</span>`</span>, <span class="hljs-comment">// è®¿é—®è·¯å¾„</span>
      <span class="hljs-attr">size</span>: file.<span class="hljs-property">size</span> <span class="hljs-comment">// æ–‡ä»¶å¤§å°ï¼ˆå­—èŠ‚ï¼‰</span>
    }
  };
});

<span class="hljs-comment">// 4. é™æ€æ–‡ä»¶è®¿é—®ï¼šè®©ä¸Šä¼ çš„å›¾ç‰‡å¯é€šè¿‡ URL è®¿é—®</span>
app.<span class="hljs-title function_">use</span>(<span class="hljs-keyword">async</span> (ctx, next) =&gt; {
  <span class="hljs-keyword">if</span> (ctx.<span class="hljs-property">path</span>.<span class="hljs-title function_">startsWith</span>(<span class="hljs-string">'/uploads/'</span>)) {
    <span class="hljs-keyword">const</span> filePath = path.<span class="hljs-title function_">join</span>(uploadDir, ctx.<span class="hljs-property">path</span>.<span class="hljs-title function_">replace</span>(<span class="hljs-string">'/uploads/'</span>, <span class="hljs-string">''</span>));
    <span class="hljs-keyword">if</span> (fs.<span class="hljs-title function_">existsSync</span>(filePath)) {
      ctx.<span class="hljs-property">type</span> = path.<span class="hljs-title function_">extname</span>(filePath).<span class="hljs-title function_">slice</span>(<span class="hljs-number">1</span>); <span class="hljs-comment">// è®¾ç½®å“åº”ç±»å‹ï¼ˆå¦‚ png/jpgï¼‰</span>
      ctx.<span class="hljs-property">body</span> = fs.<span class="hljs-title function_">createReadStream</span>(filePath); <span class="hljs-comment">// è¯»å–æ–‡ä»¶å¹¶è¿”å›</span>
      <span class="hljs-keyword">return</span>;
    }
    ctx.<span class="hljs-property">status</span> = <span class="hljs-number">404</span>;
    ctx.<span class="hljs-property">body</span> = <span class="hljs-string">"æ–‡ä»¶ä¸å­˜åœ¨"</span>;
    <span class="hljs-keyword">return</span>;
  }
  <span class="hljs-keyword">await</span> <span class="hljs-title function_">next</span>();
});

app.<span class="hljs-title function_">use</span>(router.<span class="hljs-title function_">routes</span>());

app.<span class="hljs-title function_">listen</span>(port, <span class="hljs-function">() =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`å›¾ç‰‡ä¸Šä¼ æœåŠ¡å™¨å¯åŠ¨ï¼šhttp://localhost:<span class="hljs-subst">${port}</span>`</span>);
});
</code></pre>
<p>æµ‹è¯•å›¾ç‰‡ä¸Šä¼ </p>
<p>æ–¹å¼ 1ï¼šPostman æµ‹è¯•</p>
<ul>
<li>è¯·æ±‚åœ°å€ï¼š<code>http://localhost:8008/api/upload</code></li>
<li>è¯·æ±‚æ–¹æ³•ï¼šPOST</li>
<li>è¯·æ±‚ä½“ï¼šé€‰æ‹© <code>form-data</code>ï¼ŒKey ä¸º <code>file</code>ï¼ŒType é€‰ <code>File</code>ï¼Œä¸Šä¼ ä¸€å¼ å›¾ç‰‡ã€‚</li>
<li>å“åº”ï¼šè¿”å›æ–‡ä»¶è·¯å¾„ï¼Œå¦‚ <code>http://localhost:8008/uploads/1738987654321.png</code>ï¼Œè®¿é—®è¯¥ URL å¯æŸ¥çœ‹å›¾ç‰‡ã€‚</li>
</ul>
<p>æ–¹å¼ 2ï¼šcurl å‘½ä»¤æµ‹è¯•</p>
<p>ç»ˆç«¯è¾“å…¥ bash å‘½ä»¤</p>
<pre><code class="hljs language-bash" lang="bash">curl -X POST -F <span class="hljs-string">"file=@/ä½ çš„å›¾ç‰‡è·¯å¾„/xxx.png"</span> http://localhost:8008/api/upload
</code></pre>
<h2 data-id="heading-13">ç¬¬ä¹ç«  cookie</h2>
<p>Cookie æ˜¯å­˜å‚¨åœ¨å®¢æˆ·ç«¯æµè§ˆå™¨çš„å°å‹æ–‡æœ¬æ•°æ®ï¼ŒKoa å†…ç½® <code>ctx.cookies</code> API å¯ä»¥æ“ä½œ Cookieã€‚</p>
<p>Cookie æ“ä½œç¤ºä¾‹</p>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-keyword">import</span> Koa from <span class="hljs-string">'koa'</span>
<span class="hljs-keyword">import</span> Router from <span class="hljs-string">'@koa/router'</span>
 
<span class="hljs-keyword">const</span> app = <span class="hljs-keyword">new</span> Koa();
<span class="hljs-keyword">const</span> router = <span class="hljs-keyword">new</span> Router();
<span class="hljs-keyword">const</span> port = <span class="hljs-number">8008</span>;

<span class="hljs-comment">// 1. è®¾ç½® Cookie</span>
router.<span class="hljs-keyword">get</span>(<span class="hljs-string">'/cookie/set'</span>, <span class="hljs-keyword">async</span> (ctx) =&gt; {
  <span class="hljs-comment">// ctx.cookies.set(åç§°, å€¼, é…ç½®)</span>
  ctx.cookies.<span class="hljs-keyword">set</span>(
    <span class="hljs-string">'username'</span>, 
    encodeURIComponent(<span class="hljs-string">'å¼ ä¸‰'</span>), 
    {
      maxAge: <span class="hljs-number">24</span> * <span class="hljs-number">60</span> * <span class="hljs-number">60</span> * <span class="hljs-number">1000</span>, <span class="hljs-comment">// è¿‡æœŸæ—¶é—´ 1 å¤©ï¼ˆæ¯«ç§’ï¼‰</span>
      httpOnly: <span class="hljs-keyword">true</span>, <span class="hljs-comment">// ä»…å…è®¸æœåŠ¡ç«¯è®¿é—®ï¼Œé˜²æ­¢ XSS æ”»å‡»</span>
      secure: <span class="hljs-keyword">false</span>, <span class="hljs-comment">// å¼€å‘ç¯å¢ƒè®¾ä¸º falseï¼ˆHTTPS ç¯å¢ƒè®¾ä¸º trueï¼‰</span>
      path: <span class="hljs-string">'/'</span>, <span class="hljs-comment">// ç”Ÿæ•ˆè·¯å¾„ï¼ˆ/ è¡¨ç¤ºå…¨ç«™ï¼‰</span>
      sameSite: <span class="hljs-string">'lax'</span> <span class="hljs-comment">// é˜²æ­¢ CSRF æ”»å‡»</span>
    }
  );
  ctx.body = { code: <span class="hljs-number">200</span>, msg: <span class="hljs-string">"Cookie è®¾ç½®æˆåŠŸ"</span> };
});

<span class="hljs-comment">// 2. è·å– Cookie</span>
router.<span class="hljs-keyword">get</span>(<span class="hljs-string">'/cookie/get'</span>, <span class="hljs-keyword">async</span> (ctx) =&gt; {
  <span class="hljs-keyword">const</span> username = ctx.cookies.<span class="hljs-keyword">get</span>(<span class="hljs-string">'username'</span>);
  ctx.body = {
    code: <span class="hljs-number">200</span>,
    msg: <span class="hljs-string">"Cookie è·å–æˆåŠŸ"</span>,
    data: { username }
  };
});

<span class="hljs-comment">// 3. åˆ é™¤ Cookie</span>
router.<span class="hljs-keyword">get</span>(<span class="hljs-string">'/cookie/delete'</span>, <span class="hljs-keyword">async</span> (ctx) =&gt; {
  ctx.cookies.<span class="hljs-keyword">set</span>(<span class="hljs-string">'username'</span>, <span class="hljs-string">''</span>, { maxAge: <span class="hljs-number">0</span> }); <span class="hljs-comment">// è®¾ç½® maxAge ä¸º 0 å³åˆ é™¤</span>
  ctx.body = { code: <span class="hljs-number">200</span>, msg: <span class="hljs-string">"Cookie åˆ é™¤æˆåŠŸ"</span> };
});

app.use(router.routes());

app.listen(port, () =&gt; {
  console.log(`Cookie æœåŠ¡å™¨å¯åŠ¨ï¼šhttp:<span class="hljs-comment">//localhost:${port}`);</span>
});
</code></pre>
<p>æµ‹è¯• Cookie</p>
<ol>
<li>è®¿é—® <code>http://localhost:8008/cookie/set</code> â†’ è®¾ç½® Cookieï¼›</li>
<li>è®¿é—® <code>http://localhost:8008/cookie/get</code> â†’ è·å– Cookieï¼Œè¾“å‡º <code>{username: "å¼ ä¸‰"}</code>ï¼›</li>
<li>è®¿é—® <code>http://localhost:8008/cookie/delete</code> â†’ åˆ é™¤ Cookieï¼Œå†æ¬¡è·å–åˆ™ä¸º <code>undefined</code>ã€‚</li>
</ol>
<h2 data-id="heading-14">ç¬¬åç«  session</h2>
<p>å®‰è£… Session ä¸­é—´ä»¶</p>
<p>Koa åŸç”Ÿä¸æ”¯æŒ Sessionï¼Œéœ€å®‰è£… <code>koa-session</code>ï¼š</p>
<pre><code class="hljs">npm install koa-session
</code></pre>
<p>Session é…ç½®ç¤ºä¾‹</p>
<pre><code class="hljs language-php" lang="php">import Koa <span class="hljs-keyword">from</span> <span class="hljs-string">'koa'</span>
import Router <span class="hljs-keyword">from</span> <span class="hljs-string">'@koa/router'</span>
import session  <span class="hljs-keyword">from</span> <span class="hljs-string">'koa-session'</span>

<span class="hljs-keyword">const</span> <span class="hljs-variable constant_">app</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Koa</span>();
<span class="hljs-keyword">const</span> <span class="hljs-variable constant_">router</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Router</span>();
<span class="hljs-keyword">const</span> <span class="hljs-variable constant_">port</span> = <span class="hljs-number">8008</span>;

<span class="hljs-comment">// 1. é…ç½® Session å¯†é’¥ï¼ˆç”Ÿäº§ç¯å¢ƒéœ€æ”¹ä¸ºéšæœºå­—ç¬¦ä¸²ï¼‰</span>
app.keys = [<span class="hljs-string">'dengruicode_secret_key'</span>];

<span class="hljs-comment">// 2. Session é…ç½®</span>
<span class="hljs-keyword">const</span> <span class="hljs-variable constant_">CONFIG</span> = {
  key: <span class="hljs-string">'koa:sess'</span>, <span class="hljs-comment">// Session Cookie åç§°</span>
  maxAge: <span class="hljs-number">24</span> * <span class="hljs-number">60</span> * <span class="hljs-number">60</span> * <span class="hljs-number">1000</span>, <span class="hljs-comment">// è¿‡æœŸæ—¶é—´ 1 å¤©</span>
  autoCommit: <span class="hljs-literal">true</span>,
  overwrite: <span class="hljs-literal">true</span>,
  httpOnly: <span class="hljs-literal">true</span>, <span class="hljs-comment">// ä»…æœåŠ¡ç«¯è®¿é—®</span>
  signed: <span class="hljs-literal">true</span>, <span class="hljs-comment">// ç­¾å Cookieï¼Œé˜²æ­¢ç¯¡æ”¹</span>
  rolling: <span class="hljs-literal">false</span>, <span class="hljs-comment">// ä¸åˆ·æ–°è¿‡æœŸæ—¶é—´</span>
  renew: <span class="hljs-literal">false</span>, <span class="hljs-comment">// å¿«è¿‡æœŸæ—¶è‡ªåŠ¨ç»­æœŸ</span>
  secure: <span class="hljs-literal">false</span>, <span class="hljs-comment">// å¼€å‘ç¯å¢ƒ false</span>
  sameSite: <span class="hljs-string">'lax'</span>
};

<span class="hljs-comment">// 3. æ³¨å†Œ Session ä¸­é—´ä»¶</span>
app.<span class="hljs-keyword">use</span>(<span class="hljs-title function_ invoke__">session</span>(CONFIG, app));

<span class="hljs-comment">// 4. Session æ“ä½œ</span>
<span class="hljs-comment">// è®¾ç½® Session</span>
router.<span class="hljs-title function_ invoke__">get</span>(<span class="hljs-string">'/session/set'</span>, <span class="hljs-title function_ invoke__">async</span> (ctx) =&gt; {
  ctx.session.user = {
    <span class="hljs-attr">id</span>: <span class="hljs-number">1</span>,
    <span class="hljs-attr">name</span>: <span class="hljs-string">"å¼ ä¸‰"</span>,
    <span class="hljs-attr">age</span>: <span class="hljs-number">20</span>
  };
  ctx.body = { <span class="hljs-attr">code</span>: <span class="hljs-number">200</span>, <span class="hljs-attr">msg</span>: <span class="hljs-string">"Session è®¾ç½®æˆåŠŸ"</span> };
});

<span class="hljs-comment">// è·å– Session</span>
router.<span class="hljs-title function_ invoke__">get</span>(<span class="hljs-string">'/session/get'</span>, <span class="hljs-title function_ invoke__">async</span> (ctx) =&gt; {
  <span class="hljs-keyword">const</span> user = ctx.session.user;
  ctx.body = {
    <span class="hljs-attr">code</span>: <span class="hljs-number">200</span>,
    <span class="hljs-attr">msg</span>: <span class="hljs-string">"Session è·å–æˆåŠŸ"</span>,
    <span class="hljs-attr">data</span>: { user }
  };
});

<span class="hljs-comment">// åˆ é™¤ Session</span>
router.<span class="hljs-title function_ invoke__">get</span>(<span class="hljs-string">'/session/delete'</span>, <span class="hljs-title function_ invoke__">async</span> (ctx) =&gt; {
  ctx.session = <span class="hljs-literal">null</span>; // æ¸…ç©º Session
  ctx.body = { <span class="hljs-attr">code</span>: <span class="hljs-number">200</span>, <span class="hljs-attr">msg</span>: <span class="hljs-string">"Session åˆ é™¤æˆåŠŸ"</span> };
});

app.<span class="hljs-keyword">use</span>(router.<span class="hljs-title function_ invoke__">routes</span>());

app.<span class="hljs-title function_ invoke__">listen</span>(port, () =&gt; {
  console.<span class="hljs-title function_ invoke__">log</span>(`Session æœåŠ¡å™¨å¯åŠ¨ï¼š<span class="hljs-attr">http</span>://<span class="hljs-attr">localhost</span>:${port}`);
});
</code></pre>
<p>æµ‹è¯• Session</p>
<ol>
<li>è®¿é—® <code>http://localhost:8008/session/set</code> â†’ è®¾ç½® Sessionï¼›</li>
<li>è®¿é—® <code>http://localhost:8008/session/get</code> â†’ è·å– Sessionï¼Œè¾“å‡ºç”¨æˆ·ä¿¡æ¯ï¼›</li>
<li>è®¿é—® <code>http://localhost:8008/session/delete</code> â†’ æ¸…ç©º Sessionï¼Œå†æ¬¡è·å–åˆ™ä¸º <code>undefined</code>ã€‚</li>
</ol>
<blockquote>
<p>æ³¨æ„ï¼š<code>koa-session</code> æ˜¯åŸºäº Cookie çš„å†…å­˜ Sessionï¼Œç”Ÿäº§ç¯å¢ƒå»ºè®®ä½¿ç”¨ <code>koa-redis</code> å°† Session å­˜å‚¨åˆ° Redisï¼Œé¿å…æœåŠ¡é‡å¯ä¸¢å¤±æ•°æ®ã€‚</p>
</blockquote>
<h2 data-id="heading-15">ç¬¬åä¸€ç«  jwt</h2>
<p>å®‰è£… JWT ä¾èµ–</p>
<pre><code class="hljs">npm install jsonwebtoken koa-jwt
</code></pre>
<ul>
<li><code>jsonwebtoken</code>ï¼šç”Ÿæˆ / è§£æ JWT ä»¤ç‰Œï¼›</li>
<li><code>koa-jwt</code>ï¼šéªŒè¯ JWT ä»¤ç‰Œçš„ä¸­é—´ä»¶ã€‚</li>
</ul>
<p>JWT å®Œæ•´ç¤ºä¾‹</p>
<pre><code class="hljs language-ini" lang="ini">import Koa from 'koa'
import Router from '@koa/router'
import jwt  from 'jsonwebtoken'
import koaJwt  from 'koa-jwt'

const <span class="hljs-attr">app</span> = new Koa()<span class="hljs-comment">;</span>
const <span class="hljs-attr">router</span> = new Router()<span class="hljs-comment">;</span>
const <span class="hljs-attr">port</span> = <span class="hljs-number">8008</span><span class="hljs-comment">;</span>

// 1. JWT å¯†é’¥ï¼ˆç”Ÿäº§ç¯å¢ƒéœ€åŠ å¯†å­˜å‚¨ï¼‰
const <span class="hljs-attr">JWT_SECRET</span> = <span class="hljs-string">'dengruicode_jwt_secret'</span><span class="hljs-comment">;</span>
// JWT è¿‡æœŸæ—¶é—´ï¼š1 å°æ—¶ï¼ˆç§’ï¼‰
const <span class="hljs-attr">JWT_EXPIRES_IN</span> = <span class="hljs-number">3600</span><span class="hljs-comment">;</span>

// 2. ç™»å½•æ¥å£ï¼šç”Ÿæˆ JWT ä»¤ç‰Œ
router.post('/api/login', async (ctx) =&gt; {
  // æ¨¡æ‹ŸéªŒè¯ç”¨æˆ·åå¯†ç ï¼ˆç”Ÿäº§ç¯å¢ƒéœ€æŸ¥æ•°æ®åº“ï¼‰
  const { username, password } = ctx.request.body<span class="hljs-comment">;</span>
  if (<span class="hljs-attr">username</span> === <span class="hljs-string">'admin'</span> &amp;&amp; password === <span class="hljs-string">'123456'</span>) {
    // ç”Ÿæˆ JWT ä»¤ç‰Œ
    const <span class="hljs-attr">token</span> = jwt.sign(
      { id: 1, username }, // è½½è·ï¼šå­˜å‚¨ç”¨æˆ·ä¿¡æ¯ï¼ˆä¸è¦å­˜æ•æ„Ÿæ•°æ®ï¼‰
      JWT_SECRET,
      { expiresIn: JWT_EXPIRES_IN }
    )<span class="hljs-comment">;</span>
    <span class="hljs-attr">ctx.body</span> = {
      code: 200,
      msg: "ç™»å½•æˆåŠŸ",
      data: { token }
    }<span class="hljs-comment">;</span>
  } else {
    <span class="hljs-attr">ctx.status</span> = <span class="hljs-number">401</span><span class="hljs-comment">;</span>
    <span class="hljs-attr">ctx.body</span> = { code: <span class="hljs-number">401</span>, msg: <span class="hljs-string">"ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯"</span> }<span class="hljs-comment">;</span>
  }
})<span class="hljs-comment">;</span>

// 3. å—ä¿æŠ¤çš„æ¥å£ï¼šéœ€è¦ JWT éªŒè¯
// koa-jwt ä¸­é—´ä»¶ä¼šè‡ªåŠ¨è§£æ Authorization å¤´ä¸­çš„ token
app.use(koaJwt({ secret: JWT_SECRET }).unless({
  path: <span class="hljs-section">[/^/api/login/]</span> // æ’é™¤ç™»å½•æ¥å£ï¼Œæ— éœ€éªŒè¯
}))<span class="hljs-comment">;</span>

// 4. è·å–ç”¨æˆ·ä¿¡æ¯æ¥å£ï¼ˆéœ€éªŒè¯ JWTï¼‰
router.get('/api/user/info', async (ctx) =&gt; {
  // ctx.state.user æ˜¯ koa-jwt è§£æåçš„ JWT è½½è·
  const { id, username } = ctx.state.user<span class="hljs-comment">;</span>
  <span class="hljs-attr">ctx.body</span> = {
    code: 200,
    msg: "è·å–ç”¨æˆ·ä¿¡æ¯æˆåŠŸ",
    data: { id, username }
  }<span class="hljs-comment">;</span>
})<span class="hljs-comment">;</span>

app.use(router.routes())<span class="hljs-comment">;</span>

// 5. JWT é”™è¯¯å¤„ç†
app.use(async (ctx, next) =&gt; {
  try {
    await next()<span class="hljs-comment">;</span>
  } catch (err) {
    if (<span class="hljs-attr">err.status</span> === <span class="hljs-number">401</span>) {
      <span class="hljs-attr">ctx.status</span> = <span class="hljs-number">401</span><span class="hljs-comment">;</span>
      <span class="hljs-attr">ctx.body</span> = { code: <span class="hljs-number">401</span>, msg: <span class="hljs-string">"token æ— æ•ˆæˆ–è¿‡æœŸ"</span> }<span class="hljs-comment">;</span>
    } else {
      throw err<span class="hljs-comment">;</span>
    }
  }
})<span class="hljs-comment">;</span>

app.listen(port, () =&gt; {
  console.log(`JWT æœåŠ¡å™¨å¯åŠ¨ï¼šhttp://localhost:${port}`)<span class="hljs-comment">;</span>
})<span class="hljs-comment">;</span>
</code></pre>
<p>æµ‹è¯• JWT</p>
<p>æ­¥éª¤ 1ï¼šç™»å½•è·å– token</p>
<pre><code class="hljs language-json" lang="json">curl -X POST -d <span class="hljs-string">"username=admin&amp;password=123456"</span> http<span class="hljs-punctuation">:</span><span class="hljs-comment">//localhost:8008/api/login</span>
# å“åº”ï¼š<span class="hljs-punctuation">{</span><span class="hljs-attr">"code"</span><span class="hljs-punctuation">:</span><span class="hljs-number">200</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"msg"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"ç™»å½•æˆåŠŸ"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"data"</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">{</span><span class="hljs-attr">"token"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"xxx.xxx.xxx"</span><span class="hljs-punctuation">}</span><span class="hljs-punctuation">}</span>
</code></pre>
<p>æ­¥éª¤ 2ï¼šæºå¸¦ token è®¿é—®å—ä¿æŠ¤æ¥å£</p>
<pre><code class="hljs language-json" lang="json">curl -H <span class="hljs-string">"Authorization: Bearer ä½ çš„token"</span> http<span class="hljs-punctuation">:</span><span class="hljs-comment">//localhost:8008/api/user/info</span>
# å“åº”ï¼š<span class="hljs-punctuation">{</span><span class="hljs-attr">"code"</span><span class="hljs-punctuation">:</span><span class="hljs-number">200</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"msg"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"è·å–ç”¨æˆ·ä¿¡æ¯æˆåŠŸ"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"data"</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">{</span><span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span><span class="hljs-number">1</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"username"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"admin"</span><span class="hljs-punctuation">}</span><span class="hljs-punctuation">}</span>
</code></pre>
<p>æ­¥éª¤ 3ï¼štoken æ— æ•ˆ / è¿‡æœŸæµ‹è¯•</p>
<p>æºå¸¦é”™è¯¯ token æˆ–è¿‡æœŸ token è®¿é—®ï¼Œä¼šè¿”å› <code>{"code":401,"msg":"token æ— æ•ˆæˆ–è¿‡æœŸ"}</code>ã€‚</p>
<p>æ€»ç»“</p>
<ol>
<li>
<p><strong>æ ¸å¿ƒæµç¨‹</strong>ï¼šKoa å¼€å‘çš„æ ¸å¿ƒæ˜¯ã€Œä¸­é—´ä»¶ + è·¯ç”±ã€ï¼Œæ‰€æœ‰åŠŸèƒ½ï¼ˆè·¨åŸŸã€ä¸Šä¼ ã€JWTï¼‰éƒ½é€šè¿‡ä¸­é—´ä»¶æ‰©å±•ï¼›</p>
</li>
<li>
<p><strong>å…³é”®ä¾èµ–</strong>ï¼š<code>@koa/router</code>ï¼ˆè·¯ç”±ï¼‰ã€<code>koa-body</code>ï¼ˆPOST / ä¸Šä¼ ï¼‰ã€<code>@koa/cors</code>ï¼ˆè·¨åŸŸï¼‰ã€<code>koa-session</code>ï¼ˆSessionï¼‰ã€<code>jsonwebtoken/koa-jwt</code>ï¼ˆJWTï¼‰ï¼›</p>
</li>
<li>
<p><strong>ç”Ÿäº§å»ºè®®</strong>ï¼š</p>
<ul>
<li>
<p>Session/JWT å¯†é’¥éœ€éšæœºç”Ÿæˆå¹¶åŠ å¯†å­˜å‚¨ï¼›</p>
</li>
<li>
<p>æ–‡ä»¶ä¸Šä¼ éœ€é™åˆ¶å¤§å°å’Œç±»å‹ï¼Œé˜²æ­¢æ¶æ„ä¸Šä¼ ï¼›</p>
</li>
<li>
<p>è·¨åŸŸéœ€æŒ‡å®šå…·ä½“åŸŸåï¼Œè€Œé <code>*</code>ï¼›</p>
</li>
<li>
<p>JWT è½½è·ä¸è¦å­˜æ•æ„Ÿæ•°æ®ï¼Œè¿‡æœŸæ—¶é—´ä¸å®œè¿‡é•¿ã€‚</p>
</li>
</ul>
</li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[â€œç ´æ¡ˆâ€ç¬”è®°ï¼šiframeåŠ¨æ€åŠ è½½å†…å®¹åï¼Œæ‰“å°åŠŸèƒ½ä¸ºä½•å¤±çµï¼Ÿ]]></title>    <link>https://juejin.cn/post/7603699739223621647</link>    <guid>https://juejin.cn/post/7603699739223621647</guid>    <pubDate>2026-02-08T09:14:39.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7603699739223621647" data-draft-id="7603671627003904040" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="â€œç ´æ¡ˆâ€ç¬”è®°ï¼šiframeåŠ¨æ€åŠ è½½å†…å®¹åï¼Œæ‰“å°åŠŸèƒ½ä¸ºä½•å¤±çµï¼Ÿ"/> <meta itemprop="keywords" content="å‰ç«¯"/> <meta itemprop="datePublished" content="2026-02-08T09:14:39.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å¤©æ‰ç†ŠçŒ«å›"/> <meta itemprop="url" content="https://juejin.cn/user/3789388889725732"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            â€œç ´æ¡ˆâ€ç¬”è®°ï¼šiframeåŠ¨æ€åŠ è½½å†…å®¹åï¼Œæ‰“å°åŠŸèƒ½ä¸ºä½•å¤±çµï¼Ÿ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3789388889725732/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å¤©æ‰ç†ŠçŒ«å›
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-08T09:14:39.000Z" title="Sun Feb 08 2026 09:14:39 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»3åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h3 data-id="heading-0"><strong>â€œç ´æ¡ˆâ€ç¬”è®°ï¼šiframeåŠ¨æ€åŠ è½½å†…å®¹åï¼Œæ‰“å°åŠŸèƒ½ä¸ºä½•å¤±çµï¼Ÿ</strong></h3>
<h4 data-id="heading-1"><strong>æ¡ˆä»¶æ¦‚è¿°</strong></h4>
<p><strong>å¼‚å¸¸ç°è±¡</strong>ï¼šå½“æˆ‘ç”¨ <code>iframe.srcdoc</code>åŠ¨æ€ç”Ÿæˆä¸€ä¸ªæŠ¥å‘Šé¡µé¢ï¼Œå¹¶æƒ³è‡ªåŠ¨è°ƒèµ·æ‰“å°æ—¶ï¼Œæ‰“å°çª—å£æ­»æ´»ä¸å¼¹å‡ºæ¥ï¼Œæ‰“å°å®Œæˆçš„å›è°ƒå‡½æ•°ä¹Ÿæ°¸è¿œä¸ä¼šæ‰§è¡Œã€‚ä»£ç çœ‹èµ·æ¥æ²¡é—®é¢˜ï¼Œä½†å°±æ˜¯æ— æ•ˆã€‚</p>
<p><strong>åˆæ­¥æ€€ç–‘</strong>ï¼šæ˜¯ä¸æ˜¯ <code>srcdoc</code>æŠŠæˆ‘åˆšç»‘å®šçš„äº‹ä»¶ç›‘å¬å™¨ç»™â€œå†²èµ°äº†â€ï¼Ÿ</p>
<hr/>
<h4 data-id="heading-2"><strong>ç¬¬ä¸€ç°åœºï¼šé‡ç°â€œæ¡ˆå‘â€è¿‡ç¨‹</strong></h4>
<p>è¿™æ˜¯å½“æ—¶â€œæ¡ˆå‘â€çš„ä»£ç ç‰‡æ®µï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 1. ç»™ iframe çŒå…¥æ–°å†…å®¹</span>
<span class="hljs-keyword">let</span> frame = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'myFrame'</span>);
frame.<span class="hljs-property">srcdoc</span> = <span class="hljs-string">`&lt;h1&gt;æˆ‘çš„æŠ¥å‘Š&lt;/h1&gt;&lt;p&gt;è¯·æ‰“å°æˆ‘&lt;/p&gt;`</span>;
â€‹
<span class="hljs-comment">// 2. ç«‹åˆ»ç»‘å®šæ‰“å°å®Œæˆåçš„å›è°ƒ</span>
frame.<span class="hljs-property">contentWindow</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'afterprint'</span>, <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
 Â <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'æ‰“å°å®Œæˆï¼'</span>); <span class="hljs-comment">// ğŸš¨ è¿™æ¡æ—¥å¿—ä»æœªå‡ºç°ï¼</span>
});
â€‹
<span class="hljs-comment">// 3. ç«‹åˆ»ä¸‹ä»¤æ‰“å°</span>
frame.<span class="hljs-property">contentWindow</span>.<span class="hljs-title function_">print</span>(); <span class="hljs-comment">// ğŸš¨ æ‰“å°çª—å£æ¯«æ— ååº”ï¼</span>
</code></pre>
<p><strong>ç›´è§‚æ„Ÿå—</strong>ï¼šä»£ç æ‰§è¡Œäº†ï¼Œä½†åƒçŸ³æ²‰å¤§æµ·ï¼Œæ²¡æœ‰ä»»ä½•æ•ˆæœå’ŒæŠ¥é”™ã€‚</p>
<hr/>
<h4 data-id="heading-3"><strong>ä¾¦æŸ¥å®éªŒï¼šé€ä¸€æ’é™¤å«Œç–‘</strong></h4>
<p>æˆ‘ä»¬åšäº†å‡ ä¸ªå…³é”®å®éªŒæ¥æ’æŸ¥ã€‚</p>
<p><strong>å®éªŒä¸€ï¼šäº‹ä»¶ç›‘å¬å™¨çœŸçš„è¢«â€œå†²èµ°äº†â€å—ï¼Ÿ</strong></p>
<p>æˆ‘ä»¬åœ¨è®¾ç½®æ–°å†…å®¹å‰åï¼Œç»‘å®šä¸€ä¸ªè‡ªå·±èƒ½æ§åˆ¶çš„â€œä¿¡å·å¼¹â€ï¼ˆè‡ªå®šä¹‰äº‹ä»¶ï¼‰ã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript">frame.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'ä¿¡å·å¼¹'</span>, <span class="hljs-function">() =&gt;</span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'ç›‘å¬å™¨Aåœ¨'</span>));
frame.<span class="hljs-property">srcdoc</span> = <span class="hljs-string">`&lt;h1&gt;æ–°å†…å®¹&lt;/h1&gt;`</span>;
frame.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'ä¿¡å·å¼¹'</span>, <span class="hljs-function">() =&gt;</span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'ç›‘å¬å™¨Bä¹Ÿåœ¨'</span>));
â€‹
<span class="hljs-comment">// å‘å°„ä¿¡å·å¼¹</span>
frame.<span class="hljs-title function_">dispatchEvent</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Event</span>(<span class="hljs-string">'ä¿¡å·å¼¹'</span>));
<span class="hljs-comment">// æ§åˆ¶å°è¾“å‡ºï¼šç›‘å¬å™¨Aåœ¨ | ç›‘å¬å™¨Bä¹Ÿåœ¨</span>
</code></pre>
<p><strong>âœ… ç»“è®º</strong>ï¼šç›‘å¬å™¨<strong>æ²¡æœ‰æ¶ˆå¤±</strong>ã€‚ä¸¤ä¸ªéƒ½è¿˜åœ¨æ­£å¸¸å·¥ä½œã€‚æ‰€ä»¥â€œå†²èµ°ç›‘å¬å™¨â€çš„å«Œç–‘è¢«æ’é™¤äº†ã€‚</p>
<p><strong>å®éªŒäºŒï¼šå¦‚æœç­‰ä¸€ä¼šå„¿å†æ‰“å°å‘¢ï¼Ÿ</strong></p>
<p>æˆ‘ä»¬æ€€ç–‘æ˜¯ä¸æ˜¯å‘½ä»¤ä¸‹å¾—å¤ªæ€¥äº†ã€‚</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">frame.srcdoc</span> = `&lt;h1&gt;æ–°å†…å®¹&lt;/h1&gt;`<span class="hljs-comment">;</span>
setTimeout(() =&gt; {
 Â frame.contentWindow.print()<span class="hljs-comment">; // ğŸ• å»¶è¿Ÿ1ç§’åï¼šæ‰“å°çª—å£å¼¹å‡ºäº†ï¼</span>
 Â console.log('æ‰“å°è°ƒç”¨æˆåŠŸï¼Œä½† afterprint ä»ä¸è§¦å‘')<span class="hljs-comment">;</span>
}, 1000)<span class="hljs-comment">;</span>
</code></pre>
<p><strong>âš ï¸ æ–°å‘ç°</strong>ï¼š<strong>ç­‰å¾…è¶³å¤Ÿæ—¶é—´åï¼Œæ‰“å°å‘½ä»¤èƒ½æ‰§è¡Œäº†ï¼Œä½† <code>afterprint</code>äº‹ä»¶ä¾ç„¶ä¸è§¦å‘ã€‚</strong> è¿™è¯´æ˜äº‹ä»¶ç»‘å®šçš„æ—¶æœºå¯èƒ½ä¹Ÿæœ‰é—®é¢˜ã€‚</p>
<p><strong>å®éªŒä¸‰ï¼šæ‰¾åˆ°é‚£ä¸ªâ€œæ­£ç¡®æ—¶æœºâ€</strong></p>
<p>æˆ‘ä»¬å°è¯•åœ¨ iframe è‡ªå·±å®£å¸ƒâ€œæˆ‘å‡†å¤‡å¥½äº†â€çš„æ—¶å€™å†è¡ŒåŠ¨ã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript">frame.<span class="hljs-property">srcdoc</span> = <span class="hljs-string">`&lt;h1&gt;æ–°å†…å®¹&lt;/h1&gt;`</span>;
â€‹
<span class="hljs-comment">// ç›‘å¬ iframe çš„â€œå‡†å¤‡å¥½â€ä¿¡å·</span>
frame.<span class="hljs-property">onload</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
 Â <span class="hljs-comment">// ç­‰å®ƒå–Šâ€œå‡†å¤‡å¥½â€äº†ï¼Œæˆ‘ä»¬å†ç»‘å®šå’Œæ‰“å°</span>
 Â frame.<span class="hljs-property">contentWindow</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'afterprint'</span>, <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
 Â  Â <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'âœ…âœ…âœ… æ‰“å°å®Œæˆï¼'</span>); <span class="hljs-comment">// è¿™æ¬¡æˆåŠŸäº†ï¼</span>
  });
 Â frame.<span class="hljs-property">contentWindow</span>.<span class="hljs-title function_">print</span>(); <span class="hljs-comment">// æ‰“å°çª—å£æ­£å¸¸å¼¹å‡º</span>
};
</code></pre>
<p><strong>âœ… å†³å®šæ€§è¯æ®</strong>ï¼šåœ¨ <code>onload</code>äº‹ä»¶é‡Œæ“ä½œï¼Œ<strong>ä¸€åˆ‡å®Œå…¨æ­£å¸¸</strong>ã€‚</p>
<hr/>
<h4 data-id="heading-4"><strong>æ¡ˆæƒ…å¤ç›˜ï¼šåˆ°åº•å‘ç”Ÿäº†ä»€ä¹ˆï¼Ÿ</strong></h4>
<p>æˆ‘ä»¬å¯ä»¥æŠŠ <code>iframe.srcdoc = â€˜...â€™</code>è¿™ä¸ªè¿‡ç¨‹ï¼Œæƒ³è±¡æˆ<strong>ç»™ä¸€ä¸ªæˆ¿é—´ï¼ˆiframeï¼‰è¿›è¡Œå½»åº•çš„é‡è£…ä¿®</strong>ã€‚</p>
<ol>
<li>
<p><strong>æ‹†æ—§</strong>ï¼šæµè§ˆå™¨å…ˆæŠŠæˆ¿é—´é‡Œï¼ˆiframe å†…ï¼‰æ‰€æœ‰æ—§çš„å®¶å…·ã€ç®¡é“ï¼ˆæ—§çš„æ–‡æ¡£ã€çª—å£ï¼‰å…¨æ¸…ç©ºã€‚</p>
</li>
<li>
<p><strong>å¼‚æ­¥è£…ä¿®</strong>ï¼šç„¶å<strong>å¼€å§‹æ ¹æ®ä½ ç»™çš„æ–°å›¾çº¸ï¼ˆHTMLå­—ç¬¦ä¸²ï¼‰å¼‚æ­¥æ–½å·¥</strong>ã€‚è¿™éœ€è¦æ—¶é—´ï¼Œæ°´ç”µã€å¢™é¢ã€å®¶å…·éƒ½åœ¨åŒæ­¥å®‰æ’ã€‚</p>
</li>
<li>
<p><strong>æ–½å·¥ä¸­</strong>ï¼šåœ¨è£…ä¿®é˜Ÿå–Šâ€œå®Œå·¥å•¦ï¼â€ï¼ˆè§¦å‘ <code>load</code>äº‹ä»¶ï¼‰<strong>ä¹‹å‰</strong>ï¼Œè¿™ä¸ªæˆ¿é—´å¤„äº<strong>æ–½å·¥çŠ¶æ€</strong>ã€‚</p>
<ul>
<li>ä½ å¯¹ç€ä¸€ä¸ªè¿˜åœ¨é“ºæ°´æ³¥çš„å¢™é¢ï¼ˆä¸ç¨³å®šçš„å†…éƒ¨çª—å£ï¼‰å–Šâ€œæ‰“å°ï¼â€ï¼ˆ<code>print()</code>ï¼‰ï¼Œå·¥äººä¼šæ— è§†ä½ ã€‚</li>
<li>ä½ å‘Šè¯‰ä¸€é¢è¿˜æ²¡ç Œå¥½çš„å¢™â€œæ‰“å°å®Œå–Šæˆ‘ä¸€å£°â€ï¼ˆç»‘ <code>afterprint</code>ï¼‰ï¼Œè¿™ä¸ªè¯·æ±‚å¯èƒ½ä¼šä¸¢å¤±ã€‚</li>
</ul>
</li>
<li>
<p><strong>ç«£å·¥</strong>ï¼šåªæœ‰ç­‰ <code>onload</code>äº‹ä»¶è§¦å‘ï¼Œæ‰ä»£è¡¨<strong>æˆ¿é—´å®Œå…¨è£…ä¿®å¥½ï¼Œæ°´ç”µå…¨é€šï¼Œå¯ä»¥æ­£å¼æŠ•å…¥ä½¿ç”¨</strong>ã€‚è¿™æ—¶ä½ çš„æ‰€æœ‰æŒ‡ä»¤éƒ½èƒ½è¢«æ­£ç¡®æ¥æ”¶å’Œæ‰§è¡Œã€‚</p>
</li>
</ol>
<p><strong>æ‰€ä»¥ï¼Œæ ¸å¿ƒä¸æ˜¯ç›‘å¬å™¨è¢«â€œåˆ é™¤â€ï¼Œè€Œæ˜¯ä½ å¯¹ç€ä¸€ä¸ªâ€œåŠæˆå“â€å‘å‡ºäº†æŒ‡ä»¤ã€‚</strong></p>
<hr/>
<h4 data-id="heading-5"><strong>è§£å†³æ–¹æ¡ˆï¼šä¸¤ä¸ªå¯é çš„è¡ŒåŠ¨æŒ‡å—</strong></h4>
<p><strong>æ–¹æ¡ˆä¸€ï¼šç­‰å¾…â€œç«£å·¥å…¸ç¤¼â€ï¼ˆæœ€æ¨èï¼‰</strong></p>
<p><strong>åšæ³•</strong>ï¼šç”¨ <code>srcdoc</code>è®¾ç½®å†…å®¹ï¼Œä½†æ‰€æœ‰æ“ä½œéƒ½æ”¾åˆ° <code>iframe.onload</code>å›è°ƒå‡½æ•°é‡Œã€‚</p>
<p><strong>ä¼˜ç‚¹</strong>ï¼šé€»è¾‘æ¸…æ™°ï¼Œæ˜¯ç°ä»£ API çš„æ ‡å‡†ç”¨æ³•ã€‚</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">iframe.srcdoc</span> = â€˜ä½ çš„HTMLå†…å®¹â€™<span class="hljs-comment">;</span>
<span class="hljs-attr">iframe.onload</span> = function() {
 Â // åœ¨è¿™é‡Œè¿›è¡Œæ‰€æœ‰â€œå®¤å†…æ“ä½œâ€
 Â iframe.contentWindow.addEventListener(â€˜afterprintâ€™, ä½ çš„å›è°ƒ)<span class="hljs-comment">;</span>
 Â iframe.contentWindow.print()<span class="hljs-comment">;</span>
}<span class="hljs-comment">;</span>
</code></pre>
<p><strong>æ–¹æ¡ˆäºŒï¼šä½¿ç”¨â€œé­”æ³•ç¬é—´é‡å»ºâ€</strong></p>
<p><strong>åšæ³•</strong>ï¼šä¸ç”¨ <code>srcdoc</code>ï¼Œæ”¹ç”¨ä¼ ç»Ÿçš„ <code>document.write()</code>æ¥åŒæ­¥å†™å…¥å†…å®¹ã€‚</p>
<p><strong>åŸç†</strong>ï¼š<code>document.write()</code>ä¼šåœ¨ä½ å†™ä¸‹å†…å®¹çš„åŒä¸€æ—¶åˆ»ï¼Œ<strong>åŒæ­¥ã€ç«‹å³</strong>åœ°é‡å»ºæ•´ä¸ªæ–‡æ¡£ï¼Œæ²¡æœ‰â€œæ–½å·¥ä¸­â€çš„ç­‰å¾…æœŸã€‚å†™å®Œåç«‹å³å¯ç”¨ã€‚</p>
<p><strong>ä¼˜ç‚¹</strong>ï¼šæ— éœ€ç­‰å¾… <code>onload</code>ï¼Œç«‹å³ç”Ÿæ•ˆã€‚</p>
<pre><code class="hljs language-ini" lang="ini">let <span class="hljs-attr">doc</span> = iframe.contentWindow.document<span class="hljs-comment">;</span>
doc.open()<span class="hljs-comment">;</span>
doc.write(â€˜ä½ çš„å®Œæ•´HTMLå†…å®¹â€™)<span class="hljs-comment">; // é­”æ³•å‘ç”Ÿï¼Œå†…å®¹ç¬é—´è¢«æ›¿æ¢</span>
doc.close()<span class="hljs-comment">;</span>
// ç´§æ¥ç€å°±å¯ä»¥æ“ä½œï¼Œå› ä¸ºæ–‡æ¡£å·²ç»å°±ç»ª
iframe.contentWindow.print()<span class="hljs-comment">;</span>
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[è¯­éŸ³ AI Agent å»¶è¿Ÿä¼˜åŒ–å®æˆ˜ï¼šæˆ‘æ˜¯æ€ä¹ˆæŠŠå“åº”æ—¶é—´ä» 2 ç§’å¹²åˆ° 500ms ä»¥å†…çš„]]></title>    <link>https://juejin.cn/post/7603644943351889926</link>    <guid>https://juejin.cn/post/7603644943351889926</guid>    <pubDate>2026-02-08T07:06:46.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7603644943351889926" data-draft-id="7603644943351873542" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="è¯­éŸ³ AI Agent å»¶è¿Ÿä¼˜åŒ–å®æˆ˜ï¼šæˆ‘æ˜¯æ€ä¹ˆæŠŠå“åº”æ—¶é—´ä» 2 ç§’å¹²åˆ° 500ms ä»¥å†…çš„"/> <meta itemprop="keywords" content="AIç¼–ç¨‹"/> <meta itemprop="datePublished" content="2026-02-08T07:06:46.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ç è·¯é£"/> <meta itemprop="url" content="https://juejin.cn/user/186265609189227"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            è¯­éŸ³ AI Agent å»¶è¿Ÿä¼˜åŒ–å®æˆ˜ï¼šæˆ‘æ˜¯æ€ä¹ˆæŠŠå“åº”æ—¶é—´ä» 2 ç§’å¹²åˆ° 500ms ä»¥å†…çš„
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/186265609189227/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ç è·¯é£
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-08T07:06:46.000Z" title="Sun Feb 08 2026 07:06:46 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»8åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>åšè¯­éŸ³ Agent çš„äººéƒ½çŸ¥é“ï¼Œç”¨æˆ·èƒ½å¿å—çš„ç­‰å¾…æé™å¤§æ¦‚æ˜¯ 1.5 ç§’ã€‚è¶…è¿‡è¿™ä¸ªé˜ˆå€¼ï¼Œå¯¹è¯æ„Ÿå°±æ²¡äº†ï¼Œç”¨æˆ·ä¼šè§‰å¾—æ˜¯åœ¨"è·Ÿæœºå™¨å¯¹è¯"è€Œä¸æ˜¯"åœ¨èŠå¤©"ã€‚è¿™ç¯‡æ–‡ç« åˆ†äº«æˆ‘åœ¨å®é™…é¡¹ç›®ä¸­ï¼ŒæŠŠç«¯åˆ°ç«¯å»¶è¿Ÿä» 2 ç§’å‡ºå¤´å‹åˆ° 500ms ä»¥å†…çš„å®Œæ•´è¿‡ç¨‹ã€‚</p>
</blockquote>
<h2 data-id="heading-0">å…ˆææ¸…æ¥šå»¶è¿ŸèŠ±åœ¨å“ª</h2>
<p>åœ¨åŠ¨æ‰‹ä¼˜åŒ–ä¹‹å‰ï¼Œç¬¬ä¸€æ­¥æ˜¯ææ¸…æ¥šæ—¶é—´éƒ½èŠ±åœ¨äº†å“ªé‡Œã€‚ä¸€ä¸ªå…¸å‹çš„è¯­éŸ³ Agent è°ƒç”¨é“¾æ˜¯è¿™æ ·çš„ï¼š</p>
<pre><code class="hljs">ç”¨æˆ·è¯´è¯ â†’ VADæ£€æµ‹ â†’ ASRè½¬å†™ â†’ LLMæ¨ç† â†’ TTSåˆæˆ â†’ æ’­æ”¾å›å¤
</code></pre>
<p>æˆ‘åœ¨ç”Ÿäº§ç¯å¢ƒé‡ŒåŸ‹äº†å…¨é“¾è·¯ tracingï¼ŒæŠŠæ¯ä¸ªç¯èŠ‚çš„è€—æ—¶æ‹‰å‡ºæ¥ä¸€çœ‹ï¼š</p>








































<table><thead><tr><th>ç¯èŠ‚</th><th>ä¼˜åŒ–å‰è€—æ—¶</th><th>å æ¯”</th></tr></thead><tbody><tr><td>VAD ç«¯ç‚¹æ£€æµ‹</td><td>~300ms</td><td>15%</td></tr><tr><td>ASR è¯­éŸ³è½¬æ–‡å­—</td><td>~400ms</td><td>20%</td></tr><tr><td>LLM æ„å›¾ç†è§£+ç”Ÿæˆ</td><td>~800ms</td><td>40%</td></tr><tr><td>TTS æ–‡å­—è½¬è¯­éŸ³</td><td>~350ms</td><td>17%</td></tr><tr><td>ç½‘ç»œä¼ è¾“+å…¶ä»–</td><td>~150ms</td><td>8%</td></tr><tr><td><strong>æ€»è®¡</strong></td><td><strong>~2000ms</strong></td><td><strong>100%</strong></td></tr></tbody></table>
<p>æœ€å¤§çš„ç“¶é¢ˆå¾ˆæ˜æ˜¾â€”â€”<strong>LLM æ¨ç†å äº† 40%</strong>ã€‚ä½†åˆ«æ€¥ç€åªä¼˜åŒ–è¿™ä¸€ä¸ªï¼Œå®é™…ä¸Šæ¯ä¸ªç¯èŠ‚éƒ½æœ‰å‹ç¼©ç©ºé—´ï¼Œè€Œä¸”çœŸæ­£çš„å¤§æ‹›æ˜¯<strong>è®©è¿™äº›ç¯èŠ‚ä¸å†ä¸²è¡Œç­‰å¾…</strong>ã€‚</p>
<h2 data-id="heading-1">ç¬¬ä¸€åˆ€ï¼šæµå¼æ¶æ„æ”¹é€ ï¼ˆ-600msï¼‰</h2>
<p>æœ€ç›´è§‰çš„ä¼˜åŒ–ï¼šä¸è¦ç­‰ä¸€ä¸ªç¯èŠ‚å®Œå…¨ç»“æŸæ‰å¯åŠ¨ä¸‹ä¸€ä¸ªã€‚</p>
<h3 data-id="heading-2">ä¼ ç»Ÿä¸²è¡Œæ¶æ„</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># âŒ ä¸²è¡Œæ¨¡å¼ï¼šæ¯æ­¥éƒ½è¦ç­‰ä¸Šä¸€æ­¥å®Œå…¨ç»“æŸ</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">handle_utterance</span>(<span class="hljs-params">audio_stream</span>):
    <span class="hljs-comment"># ç­‰ç”¨æˆ·è¯´å®Œ</span>
    complete_audio = <span class="hljs-keyword">await</span> vad.wait_for_endpoint(audio_stream)
    <span class="hljs-comment"># ç­‰è½¬å†™å®Œæˆ</span>
    transcript = <span class="hljs-keyword">await</span> asr.transcribe(complete_audio)
    <span class="hljs-comment"># ç­‰ LLM ç”Ÿæˆå®Œæ•´å›å¤</span>
    response = <span class="hljs-keyword">await</span> llm.generate(transcript)
    <span class="hljs-comment"># ç­‰ TTS åˆæˆå®Œæ•´éŸ³é¢‘</span>
    audio = <span class="hljs-keyword">await</span> tts.synthesize(response)
    <span class="hljs-comment"># æ’­æ”¾</span>
    <span class="hljs-keyword">await</span> play(audio)
</code></pre>
<h3 data-id="heading-3">æµå¼ç®¡é“æ¶æ„</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># âœ… æµå¼æ¨¡å¼ï¼šå„ç¯èŠ‚å¹¶è¡Œå¤„ç†</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">handle_utterance_streaming</span>(<span class="hljs-params">audio_stream</span>):
    transcript_stream = asr.stream_transcribe(audio_stream)

    <span class="hljs-keyword">async</span> <span class="hljs-keyword">for</span> partial_transcript <span class="hljs-keyword">in</span> transcript_stream:
        <span class="hljs-keyword">if</span> vad.is_endpoint(partial_transcript):
            <span class="hljs-comment"># ASR çš„ partial result ç›´æ¥å–‚ç»™ LLM</span>
            llm_stream = llm.stream_generate(partial_transcript.final_text)

            <span class="hljs-comment"># LLM æ¯ç”Ÿæˆä¸€ä¸ªå¥å­ç‰‡æ®µï¼Œç«‹åˆ»é€ç»™ TTS</span>
            tts_task = asyncio.create_task(
                stream_tts_and_play(llm_stream)
            )
            <span class="hljs-keyword">break</span>

<span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">stream_tts_and_play</span>(<span class="hljs-params">llm_stream</span>):
    <span class="hljs-string">"""LLM è¾“å‡ºçš„æ¯ä¸ªæ–‡æœ¬å— â†’ ç«‹åˆ»åˆæˆ â†’ ç«‹åˆ»æ’­æ”¾"""</span>
    <span class="hljs-keyword">async</span> <span class="hljs-keyword">for</span> text_chunk <span class="hljs-keyword">in</span> llm_stream:
        <span class="hljs-comment"># æŒ‰å¥å­è¾¹ç•Œåˆ‡åˆ†ï¼Œä¸ç”¨ç­‰å®Œæ•´å›å¤</span>
        <span class="hljs-keyword">if</span> is_sentence_boundary(text_chunk):
            audio_chunk = <span class="hljs-keyword">await</span> tts.synthesize_chunk(text_chunk)
            <span class="hljs-keyword">await</span> player.enqueue(audio_chunk)
</code></pre>
<p>æ ¸å¿ƒæ€æƒ³ï¼š<strong>ASR çš„æµå¼ç»“æœç›´æ¥å–‚ LLMï¼ŒLLM çš„æµå¼è¾“å‡ºç›´æ¥å–‚ TTS</strong>ã€‚ä¸å†æœ‰ä»»ä½•ç¯èŠ‚éœ€è¦ç­‰"å®Œæ•´ç»“æœ"ã€‚</p>
<p>è¿™ä¸€åˆ€ä¸‹å»ï¼Œç«¯åˆ°ç«¯å»¶è¿Ÿä» ~2000ms ç›´æ¥é™åˆ° ~1400msã€‚</p>
<h2 data-id="heading-4">ç¬¬äºŒåˆ€ï¼šVAD ä¼˜åŒ–ï¼ˆ-200msï¼‰</h2>
<p>VADï¼ˆVoice Activity Detectionï¼‰è´Ÿè´£åˆ¤æ–­"ç”¨æˆ·è¯´å®Œäº†"ã€‚é»˜è®¤çš„ VAD é€šå¸¸éœ€è¦ 300-500ms çš„é™éŸ³æ‰ä¼šè§¦å‘ endpointï¼Œè¿™æ®µæ—¶é—´å®Œå…¨æ˜¯ç™½ç­‰ã€‚</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">SmartVAD</span>:
    <span class="hljs-string">"""åŸºäºä¸Šä¸‹æ–‡çš„æ™ºèƒ½ VAD"""</span>

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self</span>):
        self.silence_threshold = <span class="hljs-number">300</span>  <span class="hljs-comment"># é»˜è®¤ 300ms</span>
        self.context_aware = <span class="hljs-literal">True</span>

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">get_dynamic_threshold</span>(<span class="hljs-params">self, context: ConversationContext</span>) -&gt; <span class="hljs-built_in">int</span>:
        <span class="hljs-string">"""æ ¹æ®å¯¹è¯ä¸Šä¸‹æ–‡åŠ¨æ€è°ƒæ•´é™éŸ³é˜ˆå€¼"""</span>

        <span class="hljs-comment"># å¦‚æœæ˜¯ç®€çŸ­ç¡®è®¤ç±»å¯¹è¯ï¼ˆ"å¥½çš„"ã€"æ”¶åˆ°"ï¼‰ï¼Œç¼©çŸ­ç­‰å¾…</span>
        <span class="hljs-keyword">if</span> context.expected_response_type == <span class="hljs-string">"confirmation"</span>:
            <span class="hljs-keyword">return</span> <span class="hljs-number">150</span>

        <span class="hljs-comment"># å¦‚æœæ˜¯å¤æ‚é—®é¢˜ï¼Œç”¨æˆ·å¯èƒ½åœ¨æ€è€ƒï¼Œé€‚å½“å»¶é•¿</span>
        <span class="hljs-keyword">if</span> context.turn_count &gt; <span class="hljs-number">5</span> <span class="hljs-keyword">and</span> context.avg_utterance_length &gt; <span class="hljs-number">20</span>:
            <span class="hljs-keyword">return</span> <span class="hljs-number">400</span>

        <span class="hljs-comment"># åˆ©ç”¨ ASR çš„è¯­ä¹‰ä¿¡æ¯è¾…åŠ©åˆ¤æ–­</span>
        partial = context.current_partial_transcript
        <span class="hljs-keyword">if</span> partial <span class="hljs-keyword">and</span> self._is_complete_sentence(partial):
            <span class="hljs-keyword">return</span> <span class="hljs-number">100</span>  <span class="hljs-comment"># è¯­ä¹‰å®Œæ•´å°±ä¸ç”¨ç­‰å¤ªä¹…</span>

        <span class="hljs-keyword">return</span> self.silence_threshold

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">_is_complete_sentence</span>(<span class="hljs-params">self, text: <span class="hljs-built_in">str</span></span>) -&gt; <span class="hljs-built_in">bool</span>:
        <span class="hljs-string">"""ç®€å•çš„å¥å­å®Œæ•´æ€§åˆ¤æ–­"""</span>
        <span class="hljs-comment"># ä»¥é—®å·ã€å¥å·ç»“å°¾ï¼Œæˆ–è€…æ˜¯å¸¸è§çš„å®Œæ•´çŸ­è¯­</span>
        endings = [<span class="hljs-string">'å—'</span>, <span class="hljs-string">'å‘¢'</span>, <span class="hljs-string">'å§'</span>, <span class="hljs-string">'äº†'</span>, <span class="hljs-string">'çš„'</span>, <span class="hljs-string">'å¥½'</span>, <span class="hljs-string">'è¡Œ'</span>, <span class="hljs-string">'å¯ä»¥'</span>]
        <span class="hljs-keyword">return</span> <span class="hljs-built_in">any</span>(text.strip().endswith(e) <span class="hljs-keyword">for</span> e <span class="hljs-keyword">in</span> endings)
</code></pre>
<p>ä»å›ºå®š 300ms é™éŸ³é˜ˆå€¼æ”¹æˆåŠ¨æ€åˆ¤æ–­åï¼Œå¹³å‡ VAD å»¶è¿Ÿä» 300ms é™åˆ° ~100msã€‚</p>
<h2 data-id="heading-5">ç¬¬ä¸‰åˆ€ï¼šLLM æ¨ç†åŠ é€Ÿï¼ˆ-400msï¼‰</h2>
<p>LLM æ˜¯æœ€å¤§çš„ç“¶é¢ˆï¼Œä¼˜åŒ–ç©ºé—´ä¹Ÿæœ€å¤§ã€‚å‡ ä¸ªå…³é”®æ‰‹æ®µï¼š</p>
<h3 data-id="heading-6">3.1 Prompt ç¼“å­˜</h3>
<p>å¦‚æœä½ ç”¨çš„æ˜¯ Claude APIï¼Œç³»ç»Ÿçº§ promptï¼ˆè§’è‰²è®¾å®šã€çŸ¥è¯†åº“ã€å†å²ä¸Šä¸‹æ–‡ç­‰ï¼‰åœ¨è¿ç»­å¯¹è¯ä¸­å‡ ä¹ä¸å˜ã€‚å¼€å¯ Prompt Caching åï¼Œè¿™éƒ¨åˆ† Token çš„å¤„ç†æ—¶é—´æ¥è¿‘äºé›¶ã€‚</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># ç³»ç»Ÿ prompt æ‰“ä¸Š cache_control</span>
messages = [
    {
        <span class="hljs-string">"role"</span>: <span class="hljs-string">"system"</span>,
        <span class="hljs-string">"content"</span>: [
            {
                <span class="hljs-string">"type"</span>: <span class="hljs-string">"text"</span>,
                <span class="hljs-string">"text"</span>: SYSTEM_PROMPT + KNOWLEDGE_BASE,  <span class="hljs-comment"># é€šå¸¸å  80% tokens</span>
                <span class="hljs-string">"cache_control"</span>: {<span class="hljs-string">"type"</span>: <span class="hljs-string">"ephemeral"</span>}
            }
        ]
    },
    {<span class="hljs-string">"role"</span>: <span class="hljs-string">"user"</span>, <span class="hljs-string">"content"</span>: user_message}
]
</code></pre>
<p>å®æµ‹æ•ˆæœï¼šé¦–è½® ~800msï¼Œåç»­è½®æ¬¡ ~350msã€‚<strong>åå¤å‡ºç°çš„ prompt å†…å®¹åªéœ€å¤„ç†ä¸€æ¬¡</strong>ã€‚</p>
<h3 data-id="heading-7">3.2 é€‰å¯¹æ¨¡å‹</h3>
<p>ä¸æ˜¯æ‰€æœ‰åœºæ™¯éƒ½éœ€è¦æœ€å¼ºæ¨¡å‹ã€‚è¯­éŸ³ Agent çš„æ„å›¾è¯†åˆ«å’ŒçŸ¥è¯†åº“é—®ç­”ï¼Œç”¨ Haiku çº§åˆ«çš„å°æ¨¡å‹å®Œå…¨å¤Ÿç”¨ï¼Œé€Ÿåº¦å¿« 5 å€ä»¥ä¸Šï¼š</p>

























<table><thead><tr><th>æ¨¡å‹</th><th>é¦– Token å»¶è¿Ÿ</th><th>é€‚ç”¨åœºæ™¯</th></tr></thead><tbody><tr><td>Opus 4.6</td><td>~500ms</td><td>å¤æ‚æ¨ç†ã€è·¨æ–‡æ¡£åˆ†æ</td></tr><tr><td>Sonnet 4.5</td><td>~250ms</td><td>é€šç”¨å¯¹è¯ã€ä¸­ç­‰å¤æ‚åº¦</td></tr><tr><td>Haiku 4.5</td><td>~80ms</td><td>æ„å›¾åˆ†ç±»ã€ç®€å•é—®ç­”ã€slot filling</td></tr></tbody></table>
<p>å®é™…é¡¹ç›®ä¸­ï¼Œæˆ‘ç”¨<strong>è·¯ç”± + çº§è”</strong>çš„æ–¹å¼ï¼šå…ˆç”¨ Haiku åšæ„å›¾åˆ†ç±»ï¼ˆ&lt;100msï¼‰ï¼Œç®€å•æ„å›¾ç›´æ¥ç”¨ Haiku å›ç­”ï¼Œå¤æ‚é—®é¢˜å†å‡çº§åˆ° Sonnetã€‚</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">ModelRouter</span>:
    <span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">route</span>(<span class="hljs-params">self, transcript: <span class="hljs-built_in">str</span>, context: <span class="hljs-built_in">dict</span></span>) -&gt; <span class="hljs-built_in">str</span>:
        <span class="hljs-comment"># ç¬¬ä¸€æ­¥ï¼šHaiku å¿«é€Ÿåˆ†ç±»æ„å›¾ï¼ˆ&lt; 100msï¼‰</span>
        intent = <span class="hljs-keyword">await</span> self.haiku.classify(transcript)

        <span class="hljs-keyword">if</span> intent.<span class="hljs-built_in">type</span> <span class="hljs-keyword">in</span> (<span class="hljs-string">"greeting"</span>, <span class="hljs-string">"confirmation"</span>, <span class="hljs-string">"simple_qa"</span>):
            <span class="hljs-comment"># ç®€å•æ„å›¾ï¼šHaiku ç›´æ¥å›ï¼ˆ&lt; 200msï¼‰</span>
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">await</span> self.haiku.generate(transcript, context)

        <span class="hljs-keyword">elif</span> intent.<span class="hljs-built_in">type</span> <span class="hljs-keyword">in</span> (<span class="hljs-string">"knowledge_query"</span>, <span class="hljs-string">"multi_turn"</span>):
            <span class="hljs-comment"># ä¸­ç­‰å¤æ‚åº¦ï¼šSonnet å¤„ç†ï¼ˆ&lt; 400msï¼‰</span>
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">await</span> self.sonnet.generate(transcript, context)

        <span class="hljs-keyword">else</span>:
            <span class="hljs-comment"># å¤æ‚æ¨ç†ï¼šOpus å…œåº•</span>
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">await</span> self.opus.generate(transcript, context)
</code></pre>
<p>è¿™ä¸ªè·¯ç”±ç­–ç•¥ä¸‹ï¼Œ<strong>70% ä»¥ä¸Šçš„è¯·æ±‚èµ° Haikuï¼ŒLLM å¹³å‡å»¶è¿Ÿä» 800ms é™åˆ° ~250ms</strong>ã€‚</p>
<h3 data-id="heading-8">3.3 é¢„æµ‹æ€§ç”Ÿæˆ</h3>
<p>åœ¨æŸäº›é«˜é¢‘åœºæ™¯ä¸‹ï¼Œå¯ä»¥åœ¨ç”¨æˆ·è¿˜åœ¨è¯´è¯æ—¶å°±å¼€å§‹"é¢„ç”Ÿæˆ"å¯èƒ½çš„å›å¤ï¼š</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">predictive_generate</span>(<span class="hljs-params">partial_transcript: <span class="hljs-built_in">str</span></span>):
    <span class="hljs-string">"""åŸºäº ASR partial result æå‰å¯åŠ¨æ¨ç†"""</span>
    <span class="hljs-keyword">if</span> confidence_high_enough(partial_transcript):
        <span class="hljs-comment"># é¢„æ¨ç†ï¼Œå¦‚æœæœ€ç»ˆ transcript å˜åŒ–ä¸å¤§å°±ç›´æ¥ç”¨</span>
        predicted_response = <span class="hljs-keyword">await</span> llm.generate(partial_transcript)
        cache.<span class="hljs-built_in">set</span>(partial_transcript, predicted_response, ttl=<span class="hljs-number">5</span>)
</code></pre>
<p>è¿™ä¸ªæ–¹æ¡ˆæœ‰é£é™©ï¼ˆé¢„æµ‹é”™äº†ç™½ç®—ï¼‰ï¼Œä½†åœ¨å®¢æœåœºæ™¯ä¸‹ï¼Œç”¨æˆ·é—®é¢˜çš„æ¨¡å¼éå¸¸é›†ä¸­ï¼Œå‘½ä¸­ç‡èƒ½åˆ° 40-50%ã€‚å‘½ä¸­æ—¶ç­‰äº<strong>é›¶ LLM å»¶è¿Ÿ</strong>ã€‚</p>
<h2 data-id="heading-9">ç¬¬å››åˆ€ï¼šTTS æµå¼åˆæˆï¼ˆ-200msï¼‰</h2>
<p>ä¼ ç»Ÿ TTS éœ€è¦æ‹¿åˆ°å®Œæ•´æ–‡æœ¬æ‰èƒ½åˆæˆã€‚ç°åœ¨ä¸»æµçš„ TTS æœåŠ¡ï¼ˆElevenLabs Flashã€Azure Neural TTSï¼‰éƒ½æ”¯æŒæµå¼åˆæˆâ€”â€”å–‚ä¸€ä¸ªå¥å­ç‰‡æ®µè¿›å»å°±èƒ½æ‹¿åˆ°å¯¹åº”çš„éŸ³é¢‘ç‰‡æ®µã€‚</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">StreamingTTS</span>:
    <span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">synthesize_streaming</span>(<span class="hljs-params">self, text_stream</span>):
        <span class="hljs-string">"""æµå¼ TTSï¼šæ¯æ”¶åˆ°ä¸€ä¸ªå¥å­ç‰‡æ®µå°±åˆæˆ"""</span>
        buffer = <span class="hljs-string">""</span>
        <span class="hljs-keyword">async</span> <span class="hljs-keyword">for</span> chunk <span class="hljs-keyword">in</span> text_stream:
            buffer += chunk
            <span class="hljs-comment"># æŒ‰æ ‡ç‚¹ç¬¦å·åˆ‡åˆ†æˆè‡ªç„¶çš„è¯­éŸ³ç‰‡æ®µ</span>
            sentences = self._split_at_punctuation(buffer)
            <span class="hljs-keyword">for</span> sentence <span class="hljs-keyword">in</span> sentences[:-<span class="hljs-number">1</span>]:  <span class="hljs-comment"># æœ€åä¸€ä¸ªå¯èƒ½ä¸å®Œæ•´ï¼Œç•™ç€</span>
                audio = <span class="hljs-keyword">await</span> self._synthesize_one(sentence)
                <span class="hljs-keyword">yield</span> audio
            buffer = sentences[-<span class="hljs-number">1</span>] <span class="hljs-keyword">if</span> sentences <span class="hljs-keyword">else</span> <span class="hljs-string">""</span>

        <span class="hljs-comment"># å¤„ç†å‰©ä½™æ–‡æœ¬</span>
        <span class="hljs-keyword">if</span> buffer.strip():
            <span class="hljs-keyword">yield</span> <span class="hljs-keyword">await</span> self._synthesize_one(buffer)

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">_split_at_punctuation</span>(<span class="hljs-params">self, text: <span class="hljs-built_in">str</span></span>) -&gt; <span class="hljs-built_in">list</span>[<span class="hljs-built_in">str</span>]:
        <span class="hljs-string">"""åœ¨æ ‡ç‚¹å¤„åˆ‡åˆ†ï¼Œä¿è¯æ¯ä¸ªç‰‡æ®µæ˜¯è‡ªç„¶çš„è¯­éŸ³å•å…ƒ"""</span>
        <span class="hljs-keyword">import</span> re
        parts = re.split(<span class="hljs-string">r'([ã€‚ï¼ï¼Ÿï¼Œï¼›ã€,.!?;])'</span>, text)
        <span class="hljs-comment"># æŠŠæ ‡ç‚¹å’Œå‰é¢çš„æ–‡å­—åˆå¹¶</span>
        result = []
        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>, <span class="hljs-built_in">len</span>(parts) - <span class="hljs-number">1</span>, <span class="hljs-number">2</span>):
            result.append(parts[i] + parts[i + <span class="hljs-number">1</span>])
        <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(parts) % <span class="hljs-number">2</span> == <span class="hljs-number">1</span>:
            result.append(parts[-<span class="hljs-number">1</span>])
        <span class="hljs-keyword">return</span> [p <span class="hljs-keyword">for</span> p <span class="hljs-keyword">in</span> result <span class="hljs-keyword">if</span> p.strip()]
</code></pre>
<p>å…³é”®ç»†èŠ‚ï¼š<strong>åˆ‡åˆ†ç²’åº¦å¾ˆé‡è¦</strong>ã€‚å¤ªç»†ï¼ˆæ¯ä¸ªè¯åˆæˆä¸€æ¬¡ï¼‰ä¼šå¯¼è‡´è¯­éŸ³ä¸è‡ªç„¶ï¼Œå¤ªç²—ï¼ˆç­‰å®Œæ•´æ®µè½ï¼‰ä¼šå¢åŠ å»¶è¿Ÿã€‚æŒ‰æ ‡ç‚¹ç¬¦å·åˆ‡åˆ†æ˜¯å®æµ‹ä¸‹æ¥æœ€å¥½çš„å¹³è¡¡ç‚¹ã€‚</p>
<h2 data-id="heading-10">æœ€ç»ˆç»“æœ</h2>
<p>æ‰€æœ‰ä¼˜åŒ–å åŠ åï¼š</p>















































<table><thead><tr><th>ç¯èŠ‚</th><th>ä¼˜åŒ–å‰</th><th>ä¼˜åŒ–å</th><th>èŠ‚çœ</th></tr></thead><tbody><tr><td>VAD ç«¯ç‚¹æ£€æµ‹</td><td>~300ms</td><td>~100ms</td><td>200ms</td></tr><tr><td>ASR è½¬å†™</td><td>~400ms</td><td>~150msï¼ˆæµå¼ï¼‰</td><td>250ms</td></tr><tr><td>LLM æ¨ç†</td><td>~800ms</td><td>~250msï¼ˆè·¯ç”±+ç¼“å­˜ï¼‰</td><td>550ms</td></tr><tr><td>TTS åˆæˆ</td><td>~350ms</td><td>~100msï¼ˆæµå¼ï¼‰</td><td>250ms</td></tr><tr><td>ç½‘ç»œä¼ è¾“</td><td>~150ms</td><td>~80msï¼ˆåŒåŒºéƒ¨ç½²ï¼‰</td><td>70ms</td></tr><tr><td><strong>æ€»è®¡</strong></td><td><strong>~2000ms</strong></td><td><strong>~450ms</strong></td><td><strong>~1550ms</strong></td></tr></tbody></table>
<p>ä»ç”¨æˆ·ä½“æ„Ÿæ¥è¯´ï¼šä¼˜åŒ–å‰æ˜¯"é—®å®Œç­‰ä¸¤ç§’æ‰æœ‰ååº”"ï¼Œä¼˜åŒ–åæ˜¯"è¯éŸ³åˆšè½å°±æœ‰å›åº”"ã€‚è¿™ä¸ªå·®è·ä¸æ˜¯é‡å˜ï¼Œæ˜¯è´¨å˜â€”â€”å®ƒå†³å®šäº†ç”¨æˆ·ä¼šä¸ä¼šè§‰å¾—"è¿™ä¸ª AI å®¢æœä¸é”™"è¿˜æ˜¯"ç®—äº†è®©æˆ‘è½¬äººå·¥"ã€‚</p>
<h2 data-id="heading-11">å‡ ä¸ªè¸©å‘æé†’</h2>
<p><strong>1. æµå¼æ¶æ„ä¸‹çš„ä¸­æ–­å¤„ç†</strong></p>
<p>ç”¨æˆ·éšæ—¶å¯èƒ½æ‰“æ–­ Agent è¯´è¯ã€‚æµå¼æ¶æ„ä¸‹ä½ éœ€è¦ä¼˜é›…åœ°å¤„ç†ï¼š</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">handle_interruption</span>(<span class="hljs-params">self</span>):
    <span class="hljs-string">"""ç”¨æˆ·æ‰“æ–­æ—¶ï¼Œåœæ­¢å½“å‰çš„ TTS æ’­æ”¾å’Œ LLM ç”Ÿæˆ"""</span>
    <span class="hljs-comment"># åœæ­¢æ’­æ”¾</span>
    self.player.stop()
    <span class="hljs-comment"># å–æ¶ˆæ­£åœ¨è¿›è¡Œçš„ LLM ç”Ÿæˆ</span>
    <span class="hljs-keyword">if</span> self._llm_task <span class="hljs-keyword">and</span> <span class="hljs-keyword">not</span> self._llm_task.done():
        self._llm_task.cancel()
    <span class="hljs-comment"># å–æ¶ˆæ­£åœ¨è¿›è¡Œçš„ TTS åˆæˆ</span>
    <span class="hljs-keyword">if</span> self._tts_task <span class="hljs-keyword">and</span> <span class="hljs-keyword">not</span> self._tts_task.done():
        self._tts_task.cancel()
    <span class="hljs-comment"># ç”¨æ‰“æ–­åçš„æ–° transcript é‡æ–°å¼€å§‹å¤„ç†</span>
</code></pre>
<p><strong>2. å¥å­åˆ‡åˆ†çš„ä¸­æ–‡å‘</strong></p>
<p>ä¸­æ–‡æ²¡æœ‰ç©ºæ ¼åˆ†éš”ï¼Œæ ‡ç‚¹ç¬¦å·ä½¿ç”¨ä¹Ÿä¸åƒè‹±æ–‡é‚£ä¹ˆè§„èŒƒã€‚å®é™…å¯¹è¯ä¸­å¾ˆå¤šç”¨æˆ·è¯´è¯æ˜¯æ²¡æœ‰æ ‡ç‚¹çš„ï¼ˆASR è¾“å‡ºä¹Ÿç»å¸¸ä¸å¸¦æ ‡ç‚¹ï¼‰ï¼Œéœ€è¦é è¯­ä¹‰æ¥åˆ¤æ–­åˆ‡åˆ†ç‚¹ã€‚</p>
<p><strong>3. éŸ³é¢‘æ ¼å¼çš„é€‰æ‹©</strong></p>
<p>æµå¼åœºæ™¯ä¸‹ï¼ŒOpus ç¼–ç æ¯” MP3 å¥½å¾—å¤šâ€”â€”æ›´ä½å»¶è¿Ÿã€æ›´å°ä½“ç§¯ã€æ›´å¥½çš„æµå¼æ”¯æŒã€‚å¦‚æœä½ è¿˜åœ¨ç”¨ MP3 åšå®æ—¶è¯­éŸ³ï¼Œæ¢ Opus ç«‹åˆ»èƒ½çœ 50-100msã€‚</p>
<h2 data-id="heading-12">æ€»ç»“</h2>
<p>è¯­éŸ³ Agent çš„å»¶è¿Ÿä¼˜åŒ–æ²¡æœ‰é“¶å¼¹ï¼Œæ ¸å¿ƒå°±æ˜¯ä¸¤ä»¶äº‹ï¼š</p>
<ol>
<li><strong>ä¸²è¡Œå˜å¹¶è¡Œ</strong>ï¼šæµå¼æ¶æ„è®©æ¯ä¸ªç¯èŠ‚ä¸å†äº’ç›¸ç­‰å¾…</li>
<li><strong>æ¯ä¸ªç¯èŠ‚å‹åˆ°æè‡´</strong>ï¼šVAD æ™ºèƒ½åŒ–ã€æ¨¡å‹è·¯ç”±ã€Prompt ç¼“å­˜ã€TTS æµå¼åŒ–</li>
</ol>
<p>èƒ½æŠŠå»¶è¿Ÿå‹åˆ° 500ms ä»¥å†…çš„è¯­éŸ³ Agent å¹³å°ï¼Œåœ¨ç”¨æˆ·ä½“éªŒä¸Šä¼šå’Œå…¶ä»–ç«å“æ‹‰å¼€ä»£é™…å·®è·ã€‚æˆ‘åœ¨ç”¨çš„ ofox.ai å°±æ˜¯æœç€è¿™ä¸ªæ–¹å‘åœ¨åšï¼Œä»–ä»¬æœ€æ–°ç‰ˆæœ¬å®æµ‹å»¶è¿Ÿå·²ç»åˆ°äº† 400ms çº§åˆ«ï¼Œåœ¨å›½å†…è¯­éŸ³ Agent å¹³å°é‡Œç®—æ˜¯ç¬¬ä¸€æ¢¯é˜Ÿäº†ã€‚</p>
<p>å¦‚æœä½ ä¹Ÿåœ¨åšè¯­éŸ³ AI ç›¸å…³çš„é¡¹ç›®ï¼Œæ¬¢è¿äº¤æµã€‚è¿™ä¸ªé¢†åŸŸ 2026 å¹´ä¼šè¶Šæ¥è¶Šå·ï¼Œä½†åªè¦å»¶è¿Ÿè¶³å¤Ÿä½ã€ä½“éªŒè¶³å¤Ÿå¥½ï¼Œå¸‚åœºç©ºé—´æ˜¯å·¨å¤§çš„ã€‚</p>
<hr/>
<p><em>æˆ‘æ˜¯ç è·¯é£ï¼Œä¸€ä¸ªåœ¨ AI Agent ä¸€çº¿æ¬ç –çš„å¼€å‘è€…ã€‚å…³æ³¨æˆ‘ï¼ŒæŒç»­åˆ†äº«è¯­éŸ³ AIã€Agent æ¶æ„ã€å¤§æ¨¡å‹å·¥ç¨‹åŒ–çš„å®æˆ˜ç»éªŒã€‚</em></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[æ‘˜è¦ã€å‹ç¼©ä¸å¤„ç†å¤§å·¥å…·è¾“å‡ºçš„å·¥ç¨‹å®è·µ]]></title>    <link>https://juejin.cn/post/7603674653153837065</link>    <guid>https://juejin.cn/post/7603674653153837065</guid>    <pubDate>2026-02-08T07:10:11.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7603674653153837065" data-draft-id="7603771025856626739" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="æ‘˜è¦ã€å‹ç¼©ä¸å¤„ç†å¤§å·¥å…·è¾“å‡ºçš„å·¥ç¨‹å®è·µ"/> <meta itemprop="keywords" content="AIGC"/> <meta itemprop="datePublished" content="2026-02-08T07:10:11.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ç››å¤å…‰å¹´çˆ±å­¦ä¹ "/> <meta itemprop="url" content="https://juejin.cn/user/2189882893018872"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            æ‘˜è¦ã€å‹ç¼©ä¸å¤„ç†å¤§å·¥å…·è¾“å‡ºçš„å·¥ç¨‹å®è·µ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2189882893018872/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ç››å¤å…‰å¹´çˆ±å­¦ä¹ 
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-08T07:10:11.000Z" title="Sun Feb 08 2026 07:10:11 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    5
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»7åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">æ‘˜è¦ã€å‹ç¼©ä¸å¤„ç†å¤§å·¥å…·è¾“å‡ºçš„å·¥ç¨‹å®è·µâ€”â€”ä» Manus çš„ç»éªŒï¼Œçœ‹ Context Engineering çš„â€œé«˜é£é™©åŒºâ€</h2>
<hr/>
<h3 data-id="heading-1">å¼•è¨€ï¼šå‹ç¼©çš„ä¸å¯é€†é£é™©ä¸å·¥ç¨‹å¯¹ç­–</h3>
<p>ä¸Šä¸‹æ–‡å‹ç¼©æ˜¯AI Agentå·¥ç¨‹ä¸­çš„<strong>é«˜é£é™©æ“ä½œ</strong>â€”â€”å®ƒæ˜¯æœ‰æŸä¸”ä¸å¯é€†çš„ã€‚ä¸€æ—¦å…³é”®ä¿¡æ¯åœ¨å‹ç¼©è¿‡ç¨‹ä¸­ä¸¢å¤±ï¼Œç³»ç»Ÿå°†æ— æ³•æ¢å¤ï¼Œå¯èƒ½å¯¼è‡´åç»­å†³ç­–é“¾æ¡çš„å…¨é¢åå·®ã€‚</p>
<p>Manusè”åˆåˆ›å§‹äººPeak Jiæå‡ºçš„æ ¸å¿ƒæ–¹æ³•è®ºï¼š<strong>é«˜è´¨é‡çš„æ‘˜è¦ä¸æ˜¯è®©æ¨¡å‹"å†™æ‘˜è¦"ï¼Œè€Œæ˜¯è®©æ¨¡å‹"å¡«è¡¨æ ¼"ï¼›å¤„ç†å¤§å·¥å…·è¾“å‡ºä¸æ˜¯æ— è„‘é€ä¼ ï¼Œè€Œæ˜¯åœºæ™¯åŒ–çš„ç­–ç•¥é€‰æ‹©</strong>ã€‚è¿™ä¸€å·¥ç¨‹å®è·µä¸ºæˆ‘ä»¬æä¾›äº†ç¡®ä¿ä¿¡æ¯ä¿çœŸåº¦çš„ç³»ç»ŸåŒ–è·¯å¾„ã€‚</p>
<hr/>
<h3 data-id="heading-2">ç¬¬ä¸€éƒ¨åˆ†ï¼šé«˜è´¨é‡æ‘˜è¦çš„ç§˜è¯€â€”â€”ä»åˆ›ä½œåˆ°æŠ½å–</h3>
<h4 data-id="heading-3">1.1 é”™è¯¯åšæ³•ï¼šå¼€æ”¾å¼æŒ‡ä»¤çš„ä¸å¯æ§æ€§</h4>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-string">"è¯·æ€»ç»“ä»¥ä¸‹å†…å®¹..."</span>
</code></pre>
<p><strong>æ ¸å¿ƒé—®é¢˜</strong>ï¼š</p>
<ul>
<li><strong>ä¿¡æ¯è¦†ç›–ä¸ç¡®å®š</strong>ï¼šæ¨¡å‹å¯èƒ½é—æ¼å·¥ç¨‹å¸ˆè®¤ä¸ºå…³é”®çš„ä¿¡æ¯</li>
<li><strong>è¾“å‡ºç¨³å®šæ€§ä½</strong>ï¼šç›¸åŒè¾“å…¥å¤šæ¬¡è°ƒç”¨ç»“æœä¸ä¸€è‡´</li>
<li><strong>ä¸‹æ¸¸å¯è§£ææ€§å·®</strong>ï¼šè‡ªç„¶è¯­è¨€è¾“å‡ºéš¾ä»¥è¢«ç¨‹åºæ¶ˆè´¹</li>
<li><strong>é”™è¯¯å®šä½å›°éš¾</strong>ï¼šæ— æ³•ç²¾ç¡®çŸ¥é“"å“ªé‡Œæ¼äº†"</li>
</ul>
<h4 data-id="heading-4">1.2 æ­£ç¡®åšæ³•ï¼šSchemaçº¦æŸçš„ä¿¡æ¯æŠ½å–</h4>
<pre><code class="hljs language-css" lang="css">å®šä¹‰ç»“æ„åŒ–è¡¨å•ï¼Œè®©AIç²¾ç¡®å¡«å……å­—æ®µï¼š
â€‹
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Â  Â  Â  Â  Â  Â   Task <span class="hljs-selector-tag">Summary</span> Â  Â  Â  Â  Â  Â  Â  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ç”¨æˆ·åŸå§‹ç›®æ ‡ Â  Â  Â   â”‚ <span class="hljs-selector-attr">[å¿…é¡»]</span> åŸæ–‡æ ¸å¿ƒè¯‰æ±‚  â”‚
â”‚ å½“å‰å­ç›®æ ‡ Â  Â  Â  Â   â”‚ <span class="hljs-selector-attr">[å¿…é¡»]</span> å½“å‰èšç„¦ä»»åŠ¡  â”‚
â”‚ å·²ä¿®æ”¹æ–‡ä»¶ Â  Â  Â  Â   â”‚ <span class="hljs-selector-attr">[å¯é€‰]</span> æ–‡ä»¶è·¯å¾„åˆ—è¡¨  â”‚
â”‚ å·²åšå…³é”®å†³ç­– Â  Â  Â   â”‚ <span class="hljs-selector-attr">[å¿…é¡»]</span> å†³ç­–+ç†ç”± Â  Â  â”‚
â”‚ å½“å‰é˜»å¡ç‚¹ Â  Â  Â  Â   â”‚ <span class="hljs-selector-attr">[å¿…é¡»]</span> æ— /å…·ä½“é—®é¢˜ Â  â”‚
â”‚ ä¸‹ä¸€æ­¥æ˜ç¡®è¡ŒåŠ¨ Â  Â   â”‚ <span class="hljs-selector-attr">[å¿…é¡»]</span> å¯æ‰§è¡Œæ­¥éª¤ Â   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<p><strong>èŒƒå¼è½¬ç§»çš„æœ¬è´¨</strong>ï¼š</p>








































<table><thead><tr><th>ç»´åº¦</th><th>è‡ªç”±æ‘˜è¦ï¼ˆåˆ›ä½œï¼‰</th><th>Schemaå¡«è¡¨ï¼ˆæŠ½å–ï¼‰</th></tr></thead><tbody><tr><td><strong>é—®é¢˜ç±»å‹</strong></td><td>è¯­è¨€ç”Ÿæˆï¼ˆGenerativeï¼‰</td><td>ä¿¡æ¯æŠ½å–ï¼ˆExtractiveï¼‰</td></tr><tr><td><strong>ä¿¡æ¯è¦†ç›–</strong></td><td>ä¸ç¡®å®š</td><td>å¼ºåˆ¶è¦†ç›–ï¼ˆå­—æ®µå¿…å¡«ï¼‰</td></tr><tr><td><strong>è¾“å‡ºç¨³å®šæ€§</strong></td><td>ä½</td><td>é«˜ï¼ˆç»“æ„å›ºå®šï¼‰</td></tr><tr><td><strong>ä¸‹æ¸¸å¯è§£ææ€§</strong></td><td>å·®</td><td>æå¼ºï¼ˆç»“æ„åŒ–æ•°æ®ï¼‰</td></tr><tr><td><strong>ç‰ˆæœ¬æ¼”è¿›</strong></td><td>ä¸å¯æ§</td><td>å¯æ¼”è¿›ï¼ˆSchemaæ˜¾å¼å˜æ›´ï¼‰</td></tr><tr><td><strong>é”™è¯¯å®šä½</strong></td><td>å›°éš¾</td><td>ç²¾ç¡®ï¼ˆå­—æ®µçº§ç›‘æ§ï¼‰</td></tr></tbody></table>
<p><strong>Schemaçš„å·¥ç¨‹ä»·å€¼</strong>ï¼š</p>
<blockquote>
<p>"Schemaæœ¬èº«ï¼Œå°±æ˜¯ç³»ç»Ÿ'è®¤ä¸ºé‡è¦çš„äº‹å®é›†åˆ'"</p>
</blockquote>
<ul>
<li><strong>æ˜¾å¼ç¼–ç ä¸šåŠ¡çŸ¥è¯†</strong>ï¼šå“ªäº›ä¿¡æ¯å¯¹ç³»ç»Ÿå†³ç­–è‡³å…³é‡è¦</li>
<li><strong>å»ºç«‹ç¡®å®šæ€§å¥‘çº¦</strong>ï¼šå·¥ç¨‹å¸ˆä¸æ¨¡å‹ä¹‹é—´çš„å¯é æ¥å£</li>
<li><strong>æ”¯æ’‘ç‰ˆæœ¬åŒ–è¿­ä»£</strong>ï¼šä¸šåŠ¡å˜åŒ–æ—¶Schemaæ˜¾å¼å˜æ›´ï¼Œå˜æ›´å¯è¿½æº¯</li>
</ul>
<hr/>
<h3 data-id="heading-5">ç¬¬äºŒéƒ¨åˆ†ï¼šå¤„ç†å¤§å·¥å…·è¾“å‡ºçš„åŒç­–ç•¥</h3>
<p>å½“å·¥å…·è¿”å›æµ·é‡Tokenæ—¶ï¼Œ <strong>"å®Œæ•´è¿”å›"ä¸"å³æ—¶å¤„ç†"å­˜åœ¨æ ¹æœ¬å¼ åŠ›</strong>ã€‚Peakæå‡ºåœºæ™¯åŒ–çš„ç­–ç•¥é€‰æ‹©æ¡†æ¶ã€‚</p>
<h4 data-id="heading-6">2.1 ç­–ç•¥é€‰æ‹©çš„å†³ç­–è¾¹ç•Œ</h4>
<pre><code class="hljs">å¼€å§‹
  â”‚
  â”œâ”€â”€ å·¥å…·è¾“å‡ºç»é¢„å¤„ç†åé•¿åº¦ &lt; é˜ˆå€¼ï¼ˆå¦‚4K tokensï¼‰ï¼Ÿ
  â”‚ Â  â””â”€â”€ å¦ â†’ å¼ºåˆ¶é¢„æ‘˜è¦æˆ–å­Agentå°è£…ï¼ˆç­–ç•¥äºŒï¼‰
  â”‚ Â  â””â”€â”€ æ˜¯ â†’ ç»§ç»­åˆ¤æ–­
  â”‚
  â”œâ”€â”€ Agentéœ€è¦ç«‹å³å¤„ç†ï¼ˆéæš‚å­˜å¤‡ç”¨ï¼‰ï¼Ÿ
  â”‚ Â  â””â”€â”€ å¦ â†’ ç«‹å³å¸è½½åˆ°æ–‡ä»¶ç³»ç»Ÿï¼Œè¿”å›æŒ‡é’ˆ
  â”‚ Â  â””â”€â”€ æ˜¯ â†’ ç­–ç•¥ä¸€ï¼šå…ˆå®Œæ•´è¿”å› + ä¿é™©æªæ–½
  â”‚
  â””â”€â”€ ä¿¡æ¯æ—¶æ•ˆæ€§é«˜ï¼ˆå»¶è¿Ÿå¤„ç†ä¼šè´¬å€¼ï¼‰ï¼Ÿ
 Â  Â   â””â”€â”€ å¦ â†’ è€ƒè™‘æ‰¹é‡å¼‚æ­¥å¤„ç†
 Â  Â   â””â”€â”€ æ˜¯ â†’ ç¡®è®¤ç­–ç•¥ä¸€
</code></pre>
<p><strong>å…³é”®è®¤çŸ¥</strong>ï¼šç­–ç•¥ä¸€çš„"å®Œæ•´è¿”å›"æ˜¯<strong>æœ‰è¾¹ç•Œ</strong>çš„ï¼Œä¸æ˜¯æ— è„‘é€ä¼ åŸå§‹è¾“å‡ºã€‚</p>
<h4 data-id="heading-7">2.2 ç­–ç•¥ä¸€ï¼šç®€å•æœç´¢â€”â€”å…ˆå®Œæ•´è¿”å›ï¼Œå¿…é¡»åŠ ä¿é™©</h4>
<p><strong>é€‚ç”¨æ¡ä»¶</strong>ï¼ˆä¸‰è€…ç¼ºä¸€ä¸å¯ï¼‰ï¼š</p>
<ul>
<li>å·¥å…·è¾“å‡ºç»é¢„å¤„ç†åé•¿åº¦å¯æ§ï¼ˆ&lt; 4K tokensï¼‰</li>
<li>Agentææœ‰å¯èƒ½ç«‹å³å¤„ç†</li>
<li>ä¿¡æ¯æ—¶æ•ˆæ€§é«˜</li>
</ul>
<p><strong>ä¸‰å±‚è¿‡æ»¤æœºåˆ¶</strong>ï¼š</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">Layer 1:</span> <span class="hljs-string">å·¥å…·å±‚é¢„å¤„ç†ï¼ˆå¿…é¡»ï¼‰</span>
<span class="hljs-string">â”œâ”€â”€</span> <span class="hljs-string">çˆ¬è™«ï¼šåªå–æ­£æ–‡ï¼Œå»å¹¿å‘Š/å¯¼èˆª/é¡µè„š</span>
<span class="hljs-string">â”œâ”€â”€</span> <span class="hljs-string">æœç´¢ï¼šåªå–Top-Kï¼ˆå¦‚10æ¡ï¼‰ï¼Œéå…¨éƒ¨1000æ¡</span>
<span class="hljs-string">â””â”€â”€</span> <span class="hljs-string">æ•°æ®åº“ï¼šåˆ†é¡µ+å­—æ®µç­›é€‰ï¼ŒéSELECT</span> <span class="hljs-string">*</span>
<span class="hljs-string">â€‹</span>
<span class="hljs-attr">Layer 2:</span> <span class="hljs-string">ç­–ç•¥å†³ç­–</span>
<span class="hljs-string">â””â”€â”€</span> <span class="hljs-string">é¢„å¤„ç†åé•¿åº¦</span> <span class="hljs-string">&lt;</span> <span class="hljs-string">é˜ˆå€¼</span> <span class="hljs-string">â†’</span> <span class="hljs-string">è¿›å…¥ç­–ç•¥ä¸€</span>
<span class="hljs-string">â€‹</span>
<span class="hljs-attr">Layer 3:</span> <span class="hljs-string">ç³»ç»Ÿçº§å‹ç¼©ï¼ˆæœªæ¥æ—¶åˆ»ï¼‰</span>
<span class="hljs-string">â””â”€â”€</span> <span class="hljs-string">åŸå§‹ç»“æœ</span> <span class="hljs-string">â†’</span> <span class="hljs-string">å‹ç¼©ä¸ºæŒ‡é’ˆï¼ˆä½†å…³é”®æ´è§å·²ä¿é™©æŒä¹…åŒ–ï¼‰</span>
</code></pre>
<p><strong>ä¿é™©æªæ–½ï¼šå¯¹å†²"å»¶è¿Ÿå‹ç¼©"çš„ä¸ç¡®å®šæ€§</strong></p>
<pre><code class="hljs language-arduino" lang="arduino">é£é™©åœºæ™¯ï¼š
  å®Œæ•´è¿”å› â†’ Agentè¿˜æœªå¤„ç† â†’ ç³»ç»Ÿæå‰å‹ç¼©ï¼ˆå› çª—å£å‹åŠ›ï¼‰â†’ ä¿¡æ¯ä¸¢å¤±
â€‹
ä¿é™©æœºåˆ¶ï¼š
  å®Œæ•´è¿”å› â†’ Agentç«‹å³æå–æ´è§ â†’ ä¸»åŠ¨writeå·¥å…·å†™å…¥æ–‡ä»¶
 Â  Â  Â  Â  Â  Â   â””â”€â”€ å³ä½¿åŸå§‹ä¿¡æ¯è¢«æå‰å‹ç¼©ï¼Œæ´è§å·²å®‰å…¨
â€‹
å…³é”®è®¾è®¡ï¼šæŒ‡ç¤ºæ¨¡å‹<span class="hljs-string">"ç«‹å³æå–å¹¶æŒä¹…åŒ–å…³é”®è®¤çŸ¥"</span>ï¼Œè€Œéä¿å­˜å®Œæ•´åŸæ–‡
</code></pre>
<p><strong>ä¿é™©æªæ–½çš„å†™å…¥å†…å®¹</strong>ï¼š</p>





















<table><thead><tr><th>åœºæ™¯</th><th>å†™å…¥å†…å®¹</th></tr></thead><tbody><tr><td>æœç´¢è¿”å›10ç¯‡è®ºæ–‡</td><td>"3ç¯‡æ ¸å¿ƒè®ºæ–‡+å„è‡ªè´¡çŒ®+ä¸å½“å‰ä»»åŠ¡ç›¸å…³æ€§"</td></tr><tr><td>æ•°æ®åº“æŸ¥è¯¢ç»“æœ</td><td>"ç»Ÿè®¡æ‘˜è¦+å¼‚å¸¸ç‚¹+éœ€è¦æ·±å…¥è°ƒæŸ¥çš„IDåˆ—è¡¨"</td></tr><tr><td>APIè¿”å›ç›‘æ§æ•°æ®</td><td>"å…³é”®æŒ‡æ ‡å˜åŒ–+é˜ˆå€¼å‘Šè­¦+å»ºè®®æ’æŸ¥æ–¹å‘"</td></tr></tbody></table>
<h4 data-id="heading-8">2.3 ç­–ç•¥äºŒï¼šå¤æ‚æœç´¢â€”â€”å­Agentä½œä¸ºå·¥å…·</h4>
<p><strong>é€‚ç”¨åœºæ™¯</strong>ï¼š</p>
<ul>
<li>éœ€è¦å¤šæ¬¡æŸ¥è¯¢å¹¶æ•´åˆä¿¡æ¯</li>
<li>è¾“å‡ºç»é¢„å¤„ç†åä»è¶…é•¿</li>
<li>å¤æ‚æ€§è¶…å‡ºä¸»Agentå³æ—¶å¤„ç†èƒ½åŠ›</li>
</ul>
<p><strong>æ¶æ„è®¾è®¡</strong>ï¼š</p>
<pre><code class="hljs language-scss" lang="scss">ä¸»Agentä¸Šä¸‹æ–‡ï¼ˆå¹²å‡€ã€é«˜æ•ˆï¼‰
â”œâ”€â”€ è°ƒç”¨ï¼š<span class="hljs-built_in">advanced_search</span>("AI Agentä¸Šä¸‹æ–‡å·¥ç¨‹æœ€æ–°è¿›å±•")
â”‚ Â  Â  Â  â†“
â”‚ Â  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Â  â”‚ Â  Â  Â  Â  å­Agentï¼ˆç‹¬ç«‹å·¥ä½œæµï¼‰ Â  Â  Â  Â  â”‚
â”‚ Â  â”‚  â€¢ è‡ªä¸»å†³å®šæœç´¢ç­–ç•¥ï¼ˆå¤šæºã€å¤šè½®ï¼‰ Â  Â   â”‚
â”‚ Â  â”‚  â€¢ å†…éƒ¨å®Œæˆæ•´åˆã€å»é‡ã€éªŒè¯ Â  Â  Â  Â  Â  â”‚
â”‚ Â  â”‚  â€¢ è¾“å‡ºï¼šå›ºå®šSchemaçš„ç»“æ„åŒ–ç»“æœ Â  Â  Â   â”‚
â”‚ Â  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚ Â  Â  Â  â†“
â””â”€â”€ æ¥æ”¶ï¼š{çƒ­ç‚¹è¯é¢˜, å…³é”®æ•°æ®, è¶‹åŠ¿åˆ¤æ–­, ä¿¡æ¯æ¥æº}
â€‹
æ•ˆæœï¼šä¸»Agentä¸Šä¸‹æ–‡æå…¶å¹²å‡€ï¼Œå¤æ‚æ€§å®Œå…¨å°è£…
</code></pre>
<p><strong>ç­–ç•¥å¯¹æ¯”</strong>ï¼š</p>



































<table><thead><tr><th>ç»´åº¦</th><th>ç­–ç•¥ä¸€ï¼šå…ˆå®Œæ•´è¿”å›</th><th>ç­–ç•¥äºŒï¼šå­Agentå°è£…</th></tr></thead><tbody><tr><td><strong>è°ƒç”¨æ¬¡æ•°</strong></td><td>1æ¬¡ï¼ˆå³æ—¶ï¼‰</td><td>å¤šæ¬¡ï¼ˆå­Agentå†…éƒ¨ï¼‰</td></tr><tr><td><strong>å»¶è¿Ÿç‰¹æ€§</strong></td><td>å³æ—¶å“åº”</td><td>æœ‰å»¶è¿Ÿ</td></tr><tr><td><strong>ä¸»Agentä¸Šä¸‹æ–‡</strong></td><td>ä¸´æ—¶è†¨èƒ€ï¼Œåå‹ç¼©</td><td>å§‹ç»ˆå¹²å‡€</td></tr><tr><td><strong>ä¿¡æ¯ä¿çœŸåº¦</strong></td><td>ä¾èµ–ä¿é™©æªæ–½</td><td>å­Agentå†…éƒ¨ä¿éšœ</td></tr><tr><td><strong>å·¥ç¨‹å¤æ‚åº¦</strong></td><td>ä½</td><td>é«˜ï¼ˆéœ€è®¾è®¡å­Agentï¼‰</td></tr></tbody></table>
<hr/>
<h3 data-id="heading-9">ç¬¬ä¸‰éƒ¨åˆ†ï¼šå…³é”®å·¥ç¨‹å†³ç­–â€”â€”ä¸ºä½•ç®€å•æœç´¢ä¸ç«‹å³å¸è½½</h3>
<h4 data-id="heading-10">3.1 ä¸¤ç§æ¨¡å¼çš„æˆæœ¬å¯¹æ¯”</h4>


























<table><thead><tr><th>æ¨¡å¼</th><th>æµç¨‹</th><th>è°ƒç”¨æ¬¡æ•°</th><th>å»¶è¿Ÿ</th><th>é€‚ç”¨åœºæ™¯</th></tr></thead><tbody><tr><td><strong>ç«‹å³å¸è½½</strong></td><td>searchâ†’å¸è½½â†’æŒ‡é’ˆâ†’read_fileâ†’å†…å®¹â†’å¤„ç†</td><td>2æ¬¡</td><td>é«˜</td><td>å¤æ‚æŸ¥è¯¢ï¼Œéå³æ—¶å¤„ç†</td></tr><tr><td><strong>å…ˆè¿”å›åŸæ–‡</strong></td><td>searchâ†’å†…å®¹â†’ç«‹å³å¤„ç†</td><td>1æ¬¡</td><td>ä½</td><td>ç®€å•æœç´¢ï¼Œå³æ—¶å†³ç­–</td></tr></tbody></table>
<h4 data-id="heading-11">3.2 å·¥ç¨‹å†³ç­–åŸåˆ™</h4>
<blockquote>
<p>"å¯¹äºé‚£äº›Agentææœ‰å¯èƒ½éœ€è¦ç«‹å³å¤„ç†çš„å·¥å…·ç»“æœï¼Œé€‰æ‹©å…ˆè¿”å›åŸæ–‡æ¥æ¢å–å®è´µçš„å³æ—¶æ•ˆç‡" â€”â€” Peak Ji</p>
</blockquote>
<p><strong>æ ¸å¿ƒæƒè¡¡</strong>ï¼š</p>
<ul>
<li><strong>æ•ˆç‡ä¼˜å…ˆ</strong>ï¼šç®€å•æœç´¢çš„å³æ—¶æ€§ä»·å€¼é«˜äºå¸è½½çš„å®‰å…¨æ€§</li>
<li><strong>é£é™©å¯¹å†²</strong>ï¼šä¿é™©æªæ–½ï¼ˆä¸»åŠ¨å†™å…¥ï¼‰å¼¥è¡¥å‹ç¼©æ—¶æœºçš„ä¸ç¡®å®šæ€§</li>
<li><strong>åœºæ™¯åˆ†ç¦»</strong>ï¼šå¤æ‚ä»»åŠ¡ç”¨å­Agentå°è£…ï¼Œç®€å•ä»»åŠ¡ç”¨ç­–ç•¥ä¸€å¿«é€Ÿå¤„ç†</li>
</ul>
<hr/>
<h3 data-id="heading-12">ç¬¬å››éƒ¨åˆ†ï¼šä¸WSCIæ¡†æ¶çš„èåˆ</h3>
<p>Manuså®è·µä¸LangChain WSCIæ¡†æ¶çš„æ·±åº¦å¯¹åº”ï¼š</p>






























<table><thead><tr><th>Manuså®è·µ</th><th>WSCIæ“ä½œ</th><th>ä½œç”¨</th></tr></thead><tbody><tr><td>Schemaç»“æ„åŒ–æ‘˜è¦</td><td><strong>Write</strong>ï¼ˆå†™å…¥ï¼‰</td><td>æŠ¢å å¼æŒä¹…åŒ–å…³é”®ä¿¡æ¯</td></tr><tr><td>å·¥å…·å±‚é¢„å¤„ç†ï¼ˆTop-Kã€ç­›é€‰ï¼‰</td><td><strong>Select</strong>ï¼ˆé€‰æ‹©ï¼‰</td><td>å‰ç½®è¿‡æ»¤ï¼Œæ§åˆ¶è¾“å…¥è§„æ¨¡</td></tr><tr><td>å»¶è¿Ÿå‹ç¼© + ä¿é™©æªæ–½</td><td><strong>Compress</strong> + <strong>Write</strong></td><td>æ•ˆç‡ä¸ä¿çœŸåº¦çš„å¹³è¡¡</td></tr><tr><td>å­Agentå°è£…å¤æ‚æ€§</td><td><strong>Isolate</strong>ï¼ˆéš”ç¦»ï¼‰</td><td>ä¸Šä¸‹æ–‡ç©ºé—´éš”ç¦»ï¼Œä¸»Agentä¿æŒå¹²å‡€</td></tr></tbody></table>
<p><strong>å…³é”®æ´å¯Ÿ</strong>ï¼šä¿é™©æªæ–½æœ¬è´¨æ˜¯<strong>åœ¨Compressä¹‹å‰preemptivelyæ‰§è¡ŒWrite</strong>ï¼Œç¡®ä¿å…³é”®ä¿¡æ¯åœ¨å‹ç¼©å‘ç”Ÿå‰å·²å®‰å…¨æŒä¹…åŒ–ã€‚</p>
<hr/>
<h3 data-id="heading-13">ç»“è¯­ï¼šå·¥ç¨‹æ™ºæ…§çš„æœ¬è´¨</h3>
<p>Peak Jiçš„æ–¹æ³•è®ºæ­ç¤ºäº†AI Agentå·¥ç¨‹çš„æ ¸å¿ƒåŸåˆ™ï¼š</p>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-bullet">1.</span> æ‘˜è¦ä¸æ˜¯åˆ›ä½œï¼Œæ˜¯æŠ½å– â€”â€” ç”¨Schemaçº¦æŸç¡®ä¿ä¿çœŸåº¦
<span class="hljs-bullet">2.</span> å‹ç¼©æœ‰é£é™©ï¼Œä¸»åŠ¨å†™å…¥æ¥å¯¹å†² â€”â€” ç”¨æœºåˆ¶è®¾è®¡é˜²ä¸¢å¤±
<span class="hljs-bullet">3.</span> åœºæ™¯å†³å®šç­–ç•¥ â€”â€” æ²¡æœ‰é“¶å¼¹ï¼Œåªæœ‰æƒè¡¡
<span class="hljs-bullet">4.</span> å¤æ‚æ€§è¦å°è£… â€”â€” å­Agentéš”ç¦»ï¼Œä¸»Agentä¿æŒå¹²å‡€
<span class="hljs-bullet">5.</span> æ•ˆç‡ä¸å®‰å…¨çš„å¹³è¡¡ â€”â€” å³æ—¶æ€§ä»·å€¼é«˜æ—¶ï¼Œç”¨ä¿é™©æªæ–½å¯¹å†²é£é™©
</code></pre>
<p>è¿™äº›"å……æ»¡æƒè¡¡çš„å·¥ç¨‹æ™ºæ…§"ï¼Œæ­£æ˜¯ä»Demoèµ°å‘ç”Ÿäº§ç³»ç»Ÿçš„å…³é”®èƒ½åŠ›ã€‚</p>
<h3 data-id="heading-14">ç»“è¯­ï¼šçœŸæ­£çš„éš¾ç‚¹ä¸åœ¨æŠ€æœ¯ï¼Œè€Œåœ¨å–èˆ</h3>
<p>æ‘˜è¦ã€å‹ç¼©ã€å¤§å·¥å…·è¾“å‡ºï¼Œæœ¬èº«éƒ½ä¸å¤æ‚ã€‚ çœŸæ­£éš¾çš„æ˜¯ï¼š</p>
<blockquote>
<p><strong>åœ¨æ•ˆç‡ã€æˆæœ¬ã€ä¸Šä¸‹æ–‡å¹²å‡€åº¦ã€ä¿¡æ¯ä¿çœŸä¹‹é—´ï¼Œ åšæ¸…é†’ã€å¯è§£é‡Šã€å¯å¤ç›˜çš„å·¥ç¨‹é€‰æ‹©ã€‚</strong></p>
</blockquote>
<p>Manus çš„ç»éªŒç»™äº†æˆ‘ä»¬å‡ ä¸ªæå…¶é‡è¦çš„åŸåˆ™ï¼š</p>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-bullet">1.</span> æ‘˜è¦ä¸æ˜¯åˆ›ä½œï¼Œæ˜¯æŠ½å– â€”â€” ç”¨Schemaçº¦æŸç¡®ä¿ä¿çœŸåº¦
<span class="hljs-bullet">2.</span> å‹ç¼©æœ‰é£é™©ï¼Œä¸»åŠ¨å†™å…¥æ¥å¯¹å†² â€”â€” ç”¨æœºåˆ¶è®¾è®¡é˜²ä¸¢å¤±
<span class="hljs-bullet">3.</span> åœºæ™¯å†³å®šç­–ç•¥ â€”â€” æ²¡æœ‰é“¶å¼¹ï¼Œåªæœ‰æƒè¡¡
<span class="hljs-bullet">4.</span> å¤æ‚æ€§è¦å°è£… â€”â€” å­Agentéš”ç¦»ï¼Œä¸»Agentä¿æŒå¹²å‡€
<span class="hljs-bullet">5.</span> æ•ˆç‡ä¸å®‰å…¨çš„å¹³è¡¡ â€”â€” å³æ—¶æ€§ä»·å€¼é«˜æ—¶ï¼Œç”¨ä¿é™©æªæ–½å¯¹å†²é£é™©
</code></pre>
<p>å½“ Agent ä» Demo èµ°å‘ç”Ÿäº§ç³»ç»Ÿï¼Œ <strong>Context Engineering æœ¬èº«ï¼Œå°±æˆäº†ä¸€é—¨æ¶æ„è®¾è®¡å­¦ã€‚</strong></p>
<hr/>
<h3 data-id="heading-15">å‚è€ƒèµ„æº</h3>
<ol>
<li>ManusæŠ€æœ¯åˆ†äº«ï¼ˆPeak Jiï¼‰ï¼šæ‘˜è¦ã€å‹ç¼©ä¸å¤„ç†å¤§å·¥å…·è¾“å‡ºçš„æŠ€å·§</li>
<li>LangChain Context Engineering Best Practices</li>
<li>ã€Šä¸Šä¸‹æ–‡å·¥ç¨‹ï¼šæ„å»ºé«˜æ€§èƒ½AI Agentçš„ç³»ç»Ÿæ€§æ¶æ„è®¾è®¡ã€‹</li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[è¯¦è§£YOLOv8ç½‘ç»œç»“æ„]]></title>    <link>https://juejin.cn/post/7603651011979608106</link>    <guid>https://juejin.cn/post/7603651011979608106</guid>    <pubDate>2026-02-08T07:32:33.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7603651011979608106" data-draft-id="7602191709389193258" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="è¯¦è§£YOLOv8ç½‘ç»œç»“æ„"/> <meta itemprop="keywords" content="äººå·¥æ™ºèƒ½,æ·±åº¦å­¦ä¹ "/> <meta itemprop="datePublished" content="2026-02-08T07:32:33.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="èœ—ç‰›ä¸ä¼šç®—æ³•"/> <meta itemprop="url" content="https://juejin.cn/user/3083493743796632"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            è¯¦è§£YOLOv8ç½‘ç»œç»“æ„
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3083493743796632/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    èœ—ç‰›ä¸ä¼šç®—æ³•
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-08T07:32:33.000Z" title="Sun Feb 08 2026 07:32:33 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»21åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/86ce9878f5c247f4bc8163c8a87a77ed~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6JyX54mb5LiN5Lya566X5rOV:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771141219&amp;x-signature=HCoxuCzzK%2FD%2FUF%2BRq3S51ep5M1Q%3D" alt="image.png" loading="lazy"/></p>
<blockquote>
<ol>
<li><strong>Backbone</strong>ï¼šä½¿ç”¨çš„ä¾æ—§æ˜¯CSPçš„æ€æƒ³ï¼Œä¸è¿‡YOLOv5ä¸­çš„C3æ¨¡å—è¢«æ›¿æ¢æˆäº†C2fæ¨¡å—ï¼Œå®ç°äº†è¿›ä¸€æ­¥çš„è½»é‡åŒ–ï¼ŒåŒæ—¶YOLOv8ä¾æ—§ä½¿ç”¨äº†YOLOv5ç­‰æ¶æ„ä¸­ä½¿ç”¨çš„<a href="https://link.juejin.cn?target=https%3A%2F%2Fzhida.zhihu.com%2Fsearch%3Fcontent_id%3D221063610%26content_type%3DArticle%26match_order%3D1%26q%3DSPPF%25E6%25A8%25A1%25E5%259D%2597%26zd_token%3DeyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJ6aGlkYV9zZXJ2ZXIiLCJleHAiOjE3NzA2MTY0NjUsInEiOiJTUFBG5qih5Z2XIiwiemhpZGFfc291cmNlIjoiZW50aXR5IiwiY29udGVudF9pZCI6MjIxMDYzNjEwLCJjb250ZW50X3R5cGUiOiJBcnRpY2xlIiwibWF0Y2hfb3JkZXIiOjEsInpkX3Rva2VuIjpudWxsfQ.zFfae3dHjEp7samMmwOwMc2fHznovNFMBwoxRHm2r_Q%26zhida_source%3Dentity" target="_blank" title="https://zhida.zhihu.com/search?content_id=221063610&amp;content_type=Article&amp;match_order=1&amp;q=SPPF%E6%A8%A1%E5%9D%97&amp;zd_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJ6aGlkYV9zZXJ2ZXIiLCJleHAiOjE3NzA2MTY0NjUsInEiOiJTUFBG5qih5Z2XIiwiemhpZGFfc291cmNlIjoiZW50aXR5IiwiY29udGVudF9pZCI6MjIxMDYzNjEwLCJjb250ZW50X3R5cGUiOiJBcnRpY2xlIiwibWF0Y2hfb3JkZXIiOjEsInpkX3Rva2VuIjpudWxsfQ.zFfae3dHjEp7samMmwOwMc2fHznovNFMBwoxRHm2r_Q&amp;zhida_source=entity" ref="nofollow noopener noreferrer">SPPFæ¨¡å—</a>ï¼›</li>
<li><strong>PAN-FPN</strong>ï¼šæ¯«æ— ç–‘é—®YOLOv8ä¾æ—§ä½¿ç”¨äº†PANçš„æ€æƒ³ï¼Œä¸è¿‡é€šè¿‡å¯¹æ¯”YOLOv5ä¸YOLOv8çš„ç»“æ„å›¾å¯ä»¥çœ‹åˆ°ï¼ŒYOLOv8å°†YOLOv5ä¸­PAN-FPNä¸Šé‡‡æ ·é˜¶æ®µä¸­çš„å·ç§¯ç»“æ„åˆ é™¤äº†ï¼ŒåŒæ—¶ä¹Ÿå°†C3æ¨¡å—æ›¿æ¢ä¸ºäº†C2fæ¨¡å—ï¼›</li>
<li><strong><a href="https://link.juejin.cn?target=https%3A%2F%2Fzhida.zhihu.com%2Fsearch%3Fcontent_id%3D221063610%26content_type%3DArticle%26match_order%3D1%26q%3DDecoupled-Head%26zd_token%3DeyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJ6aGlkYV9zZXJ2ZXIiLCJleHAiOjE3NzA2MTY0NjUsInEiOiJEZWNvdXBsZWQtSGVhZCIsInpoaWRhX3NvdXJjZSI6ImVudGl0eSIsImNvbnRlbnRfaWQiOjIyMTA2MzYxMCwiY29udGVudF90eXBlIjoiQXJ0aWNsZSIsIm1hdGNoX29yZGVyIjoxLCJ6ZF90b2tlbiI6bnVsbH0.bJaifDp-vtIsz55d5iRqm9OPpNpfdcGy3MXkAmbCswc%26zhida_source%3Dentity" target="_blank" title="https://zhida.zhihu.com/search?content_id=221063610&amp;content_type=Article&amp;match_order=1&amp;q=Decoupled-Head&amp;zd_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJ6aGlkYV9zZXJ2ZXIiLCJleHAiOjE3NzA2MTY0NjUsInEiOiJEZWNvdXBsZWQtSGVhZCIsInpoaWRhX3NvdXJjZSI6ImVudGl0eSIsImNvbnRlbnRfaWQiOjIyMTA2MzYxMCwiY29udGVudF90eXBlIjoiQXJ0aWNsZSIsIm1hdGNoX29yZGVyIjoxLCJ6ZF90b2tlbiI6bnVsbH0.bJaifDp-vtIsz55d5iRqm9OPpNpfdcGy3MXkAmbCswc&amp;zhida_source=entity" ref="nofollow noopener noreferrer">Decoupled-Head</a></strong>ï¼šæ˜¯ä¸æ˜¯å—…åˆ°äº†ä¸ä¸€æ ·çš„å‘³é“ï¼Ÿæ˜¯çš„ï¼ŒYOLOv8èµ°å‘äº†Decoupled-Headï¼›</li>
<li><strong>Anchor-Free</strong>ï¼šYOLOv8æŠ›å¼ƒäº†ä»¥å¾€çš„Anchor-Baseï¼Œä½¿ç”¨äº†<strong>Anchor-Free</strong>çš„æ€æƒ³ï¼›</li>
<li><strong>æŸå¤±å‡½æ•°</strong>ï¼šYOLOv8ä½¿ç”¨<a href="https://link.juejin.cn?target=https%3A%2F%2Fzhida.zhihu.com%2Fsearch%3Fcontent_id%3D221063610%26content_type%3DArticle%26match_order%3D1%26q%3DVFL%2BLoss%26zd_token%3DeyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJ6aGlkYV9zZXJ2ZXIiLCJleHAiOjE3NzA2MTY0NjUsInEiOiJWRkwgTG9zcyIsInpoaWRhX3NvdXJjZSI6ImVudGl0eSIsImNvbnRlbnRfaWQiOjIyMTA2MzYxMCwiY29udGVudF90eXBlIjoiQXJ0aWNsZSIsIm1hdGNoX29yZGVyIjoxLCJ6ZF90b2tlbiI6bnVsbH0.rAPx8zzDoFP6DZBYUgogPY4PM81JBTjExrC-6fnsfOQ%26zhida_source%3Dentity" target="_blank" title="https://zhida.zhihu.com/search?content_id=221063610&amp;content_type=Article&amp;match_order=1&amp;q=VFL+Loss&amp;zd_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJ6aGlkYV9zZXJ2ZXIiLCJleHAiOjE3NzA2MTY0NjUsInEiOiJWRkwgTG9zcyIsInpoaWRhX3NvdXJjZSI6ImVudGl0eSIsImNvbnRlbnRfaWQiOjIyMTA2MzYxMCwiY29udGVudF90eXBlIjoiQXJ0aWNsZSIsIm1hdGNoX29yZGVyIjoxLCJ6ZF90b2tlbiI6bnVsbH0.rAPx8zzDoFP6DZBYUgogPY4PM81JBTjExrC-6fnsfOQ&amp;zhida_source=entity" ref="nofollow noopener noreferrer">VFL Loss</a>ä½œä¸ºåˆ†ç±»æŸå¤±ï¼Œä½¿ç”¨<a href="https://link.juejin.cn?target=https%3A%2F%2Fzhida.zhihu.com%2Fsearch%3Fcontent_id%3D221063610%26content_type%3DArticle%26match_order%3D1%26q%3DDFL%2BLoss%26zd_token%3DeyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJ6aGlkYV9zZXJ2ZXIiLCJleHAiOjE3NzA2MTY0NjUsInEiOiJERkwgTG9zcyIsInpoaWRhX3NvdXJjZSI6ImVudGl0eSIsImNvbnRlbnRfaWQiOjIyMTA2MzYxMCwiY29udGVudF90eXBlIjoiQXJ0aWNsZSIsIm1hdGNoX29yZGVyIjoxLCJ6ZF90b2tlbiI6bnVsbH0.U9YqCvPhM9EnSbK6EV5H02-pz_fF72zWNynAvHactF8%26zhida_source%3Dentity" target="_blank" title="https://zhida.zhihu.com/search?content_id=221063610&amp;content_type=Article&amp;match_order=1&amp;q=DFL+Loss&amp;zd_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJ6aGlkYV9zZXJ2ZXIiLCJleHAiOjE3NzA2MTY0NjUsInEiOiJERkwgTG9zcyIsInpoaWRhX3NvdXJjZSI6ImVudGl0eSIsImNvbnRlbnRfaWQiOjIyMTA2MzYxMCwiY29udGVudF90eXBlIjoiQXJ0aWNsZSIsIm1hdGNoX29yZGVyIjoxLCJ6ZF90b2tlbiI6bnVsbH0.U9YqCvPhM9EnSbK6EV5H02-pz_fF72zWNynAvHactF8&amp;zhida_source=entity" ref="nofollow noopener noreferrer">DFL Loss</a>+CIOU Lossä½œä¸ºåˆ†ç±»æŸå¤±ï¼›</li>
<li><strong>æ ·æœ¬åŒ¹é…</strong>ï¼šYOLOv8æŠ›å¼ƒäº†ä»¥å¾€çš„IOUåŒ¹é…æˆ–è€…å•è¾¹æ¯”ä¾‹çš„åˆ†é…æ–¹å¼ï¼Œè€Œæ˜¯ä½¿ç”¨äº†<a href="https://link.juejin.cn?target=https%3A%2F%2Fzhida.zhihu.com%2Fsearch%3Fcontent_id%3D221063610%26content_type%3DArticle%26match_order%3D1%26q%3DTask-Aligned%2BAssigner%26zd_token%3DeyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJ6aGlkYV9zZXJ2ZXIiLCJleHAiOjE3NzA2MTY0NjUsInEiOiJUYXNrLUFsaWduZWQgQXNzaWduZXIiLCJ6aGlkYV9zb3VyY2UiOiJlbnRpdHkiLCJjb250ZW50X2lkIjoyMjEwNjM2MTAsImNvbnRlbnRfdHlwZSI6IkFydGljbGUiLCJtYXRjaF9vcmRlciI6MSwiemRfdG9rZW4iOm51bGx9.j0ZGjWM-Zy_SUOnG0RFlonZgzjp7sv5sMb95CU7VmKw%26zhida_source%3Dentity" target="_blank" title="https://zhida.zhihu.com/search?content_id=221063610&amp;content_type=Article&amp;match_order=1&amp;q=Task-Aligned+Assigner&amp;zd_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJ6aGlkYV9zZXJ2ZXIiLCJleHAiOjE3NzA2MTY0NjUsInEiOiJUYXNrLUFsaWduZWQgQXNzaWduZXIiLCJ6aGlkYV9zb3VyY2UiOiJlbnRpdHkiLCJjb250ZW50X2lkIjoyMjEwNjM2MTAsImNvbnRlbnRfdHlwZSI6IkFydGljbGUiLCJtYXRjaF9vcmRlciI6MSwiemRfdG9rZW4iOm51bGx9.j0ZGjWM-Zy_SUOnG0RFlonZgzjp7sv5sMb95CU7VmKw&amp;zhida_source=entity" ref="nofollow noopener noreferrer">Task-Aligned Assigner</a>åŒ¹é…æ–¹å¼ã€‚</li>
</ol>
</blockquote>
<p>YOLOv8ç½‘ç»œä½¿ç”¨çš„æ¨¡å—ï¼š</p>
<ol>
<li>å·ç§¯æ¨¡å—ï¼šConv + BatchNorm + SiLU</li>
<li>ç“¶é¢ˆæ¨¡å—ï¼šå‡å°‘è®¡ç®—å¤æ‚åº¦å’Œå‚æ•°æ•°é‡ï¼ŒåŒæ—¶ä¿ç•™æ¨¡å‹æ€§èƒ½</li>
<li>C2fæ¨¡å—ï¼šé«˜æ•ˆå¤šåˆ†æ”¯å¤šç‰¹å¾æå–</li>
<li>ç©ºé—´é‡‘å­—å¡”å¿«é€Ÿï¼ˆSPPFï¼‰æ¨¡å—ï¼šæ•æ‰å¤šå°ºåº¦ä¿¡æ¯</li>
<li>æ£€æµ‹æ¨¡å—ï¼šè¾¹ç•Œæ¡†æ£€æµ‹å’Œç±»åˆ«æ£€æµ‹</li>
</ol>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6ec2cffbacbb404eb91ea9213bed075b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6JyX54mb5LiN5Lya566X5rOV:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771141219&amp;x-signature=n3h%2B30my85YfW8xWO7NNOdrESgs%3D" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-0">1. Backboneï¼šC2f é«˜æ•ˆç‰¹å¾æå–æ¨¡å— ï¼ˆæ ¸å¿ƒåˆ›æ–°ï¼‰</h2>
<p><strong><code>Backboneè´Ÿè´£ç‰¹å¾æå–</code></strong>ã€‚C2fæ¨¡å—æ˜¯YOLOv8 Backboneçš„æ ¸å¿ƒï¼Œå®ƒå–ä»£äº†YOLOv5ä¸­çš„C3æ¨¡å—ï¼Œ<strong>åœ¨è½»é‡åŒ–å’Œæ¢¯åº¦æµæ–¹é¢è¡¨ç°æ›´ä¼˜</strong>ã€‚</p>
<h3 data-id="heading-1">1.1 C2fæ¨¡å—ç»“æ„</h3>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/643d449afba84286a4c549010001a860~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6JyX54mb5LiN5Lya566X5rOV:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771141219&amp;x-signature=%2Fl5VVBz5AkWam13dfLOwvxFf86g%3D" alt="image.png" loading="lazy"/></p>
<blockquote>
<p>C2f æ˜¯ YOLOv8 ç³»åˆ—ï¼ˆä»¥åŠåç»­ä¸€äº› YOLO å˜ä½“ï¼‰ä¸­å¼•å…¥çš„ä¸€ç§<strong>é«˜æ•ˆç‰¹å¾æå–</strong>æ¨¡å—ï¼Œåå­—å¸¸è¢«è§£é‡Šä¸º â€œC2-fusionâ€ æˆ– â€œC2 with better gradient Flowâ€ã€‚å®ƒå±äº CSPï¼ˆCross Stage Partialï¼Œ<strong>è·¨é˜¶æ®µéƒ¨åˆ†æ®‹å·®è¿æ¥</strong>ï¼‰å®¶æ—çš„æ”¹è‰¯ç‰ˆæœ¬ï¼Œç”¨æ¥å–ä»£ YOLOv5/YOLOv7 é£æ ¼çš„ C3 / BottleneckCSP æ¨¡å—ã€‚</p>
<p>é€šä¿—è¯´ï¼šC2f æ˜¯ä¸€ä¸ªâ€œ<strong>æŠŠè¾“å…¥ç‰¹å¾æ‹†å¤šè·¯ã€ä¾æ¬¡åŠ å·¥ã€å†æŠŠæ‰€æœ‰ä¸­é—´ç‰¹å¾æ‹¼å›æ¥ç„¶åå‹ç¼©èåˆ</strong>â€çš„ç»“æ„ã€‚å®ƒçš„ç›®æ ‡æ˜¯ï¼š</p>
<ol>
<li>å¼ºåŒ–æ¢¯åº¦æµï¼ˆgradient flowï¼‰ï¼Œè·³è·ƒè¿æ¥ï¼Œç¼“è§£æ¢¯åº¦æ¶ˆå¤±é—®é¢˜ï¼Œå¸®åŠ©è®­ç»ƒæ›´æ·±çš„ç½‘ç»œï¼›</li>
<li>æé«˜ç‰¹å¾å¤šæ ·æ€§ï¼ˆå¤šåˆ†æ”¯ã€å¤šé˜¶æ®µç‰¹å¾åŒæ—¶ä¿ç•™ï¼‰ï¼›</li>
<li>é™ä½å‚æ•°é‡å’Œè®¡ç®—é‡ï¼ˆFLOPsï¼‰ï¼Œå°¤å…¶åœ¨ä¸­å°æ¨¡å‹é‡Œï¼›</li>
<li>ä¿æŒå¯¼å‡ºå‹å¥½ï¼ˆONNX/TensorRTï¼‰ï¼Œé€‚åˆå·¥ä¸šéƒ¨ç½²ã€‚</li>
</ol>
<p>C2f æœ€å¸¸å‡ºç°çš„ä½ç½®æ˜¯ YOLOv8 çš„ Backboneï¼ˆä¸»å¹²ï¼‰å’Œ Neckï¼ˆç‰¹å¾èåˆé¢ˆéƒ¨ï¼‰ä¸­çš„ä¸»å †å å•å…ƒã€‚å¯ä»¥æŠŠå®ƒå½“æˆ YOLOv8 çš„â€œä¸»åŠ›ç§¯æœ¨å—â€ã€‚</p>
<p><strong>CBSï¼šC = Convï¼ŒB = BatchNormï¼ŒS = SiLU</strong>ã€‚ä¹Ÿå°±æ˜¯ï¼šå·ç§¯å±‚ (Conv) â†’ æ‰¹å½’ä¸€åŒ– (Batch Normalization) â†’ SiLU æ¿€æ´»å‡½æ•°</p>
</blockquote>
<p><strong>ä¸ºä»€ä¹ˆéè¦Splitï¼Ÿ</strong></p>
<ol>
<li><strong>å‚æ•°å…±äº«</strong>ï¼šä¸¤ä¸ªåˆ†æ”¯å…±äº«åº•å±‚ç‰¹å¾æå–</li>
<li><strong>ç‰¹å¾ä¸€è‡´æ€§</strong>ï¼šæ¥è‡ªåŒä¸€å·ç§¯ï¼Œç‰¹å¾åˆ†å¸ƒç›¸ä¼¼</li>
<li><strong>æ¢¯åº¦ç»Ÿä¸€</strong>ï¼šåå‘ä¼ æ’­æ—¶æ¢¯åº¦æ¥æºä¸€è‡´</li>
</ol>
<p><strong>ç»“æ„ç»†èŠ‚ï¼š</strong></p>
<pre><code class="hljs language-js" lang="js">è¾“å…¥ â†’ å·ç§¯ â†’ åˆ†å‰²ä¸ºä¸¤éƒ¨åˆ†ï¼š
  åˆ†æ”¯<span class="hljs-number">1</span>: ç›´æ¥ä¼ é€’ï¼ˆæ·å¾„è¿æ¥ï¼‰
  åˆ†æ”¯<span class="hljs-number">2</span>: é€šè¿‡ n ä¸ª <span class="hljs-title class_">Bottleneck</span> å †å 
     æ¯ä¸ª<span class="hljs-title class_">Bottleneck</span>ç»“æ„ï¼š
       è¾“å…¥ â†’ <span class="hljs-title class_">Conv1</span>x1(é™ç»´) â†’ <span class="hljs-title class_">Conv3</span>x3(ç‰¹å¾æå–) â†’ <span class="hljs-title class_">Add</span>(æ®‹å·®è¿æ¥)
  èåˆï¼šåˆ†æ”¯<span class="hljs-number">1</span> + åˆ†æ”¯<span class="hljs-number">2</span> â†’ å·ç§¯è¾“å‡º
</code></pre>
<h3 data-id="heading-2">1.2 C2få†…éƒ¨åŸç†</h3>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6d399f5ba1d548d6be760c9cfcfabefe~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6JyX54mb5LiN5Lya566X5rOV:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771141219&amp;x-signature=uKykckfUAkzUUddFnzO7JIi52QM%3D" alt="65b824e6-8561-48d9-be1b-625df4360fec.png" loading="lazy"/></p>
<p>è¿™ä¸ªæ”¶é›†ä¸­é—´å±‚è¾“å‡ºå†ç»Ÿä¸€èåˆçš„æ€æƒ³ï¼Œç±»ä¼¼äº ELAN / E-ELAN å®¶æ—ï¼ˆYOLOv7Â é‡Œæå‡ºçš„é«˜æ•ˆå±‚èšåˆæ€æƒ³ï¼‰ï¼Œä¹Ÿç±»ä¼¼ DenseNet çš„â€œå¯†é›†è¿æ¥â€ç²¾ç¥ï¼š<strong>ä¿ç•™æ¯ä¸ªé˜¶æ®µçš„ä¸­é—´ç‰¹å¾ï¼Œè€Œä¸æ˜¯åªæ‹¿æœ€åä¸€å±‚</strong>ã€‚</p>
<h3 data-id="heading-3">1.3 C2fè®¾è®¡ä¼˜åŠ¿</h3>
<h4 data-id="heading-4">1.3.1 æ¢¯åº¦æµåŠ¨ï¼ˆGradientÂ Flowï¼‰</h4>
<p>å¤šåˆ†æ”¯ç»“æ„ä¿ƒè¿›æ¢¯åº¦åå‘ä¼ æ’­ï¼Œç¼“è§£æ¢¯åº¦æ¶ˆå¤±</p>
<blockquote>
<p>æ·±å±‚ç½‘ç»œè®­ç»ƒæ—¶ï¼Œ<strong>è¶Šåé¢çš„å±‚è¶Šéš¾æŠŠæ¢¯åº¦æœ‰æ•ˆåœ°ä¼ å›å‰é¢</strong>ã€‚å¦‚æœæ‰€æœ‰ä¸­é—´ç‰¹å¾éƒ½åœ¨æœ€ç»ˆ concat é‡Œå‡ºç°ï¼Œé‚£ä¹ˆ<strong>æ—©æœŸçš„å°æ®‹å·®å— (Yâ‚€, Yâ‚, â€¦) å¯¹æœ€ç»ˆè¾“å‡ºæœ‰â€œç›´æ¥è¯è¯­æƒâ€</strong>ï¼Œå®ƒä»¬çš„æ¢¯åº¦ä¼šç›´æ¥å›ä¼ ï¼Œè€Œä¸ä¼šè¢«é•¿é“¾æ¡ç¨€é‡Šã€‚</p>
<p>è¿™å°±åƒåœ¨å¾ˆé•¿çš„ä¼ è¯é“¾ä¸Šï¼Œæ¯ä¸ªäººéƒ½èƒ½ç›´æ¥å¯¹è€æ¿è¯´è¯ï¼Œè€Œä¸æ˜¯åªèƒ½æ‚„æ‚„è·Ÿä¸‹ä¸€ä¸ªäººè¯´ï¼ŒæŒ‡æœ›æ¶ˆæ¯èƒ½ä¸€è·¯ä¼ åˆ°è€æ¿è€³æœµé‡Œã€‚
ç›¸æ¯”ä¹‹ä¸‹ï¼Œä¼ ç»Ÿçš„å±‚-æ¥-å±‚-æ¥-å±‚ç»“æ„ï¼Œæœ€å‰é¢å‡ å±‚ç¦»æœ€ç»ˆè¾“å‡ºå¾ˆè¿œï¼Œæ¢¯åº¦å¯èƒ½åœ¨ä¸­é€”è¡°å‡ã€‚</p>
</blockquote>
<h4 data-id="heading-5">1.3.2 ç‰¹å¾å¤šæ ·æ€§ï¼ˆMulti-scale / Multi-stage Featuresï¼‰</h4>
<blockquote>
<p>Concat([X_b, Yâ‚€, Yâ‚, â€¦]) ç›¸å½“äºæŠŠä¸åŒâ€œ<strong>æ·±åº¦çº§åˆ«</strong>â€<strong>çš„è¡¨è¾¾å¹¶åˆ—æ”¾åœ¨ä¸€èµ·</strong>ï¼š</p>
<p>Yâ‚€ å¯èƒ½æ›´åå±€éƒ¨/ä½çº§çº¹ç†ï¼›
Yâ‚…ï¼ˆæ¯”å¦‚æŸä¸ªåå±‚ï¼‰å¯èƒ½æ›´åé«˜è¯­ä¹‰/æŠ½è±¡æ¦‚å¿µï¼›
X_b æ˜¯å‡ ä¹æœªç ´åçš„åŸå§‹ä¿¡æ¯é€šé“ï¼Œä¿å­˜ç»†èŠ‚ã€‚
æ¨¡å‹åç»­å°±å¯ä»¥è‡ªç”±åœ¨è¿™äº›â€œè€ç…§ç‰‡+æ–°ç…§ç‰‡â€çš„å †å é‡ŒæŒ‘å®ƒæƒ³è¦çš„ç‰¹å¾ï¼Œè€Œä¸æ˜¯è¢«è¿«åªä¾èµ–â€œæœ€æ–°é‚£å¼ ç…§ç‰‡â€ã€‚</p>
<p>è¿™è·Ÿ DenseNet çš„æ€è·¯å¾ˆåƒï¼šæŠŠä¸åŒæ·±åº¦çš„ç‰¹å¾ä¸€èµ·å½“èµ„æºæ± ã€‚</p>
</blockquote>
<h4 data-id="heading-6">1.3.3 è®¡ç®—æ•ˆç‡ï¼ˆParameter / FLOPs Efficiencyï¼‰</h4>
<blockquote>
<p>C2f åˆ©ç”¨çš„æ˜¯ï¼š</p>
<ul>
<li>å°ç“¶é¢ˆå—ï¼ˆBottleneckï¼‰é‡å¤å †å ï¼Œè€Œä¸æ˜¯æ¯ä¸€å±‚éƒ½ç”¨å¤§èƒ–å·ç§¯ï¼›</li>
<li>1Ã—1 å·ç§¯å…ˆé™ç»´ã€åèåˆï¼Œå‡å°‘å¤§é€šé“æ•°ä¸‹çš„ 3Ã—3 å·ç§¯å¼€é”€ï¼›</li>
<li>é€šé“åˆ†æµ + éƒ¨åˆ†æ®‹å·®ï¼Œä½¿å¾—ä¸æ˜¯æ‰€æœ‰åˆ†æ”¯éƒ½è¦å…¨ç®—ä¸€éé‡å‹æ“ä½œã€‚</li>
</ul>
<p>ç»“æœï¼šåœ¨åŒç­‰ã€ç”šè‡³æ›´é«˜çš„ç²¾åº¦ä¸‹ï¼ŒC2f å¾€å¾€èƒ½æ¯” YOLOv5 çš„ C3 æ¨¡å—æˆ– YOLOv4 çš„ CSPDarknet æ¨¡å—æ›´çœå‚æ•°ã€æ›´çœç®—åŠ›ï¼Œå°¤å…¶æ˜¯åœ¨å°ä¸­ç­‰æ¨¡å‹ï¼ˆn/s/m çº§åˆ«ï¼‰é‡Œæ€§ä»·æ¯”æ˜æ˜¾ã€‚</p>
</blockquote>
<h3 data-id="heading-7">1.4 ä¸ CSP / C3 / ELAN / C3k2 çš„å…³ç³»</h3>
<h4 data-id="heading-8">1.4.1  CSP / CSPDarknetï¼ˆYOLOv4ï¼‰</h4>
<p>Cross Stage Partialï¼ˆ<strong>è·¨é˜¶æ®µéƒ¨åˆ†æ®‹å·®</strong>ï¼‰æ€æƒ³ï¼šæŠŠç‰¹å¾åˆ†æˆä¸¤è·¯ï¼Œä¸€è·¯èµ°æ®‹å·®å †å ï¼Œå¦ä¸€è·¯ä¿æŒç›¸å¯¹åŸæ ·ï¼Œæœ€åå†åˆå¹¶ã€‚è¿™å¯å‡å°‘é‡å¤è®¡ç®—ï¼Œåˆä¿æŒæ¢¯åº¦æµåŠ¨ã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b41eb82b16394a70990e704f655325e0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6JyX54mb5LiN5Lya566X5rOV:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771141219&amp;x-signature=K%2F7F6A12YlV64djVFxa0oMvXMNc%3D" alt="image.png" loading="lazy"/>
å…¶ä¸­çš„ CBL æ¨¡å—å°±æ˜¯<code>Conv2D + BN + LeakyReLU</code> çš„ç»„åˆï¼Œè¿™é‡Œçš„ bottleneck å¯ä»¥æ ¹æ®ä¼ å…¥çš„å‚æ•°å†³å®šæ˜¯å¦å¸¦æœ‰ shortcutã€‚å¦‚æœæ˜¯å¸¦æœ‰ shortcut çš„è¯ï¼Œå°±æ˜¯æ­£ç»Ÿçš„ residual æ¨¡å—äº†ï¼Œå¦‚æœæ²¡æœ‰ shortcutï¼Œå°±æ˜¯å•çº¯çš„ 2 ä¸ª CBL ä¸²è”ã€‚</p>
<h4 data-id="heading-9">1.4.2 C3ï¼ˆYOLOv5ï¼‰</h4>
<p>åŸºäº CSP çš„ Bottleneck å †å ï¼›åœ¨ PyTorch åŒ–å®ç°é‡Œå« C3ï¼Œæ˜¯ YOLOv5 ä¸»å¹²/é¢ˆéƒ¨çš„åŸºæœ¬å—ã€‚å®ƒä¹Ÿä¼šåšé€šé“åˆ†æ”¯ï¼Œä½†ä¸­é—´ç‰¹å¾çš„ä¿ç•™/èšåˆæ–¹å¼ç›¸å¯¹å›ºå®šï¼Œèšåˆç‚¹æ›´å•ä¸€ã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bd31b621d150467daab9cdc6cf417b67~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6JyX54mb5LiN5Lya566X5rOV:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771141219&amp;x-signature=0AlTMzbpWMt2dzwHkoXvFvk3YFY%3D" alt="image.png" loading="lazy"/>
C3 æ¨¡å—å› ä¸ºå†…éƒ¨æœ‰ 3 ä¸ªå·ç§¯æ¨¡å—ï¼Œæ‰€ä»¥è¢«å‘½åä¸º C3 æ¨¡å—ï¼Œå»æ‰äº† BottleneckCSP ä¸­ä¸€äº›ç¹æ‚çš„ Conv2d æ“ä½œï¼Œå¹¶ä¸”å°†æ¿€æ´»å‡½æ•°ä» LeakyReLU æ¢æˆäº† SiLUã€‚ CBL æ¨¡å—ä¹Ÿå› æ­¤å˜æˆäº† CBS æ¨¡å—ã€‚CBS æ¨¡å—ï¼š<strong><code>Conv + BatchNorm + SiLU</code></strong>ã€‚å’Œ BottleneckCSP ä¸€æ ·ï¼Œå†…éƒ¨çš„ bottleneck ä¹Ÿåˆ†ä¸ºå¸¦ shortcut å’Œä¸å¸¦ shortcut ä¸¤ç§ã€‚</p>
<h4 data-id="heading-10">1.4.3 E-ELANï¼ˆYOLOv7ï¼‰</h4>
<p>Efficient Layer Aggregation Networks çš„æ‰©å±•ã€‚æ›´æ¿€è¿›åœ°æŠŠä¸­é—´å±‚è¾“å‡ºèšåˆåœ¨ä¸€èµ·ï¼Œå¼ºè°ƒâ€œ<strong><code>å¤šåˆ†æ”¯å¹¶è¡Œ + å¤šé˜¶æ®µç‰¹å¾æ˜¾å¼æ”¶é›†</code></strong>â€ã€‚E-ELAN è®©ç½‘ç»œåœ¨ä¸å¢åŠ å¾ˆå¤šå‚æ•°çš„æƒ…å†µä¸‹ï¼Œä»èƒ½æ‰©å¤§æœ‰æ•ˆæ·±åº¦å’Œè¡¨è¾¾åŠ›ï¼Œæ¨åŠ¨äº† YOLOv7 çš„ç²¾åº¦-é€Ÿåº¦å‰æ²¿ã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/264c399d363a4e2880525a6691470031~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6JyX54mb5LiN5Lya566X5rOV:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771141219&amp;x-signature=Wj87MDnG1cdIP7CSVMJrvOOhDpQ%3D" alt="e612f8c2-294e-4318-bc69-6274edf8d642.png" loading="lazy"/>
ä¸Šå›¾å¯çŸ¥æ¼”å˜è¿‡ç¨‹ï¼š<code>VoVNet--&gt;CSPVoVNet--&gt;ELAN--&gt;E-ELAN</code></p>
<ul>
<li>VoVNet é€šè¿‡å‡å°‘ DenseNet çš„è¿æ¥ä¸ªæ•°æå‡ç½‘ç»œæ•ˆç‡ï¼›</li>
<li>CSPNet é€šè¿‡ split æ“ä½œå¢åŠ æ¢¯åº¦ä¿¡æ¯ï¼Œå‡å°‘è®¡ç®—é‡ï¼›</li>
<li>ELAN åˆ™æ˜¯é€šè¿‡è€ƒè™‘æœ€çŸ­æ¢¯åº¦è·¯å¾„ä½¿å¾—å¯ä»¥å †å æ›´å¤š blockï¼›</li>
<li>E-ELANæ›´è¿›ä¸€æ­¥ä½¿ç”¨Â <code>expand, shuffle, merge cardinality</code>Â æ¥è¿›ä¸€æ­¥è®©ç½‘ç»œå †å æ›´å¤š blockã€‚</li>
</ul>
<h4 data-id="heading-11">1.4.4 C2fï¼ˆYOLOv8èµ·ï¼‰</h4>
<ul>
<li>å¯ä»¥ç†è§£æˆæŠŠ CSP çš„åˆ†æµå“²å­¦å’Œ ELAN çš„â€œ<strong><code>ä¸­é—´ç‰¹å¾æ˜¾å¼ä¿ç•™</code></strong>â€åˆä½“ï¼Œå½¢æˆä¸€ç§æ—¢è½»é‡åˆé«˜æ¢¯åº¦æµæ•ˆç‡çš„æ¨¡å—ã€‚</li>
<li>C2f æ›´åˆ©äº PyTorch/TensorRT å¯¼å‡ºï¼Œç»“æ„è§„åˆ™ã€é‡å¤æ€§é«˜ï¼Œæ˜“äºè‡ªåŠ¨æ‰©å±•æˆ n/s/m/l/x å¤šä¸ªæ¨¡å‹å°ºåº¦ã€‚</li>
</ul>
<h4 data-id="heading-12">1.4.5 C3k2 / C3kï¼ˆYOLOv11ç­‰åç»­æ¼”è¿›ï¼‰</h4>
<ul>
<li>
<p>Â <code>C3k(å¯å®šåˆ¶å·ç§¯æ ¸)</code>ï¼šC3kæ˜¯C3æ¨¡å—çš„ä¸€ä¸ªå˜ä½“ï¼Œä¸»è¦æ”¹è¿›åœ¨äºå®ƒå…è®¸<strong>è‡ªå®šä¹‰å·ç§¯æ ¸çš„å¤§å°</strong>ï¼ˆkernel size)ã€‚å¯ä»¥æ›´å¥½åœ°é€‚åº”ä¸åŒå°ºå¯¸çš„å›¾åƒç‰¹å¾ï¼Œå°¤å…¶æ˜¯å½“æˆ‘ä»¬éœ€è¦æ•æ‰æ›´å¤§èŒƒå›´çš„ä¸Šä¸‹æ–‡ä¿¡æ¯æ—¶ã€‚<strong>å½“kè®¾ç½®ä¸º3æ—¶å€™ï¼ŒC3kåœ¨åŠŸèƒ½ä¸Šä¸C3ç›¸ç­‰ã€‚</strong></p>
</li>
<li>
<p><code>C3k2</code>ç»“åˆäº†<code>C2f</code>çš„é€Ÿåº¦ä¼˜åŠ¿å’Œ<code>C3k</code>çš„çµæ´»æ€§ã€‚å®ƒå…è®¸åœ¨è¿è¡Œæ—¶é€‰æ‹©æ˜¯å¦ä½¿ç”¨<code>C3k</code>å±‚æ¥å¤„ç†ç‰¹å¾ï¼Œæä¾›äº†å¾ˆé«˜çš„å¯é…ç½®æ€§ã€‚</p>
</li>
<li>
<p>å½“<code>c3kå‚æ•°è®¾ç½®ä¸ºTrueæ—¶</code>ï¼ŒC3k2å°†ä½¿ç”¨c3kå±‚ï¼Œèƒ½å¤Ÿåˆ©ç”¨ä¸åŒå·ç§¯æ ¸å¤§å°çš„çµæ´»æ€§ï¼›å¦åˆ™ï¼Œå®ƒå°†ä½¿ç”¨æ ‡å‡†çš„ç“¶é¢ˆå±‚ï¼Œä¸c2fç±»<br/>
ä¼¼ã€‚</p>
</li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3756d293206d4738a8e3e425d47bc810~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6JyX54mb5LiN5Lya566X5rOV:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771141219&amp;x-signature=Npvseu5pRU0SXPXH4PtCUmJ4c6s%3D" alt="image.png" loading="lazy"/></p>
<p>ä»è¿™ä¸ªæ—è°±ä½ å¯ä»¥çœ‹å‡ºï¼š</p>
<ul>
<li>C2f åœ¨ YOLOv7ï¼ˆE-ELANï¼‰æ€è·¯å’Œ YOLOv5ï¼ˆC3/CSPï¼‰æ€è·¯ä¹‹é—´çš„æŠ˜ä¸­ï¼šå®ƒä¿ç•™â€œ<strong><code>æ˜¾å¼å¤šé˜¶æ®µç‰¹å¾èšåˆ + å¼ºæ¢¯åº¦æµ</code></strong>â€ï¼Œä½†åŠªåŠ›æŠŠå®ƒåšå¾—æ›´è§„æ•´ã€æ›´è½»ã€æ›´é€‚åˆè‡ªåŠ¨ç¼©æ”¾ã€‚</li>
</ul>
<h3 data-id="heading-13">1.5 C2få¯¹YOLOç½‘ç»œçš„ä¼˜åŠ¿</h3>
<blockquote>
<ol>
<li><strong>å°ç›®æ ‡ / ç»†èŠ‚ä¿ç•™</strong>ï¼š
ç›´é€šåˆ†æ”¯ï¼ˆX_bï¼‰ä¿ç•™äº†æ›´åŸå§‹ã€ç»†é¢—ç²’åº¦çš„ç©ºé—´ä¿¡æ¯ã€‚æ£€æµ‹å°ç›®æ ‡æ—¶ï¼Œè¿™ç§ç²¾ç»†çº¹ç†å¾ˆå…³é”®ã€‚</li>
<li><strong>é«˜å±‚è¯­ä¹‰ / å…³ç³»å»ºæ¨¡</strong>ï¼š
é€æ­¥å †å çš„æ®‹å·®å— (Yâ‚€â†’Yâ‚â†’â€¦â†’Yâ‚–) ä¼šé€æ¸æå–æ›´é«˜çº§åˆ«ã€æ›´åŠ æŠ½è±¡çš„è¯­ä¹‰ç‰¹å¾ã€‚è¿™å¯¹åˆ†ç±»å†³ç­–ï¼ˆâ€œè¿™ä¸ªæ¡†åˆ°åº•æ˜¯çŒ«è¿˜æ˜¯ç‹—â€ï¼‰éå¸¸é‡è¦ã€‚</li>
<li><strong>ç¨³å®šè®­ç»ƒ</strong>ï¼š
å¤šé˜¶æ®µç‰¹å¾å…¨éƒ¨ç›´æ¥å‚ä¸æœ€åçš„ concatï¼Œæ„å‘³ç€æ¢¯åº¦èƒ½ä»è¾“å‡ºç«¯ç›´æ¥åå‘æµå‘æ¯ä¸ªé˜¶æ®µã€‚è¿™åœ¨æ·±å±‚ä¸»å¹²é‡Œå¯ä»¥å‡å°‘æ¢¯åº¦æ¶ˆå¤±é—®é¢˜ï¼Œè®©å¤§æ¨¡å‹/æ·±æ¨¡å‹ä¹Ÿèƒ½åœ¨å¸¸è§„è®­ç»ƒè¶…å‚ä¸‹ç¨³ç¨³æ”¶æ•›ã€‚</li>
<li><strong>é«˜æ€§ä»·æ¯”</strong>ï¼š
é€šè¿‡ 1Ã—1 é™ç»´ + 3Ã—3 å±€éƒ¨å·ç§¯çš„è½»é‡ç“¶é¢ˆå †å ï¼ŒC2f ä¿æŒäº†è¾ƒä½çš„å‚æ•°é‡å’Œ FLOPsï¼Œä½†ä»èƒ½æä¾›å¤šå°ºåº¦è¡¨è¾¾ã€‚è¿™å¯¹äºè¦åœ¨ä¸­ä½ç®—åŠ›ï¼ˆJetsonã€å·¥ä¸šç›¸æœºç›’å­ï¼‰ä¸Šè·‘å®æ—¶æ£€æµ‹çš„ YOLOv8/YOLOv9/YOLOv11 å®¶æ—æ¥è¯´ï¼Œå°¤ä¸ºå…³é”®ã€‚</li>
<li><strong>ç»“æ„è§„æ•´ï¼Œæ˜“å¯¼å‡º</strong>ï¼š
C2f çš„å½¢çŠ¶æ˜¯è§„åˆ™çš„å·ç§¯+æ‹¼æ¥+å·ç§¯ï¼Œä¸éœ€è¦èŠ±å“¨çš„åŠ¨æ€å›¾ç®—å­ï¼Œéå¸¸å®¹æ˜“è¢« ONNXã€TensorRTã€OpenVINO ç­‰æ¨ç†æ¡†æ¶è§£æå’ŒåŠ é€Ÿï¼Œå®ç°å·¥ä¸šéƒ¨ç½²ã€‚</li>
</ol>
</blockquote>
<h3 data-id="heading-14">1.6 C2fæ€»ç»“</h3>
<blockquote>
<p>C2f æ˜¯ YOLOv8ï¼ˆä»¥åŠä¹‹åçš„ YOLO ç³»åˆ—ï¼‰é‡Œç”¨æ¥å–ä»£æ—§å¼ CSP/C3 æ¨¡å—çš„æ ¸å¿ƒç»“æ„å•å…ƒã€‚å®ƒæŠŠè¾“å…¥ç‰¹å¾æ‹†æˆå¤šè·¯ï¼Œä¸€è·¯ä¿æŒåŸå§‹/æµ…å±‚ç»†èŠ‚ï¼Œå¦ä¸€è·¯é€šè¿‡ä¸€ä¸²å°æ®‹å·®å—é€æ­¥æå–æ›´æ·±è¯­ä¹‰ï¼›ç„¶åæŠŠæ‰€æœ‰é˜¶æ®µçš„ä¸­é—´è¾“å‡ºé€šé€šæ‹¼æ¥ï¼Œå†ç”¨ä¸€ä¸ªå·ç§¯ç»Ÿä¸€èåˆã€‚<strong><code>åˆ†æµ+å †å +concat+èåˆ</code></strong></p>
</blockquote>
<h2 data-id="heading-15">2. Neckï¼šPAFPNï¼ˆPath Aggregation Feature Pyramid Networkï¼‰</h2>
<p>YOLOv8æ²¿ç”¨å¹¶ä¼˜åŒ–äº†PANetç»“æ„ï¼Œå®ç°<strong>å¤šå°ºåº¦ç‰¹å¾çš„æœ‰æ•ˆèåˆ</strong>ã€‚</p>
<p><strong><code>Neckéƒ¨åˆ†è´Ÿè´£å¤šå°ºåº¦ç‰¹å¾èåˆ</code></strong>ï¼Œé€šè¿‡å°†æ¥è‡ªBackboneä¸åŒé˜¶æ®µçš„ç‰¹å¾å›¾è¿›è¡Œèåˆï¼Œå¢å¼ºç‰¹å¾è¡¨ç¤ºèƒ½åŠ›ã€‚å…·ä½“æ¥è¯´ï¼ŒYOLOv8çš„Neckéƒ¨åˆ†åŒ…æ‹¬ä»¥ä¸‹ç»„ä»¶:</p>
<ul>
<li><strong>SPPFæ¨¡å—</strong>(Spatial Pyramid Pooling Fast)ï¼šç”¨äº<strong>ä¸åŒå°ºåº¦çš„æ± åŒ–æ“ä½œ</strong>ï¼Œå°†ä¸åŒå°ºåº¦çš„ç‰¹å¾å›¾æ‹¼æ¥åœ¨ä¸€èµ·ï¼Œæé«˜å¯¹ä¸åŒå°ºå¯¸ç›®æ ‡çš„æ£€æµ‹èƒ½åŠ›ã€‚</li>
<li><strong>PAAæ¨¡å—</strong>(Probabilistic Anchor Assignment)ï¼šç”¨äº<strong>æ™ºèƒ½åœ°åˆ†é…é”šæ¡†</strong>ï¼Œä»¥ä¼˜åŒ–æ­£è´Ÿæ ·æœ¬çš„é€‰æ‹©ï¼Œæé«˜æ¨¡å‹çš„è®­ç»ƒæ•ˆæœã€‚</li>
<li><strong>PANæ¨¡å—</strong>(Path Aggregation Network)ï¼šåŒ…æ‹¬ä¸¤ä¸ªPANæ¨¡å—ï¼Œç”¨äº<strong>ä¸åŒå±‚æ¬¡ç‰¹å¾çš„è·¯å¾„èšåˆ</strong>ï¼Œé€šè¿‡è‡ªåº•å‘ä¸Šå’Œè‡ªé¡¶å‘ä¸‹çš„è·¯å¾„å¢å¼ºç‰¹å¾å›¾çš„è¡¨è¾¾èƒ½åŠ›ã€‚</li>
</ul>
<p><strong>ç»“æ„æµç¨‹ï¼š</strong></p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-title class_">Backbone</span>è¾“å‡ºç‰¹å¾å›¾(<span class="hljs-variable constant_">P3</span>,<span class="hljs-variable constant_">P4</span>,<span class="hljs-variable constant_">P5</span>) â†’ 
ä¸Šé‡‡æ ·è·¯å¾„ï¼ˆè‡ªé¡¶å‘ä¸‹ï¼‰ï¼š
  <span class="hljs-variable constant_">P5</span> â†’ ä¸Šé‡‡æ · â†’ ä¸<span class="hljs-variable constant_">P4</span>èåˆ â†’ å·ç§¯ â†’ ä¸Šé‡‡æ · â†’ ä¸<span class="hljs-variable constant_">P3</span>èåˆ
ä¸‹é‡‡æ ·è·¯å¾„ï¼ˆè‡ªåº•å‘ä¸Šï¼‰ï¼š
  èåˆåçš„<span class="hljs-variable constant_">P3</span> â†’ ä¸‹é‡‡æ · â†’ ä¸<span class="hljs-variable constant_">P4</span>èåˆ â†’ ä¸‹é‡‡æ · â†’ ä¸<span class="hljs-variable constant_">P5</span>èåˆ
æœ€ç»ˆè¾“å‡ºä¸‰ä¸ªå°ºåº¦çš„ç‰¹å¾å›¾
</code></pre>
<h3 data-id="heading-16">2.1  SPPFæ¨¡å—ç»“æ„</h3>
<p><strong>SPPFæ¨¡å—(Spatial Pyramid Pooling Fast):</strong> ç”¨äºä¸åŒå°ºåº¦çš„æ± åŒ–æ“ä½œï¼Œå°†ä¸åŒå°ºåº¦çš„ç‰¹å¾å›¾æ‹¼æ¥åœ¨ä¸€èµ·ï¼Œæé«˜å¯¹ä¸åŒå°ºå¯¸ç›®æ ‡çš„æ£€æµ‹èƒ½åŠ›ã€‚
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a09a61856ebe464f9ee778d19afb859f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6JyX54mb5LiN5Lya566X5rOV:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771141219&amp;x-signature=u%2B6EQjcw9v6H5zfx8FpKiF0OK%2BQ%3D" alt="b1bc51b7-aeaa-43a4-8f42-32e40835f4c7.png" loading="lazy"/></p>
<h4 data-id="heading-17">2.1.1 SPPæ¨¡å—ç»“æ„</h4>
<p>SPPæ¨¡å—æ˜¯ä½•å‡¯æ˜å¤§ç¥åœ¨2015å¹´çš„è®ºæ–‡ ã€ŠSpatial Pyramid Pooling in Deep Convolutional Networks for VisualRecognitionã€‹ä¸­è¢«æå‡ºã€‚</p>
<p>SPPä¸ºç©ºé—´é‡‘å­—å¡”æ± åŒ–ç»“æ„ï¼Œä¸»è¦æ˜¯ä¸ºäº†è§£å†³ä¸¤ä¸ªé—®é¢˜:</p>
<ol>
<li>æœ‰æ•ˆé¿å…äº†å¯¹å›¾åƒåŒºåŸŸè£å‰ªã€ç¼©æ”¾æ“ä½œå¯¼è‡´çš„<strong>å›¾åƒå¤±çœŸ</strong>ç­‰é—®é¢˜;</li>
<li>è§£å†³äº†å·ç§¯ç¥ç»ç½‘ç»œå¯¹å›¾ç›¸å…³<strong>é‡å¤ç‰¹å¾æå–</strong>çš„é—®é¢˜ï¼Œå¤§å¤§æé«˜äº†äº§ç”Ÿå€™é€‰æ¡†çš„é€Ÿåº¦ï¼Œä¸”èŠ‚çœäº†è®¡ç®—æˆæœ¬ã€‚</li>
</ol>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fdfb218a283449609dc3ccc367466cc6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6JyX54mb5LiN5Lya566X5rOV:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771141219&amp;x-signature=q4zvhACwCS38mmQ9YyxMmLfCjvc%3D" alt="b7421555-253f-4845-9781-b997e365e982.png" loading="lazy"/></p>
<h4 data-id="heading-18">2.1.2 SPPFæ¨¡å—ç»“æ„</h4>
<p>è¿™ä¸ªæ˜¯YOLOv5 ä½œè€…Glenn Jocher åŸºäºSPPæå‡ºçš„ï¼Œé€Ÿåº¦è¾ƒSPPå¿«å¾ˆå¤šï¼Œæ‰€ä»¥å«SPP-Fastã€‚SPPFæ˜¯ç©ºé—´é‡‘å­—å¡”æ± åŒ–çš„å¿«é€Ÿç‰ˆæœ¬ï¼Œå®ƒæ˜¯ä¸€ç§åœ¨å·ç§¯ç¥ç»ç½‘ç»œä¸­ç”¨äº<strong>å¤„ç†ä¸åŒå°ºå¯¸è¾“å…¥</strong>çš„æŠ€æœ¯ã€‚SPPFçš„æ ¸å¿ƒæ€æƒ³æ˜¯é€šè¿‡<strong>å¯¹è¾“å…¥ç‰¹å¾å›¾è¿›è¡Œä¸åŒå°ºåº¦çš„æ± åŒ–æ“ä½œï¼Œç”Ÿæˆå›ºå®šé•¿åº¦çš„ç‰¹å¾å‘é‡</strong>ï¼Œä»è€Œä½¿å¾—ç½‘ç»œèƒ½å¤Ÿå¤„ç†ä»»æ„å°ºå¯¸çš„è¾“å…¥å›¾åƒã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2e4bdff9f03946429af278c59f40aafd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6JyX54mb5LiN5Lya566X5rOV:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771141219&amp;x-signature=tXT%2Bg4%2FCGcrsObeoZsZQ%2FGZjVyU%3D" alt="5f651cd5-0a25-42d3-bd96-6d40fc5d65c3.png" loading="lazy"/></p>
<h3 data-id="heading-19">2.2 PAN-FPNæ¨¡å—ç»“æ„</h3>
<p>YOLOv8 ä¸­å…¥äº† PAN-FPN (Path Aggregation Network - Feature Pyramid Network) ä¸ºå…¶ç‰¹å¾é‡‘å­—å¡”ç½‘ç»œï¼Œè¿›ä¸€æ­¥å¢å¼ºäº†å¤šå°ºåº¦ç‰¹å¾çš„è¡¨ç¤ºèƒ½åŠ›ã€‚<strong>PAN-FPN é€šè¿‡åŒå‘è·¯å¾„çš„èåˆï¼Œä½¿å¾—ç‰¹å¾å›¾åŒ…å«æ›´ä¸°å¯Œçš„ä¸Šä¸‹æ–‡ä¿¡æ¯å’Œè¯­ä¹‰ä¿¡æ¯ï¼Œå¢å¼ºäº†æ¨¡å‹å¯¹ä¸åŒå°ºåº¦ç›®æ ‡çš„æ£€æµ‹èƒ½åŠ›ã€‚</strong></p>
<p>ç›¸å¯¹äºYOLOv5æˆ–è€…YOLOv6ï¼ŒYOLOv8å°†C3æ¨¡å—ä»¥åŠRepBlockæ›¿æ¢ä¸ºäº†C2fï¼ŒåŒæ—¶ç»†å¿ƒå¯ä»¥å‘ç°ï¼Œç›¸å¯¹äºYOLOv5å’ŒYOLOv6ï¼ŒYOLOv8é€‰æ‹©å°†ä¸Šé‡‡æ ·ä¹‹å‰çš„1Ã—1å·ç§¯å»é™¤äº†ï¼Œå°†Backboneä¸åŒé˜¶æ®µè¾“å‡ºçš„ç‰¹å¾ç›´æ¥é€å…¥äº†ä¸Šé‡‡æ ·æ“ä½œã€‚</p>
<p><strong>YOLOv5çš„Neck</strong>éƒ¨åˆ†çš„ç»“æ„å›¾å¦‚ä¸‹ï¼š
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3284c93a0812493da205c25b6fb019fd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6JyX54mb5LiN5Lya566X5rOV:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771141219&amp;x-signature=WduVkhxkMSV%2BqbvqmAic5vrO8AY%3D" alt="image.png" loading="lazy"/></p>
<p>YOLOv6çš„Neckéƒ¨åˆ†çš„ç»“æ„å›¾å¦‚ä¸‹ï¼š</p>
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1b233a5dbd354cecbb89c24ed352a75f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6JyX54mb5LiN5Lya566X5rOV:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771141219&amp;x-signature=qQffFB3JvpBzit%2BSmB096r1OATk%3D" alt="image.png" width="100%" loading="lazy"/>
<p><strong>YOLOv8</strong>çš„ç»“æ„å›¾ï¼š</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/af574db2816349d09aec6ebed2fec1f9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6JyX54mb5LiN5Lya566X5rOV:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771141219&amp;x-signature=us7yT6aeXttmh8GU3s6XsNsmR1M%3D" alt="image.png" loading="lazy"/></p>
<p><strong>FPNç½‘ç»œpytorchä»£ç </strong></p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">FPN</span>(nn.Module):
 
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, num_blocks, num_classes, back_bone=<span class="hljs-string">'resnet'</span>, pretrained=<span class="hljs-literal">True</span></span>):
        <span class="hljs-built_in">super</span>(FPN, self).__init__()
        self.in_planes = <span class="hljs-number">64</span>
        self.num_classes = num_classes
 
        self.conv1 = nn.Conv2d(<span class="hljs-number">3</span>, <span class="hljs-number">64</span>, kernel_size=<span class="hljs-number">7</span>, stride=<span class="hljs-number">2</span>, padding=<span class="hljs-number">3</span>, bias=<span class="hljs-literal">False</span>)
        self.bn1 = nn.BatchNorm2d(<span class="hljs-number">64</span>)
 
        BatchNorm = nn.BatchNorm2d
        self.back_bone = build_backbone(back_bone)
 
        <span class="hljs-comment"># Bottom-up layers</span>
        self.layer1 = self._make_layer(Bottleneck,  <span class="hljs-number">64</span>, num_blocks[<span class="hljs-number">0</span>], stride=<span class="hljs-number">1</span>)
        self.layer2 = self._make_layer(Bottleneck, <span class="hljs-number">128</span>, num_blocks[<span class="hljs-number">1</span>], stride=<span class="hljs-number">2</span>)
        self.layer3 = self._make_layer(Bottleneck, <span class="hljs-number">256</span>, num_blocks[<span class="hljs-number">2</span>], stride=<span class="hljs-number">2</span>)
        self.layer4 = self._make_layer(Bottleneck, <span class="hljs-number">512</span>, num_blocks[<span class="hljs-number">3</span>], stride=<span class="hljs-number">2</span>)
 
        <span class="hljs-comment"># Top layer</span>
        self.toplayer = nn.Conv2d(<span class="hljs-number">2048</span>, <span class="hljs-number">256</span>, kernel_size=<span class="hljs-number">1</span>, stride=<span class="hljs-number">1</span>, padding=<span class="hljs-number">0</span>)  <span class="hljs-comment"># Reduce channels</span>
 
        <span class="hljs-comment"># Smooth layers</span>
        self.smooth1 = nn.Conv2d(<span class="hljs-number">256</span>, <span class="hljs-number">256</span>, kernel_size=<span class="hljs-number">3</span>, stride=<span class="hljs-number">1</span>, padding=<span class="hljs-number">1</span>)
        self.smooth2 = nn.Conv2d(<span class="hljs-number">256</span>, <span class="hljs-number">256</span>, kernel_size=<span class="hljs-number">3</span>, stride=<span class="hljs-number">1</span>, padding=<span class="hljs-number">1</span>)
        self.smooth3 = nn.Conv2d(<span class="hljs-number">256</span>, <span class="hljs-number">256</span>, kernel_size=<span class="hljs-number">3</span>, stride=<span class="hljs-number">1</span>, padding=<span class="hljs-number">1</span>)
 
        <span class="hljs-comment"># Lateral layers</span>
        self.latlayer1 = nn.Conv2d(<span class="hljs-number">1024</span>, <span class="hljs-number">256</span>, kernel_size=<span class="hljs-number">1</span>, stride=<span class="hljs-number">1</span>, padding=<span class="hljs-number">0</span>)
        self.latlayer2 = nn.Conv2d( <span class="hljs-number">512</span>, <span class="hljs-number">256</span>, kernel_size=<span class="hljs-number">1</span>, stride=<span class="hljs-number">1</span>, padding=<span class="hljs-number">0</span>)
        self.latlayer3 = nn.Conv2d( <span class="hljs-number">256</span>, <span class="hljs-number">256</span>, kernel_size=<span class="hljs-number">1</span>, stride=<span class="hljs-number">1</span>, padding=<span class="hljs-number">0</span>)
 
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">_upsample</span>(<span class="hljs-params">self, x, h, w</span>):    <span class="hljs-comment"># upsample use 'bilinear' interpolate</span>
        <span class="hljs-keyword">return</span> F.interpolate(x, size=(h, w), mode=<span class="hljs-string">'bilinear'</span>, align_corners=<span class="hljs-literal">True</span>)
 
 
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">_make_layer</span>(<span class="hljs-params">self, Bottleneck, planes, num_blocks, stride</span>):
        strides = [stride] + [<span class="hljs-number">1</span>]*(num_blocks-<span class="hljs-number">1</span>)
        layers = []
        <span class="hljs-keyword">for</span> stride <span class="hljs-keyword">in</span> strides:
            layers.append(Bottleneck(self.in_planes, planes, stride))
            self.in_planes = planes * Bottleneck.expansion
        <span class="hljs-keyword">return</span> nn.Sequential(*layers)
 
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">_upsample_add</span>(<span class="hljs-params">self, x, y</span>):
        <span class="hljs-string">'''Upsample and add two feature maps.
        Args:
          x: (Variable) top feature map to be upsampled.
          y: (Variable) lateral feature map.
        Returns:
          (Variable) added feature map.
        Note in PyTorch, when input size is odd, the upsampled feature map
        with `F.upsample(..., scale_factor=2, mode='nearest')`
        maybe not equal to the lateral feature map size.
        e.g.
        original input size: [N,_,15,15] -&gt;
        conv2d feature map size: [N,_,8,8] -&gt;
        upsampled feature map size: [N,_,16,16]
        So we choose bilinear upsample which supports arbitrary output sizes.
        '''</span>
        _,_,H,W = y.size()
        <span class="hljs-keyword">return</span> F.interpolate(x, size=(H,W), mode=<span class="hljs-string">'bilinear'</span>, align_corners=<span class="hljs-literal">True</span>) + y
 
 
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">forward</span>(<span class="hljs-params">self, x</span>):
        <span class="hljs-comment"># Bottom-up</span>
        c1 = F.relu(self.bn1(self.conv1(x)))
        c1 = F.max_pool2d(c1, kernel_size=<span class="hljs-number">3</span>, stride=<span class="hljs-number">2</span>, padding=<span class="hljs-number">1</span>)
        c2 = self.layer1(c1)
        c3 = self.layer2(c2)
        c4 = self.layer3(c3)
        c5 = self.layer4(c4)

        <span class="hljs-comment"># Top-down</span>
        p5 = self.toplayer(c5)
        p4 = self._upsample_add(p5, self.latlayer1(c4))
        p3 = self._upsample_add(p4, self.latlayer2(c3))
        p2 = self._upsample_add(p3, self.latlayer3(c2))
 
        <span class="hljs-comment"># Smooth</span>
        p4 = self.smooth1(p4)
        p3 = self.smooth2(p3)
        p2 = self.smooth3(p2)
 
        <span class="hljs-keyword">return</span> p2, p3, p4, p5

</code></pre>
<h4 data-id="heading-20">2.2.1 ç‰¹å¾é‡‘å­—å¡”ç½‘ç»œ(FPN)</h4>
<p><strong>è®ºæ–‡ï¼š</strong> <a href="https://link.juejin.cn?target=https%3A%2F%2Farxiv.org%2Fabs%2F1612.03144" target="_blank" title="https://arxiv.org/abs/1612.03144" ref="nofollow noopener noreferrer">[1612.03144] Feature Pyramid Networks for Object Detection</a></p>
<p>FPN é€šè¿‡ç»“åˆ â€‹<strong>â€‹æ·±å±‚è¯­ä¹‰ä¿¡æ¯â€‹</strong>â€‹ï¼ˆé«˜å±‚ç‰¹å¾ï¼‰å’Œ â€‹<strong>â€‹æµ…å±‚ç»†èŠ‚ä¿¡æ¯â€‹</strong>â€‹ï¼ˆä½å±‚ç‰¹å¾ï¼‰ï¼Œæ„å»ºå¤šå°ºåº¦çš„ç‰¹å¾é‡‘å­—å¡”ï¼Œæ˜¾è‘—æå‡ç›®æ ‡æ£€æµ‹æ¨¡å‹å¯¹ä¸åŒå°ºå¯¸ç›®æ ‡çš„æ£€æµ‹èƒ½åŠ›ã€‚</p>
<p>åœ¨YOLOv8ä¸­ï¼ŒFPNä¸»è¦è´Ÿè´£æ„å»º<strong>ä»ä½å±‚åˆ°é«˜å±‚</strong>çš„<strong>å¤šå°ºåº¦ç‰¹å¾å›¾</strong>ã€‚å…¶ä¸»è¦è¿‡ç¨‹å¦‚ä¸‹:</p>
<p><strong>1.è‡ªé¡¶å‘ä¸‹è·¯å¾„:</strong></p>
<ul>
<li>ä»æ·±å±‚ç‰¹å¾å¼€å§‹ï¼Œé€å±‚å‘ä¸Šé‡‡æ ·ã€‚</li>
<li>æ¯ä¸€å±‚çš„ä¸Šé‡‡æ ·ç‰¹å¾ä¸ç›¸åº”çš„ä½å±‚ç‰¹å¾è¿›è¡Œèåˆï¼Œä»¥è¡¥å……ç©ºé—´ä¿¡æ¯å’Œå¢å¼ºè¯­ä¹‰ä¿¡æ¯ã€‚</li>
</ul>
<p><strong>2.æ¨ªå‘è¿æ¥:</strong></p>
<ul>
<li>åˆ©ç”¨1x1å·ç§¯è°ƒæ•´é€šé“æ•°ï¼Œä½¿å¾—ä¸Šé‡‡æ ·ç‰¹å¾ä¸ä½å±‚ç‰¹å¾çš„é€šé“æ•°ä¸€è‡´ã€‚</li>
<li>é€šè¿‡é€å±‚ç›¸åŠ çš„æ–¹å¼è¿›è¡Œç‰¹å¾èåˆã€‚</li>
</ul>
<p>FPNç½‘ç»œå¤§è‡´ç»“æ„å¦‚ä¸‹ï¼š<strong>ä¸€ä¸ªè‡ªåº•å‘ä¸Šçš„çº¿è·¯ã€ä¸€ä¸ªè‡ªé¡¶å‘ä¸‹çš„çº¿è·¯ã€æ¨ªå‘è¿æ¥</strong></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/81c3d44184fd436e9c1e7778151c3b9d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6JyX54mb5LiN5Lya566X5rOV:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771141219&amp;x-signature=YPO8pQKOayeBpNusZAvuPL%2BEBUE%3D" alt="90a4c3d1-52ac-4ab7-b75d-18b22028cde7.png" loading="lazy"/></p>
<p><strong>ç»“æ¥è¯´ï¼ŒFPN = top-downçš„èåˆ + åœ¨é‡‘å­—å¡”å„å±‚è¿›è¡Œprediction</strong></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/edf82e376ef6489bad39ffc195a1c375~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6JyX54mb5LiN5Lya566X5rOV:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771141219&amp;x-signature=%2BCm6UKhqikcFzs%2F%2FPAkrCJAQkRU%3D" alt="5bf5c1dd-3c77-4017-bb0f-a43827b27778.png" loading="lazy"/>
<strong>FPNï¼ˆFeature Pyramid Networkï¼‰â€‹</strong>â€‹ é€šè¿‡è‡ªé¡¶å‘ä¸‹çš„è·¯å¾„æ„å»ºç‰¹å¾é‡‘å­—å¡”ï¼Œä½†å­˜åœ¨ä¸¤ä¸ªå…³é”®é—®é¢˜ï¼š</p>
<ol>
<li>â€‹<strong>â€‹è¯­ä¹‰ä¿¡æ¯ç¨€é‡Šâ€‹</strong>â€‹ï¼šæ·±å±‚ç‰¹å¾ç»è¿‡å¤šæ¬¡ä¸Šé‡‡æ ·ä¼ é€’åˆ°æµ…å±‚æ—¶ï¼Œä¸¢å¤±ç»†èŠ‚ä¿¡æ¯ã€‚</li>
<li>â€‹<strong>â€‹å®šä½ç²¾åº¦ä¸è¶³â€‹</strong>â€‹ï¼šå°ç›®æ ‡ä¾èµ–æµ…å±‚ç‰¹å¾ï¼Œä½†æµ…å±‚è¯­ä¹‰ä¿¡æ¯è¾ƒå¼±ã€‚</li>
</ol>
<h4 data-id="heading-21">2.2.2 è·¯å¾„èšåˆç½‘ç»œ(PAN)</h4>
<p><strong>è®ºæ–‡ï¼š2018å¹´åœ¨CVPR</strong> <a href="https://link.juejin.cn?target=https%3A%2F%2Farxiv.org%2Fabs%2F1803.01534" target="_blank" title="https://arxiv.org/abs/1803.01534" ref="nofollow noopener noreferrer">[1803.01534] Path Aggregation Network for Instance Segmentation</a></p>
<p><strong>PANetçš„æ ¸å¿ƒåˆ›æ–°åœ¨äºå¼•å…¥äº†è‡ªåº•å‘ä¸Šçš„è·¯å¾„èšåˆæœºåˆ¶ï¼Œå½¢æˆäº†<code>åŒå‘ç‰¹å¾èåˆè·¯å¾„</code></strong>ï¼Œè§£å†³äº†FPNå•å‘ä¿¡æ¯ä¼ é€’çš„å±€é™æ€§ã€‚è¿™ä¸€æ”¹è¿›ä½¿å¾—ä½å±‚çš„é«˜åˆ†è¾¨ç‡ç‰¹å¾èƒ½å¤Ÿæ›´æœ‰æ•ˆåœ°ä¼ é€’åˆ°é«˜å±‚ï¼ŒåŒæ—¶é«˜å±‚çš„è¯­ä¹‰ä¿¡æ¯ä¹Ÿèƒ½å……åˆ†å½±å“ä½å±‚ç‰¹å¾ï¼Œå®ç°äº†æ›´å…¨é¢çš„å¤šå°ºåº¦ç‰¹å¾äº¤äº’ã€‚</p>
<p>PANæ˜¯åœ¨FPNçš„åŸºç¡€ä¸Šï¼Œè¿›ä¸€æ­¥å¢å¼ºç‰¹å¾é‡‘å­—å¡”ç½‘ç»œçš„ç»“æ„ï¼Œå…·ä½“è¿‡ç¨‹å¦‚ä¸‹:</p>
<p><strong>1.è‡ªåº•å‘ä¸Šçš„è·¯å¾„:</strong></p>
<ul>
<li>ä»åº•å±‚ç‰¹å¾å¼€å§‹ï¼Œé€å±‚å‘ä¸Šä¼ é€’ç‰¹å¾ã€‚</li>
<li>æ¯ä¸€å±‚çš„ç‰¹å¾å›¾é€šè¿‡è‡ªåº•å‘ä¸Šçš„è·¯å¾„ï¼Œä¸é«˜å±‚ç‰¹å¾å›¾è¿›è¡Œèåˆã€‚</li>
</ul>
<p><strong>2.ç‰¹å¾èåˆ:</strong></p>
<ul>
<li>åœ¨æ¯ä¸€å±‚ï¼Œå°†è‡ªé¡¶å‘ä¸‹è·¯å¾„å’Œè‡ªåº•å‘ä¸Šè·¯å¾„çš„ç‰¹å¾è¿›è¡Œèåˆï¼Œç¡®ä¿æ¯ä¸€å±‚çš„ç‰¹å¾éƒ½åŒ…å«ä¸åŒå°ºåº¦çš„ä¿¡æ¯ã€‚</li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1367cdc558df415d98d76e1f532b455f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6JyX54mb5LiN5Lya566X5rOV:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771141219&amp;x-signature=TGxQEaJVX7BUgRakbmU%2Bo6%2BvEt0%3D" alt="image.png" loading="lazy"/></p>
<h4 data-id="heading-22">2.2.3 FPNå’ŒPANetåŒºåˆ«</h4>
<p><strong>FPNæ›´é€‚åˆåŸºç¡€ç›®æ ‡æ£€æµ‹ä»»åŠ¡å’Œèµ„æºå—é™ç¯å¢ƒ</strong>ï¼Œä¾‹å¦‚è½»é‡åŒ–ç§»åŠ¨ç«¯éƒ¨ç½²æˆ–å®æ—¶è§†é¢‘æµå¤„ç†ã€‚å…¶ç®€å•é«˜æ•ˆçš„ç»“æ„è®¾è®¡ä½¿å…¶åœ¨è®¡ç®—èµ„æºæœ‰é™çš„åœºæ™¯ä¸‹ä»èƒ½ä¿æŒè‰¯å¥½çš„æ£€æµ‹æ€§èƒ½ã€‚</p>
<p><strong>PANetåˆ™é€‚ç”¨äºéœ€è¦é«˜ç²¾åº¦çš„åœºæ™¯</strong>ï¼Œç‰¹åˆ«æ˜¯åœ¨å¤„ç†æå°ç›®æ ‡æˆ–å¤æ‚èƒŒæ™¯ç¯å¢ƒæ—¶ã€‚ä¾‹å¦‚åœ¨è‡ªåŠ¨é©¾é©¶ç³»ç»Ÿä¸­æ£€æµ‹è½¦è¾†å‘¨å›´çš„å°éšœç¢ç‰©ï¼Œæˆ–åœ¨åŒ»å­¦å›¾åƒåˆ†ä¸­è¯†åˆ«å¾®å°ç—…ç¶æ—¶ï¼ŒPANetçš„åŒå‘ç‰¹å¾èåˆå’Œè‡ªé€‚åº”ç‰¹å¾æ± åŒ–æŠ€æœ¯èƒ½å¤Ÿæ˜¾è‘—æå‡æ£€æµ‹å’Œåˆ†å‰²çš„å‡†ç¡®æ€§ã€‚</p>
<p>FPNçš„å‚æ•°é‡çº¦ä¸º25Mï¼ŒFLOPsçº¦ä¸º200Bï¼›è€ŒPANetçš„å‚æ•°é‡å¢åŠ åˆ°32.5Mï¼ŒFLOPsè¾¾åˆ°235.6Bã€‚</p>
<h3 data-id="heading-23">2.3 Neckåˆ›æ–°ç‚¹</h3>
<ol>
<li>
<p><strong>åŒèåˆè·¯å¾„</strong>ï¼š</p>
<ul>
<li>ä¸Šé‡‡æ ·è·¯å¾„ï¼šä¼ æ’­å¼ºè¯­ä¹‰ä¿¡æ¯ï¼ˆåˆ©äºåˆ†ç±»ï¼‰</li>
<li>ä¸‹é‡‡æ ·è·¯å¾„ï¼šä¼ æ’­å¼ºå®šä½ä¿¡æ¯ï¼ˆåˆ©äºæ£€æµ‹ï¼‰</li>
</ul>
</li>
<li>
<p><strong>è·¨å°ºåº¦è¿æ¥</strong>ï¼šä½¿ç”¨Concatè€ŒéAddï¼Œä¿ç•™æ›´å¤šç‰¹å¾ä¿¡æ¯</p>
</li>
<li>
<p><strong>é€‚é…ä¸åŒå°ºåº¦</strong>ï¼šé’ˆå¯¹80Ã—80ï¼ˆå°ç›®æ ‡ï¼‰ã€40Ã—40ï¼ˆä¸­ç›®æ ‡ï¼‰ã€20Ã—20ï¼ˆå¤§ç›®æ ‡ï¼‰ç‰¹å¾å›¾ä¼˜åŒ–èåˆç­–ç•¥ã€‚</p>
</li>
</ol>
<h3 data-id="heading-24">2.4 PAN-FPNåœ¨YOLOv8ä¸­çš„å…·ä½“å®ç°</h3>
<p>åœ¨YOLOv8ä¸­ï¼ŒPAN-FPNçš„å®ç°ç»“åˆäº†FPNå’ŒPANçš„ä¼˜ç‚¹ï¼Œå…·ä½“å¦‚ä¸‹:</p>
<blockquote>
<p><strong>1. å¤šå°ºåº¦ç‰¹å¾æå–:</strong></p>
<ul>
<li>YOLOv8çš„ä¸»å¹²ç½‘ç»œé¦–å…ˆæå–å‡ºä¸åŒå°ºåº¦çš„ç‰¹å¾å›¾ã€‚</li>
<li>é€šè¿‡FPNæ„å»ºè‡ªé¡¶å‘ä¸‹çš„ç‰¹å¾é‡‘å­—å¡”ï¼Œå®ç°å¤šå°ºåº¦ç‰¹å¾çš„åˆæ­¥èåˆã€‚</li>
</ul>
<p><strong>1. åŒå‘ç‰¹å¾èåˆ:</strong></p>
<ul>
<li>åœ¨FPNçš„åŸºç¡€ä¸Šï¼Œå¼•å…¥PANçš„è‡ªåº•å‘ä¸Šè·¯å¾„ï¼Œå°†ä½å±‚ç‰¹å¾é€å±‚ä¼ é€’åˆ°é«˜å±‚ï¼Œè¿›ä¸€æ­¥ä¸°å¯Œå¤šå°ºåº¦ç‰¹å¾ã€‚</li>
<li>é€šè¿‡æ¨ªå‘è¿æ¥ï¼Œå°†ä¸åŒå°ºåº¦çš„ç‰¹å¾è¿›è¡Œèåˆï¼Œç¡®ä¿æ¯ä¸€å±‚çš„ç‰¹å¾éƒ½åŒ…å«ä¸°å¯Œçš„ä¸Šä¸‹æ–‡ä¿¡æ¯ã€‚</li>
</ul>
<p><strong>2. å¢å¼ºçš„ç‰¹å¾è¡¨ç¤º:</strong></p>
<ul>
<li>PAN-FPNé€šè¿‡åŒå‘è·¯å¾„çš„èåˆï¼Œä½¿å¾—ç‰¹å¾å›¾åŒ…å«æ›´ä¸°å¯Œçš„ä¸Šä¸‹æ–‡ä¿¡æ¯å’Œè¯­ä¹‰ä¿¡æ¯ï¼Œå¢å¼ºäº†æ¨¡å‹å¯¹ä¸åŒå°ºåº¦ç›®æ ‡çš„æ£€æµ‹èƒ½åŠ›ã€‚</li>
</ul>
</blockquote>
<h2 data-id="heading-25">3. Headï¼šDecoupled-Head + DFL + CIoUï¼ˆæ£€æµ‹å¤´é©æ–°ï¼‰</h2>
<p>YOLOv8å°†æ£€æµ‹å¤´æ”¹ä¸º <strong><code>è§£è€¦å½¢å¼</code></strong>ï¼Œå¹¶å¼•å…¥äº†å…ˆè¿›çš„æŸå¤±å‡½æ•°ã€‚</p>
<p>åœ¨YOLOv8ä¸­ï¼ŒHeadéƒ¨åˆ†è´Ÿè´£å°†Neckéƒ¨åˆ†è¾“å‡ºçš„ç‰¹å¾è¿›è¡Œè¿›ä¸€æ­¥å¤„ç†ï¼Œä»¥ç”Ÿæˆæœ€ç»ˆçš„æ£€æµ‹ç»“æœã€‚Headéƒ¨åˆ†çš„ä¸»è¦åŠŸèƒ½æ˜¯<strong>å°†ç‰¹å¾å›¾è½¬æ¢ä¸ºç›®æ ‡æ£€æµ‹æ‰€éœ€çš„å…·ä½“ä¿¡æ¯ï¼ŒåŒ…æ‹¬ç±»åˆ«ã€ä½ç½®å’Œç½®ä¿¡åº¦ã€‚</strong></p>
<p>è§£è€¦å¤´ç»“æ„ï¼š</p>
<pre><code class="hljs language-js" lang="js">å…±äº«ç‰¹å¾ â†’ ä¸‰ä¸ªç‹¬ç«‹åˆ†æ”¯ï¼š
  <span class="hljs-number">1.</span> åˆ†ç±»åˆ†æ”¯ï¼š<span class="hljs-title class_">Conv</span> + <span class="hljs-title class_">Conv</span> â†’ ç±»åˆ«ç½®ä¿¡åº¦
  <span class="hljs-number">2.</span> å›å½’åˆ†æ”¯ï¼š<span class="hljs-title class_">Conv</span> + <span class="hljs-title class_">Conv</span> â†’ è¾¹ç•Œæ¡†åæ ‡
  <span class="hljs-number">3.</span> åˆ†å¸ƒç„¦ç‚¹åˆ†æ”¯ï¼š<span class="hljs-title class_">Conv</span> + <span class="hljs-title class_">Conv</span> â†’ è¾¹ç•Œæ¡†åˆ†å¸ƒï¼ˆ<span class="hljs-variable constant_">DFL</span>ï¼‰
</code></pre>
<h3 data-id="heading-26">3.1 å·ç§¯å±‚å’Œæ¿€æ´»å‡½æ•°</h3>
<p>Headéƒ¨åˆ†é€šå¸¸åŒ…æ‹¬è‹¥å¹²å·ç§¯å±‚å’Œæ¿€æ´»å‡½æ•°ã€‚è¿™äº›å·ç§¯å±‚ç”¨äºè¿›ä¸€æ­¥å¤„ç†Neckéƒ¨åˆ†è¾“å‡ºçš„ç‰¹å¾å›¾ï¼Œä»¥æå–æ›´å¤šçš„é«˜çº§ç‰¹å¾ã€‚å¸¸è§çš„æ¿€æ´»å‡½æ•°åŒ…æ‹¬ReLUæˆ–Leaky ReLUï¼Œèƒ½å¤Ÿå¼•å…¥éçº¿æ€§ï¼Œä»è€Œæå‡ç‰¹å¾è¡¨è¾¾èƒ½åŠ›ã€‚</p>
<h3 data-id="heading-27">3.2 é¢„æµ‹å±‚ (Prediction Layers)</h3>
<p>åœ¨YOLOv8ä¸­ï¼Œé¢„æµ‹å±‚æ˜¯å…³é”®ç»„ä»¶ï¼Œè´Ÿè´£ç”Ÿæˆæœ€ç»ˆçš„æ£€æµ‹ç»“æœã€‚é¢„æµ‹å±‚åŒ…æ‹¬ä¸‰ä¸ªä¸»è¦è¾“å‡º:</p>
<ul>
<li><strong>è¾¹ç•Œæ¡†å›å½’(Bounding BoxRegression)</strong>ï¼šé¢„æµ‹ç›®æ ‡çš„ä½ç½®å’Œå¤§å°ã€‚é€šå¸¸è¾“å‡ºå››ä¸ªå€¼ï¼Œåˆ†åˆ«å¯¹åº”è¾¹ç•Œæ¡†çš„ä¸­å¿ƒåæ ‡(x,y)å’Œå®½åº¦ã€é«˜åº¦(w,h)ã€‚</li>
<li><strong>ç½®ä¿¡åº¦è¯„åˆ†(Confidence Scores)</strong>ï¼šé¢„æµ‹æ¯ä¸ªè¾¹ç•Œæ¡†å†…æ˜¯å¦åŒ…å«ç›®æ ‡ï¼Œä»¥åŠç›®æ ‡çš„ç½®ä¿¡åº¦ã€‚</li>
<li><strong>ç±»åˆ«æ¦‚ç‡(Class Probabilities)</strong>ï¼šé¢„æµ‹ç›®æ ‡å±äºæ¯ä¸ªç±»åˆ«çš„æ¦‚ç‡ã€‚</li>
</ul>
<h4 data-id="heading-28">3.2.1 DFLï¼ˆDistribution Focal Lossï¼‰</h4>
<pre><code class="hljs language-js" lang="js">ä¼ ç»Ÿï¼šç›´æ¥å›å½’è¾¹ç•Œæ¡†åæ ‡
<span class="hljs-variable constant_">DFL</span>ï¼šå°†åæ ‡é¢„æµ‹å»ºæ¨¡ä¸ºç¦»æ•£æ¦‚ç‡åˆ†å¸ƒ
  æ­¥éª¤ï¼š
    <span class="hljs-number">1.</span> é¢„æµ‹è¾¹ç•Œæ¡†çš„åˆ†å¸ƒï¼ˆå¦‚y = Î£[<span class="hljs-title function_">P</span>(i)Ã—i]ï¼‰
    <span class="hljs-number">2.</span> ä½¿ç”¨<span class="hljs-title class_">Focal</span> <span class="hljs-title class_">Loss</span>ä¼˜åŒ–åˆ†å¸ƒ
  ä¼˜åŠ¿ï¼š
    - æ›´å‡†ç¡®çš„å°ç›®æ ‡æ£€æµ‹
    - å¯¹æ¨¡ç³Šè¾¹ç•Œæ›´é²æ£’
</code></pre>
<h4 data-id="heading-29">3.2.2 æŸå¤±å‡½æ•°ç»„åˆ</h4>
<pre><code class="hljs language-js" lang="js">æ€»æŸå¤± = åˆ†ç±»æŸå¤± + å›å½’æŸå¤± + <span class="hljs-variable constant_">DFL</span>æŸå¤±

åˆ†ç±»æŸå¤±ï¼š<span class="hljs-title class_">BCEWithLogitsLoss</span> æˆ– <span class="hljs-title class_">VarifocalLoss</span>ï¼ˆå¯é€‰ï¼‰
å›å½’æŸå¤±ï¼š<span class="hljs-title class_">CIoU</span> <span class="hljs-title class_">Loss</span>ï¼ˆè€ƒè™‘é‡å ã€ä¸­å¿ƒè·ç¦»ã€é•¿å®½æ¯”ï¼‰
<span class="hljs-variable constant_">DFL</span>æŸå¤±ï¼šç›‘ç£è¾¹ç•Œæ¡†åˆ†å¸ƒå­¦ä¹ 
</code></pre>
<h2 data-id="heading-30">å…¶ä»–ä¼˜åŒ–</h2>
<p>é™¤äº†ä¸Šè¿°ç»“æ„å¤–ï¼ŒYOLOv8è¿˜å¼•å…¥äº†ä¸€äº›æ–°çš„ä¼˜åŒ–æŠ€æœ¯ï¼Œå¦‚:</p>
<ol>
<li><strong>Anchor-freeæœºåˆ¶</strong>:å‡å°‘äº†é”šæ¡†çš„è¶…å‚æ•°è®¾ç½®ï¼Œé€šè¿‡ç›´æ¥é¢„æµ‹ç›®æ ‡çš„ä¸­å¿ƒç‚¹æ¥ç®€åŒ–è®­ç»ƒè¿‡ç¨‹ã€‚</li>
<li><strong>è‡ªé€‚åº”éå¤§å€¼æŠ‘åˆ¶NMS(Non-Maximum Suppression)</strong>:æ”¹è¿›äº†ä¼ ç»Ÿçš„NMSç®—æ³•ï¼Œé€šè¿‡è‡ªé€‚åº”è°ƒæ•´é˜ˆå€¼ï¼Œ<strong>å‡å°‘è¯¯æ£€å’Œæ¼æ£€</strong>ï¼Œæé«˜æ£€æµ‹ç²¾åº¦ã€‚
æœ€ç»ˆçš„é¢„æµ‹ç»“æœä¼šç»è¿‡éæå¤§å€¼æŠ‘åˆ¶å¤„ç†ï¼Œ<strong>ä»¥å»é™¤é‡å¤çš„æ£€æµ‹æ¡†</strong>ã€‚NMSä¿ç•™ç½®ä¿¡åº¦æœ€é«˜çš„è¾¹ç•Œæ¡†ï¼Œå¹¶ç§»é™¤ä¸ä¹‹é‡å åº¦é«˜çš„å…¶ä»–è¾¹ç•Œæ¡†ï¼Œç¡®ä¿æ¯ä¸ªç›®æ ‡åªè¢«æ£€æµ‹ä¸€æ¬¡ã€‚</li>
<li><strong>è‡ªåŠ¨æ··åˆç²¾åº¦è®­ç»ƒ(Automatic Mixed Precision Training)</strong>:é€šè¿‡åœ¨è®­ç»ƒè¿‡ç¨‹ä¸­åŠ¨æ€è°ƒæ•´è®¡ç®—ç²¾åº¦ï¼ŒåŠ å¿«è®­ç»ƒé€Ÿåº¦ï¼ŒåŒæ—¶å‡å°‘æ˜¾å­˜å ç”¨ã€‚</li>
</ol>
<h2 data-id="heading-31">æ€»ç»“å¤ä¹ </h2>
<p>ï¼ˆ1ï¼‰ç‰¹å¾é‡‘å­—å¡”ç½‘ç»œæ˜¯å•¥ï¼Ÿ
ï¼ˆ2ï¼‰ç©ºé—´é‡‘å­—å¡”æ± åŒ–æ˜¯å•¥ï¼Ÿ
ï¼ˆ3ï¼‰C2fæ˜¯å•¥ï¼Ÿ
ï¼ˆ4ï¼‰è·¯å¾„èšåˆç½‘ç»œæ˜¯å•¥ï¼Ÿ
ï¼ˆ5ï¼‰ç‰¹å¾é‡‘å­—å¡”ç½‘ç»œå’Œè·¯å¾„èšåˆç½‘ç»œåŒºåˆ«ï¼Ÿ
ï¼ˆ5ï¼‰YOLOä¸ºä»€ä¹ˆä½¿ç”¨ä¸¤å±‚ç‰¹å¾é‡‘å­—å¡”ç»“æ„ï¼Ÿ
ï¼ˆ7ï¼‰é¢„æµ‹å±‚ä¼šè¾“å‡ºä»€ä¹ˆï¼Ÿ
ï¼ˆ8ï¼‰æ€ä¹ˆå»é™¤é‡å¤çš„æ£€æµ‹æ¡†å’Œå‡å°‘è¯¯æ£€å’Œæ¼æ£€ï¼ŸNMS
ï¼ˆ9ï¼‰ä¸ºä»€ä¹ˆæ£€æµ‹å°ç‰©ä½“éœ€è¦ç”¨å¤§çš„ç‰¹å¾å›¾ï¼Ÿ</p>
<p>ï¼ˆ10ï¼‰ä¸ºä»€ä¹ˆè¦ç”¨åŒåˆ†æ”¯ï¼Ÿ</p>
<ol>
<li><strong>ä¸°å¯Œç‰¹å¾è¡¨ç¤º</strong>ï¼šä¸åŒåˆ†æ”¯å­¦ä¹ ä¸åŒç‰¹å¾</li>
<li><strong>æ¢¯åº¦å¤šæ ·æ€§</strong>ï¼šç¼“è§£æ¢¯åº¦æ¶ˆå¤±ï¼Œå¸®åŠ©è®­ç»ƒ</li>
<li><strong>ä¿¡æ¯å†—ä½™</strong>ï¼šæå‡æ¨¡å‹é²æ£’æ€§</li>
</ol>
<p>ï¼ˆ11ï¼‰è¿æ¥å¤„çš„cå’Œaçš„åŒºåˆ«ï¼Ÿ</p>
<p><strong>è¿æ¥å¤„çš„<code>c</code>é€šå¸¸ä»£è¡¨"æ‹¼æ¥/è¿æ¥ï¼ˆconcatenateï¼‰"æ“ä½œ</strong>
<strong>è¿æ¥å¤„çš„<code>a</code>æ˜¯<code>add</code>ï¼ˆåŠ æ³•æ“ä½œ/æ®‹å·®è¿æ¥ï¼‰</strong></p>
<p>ï¼ˆ12ï¼‰TDå’ŒBUæ˜¯ä»€ä¹ˆï¼Ÿ</p>
<ul>
<li><strong>TD</strong>Â =Â <strong>T</strong>op-<strong>D</strong>own = è‡ªä¸Šè€Œä¸‹ = è¯­ä¹‰ä¿¡æ¯ä¸‹ä¼ </li>
<li><strong>BU</strong>Â =Â <strong>B</strong>ottom-<strong>U</strong>p = è‡ªä¸‹è€Œä¸Š = ä½ç½®ä¿¡æ¯ä¸Šä¼ </li>
</ul>
<h2 data-id="heading-32">å‚è€ƒèµ„æ–™</h2>
<p>[1]<a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.csdn.net%2Fu013172930%2Farticle%2Fdetails%2F154040820" target="_blank" title="https://blog.csdn.net/u013172930/article/details/154040820" ref="nofollow noopener noreferrer">ä»€ä¹ˆæ˜¯ C2fï¼š YOLOv8 ä¸­å¼•å…¥çš„ä¸€ç§é«˜æ•ˆç‰¹å¾æå–æ¨¡å—_c2fæ¨¡å—</a></p>
<p>[2]<a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.csdn.net%2Fshangyanaf%2Farticle%2Fdetails%2F139223155" target="_blank" title="https://blog.csdn.net/shangyanaf/article/details/139223155" ref="nofollow noopener noreferrer">ä¸‡å­—è¯¦è§£YOLOv8ç½‘ç»œç»“æ„Backbone/neck/headä»¥åŠConvã€Bottleneckã€C2fã€SPPFã€Detectç­‰æ¨¡å—_yolov8ç½‘ç»œæ¶æ„</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[åŒ—äº¬å›é•¿æ²™äº†ï¼Œç®€å•è°ˆè°ˆæ„Ÿå—ï¼]]></title>    <link>https://juejin.cn/post/7603781883973763091</link>    <guid>https://juejin.cn/post/7603781883973763091</guid>    <pubDate>2026-02-08T09:54:37.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7603781883973763091" data-draft-id="7603643044035199012" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="åŒ—äº¬å›é•¿æ²™äº†ï¼Œç®€å•è°ˆè°ˆæ„Ÿå—ï¼"/> <meta itemprop="keywords" content="åç«¯,é¢è¯•,Java"/> <meta itemprop="datePublished" content="2026-02-08T09:54:37.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ç¨‹åºå‘˜é£é±¼"/> <meta itemprop="url" content="https://juejin.cn/user/1665088861772688"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            åŒ—äº¬å›é•¿æ²™äº†ï¼Œç®€å•è°ˆè°ˆæ„Ÿå—ï¼
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1665088861772688/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ç¨‹åºå‘˜é£é±¼
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-08T09:54:37.000Z" title="Sun Feb 08 2026 09:54:37 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»2åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{line-height:1.75;font-family:-apple-system-font,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei UI,Microsoft YaHei,Arial,sans-serif;letter-spacing:2px;background-image:linear-gradient(90deg,rgba(50,0,0,.05) 3%,transparent 0),linear-gradient(1turn,rgba(50,0,0,.05) 3%,transparent 0);background-size:20px 20px;background-position:50%;word-break:break-word;font-weight:400;font-size:15px;overflow-x:hidden;color:#333}.markdown-body h1{font-size:23px;margin-bottom:5px;font-weight:700;padding-left:10px;border-left:5px solid #773098}.markdown-body h2{font-size:19px;font-weight:700;padding-left:10px;border-left:5px solid #916dd5}.markdown-body h3{font-size:17px;font-weight:700;padding-left:10px;border-left:5px solid #d89cf6}.markdown-body h4{font-size:16px}.markdown-body h5{font-size:15px}.markdown-body h6{font-size:14px;margin-top:5px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{display:block;max-width:100%;margin:1em 0;border-radius:6px;box-shadow:2px 4px 7px #999;user-select:none}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{padding:.2em .5em;font-weight:700;font-family:-apple-system-font,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei UI,Microsoft YaHei,Arial,sans-serif;font-size:1em;color:#916dd5;word-break:break-word;overflow-x:auto;background-color:none;border-radius:2px}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{display:block;font-family:-apple-system-font,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei UI,Microsoft YaHei,Arial,sans-serif;font-weight:400;font-size:.9em;padding:16px 12px;margin:0;color:#333;word-break:normal;overflow-x:auto;background:#f8f8f8;scroll-behavior:smooth}.markdown-body a{text-decoration:none;color:#916dd5;font-weight:700;border-bottom:1px solid #916dd5}.markdown-body a:active,.markdown-body a:hover{color:#773098}.markdown-body table{display:inline-block!important;font-size:14px;width:auto;max-width:100%;overflow:auto;border:1px solid #916dd5;border-collapse:collapse}.markdown-body thead{background-color:#916dd5;color:#fff;text-align:left}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px;border:1px solid #916dd5}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #d89cf6;background-color:#f4eeff}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0;line-height:26px}.markdown-body ol,.markdown-body ul{padding-left:28px;list-style-type:circle}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body b,.markdown-body strong{color:#916dd5;font-weight:700}.markdown-body b:before,.markdown-body strong:before{content:"ã€Œ"}.markdown-body b:after,.markdown-body strong:after{content:"ã€"}.markdown-body em,.markdown-body i{color:#916dd5}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="github-gist">.markdown-body pre,.markdown-body pre&gt;code.hljs{background:#fff;color:#333}.hljs-comment,.hljs-meta{color:#969896}.hljs-emphasis,.hljs-quote,.hljs-strong,.hljs-template-variable,.hljs-variable{color:#df5000}.hljs-keyword,.hljs-selector-tag,.hljs-type{color:#d73a49}.hljs-attribute,.hljs-bullet,.hljs-literal,.hljs-symbol{color:#0086b3}.hljs-name,.hljs-section{color:#63a35c}.hljs-tag{color:#333}.hljs-attr,.hljs-selector-attr,.hljs-selector-class,.hljs-selector-id,.hljs-selector-pseudo,.hljs-title{color:#6f42c1}.hljs-addition{color:#55a532;background-color:#eaffea}.hljs-deletion{color:#bd2c00;background-color:#ffecec}.hljs-link{text-decoration:underline}.hljs-number{color:#005cc5}.hljs-string{color:#032f62}</style><p>å¤§å®¶å¥½å‘€ï¼Œæˆ‘æ˜¯<strong>é£é±¼</strong></p>
<p>æˆ‘ä»Šå¹´å·²ç»ä»åŒ—äº¬å›é•¿æ²™äº†ï¼Œè¿™é‡Œè°ˆè°ˆæ„Ÿå—ã€‚</p>
<blockquote>
<p>â</p>
<p>é¦–å…ˆæˆ‘å›é•¿æ²™ä¸æ˜¯é€ƒç¦»ï¼Œè€Œæ˜¯æ¢ä¸€ç§æ›´èˆ’æœã€æ›´å¯æŒç»­çš„ç”Ÿæ´»æ–¹å¼ã€‚</p>
<p>åŒ—äº¬ç»™äº†æˆ‘è§†é‡å’Œèƒ½åŠ›ï¼Œé•¿æ²™ç»™äº†æˆ‘ç”Ÿæ´»å’Œå½’å±ã€‚</p>
</blockquote>
<p><strong>æœ€ç›´è§‚çš„å˜åŒ–</strong></p>
<ul>
<li>èŠ‚å¥æ…¢äº†ï¼šä¸ç”¨æŒ¤æ—©é«˜å³°äº†ï¼Œèµ°è·¯ä¸ç”¨å°è·‘ï¼Œå›å®¶è·¯æ›´çŸ­ã€‚</li>
<li>å¿ƒæ€ç¨³äº†ï¼šä¸å†å¤©å¤©èµ¶è¿›åº¦ã€è¿½KPIï¼Œäººä¹Ÿæ²¡é‚£ä¹ˆç´§ç»·äº†ã€‚</li>
</ul>
<p><strong>ç”Ÿæ´»æˆæœ¬ï¼šå‹åŠ›æ˜æ˜¾å°äº†</strong></p>
<blockquote>
<p>â</p>
<p>æˆ¿ç§Ÿã€é€šå‹¤ã€æ—¥å¸¸å¼€é”€éƒ½é™äº†ä¸å°‘ï¼Œä»¥å‰åœ¨åŒ—äº¬å·¥èµ„é«˜ï¼Œä½†å¤§å¤´éƒ½è¢«ç”Ÿæ´»æˆæœ¬åƒæ‰äº†ã€‚</p>
<p>ç°åœ¨æ”¶å…¥å¯èƒ½å°‘äº›ï¼Œä½†å¿ƒé‡Œè¸å®å¾ˆå¤šã€‚</p>
</blockquote>
<p><strong>ä¸ªäººç”Ÿæ´»ï¼šæ›´æ¾å¼›ä¹Ÿæ›´æœ‰è¾¹ç•Œ</strong></p>
<blockquote>
<p>â</p>
<p>å›æ¥åä½œæ¯æ›´è§„å¾‹äº†ï¼Œèƒ½æ—©ç‚¹ç¡ã€æ—©ç‚¹èµ·ï¼Œå‘¨å†…ä¹Ÿä¼šç•™å‡ºæ—¶é—´è¿åŠ¨æˆ–æ•£æ­¥ã€‚</p>
<p>ä»¥å‰ä¸‹ç­åªæƒ³èººç€åˆ·æ‰‹æœºï¼Œç°åœ¨ä¼šç»™è‡ªå·±ç•™ä¸€ç‚¹ç©ºç™½æ—¶é—´ï¼Œç”¨æ¥è¯»ä¹¦ã€æ•´ç†æ€è·¯æˆ–è€…é™ªå®¶äººèŠå¤©ã€‚</p>
<p>ç”Ÿæ´»å˜ç®€å•ï¼Œä½†å¿ƒé‡Œæ›´ç¬ƒå®šï¼Œèƒ½æŠŠæ³¨æ„åŠ›æ”¾åœ¨çœŸæ­£é‡è¦çš„äººå’Œäº‹ä¸Šã€‚</p>
</blockquote>
<p><strong>åŸå¸‚æ°”æ¯ï¼šæ›´æœ‰ç”Ÿæ´»æ„Ÿ</strong></p>
<blockquote>
<p>â</p>
<p>é•¿æ²™çƒŸç«æ°”è¶³ï¼Œæˆ‘ç°åœ¨æ¯å‘¨éƒ½ä¼šå»çˆ¬ä¸€æ¬¡å²³éº“å±±ï¼ˆç¦»å¾—è¿‘ï¼‰ã€‚</p>
<p>å‘¨æœ«ä¹Ÿèƒ½éšæ—¶çº¦ä¸Šæœ‹å‹ä¸€èµ·åƒé¥­èŠå¤©ï¼Œä¸ç”¨å†æç€æ—¶é—´èµ¶è·¯ã€‚</p>
</blockquote>
<p><strong>ä¸ªäººæˆé•¿ï¼šä»å¤–éƒ¨é©±åŠ¨åˆ°è‡ªæˆ‘é©±åŠ¨</strong></p>
<blockquote>
<p>â</p>
<p>ä»¥å‰åœ¨åŒ—äº¬ï¼ŒèŠ‚å¥å’Œç¯å¢ƒä¼šæ¨ç€æˆ‘èµ°ï¼Œäº‹æƒ…ä¸€ä»¶æ¥ä¸€ä»¶ï¼Œæ¥ä¸åŠæƒ³å¤ªå¤šã€‚</p>
<p>å›é•¿æ²™åï¼Œå¤–éƒ¨æ¨åŠ›å°äº†ï¼Œä½†æˆ‘å¼€å§‹ä¸»åŠ¨æ­è‡ªå·±çš„èŠ‚å¥ï¼šç»™è‡ªå·±è®¾ç›®æ ‡ã€åšå¤ç›˜ã€å®‰æ’å­¦ä¹ è®¡åˆ’ã€‚</p>
<p>æ…¢ä¸‹æ¥ä¹‹åï¼Œåè€Œæ›´èƒ½çœ‹æ¸…è‡ªå·±æ“…é•¿ä»€ä¹ˆã€ç¼ºä»€ä¹ˆï¼Œä¹Ÿæ›´å®¹æ˜“æŠŠå·¥ä½œå’Œç”Ÿæ´»éƒ½ç»è¥å¾—æ›´ç¨³ã€‚</p>
</blockquote>
<p><strong>ç»™åŒæ ·é€‰æ‹©çš„äººä¸€ç‚¹å»ºè®®</strong></p>
<ul>
<li>å…ˆæƒ³æ¸…æ¥šä½ æƒ³è¦ä»€ä¹ˆï¼šæ˜¯ç¦»å®¶è¿‘ã€ç”Ÿæ´»å‹åŠ›å°ï¼Œè¿˜æ˜¯èŒä¸šæˆé•¿æ›´å¿«ï¼Ÿåˆ«åªå› ä¸ºç´¯äº†å°±å†³å®šï¼Œè¦æœ‰æ˜ç¡®çš„å–èˆã€‚</li>
<li>æå‰åšèµ„æºå‡†å¤‡ï¼šæ— è®ºå»å“ªï¼ŒèŒä¸šå‘å±•éƒ½å¾—é è‡ªå·±ï¼ŒæŠ€èƒ½å‚¨å¤‡ã€ä½œå“ã€åœˆå­éƒ½è¦ä¸»åŠ¨ç»è¥ã€‚</li>
<li>è§„åˆ’ç°é‡‘æµï¼šæ”¶å…¥å˜åŒ–è¦æå‰ç®—æ¸…æ¥šï¼Œåˆ«è®©ç”Ÿæ´»å‹åŠ›åè¿‡æ¥å½±å“åˆ¤æ–­ã€‚</li>
<li>ç»™è‡ªå·±ä¸€ä¸ªè¿‡æ¸¡æœŸï¼šå›å»ä¸æ˜¯ç«‹åˆ»å®Œç¾é€‚åº”ï¼Œç»™è‡ªå·±å‡ ä¸ªæœˆè°ƒæ•´èŠ‚å¥ï¼Œåˆ«å¤ªç„¦è™‘ã€‚</li>
</ul>
<p><strong>æœ€åæƒ³è¯´</strong></p>
<p>é€‚åˆè‡ªå·±çš„åœ°æ–¹ï¼Œä¸ä¸€å®šæ˜¯æœºä¼šæœ€å¤šçš„åœ°æ–¹ï¼Œè€Œæ˜¯èƒ½è®©ä½ æ´»å¾—æ›´ä»å®¹ã€æœ‰åŠ›é‡çš„åœ°æ–¹ã€‚</p>
<blockquote>
<p>â</p>
<p>æœ€åæƒ³çœ‹æŠ€æœ¯æ–‡ç« çš„ï¼Œå¯ä»¥å»æˆ‘çš„ä¸ªäººç½‘ç«™ï¼š<a href="https://link.juejin.cn?target=http%3A%2F%2Fhardyfish.top%2F" target="_blank" title="http://hardyfish.top/" ref="nofollow noopener noreferrer">hardyfish.top/</a></p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[JavaScript å“åº”å¼å¸ƒå±€çš„è¯ç”Ÿå†ç¨‹ï¼šä»åç«¯æ¸²æŸ“åˆ°å‰ç«¯å“åº”å¼]]></title>    <link>https://juejin.cn/post/7604037348607066150</link>    <guid>https://juejin.cn/post/7604037348607066150</guid>    <pubDate>2026-02-08T09:54:26.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7604037348607066150" data-draft-id="7603721514203676681" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="JavaScript å“åº”å¼å¸ƒå±€çš„è¯ç”Ÿå†ç¨‹ï¼šä»åç«¯æ¸²æŸ“åˆ°å‰ç«¯å“åº”å¼"/> <meta itemprop="keywords" content="å…¨æ ˆ"/> <meta itemprop="datePublished" content="2026-02-08T09:54:26.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ä¸ä¼šæ•²ä»£ç 1"/> <meta itemprop="url" content="https://juejin.cn/user/1927884034804425"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            JavaScript å“åº”å¼å¸ƒå±€çš„è¯ç”Ÿå†ç¨‹ï¼šä»åç«¯æ¸²æŸ“åˆ°å‰ç«¯å“åº”å¼
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1927884034804425/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ä¸ä¼šæ•²ä»£ç 1
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-08T09:54:26.000Z" title="Sun Feb 08 2026 09:54:26 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»10åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">JavaScript å“åº”å¼å¸ƒå±€çš„è¯ç”Ÿå†ç¨‹ï¼šä»åç«¯æ¸²æŸ“åˆ°å‰ç«¯å“åº”å¼</h2>
<h3 data-id="heading-1">å¼•è¨€</h3>
<p>åœ¨ Web å¼€å‘çš„æ¼”è¿›è¿‡ç¨‹ä¸­ï¼Œæ•°æ®ä¸ç•Œé¢çš„å…³ç³»ç»å†äº†å¤šæ¬¡é©å‘½æ€§çš„å˜åŒ–ã€‚ä»æœ€åˆçš„çº¯åç«¯æ¸²æŸ“ï¼Œåˆ°å‰åç«¯åˆ†ç¦»ï¼Œå†åˆ°ç°ä»£çš„å“åº”å¼æ•°æ®é©±åŠ¨ï¼Œæ¯ä¸€æ¬¡å˜é©éƒ½è®©å¼€å‘æ›´åŠ é«˜æ•ˆã€ç”¨æˆ·ä½“éªŒæ›´åŠ æµç•…ã€‚æœ¬æ–‡å°†ç»“åˆå…·ä½“ä»£ç ç¤ºä¾‹ï¼Œå¸¦ä½ èµ°å®Œè¿™æ®µå†ç¨‹ï¼Œç†è§£å“åº”å¼å¸ƒå±€å¦‚ä½•è¯ç”Ÿå¹¶æˆä¸ºç°ä»£å‰ç«¯å¼€å‘çš„æ ¸å¿ƒã€‚</p>
<hr/>
<h3 data-id="heading-2">ç¬¬ä¸€é˜¶æ®µï¼šçº¯åç«¯çš„å¥—æ¨¡æ¿ï¼ˆMVC æ¨¡å¼ï¼‰</h3>
<h4 data-id="heading-3">ä»€ä¹ˆæ˜¯çº¯åç«¯å¥—æ¨¡æ¿ï¼Ÿ</h4>
<p>åœ¨è¿™ä¸ªé˜¶æ®µï¼ŒæœåŠ¡å™¨è´Ÿè´£å¤„ç†<strong>æ‰€æœ‰</strong>çš„é¡µé¢ç”Ÿæˆå·¥ä½œã€‚å…¸å‹çš„ MVCï¼ˆModel-View-Controllerï¼‰æ¶æ„ä¸­ï¼š</p>
<ul>
<li><strong>Model</strong>ï¼šæ•°æ®å±‚ï¼ˆå¦‚æ•°æ®åº“ä¸­çš„æ•°æ®ï¼‰</li>
<li><strong>View</strong>ï¼šæ¨¡æ¿å±‚ï¼ˆHTML + æ¨¡æ¿è¯­æ³•ï¼‰</li>
<li><strong>Controller</strong>ï¼šä¸šåŠ¡é€»è¾‘å±‚ï¼ˆæ¥æ”¶è¯·æ±‚ã€å¤„ç†æ•°æ®ã€æ¸²æŸ“æ¨¡æ¿ï¼‰</li>
</ul>
<h4 data-id="heading-4">ä»£ç ç¤ºä¾‹åˆ†æ</h4>
<p>åœ¨ <code>server.js</code> ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°å…¸å‹çš„åç«¯æ¸²æŸ“æ¨¡å¼ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// æ•°æ®å®šä¹‰åœ¨æœåŠ¡å™¨ç«¯</span>
<span class="hljs-keyword">const</span> users=[
    {
        <span class="hljs-attr">id</span>:<span class="hljs-number">1</span>,
        <span class="hljs-attr">name</span>:<span class="hljs-string">'å¼ ä¸‰'</span>,
        <span class="hljs-attr">email</span>:<span class="hljs-string">'zhangsan@qq.com'</span>
    },
    <span class="hljs-comment">// ... æ›´å¤šç”¨æˆ·æ•°æ®</span>
]

<span class="hljs-comment">// ç”ŸæˆHTMLçš„æ¨¡æ¿å‡½æ•°</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">generateHTML</span>(<span class="hljs-params">users</span>){
    <span class="hljs-keyword">const</span> userRows=users.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">user</span>=&gt;</span>
        <span class="hljs-string">`&lt;tr&gt;
            &lt;td&gt;<span class="hljs-subst">${user.id}</span>&lt;/td&gt;
            &lt;td&gt;<span class="hljs-subst">${user.name}</span>&lt;/td&gt;
            &lt;td&gt;<span class="hljs-subst">${user.email}</span>&lt;/td&gt;
        &lt;/tr&gt;`</span>
    ).<span class="hljs-title function_">join</span>(<span class="hljs-string">''</span>)
    
    <span class="hljs-keyword">return</span> <span class="hljs-string">`
    &lt;!DOCTYPE html&gt;
    &lt;html lang="en"&gt;
    &lt;head&gt;
        &lt;!-- æ ·å¼å’Œå…ƒæ•°æ® --&gt;
    &lt;/head&gt;
    &lt;body&gt;
        &lt;h1&gt;Users&lt;/h1&gt;
        &lt;table&gt;
            &lt;thead&gt;...&lt;/thead&gt;
            &lt;tbody&gt;
                <span class="hljs-subst">${userRows}</span>  &lt;!-- åŠ¨æ€æ•°æ®æ’å…¥ --&gt;
            &lt;/tbody&gt;
        &lt;/table&gt;
    &lt;/body&gt;
    &lt;/html&gt;`</span>
}

<span class="hljs-comment">// æœåŠ¡å™¨å¤„ç†è¯·æ±‚</span>
<span class="hljs-keyword">const</span> server = http.<span class="hljs-title function_">createServer</span>(<span class="hljs-function">(<span class="hljs-params">req,res</span>)=&gt;</span>{
    <span class="hljs-keyword">if</span>(req.<span class="hljs-property">url</span> === <span class="hljs-string">'/users'</span>){
        res.<span class="hljs-property">statusCode</span>=<span class="hljs-number">200</span>
        res.<span class="hljs-title function_">setHeader</span>(<span class="hljs-string">'Content-Type'</span>,<span class="hljs-string">'text/html;charset=utf-8'</span>)
        <span class="hljs-keyword">const</span> html=<span class="hljs-title function_">generateHTML</span>(users)  <span class="hljs-comment">// åœ¨æœåŠ¡å™¨ç”Ÿæˆå®Œæ•´HTML</span>
        res.<span class="hljs-title function_">end</span>(html)  <span class="hljs-comment">// è¿”å›ç»™æµè§ˆå™¨</span>
    }
})
</code></pre>
<h4 data-id="heading-5">å·¥ä½œæµç¨‹</h4>
<ol>
<li>ç”¨æˆ·è®¿é—® <code>http://localhost:1314/users</code></li>
<li>æœåŠ¡å™¨æ¥æ”¶åˆ°è¯·æ±‚ï¼Œæ‰§è¡Œå¯¹åº”çš„æ§åˆ¶å™¨é€»è¾‘</li>
<li>ä»æ•°æ®åº“ï¼ˆç¤ºä¾‹ä¸­æ˜¯å†…å­˜æ•°ç»„ï¼‰è·å–ç”¨æˆ·æ•°æ®</li>
<li>å°†æ•°æ®æ³¨å…¥åˆ° HTML æ¨¡æ¿ä¸­ç”Ÿæˆå®Œæ•´çš„é¡µé¢</li>
<li>è¿”å›åŒ…å«æ•°æ®çš„å®Œæ•´ HTML ç»™æµè§ˆå™¨æ˜¾ç¤º</li>
</ol>
<h4 data-id="heading-6">å®é™…è¿è¡Œæ•ˆæœ</h4>
<pre><code class="hljs language-xml" lang="xml">æµè§ˆå™¨è¯·æ±‚: http://localhost:1314/users
â†“
æœåŠ¡å™¨å“åº”:
<span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">table</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">tr</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>1<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>å¼ ä¸‰<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>zhangsan@qq.com<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">tr</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>2<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>æå››<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>lisi@qq.com<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span>
      <span class="hljs-comment">&lt;!-- æ‰€æœ‰æ•°æ®éƒ½åœ¨HTMLä¸­ --&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">table</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span>
</code></pre>
<h4 data-id="heading-7">åŠ£åŠ¿åˆ†æ</h4>
<ol>
<li><strong>å‰åç«¯è€¦åˆä¸¥é‡</strong>ï¼šå‰ç«¯å¼€å‘è€…éœ€è¦äº†è§£åç«¯æ¨¡æ¿è¯­æ³•ï¼Œæ— æ³•ç‹¬ç«‹å·¥ä½œ</li>
<li><strong>é¡µé¢åˆ·æ–°é¢‘ç¹</strong>ï¼šæŸ¥çœ‹ç”¨æˆ·è¯¦æƒ…éœ€è¦é‡æ–°åŠ è½½æ•´ä¸ªé¡µé¢</li>
<li><strong>æœåŠ¡å™¨å‹åŠ›å¤§</strong>ï¼šé«˜å¹¶å‘æ—¶æ¯ä¸ªè¯·æ±‚éƒ½éœ€è¦æ¸²æŸ“å®Œæ•´é¡µé¢</li>
<li><strong>å¼€å‘æ•ˆç‡ä½</strong>ï¼šä¿®æ”¹ä¸€ä¸ªæŒ‰é’®æ ·å¼éœ€è¦åç«¯é‡æ–°éƒ¨ç½²</li>
<li><strong>æŠ€æœ¯æ ˆé™åˆ¶</strong>ï¼šå‰ç«¯æ— æ³•ä½¿ç”¨ç°ä»£æ¡†æ¶å’Œå·¥å…·é“¾</li>
</ol>
<h4 data-id="heading-8">å…¸å‹é—®é¢˜åœºæ™¯</h4>
<p>å‡è®¾è¦æ·»åŠ ä¸€ä¸ª"åˆ é™¤ç”¨æˆ·"åŠŸèƒ½ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// éœ€è¦ä¸ºæ¯ä¸ªç”¨æˆ·æ·»åŠ åˆ é™¤æŒ‰é’®</span>
<span class="hljs-string">`&lt;tr&gt;
    &lt;td&gt;<span class="hljs-subst">${user.id}</span>&lt;/td&gt;
    &lt;td&gt;<span class="hljs-subst">${user.name}</span>&lt;/td&gt;
    &lt;td&gt;<span class="hljs-subst">${user.email}</span>&lt;/td&gt;
    &lt;td&gt;&lt;button onclick="deleteUser(<span class="hljs-subst">${user.id}</span>)"&gt;åˆ é™¤&lt;/button&gt;&lt;/td&gt;
&lt;/tr&gt;`</span>

<span class="hljs-comment">// åˆ é™¤åéœ€è¦åˆ·æ–°æ•´ä¸ªé¡µé¢æ‰èƒ½çœ‹åˆ°æ›´æ–°åçš„åˆ—è¡¨</span>
</code></pre>
<hr/>
<h3 data-id="heading-9">ç¬¬äºŒé˜¶æ®µï¼šå‰åç«¯åˆ†ç¦» + DOM API ç¼–ç¨‹</h3>
<h4 data-id="heading-10">ä»€ä¹ˆæ˜¯å‰åç«¯åˆ†ç¦»ï¼Ÿ</h4>
<p>éšç€ AJAXï¼ˆåå‡çº§ä¸º Fetch APIï¼‰æŠ€æœ¯çš„æˆç†Ÿï¼Œå‰ç«¯å¯ä»¥ç‹¬ç«‹äºåç«¯è¿›è¡Œå¼€å‘ï¼š</p>
<h4 data-id="heading-11">åç«¯ä»£ç å˜åŒ–ï¼ˆAPI åŒ–ï¼‰</h4>
<p>åç«¯ä¸å†è¿”å› HTMLï¼Œè€Œæ˜¯è¿”å› JSON æ•°æ®ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// db.json - çº¯æ•°æ®æ–‡ä»¶</span>
{
    <span class="hljs-string">"users"</span>: [
        {<span class="hljs-string">"id"</span>:<span class="hljs-number">1</span>,<span class="hljs-string">"name"</span>:<span class="hljs-string">"å¼ ä¸‰"</span>,<span class="hljs-string">"email"</span>:<span class="hljs-string">"zhangsan@qq.com"</span>},
        {<span class="hljs-string">"id"</span>:<span class="hljs-number">2</span>,<span class="hljs-string">"name"</span>:<span class="hljs-string">"æå››"</span>,<span class="hljs-string">"email"</span>:<span class="hljs-string">"lisi@qq.com"</span>}
    ]
}
</code></pre>
<h4 data-id="heading-12">å‰ç«¯ç‹¬ç«‹å¼€å‘</h4>
<p><code>index.html</code> å±•ç¤ºäº†å¦‚ä½•ç‹¬ç«‹è·å–å’Œå±•ç¤ºæ•°æ®ï¼š</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"en"</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
    <span class="hljs-comment">&lt;!-- ç‹¬ç«‹çš„å‰ç«¯é¡µé¢ --&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>Users<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">table</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">thead</span>&gt;</span>...<span class="hljs-tag">&lt;/<span class="hljs-name">thead</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">tbody</span>&gt;</span>
            <span class="hljs-comment">&lt;!-- åˆå§‹ä¸ºç©ºï¼Œé€šè¿‡JSåŠ¨æ€å¡«å…… --&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">tbody</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">table</span>&gt;</span>
    
    <span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">
        <span class="hljs-comment">// ä¸»åŠ¨å‘åç«¯è¯·æ±‚æ•°æ®</span>
        <span class="hljs-title function_">fetch</span>(<span class="hljs-string">'http://localhost:3000/users'</span>)
        .<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">res</span> =&gt;</span> res.<span class="hljs-title function_">json</span>())
        .<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">data</span> =&gt;</span> {
            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'è·å–åˆ°çš„æ•°æ®:'</span>, data)
            
            <span class="hljs-comment">// æ‰‹åŠ¨æ“ä½œDOMæ›´æ–°ç•Œé¢</span>
            <span class="hljs-keyword">const</span> tbody = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelector</span>(<span class="hljs-string">'tbody'</span>)
            
            <span class="hljs-comment">// æ‹¼æ¥HTMLå­—ç¬¦ä¸²</span>
            <span class="hljs-keyword">const</span> rowsHTML = data.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">user</span> =&gt;</span> 
                <span class="hljs-string">`&lt;tr&gt;
                    &lt;td&gt;<span class="hljs-subst">${user.id}</span>&lt;/td&gt;
                    &lt;td&gt;<span class="hljs-subst">${user.name}</span>&lt;/td&gt;
                    &lt;td&gt;<span class="hljs-subst">${user.email}</span>&lt;/td&gt;
                    &lt;td&gt;
                        &lt;button onclick="deleteUser(<span class="hljs-subst">${user.id}</span>)"&gt;
                            åˆ é™¤
                        &lt;/button&gt;
                    &lt;/td&gt;
                &lt;/tr&gt;`</span>
            ).<span class="hljs-title function_">join</span>(<span class="hljs-string">''</span>)
            
            <span class="hljs-comment">// æ›´æ–°DOM</span>
            tbody.<span class="hljs-property">innerHTML</span> = rowsHTML
        })
        
        <span class="hljs-comment">// åˆ é™¤ç”¨æˆ·çš„å‡½æ•°</span>
        <span class="hljs-keyword">function</span> <span class="hljs-title function_">deleteUser</span>(<span class="hljs-params">id</span>) {
            <span class="hljs-title function_">fetch</span>(<span class="hljs-string">`http://localhost:3000/users/<span class="hljs-subst">${id}</span>`</span>, {
                <span class="hljs-attr">method</span>: <span class="hljs-string">'DELETE'</span>
            })
            .<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> {
                <span class="hljs-comment">// åˆ é™¤æˆåŠŸåï¼Œéœ€è¦é‡æ–°è·å–æ•°æ®å¹¶æ›´æ–°DOM</span>
                <span class="hljs-title function_">fetch</span>(<span class="hljs-string">'http://localhost:3000/users'</span>)
                .<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">res</span> =&gt;</span> res.<span class="hljs-title function_">json</span>())
                .<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">data</span> =&gt;</span> {
                    <span class="hljs-keyword">const</span> tbody = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelector</span>(<span class="hljs-string">'tbody'</span>)
                    <span class="hljs-keyword">const</span> rowsHTML = data.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">user</span> =&gt;</span> 
                        <span class="hljs-string">`&lt;tr&gt;...&lt;/tr&gt;`</span>
                    ).<span class="hljs-title function_">join</span>(<span class="hljs-string">''</span>)
                    tbody.<span class="hljs-property">innerHTML</span> = rowsHTML
                })
            })
        }
    </span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span>
</code></pre>
<h4 data-id="heading-13">å¯¹æ¯”å‰ä¸€é˜¶æ®µçš„ä¼˜åŠ¿</h4>
<h5 data-id="heading-14">1. <strong>å¼€å‘å®Œå…¨è§£è€¦</strong></h5>
<pre><code class="hljs language-makefile" lang="makefile"><span class="hljs-section">å‰ç«¯å›¢é˜Ÿ: HTML/CSS/JSç‹¬ç«‹å¼€å‘ï¼Œä½¿ç”¨Mockæ•°æ®</span>
<span class="hljs-section">åç«¯å›¢é˜Ÿ: ä¸“æ³¨APIå¼€å‘å’Œæ•°æ®åº“ä¼˜åŒ–</span>
<span class="hljs-section">æµ‹è¯•å›¢é˜Ÿ: å¯ç‹¬ç«‹æµ‹è¯•APIå’Œå‰ç«¯åŠŸèƒ½</span>
</code></pre>
<h5 data-id="heading-15">2. <strong>ç”¨æˆ·ä½“éªŒæå‡</strong></h5>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// å®ç°æœç´¢åŠŸèƒ½è€Œæ— éœ€åˆ·æ–°é¡µé¢</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">searchUsers</span>(<span class="hljs-params">keyword</span>) {
    <span class="hljs-title function_">fetch</span>(<span class="hljs-string">`http://localhost:3000/users?q=<span class="hljs-subst">${keyword}</span>`</span>)
    .<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">res</span> =&gt;</span> res.<span class="hljs-title function_">json</span>())
    .<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">data</span> =&gt;</span> {
        <span class="hljs-comment">// åªæ›´æ–°è¡¨æ ¼å†…å®¹ï¼Œé¡µé¢å…¶ä»–éƒ¨åˆ†ä¿æŒä¸å˜</span>
        <span class="hljs-title function_">updateTable</span>(data)
    })
}
</code></pre>
<h5 data-id="heading-16">3. <strong>æŠ€æœ¯é€‰å‹è‡ªç”±</strong></h5>
<ul>
<li>å‰ç«¯å¯ä»¥é€‰æ‹© Reactã€Vueã€Angular æˆ–ä¿æŒåŸç”Ÿ</li>
<li>åç«¯å¯ä»¥ä½¿ç”¨ Javaã€Pythonã€Go ç­‰ä»»æ„è¯­è¨€</li>
<li>å„è‡ªç‹¬ç«‹éƒ¨ç½²å’Œæ‰©å±•</li>
</ul>
<h4 data-id="heading-17">åŠ£åŠ¿åˆ†æ</h4>
<h5 data-id="heading-18">1. <strong>DOM æ“ä½œç¹çä¸”é‡å¤</strong></h5>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// æ¯æ¬¡æ•°æ®å˜åŒ–éƒ½éœ€è¦è¿™æ ·æ“ä½œ</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">updateTable</span>(<span class="hljs-params">users</span>) {
    <span class="hljs-keyword">const</span> tbody = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelector</span>(<span class="hljs-string">'tbody'</span>)
    tbody.<span class="hljs-property">innerHTML</span> = <span class="hljs-string">''</span>
    
    users.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">user</span> =&gt;</span> {
        <span class="hljs-keyword">const</span> tr = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createElement</span>(<span class="hljs-string">'tr'</span>)
        
        <span class="hljs-keyword">const</span> td1 = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createElement</span>(<span class="hljs-string">'td'</span>)
        td1.<span class="hljs-property">textContent</span> = user.<span class="hljs-property">id</span>
        tr.<span class="hljs-title function_">appendChild</span>(td1)
        
        <span class="hljs-keyword">const</span> td2 = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createElement</span>(<span class="hljs-string">'td'</span>)
        td2.<span class="hljs-property">textContent</span> = user.<span class="hljs-property">name</span>
        tr.<span class="hljs-title function_">appendChild</span>(td2)
        
        <span class="hljs-comment">// ... é‡å¤çš„åˆ›å»ºå’Œè¿½åŠ æ“ä½œ</span>
        
        tbody.<span class="hljs-title function_">appendChild</span>(tr)
    })
}

<span class="hljs-comment">// æˆ–è€…ä½¿ç”¨innerHTMLæ–¹å¼</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">updateTable2</span>(<span class="hljs-params">users</span>) {
    <span class="hljs-keyword">const</span> tbody = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelector</span>(<span class="hljs-string">'tbody'</span>)
    <span class="hljs-keyword">const</span> html = users.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">user</span> =&gt;</span> <span class="hljs-string">`
        &lt;tr&gt;
            &lt;td&gt;<span class="hljs-subst">${user.id}</span>&lt;/td&gt;
            &lt;td&gt;<span class="hljs-subst">${user.name}</span>&lt;/td&gt;
            &lt;td&gt;<span class="hljs-subst">${user.email}</span>&lt;/td&gt;
        &lt;/tr&gt;
    `</span>).<span class="hljs-title function_">join</span>(<span class="hljs-string">''</span>)
    tbody.<span class="hljs-property">innerHTML</span> = html
}
</code></pre>
<h5 data-id="heading-19">2. <strong>çŠ¶æ€ç®¡ç†æ··ä¹±</strong></h5>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">let</span> currentUsers = []
<span class="hljs-keyword">let</span> filteredUsers = []
<span class="hljs-keyword">let</span> selectedUserId = <span class="hljs-literal">null</span>

<span class="hljs-comment">// æ•°æ®å˜åŒ–æ—¶éœ€è¦æ‰‹åŠ¨åŒæ­¥å¤šä¸ªåœ°æ–¹</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">deleteUser</span>(<span class="hljs-params">id</span>) {
    <span class="hljs-comment">// 1. å‘é€åˆ é™¤è¯·æ±‚</span>
    <span class="hljs-title function_">fetch</span>(<span class="hljs-string">`/users/<span class="hljs-subst">${id}</span>`</span>, {<span class="hljs-attr">method</span>: <span class="hljs-string">'DELETE'</span>})
    
    <span class="hljs-comment">// 2. æ›´æ–°å½“å‰æ•°æ®æ•°ç»„</span>
    currentUsers = currentUsers.<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">u</span> =&gt;</span> u.<span class="hljs-property">id</span> !== id)
    filteredUsers = filteredUsers.<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">u</span> =&gt;</span> u.<span class="hljs-property">id</span> !== id)
    
    <span class="hljs-comment">// 3. å¦‚æœåˆ é™¤çš„æ˜¯é€‰ä¸­ç”¨æˆ·ï¼Œæ¸…ç©ºé€‰ä¸­çŠ¶æ€</span>
    <span class="hljs-keyword">if</span> (selectedUserId === id) {
        selectedUserId = <span class="hljs-literal">null</span>
        <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelector</span>(<span class="hljs-string">'.selected'</span>).<span class="hljs-property">classList</span>.<span class="hljs-title function_">remove</span>(<span class="hljs-string">'selected'</span>)
    }
    
    <span class="hljs-comment">// 4. æ›´æ–°DOMæ˜¾ç¤º</span>
    <span class="hljs-title function_">updateTable</span>(filteredUsers)
    
    <span class="hljs-comment">// 5. æ›´æ–°ç»Ÿè®¡æ•°æ®</span>
    <span class="hljs-title function_">updateStats</span>(currentUsers)
}
</code></pre>
<h5 data-id="heading-20">3. <strong>æ€§èƒ½é—®é¢˜</strong></h5>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// æ¯æ¬¡æ›´æ–°éƒ½é‡æ–°æ¸²æŸ“æ•´ä¸ªè¡¨æ ¼</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">updateTable</span>(<span class="hljs-params">users</span>) {
    <span class="hljs-keyword">const</span> tbody = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelector</span>(<span class="hljs-string">'tbody'</span>)
    tbody.<span class="hljs-property">innerHTML</span> = <span class="hljs-string">''</span>  <span class="hljs-comment">// æ¸…ç©ºæ‰€æœ‰DOMèŠ‚ç‚¹</span>
    
    <span class="hljs-comment">// é‡æ–°åˆ›å»ºæ‰€æœ‰èŠ‚ç‚¹</span>
    users.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">user</span> =&gt;</span> {
        <span class="hljs-comment">// å³ä½¿åªæœ‰ä¸€é¡¹æ•°æ®å˜åŒ–ï¼Œä¹Ÿè¦é‡ç»˜æ‰€æœ‰è¡Œ</span>
    })
}

<span class="hljs-comment">// 1000è¡Œæ•°æ®æ—¶ä¼šå‡ºç°æ˜æ˜¾å¡é¡¿</span>
<span class="hljs-title function_">updateTable</span>(largeUserList)  <span class="hljs-comment">// å¯èƒ½é˜»å¡ä¸»çº¿ç¨‹å‡ æ¯«ç§’</span>
</code></pre>
<h5 data-id="heading-21">4. <strong>å…³æ³¨ç‚¹åç¦»</strong></h5>
<p>å¼€å‘è€…èŠ±è´¹å¤§é‡æ—¶é—´åœ¨ï¼š</p>
<ul>
<li>DOM é€‰æ‹©å™¨çš„ç¼–å†™å’Œç»´æŠ¤</li>
<li>äº‹ä»¶å§”æ‰˜å’Œå†’æ³¡å¤„ç†</li>
<li>æ‰‹åŠ¨å¤„ç†çŠ¶æ€åŒæ­¥</li>
<li>æ€§èƒ½ä¼˜åŒ–ï¼ˆé˜²æŠ–ã€èŠ‚æµã€è™šæ‹Ÿåˆ—è¡¨ï¼‰</li>
</ul>
<p>è€Œä¸æ˜¯ä¸“æ³¨äºä¸šåŠ¡é€»è¾‘æœ¬èº«ã€‚</p>
<hr/>
<h3 data-id="heading-22">ç¬¬ä¸‰é˜¶æ®µï¼šVue å“åº”å¼æ•°æ®é©±åŠ¨</h3>
<h4 data-id="heading-23">ä»€ä¹ˆæ˜¯å“åº”å¼æ•°æ®é©±åŠ¨ï¼Ÿ</h4>
<p>å“åº”å¼ç¼–ç¨‹çš„æ ¸å¿ƒæ€æƒ³æ˜¯ï¼š<strong>æ•°æ®å˜åŒ–è‡ªåŠ¨é©±åŠ¨ç•Œé¢æ›´æ–°</strong>ã€‚</p>
<h4 data-id="heading-24">å®Œæ•´ä»£ç ç¤ºä¾‹</h4>
<p><code>App.vue</code> å±•ç¤ºäº† Vue 3 çš„å“åº”å¼ç¼–ç¨‹ï¼š</p>
<pre><code class="hljs language-vue" lang="vue">&lt;script setup&gt;
// å¯¼å…¥å“åº”å¼API
import { ref, onMounted } from 'vue'

// åˆ›å»ºå“åº”å¼æ•°æ®
const users = ref([])
const isLoading = ref(false)
const searchKeyword = ref('')

// ç»„ä»¶æŒ‚è½½åè‡ªåŠ¨æ‰§è¡Œ
onMounted(() =&gt; {
    console.log('ç»„ä»¶å·²æŒ‚è½½ï¼Œå¼€å§‹è·å–æ•°æ®')
    loadUsers()
})

// åŠ è½½ç”¨æˆ·æ•°æ®
function loadUsers() {
    isLoading.value = true  // ç•Œé¢è‡ªåŠ¨æ˜¾ç¤ºåŠ è½½çŠ¶æ€
    
    fetch('http://localhost:3000/users')
    .then(res =&gt; res.json())
    .then(data =&gt; {
        users.value = data  // èµ‹å€¼åç•Œé¢è‡ªåŠ¨æ›´æ–°
        isLoading.value = false
    })
    .catch(error =&gt; {
        console.error('åŠ è½½å¤±è´¥:', error)
        isLoading.value = false
    })
}

// åˆ é™¤ç”¨æˆ·
function deleteUser(id) {
    if (confirm('ç¡®å®šè¦åˆ é™¤å—ï¼Ÿ')) {
        // 1. å…ˆä»å‰ç«¯ç§»é™¤ï¼ˆç«‹å³å“åº”ï¼‰
        users.value = users.value.filter(user =&gt; user.id !== id)
        
        // 2. åå‘é€è¯·æ±‚åˆ°æœåŠ¡å™¨
        fetch(`http://localhost:3000/users/${id}`, {
            method: 'DELETE'
        }).catch(error =&gt; {
            // å¦‚æœå¤±è´¥ï¼Œå¯ä»¥å›æ»šæˆ–æç¤º
            console.error('åˆ é™¤å¤±è´¥:', error)
            loadUsers()  // é‡æ–°åŠ è½½æ•°æ®
        })
    }
}

// è®¡ç®—å±æ€§ï¼šè¿‡æ»¤åçš„ç”¨æˆ·
const filteredUsers = computed(() =&gt; {
    if (!searchKeyword.value) return users.value
    
    return users.value.filter(user =&gt;
        user.name.includes(searchKeyword.value) ||
        user.email.includes(searchKeyword.value)
    )
})
&lt;/script&gt;

&lt;template&gt;
    &lt;div class="user-management"&gt;
        &lt;!-- æœç´¢æ¡† --&gt;
        &lt;div class="search-box"&gt;
            &lt;input 
                v-model="searchKeyword" 
                placeholder="æœç´¢ç”¨æˆ·..."
                @input="searchUsers"
            /&gt;
            &lt;span&gt;æ‰¾åˆ° {{ filteredUsers.length }} ä¸ªç”¨æˆ·&lt;/span&gt;
        &lt;/div&gt;
        
        &lt;!-- åŠ è½½çŠ¶æ€ --&gt;
        &lt;div v-if="isLoading" class="loading"&gt;
            åŠ è½½ä¸­...
        &lt;/div&gt;
        
        &lt;!-- ç”¨æˆ·è¡¨æ ¼ --&gt;
        &lt;table v-else&gt;
            &lt;thead&gt;
                &lt;tr&gt;
                    &lt;th&gt;ID&lt;/th&gt;
                    &lt;th&gt;å§“å&lt;/th&gt;
                    &lt;th&gt;é‚®ç®±&lt;/th&gt;
                    &lt;th&gt;æ“ä½œ&lt;/th&gt;
                &lt;/tr&gt;
            &lt;/thead&gt;
            &lt;tbody&gt;
                &lt;!-- å“åº”å¼æ•°æ®ç»‘å®š --&gt;
                &lt;tr v-for="user in filteredUsers" :key="user.id"&gt;
                    &lt;td&gt;{{ user.id }}&lt;/td&gt;
                    &lt;td&gt;{{ user.name }}&lt;/td&gt;
                    &lt;td&gt;{{ user.email }}&lt;/td&gt;
                    &lt;td&gt;
                        &lt;button @click="deleteUser(user.id)"&gt;
                            åˆ é™¤
                        &lt;/button&gt;
                    &lt;/td&gt;
                &lt;/tr&gt;
            &lt;/tbody&gt;
        &lt;/table&gt;
        
        &lt;!-- ç©ºçŠ¶æ€ --&gt;
        &lt;div v-if="!isLoading &amp;&amp; filteredUsers.length === 0"&gt;
            æ²¡æœ‰æ‰¾åˆ°ç”¨æˆ·
        &lt;/div&gt;
    &lt;/div&gt;
&lt;/template&gt;

&lt;style scoped&gt;
/* ç»„ä»¶ä½œç”¨åŸŸæ ·å¼ */
.user-management {
    padding: 20px;
}

.search-box {
    margin-bottom: 20px;
}

table {
    width: 100%;
    border-collapse: collapse;
}

tr:hover {
    background-color: #f5f5f5;
}
&lt;/style&gt;
</code></pre>
<h4 data-id="heading-25">æ ¸å¿ƒä¼˜åŠ¿è¯¦è§£</h4>
<h5 data-id="heading-26">1. <strong>å£°æ˜å¼ç¼–ç¨‹ vs å‘½ä»¤å¼ç¼–ç¨‹</strong></h5>
<pre><code class="hljs language-vue" lang="vue">&lt;!-- å£°æ˜å¼ï¼šå‘Šè¯‰æ¡†æ¶"è¦æ˜¾ç¤ºä»€ä¹ˆ" --&gt;
&lt;tr v-for="user in users" :key="user.id"&gt;
    &lt;td&gt;{{ user.id }}&lt;/td&gt;
    &lt;td&gt;{{ user.name }}&lt;/td&gt;
&lt;/tr&gt;

&lt;!-- å¯¹æ¯”å‘½ä»¤å¼ï¼šå‘Šè¯‰æµè§ˆå™¨"å¦‚ä½•æ˜¾ç¤º" --&gt;
// const tbody = document.querySelector('tbody')
// tbody.innerHTML = ''
// users.forEach(user =&gt; {
//     const tr = document.createElement('tr')
//     // ... æ‰‹åŠ¨åˆ›å»ºæ¯ä¸ªå…ƒç´ 
// })
</code></pre>
<h5 data-id="heading-27">2. <strong>å“åº”å¼æ•°æ®ç³»ç»Ÿ</strong></h5>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// åˆ›å»ºå“åº”å¼æ•°æ®</span>
<span class="hljs-keyword">const</span> users = <span class="hljs-title function_">ref</span>([])

<span class="hljs-comment">// æ·»åŠ æ–°ç”¨æˆ·ï¼ˆç•Œé¢è‡ªåŠ¨æ›´æ–°ï¼‰</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">addUser</span>(<span class="hljs-params">newUser</span>) {
    users.<span class="hljs-property">value</span>.<span class="hljs-title function_">push</span>(newUser)  <span class="hljs-comment">// è¡¨æ ¼è‡ªåŠ¨å¢åŠ ä¸€è¡Œ</span>
}

<span class="hljs-comment">// ä¿®æ”¹ç”¨æˆ·ä¿¡æ¯ï¼ˆç•Œé¢è‡ªåŠ¨æ›´æ–°ï¼‰</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">updateUser</span>(<span class="hljs-params">id, newData</span>) {
    <span class="hljs-keyword">const</span> user = users.<span class="hljs-property">value</span>.<span class="hljs-title function_">find</span>(<span class="hljs-function"><span class="hljs-params">u</span> =&gt;</span> u.<span class="hljs-property">id</span> === id)
    <span class="hljs-keyword">if</span> (user) {
        <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">assign</span>(user, newData)  <span class="hljs-comment">// å¯¹åº”è¡Œè‡ªåŠ¨æ›´æ–°</span>
    }
}

<span class="hljs-comment">// æ— éœ€æ‰‹åŠ¨æ“ä½œDOMï¼</span>
</code></pre>
<h5 data-id="heading-28">3. <strong>è‡ªåŠ¨ä¾èµ–è·Ÿè¸ª</strong></h5>
<pre><code class="hljs language-vue" lang="vue">&lt;template&gt;
    &lt;div&gt;
        ç”¨æˆ·æ€»æ•°: {{ totalUsers }}
        æ´»è·ƒç”¨æˆ·: {{ activeUsers }}
    &lt;/div&gt;
&lt;/template&gt;

&lt;script setup&gt;
const users = ref([])
const showActiveOnly = ref(false)

// è®¡ç®—å±æ€§ï¼šè‡ªåŠ¨è¿½è¸ªä¾èµ–
const totalUsers = computed(() =&gt; users.value.length)

const activeUsers = computed(() =&gt; {
    // è‡ªåŠ¨è¿½è¸ª users å’Œ showActiveOnly
    if (!showActiveOnly.value) return users.value.length
    
    return users.value.filter(user =&gt; user.isActive).length
})

// å½“ users æˆ– showActiveOnly å˜åŒ–æ—¶
// totalUsers å’Œ activeUsers è‡ªåŠ¨é‡æ–°è®¡ç®—
// ç•Œé¢è‡ªåŠ¨æ›´æ–°
&lt;/script&gt;
</code></pre>
<h5 data-id="heading-29">4. <strong>è™šæ‹Ÿ DOM æ€§èƒ½ä¼˜åŒ–</strong></h5>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// Vue å†…éƒ¨å·¥ä½œåŸç†ï¼š</span>
<span class="hljs-comment">// 1. æ•°æ®å˜åŒ–æ—¶ï¼Œåˆ›å»ºæ–°çš„è™šæ‹ŸDOM</span>
<span class="hljs-keyword">const</span> newVNode = <span class="hljs-title function_">createVNode</span>(users.<span class="hljs-property">value</span>)

<span class="hljs-comment">// 2. ä¸æ—§çš„è™šæ‹ŸDOMæ¯”è¾ƒå·®å¼‚</span>
<span class="hljs-keyword">const</span> patches = <span class="hljs-title function_">diff</span>(oldVNode, newVNode)

<span class="hljs-comment">// 3. åªæ›´æ–°æœ‰å˜åŒ–çš„éƒ¨åˆ†</span>
<span class="hljs-title function_">patch</span>(domNode, patches)

<span class="hljs-comment">// ç»“æœï¼š1000è¡Œæ•°æ®ä¸­ä¿®æ”¹1è¡Œ</span>
<span class="hljs-comment">// åŸç”ŸDOM: å¯èƒ½é‡ç»˜1000è¡Œ</span>
<span class="hljs-comment">// Vue: åªæ›´æ–°1è¡Œ</span>
</code></pre>
<h5 data-id="heading-30">5. <strong>ç»„ä»¶åŒ–å¼€å‘</strong></h5>
<pre><code class="hljs language-vue" lang="vue">&lt;!-- UserList.vue --&gt;
&lt;script setup&gt;
// æ¥æ”¶çˆ¶ç»„ä»¶ä¼ é€’çš„æ•°æ®
const props = defineProps(['users', 'onDelete'])

// å®šä¹‰å‘çˆ¶ç»„ä»¶å‘é€çš„äº‹ä»¶
const emit = defineEmits(['user-selected'])
&lt;/script&gt;

&lt;!-- UserItem.vue --&gt;
&lt;script setup&gt;
// æ›´å°ç»„ä»¶ï¼Œæ›´é«˜å¤ç”¨æ€§
const props = defineProps(['user'])
&lt;/script&gt;

&lt;!-- App.vue --&gt;
&lt;template&gt;
    &lt;UserList 
        :users="filteredUsers"
        @user-selected="handleSelect"
    /&gt;
&lt;/template&gt;
</code></pre>
<h4 data-id="heading-31">å®é™…åœºæ™¯å¯¹æ¯”</h4>
<p><strong>åœºæ™¯ï¼šå®ç°ç”¨æˆ·åˆ—è¡¨çš„æœç´¢ã€æ’åºã€åˆ†é¡µ</strong></p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// åŸç”ŸJSå®ç°ï¼ˆçº¦100è¡Œä»£ç ï¼‰</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">UserTable</span> {
    <span class="hljs-title function_">constructor</span>(<span class="hljs-params"/>) {
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">users</span> = []
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">filteredUsers</span> = []
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">sortField</span> = <span class="hljs-string">'id'</span>
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">sortDirection</span> = <span class="hljs-string">'asc'</span>
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">currentPage</span> = <span class="hljs-number">1</span>
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">pageSize</span> = <span class="hljs-number">10</span>
        
        <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">init</span>()
        <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">bindEvents</span>()
        <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">loadData</span>()
    }
    
    <span class="hljs-comment">// éœ€è¦æ‰‹åŠ¨å¤„ç†æ‰€æœ‰çŠ¶æ€åŒæ­¥å’ŒDOMæ›´æ–°</span>
    <span class="hljs-comment">// ä»£ç å¤æ‚ï¼Œéš¾ä»¥ç»´æŠ¤</span>
}

<span class="hljs-comment">// Vueå®ç°ï¼ˆçº¦30è¡Œä»£ç ï¼‰</span>
<span class="hljs-keyword">const</span> users = <span class="hljs-title function_">ref</span>([])
<span class="hljs-keyword">const</span> searchKeyword = <span class="hljs-title function_">ref</span>(<span class="hljs-string">''</span>)
<span class="hljs-keyword">const</span> sortField = <span class="hljs-title function_">ref</span>(<span class="hljs-string">'id'</span>)
<span class="hljs-keyword">const</span> page = <span class="hljs-title function_">ref</span>(<span class="hljs-number">1</span>)

<span class="hljs-keyword">const</span> displayedUsers = <span class="hljs-title function_">computed</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">let</span> result = [...users.<span class="hljs-property">value</span>]
    
    <span class="hljs-comment">// ç­›é€‰</span>
    <span class="hljs-keyword">if</span> (searchKeyword.<span class="hljs-property">value</span>) {
        result = result.<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">u</span> =&gt;</span> 
            u.<span class="hljs-property">name</span>.<span class="hljs-title function_">includes</span>(searchKeyword.<span class="hljs-property">value</span>)
        )
    }
    
    <span class="hljs-comment">// æ’åº</span>
    result.<span class="hljs-title function_">sort</span>(<span class="hljs-function">(<span class="hljs-params">a, b</span>) =&gt;</span> {
        <span class="hljs-keyword">if</span> (sortField.<span class="hljs-property">value</span> === <span class="hljs-string">'name'</span>) {
            <span class="hljs-keyword">return</span> a.<span class="hljs-property">name</span>.<span class="hljs-title function_">localeCompare</span>(b.<span class="hljs-property">name</span>)
        }
        <span class="hljs-keyword">return</span> a.<span class="hljs-property">id</span> - b.<span class="hljs-property">id</span>
    })
    
    <span class="hljs-comment">// åˆ†é¡µ</span>
    <span class="hljs-keyword">const</span> start = (page.<span class="hljs-property">value</span> - <span class="hljs-number">1</span>) * <span class="hljs-number">10</span>
    <span class="hljs-keyword">return</span> result.<span class="hljs-title function_">slice</span>(start, start + <span class="hljs-number">10</span>)
})
</code></pre>
<h4 data-id="heading-32">ä¸ºä»€ä¹ˆå“åº”å¼æ˜¯é©å‘½æ€§çš„ï¼Ÿ</h4>
<ol>
<li><strong>å¼€å‘æ•ˆç‡æå‡ 3-5 å€</strong>ï¼šå‡å°‘å¤§é‡é‡å¤çš„ DOM æ“ä½œä»£ç </li>
<li><strong>ä»£ç å¯ç»´æŠ¤æ€§å¤§å¹…æé«˜</strong>ï¼šæ•°æ®æµå‘æ¸…æ™°ï¼Œæ˜“äºè°ƒè¯•</li>
<li><strong>æ€§èƒ½æ›´ä¼˜</strong>ï¼šæ™ºèƒ½çš„æ›´æ–°ç­–ç•¥å’Œè™šæ‹Ÿ DOM</li>
<li><strong>æ›´å¥½çš„å¼€å‘ä½“éªŒ</strong>ï¼šçƒ­é‡è½½ã€TypeScript æ”¯æŒã€DevTools</li>
<li><strong>å›¢é˜Ÿåä½œæ›´é¡ºç•…</strong>ï¼šæ¸…æ™°çš„ç»„ä»¶æ¥å£å’ŒèŒè´£åˆ’åˆ†</li>
</ol>
<hr/>
<h3 data-id="heading-33">å‘å±•å†ç¨‹æ€»ç»“</h3>

































<table><thead><tr><th>é˜¶æ®µ</th><th>æ ¸å¿ƒæŠ€æœ¯</th><th>æ•°æ®æµå‘</th><th>ä»£ç é‡å¯¹æ¯”</th><th>ç»´æŠ¤éš¾åº¦</th></tr></thead><tbody><tr><td>çº¯åç«¯æ¨¡æ¿</td><td>æœåŠ¡å™¨æ¸²æŸ“ã€æ¨¡æ¿å¼•æ“</td><td>æœåŠ¡å™¨ â†’ HTML</td><td>ä¸­ç­‰</td><td>é«˜ï¼ˆå‰åç«¯è€¦åˆï¼‰</td></tr><tr><td>å‰åç«¯åˆ†ç¦»</td><td>Fetch API + DOMæ“ä½œ</td><td>æœåŠ¡å™¨ â†’ JSON â†’ DOM</td><td>å¤šï¼ˆé‡å¤DOMæ“ä½œï¼‰</td><td>ä¸­ï¼ˆçŠ¶æ€ç®¡ç†å¤æ‚ï¼‰</td></tr><tr><td>å“åº”å¼é©±åŠ¨</td><td>Vue/Reactå“åº”å¼ç³»ç»Ÿ</td><td>æ•°æ® â†” è‡ªåŠ¨æ›´æ–°</td><td>å°‘ï¼ˆä¸“æ³¨ä¸šåŠ¡é€»è¾‘ï¼‰</td><td>ä½ï¼ˆæ•°æ®é©±åŠ¨ï¼‰</td></tr></tbody></table>
<h4 data-id="heading-34">æ€§èƒ½å¯¹æ¯”ç¤ºä¾‹</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// æ›´æ–°1000æ¡ç”¨æˆ·æ•°æ®ä¸­çš„1æ¡ï¼š</span>

<span class="hljs-comment">// é˜¶æ®µä¸€ï¼šåç«¯æ¨¡æ¿ - æ•´ä¸ªé¡µé¢åˆ·æ–°ï¼ˆæ…¢ï¼‰</span>
location.<span class="hljs-title function_">reload</span>()

<span class="hljs-comment">// é˜¶æ®µäºŒï¼šDOMæ“ä½œ - é‡ç»˜æ•´ä¸ªè¡¨æ ¼ï¼ˆä¸­ç­‰ï¼‰</span>
tbody.<span class="hljs-property">innerHTML</span> = newHTML  <span class="hljs-comment">// å¯èƒ½16ms</span>

<span class="hljs-comment">// é˜¶æ®µä¸‰ï¼šå“åº”å¼ - åªæ›´æ–°1è¡Œï¼ˆå¿«ï¼‰</span>
users.<span class="hljs-property">value</span>[<span class="hljs-number">5</span>].<span class="hljs-property">name</span> = <span class="hljs-string">'æ–°åå­—'</span>  <span class="hljs-comment">// &lt;1ms</span>
</code></pre>
<hr/>
<h3 data-id="heading-35">ç»™åˆå­¦è€…çš„å­¦ä¹ è·¯å¾„å»ºè®®</h3>
<h4 data-id="heading-36">ç¬¬ä¸€æ­¥ï¼šæ‰“å¥½åŸºç¡€ï¼ˆ2-4å‘¨ï¼‰</h4>
<pre><code class="hljs language-html" lang="html"><span class="hljs-comment">&lt;!-- ç†è§£åŸç”ŸDOMæ“ä½œ --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onclick</span>=<span class="hljs-string">"handleClick()"</span>&gt;</span>ç‚¹å‡»æˆ‘<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">function</span> <span class="hljs-title function_">handleClick</span>(<span class="hljs-params"/>) {
    <span class="hljs-comment">// æ‰‹åŠ¨æ›´æ–°DOM</span>
    <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'result'</span>).<span class="hljs-property">textContent</span> = <span class="hljs-string">'å·²ç‚¹å‡»'</span>
}
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
</code></pre>
<h4 data-id="heading-37">ç¬¬äºŒæ­¥ï¼šå­¦ä¹ å‰åç«¯åˆ†ç¦»ï¼ˆ2-3å‘¨ï¼‰</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// æŒæ¡Fetch API</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">loadData</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(<span class="hljs-string">'/api/data'</span>)
    <span class="hljs-keyword">const</span> data = <span class="hljs-keyword">await</span> response.<span class="hljs-title function_">json</span>()
    
    <span class="hljs-comment">// æ‰‹åŠ¨æ›´æ–°ç•Œé¢</span>
    <span class="hljs-title function_">renderData</span>(data)
}
</code></pre>
<h4 data-id="heading-38">ç¬¬ä¸‰æ­¥ï¼šæ‹¥æŠ±å“åº”å¼ï¼ˆ3-6å‘¨ï¼‰</h4>
<pre><code class="hljs language-vue" lang="vue">&lt;!-- ä»ç®€å•çš„è®¡æ•°å™¨å¼€å§‹ --&gt;
&lt;script setup&gt;
const count = ref(0)
&lt;/script&gt;

&lt;template&gt;
    &lt;button @click="count++"&gt;
        ç‚¹å‡»äº† {{ count }} æ¬¡
    &lt;/button&gt;
&lt;/template&gt;
</code></pre>
<h4 data-id="heading-39">ç¬¬å››æ­¥ï¼šæ·±å…¥ç†è§£åŸç†</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// å°è¯•è‡ªå·±å®ç°ç®€å•çš„å“åº”å¼ç³»ç»Ÿ</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">createReactive</span>(<span class="hljs-params">obj</span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Proxy</span>(obj, {
        <span class="hljs-title function_">get</span>(<span class="hljs-params">target, key</span>) {
            <span class="hljs-title function_">track</span>(target, key)  <span class="hljs-comment">// ä¾èµ–æ”¶é›†</span>
            <span class="hljs-keyword">return</span> target[key]
        },
        <span class="hljs-title function_">set</span>(<span class="hljs-params">target, key, value</span>) {
            target[key] = value
            <span class="hljs-title function_">trigger</span>(target, key)  <span class="hljs-comment">// è§¦å‘æ›´æ–°</span>
            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>
        }
    })
}
</code></pre>
<hr/>
<h3 data-id="heading-40">æœªæ¥å±•æœ›ä¸è¶‹åŠ¿</h3>
<h4 data-id="heading-41">1. <strong>ç¼–è¯‘æ—¶ä¼˜åŒ–</strong></h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// Vue 3 çš„ `&lt;script setup&gt;` ç¼–è¯‘æ—¶ä¼˜åŒ–</span>
<span class="hljs-comment">// æ›´å°çš„æ‰“åŒ…ä½“ç§¯ï¼Œæ›´å¥½çš„æ€§èƒ½</span>

<span class="hljs-comment">// React Server Components</span>
<span class="hljs-comment">// æœåŠ¡å™¨ç«¯ç»„ä»¶ï¼Œå‡å°‘å®¢æˆ·ç«¯ä»£ç </span>
</code></pre>
<h4 data-id="heading-42">2. <strong>è·¨å¹³å°ç»Ÿä¸€</strong></h4>
<pre><code class="hljs language-vue" lang="vue">&lt;!-- åŒä¸€å¥—ä»£ç ï¼Œå¤šç«¯è¿è¡Œ --&gt;
&lt;template&gt;
    &lt;!-- Webã€å°ç¨‹åºã€Nativeå…±ç”¨ --&gt;
    &lt;view @click="handleClick"&gt;
        {{ message }}
    &lt;/view&gt;
&lt;/template&gt;
</code></pre>
<h4 data-id="heading-43">3. <strong>TypeScript æ·±åº¦é›†æˆ</strong></h4>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// å®Œæ•´çš„ç±»å‹å®‰å…¨</span>
<span class="hljs-keyword">interface</span> <span class="hljs-title class_">User</span> {
    <span class="hljs-attr">id</span>: <span class="hljs-built_in">number</span>
    <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span>
    <span class="hljs-attr">email</span>: <span class="hljs-built_in">string</span>
}

<span class="hljs-keyword">const</span> users = ref&lt;<span class="hljs-title class_">User</span>[]&gt;([])  <span class="hljs-comment">// ç±»å‹æ£€æŸ¥</span>
</code></pre>
<h4 data-id="heading-44">4. <strong>å¾®å‰ç«¯æ¶æ„</strong></h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// å¤§å‹åº”ç”¨æ‹†åˆ†ä¸ºå¤šä¸ªå­åº”ç”¨</span>
<span class="hljs-comment">// æ¯ä¸ªå­åº”ç”¨å¯ä»¥ä½¿ç”¨ä¸åŒæŠ€æœ¯æ ˆ</span>
<span class="hljs-comment">// ç‹¬ç«‹å¼€å‘ã€éƒ¨ç½²ã€è¿è¡Œ</span>
</code></pre>
<hr/>
<h3 data-id="heading-45">ç»“è¯­</h3>
<p>ä»çº¯åç«¯æ¨¡æ¿åˆ°å“åº”å¼æ•°æ®é©±åŠ¨ï¼ŒWeb å¼€å‘çš„æ¼”è¿›å§‹ç»ˆå›´ç»•ä¸€ä¸ªæ ¸å¿ƒç›®æ ‡ï¼š<strong>è®©å¼€å‘è€…æ›´ä¸“æ³¨äºä¸šåŠ¡é€»è¾‘ï¼Œè€Œä¸æ˜¯æŠ€æœ¯ç»†èŠ‚</strong>ã€‚</p>
<p><strong>å“åº”å¼ä¸æ˜¯é“¶å¼¹ï¼Œä½†å®ƒæ˜¯æœ€ä¼˜é›…çš„è§£å†³æ–¹æ¡ˆä¹‹ä¸€ã€‚</strong> å®ƒè§£å†³äº†å‰ç«¯å¼€å‘ä¸­æœ€ç—›è‹¦çš„é—®é¢˜ï¼šæ•°æ®ä¸è§†å›¾çš„åŒæ­¥ã€‚é€šè¿‡å£°æ˜å¼çš„ç¼–ç¨‹æ¨¡å‹ã€è‡ªåŠ¨çš„ä¾èµ–è·Ÿè¸ªã€é«˜æ•ˆçš„æ›´æ–°ç­–ç•¥ï¼Œå“åº”å¼æ¡†æ¶è®©æˆ‘ä»¬èƒ½å¤Ÿä»¥æ›´å°‘çš„ä»£ç å®ç°æ›´å¤æ‚çš„åŠŸèƒ½ã€‚</p>
<p>ä½œä¸ºåˆå­¦è€…ï¼Œç†è§£è¿™ä¸€æ¼”è¿›å†ç¨‹éå¸¸é‡è¦ã€‚å®ƒä¸ä»…å¸®åŠ©ä½ ç†è§£ä¸ºä»€ä¹ˆéœ€è¦è¿™äº›å·¥å…·ï¼Œæ›´è®©ä½ æ˜ç™½å¦‚ä½•é€‰æ‹©åˆé€‚çš„å·¥å…·ã€‚è®°ä½ï¼šæœ€å¥½çš„æŠ€æœ¯ä¸æ˜¯æœ€å¤æ‚çš„ï¼Œè€Œæ˜¯è®©ä½ å¿˜è®°æŠ€æœ¯æœ¬èº«ï¼Œä¸“æ³¨äºåˆ›é€ ä»·å€¼çš„é‚£ä¸€ä¸ªã€‚</p>
<p><strong>å¼€å§‹ä½ çš„å“åº”å¼ä¹‹æ—…å§ï¼Œä»ä»Šå¤©å¼€å§‹ï¼Œè®©æ•°æ®é©±åŠ¨ä½ çš„ç•Œé¢ï¼Œè€Œä¸æ˜¯è®© DOM æ“ä½œå æ®ä½ çš„æ—¶é—´ï¼</strong></p>
<hr/>
<p><em>æœ¬æ–‡é€šè¿‡è¯¦ç»†çš„ä»£ç å¯¹æ¯”å±•ç¤ºäº† Web å¼€å‘çš„å®Œæ•´æ¼”è¿›å†ç¨‹ã€‚å»ºè®®è¯»è€…åŠ¨æ‰‹è¿è¡Œæ¯ä¸ªç¤ºä¾‹ä»£ç ï¼Œäº²è‡ªä½“éªŒä¸åŒé˜¶æ®µçš„å¼€å‘æ„Ÿå—ã€‚åªæœ‰çœŸæ­£ç»å†è¿‡ DOM æ“ä½œçš„ç¹çï¼Œæ‰èƒ½æ·±åˆ»ç†è§£å“åº”å¼ç¼–ç¨‹çš„ä»·å€¼ã€‚å­¦ä¹ ä¹‹è·¯æ¼«é•¿ï¼Œä½†æ¯ä¸€æ­¥éƒ½ç®—æ•°ã€‚</em></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[æ„å»ºæ— éšœç¢ç»„ä»¶ä¹‹Alert Dialog Pattern]]></title>    <link>https://juejin.cn/post/7603911453704028203</link>    <guid>https://juejin.cn/post/7603911453704028203</guid>    <pubDate>2026-02-08T08:43:54.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7603911453704028203" data-draft-id="7603911453704011819" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="æ„å»ºæ— éšœç¢ç»„ä»¶ä¹‹Alert Dialog Pattern"/> <meta itemprop="keywords" content="å‰ç«¯,HTML,äº¤äº’è®¾è®¡"/> <meta itemprop="datePublished" content="2026-02-08T08:43:54.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="anOnion"/> <meta itemprop="url" content="https://juejin.cn/user/553809592722589"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            æ„å»ºæ— éšœç¢ç»„ä»¶ä¹‹Alert Dialog Pattern
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/553809592722589/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    anOnion
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-08T08:43:54.000Z" title="Sun Feb 08 2026 08:43:54 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»8åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">Alert Dialog Pattern è¯¦è§£ï¼šæ„å»ºæ— éšœç¢ä¸­æ–­å¼å¯¹è¯æ¡†</h2>
<p>Alert Dialog æ˜¯ Web æ— éšœç¢äº¤äº’çš„é‡è¦ç»„ä»¶ã€‚æœ¬æ–‡è¯¦è§£å…¶ WAI-ARIA å®ç°è¦ç‚¹ï¼Œæ¶µç›–è§’è‰²å£°æ˜ã€é”®ç›˜äº¤äº’ã€æœ€ä½³å®è·µï¼ŒåŠ©ä½ æ‰“é€ ä¸­æ–­å¼å¯¹è¯æ¡†ï¼Œè®©å…³é”®ä¿¡æ¯è§¦è¾¾æ¯ä½ç”¨æˆ·ã€‚</p>
<h3 data-id="heading-1">ä¸€ã€Alert Dialog çš„å®šä¹‰ä¸æ ¸å¿ƒåŠŸèƒ½</h3>
<p>Alert Dialogï¼ˆè­¦å‘Šå¯¹è¯æ¡†ï¼‰æ˜¯ä¸€ç§æ¨¡æ€å¯¹è¯æ¡†ï¼Œå®ƒä¼šä¸­æ–­ç”¨æˆ·çš„å·¥ä½œæµç¨‹ä»¥ä¼ è¾¾é‡è¦ä¿¡æ¯å¹¶è·å–å“åº”ã€‚ä¸æ™®é€šçš„ Alert é€šçŸ¥ä¸åŒï¼ŒAlert Dialog éœ€è¦ç”¨æˆ·æ˜ç¡®ä¸ä¹‹äº¤äº’åæ‰èƒ½ç»§ç»­å…¶ä»–æ“ä½œã€‚è¿™ç§è®¾è®¡é€‚ç”¨äºéœ€è¦ç”¨æˆ·ç«‹å³å…³æ³¨å’Œåšå‡ºå†³å®šçš„åœºæ™¯ã€‚</p>
<p>åœ¨å®é™…åº”ç”¨ä¸­ï¼ŒAlert Dialog å¹¿æ³›åº”ç”¨äºå„ç§éœ€è¦ç”¨æˆ·ç¡®è®¤æˆ–ç´§æ€¥é€šçŸ¥çš„åœºæ™¯ã€‚ä¾‹å¦‚ï¼Œåˆ é™¤æ“ä½œå‰çš„ç¡®è®¤æç¤ºã€è¡¨å•æäº¤å¤±è´¥çš„é”™è¯¯ç¡®è®¤ã€ç¦»å¼€é¡µé¢æ—¶çš„æœªä¿å­˜æ›´æ”¹æé†’ç­‰ã€‚è¿™äº›åœºæ™¯éƒ½éœ€è¦ç”¨æˆ·æ˜ç¡®å“åº”æ‰èƒ½ç»§ç»­æ“ä½œï¼Œå› æ­¤ Alert Dialog æˆä¸ºæœ€ä½³é€‰æ‹©ã€‚</p>
<h3 data-id="heading-2">äºŒã€Alert Dialog çš„ç‰¹æ€§ä¸æ³¨æ„äº‹é¡¹</h3>
<p>Alert Dialog ç»„ä»¶å…·æœ‰å‡ ä¸ªé‡è¦çš„ç‰¹æ€§ï¼Œè¿™äº›ç‰¹æ€§å†³å®šäº†å®ƒçš„é€‚ç”¨åœºæ™¯å’Œå®ç°æ–¹å¼ã€‚é¦–å…ˆï¼ŒAlert Dialog ä¼šè·å–é”®ç›˜ç„¦ç‚¹ï¼Œç¡®ä¿ç”¨æˆ·çš„æ³¨æ„åŠ›é›†ä¸­åœ¨å¯¹è¯æ¡†ä¸Šã€‚å…¶æ¬¡ï¼ŒAlert Dialog é€šå¸¸ä¼šé˜»æ­¢ç”¨æˆ·ä¸é¡µé¢çš„å…¶ä»–éƒ¨åˆ†äº¤äº’ï¼Œç›´åˆ°ç”¨æˆ·å…³é—­å¯¹è¯æ¡†ã€‚è¿™ç§æ¨¡æ€ç‰¹æ€§ç¡®ä¿äº†ç”¨æˆ·å¿…é¡»å¤„ç†é‡è¦ä¿¡æ¯æ‰èƒ½ç»§ç»­æ“ä½œã€‚</p>
<p>Alert Dialog ç»„ä»¶çš„è®¾è®¡è¿˜éœ€è¦è€ƒè™‘å‡ ä¸ªå…³é”®å› ç´ ã€‚é¦–å…ˆï¼ŒAlert Dialog åº”è¯¥å§‹ç»ˆåŒ…å«ä¸€ä¸ªæ˜ç¡®çš„å…³é—­æ–¹å¼ï¼Œå¦‚ç¡®è®¤æŒ‰é’®æˆ–å–æ¶ˆæŒ‰é’®ã€‚å…¶æ¬¡ï¼Œå¯¹è¯æ¡†åº”è¯¥æœ‰ä¸€ä¸ªæ¸…æ™°çš„æ ‡é¢˜ï¼Œé€šè¿‡ <code>aria-labelledby</code> æˆ– <code>aria-label</code> å…³è”ã€‚å¦å¤–ï¼Œå¯¹è¯æ¡†çš„å†…å®¹åº”è¯¥é€šè¿‡ <code>aria-describedby</code> å…³è”ï¼Œä»¥ä¾¿å±å¹•é˜…è¯»å™¨èƒ½å¤Ÿæ­£ç¡®è¯»å–å®Œæ•´ä¿¡æ¯ã€‚è¿™äº›å±æ€§çš„æ­£ç¡®ä½¿ç”¨å¯¹äºæ— éšœç¢ä½“éªŒè‡³å…³é‡è¦ã€‚</p>
<h3 data-id="heading-3">ä¸‰ã€WAI-ARIA è§’è‰²ã€çŠ¶æ€å’Œå±æ€§</h3>
<p>æ­£ç¡®ä½¿ç”¨ WAI-ARIA å±æ€§æ˜¯æ„å»ºæ— éšœç¢ Alert Dialog ç»„ä»¶çš„æŠ€æœ¯åŸºç¡€ã€‚Alert Dialog ç»„ä»¶çš„ ARIA è¦æ±‚åŒ…å«å¤šä¸ªå±æ€§çš„é…åˆä½¿ç”¨ã€‚</p>
<p><code>role="alertdialog"</code> æ˜¯ Alert Dialog ç»„ä»¶çš„å¿…éœ€å±æ€§ï¼Œå®ƒå‘è¾…åŠ©æŠ€æœ¯è¡¨æ˜è¿™ä¸ªå…ƒç´ æ˜¯ä¸€ä¸ªè­¦å‘Šå¯¹è¯æ¡†ã€‚è¿™ä¸ªå±æ€§ä½¿æµè§ˆå™¨å’Œè¾…åŠ©æŠ€æœ¯èƒ½å¤Ÿå°† Alert Dialog ä¸å…¶ä»–ç±»å‹çš„å¯¹è¯æ¡†åŒºåˆ†å¼€æ¥ï¼Œä»è€Œæä¾›ç‰¹æ®Šçš„å¤„ç†æ–¹å¼ï¼Œå¦‚æ’­æ”¾ç³»ç»Ÿæç¤ºéŸ³ã€‚</p>
<p><code>aria-labelledby</code> æˆ– <code>aria-label</code> ç”¨äºæ ‡è¯†å¯¹è¯æ¡†çš„æ ‡é¢˜ã€‚å¦‚æœå¯¹è¯æ¡†æœ‰å¯è§çš„æ ‡é¢˜æ ‡ç­¾ï¼Œåº”è¯¥ä½¿ç”¨ <code>aria-labelledby</code> å¼•ç”¨è¯¥æ ‡é¢˜å…ƒç´ ï¼›å¦‚æœæ²¡æœ‰å¯è§æ ‡é¢˜ï¼Œåˆ™ä½¿ç”¨ <code>aria-label</code> æä¾›æ ‡ç­¾ã€‚</p>
<p><code>aria-describedby</code> ç”¨äºå¼•ç”¨åŒ…å«è­¦å‘Šæ¶ˆæ¯çš„å…ƒç´ ã€‚è¿™ç¡®ä¿å±å¹•é˜…è¯»å™¨èƒ½å¤Ÿæœ—è¯»å®Œæ•´çš„å¯¹è¯æ¡†å†…å®¹ï¼ŒåŒ…æ‹¬è¯¦ç»†çš„è¯´æ˜å’Œæ“ä½œæç¤ºã€‚</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-comment">&lt;!-- Alert Dialog åŸºæœ¬ç»“æ„ --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">dialog</span>
  <span class="hljs-attr">id</span>=<span class="hljs-string">"confirm-dialog"</span>
  <span class="hljs-attr">role</span>=<span class="hljs-string">"alertdialog"</span>
  <span class="hljs-attr">aria-labelledby</span>=<span class="hljs-string">"dialog-title"</span>
  <span class="hljs-attr">aria-describedby</span>=<span class="hljs-string">"dialog-desc"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">form</span> <span class="hljs-attr">method</span>=<span class="hljs-string">"dialog"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">h2</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"dialog-title"</span>&gt;</span>ç¡®è®¤åˆ é™¤<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"dialog-desc"</span>&gt;</span>æ‚¨ç¡®å®šè¦åˆ é™¤è¿™ä¸ªæ–‡ä»¶å—ï¼Ÿæ­¤æ“ä½œæ— æ³•æ’¤é”€ã€‚<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"actions"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"confirm"</span>&gt;</span>ç¡®è®¤åˆ é™¤<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"cancel"</span>&gt;</span>å–æ¶ˆ<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dialog</span>&gt;</span>
</code></pre>
<p>å€¼å¾—æ³¨æ„çš„æ˜¯ï¼ŒAlert Dialog ä¸æ™®é€š Dialog çš„ä¸»è¦åŒºåˆ«åœ¨äº Alert Dialog ç”¨äºç´§æ€¥æˆ–é‡è¦ä¿¡æ¯ï¼Œå¹¶ä¸”é€šå¸¸åŒ…å«ç¡®è®¤/å–æ¶ˆæŒ‰é’®ã€‚ç”¨æˆ·æ— æ³•å¿½ç•¥ Alert Dialogï¼Œå¿…é¡»åšå‡ºå“åº”æ‰èƒ½ç»§ç»­æ“ä½œã€‚</p>
<h3 data-id="heading-4">å››ã€é”®ç›˜äº¤äº’è§„èŒƒ</h3>
<p>Alert Dialog çš„é”®ç›˜äº¤äº’éµå¾ªæ¨¡æ€å¯¹è¯æ¡†çš„äº¤äº’æ¨¡å¼ã€‚ç”¨æˆ·å¯ä»¥é€šè¿‡å¤šç§æ–¹å¼ä¸ Alert Dialog è¿›è¡Œäº¤äº’ã€‚</p>
<ul>
<li><code>Enter</code> æˆ– <code>Space</code> ç”¨äºæ¿€æ´»é»˜è®¤æŒ‰é’®ï¼Œé€šå¸¸æ˜¯å¯¹è¯æ¡†ä¸­çš„ä¸»è¦æ“ä½œæŒ‰é’®ã€‚</li>
<li><code>Tab</code> é”®ç”¨äºåœ¨å¯¹è¯æ¡†å†…çš„ç„¦ç‚¹å…ƒç´ ä¹‹é—´åˆ‡æ¢ï¼Œç„¦ç‚¹ä¼šå¾ªç¯åœç•™ åœ¨å¯¹è¯æ¡†å†…éƒ¨ã€‚</li>
<li><code>Escape</code> é”®é€šå¸¸ç”¨äºå…³é—­å¯¹è¯æ¡†ï¼Œç›¸å½“äºç‚¹å‡»å–æ¶ˆæŒ‰é’®ã€‚</li>
</ul>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// ESC é”®å…³é—­å¯¹è¯æ¡†ç¤ºä¾‹</span>
<span class="hljs-variable language_">document</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'keydown'</span>, <span class="hljs-keyword">function</span> (<span class="hljs-params">e</span>) {
  <span class="hljs-keyword">if</span> (e.<span class="hljs-property">key</span> === <span class="hljs-string">'Escape'</span> &amp;&amp; dialog.<span class="hljs-property">open</span>) {
    dialog.<span class="hljs-title function_">close</span>();
  }
});
</code></pre>
<p>ç„¦ç‚¹ç®¡ç†æ˜¯ Alert Dialog çš„å…³é”®éƒ¨åˆ†ã€‚å½“å¯¹è¯æ¡†æ‰“å¼€æ—¶ï¼Œç„¦ç‚¹åº”è¯¥ç«‹å³ç§»åŠ¨åˆ°å¯¹è¯æ¡†å†…éƒ¨æˆ–é»˜è®¤æŒ‰é’®ä¸Šã€‚å½“å¯¹è¯æ¡†å…³é—­æ—¶ï¼Œç„¦ç‚¹åº”è¯¥è¿”å›åˆ°æ‰“å¼€å¯¹è¯æ¡†çš„å…ƒç´ ã€‚è¿™ç§ç„¦ç‚¹ç®¡ç†ç¡®ä¿äº†é”®ç›˜ç”¨æˆ·èƒ½å¤Ÿä¿æŒå…¶å·¥ä½œä¸Šä¸‹æ–‡ã€‚</p>
<h3 data-id="heading-5">äº”ã€å®Œæ•´ç¤ºä¾‹</h3>
<p>ä»¥ä¸‹æ˜¯ä¸€ä¸ªå®Œæ•´çš„ Alert Dialog å®ç°ç¤ºä¾‹ï¼Œå±•ç¤ºäº†æ­£ç¡®çš„ HTML ç»“æ„ã€ARIA å±æ€§å’Œç„¦ç‚¹ç®¡ç†ã€‚</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">dialog</span>
  <span class="hljs-attr">id</span>=<span class="hljs-string">"confirm-dialog"</span>
  <span class="hljs-attr">role</span>=<span class="hljs-string">"alertdialog"</span>
  <span class="hljs-attr">aria-labelledby</span>=<span class="hljs-string">"dialog-title"</span>
  <span class="hljs-attr">aria-describedby</span>=<span class="hljs-string">"dialog-desc"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">form</span> <span class="hljs-attr">method</span>=<span class="hljs-string">"dialog"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">h2</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"dialog-title"</span>&gt;</span>ç¡®è®¤åˆ é™¤<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"dialog-desc"</span>&gt;</span>æ‚¨ç¡®å®šè¦åˆ é™¤è¿™ä¸ªæ–‡ä»¶å—ï¼Ÿæ­¤æ“ä½œæ— æ³•æ’¤é”€ã€‚<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"dialog-actions"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">button</span>
        <span class="hljs-attr">class</span>=<span class="hljs-string">"btn btn-ghost"</span>
        <span class="hljs-attr">value</span>=<span class="hljs-string">"cancel"</span>&gt;</span>
        å–æ¶ˆ
      <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">button</span>
        <span class="hljs-attr">class</span>=<span class="hljs-string">"btn btn-error"</span>
        <span class="hljs-attr">value</span>=<span class="hljs-string">"confirm"</span>&gt;</span>
        åˆ é™¤
      <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dialog</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">button</span>
  <span class="hljs-attr">id</span>=<span class="hljs-string">"delete-btn"</span>
  <span class="hljs-attr">class</span>=<span class="hljs-string">"btn btn-error"</span>&gt;</span>
  åˆ é™¤æ–‡ä»¶
<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">
  <span class="hljs-keyword">const</span> dialog = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'confirm-dialog'</span>);
  <span class="hljs-keyword">const</span> deleteBtn = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'delete-btn'</span>);
  <span class="hljs-keyword">let</span> previousActiveElement;

  deleteBtn.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'click'</span>, <span class="hljs-keyword">function</span> (<span class="hljs-params"/>) {
    previousActiveElement = <span class="hljs-variable language_">document</span>.<span class="hljs-property">activeElement</span>;
    dialog.<span class="hljs-title function_">showModal</span>();
  });

  dialog.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'close'</span>, <span class="hljs-keyword">function</span> (<span class="hljs-params"/>) {
    <span class="hljs-keyword">if</span> (dialog.<span class="hljs-property">returnValue</span> === <span class="hljs-string">'confirm'</span>) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'æ–‡ä»¶å·²åˆ é™¤'</span>);
    }
    previousActiveElement.<span class="hljs-title function_">focus</span>();
  });
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
</code></pre>
<h3 data-id="heading-6">å…­ã€æœ€ä½³å®è·µ</h3>
<h4 data-id="heading-7">6.1 å®ç°æ–¹å¼å¯¹æ¯”</h4>
<p>Alert Dialog å¯ä»¥é€šè¿‡ä¸¤ç§æ–¹å¼å®ç°ï¼šä½¿ç”¨ <code>div</code> é…åˆ ARIA å±æ€§ï¼Œæˆ–ä½¿ç”¨åŸç”Ÿ <code>&lt;dialog&gt;</code> å…ƒç´ ã€‚</p>
<h5 data-id="heading-8">ä¼ ç»Ÿæ–¹å¼ï¼ˆdiv + ARIAï¼‰</h5>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>
  <span class="hljs-attr">role</span>=<span class="hljs-string">"alertdialog"</span>
  <span class="hljs-attr">aria-modal</span>=<span class="hljs-string">"true"</span>
  <span class="hljs-attr">aria-labelledby</span>=<span class="hljs-string">"dialog-title"</span>
  <span class="hljs-attr">aria-describedby</span>=<span class="hljs-string">"dialog-desc"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">h2</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"dialog-title"</span>&gt;</span>ç¡®è®¤åˆ é™¤<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"dialog-desc"</span>&gt;</span>æ‚¨ç¡®å®šè¦åˆ é™¤è¿™ä¸ªæ–‡ä»¶å—ï¼Ÿ<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">button</span>&gt;</span>ç¡®è®¤<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">button</span>&gt;</span>å–æ¶ˆ<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
</code></pre>
<p>è¿™ç§æ–¹å¼éœ€è¦å¼€å‘è€…æ‰‹åŠ¨å¤„ç†ç„¦ç‚¹ç®¡ç†ã€ESC é”®å…³é—­ã€èƒŒæ™¯é”å®šç­‰é€»è¾‘ã€‚</p>
<h5 data-id="heading-9">æ¨èæ–¹å¼ï¼ˆåŸç”Ÿ dialogï¼‰</h5>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">dialog</span>
  <span class="hljs-attr">role</span>=<span class="hljs-string">"alertdialog"</span>
  <span class="hljs-attr">aria-labelledby</span>=<span class="hljs-string">"dialog-title"</span>
  <span class="hljs-attr">aria-describedby</span>=<span class="hljs-string">"dialog-desc"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">form</span> <span class="hljs-attr">method</span>=<span class="hljs-string">"dialog"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">h2</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"dialog-title"</span>&gt;</span>ç¡®è®¤åˆ é™¤<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"dialog-desc"</span>&gt;</span>æ‚¨ç¡®å®šè¦åˆ é™¤è¿™ä¸ªæ–‡ä»¶å—ï¼Ÿ<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"confirm"</span>&gt;</span>ç¡®è®¤<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"cancel"</span>&gt;</span>å–æ¶ˆ<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dialog</span>&gt;</span>
</code></pre>
<p>HTML åŸç”Ÿ <code>&lt;dialog&gt;</code> å…ƒç´ ç®€åŒ–äº†å®ç°ï¼Œå®ƒæä¾›äº†ï¼š</p>
<ul>
<li>è‡ªåŠ¨ç„¦ç‚¹ç®¡ç†</li>
<li>å†…ç½® ESC é”®æ”¯æŒ</li>
<li>è‡ªåŠ¨æ¨¡æ€èƒŒæ™¯</li>
<li>å†…ç½® ARIA å±æ€§</li>
</ul>
<p><code>&lt;dialog&gt;</code> å…ƒç´ çš„é»˜è®¤ <code>role</code> æ˜¯ <code>dialog</code>ï¼Œè¡¨ç¤ºæ™®é€šå¯¹è¯æ¡†ã€‚å¯¹äº Alert Dialogï¼Œéœ€è¦æ˜¾å¼è®¾ç½® <code>role="alertdialog"</code> æ¥å‘Šè¯‰è¾…åŠ©æŠ€æœ¯è¿™æ˜¯ä¸€ä¸ªéœ€è¦ç´§æ€¥å¤„ç†çš„å¯¹è¯æ¡†ï¼Œä»è€Œè·å¾—ç³»ç»Ÿæç¤ºéŸ³ç­‰ç‰¹æ®Šå¤„ç†ã€‚</p>
<h4 data-id="heading-10">6.2 ç„¦ç‚¹ç®¡ç†</h4>
<p>æ­£ç¡®çš„ç„¦ç‚¹ç®¡ç†å¯¹äºé”®ç›˜ç”¨æˆ·å’Œæ— éšœç¢ä½“éªŒè‡³å…³é‡è¦ã€‚æ‰“å¼€å¯¹è¯æ¡†æ—¶ï¼Œç„¦ç‚¹åº”è¯¥ç§»åŠ¨åˆ°å¯¹è¯æ¡†å†…éƒ¨æˆ–é»˜è®¤æŒ‰é’®ã€‚å…³é—­å¯¹è¯æ¡†æ—¶ï¼Œç„¦ç‚¹åº”è¯¥è¿”å›åˆ°è§¦å‘å¯¹è¯æ¡†çš„å…ƒç´ ã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// ç„¦ç‚¹ç®¡ç†æœ€ä½³å®è·µ</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">openDialog</span>(<span class="hljs-params">dialog</span>) {
  <span class="hljs-keyword">const</span> previousFocus = <span class="hljs-variable language_">document</span>.<span class="hljs-property">activeElement</span>;
  dialog.<span class="hljs-title function_">showModal</span>();

  <span class="hljs-comment">// ç§»åŠ¨ç„¦ç‚¹åˆ°å¯¹è¯æ¡†å†…</span>
  <span class="hljs-keyword">const</span> focusableElements = dialog.<span class="hljs-title function_">querySelectorAll</span>(
    <span class="hljs-string">'button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])'</span>,
  );
  <span class="hljs-keyword">if</span> (focusableElements.<span class="hljs-property">length</span> &gt; <span class="hljs-number">0</span>) {
    focusableElements[<span class="hljs-number">0</span>].<span class="hljs-title function_">focus</span>();
  }

  <span class="hljs-comment">// ä¿å­˜å…³é—­æ—¶çš„ç„¦ç‚¹å…ƒç´ </span>
  dialog.<span class="hljs-property">dataset</span>.<span class="hljs-property">previousFocus</span> = previousFocus;
}

<span class="hljs-keyword">function</span> <span class="hljs-title function_">closeDialog</span>(<span class="hljs-params">dialog</span>) {
  dialog.<span class="hljs-title function_">close</span>();
  <span class="hljs-keyword">const</span> previousFocus = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelector</span>(
    <span class="hljs-string">`[data-focus-id="<span class="hljs-subst">${dialog.dataset.focusId}</span>"]`</span>,
  );
  <span class="hljs-keyword">if</span> (previousFocus) {
    previousFocus.<span class="hljs-title function_">focus</span>();
  }
  dialog.<span class="hljs-title function_">remove</span>();
}
</code></pre>
<h4 data-id="heading-11">6.3 é¿å…è¿‡åº¦ä½¿ç”¨</h4>
<p>Alert Dialog ä¼šä¸­æ–­ç”¨æˆ·çš„å·¥ä½œæµç¨‹ï¼Œå› æ­¤åº”è¯¥è°¨æ…ä½¿ç”¨ã€‚åªæœ‰åœ¨çœŸæ­£éœ€è¦ç”¨æˆ·ç«‹å³å“åº”çš„æƒ…å†µä¸‹æ‰ä½¿ç”¨ Alert Dialogã€‚å¯¹äºéç´§æ€¥ä¿¡æ¯ï¼Œåº”è¯¥è€ƒè™‘ä½¿ç”¨æ™®é€šçš„ Alert æˆ– Toast é€šçŸ¥ã€‚</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-comment">&lt;!-- ä¸æ¨èï¼šè¿‡åº¦ä½¿ç”¨ Alert Dialog --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">dialog</span>
  <span class="hljs-attr">open</span>
  <span class="hljs-attr">role</span>=<span class="hljs-string">"alertdialog"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>æç¤º<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>æ‚¨çš„è®¾ç½®å·²ä¿å­˜ã€‚<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onclick</span>=<span class="hljs-string">"this.closest('dialog').close()"</span>&gt;</span>ç¡®å®š<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dialog</span>&gt;</span>

<span class="hljs-comment">&lt;!-- æ¨èï¼šä½¿ç”¨æ™®é€š Alert --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">role</span>=<span class="hljs-string">"alert"</span>&gt;</span>æ‚¨çš„è®¾ç½®å·²ä¿å­˜ã€‚<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
</code></pre>
<h4 data-id="heading-12">6.4 å±å¹•é˜…è¯»å™¨å…¼å®¹æ€§</h4>
<p>ç¡®ä¿ <code>&lt;dialog&gt;</code> å¯¹å±å¹•é˜…è¯»å™¨ç”¨æˆ·å‹å¥½ã€‚<code>&lt;dialog&gt;</code> å…ƒç´ å†…ç½®äº†æ— éšœç¢æ”¯æŒï¼Œä½†ä»ç„¶å»ºè®®å¯¹ Alert Dialog è®¾ç½® <code>role="alertdialog"</code> æ¥åŒºåˆ†ç´§æ€¥å¯¹è¯æ¡†ã€‚</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-comment">&lt;!-- å±å¹•é˜…è¯»å™¨å‹å¥½çš„ dialog --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">dialog</span>
  <span class="hljs-attr">id</span>=<span class="hljs-string">"session-dialog"</span>
  <span class="hljs-attr">role</span>=<span class="hljs-string">"alertdialog"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">form</span> <span class="hljs-attr">method</span>=<span class="hljs-string">"dialog"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>é‡è¦æé†’<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>æ‚¨çš„ä¼šè¯å°†åœ¨ 5 åˆ†é’Ÿåè¿‡æœŸã€‚è¯·å°½å¿«ä¿å­˜æ‚¨çš„å·¥ä½œã€‚<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"actions"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"continue"</span>&gt;</span>ç»§ç»­ä½¿ç”¨<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"exit"</span>&gt;</span>é€€å‡º<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dialog</span>&gt;</span>
</code></pre>
<h3 data-id="heading-13">ä¸ƒã€Alert ä¸ Alert Dialog çš„åŒºåˆ«</h3>
<p>ç†è§£ <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.w3.org%2FWAI%2FARIA%2Fapg%2Fpatterns%2Falert%2F" target="_blank" title="https://www.w3.org/WAI/ARIA/apg/patterns/alert/" ref="nofollow noopener noreferrer">Alert</a> å’Œ <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.w3.org%2FWAI%2FARIA%2Fapg%2Fpatterns%2Falertdialog%2F" target="_blank" title="https://www.w3.org/WAI/ARIA/apg/patterns/alertdialog/" ref="nofollow noopener noreferrer">Alert Dialog</a> çš„åŒºåˆ«å¯¹äºæ­£ç¡®é€‰æ‹©é€šçŸ¥ç»„ä»¶è‡³å…³é‡è¦ã€‚è™½ç„¶ä¸¤è€…éƒ½æ˜¯ç”¨äºä¼ è¾¾é‡è¦ä¿¡æ¯ï¼Œä½†å®ƒä»¬æœåŠ¡äºä¸åŒçš„ç›®çš„å’Œä½¿ç”¨åœºæ™¯ã€‚</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.w3.org%2FWAI%2FARIA%2Fapg%2Fpatterns%2Falert%2F" target="_blank" title="https://www.w3.org/WAI/ARIA/apg/patterns/alert/" ref="nofollow noopener noreferrer">Alert</a> æ˜¯ä¸€ç§è¢«åŠ¨é€šçŸ¥ç»„ä»¶ï¼Œå®ƒä¸éœ€è¦ç”¨æˆ·è¿›è¡Œä»»ä½•äº¤äº’æ“ä½œã€‚Alert ä¼šåœ¨ä¸è¢«ä¸­æ–­ç”¨æˆ·å·¥ä½œæµç¨‹çš„å‰æä¸‹è‡ªåŠ¨é€šçŸ¥ç”¨æˆ·é‡è¦ä¿¡æ¯ã€‚ç”¨æˆ·å¯ä»¥ç»§ç»­å½“å‰çš„å·¥ä½œï¼ŒAlert åªæ˜¯åœ¨è§†è§‰å’Œå¬è§‰ä¸Šæä¾›é€šçŸ¥ã€‚è¿™ç§è®¾è®¡é€‚ç”¨äºä¸ç´§æ€¥ã€ä¸éœ€è¦ç”¨æˆ·ç«‹å³å“åº”çš„ä¿¡æ¯ï¼Œä¾‹å¦‚æ“ä½œæˆåŠŸç¡®è®¤ã€åå°å¤„ç†å®Œæˆé€šçŸ¥ç­‰ã€‚</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.w3.org%2FWAI%2FARIA%2Fapg%2Fpatterns%2Falertdialog%2F" target="_blank" title="https://www.w3.org/WAI/ARIA/apg/patterns/alertdialog/" ref="nofollow noopener noreferrer">Alert Dialog</a> åˆ™æ˜¯ä¸€ç§éœ€è¦ç”¨æˆ·ä¸»åŠ¨å“åº”çš„å¯¹è¯æ¡†ç»„ä»¶ã€‚å½“ç”¨æˆ·éœ€è¦åšå‡ºå†³å®šæˆ–è€…æä¾›ç¡®è®¤æ—¶ï¼Œåº”è¯¥ä½¿ç”¨ Alert Dialogã€‚Alert Dialog ä¼šä¸­æ–­ç”¨æˆ·çš„å·¥ä½œæµç¨‹ï¼Œè·å–é”®ç›˜ç„¦ç‚¹ï¼Œè¦æ±‚ç”¨æˆ·å¿…é¡»ä¸ä¹‹äº¤äº’æ‰èƒ½ç»§ç»­å…¶ä»–æ“ä½œã€‚è¿™ç§è®¾è®¡é€‚ç”¨äºç´§æ€¥è­¦å‘Šã€ç¡®è®¤åˆ é™¤æ“ä½œã€æ”¾å¼ƒæ›´æ”¹ç¡®è®¤ç­‰éœ€è¦ç”¨æˆ·æ˜ç¡®å“åº”çš„åœºæ™¯ã€‚</p>
<p>é€‰æ‹©å»ºè®®ï¼šå¦‚æœä¿¡æ¯éœ€è¦ç”¨æˆ·ç«‹å³å“åº”å¹¶åšå‡ºå†³å®šï¼Œä½¿ç”¨ Alert Dialogï¼›å¦‚æœåªæ˜¯è¢«åŠ¨é€šçŸ¥ä¿¡æ¯ï¼Œä½¿ç”¨ Alertã€‚</p>
<h3 data-id="heading-14">å…«ã€æ€»ç»“</h3>
<p>æ„å»ºæ— éšœç¢çš„å¯¹è¯æ¡†ç»„ä»¶éœ€è¦å…³æ³¨å…ƒç´ é€‰æ‹©ã€ç„¦ç‚¹ç®¡ç†ã€é”®ç›˜äº¤äº’ä¸‰ä¸ªå±‚é¢çš„ç»†èŠ‚ã€‚ä»å…ƒç´ é€‰æ‹©è§’åº¦ï¼Œæ¨èä¼˜å…ˆä½¿ç”¨åŸç”Ÿ <code>&lt;dialog&gt;</code> å…ƒç´ ï¼Œå®ƒå†…ç½®äº†æ— éšœç¢æ”¯æŒå’Œç„¦ç‚¹ç®¡ç†ã€‚ä»ç„¦ç‚¹ç®¡ç†è§’åº¦ï¼Œéœ€è¦ç¡®ä¿æ‰“å¼€å’Œå…³é—­æ—¶ç„¦ç‚¹çš„æ­£ç¡®ç§»åŠ¨ã€‚ä»ç”¨æˆ·ä½“éªŒè§’åº¦ï¼Œåº”è¯¥é¿å…è¿‡åº¦ä½¿ç”¨å¯¹è¯æ¡†ï¼Œåªåœ¨çœŸæ­£éœ€è¦ç”¨æˆ·å“åº”æ—¶ä½¿ç”¨ã€‚</p>
<p>WAI-ARIA <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.w3.org%2FWAI%2FARIA%2Fapg%2Fpatterns%2Falertdialog%2F" target="_blank" title="https://www.w3.org/WAI/ARIA/apg/patterns/alertdialog/" ref="nofollow noopener noreferrer">Alert Dialog Pattern</a> ä¸ºæˆ‘ä»¬æä¾›äº†æ¸…æ™°çš„æŒ‡å¯¼æ–¹é’ˆï¼Œéµå¾ªè¿™äº›è§„èŒƒèƒ½å¤Ÿå¸®åŠ©æˆ‘ä»¬åˆ›å»ºæ›´åŠ åŒ…å®¹å’Œæ˜“ç”¨çš„ Web åº”ç”¨ã€‚æ¯ä¸€ä¸ªæ­£ç¡®å®ç°çš„å¯¹è¯æ¡†ï¼Œéƒ½æ˜¯æå‡ç”¨æˆ·ä½“éªŒå’Œç¡®ä¿é‡è¦ä¿¡æ¯æœ‰æ•ˆä¼ è¾¾çš„é‡è¦ä¸€æ­¥ã€‚</p>
<p>æ–‡ç« åŒæ­¥äº an-Onion çš„ <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fan-Onion%2Fan-Onion.github.io" target="_blank" title="https://github.com/an-Onion/an-Onion.github.io" ref="nofollow noopener noreferrer">Github</a>ã€‚ç å­—ä¸æ˜“ï¼Œæ¬¢è¿ç‚¹èµã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[JDK 6åˆ°25 å…¨ç‰ˆæœ¬ç½‘ç›˜åˆé›† (Windows + Mac + Linux)]]></title>    <link>https://juejin.cn/post/7603677143214784527</link>    <guid>https://juejin.cn/post/7603677143214784527</guid>    <pubDate>2026-02-08T09:02:31.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7603677143214784527" data-draft-id="7603671627003887656" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="JDK 6åˆ°25 å…¨ç‰ˆæœ¬ç½‘ç›˜åˆé›† (Windows + Mac + Linux)"/> <meta itemprop="keywords" content="Java,åç«¯"/> <meta itemprop="datePublished" content="2026-02-08T09:02:31.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å®‹å°é»‘"/> <meta itemprop="url" content="https://juejin.cn/user/897618008110413"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            JDK 6åˆ°25 å…¨ç‰ˆæœ¬ç½‘ç›˜åˆé›† (Windows + Mac + Linux)
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/897618008110413/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å®‹å°é»‘
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-08T09:02:31.000Z" title="Sun Feb 08 2026 09:02:31 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»1åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">æ‰€æœ‰ç‰ˆæœ¬åˆé›†</h2>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/96b6be38a95b45aebfdb0cb0aae83bde~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a6L5bCP6buR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771146151&amp;x-signature=kLdS8tdlWgU22BBeyqw6pVipNTE%3D" alt="image.png" loading="lazy"/></p>
<p>é€šè¿‡ç½‘ç›˜åˆ†äº«çš„æ–‡ä»¶ï¼šJDKå…¨é›†</p>
<p>é“¾æ¥: <a href="https://link.juejin.cn?target=https%3A%2F%2Fpan.baidu.com%2Fs%2F1KmnYXE8jrs2dnLriuN1Vdw%3Fpwd%3Ditpr" target="_blank" title="https://pan.baidu.com/s/1KmnYXE8jrs2dnLriuN1Vdw?pwd=itpr" ref="nofollow noopener noreferrer">pan.baidu.com/s/1KmnYXE8jâ€¦</a></p>
<p>æå–ç : itpr</p>
<p>å¦‚ä¸‹æ˜¯å„å•ç‹¬ç‰ˆæœ¬</p>
<h2 data-id="heading-1">JDK1.6</h2>
<p>é€šè¿‡ç½‘ç›˜åˆ†äº«çš„æ–‡ä»¶ï¼šJDK1.6</p>
<p>é“¾æ¥: <a href="https://link.juejin.cn?target=https%3A%2F%2Fpan.baidu.com%2Fs%2F1tWHFnzoaB4fbSl1MYd8qgg%3Fpwd%3Dgr79" target="_blank" title="https://pan.baidu.com/s/1tWHFnzoaB4fbSl1MYd8qgg?pwd=gr79" ref="nofollow noopener noreferrer">pan.baidu.com/s/1tWHFnzoaâ€¦</a></p>
<p>æå–ç : gr79</p>
<h2 data-id="heading-2">JDK1.7</h2>
<p>é€šè¿‡ç½‘ç›˜åˆ†äº«çš„æ–‡ä»¶ï¼šJDK1.7</p>
<p>é“¾æ¥: <a href="https://link.juejin.cn?target=https%3A%2F%2Fpan.baidu.com%2Fs%2F1dQIDiPUqnta3yQi55pcm2A%3Fpwd%3Dxhkh" target="_blank" title="https://pan.baidu.com/s/1dQIDiPUqnta3yQi55pcm2A?pwd=xhkh" ref="nofollow noopener noreferrer">pan.baidu.com/s/1dQIDiPUqâ€¦</a></p>
<p>æå–ç : xhkh</p>
<h2 data-id="heading-3">JDK1.8</h2>
<p>é€šè¿‡ç½‘ç›˜åˆ†äº«çš„æ–‡ä»¶ï¼šJDK1.8</p>
<p>é“¾æ¥: <a href="https://link.juejin.cn?target=https%3A%2F%2Fpan.baidu.com%2Fs%2F1iCS3Yi1-_kjquJyZk6oDLA%3Fpwd%3Dtg6k" target="_blank" title="https://pan.baidu.com/s/1iCS3Yi1-_kjquJyZk6oDLA?pwd=tg6k" ref="nofollow noopener noreferrer">pan.baidu.com/s/1iCS3Yi1-â€¦</a></p>
<p>æå–ç : tg6k</p>
<h2 data-id="heading-4">JDK9</h2>
<p>é“¾æ¥: <a href="https://link.juejin.cn?target=https%3A%2F%2Fpan.baidu.com%2Fs%2F1aBO393S59b5ujVymdF0vTg%3Fpwd%3Dtua1" target="_blank" title="https://pan.baidu.com/s/1aBO393S59b5ujVymdF0vTg?pwd=tua1" ref="nofollow noopener noreferrer">pan.baidu.com/s/1aBO393S5â€¦</a></p>
<p>æå–ç : tua1</p>
<h2 data-id="heading-5">JDK10</h2>
<p>é€šè¿‡ç½‘ç›˜åˆ†äº«çš„æ–‡ä»¶ï¼šJDK10</p>
<p>é“¾æ¥: <a href="https://link.juejin.cn?target=https%3A%2F%2Fpan.baidu.com%2Fs%2F15OXI6JChAp2Q3IttHDDfmg%3Fpwd%3D6a7t" target="_blank" title="https://pan.baidu.com/s/15OXI6JChAp2Q3IttHDDfmg?pwd=6a7t" ref="nofollow noopener noreferrer">pan.baidu.com/s/15OXI6JChâ€¦</a></p>
<p>æå–ç : 6a7t</p>
<h2 data-id="heading-6">JDK11</h2>
<p>é€šè¿‡ç½‘ç›˜åˆ†äº«çš„æ–‡ä»¶ï¼šJDK11</p>
<p>é“¾æ¥: <a href="https://link.juejin.cn?target=https%3A%2F%2Fpan.baidu.com%2Fs%2F1vddDP0HGF0bOLPLwb-FovA%3Fpwd%3Dwmep" target="_blank" title="https://pan.baidu.com/s/1vddDP0HGF0bOLPLwb-FovA?pwd=wmep" ref="nofollow noopener noreferrer">pan.baidu.com/s/1vddDP0HGâ€¦</a></p>
<p>æå–ç : wmep</p>
<h2 data-id="heading-7">JDK12</h2>
<p>é€šè¿‡ç½‘ç›˜åˆ†äº«çš„æ–‡ä»¶ï¼šJDK12</p>
<p>é“¾æ¥: <a href="https://link.juejin.cn?target=https%3A%2F%2Fpan.baidu.com%2Fs%2F191YElh8MPBH8uoT8zg6tLg%3Fpwd%3Dbmzp" target="_blank" title="https://pan.baidu.com/s/191YElh8MPBH8uoT8zg6tLg?pwd=bmzp" ref="nofollow noopener noreferrer">pan.baidu.com/s/191YElh8Mâ€¦</a></p>
<p>æå–ç : bmzp</p>
<h2 data-id="heading-8">JDK13</h2>
<p>é€šè¿‡ç½‘ç›˜åˆ†äº«çš„æ–‡ä»¶ï¼šJDK13</p>
<p>é“¾æ¥: <a href="https://link.juejin.cn?target=https%3A%2F%2Fpan.baidu.com%2Fs%2F1O5mJcvDXEFObYg91TUGXFA%3Fpwd%3D7wrs" target="_blank" title="https://pan.baidu.com/s/1O5mJcvDXEFObYg91TUGXFA?pwd=7wrs" ref="nofollow noopener noreferrer">pan.baidu.com/s/1O5mJcvDXâ€¦</a></p>
<p>æå–ç : 7wrs</p>
<h2 data-id="heading-9">JDK14</h2>
<p>é€šè¿‡ç½‘ç›˜åˆ†äº«çš„æ–‡ä»¶ï¼šJDK14</p>
<p>é“¾æ¥: <a href="https://link.juejin.cn?target=https%3A%2F%2Fpan.baidu.com%2Fs%2F1Xl5rrDGh80-Fxlo_Ug3wfg%3Fpwd%3Drve7" target="_blank" title="https://pan.baidu.com/s/1Xl5rrDGh80-Fxlo_Ug3wfg?pwd=rve7" ref="nofollow noopener noreferrer">pan.baidu.com/s/1Xl5rrDGhâ€¦</a></p>
<p>æå–ç : rve7</p>
<h2 data-id="heading-10">JDK15</h2>
<p>é€šè¿‡ç½‘ç›˜åˆ†äº«çš„æ–‡ä»¶ï¼šJDK15</p>
<p>é“¾æ¥: <a href="https://link.juejin.cn?target=https%3A%2F%2Fpan.baidu.com%2Fs%2F194EF9-_Rmh9AX0DH2FWM5w%3Fpwd%3Dkuxj" target="_blank" title="https://pan.baidu.com/s/194EF9-_Rmh9AX0DH2FWM5w?pwd=kuxj" ref="nofollow noopener noreferrer">pan.baidu.com/s/194EF9-_Râ€¦</a></p>
<p>æå–ç : kuxj</p>
<h2 data-id="heading-11">JDK16</h2>
<p>é€šè¿‡ç½‘ç›˜åˆ†äº«çš„æ–‡ä»¶ï¼šJDK16</p>
<p>é“¾æ¥: <a href="https://link.juejin.cn?target=https%3A%2F%2Fpan.baidu.com%2Fs%2F1iqcpE1FIa6AsVMsGIYn59w%3Fpwd%3D4j7p" target="_blank" title="https://pan.baidu.com/s/1iqcpE1FIa6AsVMsGIYn59w?pwd=4j7p" ref="nofollow noopener noreferrer">pan.baidu.com/s/1iqcpE1FIâ€¦</a></p>
<p>æå–ç : 4j7p</p>
<h2 data-id="heading-12">JDK17</h2>
<p>é€šè¿‡ç½‘ç›˜åˆ†äº«çš„æ–‡ä»¶ï¼šJDK17</p>
<p>é“¾æ¥: <a href="https://link.juejin.cn?target=https%3A%2F%2Fpan.baidu.com%2Fs%2F1Bk5lV7DxukOTi9h0muvrjg%3Fpwd%3Dk686" target="_blank" title="https://pan.baidu.com/s/1Bk5lV7DxukOTi9h0muvrjg?pwd=k686" ref="nofollow noopener noreferrer">pan.baidu.com/s/1Bk5lV7Dxâ€¦</a></p>
<p>æå–ç : k686</p>
<h2 data-id="heading-13">JDK18</h2>
<p>é€šè¿‡ç½‘ç›˜åˆ†äº«çš„æ–‡ä»¶ï¼šJDK18</p>
<p>é“¾æ¥: <a href="https://link.juejin.cn?target=https%3A%2F%2Fpan.baidu.com%2Fs%2F1PkPOK_ap-vE8pdXCTFns3Q%3Fpwd%3Dfyiv" target="_blank" title="https://pan.baidu.com/s/1PkPOK_ap-vE8pdXCTFns3Q?pwd=fyiv" ref="nofollow noopener noreferrer">pan.baidu.com/s/1PkPOK_apâ€¦</a></p>
<p>æå–ç : fyiv</p>
<h2 data-id="heading-14">JDK19</h2>
<p>é€šè¿‡ç½‘ç›˜åˆ†äº«çš„æ–‡ä»¶ï¼šJDK19</p>
<p>é“¾æ¥: <a href="https://link.juejin.cn?target=https%3A%2F%2Fpan.baidu.com%2Fs%2F1001F7reDD3f4kElZwxhJjQ%3Fpwd%3D5i5s" target="_blank" title="https://pan.baidu.com/s/1001F7reDD3f4kElZwxhJjQ?pwd=5i5s" ref="nofollow noopener noreferrer">pan.baidu.com/s/1001F7reDâ€¦</a></p>
<p>æå–ç : 5i5s</p>
<h2 data-id="heading-15">JDK20</h2>
<p>é€šè¿‡ç½‘ç›˜åˆ†äº«çš„æ–‡ä»¶ï¼šJDK20</p>
<p>é“¾æ¥: <a href="https://link.juejin.cn?target=https%3A%2F%2Fpan.baidu.com%2Fs%2F1WAg3fEMGlyMMWUkHla_AIQ%3Fpwd%3Daeft" target="_blank" title="https://pan.baidu.com/s/1WAg3fEMGlyMMWUkHla_AIQ?pwd=aeft" ref="nofollow noopener noreferrer">pan.baidu.com/s/1WAg3fEMGâ€¦</a></p>
<p>æå–ç : aeft</p>
<h2 data-id="heading-16">JDK21</h2>
<p>é€šè¿‡ç½‘ç›˜åˆ†äº«çš„æ–‡ä»¶ï¼šJDK21</p>
<p>é“¾æ¥: <a href="https://link.juejin.cn?target=https%3A%2F%2Fpan.baidu.com%2Fs%2F1HS0nV4NgRE5McYlMn87SlA%3Fpwd%3Dkwwr" target="_blank" title="https://pan.baidu.com/s/1HS0nV4NgRE5McYlMn87SlA?pwd=kwwr" ref="nofollow noopener noreferrer">pan.baidu.com/s/1HS0nV4Ngâ€¦</a></p>
<p>æå–ç : kwwr</p>
<h2 data-id="heading-17">JDK22</h2>
<p>é€šè¿‡ç½‘ç›˜åˆ†äº«çš„æ–‡ä»¶ï¼šJDK22</p>
<p>é“¾æ¥: <a href="https://link.juejin.cn?target=https%3A%2F%2Fpan.baidu.com%2Fs%2F1S2EqTU8a16Ey6bEBKbS4CA%3Fpwd%3Db2fe" target="_blank" title="https://pan.baidu.com/s/1S2EqTU8a16Ey6bEBKbS4CA?pwd=b2fe" ref="nofollow noopener noreferrer">pan.baidu.com/s/1S2EqTU8aâ€¦</a></p>
<p>æå–ç : b2fe</p>
<h2 data-id="heading-18">JDK23</h2>
<p>é€šè¿‡ç½‘ç›˜åˆ†äº«çš„æ–‡ä»¶ï¼šJDK23</p>
<p>é“¾æ¥: <a href="https://link.juejin.cn?target=https%3A%2F%2Fpan.baidu.com%2Fs%2F1H_B4e2RG2hE_tGj3vL_SCQ%3Fpwd%3Dy4bp" target="_blank" title="https://pan.baidu.com/s/1H_B4e2RG2hE_tGj3vL_SCQ?pwd=y4bp" ref="nofollow noopener noreferrer">pan.baidu.com/s/1H_B4e2RGâ€¦</a></p>
<p>æå–ç : y4bp</p>
<h2 data-id="heading-19">JDK24</h2>
<p>é€šè¿‡ç½‘ç›˜åˆ†äº«çš„æ–‡ä»¶ï¼šJDK24</p>
<p>é“¾æ¥: <a href="https://link.juejin.cn?target=https%3A%2F%2Fpan.baidu.com%2Fs%2F1vKSW4DDaDG8URWVrWaj2-A%3Fpwd%3D1jy2" target="_blank" title="https://pan.baidu.com/s/1vKSW4DDaDG8URWVrWaj2-A?pwd=1jy2" ref="nofollow noopener noreferrer">pan.baidu.com/s/1vKSW4DDaâ€¦</a></p>
<p>æå–ç : 1jy2</p>
<h2 data-id="heading-20">JDK25</h2>
<p>é€šè¿‡ç½‘ç›˜åˆ†äº«çš„æ–‡ä»¶ï¼šJDK25</p>
<p>é“¾æ¥: <a href="https://link.juejin.cn?target=https%3A%2F%2Fpan.baidu.com%2Fs%2F1tuBLLj-6DyPunBZRzTBF9Q%3Fpwd%3Ddc9f" target="_blank" title="https://pan.baidu.com/s/1tuBLLj-6DyPunBZRzTBF9Q?pwd=dc9f" ref="nofollow noopener noreferrer">pan.baidu.com/s/1tuBLLj-6â€¦</a></p>
<p>æå–ç : dc9f</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Spring æºç åˆ†æ BeanFactoryPostProcessor]]></title>    <link>https://juejin.cn/post/7603771025856528435</link>    <guid>https://juejin.cn/post/7603771025856528435</guid>    <pubDate>2026-02-08T06:21:32.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7603771025856528435" data-draft-id="7599852579067133967" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Spring æºç åˆ†æ BeanFactoryPostProcessor"/> <meta itemprop="keywords" content="Spring,Spring Boot,æºç "/> <meta itemprop="datePublished" content="2026-02-08T06:21:32.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="æš®è‰²å¦–å¨†ä¸¶"/> <meta itemprop="url" content="https://juejin.cn/user/4292946760307655"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Spring æºç åˆ†æ BeanFactoryPostProcessor
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4292946760307655/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    æš®è‰²å¦–å¨†ä¸¶
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-08T06:21:32.000Z" title="Sun Feb 08 2026 06:21:32 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»16åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">å‰è¨€</h2>
<p>ä¸Šä¸€ç¯‡è®²è¿°äº† <code>SpringBoot</code> å¯åŠ¨æµç¨‹å’Œç›¸å…³æºç åˆ†æï¼Œå…¶ä¸­ä¸€ä¸ªé‡è¦çš„åˆ·æ–°æ–¹æ³•  <code>AbstractApplicationContext#refresh()</code> æ˜¯å±äº <code>Spring</code> çš„å†…å®¹ï¼Œä¹Ÿæ˜¯ <code>Spring</code> æ¡†æ¶çš„æ ¸å¿ƒæ–¹æ³•ï¼Œææ‡‚äº†è¿™ä¸ªæ–¹æ³•ï¼ŒåŸºæœ¬ä¸Šå¯ä»¥è¯´å°±å®Œå…¨ææ‡‚äº† <code>Spring</code></p>
<p>æƒ³äº†å¾ˆä¹…ä¸çŸ¥é“å¯¹äºè¿™æ ·ä¸€ä¸ªå¤æ‚çš„æ¡†æ¶ï¼Œä»ä½•å¼€å§‹è®²èµ·ï¼Œé‚£ä¹ˆå°±æŒ‰ç…§ <code>AbstractApplicationContext#refresh()</code> çš„å†…éƒ¨ä»£ç é¡ºåºæ¥å§ï¼Œå…ˆå­¦ä¹  <code>BeanFactoryPostProcessor</code>ã€‚</p>
<p>æœ¬ç¯‡æ–‡ç« ä½¿ç”¨çš„ç‰ˆæœ¬æ˜¯ <code>SpringBoot 3.4.1 ã€ Spring 6.2.1</code>ã€‚</p>
<h2 data-id="heading-1">SpringBoot &amp; Spring æ¶æ„å›¾ç¤ºæ¦‚è§ˆ</h2>
<p>è¿™é‡Œæˆ‘ä»¥ <code>SpringBoot</code> æºç å…¥å£ä¸ºèµ·ç‚¹ï¼Œç”»äº†ä¸€ä¸ªç›¸å…³çš„æµç¨‹å›¾ï¼ŒåŒ…å«äº† <code>SpringBootã€Spring äº‹åŠ¡ã€Spring AOPã€Spring äº‹ä»¶ã€BeanFactoryPostProcessorã€BeanPostProcessor</code> ç­‰æ‰€æœ‰ <code>Spring</code> çŸ¥è¯†ï¼Œä»¥åŠç›¸å…³æ¨¡å—ä¹‹é—´çš„äº¤äº’è”ç³»ï¼Œåç»­ä¹Ÿä¼šæŒç»­æ›´æ–°æ­¤å›¾ï¼ˆå› ä¸ºæˆ‘è‡ªå·±è¿˜æ²¡æœ‰å­¦å®Œï¼‰ï¼Œæˆ‘è¯•äº†ä¸‹ä½œè€…ä¾§è¿™è¾¹æ›´æ–°åï¼Œåˆ†äº«çš„åä½œé“¾æ¥ä¹Ÿä¼šå®æ—¶å˜æ›´ï¼Œå¸Œæœ›å¯¹å¤§å®¶æœ‰å¸®åŠ©</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.processon.com%2Fv%2F696465e679c29354e9e50f69" target="_blank" title="https://www.processon.com/v/696465e679c29354e9e50f69" ref="nofollow noopener noreferrer">SpringBoot &amp; Spring æ¶æ„å›¾ æŒç»­æ›´æ–°</a> å¯¹äºå³å°†éœ€è¦é¢è¯•çš„åŒå­¦åº”è¯¥ä¼šæ¯”è¾ƒæœ‰å¸®åŠ©ï¼</p>
<h2 data-id="heading-2">å‰ç½®çŸ¥è¯† IoC å®¹å™¨</h2>
<p><code>IoC</code> å…¨ç§° <code>Inversion of Control</code>ï¼Œå«åšæ§åˆ¶åè½¬ï¼Œå®ƒæ˜¯ä¸€ç§è®¾è®¡åŸåˆ™ï¼Œå…¶æ ¸å¿ƒæ€æƒ³æ˜¯å°†å¯¹è±¡åˆ›å»ºã€ä¾èµ–ç®¡ç†å’Œç”Ÿå‘½å‘¨æœŸæ§åˆ¶çš„æƒåŠ›ä»åº”ç”¨ç¨‹åºä»£ç  <strong>åè½¬</strong> ç»™å®¹å™¨ï¼ˆæ¡†æ¶ï¼‰ã€‚</p>
<p>åŸæœ¬æˆ‘ä»¬éœ€è¦è°ƒç”¨æŸä¸ªä¸šåŠ¡æ–¹æ³•ï¼Œéœ€è¦è‡ªå·±å®ä¾‹åŒ–å¯¹è±¡ï¼Œç„¶åè°ƒç”¨è¯¥å¯¹è±¡æŸä¸ªæ–¹æ³•ï¼Œä½¿ç”¨ <code>Spring</code> ä¹‹åï¼Œæˆ‘ä»¬æŠŠè¯¥å¯¹è±¡äº¤ç»™ <code>Spring</code> ç®¡ç†ï¼Œ<code>Spring</code> æ¡†æ¶å¸®æˆ‘ä»¬åˆ›å»ºå¯¹è±¡ï¼Œæˆ‘ä»¬åªéœ€è¦æ‹¿ <code>Spring</code> åˆ›å»ºå¥½çš„å¯¹è±¡å³å¯ã€‚è€Œæˆ‘ä»¬äº¤ç»™ <code>Spring</code> ç®¡ç†çš„å¯¹è±¡é€šå¸¸å°±å«åš <code>Bean</code>ã€‚</p>
<p><code>IoC</code> å®¹å™¨å°±æ˜¯é€šå¸¸æˆ‘ä»¬å¸¸è¯´çš„ <code>Spring ä¸Šä¸‹æ–‡</code>ï¼Œ<code>ApplicationContext</code> çš„å®ç°ç±»ï¼Œå¯¹äº <code>SpringBoot</code> æ¥è¯´ï¼Œå…¶æ‰©å±•çš„å®ç°ç±»æ˜¯ <code>AnnotationConfigServletWebServerApplicationContext</code></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
   <span class="hljs-type">ConfigurableApplicationContext</span> <span class="hljs-variable">context</span> <span class="hljs-operator">=</span> SpringApplication.run(SpringAiDemoApplication.class, args);
}
</code></pre>
<p><code>SpringBoot</code> ä¸»ç±»çš„ <code>run</code> æ–¹æ³•ï¼Œå…¶è¿”å›å€¼å°±æ˜¯ä¸€ä¸ª <code>IoC</code> å®¹å™¨ï¼Œ<code>ApplicationContext</code> çš„å­æ¥å£</p>
<h2 data-id="heading-3">å‰ç½®çŸ¥è¯† BeanDefinition å’Œ Bean</h2>
<p>åœ¨å¼€å§‹ä¹‹å‰ï¼Œæˆ‘ç›¸ä¿¡å¤§å®¶éƒ½æ˜¯å·²ç»ç†Ÿæ‚‰ <code>Spring</code> æ¡†æ¶çš„æ—¥å¸¸ç”¨æ³•ï¼Œæˆ‘ä»¬éœ€è¦æœ‰ä¸€ä¸ªå‰ç½®çŸ¥è¯†å‚¨å¤‡ï¼Œåœ¨ <code>Spring</code> å®¹å™¨ä¸­ï¼Œ<code>Bean</code> çš„åˆ›å»ºéƒ½æ˜¯ç”± <code>BeanDefinition</code> å†³å®šçš„ï¼Œ <code>BeanDefinition</code> æè¿°äº†è¿™ä¸ª <code>Bean</code> çš„æ‰€æœ‰ä¿¡æ¯</p>
<ul>
<li><code>Bean</code> çš„ç±»å‹</li>
<li><code>Bean</code> çš„åå­—</li>
<li>å•ä¾‹è¿˜æ˜¯å¤šä¾‹</li>
<li>æ˜¯å¦å»¶è¿ŸåŠ è½½</li>
<li>æ˜¯å¦å…è®¸è‡ªåŠ¨è£…é…</li>
<li>ç­‰ç­‰</li>
</ul>
<p>æ¯”å¦‚æˆ‘ä»¬ä½¿ç”¨ <code>@Configurationã€@Beanã€@Component</code> æ³¨è§£ä¸€ä¸ª <code>Bean</code>ã€‚åˆ·æ–°æ–¹æ³•ä¸­ï¼Œå…ˆè§£æè¿™äº›æ³¨è§£å¾—åˆ°äº† <code>BeanDefinition</code> ä¿¡æ¯ï¼Œå½“æ‰€æœ‰é…ç½®ç›¸å…³çš„æ³¨è§£è¢«è§£æå®Œï¼Œå¾—åˆ°ä¸€ä¸ª</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Map&lt;String, BeanDefinition&gt; beanDefinitionMap = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ConcurrentHashMap</span>&lt;&gt;(<span class="hljs-number">256</span>);
<span class="hljs-keyword">private</span> <span class="hljs-keyword">volatile</span> List&lt;String&gt; beanDefinitionNames = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;(<span class="hljs-number">256</span>);
</code></pre>
<p>ç„¶å <code>Spring</code> éå†è¿™ä¸ª <code>beanDefinitionNames</code> å»åˆ›å»º <code>Bean</code>ã€‚</p>
<blockquote>
<p>å› ä¸º HashMap æ˜¯æ— åºçš„ï¼Œåˆ›å»º Bean éœ€è¦æ ¹æ®é¡ºåºåˆ›å»ºï¼Œæ‰€ä»¥éœ€è¦è¿™ä¸ª beanDefinitionNames</p>
</blockquote>
<h2 data-id="heading-4">BeanFactoryPostProcessor çš„ä½œç”¨</h2>
<p>å­¦ä¹ æºç ï¼Œæœ€æœ‰æ•ˆçš„æ–¹å¼ä¹‹ä¸€å°±æ˜¯çœ‹æ³¨é‡Šï¼Œ</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">/**
 * Factory hook that allows for custom modification of an application context's
 * bean definitions, adapting the bean property values of the context's underlying
 * bean factory.
 * ......
 */</span>
<span class="hljs-meta">@FunctionalInterface</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">BeanFactoryPostProcessor</span> {

    <span class="hljs-comment">/**
     * Modify the application context's internal bean factory after its standard
     * initialization. All bean definitions will have been loaded, but no beans
     * will have been instantiated yet. This allows for overriding or adding
     * properties even to eager-initializing beans.
     * <span class="hljs-doctag">@param</span> beanFactory the bean factory used by the application context
     * <span class="hljs-doctag">@throws</span> org.springframework.beans.BeansException in case of errors
     */</span>
    <span class="hljs-keyword">void</span> <span class="hljs-title function_">postProcessBeanFactory</span><span class="hljs-params">(ConfigurableListableBeanFactory beanFactory)</span> <span class="hljs-keyword">throws</span> BeansException;

}
</code></pre>
<p>æ³¨é‡Šè¯´æ˜è¿™ä¸ªç±»çš„ä½œç”¨ç›¸å½“äºä¸€ä¸ªå·¥å‚å›è°ƒå‡½æ•°ï¼ˆé€šå¸¸æˆ‘ä»¬å«å®ƒ <code>Bean å·¥å‚åç½®å¤„ç†å™¨</code>ï¼‰ï¼Œå¯ä»¥è°ƒæ•´ä¸Šä¸‹æ–‡çš„åº•å±‚<code>Bean</code> å·¥å‚çš„ <code>Bean</code> å±æ€§å€¼ã€‚ä¹Ÿå°±æ˜¯åœ¨ <code>Bean</code> åˆ›å»ºå‰ï¼Œ<code>BeanDefinition</code> å·²é»˜è®¤åŠ è½½åï¼Œä¿®æ”¹æŸäº› <code>BeanDefinition</code> ã€‚å› ä¸º <code>Bean</code> çš„åˆ›å»ºæ˜¯ç”± <code>BeanDefinition</code> å†³å®šçš„ï¼Œæ‰€ä»¥ä¿®æ”¹ <code>BeanDefinition</code>ï¼Œä¹Ÿå°±ç›¸å½“äºä¿®æ”¹å³å°†è¦åˆ›å»ºçš„ <code>Bean</code></p>
<h2 data-id="heading-5">å†…ç½®çš„ BeanFactoryPostProcessor</h2>
<p>åœ¨ä¸Šä¸€ç¯‡ <code>SpringBoot</code> æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬æåˆ°åœ¨åˆ›å»º <code>Spring</code> ä¸Šä¸‹æ–‡çš„æ—¶å€™ï¼Œ<code>AnnotationConfigServletWebServerApplicationContext</code> çš„æ„é€ æ–¹æ³•ä¸­ï¼Œä¼šæ³¨å†Œä¸€äº›å†…ç½®çš„ <code>BeanFactoryPostProcessor</code>ã€‚æºç </p>
<pre><code class="hljs language-java" lang="java">org.springframework.context.annotation.AnnotationConfigUtils#registerAnnotationConfigProcessors()
</code></pre>
<p>å†…ç½®ä¼šæ³¨å†Œä»¥ä¸‹åç½®å¤„ç†å™¨</p>
<pre><code class="hljs language-java" lang="java">ConfigurationClassPostProcessor  å¤„ç†æ‰€æœ‰é…ç½®æ³¨è§£ <span class="hljs-meta">@Componentscan</span>ã€<span class="hljs-meta">@Import</span>ã€<span class="hljs-meta">@Bean</span>ã€<span class="hljs-meta">@Component</span> ç­‰
AutowiredAnnotationBeanPostProcessor  å¤„ç† <span class="hljs-meta">@Autowired</span>
CommonAnnotationBeanPostProcessor     å¤„ç† <span class="hljs-meta">@PostConstruct</span>ã€<span class="hljs-meta">@Resource</span> ç­‰
PersistenceAnnotationBeanPostProcessor(å¦‚æœç”¨äº† JPA)
EventListenerMethodProcessor    å¤„ç† <span class="hljs-meta">@EventListener</span>
DefaultEventListenerFactory  ï¼ˆä¸æ˜¯åç½®å¤„ç†å™¨ï¼Œä¸çŸ¥é“ä¸ºä»€ä¹ˆæ”¾åœ¨è¿™ä¸ªæ–¹æ³•é‡Œï¼‰
</code></pre>
<p>è¿™é‡Œåªæœ‰ <code>ConfigurationClassPostProcessor</code> å’Œ <code>EventListenerMethodProcessor</code> æ˜¯å·¥å‚åç½®å¤„ç†å™¨ <code>BeanFactoryPostProcessor</code>ï¼Œå…¶ä»–éƒ½æ˜¯ Bean çš„åç½®å¤„ç†å™¨ <code>BeanPostProcessor</code>ï¼Œä¸‹ä¸€ç¯‡æ–‡ç« ä¼šä»‹ç»ã€‚åœ¨ä»‹ç» <code>ConfigurationClassPostProcessor</code> å’Œ <code>EventListenerMethodProcessor</code> çš„ä½œç”¨ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆå­¦ä¹ ä¸€ä¸ª <code>BeanFactoryPostProcessor</code> çš„æ‰©å±•æ¥å£ <code>BeanDefinitionRegistryPostProcessor</code>ã€‚</p>
<h2 data-id="heading-6">BeanDefinitionRegistryPostProcessor</h2>
<p>è¿˜æ˜¯è€è§„çŸ©ï¼Œå­¦ä¹ ä¸€ä¸ªç±»ä¹‹å‰å…ˆçœ‹æ³¨é‡Š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">/**
 * Extension to the standard {<span class="hljs-doctag">@link</span> BeanFactoryPostProcessor} SPI, allowing for
 * the registration of further bean definitions &lt;i&gt;before&lt;/i&gt; regular
 * BeanFactoryPostProcessor detection kicks in. In particular,
 * BeanDefinitionRegistryPostProcessor may register further bean definitions
 * which in turn define BeanFactoryPostProcessor instances.

 * <span class="hljs-doctag">@see</span> org.springframework.context.annotation.ConfigurationClassPostProcessor
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">BeanDefinitionRegistryPostProcessor</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">BeanFactoryPostProcessor</span> {

    <span class="hljs-comment">/**
     * Modify the application context's internal bean definition registry after its
     * standard initialization. All regular bean definitions will have been loaded,
     * but no beans will have been instantiated yet. This allows for adding further
     * bean definitions before the next post-processing phase kicks in.
     * <span class="hljs-doctag">@param</span> registry the bean definition registry used by the application context
     * <span class="hljs-doctag">@throws</span> org.springframework.beans.BeansException in case of errors
     */</span>
    <span class="hljs-keyword">void</span> <span class="hljs-title function_">postProcessBeanDefinitionRegistry</span><span class="hljs-params">(BeanDefinitionRegistry registry)</span> <span class="hljs-keyword">throws</span> BeansException;
}
</code></pre>
<p>æ³¨é‡Šè¯´ <code>BeanDefinitionRegistryPostProcessor</code> æ˜¯ <code>BeanFactoryPostProcessor</code> çš„ä¸€ä¸ªæ‰©å±•æ¥å£ã€‚å®¹å™¨åˆ·æ–°è¿‡ç¨‹ä¸­ <code>postProcessBeanDefinitionRegistry()</code> åœ¨ <code>postProcessBeanFactory()</code> ä¹‹å‰æ‰§è¡Œï¼Œä»–ä»¬çš„åŒºåˆ«å’Œä½œç”¨å¦‚ä¸‹</p>
<h3 data-id="heading-7">å’Œ BeanFactoryPostProcessor çš„åŒºåˆ«å¯¹æ¯”</h3>
<p>è¿™é‡Œç”¨ä¸€ä¸ªè¡¨æ ¼æ¥å¯¹æ¯” <code>BeanDefinitionRegistryPostProcessor</code> å’Œ <code>BeanFactoryPostProcessor</code> çš„æ–¹æ³•</p>



































<table><thead><tr><th>ç»´åº¦</th><th>postProcessBeanDefinitionRegistry</th><th>postProcessBeanFactory</th></tr></thead><tbody><tr><td><strong>æ‰§è¡Œæ—¶æœº</strong></td><td><strong>æ›´æ—©</strong>ï¼Œåœ¨æ‰€æœ‰ BeanFactoryPostProcessor ä¹‹å‰</td><td><strong>ç¨æ™š</strong>ï¼Œåœ¨æ‰€æœ‰ postProcessBeanDefinitionRegistry ä¹‹å</td></tr><tr><td><strong>å‚æ•°ç±»å‹</strong></td><td><code>BeanDefinitionRegistry</code></td><td><code>ConfigurableListableBeanFactory</code></td></tr><tr><td><strong>ä¸»è¦ç”¨é€”</strong></td><td><strong>æ³¨å†Œã€ä¿®æ”¹ã€ç§»é™¤</strong> BeanDefinition</td><td><strong>ä¿®æ”¹</strong> å·²æ³¨å†Œçš„ BeanDefinitionï¼Œä¸èƒ½æ³¨å†Œå’Œç§»é™¤</td></tr><tr><td><strong>èƒ½åŠ›èŒƒå›´</strong></td><td><strong>æ³¨å†Œæ–° Bean</strong> çš„èƒ½åŠ›æ›´å¼º</td><td><strong>ä¿®æ”¹ç°æœ‰ Bean</strong> çš„å±æ€§</td></tr><tr><td><strong>æ‰§è¡Œé¡ºåº</strong></td><td>ç¬¬ä¸€é˜¶æ®µ</td><td>ç¬¬äºŒé˜¶æ®µ</td></tr></tbody></table>
<p>ä¹Ÿå°±æ˜¯è¯´ä»–ä»¬ä¸¤éƒ½æ˜¯å¯¹ <code>BeanDefinition</code> åšæ“ä½œçš„ï¼Œåªä¸è¿‡æ—¶æœºä¸åŒ</p>
<h2 data-id="heading-8">å¸¸è§çš„ BeanFactoryPostProcessor</h2>
<p><code>SpringBoot</code> é¡¹ç›®ä¸­æœ‰ä¸€äº›å†…ç½®çš„å·¥å‚åç½®å¤„ç†å™¨</p>
<ul>
<li><code>ConfigurationClassPostProcessor</code>  è§£æé…ç½®ç±»ï¼Œè·å– <code>BeanDefiniton</code></li>
<li><code>EventListenerMethodProcessor</code>     åˆå§‹åŒ–äº‹ä»¶å·¥å‚ï¼Œä¸ºäº†åç»­åˆ›å»ºäº‹ä»¶ç›‘å¬å™¨</li>
<li><code>PropertySourcesPlaceholderConfigurer</code> å¤„ç†é…ç½®ç±»æˆå‘˜å˜é‡çš„å€¼æœ‰å±æ€§å ä½ç¬¦ï¼Œæ¯”å¦‚æœ‰äº› <code>Bean</code> çš„æŸä¸ªå±æ€§å€¼æ˜¯ <code>${mybatis-plus.lazy-initialization}</code> è¿™ç§è¡¨è¾¾å¼ï¼Œå°±æ˜¯é€šè¿‡è¿™ä¸ªåç½®å¤„ç†å™¨æ¥è§£æèµ‹å€¼</li>
<li><code>MapperScannerConfigurer</code> å¦‚æœä½¿ç”¨äº† <code>mybatis</code> ï¼Œæ‰«æ <code>@Mapper</code> æ³¨è§£çš„ç±»ï¼Œæ·»åŠ åˆ° <code>Spring</code> å®¹å™¨</li>
<li><code>CachingMetadataReaderFactoryPostProcessor</code>  ç¼“å­˜ <code>ResourceLoader</code> å·²åŠ è½½çš„é…ç½®ç±»ï¼Œä¸è¦é‡å¤åŠ è½½</li>
</ul>
<p>ä¸‹é¢æˆ‘ä»¬è¯¦ç»†ä»‹ç»å…¶ä¸­å‡ ä¸ªé‡è¦çš„å·¥å‚åç½®å¤„ç†å™¨çš„ä½œç”¨ã€‚</p>
<h2 data-id="heading-9">BeanFactoryPostProcessor çš„æ‰§è¡Œ</h2>
<p>å·¥å‚åç½®å¤„ç†å™¨çš„æ‰§è¡Œæ–¹æ³•æ˜¯é€šè¿‡ä¸€ä¸ªå§”æ‰˜ç±» <code>PostProcessorRegistrationDelegate</code> å®ç°çš„</p>
<pre><code class="hljs language-java" lang="java">PostProcessorRegistrationDelegate.invokeBeanFactoryPostProcessors(beanFactory, getBeanFactoryPostProcessors());
</code></pre>
<p>è¿™ä¸ªæ–¹æ³•éå¸¸æœ‰æ„æ€ï¼Œä½œè€…åœ¨è¿™é‡Œç»™å‡ºäº†ä¸€å¤§æ®µçš„æ³¨é‡Šï¼Œå‘Šè¯‰è¯»è€…ä¸è¦å†å» <code>Github</code> æ <code>issue</code> äº†ï¼Œå› ä¸ºè¿™ä¸ªæ–¹æ³•çš„ä»£ç çœ‹èµ·æ¥å¾ˆä¹±ã€æœ‰å¾ˆå¤šé‡å¤ä»£ç ï¼Œå¾ˆå¤šè¯»è€…æäº† <code>issue</code> è¡¨æ˜è¿™ä¸ªæ–¹æ³•éœ€è¦ä¼˜åŒ–ï¼Œä½†æ˜¯ä½œè€…ä¸€ä¸€æ‹’ç»ï¼Œå›åº”è¯´è¿™ç§å®ç°æ˜¯å¿…è¦çš„ï¼Œä¸€å®šè¦ç¡®ä¿å·¥å‚åç½®å¤„ç†å™¨çš„æ‰§è¡Œé¡ºåºã€‚æœ‰å…´è¶£å¯ä»¥æŸ¥é˜…ä¸Šè¿°æ–¹æ³•çš„æºç </p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5a1cf98563ec41d08e400d64fcb53590~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pqu6Imy5aaW5aiG5Li2:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771136492&amp;x-signature=ork6UczAeDRGazI37V22JO8O63Y%3D" alt="image.png" loading="lazy"/></p>
<p>è¿™é‡Œä½œè€…å°† <code>BeanDefinitionRegistryPostProcessor</code> å’Œ <code>BeanFactoryPostProcessor</code> åˆ†å¼€ï¼Œå¹¶ä¸”å°†å®ƒä»¬åˆ†åˆ«æŒ‰ç…§é¡ºåºæ’åºæ”¾åˆ°ä¸åŒåˆ—è¡¨ä¸­ä¾æ¬¡æ‰§è¡Œã€‚</p>
<blockquote>
<p>æ³¨æ„ï¼Œè¿™ä¸ªé˜¶æ®µè¿˜æ²¡æœ‰åˆ›å»º <code>Bean</code> ï¼Œæ‰€ä»¥è¦æ‰§è¡Œçš„ <code>BeanFactoryPostProcessor</code> ï¼Œéƒ½æ˜¯é€šè¿‡ä» <code>BeanFactory</code> é‡Œé¢çš„ <code>beanDefinitonNames</code> é›†åˆæ‹¿åˆ°çš„ï¼Œä½¿ç”¨ <code>beanFactory.getBeanNamesForType()</code> æ–¹æ³•</p>
</blockquote>
<h2 data-id="heading-10">é…ç½®ç±»åŠ è½½åŸç† ï¼ˆéå¸¸éå¸¸é‡è¦ï¼‰ConfigurationClassPostProcessor</h2>
<p>è¿™æ˜¯ä¸€ä¸ªéå¸¸é‡è¦çš„ <code>BeanFactoryPostProcessor</code>ï¼Œ<code>Spring</code> é¡¹ç›®å¯åŠ¨åŠ è½½é…ç½®ç±»å‡ ä¹å…¨éƒ½æ˜¯å®ƒå®ç°çš„ï¼Œé™¤äº†æˆ‘ä»¬è‡ªå·±å£°æ˜çš„ <code>Serviceã€Controller</code>ã€‚ é…ç½®ç±»æœ¬èº«ä¹Ÿæ˜¯ <code>Spring Bean</code>ã€‚</p>
<p>å…¶å®æˆ‘ä»¬æŸ¥çœ‹æºç ä¼šå‘ç° <code>@Serviceã€@Controllerã€@Configuration</code> æœ¬èº«å°±æ˜¯ä¸€ä¸ª <code>@Component</code>ã€‚æŸ¥çœ‹ <code>@Component</code> çš„æ³¨é‡Š</p>
<pre><code class="hljs language-vbnet" lang="vbnet">/**
 * Indicates that the annotated <span class="hljs-keyword">class</span> <span class="hljs-built_in">is</span> a &lt;em&gt;component&lt;/em&gt;.
 *
 * &lt;p&gt;Such classes are considered <span class="hljs-keyword">as</span> candidates <span class="hljs-keyword">for</span> <span class="hljs-keyword">auto</span>-detection
 * <span class="hljs-keyword">when</span> <span class="hljs-keyword">using</span> annotation-based configuration <span class="hljs-built_in">and</span> classpath scanning.
 */
</code></pre>
<p>è¢«è¿™ä¸ªæ³¨è§£æ ‡æ³¨çš„ç±»éƒ½ä¼šè¢«è§†ä¸ºä¸€ä¸ªç»„ä»¶ï¼Œåœ¨è¢«æ‰«æçš„æ—¶å€™ä¼šè¢«è®¤ä¸ºæ˜¯ä¸€ä¸ªé…ç½®ç±»</p>
<h3 data-id="heading-11">ä»£ç è§£è¯»</h3>
<p><code>ConfigurationClassPostProcessor</code> æ˜¯ä¸€ä¸ª <code>BeanDefinitionRegistryPostProcessor</code> ã€‚æˆ‘ä»¬æŸ¥çœ‹æºç æ–¹æ³•çš„è°ƒç”¨è¿‡ç¨‹ <code>postProcessBeanDefinitionRegistry â†’ processConfigBeanDefinitions â†’ ConfigurationClassParser#parse â†’ ConfigurationClassParser#processConfigurationClass â†’ ConfigurationClassParser#doProcessConfigurationClass(arg1,arg2) â†’ doProcessConfigurationClass(arg1,arg2,arg3)</code></p>
<p>å…ˆçœ‹ <code>parse()</code> æ–¹æ³•</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">parse</span><span class="hljs-params">(Set&lt;BeanDefinitionHolder&gt; configCandidates)</span> {
    <span class="hljs-keyword">for</span> (BeanDefinitionHolder holder : configCandidates) {
       <span class="hljs-type">BeanDefinition</span> <span class="hljs-variable">bd</span> <span class="hljs-operator">=</span> holder.getBeanDefinition();
       <span class="hljs-keyword">try</span> {
          <span class="hljs-keyword">if</span> (bd <span class="hljs-keyword">instanceof</span> AnnotatedBeanDefinition annotatedBeanDef) {
             parse(annotatedBeanDef, holder.getBeanName());
          }
          <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (bd <span class="hljs-keyword">instanceof</span> AbstractBeanDefinition abstractBeanDef &amp;&amp; abstractBeanDef.hasBeanClass()) {
             parse(abstractBeanDef.getBeanClass(), holder.getBeanName());
          }
          <span class="hljs-keyword">else</span> {
             parse(bd.getBeanClassName(), holder.getBeanName());
          }
       }
       <span class="hljs-keyword">catch</span> (BeanDefinitionStoreException ex) {
          <span class="hljs-keyword">throw</span> ex;
       }
       <span class="hljs-keyword">catch</span> (Throwable ex) {
          <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BeanDefinitionStoreException</span>(
                <span class="hljs-string">"Failed to parse configuration class ["</span> + bd.getBeanClassName() + <span class="hljs-string">"]"</span>, ex);
       }
    }

    <span class="hljs-built_in">this</span>.deferredImportSelectorHandler.process();
}
</code></pre>
<p>æˆ‘ä»¬ä¼ å…¥çš„å…¥å‚å°±æ˜¯ <code>SpringBoot</code> ä¸»ç±»çš„ <code>BeanDefinition</code>ï¼Œè¿™ä¸ªæ–¹æ³•æ ¹æ® <code>BeanDefinition</code> å®é™…çš„ç±»å‹èµ°ä¸åŒçš„é‡è½½æ–¹æ³•ï¼Œ<code>SpringBoot</code> é¡¹ç›®ä¸»ç±»çš„å®šä¹‰ç±»å‹æ˜¯ <code>AnnotatedBeanDefinition</code> ã€‚ æ¥ä¸‹æ¥æˆ‘ä»¬çœ‹ <code>doProcessConfigurationClass(arg1,arg2)</code></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">processConfigurationClass</span><span class="hljs-params">(ConfigurationClass configClass, Predicate&lt;String&gt; filter)</span> {
     <span class="hljs-comment">//......</span>
    <span class="hljs-comment">// å¾ªç¯å¤„ç†é…ç½®ç±»ï¼Œè¿”å›çš„ sourceClass æ˜¯çˆ¶ç±»ï¼Œåªè¦ä¸ä¸ºç©ºå°±ä¸€ç›´å‘ä¸Šæ‰¾çˆ¶ç±»å¾ªç¯å¤„ç†</span>
    <span class="hljs-type">SourceClass</span> <span class="hljs-variable">sourceClass</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;
    <span class="hljs-keyword">try</span> {
       sourceClass = asSourceClass(configClass, filter);
       <span class="hljs-keyword">do</span> {
          sourceClass = doProcessConfigurationClass(configClass, sourceClass, filter);
       }
       <span class="hljs-keyword">while</span> (sourceClass != <span class="hljs-literal">null</span>);
    }
    <span class="hljs-keyword">catch</span> (IOException ex) {
    <span class="hljs-comment">//...</span>
    }

    <span class="hljs-built_in">this</span>.configurationClasses.put(configClass, configClass);
}
</code></pre>
<p>è¿™é‡Œæœ‰ä¸€ä¸ªå¾ªç¯ï¼Œè§£æä¼ å…¥çš„é…ç½®ç±»ï¼Œè¿”å›è¯¥é…ç½®ç±»çš„çˆ¶ç±»ï¼Œå¦‚æœè¯¥é…ç½®ç±»çš„çˆ¶ç±»ä¸ä¸ºç©ºï¼Œå°±ä¸€ç›´è§£æã€‚
æ¥ä¸‹æ¥å†…éƒ¨æœ€ç›´è§‚çš„è§£æé…ç½®ç±»çš„æ–¹æ³• <code>doProcessConfigurationClass(arg1,arg2,arg3)</code> ã€‚</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">final</span> SourceClass <span class="hljs-title function_">doProcessConfigurationClass</span><span class="hljs-params">(ConfigurationClass configClass, SourceClass sourceClass, Predicate&lt;String&gt; filter)</span> {
    <span class="hljs-keyword">if</span> (configClass.getMetadata().isAnnotated(Component.class.getName())) {
       <span class="hljs-comment">// è§£æå†…éƒ¨ç±»ã€‚æ¯”å¦‚ä¸€ä¸ªåŠ äº† @Configuration çš„é…ç½®ç±»ï¼Œæœ‰ä¸€ä¸ªé™æ€å†…éƒ¨ç±»ä¹ŸåŠ äº† @Configuration</span>
       processMemberClasses(configClass, sourceClass, filter);
    }

    <span class="hljs-comment">// è§£æ @PropertySource æ³¨è§£</span>
    <span class="hljs-keyword">for</span> (AnnotationAttributes propertySource : AnnotationConfigUtils.attributesForRepeatable(
          sourceClass.getMetadata(), org.springframework.context.annotation.PropertySource.class,
          PropertySources.class, <span class="hljs-literal">true</span>)) {
       <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.propertySourceRegistry != <span class="hljs-literal">null</span>) {
          <span class="hljs-built_in">this</span>.propertySourceRegistry.processPropertySource(propertySource);
       }
    }

    <span class="hljs-comment">// è§£æ @ComponentScans æ³¨è§£</span>
    Set&lt;AnnotationAttributes&gt; componentScans = AnnotationConfigUtils.attributesForRepeatable(sourceClass.getMetadata(),ComponentScan.class, ComponentScans.class, MergedAnnotation::isDirectlyPresent);

    <span class="hljs-keyword">if</span> (componentScans.isEmpty()) {
       componentScans = AnnotationConfigUtils.attributesForRepeatable(sourceClass.getMetadata(), ComponentScan.class, ComponentScans.class, MergedAnnotation::isMetaPresent);
    }

    <span class="hljs-keyword">if</span> (!componentScans.isEmpty()) {
       List&lt;Condition&gt; registerBeanConditions = collectRegisterBeanConditions(configClass);
       <span class="hljs-keyword">for</span> (AnnotationAttributes componentScan : componentScans) {
          <span class="hljs-comment">// è§£æ @ComponentScan æ³¨è§£(æ³¨æ„è¿™é‡Œç›´æ¥å‘ Spring å®¹å™¨æ³¨å†Œäº† BeanDefiniton)</span>
          <span class="hljs-comment">//å…¶ä»–æ³¨è§£è§£æéƒ½æ˜¯å…ˆå°è£…æˆä¸€ä¸ª ConfigurationClass å¯¹è±¡ï¼Œåç»­ç»Ÿä¸€æ³¨å†Œ BeanDefinition</span>
          Set&lt;BeanDefinitionHolder&gt; scannedBeanDefinitions = <span class="hljs-built_in">this</span>.componentScanParser.parse(componentScan, sourceClass.getMetadata().getClassName());
          <span class="hljs-comment">// æ£€æŸ¥ @ComponentScan æ‰«æåˆ°çš„é…ç½®ç±»æ˜¯å¦è¿˜æœ‰å…¶ä»–é…ç½®æ³¨è§£ï¼Œä¾‹å¦‚ @Importï¼Œé€’å½’è§£æ</span>
          <span class="hljs-keyword">for</span> (BeanDefinitionHolder holder : scannedBeanDefinitions) {
             <span class="hljs-type">BeanDefinition</span> <span class="hljs-variable">bdCand</span> <span class="hljs-operator">=</span> holder.getBeanDefinition().getOriginatingBeanDefinition();
             <span class="hljs-keyword">if</span> (bdCand == <span class="hljs-literal">null</span>) {
                bdCand = holder.getBeanDefinition();
             }
             <span class="hljs-keyword">if</span> (ConfigurationClassUtils.checkConfigurationClassCandidate(bdCand, <span class="hljs-built_in">this</span>.metadataReaderFactory)) {
                parse(bdCand.getBeanClassName(), holder.getBeanName());
             }
          }
       }
    }

    <span class="hljs-comment">// è§£æ @Import æ³¨è§£ï¼ˆSpringBoot è‡ªåŠ¨é…ç½®ç±»çš„æ ¸å¿ƒå®ç°ï¼‰</span>
    processImports(configClass, sourceClass, getImports(sourceClass), filter, <span class="hljs-literal">true</span>);

    <span class="hljs-comment">//è§£æ @ImportResource æ³¨è§£</span>
    <span class="hljs-type">AnnotationAttributes</span> <span class="hljs-variable">importResource</span> <span class="hljs-operator">=</span> AnnotationConfigUtils.attributesFor(sourceClass.getMetadata(), ImportResource.class);
    <span class="hljs-keyword">if</span> (importResource != <span class="hljs-literal">null</span>) {
       String[] resources = importResource.getStringArray(<span class="hljs-string">"locations"</span>);
       Class&lt;? <span class="hljs-keyword">extends</span> <span class="hljs-title class_">BeanDefinitionReader</span>&gt; readerClass = importResource.getClass(<span class="hljs-string">"reader"</span>);
       <span class="hljs-keyword">for</span> (String resource : resources) {
          <span class="hljs-type">String</span> <span class="hljs-variable">resolvedResource</span> <span class="hljs-operator">=</span> <span class="hljs-built_in">this</span>.environment.resolveRequiredPlaceholders(resource);
          configClass.addImportedResource(resolvedResource, readerClass);
       }
    }

    <span class="hljs-comment">// è§£æ @Bean æ³¨è§£</span>
    Set&lt;MethodMetadata&gt; beanMethods = retrieveBeanMethodMetadata(sourceClass);
    <span class="hljs-keyword">for</span> (MethodMetadata methodMetadata : beanMethods) {
       <span class="hljs-keyword">if</span> (methodMetadata.isAnnotated(<span class="hljs-string">"kotlin.jvm.JvmStatic"</span>) &amp;&amp; !methodMetadata.isStatic()) {
          <span class="hljs-keyword">continue</span>;
       }
       configClass.addBeanMethod(<span class="hljs-keyword">new</span> <span class="hljs-title class_">BeanMethod</span>(methodMetadata, configClass));
    }

    <span class="hljs-comment">// è§£æå½“å‰ç±»å®ç°çš„æ¥å£é‡Œé¢åŠ äº† @Bean çš„ default æ–¹æ³•</span>
    processInterfaces(configClass, sourceClass);

    <span class="hljs-comment">// è§£æçˆ¶ç±»</span>
    <span class="hljs-keyword">if</span> (sourceClass.getMetadata().hasSuperClass()) {
       <span class="hljs-type">String</span> <span class="hljs-variable">superclass</span> <span class="hljs-operator">=</span> sourceClass.getMetadata().getSuperClassName();
       <span class="hljs-keyword">if</span> (superclass != <span class="hljs-literal">null</span> &amp;&amp; !superclass.startsWith(<span class="hljs-string">"java"</span>)) {
          <span class="hljs-type">boolean</span> <span class="hljs-variable">superclassKnown</span> <span class="hljs-operator">=</span> <span class="hljs-built_in">this</span>.knownSuperclasses.containsKey(superclass);
          <span class="hljs-built_in">this</span>.knownSuperclasses.add(superclass, configClass);
          <span class="hljs-keyword">if</span> (!superclassKnown) {
             <span class="hljs-comment">// Superclass found, return its annotation metadata and recurse</span>
             <span class="hljs-keyword">return</span> sourceClass.getSuperClass();
          }
       }
    }
    <span class="hljs-comment">// No superclass -&gt; processing is complete</span>
    <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
}
</code></pre>
<p>æˆ‘ä»¬å¯ä»¥ç»§ç»­é˜…è¯» <code>processMemberClasses()ã€processImports()</code> ç­‰æ¯ä¸€ä¸ªå…·ä½“è§£ææ³¨è§£çš„æ–¹æ³•ï¼Œä¼šå‘ç°
è¿™ä¸ªè§£ææ–¹æ³•çš„è°ƒç”¨æ˜¯ä¸€ä¸ªé€’å½’çš„è¿‡ç¨‹ã€‚å…ˆæ ¹æ®ä¸€ä¸ªä¸»é…ç½®ç±»ï¼Œåœ¨ <code>SpringBoot</code> ä¸­å°±æ˜¯åº”ç”¨å¯åŠ¨ä¸»ç±»ã€‚ç”±äº <code>@SpringBootApplication</code> å†…éƒ¨ç»„åˆäº† <code>@Configuration</code> ï¼Œæ‰€ä»¥å®ƒæ˜¯ä¸€ä¸ªé…ç½®ç±»ï¼Œ<code>SpringBoot</code> ä¼šä»¥ä¸»ç±»ä¸ºå…¥å£ï¼Œä»å®ƒå¼€å§‹æ‰«æï¼Œç„¶åç”±äº <code>SpringBootApplication</code> å†…éƒ¨ç»„åˆäº† <code>@ComponentScan</code> æ³¨è§£ï¼Œæ‰€ä»¥ä¼šè§£æä¸»ç±»æ‰€åœ¨çš„åŒ…ä¸‹çš„æ‰€æœ‰é…ç½®ç±»ã€‚ç„¶åç”±äºå®ƒå†…éƒ¨åˆç»„åˆäº† <code>SpringBootApplication â†’ @EnableAutoConfiguration â†’ @Import(AutoConfigurationImportSelector.class)</code>ï¼Œæ‰€ä»¥ä¼šè§£æ <code>AutoConfigurationImportSelector</code> è·å–çš„æ‰€æœ‰é…ç½®ç±»ã€‚è¿™ä¹Ÿæ˜¯ <code>SpringBoot</code> è‡ªåŠ¨é…ç½®çš„æ ¸å¿ƒå®ç°åŸç†</p>
<h3 data-id="heading-12">SpringBoot è‡ªåŠ¨é…ç½®çš„æ ¸å¿ƒåŸç†</h3>
<p>åœ¨ <code>SpringBoot</code> æ–‡ç« ä¸­æˆ‘ä»¬è¯´è¿‡ï¼Œè¿™ä¸ª <code>AutoConfigurationImportSelector</code> æ˜¯ <code>SpringBoot</code> è‡ªåŠ¨é…ç½®çš„æ ¸å¿ƒã€‚ä»ä¸Šé¢çš„è§£ææ–¹æ³• <code>doProcessConfigurationClass(arg1,arg2,arg3)</code> æˆ‘ä»¬çŸ¥é“å®ƒä¼šè§£æ <code>@Import</code> æ³¨è§£ï¼Œç„¶åæˆ‘ä»¬çœ‹  <code>processImports()</code> çš„æºç </p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">for</span> (SourceClass candidate : importCandidates) {
    <span class="hljs-keyword">if</span> (candidate.isAssignable(ImportSelector.class)) {
       <span class="hljs-comment">// å¤„ç† ImportSelector çš„é€»è¾‘</span>
       Class&lt;?&gt; candidateClass = candidate.loadClass();
       <span class="hljs-type">ImportSelector</span> <span class="hljs-variable">selector</span> <span class="hljs-operator">=</span> ParserStrategyUtils.instantiateClass(candidateClass, ImportSelector.class,<span class="hljs-built_in">this</span>.environment, <span class="hljs-built_in">this</span>.resourceLoader, <span class="hljs-built_in">this</span>.registry);
       Predicate&lt;String&gt; selectorFilter = selector.getExclusionFilter();
       <span class="hljs-keyword">if</span> (selectorFilter != <span class="hljs-literal">null</span>) {
          filter = filter.or(selectorFilter);
       }
       <span class="hljs-keyword">if</span> (selector <span class="hljs-keyword">instanceof</span> DeferredImportSelector deferredImportSelector) {
          <span class="hljs-built_in">this</span>.deferredImportSelectorHandler.handle(configClass, deferredImportSelector);
       }
       <span class="hljs-keyword">else</span> {
          String[] importClassNames = selector.selectImports(currentSourceClass.getMetadata());
          Collection&lt;SourceClass&gt; importSourceClasses = asSourceClasses(importClassNames, filter);
          processImports(configClass, currentSourceClass, importSourceClasses, filter, <span class="hljs-literal">false</span>);
       }
    }
    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (candidate.isAssignable(ImportBeanDefinitionRegistrar.class)) {
       <span class="hljs-comment">// å¤„ç† ImportBeanDefinitionRegistrar çš„é€»è¾‘</span>
       Class&lt;?&gt; candidateClass = candidate.loadClass();
       <span class="hljs-type">ImportBeanDefinitionRegistrar</span> <span class="hljs-variable">registrar</span> <span class="hljs-operator">=</span>
             ParserStrategyUtils.instantiateClass(candidateClass, ImportBeanDefinitionRegistrar.class,
                   <span class="hljs-built_in">this</span>.environment, <span class="hljs-built_in">this</span>.resourceLoader, <span class="hljs-built_in">this</span>.registry);
       configClass.addImportBeanDefinitionRegistrar(registrar, currentSourceClass.getMetadata());
    }
    <span class="hljs-keyword">else</span> {
       <span class="hljs-comment">// å¤„ç†æ™®é€šé…ç½®ç±»çš„é€»è¾‘</span>
       <span class="hljs-built_in">this</span>.importStack.registerImport(
             currentSourceClass.getMetadata(), candidate.getMetadata().getClassName());
       processConfigurationClass(candidate.asConfigClass(configClass), filter);
    }
}

</code></pre>
<p>è¿™é‡Œå¯¹äº <code>@Import</code> æœ‰ä¸‰ç§å¤„ç†é€»è¾‘ï¼Œç›¸å½“äºä¸€ä¸ªç­–ç•¥æ¨¡å¼çš„ä½“ç°</p>
<ul>
<li><code>@Import(XxxImportSelector.class)</code> æ‰§è¡Œ <code>selectImports</code> è·å–å¯¼å…¥çš„é…ç½®ç±»</li>
<li><code>@Import(XxxImportBeanDefinitionRegistrar.class)</code> æ‰§è¡Œ <code>registerBeanDefinitions</code> æ³¨å†Œ <code>BeanDefinition</code></li>
<li><code>@Import(XxxConfiguration.class)</code> æ™®é€šé…ç½®ç±»ï¼Œç›´æ¥è§£æ</li>
</ul>
<p>å¯¹äº <code>@Import</code> æ³¨è§£ä¸­çš„ä¸åŒç±»å‹å€¼ï¼Œä¼šè¿›è¡Œä¸åŒçš„å¤„ç†é€»è¾‘ï¼Œä½†æœ€ç»ˆéƒ½æ˜¯è§£æé…ç½®ç±»ï¼Œæ— éæ˜¯å¯¼å…¥çš„æ–¹å¼ä¸åŒï¼Œå…·ä½“æˆ‘ä»¬å¯ä»¥çœ‹å¯¹åº”æ¥å£çš„æ–¹æ³•è¯´æ˜ã€‚</p>
<blockquote>
<p>æ³¨æ„å¯¹äº <code>ImportSelector</code> æœ‰ä¸¤ç§å¤„ç†æ–¹å¼ï¼Œå®ƒæœ‰ä¸€ä¸ªå­æ¥å£ <code>DeferredImportSelector</code>ï¼Œå»¶è¿Ÿå¯¼å…¥å™¨ï¼Œå¦‚æœå¯¼å…¥çš„æ˜¯æ­¤ç±»å‹ï¼Œé‚£ä¹ˆä¼šæ‰§è¡Œå…¶å†…éƒ¨ç±» <code>DeferredImportSelector.Group#process</code></p>
</blockquote>
<p>æˆ‘ä»¬æŸ¥çœ‹ <code>AutoConfigurationImportSelector.AutoConfigurationGroup#process()</code> æ–¹æ³•çš„æºç ï¼Œçœ‹å®ƒæ˜¯æ€ä¹ˆè·å–åˆ°è‡ªåŠ¨é…ç½®ç±»çš„</p>
<blockquote>
<p>è¿™é‡Œæœ‰ä¸€ä¸ªç‚¹è¦æ³¨æ„ï¼Œå¯¹äº <code>SpringBoot</code> çš„ <code>AutoConfigurationImportSelector</code> æ˜¯ä¸€ä¸ªå»¶è¿Ÿå¯¼å…¥å™¨ï¼Œè·å–å¯¼å…¥çš„é…ç½®ç±»åˆ—è¡¨ä¸æ˜¯ç›´æ¥è°ƒç”¨ <code>AutoConfigurationImportSelector.selectImports()</code> è€Œæ˜¯è°ƒç”¨å†…éƒ¨ç±» <code>AutoConfigurationGroup.process()</code> å’Œ <code>AutoConfigurationGroup.selectImports()</code></p>
</blockquote>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">protected</span> AutoConfigurationEntry <span class="hljs-title function_">getAutoConfigurationEntry</span><span class="hljs-params">(AnnotationMetadata annotationMetadata)</span> {
    <span class="hljs-keyword">if</span> (!isEnabled(annotationMetadata)) {
       <span class="hljs-keyword">return</span> EMPTY_ENTRY;
    }
    <span class="hljs-type">AnnotationAttributes</span> <span class="hljs-variable">attributes</span> <span class="hljs-operator">=</span> getAttributes(annotationMetadata);
    <span class="hljs-comment">//æ‰«æ imports æ–‡ä»¶è·å–è‡ªåŠ¨é…ç½®ç±»åˆ—è¡¨</span>
    List&lt;String&gt; configurations = getCandidateConfigurations(annotationMetadata, attributes);
    configurations = removeDuplicates(configurations);
    Set&lt;String&gt; exclusions = getExclusions(annotationMetadata, attributes);
    checkExcludedClasses(configurations, exclusions);
    configurations.removeAll(exclusions);
    configurations = getConfigurationClassFilter().filter(configurations);
    fireAutoConfigurationImportEvents(configurations, exclusions);
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">AutoConfigurationEntry</span>(configurations, exclusions);
}
</code></pre>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">protected</span> List&lt;String&gt; <span class="hljs-title function_">getCandidateConfigurations</span><span class="hljs-params">(AnnotationMetadata metadata, AnnotationAttributes attributes)</span> {
    <span class="hljs-type">ImportCandidates</span> <span class="hljs-variable">importCandidates</span> <span class="hljs-operator">=</span> ImportCandidates.load(<span class="hljs-built_in">this</span>.autoConfigurationAnnotation,getBeanClassLoader());
    List&lt;String&gt; configurations = importCandidates.getCandidates();
    <span class="hljs-keyword">return</span> configurations;
}
</code></pre>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> ImportCandidates <span class="hljs-title function_">load</span><span class="hljs-params">(Class&lt;?&gt; annotation, ClassLoader classLoader)</span> {
    Assert.notNull(annotation, <span class="hljs-string">"'annotation' must not be null"</span>);
    <span class="hljs-type">ClassLoader</span> <span class="hljs-variable">classLoaderToUse</span> <span class="hljs-operator">=</span> decideClassloader(classLoader);
    <span class="hljs-type">String</span> <span class="hljs-variable">location</span> <span class="hljs-operator">=</span> String.format(LOCATION, annotation.getName());
    Enumeration&lt;URL&gt; urls = findUrlsInClasspath(classLoaderToUse, location);
    List&lt;String&gt; importCandidates = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();
    <span class="hljs-keyword">while</span> (urls.hasMoreElements()) {
       <span class="hljs-type">URL</span> <span class="hljs-variable">url</span> <span class="hljs-operator">=</span> urls.nextElement();
       importCandidates.addAll(readCandidateConfigurations(url));
    }
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ImportCandidates</span>(importCandidates);
}
</code></pre>
<p>å¥½äº†ï¼Œè¿™é‡Œæœ‰ä¸€ä¸ª <code>LOCATION</code> å¸¸é‡ï¼Œæˆ‘ä»¬çœ‹ä»–çš„å€¼æ˜¯å†™æ­»çš„</p>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-keyword">private</span> <span class="hljs-type">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> LOCATION = <span class="hljs-string">"META-INF/spring/%s.imports"</span>;
</code></pre>
<p>è¿™é‡Œä¼ å…¥çš„æ³¨è§£å°±æ˜¯ <code>@AutoConfiguration</code> çš„å…¨ç±»åï¼Œ<code>org.springframework.boot.autoconfigure.AutoConfiguration</code></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-title function_">AutoConfigurationImportSelector</span><span class="hljs-params">()</span> {
    <span class="hljs-built_in">this</span>(<span class="hljs-literal">null</span>);
}

AutoConfigurationImportSelector(Class&lt;?&gt; autoConfigurationAnnotation) {
    <span class="hljs-built_in">this</span>.autoConfigurationAnnotation = (autoConfigurationAnnotation != <span class="hljs-literal">null</span>) ? autoConfigurationAnnotation : AutoConfiguration.class;
}
</code></pre>
<p>æ›¿æ¢æ‰ <code>LOCATION</code> çš„å ä½ç¬¦ä¹‹åï¼Œæˆ‘ä»¬å¾—åˆ°å®Œæ•´çš„è·¯å¾„åœ°å€</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">LOCATION</span> = META-INF/spring/org.springframework.boot.autoconfigure.AutoConfiguration.imports
</code></pre>
<p>ç„¶åæˆ‘ä»¬å†å»çœ‹ <code>MyBatisPlusã€Redisã€RabbitMQ</code> çš„ <code>starter</code>ï¼Œæˆ‘ä»¬éƒ½ä¼šçœ‹åˆ°è¿™ä¸ªè·¯å¾„ä¸‹æœ‰è¿™æ ·çš„æ–‡ä»¶</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/743446472e194f77a2b07685fdd92278~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pqu6Imy5aaW5aiG5Li2:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771136492&amp;x-signature=i%2FFo8ac4Z2jWPqbxtx6n97AHm0k%3D" alt="ä¼ä¸šå¾®ä¿¡æˆªå›¾_f001c7fb-e86a-46f5-8db5-500d33a15b4d.png" loading="lazy"/></p>
<p>è¿™ä¸‹æç„¶å¤§æ‚Ÿäº†å§ï¼Œé‚£ç°åœ¨è®©ä½ è‡ªå·±å®šä¹‰ä¸€ä¸ª <code>springboot-starter</code>ï¼Œè¿˜è§‰å¾—å›°éš¾å—ï¼Ÿ</p>
<blockquote>
<p>æ³¨æ„ SpringBoot 3.0 ä»¥å‰è¯»å–çš„æ˜¯ <code>spring.factories</code> ï¼Œä¹‹åæ”¹æˆäº† <code>imports</code> æ–‡ä»¶</p>
</blockquote>
<h3 data-id="heading-13">é…ç½®ç±»åŠ è½½è¿‡ç¨‹æµç¨‹å›¾</h3>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/af334198f2224545bbb4bd88a440f229~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pqu6Imy5aaW5aiG5Li2:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771136492&amp;x-signature=hAKvfLugez6cJuIsQkPgh7s9spw%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-14">é…ç½®ç±»é€’å½’è§£ææµç¨‹å›¾</h3>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/dcb0df7b91fd43148db39daca9f50afa~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pqu6Imy5aaW5aiG5Li2:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771136492&amp;x-signature=tsaF%2Bl2%2FufFSkkmXY8fqX4lVprE%3D" alt="ä¼ä¸šå¾®ä¿¡æˆªå›¾_41c7f5f9-d4c4-4bc1-83c1-76eaac5eb168.png" loading="lazy"/></p>
<p>ä¸‹é¢çš„æ ‘å½¢ç»“æ„å¯èƒ½æœ‰åŠ©äºè¿›ä¸€æ­¥ç†è§£è¿™ä¸ªæµç¨‹</p>
<pre><code class="hljs language-ruby" lang="ruby">/**
 * <span class="hljs-title class_">Spring</span> é…ç½®ç±»æ‰«æè§£æçš„é€’å½’æµç¨‹
 * 
 * ç¤ºä¾‹é…ç½®ç»“æ„ï¼š
 * â””â”€â”€ <span class="hljs-title class_">SpringBootApplication</span> (<span class="hljs-variable">@Configuration</span>)  [<span class="hljs-title class_">Level</span> <span class="hljs-number">0</span>]
  *    â”œâ”€â”€ <span class="hljs-variable">@ComponentScan</span>(<span class="hljs-string">"com.example"</span>)  [<span class="hljs-title class_">Level</span> <span class="hljs-number">1</span>]
 *     â”‚   â””â”€â”€ com.example.<span class="hljs-title class_">UserController</span> (<span class="hljs-variable">@Controller</span>)  [<span class="hljs-title class_">Level</span> <span class="hljs-number">2</span>]
 *     â”‚       â””â”€â”€ <span class="hljs-variable">@Configuration</span> [<span class="hljs-title class_">Level</span> <span class="hljs-number">3</span>]
 *     â””â”€â”€ <span class="hljs-variable">@Bean</span>(appBean)  [<span class="hljs-title class_">Level</span> <span class="hljs-number">1</span>]
 *     â”œâ”€â”€ <span class="hljs-variable">@Import</span>(<span class="hljs-title class_">AutoConfigurationImportSelector</span>.<span class="hljs-keyword">class</span>)  [<span class="hljs-title class_">Level</span> <span class="hljs-number">1</span>]
 *     â”‚   â”œâ”€â”€ <span class="hljs-variable">@Configuration</span>
 *     â”‚   â”œâ”€â”€ <span class="hljs-variable">@Import</span>(<span class="hljs-title class_">DataSourceConfig</span>.<span class="hljs-keyword">class</span>)  [<span class="hljs-title class_">Level</span> <span class="hljs-number">2</span>]
 *     â”‚   â”‚   â”œâ”€â”€ <span class="hljs-variable">@Configuration</span>
 *     â”‚   â”‚   â”œâ”€â”€ <span class="hljs-variable">@Import</span>(<span class="hljs-title class_">RedisConfig</span>.<span class="hljs-keyword">class</span>)  [<span class="hljs-title class_">Level</span> <span class="hljs-number">3</span>]
 *     â”‚   â”‚   â”‚   â”œâ”€â”€ <span class="hljs-variable">@Configuration</span>
 *     â”‚   â”‚   â”‚   â””â”€â”€ <span class="hljs-variable">@Import</span>(<span class="hljs-title class_">CacheConfig</span>.<span class="hljs-keyword">class</span>)  [<span class="hljs-title class_">Level</span> <span class="hljs-number">4</span>]
 *     â”‚   â”‚   â”‚       â”œâ”€â”€ <span class="hljs-variable">@Configuration</span>
 *     â”‚   â”‚   â”‚       â””â”€â”€ <span class="hljs-variable">@ComponentScan</span>(<span class="hljs-string">"com.cache"</span>)
 *     â”‚   â”‚   â””â”€â”€ <span class="hljs-variable">@Bean</span>(dataSource)
 *     â”‚   â””â”€â”€ <span class="hljs-variable">@Bean</span>(service)
 *<span class="hljs-regexp">/
</span></code></pre>
<p>åªè¦å½“å‰æ­£åœ¨æ‰«æå¤„ç†çš„é…ç½®ç±»é‡Œé¢è¿˜æœ‰å…¶ä»–é…ç½®æ³¨è§£ï¼Œå°±ä¸€ç›´é€’å½’æ‰«æè§£æï¼Œç›´åˆ°è§£æå®Œæ¯•ä¸ºæ­¢ã€‚</p>
<h3 data-id="heading-15">ç‰¹æ®Šçš„ @ComponentScan</h3>
<p>ä»”ç»†è§‚å¯Ÿæºç ä¼šå‘ç° <code>@ComponentScan</code> æ³¨è§£çš„æ‰«æè¿‡ç¨‹ä¸­ï¼Œä½¿ç”¨ <code>ComponentScanAnnotationParser</code> è§£æä¹‹åç›´æ¥å‘ <code>Spring</code> å®¹å™¨æ³¨å†Œäº† <code>BeanDefinition</code> ã€‚è€Œå…¶ä»–æ³¨è§£çš„æ‰«æï¼Œä¾‹å¦‚ <code>@Configurationã€@Beanã€@Import</code> éƒ½æ˜¯å°†éœ€è¦å¤„ç†çš„é…ç½®ç±»ä¿¡æ¯å­˜å‚¨åˆ° <code>ConfigurationClassParser</code> çš„æˆå‘˜å˜é‡ä¸­ã€‚</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">//@ComponentScan è§£æå™¨</span>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> ComponentScanAnnotationParser componentScanParser;
<span class="hljs-comment">//é…ç½®ç±»é›†åˆ</span>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Map&lt;ConfigurationClass, ConfigurationClass&gt; configurationClasses = <span class="hljs-keyword">new</span> <span class="hljs-title class_">LinkedHashMap</span>&lt;&gt;();

<span class="hljs-comment">//å»¶è¿Ÿå¯¼å…¥å™¨å¤„ç†å™¨</span>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">DeferredImportSelectorHandler</span> <span class="hljs-variable">deferredImportSelectorHandler</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">DeferredImportSelectorHandler</span>();
</code></pre>
<p>æ­¤æ—¶è¿˜æ²¡æœ‰æ³¨å†Œå®ƒä»¬çš„ <code>BeanDefinition</code></p>
<h3 data-id="heading-16">åˆ†ç±»æ„å»º BeanDefinition</h3>
<p>ä¸Šä¸€æ®µæˆ‘ä»¬è¯´äº†ï¼Œå‰é¢çš„æ­¥éª¤è§£æå®Œä¹‹åï¼Œåªæ˜¯æŠŠæ¯ä¸€ä¸ªé…ç½®ç±»ä¿¡æ¯å­˜å‚¨èµ·æ¥ï¼ŒæŠ½è±¡æˆä¸€ä¸ª <code>Map&lt;ConfigurationClass, ConfigurationClass&gt; configurationClasses</code>ï¼Œæ­¤æ—¶è¿˜æ²¡æœ‰å‘ <code>Spring</code> å®¹å™¨ä¸­æ³¨å†Œæˆ <code>BeanDefiniton</code>ã€‚æˆ‘ä»¬å¯ä»¥æŸ¥çœ‹æºç ï¼Œè¿™ä¸ªç±»é‡Œé¢æœ‰ä¸€äº›æˆå‘˜å˜é‡</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">final</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ConfigurationClass</span> {
    <span class="hljs-comment">//bean åç§°</span>
    <span class="hljs-keyword">private</span> String beanName;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Set&lt;ConfigurationClass&gt; importedBy = <span class="hljs-keyword">new</span> <span class="hljs-title class_">LinkedHashSet</span>&lt;&gt;(<span class="hljs-number">1</span>);

    <span class="hljs-comment">//@Bean æ–¹æ³•é›†åˆ</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Set&lt;BeanMethod&gt; beanMethods = <span class="hljs-keyword">new</span> <span class="hljs-title class_">LinkedHashSet</span>&lt;&gt;();
    <span class="hljs-comment">//@ImportResource é›†åˆ</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Map&lt;String, Class&lt;? <span class="hljs-keyword">extends</span> <span class="hljs-title class_">BeanDefinitionReader</span>&gt;&gt; importedResources = <span class="hljs-keyword">new</span> <span class="hljs-title class_">LinkedHashMap</span>&lt;&gt;();
    <span class="hljs-comment">//ImportBeanDefinitionRegistrar é›†åˆ</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Map&lt;ImportBeanDefinitionRegistrar, AnnotationMetadata&gt; importBeanDefinitionRegistrars =  <span class="hljs-keyword">new</span> <span class="hljs-title class_">LinkedHashMap</span>&lt;&gt;();
}
</code></pre>
<p>å½“æ‰€æœ‰é…ç½®ç±»è§£æå®Œæˆä¹‹åï¼Œå¾—åˆ°ä¸€ä¸ªå…¨é‡é›†åˆ <code>Map&lt;ConfigurationClass, ConfigurationClass&gt;</code> ï¼Œç„¶ååœ¨
<code>ConfigurationClassPostProcessor#processConfigBeanDefinitions()</code> ä¸­è°ƒç”¨ <code>ConfigurationClassBeanDefinitionReader.loadBeanDefinitions()</code> è¿™ä¸€æ­¥æ‰§è¡Œå®Œæ¯•åï¼Œæ•´ä¸ªåº”ç”¨æ‰€æœ‰çš„é…ç½®éƒ½æ„å»º <code>BeanDefinition</code> åŠ è½½å®Œæ¯•</p>
<h2 data-id="heading-17">EventListenerMethodProcessor</h2>
<p>å®ƒæ˜¯ä¸€ä¸ªè§£æäº‹ä»¶ç›‘å¬çš„åç½®å¤„ç†å™¨</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Override</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">postProcessBeanFactory</span><span class="hljs-params">(ConfigurableListableBeanFactory beanFactory)</span> {
    <span class="hljs-built_in">this</span>.beanFactory = beanFactory;
    <span class="hljs-built_in">this</span>.originalEvaluationContext.setBeanResolver(<span class="hljs-keyword">new</span> <span class="hljs-title class_">BeanFactoryResolver</span>(<span class="hljs-built_in">this</span>.beanFactory));

    Map&lt;String, EventListenerFactory&gt; beans = beanFactory.getBeansOfType(EventListenerFactory.class, <span class="hljs-literal">false</span>, <span class="hljs-literal">false</span>);
    List&lt;EventListenerFactory&gt; factories = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;(beans.values());
    AnnotationAwareOrderComparator.sort(factories);
    <span class="hljs-built_in">this</span>.eventListenerFactories = factories;
}
</code></pre>
<p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°è¿™ä¸ªåç½®å¤„ç†æ–¹æ³•ä¸­ï¼Œä¸»è¦æ˜¯å¯¹ <code>eventListenerFactories</code> èµ‹å€¼ï¼Œç„¶ååç»­ç­‰æ‰€æœ‰å•ä¾‹ <code>Bean</code> å®ä¾‹åŒ–å®Œæˆåï¼Œä¼šè°ƒç”¨å®ƒçš„ç”Ÿå‘½å‘¨æœŸæ–¹æ³• <code>EventListenerMethodProcessor#afterSingletonsInstantiated()</code>ï¼Œä¼šç”¨è¿™ä¸ªå·¥å‚åˆ›å»ºäº‹ä»¶ç›‘å¬å™¨ï¼Œæ·»åŠ åˆ° <code>ApplicationContext</code> ä¸­ï¼Œ<code>Spring äº‹ä»¶æœºåˆ¶</code> å°±æ˜¯æŠŠæ‰€æœ‰äº‹ä»¶ç›‘å¬å™¨æ·»åŠ åˆ° <code>ApplicationContext</code> çš„ <code>applicationListeners</code> å­—æ®µä¸­ï¼Œè°ƒç”¨ <code>ApplicationEventPublisher#publishEvent(ApplicationEvent)</code> çš„æ—¶å€™ä»è¿™é‡Œæ‰¾åˆ°ç¬¦åˆçš„ç›‘å¬å™¨æ‰¹é‡æ‰§è¡Œï¼Œç›¸å½“äºå¹¿æ’­ä¸€ä¸ªæ¶ˆæ¯ã€‚</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">//org.springframework.context.event.SimpleApplicationEventMulticaster#multicastEvent(org.springframework.context.ApplicationEvent, org.springframework.core.ResolvableType)</span>
<span class="hljs-meta">@Override</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">multicastEvent</span><span class="hljs-params">(ApplicationEvent event, <span class="hljs-meta">@Nullable</span> ResolvableType eventType)</span> {
    <span class="hljs-type">ResolvableType</span> <span class="hljs-variable">type</span> <span class="hljs-operator">=</span> (eventType != <span class="hljs-literal">null</span> ? eventType : ResolvableType.forInstance(event));
    <span class="hljs-type">Executor</span> <span class="hljs-variable">executor</span> <span class="hljs-operator">=</span> getTaskExecutor();
    <span class="hljs-keyword">for</span> (ApplicationListener&lt;?&gt; listener : getApplicationListeners(event, type)) {
       <span class="hljs-keyword">if</span> (executor != <span class="hljs-literal">null</span> &amp;&amp; listener.supportsAsyncExecution()) {
          <span class="hljs-keyword">try</span> {
          <span class="hljs-comment">//å¼‚æ­¥äº‹ä»¶</span>
             executor.execute(() -&gt; invokeListener(listener, event));
          }
          <span class="hljs-keyword">catch</span> (RejectedExecutionException ex) {
             <span class="hljs-comment">// Probably on shutdown -&gt; invoke listener locally instead</span>
             invokeListener(listener, event);
          }
       }
       <span class="hljs-keyword">else</span> {
          invokeListener(listener, event);
       }
    }
}
</code></pre>
<h2 data-id="heading-18">MapperScannerConfigurer</h2>
<p>å¦‚æœæˆ‘ä»¬ä½¿ç”¨ <code>Mybatis</code> æ¡†æ¶çš„è¯ï¼Œå°±ä¼šæœ‰è¿™ä¸ªå·¥å‚åç½®å¤„ç†å™¨</p>
<h3 data-id="heading-19">æ³¨å†Œæ¥æº</h3>
<p>ä¸Šé¢æˆ‘ä»¬çŸ¥é“ <code>SpringBoot</code> å¯åŠ¨åä¼šå…ˆæ‰§è¡Œ <code>ConfigurationClassPostProcessor</code> åŠ è½½è‡ªåŠ¨é…ç½®ç±»ï¼Œäºæ˜¯åŠ è½½åˆ°äº† <code>MybatisPlusAutoConfiguration</code>ï¼Œå®ƒæœ‰ä¸€ä¸ªé™æ€å†…éƒ¨ç±»</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@org</span>.springframework.context.annotation.Configuration(proxyBeanMethods = <span class="hljs-literal">false</span>)
<span class="hljs-meta">@Import(AutoConfiguredMapperScannerRegistrar.class)</span>
<span class="hljs-meta">@ConditionalOnMissingBean({MapperFactoryBean.class, MapperScannerConfigurer.class})</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MapperScannerRegistrarNotFoundConfiguration</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">InitializingBean</span> {

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">afterPropertiesSet</span><span class="hljs-params">()</span> {
        logger.debug(<span class="hljs-string">"Not found configuration for registering mapper bean using @MapperScan, MapperFactoryBean and MapperScannerConfigurer."</span>);
    }
}
</code></pre>
<p>è¿™é‡Œ <code>@Import</code> å¯¼å…¥äº† <code>AutoConfiguredMapperScannerRegistrar</code> ç±»ï¼Œå†æŸ¥çœ‹<code>AutoConfiguredMapperScannerRegistrar#registerBeanDefinitions</code> æ³¨å†Œæ–¹æ³•ä¸­æ³¨å†Œäº† <code>MapperScannerConfigurer</code> çš„ <code>BeanDefiniton</code> ã€‚</p>
<h3 data-id="heading-20">ä½œç”¨</h3>
<p>æˆ‘ä»¬æŸ¥çœ‹ <code>MapperScannerConfigurer#postProcessBeanDefinitionRegistry</code>ï¼Œæºç å¾ˆç®€å•</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Override</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">postProcessBeanDefinitionRegistry</span><span class="hljs-params">(BeanDefinitionRegistry registry)</span> {
  <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.processPropertyPlaceHolders) {
   <span class="hljs-comment">//è§£æå±æ€§å€¼ä¸­çš„å ä½ç¬¦</span>
    processPropertyPlaceHolders();
  }
  
  <span class="hljs-comment">//å®ä¾‹åŒ– `ClassPathBeanDefinitionScanner` çš„å®ç°ç±»æ‰«æç±»è·¯å¾„ä¸‹çš„ @Mapper æ³¨è§£</span>
  <span class="hljs-type">ClassPathMapperScanner</span> <span class="hljs-variable">scanner</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ClassPathMapperScanner</span>(registry);
  scanner.setAddToConfig(<span class="hljs-built_in">this</span>.addToConfig);
  scanner.setAnnotationClass(<span class="hljs-built_in">this</span>.annotationClass);
  scanner.setMarkerInterface(<span class="hljs-built_in">this</span>.markerInterface);
  scanner.setSqlSessionFactory(<span class="hljs-built_in">this</span>.sqlSessionFactory);
  scanner.setSqlSessionTemplate(<span class="hljs-built_in">this</span>.sqlSessionTemplate);
  scanner.setSqlSessionFactoryBeanName(<span class="hljs-built_in">this</span>.sqlSessionFactoryBeanName);
  scanner.setSqlSessionTemplateBeanName(<span class="hljs-built_in">this</span>.sqlSessionTemplateBeanName);
  scanner.setResourceLoader(<span class="hljs-built_in">this</span>.applicationContext);
  scanner.setBeanNameGenerator(<span class="hljs-built_in">this</span>.nameGenerator);
  scanner.setMapperFactoryBeanClass(<span class="hljs-built_in">this</span>.mapperFactoryBeanClass);
  <span class="hljs-keyword">if</span> (StringUtils.hasText(lazyInitialization)) {
    scanner.setLazyInitialization(Boolean.valueOf(lazyInitialization));
  }
  <span class="hljs-keyword">if</span> (StringUtils.hasText(defaultScope)) {
    scanner.setDefaultScope(defaultScope);
  }
  scanner.registerFilters();
  scanner.scan(
      StringUtils.tokenizeToStringArray(<span class="hljs-built_in">this</span>.basePackage, ConfigurableApplicationContext.CONFIG_LOCATION_DELIMITERS));
}
</code></pre>
<p>å°±æ˜¯æŠŠç±»è·¯å¾„ä¸‹çš„ <code>@Mapper</code> æ³¨è§£çš„ç±»æ‰«æå‡ºæ¥æ³¨å†Œä¸º <code>BeanDefiniton</code> ã€‚</p>
<h3 data-id="heading-21">è‡ªæˆ‘æ‰©å±•</h3>
<p>å‚è€ƒ <code>MapperScannerConfigurer</code> å‡è®¾æˆ‘ä»¬åç»­éœ€è¦è‡ªå·±åˆ¶ä½œä¸€ä¸ªç»„ä»¶ï¼Œè¯»å– <code>@Xxx</code> æ ‡æ³¨çš„ç±»æ³¨å†Œä¸º <code>BeanDefiniton</code> äº¤ç»™ <code>Spring</code> ï¼Œæ˜¯ä¸æ˜¯å°±å¾ˆç®€å•äº†~</p>
<h2 data-id="heading-22">CachingMetadataReaderFactoryPostProcessor</h2>
<p>è¿™ä¸ªç±»æ˜¯ <code>SpringBoot</code> æä¾›çš„ä¸€ä¸ªé‡è¦çš„ç¼“å­˜å…ƒä¿¡æ¯çš„å·¥å‚åç½®å¤„ç†å™¨ï¼Œå®ƒæ˜¯é€šè¿‡ <code>ApplicationContextInitializer</code> æ·»åŠ åˆ° <code>ApplicationContext</code> ä¸­çš„</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">class</span> <span class="hljs-title class_">SharedMetadataReaderFactoryContextInitializer</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">ApplicationContextInitializer</span>&lt;ConfigurableApplicationContext&gt;, Ordered, BeanRegistrationExcludeFilter {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">BEAN_NAME</span> <span class="hljs-operator">=</span> <span class="hljs-string">"org.springframework.boot.autoconfigure.internalCachingMetadataReaderFactory"</span>;
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">initialize</span><span class="hljs-params">(ConfigurableApplicationContext applicationContext)</span> {
       <span class="hljs-keyword">if</span> (AotDetector.useGeneratedArtifacts()) {
          <span class="hljs-keyword">return</span>;
       }
       <span class="hljs-type">BeanFactoryPostProcessor</span> <span class="hljs-variable">postProcessor</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">CachingMetadataReaderFactoryPostProcessor</span>(applicationContext);
       applicationContext.addBeanFactoryPostProcessor(postProcessor);
    }
}
</code></pre>
<p>æˆ‘ä»¬å¯ä»¥æŸ¥çœ‹ <code>CachingMetadataReaderFactoryPostProcessor#postProcessBeanDefinitionRegistry</code> åç½®å¤„ç†æ–¹æ³•æºç ï¼Œ</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Override</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">postProcessBeanDefinitionRegistry</span><span class="hljs-params">(BeanDefinitionRegistry registry)</span> <span class="hljs-keyword">throws</span> BeansException {
    register(registry);
    configureConfigurationClassPostProcessor(registry);
}
</code></pre>
<p>å…ˆæ³¨å†Œäº†ä¸€ä¸ª <code>SharedMetadataReaderFactoryBean</code> çš„ <code>BeanDefiniton</code> ï¼Œå®é™…ä¸Šæœ€åå°±æ˜¯å‘å®¹å™¨ä¸­æ³¨å…¥ <code>ConcurrentReferenceCachingMetadataReaderFactory</code>ï¼Œç„¶åç¬¬äºŒè¡Œä»£ç å¾ˆå…³é”®ï¼Œç»™ <code>ConfigurationClassPostProcessor</code> è¿™ä¸ªå·¥å‚åç½®å¤„ç†å™¨çš„å±æ€§ <code>metadataReaderFactory</code> èµ‹å€¼ä¸ºåˆšåˆšåˆ›å»ºçš„ <code>ConcurrentReferenceCachingMetadataReaderFactory</code></p>
<p>æˆ‘ä»¬å†å»çœ‹åŸç”Ÿçš„ <code>ConfigurationClassPostProcessor.metadataReaderFactory</code> é»˜è®¤å€¼</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">private</span> <span class="hljs-type">MetadataReaderFactory</span> <span class="hljs-variable">metadataReaderFactory</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">CachingMetadataReaderFactory</span>();
</code></pre>
<p>åœ¨åˆ¤æ–­ä¸€ä¸ªç±»æ˜¯ä¸æ˜¯é…ç½®ç±»çš„æ—¶å€™ä¼šç”¨åˆ°å®ƒï¼Œé»˜è®¤çš„å®ç°æ˜¯æ¯æ¬¡éƒ½ä¼šç”¨èµ„æºåŠ è½½å™¨è¯»å–ä¸€éè¿™ä¸ªç±»ï¼Œ</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Override</span>
<span class="hljs-keyword">public</span> MetadataReader <span class="hljs-title function_">getMetadataReader</span><span class="hljs-params">(String className)</span> <span class="hljs-keyword">throws</span> IOException {
    <span class="hljs-keyword">try</span> {
       <span class="hljs-type">String</span> <span class="hljs-variable">resourcePath</span> <span class="hljs-operator">=</span> ResourceLoader.CLASSPATH_URL_PREFIX + ClassUtils.convertClassNameToResourcePath(className) + ClassUtils.CLASS_FILE_SUFFIX;
       <span class="hljs-comment">//é‡æ–°è¯»å–æ–‡ä»¶</span>
       <span class="hljs-type">Resource</span> <span class="hljs-variable">resource</span> <span class="hljs-operator">=</span> <span class="hljs-built_in">this</span>.resourceLoader.getResource(resourcePath);
       <span class="hljs-keyword">return</span> getMetadataReader(resource);
    }
}
</code></pre>
<p>è€Œ <code>ConcurrentReferenceCachingMetadataReaderFactory</code> çš„å®ç°æ˜¯ï¼Œç¬¬ä¸€æ¬¡è¯»å–ä¹‹åæ”¾å…¥ç¼“å­˜ï¼Œåç»­æ¯æ¬¡è·å–ä¼šå…ˆä»ç¼“å­˜ä¸­æŸ¥è¯¢</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Override</span>
<span class="hljs-keyword">public</span> MetadataReader <span class="hljs-title function_">getMetadataReader</span><span class="hljs-params">(String className)</span> <span class="hljs-keyword">throws</span> IOException {
    <span class="hljs-comment">//è¯»å–ç¼“å­˜</span>
    <span class="hljs-type">MetadataReader</span> <span class="hljs-variable">metadataReader</span> <span class="hljs-operator">=</span> <span class="hljs-built_in">this</span>.classNameCache.get(className);
    <span class="hljs-keyword">if</span> (metadataReader == <span class="hljs-literal">null</span>) {
       metadataReader = <span class="hljs-built_in">super</span>.getMetadataReader(className);
       <span class="hljs-built_in">this</span>.classNameCache.put(className, metadataReader);
    }
    <span class="hljs-keyword">return</span> metadataReader;
}
</code></pre>
<p>å®ƒçš„ä½œç”¨å°±æ˜¯æé«˜ç¨‹åºæ€§èƒ½ï¼Œé¿å…é‡å¤è¯»å–ç±»çš„å…ƒæ•°æ®ä¿¡æ¯</p>
<h2 data-id="heading-23">BeanFactoryPostProcessor ä¸ BeanPostProcessor å¯¹æ¯”</h2>
<p>è¿™ä¸¤ä¸ªåå­—å¾ˆåƒï¼Œè¿™é‡Œåˆ—å‡ºå®ƒä»¬çš„åŒºåˆ«ï¼Œä¸‹ä¸€ç¯‡æ–‡ç« ä¼šè¯¦ç»†ä»‹ç» <code>BeanPostProcessor</code></p>


















































<table><thead><tr><th align="left">å¯¹æ¯”ç»´åº¦</th><th align="left">BeanFactoryPostProcessor</th><th align="left">BeanPostProcessor</th></tr></thead><tbody><tr><td align="left"><strong>å¤„ç†æ—¶æœº</strong></td><td align="left">Bean å®šä¹‰åŠ è½½ä¹‹åï¼ŒBean å®ä¾‹åŒ–ä¹‹å‰</td><td align="left">Bean å®ä¾‹åŒ–ä¹‹åï¼Œåˆå§‹åŒ–å›è°ƒå‰å</td></tr><tr><td align="left"><strong>ä½œç”¨å¯¹è±¡</strong></td><td align="left">Bean çš„å®šä¹‰å…ƒæ•°æ®ï¼ˆBeanDefinitionï¼‰</td><td align="left">Bean å®ä¾‹å¯¹è±¡</td></tr><tr><td align="left"><strong>ä¸»è¦åŠŸèƒ½</strong></td><td align="left">ä¿®æ”¹ã€æ³¨å†Œæˆ–ç§»é™¤ BeanDefinition</td><td align="left">ä¿®æ”¹æˆ–åŒ…è£… Bean å®ä¾‹</td></tr><tr><td align="left"><strong>æ‰§è¡Œé˜¶æ®µ</strong></td><td align="left"><code>postProcessBeanFactory()</code></td><td align="left"><code>postProcessBeforeInitialization()</code><br/><code>postProcessAfterInitialization()</code></td></tr><tr><td align="left"><strong>è§¦å‘æ¬¡æ•°</strong></td><td align="left">æ¯ä¸ªå®¹å™¨<strong>ä»…æ‰§è¡Œä¸€æ¬¡</strong></td><td align="left">å¯¹<strong>æ¯ä¸ª Bean å®ä¾‹</strong>éƒ½ä¼šæ‰§è¡Œ</td></tr><tr><td align="left"><strong>Spring æ ¸å¿ƒé˜¶æ®µ</strong></td><td align="left">BeanFactory å‡†å¤‡é˜¶æ®µ</td><td align="left">Bean ç”Ÿå‘½å‘¨æœŸé˜¶æ®µ</td></tr><tr><td align="left"><strong>å…¸å‹åº”ç”¨åœºæ™¯</strong></td><td align="left">1. ä¿®æ”¹ Bean çš„å±æ€§å€¼ï¼ˆå ä½ç¬¦è§£æï¼‰<br/>2. åŠ¨æ€æ³¨å†Œ BeanDefinition<br/>3. æ ¹æ®æ¡ä»¶ç§»é™¤ Bean</td><td align="left">1. ä»£ç†å¢å¼ºï¼ˆAOPï¼‰<br/>2. å±æ€§æ³¨å…¥åçš„å¤„ç†<br/>3. è‡ªå®šä¹‰åˆå§‹åŒ–é€»è¾‘</td></tr><tr><td align="left"><strong>å®ç°ç¤ºä¾‹</strong></td><td align="left"><code>PropertySourcesPlaceholderConfigurer</code><br/><code>ConfigurationClassPostProcessor</code></td><td align="left"><code>AutowiredAnnotationBeanPostProcessor</code><br/><code>CommonAnnotationBeanPostProcessor</code></td></tr></tbody></table>
<h2 data-id="heading-24">ç»“è¯­</h2>
<p>ç¯‡å¹…åŸå› ï¼Œè¿™é‡Œæ— æ³•åˆ—å‡ºæ‰€æœ‰çš„å·¥å‚åç½®å¤„ç†å™¨çš„å…·ä½“ä½œç”¨å’Œå®ç°ï¼Œä¸è¿‡ <code>SpringBoot</code> å¯åŠ¨è¿‡ç¨‹ä¸­ï¼Œ<code>Spring</code> å®¹å™¨åˆ·æ–°è¿‡ç¨‹ä¸­è°ƒç”¨çš„ <code>BeanFactoryPostProcessor</code> ç›¸å¯¹äº <code>BeanPostProcessor</code> è¦å°‘çš„å¤šï¼Œä½†æ˜¯ä¸¤è€…éƒ½å¾ˆé‡è¦ï¼Œæœ‰å…´è¶£å¯ä»¥é€ä¸€æŸ¥çœ‹æºç ã€‚</p>
<h3 data-id="heading-25">å¦‚æœè¿™ç¯‡æ–‡ç« å¯¹ä½ æœ‰å¸®åŠ©ï¼Œè®°å¾—ç‚¹èµåŠ å…³æ³¨ï¼ä½ çš„æ”¯æŒå°±æ˜¯æˆ‘ç»§ç»­åˆ›ä½œçš„åŠ¨åŠ›ï¼</h3></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Web å®‰å…¨ä¸åç¼–è¯‘æºç ä¸‹çš„æƒé™è®¾è®¡ï¼šæ„ç­‘å‰åç«¯ä¸€è‡´çš„é˜²æŠ¤ä½“ç³»]]></title>    <link>https://juejin.cn/post/7603651855236857865</link>    <guid>https://juejin.cn/post/7603651855236857865</guid>    <pubDate>2026-02-08T06:32:33.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7603651855236857865" data-draft-id="7603674653153771529" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Web å®‰å…¨ä¸åç¼–è¯‘æºç ä¸‹çš„æƒé™è®¾è®¡ï¼šæ„ç­‘å‰åç«¯ä¸€è‡´çš„é˜²æŠ¤ä½“ç³»"/> <meta itemprop="keywords" content="å‰ç«¯,å®‰å…¨"/> <meta itemprop="datePublished" content="2026-02-08T06:32:33.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="LeonGao"/> <meta itemprop="url" content="https://juejin.cn/user/3976252950591149"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Web å®‰å…¨ä¸åç¼–è¯‘æºç ä¸‹çš„æƒé™è®¾è®¡ï¼šæ„ç­‘å‰åç«¯ä¸€è‡´çš„é˜²æŠ¤ä½“ç³»
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3976252950591149/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    LeonGao
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-08T06:32:33.000Z" title="Sun Feb 08 2026 06:32:33 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»5åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{position:relative;word-break:break-word;line-height:1.75;font-weight:400;font-size:15px;overflow-x:hidden;color:#333}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:30px;margin-bottom:5px}.markdown-body h2{font-size:24px;display:inline-block;font-weight:700;background:#ef7060;color:#fff;padding:6px 8px 0 0;border-top-right-radius:6px;margin-right:2px;box-shadow:6px 3px 0 0 rgba(239,112,96,.2)}.markdown-body h2:before{content:" ";display:inline-block;width:8px}.markdown-body h2:after{content:" ";position:absolute;display:block;width:calc(100% - 50px);border-bottom:3px solid #ef7060}.markdown-body h3{font-size:18px;padding-bottom:0}.markdown-body h4{font-size:16px}.markdown-body h5{font-size:15px}.markdown-body h6{margin-top:5px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #3e3e3e;margin-top:32px;margin-bottom:32px;height:1px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgba(27,31,35,.05);color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:JetBranins Mono,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75;box-shadow:0 0 8px hsla(0,0%,43.1%,.45);border-radius:4px;margin:16px}.markdown-body pre:before{content:"";display:block;height:30px;width:100%;margin-bottom:-7px;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAAAdCAYAAABcz8ldAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAhgSURBVGhD7Zp7bBTHHcdn33t7vvOdzy+ITVKDU0xIKG2ABCPTRCCaUiEVKWoqRJuASAhCitRCVKSoalFUKZBiSmmFRRJKRUnUtIpo+aNqGgwoOCmuFUIRzxjwE4zte+97drYzztji8HPvtkit/PnH+n1397Tz+83vN/PbMZhmmmmm+d+BoX8n5diihcGqgFQf5vk6BMAskWUlw3GyFnIvtqWSf91w7mKC3npfOLX7wYeiIa6BBWCOLLFRF2NB0JvIOP/80YG+k2ev6S699b/OzOfKBW5l5KsgyC4DCFQDnpEAdE1goc/dlNPc/Up7P711UiYNSMuyxeUzZPnHgGHWh5XADEkSAcdiN+AnEXIBhBComgFU0/xQR+jnj51sOUMf9Z0NKyL8S9+JPBEN8zuCMrsqGOA5QWAAyzLAxe53HBeYFgJp1c5Cx33nyIfpV3e+22/Sx32nev/sMCgVnmM4bjOniAtZWQAsz315EfsGQQc4hgWcjHkCmOj1rheuNn95cXwmDMiVp5etC/D8m5FwUWVQUYYGPh6mZYFUOgsGVa1pXvOZzVT2jRuH54RM230jEuI3RcIiL4l4UkxAJmuD/riVsqD7ct2m9nep7BtVTbVfZ0uE/UIk+CQflAHDjf8+Lg6MldYATGpH3c/Ul7p3dWXppVGM6eElJSHmnQWPbSlRlN1lJcUBjqNRnwJZVQO3B5P/uq5rK1d90pakckFcaKp5UJHY92JR8YlwkUDVySEZfGfQdO7E7Z8s2HL9TSoXTPXRud9nA8IBqSwcZgWeqpPj6BYw7yTbXBN9q2v9lQEq5zBmWA8vWLCptCi4tzwW8RQMQlFQATPLSh6vCSh/plJBkMyQBHZfWYnkKRgEktEVpTJXERN2Xzo4ex2VC6K6qXYpF5b3ypVRT8EgcAERSJXRbwCBOTFzXblM5RxGBaRt+ZPYA+LO0mgxz5K1Ig+UgAzKIuGnz39z6S+olDeaibaXRsU1RUFvgx+GwTWgPCaDgMw2XXpr9gwq50XV0bkxJiYeEiNF5cwE5XsiOEkAUkXkUW51SSOVchjl8WKef604XFSRbzCGCYeCoESStv/p8QU1VPIM3knNDynctnBRfsEYhgSlNCIGgQv2UCkvGIHZgteMh1nBW9W4F16RAM6yDVV7amZTaYQcr59cuuhhWRTWBvAMLxQGeyFSHOLnh0MvUskz5RF+fbRYDEy0mZgqQYUHOLhr//b6rGoqeaLqQG0pw3PrBbyA+4EQUkRmhvgqNUfICUipKK4OKUqIJVPKB0jpEhjmWWp64jdbKmVZZNYogcJm493gsifOqhDyeh9GYR/FM7sW+DA5CKR0MSK3tvKZkpwB5gRE4tjFEr7RL0iWBGV51vHFCyupNGWWPqLgnoer9mtyEGSJAzwLllDTGzyznDjRN/CwOFkoFb4bm0eVIXICgpvdGoEvrF7fC89zfLkkeV5HbOhWiTwTpKYvCAJLGshRdXtKMKAWlyxq+MPQLk1h66g5RE5ABJYNFrqY3wvJklJRUKg5ZWLFXIA86yek2uDOPkBNb3CM5Pf7DL2QyIrUGiLH+xC5Bmmm/ARnHUhC6PnzxWDK0RH5HuIjZGy27erU9AZ0dTIWXyG+NpBBrSFySxZw220IqeUPFoS6jVAPNadM7yDsgNB1qOkLuAziMYIb1PQGA75wIaKGPyAb+9oF16g5RE5ALIQ+tSyLWoWDEAK6aXW3JlK9VJoyx1oyvVkNdvo5KXXDAVkdnaKmNwx0xjH98w3JNmTCm+Bc9hKVhsgJSI9pvp9Vdd++jmq6AXB2/HHrhcs5aTkVDv0DFzoHvKdq/mQsKX/4t7KJLDpOJW+IbAvMGoMkxfwAWZB8DT7W1diTE+WcgKz6pK1bs6z3daPwmJDsSKt6ZsCyjlLJMz0DsDGZ8SdlDROBjOb8YeWOjptU8kTXusuaazu7oJrfEnQvdkpVcUn6PTVHyAkIIW7br/Unklni0EJIZ1WgGsauZR+fvUglz6zY0dGfVp09ybRNlfwgi3k8YSbvJJ29VMoLt9v6rZVQL7hOYUubndHJGclBtzn1byqNMCogi09/2nFb01/oj+f/5TyjauBOKtPcZ1r7qZQ3f2lRfxZPWi2anp8TSDAGExZMa2jr8u03L1M5L7q3Xc+iAeuHRl/ScvPcjSLDBnZS/cjtNHd2v3171Ewbs9N5q7Pn4otVMx3btBsCsoRbk1FxG5dMVgMDqfTpXl1/tuFMa5zKefPROdX59qLQBwLnNog8Wy1OcjB1N+QEsW/QsFNZuO35Xb1v98QLX4/Sx+O3wqujrQ6013ABUWI8+AaqBjAH01+ghL22+5X2PirnMG7r+esbnae/V1neauvGSoHjigTcVU7UGFm2DeK4ttxKpQ+mLPvl+o/PjnkAkw9HTqSMmVHhyAMx9iFcSh/BHTfLceO/C8mKjApBf9zszGhoY92m9sN+BGOY9AeD7eGniv8OTaOB4dgyTsQd9wS+IQu4lciYdkI7CLrNH3Rvbb9FL41i0tbzVP2iWJkobpN5fmM4IJfJskTP1Bk8A9HQmbpmGDBrWqdVCN/Yd7PjxKGOXn+bmbto3feVVcVB9qehIL8EJy8nChwgr0O2xxBnhGU5eP2CfYbl/m4gBRsbtneMORP9oGpjpcCsiKzHHfdOPiQ/wMniyFEu2dbiTQCAeN/vavC466BGYLttXc9fmXBXMGlAhiHHur+sq6uPiUI9z7CVHMPwBnLSuuN8FuC48/Oaz1ylt94XfrW5ouyprwWfYRkwNyCyYYjwkBHows1fa+tV/fzGxlv39b9gqvfPmQ+i/HK8KlcBjhHwfl8HEHyOd1JnuzZd66S3TTPNNNP8/wDAfwDG7G0m9LKBpwAAAABJRU5ErkJggg==) 10px 10px no-repeat;background-size:40px;background-color:#fdfdfd}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#fdfdfd}.markdown-body a{text-decoration:none;font-weight:700;color:#ef7060;border-bottom:1px solid #ef7060}.markdown-body a:active,.markdown-body a:hover{color:#ef2d26}.markdown-body table tr td,.markdown-body table tr th{border:1px solid #ccc;padding:5px 10px}.markdown-body table{display:block!important;width:auto;max-width:100%;overflow:auto;border-collapse:collapse}.markdown-body thead{background:#f0f0f0;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#f8f8f8}.markdown-body blockquote{margin-inline-start:0;margin-inline-end:0;border-left:3px solid #ef7060;background:#fff9f9;padding:1px 20px;margin-top:20px}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="atom-one-light">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#383a42;background:#fafafa}.hljs-comment,.hljs-quote{color:#a0a1a7;font-style:italic}.hljs-doctag,.hljs-formula,.hljs-keyword{color:#a626a4}.hljs-deletion,.hljs-name,.hljs-section,.hljs-selector-tag,.hljs-subst{color:#e45649}.hljs-literal{color:#0184bb}.hljs-addition,.hljs-attribute,.hljs-meta-string,.hljs-regexp,.hljs-string{color:#50a14f}.hljs-built_in,.hljs-class .hljs-title{color:#c18401}.hljs-attr,.hljs-number,.hljs-selector-attr,.hljs-selector-class,.hljs-selector-pseudo,.hljs-template-variable,.hljs-type,.hljs-variable{color:#986801}.hljs-bullet,.hljs-link,.hljs-meta,.hljs-selector-id,.hljs-symbol,.hljs-title{color:#4078f2}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}.hljs-link{text-decoration:underline}</style><h2 data-id="heading-0">å¼•è¨€</h2>
<p>åœ¨ Web åº”ç”¨çš„å®‰å…¨ä½“ç³»ä¸­ï¼Œ<strong>æƒé™æ§åˆ¶</strong> æ˜¯æœ€æ ¸å¿ƒçš„é˜²çº¿ä¹‹ä¸€ã€‚æ— è®ºæ˜¯ä¼ä¸šåå°ã€æ•°æ®é—¨æˆ·è¿˜æ˜¯ SaaS å¹³å°ï¼Œä¸€æ—¦æƒé™è®¾è®¡å‡ºç°æ¼æ´ï¼Œå°±å¯èƒ½å¯¼è‡´æ•°æ®æ³„æ¼ã€è¶Šæƒæ“ä½œç”šè‡³åé—¨åˆ©ç”¨ã€‚</p>
<p>ç„¶è€Œï¼Œè®¸å¤šå¼€å‘è€…åªåœ¨å‰ç«¯é…ç½®æƒé™é€»è¾‘ï¼Œå¿½ç•¥äº† <strong>åç¼–è¯‘ä¸å‰ç«¯æºç æš´éœ²çš„å®‰å…¨é£é™©</strong>ã€‚é€šè¿‡ F12 è°ƒè¯•ã€æ‰“åŒ…åç¼–è¯‘æˆ–ç½‘ç»œæŠ“åŒ…ç­‰æ‰‹æ®µï¼Œæ”»å‡»è€…å¯ä»¥è½»æ˜“ç»•è¿‡å‰ç«¯åˆ¤æ–­ç›´æ¥è®¿é—®åç«¯æ¥å£ã€‚</p>
<blockquote>
<p><strong>é—®é¢˜ï¼š</strong> å¦‚ä½•åœ¨ã€Œæºç å¯è§ã€ã€Œåç¼–è¯‘å¯è¡Œã€çš„ç¯å¢ƒä¸‹ï¼Œè®¾è®¡ä¸€å¥—çœŸæ­£å®‰å…¨ä¸”å¯æ‰©å±•çš„æƒé™ä½“ç³»ï¼Ÿ</p>
</blockquote>
<p>æœ¬æ–‡å°†ä» <strong>Web å®‰å…¨è§†è§’</strong> åˆ†ææƒé™è®¾è®¡çš„åº•å±‚é£é™©ï¼Œè®²è§£ <strong>ä»å‰ç«¯åˆ°åç«¯çš„ç»Ÿä¸€æƒé™é˜²æŠ¤ç­–ç•¥</strong>ï¼Œå¹¶é€šè¿‡ç¤ºä¾‹ä»£ç å±•ç¤ºå¦‚ä½•æœ‰æ•ˆæŠµå¾¡åç¼–è¯‘å¸¦æ¥çš„å®‰å…¨å¨èƒã€‚</p>
<hr/>
<h2 data-id="heading-1">ä¸€ã€é—®é¢˜å®šä¹‰ä¸èƒŒæ™¯</h2>
<h3 data-id="heading-2">1. å‰ç«¯å¯é€†å‘çš„ç°å®</h3>
<p>ç°ä»£ Web å‰ç«¯ï¼ˆå¦‚ Reactã€Vueã€Angularï¼‰ä½¿ç”¨ <strong>æ‰“åŒ…ç¼–è¯‘</strong> ä¸ <strong>ä»£ç æ··æ·†</strong> æŠ€æœ¯ï¼Œä½†æœ¬è´¨ä¸Šä»æ˜¯ <strong>è¿è¡Œåœ¨ç”¨æˆ·ç«¯çš„å¯æ‰§è¡Œè„šæœ¬</strong>ã€‚æ”»å‡»è€…å¯é€šè¿‡ï¼š</p>
<ul>
<li>æµè§ˆå™¨å¼€å‘è€…å·¥å…·æŸ¥çœ‹æºç ï¼ˆå³ä½¿æ··æ·†ï¼‰ï¼›</li>
<li>æŠ“åŒ…å·¥å…·ï¼ˆå¦‚ Burpã€Postmanï¼‰ç›´æ¥æ¨¡æ‹Ÿè¯·æ±‚ï¼›</li>
<li>åç¼–è¯‘ WebAssembly / å‰ç«¯åŠ å¯†é€»è¾‘ï¼›</li>
<li>ä¿®æ”¹æœ¬åœ°å­˜å‚¨ä¿¡æ¯ï¼ˆtokenã€roleã€flagï¼‰ã€‚</li>
</ul>
<p>è¿™æ„å‘³ç€ <strong>ä»»ä½•å‰ç«¯å±‚çš„æƒé™æ ¡éªŒéƒ½æ˜¯ä¸å¯ä¿¡çš„</strong>ã€‚</p>
<h3 data-id="heading-3">2. å¸¸è§é”™è¯¯ç¤ºä¾‹</h3>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-comment">// âŒ å‰ç«¯ä¸­é”™è¯¯çš„â€œæƒé™æ§åˆ¶â€</span>
if (userRole === 'admin') {
  <span class="hljs-built_in">showAdminPanel</span>();
} else {
  <span class="hljs-built_in">hideAdminPanel</span>();
}
</code></pre>
<p>æ”»å‡»è€…åªéœ€åœ¨æµè§ˆå™¨æ§åˆ¶å°è¾“å…¥ï¼š</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">userRole</span> = <span class="hljs-string">'admin'</span><span class="hljs-comment">; showAdminPanel();</span>
</code></pre>
<p>å³å¯ä¼ªè£…ä¸ºç®¡ç†å‘˜ã€‚</p>
<hr/>
<h2 data-id="heading-4">äºŒã€è§£å†³æ–¹æ¡ˆä¸æŠ€æœ¯è®¾è®¡</h2>
<h3 data-id="heading-5">ğŸ”’ æƒé™æ§åˆ¶çš„æœ¬è´¨ï¼šå¯ä¿¡åˆ¤å®šå¿…é¡»åœ¨æœåŠ¡ç«¯</h3>
<p>å®‰å…¨è®¾è®¡åŸåˆ™ï¼š</p>
<blockquote>
<p><strong>ä»»ä½•å®‰å…¨ç›¸å…³çš„åˆ¤æ–­éƒ½åº”åœ¨æœåŠ¡ç«¯å®Œæˆï¼Œå‰ç«¯ä»…ä½œå±•ç¤ºæˆ–å¼•å¯¼ã€‚</strong></p>
</blockquote>
<h3 data-id="heading-6">1. åç«¯ç»Ÿä¸€é‰´æƒä¸æˆæƒ</h3>
<p>åç«¯éœ€è¦æ„å»ºä¸€å¥—é›†ä¸­å¼çš„ <strong>é‰´æƒï¼ˆAuthenticationï¼‰</strong> ä¸ <strong>æˆæƒï¼ˆAuthorizationï¼‰</strong> æ¨¡å‹ï¼š</p>
<ul>
<li><strong>é‰´æƒï¼š</strong> å½“å‰è¯·æ±‚æ˜¯è°ï¼Ÿï¼ˆJWT / Session / OAuth2ï¼‰</li>
<li><strong>æˆæƒï¼š</strong> å½“å‰ç”¨æˆ·èƒ½åšä»€ä¹ˆï¼Ÿï¼ˆRBAC / ABAC / PBACï¼‰</li>
</ul>
<p><strong>ç¤ºä¾‹ï¼šåŸºäº RBAC çš„ Spring Boot åç«¯å®ç°</strong></p>
<pre><code class="hljs language-less" lang="less"><span class="hljs-comment">// RoleBasedAccess.javaï¼ˆè‡ªå®šä¹‰æ³¨è§£ï¼‰</span>
<span class="hljs-variable">@Target</span>(ElementType.METHOD)
<span class="hljs-variable">@Retention</span>(RetentionPolicy.RUNTIME)
public <span class="hljs-variable">@interface</span> RoleBasedAccess {
    <span class="hljs-selector-tag">String</span><span class="hljs-selector-attr">[]</span> <span class="hljs-selector-tag">value</span>();
}
</code></pre>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// SecurityInterceptor.java</span>
<span class="hljs-meta">@Component</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SecurityInterceptor</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">HandlerInterceptor</span> {
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">preHandle</span><span class="hljs-params">(HttpServletRequest req, HttpServletResponse res, Object handler)</span> {
        <span class="hljs-type">String</span> <span class="hljs-variable">token</span> <span class="hljs-operator">=</span> req.getHeader(<span class="hljs-string">"Authorization"</span>);
        <span class="hljs-type">User</span> <span class="hljs-variable">user</span> <span class="hljs-operator">=</span> TokenUtils.verify(token);
        <span class="hljs-type">RoleBasedAccess</span> <span class="hljs-variable">access</span> <span class="hljs-operator">=</span> ((HandlerMethod) handler).getMethodAnnotation(RoleBasedAccess.class);
        <span class="hljs-keyword">if</span> (access != <span class="hljs-literal">null</span> &amp;&amp; !user.hasAnyRole(access.value())) {
            res.setStatus(HttpServletResponse.SC_FORBIDDEN);
            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
        }
        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
    }
}
</code></pre>
<pre><code class="hljs language-less" lang="less"><span class="hljs-comment">// æ§åˆ¶å™¨ç¤ºä¾‹</span>
<span class="hljs-variable">@GetMapping</span>(<span class="hljs-string">"/admin/list"</span>)
<span class="hljs-variable">@RoleBasedAccess</span>({<span class="hljs-string">"ADMIN"</span>})
public ResponseEntity&lt;?&gt; <span class="hljs-built_in">listAdmins</span>() {
    <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">ResponseEntity</span><span class="hljs-selector-class">.ok</span>(adminService.<span class="hljs-built_in">findAll</span>());
}
</code></pre>
<blockquote>
<p>âœ… å³ä½¿æ”»å‡»è€…ç¯¡æ”¹å‰ç«¯å˜é‡æˆ–ä¿®æ”¹ UIï¼Œä»æ— æ³•è®¿é—®æœªç»æˆæƒçš„æ¥å£ã€‚</p>
</blockquote>
<hr/>
<h3 data-id="heading-7">2. å‰ç«¯ä»…ä½œâ€œæƒé™å¯è§†åŒ–â€ï¼Œéâ€œæƒé™æ§åˆ¶â€</h3>
<p>å‰ç«¯å¯ä»¥æŒ‰æœåŠ¡å™¨è¿”å›çš„æƒé™æ ‡è¯†åŠ¨æ€æ¸²æŸ“æŒ‰é’®ã€èœå•ï¼Œä½†<strong>ä¸èƒ½</strong>ä¾èµ–è¿™äº›å­—æ®µåšä¸šåŠ¡å®‰å…¨åˆ¤æ–­ã€‚</p>
<p><strong>å‰ç«¯ç¤ºä¾‹ï¼ˆVue + Axiosï¼‰</strong></p>
<pre><code class="hljs language-ini" lang="ini">// app.js
axios.interceptors.request.use(<span class="hljs-attr">config</span> =&gt; {
  const <span class="hljs-attr">token</span> = localStorage.getItem(<span class="hljs-string">'token'</span>)<span class="hljs-comment">;</span>
  <span class="hljs-attr">config.headers.Authorization</span> = token<span class="hljs-comment">;</span>
  return config<span class="hljs-comment">;</span>
})<span class="hljs-comment">;</span>

// åŠ¨æ€èœå•æ¸²æŸ“
const <span class="hljs-attr">user</span> = getUserInfo()<span class="hljs-comment">; // åç«¯è¿”å›çš„è§’è‰²ä¿¡æ¯</span>
const <span class="hljs-attr">routes</span> = allRoutes.filter(route =&gt; user.roles.includes(route.meta.role))<span class="hljs-comment">;</span>
</code></pre>
<ul>
<li>èœå•ä¸æŒ‰é’®çš„å±•ç¤ºåªå½±å“â€œè§†è§‰ä½“éªŒâ€ï¼›</li>
<li>å®é™…çš„è®¿é—®ç»“æœç”±åç«¯å†³å®šï¼ˆå³ä½¿å‰ç«¯æŒ‰é’®è¢«ä¼ªé€ ä¹Ÿæ— æ•ˆï¼‰ã€‚</li>
</ul>
<hr/>
<h3 data-id="heading-8">3. é˜²åç¼–è¯‘ä¸æ•°æ®æš´éœ²çš„åŠ å›ºæªæ–½</h3>



































<table><thead><tr><th>å¨èƒç±»å‹</th><th>é˜²æŠ¤ç­–ç•¥</th><th>æŠ€æœ¯ç‚¹</th></tr></thead><tbody><tr><td>æºç åç¼–è¯‘</td><td>æ„å»ºæ—¶æ··æ·†ä¸ Tree Shaking</td><td>Webpack <code>terser</code> / <code>esbuild</code></td></tr><tr><td>å…³é”®é€»è¾‘é€†å‘</td><td>å°†æ ¸å¿ƒç®—æ³•è¿ç§»è‡³åç«¯æˆ– WebAssembly</td><td>ä¾‹å¦‚ç­¾åã€å¯†é’¥ç”Ÿæˆ</td></tr><tr><td>API è¢«ç›´æ¥è°ƒç”¨</td><td>ä½¿ç”¨ Token + HMAC ç­¾å + é™æµ</td><td>JWT + Redis + Nginx</td></tr><tr><td>è°ƒè¯•æ³¨å…¥</td><td>CSPï¼ˆContent Security Policyï¼‰é™åˆ¶ JS æ‰§è¡Œç¯å¢ƒ</td><td>HTTP å®‰å…¨å¤´</td></tr><tr><td>æ•°æ®æ³„æ¼</td><td>åç«¯ç™½åå•è¿‡æ»¤ã€æ•æ„Ÿå­—æ®µè„±æ•</td><td>DTO é˜²æ­¢ DB å­—æ®µé€ä¼ </td></tr></tbody></table>
<p>ä¾‹å¦‚ï¼Œé€šè¿‡ <strong>è¯·æ±‚ç­¾åæœºåˆ¶ï¼ˆHMACï¼‰</strong> é˜»æ­¢ä¼ªé€ è¯·æ±‚ï¼š</p>
<pre><code class="hljs language-ini" lang="ini">// å‰ç«¯å‘èµ·è¯·æ±‚å‰ç”Ÿæˆç­¾åï¼ˆæ‰€æœ‰å‚æ•° + æ—¶é—´æˆ³ï¼‰
import crypto from "crypto"<span class="hljs-comment">;</span>

const <span class="hljs-attr">secret</span> = <span class="hljs-string">"server-shared-key"</span><span class="hljs-comment">;</span>
const <span class="hljs-attr">timestamp</span> = Date.now().toString()<span class="hljs-comment">;</span>
const <span class="hljs-attr">sign</span> = crypto.createHmac(<span class="hljs-string">'sha256'</span>, secret)
                   .update(userId + timestamp)
                   .digest('hex')<span class="hljs-comment">;</span>

axios.post('/api/secure', { data, timestamp, sign })<span class="hljs-comment">;</span>
</code></pre>
<p>åç«¯éªŒè¯ç­¾ååˆæ³•æ€§ï¼š</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># Flask ç¤ºä¾‹</span>
<span class="hljs-keyword">import</span> hmac, hashlib

<span class="hljs-keyword">def</span> <span class="hljs-title function_">verify_sign</span>(<span class="hljs-params">userId, ts, sign</span>):
    secret = <span class="hljs-string">"server-shared-key"</span>
    expected = hmac.new(secret.encode(), <span class="hljs-string">f"<span class="hljs-subst">{userId}</span><span class="hljs-subst">{ts}</span>"</span>.encode(), hashlib.sha256).hexdigest()
    <span class="hljs-keyword">return</span> hmac.compare_digest(expected, sign)
</code></pre>
<hr/>
<h2 data-id="heading-9">ä¸‰ã€ä¼˜ç¼ºç‚¹åˆ†æä¸å®è·µå»ºè®®</h2>





























<table><thead><tr><th>æ¨¡å‹</th><th>ä¼˜ç‚¹</th><th>ç¼ºç‚¹</th><th>é€‚ç”¨åœºæ™¯</th></tr></thead><tbody><tr><td>å‰ç«¯æƒé™ï¼ˆå±•ç¤ºçº§ï¼‰</td><td>å“åº”å¿«ã€æ˜“å®ç°</td><td>ç®€å•æ˜“è¢«ç»•è¿‡</td><td>UIæ§åˆ¶ã€ä½å®‰å…¨é¡µé¢</td></tr><tr><td>åç«¯æƒé™ï¼ˆéªŒè¯çº§ï¼‰</td><td>å®‰å…¨å¯é ã€å¯å®¡è®¡</td><td>å¼€å‘ç•¥å¤æ‚</td><td>æ‰€æœ‰æ•æ„Ÿæ¥å£å¿…é¡»</td></tr><tr><td>æ··åˆç­–ç•¥</td><td>å®‰å…¨+ä½“éªŒå¹³è¡¡</td><td>éœ€å‰åç«¯ç‰ˆæœ¬ç»Ÿä¸€</td><td>ä¼ä¸šåå°ä¸­å¤§å‹ç³»ç»Ÿ</td></tr></tbody></table>
<p><strong>å®è·µå»ºè®®ï¼š</strong></p>
<ol>
<li><strong>å‰ç«¯è´Ÿè´£ä½“éªŒ</strong>ï¼Œä½†ä¸è¦æ‰¿æ‹…å®‰å…¨èŒè´£ï¼›</li>
<li><strong>åç«¯è´Ÿè´£æƒé™æ ¸å¿ƒ</strong>ï¼Œæ‰€æœ‰è¯·æ±‚å‡äºŒæ¬¡æ ¡éªŒï¼›</li>
<li>å¯¹<strong>é™æ€èµ„æºä¸æ¥å£</strong>åŒæ—¶é™æµã€æ ¡éªŒã€å®¡è®¡ï¼›</li>
<li>æ¯ä¸ªæƒé™ç‚¹åº”<strong>æœ‰æ—¥å¿—å¯è¿½æº¯ã€æœ‰ç­–ç•¥å¯ç®¡ç†</strong>ã€‚</li>
</ol>
<hr/>
<h2 data-id="heading-10">å››ã€ç»“è®º</h2>
<p>åœ¨åç¼–è¯‘ä¸æºç æš´éœ²æˆä¸ºå¸¸æ€çš„ Web ç¯å¢ƒä¸­ï¼Œ<strong>å‰ç«¯å®‰å…¨åªæ˜¯å¹»è§‰ï¼Œåç«¯çš„æƒé™æ‰æ˜¯çœŸç›¸</strong>ã€‚</p>
<p>é«˜è´¨é‡çš„æƒé™è®¾è®¡ï¼Œä¸æ˜¯è®©å‰ç«¯æ›´â€œèªæ˜â€ï¼Œè€Œæ˜¯è®©åç«¯æ›´â€œå¯ä¿¡â€ï¼›ä¸æ˜¯é æ··æ·†éšè—é€»è¾‘ï¼Œè€Œæ˜¯é æ¶æ„å»ºç«‹ä¿¡ä»»è¾¹ç•Œã€‚</p>
<p>æœªæ¥ï¼Œéšç€ <strong>é›¶ä¿¡ä»»æ¶æ„ï¼ˆZero Trustï¼‰</strong> ä¸ <strong>å‰åç«¯ä¸€ä½“åŒ–åŠ å¯†é€šä¿¡</strong> çš„æ™®åŠï¼Œ<br/>
æƒé™è®¾è®¡å°†æ›´æ™ºèƒ½ã€æ›´å»ä¸­å¿ƒåŒ–ï¼ŒåŸºäº <strong>èº«ä»½ã€ä¸Šä¸‹æ–‡ä¸è¡Œä¸ºæ£€æµ‹</strong> çš„åŠ¨æ€æˆæƒæœºåˆ¶å°†é€æ¸å–ä»£ä¼ ç»Ÿ RBACã€‚</p>
<hr/>
<h2 data-id="heading-11">äº”ã€å‚è€ƒèµ„æ–™</h2>
<ol>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fowasp.org%2FTop10%2FA01_2021-Broken_Access_Control%2F" target="_blank" title="https://owasp.org/Top10/A01_2021-Broken_Access_Control/" ref="nofollow noopener noreferrer">OWASP Top 10 2021 â€“ A01: Broken Access Control</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fspring.io%2Fprojects%2Fspring-security" target="_blank" title="https://spring.io/projects/spring-security" ref="nofollow noopener noreferrer">Spring Security å®˜æ–¹æ–‡æ¡£</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fzh-CN%2Fdocs%2FWeb%2FHTTP%2FCSP" target="_blank" title="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/CSP" ref="nofollow noopener noreferrer">MDN â€“ Content Security Policy (CSP) æŒ‡å—</a></li>
<li>[JWT.io â€“ JSON Web Token å®˜æ–¹æ ‡å‡†]</li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fcheatsheetseries.owasp.org%2Fcheatsheets%2FAuthorization_Cheat_Sheet.html" target="_blank" title="https://cheatsheetseries.owasp.org/cheatsheets/Authorization_Cheat_Sheet.html" ref="nofollow noopener noreferrer">OWASP â€“ Authorization Cheat Sheet</a></li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Unsafeé­”æ³•ç±»æ·±åº¦è§£æï¼šJavaåº•å±‚æ“ä½œçš„ç»ˆææŒ‡å—]]></title>    <link>https://juejin.cn/post/7603688142004699145</link>    <guid>https://juejin.cn/post/7603688142004699145</guid>    <pubDate>2026-02-08T06:33:22.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7603688142004699145" data-draft-id="7603721514203283465" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Unsafeé­”æ³•ç±»æ·±åº¦è§£æï¼šJavaåº•å±‚æ“ä½œçš„ç»ˆææŒ‡å—"/> <meta itemprop="keywords" content="åç«¯"/> <meta itemprop="datePublished" content="2026-02-08T06:33:22.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ç¥å¥‡å°æ±¤åœ†"/> <meta itemprop="url" content="https://juejin.cn/user/1151943919285431"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Unsafeé­”æ³•ç±»æ·±åº¦è§£æï¼šJavaåº•å±‚æ“ä½œçš„ç»ˆææŒ‡å—
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1151943919285431/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ç¥å¥‡å°æ±¤åœ†
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-08T06:33:22.000Z" title="Sun Feb 08 2026 06:33:22 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»23åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">ä»‹ç»</h2>
<p>Unsafeæ˜¯ä½äºsun.miscåŒ…ä¸‹çš„ä¸€ä¸ªç±»ï¼Œä¸»è¦æä¾›ä¸€äº›ç”¨äºæ‰§è¡Œä½çº§åˆ«ã€ä¸å®‰å…¨æ“ä½œçš„æ–¹æ³•ï¼Œå¦‚ç›´æ¥è®¿é—®ç³»ç»Ÿå†…å­˜èµ„æºã€è‡ªä¸»ç®¡ç†å†…å­˜èµ„æºç­‰ï¼Œè¿™äº›æ–¹æ³•åœ¨æå‡Javaè¿è¡Œæ•ˆç‡ã€å¢å¼ºJavaè¯­è¨€åº•å±‚èµ„æºæ“ä½œèƒ½åŠ›æ–¹é¢èµ·åˆ°äº†å¾ˆå¤§çš„ä½œç”¨ã€‚ä½†ç”±äºUnsafeç±»ä½¿Javaè¯­è¨€æ‹¥æœ‰äº†ç±»ä¼¼Cè¯­è¨€æŒ‡é’ˆä¸€æ ·æ“ä½œå†…å­˜ç©ºé—´çš„èƒ½åŠ›ï¼Œè¿™æ— ç–‘ä¹Ÿå¢åŠ äº†ç¨‹åºå‘ç”Ÿç›¸å…³æŒ‡é’ˆé—®é¢˜çš„é£é™©ã€‚åœ¨ç¨‹åºä¸­è¿‡åº¦ã€ä¸æ­£ç¡®ä½¿ç”¨Unsafeç±»ä¼šä½¿å¾—ç¨‹åºå‡ºé”™çš„æ¦‚ç‡å˜å¤§ï¼Œä½¿å¾—Javaè¿™ç§å®‰å…¨çš„è¯­è¨€å˜å¾—ä¸å†â€œå®‰å…¨â€ï¼Œå› æ­¤å¯¹Unsafeçš„ä½¿ç”¨ä¸€å®šè¦æ…é‡ã€‚</p>
<p>è¿™ä¸ªç±»å°½ç®¡é‡Œé¢çš„æ–¹æ³•éƒ½æ˜¯ public çš„ï¼Œä½†æ˜¯å¹¶æ²¡æœ‰åŠæ³•ä½¿ç”¨å®ƒä»¬ï¼ŒJDK API æ–‡æ¡£ä¹Ÿæ²¡æœ‰æä¾›ä»»ä½•å…³äºè¿™ä¸ªç±»çš„æ–¹æ³•çš„è§£é‡Šã€‚æ€»è€Œè¨€ä¹‹ï¼Œå¯¹äº Unsafe ç±»çš„ä½¿ç”¨éƒ½æ˜¯å—é™åˆ¶çš„ï¼Œåªæœ‰æˆä¿¡çš„ä»£ç æ‰èƒ½è·å¾—è¯¥ç±»çš„å®ä¾‹ï¼Œå½“ç„¶ JDK åº“é‡Œé¢çš„ç±»æ˜¯å¯ä»¥éšæ„ä½¿ç”¨çš„ã€‚</p>
<p>å…ˆæ¥çœ‹ä¸‹è¿™å¼ å›¾ï¼Œå¯¹UnSafeç±»æ€»ä½“åŠŸèƒ½ï¼š</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fseven97-blog.oss-cn-hangzhou.aliyuncs.com%2Fimgs%2F202404251040445.jpg" target="_blank" title="https://seven97-blog.oss-cn-hangzhou.aliyuncs.com/imgs/202404251040445.jpg" ref="nofollow noopener noreferrer"><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/af56ce01300f4528b2404ef5e07612fc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56We5aWH5bCP5rGk5ZyG:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771137203&amp;x-signature=FbCKApmBIzjz3cacmsUy8EKKseY%3D" alt="" loading="lazy"/></a></p>
<p>å¦‚ä¸Šå›¾æ‰€ç¤ºï¼ŒUnsafeæä¾›çš„APIå¤§è‡´å¯åˆ†ä¸ºå†…å­˜æ“ä½œã€CASã€Classç›¸å…³ã€å¯¹è±¡æ“ä½œã€çº¿ç¨‹è°ƒåº¦ã€ç³»ç»Ÿä¿¡æ¯è·å–ã€å†…å­˜å±éšœã€æ•°ç»„æ“ä½œç­‰å‡ ç±»ï¼Œä¸‹é¢å°†å¯¹å…¶ç›¸å…³æ–¹æ³•å’Œåº”ç”¨åœºæ™¯è¿›è¡Œè¯¦ç»†ä»‹ç»ã€‚</p>
<h2 data-id="heading-1">å†…å­˜æ“ä½œ</h2>
<h3 data-id="heading-2">ä»‹ç»</h3>
<p>å¦‚æœä½ æ˜¯ä¸€ä¸ªå†™è¿‡ C æˆ–è€… C++ çš„ç¨‹åºå‘˜ï¼Œä¸€å®šå¯¹å†…å­˜æ“ä½œä¸ä¼šé™Œç”Ÿï¼Œè€Œåœ¨ Java ä¸­æ˜¯ä¸å…è®¸ç›´æ¥å¯¹å†…å­˜è¿›è¡Œæ“ä½œçš„ï¼Œå¯¹è±¡å†…å­˜çš„åˆ†é…å’Œå›æ”¶éƒ½æ˜¯ç”± JVM è‡ªå·±å®ç°çš„ã€‚ä½†æ˜¯åœ¨Â <code>Unsafe</code>Â ä¸­ï¼Œæä¾›çš„ä¸‹åˆ—æ¥å£å¯ä»¥ç›´æ¥è¿›è¡Œå†…å­˜æ“ä½œï¼š</p>
<p>java</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">//åˆ†é…æ–°çš„æœ¬åœ°ç©ºé—´</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">native</span> <span class="hljs-type">long</span> <span class="hljs-title function_">allocateMemory</span><span class="hljs-params">(<span class="hljs-type">long</span> bytes)</span>;
<span class="hljs-comment">//é‡æ–°è°ƒæ•´å†…å­˜ç©ºé—´çš„å¤§å°</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">native</span> <span class="hljs-type">long</span> <span class="hljs-title function_">reallocateMemory</span><span class="hljs-params">(<span class="hljs-type">long</span> address, <span class="hljs-type">long</span> bytes)</span>;
<span class="hljs-comment">//å°†å†…å­˜è®¾ç½®ä¸ºæŒ‡å®šå€¼</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">native</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setMemory</span><span class="hljs-params">(Object o, <span class="hljs-type">long</span> offset, <span class="hljs-type">long</span> bytes, <span class="hljs-type">byte</span> value)</span>;
<span class="hljs-comment">//å†…å­˜æ‹·è´</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">native</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">copyMemory</span><span class="hljs-params">(Object srcBase, <span class="hljs-type">long</span> srcOffset,Object destBase, <span class="hljs-type">long</span> destOffset,<span class="hljs-type">long</span> bytes)</span>;
<span class="hljs-comment">//æ¸…é™¤å†…å­˜</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">native</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">freeMemory</span><span class="hljs-params">(<span class="hljs-type">long</span> address)</span>;
</code></pre>
<p>ä½¿ç”¨ä¸‹é¢çš„ä»£ç è¿›è¡Œæµ‹è¯•ï¼š</p>
<p>java</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">memoryTest</span>()</span> {
    <span class="hljs-built_in">int</span> size = <span class="hljs-number">4</span>;
    <span class="hljs-built_in">long</span> addr = <span class="hljs-keyword">unsafe</span>.allocateMemory(size);
    <span class="hljs-built_in">long</span> addr3 = <span class="hljs-keyword">unsafe</span>.reallocateMemory(addr, size * <span class="hljs-number">2</span>);
    System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">"addr: "</span>+addr);
    System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">"addr3: "</span>+addr3);
    <span class="hljs-keyword">try</span> {
        <span class="hljs-keyword">unsafe</span>.setMemory(<span class="hljs-literal">null</span>,addr ,size,(<span class="hljs-built_in">byte</span>)<span class="hljs-number">1</span>);
        <span class="hljs-keyword">for</span> (<span class="hljs-built_in">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">2</span>; i++) {
            <span class="hljs-keyword">unsafe</span>.copyMemory(<span class="hljs-literal">null</span>,addr,<span class="hljs-literal">null</span>,addr3+size*i,<span class="hljs-number">4</span>);
        }
        System.<span class="hljs-keyword">out</span>.println(<span class="hljs-keyword">unsafe</span>.getInt(addr));
        System.<span class="hljs-keyword">out</span>.println(<span class="hljs-keyword">unsafe</span>.getLong(addr3));
    }<span class="hljs-keyword">finally</span> {
        <span class="hljs-keyword">unsafe</span>.freeMemory(addr);
        <span class="hljs-keyword">unsafe</span>.freeMemory(addr3);
    }
}
</code></pre>
<p>å…ˆçœ‹ç»“æœè¾“å‡ºï¼š</p>
<p>plain</p>
<pre><code class="hljs language-makefile" lang="makefile"><span class="hljs-section">addr: 2433733895744</span>
<span class="hljs-section">addr3: 2433733894944</span>
16843009
72340172838076673
</code></pre>
<p>åˆ†æä¸€ä¸‹è¿è¡Œç»“æœï¼Œé¦–å…ˆä½¿ç”¨<code>allocateMemory</code>æ–¹æ³•ç”³è¯· 4 å­—èŠ‚é•¿åº¦çš„å†…å­˜ç©ºé—´ï¼Œè°ƒç”¨<code>setMemory</code>æ–¹æ³•å‘æ¯ä¸ªå­—èŠ‚å†™å…¥å†…å®¹ä¸º<code>byte</code>ç±»å‹çš„ 1ï¼Œå½“ä½¿ç”¨ Unsafe è°ƒç”¨<code>getInt</code>æ–¹æ³•æ—¶ï¼Œå› ä¸ºä¸€ä¸ª<code>int</code>å‹å˜é‡å  4 ä¸ªå­—èŠ‚ï¼Œä¼šä¸€æ¬¡æ€§è¯»å– 4 ä¸ªå­—èŠ‚ï¼Œç»„æˆä¸€ä¸ª<code>int</code>çš„å€¼ï¼Œå¯¹åº”çš„åè¿›åˆ¶ç»“æœä¸º 16843009ã€‚</p>
<p>ä½ å¯ä»¥é€šè¿‡ä¸‹å›¾ç†è§£è¿™ä¸ªè¿‡ç¨‹ï¼š</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fseven97-blog.oss-cn-hangzhou.aliyuncs.com%2Fimgs%2F202406202130396.png" target="_blank" title="https://seven97-blog.oss-cn-hangzhou.aliyuncs.com/imgs/202406202130396.png" ref="nofollow noopener noreferrer"><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/60e61edb820240908dfef29cdca85ae7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56We5aWH5bCP5rGk5ZyG:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771137203&amp;x-signature=McQsQTlSzXk3eVY8DvAFFeWA0zo%3D" alt="" loading="lazy"/></a></p>
<p>åœ¨ä»£ç ä¸­è°ƒç”¨<code>reallocateMemory</code>æ–¹æ³•é‡æ–°åˆ†é…äº†ä¸€å— 8 å­—èŠ‚é•¿åº¦çš„å†…å­˜ç©ºé—´ï¼Œé€šè¿‡æ¯”è¾ƒ<code>addr</code>å’Œ<code>addr3</code>å¯ä»¥çœ‹åˆ°å’Œä¹‹å‰ç”³è¯·çš„å†…å­˜åœ°å€æ˜¯ä¸åŒçš„ã€‚åœ¨ä»£ç ä¸­çš„ç¬¬äºŒä¸ª for å¾ªç¯é‡Œï¼Œè°ƒç”¨<code>copyMemory</code>æ–¹æ³•è¿›è¡Œäº†ä¸¤æ¬¡å†…å­˜çš„æ‹·è´ï¼Œæ¯æ¬¡æ‹·è´å†…å­˜åœ°å€<code>addr</code>å¼€å§‹çš„ 4 ä¸ªå­—èŠ‚ï¼Œåˆ†åˆ«æ‹·è´åˆ°ä»¥<code>addr3</code>å’Œ<code>addr3+4</code>å¼€å§‹çš„å†…å­˜ç©ºé—´ä¸Šï¼š</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fseven97-blog.oss-cn-hangzhou.aliyuncs.com%2Fimgs%2F202406202130404.png" target="_blank" title="https://seven97-blog.oss-cn-hangzhou.aliyuncs.com/imgs/202406202130404.png" ref="nofollow noopener noreferrer"><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bf0021cd157244e8bc4857c7ee307703~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56We5aWH5bCP5rGk5ZyG:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771137203&amp;x-signature=cIfVZVovO11KHNXFn8iyfbYKmbU%3D" alt="" loading="lazy"/></a></p>
<p>æ‹·è´å®Œæˆåï¼Œä½¿ç”¨<code>getLong</code>æ–¹æ³•ä¸€æ¬¡æ€§è¯»å– 8 ä¸ªå­—èŠ‚ï¼Œå¾—åˆ°<code>long</code>ç±»å‹çš„å€¼ä¸º 72340172838076673ã€‚</p>
<p>éœ€è¦æ³¨æ„ï¼Œé€šè¿‡è¿™ç§æ–¹å¼åˆ†é…çš„å†…å­˜å±äº å †å¤–å†…å­˜ ï¼Œæ˜¯æ— æ³•è¿›è¡Œåƒåœ¾å›æ”¶çš„ï¼Œéœ€è¦æˆ‘ä»¬æŠŠè¿™äº›å†…å­˜å½“åšä¸€ç§èµ„æºå»æ‰‹åŠ¨è°ƒç”¨<code>freeMemory</code>æ–¹æ³•è¿›è¡Œé‡Šæ”¾ï¼Œå¦åˆ™ä¼šäº§ç”Ÿå†…å­˜æ³„æ¼ã€‚é€šç”¨çš„æ“ä½œå†…å­˜æ–¹å¼æ˜¯åœ¨<code>try</code>ä¸­æ‰§è¡Œå¯¹å†…å­˜çš„æ“ä½œï¼Œæœ€ç»ˆåœ¨<code>finally</code>å—ä¸­è¿›è¡Œå†…å­˜çš„é‡Šæ”¾ã€‚</p>
<p><strong>ä¸ºä»€ä¹ˆè¦ä½¿ç”¨å †å¤–å†…å­˜ï¼Ÿ</strong></p>
<ul>
<li>å¯¹åƒåœ¾å›æ”¶åœé¡¿çš„æ”¹å–„ã€‚ç”±äºå †å¤–å†…å­˜æ˜¯ç›´æ¥å—æ“ä½œç³»ç»Ÿç®¡ç†è€Œä¸æ˜¯ JVMï¼Œæ‰€ä»¥å½“æˆ‘ä»¬ä½¿ç”¨å †å¤–å†…å­˜æ—¶ï¼Œå³å¯ä¿æŒè¾ƒå°çš„å †å†…å†…å­˜è§„æ¨¡ã€‚ä»è€Œåœ¨ GC æ—¶å‡å°‘å›æ”¶åœé¡¿å¯¹äºåº”ç”¨çš„å½±å“ã€‚</li>
<li>æå‡ç¨‹åº I/O æ“ä½œçš„æ€§èƒ½ã€‚é€šå¸¸åœ¨ I/O é€šä¿¡è¿‡ç¨‹ä¸­ï¼Œä¼šå­˜åœ¨å †å†…å†…å­˜åˆ°å †å¤–å†…å­˜çš„æ•°æ®æ‹·è´æ“ä½œï¼Œå¯¹äºéœ€è¦é¢‘ç¹è¿›è¡Œå†…å­˜é—´æ•°æ®æ‹·è´ä¸”ç”Ÿå‘½å‘¨æœŸè¾ƒçŸ­çš„æš‚å­˜æ•°æ®ï¼Œéƒ½å»ºè®®å­˜å‚¨åˆ°å †å¤–å†…å­˜ã€‚</li>
</ul>
<h3 data-id="heading-3">å…¸å‹åº”ç”¨</h3>
<p><code>DirectByteBuffer</code>Â æ˜¯ Java ç”¨äºå®ç°å †å¤–å†…å­˜çš„ä¸€ä¸ªé‡è¦ç±»ï¼Œé€šå¸¸ç”¨åœ¨é€šä¿¡è¿‡ç¨‹ä¸­åšç¼“å†²æ± ï¼Œå¦‚åœ¨ Nettyã€MINA ç­‰ NIO æ¡†æ¶ä¸­åº”ç”¨å¹¿æ³›ã€‚<code>DirectByteBuffer</code>Â å¯¹äºå †å¤–å†…å­˜çš„åˆ›å»ºã€ä½¿ç”¨ã€é”€æ¯ç­‰é€»è¾‘å‡ç”± Unsafe æä¾›çš„å †å¤–å†…å­˜ API æ¥å®ç°ã€‚</p>
<p>ä¸‹å›¾ä¸ºÂ <code>DirectByteBuffer</code>Â æ„é€ å‡½æ•°ï¼Œåˆ›å»ºÂ <code>DirectByteBuffer</code>Â çš„æ—¶å€™ï¼Œé€šè¿‡Â <code>Unsafe.allocateMemory</code>Â åˆ†é…å†…å­˜ã€<code>Unsafe.setMemory</code>Â è¿›è¡Œå†…å­˜åˆå§‹åŒ–ï¼Œè€Œåæ„å»ºÂ <code>Cleaner</code>Â å¯¹è±¡ç”¨äºè·Ÿè¸ªÂ <code>DirectByteBuffer</code>Â å¯¹è±¡çš„åƒåœ¾å›æ”¶ï¼Œä»¥å®ç°å½“Â <code>DirectByteBuffer</code>Â è¢«åƒåœ¾å›æ”¶æ—¶ï¼Œåˆ†é…çš„å †å¤–å†…å­˜ä¸€èµ·è¢«é‡Šæ”¾ã€‚</p>
<p>java</p>
<pre><code class="hljs language-ini" lang="ini">DirectByteBuffer(int cap) {                   // package-private

    super(-1, 0, cap, cap)<span class="hljs-comment">;</span>
    boolean <span class="hljs-attr">pa</span> = VM.isDirectMemoryPageAligned()<span class="hljs-comment">;</span>
    int <span class="hljs-attr">ps</span> = Bits.pageSize()<span class="hljs-comment">;</span>
    long <span class="hljs-attr">size</span> = Math.max(<span class="hljs-number">1</span>L, (long)cap + (pa ? ps : <span class="hljs-number">0</span>))<span class="hljs-comment">;</span>
    Bits.reserveMemory(size, cap)<span class="hljs-comment">;</span>

    long <span class="hljs-attr">base</span> = <span class="hljs-number">0</span><span class="hljs-comment">;</span>
    try {
        // åˆ†é…å†…å­˜å¹¶è¿”å›åŸºåœ°å€
        <span class="hljs-attr">base</span> = unsafe.allocateMemory(size)<span class="hljs-comment">;</span>
    } catch (OutOfMemoryError x) {
        Bits.unreserveMemory(size, cap)<span class="hljs-comment">;</span>
        throw x<span class="hljs-comment">;</span>
    }
    // å†…å­˜åˆå§‹åŒ–
    unsafe.setMemory(base, size, (byte) 0)<span class="hljs-comment">;</span>
    if (pa &amp;&amp; (base % ps != 0)) {
        // Round up to page boundary
        <span class="hljs-attr">address</span> = base + ps - (base &amp; (ps - <span class="hljs-number">1</span>))<span class="hljs-comment">;</span>
    } else {
        <span class="hljs-attr">address</span> = base<span class="hljs-comment">;</span>
    }
    // è·Ÿè¸ª DirectByteBuffer å¯¹è±¡çš„åƒåœ¾å›æ”¶ï¼Œä»¥å®ç°å †å¤–å†…å­˜é‡Šæ”¾
    <span class="hljs-attr">cleaner</span> = Cleaner.create(this, new Deallocator(base, size, cap))<span class="hljs-comment">;</span>
    <span class="hljs-attr">att</span> = null<span class="hljs-comment">;</span>
}
</code></pre>
<h2 data-id="heading-4">å†…å­˜å±éšœ</h2>
<h3 data-id="heading-5">ä»‹ç»</h3>
<p>åœ¨ä»‹ç»å†…å­˜å±éšœå‰ï¼Œéœ€è¦çŸ¥é“ç¼–è¯‘å™¨å’Œ CPU ä¼šåœ¨ä¿è¯ç¨‹åºè¾“å‡ºç»“æœä¸€è‡´çš„æƒ…å†µä¸‹ï¼Œä¼šå¯¹ä»£ç è¿›è¡Œé‡æ’åºï¼Œä»æŒ‡ä»¤ä¼˜åŒ–è§’åº¦æå‡æ€§èƒ½ã€‚è€ŒæŒ‡ä»¤é‡æ’åºå¯èƒ½ä¼šå¸¦æ¥ä¸€ä¸ªä¸å¥½çš„ç»“æœï¼Œå¯¼è‡´ CPU çš„é«˜é€Ÿç¼“å­˜å’Œå†…å­˜ä¸­æ•°æ®çš„ä¸ä¸€è‡´ï¼Œè€Œå†…å­˜å±éšœï¼ˆ<code>Memory Barrier</code>ï¼‰å°±æ˜¯é€šè¿‡é˜»æ­¢å±éšœä¸¤è¾¹çš„æŒ‡ä»¤é‡æ’åºä»è€Œé¿å…ç¼–è¯‘å™¨å’Œç¡¬ä»¶çš„ä¸æ­£ç¡®ä¼˜åŒ–æƒ…å†µã€‚</p>
<p>åœ¨ç¡¬ä»¶å±‚é¢ä¸Šï¼Œå†…å­˜å±éšœæ˜¯ CPU ä¸ºäº†é˜²æ­¢ä»£ç è¿›è¡Œé‡æ’åºè€Œæä¾›çš„æŒ‡ä»¤ï¼Œä¸åŒçš„ç¡¬ä»¶å¹³å°ä¸Šå®ç°å†…å­˜å±éšœçš„æ–¹æ³•å¯èƒ½å¹¶ä¸ç›¸åŒã€‚åœ¨ Java8 ä¸­ï¼Œå¼•å…¥äº† 3 ä¸ªå†…å­˜å±éšœçš„å‡½æ•°ï¼Œå®ƒå±è”½äº†æ“ä½œç³»ç»Ÿåº•å±‚çš„å·®å¼‚ï¼Œå…è®¸åœ¨ä»£ç ä¸­å®šä¹‰ã€å¹¶ç»Ÿä¸€ç”± JVM æ¥ç”Ÿæˆå†…å­˜å±éšœæŒ‡ä»¤ï¼Œæ¥å®ç°å†…å­˜å±éšœçš„åŠŸèƒ½ã€‚</p>
<p><code>Unsafe</code>Â ä¸­æä¾›äº†ä¸‹é¢ä¸‰ä¸ªå†…å­˜å±éšœç›¸å…³æ–¹æ³•ï¼š</p>
<p>java</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-comment">//å†…å­˜å±éšœï¼Œç¦æ­¢loadæ“ä½œé‡æ’åºã€‚å±éšœå‰çš„loadæ“ä½œä¸èƒ½è¢«é‡æ’åºåˆ°å±éšœåï¼Œå±éšœåçš„loadæ“ä½œä¸èƒ½è¢«é‡æ’åºåˆ°å±éšœå‰</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> native <span class="hljs-keyword">void</span> <span class="hljs-title">loadFence</span>()</span>;
<span class="hljs-comment">//å†…å­˜å±éšœï¼Œç¦æ­¢storeæ“ä½œé‡æ’åºã€‚å±éšœå‰çš„storeæ“ä½œä¸èƒ½è¢«é‡æ’åºåˆ°å±éšœåï¼Œå±éšœåçš„storeæ“ä½œä¸èƒ½è¢«é‡æ’åºåˆ°å±éšœå‰</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> native <span class="hljs-keyword">void</span> <span class="hljs-title">storeFence</span>()</span>;
<span class="hljs-comment">//å†…å­˜å±éšœï¼Œç¦æ­¢loadã€storeæ“ä½œé‡æ’åº</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> native <span class="hljs-keyword">void</span> <span class="hljs-title">fullFence</span>()</span>;
</code></pre>
<p>å†…å­˜å±éšœå¯ä»¥çœ‹åšå¯¹å†…å­˜éšæœºè®¿é—®çš„æ“ä½œä¸­çš„ä¸€ä¸ªåŒæ­¥ç‚¹ï¼Œä½¿å¾—æ­¤ç‚¹ä¹‹å‰çš„æ‰€æœ‰è¯»å†™æ“ä½œéƒ½æ‰§è¡Œåæ‰å¯ä»¥å¼€å§‹æ‰§è¡Œæ­¤ç‚¹ä¹‹åçš„æ“ä½œã€‚ä»¥<code>loadFence</code>æ–¹æ³•ä¸ºä¾‹ï¼Œå®ƒä¼šç¦æ­¢è¯»æ“ä½œé‡æ’åºï¼Œä¿è¯åœ¨è¿™ä¸ªå±éšœä¹‹å‰çš„æ‰€æœ‰è¯»æ“ä½œéƒ½å·²ç»å®Œæˆï¼Œå¹¶ä¸”å°†ç¼“å­˜æ•°æ®è®¾ä¸ºæ— æ•ˆï¼Œé‡æ–°ä»ä¸»å­˜ä¸­è¿›è¡ŒåŠ è½½ã€‚</p>
<p>çœ‹åˆ°è¿™ä¼°è®¡å¾ˆå¤šå°ä¼™ä¼´ä»¬ä¼šæƒ³åˆ°<code>volatile</code>å…³é”®å­—äº†ï¼Œå¦‚æœåœ¨å­—æ®µä¸Šæ·»åŠ äº†<code>volatile</code>å…³é”®å­—ï¼Œå°±èƒ½å¤Ÿå®ç°å­—æ®µåœ¨å¤šçº¿ç¨‹ä¸‹çš„å¯è§æ€§ã€‚åŸºäºè¯»å†…å­˜å±éšœï¼Œæˆ‘ä»¬ä¹Ÿèƒ½å®ç°ç›¸åŒçš„åŠŸèƒ½ã€‚ä¸‹é¢å®šä¹‰ä¸€ä¸ªçº¿ç¨‹æ–¹æ³•ï¼Œåœ¨çº¿ç¨‹ä¸­å»ä¿®æ”¹<code>flag</code>æ ‡å¿—ä½ï¼Œæ³¨æ„è¿™é‡Œçš„<code>flag</code>æ˜¯æ²¡æœ‰è¢«<code>volatile</code>ä¿®é¥°çš„ï¼š</p>
<p>java</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-meta">@Getter</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">ChangeThread</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Runnable</span>{
    <span class="hljs-comment">/**volatile**/</span> <span class="hljs-built_in">boolean</span> flag=<span class="hljs-literal">false</span>;
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">run</span>(<span class="hljs-params"/>) {
        <span class="hljs-keyword">try</span> {
            <span class="hljs-title class_">Thread</span>.<span class="hljs-title function_">sleep</span>(<span class="hljs-number">3000</span>);
        } <span class="hljs-keyword">catch</span> (<span class="hljs-title class_">InterruptedException</span> e) {
            e.<span class="hljs-title function_">printStackTrace</span>();
        }
        <span class="hljs-title class_">System</span>.<span class="hljs-property">out</span>.<span class="hljs-title function_">println</span>(<span class="hljs-string">"subThread change flag to:"</span> + flag);
        flag = <span class="hljs-literal">true</span>;
    }
}
</code></pre>
<p>åœ¨ä¸»çº¿ç¨‹çš„<code>while</code>å¾ªç¯ä¸­ï¼ŒåŠ å…¥å†…å­˜å±éšœï¼Œæµ‹è¯•æ˜¯å¦èƒ½å¤Ÿæ„ŸçŸ¥åˆ°<code>flag</code>çš„ä¿®æ”¹å˜åŒ–ï¼š</p>
<p>java</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span>(<span class="hljs-params">String[] args</span>)</span>{
    ChangeThread changeThread = <span class="hljs-keyword">new</span> ChangeThread();
    <span class="hljs-keyword">new</span> Thread(changeThread).start();
    <span class="hljs-keyword">while</span> (<span class="hljs-literal">true</span>) {
        boolean flag = changeThread.isFlag();
        <span class="hljs-keyword">unsafe</span>.loadFence(); <span class="hljs-comment">//åŠ å…¥è¯»å†…å­˜å±éšœ</span>
        <span class="hljs-keyword">if</span> (flag){
            System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">"detected flag changed"</span>);
            <span class="hljs-keyword">break</span>;
        }
    }
    System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">"main thread end"</span>);
}
</code></pre>
<p>è¿è¡Œç»“æœï¼š</p>
<p>plain</p>
<pre><code class="hljs language-arduino" lang="arduino">subThread change flag to:<span class="hljs-literal">false</span>
detected flag changed
main thread end
</code></pre>
<p>è€Œå¦‚æœåˆ æ‰ä¸Šé¢ä»£ç ä¸­çš„<code>loadFence</code>æ–¹æ³•ï¼Œé‚£ä¹ˆä¸»çº¿ç¨‹å°†æ— æ³•æ„ŸçŸ¥åˆ°<code>flag</code>å‘ç”Ÿçš„å˜åŒ–ï¼Œä¼šä¸€ç›´åœ¨<code>while</code>ä¸­å¾ªç¯ã€‚å¯ä»¥ç”¨å›¾æ¥è¡¨ç¤ºä¸Šé¢çš„è¿‡ç¨‹ï¼š</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fp0-xtjj-private.juejin.cn%2Ftos-cn-i-73owjymdk6%2Ff320a294eacd4789a072b1f71e541406~tplv-73owjymdk6-jj-mark-v1%3A0%3A0%3A0%3A0%3A5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56We5aWH5bCP5rGk5ZyG%3Aq75.awebp%3Fpolicy%3DeyJ2bSI6MywidWlkIjoiMTE1MTk0MzkxOTI4NTQzMSJ9%26rk3s%3De9ecf3d6%26x-orig-authkey%3Df32326d3454f2ac7e96d3d06cdbb035152127018%26x-orig-expires%3D1770618790%26x-orig-sign%3DdYNDmbPY7ht9OLvDS82flYbnOis%253D" target="_blank" title="https://p0-xtjj-private.juejin.cn/tos-cn-i-73owjymdk6/f320a294eacd4789a072b1f71e541406~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56We5aWH5bCP5rGk5ZyG:q75.awebp?policy=eyJ2bSI6MywidWlkIjoiMTE1MTk0MzkxOTI4NTQzMSJ9&amp;rk3s=e9ecf3d6&amp;x-orig-authkey=f32326d3454f2ac7e96d3d06cdbb035152127018&amp;x-orig-expires=1770618790&amp;x-orig-sign=dYNDmbPY7ht9OLvDS82flYbnOis%3D" ref="nofollow noopener noreferrer"><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fba0241f9bb84ff29959034d18ae368e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56We5aWH5bCP5rGk5ZyG:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771137203&amp;x-signature=nxiCNFJoxs6yyGp8MgE%2FB66dFiA%3D" alt="" loading="lazy"/></a></p>
<p>äº†è§£ Java å†…å­˜æ¨¡å‹ï¼ˆ<code>JMM</code>ï¼‰çš„å°ä¼™ä¼´ä»¬åº”è¯¥æ¸…æ¥šï¼Œè¿è¡Œä¸­çš„çº¿ç¨‹ä¸æ˜¯ç›´æ¥è¯»å–ä¸»å†…å­˜ä¸­çš„å˜é‡çš„ï¼Œåªèƒ½æ“ä½œè‡ªå·±å·¥ä½œå†…å­˜ä¸­çš„å˜é‡ï¼Œç„¶ååŒæ­¥åˆ°ä¸»å†…å­˜ä¸­ï¼Œå¹¶ä¸”çº¿ç¨‹çš„å·¥ä½œå†…å­˜æ˜¯ä¸èƒ½å…±äº«çš„ã€‚ä¸Šé¢çš„å›¾ä¸­çš„æµç¨‹å°±æ˜¯å­çº¿ç¨‹å€ŸåŠ©äºä¸»å†…å­˜ï¼Œå°†ä¿®æ”¹åçš„ç»“æœåŒæ­¥ç»™äº†ä¸»çº¿ç¨‹ï¼Œè¿›è€Œä¿®æ”¹ä¸»çº¿ç¨‹ä¸­çš„å·¥ä½œç©ºé—´ï¼Œè·³å‡ºå¾ªç¯ã€‚</p>
<h3 data-id="heading-6">å…¸å‹åº”ç”¨</h3>
<p>åœ¨ Java 8 ä¸­å¼•å…¥äº†ä¸€ç§é”çš„æ–°æœºåˆ¶â€”â€”<code>StampedLock</code>ï¼Œå®ƒå¯ä»¥çœ‹æˆæ˜¯è¯»å†™é”çš„ä¸€ä¸ªæ”¹è¿›ç‰ˆæœ¬ã€‚<code>StampedLock</code>Â æä¾›äº†ä¸€ç§ä¹è§‚è¯»é”çš„å®ç°ï¼Œè¿™ç§ä¹è§‚è¯»é”ç±»ä¼¼äºæ— é”çš„æ“ä½œï¼Œå®Œå…¨ä¸ä¼šé˜»å¡å†™çº¿ç¨‹è·å–å†™é”ï¼Œä»è€Œç¼“è§£è¯»å¤šå†™å°‘æ—¶å†™çº¿ç¨‹â€œé¥¥é¥¿â€ç°è±¡ã€‚ç”±äºÂ <code>StampedLock</code>Â æä¾›çš„ä¹è§‚è¯»é”ä¸é˜»å¡å†™çº¿ç¨‹è·å–è¯»é”ï¼Œå½“çº¿ç¨‹å…±äº«å˜é‡ä»ä¸»å†…å­˜ load åˆ°çº¿ç¨‹å·¥ä½œå†…å­˜æ—¶ï¼Œä¼šå­˜åœ¨æ•°æ®ä¸ä¸€è‡´é—®é¢˜ã€‚</p>
<p>ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œ<code>StampedLock</code>Â çš„Â <code>validate</code>Â æ–¹æ³•ä¼šé€šè¿‡Â <code>Unsafe</code>Â çš„Â <code>loadFence</code>Â æ–¹æ³•åŠ å…¥ä¸€ä¸ªÂ <code>load</code>Â å†…å­˜å±éšœã€‚</p>
<p>java</p>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title">validate</span><span class="hljs-params">(<span class="hljs-type">long</span> stamp)</span> </span>{
   U.<span class="hljs-built_in">loadFence</span>();
   <span class="hljs-keyword">return</span> (stamp &amp; SBITS) == (state &amp; SBITS);
}
</code></pre>
<h2 data-id="heading-7">å¯¹è±¡æ“ä½œ</h2>
<h3 data-id="heading-8">ä»‹ç»</h3>
<p><strong>ä¾‹å­</strong></p>
<p>java</p>
<pre><code class="hljs language-csharp" lang="csharp">import sun.misc.Unsafe;
import java.lang.reflect.Field;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">Main</span> {

    <span class="hljs-keyword">private</span> <span class="hljs-built_in">int</span> <span class="hljs-keyword">value</span>;

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span>(<span class="hljs-params">String[] args</span>) throws Exception</span>{
        Unsafe <span class="hljs-keyword">unsafe</span> = reflectGetUnsafe();
        assert <span class="hljs-keyword">unsafe</span> != <span class="hljs-literal">null</span>;
        <span class="hljs-built_in">long</span> offset = <span class="hljs-keyword">unsafe</span>.objectFieldOffset(Main.<span class="hljs-keyword">class</span>.getDeclaredField(<span class="hljs-string">"value"</span>));
        Main main = <span class="hljs-keyword">new</span> Main();
        System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">"value before putInt: "</span> + main.<span class="hljs-keyword">value</span>);
        <span class="hljs-keyword">unsafe</span>.putInt(main, offset, <span class="hljs-number">42</span>);
        System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">"value after putInt: "</span> + main.<span class="hljs-keyword">value</span>);
  System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">"value after putInt: "</span> + <span class="hljs-keyword">unsafe</span>.getInt(main, offset));
    }

    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> Unsafe <span class="hljs-title">reflectGetUnsafe</span>()</span> {
        <span class="hljs-keyword">try</span> {
            Field field = Unsafe.<span class="hljs-keyword">class</span>.getDeclaredField(<span class="hljs-string">"theUnsafe"</span>);
            field.setAccessible(<span class="hljs-literal">true</span>);
            <span class="hljs-keyword">return</span> (Unsafe) field.<span class="hljs-keyword">get</span>(<span class="hljs-literal">null</span>);
        } <span class="hljs-keyword">catch</span> (Exception e) {
            e.printStackTrace();
            <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
        }
    }

}
</code></pre>
<p>è¾“å‡ºç»“æœï¼š</p>
<p>plain</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">value before putInt:</span> <span class="hljs-number">0</span>
<span class="hljs-attr">value after putInt:</span> <span class="hljs-number">42</span>
<span class="hljs-attr">value after putInt:</span> <span class="hljs-number">42</span>
</code></pre>
<p><strong>å¯¹è±¡å±æ€§</strong></p>
<p>å¯¹è±¡æˆå‘˜å±æ€§çš„å†…å­˜åç§»é‡è·å–ï¼Œä»¥åŠå­—æ®µå±æ€§å€¼çš„ä¿®æ”¹ï¼Œåœ¨ä¸Šé¢çš„ä¾‹å­ä¸­æˆ‘ä»¬å·²ç»æµ‹è¯•è¿‡äº†ã€‚é™¤äº†å‰é¢çš„<code>putInt</code>ã€<code>getInt</code>æ–¹æ³•å¤–ï¼ŒUnsafe æä¾›äº†å…¨éƒ¨ 8 ç§åŸºç¡€æ•°æ®ç±»å‹ä»¥åŠ<code>Object</code>çš„<code>put</code>å’Œ<code>get</code>æ–¹æ³•ï¼Œå¹¶ä¸”æ‰€æœ‰çš„<code>put</code>æ–¹æ³•éƒ½å¯ä»¥è¶Šè¿‡è®¿é—®æƒé™ï¼Œç›´æ¥ä¿®æ”¹å†…å­˜ä¸­çš„æ•°æ®ã€‚é˜…è¯» openJDK æºç ä¸­çš„æ³¨é‡Šå‘ç°ï¼ŒåŸºç¡€æ•°æ®ç±»å‹å’Œ<code>Object</code>çš„è¯»å†™ç¨æœ‰ä¸åŒï¼ŒåŸºç¡€æ•°æ®ç±»å‹æ˜¯ç›´æ¥æ“ä½œçš„å±æ€§å€¼ï¼ˆ<code>value</code>ï¼‰ï¼Œè€Œ<code>Object</code>çš„æ“ä½œåˆ™æ˜¯åŸºäºå¼•ç”¨å€¼ï¼ˆ<code>reference value</code>ï¼‰ã€‚ä¸‹é¢æ˜¯<code>Object</code>çš„è¯»å†™æ–¹æ³•ï¼š</p>
<p>java</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">//åœ¨å¯¹è±¡çš„æŒ‡å®šåç§»åœ°å€è·å–ä¸€ä¸ªå¯¹è±¡å¼•ç”¨</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">native</span> Object <span class="hljs-title function_">getObject</span><span class="hljs-params">(Object o, <span class="hljs-type">long</span> offset)</span>;
<span class="hljs-comment">//åœ¨å¯¹è±¡æŒ‡å®šåç§»åœ°å€å†™å…¥ä¸€ä¸ªå¯¹è±¡å¼•ç”¨</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">native</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">putObject</span><span class="hljs-params">(Object o, <span class="hljs-type">long</span> offset, Object x)</span>;
</code></pre>
<p>é™¤äº†å¯¹è±¡å±æ€§çš„æ™®é€šè¯»å†™å¤–ï¼Œ<code>Unsafe</code>Â è¿˜æä¾›äº†Â <strong>volatile è¯»å†™</strong>å’Œ<strong>æœ‰åºå†™å…¥</strong>æ–¹æ³•ã€‚<code>volatile</code>è¯»å†™æ–¹æ³•çš„è¦†ç›–èŒƒå›´ä¸æ™®é€šè¯»å†™ç›¸åŒï¼ŒåŒ…å«äº†å…¨éƒ¨åŸºç¡€æ•°æ®ç±»å‹å’Œ<code>Object</code>ç±»å‹ï¼Œä»¥<code>int</code>ç±»å‹ä¸ºä¾‹ï¼š</p>
<p>java</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">//åœ¨å¯¹è±¡çš„æŒ‡å®šåç§»åœ°å€å¤„è¯»å–ä¸€ä¸ªintå€¼ï¼Œæ”¯æŒvolatile loadè¯­ä¹‰</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">native</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getIntVolatile</span><span class="hljs-params">(Object o, <span class="hljs-type">long</span> offset)</span>;
<span class="hljs-comment">//åœ¨å¯¹è±¡æŒ‡å®šåç§»åœ°å€å¤„å†™å…¥ä¸€ä¸ªintï¼Œæ”¯æŒvolatile storeè¯­ä¹‰</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">native</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">putIntVolatile</span><span class="hljs-params">(Object o, <span class="hljs-type">long</span> offset, <span class="hljs-type">int</span> x)</span>;
</code></pre>
<p>ç›¸å¯¹äºæ™®é€šè¯»å†™æ¥è¯´ï¼Œ<code>volatile</code>è¯»å†™å…·æœ‰æ›´é«˜çš„æˆæœ¬ï¼Œå› ä¸ºå®ƒéœ€è¦ä¿è¯å¯è§æ€§å’Œæœ‰åºæ€§ã€‚åœ¨æ‰§è¡Œ<code>get</code>æ“ä½œæ—¶ï¼Œä¼šå¼ºåˆ¶ä»ä¸»å­˜ä¸­è·å–å±æ€§å€¼ï¼Œåœ¨ä½¿ç”¨<code>put</code>æ–¹æ³•è®¾ç½®å±æ€§å€¼æ—¶ï¼Œä¼šå¼ºåˆ¶å°†å€¼æ›´æ–°åˆ°ä¸»å­˜ä¸­ï¼Œä»è€Œä¿è¯è¿™äº›å˜æ›´å¯¹å…¶ä»–çº¿ç¨‹æ˜¯å¯è§çš„ã€‚</p>
<p>æœ‰åºå†™å…¥çš„æ–¹æ³•æœ‰ä»¥ä¸‹ä¸‰ä¸ªï¼š</p>
<p>java</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">native</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">putOrderedObject</span><span class="hljs-params">(Object o, <span class="hljs-type">long</span> offset, Object x)</span>;
<span class="hljs-keyword">public</span> <span class="hljs-keyword">native</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">putOrderedInt</span><span class="hljs-params">(Object o, <span class="hljs-type">long</span> offset, <span class="hljs-type">int</span> x)</span>;
<span class="hljs-keyword">public</span> <span class="hljs-keyword">native</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">putOrderedLong</span><span class="hljs-params">(Object o, <span class="hljs-type">long</span> offset, <span class="hljs-type">long</span> x)</span>;
</code></pre>
<p>æœ‰åºå†™å…¥çš„æˆæœ¬ç›¸å¯¹<code>volatile</code>è¾ƒä½ï¼Œå› ä¸ºå®ƒåªä¿è¯å†™å…¥æ—¶çš„æœ‰åºæ€§ï¼Œè€Œä¸ä¿è¯å¯è§æ€§ï¼Œä¹Ÿå°±æ˜¯ä¸€ä¸ªçº¿ç¨‹å†™å…¥çš„å€¼ä¸èƒ½ä¿è¯å…¶ä»–çº¿ç¨‹ç«‹å³å¯è§ã€‚ä¸ºäº†è§£å†³è¿™é‡Œçš„å·®å¼‚æ€§ï¼Œéœ€è¦å¯¹å†…å­˜å±éšœçš„çŸ¥è¯†ç‚¹å†è¿›ä¸€æ­¥è¿›è¡Œè¡¥å……ï¼Œé¦–å…ˆéœ€è¦äº†è§£ä¸¤ä¸ªæŒ‡ä»¤çš„æ¦‚å¿µï¼š</p>
<ul>
<li><code>Load</code>ï¼šå°†ä¸»å†…å­˜ä¸­çš„æ•°æ®æ‹·è´åˆ°å¤„ç†å™¨çš„ç¼“å­˜ä¸­</li>
<li><code>Store</code>ï¼šå°†å¤„ç†å™¨ç¼“å­˜çš„æ•°æ®åˆ·æ–°åˆ°ä¸»å†…å­˜ä¸­</li>
</ul>
<p>é¡ºåºå†™å…¥ä¸<code>volatile</code>å†™å…¥çš„å·®åˆ«åœ¨äºï¼Œåœ¨é¡ºåºå†™æ—¶åŠ å…¥çš„å†…å­˜å±éšœç±»å‹ä¸º<code>StoreStore</code>ç±»å‹ï¼Œè€Œåœ¨<code>volatile</code>å†™å…¥æ—¶åŠ å…¥çš„å†…å­˜å±éšœæ˜¯<code>StoreLoad</code>ç±»å‹ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fseven97-blog.oss-cn-hangzhou.aliyuncs.com%2Fimgs%2F202406202130467.png" target="_blank" title="https://seven97-blog.oss-cn-hangzhou.aliyuncs.com/imgs/202406202130467.png" ref="nofollow noopener noreferrer"><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3ffdc3b0cb1944029747a07cca8f7381~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56We5aWH5bCP5rGk5ZyG:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771137203&amp;x-signature=pAvU2CZVAAqKxOeTX9A%2FCZ5aJB8%3D" alt="" loading="lazy"/></a></p>
<p>åœ¨æœ‰åºå†™å…¥æ–¹æ³•ä¸­ï¼Œä½¿ç”¨çš„æ˜¯<code>StoreStore</code>å±éšœï¼Œè¯¥å±éšœç¡®ä¿<code>Store1</code>ç«‹åˆ»åˆ·æ–°æ•°æ®åˆ°å†…å­˜ï¼Œè¿™ä¸€æ“ä½œå…ˆäº<code>Store2</code>ä»¥åŠåç»­çš„å­˜å‚¨æŒ‡ä»¤æ“ä½œã€‚è€Œåœ¨<code>volatile</code>å†™å…¥ä¸­ï¼Œä½¿ç”¨çš„æ˜¯<code>StoreLoad</code>å±éšœï¼Œè¯¥å±éšœç¡®ä¿<code>Store1</code>ç«‹åˆ»åˆ·æ–°æ•°æ®åˆ°å†…å­˜ï¼Œè¿™ä¸€æ“ä½œå…ˆäº<code>Load2</code>åŠåç»­çš„è£…è½½æŒ‡ä»¤ï¼Œå¹¶ä¸”ï¼Œ<code>StoreLoad</code>å±éšœä¼šä½¿è¯¥å±éšœä¹‹å‰çš„æ‰€æœ‰å†…å­˜è®¿é—®æŒ‡ä»¤ï¼ŒåŒ…æ‹¬å­˜å‚¨æŒ‡ä»¤å’Œè®¿é—®æŒ‡ä»¤å…¨éƒ¨å®Œæˆä¹‹åï¼Œæ‰æ‰§è¡Œè¯¥å±éšœä¹‹åçš„å†…å­˜è®¿é—®æŒ‡ä»¤ã€‚</p>
<p>ç»¼ä¸Šæ‰€è¿°ï¼Œåœ¨ä¸Šé¢çš„ä¸‰ç±»å†™å…¥æ–¹æ³•ä¸­ï¼Œåœ¨å†™å…¥æ•ˆç‡æ–¹é¢ï¼ŒæŒ‰ç…§<code>put</code>ã€<code>putOrder</code>ã€<code>putVolatile</code>çš„é¡ºåºæ•ˆç‡é€æ¸é™ä½ã€‚</p>
<p><strong>å¯¹è±¡å®ä¾‹åŒ–</strong></p>
<p>ä½¿ç”¨Â <code>Unsafe</code>Â çš„Â <code>allocateInstance</code>Â æ–¹æ³•ï¼Œå…è®¸æˆ‘ä»¬ä½¿ç”¨éå¸¸è§„çš„æ–¹å¼è¿›è¡Œå¯¹è±¡çš„å®ä¾‹åŒ–ï¼Œé¦–å…ˆå®šä¹‰ä¸€ä¸ªå®ä½“ç±»ï¼Œå¹¶ä¸”åœ¨æ„é€ å‡½æ•°ä¸­å¯¹å…¶æˆå‘˜å˜é‡è¿›è¡Œèµ‹å€¼æ“ä½œï¼š</p>
<p>java</p>
<pre><code class="hljs language-csharp" lang="csharp">@Data
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">A</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-built_in">int</span> b;
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">A</span>()</span>{
        <span class="hljs-keyword">this</span>.b =<span class="hljs-number">1</span>;
    }
}
</code></pre>
<p>åˆ†åˆ«åŸºäºæ„é€ å‡½æ•°ã€åå°„ä»¥åŠÂ <code>Unsafe</code>Â æ–¹æ³•çš„ä¸åŒæ–¹å¼åˆ›å»ºå¯¹è±¡è¿›è¡Œæ¯”è¾ƒï¼š</p>
<p>java</p>
<pre><code class="hljs language-ini" lang="ini">public void objTest() throws Exception{
    A <span class="hljs-attr">a1</span>=new A()<span class="hljs-comment">;</span>
    System.out.println(a1.getB())<span class="hljs-comment">;</span>
    A <span class="hljs-attr">a2</span> = A.class.newInstance()<span class="hljs-comment">;</span>
    System.out.println(a2.getB())<span class="hljs-comment">;</span>
    A <span class="hljs-attr">a3</span>= (A) unsafe.allocateInstance(A.class)<span class="hljs-comment">;</span>
    System.out.println(a3.getB())<span class="hljs-comment">;</span>
}
</code></pre>
<p>æ‰“å°ç»“æœåˆ†åˆ«ä¸º 1ã€1ã€0ï¼Œè¯´æ˜é€šè¿‡<code>allocateInstance</code>æ–¹æ³•åˆ›å»ºå¯¹è±¡è¿‡ç¨‹ä¸­ï¼Œä¸ä¼šè°ƒç”¨ç±»çš„æ„é€ æ–¹æ³•ã€‚ä½¿ç”¨è¿™ç§æ–¹å¼åˆ›å»ºå¯¹è±¡æ—¶ï¼Œåªç”¨åˆ°äº†<code>Class</code>å¯¹è±¡ï¼Œæ‰€ä»¥è¯´å¦‚æœæƒ³è¦è·³è¿‡å¯¹è±¡çš„åˆå§‹åŒ–é˜¶æ®µæˆ–è€…è·³è¿‡æ„é€ å™¨çš„å®‰å…¨æ£€æŸ¥ï¼Œå°±å¯ä»¥ä½¿ç”¨è¿™ç§æ–¹æ³•ã€‚åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œå¦‚æœå°† A ç±»çš„æ„é€ å‡½æ•°æ”¹ä¸º<code>private</code>ç±»å‹ï¼Œå°†æ— æ³•é€šè¿‡æ„é€ å‡½æ•°å’Œåå°„åˆ›å»ºå¯¹è±¡ï¼ˆå¯ä»¥é€šè¿‡æ„é€ å‡½æ•°å¯¹è±¡ setAccessible ååˆ›å»ºå¯¹è±¡ï¼‰ï¼Œä½†<code>allocateInstance</code>æ–¹æ³•ä»ç„¶æœ‰æ•ˆã€‚</p>
<h3 data-id="heading-9">å…¸å‹åº”ç”¨</h3>
<ul>
<li><strong>å¸¸è§„å¯¹è±¡å®ä¾‹åŒ–æ–¹å¼</strong>ï¼šæˆ‘ä»¬é€šå¸¸æ‰€ç”¨åˆ°çš„åˆ›å»ºå¯¹è±¡çš„æ–¹å¼ï¼Œä»æœ¬è´¨ä¸Šæ¥è®²ï¼Œéƒ½æ˜¯é€šè¿‡ new æœºåˆ¶æ¥å®ç°å¯¹è±¡çš„åˆ›å»ºã€‚ä½†æ˜¯ï¼Œnew æœºåˆ¶æœ‰ä¸ªç‰¹ç‚¹å°±æ˜¯å½“ç±»åªæä¾›æœ‰å‚çš„æ„é€ å‡½æ•°ä¸”æ— æ˜¾ç¤ºå£°æ˜æ— å‚æ„é€ å‡½æ•°æ—¶ï¼Œåˆ™å¿…é¡»ä½¿ç”¨æœ‰å‚æ„é€ å‡½æ•°è¿›è¡Œå¯¹è±¡æ„é€ ï¼Œè€Œä½¿ç”¨æœ‰å‚æ„é€ å‡½æ•°æ—¶ï¼Œå¿…é¡»ä¼ é€’ç›¸åº”ä¸ªæ•°çš„å‚æ•°æ‰èƒ½å®Œæˆå¯¹è±¡å®ä¾‹åŒ–ã€‚</li>
<li><strong>éå¸¸è§„çš„å®ä¾‹åŒ–æ–¹å¼</strong>ï¼šè€Œ Unsafe ä¸­æä¾› allocateInstance æ–¹æ³•ï¼Œä»…é€šè¿‡ Class å¯¹è±¡å°±å¯ä»¥åˆ›å»ºæ­¤ç±»çš„å®ä¾‹å¯¹è±¡ï¼Œè€Œä¸”ä¸éœ€è¦è°ƒç”¨å…¶æ„é€ å‡½æ•°ã€åˆå§‹åŒ–ä»£ç ã€JVM å®‰å…¨æ£€æŸ¥ç­‰ã€‚å®ƒæŠ‘åˆ¶ä¿®é¥°ç¬¦æ£€æµ‹ï¼Œä¹Ÿå°±æ˜¯å³ä½¿æ„é€ å™¨æ˜¯ private ä¿®é¥°çš„ä¹Ÿèƒ½é€šè¿‡æ­¤æ–¹æ³•å®ä¾‹åŒ–ï¼Œåªéœ€æç±»å¯¹è±¡å³å¯åˆ›å»ºç›¸åº”çš„å¯¹è±¡ã€‚ç”±äºè¿™ç§ç‰¹æ€§ï¼ŒallocateInstance åœ¨ java.lang.invokeã€Objenesisï¼ˆæä¾›ç»•è¿‡ç±»æ„é€ å™¨çš„å¯¹è±¡ç”Ÿæˆæ–¹å¼ï¼‰ã€Gsonï¼ˆååºåˆ—åŒ–æ—¶ç”¨åˆ°ï¼‰ä¸­éƒ½æœ‰ç›¸åº”çš„åº”ç”¨ã€‚</li>
</ul>
<h2 data-id="heading-10">æ•°ç»„æ“ä½œ</h2>
<h3 data-id="heading-11">ä»‹ç»</h3>
<p><code>arrayBaseOffset</code>Â ä¸Â <code>arrayIndexScale</code>Â è¿™ä¸¤ä¸ªæ–¹æ³•é…åˆèµ·æ¥ä½¿ç”¨ï¼Œå³å¯å®šä½æ•°ç»„ä¸­æ¯ä¸ªå…ƒç´ åœ¨å†…å­˜ä¸­çš„ä½ç½®ã€‚</p>
<p>java</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">//è¿”å›æ•°ç»„ä¸­ç¬¬ä¸€ä¸ªå…ƒç´ çš„åç§»åœ°å€</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">native</span> <span class="hljs-type">int</span> <span class="hljs-title function_">arrayBaseOffset</span><span class="hljs-params">(Class&lt;?&gt; arrayClass)</span>;
<span class="hljs-comment">//è¿”å›æ•°ç»„ä¸­ä¸€ä¸ªå…ƒç´ å ç”¨çš„å¤§å°</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">native</span> <span class="hljs-type">int</span> <span class="hljs-title function_">arrayIndexScale</span><span class="hljs-params">(Class&lt;?&gt; arrayClass)</span>;
</code></pre>
<h3 data-id="heading-12">å…¸å‹åº”ç”¨</h3>
<p>è¿™ä¸¤ä¸ªä¸æ•°æ®æ“ä½œç›¸å…³çš„æ–¹æ³•ï¼Œåœ¨Â <code>java.util.concurrent.atomic</code>Â åŒ…ä¸‹çš„Â <code>AtomicIntegerArray</code>ï¼ˆå¯ä»¥å®ç°å¯¹Â <code>Integer</code>Â æ•°ç»„ä¸­æ¯ä¸ªå…ƒç´ çš„åŸå­æ€§æ“ä½œï¼‰ä¸­æœ‰å…¸å‹çš„åº”ç”¨ï¼Œå¦‚ä¸‹å›¾Â <code>AtomicIntegerArray</code>Â æºç æ‰€ç¤ºï¼Œé€šè¿‡Â <code>Unsafe</code>Â çš„Â <code>arrayBaseOffset</code>ã€<code>arrayIndexScale</code>Â åˆ†åˆ«è·å–æ•°ç»„é¦–å…ƒç´ çš„åç§»åœ°å€Â <code>base</code>Â åŠå•ä¸ªå…ƒç´ å¤§å°å› å­Â <code>scale</code>Â ã€‚åç»­ç›¸å…³åŸå­æ€§æ“ä½œï¼Œå‡ä¾èµ–äºè¿™ä¸¤ä¸ªå€¼è¿›è¡Œæ•°ç»„ä¸­å…ƒç´ çš„å®šä½ï¼Œå¦‚ä¸‹å›¾äºŒæ‰€ç¤ºçš„Â <code>getAndAdd</code>Â æ–¹æ³•å³é€šè¿‡Â <code>checkedByteOffset</code>Â æ–¹æ³•è·å–æŸæ•°ç»„å…ƒç´ çš„åç§»åœ°å€ï¼Œè€Œåé€šè¿‡ CAS å®ç°åŸå­æ€§æ“ä½œã€‚</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fseven97-blog.oss-cn-hangzhou.aliyuncs.com%2Fimgs%2F202406202130522.png" target="_blank" title="https://seven97-blog.oss-cn-hangzhou.aliyuncs.com/imgs/202406202130522.png" ref="nofollow noopener noreferrer"><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e11d8699d0e348dab3f81b341301441c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56We5aWH5bCP5rGk5ZyG:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771137203&amp;x-signature=wEVeqZomJ856PftogdC%2FATMiFJw%3D" alt="" loading="lazy"/></a></p>
<h2 data-id="heading-13">CAS æ“ä½œ</h2>
<h3 data-id="heading-14">ä»‹ç»</h3>
<p>è¿™éƒ¨åˆ†ä¸»è¦ä¸º CAS ç›¸å…³æ“ä½œçš„æ–¹æ³•ã€‚</p>
<p>java</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">/**
  *  CAS
  * <span class="hljs-doctag">@param</span> o         åŒ…å«è¦ä¿®æ”¹fieldçš„å¯¹è±¡
  * <span class="hljs-doctag">@param</span> offset    å¯¹è±¡ä¸­æŸfieldçš„åç§»é‡
  * <span class="hljs-doctag">@param</span> expected  æœŸæœ›å€¼
  * <span class="hljs-doctag">@param</span> update    æ›´æ–°å€¼
  * <span class="hljs-doctag">@return</span>          true | false
  */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">native</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">compareAndSwapObject</span><span class="hljs-params">(Object o, <span class="hljs-type">long</span> offset,  Object expected, Object update)</span>;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">native</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">compareAndSwapInt</span><span class="hljs-params">(Object o, <span class="hljs-type">long</span> offset, <span class="hljs-type">int</span> expected,<span class="hljs-type">int</span> update)</span>;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">native</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">compareAndSwapLong</span><span class="hljs-params">(Object o, <span class="hljs-type">long</span> offset, <span class="hljs-type">long</span> expected, <span class="hljs-type">long</span> update)</span>;
</code></pre>
<p><strong>ä»€ä¹ˆæ˜¯ CAS?</strong> Â CAS å³æ¯”è¾ƒå¹¶æ›¿æ¢ï¼ˆCompare And Swap)ï¼Œæ˜¯å®ç°å¹¶å‘ç®—æ³•æ—¶å¸¸ç”¨åˆ°çš„ä¸€ç§æŠ€æœ¯ã€‚CAS æ“ä½œåŒ…å«ä¸‰ä¸ªæ“ä½œæ•°â€”â€”å†…å­˜ä½ç½®ã€é¢„æœŸåŸå€¼åŠæ–°å€¼ã€‚æ‰§è¡Œ CAS æ“ä½œçš„æ—¶å€™ï¼Œå°†å†…å­˜ä½ç½®çš„å€¼ä¸é¢„æœŸåŸå€¼æ¯”è¾ƒï¼Œå¦‚æœç›¸åŒ¹é…ï¼Œé‚£ä¹ˆå¤„ç†å™¨ä¼šè‡ªåŠ¨å°†è¯¥ä½ç½®å€¼æ›´æ–°ä¸ºæ–°å€¼ï¼Œå¦åˆ™ï¼Œå¤„ç†å™¨ä¸åšä»»ä½•æ“ä½œã€‚æˆ‘ä»¬éƒ½çŸ¥é“ï¼ŒCAS æ˜¯ä¸€æ¡ CPU çš„åŸå­æŒ‡ä»¤ï¼ˆcmpxchg æŒ‡ä»¤ï¼‰ï¼Œä¸ä¼šé€ æˆæ‰€è°“çš„æ•°æ®ä¸ä¸€è‡´é—®é¢˜ï¼Œ<code>Unsafe</code>Â æä¾›çš„ CAS æ–¹æ³•ï¼ˆå¦‚Â <code>compareAndSwapXXX</code>ï¼‰åº•å±‚å®ç°å³ä¸º CPU æŒ‡ä»¤Â <code>cmpxchg</code>Â ã€‚</p>
<h3 data-id="heading-15">å…¸å‹åº”ç”¨</h3>
<p>åœ¨ JUC åŒ…çš„å¹¶å‘å·¥å…·ç±»ä¸­å¤§é‡åœ°ä½¿ç”¨äº† CAS æ“ä½œï¼Œåƒåœ¨å‰é¢ä»‹ç»<code>synchronized</code>å’Œ<code>AQS</code>çš„æ–‡ç« ä¸­ä¹Ÿå¤šæ¬¡æåˆ°äº† CASï¼Œå…¶ä½œä¸ºä¹è§‚é”åœ¨å¹¶å‘å·¥å…·ç±»ä¸­å¹¿æ³›å‘æŒ¥äº†ä½œç”¨ã€‚åœ¨Â <code>Unsafe</code>Â ç±»ä¸­ï¼Œæä¾›äº†<code>compareAndSwapObject</code>ã€<code>compareAndSwapInt</code>ã€<code>compareAndSwapLong</code>æ–¹æ³•æ¥å®ç°çš„å¯¹<code>Object</code>ã€<code>int</code>ã€<code>long</code>ç±»å‹çš„ CAS æ“ä½œã€‚ä»¥<code>compareAndSwapInt</code>æ–¹æ³•ä¸ºä¾‹ï¼š</p>
<p>java</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">native</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">compareAndSwapInt</span><span class="hljs-params">(Object o, <span class="hljs-type">long</span> offset,<span class="hljs-type">int</span> expected,<span class="hljs-type">int</span> x)</span>;
</code></pre>
<p>å‚æ•°ä¸­<code>o</code>ä¸ºéœ€è¦æ›´æ–°çš„å¯¹è±¡ï¼Œ<code>offset</code>æ˜¯å¯¹è±¡<code>o</code>ä¸­æ•´å½¢å­—æ®µçš„åç§»é‡ï¼Œå¦‚æœè¿™ä¸ªå­—æ®µçš„å€¼ä¸<code>expected</code>ç›¸åŒï¼Œåˆ™å°†å­—æ®µçš„å€¼è®¾ä¸º<code>x</code>è¿™ä¸ªæ–°å€¼ï¼Œå¹¶ä¸”æ­¤æ›´æ–°æ˜¯ä¸å¯è¢«ä¸­æ–­çš„ï¼Œä¹Ÿå°±æ˜¯ä¸€ä¸ªåŸå­æ“ä½œã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªä½¿ç”¨<code>compareAndSwapInt</code>çš„ä¾‹å­ï¼š</p>
<p>java</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">private</span> <span class="hljs-keyword">volatile</span> <span class="hljs-built_in">int</span> a;
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span>(<span class="hljs-params">String[] args</span>)</span>{
    CasTest casTest=<span class="hljs-keyword">new</span> CasTest();
    <span class="hljs-keyword">new</span> Thread(()-&gt;{
        <span class="hljs-keyword">for</span> (<span class="hljs-built_in">int</span> i = <span class="hljs-number">1</span>; i &lt; <span class="hljs-number">5</span>; i++) {
            casTest.increment(i);
            System.<span class="hljs-keyword">out</span>.print(casTest.a+<span class="hljs-string">" "</span>);
        }
    }).start();
    <span class="hljs-keyword">new</span> Thread(()-&gt;{
        <span class="hljs-keyword">for</span> (<span class="hljs-built_in">int</span> i = <span class="hljs-number">5</span> ; i &lt;<span class="hljs-number">10</span> ; i++) {
            casTest.increment(i);
            System.<span class="hljs-keyword">out</span>.print(casTest.a+<span class="hljs-string">" "</span>);
        }
    }).start();
}

<span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">increment</span>(<span class="hljs-params"><span class="hljs-built_in">int</span> x</span>)</span>{
    <span class="hljs-keyword">while</span> (<span class="hljs-literal">true</span>){
        <span class="hljs-keyword">try</span> {
            <span class="hljs-built_in">long</span> fieldOffset = <span class="hljs-keyword">unsafe</span>.objectFieldOffset(CasTest.<span class="hljs-keyword">class</span>.getDeclaredField(<span class="hljs-string">"a"</span>));
            <span class="hljs-keyword">if</span> (<span class="hljs-keyword">unsafe</span>.compareAndSwapInt(<span class="hljs-keyword">this</span>,fieldOffset,x<span class="hljs-number">-1</span>,x))
                <span class="hljs-keyword">break</span>;
        } <span class="hljs-keyword">catch</span> (NoSuchFieldException e) {
            e.printStackTrace();
        }
    }
}
</code></pre>
<p>è¿è¡Œä»£ç ä¼šä¾æ¬¡è¾“å‡ºï¼š</p>
<p>plain</p>
<pre><code class="hljs">1 2 3 4 5 6 7 8 9
</code></pre>
<p>åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œä½¿ç”¨ä¸¤ä¸ªçº¿ç¨‹å»ä¿®æ”¹<code>int</code>å‹å±æ€§<code>a</code>çš„å€¼ï¼Œå¹¶ä¸”åªæœ‰åœ¨<code>a</code>çš„å€¼ç­‰äºä¼ å…¥çš„å‚æ•°<code>x</code>å‡ä¸€æ—¶ï¼Œæ‰ä¼šå°†<code>a</code>çš„å€¼å˜ä¸º<code>x</code>ï¼Œä¹Ÿå°±æ˜¯å®ç°å¯¹<code>a</code>çš„åŠ ä¸€çš„æ“ä½œã€‚æµç¨‹å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fseven97-blog.oss-cn-hangzhou.aliyuncs.com%2Fimgs%2F202406202130526.png" target="_blank" title="https://seven97-blog.oss-cn-hangzhou.aliyuncs.com/imgs/202406202130526.png" ref="nofollow noopener noreferrer"><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ab7b1c68423246038926ec5227e9cd9b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56We5aWH5bCP5rGk5ZyG:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771137203&amp;x-signature=TUIiFd06QpGQRv2GUC%2FZGTUgK1M%3D" alt="" loading="lazy"/></a></p>
<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåœ¨è°ƒç”¨<code>compareAndSwapInt</code>æ–¹æ³•åï¼Œä¼šç›´æ¥è¿”å›<code>true</code>æˆ–<code>false</code>çš„ä¿®æ”¹ç»“æœï¼Œå› æ­¤éœ€è¦æˆ‘ä»¬åœ¨ä»£ç ä¸­æ‰‹åŠ¨æ·»åŠ è‡ªæ—‹çš„é€»è¾‘ã€‚åœ¨<code>AtomicInteger</code>ç±»çš„è®¾è®¡ä¸­ï¼Œä¹Ÿæ˜¯é‡‡ç”¨äº†å°†<code>compareAndSwapInt</code>çš„ç»“æœä½œä¸ºå¾ªç¯æ¡ä»¶ï¼Œç›´è‡³ä¿®æ”¹æˆåŠŸæ‰é€€å‡ºæ­»å¾ªç¯çš„æ–¹å¼æ¥å®ç°çš„åŸå­æ€§çš„è‡ªå¢æ“ä½œã€‚</p>
<h2 data-id="heading-16">çº¿ç¨‹è°ƒåº¦</h2>
<h3 data-id="heading-17">ä»‹ç»</h3>
<p><code>Unsafe</code>Â ç±»ä¸­æä¾›äº†<code>park</code>ã€<code>unpark</code>ã€<code>monitorEnter</code>ã€<code>monitorExit</code>ã€<code>tryMonitorEnter</code>æ–¹æ³•è¿›è¡Œçº¿ç¨‹è°ƒåº¦ã€‚</p>
<p>java</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">//å–æ¶ˆé˜»å¡çº¿ç¨‹</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">native</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">unpark</span><span class="hljs-params">(Object thread)</span>;
<span class="hljs-comment">//é˜»å¡çº¿ç¨‹</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">native</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">park</span><span class="hljs-params">(<span class="hljs-type">boolean</span> isAbsolute, <span class="hljs-type">long</span> time)</span>;
<span class="hljs-comment">//è·å¾—å¯¹è±¡é”ï¼ˆå¯é‡å…¥é”ï¼‰</span>
<span class="hljs-meta">@Deprecated</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">native</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">monitorEnter</span><span class="hljs-params">(Object o)</span>;
<span class="hljs-comment">//é‡Šæ”¾å¯¹è±¡é”</span>
<span class="hljs-meta">@Deprecated</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">native</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">monitorExit</span><span class="hljs-params">(Object o)</span>;
<span class="hljs-comment">//å°è¯•è·å–å¯¹è±¡é”</span>
<span class="hljs-meta">@Deprecated</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">native</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">tryMonitorEnter</span><span class="hljs-params">(Object o)</span>;
</code></pre>
<p>æ–¹æ³•Â <code>park</code>ã€<code>unpark</code>Â å³å¯å®ç°çº¿ç¨‹çš„æŒ‚èµ·ä¸æ¢å¤ï¼Œå°†ä¸€ä¸ªçº¿ç¨‹è¿›è¡ŒæŒ‚èµ·æ˜¯é€šè¿‡Â <code>park</code>Â æ–¹æ³•å®ç°çš„ï¼Œè°ƒç”¨Â <code>park</code>Â æ–¹æ³•åï¼Œçº¿ç¨‹å°†ä¸€ç›´é˜»å¡ç›´åˆ°è¶…æ—¶æˆ–è€…ä¸­æ–­ç­‰æ¡ä»¶å‡ºç°ï¼›<code>unpark</code>Â å¯ä»¥ç»ˆæ­¢ä¸€ä¸ªæŒ‚èµ·çš„çº¿ç¨‹ï¼Œä½¿å…¶æ¢å¤æ­£å¸¸ã€‚</p>
<p>æ­¤å¤–ï¼Œ<code>Unsafe</code>Â æºç ä¸­<code>monitor</code>ç›¸å…³çš„ä¸‰ä¸ªæ–¹æ³•å·²ç»è¢«æ ‡è®°ä¸º<code>deprecated</code>ï¼Œä¸å»ºè®®è¢«ä½¿ç”¨ï¼š</p>
<p>java</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">//è·å¾—å¯¹è±¡é”</span>
<span class="hljs-meta">@Deprecated</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">native</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">monitorEnter</span><span class="hljs-params">(Object var1)</span>;
<span class="hljs-comment">//é‡Šæ”¾å¯¹è±¡é”</span>
<span class="hljs-meta">@Deprecated</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">native</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">monitorExit</span><span class="hljs-params">(Object var1)</span>;
<span class="hljs-comment">//å°è¯•è·å¾—å¯¹è±¡é”</span>
<span class="hljs-meta">@Deprecated</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">native</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">tryMonitorEnter</span><span class="hljs-params">(Object var1)</span>;
</code></pre>
<p><code>monitorEnter</code>æ–¹æ³•ç”¨äºè·å¾—å¯¹è±¡é”ï¼Œ<code>monitorExit</code>ç”¨äºé‡Šæ”¾å¯¹è±¡é”ï¼Œå¦‚æœå¯¹ä¸€ä¸ªæ²¡æœ‰è¢«<code>monitorEnter</code>åŠ é”çš„å¯¹è±¡æ‰§è¡Œæ­¤æ–¹æ³•ï¼Œä¼šæŠ›å‡º<code>IllegalMonitorStateException</code>å¼‚å¸¸ã€‚<code>tryMonitorEnter</code>æ–¹æ³•å°è¯•è·å–å¯¹è±¡é”ï¼Œå¦‚æœæˆåŠŸåˆ™è¿”å›<code>true</code>ï¼Œåä¹‹è¿”å›<code>false</code>ã€‚</p>
<h3 data-id="heading-18">å…¸å‹åº”ç”¨</h3>
<p>Java é”å’ŒåŒæ­¥å™¨æ¡†æ¶çš„æ ¸å¿ƒç±»Â <code>AbstractQueuedSynchronizer</code>Â (AQS)ï¼Œå°±æ˜¯é€šè¿‡è°ƒç”¨<code>LockSupport.park()</code>å’Œ<code>LockSupport.unpark()</code>å®ç°çº¿ç¨‹çš„é˜»å¡å’Œå”¤é†’çš„ï¼Œè€ŒÂ <code>LockSupport</code>Â çš„Â <code>park</code>ã€<code>unpark</code>Â æ–¹æ³•å®é™…æ˜¯è°ƒç”¨Â <code>Unsafe</code>Â çš„Â <code>park</code>ã€<code>unpark</code>Â æ–¹å¼å®ç°çš„ã€‚</p>
<p>java</p>
<pre><code class="hljs language-scss" lang="scss">public static void <span class="hljs-built_in">park</span>(Object blocker) {
    Thread t = Thread<span class="hljs-selector-class">.currentThread</span>();
    <span class="hljs-built_in">setBlocker</span>(t, blocker);
    UNSAFE<span class="hljs-selector-class">.park</span>(false, <span class="hljs-number">0</span>L);
    <span class="hljs-built_in">setBlocker</span>(t, null);
}
public static void <span class="hljs-built_in">unpark</span>(Thread thread) {
    if (thread != null)
        UNSAFE<span class="hljs-selector-class">.unpark</span>(thread);
}
</code></pre>
<p><code>LockSupport</code>Â çš„<code>park</code>æ–¹æ³•è°ƒç”¨äº†Â <code>Unsafe</code>Â çš„<code>park</code>æ–¹æ³•æ¥é˜»å¡å½“å‰çº¿ç¨‹ï¼Œæ­¤æ–¹æ³•å°†çº¿ç¨‹é˜»å¡åå°±ä¸ä¼šç»§ç»­å¾€åæ‰§è¡Œï¼Œç›´åˆ°æœ‰å…¶ä»–çº¿ç¨‹è°ƒç”¨<code>unpark</code>æ–¹æ³•å”¤é†’å½“å‰çº¿ç¨‹ã€‚ä¸‹é¢çš„ä¾‹å­å¯¹Â <code>Unsafe</code>Â çš„è¿™ä¸¤ä¸ªæ–¹æ³•è¿›è¡Œæµ‹è¯•ï¼š</p>
<p>java</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span>(<span class="hljs-params">String[] args</span>)</span> {
    Thread mainThread = Thread.currentThread();
    <span class="hljs-keyword">new</span> Thread(()-&gt;{
        <span class="hljs-keyword">try</span> {
            TimeUnit.SECONDS.sleep(<span class="hljs-number">5</span>);
            System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">"subThread try to unpark mainThread"</span>);
            <span class="hljs-keyword">unsafe</span>.unpark(mainThread);
        } <span class="hljs-keyword">catch</span> (InterruptedException e) {
            e.printStackTrace();
        }
    }).start();

    System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">"park main mainThread"</span>);
    <span class="hljs-keyword">unsafe</span>.park(<span class="hljs-literal">false</span>,<span class="hljs-number">0L</span>);
    System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">"unpark mainThread success"</span>);
}
</code></pre>
<p>ç¨‹åºè¾“å‡ºä¸ºï¼š</p>
<p>plain</p>
<pre><code class="hljs language-css" lang="css">park <span class="hljs-selector-tag">main</span> mainThread
subThread try <span class="hljs-selector-tag">to</span> unpark mainThread
unpark mainThread success
</code></pre>
<p>ç¨‹åºè¿è¡Œçš„æµç¨‹ä¹Ÿæ¯”è¾ƒå®¹æ˜“çœ‹æ‡‚ï¼Œå­çº¿ç¨‹å¼€å§‹è¿è¡Œåå…ˆè¿›è¡Œç¡çœ ï¼Œç¡®ä¿ä¸»çº¿ç¨‹èƒ½å¤Ÿè°ƒç”¨<code>park</code>æ–¹æ³•é˜»å¡è‡ªå·±ï¼Œå­çº¿ç¨‹åœ¨ç¡çœ  5 ç§’åï¼Œè°ƒç”¨<code>unpark</code>æ–¹æ³•å”¤é†’ä¸»çº¿ç¨‹ï¼Œä½¿ä¸»çº¿ç¨‹èƒ½ç»§ç»­å‘ä¸‹æ‰§è¡Œã€‚æ•´ä¸ªæµç¨‹å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fseven97-blog.oss-cn-hangzhou.aliyuncs.com%2Fimgs%2F202406202130484.png" target="_blank" title="https://seven97-blog.oss-cn-hangzhou.aliyuncs.com/imgs/202406202130484.png" ref="nofollow noopener noreferrer"><img src="https://seven97-blog.oss-cn-hangzhou.aliyuncs.com/imgs/202406202130484.png" alt="" loading="lazy"/></a></p>
<h2 data-id="heading-19">Class æ“ä½œ</h2>
<h3 data-id="heading-20">ä»‹ç»</h3>
<p><code>Unsafe</code>Â å¯¹<code>Class</code>çš„ç›¸å…³æ“ä½œä¸»è¦åŒ…æ‹¬ç±»åŠ è½½å’Œé™æ€å˜é‡çš„æ“ä½œæ–¹æ³•ã€‚</p>
<p><strong>é™æ€å±æ€§è¯»å–ç›¸å…³çš„æ–¹æ³•</strong></p>
<p>java</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">//è·å–é™æ€å±æ€§çš„åç§»é‡</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">native</span> <span class="hljs-type">long</span> <span class="hljs-title function_">staticFieldOffset</span><span class="hljs-params">(Field f)</span>;
<span class="hljs-comment">//è·å–é™æ€å±æ€§çš„å¯¹è±¡æŒ‡é’ˆ</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">native</span> Object <span class="hljs-title function_">staticFieldBase</span><span class="hljs-params">(Field f)</span>;
<span class="hljs-comment">//åˆ¤æ–­ç±»æ˜¯å¦éœ€è¦åˆå§‹åŒ–ï¼ˆç”¨äºè·å–ç±»çš„é™æ€å±æ€§å‰è¿›è¡Œæ£€æµ‹ï¼‰</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">native</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">shouldBeInitialized</span><span class="hljs-params">(Class&lt;?&gt; c)</span>;
</code></pre>
<p>åˆ›å»ºä¸€ä¸ªåŒ…å«é™æ€å±æ€§çš„ç±»ï¼Œè¿›è¡Œæµ‹è¯•ï¼š</p>
<p>java</p>
<pre><code class="hljs language-csharp" lang="csharp">@Data
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">User</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> String name=<span class="hljs-string">"Hydra"</span>;
    <span class="hljs-built_in">int</span> age;
}
<span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">staticTest</span>() throws Exception</span> {
    User user=<span class="hljs-keyword">new</span> User();
    <span class="hljs-comment">// ä¹Ÿå¯ä»¥ç”¨ä¸‹é¢çš„è¯­å¥è§¦å‘ç±»åˆå§‹åŒ–</span>
    <span class="hljs-comment">// 1.</span>
    <span class="hljs-comment">// unsafe.ensureClassInitialized(User.class);</span>
    <span class="hljs-comment">// 2.</span>
    <span class="hljs-comment">// System.out.println(User.name);</span>
    System.<span class="hljs-keyword">out</span>.println(<span class="hljs-keyword">unsafe</span>.shouldBeInitialized(User.<span class="hljs-keyword">class</span>));
    Field sexField = User.<span class="hljs-keyword">class</span>.getDeclaredField(<span class="hljs-string">"name"</span>);
    <span class="hljs-built_in">long</span> fieldOffset = <span class="hljs-keyword">unsafe</span>.staticFieldOffset(sexField);
    Object fieldBase = <span class="hljs-keyword">unsafe</span>.staticFieldBase(sexField);
    Object <span class="hljs-built_in">object</span> = <span class="hljs-keyword">unsafe</span>.getObject(fieldBase, fieldOffset);
    System.<span class="hljs-keyword">out</span>.println(<span class="hljs-built_in">object</span>);
}
</code></pre>
<p>è¿è¡Œç»“æœï¼š</p>
<p>plain</p>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-literal">false</span>
Hydra
</code></pre>
<p>åœ¨Â <code>Unsafe</code>Â çš„å¯¹è±¡æ“ä½œä¸­ï¼Œæˆ‘ä»¬å­¦ä¹ äº†é€šè¿‡<code>objectFieldOffset</code>æ–¹æ³•è·å–å¯¹è±¡å±æ€§åç§»é‡å¹¶åŸºäºå®ƒå¯¹å˜é‡çš„å€¼è¿›è¡Œå­˜å–ï¼Œä½†æ˜¯å®ƒä¸é€‚ç”¨äºç±»ä¸­çš„é™æ€å±æ€§ï¼Œè¿™æ—¶å€™å°±éœ€è¦ä½¿ç”¨<code>staticFieldOffset</code>æ–¹æ³•ã€‚åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼Œåªæœ‰åœ¨è·å–<code>Field</code>å¯¹è±¡çš„è¿‡ç¨‹ä¸­ä¾èµ–åˆ°äº†<code>Class</code>ï¼Œè€Œè·å–é™æ€å˜é‡çš„å±æ€§æ—¶ä¸å†ä¾èµ–äº<code>Class</code>ã€‚</p>
<p>åœ¨ä¸Šé¢çš„ä»£ç ä¸­é¦–å…ˆåˆ›å»ºä¸€ä¸ª<code>User</code>å¯¹è±¡ï¼Œè¿™æ˜¯å› ä¸ºå¦‚æœä¸€ä¸ªç±»æ²¡æœ‰è¢«åˆå§‹åŒ–ï¼Œé‚£ä¹ˆå®ƒçš„é™æ€å±æ€§ä¹Ÿä¸ä¼šè¢«åˆå§‹åŒ–ï¼Œæœ€åè·å–çš„å­—æ®µå±æ€§å°†æ˜¯<code>null</code>ã€‚æ‰€ä»¥åœ¨è·å–é™æ€å±æ€§å‰ï¼Œéœ€è¦è°ƒç”¨<code>shouldBeInitialized</code>æ–¹æ³•ï¼Œåˆ¤æ–­åœ¨è·å–å‰æ˜¯å¦éœ€è¦åˆå§‹åŒ–è¿™ä¸ªç±»ã€‚å¦‚æœåˆ é™¤åˆ›å»º User å¯¹è±¡çš„è¯­å¥ï¼Œè¿è¡Œç»“æœä¼šå˜ä¸ºï¼š</p>
<p>plain</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-literal">true</span>
<span class="hljs-literal">null</span>
</code></pre>
<p><strong>ä½¿ç”¨<code>defineClass</code>æ–¹æ³•å…è®¸ç¨‹åºåœ¨è¿è¡Œæ—¶åŠ¨æ€åœ°åˆ›å»ºä¸€ä¸ªç±»</strong></p>
<p>java</p>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-function"><span class="hljs-keyword">public</span> native Class&lt;?&gt; <span class="hljs-title">defineClass</span><span class="hljs-params">(<span class="hljs-type">String</span> name, <span class="hljs-type">byte</span>[] b, <span class="hljs-type">int</span> off, <span class="hljs-type">int</span> len, ClassLoader loader,ProtectionDomain protectionDomain)</span></span>;
</code></pre>
<p>åœ¨å®é™…ä½¿ç”¨è¿‡ç¨‹ä¸­ï¼Œå¯ä»¥åªä¼ å…¥å­—èŠ‚æ•°ç»„ã€èµ·å§‹å­—èŠ‚çš„ä¸‹æ ‡ä»¥åŠè¯»å–çš„å­—èŠ‚é•¿åº¦ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œç±»åŠ è½½å™¨ï¼ˆ<code>ClassLoader</code>ï¼‰å’Œä¿æŠ¤åŸŸï¼ˆ<code>ProtectionDomain</code>ï¼‰æ¥æºäºè°ƒç”¨æ­¤æ–¹æ³•çš„å®ä¾‹ã€‚ä¸‹é¢çš„ä¾‹å­ä¸­å®ç°äº†åç¼–è¯‘ç”Ÿæˆåçš„ class æ–‡ä»¶çš„åŠŸèƒ½ï¼š</p>
<p>java</p>
<pre><code class="hljs language-ini" lang="ini">private static void defineTest() {
    String <span class="hljs-attr">fileName</span>=<span class="hljs-string">"F:\workspace\unsafe-test\target\classes\com\cn\model\User.class"</span><span class="hljs-comment">;</span>
    File <span class="hljs-attr">file</span> = new File(fileName)<span class="hljs-comment">;</span>
    try(FileInputStream <span class="hljs-attr">fis</span> = new FileInputStream(file)) {
        byte<span class="hljs-section">[]</span> <span class="hljs-attr">content</span>=new byte[(int)file.length()]<span class="hljs-comment">;</span>
        fis.read(content)<span class="hljs-comment">;</span>
        Class <span class="hljs-attr">clazz</span> = unsafe.defineClass(null, content, <span class="hljs-number">0</span>, content.length, null, null)<span class="hljs-comment">;</span>
        Object <span class="hljs-attr">o</span> = clazz.newInstance()<span class="hljs-comment">;</span>
        Object <span class="hljs-attr">age</span> = clazz.getMethod(<span class="hljs-string">"getAge"</span>).invoke(o, null)<span class="hljs-comment">;</span>
        System.out.println(age)<span class="hljs-comment">;</span>
    } catch (Exception e) {
        e.printStackTrace()<span class="hljs-comment">;</span>
    }
}
</code></pre>
<p>åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼Œé¦–å…ˆè¯»å–äº†ä¸€ä¸ª<code>class</code>æ–‡ä»¶å¹¶é€šè¿‡æ–‡ä»¶æµå°†å®ƒè½¬åŒ–ä¸ºå­—èŠ‚æ•°ç»„ï¼Œä¹‹åä½¿ç”¨<code>defineClass</code>æ–¹æ³•åŠ¨æ€çš„åˆ›å»ºäº†ä¸€ä¸ªç±»ï¼Œå¹¶åœ¨åç»­å®Œæˆäº†å®ƒçš„å®ä¾‹åŒ–å·¥ä½œï¼Œæµç¨‹å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œå¹¶ä¸”é€šè¿‡è¿™ç§æ–¹å¼åˆ›å»ºçš„ç±»ï¼Œä¼šè·³è¿‡ JVM çš„æ‰€æœ‰å®‰å…¨æ£€æŸ¥ã€‚</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Foss.javaguide.cn%2Fgithub%2Fjavaguide%2Fjava%2Fbasis%2Funsafe%2Fimage-20220717145000710.png" target="_blank" title="https://oss.javaguide.cn/github/javaguide/java/basis/unsafe/image-20220717145000710.png" ref="nofollow noopener noreferrer"><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/943b180e413f45d38624174ed73a4ebc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56We5aWH5bCP5rGk5ZyG:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771137203&amp;x-signature=hsOaP0KsEp%2FGFeTEkmNIllfaG34%3D" alt="" loading="lazy"/></a></p>
<p>é™¤äº†<code>defineClass</code>æ–¹æ³•å¤–ï¼ŒUnsafe è¿˜æä¾›äº†ä¸€ä¸ª<code>defineAnonymousClass</code>æ–¹æ³•ï¼š</p>
<p>java</p>
<pre><code class="hljs language-vbnet" lang="vbnet"><span class="hljs-keyword">public</span> native <span class="hljs-keyword">Class</span>&lt;?&gt; defineAnonymousClass(<span class="hljs-keyword">Class</span>&lt;?&gt; hostClass, <span class="hljs-type">byte</span>[] data, <span class="hljs-type">Object</span>[] cpPatches);
</code></pre>
<p>ä½¿ç”¨è¯¥æ–¹æ³•å¯ä»¥ç”¨æ¥åŠ¨æ€çš„åˆ›å»ºä¸€ä¸ªåŒ¿åç±»ï¼Œåœ¨<code>Lambda</code>è¡¨è¾¾å¼ä¸­å°±æ˜¯ä½¿ç”¨ ASM åŠ¨æ€ç”Ÿæˆå­—èŠ‚ç ï¼Œç„¶ååˆ©ç”¨è¯¥æ–¹æ³•å®šä¹‰å®ç°ç›¸åº”çš„å‡½æ•°å¼æ¥å£çš„åŒ¿åç±»ã€‚åœ¨ JDK 15 å‘å¸ƒçš„æ–°ç‰¹æ€§ä¸­ï¼Œåœ¨éšè—ç±»ï¼ˆ<code>Hidden classes</code>ï¼‰ä¸€æ¡ä¸­ï¼ŒæŒ‡å‡ºå°†åœ¨æœªæ¥çš„ç‰ˆæœ¬ä¸­å¼ƒç”¨Â <code>Unsafe</code>Â çš„<code>defineAnonymousClass</code>æ–¹æ³•ã€‚</p>
<h3 data-id="heading-21">å…¸å‹åº”ç”¨</h3>
<p>Lambda è¡¨è¾¾å¼å®ç°éœ€è¦ä¾èµ–Â <code>Unsafe</code>Â çš„Â <code>defineAnonymousClass</code>Â æ–¹æ³•å®šä¹‰å®ç°ç›¸åº”çš„å‡½æ•°å¼æ¥å£çš„åŒ¿åç±»ã€‚</p>
<h2 data-id="heading-22">ç³»ç»Ÿä¿¡æ¯</h2>
<h3 data-id="heading-23">ä»‹ç»</h3>
<p>è¿™éƒ¨åˆ†åŒ…å«ä¸¤ä¸ªè·å–ç³»ç»Ÿç›¸å…³ä¿¡æ¯çš„æ–¹æ³•ã€‚</p>
<p>java</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-comment">//è¿”å›ç³»ç»ŸæŒ‡é’ˆçš„å¤§å°ã€‚è¿”å›å€¼ä¸º4ï¼ˆ32ä½ç³»ç»Ÿï¼‰æˆ– 8ï¼ˆ64ä½ç³»ç»Ÿï¼‰ã€‚</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> native <span class="hljs-built_in">int</span> <span class="hljs-title">addressSize</span>()</span>;
<span class="hljs-comment">//å†…å­˜é¡µçš„å¤§å°ï¼Œæ­¤å€¼ä¸º2çš„å¹‚æ¬¡æ–¹ã€‚</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> native <span class="hljs-built_in">int</span> <span class="hljs-title">pageSize</span>()</span>;
</code></pre>
<h3 data-id="heading-24">å…¸å‹åº”ç”¨</h3>
<p>è¿™ä¸¤ä¸ªæ–¹æ³•çš„åº”ç”¨åœºæ™¯æ¯”è¾ƒå°‘ï¼Œåœ¨<code>java.nio.Bits</code>ç±»ä¸­ï¼Œåœ¨ä½¿ç”¨<code>pageCount</code>è®¡ç®—æ‰€éœ€çš„å†…å­˜é¡µçš„æ•°é‡æ—¶ï¼Œè°ƒç”¨äº†<code>pageSize</code>æ–¹æ³•è·å–å†…å­˜é¡µçš„å¤§å°ã€‚å¦å¤–ï¼Œåœ¨ä½¿ç”¨<code>copySwapMemory</code>æ–¹æ³•æ‹·è´å†…å­˜æ—¶ï¼Œè°ƒç”¨äº†<code>addressSize</code>æ–¹æ³•ï¼Œæ£€æµ‹ 32 ä½ç³»ç»Ÿçš„æƒ…å†µã€‚</p>
<h2 data-id="heading-25">Unsafeåº•å±‚</h2>
<p>å†çœ‹çœ‹Unsafeçš„compareAndSwap æ–¹æ³•æ¥å®ç°CASæ“ä½œï¼Œå®ƒæ˜¯ä¸€ä¸ªæœ¬åœ°æ–¹æ³•ï¼Œå®ç°ä½äºunsafe.cppä¸­ã€‚</p>
<p>java</p>
<pre><code class="hljs language-ini" lang="ini">UNSAFE_ENTRY(jboolean, Unsafe_CompareAndSwapInt(JNIEnv *env, jobject unsafe, jobject obj, jlong offset, jint e, jint x))
  UnsafeWrapper("Unsafe_CompareAndSwapInt")<span class="hljs-comment">;</span>
  oop <span class="hljs-attr">p</span> = JNIHandles::resolve(obj)<span class="hljs-comment">;</span>
  jint* <span class="hljs-attr">addr</span> = (jint *) index_oop_from_field_<span class="hljs-literal">off</span>set_long(p, <span class="hljs-literal">off</span>set)<span class="hljs-comment">;</span>
  return (jint)(Atomic::cmpxchg(x, addr, e)) == e<span class="hljs-comment">;</span>
UNSAFE_END
</code></pre>
<p>å¯ä»¥çœ‹åˆ°å®ƒé€šè¿‡ Atomic::cmpxchg æ¥å®ç°æ¯”è¾ƒå’Œæ›¿æ¢æ“ä½œã€‚å…¶ä¸­å‚æ•°xæ˜¯å³å°†æ›´æ–°çš„å€¼ï¼Œå‚æ•°eæ˜¯åŸå†…å­˜çš„å€¼ã€‚</p>
<p>å¦‚æœæ˜¯Linuxçš„x86ï¼ŒAtomic::cmpxchgæ–¹æ³•çš„å®ç°å¦‚ä¸‹ï¼š</p>
<p>java</p>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-function"><span class="hljs-keyword">inline</span> jint <span class="hljs-title">Atomic::cmpxchg</span> <span class="hljs-params">(jint exchange_value, <span class="hljs-keyword">volatile</span> jint* dest, jint compare_value)</span> </span>{
  <span class="hljs-type">int</span> mp = os::<span class="hljs-built_in">is_MP</span>();
  <span class="hljs-function">__asm__ <span class="hljs-title">volatile</span> <span class="hljs-params">(LOCK_IF_MP(%<span class="hljs-number">4</span>) <span class="hljs-string">"cmpxchgl %1,(%3)"</span>
                    : <span class="hljs-string">"=a"</span> (exchange_value)
                    : <span class="hljs-string">"r"</span> (exchange_value), <span class="hljs-string">"a"</span> (compare_value), <span class="hljs-string">"r"</span> (dest), <span class="hljs-string">"r"</span> (mp)
                    : <span class="hljs-string">"cc"</span>, <span class="hljs-string">"memory"</span>)</span></span>;
  <span class="hljs-keyword">return</span> exchange_value;
}
</code></pre>
<p>è€Œwindowsçš„x86çš„å®ç°å¦‚ä¸‹ï¼š</p>
<p>java</p>
<pre><code class="hljs language-scss" lang="scss">inline jint Atomic::cmpxchg (jint exchange_value, volatile jint* dest, jint compare_value) {
    int mp = os::<span class="hljs-built_in">isMP</span>(); <span class="hljs-comment">//åˆ¤æ–­æ˜¯å¦æ˜¯å¤šå¤„ç†å™¨</span>
    _asm {
        mov edx, dest
        mov ecx, exchange_value
        mov eax, compare_value
        <span class="hljs-built_in">LOCK_IF_MP</span>(mp)
        cmpxchg dword ptr <span class="hljs-selector-attr">[edx]</span>, ecx
    }
}

<span class="hljs-comment">// Adding a lock prefix to an instruction on MP machine</span>
<span class="hljs-comment">// VC++ doesn't like the lock prefix to be on a single line</span>
<span class="hljs-comment">// so we can't insert a label after the lock prefix.</span>
<span class="hljs-comment">// By emitting a lock prefix, we can define a label after it.</span>
<span class="hljs-selector-id">#define</span> <span class="hljs-built_in">LOCK_IF_MP</span>(mp) __asm cmp mp, <span class="hljs-number">0</span>  \
                       __asm je L0      \
                       __asm _emit <span class="hljs-number">0</span>xF0 \
                       __asm L0:
</code></pre>
<p>å¦‚æœæ˜¯å¤šå¤„ç†å™¨ï¼Œä¸ºcmpxchgæŒ‡ä»¤æ·»åŠ lockå‰ç¼€ã€‚åä¹‹ï¼Œå°±çœç•¥lockå‰ç¼€(å•å¤„ç†å™¨ä¼šä¸éœ€è¦lockå‰ç¼€æä¾›çš„å†…å­˜å±éšœæ•ˆæœ)ã€‚è¿™é‡Œçš„lockå‰ç¼€å°±æ˜¯ä½¿ç”¨äº†å¤„ç†å™¨çš„æ€»çº¿é”(æœ€æ–°çš„å¤„ç†å™¨éƒ½ä½¿ç”¨ç¼“å­˜é”ä»£æ›¿æ€»çº¿é”æ¥æé«˜æ€§èƒ½)ã€‚</p>
<blockquote>
<p>cmpxchg(void* ptr, int old, int new)ï¼Œå¦‚æœptrå’Œoldçš„å€¼ä¸€æ ·ï¼Œåˆ™æŠŠnewå†™åˆ°ptrå†…å­˜ï¼Œå¦åˆ™è¿”å›ptrçš„å€¼ï¼Œæ•´ä¸ªæ“ä½œæ˜¯åŸå­çš„ã€‚åœ¨Intelå¹³å°ä¸‹ï¼Œä¼šç”¨lock cmpxchgæ¥å®ç°ï¼Œä½¿ç”¨lockè§¦å‘ç¼“å­˜é”ï¼Œè¿™æ ·å¦ä¸€ä¸ªçº¿ç¨‹æƒ³è®¿é—®ptrçš„å†…å­˜ï¼Œå°±ä¼šè¢«blockä½ã€‚</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Web å®‰å…¨ä¸åç¼–è¯‘æºç ä¸‹çš„æƒé™è®¾è®¡ï¼šæ„å»ºå‰åç«¯ä¸€ä½“çš„ä¿¡ä»»é˜²çº¿]]></title>    <link>https://juejin.cn/post/7603771025856561203</link>    <guid>https://juejin.cn/post/7603771025856561203</guid>    <pubDate>2026-02-08T06:35:50.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7603771025856561203" data-draft-id="7603674653153787913" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Web å®‰å…¨ä¸åç¼–è¯‘æºç ä¸‹çš„æƒé™è®¾è®¡ï¼šæ„å»ºå‰åç«¯ä¸€ä½“çš„ä¿¡ä»»é˜²çº¿"/> <meta itemprop="keywords" content="å‰ç«¯,å®‰å…¨,ç¼–è¯‘åŸç†"/> <meta itemprop="datePublished" content="2026-02-08T06:35:50.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="LeonGao"/> <meta itemprop="url" content="https://juejin.cn/user/3976252950591149"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Web å®‰å…¨ä¸åç¼–è¯‘æºç ä¸‹çš„æƒé™è®¾è®¡ï¼šæ„å»ºå‰åç«¯ä¸€ä½“çš„ä¿¡ä»»é˜²çº¿
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3976252950591149/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    LeonGao
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-08T06:35:50.000Z" title="Sun Feb 08 2026 06:35:50 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»5åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{position:relative;word-break:break-word;line-height:1.75;font-weight:400;font-size:15px;overflow-x:hidden;color:#333}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:30px;margin-bottom:5px}.markdown-body h2{font-size:24px;display:inline-block;font-weight:700;background:#ef7060;color:#fff;padding:6px 8px 0 0;border-top-right-radius:6px;margin-right:2px;box-shadow:6px 3px 0 0 rgba(239,112,96,.2)}.markdown-body h2:before{content:" ";display:inline-block;width:8px}.markdown-body h2:after{content:" ";position:absolute;display:block;width:calc(100% - 50px);border-bottom:3px solid #ef7060}.markdown-body h3{font-size:18px;padding-bottom:0}.markdown-body h4{font-size:16px}.markdown-body h5{font-size:15px}.markdown-body h6{margin-top:5px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #3e3e3e;margin-top:32px;margin-bottom:32px;height:1px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgba(27,31,35,.05);color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:JetBranins Mono,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75;box-shadow:0 0 8px hsla(0,0%,43.1%,.45);border-radius:4px;margin:16px}.markdown-body pre:before{content:"";display:block;height:30px;width:100%;margin-bottom:-7px;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAAAdCAYAAABcz8ldAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAhgSURBVGhD7Zp7bBTHHcdn33t7vvOdzy+ITVKDU0xIKG2ABCPTRCCaUiEVKWoqRJuASAhCitRCVKSoalFUKZBiSmmFRRJKRUnUtIpo+aNqGgwoOCmuFUIRzxjwE4zte+97drYzztji8HPvtkit/PnH+n1397Tz+83vN/PbMZhmmmmm+d+BoX8n5diihcGqgFQf5vk6BMAskWUlw3GyFnIvtqWSf91w7mKC3npfOLX7wYeiIa6BBWCOLLFRF2NB0JvIOP/80YG+k2ev6S699b/OzOfKBW5l5KsgyC4DCFQDnpEAdE1goc/dlNPc/Up7P711UiYNSMuyxeUzZPnHgGHWh5XADEkSAcdiN+AnEXIBhBComgFU0/xQR+jnj51sOUMf9Z0NKyL8S9+JPBEN8zuCMrsqGOA5QWAAyzLAxe53HBeYFgJp1c5Cx33nyIfpV3e+22/Sx32nev/sMCgVnmM4bjOniAtZWQAsz315EfsGQQc4hgWcjHkCmOj1rheuNn95cXwmDMiVp5etC/D8m5FwUWVQUYYGPh6mZYFUOgsGVa1pXvOZzVT2jRuH54RM230jEuI3RcIiL4l4UkxAJmuD/riVsqD7ct2m9nep7BtVTbVfZ0uE/UIk+CQflAHDjf8+Lg6MldYATGpH3c/Ul7p3dWXppVGM6eElJSHmnQWPbSlRlN1lJcUBjqNRnwJZVQO3B5P/uq5rK1d90pakckFcaKp5UJHY92JR8YlwkUDVySEZfGfQdO7E7Z8s2HL9TSoXTPXRud9nA8IBqSwcZgWeqpPj6BYw7yTbXBN9q2v9lQEq5zBmWA8vWLCptCi4tzwW8RQMQlFQATPLSh6vCSh/plJBkMyQBHZfWYnkKRgEktEVpTJXERN2Xzo4ex2VC6K6qXYpF5b3ypVRT8EgcAERSJXRbwCBOTFzXblM5RxGBaRt+ZPYA+LO0mgxz5K1Ig+UgAzKIuGnz39z6S+olDeaibaXRsU1RUFvgx+GwTWgPCaDgMw2XXpr9gwq50XV0bkxJiYeEiNF5cwE5XsiOEkAUkXkUW51SSOVchjl8WKef604XFSRbzCGCYeCoESStv/p8QU1VPIM3knNDynctnBRfsEYhgSlNCIGgQv2UCkvGIHZgteMh1nBW9W4F16RAM6yDVV7amZTaYQcr59cuuhhWRTWBvAMLxQGeyFSHOLnh0MvUskz5RF+fbRYDEy0mZgqQYUHOLhr//b6rGoqeaLqQG0pw3PrBbyA+4EQUkRmhvgqNUfICUipKK4OKUqIJVPKB0jpEhjmWWp64jdbKmVZZNYogcJm493gsifOqhDyeh9GYR/FM7sW+DA5CKR0MSK3tvKZkpwB5gRE4tjFEr7RL0iWBGV51vHFCyupNGWWPqLgnoer9mtyEGSJAzwLllDTGzyznDjRN/CwOFkoFb4bm0eVIXICgpvdGoEvrF7fC89zfLkkeV5HbOhWiTwTpKYvCAJLGshRdXtKMKAWlyxq+MPQLk1h66g5RE5ABJYNFrqY3wvJklJRUKg5ZWLFXIA86yek2uDOPkBNb3CM5Pf7DL2QyIrUGiLH+xC5Bmmm/ARnHUhC6PnzxWDK0RH5HuIjZGy27erU9AZ0dTIWXyG+NpBBrSFySxZw220IqeUPFoS6jVAPNadM7yDsgNB1qOkLuAziMYIb1PQGA75wIaKGPyAb+9oF16g5RE5ALIQ+tSyLWoWDEAK6aXW3JlK9VJoyx1oyvVkNdvo5KXXDAVkdnaKmNwx0xjH98w3JNmTCm+Bc9hKVhsgJSI9pvp9Vdd++jmq6AXB2/HHrhcs5aTkVDv0DFzoHvKdq/mQsKX/4t7KJLDpOJW+IbAvMGoMkxfwAWZB8DT7W1diTE+WcgKz6pK1bs6z3daPwmJDsSKt6ZsCyjlLJMz0DsDGZ8SdlDROBjOb8YeWOjptU8kTXusuaazu7oJrfEnQvdkpVcUn6PTVHyAkIIW7br/Unklni0EJIZ1WgGsauZR+fvUglz6zY0dGfVp09ybRNlfwgi3k8YSbvJJ29VMoLt9v6rZVQL7hOYUubndHJGclBtzn1byqNMCogi09/2nFb01/oj+f/5TyjauBOKtPcZ1r7qZQ3f2lRfxZPWi2anp8TSDAGExZMa2jr8u03L1M5L7q3Xc+iAeuHRl/ScvPcjSLDBnZS/cjtNHd2v3171Ewbs9N5q7Pn4otVMx3btBsCsoRbk1FxG5dMVgMDqfTpXl1/tuFMa5zKefPROdX59qLQBwLnNog8Wy1OcjB1N+QEsW/QsFNZuO35Xb1v98QLX4/Sx+O3wqujrQ6013ABUWI8+AaqBjAH01+ghL22+5X2PirnMG7r+esbnae/V1neauvGSoHjigTcVU7UGFm2DeK4ttxKpQ+mLPvl+o/PjnkAkw9HTqSMmVHhyAMx9iFcSh/BHTfLceO/C8mKjApBf9zszGhoY92m9sN+BGOY9AeD7eGniv8OTaOB4dgyTsQd9wS+IQu4lciYdkI7CLrNH3Rvbb9FL41i0tbzVP2iWJkobpN5fmM4IJfJskTP1Bk8A9HQmbpmGDBrWqdVCN/Yd7PjxKGOXn+bmbto3feVVcVB9qehIL8EJy8nChwgr0O2xxBnhGU5eP2CfYbl/m4gBRsbtneMORP9oGpjpcCsiKzHHfdOPiQ/wMniyFEu2dbiTQCAeN/vavC466BGYLttXc9fmXBXMGlAhiHHur+sq6uPiUI9z7CVHMPwBnLSuuN8FuC48/Oaz1ylt94XfrW5ouyprwWfYRkwNyCyYYjwkBHows1fa+tV/fzGxlv39b9gqvfPmQ+i/HK8KlcBjhHwfl8HEHyOd1JnuzZd66S3TTPNNNP8/wDAfwDG7G0m9LKBpwAAAABJRU5ErkJggg==) 10px 10px no-repeat;background-size:40px;background-color:#fdfdfd}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#fdfdfd}.markdown-body a{text-decoration:none;font-weight:700;color:#ef7060;border-bottom:1px solid #ef7060}.markdown-body a:active,.markdown-body a:hover{color:#ef2d26}.markdown-body table tr td,.markdown-body table tr th{border:1px solid #ccc;padding:5px 10px}.markdown-body table{display:block!important;width:auto;max-width:100%;overflow:auto;border-collapse:collapse}.markdown-body thead{background:#f0f0f0;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#f8f8f8}.markdown-body blockquote{margin-inline-start:0;margin-inline-end:0;border-left:3px solid #ef7060;background:#fff9f9;padding:1px 20px;margin-top:20px}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="atom-one-light">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#383a42;background:#fafafa}.hljs-comment,.hljs-quote{color:#a0a1a7;font-style:italic}.hljs-doctag,.hljs-formula,.hljs-keyword{color:#a626a4}.hljs-deletion,.hljs-name,.hljs-section,.hljs-selector-tag,.hljs-subst{color:#e45649}.hljs-literal{color:#0184bb}.hljs-addition,.hljs-attribute,.hljs-meta-string,.hljs-regexp,.hljs-string{color:#50a14f}.hljs-built_in,.hljs-class .hljs-title{color:#c18401}.hljs-attr,.hljs-number,.hljs-selector-attr,.hljs-selector-class,.hljs-selector-pseudo,.hljs-template-variable,.hljs-type,.hljs-variable{color:#986801}.hljs-bullet,.hljs-link,.hljs-meta,.hljs-selector-id,.hljs-symbol,.hljs-title{color:#4078f2}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}.hljs-link{text-decoration:underline}</style><h2 data-id="heading-0">å¼•è¨€</h2>
<p>åœ¨ç°ä»£ Web åº”ç”¨ä¸­ï¼Œ<strong>å®‰å…¨ä¸æƒé™è®¾è®¡</strong> æ˜¯æ¶æ„ä¸­æœ€å®¹æ˜“è¢«å¿½è§†ã€å´æœ€å®¹æ˜“å‡ºé—®é¢˜çš„éƒ¨åˆ†ã€‚<br/>
éšç€å‰ç«¯åº”ç”¨çš„å¤æ‚åº¦ä¸æ–­æé«˜ï¼ˆVueã€Reactã€Flutter Web ç­‰ï¼‰ï¼Œè¶Šæ¥è¶Šå¤šé€»è¾‘è¢«æ”¾åœ¨å®¢æˆ·ç«¯æ‰§è¡Œï¼›<br/>
ä¸æ­¤åŒæ—¶ï¼Œæ‰“åŒ…åçš„å‰ç«¯ä»£ç å¯è¢«è½»æ˜“â€œåç¼–è¯‘â€ã€â€œé€†å‘åˆ†æâ€æˆ–ç›´æ¥åœ¨æµè§ˆå™¨ä¸­ç¯¡æ”¹ã€‚</p>
<p>äºæ˜¯ï¼Œå¼€å‘è€…å¸¸é¢ä¸´ä¸€ä¸ªæ£˜æ‰‹é—®é¢˜ï¼š</p>
<blockquote>
<p>ã€Œå½“ç”¨æˆ·å¯ä»¥ç›´æ¥æŸ¥çœ‹ã€ä¿®æ”¹ã€ç”šè‡³æ³¨å…¥å‰ç«¯é€»è¾‘æ—¶ï¼Œæˆ‘ä»¬è¯¥å¦‚ä½•ä¿éšœæƒé™ä½“ç³»çš„å®‰å…¨æ€§ï¼Ÿã€</p>
</blockquote>
<p>æœ¬æ–‡å°†ç³»ç»Ÿåˆ†æ <strong>åç¼–è¯‘ç¯å¢ƒä¸‹æƒé™è®¾è®¡çš„é£é™©ä¸é˜²æŠ¤æœºåˆ¶</strong>ï¼Œé€šè¿‡æ¶æ„åˆ†å±‚æ€è·¯ï¼Œ<br/>
æ„å»ºä¸€ä¸ªå‰åç«¯ç»Ÿä¸€ã€å®‰å…¨å¯æ§çš„æƒé™é˜²æŠ¤ä½“ç³»ï¼Œå¹¶æä¾›å®è·µä»£ç ä¸å·¥ç¨‹å»ºè®®ã€‚</p>
<hr/>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2f136ab89966405c858f127a85d954e1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTGVvbkdhbw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771137350&amp;x-signature=OrhcZhqf%2F91h7ZTzDxqsJqWUCL4%3D" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-1">ä¸€ã€é—®é¢˜å®šä¹‰ä¸èƒŒæ™¯</h2>
<h3 data-id="heading-2">1. å‰ç«¯åç¼–è¯‘ï¼šå®‰å…¨çš„å‡è±¡</h3>
<p>å‰ç«¯ç¼–è¯‘äº§ç‰©ï¼ˆHTMLã€JSã€CSSï¼‰æœ€ç»ˆéƒ½éœ€è¿è¡Œåœ¨ç”¨æˆ·ç«¯ã€‚<br/>
å³ä½¿ä½¿ç”¨äº† Webpackã€Viteã€Uglify è¿›è¡Œæ··æ·†æ‰“åŒ…ï¼Œæ”»å‡»è€…ä»å¯é€šè¿‡å¦‚ä¸‹æ–¹å¼åˆ†ææºç ï¼š</p>
<ul>
<li>æ‰“å¼€ <strong>æµè§ˆå™¨å¼€å‘è€…å·¥å…·</strong> æŸ¥çœ‹é€»è¾‘ï¼›</li>
<li>ä½¿ç”¨ <strong>åæ··æ·†å·¥å…·</strong> è¿˜åŸå‡½æ•°ä¸æ¨¡å—ï¼›</li>
<li>ç›´æ¥ <strong>ä¿®æ”¹å…¨å±€å˜é‡ç»•è¿‡æ¡ä»¶åˆ¤æ–­</strong>ï¼›</li>
<li>ä½¿ç”¨ <strong>æŠ“åŒ…å·¥å…·ï¼ˆå¦‚ Burpã€Postmanï¼‰</strong> æ¨¡æ‹Ÿæ¥å£è°ƒç”¨ã€‚</li>
</ul>
<p>è¿™æ„å‘³ç€ï¼š<br/>
å‰ç«¯çš„æƒé™åˆ¤æ–­ã€ä»¤ç‰ŒéªŒè¯æˆ–è§’è‰²é™åˆ¶â€”â€”å¦‚æœ<strong>ä¸ç”±åç«¯å¤æ ¸</strong>ï¼Œ<br/>
éƒ½å¯ä»¥è¢«é€šè¿‡ç¯¡æ”¹è„šæœ¬çš„æ–¹å¼ç»•è¿‡ã€‚</p>
<h3 data-id="heading-3">2. æ¡ˆä¾‹ï¼šè¢«ç¯¡æ”¹çš„å‰ç«¯æƒé™</h3>
<p>é”™è¯¯ç¤ºä¾‹ï¼ˆå‰ç«¯åˆ¤æ–­ç®¡ç†å‘˜èº«ä»½ï¼‰ï¼š</p>
<pre><code class="hljs language-ini" lang="ini">if (<span class="hljs-attr">user.role</span> === <span class="hljs-string">'admin'</span>) {
  showAdminPanel()<span class="hljs-comment">;</span>
}
</code></pre>
<p>æ”»å‡»è€…åœ¨æµè§ˆå™¨æ§åˆ¶å°ç›´æ¥æ‰§è¡Œï¼š</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">user.role</span> = <span class="hljs-string">'admin'</span><span class="hljs-comment">;</span>
showAdminPanel()<span class="hljs-comment">;</span>
</code></pre>
<p>å³å¯è§£é”ã€Œç®¡ç†å‘˜é¢æ¿ã€ã€‚<br/>
ä½†å¦‚æœåç«¯æ¥å£æ²¡æœ‰äºŒæ¬¡éªŒè¯ï¼Œé‚£ä¹ˆçœŸæ­£çš„å±é™©åœ¨äºï¼š<strong>ä»–èƒ½è°ƒç”¨åå°ç®¡ç† API åˆ é™¤æ•°æ®ã€‚</strong></p>
<hr/>
<h2 data-id="heading-4">äºŒã€å®‰å…¨æƒé™è®¾è®¡çš„æ ¸å¿ƒåŸåˆ™</h2>
<ol>
<li>
<p><strong>å‰ç«¯å±•ç¤ºï¼Œåç«¯å†³ç­–</strong></p>
<ul>
<li>å‰ç«¯åªèƒ½æ§åˆ¶ UI æ˜¯å¦æ˜¾ç¤ºæŸä¸ªæŒ‰é’®ï¼Œä¸åº”å†³å®šã€Œæ˜¯å¦å…è®¸æ‰§è¡ŒåŠ¨ä½œã€ã€‚</li>
<li>æ‰€æœ‰ä¸å®‰å…¨ç›¸å…³çš„é€»è¾‘ï¼ˆå¢åˆ æ”¹ã€æ•°æ®æŸ¥è¯¢ï¼‰å¿…é¡»ç”±åç«¯éªŒè¯ã€‚</li>
</ul>
</li>
<li>
<p><strong>æœåŠ¡ç«¯å¿…é¡»éªŒè¯æƒé™ + ç­¾å</strong></p>
<ul>
<li>åç«¯æ˜¯ã€Œå”¯ä¸€å¯ä¿¡ç¯å¢ƒã€ï¼Œåº”éªŒè¯è¯·æ±‚æ¥æºã€ç­¾åã€è§’è‰²ã€Tokenã€‚</li>
</ul>
</li>
<li>
<p><strong>æƒé™æ˜¯ã€Œè¢«åŠ¨åˆ¤å®šã€ï¼Œä¸æ˜¯ã€Œä¸»åŠ¨è®°å¿†ã€</strong></p>
<ul>
<li>ä¸ä¾èµ–å‰ç«¯æœ¬åœ°çŠ¶æ€ï¼ˆå¦‚ localStorageï¼‰ï¼›</li>
<li>æ¯æ¬¡è¯·æ±‚éƒ½åœ¨åç«¯é‡æ–°éªŒè¯èº«ä»½ã€‚</li>
</ul>
</li>
</ol>
<hr/>
<h2 data-id="heading-5">ä¸‰ã€å®‰å…¨æƒé™é˜²æŠ¤çš„åˆ†å±‚æ¶æ„</h2>
<p>ä¸ºäº†å®ç°å®‰å…¨çš„åˆ†å¸ƒå¼æƒé™ä½“ç³»ï¼Œæˆ‘ä»¬å¯ä»¥å°†ç³»ç»Ÿåˆ’åˆ†ä¸ºå…­å±‚ï¼š</p>








































<table><thead><tr><th>å±‚çº§</th><th>æè¿°</th><th>æ ¸å¿ƒé˜²æŠ¤ç­–ç•¥</th></tr></thead><tbody><tr><td><strong>â‘  å‰ç«¯å±•ç¤ºå±‚</strong></td><td>Vue / React åº”ç”¨</td><td>ä»…å±•ç¤ºåŠŸèƒ½ï¼Œä¸å­˜å‚¨é€»è¾‘ï¼›é™åˆ¶ Token æš´éœ²</td></tr><tr><td><strong>â‘¡ æ¥å…¥ä¸ç½‘å…³å±‚</strong></td><td>Nginx / Kong / API Gateway</td><td>é™æµã€é˜²çˆ¬ï¼›éªŒè¯ Token ç­¾åï¼›è¯·æ±‚æ—¥å¿—</td></tr><tr><td><strong>â‘¢ é‰´æƒæœåŠ¡å±‚</strong></td><td>OAuth2 / SSO Server</td><td>ç™»å½•æ€éªŒè¯ï¼›è§’è‰²ä¸ç§Ÿæˆ·åˆ¤æ–­ï¼›é¢å‘ JWT</td></tr><tr><td><strong>â‘£ èµ„æºæœåŠ¡å±‚</strong></td><td>å„ä¸šåŠ¡æ¨¡å—æœåŠ¡</td><td>æ ¸å¿ƒé€»è¾‘æ ¡éªŒï¼šRBAC / ABAC æƒé™åŒ¹é…</td></tr><tr><td><strong>â‘¤ æ•°æ®ä¸å®¡è®¡å±‚</strong></td><td>Databaseã€Redisã€ELK</td><td>è„±æ•ã€æœ€å°è®¿é—®ç­–ç•¥ã€æ“ä½œç•™ç—•</td></tr><tr><td><strong>â‘¥ å®‰å…¨ç›‘æ§å±‚</strong></td><td>SIEMã€Prometheus</td><td>é£æ§æ£€æµ‹ã€å‘Šè­¦ç­–ç•¥ã€å¼‚å¸¸åˆ†æ</td></tr></tbody></table>
<h3 data-id="heading-6">æ¶æ„å›¾</h3>
<p>ä¸‹å›¾å±•ç¤ºäº†å®Œæ•´é˜²æŠ¤åˆ†å±‚ç»“æ„ï¼ˆæ•°æ®æµç”±ä¸Šè‡³ä¸‹ï¼‰ï¼š</p>
<pre><code class="hljs language-css" lang="css">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          å®‰å…¨ç›‘æ§å±‚ï¼ˆSIEM/é£æ§ï¼‰     â”‚
â”‚  â€¢ ç™»å½•å¼‚å¸¸æ£€æµ‹  â€¢ æ”»å‡»å‘Šè­¦åˆ†æ     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â–²
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          æ•°æ®ä¸å®¡è®¡å±‚               â”‚
â”‚  â€¢ æ•°æ®æœ€å°æƒé™è®¿é—®                â”‚
â”‚  â€¢ å®¡è®¡æ—¥å¿—ä¸å®‰å…¨è¿½è¸ª              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â–²
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          èµ„æºæœåŠ¡å±‚ï¼ˆä¸šåŠ¡é€»è¾‘ï¼‰      â”‚
â”‚  â€¢ æ¥å£çº§æƒé™æ§åˆ¶ï¼ˆ<span class="hljs-keyword">@RoleBasedAccess</span>ï¼‰â”‚
â”‚  â€¢ é˜²è¶Šæƒã€æ“ä½œå®¡è®¡                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â–²
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          é‰´æƒæœåŠ¡å±‚ï¼ˆSSOï¼‰           â”‚
â”‚  â€¢ TokenéªŒè¯ã€è§’è‰²å‘æ”¾              â”‚
â”‚  â€¢ åŠ¨æ€æˆæƒã€ç§Ÿæˆ·éš”ç¦»               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â–²
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          æ¥å…¥ç½‘å…³å±‚ï¼ˆAPI Gatewayï¼‰   â”‚
â”‚  â€¢ é™æµã€é˜²çˆ¬ã€é˜²åˆ·                â”‚
â”‚  â€¢ HMACç­¾åéªŒè¯                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â–²
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          å‰ç«¯å±•ç¤ºå±‚ï¼ˆéä¿¡ä»»åŒºï¼‰      â”‚
â”‚  â€¢ ä»…å±•ç¤ºUIã€è¯»å–Tokenæé†’ç”¨æˆ·ç™»å½•   â”‚
â”‚  â€¢ ç¦æ­¢ä¸šåŠ¡é€»è¾‘åœ¨æœ¬åœ°æ‰§è¡Œ           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<hr/>
<h2 data-id="heading-7">å››ã€æŠ€æœ¯å®ç°</h2>
<h3 data-id="heading-8">1. åç«¯è§’è‰²æƒé™æ³¨è§£ç¤ºä¾‹</h3>
<pre><code class="hljs language-less" lang="less"><span class="hljs-comment">// è‡ªå®šä¹‰æ³¨è§£</span>
<span class="hljs-variable">@Target</span>(ElementType.METHOD)
<span class="hljs-variable">@Retention</span>(RetentionPolicy.RUNTIME)
public <span class="hljs-variable">@interface</span> RoleCheck {
    <span class="hljs-selector-tag">String</span><span class="hljs-selector-attr">[]</span> <span class="hljs-selector-tag">value</span>();
}
</code></pre>

<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// æ‹¦æˆªå™¨å®ç°</span>
<span class="hljs-meta">@Component</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RoleInterceptor</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">HandlerInterceptor</span> {
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">preHandle</span><span class="hljs-params">(HttpServletRequest req, HttpServletResponse res, Object handler)</span> {
        <span class="hljs-type">String</span> <span class="hljs-variable">token</span> <span class="hljs-operator">=</span> req.getHeader(<span class="hljs-string">"Authorization"</span>);
        <span class="hljs-type">User</span> <span class="hljs-variable">user</span> <span class="hljs-operator">=</span> TokenService.verify(token);
        <span class="hljs-type">RoleCheck</span> <span class="hljs-variable">check</span> <span class="hljs-operator">=</span> ((HandlerMethod) handler).getMethodAnnotation(RoleCheck.class);
        <span class="hljs-keyword">if</span> (check != <span class="hljs-literal">null</span> &amp;&amp; !user.hasAnyRole(check.value())) {
            res.setStatus(HttpServletResponse.SC_FORBIDDEN);
            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
        }
        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
    }
}
</code></pre>
<blockquote>
<p>ğŸ” å³ä¾¿æ”»å‡»è€…æ¨¡æ‹Ÿè¯·æ±‚æˆ–åç¼–è¯‘å‰ç«¯ï¼Œä¹Ÿæ— æ³•ç»•è¿‡åç«¯è§’è‰²è®¤è¯ã€‚</p>
</blockquote>
<hr/>
<h3 data-id="heading-9">2. å‰ç«¯ï¼šåŸºäºæƒé™çš„æ˜¾ç¤ºæ§åˆ¶ï¼ˆéé€»è¾‘æ§åˆ¶ï¼‰</h3>
<pre><code class="hljs language-ini" lang="ini">// å‡è®¾åç«¯è¿”å›çš„è§’è‰²ä¸º <span class="hljs-section">['user']</span>
const <span class="hljs-attr">userRoles</span> = [<span class="hljs-string">'user'</span>]<span class="hljs-comment">;</span>

const <span class="hljs-attr">routes</span> = [
  { name: <span class="hljs-string">'Dashboard'</span>, meta: { role: [<span class="hljs-string">'user'</span>, <span class="hljs-string">'admin'</span>] } },
  { name: <span class="hljs-string">'SystemConfig'</span>, meta: { role: [<span class="hljs-string">'admin'</span>] } }
]<span class="hljs-comment">;</span>

// ä»…å‰ç«¯æ¸²æŸ“æ§åˆ¶
const <span class="hljs-attr">visibleRoutes</span> = routes.filter(route =&gt;
  route.meta.role.some(<span class="hljs-attr">role</span> =&gt; userRoles.includes(role))
)<span class="hljs-comment">;</span>
</code></pre>
<blockquote>
<p>ä»…å½±å“ UI å±•ç¤ºï¼Œä¸å½±å“æ¥å£å¯è®¿é—®æ€§ã€‚</p>
</blockquote>
<hr/>
<h3 data-id="heading-10">3. é˜²åç¼–è¯‘ä¸æ”»å‡»åŠ å›º</h3>



































<table><thead><tr><th>æ”»å‡»æ–¹å¼</th><th>é˜²æŠ¤æªæ–½</th><th>å®è·µå·¥å…·</th></tr></thead><tbody><tr><td>æ‰“åŒ…JSè¢«é€†å‘</td><td>æ··æ·†ä¸ä»£ç å‹ç¼©</td><td><code>terser</code>, <code>webpack-obfuscator</code></td></tr><tr><td>Tokenç¯¡æ”¹</td><td>æœåŠ¡ç­¾åéªŒè¯ã€çŸ­æ—¶æ•ˆJWT</td><td>Redis / JWT RFC7519</td></tr><tr><td>æ¨¡æ‹Ÿæ¥å£</td><td>è¯·æ±‚ç­¾åï¼ˆHMAC / Nonceï¼‰</td><td>Nginx + Auth Filter</td></tr><tr><td>è°ƒè¯•æ³¨å…¥</td><td>Content-Security-Policy (CSP)</td><td>HTTP å®‰å…¨ç­–ç•¥å¤´</td></tr><tr><td>é‡æ”¾æ”»å‡»</td><td>æ—¶é—´æˆ³ + éšæœºNonceéªŒè¯</td><td>Redisç¼“å­˜æ ¡éªŒ</td></tr></tbody></table>
<p><strong>ç­¾åéªŒè¯ç¤ºä¾‹ï¼ˆNode.js HMACï¼‰</strong></p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> crypto <span class="hljs-keyword">from</span> <span class="hljs-string">'crypto'</span>;

<span class="hljs-keyword">function</span> <span class="hljs-title function_">signRequest</span>(<span class="hljs-params">payload, secret, timestamp</span>) {
  <span class="hljs-keyword">const</span> base = <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(payload) + timestamp;
  <span class="hljs-keyword">return</span> crypto.<span class="hljs-title function_">createHmac</span>(<span class="hljs-string">'sha256'</span>, secret).<span class="hljs-title function_">update</span>(base).<span class="hljs-title function_">digest</span>(<span class="hljs-string">'hex'</span>);
}
</code></pre>
<hr/>
<h2 data-id="heading-11">äº”ã€è®¾è®¡ä¼˜ç¼ºç‚¹åˆ†æ</h2>





























<table><thead><tr><th>æ¨¡å‹</th><th>ä¼˜ç‚¹</th><th>ç¼ºç‚¹</th><th>é€‚åˆåœºæ™¯</th></tr></thead><tbody><tr><td><strong>å‰ç«¯åˆ¤æ–­æƒé™</strong></td><td>ç®€å•ã€ä½“éªŒå¥½</td><td>æ˜“è¢«ç»•è¿‡ã€ä¸å®‰å…¨</td><td>ä»…ç”¨äº UI æ§åˆ¶</td></tr><tr><td><strong>åç«¯æ ¡éªŒæƒé™</strong></td><td>å®‰å…¨ã€é›†ä¸­ç®¡ç†</td><td>å¼€é”€ç¨é«˜ã€å“åº”æ»å</td><td>æ ¸å¿ƒä¸šåŠ¡æ¥å£</td></tr><tr><td><strong>åˆ†å±‚æ¶æ„æƒé™ä½“ç³»</strong></td><td>å®‰å…¨ä¸æ•ˆç‡å¹³è¡¡</td><td>æ¶æ„å¤æ‚ã€éœ€æ²»ç†</td><td>ä¼ä¸šçº§ä¸­å¤§å‹ç³»ç»Ÿ</td></tr></tbody></table>
<blockquote>
<p>âœ… æ¨èæ··åˆæ¶æ„ï¼šå‰ç«¯ä¿éšœä½“éªŒï¼Œåç«¯ä¿éšœå®‰å…¨ã€‚</p>
</blockquote>
<hr/>
<h2 data-id="heading-12">å…­ã€ç»“è®º</h2>
<p>åœ¨ Web åç¼–è¯‘å‡ ä¹æ— æ³•é¿å…çš„æ—¶ä»£ï¼Œ<strong>å®‰å…¨æ˜¯ç­–ç•¥ï¼Œä¸æ˜¯å¹»è§‰</strong>ã€‚</p>
<p>æƒé™æ§åˆ¶è¦ä»ã€Œä¿¡ä»»å‰ç«¯ã€è½¬å˜ä¸ºã€Œå‰åç«¯ååŒã€ã€‚<br/>
åªè¦ä¿æŒä»¥ä¸‹ä¸‰ç‚¹ï¼Œä½ çš„æƒé™ä½“ç³»å°±èƒ½åœ¨å¤æ‚çš„å®‰å…¨å½¢åŠ¿ä¸‹ç«‹äºä¸è´¥ä¹‹åœ°ï¼š</p>
<ol>
<li><strong>ä¸€åˆ‡æˆæƒæœ€ç»ˆè½åœ°åç«¯ï¼›</strong></li>
<li><strong>æ‰€æœ‰æ•æ„Ÿé€»è¾‘çš†å¯å®¡è®¡ï¼›</strong></li>
<li><strong>å‰åç«¯ä¹‹é—´çš„ä¿¡ä»»å…³ç³»å¯éªŒè¯ã€å¯æ’¤é”€ã€‚</strong></li>
</ol>
<p>æœªæ¥ï¼Œä¼´éš <strong>é›¶ä¿¡ä»»æ¶æ„ï¼ˆZero Trustï¼‰</strong> ä¸ <strong>åŠ¨æ€ç­–ç•¥æˆæƒï¼ˆPolicy-based Access Control, PBACï¼‰</strong> çš„å…´èµ·ï¼Œ<br/>
æƒé™å®‰å…¨å°†æ›´åŠ æ™ºèƒ½ä¸åˆ†å¸ƒåŒ–ã€‚å®‰å…¨ä»æ­¤ä¸æ˜¯é™„åŠ ï¼Œè€Œå°†æˆä¸ºä¸šåŠ¡æœ¬èº«çš„ä¸€éƒ¨åˆ†ã€‚</p>
<hr/>
<h2 data-id="heading-13">ä¸ƒã€å‚è€ƒèµ„æ–™</h2>
<ol>
<li>[OWASP Top 10 2021: Broken Access Control]</li>
<li>[Spring Security Reference Documentation]</li>
<li>[MDN Web Docs: Content Security Policy (CSP)]</li>
<li>[RFC 7519 â€“ JSON Web Token (JWT)]</li>
<li>[Zero Trust Architecture â€“ NIST SP 800-207]</li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Java åç«¯å®šæ—¶ä»»åŠ¡æ€ä¹ˆé€‰ï¼š@Scheduledã€Quartz è¿˜æ˜¯ XXL-Jobï¼Ÿ]]></title>    <link>https://juejin.cn/post/7603721514203316233</link>    <guid>https://juejin.cn/post/7603721514203316233</guid>    <pubDate>2026-02-08T06:51:17.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7603721514203316233" data-draft-id="7603687444052099110" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Java åç«¯å®šæ—¶ä»»åŠ¡æ€ä¹ˆé€‰ï¼š@Scheduledã€Quartz è¿˜æ˜¯ XXL-Jobï¼Ÿ"/> <meta itemprop="keywords" content="åç«¯"/> <meta itemprop="datePublished" content="2026-02-08T06:51:17.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Javaç¼–ç¨‹çˆ±å¥½è€…"/> <meta itemprop="url" content="https://juejin.cn/user/819554264300154"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Java åç«¯å®šæ—¶ä»»åŠ¡æ€ä¹ˆé€‰ï¼š@Scheduledã€Quartz è¿˜æ˜¯ XXL-Jobï¼Ÿ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/819554264300154/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Javaç¼–ç¨‹çˆ±å¥½è€…
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-08T06:51:17.000Z" title="Sun Feb 08 2026 06:51:17 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»5åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>åšåç«¯æ€»ç»•ä¸å¼€â€œå®šæ—¶ä»»åŠ¡â€ï¼šå¯¹è´¦ã€<a href="https://link.juejin.cn?target=https%3A%2F%2Fzhida.zhihu.com%2Fsearch%3Fcontent_id%3D270088628%26content_type%3DArticle%26match_order%3D1%26q%3D%25E6%2595%25B0%25E6%258D%25AE%25E6%25B8%2585%25E7%2590%2586%26zhida_source%3Dentity" target="_blank" title="https://zhida.zhihu.com/search?content_id=270088628&amp;content_type=Article&amp;match_order=1&amp;q=%E6%95%B0%E6%8D%AE%E6%B8%85%E7%90%86&amp;zhida_source=entity" ref="nofollow noopener noreferrer">æ•°æ®æ¸…ç†</a>ã€å‘åˆ¸ã€è¡¥å¿ã€åŒæ­¥â€¦â€¦</p>
<p>ä½†ä¸€åˆ°<a href="https://link.juejin.cn?target=https%3A%2F%2Fzhida.zhihu.com%2Fsearch%3Fcontent_id%3D270088628%26content_type%3DArticle%26match_order%3D1%26q%3D%25E5%25BE%25AE%25E6%259C%258D%25E5%258A%25A1%26zhida_source%3Dentity" target="_blank" title="https://zhida.zhihu.com/search?content_id=270088628&amp;content_type=Article&amp;match_order=1&amp;q=%E5%BE%AE%E6%9C%8D%E5%8A%A1&amp;zhida_source=entity" ref="nofollow noopener noreferrer">å¾®æœåŠ¡</a>/å¤šå®ä¾‹éƒ¨ç½²ï¼Œå¾ˆå¤šåŒå­¦å°±å¼€å§‹è¸©å‘ï¼š<strong>åŒä¸€ä»»åŠ¡åœ¨æ¯å°æœºå™¨éƒ½è·‘ä¸€éï¼ˆé‡å¤æ‰§è¡Œï¼‰</strong> ã€æŸå°æœºå™¨æŒ‚äº†ä»»åŠ¡å°±æ–­äº†ï¼ˆ<a href="https://link.juejin.cn?target=https%3A%2F%2Fzhida.zhihu.com%2Fsearch%3Fcontent_id%3D270088628%26content_type%3DArticle%26match_order%3D1%26q%3D%25E5%258D%2595%25E7%2582%25B9%25E6%2595%2585%25E9%259A%259C%26zhida_source%3Dentity" target="_blank" title="https://zhida.zhihu.com/search?content_id=270088628&amp;content_type=Article&amp;match_order=1&amp;q=%E5%8D%95%E7%82%B9%E6%95%85%E9%9A%9C&amp;zhida_source=entity" ref="nofollow noopener noreferrer">å•ç‚¹æ•…éšœ</a>ï¼‰ã€ä»»åŠ¡å¤ªä¹…æŠŠ<a href="https://link.juejin.cn?target=https%3A%2F%2Fzhida.zhihu.com%2Fsearch%3Fcontent_id%3D270088628%26content_type%3DArticle%26match_order%3D1%26q%3D%25E8%25B0%2583%25E5%25BA%25A6%25E7%25BA%25BF%25E7%25A8%258B%26zhida_source%3Dentity" target="_blank" title="https://zhida.zhihu.com/search?content_id=270088628&amp;content_type=Article&amp;match_order=1&amp;q=%E8%B0%83%E5%BA%A6%E7%BA%BF%E7%A8%8B&amp;zhida_source=entity" ref="nofollow noopener noreferrer">è°ƒåº¦çº¿ç¨‹</a>å¡æ­»ï¼ˆåé¢å…¨å µï¼‰â€¦â€¦</p>
<hr/>
<h2 data-id="heading-0">â€œå•æœºé—¹é’Ÿâ€è¿˜æ˜¯â€œ<a href="https://link.juejin.cn?target=https%3A%2F%2Fzhida.zhihu.com%2Fsearch%3Fcontent_id%3D270088628%26content_type%3DArticle%26match_order%3D1%26q%3D%25E5%2588%2586%25E5%25B8%2583%25E5%25BC%258F%25E8%25B0%2583%25E5%25BA%25A6%26zhida_source%3Dentity" target="_blank" title="https://zhida.zhihu.com/search?content_id=270088628&amp;content_type=Article&amp;match_order=1&amp;q=%E5%88%86%E5%B8%83%E5%BC%8F%E8%B0%83%E5%BA%A6&amp;zhida_source=entity" ref="nofollow noopener noreferrer">åˆ†å¸ƒå¼è°ƒåº¦</a>â€ï¼Ÿ</h2>
<ul>
<li>
<p>â€¢Â <strong>å•æœºå®šæ—¶ä»»åŠ¡</strong>ï¼šåº”ç”¨åªéƒ¨ç½² 1 å°ï¼ˆæˆ–æ˜ç¡®åªå…è®¸ 1 å°è·‘ä»»åŠ¡ï¼‰ã€‚<br/>
âœ… è¿™ç±»ä»»åŠ¡è¿½æ±‚â€œç®€å•ã€å¿«ã€å°‘ä¾èµ–â€ã€‚</p>
</li>
<li>
<p>â€¢Â <strong>åˆ†å¸ƒå¼/<a href="https://link.juejin.cn?target=https%3A%2F%2Fzhida.zhihu.com%2Fsearch%3Fcontent_id%3D270088628%26content_type%3DArticle%26match_order%3D1%26q%3D%25E9%259B%2586%25E7%25BE%25A4%26zhida_source%3Dentity" target="_blank" title="https://zhida.zhihu.com/search?content_id=270088628&amp;content_type=Article&amp;match_order=1&amp;q=%E9%9B%86%E7%BE%A4&amp;zhida_source=entity" ref="nofollow noopener noreferrer">é›†ç¾¤</a>å®šæ—¶ä»»åŠ¡</strong>ï¼šåº”ç”¨éƒ¨ç½² N å°ã€ä¼šæ‰©ç¼©å®¹ã€ä¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fzhida.zhihu.com%2Fsearch%3Fcontent_id%3D270088628%26content_type%3DArticle%26match_order%3D1%26q%3D%25E6%2595%2585%25E9%259A%259C%25E8%25BD%25AC%25E7%25A7%25BB%26zhida_source%3Dentity" target="_blank" title="https://zhida.zhihu.com/search?content_id=270088628&amp;content_type=Article&amp;match_order=1&amp;q=%E6%95%85%E9%9A%9C%E8%BD%AC%E7%A7%BB&amp;zhida_source=entity" ref="nofollow noopener noreferrer">æ•…éšœè½¬ç§»</a>ã€‚<br/>
âœ… è¿™ç±»ä»»åŠ¡è¿½æ±‚â€œåªæ‰§è¡Œä¸€æ¬¡ã€å¯è§‚æµ‹ã€å¯è¿ç»´â€ã€‚</p>
</li>
</ul>
<p><strong>åœ¨é›†ç¾¤é‡Œï¼Œå•æœºæ–¹æ¡ˆé»˜è®¤=æ¯å°éƒ½æ‰§è¡Œ</strong>ï¼Œä¸åšæ§åˆ¶å°±ä¼šé‡å¤è·‘ã€‚</p>
<hr/>
<h2 data-id="heading-1">ä¸‰ä¸ªæ–¹æ¡ˆ</h2>
<h3 data-id="heading-2">1ï¼‰<a href="https://link.juejin.cn?target=https%3A%2F%2Fzhida.zhihu.com%2Fsearch%3Fcontent_id%3D270088628%26content_type%3DArticle%26match_order%3D1%26q%3D%2540Scheduled%26zhida_source%3Dentity" target="_blank" title="https://zhida.zhihu.com/search?content_id=270088628&amp;content_type=Article&amp;match_order=1&amp;q=%40Scheduled&amp;zhida_source=entity" ref="nofollow noopener noreferrer">@Scheduled</a>ï¼šSpring è‡ªå¸¦çš„è½»é‡æ–¹æ¡ˆï¼ˆå•æœºä¼˜å…ˆï¼‰</h3>
<p>å°±æ˜¯ç»™æ–¹æ³•åŠ ä¸ªæ³¨è§£ï¼šcron / fixedRate / fixedDelayï¼Œç«‹åˆ»èƒ½è·‘ã€‚<br/>
ä¼˜ç‚¹ï¼šé›¶é¢å¤–<a href="https://link.juejin.cn?target=https%3A%2F%2Fzhida.zhihu.com%2Fsearch%3Fcontent_id%3D270088628%26content_type%3DArticle%26match_order%3D1%26q%3D%25E4%25B8%25AD%25E9%2597%25B4%25E4%25BB%25B6%26zhida_source%3Dentity" target="_blank" title="https://zhida.zhihu.com/search?content_id=270088628&amp;content_type=Article&amp;match_order=1&amp;q=%E4%B8%AD%E9%97%B4%E4%BB%B6&amp;zhida_source=entity" ref="nofollow noopener noreferrer">ä¸­é—´ä»¶</a>ã€å’Œ Spring ç”Ÿæ€è´´åˆã€‚</p>
<p>çŸ­æ¿ï¼š<strong>å¤©ç”Ÿä¸ç®¡é›†ç¾¤</strong>ï¼ˆå¤šå®ä¾‹å°±å¤šä»½é—¹é’Ÿï¼‰ã€åŸºæœ¬æ²¡<a href="https://link.juejin.cn?target=https%3A%2F%2Fzhida.zhihu.com%2Fsearch%3Fcontent_id%3D270088628%26content_type%3DArticle%26match_order%3D1%26q%3D%25E5%258F%25AF%25E8%25A7%2586%25E5%258C%2596%26zhida_source%3Dentity" target="_blank" title="https://zhida.zhihu.com/search?content_id=270088628&amp;content_type=Article&amp;match_order=1&amp;q=%E5%8F%AF%E8%A7%86%E5%8C%96&amp;zhida_source=entity" ref="nofollow noopener noreferrer">å¯è§†åŒ–</a>ã€æƒ³æ”¹è§„åˆ™é€šå¸¸è¦èµ°å‘å¸ƒæµç¨‹ã€‚</p>
<blockquote>
<p>æé†’ï¼šåŒä¸€ä¸ªæ–¹æ³•å¯ä»¥å£°æ˜å¤šä¸ª @Scheduledï¼Œ<a href="https://link.juejin.cn?target=https%3A%2F%2Fzhida.zhihu.com%2Fsearch%3Fcontent_id%3D270088628%26content_type%3DArticle%26match_order%3D1%26q%3D%25E8%25A7%25A6%25E5%258F%2591%25E5%2599%25A8%26zhida_source%3Dentity" target="_blank" title="https://zhida.zhihu.com/search?content_id=270088628&amp;content_type=Article&amp;match_order=1&amp;q=%E8%A7%A6%E5%8F%91%E5%99%A8&amp;zhida_source=entity" ref="nofollow noopener noreferrer">è§¦å‘å™¨</a>å½¼æ­¤ç‹¬ç«‹ï¼Œç”šè‡³å¯èƒ½å¹¶å‘/è¿ç»­è§¦å‘ã€‚</p>
</blockquote>
<hr/>
<h3 data-id="heading-3">2ï¼‰<a href="https://link.juejin.cn?target=https%3A%2F%2Fzhida.zhihu.com%2Fsearch%3Fcontent_id%3D270088628%26content_type%3DArticle%26match_order%3D1%26q%3DQuartz%26zhida_source%3Dentity" target="_blank" title="https://zhida.zhihu.com/search?content_id=270088628&amp;content_type=Article&amp;match_order=1&amp;q=Quartz&amp;zhida_source=entity" ref="nofollow noopener noreferrer">Quartz</a>ï¼šè€ç‰Œã€çµæ´»ã€å¯é›†ç¾¤ï¼ˆä½†â€œåæ¡†æ¶â€ï¼‰</h3>
<p>Quartz çš„æ ¸å¿ƒæ˜¯Â <strong><a href="https://link.juejin.cn?target=https%3A%2F%2Fzhida.zhihu.com%2Fsearch%3Fcontent_id%3D270088628%26content_type%3DArticle%26match_order%3D1%26q%3DScheduler%26zhida_source%3Dentity" target="_blank" title="https://zhida.zhihu.com/search?content_id=270088628&amp;content_type=Article&amp;match_order=1&amp;q=Scheduler&amp;zhida_source=entity" ref="nofollow noopener noreferrer">Scheduler</a>ï¼ˆ<a href="https://link.juejin.cn?target=https%3A%2F%2Fzhida.zhihu.com%2Fsearch%3Fcontent_id%3D270088628%26content_type%3DArticle%26match_order%3D1%26q%3D%25E8%25B0%2583%25E5%25BA%25A6%25E5%2599%25A8%26zhida_source%3Dentity" target="_blank" title="https://zhida.zhihu.com/search?content_id=270088628&amp;content_type=Article&amp;match_order=1&amp;q=%E8%B0%83%E5%BA%A6%E5%99%A8&amp;zhida_source=entity" ref="nofollow noopener noreferrer">è°ƒåº¦å™¨</a>ï¼‰+ Jobï¼ˆä»»åŠ¡ï¼‰+Â <a href="https://link.juejin.cn?target=https%3A%2F%2Fzhida.zhihu.com%2Fsearch%3Fcontent_id%3D270088628%26content_type%3DArticle%26match_order%3D1%26q%3DTrigger%26zhida_source%3Dentity" target="_blank" title="https://zhida.zhihu.com/search?content_id=270088628&amp;content_type=Article&amp;match_order=1&amp;q=Trigger&amp;zhida_source=entity" ref="nofollow noopener noreferrer">Trigger</a>ï¼ˆè§¦å‘å™¨ï¼‰</strong> ï¼Œèƒ½åŠ›éå¸¸å…¨ã€‚<br/>
å®ƒä¹Ÿæ”¯æŒé›†ç¾¤ï¼Œä½†éœ€è¦Â <strong><a href="https://link.juejin.cn?target=https%3A%2F%2Fzhida.zhihu.com%2Fsearch%3Fcontent_id%3D270088628%26content_type%3DArticle%26match_order%3D1%26q%3DJDBC%2BJobStore%26zhida_source%3Dentity" target="_blank" title="https://zhida.zhihu.com/search?content_id=270088628&amp;content_type=Article&amp;match_order=1&amp;q=JDBC+JobStore&amp;zhida_source=entity" ref="nofollow noopener noreferrer">JDBC JobStore</a>Â +Â <a href="https://link.juejin.cn?target=https%3A%2F%2Fzhida.zhihu.com%2Fsearch%3Fcontent_id%3D270088628%26content_type%3DArticle%26match_order%3D1%26q%3D%25E5%2585%25B1%25E4%25BA%25AB%25E6%2595%25B0%25E6%258D%25AE%25E5%25BA%2593%26zhida_source%3Dentity" target="_blank" title="https://zhida.zhihu.com/search?content_id=270088628&amp;content_type=Article&amp;match_order=1&amp;q=%E5%85%B1%E4%BA%AB%E6%95%B0%E6%8D%AE%E5%BA%93&amp;zhida_source=entity" ref="nofollow noopener noreferrer">å…±äº«æ•°æ®åº“</a>Â + é”</strong>Â æ¥ä¿è¯åŒä¸€è§¦å‘ç‚¹åªè·‘ä¸€æ¬¡ï¼šå¤šä¸ªèŠ‚ç‚¹æŠ¢åˆ°é”çš„é‚£ä¸ªèŠ‚ç‚¹æ‰§è¡Œã€‚</p>
<p>ä¼˜ç‚¹ï¼šèƒ½åŠ›å¼ºã€æ¨¡å‹æˆç†Ÿã€å¯<a href="https://link.juejin.cn?target=https%3A%2F%2Fzhida.zhihu.com%2Fsearch%3Fcontent_id%3D270088628%26content_type%3DArticle%26match_order%3D1%26q%3D%25E6%25B7%25B1%25E5%25BA%25A6%25E5%25AE%259A%25E5%2588%25B6%26zhida_source%3Dentity" target="_blank" title="https://zhida.zhihu.com/search?content_id=270088628&amp;content_type=Article&amp;match_order=1&amp;q=%E6%B7%B1%E5%BA%A6%E5%AE%9A%E5%88%B6&amp;zhida_source=entity" ref="nofollow noopener noreferrer">æ·±åº¦å®šåˆ¶</a>ã€‚<br/>
çŸ­æ¿ï¼šåŸç”Ÿä¸å¸¦ç®¡ç†åå°ï¼Œ<strong>é›†ç¾¤é…ç½®/è¿ç»´æˆæœ¬æ›´é«˜</strong>ã€‚</p>
<hr/>
<h3 data-id="heading-4">3ï¼‰XXL-Jobï¼šå¼€ç®±å³ç”¨çš„åˆ†å¸ƒå¼è°ƒåº¦å¹³å°ï¼ˆåâ€œäº§å“â€ï¼‰</h3>
<p>XXL-Job æ›´åƒâ€œå¸¦åå°çš„è°ƒåº¦ç³»ç»Ÿâ€ï¼š</p>
<ul>
<li>
<p>â€¢ Web é¡µé¢ç›´æ¥Â <a href="https://link.juejin.cn?target=https%3A%2F%2Fzhida.zhihu.com%2Fsearch%3Fcontent_id%3D270088628%26content_type%3DArticle%26match_order%3D1%26q%3DCRUD%26zhida_source%3Dentity" target="_blank" title="https://zhida.zhihu.com/search?content_id=270088628&amp;content_type=Article&amp;match_order=1&amp;q=CRUD&amp;zhida_source=entity" ref="nofollow noopener noreferrer">CRUD</a>Â ä»»åŠ¡ï¼Œä¿®æ”¹å<strong>å³æ—¶ç”Ÿæ•ˆ</strong></p>
</li>
<li>
<p>â€¢Â <a href="https://link.juejin.cn?target=https%3A%2F%2Fzhida.zhihu.com%2Fsearch%3Fcontent_id%3D270088628%26content_type%3DArticle%26match_order%3D1%26q%3D%25E8%25B0%2583%25E5%25BA%25A6%25E4%25B8%25AD%25E5%25BF%2583%26zhida_source%3Dentity" target="_blank" title="https://zhida.zhihu.com/search?content_id=270088628&amp;content_type=Article&amp;match_order=1&amp;q=%E8%B0%83%E5%BA%A6%E4%B8%AD%E5%BF%83&amp;zhida_source=entity" ref="nofollow noopener noreferrer">è°ƒåº¦ä¸­å¿ƒ</a>ã€æ‰§è¡Œå™¨éƒ½æ”¯æŒé›†ç¾¤ HA</p>
</li>
<li>
<p>â€¢ æ”¯æŒåˆ†ç‰‡å¹¿æ’­ã€æ•…éšœè½¬ç§»ã€<a href="https://link.juejin.cn?target=https%3A%2F%2Fzhida.zhihu.com%2Fsearch%3Fcontent_id%3D270088628%26content_type%3DArticle%26match_order%3D1%26q%3D%25E5%259C%25A8%25E7%25BA%25BF%25E6%2597%25A5%25E5%25BF%2597%26zhida_source%3Dentity" target="_blank" title="https://zhida.zhihu.com/search?content_id=270088628&amp;content_type=Article&amp;match_order=1&amp;q=%E5%9C%A8%E7%BA%BF%E6%97%A5%E5%BF%97&amp;zhida_source=entity" ref="nofollow noopener noreferrer">åœ¨çº¿æ—¥å¿—</a>ç­‰</p>
</li>
<li>
<p>â€¢ é€šè¿‡ DB é”ä¿è¯â€œä¸€æ¬¡è°ƒåº¦åªè§¦å‘ä¸€æ¬¡æ‰§è¡Œâ€</p>
</li>
</ul>
<p>ä¼˜ç‚¹ï¼šä¸Šæ‰‹å¿«ã€å¯è§†åŒ–å¼ºã€åˆ†å¸ƒå¼èƒ½åŠ›é½ã€‚<br/>
å±€é™ï¼šä»»åŠ¡æ¨¡å‹/è¿è¡Œæ–¹å¼ç›¸å¯¹å›ºå®šï¼Œ<strong>è¶…æ·±åº¦å®šåˆ¶</strong>å¯èƒ½è¦è¯»æºç æˆ–äºŒå¼€ã€‚</p>
<hr/>
<h2 data-id="heading-5">æ ¸å¿ƒ<a href="https://link.juejin.cn?target=https%3A%2F%2Fzhida.zhihu.com%2Fsearch%3Fcontent_id%3D270088628%26content_type%3DArticle%26match_order%3D1%26q%3D%25E7%25BB%25B4%25E5%25BA%25A6%26zhida_source%3Dentity" target="_blank" title="https://zhida.zhihu.com/search?content_id=270088628&amp;content_type=Article&amp;match_order=1&amp;q=%E7%BB%B4%E5%BA%A6&amp;zhida_source=entity" ref="nofollow noopener noreferrer">ç»´åº¦</a>å¯¹æ¯”ï¼ˆå¿«é€Ÿçœ‹æ‡‚ç‰ˆï¼‰</h2>









































<table><thead><tr><th>ç»´åº¦</th><th>@Scheduled</th><th>Quartz</th><th>XXL-Job</th></tr></thead><tbody><tr><td>ä¾èµ–/å¼•å…¥æˆæœ¬</td><td>æœ€ä½ï¼ˆSpring å†…ç½®ï¼‰</td><td>ä¸­ï¼ˆå¼•å…¥æ¡†æ¶ + æŒä¹…åŒ–/é›†ç¾¤è¦é… DBï¼‰</td><td>ä¸­ï¼ˆè°ƒåº¦ä¸­å¿ƒ + æ‰§è¡Œå™¨ï¼‰</td></tr><tr><td>å¯è§†åŒ–/è¿ç»´</td><td>åŸºæœ¬æ²¡æœ‰</td><td>åŸç”Ÿæ²¡æœ‰ï¼ˆé€šå¸¸è¦è‡ªå»ºï¼‰</td><td>è‡ªå¸¦ Web ç®¡ç†åå°</td></tr><tr><td>é›†ç¾¤ä¸‹â€œåªè·‘ä¸€æ¬¡â€</td><td>ä¸æ”¯æŒï¼ˆéœ€ä½ è‡ªå·±åŠ é”/é€‰ä¸»ï¼‰</td><td>æ”¯æŒï¼ˆJDBC é›†ç¾¤ + DB é”ï¼‰</td><td>åŸç”Ÿæ”¯æŒï¼ˆDB é”ä¸€è‡´æ€§ï¼‰</td></tr><tr><td>åŠ¨æ€ä¿®æ”¹è§„åˆ™</td><td>é€šå¸¸è¦å‘å¸ƒ/é‡å¯</td><td>æ”¯æŒÂ <a href="https://link.juejin.cn?target=https%3A%2F%2Fzhida.zhihu.com%2Fsearch%3Fcontent_id%3D270088628%26content_type%3DArticle%26match_order%3D1%26q%3DAPI%26zhida_source%3Dentity" target="_blank" title="https://zhida.zhihu.com/search?content_id=270088628&amp;content_type=Article&amp;match_order=1&amp;q=API&amp;zhida_source=entity" ref="nofollow noopener noreferrer">API</a>Â åŠ¨æ€æ”¹ Trigger</td><td>é¡µé¢æ”¹å®Œå³æ—¶ç”Ÿæ•ˆ</td></tr><tr><td>é€‚åˆåœºæ™¯</td><td>å•æœºã€å°ä»»åŠ¡ã€å¿«é€Ÿå®ç°</td><td>è€ç³»ç»Ÿ/å¼ºå®šåˆ¶/å¤æ‚è§¦å‘éœ€æ±‚</td><td>åˆ†å¸ƒå¼ã€æƒ³çœè¿ç»´ã€å›¢é˜Ÿäººæ‰‹ä¸å¤š</td></tr></tbody></table>
<hr/>
<h2 data-id="heading-6">å¸¸è§â€œå‘ç‚¹â€ä¸é¿å‘å»ºè®®</h2>
<h3 data-id="heading-7">A. @Scheduled çš„å‘ï¼ˆæœ€å®¹æ˜“è¢«å¿½ç•¥ï¼‰</h3>
<ol>
<li>
<p>1.Â <strong>é»˜è®¤è°ƒåº¦çº¿ç¨‹å°‘ï¼Œä»»åŠ¡ä¼šäº’ç›¸å µ</strong><br/>
<a href="https://link.juejin.cn?target=https%3A%2F%2Fzhida.zhihu.com%2Fsearch%3Fcontent_id%3D270088628%26content_type%3DArticle%26match_order%3D1%26q%3DSpring%2BBoot%26zhida_source%3Dentity" target="_blank" title="https://zhida.zhihu.com/search?content_id=270088628&amp;content_type=Article&amp;match_order=1&amp;q=Spring+Boot&amp;zhida_source=entity" ref="nofollow noopener noreferrer">Spring Boot</a>Â é»˜è®¤çš„è°ƒåº¦å™¨ï¼ˆThreadPoolTaskSchedulerï¼‰<strong>é»˜è®¤åªæœ‰ 1 ä¸ªçº¿ç¨‹</strong>ï¼Œä¸€ä¸ªä»»åŠ¡è·‘ä¹…äº†ï¼Œåé¢çš„å®šæ—¶ä»»åŠ¡å¯èƒ½æ’é˜Ÿç­‰ã€‚<br/>
âœ… å»ºè®®ï¼šæ˜¾å¼é…ç½® schedulingÂ <a href="https://link.juejin.cn?target=https%3A%2F%2Fzhida.zhihu.com%2Fsearch%3Fcontent_id%3D270088628%26content_type%3DArticle%26match_order%3D1%26q%3D%25E7%25BA%25BF%25E7%25A8%258B%25E6%25B1%25A0%26zhida_source%3Dentity" target="_blank" title="https://zhida.zhihu.com/search?content_id=270088628&amp;content_type=Article&amp;match_order=1&amp;q=%E7%BA%BF%E7%A8%8B%E6%B1%A0&amp;zhida_source=entity" ref="nofollow noopener noreferrer">çº¿ç¨‹æ± </a>å¤§å°ï¼ˆè‡³å°‘è®©â€œæ…¢ä»»åŠ¡â€ä¸æ‹–æ­»å…¨å±€ï¼‰ã€‚</p>
</li>
<li>
<p>2.Â <strong>fixedRate vs fixedDelay ç”¨é”™ï¼ŒèŠ‚å¥å°±ä¹±äº†</strong></p>
</li>
</ol>
<ul>
<li>
<p>â€¢ fixedRateï¼šæŒ‰â€œå›ºå®šé¢‘ç‡â€è§¦å‘ï¼ˆæ›´åƒæ¯éš” X ç§’å°±å¼€å§‹ä¸€æ¬¡ï¼‰</p>
</li>
<li>
<p>â€¢ fixedDelayï¼šæŒ‰â€œä¸Šä¸€æ¬¡ç»“æŸåå†ç­‰ X ç§’â€<br/>
âœ… å»ºè®®ï¼šæƒ³â€œå‡†ç‚¹â€ç”¨ fixedRate/cronï¼›æƒ³â€œä¸²è¡Œä¸”ç•™é—´éš”â€ç”¨ fixedDelayã€‚</p>
</li>
</ul>
<ol>
<li>3.Â <strong>é›†ç¾¤é‡å¤æ‰§è¡Œ</strong><br/>
å¤šå®ä¾‹éƒ¨ç½²æ—¶ï¼Œæ¯å°éƒ½ä¼šè§¦å‘ã€‚<br/>
âœ… å»ºè®®ï¼ˆæ‹©ä¸€ï¼‰ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fzhida.zhihu.com%2Fsearch%3Fcontent_id%3D270088628%26content_type%3DArticle%26match_order%3D1%26q%3D%25E5%2588%2586%25E5%25B8%2583%25E5%25BC%258F%25E9%2594%2581%26zhida_source%3Dentity" target="_blank" title="https://zhida.zhihu.com/search?content_id=270088628&amp;content_type=Article&amp;match_order=1&amp;q=%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81&amp;zhida_source=entity" ref="nofollow noopener noreferrer">åˆ†å¸ƒå¼é”</a>ã€Leader é€‰ä¸¾ã€æˆ–æŠŠä»»åŠ¡è¿ç§»åˆ°åˆ†å¸ƒå¼è°ƒåº¦å¹³å°ã€‚</li>
</ol>
<hr/>
<h3 data-id="heading-8">B. Quartz çš„å‘ï¼ˆé›†ä¸­åœ¨é›†ç¾¤ä¸ç¨³å®šæ€§ï¼‰</h3>
<ol>
<li>
<p>1.Â <strong>é›†ç¾¤å¿…é¡»ç”¨ JDBC JobStore + å…±äº« DB</strong><br/>
Quartz çš„é›†ç¾¤ä¾èµ–å…±äº«æ•°æ®åº“ä¸<a href="https://link.juejin.cn?target=https%3A%2F%2Fzhida.zhihu.com%2Fsearch%3Fcontent_id%3D270088628%26content_type%3DArticle%26match_order%3D1%26q%3D%25E9%2594%2581%25E6%259C%25BA%25E5%2588%25B6%26zhida_source%3Dentity" target="_blank" title="https://zhida.zhihu.com/search?content_id=270088628&amp;content_type=Article&amp;match_order=1&amp;q=%E9%94%81%E6%9C%BA%E5%88%B6&amp;zhida_source=entity" ref="nofollow noopener noreferrer">é”æœºåˆ¶</a>ï¼›è€Œä¸”èŠ‚ç‚¹è¶Šå¤šï¼Œé”ç«äº‰è¶Šæ˜æ˜¾ï¼Œæ–‡æ¡£ä¹Ÿæé†’æ‰©åˆ°å¾ˆå¤šèŠ‚ç‚¹æ€§èƒ½ä¼šä¸‹é™ã€‚<br/>
âœ… å»ºè®®ï¼šQuartz é›†ç¾¤åˆ«ç›²ç›®åŠ èŠ‚ç‚¹ï¼Œå…ˆè¯„ä¼°è°ƒåº¦å¯†åº¦ä¸ DB æ‰¿è½½ã€‚</p>
</li>
<li>
<p>2.Â <strong>æ—¶é—´ä¸åŒæ­¥ä¼šå‡ºå¤§äº‹</strong><br/>
å®˜æ–¹æ˜ç¡®æé†’ï¼šé›†ç¾¤æœºå™¨æ—¶é’Ÿå¿…é¡»åŒæ­¥åˆ°â€œç§’çº§â€ã€‚<br/>
âœ… å»ºè®®ï¼šNTP/chrony åšå¥½<a href="https://link.juejin.cn?target=https%3A%2F%2Fzhida.zhihu.com%2Fsearch%3Fcontent_id%3D270088628%26content_type%3DArticle%26match_order%3D1%26q%3D%25E6%2597%25B6%25E9%2597%25B4%25E5%2590%258C%25E6%25AD%25A5%26zhida_source%3Dentity" target="_blank" title="https://zhida.zhihu.com/search?content_id=270088628&amp;content_type=Article&amp;match_order=1&amp;q=%E6%97%B6%E9%97%B4%E5%90%8C%E6%AD%A5&amp;zhida_source=entity" ref="nofollow noopener noreferrer">æ—¶é—´åŒæ­¥</a>ï¼Œåˆ«æ‹¿â€œå·®å‡ ç§’æ²¡äº‹â€èµŒç³»ç»Ÿç¨³å®šã€‚</p>
</li>
<li>
<p>3.Â <strong>Misfireï¼ˆé”™è¿‡è§¦å‘ï¼‰æ²¡ç†è§£ï¼Œä»»åŠ¡å¯èƒ½â€œè¡¥è·‘/ä¸è·‘â€</strong><br/>
Quartz æ–‡æ¡£è§£é‡Šï¼šå½“æŒä¹…åŒ– Trigger å› ä¸ºè°ƒåº¦å™¨å…³é—­æˆ–çº¿ç¨‹ä¸è¶³ç­‰åŸå› é”™è¿‡è§¦å‘æ—¶é—´ï¼Œå°±ä¼šå‘ç”ŸÂ <a href="https://link.juejin.cn?target=https%3A%2F%2Fzhida.zhihu.com%2Fsearch%3Fcontent_id%3D270088628%26content_type%3DArticle%26match_order%3D1%26q%3Dmisfire%26zhida_source%3Dentity" target="_blank" title="https://zhida.zhihu.com/search?content_id=270088628&amp;content_type=Article&amp;match_order=1&amp;q=misfire&amp;zhida_source=entity" ref="nofollow noopener noreferrer">misfire</a>ï¼Œå¹¶æŒ‰Â <a href="https://link.juejin.cn?target=https%3A%2F%2Fzhida.zhihu.com%2Fsearch%3Fcontent_id%3D270088628%26content_type%3DArticle%26match_order%3D1%26q%3Dmisfire%2B%25E7%25AD%2596%25E7%2595%25A5%26zhida_source%3Dentity" target="_blank" title="https://zhida.zhihu.com/search?content_id=270088628&amp;content_type=Article&amp;match_order=1&amp;q=misfire+%E7%AD%96%E7%95%A5&amp;zhida_source=entity" ref="nofollow noopener noreferrer">misfire ç­–ç•¥</a>å¤„ç†ã€‚<br/>
âœ… å»ºè®®ï¼šå¯¹å…³é”®ä»»åŠ¡æ˜ç¡®é…ç½® misfire ç­–ç•¥ï¼Œåˆ«å®Œå…¨ä¾èµ–é»˜è®¤â€œsmart policyâ€ã€‚</p>
</li>
</ol>
<hr/>
<h3 data-id="heading-9">C. XXL-Job çš„å‘ï¼ˆé›†ä¸­åœ¨â€œå¹³å°åŒ–è½åœ°â€ï¼‰</h3>
<ol>
<li>
<p>1.Â <strong>è°ƒåº¦ä¸­å¿ƒ/æ‰§è¡Œå™¨å°½é‡ç‰ˆæœ¬ä¸€è‡´</strong><br/>
è¿™æ˜¯å¤§é‡å›¢é˜Ÿçš„çœŸå®ç»éªŒï¼šç‰ˆæœ¬ä¸ä¸€è‡´æ—¶å®¹æ˜“å‡ºç°åè®®/å­—æ®µä¸åŒ¹é…ç­‰â€œç„å­¦é—®é¢˜â€ã€‚<br/>
âœ… å»ºè®®ï¼šç»Ÿä¸€ç‰ˆæœ¬å‘å¸ƒï¼Œè‡³å°‘ä¿æŒåŒä¸€å¤§ç‰ˆæœ¬ã€‚</p>
</li>
<li>
<p>2.Â <strong>åˆ†ç‰‡/è·¯ç”±ç­–ç•¥é€‰é”™ï¼Œå®¹æ˜“è´Ÿè½½ä¸å‡</strong><br/>
XXL-Job æ”¯æŒâ€œ<a href="https://link.juejin.cn?target=https%3A%2F%2Fzhida.zhihu.com%2Fsearch%3Fcontent_id%3D270088628%26content_type%3DArticle%26match_order%3D2%26q%3D%25E5%2588%2586%25E7%2589%2587%25E5%25B9%25BF%25E6%2592%25AD%26zhida_source%3Dentity" target="_blank" title="https://zhida.zhihu.com/search?content_id=270088628&amp;content_type=Article&amp;match_order=2&amp;q=%E5%88%86%E7%89%87%E5%B9%BF%E6%92%AD&amp;zhida_source=entity" ref="nofollow noopener noreferrer">åˆ†ç‰‡å¹¿æ’­</a>â€â€œæ•…éšœè½¬ç§»â€ç­‰è·¯ç”±èƒ½åŠ›<br/>
âœ… å»ºè®®ï¼š</p>
</li>
</ol>
<ul>
<li>
<p>â€¢ å¤§æ‰¹é‡å¤„ç†ï¼šä¼˜å…ˆåˆ†ç‰‡å¹¿æ’­ + è®¾è®¡å¥½åˆ†ç‰‡å‚æ•°</p>
</li>
<li>
<p>â€¢ å¼ºå¯ç”¨ï¼šç”¨æ•…éšœè½¬ç§»ï¼Œä½†è¦å…³æ³¨å¥åº·æ£€æŸ¥ä¸è¶…æ—¶</p>
</li>
</ul>
<ol>
<li>3.Â <strong>æ—¥å¿—ä¸æ•°æ®ç•™å­˜</strong><br/>
å®ƒæ”¯æŒåœ¨çº¿ Rolling æ—¥å¿—æŸ¥çœ‹<br/>
âœ… å»ºè®®ï¼šé…å¥½æ—¥å¿—ä¿ç•™/å½’æ¡£ç­–ç•¥ï¼Œåˆ«è®©â€œ<a href="https://link.juejin.cn?target=https%3A%2F%2Fzhida.zhihu.com%2Fsearch%3Fcontent_id%3D270088628%26content_type%3DArticle%26match_order%3D1%26q%3D%25E4%25BB%25BB%25E5%258A%25A1%25E6%2597%25A5%25E5%25BF%2597%26zhida_source%3Dentity" target="_blank" title="https://zhida.zhihu.com/search?content_id=270088628&amp;content_type=Article&amp;match_order=1&amp;q=%E4%BB%BB%E5%8A%A1%E6%97%A5%E5%BF%97&amp;zhida_source=entity" ref="nofollow noopener noreferrer">ä»»åŠ¡æ—¥å¿—</a>â€å˜æˆæ•°æ®åº“/ç£ç›˜éšå½¢ç‚¸å¼¹ã€‚</li>
</ol>
<hr/>
<h2 data-id="heading-10">3 æ¡â€œé€šç”¨é“å¾‹â€</h2>
<ol>
<li>
<p>1.Â <strong>ä»»åŠ¡å¹‚ç­‰æ€§</strong>ï¼šåŒä¸€ä»»åŠ¡è·‘ä¸¤æ¬¡ï¼Œä¹Ÿä¸èƒ½æŠŠé’±æ‰£ä¸¤æ¬¡/å‘ä¸¤æ¬¡åˆ¸ã€‚</p>
</li>
<li>
<p>2.Â <strong>è¶…æ—¶ + å‘Šè­¦</strong>ï¼šæ…¢ä»»åŠ¡è¦èƒ½è¢«å‘ç°ã€è¢«ç»ˆæ­¢æˆ–é™çº§ã€‚</p>
</li>
<li>
<p>3.Â <strong>æ—¶é—´åŒæ­¥</strong>ï¼šå°¤å…¶æ˜¯é›†ç¾¤è°ƒåº¦ï¼Œæœºå™¨æ—¶é—´ä¸å‡†ä¼šè®©é—®é¢˜å˜å¾—éå¸¸éš¾æ’æŸ¥ã€‚</p>
</li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[çº¿ç¨‹æ± ç”¨å®Œä¸Shutdownï¼ŒCPUå’Œå†…å­˜éƒ½å¿«å“­äº†]]></title>    <link>https://juejin.cn/post/7603771025856593971</link>    <guid>https://juejin.cn/post/7603771025856593971</guid>    <pubDate>2026-02-08T06:52:28.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7603771025856593971" data-draft-id="7603687444052115494" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="çº¿ç¨‹æ± ç”¨å®Œä¸Shutdownï¼ŒCPUå’Œå†…å­˜éƒ½å¿«å“­äº†"/> <meta itemprop="keywords" content="åç«¯"/> <meta itemprop="datePublished" content="2026-02-08T06:52:28.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Javaç¼–ç¨‹çˆ±å¥½è€…"/> <meta itemprop="url" content="https://juejin.cn/user/819554264300154"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            çº¿ç¨‹æ± ç”¨å®Œä¸Shutdownï¼ŒCPUå’Œå†…å­˜éƒ½å¿«å“­äº†
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/819554264300154/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Javaç¼–ç¨‹çˆ±å¥½è€…
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-08T06:52:28.000Z" title="Sun Feb 08 2026 06:52:28 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»9åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0"><strong>å‰è¨€</strong></h2>
<p>å¤§å®¶å¹³å¸¸ä½¿ç”¨<a href="https://link.juejin.cn?target=https%3A%2F%2Fzhida.zhihu.com%2Fsearch%3Fcontent_id%3D270085144%26content_type%3DArticle%26match_order%3D1%26q%3DSpringBoot%26zhida_source%3Dentity" target="_blank" title="https://zhida.zhihu.com/search?content_id=270085144&amp;content_type=Article&amp;match_order=1&amp;q=SpringBoot&amp;zhida_source=entity" ref="nofollow noopener noreferrer">SpringBoot</a>è¿›è¡ŒWebé¡¹ç›®å¼€å‘ï¼Œ<a href="https://link.juejin.cn?target=https%3A%2F%2Fzhida.zhihu.com%2Fsearch%3Fcontent_id%3D270085144%26content_type%3DArticle%26match_order%3D1%26q%3D%25E7%25BA%25BF%25E7%25A8%258B%25E6%25B1%25A0%26zhida_source%3Dentity" target="_blank" title="https://zhida.zhihu.com/search?content_id=270085144&amp;content_type=Article&amp;match_order=1&amp;q=%E7%BA%BF%E7%A8%8B%E6%B1%A0&amp;zhida_source=entity" ref="nofollow noopener noreferrer">çº¿ç¨‹æ± </a>ä¼šè¢«é…ç½®æˆä¸ºå…¨å±€å¯å¤ç”¨çš„å·¥å…·ï¼Œç”Ÿå‘½å‘¨æœŸéšæœåŠ¡å¯åŠ¨å¼€å§‹ï¼Œåˆ°æœåŠ¡åœæ­¢å³ç»“æŸã€‚è¿™ç§â€œ<strong><a href="https://link.juejin.cn?target=https%3A%2F%2Fzhida.zhihu.com%2Fsearch%3Fcontent_id%3D270085144%26content_type%3DArticle%26match_order%3D1%26q%3D%25E7%25BA%25BF%25E7%25A8%258B%25E6%25B1%25A0%25E6%2589%2598%25E7%25AE%25A1%26zhida_source%3Dentity" target="_blank" title="https://zhida.zhihu.com/search?content_id=270085144&amp;content_type=Article&amp;match_order=1&amp;q=%E7%BA%BF%E7%A8%8B%E6%B1%A0%E6%89%98%E7%AE%A1&amp;zhida_source=entity" ref="nofollow noopener noreferrer">çº¿ç¨‹æ± æ‰˜ç®¡</a></strong>â€æ¨¡å¼ï¼Œè®©å¤šå°‘å…„å¼Ÿäº§ç”Ÿç¾ä¸½çš„é”™è§‰ ï¼šâ€œåŸæ¥çº¿ç¨‹æ± ä¼šè‡ªå·±ç®¡ç†è‡ªå·±å•Šï¼â€</p>
<p>ä½†æ˜¯ï¼Œå½“éœ€æ±‚ç»ç†å¯¹ä½ éœ²å‡ºç¥ç§˜çš„å¾®ç¬‘ï¼šâ€œè¿™ä¸ªæ‰¹é‡å¯¼å‡ºéœ€æ±‚ï¼Œä»Šæ™šå°±è¦...â€ã€‚ä½ ä¸å¾—ä¸æ’¸èµ·è¢–å­ï¼Œå†™ä¸‹äº†ç½ªæ¶çš„ä»£ç åˆ›å»ºä¸´æ—¶çº¿ç¨‹æ± ï¼Œè¿™æ—¶å…„å¼Ÿä»¬ï¼Œå¦‚æœå¯¹çº¿ç¨‹æ± ä½¿ç”¨ä¸å½“ï¼Œå¾ˆå®¹æ˜“ç»™æœåŠ¡åŸ‹ä¸‹éšæ‚£ ã€‚</p>
<h2 data-id="heading-1"><strong>1 é—®é¢˜åˆç°</strong></h2>
<h3 data-id="heading-2"><strong>1.1 ç¤ºä¾‹ä»£ç </strong></h3>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/806758f53acb433f8ab961a2b8bb0b9b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2Yee8lueoi-eIseWlveiAhQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771138351&amp;x-signature=OtgSIADCBnLAOodNWffoPlxGgcg%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-3"><strong>1.2 é—®é¢˜æè¿°</strong></h3>
<p><strong>é¢è¯•å®˜ï¼š</strong> ä¸è€ƒè™‘ä»»åŠ¡å†…éƒ¨çš„å¤æ‚åº¦ï¼Œè¿™ä¸ªçº¿ç¨‹æ± çš„ä½¿ç”¨ä¼šæœ‰é—®é¢˜å—ï¼Ÿ</p>
<p><strong>èœé¸Ÿï¼š</strong> æ–¹æ³•æ‰§è¡Œå®Œå¼¹æ ˆåï¼Œ<a href="https://link.juejin.cn?target=https%3A%2F%2Fzhida.zhihu.com%2Fsearch%3Fcontent_id%3D270085144%26content_type%3DArticle%26match_order%3D1%26q%3D%25E5%25B1%2580%25E9%2583%25A8%25E5%258F%2598%25E9%2587%258F%26zhida_source%3Dentity" target="_blank" title="https://zhida.zhihu.com/search?content_id=270085144&amp;content_type=Article&amp;match_order=1&amp;q=%E5%B1%80%E9%83%A8%E5%8F%98%E9%87%8F&amp;zhida_source=entity" ref="nofollow noopener noreferrer">å±€éƒ¨å˜é‡</a>ï¼Œéƒ½ä¼šè¢«GCå›æ”¶ï¼Œè°å†™çš„ä»£ç ï¼Œç¨³å¾—å¾ˆå•Šï¼</p>
<p><strong>è€é¸Ÿï¼š</strong> ï¼ˆä¸€å£å’–å•¡å–·å±å¹•ä¸Šï¼‰è€å¼Ÿï¼Œä½ çº¿ç¨‹æ± ç”¨å®Œä¸ç”¨shutdownå‘€ï¼Ÿ</p>
<p>===========</p>
<p><strong>å†é—®ï¼šåæ­£ä»»åŠ¡æ‰§è¡Œå®Œï¼Œå†…å­˜éƒ½ä¼šè¢«GCå›æ”¶ï¼Œéå¾—Shutdownä¸€ä¸‹ä¸å¤šä½™å—ï¼Ÿ</strong></p>
<p><strong>èœé¸Ÿï¼š</strong> ......</p>
<p><strong>è€é¸Ÿï¼š</strong> ï¼ˆé‚ªé­…ä¸€ç¬‘ï¼‰å€’ä¹Ÿä¸æ˜¯å¿…é¡»Shutdownï¼Œä½†æ˜¯ä¸å»ºè®®çŠ¯é™©å°è¯•ï¼Œè¯·çœ‹VCRæ¼”ç¤ºï¼ˆä»£ç æ¼”ç¤ºï¼‰</p>
<h2 data-id="heading-4"><strong>2 èµ°è¿›ç§‘å­¦å®éªŒç°åœºï¼ˆéªŒè¯)</strong></h2>
<blockquote>
<p><strong>è¯´æ˜</strong>ï¼šæœ¬æ–‡è®¨è®ºçš„çº¿ç¨‹æ± å¯¹è±¡åŠç›¸å…³æºç ï¼Œéƒ½å›´ç»•å¸¸ç”¨çš„java.util.concurrent.ThreadPoolExecutorç±»å±•å¼€ï¼Œä¸‹æ–‡ä¸å†é¢å¤–è¯´æ˜</p>
</blockquote>
<h3 data-id="heading-5"><strong>2.2 è£…å¤‡è¯´æ˜ï¼ˆä»£ç ï¼‰</strong></h3>
<p>âš ï¸Â <strong>è­¦ å‘Š</strong> ï¼šç´§æ¥ç€å°†å‡ºç°å¤§é‡æºç è§£æï¼Œå¯èƒ½å¼•èµ·è½»å¾®ä¸é€‚ã€‚</p>
<blockquote>
<p><strong>è¯´æ˜</strong>ï¼šä»¥ä¸‹ä»£ç éƒ½æ˜¯åœ¨ä¸€ä¸ªç±»ä¸­ï¼Œqueueã€phantomRefè¿™ä¸¤ä¸ªå¯¹è±¡æ˜¯ä½œä¸ºå…¨å±€å¯¹è±¡ï¼Œä¸“é—¨æ•æ‰é‚£ä¸ª"è‚‰èº«å·²æ­»ä½†é˜´é­‚ä¸æ•£"çš„çº¿ç¨‹æ± å¯¹è±¡ã€‚</p>
</blockquote>
<p><strong>2.2.1 å¹½çµæ¢æµ‹ä»ªï¼ˆåˆ¤æ–­çº¿ç¨‹æ± å¯¹è±¡æ˜¯å¦è¢«å›æ”¶)</strong></p>
<p>å› ä¸ºéªŒè¯çš„ä»£ç æ˜¯åœ¨ä¸€ä¸ªæˆç†Ÿçš„SpringBooté¡¹ç›®ä¸­è·‘çš„ï¼Œçº¿ç¨‹æ± å¯¹è±¡å¤ªå¤šäº†ï¼Œä»å†…å­˜åˆ†æå·¥å…·ä¸Šç›‘æµ‹è¿™å•ä¸ªçº¿ç¨‹æ± å¯¹è±¡æ˜¯å¦è¢«GCå›æ”¶ä¸å¤Ÿç›´è§‚ï¼Œè¿™é‡Œå€ŸåŠ©<a href="https://link.juejin.cn?target=https%3A%2F%2Fzhida.zhihu.com%2Fsearch%3Fcontent_id%3D270085144%26content_type%3DArticle%26match_order%3D1%26q%3D%25E8%2599%259A%25E5%25BC%2595%25E7%2594%25A8%26zhida_source%3Dentity" target="_blank" title="https://zhida.zhihu.com/search?content_id=270085144&amp;content_type=Article&amp;match_order=1&amp;q=%E8%99%9A%E5%BC%95%E7%94%A8&amp;zhida_source=entity" ref="nofollow noopener noreferrer">è™šå¼•ç”¨</a>æ¥åˆ¤æ–­çº¿ç¨‹æ± å¯¹è±¡æ˜¯å¦è¢«å›æ”¶ã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9f97518c695f425baa555668a97daca8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2Yee8lueoi-eIseWlveiAhQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771138351&amp;x-signature=gnj34fOpOeQMhG8KSl92zgN09I4%3D" alt="" loading="lazy"/></p>
<p><strong>2.2.2 å®éªŒ1ï¼šcore 0ï¼Œmax 100 ä»»åŠ¡å®Œæˆåï¼Œä¸è¿›è¡Œshutdown</strong></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/30f051d9361745848f80f80d62757217~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2Yee8lueoi-eIseWlveiAhQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771138351&amp;x-signature=dMDy%2BfzFkIAe7dHFz5K6NlfVsqw%3D" alt="" loading="lazy"/></p>
<p><strong>2.2.3 å®éªŒ2ï¼šcore 0ï¼Œmax 100 ä»»åŠ¡å®Œæˆåï¼Œè¿›è¡Œshutdown</strong></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e649d955b88c4675a8c8bd8cf6664a22~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2Yee8lueoi-eIseWlveiAhQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771138351&amp;x-signature=R7YMvsK7ewcdISdDfl53zgmR7tk%3D" alt="" loading="lazy"/></p>
<p><strong>2.2.4 å®éªŒ3ï¼šcore 100ï¼Œmax 100 ä»»åŠ¡å®Œæˆåï¼Œä¸è¿›è¡Œshutdown</strong></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4cffac05c8a2412db8144327b6a211fe~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2Yee8lueoi-eIseWlveiAhQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771138351&amp;x-signature=5OTUMfaWOiIyOUzxsybVHiIq3R8%3D" alt="" loading="lazy"/></p>
<p><strong>2.2.5 å®éªŒ4ï¼šcore 100ï¼Œmax 100 ä»»åŠ¡å®Œæˆåï¼Œè¿›è¡Œshutdown</strong></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d47b3a408210415d99446b513115148c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2Yee8lueoi-eIseWlveiAhQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771138351&amp;x-signature=OUlvqmV4Jf4HhebQKmGhDkbgUWw%3D" alt="" loading="lazy"/></p>
<p><strong>2.2.6 ä»»åŠ¡æ‰§è¡Œä»£ç ç¤ºä¾‹</strong></p>
<p><strong>è§£é‡Šè¯´æ˜ï¼š</strong></p>
<p>ä»»åŠ¡æ•°é‡æ˜¯110ï¼Œä¸»è¦æ˜¯ä¸ºäº†ä¿è¯æœ‰è¶³å¤Ÿå¤šçš„ä»»åŠ¡è®©çº¿ç¨‹æ± æ‰€æœ‰çº¿ç¨‹èƒ½å¤Ÿæ‰“æ»¡ï¼›ä»»åŠ¡é‡Œé¢è¦sleep 500msï¼Œä¹Ÿæ˜¯åŒæ ·çš„é“ç†</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1925b9232ba541f5bd7893a55ef6c6cc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2Yee8lueoi-eIseWlveiAhQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771138351&amp;x-signature=bkyaOViCgHvth0dlCtgBz5wKAes%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-6"><strong>2.3 å®éªŒæ‰§è¡Œç»“æœ</strong></h3>
<p><strong>2.3.1 å®éªŒæ‰§è¡Œæ­¥éª¤</strong></p>
<p>é¡¹ç›®å¯åŠ¨åï¼Œä¾æ¬¡æ‰§è¡Œä¸Šè¿°4ä¸ªå®éªŒã€‚éœ€è¦æ³¨æ„çš„æ˜¯æ—¶é—´é—´éš”è¦ä¿è¯å‰ä¸€ä¸ªå®éªŒçš„ä»»åŠ¡å…¨éƒ¨æ‰§è¡Œå®Œï¼Œæœ€å¥½å†ç•™ä¸€äº›ç©ºæŒ¡ï¼Œè¿™æ ·ç›‘æ§æ›´æ¸…æ™°</p>
<p>æ¯ä¸ªå®éªŒæ‰§è¡Œå®Œåï¼Œåˆ†åˆ«æ‰§è¡Œä¸€æ¬¡2.2.1 åˆ¤æ–­çº¿ç¨‹æ± å¯¹è±¡æ˜¯å¦å›æ”¶</p>
<p><strong>2.3.2 ç»“æœåˆ†æ</strong></p>
<p><strong><a href="https://link.juejin.cn?target=https%3A%2F%2Fzhida.zhihu.com%2Fsearch%3Fcontent_id%3D270085144%26content_type%3DArticle%26match_order%3D1%26q%3DJVM%26zhida_source%3Dentity" target="_blank" title="https://zhida.zhihu.com/search?content_id=270085144&amp;content_type=Article&amp;match_order=1&amp;q=JVM&amp;zhida_source=entity" ref="nofollow noopener noreferrer">JVM</a>åˆå§‹çŠ¶æ€</strong></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f9e895c3c92b4940aa3974e72e78c8bc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2Yee8lueoi-eIseWlveiAhQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771138351&amp;x-signature=zVLitQZhDfgE0%2B4Ca67RSMYTxAs%3D" alt="" loading="lazy"/></p>
<p>1.Â <strong>å®éªŒ1æ‰§è¡Œç›‘æ§</strong></p>
<p>core 0ï¼Œmax 100 ä»»åŠ¡å®Œæˆåï¼Œä¸è¿›è¡Œshutdown</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a3e22d687ea14a07a6290204a10f79b8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2Yee8lueoi-eIseWlveiAhQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771138351&amp;x-signature=59xOR3kyDR2654pQfDP8pIBVato%3D" alt="" loading="lazy"/></p>
<p>2.Â <strong>å®éªŒ2æ‰§è¡Œç›‘æ§</strong></p>
<p>core 0ï¼Œmax 100 ä»»åŠ¡å®Œæˆåï¼Œè¿›è¡Œshutdown</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2ab80c0e84b849c1a2e1f638bf5774cf~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2Yee8lueoi-eIseWlveiAhQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771138351&amp;x-signature=sHtcQ7AxzY7XE2bjpBrcBhkQyck%3D" alt="" loading="lazy"/></p>
<p>3.Â <strong>å®éªŒ3æ‰§è¡Œç›‘æ§</strong></p>
<p>core 100ï¼Œmax 100 ä»»åŠ¡å®Œæˆåï¼Œä¸è¿›è¡Œshutdown</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1a077c5114484eaabb501e0c6b643d2f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2Yee8lueoi-eIseWlveiAhQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771138351&amp;x-signature=mjclYoEvREyRAYkg0AP%2FVSnETCc%3D" alt="" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e04985847703446488554e0594f42b7c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2Yee8lueoi-eIseWlveiAhQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771138351&amp;x-signature=UpPpi%2FGiXxv2Z%2B1vQGs%2BYKEcYPo%3D" alt="" loading="lazy"/></p>
<p>4.Â <strong>å®éªŒ4æ‰§è¡Œç›‘æ§</strong></p>
<p>core 100ï¼Œmax 100 ä»»åŠ¡å®Œæˆåï¼Œè¿›è¡Œshutdown</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1efdeab66fd74b0ca1a5bcfa439c1618~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2Yee8lueoi-eIseWlveiAhQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771138351&amp;x-signature=T1Kv%2F6vTF2BppYHQ6u%2FMnBfrsDg%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-7"><strong>3 åŸå› è§£å‰–å®¤</strong></h2>
<p><strong>æ¥ä¸‹æ¥éƒ½æ˜¯å¯¹å®éªŒ3çš„å¼‚å¸¸ç°è±¡è¿›è¡Œçš„åˆ†æ</strong></p>
<h3 data-id="heading-8"><strong>3.1 shutdownçš„äº”æ­¥æ‹†è§£æ³•</strong></h3>
<p>é¦–å…ˆçœ‹ä¸‹ThreadPoolExecutor#shutdownæ–¹æ³•</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a785cda4800b48069a7dd793a0780e74~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2Yee8lueoi-eIseWlveiAhQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771138351&amp;x-signature=z0AhwGEexSUCqel2IYFOlS%2BQmrk%3D" alt="" loading="lazy"/></p>
<p>æˆªå›¾ä¸­ï¼Œå¯ä»¥çœ‹åˆ°shutdownæ–¹æ³•é‡Œé¢ï¼Œä¸»è¦åšäº†5ä¸ªåŠ¨ä½œï¼š</p>
<ol>
<li>
<p>æ ¹æ®æ–¹æ³•åç§°å¯ä»¥çœ‹å‡ºæ˜¯ä¸€ä¸ªæ£€æŸ¥åŠ¨ä½œï¼Œè¿™é‡Œä¸ç”¨ç»†çœ‹</p>
</li>
<li>
<p>æŠŠçº¿ç¨‹æ± çŠ¶æ€ç½®ä¸ºSHUTDOWNçŠ¶æ€<strong>é‡è¦</strong></p>
</li>
<li>
<p>æ ¹æ®æ–¹æ³•åç§°å¯ä»¥çœ‹å‡ºæ˜¯å°†çº¿ç¨‹æ± ä¸­çš„ç©ºé—²çº¿ç¨‹è¿›è¡Œä¸­æ–­Â <strong>é‡è¦</strong></p>
</li>
<li>
<p>æ ¹æ®æ³¨é‡Šæ¥çœ‹ï¼Œæ˜¯ç»™ç‰¹å®šåœºæ™¯å¯¹è±¡ä½¿ç”¨ï¼Œè¿™é‡Œä¸ç”¨ç»†çœ‹</p>
</li>
<li>
<p>å°è¯•ç»ˆæ­¢çº¿ç¨‹æ± ï¼ˆ<a href="https://link.juejin.cn?target=https%3A%2F%2Fzhida.zhihu.com%2Fsearch%3Fcontent_id%3D270085144%26content_type%3DArticle%26match_order%3D1%26q%3D%25E4%25B8%25AD%25E6%2596%25AD%25E7%25BA%25BF%25E7%25A8%258B%26zhida_source%3Dentity" target="_blank" title="https://zhida.zhihu.com/search?content_id=270085144&amp;content_type=Article&amp;match_order=1&amp;q=%E4%B8%AD%E6%96%AD%E7%BA%BF%E7%A8%8B&amp;zhida_source=entity" ref="nofollow noopener noreferrer">ä¸­æ–­çº¿ç¨‹</a>ã€å…³é—­çº¿ç¨‹æ± ï¼‰</p>
</li>
</ol>
<p>æ¯ä¸€æ­¥çš„ç»†èŠ‚å¤„ç†ï¼Œè¿™é‡Œå°±ä¸å¸¦å¤§å®¶çœ‹äº†ï¼Œæœ‰å…´è¶£å¯ä»¥ç‚¹å¼€æºç ä¸€æ­¥æ­¥ç ”ç©¶ä¸‹ã€‚<strong>æ€»ç»“ä¸‹æ¥å°±æ˜¯ï¼Œçº¿ç¨‹æ± æ‰§è¡Œshutdownæ–¹æ³•åï¼š</strong></p>
<ol>
<li>çº¿ç¨‹æ± å¯¹è±¡ç½®ä¸ºSHUTDOWNçŠ¶æ€â€”â€”<strong>æŒ‚ä¸Šâ€œæš‚åœè¥ä¸šâ€ç‰Œå­</strong></li>
<li>å°†çº¿ç¨‹æ± ä¸­ç©ºé—²çº¿ç¨‹ç½®ä¸ºä¸­æ–­çŠ¶æ€ï¼Œæœ€ç»ˆä»çº¿ç¨‹æ± ä¸­å‰”é™¤(ä¼šè¢«GCå›æ”¶)â€”â€”<strong>ç»™é—²é€›çš„çº¿ç¨‹å‘ã€Š<a href="https://link.juejin.cn?target=https%3A%2F%2Fzhida.zhihu.com%2Fsearch%3Fcontent_id%3D270085144%26content_type%3DArticle%26match_order%3D1%26q%3D%25E8%25A7%25A3%25E8%2581%2598%25E9%2580%259A%25E7%259F%25A5%25E4%25B9%25A6%26zhida_source%3Dentity" target="_blank" title="https://zhida.zhihu.com/search?content_id=270085144&amp;content_type=Article&amp;match_order=1&amp;q=%E8%A7%A3%E8%81%98%E9%80%9A%E7%9F%A5%E4%B9%A6&amp;zhida_source=entity" ref="nofollow noopener noreferrer">è§£è˜é€šçŸ¥ä¹¦</a>ã€‹</strong></li>
<li>çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹å¯¹è±¡ä¼šç½®ä¸ºä¸­æ–­çŠ¶æ€ï¼Œæœ€ç»ˆterminated</li>
</ol>
<h3 data-id="heading-9"><strong>3.2 ä¸ºä»€ä¹ˆçº¿ç¨‹æ± ä¸è¿›è¡Œshutdownï¼Œåœ¨æ–¹æ³•å¼¹æ ˆåä¸ä¼šç«‹å³è¢«GCå›æ”¶ï¼Ÿ</strong></h3>
<p>é¦–å…ˆæˆ‘ä»¬æ¢³ç†ä¸€ä¸‹å½“å‰æ‰§è¡Œå®éªŒçš„çº¿ç¨‹æ–¹æ³•æ ˆã€çº¿ç¨‹æ± ã€çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹ä¹‹é—´çš„å¼•ç”¨å…³ç³»å›¾å¦‚ä¸‹ï¼š</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d695e9bf18f541aca26f75fb664d4160~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2Yee8lueoi-eIseWlveiAhQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771138351&amp;x-signature=IdG%2Fic3WXaYgjLk8rLjURYdfolo%3D" alt="" loading="lazy"/></p>
<p>å®éªŒ3ä¸­ï¼Œå½“ä¸»æ–¹æ³•æ‰§è¡Œå®Œå¼¹æ ˆåï¼ŒçŸ­æ—¶é—´å†…ï¼Œçº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹å¯¹è±¡ä»å¤„äº<strong>ç©ºé—²/æ´»è·ƒçŠ¶æ€</strong>ã€‚ä½†æ˜¯çº¿ç¨‹æ± å¯¹è±¡å·²ç»ä¸è¢«ä¸»çº¿ç¨‹å¯¹è±¡ä¸­çš„æ–¹æ³•æ ˆæŒæœ‰ï¼Œä¹Ÿå°±æ˜¯<strong>å›¾ä¸­å…³ç³»1æ–­å¼€</strong>ï¼ŒæŒ‰ç…§JVMçš„<a href="https://link.juejin.cn?target=https%3A%2F%2Fzhida.zhihu.com%2Fsearch%3Fcontent_id%3D270085144%26content_type%3DArticle%26match_order%3D1%26q%3D%25E5%259E%2583%25E5%259C%25BE%25E5%259B%259E%25E6%2594%25B6%25E6%259C%25BA%25E5%2588%25B6%26zhida_source%3Dentity" target="_blank" title="https://zhida.zhihu.com/search?content_id=270085144&amp;content_type=Article&amp;match_order=1&amp;q=%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6%E6%9C%BA%E5%88%B6&amp;zhida_source=entity" ref="nofollow noopener noreferrer">åƒåœ¾å›æ”¶æœºåˆ¶</a>ï¼Œè¿™æ—¶ï¼ŒThreadPoolExecutorå¯¹è±¡å·²ç»ä¸è¢«GCRootå¼•ç”¨ï¼Œæ˜¯è¦è¢«GCå›æ”¶çš„ï¼Œä½†æ˜¯ä»2.3.2ä¸­çš„å®éªŒ3æ‰§è¡Œç›‘æ§æ¥çœ‹ï¼ŒThreadPoolExecutorå¯¹è±¡å¹¶æ²¡æœ‰è¢«GCå›æ”¶ã€‚</p>
<p><strong>ç–‘é—®ï¼šéš¾é“è¿˜æœ‰ä»€ä¹ˆå¯¹è±¡æŒæœ‰è¿™ä¸ªçº¿ç¨‹æ± å¯¹è±¡çš„å¼•ç”¨ï¼Ÿ</strong></p>
<p>é¦–å…ˆï¼Œç”±äºJVMçš„<a href="https://link.juejin.cn?target=https%3A%2F%2Fzhida.zhihu.com%2Fsearch%3Fcontent_id%3D270085144%26content_type%3DArticle%26match_order%3D1%26q%3D%25E8%25BF%2590%25E8%25A1%258C%25E6%259C%25BA%25E5%2588%25B6%26zhida_source%3Dentity" target="_blank" title="https://zhida.zhihu.com/search?content_id=270085144&amp;content_type=Article&amp;match_order=1&amp;q=%E8%BF%90%E8%A1%8C%E6%9C%BA%E5%88%B6&amp;zhida_source=entity" ref="nofollow noopener noreferrer">è¿è¡Œæœºåˆ¶</a>ï¼Œæ¯ä¸€ä¸ªjavaçº¿ç¨‹éƒ½å…³è”ä¸€ä¸ª<a href="https://link.juejin.cn?target=https%3A%2F%2Fzhida.zhihu.com%2Fsearch%3Fcontent_id%3D270085144%26content_type%3DArticle%26match_order%3D1%26q%3DOS%25E7%25BA%25BF%25E7%25A8%258B%26zhida_source%3Dentity" target="_blank" title="https://zhida.zhihu.com/search?content_id=270085144&amp;content_type=Article&amp;match_order=1&amp;q=OS%E7%BA%BF%E7%A8%8B&amp;zhida_source=entity" ref="nofollow noopener noreferrer">OSçº¿ç¨‹</a>ï¼Œçº¿ç¨‹å¯¹è±¡åœ¨terminatedä¹‹å‰(çº¿ç¨‹ä»»åŠ¡æ‰§è¡Œå®Œä¹‹å‰)ï¼Œéƒ½ä¸ä¼šè¢«GCå›æ”¶ã€‚</p>
<p>ä¸Šé¢çš„å¼•ç”¨å…³ç³»å®é™…ä¸Šåº”è¯¥æ˜¯ä¸‹é¢è¿™æ ·çš„ï¼Œçº¿ç¨‹æ± ä¸­çš„æ¯ä¸ªçº¿ç¨‹å¯¹è±¡éƒ½æœ‰è‡ªå·±çš„æ‰§è¡Œæ–¹æ³•æ ˆå¯¹è±¡</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b9bbb8eab3f5493e96cc2f66c55d7ebf~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2Yee8lueoi-eIseWlveiAhQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771138351&amp;x-signature=8bi1EYjEZoIm%2BLLwF8fa10bKzzc%3D" alt="" loading="lazy"/></p>
<p>æ ¹æ®2.3.2ä¸­çš„å‡ ä¸ªæ‰§è¡Œç»“æœç›‘æ§ï¼Œå°±èƒ½çœ‹å‡ºï¼Œçº¿ç¨‹æ± å¯¹è±¡çš„å›æ”¶ä¸çº¿ç¨‹æ± ä¸­çš„å·¥ä½œçº¿ç¨‹æ˜¯å¦è¢«å…¨éƒ¨å›æ”¶æ˜¯æœ‰å…³ç³»çš„ï¼Œæ‰€ä»¥å…ˆé¢„æµ‹çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹å¯¹è±¡æ˜¯æŒæœ‰çº¿ç¨‹æ± å¯¹è±¡çš„å¼•ç”¨çš„ï¼Œç„¶ååŸºäºè¿™ä¸ªé¢„æµ‹ï¼Œå»æºç ä¸­æ‰¾ç†è®ºæ”¯æ’‘ã€‚</p>
<p><strong>é¢„æµ‹å­˜åœ¨é»„è‰²ç®­å¤´ä¾èµ–å…³ç³»ï¼Œå¦‚ä¸‹å›¾ï¼š</strong></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/34a8a758153d48679cf97849ab26af8f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2Yee8lueoi-eIseWlveiAhQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771138351&amp;x-signature=t804CVJMgGvj1PZTAyFSr5TV7FY%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-10"><strong>3.3 çº¿ç¨‹å¯¹è±¡ä¸ºä½•ä¼šæŒæœ‰çº¿ç¨‹æ± å¯¹è±¡çš„å¼•ç”¨ï¼Ÿ</strong></h3>
<p>å…¶å®ï¼Œä¸Šé¢çš„å¼•ç”¨å…³ç³»å›¾ä¸­ï¼Œæ‰€æœ‰çš„æ­£å‘ä¾èµ–å…³ç³»æˆ‘ä»¬ä¸éš¾ç†è§£ã€‚éœ€è¦éªŒè¯çš„æ˜¯åå‘çš„ä¾èµ–å…³ç³»r 2.xå’Œr 3.xï¼Œè¿™äº›åå‘çš„ä¾èµ–å…³ç³»éƒ½æ˜¯ä»€ä¹ˆæ—¶å€™å»ºç«‹çš„ï¼Ÿå¯ä»¥ä»ä¸‹é¢å‡ ä¸ªé—®é¢˜å…¥æ‰‹å»æ’æŸ¥ï¼š</p>
<ol>
<li>çº¿ç¨‹æ± (ThreadPoolExecutor)ç±»ç»“æ„ä¸­æ˜¯å¦æœ‰ç›¸å…³å¯¹è±¡çš„å±æ€§å­—æ®µï¼Ÿ</li>
<li>çº¿ç¨‹æ± å¯¹è±¡ä¸­<a href="https://link.juejin.cn?target=https%3A%2F%2Fzhida.zhihu.com%2Fsearch%3Fcontent_id%3D270085144%26content_type%3DArticle%26match_order%3D1%26q%3DWorker%26zhida_source%3Dentity" target="_blank" title="https://zhida.zhihu.com/search?content_id=270085144&amp;content_type=Article&amp;match_order=1&amp;q=Worker&amp;zhida_source=entity" ref="nofollow noopener noreferrer">Worker</a>é›†åˆä¸­Workerå¯¹è±¡åˆ›å»ºæ—¶æœºï¼Ÿ</li>
<li>Workerå¯¹è±¡åˆ›å»ºæ—¶æ˜¯å¦‚ä½•å»ºç«‹ç›¸åº”çš„ä¾èµ–å…³ç³»çš„ï¼Ÿ</li>
</ol>
<p>ä»çº¿ç¨‹æ± æäº¤ä»»åŠ¡å¼€å§‹ï¼Œä»æºç ä¸­å¯ä»¥çœ‹åˆ°workerç±»ç»“æ„ä¸­æœ¬èº«å®šä¹‰æœ‰Threadå˜é‡å±æ€§ï¼Œåœ¨Workerå¯¹è±¡åˆ›å»ºæ—¶ï¼Œå°±ä¸ºThreadå±æ€§æ˜¾å¼èµ‹å€¼ï¼š</p>
<p><strong>Workerç±»å®šä¹‰å¦‚ä¸‹ï¼š</strong></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/99b021a6362a4febb662dd802655d71e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2Yee8lueoi-eIseWlveiAhQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771138351&amp;x-signature=EsbpifZlzr9gdBOhfy4OuZHl5XM%3D" alt="" loading="lazy"/></p>
<p><strong>Workerå¯¹è±¡åˆ›å»ºæ—¶æœºå¦‚ä¸‹ï¼š</strong></p>
<p>ä»CompletableFutureå·¥å…·ä»»åŠ¡æ‰§è¡Œæ–¹æ³•ä¸­ä¸€æ­¥æ­¥è¿›å…¥æºç ï¼Œå¯ä»¥çœ‹åˆ°å¦‚ä¸‹å…³ç³»</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4ac031ed60b9495a8d87bfdc92f2c5d7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2Yee8lueoi-eIseWlveiAhQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771138351&amp;x-signature=PFF77Y7Yy8iC6NPQLPBcw8aLXE4%3D" alt="" loading="lazy"/></p>
<p>ä¸Šé¢ä¸¤æ®µæºç æˆªå›¾ä¸­ï¼ŒéªŒè¯äº†<a href="https://link.juejin.cn?target=https%3A%2F%2Fzhida.zhihu.com%2Fsearch%3Fcontent_id%3D270085144%26content_type%3DArticle%26match_order%3D1%26q%3D%25E4%25BE%259D%25E8%25B5%2596%25E5%2585%25B3%25E7%25B3%25BB%25E5%259B%25BE%26zhida_source%3Dentity" target="_blank" title="https://zhida.zhihu.com/search?content_id=270085144&amp;content_type=Article&amp;match_order=1&amp;q=%E4%BE%9D%E8%B5%96%E5%85%B3%E7%B3%BB%E5%9B%BE&amp;zhida_source=entity" ref="nofollow noopener noreferrer">ä¾èµ–å…³ç³»å›¾</a>ä¸­<strong>2.xï¼Œ3.x</strong>ä¸<strong>r 3.x</strong>çš„ä¾èµ–å…³ç³»ï¼Œè¿˜å‰©ä¸‹<strong>r 2.x</strong><a href="https://link.juejin.cn?target=https%3A%2F%2Fzhida.zhihu.com%2Fsearch%3Fcontent_id%3D270085144%26content_type%3DArticle%26match_order%3D8%26q%3D%25E4%25BE%259D%25E8%25B5%2596%25E5%2585%25B3%25E7%25B3%25BB%26zhida_source%3Dentity" target="_blank" title="https://zhida.zhihu.com/search?content_id=270085144&amp;content_type=Article&amp;match_order=8&amp;q=%E4%BE%9D%E8%B5%96%E5%85%B3%E7%B3%BB&amp;zhida_source=entity" ref="nofollow noopener noreferrer">ä¾èµ–å…³ç³»</a>æ²¡æœ‰å¾—åˆ°éªŒè¯ã€‚</p>
<p>é¦–å…ˆï¼Œä»Workerç±»ç»“æ„ä¸Šï¼Œæ²¡æœ‰æ‰¾åˆ°Workerç±»ä¸­æœ‰å®šä¹‰å¯¹ThreadPoolExecutorç±»çš„æ˜¾å¼å¼•ç”¨ï¼Œå¹¶ä¸”ä»2.3.2çš„å®éªŒæ‰§è¡Œç»“æœå›¾ä¸­å¯ä»¥çœ‹åˆ°ï¼Œå³ä½¿å¤šæ¬¡è§¦å‘GCï¼Œä¾æ—§æ²¡æœ‰å°†ThreadPoolExecutorå¯¹è±¡å›æ”¶æ‰ï¼Œæ‰€ä»¥ï¼Œ<strong>Worker-&gt;ThreadPoolExecutorè‚¯å®šæ˜¯ä¸€ç§<a href="https://link.juejin.cn?target=https%3A%2F%2Fzhida.zhihu.com%2Fsearch%3Fcontent_id%3D270085144%26content_type%3DArticle%26match_order%3D1%26q%3D%25E5%25BC%25BA%25E5%25BC%2595%25E7%2594%25A8%26zhida_source%3Dentity" target="_blank" title="https://zhida.zhihu.com/search?content_id=270085144&amp;content_type=Article&amp;match_order=1&amp;q=%E5%BC%BA%E5%BC%95%E7%94%A8&amp;zhida_source=entity" ref="nofollow noopener noreferrer">å¼ºå¼•ç”¨</a></strong>(4ç§å¼•ç”¨å…³ç³»ï¼šå¼ºå¼•ç”¨ã€<a href="https://link.juejin.cn?target=https%3A%2F%2Fzhida.zhihu.com%2Fsearch%3Fcontent_id%3D270085144%26content_type%3DArticle%26match_order%3D1%26q%3D%25E8%25BD%25AF%25E5%25BC%2595%25E7%2594%25A8%26zhida_source%3Dentity" target="_blank" title="https://zhida.zhihu.com/search?content_id=270085144&amp;content_type=Article&amp;match_order=1&amp;q=%E8%BD%AF%E5%BC%95%E7%94%A8&amp;zhida_source=entity" ref="nofollow noopener noreferrer">è½¯å¼•ç”¨</a>ã€å¼±å¼•ç”¨ã€è™šå¼•ç”¨)ã€‚</p>
<p>é‚£ä¹ˆï¼Œå“ªäº›è¡Œä¸ºä¼šè®©å¯¹è±¡ä¹‹é—´å»ºç«‹å¼ºå¼•ç”¨å…³ç³»å‘¢ï¼Ÿæˆ‘ä»¬å…ˆé—®ä¸‹AIåŠ©æ‰‹ï¼Œè®©å®ƒç½—åˆ—å‡ºä¼šå»ºç«‹å¼•ç”¨å…³ç³»çš„ä»£ç è¡Œä¸ºã€‚æ€»ç»“å½’çº³å¦‚ä¸‹ï¼š</p>
<ol>
<li>å¯¹è±¡ä¸­çš„å±æ€§å­—æ®µæ˜¾å¼èµ‹å€¼å¼•ç”¨</li>
<li>æ•°ç»„ã€é›†åˆå¯¹è±¡ä¸­æ·»åŠ å…¶ä»–å¯¹è±¡çš„å¼•ç”¨</li>
<li>å­ç±»é€šè¿‡é¢å‘å¯¹è±¡çš„ç»§æ‰¿å¤šæ€ç‰¹æ€§å¼•ç”¨çˆ¶ç±»ä¸­çš„å±æ€§å­—æ®µ</li>
<li>è¿˜æœ‰ä¸€ç§å¹³å¸¸å…³æ³¨è¾ƒå°‘çš„ï¼Œç›¸å¯¹éšå¼çš„å¼•ç”¨å…³ç³»â€”â€”å†…éƒ¨<a href="https://link.juejin.cn?target=https%3A%2F%2Fzhida.zhihu.com%2Fsearch%3Fcontent_id%3D270085144%26content_type%3DArticle%26match_order%3D1%26q%3D%25E7%25B1%25BB%25E5%25AF%25B9%25E8%25B1%25A1%26zhida_source%3Dentity" target="_blank" title="https://zhida.zhihu.com/search?content_id=270085144&amp;content_type=Article&amp;match_order=1&amp;q=%E7%B1%BB%E5%AF%B9%E8%B1%A1&amp;zhida_source=entity" ref="nofollow noopener noreferrer">ç±»å¯¹è±¡</a>å¼•ç”¨å¤–éƒ¨ç±»å¯¹è±¡</li>
</ol>
<p>ä»Workerçš„ç±»ç»“æ„æ¥çœ‹ï¼Œæ˜¯æ²¡æœ‰æ˜¾ç¤ºçš„å¯¹ThreadPoolExecutorçš„å±æ€§å¼•ç”¨çš„ï¼Œä¹Ÿæ²¡æœ‰ç›¸å…³çš„æ•°æ®ã€é›†åˆï¼Œ<strong>æ‰€ä»¥1,2ä¸æˆç«‹</strong>ã€‚Workerå¯¹è±¡ä¸ThreadPoolExecutorä¹Ÿæ²¡æœ‰ç›´æ¥æˆ–è€…é—´æ¥çš„ç»§æ‰¿/å®ç°å…³ç³»ï¼Œ<strong>æ‰€ä»¥3ä¹Ÿä¸æˆç«‹ã€‚</strong></p>
<p>æœ€åå†çœ‹Workerç±»å®šä¹‰ï¼Œç¡®å®æ˜¯åœ¨ThreadPoolExecutorç±»çš„å†…éƒ¨(å†…éƒ¨ç±»å¯¹è±¡æŒæœ‰å¤–éƒ¨ç±»å¯¹è±¡çš„éªŒè¯å¾ˆç®€å•ï¼Œä¸åœ¨è¿™é‡Œèµ˜è¿°)ã€‚è¿™æ ·Worker-&gt;ThreadPoolExecutorçš„å¼•ç”¨å…³ç³»å°±èƒ½è¯´å¾—é€šäº†ã€‚è‡³æ­¤ï¼Œ<strong>å¼•ç”¨ä¾èµ–å…³ç³»å›¾ä¸­é¢„æµ‹çš„r 2.xå’Œr 3.xå…³ç³»éƒ½æˆç«‹äº†ã€‚</strong></p>
<h3 data-id="heading-11"><strong>3.4 åŸå› é€»è¾‘æ¢³ç†</strong></h3>
<p>å†æ¬¡æŠŠä¾èµ–å…³ç³»å›¾è´´å‡ºæ¥ï¼Œä¸€èµ·å†æ¢³ç†ä¸€ä¸‹</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1a9850d8c7974bec9dee423b57870d4b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2Yee8lueoi-eIseWlveiAhQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771138351&amp;x-signature=sbm8cYeSHSVSpfkNYIvETGToQgM%3D" alt="" loading="lazy"/></p>
<ol>
<li>å½“å‰æ–¹æ³•main-Threadæ‰§è¡Œå®Œï¼Œmain-Threadçš„<a href="https://link.juejin.cn?target=https%3A%2F%2Fzhida.zhihu.com%2Fsearch%3Fcontent_id%3D270085144%26content_type%3DArticle%26match_order%3D4%26q%3D%25E6%2596%25B9%25E6%25B3%2595%25E6%25A0%2588%26zhida_source%3Dentity" target="_blank" title="https://zhida.zhihu.com/search?content_id=270085144&amp;content_type=Article&amp;match_order=4&amp;q=%E6%96%B9%E6%B3%95%E6%A0%88&amp;zhida_source=entity" ref="nofollow noopener noreferrer">æ–¹æ³•æ ˆ</a>éƒ½å¼¹æ ˆ</li>
<li>ä¾èµ–å…³ç³»<strong>1</strong>æ–­å¼€ï¼Œçº¿ç¨‹æ± ä¸å†è¢«æ´»è·ƒçº¿ç¨‹å¼•ç”¨ï¼Œä¸ä¼šå†æœ‰ä»»åŠ¡è¿›æ¥</li>
<li>å½“çº¿ç¨‹æ± ä»»åŠ¡éƒ½å®Œæˆï¼Œæ­¤æ—¶çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹éƒ½å¤„äºä¼‘çœ (wait)çŠ¶æ€ï¼Œç­‰å¾…ä»»åŠ¡é˜Ÿåˆ—ä¸­ä»»åŠ¡è¿›æ¥</li>
<li>ç”±äºçº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹éƒ½å¤„äºå­˜æ´»çŠ¶æ€ï¼Œä¸ä¼šè¢«å›æ”¶</li>
<li>å­˜åœ¨<strong>çº¿ç¨‹æ± çº¿ç¨‹_n</strong> <strong>-&gt; worker_n -&gt; çº¿ç¨‹æ± </strong>çš„é€†å‘å¼•ç”¨å…³ç³»</li>
<li>æ‰€ä»¥å¯¼è‡´å®éªŒ3ä¸­çš„ç°è±¡â€”â€”çº¿ç¨‹æ± å’Œçº¿ç¨‹æ± ä¸­çº¿ç¨‹æ— æ³•è¢«GCå›æ”¶</li>
</ol>
<h2 data-id="heading-12"><strong>4 çº¿ç¨‹æ± æœªshutdownçš„å½±å“</strong></h2>
<p>è¿™é‡Œå†æŠŠå®éªŒ3ä¼šå¯¼è‡´ç³»ç»Ÿçš„å‡ºç°çš„é—®é¢˜æ€»ç»“ä¸€ä¸‹ã€‚é€šè¿‡2.3.2ä¸­çš„å®éªŒ3ç›‘æ§å›¾ä»¥åŠæºç ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œçº¿ç¨‹æ± ä½¿ç”¨å®Œï¼ŒæœªåŠæ—¶è¿›è¡Œshutdownï¼Œå°±æœ€å·®çš„æƒ…å†µæ¥è¯´ï¼Œä¼šå¯¼è‡´çš„é—®é¢˜ï¼š</p>
<ol>
<li>
<p>çº¿ç¨‹æ± å¯¹è±¡æ— æ³•è¢«GCå›æ”¶â€”â€”<strong>å†…å­˜æ³„éœ²</strong></p>
</li>
<li>
<p>çº¿ç¨‹å¯¹è±¡æ— æ³•è¢«GCå›æ”¶â€”â€”<strong><a href="https://link.juejin.cn?target=https%3A%2F%2Fzhida.zhihu.com%2Fsearch%3Fcontent_id%3D270085144%26content_type%3DArticle%26match_order%3D1%26q%3D%25E5%2586%2585%25E5%25AD%2598%25E6%25B3%2584%25E6%25BC%258F%26zhida_source%3Dentity" target="_blank" title="https://zhida.zhihu.com/search?content_id=270085144&amp;content_type=Article&amp;match_order=1&amp;q=%E5%86%85%E5%AD%98%E6%B3%84%E6%BC%8F&amp;zhida_source=entity" ref="nofollow noopener noreferrer">å†…å­˜æ³„æ¼</a></strong></p>
</li>
<li>
<p>ä»çº¿ç¨‹è·å–ä»»åŠ¡çš„æºç æ¥çœ‹ï¼Œå³ä½¿ä»»åŠ¡é˜Ÿåˆ—ä¸­æ˜¯ç©ºçš„ï¼Œåªè¦çº¿ç¨‹æ± çŠ¶æ€ä»å¤„äº<strong>Running</strong>ï¼Œçº¿ç¨‹ä¼šå®šæ—¶ä»waitçŠ¶æ€è‹é†’ï¼Œé‡æ–°è·å–ä»»åŠ¡â€”â€”<strong>å ç”¨CPUæ‰§è¡Œåˆ†ç‰‡</strong></p>
</li>
</ol>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/295892aeb97a4c2fa7e3e8cf42023cc2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2Yee8lueoi-eIseWlveiAhQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771138351&amp;x-signature=K1Nt2f65n29D%2F73Nk7ea5MFKDEI%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-13"><strong>è¡€æ³ªæ•™è®­æ€»ç»“</strong></h2>
<ol>
<li><strong>çº¿ç¨‹æ± ç”¨å®Œä¸€å®šè¦å…»æˆshutdownçš„ä¹ æƒ¯ï¼š</strong> å› ä¸ºæœ‰çš„æ²¡å…³å¥½ï¼ŒçœŸçš„ä¼šæ¼æ°´(å†…å­˜æ³„éœ²)</li>
<li><strong>çº¿ç¨‹æ± åˆ›å»ºçº¿ç¨‹å‘½åï¼Œä¸€å®šè¦æœ‰ä¸šåŠ¡ç›¸å…³æ ‡è¯†ï¼š</strong> å»ºè®®é‡‡ç”¨â€œä¸šåŠ¡åœºæ™¯+çº¿ç¨‹è®¡æ•°â€æ³•ï¼š"<strong>è®¢å•å¯¼å‡º-xx"ã€"é‚®ä»¶å‘é€-xx"</strong> ï¼Œå‡ºé—®é¢˜æ—¶ç§’é”å«Œç–‘äººï¼š"å°±æ˜¯è®¢å•å¯¼å‡ºçº¿ç¨‹åœ¨æ‘¸é±¼ï¼"</li>
<li><strong>å†…éƒ¨ç±»ä½¿ç”¨è¦è°¨æ…ï¼š</strong> è°ˆæ‹çˆ±å¯ä»¥ï¼Œç©å¤±è¸ªä¸è¡Œï¼Œåˆ«è®©äººå®¶ï¼ˆGCï¼‰æ‰¾ä¸åˆ°ä½ ï¼</li>
</ol>
<h2 data-id="heading-14"><strong>æ–‡æœ«å½©è›‹</strong></h2>
<p>ä»¥åï¼Œä½ åœ¨ä»£ç é‡Œçœ‹åˆ°éšæ‰‹åˆ›å»ºçš„çº¿ç¨‹æ± ï¼Œæœ€ç»ˆæ²¡æœ‰.shutdown()ï¼Œè¯·åƒçœ‹åˆ°æœ‰äººä¸Šå•æ‰€ä¸å†²æ°´ä¸€æ ·ï¼Œå¤§å–Šï¼šâ€œåŒï¼å­¦ï¼ä½ ï¼çº¿ç¨‹æ± ï¼å¿˜ï¼å…³ï¼äº†ï¼â€</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[å»åˆ°æ¯”åŒ—æ–¹æ›´åŒ—çš„åœ°æ–¹â€”2025å¹´ç»ˆæ€»ç»“]]></title>    <link>https://juejin.cn/post/7603769956975231017</link>    <guid>https://juejin.cn/post/7603769956975231017</guid>    <pubDate>2026-02-08T06:56:33.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7603769956975231017" data-draft-id="7591389489411555369" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="å»åˆ°æ¯”åŒ—æ–¹æ›´åŒ—çš„åœ°æ–¹â€”2025å¹´ç»ˆæ€»ç»“"/> <meta itemprop="keywords" content="å‰ç«¯,AIç¼–ç¨‹,å¹´ç»ˆæ€»ç»“"/> <meta itemprop="datePublished" content="2026-02-08T06:56:33.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="æµ·çŸ³"/> <meta itemprop="url" content="https://juejin.cn/user/3747593580715102"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            å»åˆ°æ¯”åŒ—æ–¹æ›´åŒ—çš„åœ°æ–¹â€”2025å¹´ç»ˆæ€»ç»“
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3747593580715102/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    æµ·çŸ³
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-08T06:56:33.000Z" title="Sun Feb 08 2026 06:56:33 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»7åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:14px;overflow-x:hidden;color:var(--cyanosis-base-color);transition:color .35s;--cyanosis-base-color:#353535;--cyanosis-title-color:#005bb7;--cyanosis-strong-color:#2196f3;--cyanosis-em-color:#4fc3f7;--cyanosis-del-color:#ccc;--cyanosis-link-color:#3da8f5;--cyanosis-linkh-color:#007fff;--cyanosis-border-color:#bedcff;--cyanosis-border-color-2:#ececec;--cyanosis-bg-color:#fff;--cyanosis-blockquote-color:#8c8c8c;--cyanosis-blockquote-bg-color:#f0fdff;--cyanosis-code-color:#c2185b;--cyanosis-code-bg-color:#fff4f4;--cyanosis-code-pre-color:#f8f8f8;--cyanosis-table-border-color:#c3e0fd;--cyanosis-table-th-color:#dff0ff;--cyanosis-table-tht-color:#005bb7;--cyanosis-table-tr-nc-color:#f7fbff;--cyanosis-table-trh-color:#e0edf7;--cyanosis-slct-title-color:#005bb7;--cyanosis-slct-titlebg-color:rgba(175,207,247,0.25);--cyanosis-slct-text-color:#c80000;--cyanosis-slct-bg-color:rgba(175,207,247,0.25);--cyanosis-slct-del-color:#999;--cyanosis-slct-elbg-color:#e8ebec;--cyanosis-slct-codebg-color:#ffeaeb;--cyanosis-slct-prebg-color:rgba(160,200,255,0.25)}.markdown-body.__dark{--cyanosis-base-color:#cacaca;--cyanosis-title-color:#ddd;--cyanosis-strong-color:#fe9900;--cyanosis-em-color:#ffd28e;--cyanosis-del-color:#ccc;--cyanosis-link-color:#ffb648;--cyanosis-linkh-color:#fe9900;--cyanosis-border-color:#ffe3ba;--cyanosis-border-color-2:#ffcb7b;--cyanosis-bg-color:#2f2f2f;--cyanosis-blockquote-color:#c7c7c7;--cyanosis-blockquote-bg-color:rgba(255,199,116,0.1);--cyanosis-code-color:#000;--cyanosis-code-bg-color:#ffcb7b;--cyanosis-code-pre-color:rgba(255,227,185,0.5);--cyanosis-table-border-color:#fe9900;--cyanosis-table-th-color:#ffb648;--cyanosis-table-tht-color:#000;--cyanosis-table-tr-nc-color:#6d5736;--cyanosis-table-trh-color:#947443;--cyanosis-slct-title-color:#000;--cyanosis-slct-titlebg-color:#fe9900;--cyanosis-slct-text-color:#00c888;--cyanosis-slct-bg-color:rgba(175,207,247,0.25);--cyanosis-slct-del-color:#999;--cyanosis-slct-elbg-color:#000;--cyanosis-slct-codebg-color:#ffcb7b;--cyanosis-slct-prebg-color:rgba(160,200,255,0.25)}.markdown-body h1{padding-bottom:4px;font-size:30px}.markdown-body h1,.markdown-body h2{margin-top:36px;margin-bottom:10px;line-height:1.5;color:var(--cyanosis-title-color);transition:color .35s}.markdown-body h2{position:relative;padding-left:10px;padding-right:10px;padding-bottom:10px;font-size:24px;border-bottom:1px solid var(--cyanosis-border-color-2)}.markdown-body h2:before{content:"ã€Œ";position:absolute;top:-6px;left:-14px}.markdown-body h2:after{content:"ã€";position:relative;top:6px;right:auto}.markdown-body h3{position:relative;padding-bottom:0;margin-top:30px;margin-bottom:10px;font-size:20px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body h3:before{content:"Â»";padding-right:6px;color:var(--cyanosis-strong-color)}.markdown-body h4{margin-top:24px;font-size:16px}.markdown-body h4,.markdown-body h5{padding-bottom:0;margin-bottom:10px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body h5{margin-top:18px;font-size:14px}.markdown-body h6{padding-bottom:0;margin-top:12px;margin-bottom:10px;font-size:12px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body p{line-height:inherit;margin-top:16px;margin-bottom:16px}.markdown-body img{max-width:100%}.markdown-body hr{position:relative;width:98%;height:1px;margin-top:32px;margin-bottom:32px;background-image:linear-gradient(90deg,var(--cyanosis-link-color),rgba(255,0,0,.3),hsla(0,0%,100%,.1),rgba(255,0,0,.3),var(--cyanosis-link-color));border-width:0;overflow:visible}.markdown-body hr:after{content:"";position:absolute;margin:auto;left:0;right:0;bottom:0;top:0;display:inline-block;width:60px;height:20px;background-color:var(--cyanosis-bg-color);background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAgCAYAAABgrToAAAADoklEQVRYR82XTYgcRRTHf2933Q1RjAa9eFO8JHoJ8RQVBQ2iBwXBET0YEUTXNVmNQtTpmeqaWV0XNRq/o4KoECSCEPSg4CF+BYUkIIiCoCJCPIhC/Ihh2Z0nVV27VnZnenumW9i6ddV7//frV69fVQurfMgq56NawFTPAU6QyomqXrw6wIZeyhCPebA5buNR+akKyGoAjd6BshthnYdSjqNcRVuOlIUsD2j0SuA94IwuMHdh5ZUykOUBXfSGbmKI54EtAeYIHSZoy5dl4JxvNYBOKdW1KE8BQ8AkVk6WhasWsAiN0TX9gveXQaPP+Aytpc4u+bMI06JNohsYYYYOR2lJWtS3OKDRfcAtQfgDoI6Vo4UCGb0OmAEuDvZvYmVbEd/igC3dzDz7gQu8sPA9kJDK27mBmjqBeLjTg90PDFOjWawFFQd06kZHEfaj3LAIpTRpSXsZ5E06zEYP9sDimnAApYaV2SLZG/wjMeqAkijwW4xQJ5Gf/ZzRC8OW3hiBTGGlURRswW55Bh/Ssxljrwew8l1PQaM14GngvGDzBUKdDsMeTtgU5o8B92PFlUf3YXUrHa7Fys6lBqcCGnX15YQ2A18FyPd7Crd1A3M8C1wdbH4DD3hWeP6IEXbQkG97ajR1HPFnuPP5jFFq1OWX7hl8WM9l1AO648uNfwLk7tytMeogty+xeQ4rO3r6bdcx1nuwOGsHmaXGtPzae4uzGnLH1kQkvpdZGrHjssBZJrL+pqS05KWc8tgITAPXRzYvYOXe/C2OV43eDcRBDtIhoS2f9wzc0Cv8Wls+zoFzUC5zF0U241h5uZtPfptp6OUM8wbK+cH5GEpCS17P3fJei0Z3+npTxryJ8CPzbKMtn/ZyWbkPGl0PuFPkmkjkcb4h4R2ZLwRq1H0ALmvjkf2HwK1Y+T1PY2XABe/sHJ6MxN5lnoSpnC/UGbsTaI5phK2R7x6s3Ffk5YoDOrWm3onwJHBmEP86bPmBrsGaenNoIdnxCH+gPEhLXi0Cl1VBvyPVLSh7gEuC62yAfOIUqabWEaaiucMIk6RyqJ+Q/QM69V26jjW86Gvov/EaoyT8zRCn+Xq7PVrbx0nuYUaO9wM3WAbjCE1NEUw09Um4UV+2OKfYfu5/S19gsAzGKqm6LE5FrShbdS0ku465DjDwKA/oQht19ejqbaEVuRbiLhuHByYLjtUAZpDutzP7cYdHsPJXWbjyNVgFwQoa1WXwf4Jd9YD/Ap80+yE7+u9aAAAAAElFTkSuQmCC);background-repeat:no-repeat;background-size:auto 100%;background-position-x:center;transition:background-color .5s}.markdown-body code{padding:.065em .4em;font-size:.87em;color:var(--cyanosis-code-color);word-break:break-word;overflow-x:auto;background-color:var(--cyanosis-code-bg-color);border-radius:2px}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{display:block;padding:16px 12px;margin:0;font-size:12px;color:#333;word-break:normal;overflow-x:auto;background:var(--cyanosis-code-pre-color)}.markdown-body pre&gt;code::-webkit-scrollbar{width:4px;height:4px}.markdown-body pre&gt;code::-webkit-scrollbar-track{background-color:var(--cyanosis-border-color)}.markdown-body pre&gt;code::-webkit-scrollbar-thumb{background-color:var(--cyanosis-strong-color);border-radius:10px}.markdown-body a{position:relative;text-decoration:none;color:var(--cyanosis-link-color);border-bottom:1px solid var(--cyanosis-border-color)}.markdown-body a:hover{border-bottom-color:var(--cyanosis-linkh-color)}.markdown-body a:active,.markdown-body a:hover{color:var(--cyanosis-linkh-color)}.markdown-body a:after{position:absolute;content:"";top:100%;left:0;width:100%;opacity:0;border-bottom:1px solid var(--cyanosis-border-color);transition:top .3s,opacity .3s;transform:translateZ(0)}.markdown-body a:hover:after{top:0;opacity:1;border-bottom-color:var(--cyanosis-linkh-color)}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid var(--cyanosis-table-border-color);border-spacing:0;border-collapse:collapse}.markdown-body table thead{color:#000;text-align:left;font-size:14px;background:#f6f6f6}.markdown-body table tr:nth-child(2n){background-color:var(--cyanosis-table-tr-nc-color)}.markdown-body table tr:hover{background-color:var(--cyanosis-table-trh-color)}.markdown-body table td,.markdown-body table th{padding:12px 8px;line-height:24px;border:1px solid var(--cyanosis-table-border-color)}.markdown-body table th{color:var(--cyanosis-table-tht-color);background-color:var(--cyanosis-table-th-color)}.markdown-body table td{min-width:120px}.markdown-body blockquote{color:var(--cyanosis-blockquote-color);border-left:4px solid var(--cyanosis-strong-color);background-color:var(--cyanosis-blockquote-bg-color);padding:1px 20px;margin:22px 0;transition:color .35s}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body b,.markdown-body blockquote&gt;b,.markdown-body blockquote&gt;strong,.markdown-body strong{color:var(--cyanosis-strong-color)}.markdown-body em,.markdown-body i{color:var(--cyanosis-em-color)}.markdown-body del{color:var(--cyanosis-del-color)}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:4px}.markdown-body ol li{padding-left:6px}.markdown-body details&gt;summary{outline:none;color:var(--cyanosis-title-color);font-size:20px;font-weight:bolder;border-bottom:1px solid var(--cyanosis-border-color);cursor:pointer}.markdown-body details&gt;p{padding:10px 20px;margin:10px 0 0;color:#666;background-color:var(--cyanosis-blockquote-bg-color);border:2px dashed var(--cyanosis-strong-color)}.markdown-body h1::selection,.markdown-body h2::selection,.markdown-body h3::selection,.markdown-body h4::selection,.markdown-body h5::selection,.markdown-body h6::selection{color:var(--cyanosis-slct-title-color);background-color:var(--cyanosis-slct-titlebg-color)}.markdown-body ol li::selection,.markdown-body p::selection,.markdown-body ul li::selection{color:var(--cyanosis-slct-text-color);background-color:var(--cyanosis-slct-bg-color)}.markdown-body a::selection,.markdown-body b::selection,.markdown-body em::selection,.markdown-body i::selection,.markdown-body strong::selection{background-color:var(--cyanosis-slct-elbg-color)}.markdown-body del::selection{color:var(--cyanosis-slct-del-color);background-color:var(--cyanosis-slct-elbg-color)}.markdown-body table thead th::selection{background-color:transparent}.markdown-body table tbody td::selection{background-color:var(--cyanosis-slct-bg-color)}.markdown-body code::selection{background-color:var(--cyanosis-slct-codebg-color)}.markdown-body pre&gt;code::selection{background-color:var(--cyanosis-slct-prebg-color)}.markdown-body .contains-task-list{padding-left:14px;list-style:none}.markdown-body .contains-task-list input[type=checkbox]{position:relative}.markdown-body .contains-task-list input[type=checkbox]:before{content:"";position:absolute;top:0;left:0;right:0;bottom:0;width:inherit;height:inherit;background:#f0f8ff;border:1px solid #add6ff;border-radius:2px;box-sizing:border-box;z-index:1}.markdown-body .contains-task-list input[type=checkbox]:checked:after{content:"âœ“";position:absolute;top:-12px;left:0;right:0;bottom:0;width:0;height:0;color:#f55;font-size:20px;font-weight:700;z-index:2}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="atom-one-dark">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#abb2bf;background:#282c34}.hljs-comment,.hljs-quote{color:#5c6370;font-style:italic}.hljs-doctag,.hljs-formula,.hljs-keyword{color:#c678dd}.hljs-deletion,.hljs-name,.hljs-section,.hljs-selector-tag,.hljs-subst{color:#e06c75}.hljs-literal{color:#56b6c2}.hljs-addition,.hljs-attribute,.hljs-meta-string,.hljs-regexp,.hljs-string{color:#98c379}.hljs-built_in,.hljs-class .hljs-title{color:#e6c07b}.hljs-attr,.hljs-number,.hljs-selector-attr,.hljs-selector-class,.hljs-selector-pseudo,.hljs-template-variable,.hljs-type,.hljs-variable{color:#d19a66}.hljs-bullet,.hljs-link,.hljs-meta,.hljs-selector-id,.hljs-symbol,.hljs-title{color:#61aeee}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}.hljs-link{text-decoration:underline}</style><p><em>æƒ³å†™å¹´ç»ˆæ€»ç»“çš„å¿ƒæƒ…ï¼Œæ˜¯åœ¨çœ‹åˆ°è½¦çª—å¤–çš„é›ªä¹‹åï¼Œçªç„¶æœ‰çš„ã€‚</em></p>
<p>2025å¹´çš„æœ€åä¸€å¤©ï¼Œæˆ‘ä»¬åä¸Šäº†ä»åŒ—äº¬æœé˜³å¼€å¾€å»¶å‰è¥¿çš„é«˜é“ã€‚</p>
<p>è½¦å¢å†…çš„æš–æ°”å¼€å¾—å¾ˆè¶³ï¼Œæˆ‘é åœ¨æ¤…èƒŒä¸Šï¼Œè§‰å¾—ç å­—æ˜¯æ‰“å‘è¿™6å°æ—¶è½¦ç¨‹å†å¥½ä¸è¿‡çš„äº‹ã€‚</p>
<p>å¤å…¸ä¸»ä¹‰è®¤ä¸ºçµæ„Ÿæ˜¯ç¥çš„æ—¨æ„ï¼Œäºæ˜¯æˆ‘ä¾¿å¼€å§‹ç­‰å¾…ï¼Œç­‰å¾…ç€ç¥å¯¹æˆ‘ä¸‹è¾¾ç¥‚çš„æ—¨æ„ã€‚</p>
<p>æ²¡ç­‰å¤šä¹…æˆ‘å°±å‘ç°äº†æ¯”ç å­—è¿˜è¦å¥½çš„äº‹æƒ…ï¼Œé‚£å°±æ˜¯ç¡è§‰ã€‚</p>
<p>äºæ˜¯è¿™ä¸€ç¯‡åœ¨ç¦»å¼€åŒ—äº¬æ—¶å°±æƒ³å†™çš„æ–‡ç« ï¼Œæœ€ç»ˆè¿˜æ˜¯åœ¨æˆ‘å›åŒ—äº¬ä¹‹åï¼Œæ‰è¢«å†™å‡ºæ¥ã€‚</p>
<hr/>
<h2 data-id="heading-0">æ—¶ä»£çš„å…³é”®è¯</h2>
<blockquote>
<p>å¦‚æœè®©å¤§å®¶ç”¨ä¸€ä¸ªè¯è¯­å½¢å®¹2025å¹´ï¼Œå¤§å®¶ä¼šé€‰æ‹©ä»€ä¹ˆè¯è¯­å‘¢ï¼Ÿ</p>
</blockquote>
<p>æˆ‘é€‰çš„è¯è¯­æ˜¯â€œAIâ€</p>
<p>ä»chatGPTä¸€é¸£æƒŠäººçš„â€œAIå…ƒå¹´â€æ¥ç®—ï¼Œè¿™æ³¢æµªæ½®å·²ç»æ±¹æ¶Œäº†3å¹´ã€‚</p>
<p>å¤§å®¶éƒ½è¯´è¦æ‹¥æŠ±å˜åŒ–ï¼Œæ‹¥æŠ±å˜åŒ– ã€‚</p>
<p>ä¸ªäººæ„Ÿè§‰å˜åŒ–å·²ç»ä¸å¤Ÿå½¢å®¹äº†</p>
<p>è¿™æ˜¯ <strong>å†²å‡»</strong></p>
<p>ä»¥<code>Cursor</code>ä¸ºé¦–çš„AI IDEå·¥å…·æ­£åœ¨å†²å‡»æˆ‘ä»¬è¿™ä¸ªèŒä¸š</p>
<p>æŠ€æœ¯ç¤¾åŒºçš„åšå®¢é‡Œæ¶Œç°å‡ºè¶Šæ¥è¶Šå¤šçš„åè¯ï¼ŒLLMã€Agentã€MCPã€CSRã€Rulesã€Skillsã€AGUIã€A2UIã€A2Aç­‰ç­‰</p>
<p>é›†å›¢åœ¨å¹´åˆé‚€è¯·æ¢å®åšäº†ä¸€æ¬¡åˆ†äº«ï¼Œæˆ‘å½“æ—¶æ²¡æ¥å¾—åŠå»çº¿ä¸‹ï¼Œåæ¥ç”¨å‡ ä¸ªåˆä¼‘çš„æ—¶é—´ï¼Œæ–­æ–­ç»­ç»­çœ‹å®Œäº†å½•æ’­å›æ”¾</p>
<p>åœ¨è§†é¢‘æ’­æ”¾å®Œæ¯•ï¼Œè¿›åº¦æ¡å·²ç»é‡ç½®çš„æ—¶å€™ï¼Œè„‘æµ·é‡Œè¿˜æ˜¯å­˜åœ¨ç€å¥¹é¢‘é¢‘æåˆ°çš„6ä¸ªå­—</p>
<p><em>â€œæ—¶ä»£çš„å…³é”®è¯â€</em></p>
<ul>
<li>
<p>è’¸æ±½æ—¶ä»£çš„å…³é”®è¯æ˜¯æ•ˆç‡ä¸å¯¹ç§°</p>
</li>
<li>
<p>äº’è”ç½‘æ—¶ä»£çš„å…³é”®è¯æ˜¯ä¿¡æ¯ä¸å¯¹ç§°</p>
</li>
<li>
<p>AIæ—¶ä»£çš„å…³é”®è¯æ˜¯ç»éªŒä¸å¯¹ç§°</p>
</li>
</ul>
<p>ä»æ¢å®çš„è§†è§’çœ‹äº’è”ç½‘æ—¶ä»£ï¼Œå¯¹æˆ‘æ¥è¯´æ˜¯å¾ˆæ–°å¥‡çš„ä½“éªŒï¼š</p>
<p>â€œäº’è”ç½‘è§£å†³çš„æ˜¯ä»€ä¹ˆé—®é¢˜ï¼Œè§£å†³çš„å°±æ˜¯ä¿¡æ¯ä¸å¯¹ç§°è¿™ä¸ªé—®é¢˜</p>
<p>æ‰€ä»¥æˆ‘ä»¬æœ‰æ—¶å€™ä¹Ÿä¼šç”¨â€˜ä¿¡æ¯æ—¶ä»£â€™æ¥ç§°å‘¼â€˜äº’è”ç½‘æ—¶ä»£â€™</p>
<p>é‚£ä¹ˆä»€ä¹ˆæ˜¯â€˜ä¿¡æ¯â€™ï¼Ÿ</p>
<p>æˆ‘ä»¬åœ¨ç½‘ä¸Šçœ‹åˆ°çš„å›¾ç‰‡ä¹Ÿå¥½ï¼Œè§†é¢‘ä¹Ÿå¥½ï¼Œæ–‡å­—ä¹Ÿå¥½ï¼Œè®¤ä¸ºè‡ªå·±çœ‹åˆ°äº†ä¸€ä¸ªå•†å“ä¹Ÿå¥½ã€äººç‰©ä¹Ÿå¥½ã€‚</p>
<p>æˆ‘ä»¬åœ¨äº’è”ç½‘ä¸Šçœ‹åˆ°çš„ä¸€åˆ‡ï¼Œéƒ½æ˜¯ä¿¡æ¯ã€‚</p>
<p>å†ä¹¦é¢åŒ–ä¸€äº›ï¼Œå¼•ç”¨ã€Šä¿¡æ¯ç³»ç»Ÿé¡¹ç›®ç®¡ç†å¸ˆæ•™ç¨‹ã€‹è¿™æœ¬ä¹¦é‡Œå¯¹äºä¿¡æ¯çš„å®šä¹‰</p>
<blockquote>
<p>ä¿¡æ¯æ˜¯ç‰©è´¨ã€èƒ½é‡åŠå…¶å±æ€§çš„æ ‡ç¤ºçš„é›†åˆ</p>
</blockquote>
<p>è°ˆåˆ°äº’è”ç½‘æ—¶ä»£ï¼Œè°ˆåˆ°äº’è”ç½‘ï¼Œè‚¯å®šç»•ä¸å¼€BATï¼Œ</p>
<p>ä¸ºä»€ä¹ˆBATä¼šäº§ç”Ÿã€ä¼šå´›èµ·ï¼Ÿ</p>
<p>å…ˆè¯´Bï¼Œç™¾åº¦æ˜¯æœç´¢å¼•æ“ï¼Œä»–å¤©ç„¶æ”¶å‰²äº†webä¸Šçš„æ‰€æœ‰ä¿¡æ¯</p>
<p>äº’è”ç½‘è§£å†³çš„æ˜¯ä¿¡æ¯ä¸å¯¹ç§°çš„é—®é¢˜ï¼Œæœç´¢å¼•æ“åˆå¤©ç„¶ç«™åœ¨äº†è¿™ç§ç”Ÿæ€ä½çš„é¡¶ç«¯ï¼Œä»–èƒ½æ‹¿åˆ°å…¨é‡çš„ä¿¡æ¯ï¼Œä½œä¸ºæ”¶å‰²è€…</p>
<p>å› æ­¤è¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆæœ€åˆBæ˜¯BATä¹‹é¦–çš„åŸå› ã€‚</p>
<p>å†è¯´Tï¼Œè…¾è®¯çš„æ ¸å¿ƒä¿¡æ¯æ˜¯ä»€ä¹ˆï¼Ÿæ˜¯äººï¼Œ</p>
<blockquote>
<p>â€œäººæ˜¯ä¸€åˆ‡ç¤¾ä¼šå…³ç³»çš„æ€»å’Œâ€ â€”é©¬å…‹æ€</p>
</blockquote>
<p>åœ¨äº’è”ç½‘å¦‚ä½•ç”¨ä¿¡æ¯è¡¨è¾¾ä¸€ä¸ªäººï¼Ÿ</p>
<p>idå’Œå…³ç³»é“¾</p>
<p>æ²¡äººèƒ½æ’¼åŠ¨ä»–çš„æ ¸å¿ƒï¼Œç¢°ä»–çš„äºº</p>
<p>è€Œä¸”ä»–è·³è„±åœ¨äº†ç™¾åº¦çš„æ”¶å‰²ä¹‹å¤–</p>
<p>å› ä¸ºä»–æ˜¯å®¢æˆ·ç«¯</p>
<p>æœ€åæ¥è¯´è¯´Aï¼Œé˜¿é‡Œ</p>
<p>ä¸ºä»€ä¹ˆç™¾åº¦ä¹Ÿæ”¶å‰²ä¸äº†é˜¿é‡Œï¼Ÿ</p>
<p>æœ€æ—©çš„æ—¶å€™æ·˜å®ä¸»åŠ¨å±è”½ç™¾åº¦çš„æœç´¢ï¼Œæ·˜å®é€šè¿‡æ„å»ºè‡ªå·±çš„å•†å“ä¿¡æ¯ç”Ÿæ€ï¼Œä»–è‡ªå·±æ‰“é€ çš„ä¿¡æ¯å½“ç„¶æ˜¯ä»–è‡ªå·±å†…éƒ¨æ”¶å‰²ï¼Œå› æ­¤ç™¾åº¦æ”¶å‰²ä¸äº†ä»–çš„ä¿¡æ¯</p>
<p>äººçš„ä¿¡æ¯ã€äº¤æ˜“çš„ä¿¡æ¯ã€å…¶ä»–çš„ä¿¡æ¯ï¼ˆæ¯”å¦‚æºç¨‹ï¼‰æ„æˆäº†ä¿¡æ¯çš„å…¨éƒ¨</p>
<p>ç°åœ¨åˆ™æ˜¯æ¯ä¸ªä¼ä¸šéƒ½åœ¨æ„å»ºè‡ªå·±çš„ä¿¡æ¯ç”Ÿæ€ï¼Œæºç¨‹æ˜¯é…’æ—…ï¼Œäº¬ä¸œæ˜¯ä¾›åº”é“¾</p>
<p>è€Œåˆ°äº†ç§»åŠ¨äº’è”ç½‘æ—¶ä»£ï¼Œ</p>
<p>å°çº¢ä¹¦ã€æŠ–éŸ³åˆæœ‰è‡ªå·±çš„ä¿¡æ¯ç”Ÿæ€â€</p>
<p>é‚£ä¹ˆAIæ—¶ä»£çš„ç»éªŒä¸å¯¹ç§°åˆè¯¥ä»ä½•è¯´èµ·ï¼Ÿ</p>
<p>å¦‚ä½•åŒºåˆ†â€œçŸ¥è¯†â€å’Œâ€œç»éªŒâ€ï¼Ÿ</p>
<p>æˆ‘å¾ˆå¥½å¥‡æ¢å®åˆä¼šæ€ä¹ˆçœ‹å¾…ç°åœ¨çš„æ—¶ä»£ï¼Œåœ¨ã€ŠçœŸéœ€æ±‚ã€‹è¿™æœ¬ä¹¦å†™å®Œåï¼Œå¤–è¾¹çš„ä¸–ç•Œå‘ç”Ÿäº†å¤©ç¿»åœ°è¦†çš„å˜åŒ–â€¦</p>
<h2 data-id="heading-1">ä¸å…¶æ„Ÿæ…¨è·¯éš¾è¡Œï¼Œä¸å¦‚é©¬ä¸Šå‡ºå‘</h2>
<p>æ‰“å®Œè¿™ä¸ªæ ‡é¢˜ï¼Œæˆ‘æŠ¬å¤´çœ‹äº†ä¸€çœ¼ç”µè„‘æ—çš„é¥®æ–™ï¼Œå†™æ–‡å­—çš„æ—¶å€™éœ€è¦å–ç‚¹å°ç”œæ°´ï¼Œè¿™æ˜¯æˆ‘ä¸¤å¹´å‰å…»æˆçš„ä¹ æƒ¯</p>
<p>åæ¥æˆ‘å‘ç°å¾ˆå¤šä½œå®¶ä¹Ÿæœ‰è¿™æ ·çš„ä¹ æƒ¯ï¼Œç‹å°æ³¢éœ€è¦ä¸€ç›´å–èŒ¶ã€å¸çƒŸï¼Œæ¥è®©è‡ªå·±ä¿æŒä¸€ä¸ªäº¢å¥‹çš„çŠ¶æ€ï¼Œç”¨äºå†™ä½œ</p>
<ul>
<li>
<p>2024å¹´ï¼Œæˆ‘å†™äº†å°†è¿‘20ä¸‡å­—ï¼Œè¾“å‡ºäº†34ç¯‡æŠ€æœ¯åšå®¢ï¼Œæ˜é‡‘çš„çƒ­æ¦œæŒ¤è¿›å»è¿‡å‡ æ¬¡ï¼Œè¿˜â€œæ··â€œä¸Šè¿‡ç¬¬ä¸€ï¼Œè‡³äºå–æ‰äº†çš„é¥®æ–™æ•°...å¤§æ¦‚ä¹Ÿèƒ½åœ¨ä½™æ­åŒºæ‹”å¾—å¤´ç­¹å§ğŸ˜„</p>
</li>
<li>
<p>2025å¹´ï¼Œæˆ‘åªåœ¨æ˜é‡‘å‘äº†3ç¯‡æ–‡ç« ï¼Œæ­£æ–‡åŠ èµ·æ¥ä¼°è®¡1ä¸‡å­—å·¦å³</p>
</li>
</ul>
<p>åŒæ¯”<strong>ä¸‹é™2000%</strong>ï¼Œæˆ‘è¿˜æƒ³ä¸æƒ³åœ¨æ˜é‡‘æ··äº†ï¼Ÿ</p>
<p>éä¹Ÿéä¹Ÿï¼Œå€’ä¸æ˜¯æˆ‘ä¹Ÿæ„Ÿæ…¨è·¯éš¾è¡Œäº†æ‰€ä»¥ä¸å»è¡Œäº†ï¼Œè€Œæ˜¯è½¬æˆ˜åœºäº†ï¼Œä¸»è¦çš„æŠ€æœ¯æ²‰æ·€ä¸åˆ†äº«éƒ½åœ¨å…¬å¸å†…éƒ¨ç¤¾åŒºã€‚</p>
<p>æœ¬æ¥è¿™ä¸€ç« èŠ‚æ˜¯æƒ³é¡ºç€è¿™ä¸ªæ ‡é¢˜åšä¸€äº›æŠ€æœ¯å†™ä½œçš„å¿ƒå¾—åˆ†äº«ï¼Œä½†æ˜¯éšç€OpenClawçš„å‡ºç°ï¼Œæˆ‘å¯¹æŠ€æœ¯å†™ä½œäº§ç”Ÿäº†å®Œå…¨ä¸åŒäºä»¥å¾€çš„æƒ³æ³•</p>
<ul>
<li>
<p>å°±åƒOpenClawå‡ºç°ä¹‹åï¼Œç¨‹åºå‘˜åº”è¯¥å»å†™è®©å¤§æ¨¡å‹æ›´æ–¹ä¾¿é˜…è¯»å’Œç†è§£çš„cliå±‚é¢çš„ä¸œè¥¿ä¸€æ ·ã€‚</p>
</li>
<li>
<p>ä»¥åæ‰€è°“çš„æŠ€æœ¯åšå®¢ï¼Œæ˜¯ä¸æ˜¯ä¹Ÿå°±æ˜¯å†™æˆè®©å¤§æ¨¡å‹æ›´èƒ½è¯»æ‡‚ã€æœ€ä½³è¯»æ‡‚ä»£ç çš„æç¤ºè¯è€Œå·²</p>
</li>
</ul>
<p>å½¢æ€ä¸Šçš„å˜åŒ–</p>
<p>æ¯”å¦‚æˆ‘å†™ä¸€ç¯‡æºç åˆ†æï¼Œä»£ç å±‚é¢çš„æŸ¥çœ‹åŸºæœ¬å°±æ˜¯é å¤§æ¨¡å‹é€šè¿‡csrå»å…¨é¢è§£è¯»ï¼Œç„¶åæˆ‘å†åŸºäºä¸ªäººç»éªŒå’Œç†è§£å®Œæˆæ±‡æ€»ï¼Œé¡ºä¾¿è¡¥ä¸ŠçŸ¥è¯†ç‚¹çš„å®˜æ–¹æ–‡æ¡£å‡ºå¤„ï¼Œç¡®ä¿ä¸ä¼šè¯¯äººå­å¼Ÿã€å‡å°‘å¤§æ¨¡å‹çš„å¹»è§‰</p>
<p>ä½†æ˜¯å…¶å®å¾ˆå¤šæ—¶å€™ä¹Ÿæ²¡å¿…è¦èŠ±åŠ›æ°”æ‰“å¼€åšå®¢è®ºå›å»çœ‹åˆ«äººçš„è¿™ç§æ–‡ç« </p>
<p>ä½œä¸ºå¼€å‘è€…æˆ‘æœŸæœ›æˆ‘èƒ½åœ¨AI IDEé‡Œå®Œæˆä¸€åˆ‡ï¼Œæˆ‘å¸Œæœ›å®ƒåœ¨ä»£ç è§£è¯»æ—¶æ˜¯ç«™åœ¨é«˜è´¨é‡æŠ€æœ¯åšä¸»çš„è§†è§’ä¸Šçš„ã€‚</p>
<p>å¾ˆå¤šæ—¶å€™åŒä¸€ä¸ªçŸ¥è¯†ç‚¹ï¼Œä¸åŒæ°´å¹³çš„äººçœ‹åˆ°çš„é—¨é“æ˜¯ä¸ä¸€æ ·çš„ã€‚</p>
<p>è¯´ä¸ªå…«è‚¡æ–‡ï¼Œjsçš„é—­åŒ…æ˜¯åƒäººåƒé¢ï¼Œå„ç§è¯´æ³•éƒ½æœ‰ï¼Œ</p>
<p>èƒŒåçš„æ ¹å› æˆ‘æƒ³å°±æ˜¯æ¯ä¸ªäººçš„ç†è§£æœ‰æ·±æœ‰æµ…ã€‚</p>
<p>å¤§å®¶ç”¨äº†è¿™ä¹ˆä¹…çš„æŠ€æœ¯è®ºå›ï¼Œåº”è¯¥çœ‹è¿‡ä¸å°‘æŠ€æœ¯å¤§ä½¬ã€æŠ€æœ¯å›¢é˜Ÿçš„æ–‡ç« </p>
<p>æœ‰äº›æŠ€æœ¯å¤§ä½¬çœ‹é—®é¢˜çš„è§’åº¦ç‰¹åˆ«åˆé’»ã€ç‰¹åˆ«æ·±å…¥ï¼Œçœ‹å®Œå¾€å¾€ä¼šè®©äººæ‹å¤§è…¿ï¼ŒåŸæ¥è¿˜èƒ½è¿™ä¹ˆç†è§£å—ï¼Ÿ</p>
<p>æœ‰äº›æŠ€æœ¯å›¢é˜Ÿçœ‹é—®é¢˜ç›´æŠ“æœ¬è´¨ï¼Œè§£å†³æ–¹æ¡ˆä¸€å‡ºå°±æ˜¯æœ€ä½³å®è·µ</p>
<p>å¦‚æœå¤§æ¨¡å‹èƒ½å¤Ÿå…·å¤‡å’Œè¿™äº›æŠ€æœ¯å¤§ä½¬ã€æŠ€æœ¯å›¢é˜Ÿä¸€æ ·å¯¹é—®é¢˜/ç°è±¡/çŸ¥è¯†ç‚¹ çš„æ€è€ƒä¸è§£è¯»èƒ½åŠ›</p>
<p>æˆ‘ä»¬æ˜¯å¦è¿˜æœ‰å¿…è¦è®¿é—®æŠ€æœ¯è®ºå›ã€å…³æ³¨è¿™äº›æŠ€æœ¯å¤§ä½¬ã€æŠ€æœ¯å›¢é˜Ÿå‘¢ï¼Ÿ</p>
<p>æˆ–è®¸ï¼Œåœ¨æœªæ¥ï¼ŒæŠ€æœ¯åšå®¢åªæœ‰å¸®åŠ©ä½œè€…æœ¬äººæ²‰æ·€çŸ¥è¯†ã€æŒæ¡çŸ¥è¯†è¿™ä¸€ä¸ªä½œç”¨äº†ï¼Ÿ</p>
<p>ï¼ˆè´¹æ›¼å­¦ä¹ æ³•ï¼šæ•™æˆä»–äººï¼Œå¯¹å­¦ä¹ çš„å¸æ”¶ç‡æ˜¯90%ï¼‰</p>
<h2 data-id="heading-2">â€œå‰ç«¯å·²æ­»â€</h2>
<ul>
<li>
<p>Claudeæ¨¡å‹æ›´æ–°äº†ï¼Œç”©å¼€åˆ«çš„ä¸€å¤§æˆªï¼Œå‰ç«¯å·²æ­»</p>
</li>
<li>
<p>GPT 5æ›´æ–°äº†ï¼ŒCodeMaxæ¨¡å¼ï¼Œç”©å¼€åˆ«çš„ä¸€å¤§æˆªï¼Œå‰ç«¯å·²æ­»</p>
</li>
<li>
<p>Geminiæ›´æ–°äº†ï¼Œç”©å¼€åˆ«çš„ä¸€å¤§æˆªï¼Œå‰ç«¯å·²æ­»</p>
</li>
</ul>
<p>å‰ç«¯åˆåŒå’å•æ­»äº†ğŸ˜­</p>
<p>Vibe Codingç¡®å®ç»™æˆ‘ä»¬è¿™ä¸ªè¡Œä¸šå¸¦æ¥äº†å·¨å¤§çš„å½±å“</p>
<p>skillså‡ºæ¥å‰ï¼Œä¾æ‰˜mcpå’Œrulesï¼Œå†åŠ ä¸Šè§„çº¦ç¼–ç¨‹ï¼Œå¤§æ¨¡å‹å°±èƒ½å†™å‡ºå¾ˆä¸é”™çš„ã€ç¬¦åˆç ”å‘è§„èŒƒçš„ä»£ç äº†</p>
<p>å†åŠ ä¸Šä¸€äº›d2cçš„å·¥å…·ï¼Œä»0åˆ°1çš„éœ€æ±‚å¼€å‘ï¼Œæ•ˆç‡ç¡®å®å¾—åˆ°äº†æ˜¾è‘—çš„æå‡</p>
<p>ä½†æ˜¯ç›®å‰çš„æ¨¡å¼å¯¹äºå¢é‡å¼€å‘ï¼ˆåŸºäºå·¥ç¨‹ç°æœ‰åŠŸèƒ½å®Œæˆéœ€æ±‚è¿­ä»£ï¼‰çš„ææ•ˆå…¶å®æ²¡é‚£ä¹ˆæ˜¾è‘—</p>
<p>å†è€…ï¼Œå¯¹äºç¨‹åºå‘˜æ¥è¯´ï¼Œå†™ä»£ç éœ€è¦çš„æ—¶é—´å¾ˆå¤šæ—¶å€™å¹¶ä¸æ˜¯å¤§å¤´ï¼Œæ›´å¤šæ—¶é—´è¢«èŠ±åœ¨äº†prdè¯„å®¡ï¼Œä¸Šä¸‹æ¸¸å¯¹é½ï¼Œåä½œæ²Ÿé€šï¼Œå¼€ä¼šç­‰éç¼–ç æ€§è´¨çš„äº‹ä¸Š</p>
<p>æˆ‘ä»¬å¯èƒ½ä¸åº”è¯¥å†ç»§ç»­æƒ³ç€æå‡5ä¸ªæµç¨‹èŠ‚ç‚¹ä¸­æŸä¸ªèŠ‚ç‚¹çš„å‡ ä¸ªå­èŠ‚ç‚¹çš„æ•ˆç‡</p>
<p>ï¼ˆæ¯”å¦‚ç ”å‘èŠ‚ç‚¹ä¸­çš„è®¾è®¡ç¨¿è¿˜åŸã€code reciewè¿™äº›å­èŠ‚ç‚¹ï¼‰</p>
<p>è€Œæ˜¯èƒ½ä¸èƒ½æŠŠ5ä¸ªæµç¨‹èŠ‚ç‚¹ç›´æ¥ç æˆ3ä¸ªï¼Œè¿™ç§å±‚é¢çš„ææ•ˆ</p>
<p>Vibe Codingä»€ä¹ˆæ—¶å€™å¯ä»¥ä¸ä»…ä»…æ˜¯Codingï¼Ÿ</p>
<h2 data-id="heading-3">å»åˆ°æ¯”åŒ—æ–¹æ›´åŒ—çš„åœ°æ–¹</h2>
<p>å‰ç«¯ä¸ä»…ä»…åªæ˜¯å‰ç«¯</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Spring Boot 4 å‡çº§æŒ‡å—ï¼šå‘Šåˆ«RestTemplateï¼Œæ‹¥æŠ±ç°ä»£HTTPå®¢æˆ·ç«¯]]></title>    <link>https://juejin.cn/post/7603651855236808713</link>    <guid>https://juejin.cn/post/7603651855236808713</guid>    <pubDate>2026-02-08T06:12:38.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7603651855236808713" data-draft-id="7603687444052033574" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Spring Boot 4 å‡çº§æŒ‡å—ï¼šå‘Šåˆ«RestTemplateï¼Œæ‹¥æŠ±ç°ä»£HTTPå®¢æˆ·ç«¯"/> <meta itemprop="keywords" content="åç«¯,Spring Boot"/> <meta itemprop="datePublished" content="2026-02-08T06:12:38.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Javaæ°´è§£"/> <meta itemprop="url" content="https://juejin.cn/user/2441349519143037"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Spring Boot 4 å‡çº§æŒ‡å—ï¼šå‘Šåˆ«RestTemplateï¼Œæ‹¥æŠ±ç°ä»£HTTPå®¢æˆ·ç«¯
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2441349519143037/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Javaæ°´è§£
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-08T06:12:38.000Z" title="Sun Feb 08 2026 06:12:38 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»8åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">Spring BootÂ 4 å‡çº§æŒ‡å—ï¼šå‘Šåˆ«RestTemplateï¼Œæ‹¥æŠ±ç°ä»£[HTTPå®¢æˆ·ç«¯]</h2>
<h3 data-id="heading-1"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>å¼•è¨€</h3>
<p>éšç€Spring Boot 4.0çš„å‘å¸ƒï¼Œæˆ‘ä»¬æ­£å¼å‘Šåˆ«äº†ä¸€ä¸ªæ—¶ä»£â€”â€”RestTemplateè¿™ä¸ªä¼´éšJavaå¼€å‘è€…åä½™å¹´çš„[HTTPå®¢æˆ·ç«¯å·¥å…·]æ­£å¼è¿›å…¥å¼ƒç”¨é˜¶æ®µã€‚åœ¨Spring Boot 4.0ä¸­ï¼ŒSpringå®˜æ–¹å¼ºçƒˆå»ºè®®è¿ç§»åˆ°æ›´ç°ä»£ã€æ›´å¼ºå¤§çš„HTTPå®¢æˆ·ç«¯è§£å†³æ–¹æ¡ˆã€‚</p>
<p>æœ¬æ–‡å°†è¯¦ç»†ä»‹ç»åœ¨Spring Boot 4.0ç¯å¢ƒä¸­å¦‚ä½•æ›¿æ¢RestTemplateï¼Œä»¥åŠæ¨èçš„æ–°ä¸€ä»£HTTPå®¢æˆ·ç«¯è§£å†³æ–¹æ¡ˆã€‚</p>
<h3 data-id="heading-2"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>èƒŒæ™¯ï¼šä¸ºä»€ä¹ˆRestTemplateä¸å†æ¨èï¼Ÿ</h3>
<h4 data-id="heading-3"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>1. æŠ€æœ¯æ¼”è¿›</h4>
<ul>
<li><strong>Spring Framework 5+</strong> ï¼šä»Spring Framework 5å¼€å§‹ï¼ŒRestTemplateå·²è¢«æ ‡è®°ä¸ºå¼ƒç”¨</li>
<li><strong>å“åº”å¼ç¼–ç¨‹è¶‹åŠ¿</strong>ï¼šç°ä»£åº”ç”¨éœ€è¦å¼‚æ­¥éé˜»å¡çš„HTTPè°ƒç”¨èƒ½åŠ›</li>
<li><strong>æ€§èƒ½ä¼˜åŒ–</strong>ï¼šæ–°çš„HTTPå®¢æˆ·ç«¯æä¾›æ›´å¥½çš„æ€§èƒ½å’Œèµ„æºåˆ©ç”¨ç‡</li>
</ul>
<h4 data-id="heading-4"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>2. Spring Boot 4.0çš„å˜åŒ–</h4>
<p>Spring Boot 4.0å¯¹HTTPå®¢æˆ·ç«¯è¿›è¡Œäº†é‡å¤§è°ƒæ•´ï¼š</p>
<ul>
<li>RestTemplateè¿›å…¥å®Œå…¨å¼ƒç”¨çŠ¶æ€</li>
<li>æ¨èä½¿ç”¨WebClientï¼ˆå“åº”å¼ï¼‰æˆ–RestClientï¼ˆåŒæ­¥ï¼‰</li>
<li>ç§»é™¤äº†å¯¹ä¼ ç»ŸHTTPå®¢æˆ·ç«¯çš„å†…ç½®æ”¯æŒ</li>
</ul>
<h3 data-id="heading-5"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>æ¨èçš„æ›¿ä»£æ–¹æ¡ˆ</h3>
<h4 data-id="heading-6"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>æ–¹æ¡ˆä¸€ï¼šWebClientï¼ˆæ¨èç”¨äºå¼‚æ­¥åœºæ™¯ï¼‰</h4>
<p>WebClientæ˜¯Spring WebFluxé¡¹ç›®çš„ä¸€éƒ¨åˆ†ï¼Œæä¾›å“åº”å¼ã€éé˜»å¡çš„HTTPå®¢æˆ·ç«¯åŠŸèƒ½ã€‚</p>
<h5 data-id="heading-7"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>ä¾èµ–é…ç½®</h5>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-comment">&lt;!-- Mavené…ç½® --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-webflux<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>

AIå†™ä»£ç xml
12345
</code></pre>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-comment">// Gradleé…ç½®</span>
implementation <span class="hljs-string">'org.springframework.boot:spring-boot-starter-webflux'</span>

AIå†™ä»£ç gradle
<span class="hljs-number">12</span>
</code></pre>
<h5 data-id="heading-8"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>åŸºæœ¬ä½¿ç”¨ç¤ºä¾‹</h5>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">import</span> org.springframework.web.reactive.function.client.WebClient;
<span class="hljs-keyword">import</span> reactor.core.publisher.Mono;

<span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HttpClientService</span> {
    
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> WebClient webClient;
    
    <span class="hljs-keyword">public</span> HttpClientService() {
        <span class="hljs-keyword">this</span>.webClient = WebClient.builder()
                .baseUrl(<span class="hljs-string">"https://api.example.com"</span>)
                .defaultHeader(<span class="hljs-string">"Content-Type"</span>, <span class="hljs-string">"application/json"</span>)
                .build();
    }
    
    <span class="hljs-comment">// GETè¯·æ±‚</span>
    <span class="hljs-keyword">public</span> Mono&lt;String&gt; getData(String id) {
        <span class="hljs-keyword">return</span> webClient
                .<span class="hljs-keyword">get</span>()
                .uri(<span class="hljs-string">"/data/{id}"</span>, id)
                .retrieve()
                .bodyToMono(String.<span class="hljs-keyword">class</span>);
    }
    
    <span class="hljs-comment">// POSTè¯·æ±‚</span>
    <span class="hljs-keyword">public</span> Mono&lt;User&gt; createUser(User user) {
        <span class="hljs-keyword">return</span> webClient
                .post()
                .uri(<span class="hljs-string">"/users"</span>)
                .bodyValue(user)
                .retrieve()
                .bodyToMono(User.<span class="hljs-keyword">class</span>);
    }
    
    <span class="hljs-comment">// å“åº”å¼é“¾å¼è°ƒç”¨</span>
    <span class="hljs-keyword">public</span> Mono&lt;Result&gt; complexWorkflow(String id) {
        <span class="hljs-keyword">return</span> webClient
                .<span class="hljs-keyword">get</span>()
                .uri(<span class="hljs-string">"/data/{id}"</span>, id)
                .retrieve()
                .bodyToMono(Data.<span class="hljs-keyword">class</span>)
                .flatMap(<span class="hljs-keyword">data</span> -&gt; webClient
                        .post()
                        .uri(<span class="hljs-string">"/process"</span>)
                        .bodyValue(<span class="hljs-keyword">data</span>)
                        .retrieve()
                        .bodyToMono(Result.<span class="hljs-keyword">class</span>));
    }
}

AIå†™ä»£ç java
è¿è¡Œ
<span class="hljs-number">12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849</span>
</code></pre>
<h5 data-id="heading-9"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>WebClientçš„ä¼˜åŠ¿</h5>
<ol>
<li><strong>å¼‚æ­¥éé˜»å¡</strong>ï¼šæ”¯æŒå“åº”å¼ç¼–ç¨‹æ¨¡å¼</li>
<li><strong>èƒŒå‹æ”¯æŒ</strong>ï¼šå†…ç½®èƒŒå‹å¤„ç†æœºåˆ¶</li>
<li><strong>æµå¼å¤„ç†</strong>ï¼šæ”¯æŒæœåŠ¡å™¨ç«¯æ¨é€å’Œæµå¼æ•°æ®</li>
<li><strong>å‡½æ•°å¼API</strong>ï¼šæä¾›é“¾å¼è°ƒç”¨çš„å‡½æ•°å¼API</li>
<li><strong>æ›´å¥½çš„é”™è¯¯å¤„ç†</strong>ï¼šæ”¯æŒé”™è¯¯æ¢å¤å’Œé‡è¯•æœºåˆ¶</li>
</ol>
<h4 data-id="heading-10"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>æ–¹æ¡ˆäºŒï¼šRestClientï¼ˆæ¨èç”¨äºåŒæ­¥åœºæ™¯ï¼‰</h4>
<p>Spring 6.1å¼•å…¥çš„RestClientæä¾›äº†ç°ä»£åŒ–çš„åŒæ­¥HTTPå®¢æˆ·ç«¯APIã€‚</p>
<h5 data-id="heading-11"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>ä¾èµ–é…ç½®</h5>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-comment">&lt;!-- Mavené…ç½® --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>

AIå†™ä»£ç xml
12345
</code></pre>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-comment">// Gradleé…ç½®</span>
implementation <span class="hljs-string">'org.springframework.boot:spring-boot-starter-web'</span>

AIå†™ä»£ç gradle
<span class="hljs-number">12</span>
</code></pre>
<h5 data-id="heading-12"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>åŸºæœ¬ä½¿ç”¨ç¤ºä¾‹</h5>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-keyword">import</span> org.springframework.web.client.RestClient;
<span class="hljs-keyword">import</span> org.springframework.core.ParameterizedTypeReference;

@Service
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SyncHttpClientService</span> {
    
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> RestClient restClient;
    
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">SyncHttpClientService</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">this</span>.restClient = RestClient.<span class="hljs-built_in">builder</span>()
                .<span class="hljs-built_in">baseUrl</span>(<span class="hljs-string">"https://api.example.com"</span>)
                .<span class="hljs-built_in">defaultHeader</span>(<span class="hljs-string">"Content-Type"</span>, <span class="hljs-string">"application/json"</span>)
                .<span class="hljs-built_in">build</span>();
    }
    
    <span class="hljs-comment">// GETè¯·æ±‚</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> User <span class="hljs-title">getUser</span><span class="hljs-params">(<span class="hljs-type">String</span> id)</span> </span>{
        <span class="hljs-keyword">return</span> restClient
                .<span class="hljs-built_in">get</span>()
                .<span class="hljs-built_in">uri</span>(<span class="hljs-string">"/users/{id}"</span>, id)
                .<span class="hljs-built_in">retrieve</span>()
                .<span class="hljs-built_in">body</span>(User.<span class="hljs-keyword">class</span>);
    }
    
    <span class="hljs-comment">// POSTè¯·æ±‚</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> User <span class="hljs-title">createUser</span><span class="hljs-params">(User user)</span> </span>{
        <span class="hljs-keyword">return</span> restClient
                .<span class="hljs-built_in">post</span>()
                .<span class="hljs-built_in">uri</span>(<span class="hljs-string">"/users"</span>)
                .<span class="hljs-built_in">body</span>(user)
                .<span class="hljs-built_in">retrieve</span>()
                .<span class="hljs-built_in">body</span>(User.<span class="hljs-keyword">class</span>);
    }
    
    <span class="hljs-comment">// å¤æ‚æŸ¥è¯¢å‚æ•°</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> List&lt;User&gt; <span class="hljs-title">searchUsers</span><span class="hljs-params">(<span class="hljs-type">String</span> name, <span class="hljs-type">int</span> page, <span class="hljs-type">int</span> size)</span> </span>{
        <span class="hljs-keyword">return</span> restClient
                .<span class="hljs-built_in">get</span>()
                .<span class="hljs-built_in">uri</span>(uriBuilder -&gt; uriBuilder
                        .<span class="hljs-built_in">path</span>(<span class="hljs-string">"/users/search"</span>)
                        .<span class="hljs-built_in">queryParam</span>(<span class="hljs-string">"name"</span>, name)
                        .<span class="hljs-built_in">queryParam</span>(<span class="hljs-string">"page"</span>, page)
                        .<span class="hljs-built_in">queryParam</span>(<span class="hljs-string">"size"</span>, size)
                        .<span class="hljs-built_in">build</span>())
                .<span class="hljs-built_in">retrieve</span>()
                .<span class="hljs-built_in">body</span>(<span class="hljs-keyword">new</span> ParameterizedTypeReference&lt;List&lt;User&gt;&gt;() {});
    }
    
    <span class="hljs-comment">// é”™è¯¯å¤„ç†</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> User <span class="hljs-title">getUserWithErrorHandling</span><span class="hljs-params">(<span class="hljs-type">String</span> id)</span> </span>{
        <span class="hljs-keyword">try</span> {
            <span class="hljs-keyword">return</span> restClient
                    .<span class="hljs-built_in">get</span>()
                    .<span class="hljs-built_in">uri</span>(<span class="hljs-string">"/users/{id}"</span>, id)
                    .<span class="hljs-built_in">retrieve</span>()
                    .<span class="hljs-built_in">body</span>(User.<span class="hljs-keyword">class</span>);
        } <span class="hljs-built_in">catch</span> (RestClientException e) {
            <span class="hljs-comment">// å¤„ç†é”™è¯¯</span>
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">UserServiceException</span>(<span class="hljs-string">"Failed to fetch user"</span>, e);
        }
    }
}

AIå†™ä»£ç java
è¿è¡Œ
<span class="hljs-number">1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162</span>
</code></pre>
<h3 data-id="heading-13"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>è¿ç§»ç­–ç•¥</h3>
<h4 data-id="heading-14"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>é˜¶æ®µä¸€ï¼šè¯„ä¼°ç°æœ‰ä»£ç </h4>
<ol>
<li><strong>è¯†åˆ«RestTemplateä½¿ç”¨ç‚¹</strong></li>
</ol>
<pre><code class="hljs language-perl" lang="perl"><span class="hljs-comment"># æœç´¢é¡¹ç›®ä¸­æ‰€æœ‰RestTemplateçš„ä½¿ç”¨</span>
<span class="hljs-keyword">grep</span> -r <span class="hljs-string">"RestTemplate"</span> src/

AIå†™ä»£ç bash
<span class="hljs-number">12</span>
</code></pre>
<ol start="2">
<li>
<p><strong>åˆ†ç±»ä½¿ç”¨åœºæ™¯</strong></p>
<ul>
<li>åŒæ­¥è°ƒç”¨ â†’ RestClient</li>
<li>å¼‚æ­¥è°ƒç”¨ â†’ WebClient</li>
<li>æ‰¹å¤„ç† â†’ RestClient</li>
<li>æµå¼å¤„ç† â†’ WebClient</li>
</ul>
</li>
</ol>
<h4 data-id="heading-15"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>é˜¶æ®µäºŒï¼šæ¸è¿›å¼è¿ç§»</h4>
<h5 data-id="heading-16"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>æ­¥éª¤1ï¼šæ·»åŠ æ–°ä¾èµ–</h5>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-comment">&lt;!-- æ ¹æ®éœ€è¦æ·»åŠ  --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-webflux<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>

AIå†™ä»£ç xml
12345
</code></pre>
<h5 data-id="heading-17"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>æ­¥éª¤2ï¼šåˆ›å»ºé€‚é…å™¨</h5>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-meta">@Configuration</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HttpClientConfig</span> {
    
    <span class="hljs-meta">@Bean</span>
    <span class="hljs-meta">@Primary</span>
    <span class="hljs-keyword">public</span> <span class="hljs-title class_">RestClient</span> <span class="hljs-title function_">restClient</span>(<span class="hljs-params"/>) {
        <span class="hljs-keyword">return</span> <span class="hljs-title class_">RestClient</span>.<span class="hljs-title function_">builder</span>()
                .<span class="hljs-title function_">baseUrl</span>(<span class="hljs-string">"https://api.example.com"</span>)
                .<span class="hljs-title function_">build</span>();
    }
    
    <span class="hljs-meta">@Bean</span>
    <span class="hljs-keyword">public</span> <span class="hljs-title class_">WebClient</span> <span class="hljs-title function_">webClient</span>(<span class="hljs-params"/>) {
        <span class="hljs-keyword">return</span> <span class="hljs-title class_">WebClient</span>.<span class="hljs-title function_">builder</span>()
                .<span class="hljs-title function_">baseUrl</span>(<span class="hljs-string">"https://api.example.com"</span>)
                .<span class="hljs-title function_">build</span>();
    }
}

<span class="hljs-variable constant_">AI</span>å†™ä»£ç java
è¿è¡Œ
<span class="hljs-number">123456789101112131415161718</span>
</code></pre>
<h5 data-id="heading-18"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>æ­¥éª¤3ï¼šé€ä¸ªæ›¿æ¢</h5>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// æ—§ä»£ç </span>
<span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserService</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> RestTemplate restTemplate = new RestTemplate();
    
    <span class="hljs-keyword">public</span> User getUser(String id) {
        <span class="hljs-keyword">return</span> restTemplate.getForObject(<span class="hljs-string">"/users/{id}"</span>, User.<span class="hljs-keyword">class</span>, id);
    }
}

<span class="hljs-comment">// æ–°ä»£ç </span>
<span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserService</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> RestClient restClient;
    
    <span class="hljs-keyword">public</span> UserService(RestClient restClient) {
        <span class="hljs-keyword">this</span>.restClient = restClient;
    }
    
    <span class="hljs-keyword">public</span> User getUser(String id) {
        <span class="hljs-keyword">return</span> restClient
                .<span class="hljs-keyword">get</span>()
                .uri(<span class="hljs-string">"/users/{id}"</span>, id)
                .retrieve()
                .body(User.<span class="hljs-keyword">class</span>);
    }
}

AIå†™ä»£ç java
è¿è¡Œ
<span class="hljs-number">123456789101112131415161718192021222324252627</span>
</code></pre>
<h3 data-id="heading-19"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>é«˜çº§ç‰¹æ€§å¯¹æ¯”</h3>





















































<table><thead><tr><th>ç‰¹æ€§</th><th>RestTemplate</th><th>RestClient</th><th>WebClient</th></tr></thead><tbody><tr><td>åŒæ­¥è°ƒç”¨</td><td>âœ…</td><td>âœ…</td><td>âŒ</td></tr><tr><td>å¼‚æ­¥è°ƒç”¨</td><td>âŒ</td><td>âŒ</td><td>âœ…</td></tr><tr><td>å“åº”å¼æ”¯æŒ</td><td>âŒ</td><td>âŒ</td><td>âœ…</td></tr><tr><td>è¿æ¥æ± </td><td>âœ…</td><td>âœ…</td><td>âœ…</td></tr><tr><td>æ‹¦æˆªå™¨æ”¯æŒ</td><td>âœ…</td><td>âœ…</td><td>âœ…</td></tr><tr><td>é”™è¯¯å¤„ç†</td><td>åŸºç¡€</td><td>æ”¹è¿›</td><td>é«˜çº§</td></tr><tr><td>æ€§èƒ½</td><td>åŸºç¡€</td><td>è‰¯å¥½</td><td>ä¼˜ç§€</td></tr></tbody></table>
<h3 data-id="heading-20"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>æœ€ä½³å®è·µ</h3>
<h4 data-id="heading-21"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>1. é€‰æ‹©åˆé€‚çš„å®¢æˆ·ç«¯</h4>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// åŒæ­¥åœºæ™¯ä½¿ç”¨RestClient</span>
<span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SyncService</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> RestClient restClient;
    
    <span class="hljs-keyword">public</span> SyncService(RestClient restClient) {
        <span class="hljs-keyword">this</span>.restClient = restClient;
    }
}

<span class="hljs-comment">// å¼‚æ­¥åœºæ™¯ä½¿ç”¨WebClient</span>
<span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AsyncService</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> WebClient webClient;
    
    <span class="hljs-keyword">public</span> AsyncService(WebClient webClient) {
        <span class="hljs-keyword">this</span>.webClient = webClient;
    }
}

AIå†™ä»£ç java
è¿è¡Œ
<span class="hljs-number">12345678910111213141516171819</span>
</code></pre>
<h4 data-id="heading-22"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>2. é…ç½®ä¼˜åŒ–</h4>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-keyword">@Configuration</span>
public class HttpClientConfig {
    
    <span class="hljs-keyword">@Bean</span>
    public RestClient optimizedRestClient() {
        return RestClient<span class="hljs-selector-class">.builder</span>()
                <span class="hljs-selector-class">.requestFactory</span>(HttpComponentsClientHttpRequestFactory.class)
                <span class="hljs-selector-class">.baseUrl</span>("https://api.example.com")
                <span class="hljs-selector-class">.defaultHeader</span>("User-Agent", "MyApp/<span class="hljs-number">1.0</span>")
                <span class="hljs-selector-class">.defaultHeader</span>("Accept", "application/json")
                <span class="hljs-selector-class">.build</span>();
    }
    
    <span class="hljs-keyword">@Bean</span>
    public WebClient optimizedWebClient() {
        HttpClient httpClient = HttpClient<span class="hljs-selector-class">.create</span>()
                <span class="hljs-selector-class">.responseTimeout</span>(Duration.ofSeconds(<span class="hljs-number">10</span>))
                <span class="hljs-selector-class">.option</span>(ChannelOption.CONNECT_TIMEOUT_MILLIS, <span class="hljs-number">5000</span>);
        
        return WebClient<span class="hljs-selector-class">.builder</span>()
                <span class="hljs-selector-class">.clientConnector</span>(new ReactorClientHttpConnector(httpClient))
                <span class="hljs-selector-class">.baseUrl</span>("https://api.example.com")
                <span class="hljs-selector-class">.filter</span>(logRequest())
                <span class="hljs-selector-class">.filter</span>(logResponse())
                <span class="hljs-selector-class">.build</span>();
    }
}

AIå†™ä»£ç java
è¿è¡Œ
<span class="hljs-number">123456789101112131415161718192021222324252627</span>
</code></pre>
<h4 data-id="heading-23"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>3. é”™è¯¯å¤„ç†</h4>
<pre><code class="hljs language-vbscript" lang="vbscript">// RestClienté”™è¯¯å¤„ç†
<span class="hljs-keyword">public</span> User getUserSafely(String id) {
    return restClient
            .<span class="hljs-keyword">get</span>()
            .uri(<span class="hljs-string">"/users/{id}"</span>, id)
            .retrieve()
            .onStatus(HttpStatus::is5xxServerError, 
                     <span class="hljs-built_in">response</span> -&gt; Mono.<span class="hljs-keyword">error</span>(<span class="hljs-keyword">new</span> ServerException(<span class="hljs-string">"Server error"</span>)))
            .onStatus(HttpStatus::is4xxClientError,
                     <span class="hljs-built_in">response</span> -&gt; <span class="hljs-built_in">response</span>.bodyToMono(ErrorResponse.<span class="hljs-keyword">class</span>)
                         .flatMap(<span class="hljs-keyword">error</span> -&gt; Mono.<span class="hljs-keyword">error</span>(<span class="hljs-keyword">new</span> ClientException(<span class="hljs-keyword">error</span>))))
            .body(User.<span class="hljs-keyword">class</span>);
}

// WebClienté”™è¯¯å¤„ç†
<span class="hljs-keyword">public</span> Mono&lt;User&gt; getUserReactive(String id) {
    return webClient
            .<span class="hljs-keyword">get</span>()
            .uri(<span class="hljs-string">"/users/{id}"</span>, id)
            .retrieve()
            .onStatus(HttpStatus::is5xxServerError,
                     <span class="hljs-built_in">response</span> -&gt; <span class="hljs-built_in">response</span>.bodyToMono(ErrorResponse.<span class="hljs-keyword">class</span>)
                         .flatMap(<span class="hljs-keyword">error</span> -&gt; Mono.<span class="hljs-keyword">error</span>(<span class="hljs-keyword">new</span> ServerException(<span class="hljs-keyword">error</span>))))
            .onStatus(HttpStatus::is4xxClientError,
                     <span class="hljs-built_in">response</span> -&gt; <span class="hljs-built_in">response</span>.bodyToMono(ErrorResponse.<span class="hljs-keyword">class</span>)
                         .flatMap(<span class="hljs-keyword">error</span> -&gt; Mono.<span class="hljs-keyword">error</span>(<span class="hljs-keyword">new</span> ClientException(<span class="hljs-keyword">error</span>))))
            .bodyToMono(User.<span class="hljs-keyword">class</span>)
            .retryWhen(retrySpec())
            .onErrorResume(Exception.<span class="hljs-keyword">class</span>, 
                          <span class="hljs-keyword">error</span> -&gt; Mono.just(getDefaultUser()));
}

AIå†™ä»£ç java
è¿è¡Œ
<span class="hljs-number">12345678910111213141516171819202122232425262728293031</span>
</code></pre>
<h3 data-id="heading-24"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>æµ‹è¯•ç­–ç•¥</h3>
<h4 data-id="heading-25"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>å•å…ƒæµ‹è¯•</h4>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-keyword">@ExtendWith</span>(MockitoExtension.class)
class UserServiceTest {
    
    <span class="hljs-keyword">@Mock</span>
    private RestClient restClient;
    
    <span class="hljs-keyword">@InjectMocks</span>
    private UserService userService;
    
    <span class="hljs-keyword">@Test</span>
    void shouldGetUserById() {
        <span class="hljs-comment">// Given</span>
        String userId = "<span class="hljs-number">123</span>";
        User expectedUser = new <span class="hljs-built_in">User</span>(userId, "John Doe");
        
        RestClient<span class="hljs-selector-class">.RequestHeadersUriSpec</span> requestSpec = Mockito<span class="hljs-selector-class">.mock</span>(RestClient.RequestHeadersUriSpec.class);
        RestClient<span class="hljs-selector-class">.ResponseSpec</span> responseSpec = Mockito<span class="hljs-selector-class">.mock</span>(RestClient.ResponseSpec.class);
        
        <span class="hljs-built_in">when</span>(restClient.get())<span class="hljs-selector-class">.thenReturn</span>(requestSpec);
        <span class="hljs-built_in">when</span>(requestSpec.uri("/users/{id}", userId))<span class="hljs-selector-class">.thenReturn</span>(requestSpec);
        <span class="hljs-built_in">when</span>(requestSpec.retrieve())<span class="hljs-selector-class">.thenReturn</span>(responseSpec);
        <span class="hljs-built_in">when</span>(responseSpec.body(User.class))<span class="hljs-selector-class">.thenReturn</span>(expectedUser);
        
        <span class="hljs-comment">// When</span>
        User actualUser = userService<span class="hljs-selector-class">.getUser</span>(userId);
        
        <span class="hljs-comment">// Then</span>
        <span class="hljs-built_in">assertEquals</span>(expectedUser, actualUser);
    }
}

AIå†™ä»£ç java
è¿è¡Œ
<span class="hljs-number">123456789101112131415161718192021222324252627282930</span>
</code></pre>
<h4 data-id="heading-26"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>é›†æˆæµ‹è¯•</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@SpringBootTest(webEnvironment = SpringBootTest.WebEnvironment.RANDOM_PORT)</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">HttpClientIntegrationTest</span> {
    
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> TestRestTemplate testRestTemplate;
    
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> UserService userService;
    
    <span class="hljs-meta">@Test</span>
    <span class="hljs-keyword">void</span> <span class="hljs-title function_">shouldCommunicateWithExternalService</span><span class="hljs-params">()</span> {
        <span class="hljs-comment">// ä½¿ç”¨çœŸå®çš„HTTPè°ƒç”¨æµ‹è¯•</span>
        <span class="hljs-type">User</span> <span class="hljs-variable">user</span> <span class="hljs-operator">=</span> userService.getUser(<span class="hljs-string">"123"</span>);
        assertNotNull(user);
    }
}

AIå†™ä»£ç java
è¿è¡Œ
<span class="hljs-number">12345678910111213141516</span>
</code></pre>
<h3 data-id="heading-27"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>æ€§èƒ½è€ƒè™‘</h3>
<h4 data-id="heading-28"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>1. è¿æ¥æ± é…ç½®</h4>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-keyword">@Configuration</span>
public class ConnectionPoolConfig {
    
    <span class="hljs-keyword">@Bean</span>
    public RestClient customRestClient() {
        SimpleClientHttpRequestFactory factory = new <span class="hljs-built_in">SimpleClientHttpRequestFactory</span>();
        factory<span class="hljs-selector-class">.setConnectTimeout</span>(<span class="hljs-number">5000</span>);
        factory<span class="hljs-selector-class">.setReadTimeout</span>(<span class="hljs-number">30000</span>);
        
        return RestClient<span class="hljs-selector-class">.builder</span>()
                <span class="hljs-selector-class">.requestFactory</span>(factory)
                <span class="hljs-selector-class">.baseUrl</span>("https://api.example.com")
                <span class="hljs-selector-class">.build</span>();
    }
}

AIå†™ä»£ç java
è¿è¡Œ
<span class="hljs-number">123456789101112131415</span>
</code></pre>
<h4 data-id="heading-29"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>2. WebClientè¿æ¥æ± </h4>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-keyword">@Bean</span>
public WebClient webClientWithPool() {
    HttpClient httpClient = HttpClient<span class="hljs-selector-class">.create</span>()
            <span class="hljs-selector-class">.option</span>(ChannelOption.CONNECT_TIMEOUT_MILLIS, <span class="hljs-number">5000</span>)
            <span class="hljs-selector-class">.responseTimeout</span>(Duration.ofSeconds(<span class="hljs-number">30</span>))
            <span class="hljs-selector-class">.doOnConnected</span>(conn -&gt; 
                conn.addHandlerLast(new ReadTimeoutHandler(<span class="hljs-number">30</span>))
                    <span class="hljs-selector-class">.addHandlerLast</span>(new WriteTimeoutHandler(<span class="hljs-number">30</span>)));
    
    ConnectionProvider provider = ConnectionProvider<span class="hljs-selector-class">.builder</span>("custom")
            <span class="hljs-selector-class">.maxConnections</span>(<span class="hljs-number">50</span>)
            <span class="hljs-selector-class">.maxIdleTime</span>(Duration.ofSeconds(<span class="hljs-number">20</span>))
            <span class="hljs-selector-class">.build</span>();
    
    return WebClient<span class="hljs-selector-class">.builder</span>()
            <span class="hljs-selector-class">.clientConnector</span>(new ReactorClientHttpConnector(provider, httpClient))
            <span class="hljs-selector-class">.build</span>();
}

AIå†™ä»£ç java
è¿è¡Œ
<span class="hljs-number">123456789101112131415161718</span>
</code></pre>
<h3 data-id="heading-30"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>å¸¸è§é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ</h3>
<h4 data-id="heading-31"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>Q1: å¦‚ä½•å¤„ç†å¤§é‡å¹¶å‘è¯·æ±‚ï¼Ÿ</h4>
<p><strong>A</strong>: å¯¹äºé«˜å¹¶å‘åœºæ™¯ï¼Œæ¨èä½¿ç”¨WebClientï¼Œå› ä¸ºå®ƒæ”¯æŒå“åº”å¼ç¼–ç¨‹å’Œéé˜»å¡I/Oã€‚</p>
<h4 data-id="heading-32"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>Q2: è¿ç§»æˆæœ¬å¤ªå¤§ï¼Œèƒ½å¦æ¸è¿›å¼è¿ç§»ï¼Ÿ</h4>
<p><strong>A</strong>: å¯ä»¥é€šè¿‡é€‚é…å™¨æ¨¡å¼é€æ­¥è¿ç§»ï¼Œå…ˆåœ¨ä¸€ä¸ªæ¨¡å—ä¸­è¯•ç‚¹ï¼Œå†æ¨å¹¿åˆ°æ•´ä¸ªåº”ç”¨ã€‚</p>
<h4 data-id="heading-33"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>Q3: å¦‚ä½•ä¿æŒå‘åå…¼å®¹æ€§ï¼Ÿ</h4>
<p><strong>A</strong>: å¯ä»¥åˆ›å»ºåŒ…è£…ç±»ï¼Œéšè—å…·ä½“çš„HTTPå®¢æˆ·ç«¯å®ç°ï¼Œä¾¿äºåç»­æ›´æ¢ã€‚</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-meta">@Component</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HttpClientFacade</span> {
    
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> RestClient restClient;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> WebClient webClient;
    
    <span class="hljs-keyword">public</span> HttpClientFacade(RestClient restClient, WebClient webClient) {
        <span class="hljs-keyword">this</span>.restClient = restClient;
        <span class="hljs-keyword">this</span>.webClient = webClient;
    }
    
    <span class="hljs-comment">// ç»Ÿä¸€çš„åŒæ­¥æ¥å£</span>
    <span class="hljs-keyword">public</span> &lt;T&gt; T callSync(String url, Class&lt;T&gt; responseType) {
        <span class="hljs-keyword">return</span> restClient.<span class="hljs-keyword">get</span>().uri(url).retrieve().body(responseType);
    }
    
    <span class="hljs-comment">// ç»Ÿä¸€çš„å¼‚æ­¥æ¥å£</span>
    <span class="hljs-keyword">public</span> &lt;T&gt; Mono&lt;T&gt; callAsync(String url, Class&lt;T&gt; responseType) {
        <span class="hljs-keyword">return</span> webClient.<span class="hljs-keyword">get</span>().uri(url).retrieve().bodyToMono(responseType);
    }
}

AIå†™ä»£ç java
è¿è¡Œ
<span class="hljs-number">123456789101112131415161718192021</span>
</code></pre>
<h3 data-id="heading-34"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>æ€»ç»“</h3>
<p>Spring Boot 4.0æ ‡å¿—ç€HTTPå®¢æˆ·ç«¯æŠ€æœ¯çš„é‡å¤§è¿›æ­¥ã€‚è™½ç„¶RestTemplateçš„å‘Šåˆ«å¯èƒ½å¸¦æ¥çŸ­æœŸçš„è¿ç§»æˆæœ¬ï¼Œä½†ä»é•¿è¿œæ¥çœ‹ï¼š</p>
<ol>
<li><strong>æ€§èƒ½æå‡</strong>ï¼šæ–°çš„HTTPå®¢æˆ·ç«¯æä¾›æ›´å¥½çš„æ€§èƒ½å’Œèµ„æºåˆ©ç”¨ç‡</li>
<li><strong>å¼€å‘æ•ˆç‡</strong>ï¼šå‡½æ•°å¼APIå’Œé“¾å¼è°ƒç”¨ä½¿ä»£ç æ›´ç®€æ´</li>
<li><strong>æœªæ¥å…¼å®¹</strong>ï¼šæ‹¥æŠ±å“åº”å¼ç¼–ç¨‹å’Œç°ä»£Javaç”Ÿæ€</li>
</ol>
<p>å»ºè®®å¼€å‘å›¢é˜Ÿï¼š</p>
<ul>
<li>è¯„ä¼°ç°æœ‰RestTemplateä½¿ç”¨æƒ…å†µ</li>
<li>åˆ¶å®šæ¸è¿›å¼è¿ç§»è®¡åˆ’</li>
<li>åŸ¹è®­å›¢é˜ŸæŒæ¡æ–°çš„HTTPå®¢æˆ·ç«¯API</li>
<li>åœ¨æ–°é¡¹ç›®ä¸­ç›´æ¥ä½¿ç”¨æ¨èçš„æ›¿ä»£æ–¹æ¡ˆ</li>
</ul>
<p>éšç€Springç”Ÿæ€ç³»ç»Ÿçš„ä¸æ–­å‘å±•ï¼ŒæŒæ¡è¿™äº›ç°ä»£åŒ–çš„HTTPå®¢æˆ·ç«¯æŠ€æœ¯å°†æˆä¸ºJavaå¼€å‘è€…çš„å¿…å¤‡æŠ€èƒ½ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[åŒåº“ååŒï¼Œå„å–æ‰€é•¿ï¼š.NET Core ä¸­ PostgreSQL ä¸ SQLite çš„ä¼˜é›…èåˆå®æˆ˜]]></title>    <link>https://juejin.cn/post/7603771025856479283</link>    <guid>https://juejin.cn/post/7603771025856479283</guid>    <pubDate>2026-02-08T06:12:53.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7603771025856479283" data-draft-id="7603651855236792329" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="åŒåº“ååŒï¼Œå„å–æ‰€é•¿ï¼š.NET Core ä¸­ PostgreSQL ä¸ SQLite çš„ä¼˜é›…èåˆå®æˆ˜"/> <meta itemprop="keywords" content="åç«¯"/> <meta itemprop="datePublished" content="2026-02-08T06:12:53.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å¤§é»„è¯„æµ‹"/> <meta itemprop="url" content="https://juejin.cn/user/714024404135696"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            åŒåº“ååŒï¼Œå„å–æ‰€é•¿ï¼š.NET Core ä¸­ PostgreSQL ä¸ SQLite çš„ä¼˜é›…èåˆå®æˆ˜
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/714024404135696/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å¤§é»„è¯„æµ‹
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-08T06:12:53.000Z" title="Sun Feb 08 2026 06:12:53 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»3åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>åœ¨ç°ä»£åº”ç”¨å¼€å‘ä¸­ï¼Œå•ä¸€æ•°æ®åº“æ¶æ„å¾€å¾€éš¾ä»¥æ»¡è¶³æ‰€æœ‰åœºæ™¯éœ€æ±‚ã€‚ä¾‹å¦‚ï¼Œä½ å¯èƒ½å¸Œæœ›ï¼š</p>
<ul>
<li><strong>ä¸»ä¸šåŠ¡æ•°æ®</strong>å­˜å…¥åŠŸèƒ½å¼ºå¤§ã€æ”¯æŒé«˜å¹¶å‘çš„ <strong>PostgreSQL</strong>ï¼›</li>
<li><strong>æœ¬åœ°ç¼“å­˜ã€è¾¹ç¼˜è®¡ç®—æˆ–åµŒå…¥å¼æ—¥å¿—</strong>ä½¿ç”¨è½»é‡ã€é›¶é…ç½®çš„ <strong>SQLite</strong>ã€‚</li>
</ul>
<p>è¿™ç§â€œæ··åˆæŒä¹…åŒ–â€ï¼ˆPolyglot Persistenceï¼‰ç­–ç•¥æ­£å˜å¾—è¶Šæ¥è¶Šæ™®éã€‚è€Œ .NET Core å‡­å€Ÿå…¶å¼ºå¤§çš„ä¾èµ–æ³¨å…¥ï¼ˆDIï¼‰ä½“ç³»å’Œ Entity Framework Coreï¼ˆEF Coreï¼‰çš„å¤šä¸Šä¸‹æ–‡æ”¯æŒï¼Œä¸ºåŒæ•°æ®åº“æ¶æ„æä¾›äº†ä¼˜é›…çš„å®ç°è·¯å¾„ã€‚</p>
<p>æœ¬æ–‡å°†æ‰‹æŠŠæ‰‹å¸¦ä½ æ„å»ºä¸€ä¸ªåŒæ—¶ä½¿ç”¨ <strong>PostgreSQLï¼ˆä¸»åº“ï¼‰</strong> å’Œ <strong>SQLiteï¼ˆè¾…åŠ©åº“ï¼‰</strong> çš„ .NET Core åº”ç”¨ï¼Œå¹¶åˆ†äº«ç”Ÿäº§çº§çš„æœ€ä½³å®è·µã€‚</p>
<hr/>
<h3 data-id="heading-0">ä¸€ã€ä¸ºä»€ä¹ˆé€‰æ‹© PostgreSQL + SQLiteï¼Ÿ</h3>






























<table><thead><tr><th>åœºæ™¯</th><th>PostgreSQL</th><th>SQLite</th></tr></thead><tbody><tr><td><strong>æ•°æ®è§„æ¨¡</strong></td><td>TB çº§ï¼Œå¤šç”¨æˆ·å¹¶å‘</td><td>GB çº§ï¼Œå•æœº/è¾¹ç¼˜</td></tr><tr><td><strong>éƒ¨ç½²å¤æ‚åº¦</strong></td><td>éœ€ç‹¬ç«‹æœåŠ¡</td><td>é›¶é…ç½®ï¼Œæ–‡ä»¶å³æ•°æ®åº“</td></tr><tr><td><strong>äº‹åŠ¡ä¸ä¸€è‡´æ€§</strong></td><td>å®Œæ•´ ACIDï¼Œæ”¯æŒåˆ†å¸ƒå¼äº‹åŠ¡</td><td>å•æ–‡ä»¶ ACIDï¼Œä¸æ”¯æŒå¹¶å‘å†™</td></tr><tr><td><strong>å…¸å‹ç”¨é€”</strong></td><td>ç”¨æˆ·è´¦æˆ·ã€è®¢å•ã€æ ¸å¿ƒä¸šåŠ¡</td><td>æœ¬åœ°ç¼“å­˜ã€è®¾å¤‡æ—¥å¿—ã€ä¸´æ—¶ä»»åŠ¡é˜Ÿåˆ—</td></tr></tbody></table>
<blockquote>
<p>âœ… ç»„åˆä¼˜åŠ¿ï¼š<br/>
ä¸»ä¸šåŠ¡å¼ºä¸€è‡´ + è¾¹ç¼˜æ•°æ®è½»é‡åŒ– = æ¶æ„å¼¹æ€§ä¸æ€§èƒ½å…¼é¡¾</p>
</blockquote>
<hr/>
<h3 data-id="heading-1">äºŒã€é¡¹ç›®ç»“æ„è®¾è®¡</h3>
<p>æˆ‘ä»¬å°†åˆ›å»ºä¸¤ä¸ªç‹¬ç«‹çš„ <code>DbContext</code>ï¼Œåˆ†åˆ«å¯¹åº”ä¸åŒæ•°æ®åº“ï¼š</p>
<pre><code class="hljs language-arduino" lang="arduino">MyApp/
â”œâ”€â”€ Data/
â”‚   â”œâ”€â”€ MainDbContext.cs        <span class="hljs-comment">// PostgreSQL</span>
â”‚   â””â”€â”€ LocalDbContext.cs       <span class="hljs-comment">// SQLite</span>
â”œâ”€â”€ Models/
â”‚   â”œâ”€â”€ User.cs                 <span class="hljs-comment">// å­˜äº PostgreSQL</span>
â”‚   â””â”€â”€ DeviceLog.cs            <span class="hljs-comment">// å­˜äº SQLite</span>
â”œâ”€â”€ Services/
â”‚   â”œâ”€â”€ UserService.cs
â”‚   â””â”€â”€ LogService.cs
â””â”€â”€ Program.cs
</code></pre>
<hr/>
<h3 data-id="heading-2">ä¸‰ã€Step-by-Step å®ç°</h3>
<h4 data-id="heading-3">1. å®‰è£…å¿…è¦ NuGet åŒ…</h4>
<pre><code class="hljs language-csharp" lang="csharp">dotnet <span class="hljs-keyword">add</span> package Npgsql.EntityFrameworkCore.PostgreSQL
dotnet <span class="hljs-keyword">add</span> package Microsoft.EntityFrameworkCore.Sqlite
</code></pre>
<blockquote>
<p>æ³¨æ„ï¼šä¸è¦æ··ç”¨åŒä¸€ä¸ª DbContext æ³¨å†Œå¤šä¸ªæä¾›ç¨‹åºï¼</p>
</blockquote>
<h4 data-id="heading-4">2. å®šä¹‰æ¨¡å‹ï¼ˆModelsï¼‰</h4>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-comment">// Models/User.cs</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">User</span>
{
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">int</span> Id { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">string</span> Name { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; } = <span class="hljs-literal">default</span>!;
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">string</span> Email { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; } = <span class="hljs-literal">default</span>!;
}

<span class="hljs-comment">// Models/DeviceLog.cs</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">DeviceLog</span>
{
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">long</span> Id { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
    <span class="hljs-keyword">public</span> DateTime Timestamp { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">string</span> Message { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; } = <span class="hljs-literal">default</span>!;
}
</code></pre>
<h4 data-id="heading-5">3. åˆ›å»ºä¸¤ä¸ª DbContext</h4>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-comment">// Data/MainDbContext.cs</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MainDbContext</span> : DbContext
{
    <span class="hljs-keyword">public</span> DbSet&lt;User&gt; Users { get; set; }

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">MainDbContext</span><span class="hljs-params">(DbContextOptions&lt;MainDbContext&gt; options)</span> : base(options) {</span> }

    <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">override</span> <span class="hljs-type">void</span> <span class="hljs-title">OnModelCreating</span><span class="hljs-params">(ModelBuilder modelBuilder)</span>
    </span>{
        modelBuilder.<span class="hljs-built_in">Entity</span>&lt;User&gt;().<span class="hljs-built_in">ToTable</span>(<span class="hljs-string">"users"</span>);
    }
}

<span class="hljs-comment">// Data/LocalDbContext.cs</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">LocalDbContext</span> : DbContext
{
    <span class="hljs-keyword">public</span> DbSet&lt;DeviceLog&gt; DeviceLogs { get; set; }

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">LocalDbContext</span><span class="hljs-params">(DbContextOptions&lt;LocalDbContext&gt; options)</span> : base(options) {</span> }

    <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">override</span> <span class="hljs-type">void</span> <span class="hljs-title">OnConfiguring</span><span class="hljs-params">(DbContextOptionsBuilder optionsBuilder)</span>
    </span>{
        <span class="hljs-comment">// å¯é€‰ï¼šè‹¥æœªé€šè¿‡ DI æ³¨å…¥è¿æ¥å­—ç¬¦ä¸²</span>
        <span class="hljs-comment">// optionsBuilder.UseSqlite("Data Source=device_logs.db");</span>
    }

    <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">override</span> <span class="hljs-type">void</span> <span class="hljs-title">OnModelCreating</span><span class="hljs-params">(ModelBuilder modelBuilder)</span>
    </span>{
        modelBuilder.<span class="hljs-built_in">Entity</span>&lt;DeviceLog&gt;().<span class="hljs-built_in">ToTable</span>(<span class="hljs-string">"device_logs"</span>);
    }
}
</code></pre>
<h4 data-id="heading-6">4. åœ¨ Program.cs ä¸­æ³¨å†ŒåŒä¸Šä¸‹æ–‡</h4>
<pre><code class="hljs language-ini" lang="ini">var <span class="hljs-attr">builder</span> = WebApplication.CreateBuilder(args)<span class="hljs-comment">;</span>

// æ³¨å†Œ PostgreSQL ä¸Šä¸‹æ–‡
builder.Services.AddDbContext&lt;MainDbContext&gt;(<span class="hljs-attr">options</span> =&gt;
    options.UseNpgsql(builder.Configuration.GetConnectionString("Postgres")))<span class="hljs-comment">;</span>

// æ³¨å†Œ SQLite ä¸Šä¸‹æ–‡
builder.Services.AddDbContext&lt;LocalDbContext&gt;(<span class="hljs-attr">options</span> =&gt;
    options.UseSqlite(builder.Configuration.GetConnectionString("Sqlite")))<span class="hljs-comment">;</span>

// è‡ªåŠ¨åˆ›å»ºæ•°æ®åº“ï¼ˆä»…å¼€å‘ç¯å¢ƒå»ºè®®ï¼‰
using var <span class="hljs-attr">scope</span> = builder.Services.BuildServiceProvider().CreateScope()<span class="hljs-comment">;</span>
scope.ServiceProvider.GetRequiredService&lt;MainDbContext&gt;().Database.EnsureCreated()<span class="hljs-comment">;</span>
scope.ServiceProvider.GetRequiredService&lt;LocalDbContext&gt;().Database.EnsureCreated()<span class="hljs-comment">;</span>
</code></pre>
<p><code>appsettings.json</code> é…ç½®ï¼š</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"ConnectionStrings"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"Postgres"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Host=localhost;Database=myapp;Username=postgres;Password=secret"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"Sqlite"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Data Source=device_logs.db"</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h4 data-id="heading-7">5. ç¼–å†™æœåŠ¡å±‚ï¼ŒæŒ‰éœ€æ³¨å…¥</h4>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-comment">// Services/UserService.cs</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">UserService</span>
{
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">readonly</span> MainDbContext _db;
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">UserService</span>(<span class="hljs-params">MainDbContext db</span>)</span> =&gt; _db = db;

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">async</span> Task&lt;User&gt; <span class="hljs-title">CreateUser</span>(<span class="hljs-params"><span class="hljs-built_in">string</span> name, <span class="hljs-built_in">string</span> email</span>)</span>
    {
        <span class="hljs-keyword">var</span> user = <span class="hljs-keyword">new</span> User { Name = name, Email = email };
        _db.Users.Add(user);
        <span class="hljs-keyword">await</span> _db.SaveChangesAsync();
        <span class="hljs-keyword">return</span> user;
    }
}

<span class="hljs-comment">// Services/LogService.cs</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">LogService</span>
{
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">readonly</span> LocalDbContext _localDb;
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">LogService</span>(<span class="hljs-params">LocalDbContext localDb</span>)</span> =&gt; _localDb = localDb;

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">async</span> Task <span class="hljs-title">LogMessage</span>(<span class="hljs-params"><span class="hljs-built_in">string</span> msg</span>)</span>
    {
        _localDb.DeviceLogs.Add(<span class="hljs-keyword">new</span> DeviceLog
        {
            Timestamp = DateTime.UtcNow,
            Message = msg
        });
        <span class="hljs-keyword">await</span> _localDb.SaveChangesAsync();
    }
}
</code></pre>
<p>æ§åˆ¶å™¨ä¸­ä½¿ç”¨ï¼š</p>
<pre><code class="hljs language-dart" lang="dart">app.MapPost(<span class="hljs-string">"/user"</span>, <span class="hljs-keyword">async</span> (UserService userService, HttpRequest req) =&gt;
{
    <span class="hljs-keyword">var</span> user = <span class="hljs-keyword">await</span> userService.CreateUser(<span class="hljs-string">"Alice"</span>, <span class="hljs-string">"alice@example.com"</span>);
    <span class="hljs-keyword">return</span> Results.Ok(user);
});

app.MapPost(<span class="hljs-string">"/log"</span>, <span class="hljs-keyword">async</span> (LogService logService, [FromBody] string msg) =&gt;
{
    <span class="hljs-keyword">await</span> logService.LogMessage(msg);
    <span class="hljs-keyword">return</span> Results.Ok();
});
</code></pre>
<hr/>
<h3 data-id="heading-8">å››ã€æœ€ä½³å®è·µä¸é¿å‘æŒ‡å—</h3>
<h4 data-id="heading-9">âœ… 1. <strong>ä¸¥æ ¼åˆ†ç¦»å…³æ³¨ç‚¹</strong></h4>
<ul>
<li>ä¸è¦åœ¨åŒä¸€ä¸ªä¸šåŠ¡æ–¹æ³•ä¸­åŒæ—¶æ“ä½œä¸¤ä¸ª DbContextï¼ˆé™¤éå¿…è¦ï¼‰ï¼›</li>
<li>è‹¥éœ€è·¨åº“äº‹åŠ¡ï¼Œè€ƒè™‘æœ€ç»ˆä¸€è‡´æ€§ï¼ˆå¦‚é€šè¿‡æ¶ˆæ¯é˜Ÿåˆ—è¡¥å¿ï¼‰ã€‚</li>
</ul>
<h4 data-id="heading-10">âœ… 2. <strong>è¿æ¥å­—ç¬¦ä¸²å®‰å…¨</strong></h4>
<ul>
<li>PostgreSQL å¯†ç å‹¿ç¡¬ç¼–ç ï¼Œä½¿ç”¨ Secret Manager æˆ– Azure Key Vaultï¼›</li>
<li>SQLite è·¯å¾„å»ºè®®ä½¿ç”¨ <code>Path.Combine(Directory.GetCurrentDirectory(), "data", "logs.db")</code> ç¡®ä¿å¯ç§»æ¤æ€§ã€‚</li>
</ul>
<h4 data-id="heading-11">âœ… 3. <strong>è¿ç§»ï¼ˆMigrationsï¼‰ç®¡ç†</strong></h4>
<ul>
<li>
<p>ä¸ºæ¯ä¸ª DbContext å•ç‹¬å¯ç”¨è¿ç§»ï¼š</p>
<pre><code class="hljs language-csharp" lang="csharp">dotnet ef migrations <span class="hljs-keyword">add</span> InitialMain -c MainDbContext -o Migrations/Postgres
dotnet ef migrations <span class="hljs-keyword">add</span> InitialLocal -c LocalDbContext -o Migrations/Sqlite
</code></pre>
</li>
<li>
<p>ç”Ÿäº§ç¯å¢ƒå»ºè®®æ‰‹åŠ¨å®¡æ ¸ SQL è„šæœ¬ã€‚</p>
</li>
</ul>
<h4 data-id="heading-12">âœ… 4. <strong>æ€§èƒ½ä¸èµ„æº</strong></h4>
<ul>
<li>SQLite é»˜è®¤ä¸æ”¯æŒé«˜å¹¶å‘å†™å…¥ï¼Œé¿å…åœ¨ Web API çƒ­ç‚¹è·¯å¾„é¢‘ç¹å†™æ—¥å¿—ï¼›</li>
<li>å¯æ­é… <code>Microsoft.Data.Sqlite</code> çš„ WAL æ¨¡å¼æå‡å¹¶å‘è¯»æ€§èƒ½ã€‚</li>
</ul>
<hr/>
<h3 data-id="heading-13">äº”ã€é€‚ç”¨åœºæ™¯æ¨è</h3>
<ul>
<li>ğŸ“± <strong>IoT è¾¹ç¼˜è®¾å¤‡ + äº‘ä¸­å¿ƒ</strong>ï¼šè®¾å¤‡ç”¨ SQLite è®°å½•æœ¬åœ°çŠ¶æ€ï¼Œå®šæœŸåŒæ­¥åˆ°äº‘ç«¯ PostgreSQLï¼›</li>
<li>ğŸ–¥ï¸ <strong>æ¡Œé¢åº”ç”¨</strong>ï¼šé…ç½®ã€ç¼“å­˜ç”¨ SQLiteï¼Œç”¨æˆ·æ•°æ®åŒæ­¥åˆ° PostgreSQLï¼›</li>
<li>ğŸ§ª <strong>æµ‹è¯•éš”ç¦»</strong>ï¼šé›†æˆæµ‹è¯•æ—¶ç”¨ SQLite æ›¿ä»£ PostgreSQLï¼ŒåŠ é€Ÿæ‰§è¡Œã€‚</li>
</ul>
<hr/>
<h3 data-id="heading-14">ç»“è¯­</h3>
<p>åœ¨ .NET Core ä¸­èåˆ PostgreSQL ä¸ SQLiteï¼Œå¹¶éâ€œç‚«æŠ€â€ï¼Œè€Œæ˜¯å¯¹<strong>åœºæ™¯é€‚é…æ€§</strong>çš„ç†æ€§é€‰æ‹©ã€‚é€šè¿‡æ¸…æ™°çš„æ¶æ„åˆ†å±‚ã€ç‹¬ç«‹çš„ DbContext è®¾è®¡å’Œåˆç†çš„æœåŠ¡æ³¨å…¥ï¼Œæˆ‘ä»¬æ—¢èƒ½äº«å— PostgreSQL çš„ä¼ä¸šçº§èƒ½åŠ›ï¼Œåˆèƒ½åˆ©ç”¨ SQLite çš„æè‡´è½»é‡ã€‚</p>
<p>åŒåº“ååŒï¼Œä¸æ˜¯å¦¥åï¼Œè€Œæ˜¯æ™ºæ…§â€”â€”è®©æ¯ä¸€ä»½æ•°æ®ï¼Œéƒ½è½åœ¨æœ€é€‚åˆå®ƒçš„åœŸå£¤ä¸Šã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ã€JAVA è¿›é˜¶ã€‘Spring AOPæ ¸å¿ƒåŸç†ï¼šJDKä¸CGLibåŠ¨æ€ä»£ç†å®æˆ˜è§£æ]]></title>    <link>https://juejin.cn/post/7603674653153755145</link>    <guid>https://juejin.cn/post/7603674653153755145</guid>    <pubDate>2026-02-08T06:25:23.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7603674653153755145" data-draft-id="7603651855236841481" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ã€JAVA è¿›é˜¶ã€‘Spring AOPæ ¸å¿ƒåŸç†ï¼šJDKä¸CGLibåŠ¨æ€ä»£ç†å®æˆ˜è§£æ"/> <meta itemprop="keywords" content="åç«¯,Spring"/> <meta itemprop="datePublished" content="2026-02-08T06:25:23.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Javaæ°´è§£"/> <meta itemprop="url" content="https://juejin.cn/user/2441349519143037"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ã€JAVA è¿›é˜¶ã€‘Spring AOPæ ¸å¿ƒåŸç†ï¼šJDKä¸CGLibåŠ¨æ€ä»£ç†å®æˆ˜è§£æ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2441349519143037/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Javaæ°´è§£
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-08T06:25:23.000Z" title="Sun Feb 08 2026 06:25:23 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»26åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">å‰è¨€</h2>
<p>åœ¨[Springæ¡†æ¶]çš„æ ¸å¿ƒç‰¹æ€§ä¸­ï¼ŒAOPï¼ˆé¢å‘åˆ‡é¢ç¼–ç¨‹ï¼‰æ— ç–‘æ˜¯ä¸IOCï¼ˆæ§åˆ¶åè½¬ï¼‰å¹¶é©¾é½é©±çš„çµé­‚æŠ€æœ¯ã€‚å®ƒé€šè¿‡"æ¨ªåˆ‡"çš„æ–¹å¼ï¼Œå°†æ—¥å¿—è®°å½•ã€äº‹åŠ¡ç®¡ç†ã€æƒé™æ§åˆ¶ç­‰åˆ†æ•£åœ¨ä¸šåŠ¡é€»è¾‘ä¸­çš„é€šç”¨åŠŸèƒ½æŠ½å–å‡ºæ¥ï¼Œå½¢æˆç‹¬ç«‹çš„åˆ‡é¢ï¼Œå®ç°äº†"ä¸šåŠ¡åŠŸèƒ½"ä¸"é€šç”¨åŠŸèƒ½"çš„è§£è€¦ï¼Œæå¤§æå‡äº†ä»£ç çš„å¤ç”¨æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚è€Œæ”¯æ’‘Spring AOPå®ç°çš„æ ¸å¿ƒæŠ€æœ¯ï¼Œæ­£æ˜¯åŠ¨æ€ä»£ç†â€”â€”å…¶ä¸­JDKåŠ¨æ€ä»£ç†ä¸CGLibåŠ¨æ€ä»£ç†æ›´æ˜¯é‡ä¸­ä¹‹é‡ã€‚æœ¬æ–‡å°†ä»AOPçš„åŸºç¡€æ¦‚å¿µå‡ºå‘ï¼Œå±‚å±‚æ·±å…¥å‰–æè¿™ä¸¤ç§åŠ¨æ€ä»£ç†çš„å®ç°åŸç†ã€ä»£ç ç»†èŠ‚åŠé€‚ç”¨åœºæ™¯ï¼Œæœ€ç»ˆæ¢³ç†Spring AOPçš„æ•´ä½“æ‰§è¡Œé€»è¾‘ï¼Œä¸ºå¼€å‘è€…æä¾›ä¸€ä»½å…¨é¢ä¸”å®ç”¨çš„æŠ€æœ¯æŒ‡å—ã€‚</p>
<h2 data-id="heading-1"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>ç¬¬ä¸€ç«  å¤¯å®åŸºç¡€ï¼šèµ°è¿›Spring AOPçš„ä¸–ç•Œ</h2>
<h3 data-id="heading-2"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>1.1 ä¸ºä»€ä¹ˆéœ€è¦AOPï¼Ÿâ€”â€” ä»ä»£ç ç—›ç‚¹è¯´èµ·</h3>
<p>åœ¨ä¼ ç»Ÿçš„OOPï¼ˆé¢å‘å¯¹è±¡ç¼–ç¨‹ï¼‰å¼€å‘ä¸­ï¼Œæˆ‘ä»¬ä¹ æƒ¯äºå°†åŠŸèƒ½å°è£…åœ¨ç±»å’Œå¯¹è±¡ä¸­ï¼Œé€šè¿‡ç»§æ‰¿å’Œå¤šæ€å®ç°ä»£ç å¤ç”¨ã€‚ä½†åœ¨å®é™…ä¸šåŠ¡åœºæ™¯ä¸­ï¼Œä¼šå­˜åœ¨ä¸€äº›"è·¨ç•Œ"çš„é€šç”¨åŠŸèƒ½ï¼Œä¾‹å¦‚ï¼š</p>
<ul>
<li>æ¥å£è°ƒç”¨å‰åçš„æ—¥å¿—è®°å½•ï¼Œéœ€è¦åœ¨æ¯ä¸ªæ¥å£å®ç°ä¸­é‡å¤ç¼–å†™æ—¥å¿—è¾“å‡ºä»£ç ï¼›</li>
<li>æ•°æ®åº“æ“ä½œçš„äº‹åŠ¡ç®¡ç†ï¼Œéœ€åœ¨å¢åˆ æ”¹æ–¹æ³•å‰åæ‰‹åŠ¨å¼€å¯ã€æäº¤æˆ–å›æ»šäº‹åŠ¡ï¼›</li>
<li>æ¥å£è®¿é—®çš„æƒé™æ ¡éªŒï¼Œè¦åœ¨æ¯ä¸ªä¸šåŠ¡æ–¹æ³•å¼€å¤´åˆ¤æ–­ç”¨æˆ·æƒé™æ˜¯å¦åˆæ³•ã€‚</li>
</ul>
<p>è¿™äº›ä»£ç ä¸æ ¸å¿ƒä¸šåŠ¡é€»è¾‘æ— å…³ï¼Œå´åˆ†æ•£åœ¨å„ä¸ªä¸šåŠ¡ç±»ä¸­ï¼Œå¯¼è‡´ä»£ç å†—ä½™ã€ç»´æŠ¤æˆæœ¬é«˜â€”â€”ä¿®æ”¹æ—¥å¿—æ ¼å¼éœ€è¦æ”¹åŠ¨æ‰€æœ‰æ—¥å¿—ç›¸å…³ä»£ç ï¼Œè°ƒæ•´äº‹åŠ¡éš”ç¦»çº§åˆ«åˆ™è¦éå†æ‰€æœ‰äº‹åŠ¡æ–¹æ³•ã€‚AOPçš„å‡ºç°æ­£æ˜¯ä¸ºäº†è§£å†³è¿™ä¸€é—®é¢˜ï¼Œå®ƒå°†è¿™äº›é€šç”¨åŠŸèƒ½æŠ½è±¡ä¸º"åˆ‡é¢"ï¼Œåœ¨ä¸ä¿®æ”¹ä¸šåŠ¡ä»£ç çš„å‰æä¸‹ï¼Œé€šè¿‡"ç»‡å…¥"æœºåˆ¶å°†åˆ‡é¢ä¸ä¸šåŠ¡é€»è¾‘ç»“åˆï¼Œå®ç°é€šç”¨åŠŸèƒ½çš„ç»Ÿä¸€ç®¡ç†ã€‚</p>
<h3 data-id="heading-3"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>1.2 AOPæ ¸å¿ƒæ¦‚å¿µï¼šè¯»æ‡‚åˆ‡é¢çš„"è¯­è¨€ä½“ç³»"</h3>
<p>è¦ç†è§£Spring AOPçš„å®ç°åŸç†ï¼Œé¦–å…ˆéœ€è¦æŒæ¡å…¶æ ¸å¿ƒæ¦‚å¿µï¼Œè¿™äº›æ¦‚å¿µå…±åŒæ„æˆäº†AOPçš„"è¯­è¨€ä½“ç³»"ï¼Œä¹Ÿæ˜¯åç»­ç†è§£åŠ¨æ€ä»£ç†çš„åŸºç¡€ï¼š</p>
<h4 data-id="heading-4"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>1.2.1 åˆ‡é¢ï¼ˆAspectï¼‰</h4>
<p>åˆ‡é¢æ˜¯AOPçš„æ ¸å¿ƒè½½ä½“ï¼Œå®ƒå°è£…äº†éœ€è¦æ¨ªåˆ‡åˆ°ä¸šåŠ¡é€»è¾‘ä¸­çš„é€šç”¨åŠŸèƒ½ï¼Œä¾‹å¦‚"æ—¥å¿—åˆ‡é¢"ã€â€œäº‹åŠ¡åˆ‡é¢â€ã€‚åœ¨Springä¸­ï¼Œåˆ‡é¢é€šå¸¸æ˜¯ä¸€ä¸ªå¸¦æœ‰@Aspectæ³¨è§£çš„ç±»ï¼Œå…¶ä¸­åŒ…å«äº†é€šçŸ¥å’Œåˆ‡å…¥ç‚¹çš„å®šä¹‰ã€‚</p>
<h4 data-id="heading-5"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>1.2.2 é€šçŸ¥ï¼ˆAdviceï¼‰</h4>
<p>é€šçŸ¥å®šä¹‰äº†åˆ‡é¢çš„å…·ä½“æ‰§è¡Œé€»è¾‘å’Œæ‰§è¡Œæ—¶æœºï¼Œå³"åœ¨ä»€ä¹ˆæ—¶å€™åšä»€ä¹ˆäº‹"ã€‚Springæ”¯æŒ5ç§ç±»å‹çš„é€šçŸ¥ï¼š</p>
<ul>
<li>å‰ç½®é€šçŸ¥ï¼ˆBeforeï¼‰ï¼šåœ¨ç›®æ ‡æ–¹æ³•æ‰§è¡Œå‰æ‰§è¡Œï¼›</li>
<li>åç½®é€šçŸ¥ï¼ˆAfterï¼‰ï¼šåœ¨ç›®æ ‡æ–¹æ³•æ‰§è¡Œåæ‰§è¡Œï¼Œæ— è®ºæ–¹æ³•æ˜¯å¦æŠ›å‡ºå¼‚å¸¸ï¼›</li>
<li>è¿”å›é€šçŸ¥ï¼ˆAfterReturningï¼‰ï¼šåœ¨ç›®æ ‡æ–¹æ³•æ­£å¸¸è¿”å›åæ‰§è¡Œï¼›</li>
<li>å¼‚å¸¸é€šçŸ¥ï¼ˆAfterThrowingï¼‰ï¼šåœ¨ç›®æ ‡æ–¹æ³•æŠ›å‡ºå¼‚å¸¸åæ‰§è¡Œï¼›</li>
<li>ç¯ç»•é€šçŸ¥ï¼ˆAroundï¼‰ï¼šåŒ…è£¹ç›®æ ‡æ–¹æ³•ï¼Œå¯åœ¨æ–¹æ³•æ‰§è¡Œå‰åè‡ªå®šä¹‰é€»è¾‘ï¼Œç”šè‡³æ§åˆ¶æ–¹æ³•æ˜¯å¦æ‰§è¡Œã€‚</li>
</ul>
<h4 data-id="heading-6"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>1.2.3 åˆ‡å…¥ç‚¹ï¼ˆPointcutï¼‰</h4>
<p>åˆ‡å…¥ç‚¹å®šä¹‰äº†åˆ‡é¢çš„"ä½œç”¨èŒƒå›´"ï¼Œå³"å¯¹å“ªäº›æ–¹æ³•ç”Ÿæ•ˆ"ã€‚å®ƒé€šè¿‡åˆ‡å…¥ç‚¹è¡¨è¾¾å¼ï¼ˆå¦‚executionè¡¨è¾¾å¼ï¼‰æŒ‡å®šç›®æ ‡æ–¹æ³•ï¼Œä¾‹å¦‚"æ‰€æœ‰com.example.serviceåŒ…ä¸‹ä»¥findå¼€å¤´çš„publicæ–¹æ³•"ã€‚åˆ‡å…¥ç‚¹æ˜¯è¿æ¥åˆ‡é¢ä¸ç›®æ ‡å¯¹è±¡çš„æ¡¥æ¢ï¼Œåªæœ‰åŒ¹é…åˆ‡å…¥ç‚¹çš„æ–¹æ³•æ‰ä¼šè¢«ç»‡å…¥é€šçŸ¥é€»è¾‘ã€‚</p>
<h4 data-id="heading-7"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>1.2.4 ç›®æ ‡å¯¹è±¡ï¼ˆTargetï¼‰</h4>
<p>ç›®æ ‡å¯¹è±¡å³è¢«åˆ‡é¢ç»‡å…¥çš„ä¸šåŠ¡å¯¹è±¡ï¼Œä¹Ÿå°±æ˜¯åŒ…å«æ ¸å¿ƒä¸šåŠ¡é€»è¾‘çš„å¯¹è±¡ï¼Œä¾‹å¦‚UserServiceã€OrderServiceç­‰ã€‚</p>
<h4 data-id="heading-8"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>1.2.5 ä»£ç†å¯¹è±¡ï¼ˆProxyï¼‰</h4>
<p>ä»£ç†å¯¹è±¡æ˜¯Spring AOPå®ç°çš„å…³é”®â€”â€”Springä¸ä¼šç›´æ¥ä¿®æ”¹ç›®æ ‡å¯¹è±¡çš„ä»£ç ï¼Œè€Œæ˜¯é€šè¿‡åŠ¨æ€ä»£ç†æŠ€æœ¯ä¸ºç›®æ ‡å¯¹è±¡åˆ›å»ºä¸€ä¸ªä»£ç†å¯¹è±¡ã€‚å½“å®¢æˆ·ç«¯è°ƒç”¨ç›®æ ‡æ–¹æ³•æ—¶ï¼Œå®é™…ä¸Šæ˜¯è°ƒç”¨ä»£ç†å¯¹è±¡çš„æ–¹æ³•ï¼Œä»£ç†å¯¹è±¡ä¼šåœ¨åˆé€‚çš„æ—¶æœºæ‰§è¡Œåˆ‡é¢çš„é€šçŸ¥é€»è¾‘ï¼Œå†è°ƒç”¨ç›®æ ‡å¯¹è±¡çš„åŸå§‹æ–¹æ³•ã€‚</p>
<h4 data-id="heading-9"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>1.2.6 ç»‡å…¥ï¼ˆWeavingï¼‰</h4>
<p>ç»‡å…¥æ˜¯å°†åˆ‡é¢çš„é€šçŸ¥é€»è¾‘èå…¥åˆ°ç›®æ ‡å¯¹è±¡ä¸šåŠ¡æ–¹æ³•ä¸­çš„è¿‡ç¨‹ã€‚æ ¹æ®ç»‡å…¥æ—¶æœºçš„ä¸åŒï¼Œå¯åˆ†ä¸ºç¼–è¯‘æœŸç»‡å…¥ï¼ˆå¦‚AspectJï¼‰ã€ç±»åŠ è½½æœŸç»‡å…¥å’Œè¿è¡ŒæœŸç»‡å…¥â€”â€”Spring AOPé‡‡ç”¨çš„æ˜¯è¿è¡ŒæœŸç»‡å…¥ï¼Œé€šè¿‡åŠ¨æ€ä»£ç†åœ¨ç¨‹åºè¿è¡Œæ—¶åŠ¨æ€ç”Ÿæˆä»£ç†å¯¹è±¡ï¼Œå®Œæˆé€šçŸ¥ä¸ç›®æ ‡æ–¹æ³•çš„ç»“åˆã€‚</p>
<h3 data-id="heading-10"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>1.3 Spring AOPçš„æ ¸å¿ƒé€»è¾‘ï¼šä»£ç†å¯¹è±¡çš„"æ¡¥æ¢ä½œç”¨"</h3>
<p>Spring AOPçš„æ ¸å¿ƒé€»è¾‘å¯æ¦‚æ‹¬ä¸º"ä»£ç†ä»‹å¯¼"ï¼šå®¢æˆ·ç«¯è¯·æ±‚ç›®æ ‡å¯¹è±¡æ—¶ï¼ŒSpringçš„IOCå®¹å™¨è¿”å›çš„ä¸æ˜¯ç›®æ ‡å¯¹è±¡æœ¬èº«ï¼Œè€Œæ˜¯å…¶ä»£ç†å¯¹è±¡ï¼›å®¢æˆ·ç«¯è°ƒç”¨ä»£ç†å¯¹è±¡çš„æ–¹æ³•æ—¶ï¼Œä»£ç†å¯¹è±¡å…ˆæ‰§è¡Œåˆ‡é¢çš„é€šçŸ¥é€»è¾‘ï¼ˆå¦‚æ—¥å¿—è®°å½•ã€æƒé™æ ¡éªŒï¼‰ï¼Œå†è°ƒç”¨ç›®æ ‡å¯¹è±¡çš„åŸå§‹æ–¹æ³•ï¼›æ–¹æ³•æ‰§è¡Œå®Œæˆåï¼Œä»£ç†å¯¹è±¡è¿˜ä¼šæ‰§è¡Œåç»­çš„é€šçŸ¥é€»è¾‘ï¼ˆå¦‚äº‹åŠ¡æäº¤ã€è¿”å›å€¼å¤„ç†ï¼‰ã€‚æ•´ä¸ªè¿‡ç¨‹ä¸­ï¼Œå®¢æˆ·ç«¯æ— éœ€æ„ŸçŸ¥ä»£ç†å¯¹è±¡çš„å­˜åœ¨ï¼Œç›®æ ‡å¯¹è±¡çš„ä¸šåŠ¡ä»£ç ä¹Ÿæ— éœ€ä¿®æ”¹ï¼Œä»è€Œå®ç°äº†é€šç”¨åŠŸèƒ½ä¸ä¸šåŠ¡é€»è¾‘çš„è§£è€¦ã€‚</p>
<h2 data-id="heading-11"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>ç¬¬äºŒç«  æ·±åº¦è§£æï¼šJDKåŠ¨æ€ä»£ç†çš„å®ç°åŸç†</h2>
<p>JDKåŠ¨æ€ä»£ç†æ˜¯Spring AOPé»˜è®¤ä½¿ç”¨çš„ä»£ç†æ–¹å¼ï¼Œå®ƒåŸºäºJavaçš„åå°„æœºåˆ¶å®ç°ï¼Œæ ¸å¿ƒä¾èµ–java.lang.reflectåŒ…ä¸‹çš„Proxyç±»å’ŒInvocationHandleræ¥å£ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒJDKåŠ¨æ€ä»£ç†æœ‰ä¸€ä¸ªé‡è¦é™åˆ¶ï¼š<strong>åªèƒ½ä¸ºå®ç°äº†æ¥å£çš„ç›®æ ‡å¯¹è±¡åˆ›å»ºä»£ç†å¯¹è±¡</strong>ï¼Œè¿™æ˜¯ç”±å…¶åº•å±‚å®ç°æœºåˆ¶å†³å®šçš„ã€‚</p>
<h3 data-id="heading-12"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>2.1 JDKåŠ¨æ€ä»£ç†æ ¸å¿ƒç»„ä»¶</h3>
<p>è¦ç†è§£JDKåŠ¨æ€ä»£ç†ï¼Œé¦–å…ˆéœ€è¦æŒæ¡å…¶ä¸¤ä¸ªæ ¸å¿ƒç»„ä»¶çš„ä½œç”¨ï¼Œå®ƒä»¬å…±åŒæ”¯æ’‘èµ·ä»£ç†å¯¹è±¡çš„åˆ›å»ºå’Œé€»è¾‘æ‰§è¡Œï¼š</p>
<h4 data-id="heading-13"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>2.1.1 InvocationHandleræ¥å£</h4>
<p>InvocationHandleræ˜¯ä¸€ä¸ªå‡½æ•°å¼æ¥å£ï¼Œä»…åŒ…å«ä¸€ä¸ªinvokeæ–¹æ³•ï¼Œå®ƒæ˜¯ä»£ç†å¯¹è±¡çš„"é€»è¾‘å¤„ç†å™¨"â€”â€”å½“å®¢æˆ·ç«¯è°ƒç”¨ä»£ç†å¯¹è±¡çš„æ–¹æ³•æ—¶ï¼Œæœ€ç»ˆéƒ½ä¼šå§”æ‰˜ç»™è¯¥æ¥å£çš„invokeæ–¹æ³•æ‰§è¡Œã€‚å…¶å®šä¹‰å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript">
<span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">InvocationHandler</span> {
    <span class="hljs-comment">/**
     * ä»£ç†å¯¹è±¡æ–¹æ³•è°ƒç”¨çš„æ ¸å¿ƒå¤„ç†æ–¹æ³•
     * <span class="hljs-doctag">@param</span> proxy ä»£ç†å¯¹è±¡æœ¬èº«
     * <span class="hljs-doctag">@param</span> method è¢«è°ƒç”¨çš„ç›®æ ‡æ–¹æ³•
     * <span class="hljs-doctag">@param</span> args ç›®æ ‡æ–¹æ³•çš„å‚æ•°æ•°ç»„
     * <span class="hljs-doctag">@return</span> ç›®æ ‡æ–¹æ³•çš„è¿”å›å€¼
     * <span class="hljs-doctag">@throws</span> Throwable ç›®æ ‡æ–¹æ³•å¯èƒ½æŠ›å‡ºçš„å¼‚å¸¸
     */</span>
    <span class="hljs-title class_">Object</span> <span class="hljs-title function_">invoke</span>(<span class="hljs-title class_">Object</span> proxy, <span class="hljs-title class_">Method</span> method, <span class="hljs-title class_">Object</span>[] args) throws <span class="hljs-title class_">Throwable</span>;
}

<span class="hljs-variable constant_">AI</span>å†™ä»£ç java
è¿è¡Œ
<span class="hljs-number">123456789101112</span>
</code></pre>
<p>invokeæ–¹æ³•çš„ä¸‰ä¸ªå‚æ•°å«ä¹‰æ˜ç¡®ï¼šproxyæ˜¯åŠ¨æ€ç”Ÿæˆçš„ä»£ç†å¯¹è±¡ï¼›methodæ˜¯å®¢æˆ·ç«¯è°ƒç”¨çš„ç›®æ ‡æ–¹æ³•å®ä¾‹ï¼Œé€šè¿‡å®ƒå¯ä»¥åå°„è°ƒç”¨ç›®æ ‡å¯¹è±¡çš„æ–¹æ³•ï¼›argsæ˜¯å®¢æˆ·ç«¯ä¼ é€’ç»™ç›®æ ‡æ–¹æ³•çš„å‚æ•°ã€‚å¼€å‘è€…éœ€è¦åœ¨invokeæ–¹æ³•ä¸­å®ç°"é€šçŸ¥é€»è¾‘+ç›®æ ‡æ–¹æ³•è°ƒç”¨"çš„ç»„åˆé€»è¾‘ã€‚</p>
<h4 data-id="heading-14"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>2.1.2 Proxyç±»</h4>
<p>Proxyç±»æ˜¯JDKåŠ¨æ€ä»£ç†çš„"ä»£ç†å·¥å‚"ï¼Œå®ƒæä¾›äº†é™æ€æ–¹æ³•newProxyInstanceç”¨äºåˆ›å»ºä»£ç†å¯¹è±¡ã€‚è¯¥æ–¹æ³•æ˜¯JDKåŠ¨æ€ä»£ç†çš„å…¥å£ï¼Œå…¶å®šä¹‰å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-java" lang="java">
<span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Object <span class="hljs-title function_">newProxyInstance</span><span class="hljs-params">(ClassLoader loader,
                                     Class&lt;?&gt;[] interfaces,
                                     InvocationHandler h)</span>
    <span class="hljs-keyword">throws</span> IllegalArgumentException

AIå†™ä»£ç java
è¿è¡Œ
<span class="hljs-number">12345</span>
</code></pre>
<p>ä¸‰ä¸ªå‚æ•°çš„ä½œç”¨è‡³å…³é‡è¦ï¼Œç›´æ¥å†³å®šäº†ä»£ç†å¯¹è±¡çš„ç”Ÿæˆï¼š</p>
<ul>
<li>loaderï¼šç±»åŠ è½½å™¨ï¼Œç”¨äºåŠ è½½ä»£ç†å¯¹è±¡çš„å­—èŠ‚ç ï¼Œé€šå¸¸ä½¿ç”¨ç›®æ ‡å¯¹è±¡çš„ç±»åŠ è½½å™¨ï¼›</li>
<li>interfacesï¼šç›®æ ‡å¯¹è±¡å®ç°çš„æ‰€æœ‰æ¥å£æ•°ç»„ï¼ŒJDKåŠ¨æ€ä»£ç†ä¼šè®©ä»£ç†å¯¹è±¡å®ç°è¿™äº›æ¥å£ï¼Œä»è€Œä¿è¯ä»£ç†å¯¹è±¡ä¸ç›®æ ‡å¯¹è±¡çš„æ¥å£ä¸€è‡´æ€§ï¼›</li>
<li>hï¼šInvocationHandlerå®ä¾‹ï¼Œä»£ç†å¯¹è±¡çš„æ–¹æ³•è°ƒç”¨ä¼šå§”æ‰˜ç»™è¯¥å®ä¾‹çš„invokeæ–¹æ³•ã€‚</li>
</ul>
<h3 data-id="heading-15"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>2.2 JDKåŠ¨æ€ä»£ç†å®æˆ˜ï¼šæ‰‹å†™ä¸€ä¸ªæ—¥å¿—ä»£ç†</h3>
<p>ç†è®ºç»“åˆå®è·µæ˜¯ç†è§£æŠ€æœ¯çš„æœ€ä½³æ–¹å¼ï¼Œä¸‹é¢æˆ‘ä»¬é€šè¿‡ä¸€ä¸ª"æ—¥å¿—åˆ‡é¢"çš„æ¡ˆä¾‹ï¼Œæ‰‹å†™JDKåŠ¨æ€ä»£ç†çš„å®Œæ•´å®ç°ï¼Œç›´è§‚æ„Ÿå—å…¶å·¥ä½œæµç¨‹ã€‚</p>
<h4 data-id="heading-16"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>2.2.1 æ­¥éª¤1ï¼šå®šä¹‰ç›®æ ‡æ¥å£ä¸ç›®æ ‡å¯¹è±¡</h4>
<p>ç”±äºJDKåŠ¨æ€ä»£ç†ä¾èµ–æ¥å£ï¼Œé¦–å…ˆå®šä¹‰ä¸€ä¸ªä¸šåŠ¡æ¥å£UserServiceï¼ŒåŒ…å«ç”¨æˆ·æŸ¥è¯¢å’Œæ–°å¢ä¸¤ä¸ªæ–¹æ³•ï¼Œå†åˆ›å»ºå…¶å®ç°ç±»UserServiceImplä½œä¸ºç›®æ ‡å¯¹è±¡ï¼š</p>
<pre><code class="hljs language-kotlin" lang="kotlin">
<span class="hljs-comment">// ç›®æ ‡æ¥å£</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">UserService</span> {
    <span class="hljs-comment">// æŸ¥è¯¢ç”¨æˆ·</span>
    User findUserById(<span class="hljs-built_in">Long</span> id);
    <span class="hljs-comment">// æ–°å¢ç”¨æˆ·</span>
    void addUser(User user);
}

<span class="hljs-comment">// ç›®æ ‡å¯¹è±¡ï¼ˆä¸šåŠ¡å®ç°ç±»ï¼‰</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserServiceImpl</span> <span class="hljs-title">implements</span> <span class="hljs-title">UserService</span> {
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> User findUserById(<span class="hljs-built_in">Long</span> id) {
        <span class="hljs-comment">// æ¨¡æ‹Ÿæ•°æ®åº“æŸ¥è¯¢</span>
        System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">"æ‰§è¡Œæ•°æ®åº“æŸ¥è¯¢ï¼šæ ¹æ®ID="</span> + id + <span class="hljs-string">"æŸ¥è¯¢ç”¨æˆ·"</span>);
        <span class="hljs-keyword">return</span> new User(id, <span class="hljs-string">"å¼ ä¸‰"</span>, <span class="hljs-number">25</span>);
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> void addUser(User user) {
        <span class="hljs-comment">// æ¨¡æ‹Ÿæ•°æ®åº“æ–°å¢</span>
        System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">"æ‰§è¡Œæ•°æ®åº“æ–°å¢ï¼šæ·»åŠ ç”¨æˆ·"</span> + user.getName());
    }
}

<span class="hljs-comment">// å®ä½“ç±»User</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">User</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-built_in">Long</span> id;
    <span class="hljs-keyword">private</span> String name;
    <span class="hljs-keyword">private</span> Integer age;

    <span class="hljs-comment">// æ„é€ æ–¹æ³•ã€getterã€setterçœç•¥</span>
}

AIå†™ä»£ç java
è¿è¡Œ
<span class="hljs-number">123456789101112131415161718192021222324252627282930313233</span>
</code></pre>
<h4 data-id="heading-17"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>2.2.2 æ­¥éª¤2ï¼šå®ç°InvocationHandleræ¥å£â€”â€”å®šä¹‰åˆ‡é¢é€»è¾‘</h4>
<p>åˆ›å»ºLogInvocationHandlerç±»å®ç°InvocationHandleræ¥å£ï¼Œåœ¨invokeæ–¹æ³•ä¸­å®ç°"å‰ç½®æ—¥å¿—+ç›®æ ‡æ–¹æ³•è°ƒç”¨+åç½®æ—¥å¿—"çš„é€»è¾‘ï¼Œè¿™å°±æ˜¯æˆ‘ä»¬çš„"æ—¥å¿—åˆ‡é¢"ï¼š</p>
<pre><code class="hljs language-java" lang="java">
<span class="hljs-keyword">import</span> java.lang.reflect.InvocationHandler;
<span class="hljs-keyword">import</span> java.lang.reflect.Method;
<span class="hljs-keyword">import</span> java.time.LocalDateTime;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">LogInvocationHandler</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">InvocationHandler</span> {
    <span class="hljs-comment">// ç›®æ ‡å¯¹è±¡ï¼ˆè¢«ä»£ç†çš„ä¸šåŠ¡å¯¹è±¡ï¼‰</span>
    <span class="hljs-keyword">private</span> Object target;

    <span class="hljs-comment">// æ„é€ æ–¹æ³•æ³¨å…¥ç›®æ ‡å¯¹è±¡</span>
    <span class="hljs-keyword">public</span> <span class="hljs-title function_">LogInvocationHandler</span><span class="hljs-params">(Object target)</span> {
        <span class="hljs-built_in">this</span>.target = target;
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> Object <span class="hljs-title function_">invoke</span><span class="hljs-params">(Object proxy, Method method, Object[] args)</span> <span class="hljs-keyword">throws</span> Throwable {
        <span class="hljs-comment">// 1. å‰ç½®é€šçŸ¥ï¼šæ—¥å¿—è®°å½•ï¼ˆæ–¹æ³•è°ƒç”¨æ—¶é—´ã€æ–¹æ³•åï¼‰</span>
        <span class="hljs-type">String</span> <span class="hljs-variable">methodName</span> <span class="hljs-operator">=</span> method.getName();
        System.out.println(<span class="hljs-string">"ã€æ—¥å¿—å‰ç½®é€šçŸ¥ã€‘"</span> + LocalDateTime.now() + <span class="hljs-string">" è°ƒç”¨æ–¹æ³•ï¼š"</span> + methodName);

        <span class="hljs-comment">// 2. è°ƒç”¨ç›®æ ‡å¯¹è±¡çš„åŸå§‹æ–¹æ³•</span>
        <span class="hljs-type">Object</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;
        <span class="hljs-keyword">try</span> {
            result = method.invoke(target, args);
            <span class="hljs-comment">// 3. è¿”å›é€šçŸ¥ï¼šè®°å½•æ–¹æ³•è¿”å›å€¼</span>
            System.out.println(<span class="hljs-string">"ã€æ—¥å¿—è¿”å›é€šçŸ¥ã€‘æ–¹æ³•"</span> + methodName + <span class="hljs-string">"è¿”å›å€¼ï¼š"</span> + (result == <span class="hljs-literal">null</span> ? <span class="hljs-string">"æ— "</span> : result.toString()));
        } <span class="hljs-keyword">catch</span> (Exception e) {
            <span class="hljs-comment">// 4. å¼‚å¸¸é€šçŸ¥ï¼šè®°å½•æ–¹æ³•å¼‚å¸¸ä¿¡æ¯</span>
            System.out.println(<span class="hljs-string">"ã€æ—¥å¿—å¼‚å¸¸é€šçŸ¥ã€‘æ–¹æ³•"</span> + methodName + <span class="hljs-string">"æŠ›å‡ºå¼‚å¸¸ï¼š"</span> + e.getMessage());
            <span class="hljs-keyword">throw</span> e; <span class="hljs-comment">// æŠ›å‡ºå¼‚å¸¸ï¼Œä¸å½±å“ä¸šåŠ¡é€»è¾‘</span>
        } <span class="hljs-keyword">finally</span> {
            <span class="hljs-comment">// 5. åç½®é€šçŸ¥ï¼šè®°å½•æ–¹æ³•è°ƒç”¨ç»“æŸ</span>
            System.out.println(<span class="hljs-string">"ã€æ—¥å¿—åç½®é€šçŸ¥ã€‘æ–¹æ³•"</span> + methodName + <span class="hljs-string">"è°ƒç”¨ç»“æŸ\n"</span>);
        }

        <span class="hljs-keyword">return</span> result;
    }
}

AIå†™ä»£ç java
è¿è¡Œ
<span class="hljs-number">1234567891011121314151617181920212223242526272829303132333435363738</span>
</code></pre>
<h4 data-id="heading-18"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>2.2.3 æ­¥éª¤3ï¼šä½¿ç”¨Proxyåˆ›å»ºä»£ç†å¯¹è±¡å¹¶æµ‹è¯•</h4>
<p>åˆ›å»ºæµ‹è¯•ç±»ï¼Œé€šè¿‡Proxy.newProxyInstanceæ–¹æ³•ç”Ÿæˆä»£ç†å¯¹è±¡ï¼Œç„¶åè°ƒç”¨ä»£ç†å¯¹è±¡çš„æ–¹æ³•ï¼Œè§‚å¯Ÿæ—¥å¿—åˆ‡é¢æ˜¯å¦ç”Ÿæ•ˆï¼š</p>
<pre><code class="hljs language-java" lang="java">
<span class="hljs-keyword">import</span> java.lang.reflect.Proxy;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">JdkProxyTest</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-comment">// 1. åˆ›å»ºç›®æ ‡å¯¹è±¡</span>
        <span class="hljs-type">UserService</span> <span class="hljs-variable">target</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UserServiceImpl</span>();

        <span class="hljs-comment">// 2. åˆ›å»ºInvocationHandlerå®ä¾‹ï¼ˆä¼ å…¥ç›®æ ‡å¯¹è±¡ï¼‰</span>
        <span class="hljs-type">LogInvocationHandler</span> <span class="hljs-variable">invocationHandler</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">LogInvocationHandler</span>(target);

        <span class="hljs-comment">// 3. ç”Ÿæˆä»£ç†å¯¹è±¡ï¼šå‚æ•°åˆ†åˆ«ä¸ºç›®æ ‡ç±»åŠ è½½å™¨ã€ç›®æ ‡æ¥å£æ•°ç»„ã€InvocationHandler</span>
        <span class="hljs-type">UserService</span> <span class="hljs-variable">proxy</span> <span class="hljs-operator">=</span> (UserService) Proxy.newProxyInstance(
                target.getClass().getClassLoader(),
                target.getClass().getInterfaces(),
                invocationHandler
        );

        <span class="hljs-comment">// 4. è°ƒç”¨ä»£ç†å¯¹è±¡çš„æ–¹æ³•</span>
        proxy.findUserById(<span class="hljs-number">1L</span>);
        proxy.addUser(<span class="hljs-keyword">new</span> <span class="hljs-title class_">User</span>(<span class="hljs-number">2L</span>, <span class="hljs-string">"æå››"</span>, <span class="hljs-number">30</span>));
    }
}

AIå†™ä»£ç java
è¿è¡Œ
<span class="hljs-number">1234567891011121314151617181920212223</span>
</code></pre>
<h4 data-id="heading-19"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>2.2.4 æµ‹è¯•ç»“æœä¸åˆ†æ</h4>
<p>è¿è¡Œæµ‹è¯•ç±»ï¼Œè¾“å‡ºç»“æœå¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-ini" lang="ini">
ã€æ—¥å¿—å‰ç½®é€šçŸ¥ã€‘2025-12-05T15:30:00 è°ƒç”¨æ–¹æ³•ï¼šfindUserById
æ‰§è¡Œæ•°æ®åº“æŸ¥è¯¢ï¼šæ ¹æ®<span class="hljs-attr">ID</span>=<span class="hljs-number">1</span>æŸ¥è¯¢ç”¨æˆ·
ã€æ—¥å¿—è¿”å›é€šçŸ¥ã€‘æ–¹æ³•findUserByIdè¿”å›å€¼ï¼šUser(<span class="hljs-attr">id</span>=<span class="hljs-number">1</span>, name=å¼ ä¸‰, age=<span class="hljs-number">25</span>)
ã€æ—¥å¿—åç½®é€šçŸ¥ã€‘æ–¹æ³•findUserByIdè°ƒç”¨ç»“æŸ

ã€æ—¥å¿—å‰ç½®é€šçŸ¥ã€‘2025-12-05T15:30:00 è°ƒç”¨æ–¹æ³•ï¼šaddUser
æ‰§è¡Œæ•°æ®åº“æ–°å¢ï¼šæ·»åŠ ç”¨æˆ·æå››
ã€æ—¥å¿—è¿”å›é€šçŸ¥ã€‘æ–¹æ³•addUserè¿”å›å€¼ï¼šæ— 
ã€æ—¥å¿—åç½®é€šçŸ¥ã€‘æ–¹æ³•addUserè°ƒç”¨ç»“æŸ

AIå†™ä»£ç text
12345678910
</code></pre>
<p>ä»ç»“æœå¯ä»¥çœ‹å‡ºï¼Œä»£ç†å¯¹è±¡æˆåŠŸå°†æ—¥å¿—é€šçŸ¥é€»è¾‘ä¸ä¸šåŠ¡æ–¹æ³•ç»“åˆï¼šè°ƒç”¨findUserByIdå’ŒaddUseræ–¹æ³•æ—¶ï¼Œå‡å…ˆæ‰§è¡Œå‰ç½®æ—¥å¿—ï¼Œå†æ‰§è¡Œæ ¸å¿ƒä¸šåŠ¡é€»è¾‘ï¼Œæœ€åæ‰§è¡Œè¿”å›é€šçŸ¥å’Œåç½®é€šçŸ¥ã€‚è¿™æ­£æ˜¯JDKåŠ¨æ€ä»£ç†çš„æ ¸å¿ƒä½œç”¨â€”â€”é€šè¿‡ä»£ç†å¯¹è±¡ä»‹å¯¼ï¼Œå®ç°åˆ‡é¢é€»è¾‘ä¸ä¸šåŠ¡é€»è¾‘çš„è§£è€¦ã€‚</p>
<h3 data-id="heading-20"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>2.3 JDKåŠ¨æ€ä»£ç†åº•å±‚æœºåˆ¶ï¼šä»£ç†ç±»æ˜¯å¦‚ä½•ç”Ÿæˆçš„ï¼Ÿ</h3>
<p>å¾ˆå¤šå¼€å‘è€…ä¼šå¥½å¥‡ï¼šProxy.newProxyInstanceæ–¹æ³•è°ƒç”¨åï¼Œä»£ç†å¯¹è±¡çš„å­—èŠ‚ç æ˜¯å¦‚ä½•ç”Ÿæˆçš„ï¼Ÿå…¶å®ï¼ŒJDKåŠ¨æ€ä»£ç†çš„åº•å±‚æ˜¯é€šè¿‡"åŠ¨æ€ç”Ÿæˆå­—èŠ‚ç æ–‡ä»¶"å¹¶åŠ è½½åˆ°JVMä¸­å®ç°çš„ï¼Œå…·ä½“æµç¨‹å¦‚ä¸‹ï¼š</p>
<ol>
<li><strong>ç”Ÿæˆä»£ç†ç±»çš„å­—èŠ‚ç </strong>ï¼šProxyç±»æ ¹æ®ä¼ å…¥çš„interfaceså‚æ•°ï¼ŒåŠ¨æ€ç”Ÿæˆä¸€ä¸ªå®ç°äº†è¿™äº›æ¥å£çš„ä»£ç†ç±»å­—èŠ‚ç ï¼Œè¯¥ç±»ç»§æ‰¿è‡ªjava.lang.reflect.Proxyç±»ï¼ˆè¿™ä¹Ÿæ˜¯JDKåŠ¨æ€ä»£ç†ä¸èƒ½ä»£ç†ç±»çš„åŸå› â€”â€”Javaå•ç»§æ‰¿æœºåˆ¶ï¼‰ï¼›</li>
<li><strong>ä¸ºä»£ç†ç±»ç”Ÿæˆæ–¹æ³•</strong>ï¼šä»£ç†ç±»ä¼šä¸ºæ¯ä¸ªæ¥å£æ–¹æ³•ç”Ÿæˆå¯¹åº”çš„å®ç°æ–¹æ³•ï¼Œè¿™äº›æ–¹æ³•çš„é€»è¾‘éå¸¸ç®€å•â€”â€”ç›´æ¥è°ƒç”¨InvocationHandlerçš„invokeæ–¹æ³•ï¼›</li>
<li><strong>åŠ è½½ä»£ç†ç±»å­—èŠ‚ç </strong>ï¼šé€šè¿‡ä¼ å…¥çš„ç±»åŠ è½½å™¨ï¼ˆloaderå‚æ•°ï¼‰å°†ç”Ÿæˆçš„ä»£ç†ç±»å­—èŠ‚ç åŠ è½½åˆ°JVMä¸­ï¼Œç”ŸæˆClasså¯¹è±¡ï¼›</li>
<li><strong>åˆ›å»ºä»£ç†å¯¹è±¡å®ä¾‹</strong>ï¼šé€šè¿‡åå°„è°ƒç”¨ä»£ç†ç±»çš„æ„é€ æ–¹æ³•ï¼ˆè¯¥æ„é€ æ–¹æ³•æ¥æ”¶InvocationHandlerå‚æ•°ï¼‰ï¼Œåˆ›å»ºä»£ç†å¯¹è±¡å¹¶è¿”å›ã€‚</li>
</ol>
<p>æˆ‘ä»¬å¯ä»¥é€šè¿‡è®¾ç½®ç³»ç»Ÿå±æ€§ï¼Œå°†JDKåŠ¨æ€ç”Ÿæˆçš„ä»£ç†ç±»å­—èŠ‚ç ä¿å­˜åˆ°æœ¬åœ°ï¼Œä»¥ä¾¿ç›´è§‚æŸ¥çœ‹ã€‚åœ¨æµ‹è¯•ç±»çš„mainæ–¹æ³•å¼€å¤´æ·»åŠ å¦‚ä¸‹ä»£ç ï¼š</p>
<pre><code class="hljs language-arduino" lang="arduino">
<span class="hljs-comment">// ä¿å­˜JDKåŠ¨æ€ç”Ÿæˆçš„ä»£ç†ç±»å­—èŠ‚ç åˆ°æœ¬åœ°</span>
System.<span class="hljs-built_in">getProperties</span>().<span class="hljs-built_in">put</span>(<span class="hljs-string">"sun.misc.ProxyGenerator.saveGeneratedFiles"</span>, <span class="hljs-string">"true"</span>);

AIå†™ä»£ç java
è¿è¡Œ
<span class="hljs-number">123</span>
</code></pre>
<p>è¿è¡Œåï¼Œä¼šåœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹ç”Ÿæˆcom/sun/proxy/$Proxy0.classæ–‡ä»¶ï¼Œåç¼–è¯‘åå¯ä»¥çœ‹åˆ°ä»£ç†ç±»çš„æ ¸å¿ƒç»“æ„ï¼ˆç®€åŒ–åï¼‰ï¼š</p>
<pre><code class="hljs language-scala" lang="scala">
public <span class="hljs-keyword">final</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">$Proxy0</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Proxy</span> <span class="hljs-title">implements</span> <span class="hljs-title">UserService</span> </span>{
    <span class="hljs-comment">// é™æ€ä»£ç å—ï¼šè·å–ç›®æ ‡æ¥å£çš„æ–¹æ³•å®ä¾‹</span>
    static {
        <span class="hljs-keyword">try</span> {
            m1 = <span class="hljs-type">Class</span>.forName(<span class="hljs-string">"java.lang.Object"</span>).getMethod(<span class="hljs-string">"equals"</span>, <span class="hljs-type">Class</span>.forName(<span class="hljs-string">"java.lang.Object"</span>));
            m2 = <span class="hljs-type">Class</span>.forName(<span class="hljs-string">"java.lang.Object"</span>).getMethod(<span class="hljs-string">"toString"</span>);
            m3 = <span class="hljs-type">Class</span>.forName(<span class="hljs-string">"com.example.service.UserService"</span>).getMethod(<span class="hljs-string">"findUserById"</span>, <span class="hljs-type">Class</span>.forName(<span class="hljs-string">"java.lang.Long"</span>));
            m4 = <span class="hljs-type">Class</span>.forName(<span class="hljs-string">"com.example.service.UserService"</span>).getMethod(<span class="hljs-string">"addUser"</span>, <span class="hljs-type">Class</span>.forName(<span class="hljs-string">"com.example.entity.User"</span>));
            <span class="hljs-comment">// ...çœç•¥å…¶ä»–æ–¹æ³•</span>
        } <span class="hljs-keyword">catch</span> (<span class="hljs-type">NoSuchMethodException</span> e) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-type">NoSuchMethodError</span>(e.getMessage());
        }
    }

    <span class="hljs-comment">// æ„é€ æ–¹æ³•ï¼šæ¥æ”¶InvocationHandlerå‚æ•°å¹¶ä¼ ç»™çˆ¶ç±»Proxy</span>
    public $<span class="hljs-type">Proxy0</span>(<span class="hljs-type">InvocationHandler</span> var1) <span class="hljs-keyword">throws</span>  {
        <span class="hljs-keyword">super</span>(var1);
    }

    <span class="hljs-comment">// å®ç°UserServiceçš„findUserByIdæ–¹æ³•</span>
    public <span class="hljs-keyword">final</span> <span class="hljs-type">User</span> findUserById(<span class="hljs-type">Long</span> var1) <span class="hljs-keyword">throws</span>  {
        <span class="hljs-keyword">try</span> {
            <span class="hljs-comment">// è°ƒç”¨InvocationHandlerçš„invokeæ–¹æ³•</span>
            <span class="hljs-keyword">return</span> (<span class="hljs-type">User</span>)<span class="hljs-keyword">super</span>.h.invoke(<span class="hljs-keyword">this</span>, m3, <span class="hljs-keyword">new</span> <span class="hljs-type">Object</span>[]{var1});
        } <span class="hljs-keyword">catch</span> (<span class="hljs-type">RuntimeException</span> | <span class="hljs-type">Error</span> var3) {
            <span class="hljs-keyword">throw</span> var3;
        } <span class="hljs-keyword">catch</span> (<span class="hljs-type">Throwable</span> var4) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-type">UndeclaredThrowableException</span>(var4);
        }
    }

    <span class="hljs-comment">// å®ç°UserServiceçš„addUseræ–¹æ³•</span>
    public <span class="hljs-keyword">final</span> void addUser(<span class="hljs-type">User</span> var1) <span class="hljs-keyword">throws</span>  {
        <span class="hljs-keyword">try</span> {
            <span class="hljs-comment">// è°ƒç”¨InvocationHandlerçš„invokeæ–¹æ³•</span>
            <span class="hljs-keyword">super</span>.h.invoke(<span class="hljs-keyword">this</span>, m4, <span class="hljs-keyword">new</span> <span class="hljs-type">Object</span>[]{var1});
        } <span class="hljs-keyword">catch</span> (<span class="hljs-type">RuntimeException</span> | <span class="hljs-type">Error</span> var3) {
            <span class="hljs-keyword">throw</span> var3;
        } <span class="hljs-keyword">catch</span> (<span class="hljs-type">Throwable</span> var4) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-type">UndeclaredThrowableException</span>(var4);
        }
    }
}

<span class="hljs-type">AI</span>å†™ä»£ç java
è¿è¡Œ
<span class="hljs-number">1234567891011121314151617181920212223242526272829303132333435363738394041424344</span>
</code></pre>
<p>åç¼–è¯‘åçš„ä»£ç æ¸…æ™°åœ°å±•ç¤ºäº†ä»£ç†ç±»çš„ç»“æ„ï¼šå®ƒç»§æ‰¿è‡ªProxyç±»ï¼Œå®ç°äº†UserServiceæ¥å£ï¼Œæ¯ä¸ªæ¥å£æ–¹æ³•çš„å®ç°éƒ½å§”æ‰˜ç»™äº†InvocationHandlerçš„invokeæ–¹æ³•ã€‚è¿™ä¹Ÿå°±è§£é‡Šäº†ä¸ºä»€ä¹ˆè°ƒç”¨ä»£ç†å¯¹è±¡çš„æ–¹æ³•ä¼šè§¦å‘invokeæ–¹æ³•çš„æ‰§è¡Œâ€”â€”ä»£ç†ç±»çš„æ–¹æ³•é€»è¾‘å°±æ˜¯å¦‚æ­¤è®¾è®¡çš„ã€‚</p>
<h2 data-id="heading-21"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>ç¬¬ä¸‰ç«  å¦è¾Ÿè¹Šå¾„ï¼šCGLibåŠ¨æ€ä»£ç†çš„å®ç°åŸç†</h2>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/01d95c8e5f27489d8ca89547f47d62b4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2YeawtOinow==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771136723&amp;x-signature=JpGLTnGUz7AmkaAoiaQ1yIxJz0Q%3D" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" loading="lazy"/></p>
<p>ä¸Šä¸€ç« æˆ‘ä»¬æåˆ°ï¼ŒJDKåŠ¨æ€ä»£ç†åªèƒ½ä¸ºå®ç°äº†æ¥å£çš„ç›®æ ‡å¯¹è±¡åˆ›å»ºä»£ç†ï¼Œè¿™åœ¨å®é™…å¼€å‘ä¸­å­˜åœ¨å±€é™æ€§â€”â€”å¦‚æœæŸä¸ªä¸šåŠ¡ç±»æ²¡æœ‰å®ç°ä»»ä½•æ¥å£ï¼ˆå¦‚é—ç•™ç³»ç»Ÿä¸­çš„ç±»ï¼‰ï¼ŒJDKåŠ¨æ€ä»£ç†å°±æ— æ³•æ»¡è¶³éœ€æ±‚ã€‚æ­¤æ—¶ï¼ŒCGLibåŠ¨æ€ä»£ç†ä¾¿æˆä¸ºäº†Spring AOPçš„è¡¥å……æ–¹æ¡ˆã€‚CGLibï¼ˆCode Generation Libraryï¼‰æ˜¯ä¸€ä¸ªåŸºäºASMå­—èŠ‚ç æ“ä½œæ¡†æ¶çš„ä»£ç ç”Ÿæˆç±»åº“ï¼Œå®ƒé€šè¿‡"ç»§æ‰¿ç›®æ ‡ç±»"çš„æ–¹å¼åˆ›å»ºä»£ç†å¯¹è±¡ï¼Œæ— éœ€ç›®æ ‡ç±»å®ç°æ¥å£ã€‚</p>
<h3 data-id="heading-22"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>3.1 CGLibåŠ¨æ€ä»£ç†æ ¸å¿ƒåŸç†ï¼šåŸºäºç»§æ‰¿çš„ä»£ç†</h3>
<p>CGLibåŠ¨æ€ä»£ç†çš„æ ¸å¿ƒæ€æƒ³æ˜¯"ç»§æ‰¿ç›®æ ‡ç±»ï¼Œé‡å†™ç›®æ ‡æ–¹æ³•"ï¼š</p>
<ol>
<li>CGLibé€šè¿‡ASMæ¡†æ¶åŠ¨æ€ç”Ÿæˆç›®æ ‡ç±»çš„å­ç±»ï¼Œè¯¥å­ç±»å°±æ˜¯ä»£ç†ç±»ï¼›</li>
<li>ä»£ç†ç±»é‡å†™ç›®æ ‡ç±»ä¸­çš„éfinalæ–¹æ³•ï¼Œåœ¨é‡å†™çš„æ–¹æ³•ä¸­å®ç°"é€šçŸ¥é€»è¾‘+ç›®æ ‡æ–¹æ³•è°ƒç”¨"ï¼›</li>
<li>å®¢æˆ·ç«¯è°ƒç”¨ä»£ç†å¯¹è±¡çš„æ–¹æ³•æ—¶ï¼Œå®é™…ä¸Šæ˜¯è°ƒç”¨ä»£ç†ç±»é‡å†™åçš„æ–¹æ³•ï¼Œä»è€Œè§¦å‘é€šçŸ¥é€»è¾‘å’Œç›®æ ‡æ–¹æ³•çš„æ‰§è¡Œã€‚</li>
</ol>
<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒCGLibæ— æ³•ä»£ç†finalç±»å’Œfinalæ–¹æ³•â€”â€”å› ä¸ºfinalç±»ä¸èƒ½è¢«ç»§æ‰¿ï¼Œfinalæ–¹æ³•ä¸èƒ½è¢«é‡å†™ï¼Œè¿™æ˜¯CGLibçš„æ ¸å¿ƒé™åˆ¶ã€‚</p>
<h3 data-id="heading-23"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>3.2 CGLibåŠ¨æ€ä»£ç†æ ¸å¿ƒç»„ä»¶</h3>
<p>CGLibåŠ¨æ€ä»£ç†çš„æ ¸å¿ƒç»„ä»¶ä¸»è¦æœ‰ä¸¤ä¸ªï¼šMethodInterceptoræ¥å£å’ŒEnhancerç±»ï¼Œå®ƒä»¬çš„ä½œç”¨ä¸JDKåŠ¨æ€ä»£ç†çš„InvocationHandlerå’ŒProxyç±»ç±»ä¼¼ã€‚</p>
<h4 data-id="heading-24"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>3.2.1 MethodInterceptoræ¥å£</h4>
<p>MethodInterceptoræ˜¯CGLibçš„"æ–¹æ³•æ‹¦æˆªå™¨"ï¼Œç±»ä¼¼äºJDKåŠ¨æ€ä»£ç†çš„InvocationHandlerï¼Œå®ƒå®šä¹‰äº†ä»£ç†å¯¹è±¡æ–¹æ³•è°ƒç”¨çš„æ ¸å¿ƒå¤„ç†é€»è¾‘ã€‚è¯¥æ¥å£ä»…åŒ…å«ä¸€ä¸ªinterceptæ–¹æ³•ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript">
<span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">MethodInterceptor</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Callback</span> {
    <span class="hljs-comment">/**
     * ä»£ç†å¯¹è±¡æ–¹æ³•è°ƒç”¨çš„æ ¸å¿ƒå¤„ç†æ–¹æ³•
     * <span class="hljs-doctag">@param</span> obj ä»£ç†å¯¹è±¡
     * <span class="hljs-doctag">@param</span> method è¢«è°ƒç”¨çš„ç›®æ ‡æ–¹æ³•
     * <span class="hljs-doctag">@param</span> args ç›®æ ‡æ–¹æ³•çš„å‚æ•°æ•°ç»„
     * <span class="hljs-doctag">@param</span> proxy MethodProxyå¯¹è±¡ï¼Œç”¨äºè°ƒç”¨ç›®æ ‡æ–¹æ³•ï¼ˆæ¯”åå°„æ›´é«˜æ•ˆï¼‰
     * <span class="hljs-doctag">@return</span> ç›®æ ‡æ–¹æ³•çš„è¿”å›å€¼
     * <span class="hljs-doctag">@throws</span> Throwable ç›®æ ‡æ–¹æ³•å¯èƒ½æŠ›å‡ºçš„å¼‚å¸¸
     */</span>
    <span class="hljs-title class_">Object</span> <span class="hljs-title function_">intercept</span>(<span class="hljs-title class_">Object</span> obj, <span class="hljs-title class_">Method</span> method, <span class="hljs-title class_">Object</span>[] args, <span class="hljs-title class_">MethodProxy</span> proxy) throws <span class="hljs-title class_">Throwable</span>;
}

<span class="hljs-variable constant_">AI</span>å†™ä»£ç java
è¿è¡Œ
<span class="hljs-number">12345678910111213</span>
</code></pre>
<p>ä¸invokeæ–¹æ³•ç›¸æ¯”ï¼Œinterceptæ–¹æ³•å¤šäº†ä¸€ä¸ªMethodProxyå‚æ•°ï¼Œå®ƒæ˜¯CGLibæä¾›çš„ç”¨äºè°ƒç”¨ç›®æ ‡æ–¹æ³•çš„å·¥å…·ç±»ï¼Œå…¶æ•ˆç‡æ¯”é€šè¿‡åå°„è°ƒç”¨Methodå¯¹è±¡æ›´é«˜â€”â€”å› ä¸ºMethodProxyä¼šç”Ÿæˆç›®æ ‡æ–¹æ³•çš„å¿«é€Ÿè°ƒç”¨ä»£ç ï¼Œé¿å…äº†åå°„çš„æ€§èƒ½å¼€é”€ã€‚</p>
<h4 data-id="heading-25"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>3.2.2 Enhancerç±»</h4>
<p>Enhanceræ˜¯CGLibçš„"ä»£ç†ç”Ÿæˆå™¨"ï¼Œç±»ä¼¼äºJDKåŠ¨æ€ä»£ç†çš„Proxyç±»ï¼Œå®ƒè´Ÿè´£åŠ¨æ€ç”Ÿæˆç›®æ ‡ç±»çš„å­ç±»ï¼ˆä»£ç†ç±»ï¼‰å¹¶åˆ›å»ºä»£ç†å¯¹è±¡ã€‚Enhancerçš„æ ¸å¿ƒæ–¹æ³•åŒ…æ‹¬setSuperclassï¼ˆè®¾ç½®ç›®æ ‡ç±»ï¼Œå³ä»£ç†ç±»çš„çˆ¶ç±»ï¼‰ã€setCallbackï¼ˆè®¾ç½®æ–¹æ³•æ‹¦æˆªå™¨ï¼‰ã€createï¼ˆç”Ÿæˆå¹¶è¿”å›ä»£ç†å¯¹è±¡ï¼‰ã€‚</p>
<h3 data-id="heading-26"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>3.3 CGLibåŠ¨æ€ä»£ç†å®æˆ˜ï¼šä¸ºæ— æ¥å£ç±»åˆ›å»ºæ—¥å¿—ä»£ç†</h3>
<p>ä¸‹é¢æˆ‘ä»¬ä»¥ä¸€ä¸ª<strong>æ— æ¥å£çš„ä¸šåŠ¡ç±»</strong>ä¸ºä¾‹ï¼Œå®ç°CGLibåŠ¨æ€ä»£ç†çš„æ—¥å¿—åˆ‡é¢ï¼Œå¯¹æ¯”ä¸JDKåŠ¨æ€ä»£ç†çš„å·®å¼‚ã€‚</p>
<h4 data-id="heading-27"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>3.3.1 æ­¥éª¤1ï¼šå¼•å…¥CGLibä¾èµ–</h4>
<p>Spring Booté¡¹ç›®ä¸­å·²é»˜è®¤å¼•å…¥CGLibä¾èµ–ï¼ˆé€šè¿‡spring-coreé—´æ¥ä¾èµ–ï¼‰ï¼ŒéSpringé¡¹ç›®éœ€æ‰‹åŠ¨å¼•å…¥ï¼š</p>
<pre><code class="hljs language-xml" lang="xml">
<span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>cglib<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>cglib<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>3.3.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>

AIå†™ä»£ç xml
123456
</code></pre>
<h4 data-id="heading-28"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>3.3.2 æ­¥éª¤2ï¼šå®šä¹‰æ— æ¥å£çš„ç›®æ ‡å¯¹è±¡</h4>
<p>åˆ›å»ºä¸€ä¸ªæœªå®ç°ä»»ä½•æ¥å£çš„ä¸šåŠ¡ç±»OrderServiceï¼Œä½œä¸ºCGLibçš„ä»£ç†ç›®æ ‡ï¼š</p>
<pre><code class="hljs language-kotlin" lang="kotlin">
<span class="hljs-comment">// æ— æ¥å£çš„ç›®æ ‡å¯¹è±¡</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OrderService</span> {
    <span class="hljs-comment">// è®¢å•æŸ¥è¯¢æ–¹æ³•</span>
    <span class="hljs-keyword">public</span> Order findOrderById(<span class="hljs-built_in">Long</span> id) {
        System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">"æ‰§è¡Œæ•°æ®åº“æŸ¥è¯¢ï¼šæ ¹æ®ID="</span> + id + <span class="hljs-string">"æŸ¥è¯¢è®¢å•"</span>);
        <span class="hljs-keyword">return</span> new Order(id, <span class="hljs-string">"20251205001"</span>, <span class="hljs-number">199.9</span>);
    }

    <span class="hljs-comment">// è®¢å•åˆ›å»ºæ–¹æ³•</span>
    <span class="hljs-keyword">public</span> void createOrder(Order order) {
        System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">"æ‰§è¡Œæ•°æ®åº“æ–°å¢ï¼šåˆ›å»ºè®¢å•"</span> + order.getOrderNo());
        <span class="hljs-comment">// æ¨¡æ‹Ÿå¼‚å¸¸åœºæ™¯</span>
        <span class="hljs-comment">// if (order.getAmount() &lt; 0) {</span>
        <span class="hljs-comment">//     throw new IllegalArgumentException("è®¢å•é‡‘é¢ä¸èƒ½ä¸ºè´Ÿæ•°");</span>
        <span class="hljs-comment">// }</span>
    }
}

<span class="hljs-comment">// å®ä½“ç±»Order</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Order</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-built_in">Long</span> id;
    <span class="hljs-keyword">private</span> String orderNo;
    <span class="hljs-keyword">private</span> <span class="hljs-built_in">Double</span> amount;

    <span class="hljs-comment">// æ„é€ æ–¹æ³•ã€getterã€setterçœç•¥</span>
}

AIå†™ä»£ç java
è¿è¡Œ
<span class="hljs-number">123456789101112131415161718192021222324252627</span>
</code></pre>
<h4 data-id="heading-29"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>3.3.3 æ­¥éª¤3ï¼šå®ç°MethodInterceptoræ¥å£â€”â€”å®šä¹‰æ—¥å¿—æ‹¦æˆªé€»è¾‘</h4>
<p>åˆ›å»ºLogMethodInterceptorç±»å®ç°MethodInterceptoræ¥å£ï¼Œåœ¨interceptæ–¹æ³•ä¸­å®ç°æ—¥å¿—é€šçŸ¥é€»è¾‘ï¼š</p>
<pre><code class="hljs language-java" lang="java">
<span class="hljs-keyword">import</span> net.sf.cglib.proxy.MethodInterceptor;
<span class="hljs-keyword">import</span> net.sf.cglib.proxy.MethodProxy;
<span class="hljs-keyword">import</span> java.lang.reflect.Method;
<span class="hljs-keyword">import</span> java.time.LocalDateTime;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">LogMethodInterceptor</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">MethodInterceptor</span> {
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> Object <span class="hljs-title function_">intercept</span><span class="hljs-params">(Object obj, Method method, Object[] args, MethodProxy proxy)</span> <span class="hljs-keyword">throws</span> Throwable {
        <span class="hljs-comment">// 1. å‰ç½®é€šçŸ¥ï¼šæ—¥å¿—è®°å½•</span>
        <span class="hljs-type">String</span> <span class="hljs-variable">methodName</span> <span class="hljs-operator">=</span> method.getName();
        System.out.println(<span class="hljs-string">"ã€CGLibæ—¥å¿—å‰ç½®é€šçŸ¥ã€‘"</span> + LocalDateTime.now() + <span class="hljs-string">" è°ƒç”¨æ–¹æ³•ï¼š"</span> + methodName);

        <span class="hljs-comment">// 2. è°ƒç”¨ç›®æ ‡å¯¹è±¡çš„åŸå§‹æ–¹æ³•ï¼ˆé€šè¿‡MethodProxyè°ƒç”¨ï¼Œæ•ˆç‡æ›´é«˜ï¼‰</span>
        <span class="hljs-type">Object</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;
        <span class="hljs-keyword">try</span> {
            result = proxy.invokeSuper(obj, args); <span class="hljs-comment">// æ³¨æ„ï¼šæ­¤å¤„æ˜¯invokeSuperï¼Œè°ƒç”¨çˆ¶ç±»ï¼ˆç›®æ ‡ç±»ï¼‰çš„æ–¹æ³•</span>
            <span class="hljs-comment">// 3. è¿”å›é€šçŸ¥</span>
            System.out.println(<span class="hljs-string">"ã€CGLibæ—¥å¿—è¿”å›é€šçŸ¥ã€‘æ–¹æ³•"</span> + methodName + <span class="hljs-string">"è¿”å›å€¼ï¼š"</span> + (result == <span class="hljs-literal">null</span> ? <span class="hljs-string">"æ— "</span> : result.toString()));
        } <span class="hljs-keyword">catch</span> (Exception e) {
            <span class="hljs-comment">// 4. å¼‚å¸¸é€šçŸ¥</span>
            System.out.println(<span class="hljs-string">"ã€CGLibæ—¥å¿—å¼‚å¸¸é€šçŸ¥ã€‘æ–¹æ³•"</span> + methodName + <span class="hljs-string">"æŠ›å‡ºå¼‚å¸¸ï¼š"</span> + e.getMessage());
            <span class="hljs-keyword">throw</span> e;
        } <span class="hljs-keyword">finally</span> {
            <span class="hljs-comment">// 5. åç½®é€šçŸ¥</span>
            System.out.println(<span class="hljs-string">"ã€CGLibæ—¥å¿—åç½®é€šçŸ¥ã€‘æ–¹æ³•"</span> + methodName + <span class="hljs-string">"è°ƒç”¨ç»“æŸ\n"</span>);
        }

        <span class="hljs-keyword">return</span> result;
    }
}

AIå†™ä»£ç java
è¿è¡Œ
<span class="hljs-number">12345678910111213141516171819202122232425262728293031</span>
</code></pre>
<p>éœ€è¦ç‰¹åˆ«æ³¨æ„çš„æ˜¯ï¼Œè°ƒç”¨ç›®æ ‡æ–¹æ³•æ—¶ä½¿ç”¨çš„æ˜¯MethodProxyçš„invokeSuperæ–¹æ³•ï¼Œè€Œéinvokeæ–¹æ³•ï¼š</p>
<ul>
<li>invokeSuper(obj, args)ï¼šè°ƒç”¨ä»£ç†å¯¹è±¡çš„çˆ¶ç±»ï¼ˆå³ç›®æ ‡ç±»ï¼‰çš„å¯¹åº”æ–¹æ³•ï¼Œè¿™æ˜¯CGLibè°ƒç”¨ç›®æ ‡æ–¹æ³•çš„æ­£ç¡®æ–¹å¼ï¼›</li>
<li>invoke(obj, args)ï¼šä¼šå†æ¬¡è§¦å‘interceptæ–¹æ³•ï¼Œå¯¼è‡´æ— é™å¾ªç¯ï¼Œå¼€å‘ä¸­éœ€é¿å…ã€‚</li>
</ul>
<h4 data-id="heading-30"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>3.3.4 æ­¥éª¤4ï¼šä½¿ç”¨Enhanceråˆ›å»ºä»£ç†å¯¹è±¡å¹¶æµ‹è¯•</h4>
<p>åˆ›å»ºæµ‹è¯•ç±»ï¼Œé€šè¿‡Enhancerç”Ÿæˆä»£ç†å¯¹è±¡å¹¶è°ƒç”¨æ–¹æ³•ï¼š</p>
<pre><code class="hljs language-java" lang="java">
<span class="hljs-keyword">import</span> net.sf.cglib.proxy.Enhancer;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CglibProxyTest</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-comment">// 1. åˆ›å»ºç›®æ ‡å¯¹è±¡</span>
        <span class="hljs-type">OrderService</span> <span class="hljs-variable">target</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">OrderService</span>();

        <span class="hljs-comment">// 2. åˆ›å»ºæ–¹æ³•æ‹¦æˆªå™¨å®ä¾‹</span>
        <span class="hljs-type">LogMethodInterceptor</span> <span class="hljs-variable">interceptor</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">LogMethodInterceptor</span>();

        <span class="hljs-comment">// 3. åˆ›å»ºEnhancerå¯¹è±¡ï¼ˆä»£ç†ç”Ÿæˆå™¨ï¼‰</span>
        <span class="hljs-type">Enhancer</span> <span class="hljs-variable">enhancer</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Enhancer</span>();
        <span class="hljs-comment">// è®¾ç½®ç›®æ ‡ç±»ä¸ºçˆ¶ç±»ï¼ˆä»£ç†ç±»ç»§æ‰¿è‡ªç›®æ ‡ç±»ï¼‰</span>
        enhancer.setSuperclass(OrderService.class);
        <span class="hljs-comment">// è®¾ç½®æ–¹æ³•æ‹¦æˆªå™¨ï¼ˆä»£ç†ç±»çš„æ–¹æ³•è°ƒç”¨ä¼šå§”æ‰˜ç»™è¯¥æ‹¦æˆªå™¨ï¼‰</span>
        enhancer.setCallback(interceptor);

        <span class="hljs-comment">// 4. ç”Ÿæˆä»£ç†å¯¹è±¡ï¼ˆé€šè¿‡createæ–¹æ³•ï¼‰</span>
        <span class="hljs-type">OrderService</span> <span class="hljs-variable">proxy</span> <span class="hljs-operator">=</span> (OrderService) enhancer.create();

        <span class="hljs-comment">// 5. è°ƒç”¨ä»£ç†å¯¹è±¡çš„æ–¹æ³•</span>
        proxy.findOrderById(<span class="hljs-number">1L</span>);
        proxy.createOrder(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Order</span>(<span class="hljs-number">2L</span>, <span class="hljs-string">"20251205002"</span>, <span class="hljs-number">299.9</span>));

        <span class="hljs-comment">// æµ‹è¯•å¼‚å¸¸åœºæ™¯ï¼ˆè§£å¼€OrderServiceä¸­createOrderçš„å¼‚å¸¸æ³¨é‡Šï¼‰</span>
        <span class="hljs-comment">// proxy.createOrder(new Order(3L, "20251205003", -50.0));</span>
    }
}

AIå†™ä»£ç java
è¿è¡Œ
<span class="hljs-number">1234567891011121314151617181920212223242526272829</span>
</code></pre>
<h4 data-id="heading-31"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>3.3.5 æµ‹è¯•ç»“æœä¸åˆ†æ</h4>
<p>è¿è¡Œæµ‹è¯•ç±»ï¼Œè¾“å‡ºç»“æœå¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-objectivec" lang="objectivec">
ã€<span class="hljs-built_in">CGLib</span>æ—¥å¿—å‰ç½®é€šçŸ¥ã€‘<span class="hljs-number">2025</span><span class="hljs-number">-12</span><span class="hljs-number">-05</span>T16:<span class="hljs-number">00</span>:<span class="hljs-number">00</span> è°ƒç”¨æ–¹æ³•ï¼šfindOrderById
æ‰§è¡Œæ•°æ®åº“æŸ¥è¯¢ï¼šæ ¹æ®ID=<span class="hljs-number">1</span>æŸ¥è¯¢è®¢å•
ã€<span class="hljs-built_in">CGLib</span>æ—¥å¿—è¿”å›é€šçŸ¥ã€‘æ–¹æ³•findOrderByIdè¿”å›å€¼ï¼šOrder(<span class="hljs-type">id</span>=<span class="hljs-number">1</span>, orderNo=<span class="hljs-number">20251205001</span>, amount=<span class="hljs-number">199.9</span>)
ã€<span class="hljs-built_in">CGLib</span>æ—¥å¿—åç½®é€šçŸ¥ã€‘æ–¹æ³•findOrderByIdè°ƒç”¨ç»“æŸ

ã€<span class="hljs-built_in">CGLib</span>æ—¥å¿—å‰ç½®é€šçŸ¥ã€‘<span class="hljs-number">2025</span><span class="hljs-number">-12</span><span class="hljs-number">-05</span>T16:<span class="hljs-number">00</span>:<span class="hljs-number">00</span> è°ƒç”¨æ–¹æ³•ï¼šcreateOrder
æ‰§è¡Œæ•°æ®åº“æ–°å¢ï¼šåˆ›å»ºè®¢å•<span class="hljs-number">20251205002</span>
ã€<span class="hljs-built_in">CGLib</span>æ—¥å¿—è¿”å›é€šçŸ¥ã€‘æ–¹æ³•createOrderè¿”å›å€¼ï¼šæ— 
ã€<span class="hljs-built_in">CGLib</span>æ—¥å¿—åç½®é€šçŸ¥ã€‘æ–¹æ³•createOrderè°ƒç”¨ç»“æŸ

AIå†™ä»£ç text
<span class="hljs-number">12345678910</span>
</code></pre>
<p>ç»“æœè¡¨æ˜ï¼ŒCGLibæˆåŠŸä¸ºæ— æ¥å£çš„OrderServiceåˆ›å»ºäº†ä»£ç†å¯¹è±¡ï¼Œæ—¥å¿—é€šçŸ¥é€»è¾‘ä¸ä¸šåŠ¡é€»è¾‘å®Œç¾ç»“åˆã€‚è‹¥è§£å¼€OrderServiceä¸­createOrderæ–¹æ³•çš„å¼‚å¸¸æ³¨é‡Šï¼Œè°ƒç”¨æ—¶ä¼šè§¦å‘å¼‚å¸¸é€šçŸ¥ï¼Œè¾“å‡ºå¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-objectivec" lang="objectivec">
ã€<span class="hljs-built_in">CGLib</span>æ—¥å¿—å‰ç½®é€šçŸ¥ã€‘<span class="hljs-number">2025</span><span class="hljs-number">-12</span><span class="hljs-number">-05</span>T16:<span class="hljs-number">00</span>:<span class="hljs-number">00</span> è°ƒç”¨æ–¹æ³•ï¼šcreateOrder
æ‰§è¡Œæ•°æ®åº“æ–°å¢ï¼šåˆ›å»ºè®¢å•<span class="hljs-number">20251205003</span>
ã€<span class="hljs-built_in">CGLib</span>æ—¥å¿—å¼‚å¸¸é€šçŸ¥ã€‘æ–¹æ³•createOrderæŠ›å‡ºå¼‚å¸¸ï¼šè®¢å•é‡‘é¢ä¸èƒ½ä¸ºè´Ÿæ•°
ã€<span class="hljs-built_in">CGLib</span>æ—¥å¿—åç½®é€šçŸ¥ã€‘æ–¹æ³•createOrderè°ƒç”¨ç»“æŸ

Exception <span class="hljs-keyword">in</span> thread <span class="hljs-string">"main"</span> java.lang.IllegalArgumentException: è®¢å•é‡‘é¢ä¸èƒ½ä¸ºè´Ÿæ•°
    ...çœç•¥å †æ ˆä¿¡æ¯

AIå†™ä»£ç text
<span class="hljs-number">12345678</span>
</code></pre>
<p>è¿™è¯´æ˜CGLibçš„å¼‚å¸¸å¤„ç†é€»è¾‘åŒæ ·ç”Ÿæ•ˆï¼Œä¸JDKåŠ¨æ€ä»£ç†çš„é€šçŸ¥ç±»å‹è¦†ç›–èƒ½åŠ›ä¸€è‡´ã€‚</p>
<h3 data-id="heading-32"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>3.4 CGLibåŠ¨æ€ä»£ç†åº•å±‚æœºåˆ¶ï¼šä»£ç†ç±»çš„ç”Ÿæˆè¿‡ç¨‹</h3>
<p>ä¸JDKåŠ¨æ€ä»£ç†ç±»ä¼¼ï¼ŒCGLibä¹Ÿæ˜¯é€šè¿‡åŠ¨æ€ç”Ÿæˆå­—èŠ‚ç æ–‡ä»¶æ¥åˆ›å»ºä»£ç†ç±»çš„ï¼Œä½†å…¶ç”Ÿæˆé€»è¾‘åŸºäºASMæ¡†æ¶ï¼Œç›´æ¥æ“ä½œå­—èŠ‚ç ï¼Œè¿‡ç¨‹æ›´ä¸ºå¤æ‚ï¼Œæ ¸å¿ƒæµç¨‹å¦‚ä¸‹ï¼š</p>
<ol>
<li><strong>ç¡®å®šä»£ç†ç±»çš„çˆ¶ç±»</strong>ï¼šEnhanceræ ¹æ®setSuperclassæ–¹æ³•ä¼ å…¥çš„ç›®æ ‡ç±»ï¼Œç¡®å®šä»£ç†ç±»çš„çˆ¶ç±»ï¼›</li>
<li><strong>ç”Ÿæˆä»£ç†ç±»å­—èŠ‚ç </strong>ï¼šé€šè¿‡ASMæ¡†æ¶ç”Ÿæˆä»£ç†ç±»çš„å­—èŠ‚ç ï¼Œä»£ç†ç±»ç»§æ‰¿è‡ªç›®æ ‡ç±»ï¼Œå¹¶é‡å†™ç›®æ ‡ç±»çš„éfinalæ–¹æ³•ï¼›</li>
<li><strong>æ³¨å…¥æ‹¦æˆªé€»è¾‘</strong>ï¼šåœ¨ä»£ç†ç±»é‡å†™çš„æ–¹æ³•ä¸­ï¼Œæ³¨å…¥æ–¹æ³•æ‹¦æˆªé€»è¾‘â€”â€”è°ƒç”¨MethodInterceptorçš„interceptæ–¹æ³•ï¼›</li>
<li><strong>ç”ŸæˆMethodProxy</strong>ï¼šä¸ºæ¯ä¸ªé‡å†™çš„æ–¹æ³•ç”Ÿæˆå¯¹åº”çš„MethodProxyå¯¹è±¡ï¼Œç”¨äºé«˜æ•ˆè°ƒç”¨ç›®æ ‡æ–¹æ³•ï¼›</li>
<li><strong>åˆ›å»ºä»£ç†å¯¹è±¡</strong>ï¼šé€šè¿‡Enhancerçš„createæ–¹æ³•ï¼Œå°†ç”Ÿæˆçš„ä»£ç†ç±»å­—èŠ‚ç åŠ è½½åˆ°JVMä¸­ï¼Œåˆ›å»ºä»£ç†å¯¹è±¡å¹¶è¿”å›ã€‚</li>
</ol>
<p>æˆ‘ä»¬å¯ä»¥é€šè¿‡è®¾ç½®ç³»ç»Ÿå±æ€§ï¼Œå°†CGLibç”Ÿæˆçš„ä»£ç†ç±»å­—èŠ‚ç ä¿å­˜åˆ°æœ¬åœ°ã€‚åœ¨æµ‹è¯•ç±»mainæ–¹æ³•å¼€å¤´æ·»åŠ å¦‚ä¸‹ä»£ç ï¼š</p>
<pre><code class="hljs language-arduino" lang="arduino">
<span class="hljs-comment">// ä¿å­˜CGLibç”Ÿæˆçš„ä»£ç†ç±»å­—èŠ‚ç åˆ°æœ¬åœ°</span>
System.<span class="hljs-built_in">setProperty</span>(<span class="hljs-string">"cglib.debugLocation"</span>, <span class="hljs-string">"D:/cglib_proxy"</span>);
System.<span class="hljs-built_in">setProperty</span>(<span class="hljs-string">"cglib.generateSpringCglibProxyClass"</span>, <span class="hljs-string">"true"</span>);

AIå†™ä»£ç java
è¿è¡Œ
<span class="hljs-number">1234</span>
</code></pre>
<p>è¿è¡Œåï¼Œä¼šåœ¨D:/cglib_proxyç›®å½•ä¸‹ç”Ÿæˆå¤šä¸ªclassæ–‡ä»¶ï¼Œå…¶ä¸­OrderServiceE n h a n c e r B y C G L I B EnhancerByCGLIBEnhancerByCGLIBxxxx.classå°±æ˜¯ä»£ç†ç±»ï¼Œåç¼–è¯‘åå¯çœ‹åˆ°å…¶æ ¸å¿ƒç»“æ„ï¼ˆç®€åŒ–åï¼‰ï¼š</p>
<pre><code class="hljs language-swift" lang="swift">
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OrderService$$EnhancerByCGLIB$$1234</span> <span class="hljs-title class_">extends</span> <span class="hljs-title class_">OrderService</span> <span class="hljs-title class_">implements</span> <span class="hljs-title class_">Factory</span> {
    <span class="hljs-comment">// MethodProxyå¯¹è±¡ï¼Œç”¨äºè°ƒç”¨ç›®æ ‡æ–¹æ³•</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-type">MethodProxy</span> <span class="hljs-type">CGLIB_findOrderById_0</span>;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-type">MethodProxy</span> <span class="hljs-type">CGLIB_createOrder_1</span>;

    <span class="hljs-comment">// é™æ€ä»£ç å—ï¼šåˆå§‹åŒ–MethodProxy</span>
    <span class="hljs-keyword">static</span> {
        <span class="hljs-type">CGLIB_findOrderById_0</span> <span class="hljs-operator">=</span> <span class="hljs-type">MethodProxy</span>.create(
            <span class="hljs-type">OrderService</span>.class, 
            <span class="hljs-type">OrderService</span>$<span class="hljs-variable">$EnhancerByCGLIB</span>$<span class="hljs-variable">$1234</span>.class, 
            <span class="hljs-string">"(Ljava/lang/Long;)Lcom/example/entity/Order;"</span>, 
            <span class="hljs-string">"findOrderById"</span>, 
            <span class="hljs-string">"CGLIB$findOrderById$0"</span>
        );
        <span class="hljs-comment">// ...åˆå§‹åŒ–å…¶ä»–MethodProxy</span>
    }

    <span class="hljs-comment">// é‡å†™findOrderByIdæ–¹æ³•</span>
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">Order</span> findOrderById(<span class="hljs-type">Long</span> var1) {
        <span class="hljs-type">MethodInterceptor</span> var10000 <span class="hljs-operator">=</span> this.<span class="hljs-type">CGLIB</span><span class="hljs-variable">$CALLBACK_0</span>;
        <span class="hljs-keyword">if</span> (var10000 <span class="hljs-operator">==</span> null) {
            <span class="hljs-type">CGLIB</span><span class="hljs-variable">$BIND_CALLBACKS</span>(this);
            var10000 <span class="hljs-operator">=</span> this.<span class="hljs-type">CGLIB</span><span class="hljs-variable">$CALLBACK_0</span>;
        }

        <span class="hljs-comment">// è°ƒç”¨MethodInterceptorçš„interceptæ–¹æ³•</span>
        <span class="hljs-keyword">return</span> var10000 <span class="hljs-operator">!=</span> null <span class="hljs-operator">?</span> (<span class="hljs-type">Order</span>)var10000.intercept(
            this, 
            <span class="hljs-type">CGLIB</span><span class="hljs-variable">$findOrderById</span><span class="hljs-variable">$0</span><span class="hljs-variable">$Method</span>, 
            new <span class="hljs-type">Object</span>[]{var1}, 
            <span class="hljs-type">CGLIB_findOrderById_0</span>
        ) : <span class="hljs-keyword">super</span>.findOrderById(var1);
    }

    <span class="hljs-comment">// ç›®æ ‡æ–¹æ³•çš„å¿«é€Ÿè°ƒç”¨æ–¹æ³•ï¼ˆç”±MethodProxyè°ƒç”¨ï¼‰</span>
    <span class="hljs-keyword">final</span> <span class="hljs-type">Order</span> <span class="hljs-type">CGLIB</span><span class="hljs-variable">$findOrderById</span><span class="hljs-variable">$0</span>(<span class="hljs-type">Long</span> var1) {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">super</span>.findOrderById(var1);
    }

    <span class="hljs-comment">// ...å…¶ä»–é‡å†™æ–¹æ³•å’Œè¾…åŠ©æ–¹æ³•</span>
}

<span class="hljs-type">AIå†™ä»£ç java</span>
è¿è¡Œ
<span class="hljs-number">12345678910111213141516171819202122232425262728293031323334353637383940414243</span>
</code></pre>
<p>åç¼–è¯‘åçš„ä»£ç æ˜¾ç¤ºï¼Œä»£ç†ç±»OrderServiceE n h a n c e r B y C G L I B EnhancerByCGLIBEnhancerByCGLIB1234ç»§æ‰¿è‡ªOrderServiceï¼Œé‡å†™äº†findOrderByIdæ–¹æ³•ï¼Œæ–¹æ³•å†…éƒ¨è°ƒç”¨äº†MethodInterceptorçš„interceptæ–¹æ³•ï¼Œè¿™ä¸æˆ‘ä»¬ä¹‹å‰çš„åˆ†æå®Œå…¨ä¸€è‡´ã€‚</p>
<h2 data-id="heading-33"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>ç¬¬å››ç«  å¯¹æ¯”ä¸æŠ‰æ‹©ï¼šJDKä¸CGLibåŠ¨æ€ä»£ç†çš„æ ¸å¿ƒå·®å¼‚</h2>
<p>JDKåŠ¨æ€ä»£ç†ä¸CGLibåŠ¨æ€ä»£ç†æ˜¯Spring AOPçš„ä¸¤å¤§æ ¸å¿ƒæ”¯æ’‘ï¼Œå®ƒä»¬åœ¨å®ç°åŸç†ã€é€‚ç”¨åœºæ™¯ã€æ€§èƒ½ç­‰æ–¹é¢å­˜åœ¨æ˜¾è‘—å·®å¼‚ï¼Œäº†è§£è¿™äº›å·®å¼‚æ˜¯å¼€å‘è€…åœ¨å®é™…å¼€å‘ä¸­åšå‡ºæ­£ç¡®é€‰æ‹©çš„å…³é”®ã€‚</p>
<h3 data-id="heading-34"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>4.1 æ ¸å¿ƒå·®å¼‚å¯¹æ¯”</h3>
<p>ä¸‹è¡¨ä»å¤šä¸ªç»´åº¦å¯¹æ¯”äº†JDKåŠ¨æ€ä»£ç†ä¸CGLibåŠ¨æ€ä»£ç†çš„æ ¸å¿ƒå·®å¼‚ï¼š</p>








































<table><thead><tr><th>å¯¹æ¯”ç»´åº¦</th><th>JDKåŠ¨æ€ä»£ç†</th><th>CGLibåŠ¨æ€ä»£ç†</th></tr></thead><tbody><tr><td>å®ç°åŸç†</td><td>åŸºäºJavaåå°„æœºåˆ¶ï¼Œä»£ç†ç±»å®ç°ç›®æ ‡æ¥å£ï¼Œç»§æ‰¿è‡ªProxyç±»</td><td>åŸºäºASMå­—èŠ‚ç æ¡†æ¶ï¼Œä»£ç†ç±»ç»§æ‰¿ç›®æ ‡ç±»ï¼Œé‡å†™éfinalæ–¹æ³•</td></tr><tr><td>ç›®æ ‡å¯¹è±¡è¦æ±‚</td><td>å¿…é¡»å®ç°è‡³å°‘ä¸€ä¸ªæ¥å£</td><td>æ— æ¥å£è¦æ±‚ï¼Œä½†ä¸èƒ½æ˜¯finalç±»ï¼Œç›®æ ‡æ–¹æ³•ä¸èƒ½æ˜¯finalæ–¹æ³•</td></tr><tr><td>ä»£ç†ç±»ç»“æ„</td><td>ä»£ç†ç±» = å®ç°ç›®æ ‡æ¥å£ + ç»§æ‰¿Proxyç±»</td><td>ä»£ç†ç±» = ç»§æ‰¿ç›®æ ‡ç±» + å®ç°Factoryæ¥å£</td></tr><tr><td>æ–¹æ³•è°ƒç”¨æ–¹å¼</td><td>é€šè¿‡åå°„è°ƒç”¨ç›®æ ‡æ–¹æ³•ï¼Œæ€§èƒ½ç›¸å¯¹è¾ƒä½</td><td>é€šè¿‡MethodProxyè°ƒç”¨ç›®æ ‡æ–¹æ³•ï¼Œé¿å…åå°„ï¼Œæ€§èƒ½æ›´é«˜</td></tr><tr><td>ä¾èµ–</td><td>ä¾èµ–JavaåŸç”ŸAPIï¼Œæ— éœ€é¢å¤–å¼•å…¥ä¾èµ–</td><td>ä¾èµ–CGLibå’ŒASMæ¡†æ¶ï¼ŒSpringå·²é»˜è®¤é›†æˆ</td></tr><tr><td>é€‚ç”¨åœºæ™¯</td><td>ç›®æ ‡å¯¹è±¡å®ç°æ¥å£çš„åœºæ™¯ï¼ˆSpring AOPé»˜è®¤é¦–é€‰ï¼‰</td><td>ç›®æ ‡å¯¹è±¡æ— æ¥å£çš„åœºæ™¯ï¼Œæˆ–å¯¹æ€§èƒ½è¦æ±‚è¾ƒé«˜çš„åœºæ™¯</td></tr></tbody></table>
<h3 data-id="heading-35"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>4.2 æ€§èƒ½å¯¹æ¯”ï¼šè°æ›´é«˜æ•ˆï¼Ÿ</h3>
<p>å…³äºJDKåŠ¨æ€ä»£ç†ä¸CGLibåŠ¨æ€ä»£ç†çš„æ€§èƒ½ï¼Œé•¿æœŸå­˜åœ¨äº‰è®®ã€‚å®é™…ä¸Šï¼Œä¸¤è€…çš„æ€§èƒ½å·®å¼‚ä¸JDKç‰ˆæœ¬å¯†åˆ‡ç›¸å…³ï¼š</p>
<ul>
<li><strong>JDK 8åŠä¹‹å‰ç‰ˆæœ¬</strong>ï¼šCGLibçš„æ€§èƒ½ä¼˜äºJDKåŠ¨æ€ä»£ç†ã€‚å› ä¸ºJDKåŠ¨æ€ä»£ç†é€šè¿‡åå°„è°ƒç”¨ç›®æ ‡æ–¹æ³•ï¼Œè€ŒCGLibé€šè¿‡MethodProxyç›´æ¥è°ƒç”¨ç›®æ ‡æ–¹æ³•ï¼Œé¿å…äº†åå°„çš„æ€§èƒ½å¼€é”€ï¼›</li>
<li><strong>JDK 9åŠä¹‹åç‰ˆæœ¬</strong>ï¼šJDKå¯¹åå°„æœºåˆ¶è¿›è¡Œäº†ä¼˜åŒ–ï¼ŒJDKåŠ¨æ€ä»£ç†çš„æ€§èƒ½å¤§å¹…æå‡ï¼Œä¸CGLibçš„æ€§èƒ½å·®è·ç¼©å°ï¼Œç”šè‡³åœ¨æŸäº›åœºæ™¯ä¸‹è¶…è¿‡CGLibã€‚</li>
</ul>
<p>ä¸ºäº†ç›´è§‚å¯¹æ¯”ä¸¤è€…çš„æ€§èƒ½ï¼Œæˆ‘ä»¬è®¾è®¡ä¸€ä¸ªç®€å•çš„æ€§èƒ½æµ‹è¯•ï¼šåˆ†åˆ«é€šè¿‡JDKå’ŒCGLibä»£ç†ï¼Œè°ƒç”¨ç›®æ ‡æ–¹æ³•100ä¸‡æ¬¡ï¼Œç»Ÿè®¡æ€»è€—æ—¶ã€‚æµ‹è¯•ä»£ç å¦‚ä¸‹ï¼ˆä»¥JDKä»£ç†ä¸ºä¾‹ï¼ŒCGLibç±»ä¼¼ï¼‰ï¼š</p>
<pre><code class="hljs language-ini" lang="ini">
public class ProxyPerformanceTest {
    public static void main(String<span class="hljs-section">[]</span> args) {
        // æµ‹è¯•æ¬¡æ•°
        int <span class="hljs-attr">count</span> = <span class="hljs-number">1000000</span><span class="hljs-comment">;</span>

        // JDKåŠ¨æ€ä»£ç†æ€§èƒ½æµ‹è¯•
        UserService <span class="hljs-attr">jdkTarget</span> = new UserServiceImpl()<span class="hljs-comment">;</span>
        UserService <span class="hljs-attr">jdkProxy</span> = (UserService) Proxy.newProxyInstance(
            jdkTarget.getClass().getClassLoader(),
            jdkTarget.getClass().getInterfaces(),
            new LogInvocationHandler(jdkTarget)
        )<span class="hljs-comment">;</span>
        long <span class="hljs-attr">jdkStart</span> = System.currentTimeMillis()<span class="hljs-comment">;</span>
        for (int <span class="hljs-attr">i</span> = <span class="hljs-number">0</span><span class="hljs-comment">; i &lt; count; i++) {</span>
            jdkProxy.findUserById(1L)<span class="hljs-comment">;</span>
        }
        long <span class="hljs-attr">jdkEnd</span> = System.currentTimeMillis()<span class="hljs-comment">;</span>
        System.out.println("JDKåŠ¨æ€ä»£ç†100ä¸‡æ¬¡è°ƒç”¨è€—æ—¶ï¼š" + (jdkEnd - jdkStart) + "ms")<span class="hljs-comment">;</span>

        // CGLibåŠ¨æ€ä»£ç†æ€§èƒ½æµ‹è¯•
        OrderService <span class="hljs-attr">cglibTarget</span> = new OrderService()<span class="hljs-comment">;</span>
        Enhancer <span class="hljs-attr">enhancer</span> = new Enhancer()<span class="hljs-comment">;</span>
        enhancer.setSuperclass(OrderService.class)<span class="hljs-comment">;</span>
        enhancer.setCallback(new LogMethodInterceptor())<span class="hljs-comment">;</span>
        OrderService <span class="hljs-attr">cglibProxy</span> = (OrderService) enhancer.create()<span class="hljs-comment">;</span>
        long <span class="hljs-attr">cglibStart</span> = System.currentTimeMillis()<span class="hljs-comment">;</span>
        for (int <span class="hljs-attr">i</span> = <span class="hljs-number">0</span><span class="hljs-comment">; i &lt; count; i++) {</span>
            cglibProxy.findOrderById(1L)<span class="hljs-comment">;</span>
        }
        long <span class="hljs-attr">cglibEnd</span> = System.currentTimeMillis()<span class="hljs-comment">;</span>
        System.out.println("CGLibåŠ¨æ€ä»£ç†100ä¸‡æ¬¡è°ƒç”¨è€—æ—¶ï¼š" + (cglibEnd - cglibStart) + "ms")<span class="hljs-comment">;</span>
    }
}

AIå†™ä»£ç java
è¿è¡Œ
12345678910111213141516171819202122232425262728293031323334
</code></pre>
<p>åœ¨JDK 8ç¯å¢ƒä¸‹çš„æµ‹è¯•ç»“æœï¼ˆä»…ä¾›å‚è€ƒï¼‰ï¼š</p>
<pre><code class="hljs language-arduino" lang="arduino">
JDKåŠ¨æ€ä»£ç†<span class="hljs-number">100</span>ä¸‡æ¬¡è°ƒç”¨è€—æ—¶ï¼š<span class="hljs-number">120</span>ms
CGLibåŠ¨æ€ä»£ç†<span class="hljs-number">100</span>ä¸‡æ¬¡è°ƒç”¨è€—æ—¶ï¼š<span class="hljs-number">80</span>ms

AIå†™ä»£ç text
<span class="hljs-number">123</span>
</code></pre>
<p>åœ¨JDK 11ç¯å¢ƒä¸‹çš„æµ‹è¯•ç»“æœï¼ˆä»…ä¾›å‚è€ƒï¼‰ï¼š</p>
<pre><code class="hljs language-arduino" lang="arduino">
JDKåŠ¨æ€ä»£ç†<span class="hljs-number">100</span>ä¸‡æ¬¡è°ƒç”¨è€—æ—¶ï¼š<span class="hljs-number">75</span>ms
CGLibåŠ¨æ€ä»£ç†<span class="hljs-number">100</span>ä¸‡æ¬¡è°ƒç”¨è€—æ—¶ï¼š<span class="hljs-number">82</span>ms

AIå†™ä»£ç text
<span class="hljs-number">123</span>
</code></pre>
<p>ä»æµ‹è¯•ç»“æœå¯ä»¥çœ‹å‡ºï¼ŒJDKç‰ˆæœ¬å¯¹ä¸¤è€…çš„æ€§èƒ½å½±å“å¾ˆå¤§ã€‚åœ¨å®é™…å¼€å‘ä¸­ï¼Œæ— éœ€è¿‡åº¦çº ç»“äºæ€§èƒ½å·®å¼‚â€”â€”é™¤éæ˜¯é«˜é¢‘è°ƒç”¨çš„æ ¸å¿ƒæ¥å£ï¼Œå¦åˆ™ä¸¤è€…çš„æ€§èƒ½å·®è·å¯¹ç³»ç»Ÿæ•´ä½“å½±å“å¾®ä¹å…¶å¾®ã€‚é€‰æ‹©ä»£ç†æ–¹å¼çš„æ ¸å¿ƒä¾æ®åº”æ˜¯ç›®æ ‡å¯¹è±¡æ˜¯å¦å®ç°æ¥å£ã€‚</p>
<h3 data-id="heading-36"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>4.3 Spring AOPçš„ä»£ç†é€‰æ‹©ç­–ç•¥</h3>
<p>Spring AOPä½œä¸ºæˆç†Ÿçš„æ¡†æ¶ï¼Œå¹¶æ²¡æœ‰å¼ºåˆ¶è¦æ±‚ä½¿ç”¨æŸä¸€ç§ä»£ç†æ–¹å¼ï¼Œè€Œæ˜¯æ ¹æ®ç›®æ ‡å¯¹è±¡çš„ç±»å‹è‡ªåŠ¨é€‰æ‹©åˆé€‚çš„ä»£ç†æ–¹å¼ï¼Œå…¶æ ¸å¿ƒé€‰æ‹©ç­–ç•¥å¦‚ä¸‹ï¼š</p>
<ol>
<li><strong>ä¼˜å…ˆä½¿ç”¨JDKåŠ¨æ€ä»£ç†</strong>ï¼šå¦‚æœç›®æ ‡å¯¹è±¡å®ç°äº†è‡³å°‘ä¸€ä¸ªæ¥å£ï¼ŒSpring AOPé»˜è®¤ä½¿ç”¨JDKåŠ¨æ€ä»£ç†ï¼Œç”Ÿæˆçš„ä»£ç†å¯¹è±¡æ˜¯ç›®æ ‡æ¥å£çš„å®ç°ç±»ï¼›</li>
<li><strong>è‡ªåŠ¨åˆ‡æ¢ä¸ºCGLib</strong>ï¼šå¦‚æœç›®æ ‡å¯¹è±¡æ²¡æœ‰å®ç°ä»»ä½•æ¥å£ï¼ŒSpring AOPä¼šè‡ªåŠ¨åˆ‡æ¢ä¸ºCGLibåŠ¨æ€ä»£ç†ï¼Œç”Ÿæˆçš„ä»£ç†å¯¹è±¡æ˜¯ç›®æ ‡ç±»çš„å­ç±»ï¼›</li>
<li><strong>å¼ºåˆ¶ä½¿ç”¨CGLib</strong>ï¼šå¼€å‘è€…å¯ä»¥é€šè¿‡é…ç½®å¼ºåˆ¶Spring AOPä½¿ç”¨CGLibä»£ç†ï¼Œå³ä½¿ç›®æ ‡å¯¹è±¡å®ç°äº†æ¥å£ã€‚åœ¨Spring Boot 2.xä¸­ï¼Œå¯é€šè¿‡å¦‚ä¸‹é…ç½®å®ç°ï¼š<br/>
<code>spring: aop: proxy-target-class: true # trueè¡¨ç¤ºå¼ºåˆ¶ä½¿ç”¨CGLibä»£ç†ï¼Œfalseè¡¨ç¤ºä¼˜å…ˆä½¿ç”¨JDKä»£ç†</code></li>
</ol>
<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒSpring Boot 2.xç‰ˆæœ¬ä¸­ï¼Œproxy-target-classçš„é»˜è®¤å€¼ä¸ºtrueâ€”â€”è¿™æ„å‘³ç€å³ä½¿ç›®æ ‡å¯¹è±¡å®ç°äº†æ¥å£ï¼ŒSpring AOPä¹Ÿä¼šé»˜è®¤ä½¿ç”¨CGLibä»£ç†ã€‚è¿™ä¸€å˜åŒ–çš„åŸå› æ˜¯Springå›¢é˜Ÿè®¤ä¸ºï¼ŒCGLibä»£ç†åœ¨æ˜“ç”¨æ€§ï¼ˆæ— æ¥å£è¦æ±‚ï¼‰å’Œæ€§èƒ½ï¼ˆJDK 8åŠä»¥ä¸‹ç‰ˆæœ¬ï¼‰ä¸Šæ›´å…·ä¼˜åŠ¿ï¼ŒåŒæ—¶é¿å…äº†JDKä»£ç†åªèƒ½ä»£ç†æ¥å£çš„é™åˆ¶ã€‚</p>
<h2 data-id="heading-37"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>ç¬¬äº”ç«  Spring AOPçš„æ•´ä½“æ‰§è¡Œæµç¨‹ï¼šä»åˆ‡é¢å®šä¹‰åˆ°æ–¹æ³•è°ƒç”¨</h2>
<p>å‰é¢æˆ‘ä»¬åˆ†åˆ«å‰–æäº†JDKå’ŒCGLibåŠ¨æ€ä»£ç†çš„å®ç°åŸç†ï¼Œè€ŒSpring AOPçš„æ•´ä½“æ‰§è¡Œæµç¨‹æ˜¯å°†è¿™ä¸¤ç§ä»£ç†æŠ€æœ¯ä¸åˆ‡é¢å®šä¹‰ã€åˆ‡å…¥ç‚¹åŒ¹é…ç­‰é€»è¾‘ç»“åˆèµ·æ¥çš„å®Œæ•´é“¾è·¯ã€‚ç†è§£è¿™ä¸€æµç¨‹ï¼Œèƒ½å¸®åŠ©æˆ‘ä»¬ä»å®è§‚ä¸ŠæŠŠæ¡Spring AOPçš„å·¥ä½œæœºåˆ¶ã€‚</p>
<h3 data-id="heading-38"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>5.1 Spring AOPæ ¸å¿ƒæ‰§è¡Œæµç¨‹</h3>
<p>Spring AOPçš„æ ¸å¿ƒæ‰§è¡Œæµç¨‹å¯åˆ†ä¸º"åˆå§‹åŒ–é˜¶æ®µ"å’Œ"è¿è¡Œé˜¶æ®µ"ä¸¤ä¸ªéƒ¨åˆ†ï¼Œæ¯ä¸ªé˜¶æ®µåŒ…å«å¤šä¸ªå…³é”®æ­¥éª¤ï¼š</p>
<h4 data-id="heading-39"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>5.1.1 åˆå§‹åŒ–é˜¶æ®µï¼šè§£æåˆ‡é¢å¹¶å‡†å¤‡ä»£ç†</h4>
<p>åˆå§‹åŒ–é˜¶æ®µå‘ç”Ÿåœ¨Springå®¹å™¨å¯åŠ¨æ—¶ï¼Œæ ¸å¿ƒä»»åŠ¡æ˜¯è§£æåˆ‡é¢å®šä¹‰ã€ç”Ÿæˆåˆ‡å…¥ç‚¹ï¼Œå¹¶ä¸ºç›®æ ‡å¯¹è±¡å‡†å¤‡ä»£ç†é€»è¾‘ã€‚å…·ä½“æ­¥éª¤å¦‚ä¸‹ï¼š</p>
<ol>
<li><strong>æ‰«æåˆ‡é¢ç±»</strong>ï¼šSpringå®¹å™¨å¯åŠ¨æ—¶ï¼Œé€šè¿‡@ComponentScanæ³¨è§£æ‰«æå¸¦æœ‰@Aspectæ³¨è§£çš„åˆ‡é¢ç±»ï¼Œå°†å…¶æ³¨å†Œä¸ºSpring Beanï¼›</li>
<li><strong>è§£æåˆ‡å…¥ç‚¹è¡¨è¾¾å¼</strong>ï¼šSpringè§£æåˆ‡é¢ç±»ä¸­@Pointcutæ³¨è§£å®šä¹‰çš„åˆ‡å…¥ç‚¹è¡¨è¾¾å¼ï¼Œå°†å…¶è½¬æ¢ä¸ºPointcutå¯¹è±¡ï¼Œç”¨äºåç»­åŒ¹é…ç›®æ ‡æ–¹æ³•ï¼›</li>
<li><strong>è§£æé€šçŸ¥</strong>ï¼šè§£æåˆ‡é¢ç±»ä¸­å¸¦æœ‰@Beforeã€@Afterç­‰æ³¨è§£çš„é€šçŸ¥æ–¹æ³•ï¼Œå°†å…¶ä¸å¯¹åº”çš„åˆ‡å…¥ç‚¹å…³è”ï¼Œå½¢æˆAdvisorå¯¹è±¡ï¼ˆAdvisor = åˆ‡å…¥ç‚¹ + é€šçŸ¥ï¼‰ï¼›</li>
<li><strong>è¯†åˆ«ç›®æ ‡å¯¹è±¡</strong>ï¼šSpringå®¹å™¨æ‰«æä¸šåŠ¡ç±»ï¼ˆå¦‚å¸¦æœ‰@Serviceæ³¨è§£çš„ç±»ï¼‰ï¼Œè¯†åˆ«éœ€è¦è¢«ä»£ç†çš„ç›®æ ‡å¯¹è±¡ï¼›</li>
<li><strong>åŒ¹é…Advisor</strong>ï¼šæ ¹æ®ç›®æ ‡å¯¹è±¡çš„æ–¹æ³•ï¼ŒåŒ¹é…ä¸ä¹‹å¯¹åº”çš„Advisorï¼ˆå³åˆ¤æ–­ç›®æ ‡æ–¹æ³•æ˜¯å¦ç¬¦åˆåˆ‡å…¥ç‚¹è¡¨è¾¾å¼ï¼‰ï¼›</li>
<li><strong>åˆ›å»ºä»£ç†å·¥å‚</strong>ï¼šä¸ºåŒ¹é…åˆ°Advisorçš„ç›®æ ‡å¯¹è±¡åˆ›å»ºProxyFactoryï¼ˆä»£ç†å·¥å‚ï¼‰ï¼ŒProxyFactoryå°è£…äº†ç›®æ ‡å¯¹è±¡ã€Advisorç­‰ä¿¡æ¯ï¼Œè´Ÿè´£ç”Ÿæˆä»£ç†å¯¹è±¡ã€‚</li>
</ol>
<h4 data-id="heading-40"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>5.1.2 è¿è¡Œé˜¶æ®µï¼šä»£ç†å¯¹è±¡ä»‹å¯¼çš„æ–¹æ³•è°ƒç”¨</h4>
<p>è¿è¡Œé˜¶æ®µå‘ç”Ÿåœ¨å®¢æˆ·ç«¯è°ƒç”¨ç›®æ ‡å¯¹è±¡æ–¹æ³•æ—¶ï¼Œæ ¸å¿ƒä»»åŠ¡æ˜¯é€šè¿‡ä»£ç†å¯¹è±¡æ‰§è¡Œé€šçŸ¥é€»è¾‘å’Œç›®æ ‡æ–¹æ³•ã€‚å…·ä½“æ­¥éª¤å¦‚ä¸‹ï¼š</p>
<ol>
<li><strong>è·å–ä»£ç†å¯¹è±¡</strong>ï¼šå®¢æˆ·ç«¯ä»Springå®¹å™¨ä¸­è·å–ç›®æ ‡å¯¹è±¡æ—¶ï¼Œå®¹å™¨è¿”å›çš„ä¸æ˜¯ç›®æ ‡å¯¹è±¡æœ¬èº«ï¼Œè€Œæ˜¯ç”±ProxyFactoryç”Ÿæˆçš„ä»£ç†å¯¹è±¡ï¼ˆJDKæˆ–CGLibä»£ç†ï¼‰ï¼›</li>
<li><strong>è§¦å‘ä»£ç†æ–¹æ³•</strong>ï¼šå®¢æˆ·ç«¯è°ƒç”¨ä»£ç†å¯¹è±¡çš„æ–¹æ³•ï¼Œä»£ç†å¯¹è±¡çš„æ–¹æ³•é€»è¾‘è¢«è§¦å‘ï¼ˆJDKä»£ç†è°ƒç”¨InvocationHandler.invokeï¼ŒCGLibä»£ç†è°ƒç”¨MethodInterceptor.interceptï¼‰ï¼›</li>
<li><strong>è·å–åŒ¹é…çš„é€šçŸ¥é“¾</strong>ï¼šä»£ç†å¯¹è±¡æ ¹æ®å½“å‰è°ƒç”¨çš„æ–¹æ³•ï¼Œä»ProxyFactoryä¸­è·å–ä¸ä¹‹åŒ¹é…çš„Advisoré“¾ï¼Œå°†å…¶è½¬æ¢ä¸ºé€šçŸ¥é“¾ï¼ˆMethodInterceptoré“¾ï¼‰ï¼›</li>
<li><strong>æ‰§è¡Œé€šçŸ¥é“¾</strong>ï¼šæŒ‰ç…§é€šçŸ¥çš„ç±»å‹å’Œé¡ºåºï¼Œä¾æ¬¡æ‰§è¡Œé€šçŸ¥é“¾ä¸­çš„é€šçŸ¥é€»è¾‘ã€‚ä¾‹å¦‚ï¼Œå…ˆæ‰§è¡Œ@Beforeé€šçŸ¥ï¼Œå†æ‰§è¡Œç›®æ ‡æ–¹æ³•ï¼Œæœ€åæ‰§è¡Œ@Afteré€šçŸ¥ï¼›</li>
<li><strong>è°ƒç”¨ç›®æ ‡æ–¹æ³•</strong>ï¼šé€šçŸ¥é“¾æ‰§è¡Œåˆ°æœ€åï¼Œé€šè¿‡åå°„æˆ–MethodProxyè°ƒç”¨ç›®æ ‡å¯¹è±¡çš„åŸå§‹æ–¹æ³•ï¼›</li>
<li><strong>è¿”å›ç»“æœ</strong>ï¼šå°†ç›®æ ‡æ–¹æ³•çš„è¿”å›å€¼é€šè¿‡ä»£ç†å¯¹è±¡è¿”å›ç»™å®¢æˆ·ç«¯ï¼Œå®Œæˆæ•´ä¸ªè°ƒç”¨æµç¨‹ã€‚</li>
</ol>
<h3 data-id="heading-41"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>5.2 ç»“åˆSpringæ³¨è§£çš„å®Œæ•´æ¡ˆä¾‹</h3>
<p>ä¸ºäº†è®©å¤§å®¶æ›´ç›´è§‚åœ°ç†è§£Spring AOPçš„æ•´ä½“æ‰§è¡Œæµç¨‹ï¼Œä¸‹é¢æˆ‘ä»¬é€šè¿‡ä¸€ä¸ªå®Œæ•´çš„Spring Bootæ¡ˆä¾‹ï¼Œå±•ç¤ºä»åˆ‡é¢å®šä¹‰åˆ°æ–¹æ³•è°ƒç”¨çš„å…¨è¿‡ç¨‹ã€‚</p>
<h4 data-id="heading-42"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>5.2.1 æ­¥éª¤1ï¼šåˆ›å»ºSpring Booté¡¹ç›®å¹¶å¼•å…¥ä¾èµ–</h4>
<p>åˆ›å»ºSpring Booté¡¹ç›®ï¼Œå¼•å…¥spring-boot-starter-webå’Œspring-boot-starter-aopä¾èµ–ï¼š</p>
<pre><code class="hljs language-xml" lang="xml">
<span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-aop<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span>

AIå†™ä»£ç xml
1234567891011
</code></pre>
<h4 data-id="heading-43"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>5.2.2 æ­¥éª¤2ï¼šå®šä¹‰åˆ‡é¢ç±»</h4>
<p>åˆ›å»ºLogAspectåˆ‡é¢ç±»ï¼Œå®šä¹‰åˆ‡å…¥ç‚¹å’Œäº”ç§ç±»å‹çš„é€šçŸ¥ï¼š</p>
<pre><code class="hljs language-java" lang="java">
<span class="hljs-keyword">import</span> org.aspectj.lang.JoinPoint;
<span class="hljs-keyword">import</span> org.aspectj.lang.annotation.*;
<span class="hljs-keyword">import</span> org.springframework.stereotype.Component;
<span class="hljs-keyword">import</span> java.time.LocalDateTime;

<span class="hljs-comment">// åˆ‡é¢ç±»ï¼šæ—¥å¿—åˆ‡é¢</span>
<span class="hljs-meta">@Aspect</span>
<span class="hljs-meta">@Component</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">LogAspect</span> {
    <span class="hljs-comment">// åˆ‡å…¥ç‚¹ï¼šåŒ¹é…com.example.serviceåŒ…ä¸‹æ‰€æœ‰ç±»çš„æ‰€æœ‰æ–¹æ³•</span>
    <span class="hljs-meta">@Pointcut("execution(* com.example.service.*.*(..))")</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">servicePointcut</span><span class="hljs-params">()</span> {}

    <span class="hljs-comment">// å‰ç½®é€šçŸ¥</span>
    <span class="hljs-meta">@Before("servicePointcut()")</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">beforeAdvice</span><span class="hljs-params">(JoinPoint joinPoint)</span> {
        <span class="hljs-type">String</span> <span class="hljs-variable">methodName</span> <span class="hljs-operator">=</span> joinPoint.getSignature().getName();
        System.out.println(<span class="hljs-string">"ã€Spring AOPå‰ç½®é€šçŸ¥ã€‘"</span> + LocalDateTime.now() + <span class="hljs-string">" è°ƒç”¨æ–¹æ³•ï¼š"</span> + methodName);
    }

    <span class="hljs-comment">// åç½®é€šçŸ¥</span>
    <span class="hljs-meta">@After("servicePointcut()")</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">afterAdvice</span><span class="hljs-params">(JoinPoint joinPoint)</span> {
        <span class="hljs-type">String</span> <span class="hljs-variable">methodName</span> <span class="hljs-operator">=</span> joinPoint.getSignature().getName();
        System.out.println(<span class="hljs-string">"ã€Spring AOPåç½®é€šçŸ¥ã€‘æ–¹æ³•"</span> + methodName + <span class="hljs-string">"è°ƒç”¨ç»“æŸ"</span>);
    }

    <span class="hljs-comment">// è¿”å›é€šçŸ¥</span>
    <span class="hljs-meta">@AfterReturning(value = "servicePointcut()", returning = "result")</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">afterReturningAdvice</span><span class="hljs-params">(JoinPoint joinPoint, Object result)</span> {
        <span class="hljs-type">String</span> <span class="hljs-variable">methodName</span> <span class="hljs-operator">=</span> joinPoint.getSignature().getName();
        System.out.println(<span class="hljs-string">"ã€Spring AOPè¿”å›é€šçŸ¥ã€‘æ–¹æ³•"</span> + methodName + <span class="hljs-string">"è¿”å›å€¼ï¼š"</span> + (result == <span class="hljs-literal">null</span> ? <span class="hljs-string">"æ— "</span> : result));
    }

    <span class="hljs-comment">// å¼‚å¸¸é€šçŸ¥</span>
    <span class="hljs-meta">@AfterThrowing(value = "servicePointcut()", throwing = "ex")</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">afterThrowingAdvice</span><span class="hljs-params">(JoinPoint joinPoint, Exception ex)</span> {
        <span class="hljs-type">String</span> <span class="hljs-variable">methodName</span> <span class="hljs-operator">=</span> joinPoint.getSignature().getName();
        System.out.println(<span class="hljs-string">"ã€Spring AOPå¼‚å¸¸é€šçŸ¥ã€‘æ–¹æ³•"</span> + methodName + <span class="hljs-string">"æŠ›å‡ºå¼‚å¸¸ï¼š"</span> + ex.getMessage());
    }

    <span class="hljs-comment">// ç¯ç»•é€šçŸ¥</span>
    <span class="hljs-meta">@Around("servicePointcut()")</span>
    <span class="hljs-keyword">public</span> Object <span class="hljs-title function_">aroundAdvice</span><span class="hljs-params">(ProceedingJoinPoint joinPoint)</span> <span class="hljs-keyword">throws</span> Throwable {
        <span class="hljs-type">String</span> <span class="hljs-variable">methodName</span> <span class="hljs-operator">=</span> joinPoint.getSignature().getName();
        System.out.println(<span class="hljs-string">"ã€Spring AOPç¯ç»•é€šçŸ¥-å‰ã€‘"</span> + LocalDateTime.now() + <span class="hljs-string">" å‡†å¤‡è°ƒç”¨æ–¹æ³•ï¼š"</span> + methodName);
        <span class="hljs-type">Object</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;
        <span class="hljs-keyword">try</span> {
            <span class="hljs-comment">// æ‰§è¡Œç›®æ ‡æ–¹æ³•</span>
            result = joinPoint.proceed();
            System.out.println(<span class="hljs-string">"ã€Spring AOPç¯ç»•é€šçŸ¥-åã€‘æ–¹æ³•"</span> + methodName + <span class="hljs-string">"æ‰§è¡Œå®Œæˆ"</span>);
        } <span class="hljs-keyword">catch</span> (Throwable e) {
            System.out.println(<span class="hljs-string">"ã€Spring AOPç¯ç»•é€šçŸ¥-å¼‚å¸¸ã€‘æ–¹æ³•"</span> + methodName + <span class="hljs-string">"æ‰§è¡Œå¼‚å¸¸ï¼š"</span> + e.getMessage());
            <span class="hljs-keyword">throw</span> e;
        }
        <span class="hljs-keyword">return</span> result;
    }
}

AIå†™ä»£ç Plain
<span class="hljs-number">1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859</span>
</code></pre>
<pre><code class="hljs language-java" lang="java">
<span class="hljs-keyword">import</span> org.aspectj.lang.JoinPoint;
<span class="hljs-keyword">import</span> org.aspectj.lang.annotation.*;
<span class="hljs-keyword">import</span> org.springframework.stereotype.Component;
<span class="hljs-keyword">import</span> java.time.LocalDateTime;

<span class="hljs-comment">// åˆ‡é¢ç±»ï¼šæ—¥å¿—åˆ‡é¢</span>
<span class="hljs-meta">@Aspect</span>
<span class="hljs-meta">@Component</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">LogAspect</span> {
    <span class="hljs-comment">// åˆ‡å…¥ç‚¹ï¼šåŒ¹é…com.example.serviceåŒ…ä¸‹æ‰€æœ‰ç±»çš„æ‰€æœ‰æ–¹æ³•</span>
    <span class="hljs-meta">@Pointcut("execution(* com.example.service.*.*(..))")</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">servicePointcut</span><span class="hljs-params">()</span> {}

    <span class="hljs-comment">// å‰ç½®é€šçŸ¥</span>
    <span class="hljs-meta">@Before("servicePointcut()")</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">beforeAdvice</span><span class="hljs-params">(JoinPoint joinPoint)</span> {
        <span class="hljs-type">String</span> <span class="hljs-variable">methodName</span> <span class="hljs-operator">=</span> joinPoint.getSignature().getName();
        System.out.println(<span class="hljs-string">"ã€Spring AOPå‰ç½®é€šçŸ¥ã€‘"</span> + LocalDateTime.now() + <span class="hljs-string">" è°ƒç”¨æ–¹æ³•ï¼š"</span> + methodName);
    }

    <span class="hljs-comment">// åç½®é€šçŸ¥</span>
    <span class="hljs-meta">@After("servicePointcut()")</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">afterAdvice</span><span class="hljs-params">(JoinPoint joinPoint)</span> {
        <span class="hljs-type">String</span> <span class="hljs-variable">methodName</span> <span class="hljs-operator">=</span> joinPoint.getSignature().getName();
        System.out.println(<span class="hljs-string">"ã€Spring AOPåç½®é€šçŸ¥ã€‘æ–¹æ³•"</span> + methodName + <span class="hljs-string">"è°ƒç”¨ç»“æŸ"</span>);
    }

    <span class="hljs-comment">// è¿”å›é€šçŸ¥</span>
    <span class="hljs-meta">@AfterReturning(value = "servicePointcut()", returning = "result")</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">afterReturningAdvice</span><span class="hljs-params">(JoinPoint joinPoint, Object result)</span> {
        <span class="hljs-type">String</span> <span class="hljs-variable">methodName</span> <span class="hljs-operator">=</span> joinPoint.getSignature().getName();
        System.out.println(<span class="hljs-string">"ã€Spring AOPè¿”å›é€šçŸ¥ã€‘æ–¹æ³•"</span> + methodName + <span class="hljs-string">"è¿”å›å€¼ï¼š"</span> + (result == <span class="hljs-literal">null</span> ? <span class="hljs-string">"æ— "</span> : result));
    }

    <span class="hljs-comment">// å¼‚å¸¸é€šçŸ¥</span>
    <span class="hljs-meta">@AfterThrowing(value = "servicePointcut()", throwing = "ex")</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">afterThrowingAdvice</span><span class="hljs-params">(JoinPoint joinPoint, Exception ex)</span> {
        <span class="hljs-type">String</span> <span class="hljs-variable">methodName</span> <span class="hljs-operator">=</span> joinPoint.getSignature().getName();
        System.out.println(<span class="hljs-string">"ã€Spring AOPå¼‚å¸¸é€šçŸ¥ã€‘æ–¹æ³•"</span> + methodName + <span class="hljs-string">"æŠ›å‡ºå¼‚å¸¸ï¼š"</span> + ex.getMessage());
    }

    <span class="hljs-comment">// ç¯ç»•é€šçŸ¥</span>
    <span class="hljs-meta">@Around("servicePointcut()")</span>
    <span class="hljs-keyword">public</span> Object <span class="hljs-title function_">aroundAdvice</span><span class="hljs-params">(ProceedingJoinPoint joinPoint)</span> <span class="hljs-keyword">throws</span> Throwable {
        <span class="hljs-type">String</span> <span class="hljs-variable">methodName</span> <span class="hljs-operator">=</span> joinPoint.getSignature().getName();
        System.out.println(<span class="hljs-string">"ã€Spring AOPç¯ç»•é€šçŸ¥-å‰ã€‘"</span> + LocalDateTime.now() + <span class="hljs-string">" å‡†å¤‡è°ƒç”¨æ–¹æ³•ï¼š"</span> + methodName);
        <span class="hljs-type">Object</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;
        <span class="hljs-keyword">try</span> {
            <span class="hljs-comment">// æ‰§è¡Œç›®æ ‡æ–¹æ³•</span>
            result = joinPoint.proceed();
            System.out.println(<span class="hljs-string">"ã€Spring AOPç¯ç»•é€šçŸ¥-åã€‘æ–¹æ³•"</span> + methodName + <span class="hljs-string">"æ‰§è¡Œå®Œæˆ"</span>);
        } <span class="hljs-keyword">catch</span> (Throwable e) {
            System.out.println(<span class="hljs-string">"ã€Spring AOPç¯ç»•é€šçŸ¥-å¼‚å¸¸ã€‘æ–¹æ³•"</span> + methodName + <span class="hljs-string">"æ‰§è¡Œå¼‚å¸¸ï¼š"</span> + e.getMessage());
            <span class="hljs-keyword">throw</span> e;
        }
        <span class="hljs-keyword">return</span> result;
    }
}


AIå†™ä»£ç Plain
<span class="hljs-number">123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960</span>
</code></pre>
<h2 data-id="heading-44"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>ç¬¬å…­ç«  æ€»ç»“ï¼šSpring AOPçš„æ ¸å¿ƒå¯ç¤ºä¸å®è·µæŒ‡å—</h2>
<p>æœ¬æ–‡é€šè¿‡ä»åŸºç¡€æ¦‚å¿µåˆ°åº•å±‚å®ç°ã€ä»ç†è®ºè§£æåˆ°å®æˆ˜æ¡ˆä¾‹çš„å±‚å±‚é€’è¿›ï¼Œå…¨é¢å‰–æäº†Spring AOPçš„æ ¸å¿ƒåŸç†ä¸å®è·µåº”ç”¨ã€‚ä»AOPè§£å†³çš„ä»£ç ç—›ç‚¹å‡ºå‘ï¼Œæˆ‘ä»¬æ·±å…¥ç†è§£äº†å…¶â€œæ¨ªåˆ‡ç¼–ç¨‹â€çš„æœ¬è´¨ï¼ŒæŒæ¡äº†åˆ‡é¢ã€é€šçŸ¥ã€åˆ‡å…¥ç‚¹ç­‰æ ¸å¿ƒæ¦‚å¿µï¼Œå¹¶é‡ç‚¹æ‹†è§£äº†æ”¯æ’‘Spring AOPçš„ä¸¤å¤§åŠ¨æ€ä»£ç†æŠ€æœ¯â€”â€”JDKä¸CGLibåŠ¨æ€ä»£ç†ï¼Œæœ€ç»ˆæ¢³ç†äº†Spring AOPçš„å®Œæ•´æ‰§è¡Œé“¾è·¯ã€‚è¿™äº›å†…å®¹ä¸ä»…æ­ç¤ºäº†æŠ€æœ¯çš„åº•å±‚é€»è¾‘ï¼Œæ›´èƒ½ä¸ºå®é™…å¼€å‘æä¾›æ¸…æ™°çš„æŒ‡å¼•ã€‚</p>
<h3 data-id="heading-45"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>6.1 æ ¸å¿ƒçŸ¥è¯†ä½“ç³»æ¢³ç†</h3>
<p>Spring AOPçš„çŸ¥è¯†ä½“ç³»å¯å½’çº³ä¸ºâ€œä¸€ä¸ªæ ¸å¿ƒç›®æ ‡ã€ä¸¤å¤§æŠ€æœ¯æ”¯æ’‘ã€ä¸‰ä¸ªæ ¸å¿ƒç¯èŠ‚â€ï¼š</p>
<ul>
<li><strong>ä¸€ä¸ªæ ¸å¿ƒç›®æ ‡</strong>ï¼šé€šè¿‡â€œä¸šåŠ¡é€»è¾‘â€ä¸â€œé€šç”¨åŠŸèƒ½â€çš„è§£è€¦ï¼Œæå‡ä»£ç å¤ç”¨æ€§ä¸å¯ç»´æŠ¤æ€§ã€‚AOPå°†æ—¥å¿—ã€äº‹åŠ¡ã€æƒé™ç­‰æ¨ªåˆ‡é€»è¾‘æŠ½è±¡ä¸ºåˆ‡é¢ï¼Œé¿å…äº†ä»£ç å†—ä½™ï¼Œä½¿å¼€å‘è€…èƒ½èšç„¦æ ¸å¿ƒä¸šåŠ¡å¼€å‘ã€‚</li>
<li><strong>ä¸¤å¤§æŠ€æœ¯æ”¯æ’‘</strong>ï¼šJDKåŠ¨æ€ä»£ç†ä¸CGLibåŠ¨æ€ä»£ç†æ„æˆäº†Spring AOPçš„æŠ€æœ¯åŸºçŸ³ã€‚ä¸¤è€…åŸºäºä¸åŒçš„å®ç°åŸç†ï¼ˆæ¥å£å®ç°vsç±»ç»§æ‰¿ï¼‰ï¼Œå½¢æˆäº’è¡¥ï¼šJDKä»£ç†ä¾èµ–æ¥å£ï¼Œæ— éœ€é¢å¤–ä¾èµ–ï¼Œåœ¨JDK 9+ç‰ˆæœ¬æ€§èƒ½ä¼˜å¼‚ï¼›CGLibä»£ç†é€šè¿‡ç»§æ‰¿å®ç°ï¼Œæ— æ¥å£é™åˆ¶ï¼Œåœ¨JDK 8åŠä»¥ä¸‹ç‰ˆæœ¬æ€§èƒ½æ›´å…·ä¼˜åŠ¿ã€‚</li>
<li><strong>ä¸‰ä¸ªæ ¸å¿ƒç¯èŠ‚</strong>ï¼šSpring AOPçš„å·¥ä½œæµç¨‹å¯æ¦‚æ‹¬ä¸ºâ€œåˆ‡é¢è§£æä¸å‡†å¤‡â€â€œä»£ç†å¯¹è±¡ç”Ÿæˆâ€â€œæ–¹æ³•è°ƒç”¨ä¸é€šçŸ¥æ‰§è¡Œâ€ã€‚åˆå§‹åŒ–é˜¶æ®µï¼ŒSpringå®¹å™¨å®Œæˆåˆ‡é¢æ‰«æã€åˆ‡å…¥ç‚¹è§£æä¸Advisorç»„è£…ï¼›è¿è¡Œé˜¶æ®µï¼Œä»£ç†å¯¹è±¡ä½œä¸ºä¸­ä»‹ï¼ŒæŒ‰é¡ºåºæ‰§è¡Œé€šçŸ¥é€»è¾‘ä¸ç›®æ ‡æ–¹æ³•ï¼Œå®ç°æ¨ªåˆ‡åŠŸèƒ½çš„ç»‡å…¥ã€‚</li>
</ul>
<h3 data-id="heading-46"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>6.2 å…³é”®å®è·µå†³ç­–æŒ‡å—</h3>
<p>åŸºäºå‰æ–‡çš„æŠ€æœ¯å¯¹æ¯”ä¸åŸç†åˆ†æï¼Œåœ¨å®é™…å¼€å‘ä¸­ä½¿ç”¨Spring AOPæ—¶ï¼Œå¯éµå¾ªä»¥ä¸‹å†³ç­–åŸåˆ™ï¼š</p>
<h4 data-id="heading-47"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>6.2.1 ä»£ç†æ–¹å¼é€‰æ‹©</h4>
<p>Spring AOPçš„ä»£ç†é€‰æ‹©å·²å®ç°è‡ªåŠ¨åŒ–ï¼Œä½†å¼€å‘è€…éœ€æ˜ç¡®å…¶é€»è¾‘å¹¶æ ¹æ®åœºæ™¯è°ƒæ•´ï¼š</p>
<ul>
<li>é»˜è®¤åœºæ™¯ï¼šSpring Boot 2.xåŠä»¥ä¸Šç‰ˆæœ¬é»˜è®¤å¯ç”¨<code>proxy-target-class: true</code>ï¼Œä¼˜å…ˆä½¿ç”¨CGLibä»£ç†ï¼Œè¦†ç›–æ¥å£ä¸æ— æ¥å£ä¸¤ç§åœºæ™¯ï¼Œé™ä½ä½¿ç”¨æˆæœ¬ï¼›</li>
<li>æ¥å£ä¼˜å…ˆåœºæ™¯ï¼šè‹¥é¡¹ç›®é‡‡ç”¨â€œé¢å‘æ¥å£ç¼–ç¨‹â€è§„èŒƒï¼Œä¸”ä½¿ç”¨JDK 9+ç‰ˆæœ¬ï¼Œå¯é…ç½®ä¸ºJDKä»£ç†ï¼Œåˆ©ç”¨å…¶åŸç”Ÿæ”¯æŒä¸ä¼˜åŒ–åçš„æ€§èƒ½ï¼›</li>
<li>ç‰¹æ®Šé™åˆ¶åœºæ™¯ï¼šè‹¥ç›®æ ‡ç±»ä¸ºfinalç±»æˆ–åŒ…å«finalæ–¹æ³•ï¼ŒCGLibæ— æ³•ä»£ç†ï¼Œéœ€ç¡®ä¿ç›®æ ‡ç±»å®ç°æ¥å£ä»¥ä½¿ç”¨JDKä»£ç†ã€‚</li>
</ul>
<h4 data-id="heading-48"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>6.2.2 åˆ‡é¢è®¾è®¡ä¸ä½¿ç”¨</h4>
<p>åˆ‡é¢è®¾è®¡çš„åˆç†æ€§ç›´æ¥å½±å“ç³»ç»Ÿçš„å¯ç»´æŠ¤æ€§ï¼Œéœ€æ³¨æ„ä»¥ä¸‹å‡ ç‚¹ï¼š</p>
<ul>
<li>å•ä¸€èŒè´£ï¼šä¸€ä¸ªåˆ‡é¢èšç„¦ä¸€ç±»æ¨ªåˆ‡åŠŸèƒ½ï¼ˆå¦‚æ—¥å¿—åˆ‡é¢ä»…å¤„ç†æ—¥å¿—è®°å½•ï¼Œäº‹åŠ¡åˆ‡é¢ä»…ç®¡ç†äº‹åŠ¡ï¼‰ï¼Œé¿å…åˆ‡é¢é€»è¾‘è‡ƒè‚¿ï¼›</li>
<li>åˆ‡å…¥ç‚¹ç²¾å‡†ï¼šé€šè¿‡executionè¡¨è¾¾å¼ç²¾å‡†åŒ¹é…ç›®æ ‡æ–¹æ³•ï¼Œé¿å…â€œè¿‡åº¦ä»£ç†â€ã€‚ä¾‹å¦‚ï¼Œä»…å¯¹serviceå±‚çš„ä¸šåŠ¡æ–¹æ³•ç»‡å…¥äº‹åŠ¡åˆ‡é¢ï¼Œè€Œéæ‰€æœ‰å±‚çš„æ–¹æ³•ï¼›</li>
<li>é€šçŸ¥ç±»å‹é€‚é…ï¼šæ ¹æ®éœ€æ±‚é€‰æ‹©åˆé€‚çš„é€šçŸ¥ç±»å‹â€”â€”ç¯ç»•é€šçŸ¥åŠŸèƒ½æœ€å…¨é¢ï¼Œå¯æ§åˆ¶æ–¹æ³•æ‰§è¡Œä¸å¼‚å¸¸å¤„ç†ï¼›å‰ç½®/åç½®é€šçŸ¥é€‚ç”¨äºç®€å•çš„æ—¥å¿—è®°å½•ï¼›è¿”å›/å¼‚å¸¸é€šçŸ¥åˆ™é’ˆå¯¹æ€§å¤„ç†æ–¹æ³•ç»“æœä¸å¼‚å¸¸åœºæ™¯ã€‚</li>
</ul>
<h4 data-id="heading-49"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>6.2.3 æ€§èƒ½ä¼˜åŒ–å»ºè®®</h4>
<p>è™½ç„¶Spring AOPçš„æ€§èƒ½å¼€é”€é€šå¸¸å¯å¿½ç•¥ï¼Œä½†åœ¨é«˜é¢‘è°ƒç”¨åœºæ™¯ä¸‹ä»éœ€ä¼˜åŒ–ï¼š</p>
<ul>
<li>å‡å°‘ä»£ç†å¯¹è±¡åˆ›å»ºï¼šSpringå®¹å™¨ä¼šç¼“å­˜ä»£ç†å¯¹è±¡ï¼Œé¿å…é¢‘ç¹åˆ›å»ºï¼›</li>
<li>ä¼˜åŒ–åˆ‡å…¥ç‚¹è¡¨è¾¾å¼ï¼šé¿å…ä½¿ç”¨è¿‡äºå®½æ³›çš„è¡¨è¾¾å¼ï¼ˆå¦‚<code>execution(* *(..))</code>ï¼‰ï¼Œå‡å°‘æ–¹æ³•åŒ¹é…çš„æ€§èƒ½æ¶ˆè€—ï¼›</li>
<li>æ§åˆ¶é€šçŸ¥é€»è¾‘å¤æ‚åº¦ï¼šé€šçŸ¥ä»£ç åº”ç®€æ´é«˜æ•ˆï¼Œé¿å…åœ¨é€šçŸ¥ä¸­æ‰§è¡Œè€—æ—¶æ“ä½œï¼ˆå¦‚å¤æ‚IOã€æ•°æ®åº“æŸ¥è¯¢ï¼‰ï¼Œå¿…è¦æ—¶é€šè¿‡å¼‚æ­¥å¤„ç†ä¼˜åŒ–ã€‚</li>
</ul>
<h3 data-id="heading-50"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>6.3 æŠ€æœ¯æœ¬è´¨ä¸æœªæ¥å¯ç¤º</h3>
<p>ä»æŠ€æœ¯æœ¬è´¨æ¥çœ‹ï¼ŒSpring AOPæ˜¯â€œåŠ¨æ€ä»£ç†â€ä¸â€œä¾èµ–æ³¨å…¥â€çš„ç»“åˆäº§ç‰©â€”â€”åŠ¨æ€ä»£ç†å®ç°äº†æ–¹æ³•å¢å¼ºçš„æŠ€æœ¯èƒ½åŠ›ï¼Œä¾èµ–æ³¨å…¥åˆ™å®ç°äº†åˆ‡é¢ä¸ç›®æ ‡å¯¹è±¡çš„è§£è€¦ä¸ç®¡ç†ã€‚è¿™ç§â€œæŠ€æœ¯ç»„åˆâ€çš„æ€è·¯ï¼Œä¸ºè§£å†³å¤æ‚é—®é¢˜æä¾›äº†å…¸èŒƒã€‚</p>
<p>éšç€Springæ¡†æ¶çš„å‘å±•ï¼ŒAOPçš„å®ç°ä¹Ÿåœ¨ä¸æ–­ä¼˜åŒ–ï¼Œä½†æ ¸å¿ƒæ€æƒ³å§‹ç»ˆæœªå˜ã€‚å¯¹äºå¼€å‘è€…è€Œè¨€ï¼ŒæŒæ¡åº•å±‚åŸç†è¿œæ¯”å•çº¯ä½¿ç”¨APIæ›´é‡è¦ï¼šç†è§£åŠ¨æ€ä»£ç†çš„å­—èŠ‚ç ç”Ÿæˆé€»è¾‘ï¼Œèƒ½å¿«é€Ÿå®šä½ä»£ç†ç›¸å…³çš„å¼‚å¸¸ï¼›æ˜æ™°é€šçŸ¥çš„æ‰§è¡Œé¡ºåºï¼Œå¯é¿å…åˆ‡é¢é€»è¾‘å†²çªï¼›æŒæ¡åˆ‡å…¥ç‚¹è¡¨è¾¾å¼çš„è¯­æ³•ï¼Œèƒ½ç²¾å‡†æ§åˆ¶åˆ‡é¢ä½œç”¨èŒƒå›´ã€‚è¿™äº›èƒ½åŠ›ä¸ä»…é€‚ç”¨äºSpring AOPï¼Œæ›´èƒ½è¿ç§»åˆ°å…¶ä»–éœ€è¦â€œæ–¹æ³•å¢å¼ºâ€çš„åœºæ™¯ï¼ˆå¦‚RPCæ¡†æ¶çš„è°ƒç”¨å¢å¼ºã€åˆ†å¸ƒå¼è¿½è¸ªçš„é“¾è·¯åŸ‹ç‚¹ç­‰ï¼‰ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ä¸‰æç®¡æ¨æŒ½è¾“å‡ºç”µè·¯åˆ†æ]]></title>    <link>https://juejin.cn/post/7603721514203332617</link>    <guid>https://juejin.cn/post/7603721514203332617</guid>    <pubDate>2026-02-08T06:52:43.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7603721514203332617" data-draft-id="7603687444052082726" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ä¸‰æç®¡æ¨æŒ½è¾“å‡ºç”µè·¯åˆ†æ"/> <meta itemprop="keywords" content="åµŒå…¥å¼,åç«¯"/> <meta itemprop="datePublished" content="2026-02-08T06:52:43.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ç¨‹åºå‘˜è‰¯è®¸"/> <meta itemprop="url" content="https://juejin.cn/user/3913917128246942"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ä¸‰æç®¡æ¨æŒ½è¾“å‡ºç”µè·¯åˆ†æ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3913917128246942/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ç¨‹åºå‘˜è‰¯è®¸
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-08T06:52:43.000Z" title="Sun Feb 08 2026 06:52:43 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»13åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">ä¸‰æç®¡æ¨æŒ½è¾“å‡ºç”µè·¯åˆ†æ</h2>
<p>å¤§å®¶å¥½ï¼Œæˆ‘æ˜¯è‰¯è®¸ã€‚</p>
<p>åœ¨åµŒå…¥å¼ç³»ç»Ÿå¼€å‘ä¸­ï¼Œæˆ‘ä»¬ç»å¸¸éœ€è¦é©±åŠ¨å„ç§è´Ÿè½½ï¼Œæ¯”å¦‚ LEDã€ç»§ç”µå™¨ã€ç”µæœºç­‰ã€‚</p>
<p>è¿™æ—¶å€™ï¼Œå•çº¯ä¾é  MCU çš„ IO å£å¾€å¾€æ— æ³•æä¾›è¶³å¤Ÿçš„é©±åŠ¨èƒ½åŠ›ã€‚</p>
<p>æ¨æŒ½è¾“å‡ºç”µè·¯ä½œä¸ºä¸€ç§ç»å…¸çš„åŠŸç‡æ”¾å¤§ç”µè·¯ï¼Œåœ¨å®é™…é¡¹ç›®ä¸­åº”ç”¨éå¸¸å¹¿æ³›ã€‚</p>
<p>ä»Šå¤©æˆ‘ä»¬å°±æ¥æ·±å…¥åˆ†æä¸€ä¸‹ä¸‰æç®¡æ¨æŒ½è¾“å‡ºç”µè·¯çš„å·¥ä½œåŸç†å’Œå®é™…åº”ç”¨ã€‚</p>
<h3 data-id="heading-1">1. æ¨æŒ½ç”µè·¯çš„åŸºæœ¬æ¦‚å¿µ</h3>
<h4 data-id="heading-2">1.1 ä»€ä¹ˆæ˜¯æ¨æŒ½ç”µè·¯</h4>
<p>æ¨æŒ½ç”µè·¯æ˜¯ä¸€ç§ç”±ä¸¤ä¸ªä¸‰æç®¡ç»„æˆçš„äº’è¡¥è¾“å‡ºç”µè·¯ã€‚</p>
<p>è¿™ä¸¤ä¸ªä¸‰æç®¡ä¸€ä¸ªè´Ÿè´£"æ¨"ï¼Œå³å‘è´Ÿè½½æä¾›ç”µæµï¼›å¦ä¸€ä¸ªè´Ÿè´£"æŒ½"ï¼Œå³ä»è´Ÿè½½å¸æ”¶ç”µæµã€‚</p>
<p>è¿™ç§ç»“æ„ä½¿å¾—ç”µè·¯èƒ½å¤Ÿåœ¨æ­£è´Ÿä¸¤ä¸ªæ–¹å‘ä¸Šéƒ½æä¾›å¼ºå¤§çš„é©±åŠ¨èƒ½åŠ›ã€‚</p>
<p>ä¸æ™®é€šçš„å•ç®¡æ”¾å¤§ç”µè·¯ç›¸æ¯”ï¼Œæ¨æŒ½ç”µè·¯æœ€å¤§çš„ä¼˜åŠ¿åœ¨äºè¾“å‡ºé˜»æŠ—ä½ã€é©±åŠ¨èƒ½åŠ›å¼ºã€æ•ˆç‡é«˜ã€‚</p>
<p>åœ¨æˆ‘ä¹‹å‰åšæ±½è½¦ç”µå­é¡¹ç›®æ—¶ï¼Œå°±ç»å¸¸ä½¿ç”¨æ¨æŒ½ç”µè·¯æ¥é©±åŠ¨è½¦è½½ç»§ç”µå™¨å’ŒæŒ‡ç¤ºç¯ï¼Œæ•ˆæœéå¸¸å¥½ã€‚</p>
<h4 data-id="heading-3">1.2 æ¨æŒ½ç”µè·¯çš„åˆ†ç±»</h4>
<p>æ¨æŒ½ç”µè·¯ä¸»è¦åˆ†ä¸ºä¸¤ç§ç±»å‹ï¼š</p>
<p><strong>äº’è¡¥å‹æ¨æŒ½ç”µè·¯</strong>ï¼šä½¿ç”¨ NPN å’Œ PNP ä¸¤ç§ä¸åŒç±»å‹çš„ä¸‰æç®¡ï¼Œè¿™æ˜¯æœ€å¸¸è§çš„æ¨æŒ½ç”µè·¯å½¢å¼ã€‚</p>
<p>å½“è¾“å…¥é«˜ç”µå¹³æ—¶ï¼ŒNPN ç®¡å¯¼é€šï¼ŒPNP ç®¡æˆªæ­¢ï¼›å½“è¾“å…¥ä½ç”µå¹³æ—¶ï¼ŒPNP ç®¡å¯¼é€šï¼ŒNPN ç®¡æˆªæ­¢ã€‚</p>
<p><strong>åŒç±»å‹æ¨æŒ½ç”µè·¯</strong>ï¼šä½¿ç”¨ä¸¤ä¸ªç›¸åŒç±»å‹çš„ä¸‰æç®¡ï¼Œé€šè¿‡å˜å‹å™¨æˆ–å…¶ä»–æ–¹å¼å®ç°äº’è¡¥å·¥ä½œã€‚</p>
<p>è¿™ç§ç”µè·¯åœ¨éŸ³é¢‘åŠŸæ”¾ä¸­æ¯”è¾ƒå¸¸è§ã€‚</p>
<h3 data-id="heading-4">2. äº’è¡¥å‹æ¨æŒ½ç”µè·¯çš„å·¥ä½œåŸç†</h3>
<h4 data-id="heading-5">2.1 ç”µè·¯ç»“æ„åˆ†æ</h4>
<p>äº’è¡¥å‹æ¨æŒ½ç”µè·¯çš„å…¸å‹ç»“æ„å¦‚ä¸‹ï¼šè¾“å…¥ä¿¡å·åŒæ—¶é€åˆ° NPN ç®¡å’Œ PNP ç®¡çš„åŸºæï¼ŒNPN ç®¡çš„å‘å°„æå’Œ PNP ç®¡çš„å‘å°„æè¿æ¥åœ¨ä¸€èµ·ä½œä¸ºè¾“å‡ºç«¯ï¼ŒNPN ç®¡çš„é›†ç”µææ¥æ­£ç”µæºï¼ŒPNP ç®¡çš„é›†ç”µææ¥åœ°ã€‚</p>
<p>è®©æˆ‘ç»™å¤§å®¶ç”»ä¸ªç®€å•çš„åŸç†å›¾æ¥è¯´æ˜ã€‚</p>
<p>å‡è®¾æˆ‘ä»¬ä½¿ç”¨ STM32 çš„ GPIO å£æ¥æ§åˆ¶ä¸€ä¸ªæ¨æŒ½ç”µè·¯é©±åŠ¨ LEDï¼š</p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-comment">// STM32 HALåº“é…ç½®GPIOä¸ºæ¨æŒ½è¾“å‡º</span>
void <span class="hljs-built_in">MX_GPIO_Init</span>(void)
{
    GPIO_InitTypeDef GPIO_InitStruct = {<span class="hljs-number">0</span>};
    
    <span class="hljs-comment">// ä½¿èƒ½GPIOAæ—¶é’Ÿ</span>
    <span class="hljs-built_in">__HAL_RCC_GPIOA_CLK_ENABLE</span>();
    
    <span class="hljs-comment">// é…ç½®PA5ä¸ºæ¨æŒ½è¾“å‡º</span>
    GPIO_InitStruct<span class="hljs-selector-class">.Pin</span> = GPIO_PIN_5;
    GPIO_InitStruct<span class="hljs-selector-class">.Mode</span> = GPIO_MODE_OUTPUT_PP;  <span class="hljs-comment">// æ¨æŒ½è¾“å‡ºæ¨¡å¼</span>
    GPIO_InitStruct<span class="hljs-selector-class">.Pull</span> = GPIO_NOPULL;
    GPIO_InitStruct<span class="hljs-selector-class">.Speed</span> = GPIO_SPEED_FREQ_LOW;
    <span class="hljs-built_in">HAL_GPIO_Init</span>(GPIOA, &amp;GPIO_InitStruct);
}
â€‹
<span class="hljs-comment">// æ§åˆ¶è¾“å‡º</span>
void <span class="hljs-built_in">LED_Control</span>(uint8_t state)
{
    <span class="hljs-built_in">if</span>(state) {
        <span class="hljs-built_in">HAL_GPIO_WritePin</span>(GPIOA, GPIO_PIN_5, GPIO_PIN_SET);   <span class="hljs-comment">// è¾“å‡ºé«˜ç”µå¹³</span>
    } else {
        <span class="hljs-built_in">HAL_GPIO_WritePin</span>(GPIOA, GPIO_PIN_5, GPIO_PIN_RESET); <span class="hljs-comment">// è¾“å‡ºä½ç”µå¹³</span>
    }
}
</code></pre>
<h4 data-id="heading-6">2.2 å·¥ä½œè¿‡ç¨‹è¯¦è§£</h4>
<p>å½“è¾“å…¥ä¿¡å·ä¸ºé«˜ç”µå¹³æ—¶ï¼ŒNPN ç®¡çš„åŸºæç”µå‹å‡é«˜ï¼ŒåŸºæ-å‘å°„æä¹‹é—´å½¢æˆæ­£å‘åç½®ï¼ŒNPN ç®¡å¯¼é€šã€‚</p>
<p>æ­¤æ—¶ï¼Œç”µæµä»æ­£ç”µæºç»è¿‡ NPN ç®¡çš„é›†ç”µæ-å‘å°„ææµå‘è´Ÿè½½ï¼Œè´Ÿè½½ä¸¤ç«¯è·å¾—æ¥è¿‘ç”µæºç”µå‹çš„é«˜ç”µå¹³ã€‚</p>
<p>åŒæ—¶ï¼ŒPNP ç®¡çš„åŸºæç›¸å¯¹äºå‘å°„æä¸ºæ­£ç”µå‹ï¼ŒåŸºæ-å‘å°„æä¹‹é—´åå‘åç½®ï¼ŒPNP ç®¡æˆªæ­¢ã€‚</p>
<p>å½“è¾“å…¥ä¿¡å·ä¸ºä½ç”µå¹³æ—¶ï¼Œæƒ…å†µæ­£å¥½ç›¸åã€‚</p>
<p>NPN ç®¡çš„åŸºæç”µå‹é™ä½ï¼ŒåŸºæ-å‘å°„æä¹‹é—´ç”µå‹ä¸è¶³ä»¥ä½¿å…¶å¯¼é€šï¼ŒNPN ç®¡æˆªæ­¢ã€‚</p>
<p>è€Œ PNP ç®¡çš„åŸºæç›¸å¯¹äºå‘å°„æå˜ä¸ºè´Ÿç”µå‹ï¼ŒåŸºæ-å‘å°„æä¹‹é—´æ­£å‘åç½®ï¼ŒPNP ç®¡å¯¼é€šã€‚</p>
<p>æ­¤æ—¶ï¼Œç”µæµä»è´Ÿè½½ç»è¿‡ PNP ç®¡çš„å‘å°„æ-é›†ç”µææµå‘åœ°ï¼Œè´Ÿè½½ä¸¤ç«¯è·å¾—æ¥è¿‘åœ°ç”µä½çš„ä½ç”µå¹³ã€‚</p>
<p>è¿™ç§å·¥ä½œæ–¹å¼çš„å·§å¦™ä¹‹å¤„åœ¨äºï¼Œæ— è®ºè¾“å‡ºé«˜ç”µå¹³è¿˜æ˜¯ä½ç”µå¹³ï¼Œéƒ½æœ‰ä¸€ä¸ªä¸‰æç®¡å¤„äºå¯¼é€šçŠ¶æ€ï¼Œæä¾›ä½é˜»æŠ—çš„ç”µæµé€šè·¯ã€‚</p>
<p>è¿™å°±æ˜¯æ¨æŒ½ç”µè·¯é©±åŠ¨èƒ½åŠ›å¼ºçš„æ ¹æœ¬åŸå› ã€‚</p>
<h4 data-id="heading-7">2.3 å…³é”®å‚æ•°è®¡ç®—</h4>
<p>åœ¨è®¾è®¡æ¨æŒ½ç”µè·¯æ—¶ï¼Œæˆ‘ä»¬éœ€è¦è®¡ç®—å‡ ä¸ªå…³é”®å‚æ•°ã€‚</p>
<p>é¦–å…ˆæ˜¯åŸºæé™æµç”µé˜»çš„é€‰æ‹©ã€‚</p>
<p>å‡è®¾æˆ‘ä»¬ä½¿ç”¨çš„ä¸‰æç®¡æ”¾å¤§å€æ•° <em>Î²</em>=100ï¼Œè´Ÿè½½ç”µæµ <em>IL</em>=100<em>mA</em>ï¼Œé‚£ä¹ˆåŸºæç”µæµéœ€è¦ï¼š</p>
<p><em>IB</em>=<em>IB/Î²=100</em>mA/100=1<em>m</em>A</p>
<p>å¦‚æœè¾“å…¥ç”µå‹ä¸º 5Vï¼Œä¸‰æç®¡åŸºæ-å‘å°„æå‹é™ VBE = 0.7Vï¼Œåˆ™åŸºæé™æµç”µé˜»ä¸ºï¼š</p>
<p>RB = (VIN - VBE)/IB= (5V - 0.7V)/1mA= 4.3<em>k</em>Î©</p>
<p>å®é™…åº”ç”¨ä¸­ï¼Œæˆ‘ä»¬é€šå¸¸é€‰æ‹©æ ‡å‡†é˜»å€¼ 4.7<em>k</em>Î© æˆ– 3.9<em>k</em>Î©</p>
<h3 data-id="heading-8">3. å®é™…åº”ç”¨ç”µè·¯è®¾è®¡</h3>
<h4 data-id="heading-9">3.1 LED é©±åŠ¨ç”µè·¯</h4>
<p>åœ¨åµŒå…¥å¼é¡¹ç›®ä¸­ï¼Œæˆ‘ä»¬ç»å¸¸éœ€è¦é©±åŠ¨å¤§åŠŸç‡ LEDã€‚</p>
<p>ä¸‹é¢æ˜¯ä¸€ä¸ªä½¿ç”¨æ¨æŒ½ç”µè·¯é©±åŠ¨ LED çš„å®Œæ•´ç¤ºä¾‹ï¼š</p>
<pre><code class="hljs language-ini" lang="ini">// ç¡¬ä»¶è¿æ¥ï¼š
// STM32 PA5 -&gt; R1(4.7k) -&gt; Q1(NPN)åŸºæ
// STM32 PA5 -&gt; R2(4.7k) -&gt; Q2(PNP)åŸºæ
// Q1é›†ç”µæ -&gt; VCC(12V)
// Q2é›†ç”µæ -&gt; GND
// Q1å‘å°„æ = Q2å‘å°„æ -&gt; LEDæ­£æ
// LEDè´Ÿæ -&gt; R3(é™æµç”µé˜») -&gt; GND
â€‹
<span class="hljs-comment">#define LED_PIN GPIO_PIN_5</span>
<span class="hljs-comment">#define LED_PORT GPIOA</span>
â€‹
// åˆå§‹åŒ–LEDé©±åŠ¨
void LED_Driver_Init(void)
{
    GPIO_InitTypeDef <span class="hljs-attr">GPIO_InitStruct</span> = {<span class="hljs-number">0</span>}<span class="hljs-comment">;</span>
    
    __HAL_RCC_GPIOA_CLK_ENABLE()<span class="hljs-comment">;</span>
    
    <span class="hljs-attr">GPIO_InitStruct.Pin</span> = LED_PIN<span class="hljs-comment">;</span>
    <span class="hljs-attr">GPIO_InitStruct.Mode</span> = GPIO_MODE_OUTPUT_PP<span class="hljs-comment">;</span>
    <span class="hljs-attr">GPIO_InitStruct.Pull</span> = GPIO_NOPULL<span class="hljs-comment">;</span>
    <span class="hljs-attr">GPIO_InitStruct.Speed</span> = GPIO_SPEED_FREQ_MEDIUM<span class="hljs-comment">;</span>
    HAL_GPIO_Init(LED_PORT, &amp;GPIO_InitStruct)<span class="hljs-comment">;</span>
    
    // åˆå§‹çŠ¶æ€è®¾ä¸ºä½ç”µå¹³
    HAL_GPIO_WritePin(LED_PORT, LED_PIN, GPIO_PIN_RESET)<span class="hljs-comment">;</span>
}
â€‹
// PWMè°ƒå…‰æ§åˆ¶
void LED_PWM_Control(uint8_t brightness)
{
    // brightness: 0-100ï¼Œè¡¨ç¤ºäº®åº¦ç™¾åˆ†æ¯”
    uint16_t <span class="hljs-attr">period</span> = <span class="hljs-number">1000</span><span class="hljs-comment">;  // PWMå‘¨æœŸï¼Œå•ä½us</span>
    uint16_t <span class="hljs-attr">pulse_width</span> = (period * brightness) / <span class="hljs-number">100</span><span class="hljs-comment">;</span>
    
    for(uint16_t <span class="hljs-attr">i</span> = <span class="hljs-number">0</span><span class="hljs-comment">; i &lt; period; i++) {</span>
        if(i &lt; pulse_width) {
            HAL_GPIO_WritePin(LED_PORT, LED_PIN, GPIO_PIN_SET)<span class="hljs-comment">;</span>
        } else {
            HAL_GPIO_WritePin(LED_PORT, LED_PIN, GPIO_PIN_RESET)<span class="hljs-comment">;</span>
        }
        // å»¶æ—¶1usï¼ˆå®é™…é¡¹ç›®ä¸­åº”ä½¿ç”¨ç¡¬ä»¶PWMï¼‰
        delay_us(1)<span class="hljs-comment">;</span>
    }
}
â€‹
// ä½¿ç”¨ç¡¬ä»¶PWMçš„æ›´ä¼˜æ–¹æ¡ˆ
void LED_Hardware_PWM_Init(void)
{
    TIM_HandleTypeDef htim2<span class="hljs-comment">;</span>
    TIM_OC_InitTypeDef <span class="hljs-attr">sConfigOC</span> = {<span class="hljs-number">0</span>}<span class="hljs-comment">;</span>
    
    // é…ç½®å®šæ—¶å™¨2
    <span class="hljs-attr">htim2.Instance</span> = TIM2<span class="hljs-comment">;</span>
    <span class="hljs-attr">htim2.Init.Prescaler</span> = <span class="hljs-number">72</span>-<span class="hljs-number">1</span><span class="hljs-comment">;  // å‡è®¾ç³»ç»Ÿæ—¶é’Ÿ72MHz</span>
    <span class="hljs-attr">htim2.Init.CounterMode</span> = TIM_COUNTERMODE_UP<span class="hljs-comment">;</span>
    <span class="hljs-attr">htim2.Init.Period</span> = <span class="hljs-number">1000</span>-<span class="hljs-number">1</span><span class="hljs-comment">;   // PWMé¢‘ç‡1kHz</span>
    <span class="hljs-attr">htim2.Init.ClockDivision</span> = TIM_CLOCKDIVISION_DIV1<span class="hljs-comment">;</span>
    HAL_TIM_PWM_Init(&amp;htim2)<span class="hljs-comment">;</span>
    
    // é…ç½®PWMé€šé“
    <span class="hljs-attr">sConfigOC.OCMode</span> = TIM_OCMODE_PWM1<span class="hljs-comment">;</span>
    <span class="hljs-attr">sConfigOC.Pulse</span> = <span class="hljs-number">0</span><span class="hljs-comment">;</span>
    <span class="hljs-attr">sConfigOC.OCPolarity</span> = TIM_OCPOLARITY_HIGH<span class="hljs-comment">;</span>
    <span class="hljs-attr">sConfigOC.OCFastMode</span> = TIM_OCFAST_DISABLE<span class="hljs-comment">;</span>
    HAL_TIM_PWM_ConfigChannel(&amp;htim2, &amp;sConfigOC, TIM_CHANNEL_1)<span class="hljs-comment">;</span>
    
    // å¯åŠ¨PWM
    HAL_TIM_PWM_Start(&amp;htim2, TIM_CHANNEL_1)<span class="hljs-comment">;</span>
}
â€‹
void LED_Set_Brightness(uint8_t brightness)
{
    // è®¾ç½®å ç©ºæ¯”
    __HAL_TIM_SET_COMPARE(&amp;htim2, TIM_CHANNEL_1, brightness * 10)<span class="hljs-comment">;</span>
}
</code></pre>
<h4 data-id="heading-10">3.2 ç»§ç”µå™¨é©±åŠ¨ç”µè·¯</h4>
<p>åœ¨å·¥ä¸šæ§åˆ¶å’Œæ±½è½¦ç”µå­ä¸­ï¼Œç»§ç”µå™¨æ˜¯å¸¸ç”¨çš„å¼€å…³å™¨ä»¶ã€‚</p>
<p>æ¨æŒ½ç”µè·¯å¯ä»¥æä¾›è¶³å¤Ÿçš„é©±åŠ¨ç”µæµæ¥å¯é åœ°æ§åˆ¶ç»§ç”µå™¨ã€‚</p>
<p>ä¸‹é¢æ˜¯ä¸€ä¸ªç»§ç”µå™¨é©±åŠ¨çš„å®ç°ï¼š</p>
<pre><code class="hljs language-ini" lang="ini">// ç»§ç”µå™¨é©±åŠ¨ç”µè·¯
// ç¡¬ä»¶è¿æ¥ï¼š
// STM32 PB0 -&gt; æ¨æŒ½é©±åŠ¨ç”µè·¯ -&gt; ç»§ç”µå™¨çº¿åœˆ
// ç»§ç”µå™¨çº¿åœˆå¹¶è”ç»­æµäºŒæç®¡
â€‹
<span class="hljs-comment">#define RELAY_PIN GPIO_PIN_0</span>
<span class="hljs-comment">#define RELAY_PORT GPIOB</span>
â€‹
typedef struct {
    GPIO_TypeDef* port<span class="hljs-comment">;</span>
    uint16_t pin<span class="hljs-comment">;</span>
    uint8_t state<span class="hljs-comment">;</span>
    uint32_t last_toggle_time<span class="hljs-comment">;</span>
} Relay_TypeDef<span class="hljs-comment">;</span>
â€‹
Relay_TypeDef <span class="hljs-attr">relay1</span> = {
    .<span class="hljs-attr">port</span> = RELAY_PORT,
    .<span class="hljs-attr">pin</span> = RELAY_PIN,
    .<span class="hljs-attr">state</span> = <span class="hljs-number">0</span>,
    .<span class="hljs-attr">last_toggle_time</span> = <span class="hljs-number">0</span>
}<span class="hljs-comment">;</span>
â€‹
// åˆå§‹åŒ–ç»§ç”µå™¨
void Relay_Init(Relay_TypeDef* relay)
{
    GPIO_InitTypeDef <span class="hljs-attr">GPIO_InitStruct</span> = {<span class="hljs-number">0</span>}<span class="hljs-comment">;</span>
    
    // ä½¿èƒ½æ—¶é’Ÿ
    if(relay-&gt;<span class="hljs-attr">port</span> == GPIOB) {
        __HAL_RCC_GPIOB_CLK_ENABLE()<span class="hljs-comment">;</span>
    }
    
    <span class="hljs-attr">GPIO_InitStruct.Pin</span> = relay-&gt;pin<span class="hljs-comment">;</span>
    <span class="hljs-attr">GPIO_InitStruct.Mode</span> = GPIO_MODE_OUTPUT_PP<span class="hljs-comment">;</span>
    <span class="hljs-attr">GPIO_InitStruct.Pull</span> = GPIO_NOPULL<span class="hljs-comment">;</span>
    <span class="hljs-attr">GPIO_InitStruct.Speed</span> = GPIO_SPEED_FREQ_LOW<span class="hljs-comment">;</span>
    HAL_GPIO_Init(relay-&gt;port, &amp;GPIO_InitStruct)<span class="hljs-comment">;</span>
    
    // åˆå§‹çŠ¶æ€å…³é—­
    HAL_GPIO_WritePin(relay-&gt;port, relay-&gt;pin, GPIO_PIN_RESET)<span class="hljs-comment">;</span>
    relay-&gt;<span class="hljs-attr">state</span> = <span class="hljs-number">0</span><span class="hljs-comment">;</span>
}
â€‹
// ç»§ç”µå™¨æ§åˆ¶ï¼ˆå¸¦é˜²æŠ–åŠ¨ï¼‰
void Relay_Control(Relay_TypeDef* relay, uint8_t state)
{
    uint32_t <span class="hljs-attr">current_time</span> = HAL_GetTick()<span class="hljs-comment">;</span>
    
    // é˜²æ­¢é¢‘ç¹åˆ‡æ¢ï¼Œè‡³å°‘é—´éš”100ms
    if(current_time - relay-&gt;last_toggle_time &lt; 100) {
        return<span class="hljs-comment">;</span>
    }
    
    if(state &amp;&amp; !relay-&gt;state) {
        // æ‰“å¼€ç»§ç”µå™¨
        HAL_GPIO_WritePin(relay-&gt;port, relay-&gt;pin, GPIO_PIN_SET)<span class="hljs-comment">;</span>
        relay-&gt;<span class="hljs-attr">state</span> = <span class="hljs-number">1</span><span class="hljs-comment">;</span>
        relay-&gt;<span class="hljs-attr">last_toggle_time</span> = current_time<span class="hljs-comment">;</span>
    } else if(!state &amp;&amp; relay-&gt;state) {
        // å…³é—­ç»§ç”µå™¨
        HAL_GPIO_WritePin(relay-&gt;port, relay-&gt;pin, GPIO_PIN_RESET)<span class="hljs-comment">;</span>
        relay-&gt;<span class="hljs-attr">state</span> = <span class="hljs-number">0</span><span class="hljs-comment">;</span>
        relay-&gt;<span class="hljs-attr">last_toggle_time</span> = current_time<span class="hljs-comment">;</span>
    }
}
â€‹
// ç»§ç”µå™¨çŠ¶æ€è¯»å–
uint8_t Relay_Get_State(Relay_TypeDef* relay)
{
    return relay-&gt;state<span class="hljs-comment">;</span>
}
â€‹
// ç»§ç”µå™¨ç¿»è½¬
void Relay_Toggle(Relay_TypeDef* relay)
{
    Relay_Control(relay, !relay-&gt;state)<span class="hljs-comment">;</span>
}
</code></pre>
<h4 data-id="heading-11">3.3 ç”µæœºé©±åŠ¨ç”µè·¯</h4>
<p>æ¨æŒ½ç”µè·¯ä¹Ÿå¸¸ç”¨äºå°åŠŸç‡ç›´æµç”µæœºçš„é©±åŠ¨ã€‚</p>
<p>é€šè¿‡ PWM æ§åˆ¶å¯ä»¥å®ç°ç”µæœºè°ƒé€Ÿï¼š</p>
<pre><code class="hljs language-ini" lang="ini">// ç”µæœºé©±åŠ¨
<span class="hljs-comment">#define MOTOR_PIN GPIO_PIN_6</span>
<span class="hljs-comment">#define MOTOR_PORT GPIOA</span>
<span class="hljs-comment">#define MOTOR_TIMER TIM3</span>
<span class="hljs-comment">#define MOTOR_CHANNEL TIM_CHANNEL_1</span>
â€‹
typedef struct {
    TIM_HandleTypeDef* htim<span class="hljs-comment">;</span>
    uint32_t channel<span class="hljs-comment">;</span>
    uint8_t speed<span class="hljs-comment">;      // 0-100</span>
    uint8_t direction<span class="hljs-comment">;  // 0:æ­£è½¬, 1:åè½¬</span>
} Motor_TypeDef<span class="hljs-comment">;</span>
â€‹
Motor_TypeDef motor1<span class="hljs-comment">;</span>
â€‹
// ç”µæœºåˆå§‹åŒ–
void Motor_Init(Motor_TypeDef* motor, TIM_HandleTypeDef* htim, uint32_t channel)
{
    motor-&gt;<span class="hljs-attr">htim</span> = htim<span class="hljs-comment">;</span>
    motor-&gt;<span class="hljs-attr">channel</span> = channel<span class="hljs-comment">;</span>
    motor-&gt;<span class="hljs-attr">speed</span> = <span class="hljs-number">0</span><span class="hljs-comment">;</span>
    motor-&gt;<span class="hljs-attr">direction</span> = <span class="hljs-number">0</span><span class="hljs-comment">;</span>
    
    // å¯åŠ¨PWM
    HAL_TIM_PWM_Start(motor-&gt;htim, motor-&gt;channel)<span class="hljs-comment">;</span>
}
â€‹
// è®¾ç½®ç”µæœºé€Ÿåº¦
void Motor_Set_Speed(Motor_TypeDef* motor, uint8_t speed)
{
    if(speed &gt; 100) <span class="hljs-attr">speed</span> = <span class="hljs-number">100</span><span class="hljs-comment">;</span>
    
    motor-&gt;<span class="hljs-attr">speed</span> = speed<span class="hljs-comment">;</span>
    
    // è®¡ç®—PWMå ç©ºæ¯”
    uint32_t <span class="hljs-attr">pulse</span> = (motor-&gt;htim-&gt;Init.Period * speed) / <span class="hljs-number">100</span><span class="hljs-comment">;</span>
    __HAL_TIM_SET_COMPARE(motor-&gt;htim, motor-&gt;channel, pulse)<span class="hljs-comment">;</span>
}
â€‹
// è®¾ç½®ç”µæœºæ–¹å‘
void Motor_Set_Direction(Motor_TypeDef* motor, uint8_t direction)
{
    motor-&gt;<span class="hljs-attr">direction</span> = direction<span class="hljs-comment">;</span>
    // è¿™é‡Œéœ€è¦é…åˆHæ¡¥ç”µè·¯æ¥å®ç°æ–¹å‘æ§åˆ¶
}
â€‹
// ç”µæœºå¯åŠ¨
void Motor_Start(Motor_TypeDef* motor, uint8_t speed, uint8_t direction)
{
    Motor_Set_Direction(motor, direction)<span class="hljs-comment">;</span>
    Motor_Set_Speed(motor, speed)<span class="hljs-comment">;</span>
}
â€‹
// ç”µæœºåœæ­¢
void Motor_Stop(Motor_TypeDef* motor)
{
    Motor_Set_Speed(motor, 0)<span class="hljs-comment">;</span>
}
â€‹
// ç”µæœºåŠ é€Ÿ
void Motor_Accelerate(Motor_TypeDef* motor, uint8_t target_speed, uint16_t time_ms)
{
    uint8_t <span class="hljs-attr">current_speed</span> = motor-&gt;speed<span class="hljs-comment">;</span>
    uint16_t <span class="hljs-attr">steps</span> = time_ms / <span class="hljs-number">10</span><span class="hljs-comment">;  // æ¯10msè°ƒæ•´ä¸€æ¬¡</span>
    int16_t <span class="hljs-attr">speed_increment</span> = (target_speed - current_speed) / steps<span class="hljs-comment">;</span>
    
    for(uint16_t <span class="hljs-attr">i</span> = <span class="hljs-number">0</span><span class="hljs-comment">; i &lt; steps; i++) {</span>
        current_speed += speed_increment<span class="hljs-comment">;</span>
        Motor_Set_Speed(motor, current_speed)<span class="hljs-comment">;</span>
        HAL_Delay(10)<span class="hljs-comment">;</span>
    }
    
    Motor_Set_Speed(motor, target_speed)<span class="hljs-comment">;</span>
}
</code></pre>
<h3 data-id="heading-12">4. æ¨æŒ½ç”µè·¯çš„ä¼˜åŒ–è®¾è®¡</h3>
<h4 data-id="heading-13">4.1 äº¤è¶Šå¤±çœŸçš„æ¶ˆé™¤</h4>
<p>åœ¨äº’è¡¥æ¨æŒ½ç”µè·¯ä¸­ï¼Œå­˜åœ¨ä¸€ä¸ªå¸¸è§é—®é¢˜å«åšäº¤è¶Šå¤±çœŸã€‚</p>
<p>å½“è¾“å…¥ä¿¡å·åœ¨é›¶ç‚¹é™„è¿‘æ—¶ï¼Œä¸¤ä¸ªä¸‰æç®¡éƒ½å¤„äºä¸´ç•Œå¯¼é€šçŠ¶æ€ï¼Œè¾“å‡ºä¼šå‡ºç°éçº¿æ€§å¤±çœŸã€‚</p>
<p>è§£å†³æ–¹æ³•æ˜¯åœ¨ä¸¤ä¸ªä¸‰æç®¡çš„åŸºæä¹‹é—´åŠ å…¥åç½®ç”µè·¯ï¼Œä½¿å®ƒä»¬å§‹ç»ˆå¤„äºå¾®å¯¼é€šçŠ¶æ€ã€‚</p>
<p>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸¤ä¸ªäºŒæç®¡ä¸²è”æ¥æä¾›åç½®ç”µå‹ï¼š</p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-comment">// åœ¨å®é™…ç”µè·¯ä¸­ï¼Œæˆ‘ä»¬éœ€è¦åœ¨åŸºæç”µè·¯ä¸­åŠ å…¥åç½®</span>
<span class="hljs-comment">// è¿™é‡Œé€šè¿‡è½¯ä»¶æ–¹å¼æ¨¡æ‹Ÿåç½®æ•ˆæœ</span>
â€‹
<span class="hljs-selector-id">#define</span> BIAS_VOLTAGE <span class="hljs-number">0.6</span>  <span class="hljs-comment">// åç½®ç”µå‹ï¼Œå•ä½V</span>
â€‹
<span class="hljs-comment">// å¸¦åç½®çš„è¾“å‡ºæ§åˆ¶</span>
void <span class="hljs-built_in">Biased_Output_Control</span>(uint8_t level)
{
    <span class="hljs-comment">// åœ¨å®é™…ç¡¬ä»¶ç”µè·¯ä¸­å®ç°åç½®</span>
    <span class="hljs-comment">// è¿™é‡Œä»…ä½œç¤ºæ„</span>
    <span class="hljs-built_in">if</span>(level &gt; <span class="hljs-number">128</span>) {
        <span class="hljs-comment">// è¾“å‡ºé«˜ç”µå¹³ï¼Œè€ƒè™‘åç½®</span>
        <span class="hljs-built_in">HAL_GPIO_WritePin</span>(GPIOA, GPIO_PIN_5, GPIO_PIN_SET);
    } else {
        <span class="hljs-comment">// è¾“å‡ºä½ç”µå¹³ï¼Œè€ƒè™‘åç½®</span>
        <span class="hljs-built_in">HAL_GPIO_WritePin</span>(GPIOA, GPIO_PIN_5, GPIO_PIN_RESET);
    }
}
</code></pre>
<h4 data-id="heading-14">4.2 è¿‡æµä¿æŠ¤è®¾è®¡</h4>
<p>åœ¨é©±åŠ¨å¤§åŠŸç‡è´Ÿè½½æ—¶ï¼Œè¿‡æµä¿æŠ¤æ˜¯å¿…ä¸å¯å°‘çš„ã€‚</p>
<p>æˆ‘ä»¬å¯ä»¥åœ¨ç”µè·¯ä¸­ä¸²è”ä¸€ä¸ªå°é˜»å€¼çš„é‡‡æ ·ç”µé˜»ï¼Œé€šè¿‡ ADC é‡‡é›†ç”µå‹æ¥ç›‘æµ‹ç”µæµï¼š</p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-comment">// è¿‡æµä¿æŠ¤</span>
<span class="hljs-selector-id">#define</span> CURRENT_SENSE_PIN GPIO_PIN_0
<span class="hljs-selector-id">#define</span> CURRENT_SENSE_PORT GPIOA
<span class="hljs-selector-id">#define</span> MAX_CURRENT_MA <span class="hljs-number">500</span>  <span class="hljs-comment">// æœ€å¤§ç”µæµ500mA</span>
<span class="hljs-selector-id">#define</span> SENSE_RESISTOR <span class="hljs-number">0.1</span>  <span class="hljs-comment">// é‡‡æ ·ç”µé˜»0.1æ¬§å§†</span>
â€‹
typedef struct {
    ADC_HandleTypeDef* hadc;
    uint32_t channel;
    uint16_t max_current;
    uint8_t protection_enabled;
} Current_Protection_TypeDef;
â€‹
Current_Protection_TypeDef current_protection;
â€‹
<span class="hljs-comment">// åˆå§‹åŒ–è¿‡æµä¿æŠ¤</span>
void <span class="hljs-built_in">Current_Protection_Init</span>(Current_Protection_TypeDef* cp, ADC_HandleTypeDef* hadc, uint32_t channel)
{
    cp-&gt;hadc = hadc;
    cp-&gt;channel = channel;
    cp-&gt;max_current = MAX_CURRENT_MA;
    cp-&gt;protection_enabled = <span class="hljs-number">1</span>;
}
â€‹
<span class="hljs-comment">// è¯»å–ç”µæµå€¼</span>
uint16_t <span class="hljs-built_in">Read_Current</span>(Current_Protection_TypeDef* cp)
{
    uint32_t adc_value;
    <span class="hljs-attribute">float</span> voltage, current;
    
    <span class="hljs-comment">// å¯åŠ¨ADCè½¬æ¢</span>
    <span class="hljs-built_in">HAL_ADC_Start</span>(cp-&gt;hadc);
    <span class="hljs-built_in">HAL_ADC_PollForConversion</span>(cp-&gt;hadc, <span class="hljs-number">100</span>);
    adc_value = <span class="hljs-built_in">HAL_ADC_GetValue</span>(cp-&gt;hadc);
    <span class="hljs-built_in">HAL_ADC_Stop</span>(cp-&gt;hadc);
    
    <span class="hljs-comment">// è®¡ç®—ç”µå‹å’Œç”µæµ</span>
    <span class="hljs-comment">// å‡è®¾ADCå‚è€ƒç”µå‹3.3Vï¼Œ12ä½åˆ†è¾¨ç‡</span>
    voltage = (adc_value * <span class="hljs-number">3.3</span>) / <span class="hljs-number">4096.0</span>;
    current = voltage / SENSE_RESISTOR;  <span class="hljs-comment">// å•ä½ï¼šA</span>
    
    return (uint16_t)(current * <span class="hljs-number">1000</span>);  <span class="hljs-comment">// è½¬æ¢ä¸ºmA</span>
}
â€‹
<span class="hljs-comment">// è¿‡æµæ£€æµ‹</span>
uint8_t <span class="hljs-built_in">Check_Overcurrent</span>(Current_Protection_TypeDef* cp)
{
    <span class="hljs-built_in">if</span>(!cp-&gt;protection_enabled) return <span class="hljs-number">0</span>;
    
    uint16_t current = <span class="hljs-built_in">Read_Current</span>(cp);
    
    <span class="hljs-built_in">if</span>(current &gt; cp-&gt;max_current) {
        <span class="hljs-comment">// æ£€æµ‹åˆ°è¿‡æµ</span>
        return <span class="hljs-number">1</span>;
    }
    
    return <span class="hljs-number">0</span>;
}
â€‹
<span class="hljs-comment">// å¸¦è¿‡æµä¿æŠ¤çš„è´Ÿè½½æ§åˆ¶</span>
void <span class="hljs-built_in">Protected_Load_Control</span>(uint8_t state)
{
    <span class="hljs-built_in">if</span>(state) {
        <span class="hljs-comment">// æ‰“å¼€è´Ÿè½½</span>
        <span class="hljs-built_in">HAL_GPIO_WritePin</span>(GPIOA, GPIO_PIN_5, GPIO_PIN_SET);
        
        <span class="hljs-comment">// å»¶æ—¶ä¸€å°æ®µæ—¶é—´åæ£€æµ‹ç”µæµ</span>
        <span class="hljs-built_in">HAL_Delay</span>(<span class="hljs-number">10</span>);
        
        <span class="hljs-built_in">if</span>(Check_Overcurrent(&amp;current_protection)) {
            <span class="hljs-comment">// æ£€æµ‹åˆ°è¿‡æµï¼Œç«‹å³å…³é—­è¾“å‡º</span>
            <span class="hljs-built_in">HAL_GPIO_WritePin</span>(GPIOA, GPIO_PIN_5, GPIO_PIN_RESET);
            <span class="hljs-comment">// è®°å½•é”™è¯¯æ—¥å¿—æˆ–è§¦å‘æŠ¥è­¦</span>
            <span class="hljs-built_in">Error_Handler</span>();
        }
    } else {
        <span class="hljs-comment">// å…³é—­è´Ÿè½½</span>
        <span class="hljs-built_in">HAL_GPIO_WritePin</span>(GPIOA, GPIO_PIN_5, GPIO_PIN_RESET);
    }
}
</code></pre>
<h4 data-id="heading-15">4.3 çƒ­ä¿æŠ¤è®¾è®¡</h4>
<p>å¤§åŠŸç‡æ¨æŒ½ç”µè·¯å·¥ä½œæ—¶ä¼šäº§ç”Ÿçƒ­é‡ï¼Œéœ€è¦è¿›è¡Œæ¸©åº¦ç›‘æµ‹å’Œä¿æŠ¤ï¼š</p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-comment">// æ¸©åº¦ä¿æŠ¤</span>
<span class="hljs-selector-id">#define</span> TEMP_SENSOR_PIN GPIO_PIN_1
<span class="hljs-selector-id">#define</span> MAX_TEMPERATURE <span class="hljs-number">85</span>  <span class="hljs-comment">// æœ€å¤§æ¸©åº¦85Â°C</span>
â€‹
typedef struct {
    ADC_HandleTypeDef* hadc;
    uint32_t channel;
    int16_t max_temp;
    int16_t current_temp;
    uint8_t protection_enabled;
} Thermal_Protection_TypeDef;
â€‹
Thermal_Protection_TypeDef thermal_protection;
â€‹
<span class="hljs-comment">// è¯»å–æ¸©åº¦</span>
int16_t <span class="hljs-built_in">Read_Temperature</span>(Thermal_Protection_TypeDef* tp)
{
    uint32_t adc_value;
    <span class="hljs-attribute">float</span> voltage, temperature;
    
    <span class="hljs-built_in">HAL_ADC_Start</span>(tp-&gt;hadc);
    <span class="hljs-built_in">HAL_ADC_PollForConversion</span>(tp-&gt;hadc, <span class="hljs-number">100</span>);
    adc_value = <span class="hljs-built_in">HAL_ADC_GetValue</span>(tp-&gt;hadc);
    <span class="hljs-built_in">HAL_ADC_Stop</span>(tp-&gt;hadc);
    
    <span class="hljs-comment">// å‡è®¾ä½¿ç”¨NTCçƒ­æ•ç”µé˜»ï¼Œè¿™é‡Œéœ€è¦æ ¹æ®å®é™…ä¼ æ„Ÿå™¨ç‰¹æ€§è®¡ç®—</span>
    voltage = (adc_value * <span class="hljs-number">3.3</span>) / <span class="hljs-number">4096.0</span>;
    
    <span class="hljs-comment">// ç®€åŒ–çš„æ¸©åº¦è®¡ç®—å…¬å¼ï¼ˆå®é™…åº”ä½¿ç”¨æŸ¥è¡¨æ³•æˆ–Bå€¼å…¬å¼ï¼‰</span>
    temperature = (voltage - <span class="hljs-number">0.5</span>) * <span class="hljs-number">100</span>;
    
    tp-&gt;current_temp = (int16_t)temperature;
    return tp-&gt;current_temp;
}
â€‹
<span class="hljs-comment">// æ¸©åº¦ä¿æŠ¤æ£€æµ‹</span>
uint8_t <span class="hljs-built_in">Check_Overtemperature</span>(Thermal_Protection_TypeDef* tp)
{
    <span class="hljs-built_in">if</span>(!tp-&gt;protection_enabled) return <span class="hljs-number">0</span>;
    
    int16_t temp = <span class="hljs-built_in">Read_Temperature</span>(tp);
    
    <span class="hljs-built_in">if</span>(temp &gt; tp-&gt;max_temp) {
        return <span class="hljs-number">1</span>;
    }
    
    return <span class="hljs-number">0</span>;
}
â€‹
<span class="hljs-comment">// ç»¼åˆä¿æŠ¤çš„è´Ÿè½½æ§åˆ¶</span>
void <span class="hljs-built_in">Safe_Load_Control</span>(uint8_t state)
{
    <span class="hljs-built_in">if</span>(state) {
        <span class="hljs-comment">// å…ˆæ£€æŸ¥æ¸©åº¦</span>
        <span class="hljs-built_in">if</span>(Check_Overtemperature(&amp;thermal_protection)) {
            <span class="hljs-comment">// æ¸©åº¦è¿‡é«˜ï¼Œæ‹’ç»å¼€å¯</span>
            return;
        }
        
        <span class="hljs-comment">// æ‰“å¼€è´Ÿè½½</span>
        <span class="hljs-built_in">HAL_GPIO_WritePin</span>(GPIOA, GPIO_PIN_5, GPIO_PIN_SET);
        
        <span class="hljs-comment">// æ£€æŸ¥ç”µæµ</span>
        <span class="hljs-built_in">HAL_Delay</span>(<span class="hljs-number">10</span>);
        <span class="hljs-built_in">if</span>(Check_Overcurrent(&amp;current_protection)) {
            <span class="hljs-built_in">HAL_GPIO_WritePin</span>(GPIOA, GPIO_PIN_5, GPIO_PIN_RESET);
            return;
        }
    } else {
        <span class="hljs-built_in">HAL_GPIO_WritePin</span>(GPIOA, GPIO_PIN_5, GPIO_PIN_RESET);
    }
}
</code></pre>
<h3 data-id="heading-16">5. å¸¸è§é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ</h3>
<h4 data-id="heading-17">5.1 è¾“å‡ºæ³¢å½¢æŒ¯è¡</h4>
<p>åœ¨å®é™…åº”ç”¨ä¸­ï¼Œæ¨æŒ½ç”µè·¯çš„è¾“å‡ºæœ‰æ—¶ä¼šå‡ºç°æŒ¯è¡ç°è±¡ã€‚</p>
<p>è¿™é€šå¸¸æ˜¯ç”±äºè´Ÿè½½ç”µå®¹å’Œç”µè·¯å¯„ç”Ÿç”µæ„Ÿå½¢æˆäº† LC æŒ¯è¡å›è·¯ã€‚</p>
<p>è§£å†³æ–¹æ³•æ˜¯åœ¨è¾“å‡ºç«¯å¹¶è”ä¸€ä¸ªå°ç”µå®¹ï¼ˆé€šå¸¸ 0.1<em>Î¼F</em> åˆ° 1<em>Î¼F</em>ï¼‰è¿›è¡Œæ»¤æ³¢ï¼Œæˆ–è€…ä¸²è”ä¸€ä¸ªå°ç”µé˜»è¿›è¡Œé˜»å°¼ã€‚</p>
<h4 data-id="heading-18">5.2 ä¸Šç”µç¬é—´çš„å†²å‡»ç”µæµ</h4>
<p>å½“æ¨æŒ½ç”µè·¯é©±åŠ¨å®¹æ€§è´Ÿè½½æ—¶ï¼Œä¸Šç”µç¬é—´ä¼šäº§ç”Ÿå¾ˆå¤§çš„å†²å‡»ç”µæµã€‚</p>
<p>æˆ‘ä»¬å¯ä»¥é€šè¿‡è½¯å¯åŠ¨çš„æ–¹å¼æ¥è§£å†³ï¼š</p>
<pre><code class="hljs language-ini" lang="ini">// è½¯å¯åŠ¨å‡½æ•°
void Soft_Start_Output(uint16_t ramp_time_ms)
{
    uint16_t <span class="hljs-attr">steps</span> = ramp_time_ms / <span class="hljs-number">10</span><span class="hljs-comment">;</span>
    uint16_t <span class="hljs-attr">pwm_period</span> = <span class="hljs-number">1000</span><span class="hljs-comment">;  // PWMå‘¨æœŸ</span>
    
    for(uint16_t <span class="hljs-attr">i</span> = <span class="hljs-number">0</span><span class="hljs-comment">; i &lt;= steps; i++) {</span>
        uint16_t <span class="hljs-attr">duty</span> = (pwm_period * i) / steps<span class="hljs-comment">;</span>
        
        // è®¾ç½®PWMå ç©ºæ¯”
        __HAL_TIM_SET_COMPARE(&amp;htim2, TIM_CHANNEL_1, duty)<span class="hljs-comment">;</span>
        HAL_Delay(10)<span class="hljs-comment">;</span>
    }
    
    // æœ€ç»ˆåˆ‡æ¢åˆ°ç›´æµè¾“å‡º
    HAL_GPIO_WritePin(GPIOA, GPIO_PIN_5, GPIO_PIN_SET)<span class="hljs-comment">;</span>
}
</code></pre>
<h4 data-id="heading-19">5.3 EMI é—®é¢˜</h4>
<p>æ¨æŒ½ç”µè·¯çš„å¿«é€Ÿå¼€å…³ä¼šäº§ç”Ÿç”µç£å¹²æ‰°ã€‚</p>
<p>åœ¨ PCB è®¾è®¡æ—¶ï¼Œéœ€è¦æ³¨æ„ä»¥ä¸‹å‡ ç‚¹ï¼šé©±åŠ¨ä¿¡å·èµ°çº¿è¦çŸ­ï¼Œè¿œç¦»æ•æ„Ÿç”µè·¯ï¼›åœ¨ç”µæºå¼•è„šé™„è¿‘æ”¾ç½®å»è€¦ç”µå®¹ï¼›ä½¿ç”¨åœ°å¹³é¢æ¥é™ä½å›è·¯é¢ç§¯ï¼›å¿…è¦æ—¶å¯ä»¥ä¸²è”å°ç”µé˜»æ¥é™ä½å¼€å…³é€Ÿåº¦ã€‚</p>
<h3 data-id="heading-20">6. æ€»ç»“</h3>
<p>æ¨æŒ½è¾“å‡ºç”µè·¯æ˜¯åµŒå…¥å¼ç³»ç»Ÿä¸­éå¸¸å®ç”¨çš„é©±åŠ¨ç”µè·¯ã€‚</p>
<p>å®ƒå…·æœ‰é©±åŠ¨èƒ½åŠ›å¼ºã€æ•ˆç‡é«˜ã€è¾“å‡ºé˜»æŠ—ä½ç­‰ä¼˜ç‚¹ï¼Œå¹¿æ³›åº”ç”¨äº LED é©±åŠ¨ã€ç»§ç”µå™¨æ§åˆ¶ã€ç”µæœºé©±åŠ¨ç­‰åœºåˆã€‚</p>
<p>åœ¨å®é™…è®¾è®¡ä¸­ï¼Œæˆ‘ä»¬éœ€è¦æ ¹æ®è´Ÿè½½ç‰¹æ€§é€‰æ‹©åˆé€‚çš„ä¸‰æç®¡ï¼Œè®¡ç®—å¥½åŸºæé™æµç”µé˜»ï¼Œå¹¶è€ƒè™‘è¿‡æµä¿æŠ¤ã€çƒ­ä¿æŠ¤ç­‰å®‰å…¨æªæ–½ã€‚</p>
<p>é€šè¿‡æœ¬æ–‡çš„åˆ†æå’Œä»£ç ç¤ºä¾‹ï¼Œç›¸ä¿¡å¤§å®¶å¯¹æ¨æŒ½ç”µè·¯æœ‰äº†æ›´æ·±å…¥çš„ç†è§£ã€‚</p>
<p>åœ¨å®é™…é¡¹ç›®ä¸­ï¼Œå»ºè®®å…ˆåœ¨é¢åŒ…æ¿ä¸Šæ­å»ºç”µè·¯è¿›è¡Œæµ‹è¯•ï¼Œç¡®è®¤å‚æ•°æ— è¯¯åå†è¿›è¡Œ PCB è®¾è®¡ã€‚</p>
<p>åŒæ—¶ï¼Œè¦æ³¨æ„ç”µè·¯çš„æ•£çƒ­è®¾è®¡ï¼Œå¿…è¦æ—¶åŠ è£…æ•£çƒ­ç‰‡ã€‚</p>
<p>åªæœ‰æŠŠç†è®ºå’Œå®è·µç»“åˆèµ·æ¥ï¼Œæ‰èƒ½è®¾è®¡å‡ºå¯é ç¨³å®šçš„æ¨æŒ½é©±åŠ¨ç”µè·¯ã€‚</p>
<p><strong>æ›´å¤šç¼–ç¨‹å­¦ä¹ èµ„æº</strong></p>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.lxlinux.net%2Fe%2Fcpp%2Fc_course_handout_2025.html" target="_blank" title="https://www.lxlinux.net/e/cpp/c_course_handout_2025.html" ref="nofollow noopener noreferrer">C è¯­è¨€é›¶åŸºç¡€å…¥é—¨ç”µå­ä¹¦-2026 æœ€æ–°ç‰ˆ</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.lxlinux.net%2Fe%2Fstm32%2Fstm32_course_handout_2024.html" target="_blank" title="https://www.lxlinux.net/e/stm32/stm32_course_handout_2024.html" ref="nofollow noopener noreferrer">STM32 é›¶åŸºç¡€å…¥é—¨ç”µå­ä¹¦-2026 æœ€æ–°ç‰ˆ</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.lxlinux.net%2Fe%2Ffreertos%2Ffreertos_course_handout_2025.html" target="_blank" title="https://www.lxlinux.net/e/freertos/freertos_course_handout_2025.html" ref="nofollow noopener noreferrer">FreeRTOS é›¶åŸºç¡€å…¥é—¨ç”µå­ä¹¦-2026 æœ€æ–°ç‰ˆ</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.lxlinux.net%2Fe%2Fcpp%2Fcpp_course_handout_2025.html" target="_blank" title="https://www.lxlinux.net/e/cpp/cpp_course_handout_2025.html" ref="nofollow noopener noreferrer">C++ é›¶åŸºç¡€å…¥é—¨ç”µå­ä¹¦-2026 æœ€æ–°ç‰ˆ</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.lxlinux.net%2Fe%2Flearning-path%2F51-learning-path.html" target="_blank" title="https://www.lxlinux.net/e/learning-path/51-learning-path.html" ref="nofollow noopener noreferrer">51 å•ç‰‡æœºé›¶åŸºç¡€å…¥é—¨å­¦ä¹ è·¯çº¿</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.lxlinux.net%2Fe%2Flearning-path%2Fad-learning-path.html" target="_blank" title="https://www.lxlinux.net/e/learning-path/ad-learning-path.html" ref="nofollow noopener noreferrer">AD ç”»æ¿é›¶åŸºç¡€å…¥é—¨å­¦ä¹ è·¯çº¿</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.lxlinux.net%2Fe%2Flearning-path%2Fc-learning-path.html" target="_blank" title="https://www.lxlinux.net/e/learning-path/c-learning-path.html" ref="nofollow noopener noreferrer">C è¯­è¨€é›¶åŸºç¡€å…¥é—¨å­¦ä¹ è·¯çº¿</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.lxlinux.net%2Fe%2Flearning-path%2Fcpp-learning-path.html" target="_blank" title="https://www.lxlinux.net/e/learning-path/cpp-learning-path.html" ref="nofollow noopener noreferrer">C++ è¯­è¨€é›¶åŸºç¡€å…¥é—¨å­¦ä¹ è·¯çº¿</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.lxlinux.net%2Fe%2Flearning-path%2Fesp32-learning-path.html" target="_blank" title="https://www.lxlinux.net/e/learning-path/esp32-learning-path.html" ref="nofollow noopener noreferrer">ESP32 é›¶åŸºç¡€å…¥é—¨å­¦ä¹ è·¯çº¿</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.lxlinux.net%2Fe%2Flearning-path%2Ffreertos-learning-path.html" target="_blank" title="https://www.lxlinux.net/e/learning-path/freertos-learning-path.html" ref="nofollow noopener noreferrer">FreeRTOS é›¶åŸºç¡€å…¥é—¨å­¦ä¹ è·¯çº¿</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.lxlinux.net%2Fe%2Flearning-path%2Flinux-devop-learning-path.html" target="_blank" title="https://www.lxlinux.net/e/learning-path/linux-devop-learning-path.html" ref="nofollow noopener noreferrer">Linux åº”ç”¨å¼€å‘é›¶åŸºç¡€å…¥é—¨å­¦ä¹ è·¯çº¿</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.lxlinux.net%2Fe%2Flearning-path%2Flinux-lower-learning-path.html" target="_blank" title="https://www.lxlinux.net/e/learning-path/linux-lower-learning-path.html" ref="nofollow noopener noreferrer">Linux åº•å±‚å¼€å‘é›¶åŸºç¡€å…¥é—¨å­¦ä¹ è·¯çº¿</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.lxlinux.net%2Fe%2Flearning-path%2Flvgl-learning-path.html" target="_blank" title="https://www.lxlinux.net/e/learning-path/lvgl-learning-path.html" ref="nofollow noopener noreferrer">LVGL é›¶åŸºç¡€å…¥é—¨å­¦ä¹ è·¯çº¿</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.lxlinux.net%2Fe%2Flearning-path%2Fqt-learning-path.html" target="_blank" title="https://www.lxlinux.net/e/learning-path/qt-learning-path.html" ref="nofollow noopener noreferrer">QT é›¶åŸºç¡€å…¥é—¨å­¦ä¹ è·¯çº¿</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.lxlinux.net%2Fe%2Flearning-path%2Fstm32-learning-path.html" target="_blank" title="https://www.lxlinux.net/e/learning-path/stm32-learning-path.html" ref="nofollow noopener noreferrer">STM32 é›¶åŸºç¡€å…¥é—¨å­¦ä¹ è·¯çº¿</a></li>
</ul>
<pre><code class="hljs"/></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[å‰ç«¯HTMLè½¬PDFçš„ä¸¤ç§ä¸»æµæ–¹æ¡ˆæ·±åº¦è§£æ]]></title>    <link>https://juejin.cn/post/7603673564908896291</link>    <guid>https://juejin.cn/post/7603673564908896291</guid>    <pubDate>2026-02-08T06:33:52.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7603673564908896291" data-draft-id="7603671627003756584" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="å‰ç«¯HTMLè½¬PDFçš„ä¸¤ç§ä¸»æµæ–¹æ¡ˆæ·±åº¦è§£æ"/> <meta itemprop="keywords" content="å‰ç«¯,JavaScript"/> <meta itemprop="datePublished" content="2026-02-08T06:33:52.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="é¹¿å¿ƒè‚ºè¯­"/> <meta itemprop="url" content="https://juejin.cn/user/3030678257798120"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            å‰ç«¯HTMLè½¬PDFçš„ä¸¤ç§ä¸»æµæ–¹æ¡ˆæ·±åº¦è§£æ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3030678257798120/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    é¹¿å¿ƒè‚ºè¯­
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-08T06:33:52.000Z" title="Sun Feb 08 2026 06:33:52 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»8åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">å¼•è¨€</h2>
<p>åœ¨ç°ä»£Webå¼€å‘ä¸­ï¼Œå°†ç½‘é¡µå†…å®¹å¯¼å‡ºä¸ºPDFæ ¼å¼çš„éœ€æ±‚è¶Šæ¥è¶Šæ™®éã€‚æ— è®ºæ˜¯ç”Ÿæˆç”µå­å‘ç¥¨ã€å¯¼å‡ºæ•°æ®æŠ¥è¡¨ã€åˆ¶ä½œå¯æ‰“å°çš„æ–‡æ¡£ï¼Œè¿˜æ˜¯ä¸ºç”¨æˆ·æä¾›ç¦»çº¿é˜…è¯»çš„ææ–™ï¼ŒHTMLåˆ°PDFçš„è½¬æ¢éƒ½æ˜¯å‰ç«¯å¼€å‘è€…å¿…é¡»æŒæ¡çš„æŠ€èƒ½ã€‚æœ¬æ–‡å°†æ·±å…¥å‰–æä¸¤ç§ä¸»æµçš„å‰ç«¯PDFç”Ÿæˆæ–¹æ¡ˆï¼Œä»åŸç†ã€å®ç°åˆ°æœ€ä½³å®è·µï¼Œå¸®åŠ©ä½ æ ¹æ®å®é™…åœºæ™¯é€‰æ‹©æœ€åˆé€‚çš„æŠ€æœ¯è·¯çº¿ã€‚</p>
<hr/>
<h2 data-id="heading-1">æ–¹æ¡ˆä¸€ï¼šæµè§ˆå™¨åŸç”Ÿæ‰“å°API</h2>
<h3 data-id="heading-2">æ ¸å¿ƒåŸç†</h3>
<p>æµè§ˆå™¨åŸç”Ÿæ‰“å°æ–¹æ¡ˆåˆ©ç”¨äº†<code>window.print()</code>è¿™ä¸€å†…ç½®APIã€‚é€šè¿‡åŠ¨æ€åˆ›å»ºä¸€ä¸ªæ–°çš„æµè§ˆå™¨çª—å£ï¼Œå°†éœ€è¦æ‰“å°çš„HTMLå†…å®¹å†™å…¥è¯¥çª—å£ï¼Œç„¶åè§¦å‘æµè§ˆå™¨çš„æ‰“å°å¯¹è¯æ¡†ï¼Œè®©ç”¨æˆ·å¯ä»¥é€‰æ‹©"å¦å­˜ä¸ºPDF"ã€‚è¿™ç§æ–¹æ³•çš„æœ¬è´¨æ˜¯ä¾èµ–æµè§ˆå™¨è‡ªèº«çš„æ¸²æŸ“å¼•æ“å’Œæ‰“å°èƒ½åŠ›ã€‚</p>
<h3 data-id="heading-3">å®Œæ•´å®ç°ä»£ç </h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">/**
 * ä½¿ç”¨æµè§ˆå™¨åŸç”ŸAPIç”ŸæˆPDF
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">string</span>} <span class="hljs-variable">title</span> - æ‰“å°é¡µé¢çš„æ ‡é¢˜
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">string</span>} <span class="hljs-variable">style</span> - éœ€è¦æ‰“å°çš„CSSæ ·å¼
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">string</span>} <span class="hljs-variable">content</span> - éœ€è¦æ‰“å°çš„HTMLå†…å®¹
 */</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">printToPDF</span>(<span class="hljs-params">title, style, content</span>) {
    <span class="hljs-comment">// æ„å»ºå®Œæ•´çš„HTMLæ–‡æ¡£ç»“æ„</span>
    <span class="hljs-keyword">const</span> html = <span class="hljs-string">`
        &lt;!DOCTYPE html&gt;
        &lt;html&gt;
        &lt;head&gt;
            &lt;meta charset="UTF-8"&gt;
            &lt;meta name="viewport" content="width=device-width, initial-scale=1.0"&gt;
            &lt;title&gt;<span class="hljs-subst">${title}</span>&lt;/title&gt;
            &lt;style&gt;
                /* åŸºç¡€é‡ç½®æ ·å¼ */
                * {
                    margin: 0;
                    padding: 0;
                    box-sizing: border-box;
                }
                
                /* æ‰“å°ä¼˜åŒ–æ ·å¼ */
                @media print {
                    body {
                        -webkit-print-color-adjust: exact;
                        print-color-adjust: exact;
                    }
                    
                    /* é¿å…è¡¨æ ¼è¢«æˆªæ–­ */
                    table {
                        page-break-inside: avoid;
                    }
                    
                    /* é¿å…å›¾ç‰‡è¢«æˆªæ–­ */
                    img {
                        page-break-inside: avoid;
                        max-width: 100%;
                    }
                }
                
                <span class="hljs-subst">${style}</span>
            &lt;/style&gt;
        &lt;/head&gt;
        &lt;body&gt;
            <span class="hljs-subst">${content}</span>
        &lt;/body&gt;
        &lt;/html&gt;
    `</span>;
    
    <span class="hljs-comment">// åˆ›å»ºæ–°çª—å£</span>
    <span class="hljs-keyword">const</span> printWindow = <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">open</span>(<span class="hljs-string">''</span>, <span class="hljs-string">'_blank'</span>);
    
    <span class="hljs-keyword">if</span> (!printWindow) {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'å¼¹çª—è¢«æµè§ˆå™¨æ‹¦æˆªï¼Œè¯·æ£€æŸ¥å¼¹çª—è®¾ç½®'</span>);
        <span class="hljs-keyword">return</span>;
    }
    
    <span class="hljs-comment">// å†™å…¥HTMLå†…å®¹</span>
    printWindow.<span class="hljs-property">document</span>.<span class="hljs-title function_">write</span>(html);
    printWindow.<span class="hljs-property">document</span>.<span class="hljs-title function_">close</span>();
    
    <span class="hljs-comment">// ç­‰å¾…èµ„æºåŠ è½½å®Œæˆåè§¦å‘æ‰“å°</span>
    printWindow.<span class="hljs-property">onload</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
        <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
            printWindow.<span class="hljs-title function_">print</span>();
            <span class="hljs-comment">// æ‰“å°å®Œæˆåå¯é€‰æ‹©å…³é—­çª—å£</span>
            <span class="hljs-comment">// printWindow.close();</span>
        }, <span class="hljs-number">500</span>);
    };
}

<span class="hljs-comment">// ä½¿ç”¨ç¤ºä¾‹</span>
<span class="hljs-keyword">const</span> title = <span class="hljs-string">'æœˆåº¦é”€å”®æŠ¥è¡¨'</span>;
<span class="hljs-keyword">const</span> style = <span class="hljs-string">`
    .report-header { text-align: center; margin-bottom: 20px; }
    .report-table { width: 100%; border-collapse: collapse; }
    .report-table th, .report-table td { border: 1px solid #ddd; padding: 8px; }
`</span>;
<span class="hljs-keyword">const</span> content = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'report-container'</span>).<span class="hljs-property">innerHTML</span>;

<span class="hljs-title function_">printToPDF</span>(title, style, content);
</code></pre>
<h3 data-id="heading-4">å…³é”®é…ç½®è¯´æ˜</h3>

























<table><thead><tr><th>é…ç½®é¡¹</th><th>è¯´æ˜</th><th>å»ºè®®å€¼</th></tr></thead><tbody><tr><td><code>-webkit-print-color-adjust</code></td><td>ç¡®ä¿æ‰“å°æ—¶ä¿ç•™èƒŒæ™¯è‰²å’Œé¢œè‰²</td><td><code>exact</code></td></tr><tr><td><code>page-break-inside: avoid</code></td><td>é˜²æ­¢å…ƒç´ åœ¨åˆ†é¡µå¤„è¢«æˆªæ–­</td><td>åº”ç”¨äºè¡¨æ ¼ã€å›¾ç‰‡</td></tr><tr><td><code>page-break-before/after</code></td><td>æ§åˆ¶å¼ºåˆ¶åˆ†é¡µä½ç½®</td><td>æ ¹æ®å†…å®¹ç»“æ„è®¾ç½®</td></tr></tbody></table>
<h3 data-id="heading-5">æ–¹æ¡ˆä¸€ä¼˜ç¼ºç‚¹åˆ†æ</h3>
<p><strong>ä¼˜ç‚¹ï¼š</strong></p>
<ul>
<li><strong>é›¶ä¾èµ–</strong>ï¼šæ— éœ€å¼•å…¥ä»»ä½•ç¬¬ä¸‰æ–¹åº“ï¼Œå‡å°‘é¡¹ç›®ä½“ç§¯</li>
<li><strong>æµè§ˆå™¨å…¼å®¹æ€§å¥½</strong>ï¼šæ‰€æœ‰ç°ä»£æµè§ˆå™¨éƒ½æ”¯æŒ</li>
<li><strong>ç”¨æˆ·å¯æ§</strong>ï¼šç”¨æˆ·å¯ä»¥åœ¨æ‰“å°å¯¹è¯æ¡†ä¸­é€‰æ‹©çº¸å¼ å¤§å°ã€æ–¹å‘ã€è¾¹è·ç­‰</li>
<li><strong>æ ·å¼çµæ´»</strong>ï¼šå¯ä»¥ä½¿ç”¨<code>@media print</code>åª’ä½“æŸ¥è¯¢ä¸“é—¨ä¼˜åŒ–æ‰“å°æ ·å¼</li>
</ul>
<p><strong>ç¼ºç‚¹ï¼š</strong></p>
<ul>
<li><strong>äº¤äº’ä¾èµ–</strong>ï¼šå¿…é¡»å¼¹å‡ºæ‰“å°å¯¹è¯æ¡†ï¼Œæ— æ³•é™é»˜ç”ŸæˆPDF</li>
<li><strong>æ ·å¼ä¸€è‡´æ€§å·®</strong>ï¼šä¸åŒæµè§ˆå™¨çš„æ‰“å°æ•ˆæœå¯èƒ½å­˜åœ¨å·®å¼‚</li>
<li><strong>æ— æ³•è‡ªåŠ¨ä¸‹è½½</strong>ï¼šéœ€è¦ç”¨æˆ·æ‰‹åŠ¨é€‰æ‹©"å¦å­˜ä¸ºPDF"</li>
<li><strong>åˆ†é¡µæ§åˆ¶æœ‰é™</strong>ï¼šå¤æ‚çš„åˆ†é¡µé€»è¾‘éš¾ä»¥ç²¾ç¡®æ§åˆ¶</li>
</ul>
<hr/>
<h2 data-id="heading-6">æ–¹æ¡ˆäºŒï¼šhtml2pdf.jsåº“æ–¹æ¡ˆ</h2>
<h3 data-id="heading-7">æ ¸å¿ƒåŸç†</h3>
<p>html2pdf.jsæ˜¯ä¸€ä¸ªåŸºäº<code>html2canvas</code>å’Œ<code>jsPDF</code>çš„å°è£…åº“ã€‚å…¶å·¥ä½œæµç¨‹åˆ†ä¸ºä¸‰æ­¥ï¼š</p>
<ol>
<li><strong>DOMè½¬Canvas</strong>ï¼šä½¿ç”¨html2canvaså°†HTMLå…ƒç´ æ¸²æŸ“ä¸ºCanvaså›¾åƒ</li>
<li><strong>Canvasè½¬å›¾åƒ</strong>ï¼šå°†Canvasè½¬æ¢ä¸ºJPEG/PNGå›¾åƒæ•°æ®</li>
<li><strong>å›¾åƒè½¬PDF</strong>ï¼šä½¿ç”¨jsPDFå°†å›¾åƒæ•°æ®æ’å…¥PDFæ–‡æ¡£</li>
</ol>
<h3 data-id="heading-8">å®Œæ•´å®ç°ä»£ç </h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> html2pdf <span class="hljs-keyword">from</span> <span class="hljs-string">'html2pdf.js'</span>;

<span class="hljs-comment">/**
 * ä½¿ç”¨html2pdf.jsç”ŸæˆPDF
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">HTMLElement</span>} <span class="hljs-variable">element</span> - éœ€è¦è½¬æ¢çš„DOMå…ƒç´ 
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">Object</span>} <span class="hljs-variable">options</span> - é…ç½®é€‰é¡¹
 * <span class="hljs-doctag">@returns</span> {<span class="hljs-type">Promise</span>} - è¿”å›Promiseå¯¹è±¡
 */</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">generatePDF</span>(<span class="hljs-params">element, options = {}</span>) {
    <span class="hljs-comment">// é»˜è®¤é…ç½®</span>
    <span class="hljs-keyword">const</span> defaultOptions = {
        <span class="hljs-comment">// PDFåŸºç¡€è®¾ç½®</span>
        <span class="hljs-attr">margin</span>: [<span class="hljs-number">10</span>, <span class="hljs-number">10</span>, <span class="hljs-number">10</span>, <span class="hljs-number">10</span>],           <span class="hljs-comment">// ä¸Šå³ä¸‹å·¦è¾¹è·ï¼ˆå•ä½ï¼šmmï¼‰</span>
        <span class="hljs-attr">filename</span>: <span class="hljs-string">'document.pdf'</span>,            <span class="hljs-comment">// é»˜è®¤æ–‡ä»¶å</span>
        
        <span class="hljs-comment">// å›¾åƒè´¨é‡è®¾ç½®</span>
        <span class="hljs-attr">image</span>: {
            <span class="hljs-attr">type</span>: <span class="hljs-string">'jpeg'</span>,                    <span class="hljs-comment">// å›¾åƒæ ¼å¼ï¼šjpeg/png</span>
            <span class="hljs-attr">quality</span>: <span class="hljs-number">0.98</span>                    <span class="hljs-comment">// å›¾åƒè´¨é‡ï¼š0-1</span>
        },
        
        <span class="hljs-comment">// html2canvasé…ç½®</span>
        <span class="hljs-attr">html2canvas</span>: {
            <span class="hljs-attr">scale</span>: <span class="hljs-number">2</span>,                        <span class="hljs-comment">// ç¼©æ”¾å€æ•°ï¼Œå½±å“æ¸…æ™°åº¦</span>
            <span class="hljs-attr">useCORS</span>: <span class="hljs-literal">true</span>,                   <span class="hljs-comment">// å…è®¸åŠ è½½è·¨åŸŸå›¾ç‰‡</span>
            <span class="hljs-attr">allowTaint</span>: <span class="hljs-literal">true</span>,                <span class="hljs-comment">// å…è®¸æ±¡æŸ“ç”»å¸ƒï¼ˆç”¨äºè·¨åŸŸå›¾ç‰‡ï¼‰</span>
            <span class="hljs-attr">logging</span>: <span class="hljs-literal">false</span>,                  <span class="hljs-comment">// å…³é—­æ—¥å¿—è¾“å‡º</span>
            <span class="hljs-attr">letterRendering</span>: <span class="hljs-literal">true</span>,           <span class="hljs-comment">// æ”¹å–„æ–‡å­—æ¸²æŸ“</span>
            <span class="hljs-attr">dpi</span>: <span class="hljs-number">192</span>                         <span class="hljs-comment">// å›¾åƒDPI</span>
        },
        
        <span class="hljs-comment">// jsPDFé…ç½®</span>
        <span class="hljs-attr">jsPDF</span>: {
            <span class="hljs-attr">unit</span>: <span class="hljs-string">'mm'</span>,                      <span class="hljs-comment">// å•ä½ï¼šmm/pt/px/in</span>
            <span class="hljs-attr">format</span>: <span class="hljs-string">'a4'</span>,                    <span class="hljs-comment">// é¡µé¢æ ¼å¼ï¼ša4/letter/legalç­‰</span>
            <span class="hljs-attr">orientation</span>: <span class="hljs-string">'portrait'</span>          <span class="hljs-comment">// æ–¹å‘ï¼športrait(çºµå‘)/landscape(æ¨ªå‘)</span>
        },
        
        <span class="hljs-comment">// åˆ†é¡µæ§åˆ¶</span>
        <span class="hljs-attr">pagebreak</span>: {
            <span class="hljs-attr">mode</span>: [<span class="hljs-string">'avoid-all'</span>, <span class="hljs-string">'css'</span>, <span class="hljs-string">'legacy'</span>],
            <span class="hljs-attr">before</span>: <span class="hljs-string">'.page-break-before'</span>,    <span class="hljs-comment">// åœ¨è¿™äº›å…ƒç´ å‰å¼ºåˆ¶åˆ†é¡µ</span>
            <span class="hljs-attr">after</span>: <span class="hljs-string">'.page-break-after'</span>,      <span class="hljs-comment">// åœ¨è¿™äº›å…ƒç´ åå¼ºåˆ¶åˆ†é¡µ</span>
            <span class="hljs-attr">avoid</span>: <span class="hljs-string">'img, table, .no-break'</span>   <span class="hljs-comment">// é¿å…è¿™äº›å…ƒç´ è¢«åˆ†é¡µæˆªæ–­</span>
        }
    };
    
    <span class="hljs-comment">// åˆå¹¶é…ç½®</span>
    <span class="hljs-keyword">const</span> mergedOptions = <span class="hljs-title function_">deepMerge</span>(defaultOptions, options);
    
    <span class="hljs-comment">// æ‰§è¡Œè½¬æ¢</span>
    <span class="hljs-keyword">return</span> <span class="hljs-title function_">html2pdf</span>()
        .<span class="hljs-title function_">set</span>(mergedOptions)
        .<span class="hljs-title function_">from</span>(element)
        .<span class="hljs-title function_">save</span>();
}

<span class="hljs-comment">/**
 * è·å–PDFçš„Base64æ•°æ®ï¼ˆç”¨äºä¸Šä¼ æˆ–é¢„è§ˆï¼‰
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">HTMLElement</span>} <span class="hljs-variable">element</span> - éœ€è¦è½¬æ¢çš„DOMå…ƒç´ 
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">Object</span>} <span class="hljs-variable">options</span> - é…ç½®é€‰é¡¹
 * <span class="hljs-doctag">@returns</span> {<span class="hljs-type">Promise&lt;string&gt;</span>} - è¿”å›Base64ç¼–ç çš„PDFæ•°æ®
 */</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">getPDFBase64</span>(<span class="hljs-params">element, options = {}</span>) {
    <span class="hljs-keyword">const</span> pdf = <span class="hljs-keyword">await</span> <span class="hljs-title function_">html2pdf</span>()
        .<span class="hljs-title function_">set</span>(options)
        .<span class="hljs-title function_">from</span>(element)
        .<span class="hljs-title function_">outputPdf</span>(<span class="hljs-string">'datauristring'</span>);
    
    <span class="hljs-keyword">return</span> pdf;
}

<span class="hljs-comment">/**
 * è·å–PDFçš„Blobå¯¹è±¡ï¼ˆç”¨äºè‡ªå®šä¹‰ä¸‹è½½é€»è¾‘ï¼‰
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">HTMLElement</span>} <span class="hljs-variable">element</span> - éœ€è¦è½¬æ¢çš„DOMå…ƒç´ 
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">Object</span>} <span class="hljs-variable">options</span> - é…ç½®é€‰é¡¹
 * <span class="hljs-doctag">@returns</span> {<span class="hljs-type">Promise&lt;Blob&gt;</span>} - è¿”å›PDFçš„Blobå¯¹è±¡
 */</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">getPDFBlob</span>(<span class="hljs-params">element, options = {}</span>) {
    <span class="hljs-keyword">const</span> pdf = <span class="hljs-keyword">await</span> <span class="hljs-title function_">html2pdf</span>()
        .<span class="hljs-title function_">set</span>(options)
        .<span class="hljs-title function_">from</span>(element)
        .<span class="hljs-title function_">outputPdf</span>(<span class="hljs-string">'blob'</span>);
    
    <span class="hljs-keyword">return</span> pdf;
}

<span class="hljs-comment">// ä½¿ç”¨ç¤ºä¾‹</span>
<span class="hljs-keyword">const</span> element = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'invoice-container'</span>);

<span class="hljs-comment">// åŸºç¡€ä½¿ç”¨ - ç›´æ¥ä¸‹è½½</span>
<span class="hljs-title function_">generatePDF</span>(element, {
    <span class="hljs-attr">filename</span>: <span class="hljs-string">'å‘ç¥¨-2024001.pdf'</span>,
    <span class="hljs-attr">margin</span>: [<span class="hljs-number">15</span>, <span class="hljs-number">15</span>, <span class="hljs-number">15</span>, <span class="hljs-number">15</span>]
});

<span class="hljs-comment">// é«˜çº§ä½¿ç”¨ - è·å–æ•°æ®åä¸Šä¼ </span>
<span class="hljs-title function_">getPDFBase64</span>(element, {
    <span class="hljs-attr">filename</span>: <span class="hljs-string">'report.pdf'</span>,
    <span class="hljs-attr">html2canvas</span>: { <span class="hljs-attr">scale</span>: <span class="hljs-number">3</span> },  <span class="hljs-comment">// æ›´é«˜æ¸…æ™°åº¦</span>
    <span class="hljs-attr">jsPDF</span>: { <span class="hljs-attr">orientation</span>: <span class="hljs-string">'landscape'</span> }  <span class="hljs-comment">// æ¨ªå‘å¸ƒå±€</span>
}).<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">base64Data</span> =&gt;</span> {
    <span class="hljs-comment">// ä¸Šä¼ åˆ°æœåŠ¡å™¨</span>
    <span class="hljs-title function_">uploadToServer</span>(base64Data);
});
</code></pre>
<h3 data-id="heading-9">é…ç½®é¡¹æ·±åº¦è§£æ</h3>
<h4 data-id="heading-10">1. æ¸…æ™°åº¦ä¼˜åŒ–</h4>
<pre><code class="hljs language-javascript" lang="javascript">{
    <span class="hljs-attr">html2canvas</span>: {
        <span class="hljs-attr">scale</span>: <span class="hljs-number">3</span>,           <span class="hljs-comment">// æ¨èå€¼ï¼š2-4ï¼Œå€¼è¶Šå¤§è¶Šæ¸…æ™°ä½†æ€§èƒ½è¶Šå·®</span>
        <span class="hljs-attr">dpi</span>: <span class="hljs-number">300</span>,           <span class="hljs-comment">// æ‰“å°çº§æ¸…æ™°åº¦</span>
        <span class="hljs-attr">letterRendering</span>: <span class="hljs-literal">true</span>  <span class="hljs-comment">// æ”¹å–„å°å­—ä½“æ¸²æŸ“</span>
    }
}
</code></pre>
<h4 data-id="heading-11">2. åˆ†é¡µæ§åˆ¶ç­–ç•¥</h4>
<pre><code class="hljs language-css" lang="css"><span class="hljs-comment">/* CSSæ–¹å¼æ§åˆ¶åˆ†é¡µ */</span>
<span class="hljs-selector-class">.page-break-before</span> {
    <span class="hljs-attribute">page-break-before</span>: always;
}

<span class="hljs-selector-class">.page-break-after</span> {
    <span class="hljs-attribute">page-break-after</span>: always;
}

<span class="hljs-selector-class">.no-break</span> {
    <span class="hljs-attribute">page-break-inside</span>: avoid;
}
</code></pre>
<pre><code class="hljs language-javascript" lang="javascript">{
    <span class="hljs-attr">pagebreak</span>: {
        <span class="hljs-attr">mode</span>: [<span class="hljs-string">'avoid-all'</span>, <span class="hljs-string">'css'</span>, <span class="hljs-string">'legacy'</span>],
        <span class="hljs-comment">// avoid-all: å°½å¯èƒ½é¿å…å…ƒç´ è¢«æˆªæ–­</span>
        <span class="hljs-comment">// css: å°Šé‡CSSçš„page-breakå±æ€§</span>
        <span class="hljs-comment">// legacy: ä½¿ç”¨æ—§ç‰ˆåˆ†é¡µç®—æ³•</span>
    }
}
</code></pre>
<h4 data-id="heading-12">3. è·¨åŸŸå›¾ç‰‡å¤„ç†</h4>
<pre><code class="hljs language-javascript" lang="javascript">{
    <span class="hljs-attr">html2canvas</span>: {
        <span class="hljs-attr">useCORS</span>: <span class="hljs-literal">true</span>,       <span class="hljs-comment">// å°è¯•ä½¿ç”¨CORSåŠ è½½è·¨åŸŸå›¾ç‰‡</span>
        <span class="hljs-attr">allowTaint</span>: <span class="hljs-literal">true</span>,    <span class="hljs-comment">// å…è®¸æ±¡æŸ“ç”»å¸ƒï¼ˆå¦‚æœCORSå¤±è´¥ï¼‰</span>
        <span class="hljs-attr">proxy</span>: <span class="hljs-string">'/api/proxy'</span>  <span class="hljs-comment">// å›¾ç‰‡ä»£ç†æœåŠ¡åœ°å€</span>
    }
}
</code></pre>
<h3 data-id="heading-13">æ–¹æ¡ˆäºŒä¼˜ç¼ºç‚¹åˆ†æ</h3>
<p><strong>ä¼˜ç‚¹ï¼š</strong></p>
<ul>
<li><strong>é™é»˜ç”Ÿæˆ</strong>ï¼šæ— éœ€ç”¨æˆ·äº¤äº’ï¼Œå¯è‡ªåŠ¨ä¸‹è½½æˆ–ä¸Šä¼ </li>
<li><strong>æ•ˆæœä¸€è‡´</strong>ï¼šä¸å—æµè§ˆå™¨æ‰“å°è®¾ç½®å½±å“ï¼Œè¾“å‡ºç¨³å®š</li>
<li><strong>ç¨‹åºåŒ–æ§åˆ¶</strong>ï¼šå¯é€šè¿‡ä»£ç ç²¾ç¡®æ§åˆ¶ç”Ÿæˆè¿‡ç¨‹</li>
<li><strong>æ”¯æŒå¼‚æ­¥</strong>ï¼šå¯é›†æˆåˆ°è‡ªåŠ¨åŒ–æµç¨‹ä¸­</li>
</ul>
<p><strong>ç¼ºç‚¹ï¼š</strong></p>
<ul>
<li><strong>ä½“ç§¯è¾ƒå¤§</strong>ï¼šéœ€è¦å¼•å…¥ç¬¬ä¸‰æ–¹åº“ï¼ˆçº¦200KB+ï¼‰</li>
<li><strong>æ€§èƒ½å¼€é”€</strong>ï¼šå¤§é¡µé¢è½¬æ¢å¯èƒ½è¾ƒæ…¢ï¼Œä¼šé˜»å¡ä¸»çº¿ç¨‹</li>
<li><strong>æ–‡å­—å¯é€‰æ€§</strong>ï¼šç”Ÿæˆçš„PDFä¸­æ–‡å­—æ˜¯å›¾åƒï¼Œæ— æ³•é€‰æ‹©å¤åˆ¶</li>
<li><strong>å¤æ‚æ ·å¼é™åˆ¶</strong>ï¼šæŸäº›CSSç‰¹æ€§ï¼ˆå¦‚flexboxã€gridï¼‰å¯èƒ½æ¸²æŸ“ä¸å‡†ç¡®</li>
</ul>
<hr/>
<h2 data-id="heading-14">æ–¹æ¡ˆå¯¹æ¯”ä¸é€‰å‹æŒ‡å—</h2>























































<table><thead><tr><th>å¯¹æ¯”ç»´åº¦</th><th>æµè§ˆå™¨åŸç”Ÿæ‰“å°</th><th>html2pdf.js</th></tr></thead><tbody><tr><td><strong>ä¾èµ–ä½“ç§¯</strong></td><td>0KB</td><td>~200KB+</td></tr><tr><td><strong>ç”¨æˆ·äº¤äº’</strong></td><td>éœ€è¦</td><td>ä¸éœ€è¦</td></tr><tr><td><strong>ç”Ÿæˆé€Ÿåº¦</strong></td><td>å¿«</td><td>è¾ƒæ…¢ï¼ˆå–å†³äºå†…å®¹å¤§å°ï¼‰</td></tr><tr><td><strong>è¾“å‡ºä¸€è‡´æ€§</strong></td><td>æµè§ˆå™¨ä¾èµ–</td><td>é«˜åº¦ä¸€è‡´</td></tr><tr><td><strong>æ–‡å­—å¯é€‰æ€§</strong></td><td>æ”¯æŒ</td><td>ä¸æ”¯æŒï¼ˆæ–‡å­—ä¸ºå›¾åƒï¼‰</td></tr><tr><td><strong>åˆ†é¡µæ§åˆ¶</strong></td><td>æœ‰é™</td><td>çµæ´»</td></tr><tr><td><strong>è·¨åŸŸå›¾ç‰‡</strong></td><td>æ”¯æŒ</td><td>éœ€ç‰¹æ®Šé…ç½®</td></tr><tr><td><strong>è‡ªåŠ¨åŒ–é›†æˆ</strong></td><td>å›°éš¾</td><td>å®¹æ˜“</td></tr><tr><td><strong>æµè§ˆå™¨å…¼å®¹æ€§</strong></td><td>ä¼˜ç§€</td><td>è‰¯å¥½</td></tr></tbody></table>
<h3 data-id="heading-15">é€‰å‹å»ºè®®</h3>
<p><strong>é€‰æ‹©æµè§ˆå™¨åŸç”Ÿæ‰“å°çš„åœºæ™¯ï¼š</strong></p>
<ul>
<li>éœ€è¦ç”¨æˆ·è‡ªå®šä¹‰æ‰“å°è®¾ç½®ï¼ˆçº¸å¼ ã€è¾¹è·ç­‰ï¼‰</li>
<li>å¯¹PDFæ–‡ä»¶å¤§å°æ•æ„Ÿ</li>
<li>éœ€è¦ç”Ÿæˆçš„PDFä¸­æ–‡å­—å¯é€‰æ‹©ã€å¯å¤åˆ¶</li>
<li>é¡¹ç›®å¯¹ç¬¬ä¸‰æ–¹ä¾èµ–æœ‰ä¸¥æ ¼é™åˆ¶</li>
</ul>
<p><strong>é€‰æ‹©html2pdf.jsçš„åœºæ™¯ï¼š</strong></p>
<ul>
<li>éœ€è¦é™é»˜ç”ŸæˆPDFï¼Œä¸æ‰“æ‰°ç”¨æˆ·</li>
<li>éœ€è¦è‡ªåŠ¨ä¸Šä¼ PDFåˆ°æœåŠ¡å™¨</li>
<li>å¯¹è¾“å‡ºæ•ˆæœçš„ä¸€è‡´æ€§è¦æ±‚é«˜</li>
<li>éœ€è¦é›†æˆåˆ°è‡ªåŠ¨åŒ–å·¥ä½œæµä¸­</li>
</ul>
<hr/>
<h2 data-id="heading-16">æœ€ä½³å®è·µä¸å¸¸è§é—®é¢˜</h2>
<h3 data-id="heading-17">1. æ‰“å°æ ·å¼ä¼˜åŒ–</h3>
<pre><code class="hljs language-css" lang="css"><span class="hljs-comment">/* æ‰“å°ä¸“ç”¨æ ·å¼è¡¨ */</span>
<span class="hljs-keyword">@media</span> print {
    <span class="hljs-comment">/* éšè—ä¸éœ€è¦æ‰“å°çš„å…ƒç´  */</span>
    <span class="hljs-selector-class">.no-print</span>,
    <span class="hljs-selector-class">.navbar</span>,
    <span class="hljs-selector-class">.sidebar</span>,
    <span class="hljs-selector-class">.actions</span> {
        <span class="hljs-attribute">display</span>: none <span class="hljs-meta">!important</span>;
    }
    
    <span class="hljs-comment">/* ç¡®ä¿èƒŒæ™¯è‰²æ‰“å° */</span>
    * {
        -webkit-print-<span class="hljs-attribute">color</span>-adjust: exact <span class="hljs-meta">!important</span>;
        print-<span class="hljs-attribute">color</span>-adjust: exact <span class="hljs-meta">!important</span>;
    }
    
    <span class="hljs-comment">/* é“¾æ¥æ˜¾ç¤ºURL */</span>
    <span class="hljs-selector-tag">a</span><span class="hljs-selector-attr">[href]</span><span class="hljs-selector-pseudo">:after</span> {
        <span class="hljs-attribute">content</span>: <span class="hljs-string">" ("</span> <span class="hljs-built_in">attr</span>(href) <span class="hljs-string">")"</span>;
    }
    
    <span class="hljs-comment">/* è¡¨æ ¼ä¼˜åŒ– */</span>
    <span class="hljs-selector-tag">table</span> {
        <span class="hljs-attribute">page-break-inside</span>: avoid;
        <span class="hljs-attribute">font-size</span>: <span class="hljs-number">12pt</span>;
    }
    
    <span class="hljs-comment">/* åˆ†é¡µæ§åˆ¶ */</span>
    <span class="hljs-selector-class">.page-break</span> {
        <span class="hljs-attribute">page-break-after</span>: always;
    }
}
</code></pre>
<h3 data-id="heading-18">2. å¤§é¡µé¢æ€§èƒ½ä¼˜åŒ–</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// åˆ†å—å¤„ç†å¤§é¡µé¢</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">generateLargePDF</span>(<span class="hljs-params">container</span>) {
    <span class="hljs-keyword">const</span> pages = container.<span class="hljs-title function_">querySelectorAll</span>(<span class="hljs-string">'.page'</span>);
    <span class="hljs-keyword">const</span> pdf = <span class="hljs-keyword">new</span> <span class="hljs-title function_">jsPDF</span>(<span class="hljs-string">'p'</span>, <span class="hljs-string">'mm'</span>, <span class="hljs-string">'a4'</span>);
    
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; pages.<span class="hljs-property">length</span>; i++) {
        <span class="hljs-comment">// ä½¿ç”¨requestIdleCallbacké¿å…é˜»å¡UI</span>
        <span class="hljs-keyword">await</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function"><span class="hljs-params">resolve</span> =&gt;</span> {
            <span class="hljs-title function_">requestIdleCallback</span>(<span class="hljs-keyword">async</span> () =&gt; {
                <span class="hljs-keyword">const</span> canvas = <span class="hljs-keyword">await</span> <span class="hljs-title function_">html2canvas</span>(pages[i], { <span class="hljs-attr">scale</span>: <span class="hljs-number">2</span> });
                <span class="hljs-keyword">const</span> imgData = canvas.<span class="hljs-title function_">toDataURL</span>(<span class="hljs-string">'image/jpeg'</span>, <span class="hljs-number">0.95</span>);
                
                <span class="hljs-keyword">if</span> (i &gt; <span class="hljs-number">0</span>) pdf.<span class="hljs-title function_">addPage</span>();
                pdf.<span class="hljs-title function_">addImage</span>(imgData, <span class="hljs-string">'JPEG'</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">210</span>, <span class="hljs-number">297</span>);
                
                <span class="hljs-title function_">resolve</span>();
            });
        });
    }
    
    pdf.<span class="hljs-title function_">save</span>(<span class="hljs-string">'large-document.pdf'</span>);
}
</code></pre>
<h3 data-id="heading-19">3. å¸¸è§é—®é¢˜è§£å†³æ–¹æ¡ˆ</h3>
<p><strong>Q: ç”Ÿæˆçš„PDFä¸­æ–‡å­—æ¨¡ç³Šï¼Ÿ</strong></p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// æé«˜scaleå€¼å’ŒDPI</span>
<span class="hljs-attr">html2canvas</span>: {
    <span class="hljs-attr">scale</span>: <span class="hljs-number">3</span>,
    <span class="hljs-attr">dpi</span>: <span class="hljs-number">300</span>,
    <span class="hljs-attr">letterRendering</span>: <span class="hljs-literal">true</span>
}
</code></pre>
<p><strong>Q: è·¨åŸŸå›¾ç‰‡æ— æ³•æ˜¾ç¤ºï¼Ÿ</strong></p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// æ–¹æ¡ˆ1ï¼šé…ç½®CORS</span>
<span class="hljs-attr">html2canvas</span>: {
    <span class="hljs-attr">useCORS</span>: <span class="hljs-literal">true</span>,
    <span class="hljs-attr">allowTaint</span>: <span class="hljs-literal">true</span>
}

<span class="hljs-comment">// æ–¹æ¡ˆ2ï¼šä½¿ç”¨å›¾ç‰‡ä»£ç†</span>
<span class="hljs-attr">html2canvas</span>: {
    <span class="hljs-attr">proxy</span>: <span class="hljs-string">'https://your-domain.com/image-proxy'</span>
}

<span class="hljs-comment">// æ–¹æ¡ˆ3ï¼šå°†å›¾ç‰‡è½¬ä¸ºBase64</span>
<span class="hljs-keyword">const</span> img = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelector</span>(<span class="hljs-string">'img'</span>);
<span class="hljs-title function_">fetch</span>(img.<span class="hljs-property">src</span>)
    .<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">res</span> =&gt;</span> res.<span class="hljs-title function_">blob</span>())
    .<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">blob</span> =&gt;</span> {
        <span class="hljs-keyword">const</span> reader = <span class="hljs-keyword">new</span> <span class="hljs-title class_">FileReader</span>();
        reader.<span class="hljs-property">onloadend</span> = <span class="hljs-function">() =&gt;</span> {
            img.<span class="hljs-property">src</span> = reader.<span class="hljs-property">result</span>;
        };
        reader.<span class="hljs-title function_">readAsDataURL</span>(blob);
    });
</code></pre>
<p><strong>Q: è¡¨æ ¼è¢«åˆ†é¡µæˆªæ–­ï¼Ÿ</strong></p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-comment">/* ä¸ºè¡¨æ ¼å®¹å™¨æ·»åŠ ä¿æŠ¤ */</span>
<span class="hljs-selector-class">.table-wrapper</span> {
    <span class="hljs-attribute">page-break-inside</span>: avoid;
}

<span class="hljs-comment">/* æˆ–ä½¿ç”¨html2pdfçš„åˆ†é¡µé…ç½® */</span>
pagebreak: {
    avoid: <span class="hljs-string">'table, tr'</span>
}
</code></pre>
<hr/>
<h2 data-id="heading-20">æ€»ç»“</h2>
<p>å‰ç«¯HTMLè½¬PDFçš„ä¸¤ç§ä¸»æµæ–¹æ¡ˆå„æœ‰ä¼˜åŠ£ï¼š</p>
<ul>
<li><strong>æµè§ˆå™¨åŸç”Ÿæ‰“å°</strong>é€‚åˆéœ€è¦ç”¨æˆ·å‚ä¸ã€å¯¹æ–‡ä»¶å¤§å°æ•æ„Ÿã€éœ€è¦æ–‡å­—å¯é€‰çš„åœºæ™¯</li>
<li><strong>html2pdf.js</strong>é€‚åˆéœ€è¦è‡ªåŠ¨åŒ–ã€å¯¹è¾“å‡ºä¸€è‡´æ€§è¦æ±‚é«˜çš„åœºæ™¯</li>
</ul>
<p>åœ¨å®é™…é¡¹ç›®ä¸­ï¼Œå¯ä»¥æ ¹æ®å…·ä½“éœ€æ±‚é€‰æ‹©å•ä¸€æ–¹æ¡ˆæˆ–ç»„åˆä½¿ç”¨ã€‚ä¾‹å¦‚ï¼Œå¯ä»¥æä¾›"æ‰“å°"æŒ‰é’®ä½¿ç”¨åŸç”Ÿæ–¹æ¡ˆï¼ŒåŒæ—¶æä¾›"ä¸‹è½½PDF"æŒ‰é’®ä½¿ç”¨html2pdf.jsæ–¹æ¡ˆï¼Œè®©ç”¨æˆ·è‡ªä¸»é€‰æ‹©ã€‚</p>
<p>éšç€WebæŠ€æœ¯çš„å‘å±•ï¼Œæ–°çš„æ–¹æ¡ˆå¦‚Chromeçš„Headlessæ‰“å°ã€Puppeteerç­‰æœåŠ¡ç«¯æ–¹æ¡ˆä¹Ÿåœ¨å…´èµ·ã€‚ä½†å¯¹äºçº¯å‰ç«¯åœºæ™¯ï¼Œæœ¬æ–‡ä»‹ç»çš„ä¸¤ç§æ–¹æ¡ˆä»ç„¶æ˜¯æœ€å®ç”¨ã€æœ€æˆç†Ÿçš„é€‰æ‹©ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[CSSç›’æ¨¡å‹å®æˆ˜ï¼šç”¨ä»£ç é€è§† `border-box`ä¸ `content-box`çš„å¤©å£¤ä¹‹åˆ«]]></title>    <link>https://juejin.cn/post/7603643385816842292</link>    <guid>https://juejin.cn/post/7603643385816842292</guid>    <pubDate>2026-02-08T06:57:33.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7603643385816842292" data-draft-id="7603643385816825908" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="CSSç›’æ¨¡å‹å®æˆ˜ï¼šç”¨ä»£ç é€è§† `border-box`ä¸ `content-box`çš„å¤©å£¤ä¹‹åˆ«"/> <meta itemprop="keywords" content="CSS"/> <meta itemprop="datePublished" content="2026-02-08T06:57:33.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Leeå·"/> <meta itemprop="url" content="https://juejin.cn/user/2402874087453658"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            CSSç›’æ¨¡å‹å®æˆ˜ï¼šç”¨ä»£ç é€è§† `border-box`ä¸ `content-box`çš„å¤©å£¤ä¹‹åˆ«
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2402874087453658/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Leeå·
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-08T06:57:33.000Z" title="Sun Feb 08 2026 06:57:33 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»4åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h3 data-id="heading-0"><strong>CSSç›’æ¨¡å‹å®æˆ˜ï¼šç”¨ä»£ç é€è§† <code>border-box</code>ä¸ <code>content-box</code>çš„å¤©å£¤ä¹‹åˆ«</strong></h3>
<p>ç†è§£CSSç›’æ¨¡å‹æ˜¯å‰ç«¯å¸ƒå±€çš„å¿…ä¿®è¯¾ï¼Œè€Œ <code>box-sizing</code>å±æ€§åˆ™æ˜¯æŒæ§ç›’æ¨¡å‹è®¡ç®—è§„åˆ™çš„é’¥åŒ™ã€‚æœ¬æ–‡å°†é€šè¿‡æ‚¨æ–‡æ¡£ä¸­ç”ŸåŠ¨çš„ä»£ç ç¤ºä¾‹ï¼Œç›´è§‚å±•ç¤ºå…¶æ ¸å¿ƒåŒºåˆ«ã€‚</p>
<h4 data-id="heading-1"><strong>åœºæ™¯ä¸€ï¼šæ ‡å‡†ç›’æ¨¡å‹çš„â€œæ‰©å¼ â€å›°æ‰°ï¼ˆ<code>content-box</code>ï¼‰</strong></h4>
<p>åœ¨é»˜è®¤çš„ <code>content-box</code>æ¨¡å‹ä¸‹ï¼Œæ‚¨ä¸ºå…ƒç´ è®¾ç½®çš„ <code>width</code>å’Œ <code>height</code>ä»…ä½œç”¨äºå…¶<strong>å†…å®¹åŒºåŸŸ</strong>ã€‚è®©æˆ‘ä»¬çœ‹ä¸€ä¸ªä¾‹å­ï¼š</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"en"</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span><span class="css">
        <span class="hljs-selector-class">.box</span><span class="hljs-selector-class">.content-box</span> {
            <span class="hljs-attribute">width</span>: <span class="hljs-number">200px</span>;       <span class="hljs-comment">/* ä»…æŒ‡å†…å®¹çš„å®½åº¦ */</span>
            <span class="hljs-attribute">height</span>: <span class="hljs-number">100px</span>;      <span class="hljs-comment">/* ä»…æŒ‡å†…å®¹çš„é«˜åº¦ */</span>
            <span class="hljs-attribute">padding</span>: <span class="hljs-number">20px</span>;      <span class="hljs-comment">/* å†…è¾¹è· */</span>
            <span class="hljs-attribute">border</span>: <span class="hljs-number">5px</span> solid black; <span class="hljs-comment">/* è¾¹æ¡† */</span>
            <span class="hljs-attribute">margin</span>: <span class="hljs-number">20px</span>;       <span class="hljs-comment">/* å¤–è¾¹è· */</span>
            <span class="hljs-attribute">box-sizing</span>: content-box; <span class="hljs-comment">/* è¿™æ˜¯é»˜è®¤å€¼ï¼Œä¹Ÿå¯ä¸å†™ */</span>
            <span class="hljs-attribute">background-color</span>: lightgreen;
        }
    </span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"box content-box"</span>&gt;</span>Box with content-box<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span>
</code></pre>
<p><strong>å…³é”®ä»£ç åˆ†æ</strong>ï¼š</p>
<ul>
<li><code>width: 200px; height: 100px;</code>ï¼šè¿™é‡Œå®šä¹‰çš„ä»…ä»…æ˜¯ç»¿è‰²å†…å®¹åŒºåŸŸçš„å°ºå¯¸ã€‚</li>
<li>æ·»åŠ çš„ <code>padding</code>å’Œ <code>border</code>ä¼š<strong>å‘å¤–æ‰©å¼ </strong>ç›’å­çš„æ€»å°ºå¯¸ã€‚</li>
</ul>
<p><strong>è®¡ç®—ç»“æœ</strong>ï¼š</p>
<ul>
<li>ç›’å­çš„<strong>æ€»å®½åº¦</strong>â€‹ = <code>200(width) + 20 * 2(padding) + 5 * 2(border) = 250px</code></li>
<li>ç›’å­çš„<strong>æ€»é«˜åº¦</strong>â€‹ = <code>100(height) + 20 * 2(padding) + 5 * 2(border) = 150px</code></li>
</ul>
<p>æ­¤æ—¶ï¼Œç›’å­åœ¨é¡µé¢ä¸Šçš„å®é™…å ä½æ˜¯ 250px * 150pxï¼Œè¿œå¤§äºä½ ç›´è§‰ä¸Šè®¤ä¸ºçš„ 200px * 100pxã€‚è¿™åœ¨å¤šåˆ—å¸ƒå±€æ—¶ææ˜“å¯¼è‡´æ„å¤–æ¢è¡Œæˆ–æº¢å‡ºã€‚</p>
<h4 data-id="heading-2"><strong>åœºæ™¯äºŒï¼šæ€ªå¼‚ç›’æ¨¡å‹çš„â€œæ”¶ç¼©â€æ™ºæ…§ï¼ˆ<code>border-box</code>ï¼‰</strong></h4>
<p>ä¸ºäº†è§£å†³ä¸Šè¿°é—®é¢˜ï¼Œ<code>border-box</code>æ¨¡å‹é‡‡ç”¨äº†æ›´ç›´è§‚çš„è®¡ç®—æ–¹å¼ï¼šä½ è®¾å®šçš„ <code>width</code>å’Œ <code>height</code>ç›´æ¥å®šä¹‰äº†è¿™ä¸ªç›’å­çš„<strong>æ€»è¾¹æ¡†ç›’å°ºå¯¸</strong>ã€‚å¯¹æ¯”ç¤ºä¾‹ï¼š</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"en"</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span><span class="css">
        <span class="hljs-selector-class">.box</span><span class="hljs-selector-class">.border-box</span> {
            <span class="hljs-attribute">width</span>: <span class="hljs-number">200px</span>;       <span class="hljs-comment">/* æŒ‡æ•´ä¸ªç›’å­çš„æ€»å®½åº¦ï¼ */</span>
            <span class="hljs-attribute">height</span>: <span class="hljs-number">100px</span>;      <span class="hljs-comment">/* æŒ‡æ•´ä¸ªç›’å­çš„æ€»é«˜åº¦ï¼ */</span>
            <span class="hljs-attribute">padding</span>: <span class="hljs-number">20px</span>;
            <span class="hljs-attribute">border</span>: <span class="hljs-number">5px</span> solid black;
            <span class="hljs-attribute">margin</span>: <span class="hljs-number">20px</span>;
            <span class="hljs-attribute">box-sizing</span>: border-box; <span class="hljs-comment">/* æ ¸å¿ƒï¼šåˆ‡æ¢ä¸º border-box */</span>
            <span class="hljs-attribute">background-color</span>: lightblue;
        }
    </span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"box border-box"</span>&gt;</span>Box with border-box<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span>
</code></pre>
<p><strong>å…³é”®ä»£ç åˆ†æ</strong>ï¼š</p>
<ul>
<li>åŒæ ·çš„ <code>width: 200px; height: 100px;</code>å£°æ˜ï¼Œä½†å› ä¸º <code>box-sizing: border-box;</code>çš„å­˜åœ¨ï¼Œè¿™é‡Œçš„ 200px å’Œ 100px è¢«è§£é‡Šä¸º<strong>åŒ…å«å†…å®¹ã€å†…è¾¹è·å’Œè¾¹æ¡†çš„æ€»å°ºå¯¸</strong>ã€‚</li>
<li>æ·»åŠ çš„ <code>padding</code>å’Œ <code>border</code>ä¼š<strong>å‘å†…æŒ¤å‹</strong>å†…å®¹åŒºåŸŸçš„ç©ºé—´ã€‚</li>
</ul>
<p><strong>è®¡ç®—ç»“æœ</strong>ï¼š</p>
<ul>
<li>ç›’å­çš„<strong>æ€»å®½åº¦</strong>â€‹ = <code>200px</code>ï¼ˆç”± <code>width</code>ç›´æ¥å®šä¹‰ï¼‰</li>
<li>ç›’å­çš„<strong>æ€»é«˜åº¦</strong>â€‹ = <code>100px</code>ï¼ˆç”± <code>height</code>ç›´æ¥å®šä¹‰ï¼‰</li>
<li>å†…å®¹åŒºåŸŸçš„<strong>å®é™…å®½åº¦</strong>â€‹ = <code>200 - 20 * 2 - 5 * 2 = 150px</code></li>
<li>å†…å®¹åŒºåŸŸçš„<strong>å®é™…é«˜åº¦</strong>â€‹ = <code>100 - 20 * 2 - 5 * 2 = 50px</code></li>
</ul>
<p>æ— è®ºä½ å¦‚ä½•è°ƒæ•´ <code>padding</code>å’Œ <code>border</code>ï¼Œè¿™ä¸ªæµ…è“è‰²ç›’å­çš„<strong>å¤–è½®å»“</strong>éƒ½ä¸¥æ ¼ä¿æŒä¸ºä½ è®¾å®šçš„ 200px * 100pxï¼Œè¿™ä½¿å¾—ç²¾ç¡®æ§åˆ¶å¸ƒå±€å˜å¾—è½»è€Œæ˜“ä¸¾ã€‚</p>
<h4 data-id="heading-3"><strong>å®æˆ˜åº”ç”¨ï¼šä¸ºä»€ä¹ˆ <code>border-box</code>æ˜¯å¸ƒå±€ç¥å™¨</strong></h4>
<p>è®©æˆ‘ä»¬çœ‹ä¸€ä¸ªç»å…¸åº”ç”¨åœºæ™¯â€”â€”åˆ›å»ºä¸¤ä¸ªç­‰å®½å¹¶åˆ—çš„ç›’å­ï¼š</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"en"</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span><span class="css">
        <span class="hljs-selector-class">.container</span> {
            <span class="hljs-attribute">width</span>: <span class="hljs-number">1200px</span>;
            <span class="hljs-attribute">margin</span>: <span class="hljs-number">0</span> auto;
        }
        <span class="hljs-selector-class">.box</span> {
            <span class="hljs-attribute">box-sizing</span>: border-box; <span class="hljs-comment">/* ä½¿ç”¨ border-box æ¨¡å‹ */</span>
            <span class="hljs-attribute">width</span>: <span class="hljs-number">580px</span>; <span class="hljs-comment">/* æ€»å®½580px */</span>
            <span class="hljs-attribute">height</span>: <span class="hljs-number">100px</span>;
            <span class="hljs-attribute">margin</span>: <span class="hljs-number">0</span> <span class="hljs-number">10px</span>; <span class="hljs-comment">/* å·¦å³å¤–è¾¹è·å„10px */</span>
            <span class="hljs-attribute">border</span>: <span class="hljs-number">1px</span> solid <span class="hljs-number">#000</span>; <span class="hljs-comment">/* è¾¹æ¡† */</span>
            <span class="hljs-attribute">padding</span>: <span class="hljs-number">5px</span>; <span class="hljs-comment">/* å†…è¾¹è· */</span>
            <span class="hljs-attribute">display</span>: inline-block;
            <span class="hljs-attribute">background-color</span>: green;
        }
        <span class="hljs-selector-class">.box</span><span class="hljs-selector-pseudo">:nth-child</span>(<span class="hljs-number">2</span>) {
            <span class="hljs-attribute">background-color</span>: yellow;
        }
    </span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"container"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"box"</span>&gt;</span>1<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"box"</span>&gt;</span>2<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span>
</code></pre>
<p><strong>æ ¸å¿ƒä¼˜åŠ¿è§£æ</strong>ï¼š</p>
<ol>
<li>
<p><strong>å°ºå¯¸å¯é¢„æµ‹</strong>ï¼šæ¯ä¸ª <code>.box</code>çš„æ€»å®½åº¦æ˜¯æ˜ç¡®çš„ 580pxï¼Œæ— è®ºå…¶ <code>border</code>å’Œ <code>padding</code>å¦‚ä½•å˜åŒ–ã€‚</p>
</li>
<li>
<p><strong>å¸ƒå±€è®¡ç®—ç®€å•</strong>ï¼š</p>
<ul>
<li>å•ä¸ªç›’å­å ä½ï¼š<code>580px(width) + 10 * 2(margin) = 600px</code></li>
<li>ä¸¤ä¸ªç›’å­æ€»å ä½ï¼š<code>600px + 600px = 1200px</code></li>
<li>å®¹å™¨å®½åº¦ä¸º 1200pxï¼Œå®Œç¾å®¹çº³ã€‚</li>
</ul>
</li>
</ol>
<p><strong>å¦‚æœæ­¤å¤„ä½¿ç”¨ <code>content-box</code>ï¼Œä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ</strong></p>
<p>æ¯ä¸ªç›’å­çš„å®é™…æ€»å®½åº¦ä¼šå˜æˆï¼š<code>580(width) + 5 * 2(padding) + 1 * 2(border) = 592px</code>ï¼Œå†åŠ ä¸Šå·¦å³ <code>margin</code>å„10pxï¼Œå•ä¸ªç›’å­å°±å ç”¨äº† <code>612px</code>ï¼Œä¸¤ä¸ªç›’å­å°±éœ€è¦ <code>1224px</code>ï¼Œä¼šç«‹å³æ’‘ç ´ <code>1200px</code>çš„å®¹å™¨ï¼Œå¯¼è‡´ç¬¬äºŒä¸ªç›’å­æ‰åˆ°ä¸‹ä¸€è¡Œã€‚<code>border-box</code>å½»åº•é¿å…äº†è¿™ç§çƒ¦äººçš„è®¡ç®—ã€‚</p>
<h4 data-id="heading-4"><strong>æ€»ç»“ä¸æœ€ä½³å®è·µ</strong></h4>
<p>é€šè¿‡ä»¥ä¸Šä»£ç çš„å¯¹æ¯”æ¼”ç¤ºï¼Œå¯ä»¥æ¸…æ™°åœ°çœ‹åˆ°ï¼š</p>
<ul>
<li>**<code>content-box</code>**â€‹ æ˜¯â€œåŠ æ³•æ¨¡å‹â€ï¼ˆ<code>å®é™…å°ºå¯¸ = è®¾å®šå°ºå¯¸ + padding + border</code>ï¼‰ï¼Œæ˜“å¯¼è‡´å¸ƒå±€å¤±æ§ã€‚</li>
<li>**<code>border-box</code>**â€‹ æ˜¯â€œå‡æ³•æ¨¡å‹â€ï¼ˆ<code>å†…å®¹å°ºå¯¸ = è®¾å®šå°ºå¯¸ - padding - border</code>ï¼‰ï¼Œè®©å…ƒç´ çš„å ä½å°ºå¯¸å®Œå…¨å¯é¢„æµ‹ã€‚</li>
</ul>
<p>å› æ­¤ï¼Œåœ¨ç°ä»£å‰ç«¯å¼€å‘ä¸­ï¼Œä¸€ä¸ªå…¬è®¤çš„æœ€ä½³å®è·µæ˜¯åœ¨CSSèµ·å§‹ä½ç½®å°±å…¨å±€åº”ç”¨ <code>border-box</code>æ¨¡å‹ï¼š</p>
<pre><code class="hljs language-css" lang="css">*,
*<span class="hljs-selector-pseudo">::before</span>,
*<span class="hljs-selector-pseudo">::after</span> {
  <span class="hljs-attribute">box-sizing</span>: border-box;
}
</code></pre>
<p>è¿™æ¡ç®€å•çš„è§„åˆ™ï¼Œèƒ½è®©ä½ åœ¨åç»­çš„æ•´ä¸ªå¼€å‘è¿‡ç¨‹ä¸­ï¼Œå½»åº•å‘Šåˆ«å›  <code>padding</code>å’Œ <code>border</code>å¯¼è‡´çš„å¸ƒå±€å°ºå¯¸è®¡ç®—çƒ¦æ¼ï¼Œå°†æ›´å¤šç²¾åŠ›æŠ•å…¥åˆ°åˆ›æ„å’Œé€»è¾‘çš„å®ç°ä¸­ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Spring Fluxæ–¹æ³•æ€»ç»“]]></title>    <link>https://juejin.cn/post/7603643385816547380</link>    <guid>https://juejin.cn/post/7603643385816547380</guid>    <pubDate>2026-02-08T03:51:18.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7603643385816547380" data-draft-id="7603673564908683299" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Spring Fluxæ–¹æ³•æ€»ç»“"/> <meta itemprop="keywords" content="åç«¯"/> <meta itemprop="datePublished" content="2026-02-08T03:51:18.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Lukeå›60797"/> <meta itemprop="url" content="https://juejin.cn/user/3632442148656990"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Spring Fluxæ–¹æ³•æ€»ç»“
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3632442148656990/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Lukeå›60797
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-08T03:51:18.000Z" title="Sun Feb 08 2026 03:51:18 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    4
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»2åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><code>Flux</code> çš„æ–¹æ³•éå¸¸å¤šï¼ˆå‡ ç™¾ä¸ªï¼‰ï¼Œä½†ä½ ä¸éœ€è¦å…¨éƒ¨è®°ä½ã€‚æˆ‘ä»¬å¯ä»¥æŠŠå®ƒä»¬æŒ‰ç…§â€œåŠŸèƒ½â€åˆ†æˆå‡ ç±»ï¼Œå°±åƒå¨æˆ¿é‡Œä¸åŒçš„å·¥å…·ï¼š</p>
<h3 data-id="heading-0">1. åˆ¶é€ æ°´æºï¼ˆåˆ›å»ºæ“ä½œç¬¦ï¼‰</h3>
<p>ç”¨æ¥å®šä¹‰æµé‡çš„æ¥æºã€‚</p>
<ul>
<li><strong><code>just(T... data)</code></strong> ï¼šæœ€ç›´æ¥çš„ï¼ŒæŠŠç°æˆçš„æ•°æ®å¡è¿›å»ã€‚</li>
<li><strong><code>fromIterable(Iterable)</code></strong> ï¼šæŠŠ <code>List</code> æˆ– <code>Set</code> å˜æˆ <code>Flux</code>ã€‚</li>
<li><strong><code>range(int start, int count)</code></strong> ï¼šç”Ÿæˆä¸€ä¸ªæ•´æ•°åºåˆ—ï¼ˆå¦‚ 1 åˆ° 100ï¼‰ã€‚</li>
<li><strong><code>interval(Duration)</code></strong> ï¼š<strong>å®šæ—¶å™¨</strong>ã€‚æ¯éš”ä¸€æ®µæ—¶é—´å‘ä¸€ä¸ªæ•°å­—ï¼ˆ0, 1, 2...ï¼‰ï¼Œå¸¸ç”¨äºå¿ƒè·³æ£€æµ‹ã€‚</li>
<li><strong><code>empty()</code></strong> ï¼šç›´æ¥å‘é€å®Œæˆä¿¡å·ï¼Œæ°´ç®¡é‡Œå•¥ä¹Ÿæ²¡æœ‰ã€‚</li>
<li><strong><code>error(Throwable)</code></strong> ï¼šç›´æ¥å‘é€é”™è¯¯ä¿¡å·ï¼Œæ°´ç®¡ä¸€é€šå°±çˆ†ã€‚</li>
</ul>
<hr/>
<h3 data-id="heading-1">2. åŠ å·¥è½¬æ¢ï¼ˆè½¬åŒ–æ“ä½œç¬¦ï¼‰</h3>
<p>æœ€å¸¸ç”¨çš„éƒ¨åˆ†ï¼Œç”¨æ¥æ”¹å˜æµé‡Œçš„æ•°æ®ã€‚</p>
<ul>
<li>
<p><strong><code>map(Function)</code></strong> ï¼š<strong>1å¯¹1è½¬æ¢</strong>ã€‚æŠŠ A å˜æˆ Bï¼ˆå¦‚ï¼šæŠŠâ€œæ´—æ´ç²¾â€å­—ç¬¦ä¸²å˜æˆ <code>Soap</code> å¯¹è±¡ï¼‰ã€‚</p>
</li>
<li>
<p><strong><code>flatMap(Function)</code></strong> ï¼š<strong>1å¯¹Nè½¬æ¢ï¼ˆå¼‚æ­¥ï¼‰</strong> ã€‚æŠŠä¸€ä¸ªå…ƒç´ å˜æˆä¸€ä¸ªæ–°çš„ <code>Flux</code>ã€‚</p>
<blockquote>
<p><em>æ¯”å–»ï¼š<code>map</code> æ˜¯æŠŠèœåˆ‡ç¢ï¼›<code>flatMap</code> æ˜¯æŠŠä¸€ä¸ªè®¢å•æ‹†æˆå¤šä¸ªç‰©æµå•ï¼Œå¹¶å¼‚æ­¥å»æŸ¥æ¯ä¸€ä¸ªç‰©æµã€‚</em></p>
</blockquote>
</li>
<li>
<p><strong><code>buffer(int n)</code></strong> ï¼š<strong>æ‰“åŒ…</strong>ã€‚æŠŠé›¶æ•£çš„æ°´æ»´æ”¶é›†æ»¡ <code>n</code> ä¸ªï¼Œå‡‘æˆä¸€ä¸ª <code>List</code> å†å¾€ä¸‹æµã€‚</p>
</li>
<li>
<p><strong><code>collectList()</code></strong> ï¼šæŠŠæ°´ç®¡é‡Œæ‰€æœ‰çš„æ°´éƒ½æ¥ä½ï¼Œæœ€åè£…è¿›ä¸€ä¸ª <code>Mono&lt;List&lt;T&gt;&gt;</code>ã€‚</p>
</li>
</ul>
<hr/>
<h3 data-id="heading-2">3. è¿‡æ»¤ä¸æŒ‘é€‰ï¼ˆè¿‡æ»¤æ“ä½œç¬¦ï¼‰</h3>
<p>å†³å®šå“ªäº›ä¸œè¥¿èƒ½æµè¿‡å»ã€‚</p>
<ul>
<li><strong><code>filter(Predicate)</code></strong> ï¼šç¬¦åˆæ¡ä»¶çš„æ‰è®©è¿‡ã€‚</li>
<li><strong><code>distinct()</code></strong> ï¼š<strong>å»é‡</strong>ã€‚æµè¿‡çš„ä¸œè¥¿å¦‚æœé‡å¤ï¼Œåªæ”¾è¡Œç¬¬ä¸€ä¸ªã€‚</li>
<li><strong><code>take(long n)</code></strong> ï¼š<strong>åªå–å‰ n ä¸ª</strong>ã€‚æ‹¿å®Œå°±å…³æ°´é¾™å¤´ã€‚</li>
<li><strong><code>skip(long n)</code></strong> ï¼šè·³è¿‡å‰ n ä¸ªï¼Œä»åé¢å¼€å§‹æ¥ã€‚</li>
</ul>
<hr/>
<h3 data-id="heading-3">4. ç»„åˆæµï¼ˆç»„åˆæ“ä½œç¬¦ï¼‰</h3>
<p>æŠŠå¤šæ ¹æ°´ç®¡æ‹¼åœ¨ä¸€èµ·ã€‚</p>
<ul>
<li>
<p><strong><code>mergeWith(Publisher)</code></strong> ï¼š<strong>åˆå¹¶</strong>ã€‚ä¸¤æ ¹ç®¡å­æ±‡æˆä¸€æ ¹ï¼Œè°æœ‰æ°´è°å…ˆæµï¼ˆäº¤é”™è¾“å‡ºï¼‰ã€‚</p>
</li>
<li>
<p><strong><code>zipWith(Publisher)</code></strong> ï¼š<strong>é…å¯¹</strong>ã€‚å·¦è¾¹æµå‡ºä¸€æ»´ï¼Œå³è¾¹æµå‡ºä¸€æ»´ï¼Œå‡‘æˆä¸€å¯¹ï¼ˆTupleï¼‰å†å¾€ä¸‹èµ°ã€‚</p>
<blockquote>
<p><em>æ¯”å–»ï¼š<code>merge</code> æ˜¯åˆæµï¼Œ<code>zip</code> æ˜¯ç›¸äº²ï¼Œå¿…é¡»ä¸¤è¾¹éƒ½æœ‰äººæ‰æˆå¯¹ã€‚</em></p>
</blockquote>
</li>
<li>
<p><strong><code>concatWith(Publisher)</code></strong> ï¼š<strong>é¦–å°¾ç›¸æ¥</strong>ã€‚ç­‰ç¬¬ä¸€æ ¹ç®¡å­æµå®Œäº†ï¼Œæ‰å¼€å§‹æµç¬¬äºŒæ ¹ã€‚</p>
</li>
</ul>
<hr/>
<h3 data-id="heading-4">5. å‰¯ä½œç”¨ä¸ç”Ÿå‘½å‘¨æœŸï¼ˆç›‘å¬æ“ä½œç¬¦ï¼‰</h3>
<p>åªè§‚å¯Ÿï¼Œä¸å¹²é¢„ã€‚</p>
<ul>
<li><strong><code>doOnNext(Consumer)</code></strong> ï¼šæ•°æ®æµè¿‡æ—¶çœ‹ä¸€çœ¼ï¼ˆæ‰“æ—¥å¿—ï¼‰ã€‚</li>
<li><strong><code>doOnError(Consumer)</code></strong> ï¼šå‡ºæ•…éšœæ—¶çœ‹ä¸€çœ¼ã€‚</li>
<li><strong><code>doOnComplete(Runnable)</code></strong> ï¼šæµå®Œæ—¶çœ‹ä¸€çœ¼ã€‚</li>
<li><strong><code>doFinally(Consumer)</code></strong> ï¼šç®¡å®ƒæˆåŠŸè¿˜æ˜¯å¤±è´¥ï¼Œæœ€åéƒ½è¦æ‰§è¡Œï¼ˆç±»ä¼¼ <code>finally</code> å—ï¼‰ã€‚</li>
</ul>
<hr/>
<h3 data-id="heading-5">6. é”™è¯¯å¤„ç†ï¼ˆå®¹é”™æ“ä½œç¬¦ï¼‰</h3>
<p>æ°´ç®¡çˆ†äº†ä¹‹åçš„æ•‘åœºæ–¹æ¡ˆã€‚</p>
<ul>
<li><strong><code>onErrorReturn(T)</code></strong> ï¼šå‡ºé”™äº†ï¼Ÿåˆ«æŠ¥è­¦ï¼Œç›´æ¥è¿”å›ä¸€ä¸ªé»˜è®¤å€¼ã€‚</li>
<li><strong><code>onErrorResume(Function)</code></strong> ï¼šå‡ºé”™äº†ï¼Ÿåˆ‡åˆ°å¤‡ç”¨æ°´ç®¡ï¼ˆå¦ä¸€ä¸ª <code>Flux</code>ï¼‰ã€‚</li>
<li><strong><code>retry(long n)</code></strong> ï¼šå‡ºé”™äº†ï¼Ÿå†è¯• <code>n</code> æ¬¡ã€‚</li>
</ul>
<hr/>
<h3 data-id="heading-6">æ€»ç»“</h3>
<ul>
<li>å¦‚æœä½ è¦<strong>æ”¹å˜</strong>æ•°æ®ï¼šæ‰¾ <code>map</code>/<code>flatMap</code>ã€‚</li>
<li>å¦‚æœä½ è¦<strong>å‡å°‘</strong>æ•°æ®ï¼šæ‰¾ <code>filter</code>/<code>take</code>ã€‚</li>
<li>å¦‚æœä½ è¦<strong>åˆå¹¶</strong>æ•°æ®ï¼šæ‰¾ <code>zip</code>/<code>merge</code>ã€‚</li>
<li>å¦‚æœä½ è¦<strong>è§‚å¯Ÿ</strong>æ•°æ®ï¼šæ‰¾ <code>doOn...</code> ç³»åˆ—ã€‚</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[é«˜ç‰ˆæœ¬ MySQL é©±åŠ¨çš„ DNS é™·é˜±]]></title>    <link>https://juejin.cn/post/7603674653153525769</link>    <guid>https://juejin.cn/post/7603674653153525769</guid>    <pubDate>2026-02-08T04:24:35.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7603674653153525769" data-draft-id="7603674653153476617" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="é«˜ç‰ˆæœ¬ MySQL é©±åŠ¨çš„ DNS é™·é˜±"/> <meta itemprop="keywords" content="åç«¯"/> <meta itemprop="datePublished" content="2026-02-08T04:24:35.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="define9527"/> <meta itemprop="url" content="https://juejin.cn/user/414960194946937"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            é«˜ç‰ˆæœ¬ MySQL é©±åŠ¨çš„ DNS é™·é˜±
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/414960194946937/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    define9527
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-08T04:24:35.000Z" title="Sun Feb 08 2026 04:24:35 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»2åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">èƒŒæ™¯</h2>
<p>é¡¹ç›®ä½¿ç”¨ OceanBase æ•°æ®åº“ï¼Œå¹¶é€šè¿‡ ShardingSphere JDBC å®ç°åˆ†è¡¨ã€‚ç”±äº ShardingSphere å½“å‰ä¸æ”¯æŒ <code>jdbc:oceanbase:</code> åè®®ï¼Œæˆ‘ä»¬åœ¨ä»£ç ä¸­å°†è¿æ¥ä¸²æ›¿æ¢ä¸º <code>jdbc:mysql</code> å¹¶å¼•å…¥ MySQL é©±åŠ¨</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
 Â  Â <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.oceanbase<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
 Â  Â <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>oceanbase-client<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
 Â  Â <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.4.8<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
 Â  Â <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.apache.shardingsphere<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
 Â  Â <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>shardingsphere-jdbc<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
 Â  Â <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>5.5.2<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
 Â  Â <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.mysql<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
 Â  Â <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>mysql-connector-j<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
 Â  Â <span class="hljs-comment">&lt;!-- é—®é¢˜æ ¹æº --&gt;</span>
 Â  Â <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>8.4.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
</code></pre>
<p>æ•°æ®æºé…ç½®å¦‚ä¸‹ï¼ˆå…³é”®éƒ¨åˆ†ï¼‰</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">spring:</span>
  <span class="hljs-attr">datasource:</span>
 Â   <span class="hljs-attr">driver-class-name:</span> <span class="hljs-string">com.oceanbase.jdbc.Driver</span>
 Â   <span class="hljs-attr">url:</span> <span class="hljs-string">jdbc:oceanbase:loadbalance://IP:PORT/test?...</span>
 Â   <span class="hljs-attr">druid:</span>
 Â  Â   <span class="hljs-attr">initial-size:</span> <span class="hljs-number">8</span>
 Â  Â   <span class="hljs-attr">max-active:</span> <span class="hljs-number">30</span>
 Â  Â   <span class="hljs-attr">min-idle:</span> <span class="hljs-number">8</span>
</code></pre>

<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-meta">@Configuration</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ShardingDataSourceConfiguration</span> {

 Â  Â <span class="hljs-meta">@Value</span>(<span class="hljs-string">"${spring.datasource.url}"</span>)
 Â  Â <span class="hljs-keyword">private</span> <span class="hljs-title class_">String</span> url;

 Â  Â <span class="hljs-meta">@Value</span>(<span class="hljs-string">"${spring.datasource.username}"</span>)
 Â  Â <span class="hljs-keyword">private</span> <span class="hljs-title class_">String</span> username;

 Â  Â <span class="hljs-meta">@Value</span>(<span class="hljs-string">"${spring.datasource.password}"</span>)
 Â  Â <span class="hljs-keyword">private</span> <span class="hljs-title class_">String</span> password;

 Â  Â <span class="hljs-keyword">private</span> <span class="hljs-title class_">Map</span>&lt;<span class="hljs-title class_">String</span>, <span class="hljs-title class_">DataSource</span>&gt; <span class="hljs-title function_">createDataSourceMap</span>(<span class="hljs-params"/>) {
 Â  Â  Â  Â <span class="hljs-title class_">Map</span>&lt;<span class="hljs-title class_">String</span>, <span class="hljs-title class_">DataSource</span>&gt; dataSourceMap = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();
 Â  Â  Â  Â <span class="hljs-title class_">DruidDataSource</span> dataSource1 = <span class="hljs-keyword">new</span> <span class="hljs-title class_">DruidDataSource</span>();
 Â  Â  Â  Â dataSource1.<span class="hljs-title function_">setDriverClassName</span>(<span class="hljs-string">"com.mysql.cj.jdbc.Driver"</span>);
 Â  Â  Â  Â url = url.<span class="hljs-title function_">replace</span>(<span class="hljs-string">"jdbc:oceanbase"</span>, <span class="hljs-string">"jdbc:mysql"</span>);
 Â  Â  Â  Â dataSource1.<span class="hljs-title function_">setUrl</span>(url);
 Â  Â  Â  Â dataSource1.<span class="hljs-title function_">setUsername</span>(username);
 Â  Â  Â  Â dataSource1.<span class="hljs-title function_">setPassword</span>(password);
 Â  Â  Â  Â dataSource1.<span class="hljs-title function_">setInitialSize</span>(<span class="hljs-number">8</span>);
 Â  Â  Â  Â dataSource1.<span class="hljs-title function_">setMaxActive</span>(<span class="hljs-number">30</span>);
 Â  Â  Â  Â dataSource1.<span class="hljs-title function_">setMinIdle</span>(<span class="hljs-number">8</span>);
 Â  Â  Â  Â dataSourceMap.<span class="hljs-title function_">put</span>(<span class="hljs-string">"ds_0"</span>, dataSource1);
 Â  Â  Â  Â <span class="hljs-keyword">return</span> dataSourceMap;
 Â   }

 Â  Â <span class="hljs-meta">@Bean</span>(<span class="hljs-string">"shardingDataSource"</span>)
 Â  Â <span class="hljs-keyword">public</span> <span class="hljs-title class_">DataSource</span> <span class="hljs-title function_">dataSource</span>() throws <span class="hljs-title class_">SQLException</span> {
 Â  Â  Â  Â <span class="hljs-title class_">Properties</span> props = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Properties</span>();
 Â  Â  Â  Â props.<span class="hljs-title function_">put</span>(<span class="hljs-string">"sql-show"</span>, <span class="hljs-literal">false</span>);
 Â  Â  Â  Â <span class="hljs-keyword">return</span> <span class="hljs-title class_">ShardingSphereDataSourceFactory</span>.<span class="hljs-title function_">createDataSource</span>(
 Â  Â  Â  Â  Â  Â <span class="hljs-title function_">createDataSourceMap</span>(),
 Â  Â  Â  Â  Â  Â <span class="hljs-title class_">Collections</span>.<span class="hljs-title function_">singletonList</span>(<span class="hljs-title function_">createShardingRuleConfiguration</span>()),
 Â  Â  Â  Â  Â  Â props
 Â  Â  Â   );
 Â   }
}
</code></pre>
<p>åŒæ—¶ï¼Œé¡¹ç›®ä¸­è¿˜æœ‰ä¸€ä¸ªæœªç»è¿‡ ShardingSphere çš„åŸç”Ÿ OceanBase æ•°æ®æº</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-meta">@Configuration</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DataSourceConfiguration</span> {

 Â  Â <span class="hljs-meta">@Bean(name = <span class="hljs-string">"logAnalysisDataSource"</span>)</span>
 Â  Â <span class="hljs-keyword">public</span> DataSource logAnalysisDataSource() {
 Â  Â  Â  Â <span class="hljs-comment">// com.alibaba.druid.spring.boot.autoconfigure.DruidDataSourceBuilder</span>
 Â  Â  Â  Â <span class="hljs-comment">// ä½¿ç”¨ spring.datasource é…ç½®æ¥åˆ›å»ºæ•°æ®åº“è¿æ¥æ± </span>
 Â  Â  Â  Â DruidDataSource druidDataSource = DruidDataSourceBuilder.create().build();
 Â  Â  Â  Â druidDataSource.setSocketTimeout(<span class="hljs-number">180000</span>);
 Â  Â  Â  Â druidDataSource.setConnectTimeout(<span class="hljs-number">180000</span>);
 Â  Â  Â  Â <span class="hljs-keyword">return</span> druidDataSource;
 Â   }
}
</code></pre>
<h2 data-id="heading-1">é—®é¢˜ç°è±¡</h2>
<p>å¯åŠ¨é¡¹ç›®æ—¶ï¼Œå‘ç° <code>@Bean("shardingDataSource")</code> æ‰€å¯¹åº”çš„ DruidDataSource åˆå§‹åŒ–æ—¶é—´ç‰¹åˆ«é•¿ï¼Œä½† <code>@Bean(name = "logAnalysisDataSource")</code> æ‰€å¯¹åº”çš„ DruidDataSource åˆå§‹åŒ–å´å¾ˆå¿«</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-attr">[2026-02-07 17:47:32.417]</span> <span class="hljs-selector-attr">[INFO ]</span> <span class="hljs-selector-attr">[com.zaxxer.hikari.HikariDataSource]</span> <span class="hljs-selector-attr">[80]</span> - <span class="hljs-selector-attr">[HikariPool-1 - Starting...]</span>
<span class="hljs-selector-attr">[2026-02-07 17:47:32.739]</span> <span class="hljs-selector-attr">[INFO ]</span> <span class="hljs-selector-attr">[com.zaxxer.hikari.HikariDataSource]</span> <span class="hljs-selector-attr">[82]</span> - <span class="hljs-selector-attr">[HikariPool-1 - Start completed.]</span>

<span class="hljs-selector-attr">[2026-02-07 17:50:22.107]</span> <span class="hljs-selector-attr">[INFO ]</span> <span class="hljs-selector-attr">[com.alibaba.druid.pool.DruidDataSource]</span> <span class="hljs-selector-attr">[1007]</span> - <span class="hljs-selector-attr">[{dataSource-1} inited]</span>

<span class="hljs-selector-attr">[2026-02-07 17:50:34.454]</span> <span class="hljs-selector-attr">[INFO ]</span> <span class="hljs-selector-attr">[com.alibaba.druid.pool.DruidDataSource]</span> <span class="hljs-selector-attr">[1007]</span> - <span class="hljs-selector-attr">[{dataSource-2} inited]</span>

<span class="hljs-selector-attr">[2026-02-07 17:50:35.840]</span> <span class="hljs-selector-attr">[INFO ]</span> <span class="hljs-selector-attr">[com.xxx.WebApplication]</span> <span class="hljs-selector-attr">[61]</span> - <span class="hljs-selector-attr">[Started WebApplication in 188.327 seconds (JVM running for 189.054)]</span>
</code></pre>
<blockquote>
<p>æ—¥å¿—ä¸­çš„ HikariDataSource æ˜¯ ShardingSphere JDBC ç”¨äºæ“ä½œå…ƒæ•°æ®çš„å†…éƒ¨è¿æ¥æ± ï¼Œå…¶åˆå§‹åŒ–å®Œæˆè‡³ DruidDataSource#init æ‰§è¡Œå‰çš„è€—æ—¶å¯å¿½ç•¥ä¸è®¡</p>
</blockquote>
<p>å¯åŠ¨æ—¥å¿—ä¸­ï¼Œ<code>{dataSource-1}</code> å¯¹åº” <code>@Bean("shardingDataSource")</code>ï¼Œ<code>{dataSource-2}</code> å¯¹åº” <code>@Bean(name = "logAnalysisDataSource")</code></p>
<p>ä»æ—¥å¿—å¯ä»¥çœ‹å‡ºï¼Œ<code>@Bean("shardingDataSource")</code> è¿™ä¸ª DruidDataSource å¯¹è±¡çš„åˆå§‹åŒ–æ—¶é—´ä¸º 2 åˆ† 50 ç§’ï¼Œè€Œ <code>@Bean(name = "logAnalysisDataSource")</code> è¿™ä¸ª DruidDataSource å¯¹è±¡çš„åˆå§‹åŒ–æ—¶é—´ä¸º 12 ç§’ï¼Œè€Œä¸¤è€…å”¯ä¸€çš„åŒºåˆ«åœ¨äºåº•å±‚ JDBC é©±åŠ¨</p>
<blockquote>
<p>å¤‡æ³¨ï¼šå› é¡¹ç›®å¼€å‘ç¯å¢ƒä½äºå†…ç½‘ï¼Œä¸”æ•°æ®åº“éƒ¨ç½²äºä¸åŒåœ°åŸŸï¼Œç½‘ç»œå»¶è¿Ÿè¾ƒé«˜ï¼Œæ•°æ®åº“è¿æ¥æ± åˆå§‹åŒ–è€—æ—¶ 12 ç§’å±æ­£å¸¸èŒƒå›´</p>
</blockquote>
<p>è·Ÿè¸ª Druid æºç å‘ç°ï¼Œè€—æ—¶ä¸»è¦é›†ä¸­åœ¨ <code>createPhysicalConnection()</code> æ–¹æ³•æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œè¯¥æ–¹æ³•è´Ÿè´£å»ºç«‹åº•å±‚ç‰©ç†æ•°æ®åº“è¿æ¥</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DruidDataSource</span> <span class="hljs-title">extends</span> <span class="hljs-title">DruidAbstractDataSource</span> <span class="hljs-title">implements</span> <span class="hljs-title">DruidDataSourceMBean</span>, <span class="hljs-type">ManagedDataSource</span>, <span class="hljs-type">Referenceable</span>, <span class="hljs-type">Closeable</span>, <span class="hljs-type">Cloneable</span>, <span class="hljs-type">ConnectionPoolDataSource</span>, <span class="hljs-type">MBeanRegistration</span> {

 Â  Â <span class="hljs-keyword">public</span> void <span class="hljs-keyword">init</span>() throws SQLException {
 Â  Â  Â  Â <span class="hljs-keyword">try</span> {
 Â  Â  Â  Â  Â  Â <span class="hljs-keyword">if</span> (createScheduler != <span class="hljs-literal">null</span> &amp;&amp; asyncInit) {
 Â  Â  Â  Â  Â  Â  Â  Â <span class="hljs-keyword">for</span> (int i = <span class="hljs-number">0</span>; i &lt; initialSize; ++i) {
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â submitCreateTask(<span class="hljs-literal">true</span>);
 Â  Â  Â  Â  Â  Â  Â   }
 Â  Â  Â  Â  Â   } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (!asyncInit) {
 Â  Â  Â  Â  Â  Â  Â  Â <span class="hljs-comment">// init connections</span>
 Â  Â  Â  Â  Â  Â  Â  Â <span class="hljs-keyword">while</span> (poolingCount &lt; initialSize) {
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <span class="hljs-keyword">try</span> {
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <span class="hljs-comment">// æ…¢åœ¨è¿™é‡Œ</span>
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â PhysicalConnectionInfo pyConnectInfo = createPhysicalConnection();
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â DruidConnectionHolder holder = new DruidConnectionHolder(<span class="hljs-keyword">this</span>, pyConnectInfo);
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â connections[poolingCount++] = holder;
 Â  Â  Â  Â  Â  Â  Â  Â  Â   } <span class="hljs-keyword">catch</span> (SQLException ex) {

 Â  Â  Â  Â  Â  Â  Â  Â  Â   }
 Â  Â  Â  Â  Â  Â  Â   }
 Â  Â  Â  Â  Â   }
 Â  Â  Â   } <span class="hljs-keyword">finally</span> {
 Â  Â  Â  Â  Â  Â inited = <span class="hljs-literal">true</span>;
 Â  Â  Â  Â  Â  Â lock.unlock();
 Â  Â  Â  Â  Â  Â <span class="hljs-keyword">if</span> (<span class="hljs-keyword">init</span> &amp;&amp; LOG.isInfoEnabled()) {
 Â  Â  Â  Â  Â  Â  Â  Â String msg = <span class="hljs-string">"{dataSource-"</span> + <span class="hljs-keyword">this</span>.getID();
 Â  Â  Â  Â  Â  Â  Â  Â <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.name != <span class="hljs-literal">null</span> &amp;&amp; !<span class="hljs-keyword">this</span>.name.isEmpty()) {
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â msg += <span class="hljs-string">","</span>;
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â msg += <span class="hljs-keyword">this</span>.name;
 Â  Â  Â  Â  Â  Â  Â   }
 Â  Â  Â  Â  Â  Â  Â  Â msg += <span class="hljs-string">"} inited"</span>;
 Â  Â  Â  Â  Â  Â  Â  Â <span class="hljs-comment">// æ‰“å°æ—¥å¿—</span>
 Â  Â  Â  Â  Â  Â  Â  Â LOG.info(msg);
 Â  Â  Â  Â  Â   }
 Â  Â  Â   }
 Â   }
}
</code></pre>
<p>ç»§ç»­è·Ÿè¸ªæºç ï¼Œæœ€ç»ˆå®šä½åˆ°é—®é¢˜æºäº MySQL é©±åŠ¨åœ¨åˆ›å»ºè¿æ¥æ—¶è°ƒç”¨ <code>InetSocketAddress.getHostName()</code> è¿›è¡Œåå‘ DNS è§£æï¼Œè€—æ—¶æ˜¾è‘—ï¼Œå¯¼è‡´è¿æ¥åˆå§‹åŒ–ç¼“æ…¢</p>
<p>å®Œæ•´çš„é“¾è·¯ï¼š<code>DruidAbstractDataSource#createPhysicalConnection</code> =&gt; ... =&gt; <code>com.mysql.cj.jdbc.ConnectionImpl#getInstance(HostInfo hostInfo)</code> =&gt; <code>ConnectionImpl</code> æ„é€ æ–¹æ³•</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">package</span> com.mysql.cj.jdbc;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ConnectionImpl</span> <span class="hljs-title">implements</span> <span class="hljs-title">JdbcConnection</span>, <span class="hljs-type">SessionEventListener</span>, <span class="hljs-type">Serializable</span> {
 Â  Â <span class="hljs-keyword">public</span> ConnectionImpl(HostInfo hostInfo) throws SQLException {
 Â  Â  Â  Â <span class="hljs-keyword">try</span> {
 Â  Â  Â  Â  Â  Â SocketAddress socketAddress = <span class="hljs-keyword">this</span>.session.getRemoteSocketAddress();
 Â  Â  Â  Â  Â  Â <span class="hljs-keyword">if</span> (InetSocketAddress.<span class="hljs-keyword">class</span>.isInstance(socketAddress)) {
 Â  Â  Â  Â  Â  Â  Â  Â InetSocketAddress inetSocketAddress = (InetSocketAddress) socketAddress;
 Â  Â  Â  Â  Â  Â  Â  Â <span class="hljs-comment">// å…³é”®</span>
 Â  Â  Â  Â  Â  Â  Â  Â <span class="hljs-keyword">this</span>.connectionSpan.setAttribute(
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â TelemetryAttribute.NETWORK_PEER_ADDRESS,
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <span class="hljs-comment">// è·å– hostname å­—æ®µå€¼</span>
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â inetSocketAddress.getHostName()
 Â  Â  Â  Â  Â  Â  Â   );
 Â  Â  Â  Â  Â   }
 Â  Â  Â   }
 Â   }
}
</code></pre>

<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">package</span> java.net;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">InetSocketAddress</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">SocketAddress</span> {

 Â  Â <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">transient</span> InetSocketAddressHolder holder;

 Â  Â <span class="hljs-comment">// Private implementation class pointed to by all public methods.</span>
 Â  Â <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">InetSocketAddressHolder</span> {
 Â  Â  Â  Â <span class="hljs-comment">// The hostname of the Socket Address</span>
 Â  Â  Â  Â <span class="hljs-keyword">private</span> String hostname;
 Â  Â  Â  Â <span class="hljs-comment">// The IP address of the Socket Address</span>
 Â  Â  Â  Â <span class="hljs-keyword">private</span> InetAddress addr;
 Â  Â  Â  Â <span class="hljs-comment">// The port number of the Socket Address</span>
 Â  Â  Â  Â <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> port;

 Â  Â  Â  Â <span class="hljs-keyword">private</span> <span class="hljs-title function_">InetSocketAddressHolder</span><span class="hljs-params">(String hostname, InetAddress addr, <span class="hljs-type">int</span> port)</span> {
 Â  Â  Â  Â  Â  Â <span class="hljs-built_in">this</span>.hostname = hostname;
 Â  Â  Â  Â  Â  Â <span class="hljs-built_in">this</span>.addr = addr;
 Â  Â  Â  Â  Â  Â <span class="hljs-built_in">this</span>.port = port;
 Â  Â  Â   }

 Â  Â  Â  Â <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getPort</span><span class="hljs-params">()</span> {
 Â  Â  Â  Â  Â  Â <span class="hljs-keyword">return</span> port;
 Â  Â  Â   }

 Â  Â  Â  Â <span class="hljs-keyword">private</span> InetAddress <span class="hljs-title function_">getAddress</span><span class="hljs-params">()</span> {
 Â  Â  Â  Â  Â  Â <span class="hljs-keyword">return</span> addr;
 Â  Â  Â   }

 Â  Â  Â  Â <span class="hljs-keyword">private</span> String <span class="hljs-title function_">getHostName</span><span class="hljs-params">()</span> {
 Â  Â  Â  Â  Â  Â <span class="hljs-keyword">if</span> (hostname != <span class="hljs-literal">null</span>)
 Â  Â  Â  Â  Â  Â  Â  Â <span class="hljs-keyword">return</span> hostname;
 Â  Â  Â  Â  Â  Â <span class="hljs-keyword">if</span> (addr != <span class="hljs-literal">null</span>)
 Â  Â  Â  Â  Â  Â  Â  Â <span class="hljs-comment">// âš ï¸ è§¦å‘åå‘ DNS è§£æï¼å†…ç½‘æ—  DNS æœåŠ¡ â†’ é˜»å¡è¶…æ—¶</span>
 Â  Â  Â  Â  Â  Â  Â  Â <span class="hljs-keyword">return</span> addr.getHostName();
 Â  Â  Â  Â  Â  Â <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
 Â  Â  Â   }
 Â   }

 Â  Â <span class="hljs-comment">/**
 Â  Â  * Gets the {<span class="hljs-doctag">@code</span> hostname}.
 Â  Â  * Note: This method may trigger a name service reverse lookup if the
 Â  Â  * address was created with a literal IP address.
 Â  Â  *
 Â  Â  * <span class="hljs-doctag">@return</span>  the hostname part of the address.
 Â  Â  */</span>
 Â  Â <span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> String <span class="hljs-title function_">getHostName</span><span class="hljs-params">()</span> {
 Â  Â  Â  Â <span class="hljs-keyword">return</span> holder.getHostName();
 Â   }
}
</code></pre>
<p>åœ¨ç½‘ä¸Šæœäº†ä¸‹ï¼Œæœ‰å¦‚ä¸‹çš„æ–‡ç« ç‰‡æ®µ</p>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-section"># è§£å†³ Linux ä¸Š Java è·å– hostname å¾ˆæ…¢çš„é—®é¢˜</span>

åœ¨ Linux ç¯å¢ƒä¸­è¿è¡Œ Java åº”ç”¨æ—¶ï¼Œæœ‰æ—¶ä¼šé‡åˆ° <span class="hljs-code">`InetAddress.getLocalHost().getHostName()`</span> æ–¹æ³•æ‰§è¡Œç¼“æ…¢çš„é—®é¢˜ï¼Œä¸¥é‡å½±å“åº”ç”¨å¯åŠ¨é€Ÿåº¦

<span class="hljs-section">## é—®é¢˜åŸå› </span>
Java åœ¨è°ƒç”¨ <span class="hljs-code">`getHostName()`</span> æ—¶ï¼Œä¼šå°è¯•å¯¹æœ¬æœº IP åœ°å€è¿›è¡Œ<span class="hljs-strong">**åå‘ DNS è§£æï¼ˆPTR æŸ¥è¯¢ï¼‰**</span>ï¼Œä»¥è·å–ä¸»æœºåï¼Œè‹¥ DNS æœåŠ¡å™¨ä¸å¯è¾¾ã€æ—  PTR è®°å½•æˆ–ç½‘ç»œå»¶è¿Ÿé«˜ï¼Œè¯¥æ“ä½œå°†é•¿æ—¶é—´é˜»å¡

<span class="hljs-section">## å¸¸è§åœºæ™¯</span>
<span class="hljs-bullet">-</span> Docker / K8S å®¹å™¨ä¸­æœªé…ç½® DNS
<span class="hljs-bullet">-</span> å†…éƒ¨ç½‘ç»œæ— åå‘è§£ææ”¯æŒ
<span class="hljs-bullet">-</span> ä½¿ç”¨çº¯ IP åœ°å€è¿æ¥æ•°æ®åº“ï¼ˆå¦‚ MySQLï¼‰
</code></pre>
<p>çœŸç›¸å¤§ç™½ï¼æˆ‘çš„é¡¹ç›®å¼€å‘ç¯å¢ƒä½äºå…¬å¸å†…ç½‘ï¼Œå®Œå…¨æ— æ³•è®¿é—®å¤–ç½‘ï¼Œæ›´æ— å¤–éƒ¨ DNS æœåŠ¡æ”¯æŒï¼Œä»¥ä¸‹ä¸ºå°è¯• ping å¤–ç½‘çš„è¾“å‡ºç»“æœ</p>
<pre><code class="hljs language-ruby" lang="ruby"><span class="hljs-variable">$ </span>ping www.baidu.com
<span class="hljs-title class_">Ping</span> è¯·æ±‚æ‰¾ä¸åˆ°ä¸»æœº www.baidu.comã€‚è¯·æ£€æŸ¥è¯¥åç§°ï¼Œç„¶åé‡è¯•ã€‚
</code></pre>
<p>é‚£æ€ä¹ˆè§£é‡Š <code>@Bean(name = "logAnalysisDataSource")</code> è¿™ä¸ª DruidDataSource å¯¹è±¡çš„åˆå§‹åŒ–æ—¶é—´ä»… 12 ç§’å‘¢ï¼Ÿè¿™æ˜¯å› ä¸ºå®ƒä½¿ç”¨çš„æ˜¯ <code>jdbc:oceanbase</code> åè®®ä¸ <code>oceanbase-client</code> é©±åŠ¨ï¼Œè¿™ä¸ªé©±åŠ¨åœ¨è¿æ¥å»ºç«‹è¿‡ç¨‹ä¸­ä¸ä¼šè°ƒç”¨ <code>InetSocketAddress.getHostName()</code> æ–¹æ³•ï¼ˆæ²¡çœ‹æºç ï¼Œä»…ä¸ºçŒœæµ‹ï¼Œä½†å…«ä¹ä¸ç¦»åï¼‰</p>
<p>å¦‚ä½•è§£å†³è¿™ä¸ªé—®é¢˜å‘¢ï¼Ÿæœ‰å¦‚ä¸‹ä¸¤ç§æ–¹æ³•ï¼ˆç½‘ä¸Šè¯´æ·»åŠ å‡ ä¸ª JVM å‚æ•°å°±èƒ½è§£å†³ï¼Œå®æµ‹æ— æ•ˆï¼‰</p>
<blockquote>
<p>ä¸Šè¿°é—®é¢˜åœ¨ <a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.csdn.net%2Fqq_33919114%2Farticle%2Fdetails%2F143167989" target="_blank" title="https://blog.csdn.net/qq_33919114/article/details/143167989" ref="nofollow noopener noreferrer">SpringBoot 3 Druid å¯åŠ¨æ…¢æ’æŸ¥ï¼ŒSpringBoot å¯åŠ¨æ…¢ã€æœåŠ¡å¶å‘æ¥å£æ…¢æŸ¥è¯¢ï¼ŒMySQL Connector-j 9.0.0 ç‰ˆæœ¬é—®é¢˜ï¼ŒgetHostName() è¯·æ±‚æ…¢</a> è¿™ç¯‡æ–‡ç« ä¸­ä¹Ÿæåˆ°äº†</p>
</blockquote>
<h2 data-id="heading-2">è§£å†³åŠæ³•ä¸€ï¼šä¿®æ”¹ hosts æ–‡ä»¶</h2>
<ul>
<li>ä¿®æ”¹ hosts æ–‡ä»¶ï¼Œæ·»åŠ åŸŸåæ˜ å°„</li>
</ul>

<pre><code class="hljs language-makefile" lang="makefile">10.xxx.xxx.146 www.<span class="hljs-keyword">define</span>.com
</code></pre>
<ul>
<li>ä»å¯åŠ¨æ—¥å¿—å¯ä»¥çœ‹å‡ºï¼Œé—®é¢˜å®Œç¾è§£å†³</li>
</ul>

<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-attr">[2026-02-07 18:44:04.258]</span> <span class="hljs-selector-attr">[INFO ]</span> <span class="hljs-selector-attr">[com.zaxxer.hikari.HikariDataSource]</span> <span class="hljs-selector-attr">[80]</span> - <span class="hljs-selector-attr">[HikariPool-1 - Starting...]</span>
<span class="hljs-selector-attr">[2026-02-07 18:44:04.582]</span> <span class="hljs-selector-attr">[INFO ]</span> <span class="hljs-selector-attr">[com.zaxxer.hikari.HikariDataSource]</span> <span class="hljs-selector-attr">[82]</span> - <span class="hljs-selector-attr">[HikariPool-1 - Start completed.]</span>

<span class="hljs-selector-attr">[2026-02-07 18:44:09.426]</span> <span class="hljs-selector-attr">[INFO ]</span> <span class="hljs-selector-attr">[com.alibaba.druid.pool.DruidDataSource]</span> <span class="hljs-selector-attr">[1007]</span> - <span class="hljs-selector-attr">[{dataSource-1} inited]</span>

<span class="hljs-selector-attr">[2026-02-07 18:44:22.180]</span> <span class="hljs-selector-attr">[INFO ]</span> <span class="hljs-selector-attr">[com.alibaba.druid.pool.DruidDataSource]</span> <span class="hljs-selector-attr">[1007]</span> - <span class="hljs-selector-attr">[{dataSource-2} inited]</span>

<span class="hljs-selector-attr">[2026-02-07 18:44:23.552]</span> <span class="hljs-selector-attr">[INFO ]</span> <span class="hljs-selector-attr">[com.xxx.WebApplication]</span> <span class="hljs-selector-attr">[61]</span> - <span class="hljs-selector-attr">[Started WebApplication in 24.191 seconds (JVM running for 24.92)]</span>
</code></pre>
<ul>
<li>åŸç†ï¼šå›  <code>InetAddress.getHostName()</code> åœ¨æœ¬åœ° hosts æœ‰æ˜ å°„æ—¶ä¼š<strong>è·³è¿‡ç½‘ç»œ DNS æŸ¥è¯¢</strong>ï¼Œä»è€Œé¿å…é˜»å¡</li>
</ul>
<h2 data-id="heading-3">è§£å†³åŠæ³•äºŒï¼šé™ä½ MySQL é©±åŠ¨ç‰ˆæœ¬</h2>
<ul>
<li>é™ä½è‡³ 8.0.33 ç‰ˆæœ¬ï¼Œå®æµ‹æœ‰æ•ˆ</li>
</ul>

<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.mysql<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>mysql-connector-j<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>8.0.33<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
</code></pre>
<ul>
<li>ä»å¯åŠ¨æ—¥å¿—å¯ä»¥çœ‹å‡ºï¼Œé—®é¢˜å®Œç¾è§£å†³</li>
</ul>

<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-attr">[2026-02-07 18:51:19.582]</span> <span class="hljs-selector-attr">[INFO ]</span> <span class="hljs-selector-attr">[com.zaxxer.hikari.HikariDataSource]</span> <span class="hljs-selector-attr">[80]</span> - <span class="hljs-selector-attr">[HikariPool-1 - Starting...]</span>
<span class="hljs-selector-attr">[2026-02-07 18:51:19.899]</span> <span class="hljs-selector-attr">[INFO ]</span> <span class="hljs-selector-attr">[com.zaxxer.hikari.HikariDataSource]</span> <span class="hljs-selector-attr">[82]</span> - <span class="hljs-selector-attr">[HikariPool-1 - Start completed.]</span>

<span class="hljs-selector-attr">[2026-02-07 18:51:24.718]</span> <span class="hljs-selector-attr">[INFO ]</span> <span class="hljs-selector-attr">[com.alibaba.druid.pool.DruidDataSource]</span> <span class="hljs-selector-attr">[1007]</span> - <span class="hljs-selector-attr">[{dataSource-1} inited]</span>

<span class="hljs-selector-attr">[2026-02-07 18:51:37.035]</span> <span class="hljs-selector-attr">[INFO ]</span> <span class="hljs-selector-attr">[com.alibaba.druid.pool.DruidDataSource]</span> <span class="hljs-selector-attr">[1007]</span> - <span class="hljs-selector-attr">[{dataSource-2} inited]</span>

<span class="hljs-selector-attr">[2026-02-07 18:51:38.433]</span> <span class="hljs-selector-attr">[INFO ]</span> <span class="hljs-selector-attr">[com.xxx.WebApplication]</span> <span class="hljs-selector-attr">[61]</span> - <span class="hljs-selector-attr">[Started WebApplication in 23.6 seconds (JVM running for 24.33)]</span>
</code></pre>
<ul>
<li>ç¿»çœ‹ 8.0.33 ä¸­ ConnectionImpl çš„æºç ï¼Œä¸ä¼šè°ƒç”¨ <code>InetSocketAddress.getHostName()</code> æ–¹æ³•</li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/385985b131054048b8d265fcc2b1d816~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgZGVmaW5lOTUyNw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771129772&amp;x-signature=sm9g23yDAn6PgmNqT8O42SFGnis%3D" alt="1770436368060.png" loading="lazy"/></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[æ·±å…¥ç†è§£ Vue.js æ¸²æŸ“æœºåˆ¶ï¼šä»å£°æ˜å¼åˆ°è™šæ‹Ÿ DOM çš„å®Œæ•´å®ç°]]></title>    <link>https://juejin.cn/post/7603644943351726086</link>    <guid>https://juejin.cn/post/7603644943351726086</guid>    <pubDate>2026-02-08T04:36:23.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7603644943351726086" data-draft-id="7603781883973271571" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="æ·±å…¥ç†è§£ Vue.js æ¸²æŸ“æœºåˆ¶ï¼šä»å£°æ˜å¼åˆ°è™šæ‹Ÿ DOM çš„å®Œæ•´å®ç°"/> <meta itemprop="keywords" content="Vue.js"/> <meta itemprop="datePublished" content="2026-02-08T04:36:23.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="EchoEcho"/> <meta itemprop="url" content="https://juejin.cn/user/2920774267837208"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            æ·±å…¥ç†è§£ Vue.js æ¸²æŸ“æœºåˆ¶ï¼šä»å£°æ˜å¼åˆ°è™šæ‹Ÿ DOM çš„å®Œæ•´å®ç°
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2920774267837208/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    EchoEcho
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-08T04:36:23.000Z" title="Sun Feb 08 2026 04:36:23 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»7åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">ç›¸å…³æ¦‚å¿µï¼š</h2>
<h3 data-id="heading-1">å‘½ä»¤å¼ VS å£°æ˜å¼</h3>
<p>ä»èŒƒå¼ä¸Šæ¥çœ‹ï¼Œè§†å›¾å±‚æ¡†æ¶é€šå¸¸åˆ†ä¸ºï¼š</p>
<ul>
<li><strong>å‘½ä»¤å¼æ¡†æ¶</strong>
<ul>
<li>æ›´åŠ <strong>å…³æ³¨è¿‡ç¨‹</strong>ï¼Œä»£ç æœ¬èº«æè¿°çš„æ˜¯â€œåšäº‹çš„è¿‡ç¨‹â€ï¼Œç¬¦åˆé€»è¾‘ç›´è§‰</li>
<li>
<pre><code class="hljs language-dart" lang="dart">  <span class="hljs-comment">// è‡ªç„¶è¯­è¨€æè¿°èƒ½å¤Ÿä¸ä»£ç äº§ç”Ÿä¸€ä¸€å¯¹åº”çš„å…³ç³»</span>
  <span class="hljs-comment">// ç¤ºä¾‹ï¼š</span>
  <span class="hljs-keyword">const</span>Â divÂ =Â <span class="hljs-built_in">document</span>.<span class="hljs-built_in">querySelector</span>(<span class="hljs-string">'#app'</span>)Â <span class="hljs-comment">// è·å–div</span>
  div.innerTextÂ =Â <span class="hljs-string">'hello world'</span><span class="hljs-comment">// è®¾ç½®æ–‡æœ¬å†…å®¹</span>
  div.addEventListener(<span class="hljs-string">'click'</span>, ()Â =&gt;Â {Â alert(<span class="hljs-string">'ok'</span>) })Â <span class="hljs-comment">// ç»‘å®šç‚¹å‡»äº‹ä»¶</span>
</code></pre>
</li>
</ul>
</li>
<li><strong>å£°æ˜å¼æ¡†æ¶</strong>
<ul>
<li>æ›´åŠ <strong>å…³æ³¨ç»“æœ</strong>ï¼Œä¸»è¦æ˜¯æå‡ä»£ç çš„å¯ç»´æŠ¤æ€§</li>
<li>
<pre><code class="hljs language-less" lang="less">  <span class="hljs-comment">// ç”¨æˆ·æä¾›ä¸€ä¸ªâ€œé¢„æœŸçš„ç»“æœâ€ï¼Œä¸­é—´çš„è¿‡ç¨‹ç”±vue.jså®ç°</span>
  <span class="hljs-comment">// ç¤ºä¾‹</span>
  &lt;<span class="hljs-selector-tag">div</span>Â @<span class="hljs-selector-tag">click</span>="() Â =&gt; <span class="hljs-selector-tag">alert</span>(<span class="hljs-string">'ok'</span>)"&gt;<span class="hljs-selector-tag">hello</span> <span class="hljs-selector-tag">world</span>&lt;/<span class="hljs-selector-tag">div</span>&gt;
</code></pre>
</li>
<li>æ›´æ–°æ—¶æ€§èƒ½æ¶ˆè€— = æ‰¾å‡ºå·®å¼‚çš„æ€§èƒ½æ¶ˆè€— + ç›´æ¥ä¿®æ”¹çš„æ€§èƒ½æ¶ˆè€—</li>
</ul>
</li>
</ul>
<p>å› ä¸ºå£°æ˜å¼æ¡†æ¶åœ¨æ›´æ–°æ—¶æ¯”å‘½ä»¤å¼æ¡†æ¶å¤šäº†â€œ<strong>æ‰¾å‡ºå·®å¼‚</strong>â€çš„è¿‡ç¨‹ï¼Œæ‰€ä»¥å£°æ˜å¼ä»£ç çš„æ€§èƒ½ä¸ä¼šä¼˜äºå‘½ä»¤å¼ä»£ç çš„æ€§èƒ½ã€‚è€Œå¯¹æ¯”å‘½ä»¤å¼ä»£ç ï¼Œå£°æ˜å¼ä»£ç åˆå…·æœ‰æ›´å¼ºçš„å¯ç»´æŠ¤æ€§ï¼Œæ›´åŠ çš„ç›´è§‚ã€‚æ‰€ä»¥æ¡†æ¶è¦åšçš„å°±æ˜¯ï¼š<strong>åœ¨ä¿æŒå¯ç»´æŠ¤æ€§çš„åŒæ—¶è®©æ€§èƒ½æŸå¤±æœ€å°åŒ–</strong>ã€‚</p>
<p>åœ¨å¼€å‘è¿‡ç¨‹ä¸­ï¼ŒåŸç”Ÿ<code>JS</code>æ“ä½œDOMï¼Œè™šæ‹ŸDOMå’Œ<code>innerHTML</code>ä¸‰è€…æ“ä½œé¡µé¢çš„æ€§èƒ½éƒ½ä¸åˆ›å»ºé¡µé¢ã€æ›´æ–°é¡µé¢ï¼Œé¡µé¢å¤§å°ã€å˜æ›´éƒ¨åˆ†çš„å¤§å°æœ‰å…³ç³»ï¼Œé€‰æ‹©å“ªç§æ›´æ–°ç­–ç•¥ï¼Œéœ€è¦ç»“åˆå¿ƒæ™ºè´Ÿæ‹…ã€å¯ç»´æŠ¤æ€§ç­‰å› ç´ ç»¼åˆè€ƒè™‘ã€‚</p>
<p><strong>æ€§èƒ½å¯¹æ¯”</strong></p>

































<table><thead><tr><th>æ›´æ–°ç­–ç•¥</th><th>å¿ƒæ™ºè´Ÿæ‹…</th><th>å¯ç»´æŠ¤æ€§</th><th>æ€§èƒ½</th><th>é€‚ç”¨åœºæ™¯</th></tr></thead><tbody><tr><td>åŸç”Ÿ<code>JS</code></td><td>é«˜</td><td>ä½</td><td>æœ€é«˜</td><td>ç®€å•é¡µé¢</td></tr><tr><td>è™šæ‹ŸDOM</td><td>ä¸­</td><td>é«˜</td><td>ä¸­</td><td>å¤æ‚åº”ç”¨</td></tr><tr><td><code>innerHTML</code></td><td>ä½</td><td>ä¸­</td><td>ä½</td><td>é™æ€å†…å®¹</td></tr></tbody></table>
<h3 data-id="heading-2">è¿è¡Œæ—¶ VS ç¼–è¯‘æ—¶</h3>
<blockquote>
<p>ä»¥ä¸Šæ–‡ä¸­å£°æ˜å¼æ¡†æ¶ç¤ºä¾‹ä»£ç ä¸ºä¾‹ï¼Œç®€å•æè¿°<code>vue.js</code>çš„æ¸²æŸ“è¿‡ç¨‹ï¼š</p>
<p>1ã€é€šè¿‡<strong>ç¼–è¯‘å™¨ã€compileã€‘</strong> è§£ææ¨¡ç‰ˆå­—ç¬¦ä¸²è¯†åˆ«åˆ°éœ€è¦åˆ›å»ºä¸€ä¸ªDOMå…ƒç´ ï¼Œè®¾ç½®å†…å®¹ä¸º<code>hello world</code>ï¼Œå¹¶ä¸ºå…¶ç»‘å®šä¸€ä¸ªç‚¹å‡»äº‹ä»¶ï¼Œå®Œæˆåè¾“å‡ºä¸€ä¸ªè™šæ‹ŸDOMã€å³ä¸€ä¸ªæè¿°çœŸå®DOMçš„<code>js</code>å¯¹è±¡ã€‘</p>
<p>2ã€é€šè¿‡<strong>æ¸²æŸ“å‡½æ•°ã€renderã€‘</strong> å°†è™šæ‹ŸDOMæ¸²æŸ“æˆçœŸå®çš„DOMæ ‘æŒ‚è½½åˆ°æŒ‡å®šå…ƒç´ ä¸Šï¼Œå®Œæˆæ¸²æŸ“</p>
</blockquote>
<p>å½“è®¾è®¡ä¸€ä¸ªæ¡†æ¶çš„æ—¶å€™ï¼Œæœ‰ä¸‰ç§é€‰æ‹©</p>
<ul>
<li>çº¯è¿è¡Œæ—¶
<ul>
<li>ä¸Šé¢æåˆ°çš„å¦‚æœ<strong>åªç”¨æ¸²æŸ“å‡½æ•°</strong>ï¼Œç”±ç”¨æˆ·ç›´æ¥æä¾›è™šæ‹ŸDOMä½œä¸ºå…¥å‚ï¼Œå°±æ˜¯æ‰€è°“çš„<strong>çº¯è¿è¡Œæ—¶æ¡†æ¶</strong></li>
<li>æ²¡æœ‰ç¼–è¯‘è¿‡ç¨‹ï¼Œä¹Ÿå°±æ— æ³•æ·»åŠ ç›¸å…³çš„ä¼˜åŒ–æ‰‹æ®µï¼Œæ¯”å¦‚tree-shaking</li>
</ul>
</li>
<li>è¿è¡Œæ—¶ + ç¼–è¯‘æ—¶
<ul>
<li>ä»£ç è¿è¡Œæ—¶ç”±ç¼–è¯‘å™¨å°†è¯­ä¹‰åŒ–ä»£ç ç¼–è¯‘æˆç›®æ ‡æ•°æ®å¹¶ä½œä¸ºæ¸²æŸ“å‡½æ•°çš„å…¥å‚ï¼Œè¿™ç§æ“ä½œå°±æ˜¯Â <strong>è¿è¡Œæ—¶ç¼–è¯‘æ¡†æ¶</strong>ã€‚å®ƒæ—¢æ”¯æŒè¿è¡Œæ—¶ã€å³ç”¨æˆ·ç›´æ¥æä¾›æ•°æ®å¯¹è±¡ã€‘ï¼Œåˆæ”¯æŒç¼–è¯‘æ—¶ã€å³å°†ç”¨æˆ·è¯­ä¹‰åŒ–ä»£ç ç¼–è¯‘ä¸ºç›®æ ‡æ•°æ®ã€‘</li>
<li>ç”±äºä»£ç è¿è¡Œæ—¶æ‰å¼€å§‹ç¼–è¯‘ä¼šäº§ç”Ÿä¸€å®šçš„æ€§èƒ½å¼€é”€ï¼Œå› æ­¤å¯ä»¥åœ¨æ„å»ºæ—¶å°±æ‰§è¡Œç¼–è¯‘æ“ä½œï¼Œä»¥æå‡æ€§èƒ½ã€‚ã€åœ¨ Vue 3.5.22 ä¸­ï¼Œè¿è¡Œæ—¶ç¼–è¯‘é€šè¿‡Â <code>@vue/compiler-dom</code>Â å®ç°ï¼Œæ„å»ºæ—¶ç¼–è¯‘é€šè¿‡Â <code>@vitejs/plugin-vue</code>Â å®ç°ã€‘</li>
</ul>
</li>
<li>çº¯ç¼–è¯‘æ—¶
<ul>
<li>å¦‚æœçœç•¥ä¸Šé¢çš„æ¸²æŸ“å‡½æ•°ï¼Œç›´æ¥å°†ç”¨æˆ·ä»£ç é€šè¿‡ç¼–è¯‘å™¨å®ŒæˆçœŸå®DOMçš„æ¸²æŸ“ï¼Œå°±æ˜¯ä¸€ä¸ªçº¯ç¼–è¯‘æ—¶æ¡†æ¶ã€‚å³ä¸æ”¯æŒä»»ä½•è¿è¡Œæ—¶å†…å®¹ã€‚</li>
<li>ç”±äºä¸éœ€è¦ä»»ä½•è¿è¡Œæ—¶ï¼Œè€Œæ˜¯ç›´æ¥å°†ä»£ç ç¼–è¯‘æˆå¯æ‰§è¡Œçš„<code>js</code>ä»£ç ï¼Œå› ä¸ºæ€§èƒ½å¯èƒ½ä¼šæ›´å¥½ï¼Œä½†æ˜¯æœ‰æŸçµæ´»æ€§ã€‚</li>
</ul>
</li>
</ul>
<p><code>Vue.js</code>å°±æ˜¯å†…éƒ¨å°è£…äº†å‘½ä»¤å¼ä»£ç ä»è€Œå®ç°çš„é¢å‘ç”¨æˆ·çš„å£°æ˜å¼æ¡†æ¶ï¼›æ˜¯è¿è¡Œæ—¶+ç¼–è¯‘æ—¶æ¶æ„ï¼Œç›®çš„åœ¨äºä¿æŒçµæ´»æ€§çš„åŸºç¡€ä¸Šå°½å¯èƒ½çš„ä¼˜åŒ–æ€§èƒ½</p>
<p>å…¶ä¸­ç»„ä»¶çš„å®ç°ä¾èµ–äº<strong>æ¸²æŸ“å™¨</strong>ï¼Œç»„ä»¶ä¸­æ¨¡æ¿çš„ç¼–è¯‘ä¾èµ–äº<strong>ç¼–è¯‘å™¨</strong>ã€‚<strong>è™šæ‹ŸDOM</strong>ä½œä¸ºåª’ä»‹åœ¨æ•´ä¸ªæ¸²æŸ“è¿‡ç¨‹ä¸­ä½œä¸ºç»„ä»¶çœŸå®DOMçš„è½½ä½“ååŠ©å®ç°å†…å®¹æ¸²æŸ“å’Œæ›´æ–°ã€‚</p>
<h3 data-id="heading-3">è™šæ‹ŸDOMã€<code>vnode</code>ã€‘</h3>
<p>è™šæ‹ŸDOM æ˜¯ä¸€ä¸ªç”¨æ¥æè¿°çœŸå®DOMçš„<code>js</code>å¯¹è±¡ã€‚</p>
<p>ä½¿ç”¨è™šæ‹ŸDOMçš„å¥½å¤„æ˜¯å¯ä»¥å°†ä¸åŒç±»å‹çš„æ ‡ç­¾ã€å±æ€§åŠå­èŠ‚ç‚¹æŠ½è±¡æˆä¸€ä¸ªå¯¹è±¡ï¼Œè¿™æ ·æè¿°<code>UI</code>å¯ä»¥æ›´åŠ çµæ´»ã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// ä¸Šæ–‡ä¸­çš„ä»£ç å¯ä»¥ç”¨ä»¥ä¸‹å½¢å¼è¡¨ç¤º</span>
<span class="hljs-keyword">const</span>Â vnode=Â {
Â  Â  <span class="hljs-comment">// æ ‡ç­¾åç§°</span>
Â  Â  <span class="hljs-attr">tag</span>:Â <span class="hljs-string">'div'</span>,
Â  Â  <span class="hljs-comment">// æ ‡ç­¾å±æ€§</span>
Â  Â  <span class="hljs-attr">props</span>: {
Â  Â  Â  Â Â <span class="hljs-attr">onClick</span>: <span class="hljs-function">()Â =&gt;</span><span class="hljs-title function_">alert</span>(<span class="hljs-string">'ok'</span>)
Â  Â  },
Â  Â Â <span class="hljs-comment">// å­èŠ‚ç‚¹</span>
Â  Â Â <span class="hljs-attr">children</span>:Â <span class="hljs-string">'hello world'</span>
}
</code></pre>
<blockquote>
<p><code>vue</code>ä¸­çš„<code>h</code>å‡½æ•°å°±æ˜¯ä¸€ä¸ªè¾…åŠ©åˆ›å»ºè™šæ‹ŸDOMçš„å·¥å…·å‡½æ•°</p>
</blockquote>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> { h } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {
Â  Â  <span class="hljs-title function_">render</span>(<span class="hljs-params"/>) {
Â  Â  Â  Â  <span class="hljs-keyword">return</span> <span class="hljs-title function_">h</span>(<span class="hljs-string">'div'</span>, { <span class="hljs-attr">onClick</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">alert</span>(<span class="hljs-string">'ok'</span>) }, <span class="hljs-string">'hello world'</span>)
Â  Â  }
}

<span class="hljs-comment">// ç­‰ä»·äº</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {
Â  Â  <span class="hljs-title function_">render</span>(<span class="hljs-params"/>) {
Â  Â  Â  Â  <span class="hljs-keyword">return</span> {
Â  Â Â Â  Â Â Â  Â Â <span class="hljs-attr">tag</span>: <span class="hljs-string">'div'</span>,
Â  Â Â Â  Â Â Â  Â Â <span class="hljs-attr">props</span>: {
Â  Â Â Â  Â Â Â  Â Â Â  Â Â <span class="hljs-attr">onClick</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">alert</span>(<span class="hljs-string">'ok'</span>)
Â  Â Â Â  Â Â  Â Â Â },
Â  Â Â Â  Â Â Â  Â Â <span class="hljs-attr">children</span>: <span class="hljs-string">'hello world'</span>
Â  Â Â Â  Â Â }
Â  Â Â }
}

<span class="hljs-comment">// ç­‰ä»·äº</span>
&lt;divÂ <span class="hljs-meta">@click</span>=<span class="hljs-string">"() =&gt; alert('ok')"</span>&gt;hello world&lt;/div&gt;
</code></pre>
<p>è™šæ‹ŸDOMçš„æ€§èƒ½ä¼˜åŠ¿ï¼š</p>
<ul>
<li>æ‰¹é‡æ›´æ–°ï¼šå¯ä»¥å°†å¤šæ¬¡DOMæ“ä½œåˆå¹¶ä¸ºä¸€æ¬¡</li>
<li>è·¨å¹³å°ï¼šåŒä¸€å¥—ä»£ç å¯ä»¥æ¸²æŸ“åˆ°ä¸åŒå¹³å°</li>
<li>ä¼˜åŒ–ç­–ç•¥ï¼šé€šè¿‡<code>diff</code>ç®—æ³•æœ€å°åŒ–DOMæ“ä½œ</li>
</ul>
<h3 data-id="heading-4">ç»„ä»¶</h3>
<p>ç»„ä»¶å°±æ˜¯ä¸€ç»„DOMå…ƒç´ çš„å°è£…ï¼Œå®ƒå¯ä»¥æ˜¯ä¸€ä¸ªè¿”å›è™šæ‹ŸDOMçš„å‡½æ•°ï¼Œä¹Ÿå¯ä»¥æ˜¯ä¸€ä¸ªå¯¹è±¡ã€‚ç»„ä»¶çš„è¿”å›å€¼ä¹Ÿæ˜¯è™šæ‹ŸDOMï¼Œå®ƒä»£è¡¨ç»„ä»¶è¦æ¸²æŸ“çš„å†…å®¹ã€‚</p>
<h3 data-id="heading-5">ç¼–è¯‘å™¨ã€compileã€‘</h3>
<p>ç¼–è¯‘å™¨çš„ä½œç”¨æ˜¯å°†ç»„ä»¶æ¨¡æ¿ã€<code>&lt;template&gt;</code>ã€‘ç¼–è¯‘ä¸ºæ¸²æŸ“å‡½æ•°å¹¶æ·»åŠ åˆ°<code>&lt;script&gt;</code>æ ‡ç­¾å—çš„ç»„ä»¶å¯¹è±¡ä¸Š</p>
<pre><code class="hljs language-xml" lang="xml">// demo.vue
<span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
&lt;div@click="handler"&gt;
Â  Â  Â  Â  hello world
Â  Â Â <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">
exportdefaultÂ {
Â  Â  Â  Â Â <span class="hljs-title function_">data</span>(<span class="hljs-params"/>) { }
Â  Â  Â  Â Â <span class="hljs-attr">methods</span>: {
Â  Â  Â  Â  Â  Â Â <span class="hljs-attr">handler</span>: <span class="hljs-function">()Â =&gt;</span><span class="hljs-title function_">alert</span>(<span class="hljs-string">'ok'</span>)
Â  Â  Â  Â  }
Â  Â  }
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
</code></pre>
<p>ç»„ä»¶ç¼–è¯‘åç»“æœï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript">exportdefaultÂ {
Â  Â Â <span class="hljs-title function_">data</span>(<span class="hljs-params"/>) {},
Â  Â Â <span class="hljs-attr">methods</span>: {
Â  Â Â Â  Â Â <span class="hljs-attr">handler</span>: <span class="hljs-function">()Â =&gt;</span><span class="hljs-title function_">alert</span>(<span class="hljs-string">'ok'</span>)
Â  Â Â },
Â  Â Â <span class="hljs-title function_">render</span>(<span class="hljs-params"/>) {
Â  Â Â Â  Â Â <span class="hljs-keyword">return</span>Â <span class="hljs-title function_">_createElementVNode</span>(<span class="hljs-string">'div'</span>, {Â <span class="hljs-attr">onClick</span>:Â handlerÂ },Â <span class="hljs-string">'hello world'</span>,Â -<span class="hljs-number">1</span><span class="hljs-comment">/* HOISTED */</span>)
Â  Â Â }
}
</code></pre>
<p>æ— è®ºæ˜¯ä½¿ç”¨æ¨¡æ¿è¿˜æ˜¯ç›´æ¥æ‰‹å†™æ¸²æŸ“å‡½æ•°ï¼Œå¯¹äºä¸€ä¸ªç»„ä»¶æ¥è¯´ï¼Œå®ƒè¦æ¸²æŸ“çš„å†…å®¹æœ€ç»ˆéƒ½æ˜¯é€šè¿‡æ¸²æŸ“å‡½æ•°äº§ç”Ÿçš„ã€‚ç„¶åå†å°†æ¸²æŸ“å‡½æ•°è¿”å›çš„è™šæ‹ŸDOMä½œä¸ºæ¸²æŸ“å™¨çš„å…¥å‚ï¼Œè¿›è¡ŒçœŸå®DOMçš„æ¸²æŸ“</p>
<p><code>Vue3</code>çš„ç¼–è¯‘ä¼˜åŒ–ï¼š</p>
<ul>
<li>é™æ€æå‡ï¼šå°†é™æ€å†…å®¹æå‡åˆ°æ¸²æŸ“å‡½æ•°å¤–éƒ¨</li>
<li>è¡¥ä¸æ ‡è®°ï¼šä¸ºåŠ¨æ€å†…å®¹æ·»åŠ æ ‡è®°ï¼Œä¼˜åŒ–<code>diff</code>è¿‡ç¨‹ã€é€šè¿‡åœ¨è™šæ‹ŸDOMä¸­æ·»åŠ æ ‡è®°å®ç°ã€‘</li>
<li><code>tree-shaking</code>ï¼šç§»é™¤æœªä½¿ç”¨ä»£ç </li>
</ul>
<h3 data-id="heading-6">æ¸²æŸ“å™¨ã€rendererã€‘</h3>
<p>æ¸²æŸ“å™¨çš„ä½œç”¨å°±æ˜¯é€’å½’éå†è™šæ‹ŸDOMå¯¹è±¡ï¼Œå¹¶è°ƒç”¨åŸç”Ÿ<code>DOM API</code>æ¥å®ŒæˆçœŸå®DOMçš„åˆ›å»ºã€‚</p>
<p>æ¸²æŸ“å™¨çš„ç²¾é«“åœ¨äºåç»­çš„æ›´æ–°ï¼Œå®ƒä¼šé€šè¿‡<code>Diff</code>ç®—æ³•å¯»æ‰¾å¹¶ä¸”åªæ›´æ–°å˜åŒ–å†…å®¹ã€‚</p>
<p>å¤§è‡´å®ç°æ€è·¯å¦‚ä¸‹ï¼š</p>
<ul>
<li>å¦‚æœä¸æ˜¯å†…å®¹å˜æ›´ï¼š</li>
<li>
<ul>
<li>æ ¹æ®<code>vnode.tag</code>åˆ›å»ºå¯¹åº”DOMå…ƒç´ </li>
<li>éå†<code>vnode.props</code>å¯¹è±¡ï¼Œå¦‚æœ<code>key</code>ä»¥<code>on</code>å­—ç¬¦å¼€å¤´ï¼Œè¯´æ˜å®ƒæ˜¯ä¸€ä¸ªäº‹ä»¶ï¼Œè°ƒç”¨<code>addEventListener</code>ç»‘å®šäº‹ä»¶å¤„ç†å‡½æ•°ï¼›å¦åˆ™ä½œä¸ºå±æ€§æ·»åŠ åˆ°DOMå…ƒç´ ä¸Š</li>
<li>å¤„ç†<code>children</code>ï¼Œå¦‚æœæ˜¯å­—ç¬¦ä¸²ï¼Œå°±åˆ›å»ºæ–‡æœ¬èŠ‚ç‚¹ï¼›å¦‚æœæ˜¯æ•°ç»„å°±é€’å½’è°ƒç”¨<code>render</code>ç»§ç»­æ¸²æŸ“ï¼Œæœ€åæŠŠåˆ›å»ºçš„å…ƒç´ æŒ‚è½½åˆ°æ–°åˆ›å»ºçš„å…ƒç´ å†…</li>
</ul>
</li>
</ul>

<ul>
<li>å¦åˆ™å…ˆæ‰¾å‡º<code>vnode</code>å¯¹è±¡çš„å˜æ›´ç‚¹ï¼Œå¹¶ä¸”åªæ›´æ–°å˜æ›´çš„å†…å®¹</li>
</ul>
<h3 data-id="heading-7">ç»„ä»¶æ¸²æŸ“è¿‡ç¨‹è¯¦è§£ï¼š</h3>
<h5 data-id="heading-8"><code>vite</code>ã€<code>@vitejs/plugin-vue</code>å’Œ<code>vue-core</code>çš„å…³ç³»</h5>
<ul>
<li>
<p><code>vite</code>ä¸­ä½¿ç”¨äº†<code>@vitejs/plugin-vue</code>æ¥å¤„ç†<code>vue</code>ç»„ä»¶</p>
</li>
<li>
<p><code>@vitejs/plugin-vue</code>ä¸­é›†æˆäº†<code>vue-core</code>ä¸­çš„<code>compiler-sfc</code>ç”¨äºè§£æç¼–è¯‘<code>Vue</code>ç»„ä»¶</p>
</li>
<li>
<p><code>compiler-sfc</code>ä¸­è°ƒç”¨äº†<code>compiler-core</code>ä¸­çš„åŸºç¡€é€»è¾‘è¿›è¡Œç»„ä»¶çš„ç¼–è¯‘å’Œæ¸²æŸ“</p>
</li>
</ul>
<p>å½“æˆ‘ä»¬æ–°å»ºå¹¶å¯åŠ¨<code>vue</code>é¡¹ç›®åï¼Œå†…å®¹æ˜¯å¦‚ä½•æ¸²æŸ“çš„ï¼Œåˆæ˜¯å¦‚ä½•å®æ—¶æ›´æ–°çš„ï¼Ÿ</p>
<h4 data-id="heading-9">åˆ›å»ºå¹¶å¯åŠ¨ä¸€ä¸ª<code>Vue</code>åº”ç”¨Â </h4>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-comment">// åˆ›å»ºæ–°é¡¹ç›®</span>
npm create vue@latest
<span class="hljs-comment">// è¿›å…¥é¡¹ç›®åå®‰è£…ä¾èµ–</span>
npm install
<span class="hljs-comment">// å¯åŠ¨ï¼Œå®é™…æ‰§è¡Œçš„æ˜¯viteå‘½ä»¤</span>
npm run dev
</code></pre>
<h4 data-id="heading-10">å½“é¡¹ç›®è¿è¡Œ<code>npm run dev</code>å‘½ä»¤æ—¶æ‰§è¡Œå†…å®¹å¦‚ä¸‹ï¼š</h4>
<h4 data-id="heading-11">ç¼–è¯‘é˜¶æ®µï¼š</h4>
<h5 data-id="heading-12">å¯åŠ¨ä¸€ä¸ª<code>vite</code>å¼€å‘æœåŠ¡å™¨ï¼Œæµè§ˆå™¨ä¼šé€šè¿‡è¿™ä¸ªæœåŠ¡å™¨æ¥è®¿é—®æ­¤é¡¹ç›®çš„ç½‘é¡µå’Œä»£ç </h5>
<p><code>vite</code>æ˜¯ä¸€ä¸ªé€šç”¨çš„æ„å»ºå·¥å…·ï¼Œ<code>vite</code>æœ¬èº«å¹¶ä¸ç›´æ¥å¤„ç†<code>.vue</code>æ–‡ä»¶ï¼Œè€Œæ˜¯é€šè¿‡æ’ä»¶ç³»ç»Ÿæ¥å¤„ç†å„ç§ç±»å‹æ–‡ä»¶ï¼Œå…¶ä¸­<code>@vitejs/plugin-vue</code>å°±æ˜¯ç”¨æ¥å¤„ç†<code>vue</code>å•æ–‡ä»¶ç»„ä»¶çš„</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2284b50fb4e44ecf82dc5f4f566f79d8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRWNob0VjaG8=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771130182&amp;x-signature=AavXU%2B6fWQqANaT9e4c2mzqjgv8%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<h4 data-id="heading-13">æ„å»ºæ—¶é˜¶æ®µ</h4>
<p><code>Vite</code>æ¥æ”¶åˆ°ç»„ä»¶è¯·æ±‚ï¼Œä¼šæ‰§è¡Œæ’ä»¶ã€<code>@vitejs/plugin-vue</code>ã€‘çš„<code>load</code>é’©å­å‡½æ•°ï¼Œå†æ‰§è¡Œ<code>Transform</code>é’©å­å‡½æ•°</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4cf498d2125e4627a484df191975b452~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRWNob0VjaG8=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771130182&amp;x-signature=e9M3QhwkXxxJqjhJldPe1Yh7keQ%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<p>åœ¨ä¸Šå›¾é’©å­å‡½æ•°æ‰§è¡Œè¿‡ç¨‹ä¸­è§¦å‘äº†<code>compiler-sfc</code>ç›¸å…³æ–¹æ³•çš„æ‰§è¡Œ</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/09df4edbc402409e937d769740850d74~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRWNob0VjaG8=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771130182&amp;x-signature=RUiB%2B7mQIj5jXah01ftQpboNZGE%3D" alt="å›¾ç‰‡" loading="lazy"/><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4ea11c3f85d34604b44722b154aca173~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRWNob0VjaG8=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771130182&amp;x-signature=8KxgD1chNHz7Q%2FBEFdHKTzN54Ss%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<h5 data-id="heading-14">ç›‘å¬ç»„ä»¶å˜åŒ–</h5>
<p><code>@Vitejs/plugin-vue</code>æ’ä»¶çš„æ ¸å¿ƒå…¥å£æ–‡ä»¶ã€<code>packages/plugin-vue/src/index.ts</code>ã€‘ä¸­å®šä¹‰äº†<code>Vite</code>æ’ä»¶çš„æ‰€æœ‰é’©å­å‡½æ•°ï¼Œå…¶ä¸­<code>handleHotUpdate</code>é’©å­æ˜¯<code>Vite</code>æä¾›çš„çƒ­æ›´æ–°å¤„ç†å‡½æ•°ï¼Œå½“<code>Vue</code>æ–‡ä»¶å‘ç”Ÿå˜åŒ–æ—¶ï¼Œ<code>Vite</code>ä¼šè‡ªåŠ¨è°ƒç”¨è¿™ä¸ªé’©å­ï¼Œæ­¤æ—¶æ’ä»¶ä¼šæ£€æŸ¥å˜åŒ–çš„æ–‡ä»¶æ˜¯å¦ä¸º<code>Vue</code>ç»„ä»¶ï¼Œå¦‚æœæ˜¯åˆ™è°ƒç”¨ä¸“é—¨çš„<code>handleHotUpdateå‡½æ•°</code>ã€<code>packages/plugin-vue/src/handleHotUpdate.ts</code>ã€‘</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c129e02641f14c62ad5dbc3c1a888d4e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRWNob0VjaG8=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771130182&amp;x-signature=MUFBcSJ%2FoHSh66u64Jt1zUsFrZg%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<p>æœ€ç»ˆå°†è¿”å›</p>
<pre><code class="hljs language-c" lang="c">SFCTemplateCompileResults ï¼š {
Â  Â  code: <span class="hljs-built_in">string</span>, <span class="hljs-comment">// æ¸²æŸ“å‡½æ•°ä»£ç </span>
Â  Â  ast?: RootNode,Â <span class="hljs-comment">//Â æŠ½è±¡è¯­æ³•æ ‘</span>
Â  Â Â preamble?: <span class="hljs-built_in">string</span>,Â <span class="hljs-comment">//Â é¢„å¤„ç†ä»£ç </span>
Â  Â Â source: <span class="hljs-built_in">string</span>,Â <span class="hljs-comment">//Â è¾“å…¥æº</span>
Â  Â Â tips: <span class="hljs-built_in">string</span>[],Â <span class="hljs-comment">//Â æç¤º</span>
Â  Â Â errors: (<span class="hljs-built_in">string</span> | CompilerError)[],Â <span class="hljs-comment">//Â é”™è¯¯</span>
Â  Â Â <span class="hljs-built_in">map</span>?: RawSourceMap,Â <span class="hljs-comment">//Â æºæ˜ å°„</span>
}
</code></pre>
<p>è¿™ä¸ªé˜¶æ®µä¼šå°†<code>.vue</code>æ–‡ä»¶è½¬æ¢ä¸º<code>js</code>ä»£ç ï¼Œç”Ÿæˆçš„æ˜¯æ¸²æŸ“å‡½æ•°çš„å­—ç¬¦ä¸²</p>
<h4 data-id="heading-15">è¿è¡Œæ—¶é˜¶æ®µ</h4>
<p>å½“æµè§ˆå™¨åŠ è½½å¹¶æ‰§è¡Œè¿™äº›<code>js</code>ä»£ç æ—¶ï¼Œå°±ä¼šå‘ç”ŸçœŸæ­£çš„æ¸²æŸ“è¿‡ç¨‹</p>
<pre><code class="hljs language-scss" lang="scss">åº”ç”¨å¯åŠ¨ -&gt; <span class="hljs-built_in">createApp</span>() -&gt; app<span class="hljs-selector-class">.mount</span>() -&gt; <span class="hljs-built_in">render</span>() -&gt; <span class="hljs-built_in">patch</span>() -&gt; <span class="hljs-built_in">mountElement</span>() -&gt; çœŸå®DOM
</code></pre>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/59b801a153e24563ae174e29b29b870e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRWNob0VjaG8=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771130182&amp;x-signature=I5TwTb1ZBF42SwbAYwPJX7dWxiA%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<p>åˆ°æ­¤å°±å®Œæˆäº†<code>vue</code>ä¸­åŸºæœ¬çš„æ¸²æŸ“è¿‡ç¨‹ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ä¸»ç®¡:â€äººå®¶ Node æ¡†æ¶éƒ½ç”¨ Nest.js äº† , ä½ æ€ä¹ˆè¿˜åœ¨ç”¨ Express ?â€œ]]></title>    <link>https://juejin.cn/post/7603688142004617225</link>    <guid>https://juejin.cn/post/7603688142004617225</guid>    <pubDate>2026-02-08T04:43:22.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7603688142004617225" data-draft-id="7603651855236595721" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ä¸»ç®¡:â€äººå®¶ Node æ¡†æ¶éƒ½ç”¨ Nest.js äº† , ä½ æ€ä¹ˆè¿˜åœ¨ç”¨ Express ?â€œ"/> <meta itemprop="keywords" content="å‰ç«¯,åç«¯,é¢è¯•"/> <meta itemprop="datePublished" content="2026-02-08T04:43:22.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="åƒå¯»girling"/> <meta itemprop="url" content="https://juejin.cn/user/2276467567770442"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ä¸»ç®¡:â€äººå®¶ Node æ¡†æ¶éƒ½ç”¨ Nest.js äº† , ä½ æ€ä¹ˆè¿˜åœ¨ç”¨ Express ?â€œ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2276467567770442/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    åƒå¯»girling
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-08T04:43:22.000Z" title="Sun Feb 08 2026 04:43:22 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»10åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;color:rgba(46,36,36,.87);overflow-x:hidden}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{margin-bottom:5px;font-size:30px;font-weight:500}.markdown-body h1:before{content:"#";margin-right:10px;color:#1976d2}.markdown-body h2{font-size:28px;font-weight:400;border-left:5px solid #454545;margin-top:20px;padding-left:10px;transition:all .3s ease-in-out}.markdown-body h2:hover{border-color:#1976d2}.markdown-body h3{font-size:24px;font-weight:400;margin-top:15px;padding-bottom:0}.markdown-body h4{font-size:20px;font-weight:500}.markdown-body h5{font-size:16px}.markdown-body h6{margin-top:5px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body h2:first-letter,.markdown-body h3:first-letter,.markdown-body p:first-letter{text-transform:capitalize}.markdown-body em{text-emphasis:dot;text-emphasis-position:under}.markdown-body img{display:block;margin:0 auto!important;max-width:100%;border-radius:2px;box-shadow:0 2px 4px -1px rgba(0,0,0,.2),0 4px 5px 0 rgba(0,0,0,.14),0 1px 10px 0 rgba(0,0,0,.12)!important}.markdown-body hr{position:relative;width:98%;height:1px;border:none;margin-top:32px;margin-bottom:32px;background-image:linear-gradient(90deg,#ddd,#999,#ddd);overflow:visible}.markdown-body hr:after{content:"";position:absolute;margin:auto;left:0;right:0;bottom:0;top:0;display:inline-block;width:60px;height:20px;background:#fff;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAgCAYAAABgrToAAAADoklEQVRYR82XTYgcRRTHf2933Q1RjAa9eFO8JHoJ8RQVBQ2iBwXBET0YEUTXNVmNQtTpmeqaWV0XNRq/o4KoECSCEPSg4CF+BYUkIIiCoCJCPIhC/Ihh2Z0nVV27VnZnenumW9i6ddV7//frV69fVQurfMgq56NawFTPAU6QyomqXrw6wIZeyhCPebA5buNR+akKyGoAjd6BshthnYdSjqNcRVuOlIUsD2j0SuA94IwuMHdh5ZUykOUBXfSGbmKI54EtAeYIHSZoy5dl4JxvNYBOKdW1KE8BQ8AkVk6WhasWsAiN0TX9gveXQaPP+Aytpc4u+bMI06JNohsYYYYOR2lJWtS3OKDRfcAtQfgDoI6Vo4UCGb0OmAEuDvZvYmVbEd/igC3dzDz7gQu8sPA9kJDK27mBmjqBeLjTg90PDFOjWawFFQd06kZHEfaj3LAIpTRpSXsZ5E06zEYP9sDimnAApYaV2SLZG/wjMeqAkijwW4xQJ5Gf/ZzRC8OW3hiBTGGlURRswW55Bh/Ssxljrwew8l1PQaM14GngvGDzBUKdDsMeTtgU5o8B92PFlUf3YXUrHa7Fys6lBqcCGnX15YQ2A18FyPd7Crd1A3M8C1wdbH4DD3hWeP6IEXbQkG97ajR1HPFnuPP5jFFq1OWX7hl8WM9l1AO648uNfwLk7tytMeogty+xeQ4rO3r6bdcx1nuwOGsHmaXGtPzae4uzGnLH1kQkvpdZGrHjssBZJrL+pqS05KWc8tgITAPXRzYvYOXe/C2OV43eDcRBDtIhoS2f9wzc0Cv8Wls+zoFzUC5zF0U241h5uZtPfptp6OUM8wbK+cH5GEpCS17P3fJei0Z3+npTxryJ8CPzbKMtn/ZyWbkPGl0PuFPkmkjkcb4h4R2ZLwRq1H0ALmvjkf2HwK1Y+T1PY2XABe/sHJ6MxN5lnoSpnC/UGbsTaI5phK2R7x6s3Ffk5YoDOrWm3onwJHBmEP86bPmBrsGaenNoIdnxCH+gPEhLXi0Cl1VBvyPVLSh7gEuC62yAfOIUqabWEaaiucMIk6RyqJ+Q/QM69V26jjW86Gvov/EaoyT8zRCn+Xq7PVrbx0nuYUaO9wM3WAbjCE1NEUw09Um4UV+2OKfYfu5/S19gsAzGKqm6LE5FrShbdS0ku465DjDwKA/oQht19ejqbaEVuRbiLhuHByYLjtUAZpDutzP7cYdHsPJXWbjyNVgFwQoa1WXwf4Jd9YD/Ap80+yE7+u9aAAAAAElFTkSuQmCC);background-repeat:no-repeat;background-size:auto 100%;background-position-x:center}.markdown-body code{font-weight:900;word-break:break-word;border-radius:2px;overflow-x:auto;font-size:.87em;padding:.065em .4em;background-color:#fbe5e1;color:#c0341d}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75;border-radius:0 4px}.markdown-body pre&gt;code{font-weight:400;font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{margin:0 4px;text-decoration:none;color:#027fff;transition:all .3s ease-in-out;padding-bottom:4px;border-bottom:2px solid transparent}.markdown-body a:after{content:"";display:inline-block;width:18px;height:18px;margin-left:4px;vertical-align:middle;background-image:url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyMiIgaGVpZ2h0PSIyMiI+PGcgZmlsbD0ibm9uZSIgZmlsbC1ydWxlPSJldmVub2RkIiBzdHJva2U9IiMwMjdGRkYiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCI+PHBhdGggZD0iTTkuODE1IDYuNDQ4bDEuOTM2LTEuOTM2YzEuMzM3LTEuMzM2IDMuNTgtMS4yNTkgNS4wMTMuMTczIDEuNDMyIDEuNDMyIDEuNTEgMy42NzYuMTczIDUuMDEzbC0xLjQ1MiAxLjQ1Mi0uOTY4Ljk2OGMtMS4zMzcgMS4zMzYtMy41ODEgMS4yNTktNS4wMTMtLjE3MyIvPjxwYXRoIGQ9Ik0xMS4yNjcgMTUuMzY3bC0xLjkzNiAxLjkzNmMtMS4zMzYgMS4zMzctMy41OCAxLjI2LTUuMDEyLS4xNzMtMS40MzItMS40MzItMS41MS0zLjY3Ni0uMTczLTUuMDEybDEuNDUyLTEuNDUyLjk2OC0uOTY4YzEuMzM2LTEuMzM3IDMuNTgtMS4yNiA1LjAxMi4xNzMiLz48L2c+PC9zdmc+);background-size:cover;background-repeat:no-repeat}.markdown-body a:hover{border-color:#027fff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body a.footnote-backref:after,.markdown-body a.footnote-ref:after,.markdown-body sup a:after{display:none!important}.markdown-body table{margin:0 auto 10px;font-size:12px;width:auto;max-width:100%;overflow:auto;border:2px solid #c6c6c6}.markdown-body table img{box-shadow:none!important}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body del{color:rgba(0,0,0,.6)}.markdown-body blockquote{position:relative;color:#666;padding:5px 23px 1px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:hsla(0,0%,78.4%,.12);transition:all .2s ease-in-out}.markdown-body blockquote:hover{border-color:#1976d2}.markdown-body blockquote:after,.markdown-body blockquote:before{position:absolute;font-size:24px;font-weight:800;line-height:24px;color:#cbcbcb;opacity:.6}.markdown-body blockquote:before{content:"â€œ";top:4px;left:6px}.markdown-body blockquote:after{content:"â€";right:8px;bottom:-8px}.markdown-body blockquote&gt;p,.markdown-body blockquote blockquote{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body details{outline:none;border:none;border-left:4px solid #1976d2;padding-left:10px;margin-left:4px}.markdown-body details summary{cursor:pointer;border:none;outline:none;background:#fff;margin:0 -17px}.markdown-body details summary:hover::-webkit-details-marker{color:#1976d2}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>æˆ‘åé©³ä¸»ç®¡é“ : â€œæˆ‘è‡ªå·±åšé¡¹ç›®åšç€ç© ! ä½ ç®¡æˆ‘ç”¨å“ªä¸€ä¸ª !â€</p>
</blockquote>
<blockquote>
<p>å›å®¶ä¹‹å , æˆ‘å¼€å§‹å¥½å¥‡é‚£ä¹ˆå¤š Node æ¡†æ¶ , åˆ°åº•æœ‰ä»€ä¹ˆåŒºåˆ«å•Š?</p>
</blockquote>
<blockquote>
<p>Node.js Web æ¡†æ¶å„å¼å„æ · , ä¸‹é¢ç®€å•çš„ä»‹ç»ä¸€ä¸‹è¿™äº› Node.js Web æ¡†æ¶ !</p>
</blockquote>
<h3 data-id="heading-0">ä¸€ã€åˆ†ç±»</h3>
<p>Node.js Web æ¡†æ¶ä¸»è¦åˆ† 3 ç±»ï¼š</p>



































<table><thead><tr><th>åˆ†ç±»</th><th>æ ¸å¿ƒç‰¹ç‚¹</th><th>ä»£è¡¨æ¡†æ¶</th><th>é€‚ç”¨åœºæ™¯</th></tr></thead><tbody><tr><td>æç®€æ ¸å¿ƒæ¡†æ¶</td><td>ä»…å°è£… HTTP åŸºç¡€èƒ½åŠ›ï¼Œæ— å†—ä½™åŠŸèƒ½</td><td><strong>Expressã€Koa</strong></td><td>ä¸­å°å‹ APIã€è‡ªå®šä¹‰ä¸šåŠ¡ç³»ç»Ÿ</td></tr><tr><td>å…¨æ ˆ / ä¼ä¸šçº§æ¡†æ¶</td><td>å†…ç½®è·¯ç”±ã€ORMã€éªŒè¯ã€é‰´æƒç­‰å…¨å¥—èƒ½åŠ›</td><td><strong>NestJSã€AdonisJS</strong></td><td>å¤§å‹ä¼ä¸šåº”ç”¨ã€å›¢é˜Ÿåä½œé¡¹ç›®</td></tr><tr><td>é«˜æ€§èƒ½æ¡†æ¶</td><td>åŸºäºå¼‚æ­¥ I/O/ ç¼–è¯‘ä¼˜åŒ–ï¼Œæè‡´æ€§èƒ½</td><td><strong>Fastifyã€Hapi</strong></td><td>é«˜å¹¶å‘ APIã€å¾®æœåŠ¡</td></tr><tr><td>ç‰¹æ®Šåœºæ™¯æ¡†æ¶</td><td>é’ˆå¯¹ç‰¹å®šåœºæ™¯ä¼˜åŒ–ï¼ˆå¦‚ SSRã€ä½ä»£ç ï¼‰</td><td><strong>Next.jsã€Nuxt.jsï¼ˆNode ç«¯ï¼‰ã€Sails.js</strong></td><td>å‰ç«¯ SSRã€ä½ä»£ç å¹³å°</td></tr></tbody></table>
<h3 data-id="heading-1">äºŒã€ä¸»æµæ¡†æ¶è¯¦ç»†ä»‹ç»</h3>
<blockquote>
<p>âš ï¸ : æ’åä¸åˆ†å…ˆåé¡ºåº</p>
</blockquote>
<h4 data-id="heading-2">1. Expressï¼ˆæœ€ç»å…¸çš„æç®€æ¡†æ¶ï¼‰</h4>
<ul>
<li>
<p><strong>æ ¸å¿ƒå®šä½</strong>ï¼šNode.js Web æ¡†æ¶çš„ â€œé¼»ç¥–â€ï¼Œæç®€ã€çµæ´»ï¼Œæ— å†…ç½®å†—ä½™åŠŸèƒ½ï¼Œç”Ÿæ€æœ€ä¸°å¯Œã€‚</p>
</li>
<li>
<p><strong>æ ¸å¿ƒç‰¹æ€§</strong>ï¼š</p>
<ul>
<li>ä¸­é—´ä»¶æœºåˆ¶ï¼ˆçº¿æ€§ä¸­é—´ä»¶ï¼Œ<code>req -&gt; ä¸­é—´ä»¶1 -&gt; ä¸­é—´ä»¶2 -&gt; res</code>ï¼‰ï¼›</li>
<li>ç®€æ´çš„è·¯ç”±ç³»ç»Ÿï¼›</li>
<li>æ— å†…ç½® ORM / éªŒè¯ï¼Œéœ€æ‰‹åŠ¨é›†æˆç¬¬ä¸‰æ–¹åº“ï¼ˆå¦‚ <code>mongoose</code>ã€<code>express-validator</code>ï¼‰ã€‚</li>
</ul>
</li>
<li>
<p><strong>ç¤ºä¾‹ä»£ç </strong>ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> express = <span class="hljs-built_in">require</span>(<span class="hljs-string">'express'</span>);
<span class="hljs-keyword">const</span> app = <span class="hljs-title function_">express</span>();

<span class="hljs-comment">// ä¸­é—´ä»¶</span>
app.<span class="hljs-title function_">use</span>(express.<span class="hljs-title function_">json</span>());

<span class="hljs-comment">// è·¯ç”±</span>
app.<span class="hljs-title function_">get</span>(<span class="hljs-string">'/api/user'</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> {
  res.<span class="hljs-title function_">json</span>({ <span class="hljs-attr">name</span>: <span class="hljs-string">'å¼ ä¸‰'</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">20</span> });
});

app.<span class="hljs-title function_">listen</span>(<span class="hljs-number">3000</span>, <span class="hljs-function">() =&gt;</span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'Express å¯åŠ¨åœ¨ 3000 ç«¯å£'</span>));
</code></pre>
</li>
<li>
<p><strong>ä¼˜ç‚¹</strong>ï¼šç”Ÿæ€æå…¨ï¼ˆå‡ ä¹æ‰€æœ‰ Node åº“éƒ½å…¼å®¹ï¼‰ã€å­¦ä¹ æˆæœ¬ä½ã€çµæ´»åº¦é«˜ï¼›</p>
</li>
<li>
<p><strong>ç¼ºç‚¹</strong>ï¼šå›è°ƒåµŒå¥—ï¼ˆæ˜“å‡ºç° â€œå›è°ƒåœ°ç‹±â€ï¼‰ã€æ— å†…ç½®ç±»å‹æ”¯æŒï¼ˆTS éœ€æ‰‹åŠ¨é…ç½®ï¼‰ã€æ— ç»Ÿä¸€è§„èŒƒï¼ˆå›¢é˜Ÿåä½œæ˜“æ··ä¹±ï¼‰ï¼›</p>
</li>
<li>
<p><strong>é€‚ç”¨åœºæ™¯</strong>ï¼šä¸­å°å‹ API æœåŠ¡ã€å¿«é€ŸåŸå‹å¼€å‘ã€ä¸ªäººé¡¹ç›®ã€‚</p>
</li>
</ul>
<h4 data-id="heading-3">2. Koaï¼ˆExpress å›¢é˜Ÿå‡çº§ç‰ˆï¼‰</h4>
<ul>
<li>
<p><strong>æ ¸å¿ƒå®šä½</strong>ï¼šExpress åŸå›¢é˜Ÿå¼€å‘ï¼Œè§£å†³ Express å›è°ƒåœ°ç‹±é—®é¢˜ï¼ŒåŸºäº <code>async/await</code> é‡æ„ã€‚</p>
</li>
<li>
<p><strong>æ ¸å¿ƒç‰¹æ€§</strong>ï¼š</p>
<ul>
<li>æ´‹è‘±æ¨¡å‹ä¸­é—´ä»¶ï¼ˆä¸­é—´ä»¶å¯åŒå‘æ‰§è¡Œï¼Œå¦‚ â€œè¯·æ±‚è¿›æ¥æ‰§è¡Œ -&gt; å“åº”å‡ºå»å†æ‰§è¡Œâ€ï¼‰ï¼›</li>
<li>åŸç”Ÿæ”¯æŒ <code>async/await</code>ï¼Œæ— å›è°ƒåœ°ç‹±ï¼›</li>
<li>æ¯” Express æ›´ç²¾ç®€ï¼ˆç”šè‡³æ²¡æœ‰å†…ç½®è·¯ç”±ï¼Œéœ€è£… <code>koa-router</code>ï¼‰ã€‚</li>
</ul>
</li>
<li>
<p><strong>ç¤ºä¾‹ä»£ç </strong>ï¼š</p>
<pre><code class="hljs language-ini" lang="ini">const <span class="hljs-attr">Koa</span> = require(<span class="hljs-string">'koa'</span>)<span class="hljs-comment">;</span>
const <span class="hljs-attr">koaRouter</span> = require(<span class="hljs-string">'koa-router'</span>)<span class="hljs-comment">;</span>
const <span class="hljs-attr">koaBody</span> = require(<span class="hljs-string">'koa-body'</span>)<span class="hljs-comment">;</span>

const <span class="hljs-attr">app</span> = new Koa()<span class="hljs-comment">;</span>
const <span class="hljs-attr">router</span> = new koaRouter()<span class="hljs-comment">;</span>

// æ´‹è‘±æ¨¡å‹ä¸­é—´ä»¶
app.use(async (ctx, next) =&gt; {
  console.log('è¯·æ±‚å¼€å§‹')<span class="hljs-comment">;</span>
  await next()<span class="hljs-comment">; // æ‰§è¡Œä¸‹ä¸€ä¸ªä¸­é—´ä»¶</span>
  console.log('è¯·æ±‚ç»“æŸ')<span class="hljs-comment">; // å“åº”æ—¶æ‰§è¡Œ</span>
})<span class="hljs-comment">;</span>

app.use(koaBody())<span class="hljs-comment">;</span>
router.get('/api/user', async (ctx) =&gt; {
  <span class="hljs-attr">ctx.body</span> = { name: <span class="hljs-string">'å¼ ä¸‰'</span>, age: <span class="hljs-number">20</span> }<span class="hljs-comment">;</span>
})<span class="hljs-comment">;</span>

app.use(router.routes())<span class="hljs-comment">;</span>
app.listen(3000, () =&gt; console.log('Koa å¯åŠ¨åœ¨ 3000 ç«¯å£'))<span class="hljs-comment">;</span>
</code></pre>
</li>
<li>
<p><strong>ä¼˜ç‚¹</strong>ï¼šå¼‚æ­¥ä½“éªŒå¥½ã€æ´‹è‘±æ¨¡å‹çµæ´»ï¼ˆé€‚åˆæ—¥å¿— / é‰´æƒ / å¼‚å¸¸æ•è·ï¼‰ã€è½»é‡ï¼›</p>
</li>
<li>
<p><strong>ç¼ºç‚¹</strong>ï¼šç”Ÿæ€æ¯” Express ç•¥å°‘ã€éœ€æ‰‹åŠ¨é›†æˆæ›´å¤šç¬¬ä¸‰æ–¹åº“ï¼›</p>
</li>
<li>
<p><strong>é€‚ç”¨åœºæ™¯</strong>ï¼šä¸­å°å‹ API æœåŠ¡ã€éœ€è¦çµæ´»ä¸­é—´ä»¶çš„åœºæ™¯ã€å«Œå¼ƒ Express å›è°ƒçš„é¡¹ç›®ã€‚</p>
</li>
</ul>
<h4 data-id="heading-4">3. NestJSï¼ˆä¼ä¸šçº§ TypeScript æ¡†æ¶ï¼‰</h4>
<ul>
<li>
<p><strong>æ ¸å¿ƒå®šä½</strong>ï¼šå¯¹æ ‡ Spring Bootï¼ŒåŸºäº TypeScriptï¼Œå¼ºè°ƒæ¨¡å—åŒ–ã€ä¾èµ–æ³¨å…¥ï¼Œé€‚åˆå¤§å‹å›¢é˜Ÿåä½œã€‚</p>
</li>
<li>
<p><strong>æ ¸å¿ƒç‰¹æ€§</strong>ï¼š</p>
<ul>
<li>å¼ºåˆ¶ TypeScript å¼€å‘ï¼Œç±»å‹å®‰å…¨ï¼›</li>
<li>æ¨¡å—åŒ–æ¶æ„ï¼ˆModule + Controller + Serviceï¼‰ï¼›</li>
<li>å†…ç½®ä¾èµ–æ³¨å…¥ã€æ‹¦æˆªå™¨ã€ç®¡é“ã€å®ˆå«ï¼ˆé‰´æƒï¼‰ã€è¿‡æ»¤å™¨ï¼›</li>
<li>å…¼å®¹ Express/Koaï¼Œå¯æ— ç¼é›†æˆç¬¬ä¸‰æ–¹åº“ï¼›</li>
<li>æ”¯æŒå¾®æœåŠ¡ã€GraphQLã€WebSocketã€‚</li>
</ul>
</li>
<li>
<p><strong>ç¤ºä¾‹ä»£ç </strong>ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// user.controller.ts</span>
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">Controller</span>, <span class="hljs-title class_">Get</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@nestjs/common'</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">UserService</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'./user.service'</span>;

<span class="hljs-meta">@Controller</span>(<span class="hljs-string">'api/user'</span>)
<span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserController</span> {
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params"><span class="hljs-keyword">private</span> <span class="hljs-keyword">readonly</span> userService: UserService</span>) {}

  <span class="hljs-meta">@Get</span>()
  <span class="hljs-title function_">getUser</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">userService</span>.<span class="hljs-title function_">getUser</span>();
  }
}

<span class="hljs-comment">// user.service.ts</span>
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">Injectable</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@nestjs/common'</span>;

<span class="hljs-meta">@Injectable</span>()
<span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserService</span> {
  <span class="hljs-title function_">getUser</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">return</span> { <span class="hljs-attr">name</span>: <span class="hljs-string">'å¼ ä¸‰'</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">20</span> };
  }
}
</code></pre>
</li>
<li>
<p><strong>ä¼˜ç‚¹</strong>ï¼šè§„èŒƒç»Ÿä¸€ã€ç±»å‹å®‰å…¨ã€é€‚åˆå¤§å‹é¡¹ç›® / å›¢é˜Ÿã€ç”Ÿæ€å®Œå–„ï¼ˆå®˜æ–¹å°è£…äº†å¤§é‡ä¼ä¸šçº§èƒ½åŠ›ï¼‰ï¼›</p>
</li>
<li>
<p><strong>ç¼ºç‚¹</strong>ï¼šå­¦ä¹ æˆæœ¬é«˜ã€å…¥é—¨é—¨æ§›é«˜ã€å°å‹é¡¹ç›®ç”¨ç€ â€œé‡â€ï¼›</p>
</li>
<li>
<p><strong>é€‚ç”¨åœºæ™¯</strong>ï¼šå¤§å‹ä¼ä¸šåº”ç”¨ã€å¾®æœåŠ¡ã€å›¢é˜Ÿåä½œé¡¹ç›®ã€éœ€è¦å¼ºç±»å‹çš„é¡¹ç›®ã€‚</p>
</li>
</ul>
<h4 data-id="heading-5">4. Fastifyï¼ˆé«˜æ€§èƒ½æç®€æ¡†æ¶ï¼‰</h4>
<ul>
<li>
<p><strong>æ ¸å¿ƒå®šä½</strong>ï¼šæè‡´æ€§èƒ½ï¼Œæ¯” Express å¿« 2-3 å€ï¼Œä¸“ä¸ºé«˜å¹¶å‘ API è®¾è®¡ã€‚</p>
</li>
<li>
<p><strong>æ ¸å¿ƒç‰¹æ€§</strong>ï¼š</p>
<ul>
<li>åŸºäº JSON Schema éªŒè¯è¯·æ±‚å‚æ•°ï¼Œæ€§èƒ½ä¼˜äºä¼ ç»ŸéªŒè¯åº“ï¼›</li>
<li>å†…ç½®æ—¥å¿—ã€å‹ç¼©ã€è·¯ç”±ç¼“å­˜ï¼Œæ— éœ€é¢å¤–é…ç½®ï¼›</li>
<li>å…¼å®¹ Express ä¸­é—´ä»¶ï¼›</li>
<li>æ”¯æŒ TypeScriptã€‚</li>
</ul>
</li>
<li>
<p><strong>ç¤ºä¾‹ä»£ç </strong>ï¼š</p>
<pre><code class="hljs language-php" lang="php"><span class="hljs-keyword">const</span> <span class="hljs-variable constant_">fastify</span> = <span class="hljs-keyword">require</span>(<span class="hljs-string">'fastify'</span>)({ logger: <span class="hljs-literal">true</span> });

<span class="hljs-comment">// è·¯ç”± + å‚æ•°éªŒè¯</span>
fastify.<span class="hljs-title function_ invoke__">get</span>(<span class="hljs-string">'/api/user'</span>, {
  <span class="hljs-attr">schema</span>: {
    <span class="hljs-attr">querystring</span>: {
      <span class="hljs-attr">age</span>: { <span class="hljs-attr">type</span>: <span class="hljs-string">'number'</span> }
    }
  }
}, <span class="hljs-title function_ invoke__">async</span> (request, reply) =&gt; {
  <span class="hljs-keyword">return</span> { <span class="hljs-attr">name</span>: <span class="hljs-string">'å¼ ä¸‰'</span>, <span class="hljs-attr">age</span>: request.query.age || <span class="hljs-number">20</span> };
});

fastify.<span class="hljs-title function_ invoke__">listen</span>({ <span class="hljs-attr">port</span>: <span class="hljs-number">3000</span> }, (err) =&gt; {
  <span class="hljs-keyword">if</span> (err) <span class="hljs-keyword">throw</span> err;
  console.<span class="hljs-title function_ invoke__">log</span>(<span class="hljs-string">'Fastify å¯åŠ¨åœ¨ 3000 ç«¯å£'</span>);
});
</code></pre>
</li>
<li>
<p><strong>ä¼˜ç‚¹</strong>ï¼šæ€§èƒ½æé«˜ã€å†…ç½®åŠŸèƒ½ä¸°å¯Œï¼ˆæ— éœ€è£…å¤§é‡ä¸­é—´ä»¶ï¼‰ã€è½»é‡ï¼›</p>
</li>
<li>
<p><strong>ç¼ºç‚¹</strong>ï¼šç”Ÿæ€æ¯” Express å°ã€éƒ¨åˆ†ç‰¹æ€§ï¼ˆå¦‚ Schema éªŒè¯ï¼‰æœ‰å­¦ä¹ æˆæœ¬ï¼›</p>
</li>
<li>
<p><strong>é€‚ç”¨åœºæ™¯</strong>ï¼šé«˜å¹¶å‘ APIã€å¾®æœåŠ¡ã€å¯¹æ€§èƒ½è¦æ±‚é«˜çš„é¡¹ç›®ã€‚</p>
</li>
</ul>
<h4 data-id="heading-6">5. Hapiï¼ˆç¨³å®šçš„ä¼ä¸šçº§æ¡†æ¶ï¼‰</h4>
<blockquote>
<p>â€œè¿˜è®°å¾—å½“åˆåœ¨ <strong>æ²ƒå°”ç›</strong> ä¹°äº†è™¾ , è‡ªå·±å›å®¶è‡ªå·±åš <strong>é¸¡æ²¹ç‚’æ²³è™¾ä»</strong> , è‰¾ç› , è€é¦™äº†!!! â€</p>
</blockquote>
<ul>
<li>
<p><strong>æ ¸å¿ƒå®šä½</strong>ï¼šç”± Walmart ( æ²ƒå°”ç›  ) å¼€å‘ï¼Œå¼ºè°ƒé…ç½®ä¼˜äºç¼–ç ï¼Œé€‚åˆç¨³å®šçš„ä¼ä¸šçº§æœåŠ¡ã€‚</p>
</li>
<li>
<p><strong>æ ¸å¿ƒç‰¹æ€§</strong>ï¼š</p>
<ul>
<li>å†…ç½®è·¯ç”±ã€éªŒè¯ã€ç¼“å­˜ã€æ—¥å¿—ï¼Œæ— éœ€ç¬¬ä¸‰æ–¹åº“ï¼›</li>
<li>æ’ä»¶åŒ–æ¶æ„ï¼Œæ‰©å±•èƒ½åŠ›å¼ºï¼›</li>
<li>ç¨³å®šæ€§æé«˜ï¼ˆé€‚åˆé‡‘è / ç”µå•†ç­‰æ ¸å¿ƒç³»ç»Ÿï¼‰ã€‚</li>
</ul>
</li>
<li>
<p><strong>ä¼˜ç‚¹</strong>ï¼šç¨³å®šã€å†…ç½®åŠŸèƒ½å…¨ã€å®‰å…¨æ€§é«˜ï¼›</p>
</li>
<li>
<p><strong>ç¼ºç‚¹</strong>ï¼šå­¦ä¹ æˆæœ¬é«˜ã€çµæ´»æ€§ä½ã€æ€§èƒ½ä¸å¦‚ Fastifyï¼›</p>
</li>
<li>
<p><strong>é€‚ç”¨åœºæ™¯</strong>ï¼šé‡‘è / ç”µå•†ç­‰æ ¸å¿ƒç³»ç»Ÿã€å¯¹ç¨³å®šæ€§è¦æ±‚æé«˜çš„é¡¹ç›®ã€‚</p>
</li>
</ul>
<h4 data-id="heading-7">6. Next.jsï¼ˆå‰ç«¯ SSR/SSG æ¡†æ¶ï¼ŒNode ç«¯æ ¸å¿ƒï¼‰</h4>
<ul>
<li>
<p><strong>æ ¸å¿ƒå®šä½</strong>ï¼šReact ç”Ÿæ€çš„å…¨æ ˆæ¡†æ¶ï¼ŒNode ç«¯è´Ÿè´£æœåŠ¡ç«¯æ¸²æŸ“ï¼ˆSSRï¼‰ã€é™æ€ç”Ÿæˆï¼ˆSSGï¼‰ã€‚</p>
</li>
<li>
<p><strong>æ ¸å¿ƒç‰¹æ€§</strong>ï¼š</p>
<ul>
<li>æœåŠ¡ç«¯æ¸²æŸ“ï¼ˆæå‡ SEOã€é¦–å±åŠ è½½é€Ÿåº¦ï¼‰ï¼›</li>
<li>è‡ªåŠ¨è·¯ç”±ï¼ˆåŸºäºæ–‡ä»¶ç³»ç»Ÿï¼‰ï¼›</li>
<li>å†…ç½® API è·¯ç”±ï¼ˆæ— éœ€é¢å¤–æ­åç«¯ï¼‰ï¼›</li>
<li>æ”¯æŒé™æ€ç”Ÿæˆã€å¢é‡é™æ€å†ç”Ÿã€‚</li>
</ul>
</li>
<li>
<p><strong>é€‚ç”¨åœºæ™¯</strong>ï¼šReact å‰ç«¯é¡¹ç›®ã€éœ€è¦ SEO çš„ç½‘ç«™ï¼ˆå¦‚åšå®¢ã€ç”µå•†ï¼‰ã€å…¨æ ˆ React åº”ç”¨ã€‚</p>
</li>
</ul>
<h4 data-id="heading-8">7. Sails.jsï¼ˆä½ä»£ç  / å¿«é€Ÿå¼€å‘æ¡†æ¶ï¼‰</h4>
<ul>
<li>
<p><strong>æ ¸å¿ƒå®šä½</strong>ï¼šå¯¹æ ‡ Ruby on Railsï¼Œå†…ç½® ORMã€è“å›¾ APIã€å®æ—¶é€šä¿¡ï¼Œé€‚åˆå¿«é€Ÿå¼€å‘å…¨æ ˆåº”ç”¨ã€‚</p>
</li>
<li>
<p><strong>æ ¸å¿ƒç‰¹æ€§</strong>ï¼š</p>
<ul>
<li>è‡ªåŠ¨ç”Ÿæˆ CRUD APIï¼ˆè“å›¾è·¯ç”±ï¼‰ï¼›</li>
<li>å†…ç½® Waterline ORMï¼ˆæ”¯æŒå¤šæ•°æ®åº“ï¼‰ï¼›</li>
<li>æ”¯æŒ WebSocket å®æ—¶é€šä¿¡ï¼›</li>
</ul>
</li>
<li>
<p><strong>ä¼˜ç‚¹</strong>ï¼šå¼€å‘é€Ÿåº¦æå¿«ã€ä½ä»£ç ï¼›</p>
</li>
<li>
<p><strong>ç¼ºç‚¹</strong>ï¼šçµæ´»æ€§ä½ã€å®šåˆ¶åŒ–æˆæœ¬é«˜ï¼›</p>
</li>
<li>
<p><strong>é€‚ç”¨åœºæ™¯</strong>ï¼šå¿«é€ŸåŸå‹å¼€å‘ã€ä½ä»£ç å¹³å°ã€å°å‹å…¨æ ˆåº”ç”¨ã€‚</p>
</li>
</ul>
<h4 data-id="heading-9">8. AdonisJSï¼ˆNode.js ç‰ˆçš„ Laravelï¼Œå…¨æ ˆä¼ä¸šçº§æ¡†æ¶ï¼‰</h4>
<ul>
<li>
<p><strong>æ ¸å¿ƒå®šä½</strong>ï¼šå¯¹æ ‡ PHP ç•Œçš„ Laravelï¼Œæ˜¯ Node.js ç”Ÿæ€ä¸­ â€œå¼€ç®±å³ç”¨â€ çš„å…¨æ ˆæ¡†æ¶ï¼Œå†…ç½®å…¨å¥—ä¼ä¸šçº§èƒ½åŠ›ï¼Œå¼ºè°ƒ â€œçº¦å®šä¼˜äºé…ç½®â€ã€‚</p>
</li>
<li>
<p><strong>æ ¸å¿ƒç‰¹æ€§</strong>ï¼š</p>
<ul>
<li>å†…ç½® ORMï¼ˆLucid ORMï¼‰ï¼šæ”¯æŒ MySQLã€PostgreSQL ç­‰ï¼Œæ— éœ€æ‰‹åŠ¨é›†æˆç¬¬ä¸‰æ–¹ ORMï¼›</li>
<li>å†…ç½®èº«ä»½éªŒè¯ï¼ˆç”¨æˆ·æ³¨å†Œ / ç™»å½• / æƒé™ï¼‰ã€è¡¨å•éªŒè¯ã€CSRF ä¿æŠ¤ï¼›</li>
<li>æ”¯æŒ MVC æ¶æ„ã€è·¯ç”±åˆ†ç»„ã€ä¸­é—´ä»¶ã€ä»»åŠ¡è°ƒåº¦ï¼›</li>
<li>åŸç”Ÿæ”¯æŒ TypeScriptï¼Œç±»å‹å®‰å…¨ï¼›</li>
<li>å†…ç½®æ¨¡æ¿å¼•æ“ï¼ˆEdgeï¼‰ï¼Œä¹Ÿæ”¯æŒå‰åç«¯åˆ†ç¦»ï¼›</li>
</ul>
</li>
<li>
<p><strong>ç¤ºä¾‹ä»£ç ï¼ˆæ ¸å¿ƒè·¯ç”± + ORMï¼‰</strong> ï¼š</p>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-comment">// start/routes.ts</span>
<span class="hljs-keyword">import</span> Route from <span class="hljs-string">'@ioc:Adonis/Core/Route'</span>
<span class="hljs-keyword">import</span> User from <span class="hljs-string">'App/Models/User'</span>

<span class="hljs-comment">// è·¯ç”± + æ•°æ®åº“æŸ¥è¯¢</span>
Route.<span class="hljs-keyword">get</span>(<span class="hljs-string">'/api/user'</span>, <span class="hljs-keyword">async</span> () =&gt; {
  <span class="hljs-keyword">const</span> user = <span class="hljs-keyword">await</span> User.find(<span class="hljs-number">1</span>) <span class="hljs-comment">// Lucid ORM æŸ¥ç”¨æˆ·</span>
  <span class="hljs-keyword">return</span> { name: user?.name, age: user?.age }
})

<span class="hljs-comment">// è¡¨å•éªŒè¯</span>
Route.post(<span class="hljs-string">'/api/user'</span>, <span class="hljs-keyword">async</span> ({ request }) =&gt; {
  <span class="hljs-keyword">const</span> data = request.validate({
    schema: {
      name: schema.string(),
      age: schema.number()
    }
  })
  <span class="hljs-keyword">await</span> User.create(data) <span class="hljs-comment">// æ–°å¢ç”¨æˆ·</span>
  <span class="hljs-keyword">return</span> { success: <span class="hljs-keyword">true</span> }
})
</code></pre>
</li>
<li>
<p><strong>ä¼˜ç‚¹</strong>ï¼šå¼€ç®±å³ç”¨ï¼ˆæ— éœ€è£…å¤§é‡ä¾èµ–ï¼‰ã€Laravel å¼€å‘è€…æ˜“ä¸Šæ‰‹ã€è§„èŒƒç»Ÿä¸€ã€å†…ç½®å®‰å…¨ç‰¹æ€§ï¼›</p>
</li>
<li>
<p><strong>ç¼ºç‚¹</strong>ï¼šç”Ÿæ€æ¯” Express/NestJS å°ã€çµæ´»æ€§ç•¥ä½ã€å›½å†…ä½¿ç”¨è¾ƒå°‘ï¼ˆä¸­æ–‡æ–‡æ¡£æœ‰é™ï¼‰ï¼›</p>
</li>
<li>
<p><strong>é€‚ç”¨åœºæ™¯</strong>ï¼šå…¨æ ˆ Node.js åº”ç”¨ã€Laravel è½¬ Node å¼€å‘çš„å›¢é˜Ÿã€ä¸­å°å‹ä¼ä¸šåº”ç”¨ã€éœ€è¦å¿«é€Ÿæ­å»ºå¸¦æ•°æ®åº“çš„ä¸šåŠ¡ç³»ç»Ÿã€‚</p>
</li>
</ul>
<h4 data-id="heading-10">9. Nuxt.jsï¼ˆVue ç”Ÿæ€å…¨æ ˆæ¡†æ¶ï¼ŒNode ç«¯è´Ÿè´£ SSR/SSGï¼‰</h4>
<ul>
<li>
<p><strong>æ ¸å¿ƒå®šä½</strong>ï¼šVue ç”Ÿæ€çš„å®˜æ–¹å…¨æ ˆæ¡†æ¶ï¼ŒåŸºäº Vue + Node.js å®ç°æœåŠ¡ç«¯æ¸²æŸ“ï¼ˆSSRï¼‰ã€é™æ€ç«™ç‚¹ç”Ÿæˆï¼ˆSSGï¼‰ï¼Œè§£å†³ Vue å•é¡µåº”ç”¨ SEO å·®çš„é—®é¢˜ã€‚</p>
</li>
<li>
<p><strong>æ ¸å¿ƒç‰¹æ€§</strong>ï¼š</p>
<ul>
<li>è‡ªåŠ¨è·¯ç”±ï¼ˆåŸºäº <code>pages</code> ç›®å½•ï¼Œæ— éœ€æ‰‹åŠ¨é…ç½®è·¯ç”±ï¼‰ï¼›</li>
<li>æœåŠ¡ç«¯æ¸²æŸ“ï¼ˆSSRï¼‰ã€é™æ€ç”Ÿæˆï¼ˆSSGï¼‰ã€å¢é‡é™æ€å†ç”Ÿï¼ˆISRï¼‰ï¼›</li>
<li>å†…ç½® API è·¯ç”±ï¼ˆ<code>server/api</code> ç›®å½•ï¼Œæ— éœ€é¢å¤–æ­åç«¯æœåŠ¡ï¼‰ï¼›</li>
<li>æ”¯æŒ Vue3 + TypeScriptã€è‡ªåŠ¨ä»£ç åˆ†å‰²ã€ç¼“å­˜ä¼˜åŒ–ï¼›</li>
<li>é›†æˆ Piniaï¼ˆçŠ¶æ€ç®¡ç†ï¼‰ã€Nuxt Modulesï¼ˆç”Ÿæ€æ’ä»¶ï¼‰ï¼›</li>
</ul>
</li>
<li>
<p><strong>ç¤ºä¾‹ä»£ç ï¼ˆæ ¸å¿ƒç”¨æ³•ï¼‰</strong> ï¼š</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-comment">&lt;!-- pages/api/user.vue (é¡µé¢è·¯ç”±) --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>{{ user.name }}<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"ts"</span>&gt;</span><span class="javascript">
<span class="hljs-comment">// æœåŠ¡ç«¯è·å–æ•°æ®ï¼ˆSSRï¼‰</span>
<span class="hljs-keyword">const</span> { <span class="hljs-attr">data</span>: user } = <span class="hljs-keyword">await</span> <span class="hljs-title function_">useAsyncData</span>(<span class="hljs-string">'user'</span>, <span class="hljs-function">() =&gt;</span> 
  $fetch(<span class="hljs-string">'/api/user'</span>) <span class="hljs-comment">// è°ƒç”¨å†…ç½® API è·¯ç”±</span>
)
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>

// server/api/user.ts (å†…ç½® API è·¯ç”±)
export default defineEventHandler(() =&gt; {
  return { name: 'å¼ ä¸‰', age: 20 }
})
</code></pre>
</li>
<li>
<p><strong>ä¼˜ç‚¹</strong>ï¼šVue å¼€å‘è€…æ— ç¼ä¸Šæ‰‹ã€è§£å†³ SEO é—®é¢˜ã€å…¨æ ˆä¸€ä½“åŒ–ï¼ˆå‰ç«¯ + Node ç«¯ï¼‰ã€ç”Ÿæ€å®Œå–„ï¼›</p>
</li>
<li>
<p><strong>ç¼ºç‚¹</strong>ï¼šä»…é€‚é… Vue æŠ€æœ¯æ ˆã€Node ç«¯é€»è¾‘å®šåˆ¶åŒ–èƒ½åŠ›æœ‰é™ã€å¤§å‹é¡¹ç›®éœ€æ·±å…¥ç†è§£å…¶ç”Ÿå‘½å‘¨æœŸï¼›</p>
</li>
<li>
<p><strong>é€‚ç”¨åœºæ™¯</strong>ï¼šVue å…¨æ ˆåº”ç”¨ã€éœ€è¦ SEO çš„ç½‘ç«™ï¼ˆåšå®¢ / ç”µå•† / å®˜ç½‘ï¼‰ã€é™æ€ç«™ç‚¹ç”Ÿæˆã€ä¸­å°å‹ Vue é¡¹ç›®ã€‚</p>
</li>
</ul>
<h4 data-id="heading-11">10. Egg.jsï¼ˆé˜¿é‡Œå¼€æºï¼Œä¼ä¸šçº§ Node.js æ¡†æ¶ï¼‰</h4>
<ul>
<li>
<p><strong>æ ¸å¿ƒå®šä½</strong>ï¼šé˜¿é‡Œå¼€æºçš„ä¼ä¸šçº§æ¡†æ¶ï¼ŒåŸºäº Express/Koa å°è£…ï¼Œå¼ºè°ƒ â€œçº¦å®šä¼˜äºé…ç½®â€ï¼Œé€‚åˆä¸­å¤§å‹å›¢é˜Ÿåä½œã€‚</p>
</li>
<li>
<p><strong>æ ¸å¿ƒç‰¹æ€§</strong>ï¼š</p>
<ul>
<li>åŸºäº Koa2ï¼ˆæ´‹è‘±æ¨¡å‹ï¼‰ï¼Œå…¼å®¹ Koa/Express ä¸­é—´ä»¶ï¼›</li>
<li>å†…ç½®å¤šè¿›ç¨‹æ¨¡å‹ï¼ˆMaster + Workerï¼‰ï¼Œè‡ªåŠ¨åˆ©ç”¨å¤šæ ¸ CPUï¼›</li>
<li>æ’ä»¶åŒ–æ¶æ„ï¼ˆå¦‚ egg-mysqlã€egg-redisï¼‰ï¼Œç”Ÿæ€ä¸°å¯Œï¼ˆé˜¿é‡Œå®˜æ–¹ç»´æŠ¤ï¼‰ï¼›</li>
<li>æ”¯æŒ TypeScriptã€å•å…ƒæµ‹è¯•ã€æ—¥å¿—ã€ç›‘æ§ï¼›</li>
<li>è§„èŒƒçš„ç›®å½•ç»“æ„ï¼ˆcontroller/service/middleware/configï¼‰ï¼Œå›¢é˜Ÿåä½œå‹å¥½ï¼›</li>
</ul>
</li>
<li>
<p><strong>ç¤ºä¾‹ä»£ç </strong>ï¼š</p>
<pre><code class="hljs language-scala" lang="scala"><span class="hljs-comment">// app/controller/user.js</span>
const { <span class="hljs-type">Controller</span> } = require('egg');

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">UserController</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Controller</span> </span>{
  async index() {
    const { ctx } = <span class="hljs-keyword">this</span>;
    <span class="hljs-comment">// è°ƒç”¨ service å±‚</span>
    const user = await ctx.service.user.getUser();
    ctx.body = user;
  }
}

module.exports = <span class="hljs-type">UserController</span>;

<span class="hljs-comment">// app/service/user.js</span>
const { <span class="hljs-type">Service</span> } = require('egg');

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">UserService</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Service</span> </span>{
  async getUser() {
    <span class="hljs-comment">// ç”¨ egg-mysql æŸ¥æ•°æ®åº“</span>
    <span class="hljs-keyword">return</span> await <span class="hljs-keyword">this</span>.app.mysql.get('user', { id: <span class="hljs-number">1</span> });
  }
}

module.exports = <span class="hljs-type">UserService</span>;
</code></pre>
</li>
<li>
<p><strong>ä¼˜ç‚¹</strong>ï¼šé˜¿é‡ŒèƒŒä¹¦ã€è§„èŒƒç»Ÿä¸€ã€å¤šè¿›ç¨‹æ€§èƒ½ä¼˜ã€å›½å†…ç”Ÿæ€å®Œå–„ï¼ˆä¸­æ–‡æ–‡æ¡£ / ç¤¾åŒºï¼‰ã€é€‚åˆå›¢é˜Ÿåä½œï¼›</p>
</li>
<li>
<p><strong>ç¼ºç‚¹</strong>ï¼šçµæ´»æ€§ä½äº Express/Koaã€å­¦ä¹ æˆæœ¬ä¸­ç­‰ã€å°å‹é¡¹ç›®ç”¨ç€ â€œé‡â€ï¼›</p>
</li>
<li>
<p><strong>é€‚ç”¨åœºæ™¯</strong>ï¼šä¸­å¤§å‹ä¼ä¸šåº”ç”¨ã€é˜¿é‡Œç³»æŠ€æœ¯æ ˆé¡¹ç›®ã€å›½å†…å›¢é˜Ÿåä½œé¡¹ç›®ã€éœ€è¦å¤šè¿›ç¨‹ä¼˜åŒ–çš„ Node æœåŠ¡ã€‚</p>
</li>
</ul>
<h3 data-id="heading-12">ä¸‰ã€ å¯¹æ¯”</h3>



















































































































<table><thead><tr><th>æ¡†æ¶</th><th>å­¦ä¹ æˆæœ¬</th><th>æ€§èƒ½</th><th>ç”Ÿæ€</th><th>ç±»å‹æ”¯æŒ</th><th>é€‚ç”¨è§„æ¨¡</th><th>æ ¸å¿ƒä¼˜åŠ¿</th><th>æŠ€æœ¯æ ˆ / å®šä½</th></tr></thead><tbody><tr><td>Express</td><td>ä½</td><td>ä¸­ç­‰</td><td>æä¸°å¯Œ</td><td>éœ€æ‰‹åŠ¨é…</td><td>å° / ä¸­</td><td>çµæ´»ã€ç”Ÿæ€å…¨ã€å…¥é—¨å¿«</td><td>æç®€æ ¸å¿ƒæ¡†æ¶</td></tr><tr><td>Koa</td><td>ä¸­</td><td>ä¸­ç­‰</td><td>ä¸°å¯Œ</td><td>éœ€æ‰‹åŠ¨é…</td><td>å° / ä¸­</td><td>æ´‹è‘±æ¨¡å‹ã€async/await</td><td>æç®€æ ¸å¿ƒæ¡†æ¶ï¼ˆExpress å‡çº§ç‰ˆï¼‰</td></tr><tr><td>NestJS</td><td>é«˜</td><td>ä¸­ç­‰</td><td>ä¸°å¯Œ</td><td>åŸç”Ÿ TS</td><td>ä¸­ / å¤§</td><td>è§„èŒƒã€ä¼ä¸šçº§ã€å›¢é˜Ÿåä½œ</td><td>ä¼ä¸šçº§ TS æ¡†æ¶</td></tr><tr><td>Fastify</td><td>ä¸­</td><td>æé«˜</td><td>ä¸­ç­‰</td><td>åŸç”Ÿ TS</td><td>å° / ä¸­ / å¤§</td><td>æè‡´æ€§èƒ½ã€å†…ç½®åŠŸèƒ½å…¨</td><td>é«˜æ€§èƒ½æç®€æ¡†æ¶</td></tr><tr><td>Hapi</td><td>é«˜</td><td>ä¸­é«˜</td><td>ä¸­ç­‰</td><td>éœ€æ‰‹åŠ¨é…</td><td>ä¸­ / å¤§</td><td>ç¨³å®šã€å®‰å…¨ã€ä¼ä¸šçº§</td><td>ä¼ä¸šçº§é…ç½®ä¼˜å…ˆæ¡†æ¶</td></tr><tr><td>Next.js</td><td>ä¸­</td><td>ä¸­ç­‰</td><td>æä¸°å¯Œ</td><td>åŸç”Ÿ TS</td><td>å° / ä¸­ / å¤§</td><td>React SSRã€å…¨æ ˆä¸€ä½“åŒ–</td><td>React å…¨æ ˆæ¡†æ¶</td></tr><tr><td>Sails.js</td><td>ä½</td><td>ä¸­ç­‰</td><td>ä¸­ç­‰</td><td>éœ€æ‰‹åŠ¨é…</td><td>å°</td><td>ä½ä»£ç ã€å¼€å‘é€Ÿåº¦å¿«</td><td>ä½ä»£ç å…¨æ ˆæ¡†æ¶</td></tr><tr><td>AdonisJS</td><td>ä¸­</td><td>ä¸­ç­‰</td><td>ä¸­ç­‰</td><td>åŸç”Ÿ TS</td><td>å° / ä¸­</td><td>Laravel é£æ ¼ã€å¼€ç®±å³ç”¨</td><td>å…¨æ ˆä¼ä¸šçº§æ¡†æ¶ï¼ˆNode ç‰ˆ Laravelï¼‰</td></tr><tr><td>Nuxt.js</td><td>ä¸­</td><td>ä¸­ç­‰</td><td>æä¸°å¯Œ</td><td>åŸç”Ÿ TS</td><td>å° / ä¸­ / å¤§</td><td>Vue SSRã€å…¨æ ˆä¸€ä½“åŒ–ã€SEO ä¼˜</td><td>Vue å…¨æ ˆæ¡†æ¶</td></tr><tr><td>Egg.js</td><td>ä¸­</td><td>ä¸­é«˜</td><td>ä¸°å¯Œ</td><td>éœ€æ‰‹åŠ¨é…</td><td>ä¸­ / å¤§</td><td>é˜¿é‡ŒèƒŒä¹¦ã€å¤šè¿›ç¨‹ã€å›½å†…ç”Ÿæ€å¥½</td><td>ä¼ä¸šçº§æ¡†æ¶ï¼ˆåŸºäº Koaï¼‰</td></tr></tbody></table>
<h3 data-id="heading-13">å››ã€é€‰å‹å»ºè®®</h3>
<ol>
<li><strong>ä¸ªäºº / å°å‹é¡¹ç›®ã€å¿«é€Ÿå¼€å‘</strong>ï¼šé€‰ Expressï¼ˆç”Ÿæ€å…¨ï¼‰æˆ– Koaï¼ˆå¼‚æ­¥ä½“éªŒå¥½ï¼‰ï¼›</li>
<li><strong>é«˜å¹¶å‘ APIã€å¾®æœåŠ¡</strong>ï¼šé€‰ Fastifyï¼ˆæ€§èƒ½ç¬¬ä¸€ï¼‰ï¼›</li>
<li><strong>å¤§å‹ä¼ä¸šåº”ç”¨ã€å›¢é˜Ÿåä½œ</strong>ï¼šé€‰ NestJSï¼ˆTS + è§„èŒƒï¼‰æˆ– Hapiï¼ˆç¨³å®šï¼‰ï¼›</li>
<li><strong>React å…¨æ ˆã€éœ€è¦ SEO</strong>ï¼šé€‰ Next.jsï¼›</li>
<li><strong>ä½ä»£ç ã€å¿«é€ŸåŸå‹</strong>ï¼šé€‰ Sails.jsã€‚</li>
</ol>
<h3 data-id="heading-14">æ€»ç»“</h3>
<ol>
<li><strong>æ ¸å¿ƒç»´åº¦</strong>ï¼šé€‰å‹ä¼˜å…ˆçœ‹ã€Œé¡¹ç›®è§„æ¨¡ + å›¢é˜ŸæŠ€æœ¯æ ˆ + æ€§èƒ½è¦æ±‚ã€ï¼Œå°å‹é¡¹ç›®åˆ«ç”¨é‡æ¡†æ¶ï¼ˆå¦‚ NestJSï¼‰ï¼Œå¤§å‹é¡¹ç›®åˆ«ç”¨å¤ªçµæ´»çš„æ¡†æ¶ï¼ˆå¦‚ Expressï¼‰ï¼›</li>
<li><strong>ç”Ÿæ€ä¼˜å…ˆçº§</strong>ï¼šå¦‚æœéœ€è¦é›†æˆå¤§é‡ç¬¬ä¸‰æ–¹åº“ï¼ŒExpress / Koa / Next.js æ˜¯é¦–é€‰ï¼›</li>
<li><strong>æ€§èƒ½ä¼˜å…ˆçº§</strong>ï¼šé«˜å¹¶å‘åœºæ™¯ç›´æ¥é€‰ Fastifyï¼›</li>
<li><strong>å›¢é˜Ÿåä½œ</strong>ï¼šå¤§å‹å›¢é˜Ÿä¼˜å…ˆ NestJSï¼ˆå¼ºè§„èŒƒï¼‰ï¼Œé¿å… Express å› çµæ´»å¯¼è‡´çš„ä»£ç æ··ä¹±ã€‚</li>
</ol>
<blockquote>
<p>okokok , è¿™ä¸ªæ–‡ç« åˆ°è¿™é‡Œå°±ç»“æŸäº† , æˆ‘ä»¬æœ‰ç¼˜å†ä¼š ğŸ˜ğŸ˜ğŸ˜ !!!</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Nginx è·¯å¾„æ˜ å°„æ·±åº¦è§£æï¼šä»æœ¬åœ°å¼€å‘åˆ°ç”Ÿäº§äº¤ä»˜çš„åº•å±‚å“²å­¦]]></title>    <link>https://juejin.cn/post/7603699739223293967</link>    <guid>https://juejin.cn/post/7603699739223293967</guid>    <pubDate>2026-02-08T05:01:07.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7603699739223293967" data-draft-id="7603673564908732451" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Nginx è·¯å¾„æ˜ å°„æ·±åº¦è§£æï¼šä»æœ¬åœ°å¼€å‘åˆ°ç”Ÿäº§äº¤ä»˜çš„åº•å±‚å“²å­¦"/> <meta itemprop="keywords" content="å‰ç«¯,åç«¯,æ¶æ„"/> <meta itemprop="datePublished" content="2026-02-08T05:01:07.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="æ–‡è‰ºç†ç§‘ç”ŸOwen"/> <meta itemprop="url" content="https://juejin.cn/user/3817963023244503"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Nginx è·¯å¾„æ˜ å°„æ·±åº¦è§£æï¼šä»æœ¬åœ°å¼€å‘åˆ°ç”Ÿäº§äº¤ä»˜çš„åº•å±‚å“²å­¦
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3817963023244503/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    æ–‡è‰ºç†ç§‘ç”ŸOwen
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-08T05:01:07.000Z" title="Sun Feb 08 2026 05:01:07 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»6åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">Nginx é™æ€èµ„æºæ˜ å°„ï¼šä»åŸç†åˆ°ç”Ÿäº§ç¯å¢ƒçš„æœ€ä½³å®è·µ</h2>
<blockquote>
<p><strong>æ‘˜è¦</strong>ï¼šåœ¨ç°ä»£å‰åç«¯åˆ†ç¦»æ¶æ„ä¸­ï¼ŒNginx ä¸ä»…æ˜¯é«˜æ€§èƒ½çš„é™æ€èµ„æºæœåŠ¡å™¨ï¼Œæ›´æ˜¯ä¸å¯æˆ–ç¼ºçš„åå‘ä»£ç†æ¢çº½ã€‚ç„¶è€Œï¼Œç”±äºå¯¹èµ„æºæ˜ å°„ï¼ˆroot/aliasï¼‰åŠè¯·æ±‚è½¬å‘ï¼ˆproxy_passï¼‰é€»è¾‘çš„ç†è§£åå·®ï¼Œå¾€å¾€ä¼šå¯¼è‡´ä» Windows å¼€å‘ç¯å¢ƒè¿ç§»è‡³ Linux ç”Ÿäº§ç¯å¢ƒæ—¶å‡ºç° 404 æˆ–è½¬å‘å¼‚å¸¸ã€‚æœ¬æ–‡å°†ä» HTTP åè®®è§†è§’å‡ºå‘ï¼Œæ·±åº¦å‰–æâ€œè·¯å¾„æ˜ å°„ä¸‰å‰‘å®¢â€çš„åº•å±‚é€»è¾‘ï¼Œå¹¶æä¾›ä¸€å¥—å¯è½åœ°çš„å·¥ç¨‹åŒ–é…ç½®è§„èŒƒä¸é¿å‘æŒ‡å—ã€‚</p>
</blockquote>
<hr/>
<h3 data-id="heading-1">1. ä¸šåŠ¡åœºæ™¯ä¸å·¥ç¨‹ç—›ç‚¹</h3>
<p>åœ¨å®é™…çš„å·¥ç¨‹é“¾è·¯ä¸­ï¼Œæˆ‘ä»¬ç»å¸¸é‡åˆ°è¿™æ ·çš„åœºæ™¯ï¼š
å‰ç«¯åŒå­¦åœ¨ Windows æœ¬åœ°ä½¿ç”¨ Nginx è°ƒè¯• SPAï¼ˆå•é¡µåº”ç”¨ï¼‰æˆ–é™æ€ç«™ç‚¹ï¼Œä¸€åˆ‡è¿è¡Œæ­£å¸¸ã€‚ä½†å½“ CI/CD æµæ°´çº¿å°†ä»£ç éƒ¨ç½²åˆ° Linux ç”Ÿäº§æœåŠ¡å™¨åï¼Œè®¿é—®ç‰¹å®šèµ„æºï¼ˆå¦‚å›¾ç‰‡ã€æ¬¡çº§è·¯ç”±ï¼‰å´é¢‘é¢‘å‡ºç° 404 é”™è¯¯ã€‚</p>
<p>è¿™å¹¶éç„å­¦ï¼Œè€Œæ˜¯ç”±äºå¯¹ <strong>Nginx è·¯å¾„è§£ææœºåˆ¶</strong> åŠ <strong>æ“ä½œç³»ç»Ÿæ–‡ä»¶ç³»ç»Ÿå·®å¼‚</strong> ç†è§£ä¸è¶³å¯¼è‡´çš„ã€‚è¦è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬éœ€è¦å…ˆå»ºç«‹æ­£ç¡®çš„è·¯å¾„æ˜ å°„å¿ƒæ™ºæ¨¡å‹ã€‚</p>
<h3 data-id="heading-2">2. æ ¸å¿ƒæ¨¡å‹è§£æï¼šURL ä¸æ–‡ä»¶ç³»ç»Ÿçš„æ˜ å°„</h3>
<p>Nginx çš„æ ¸å¿ƒèŒè´£ä¹‹ä¸€ï¼Œå°±æ˜¯å°†æŠ½è±¡çš„ <strong>HTTP URI</strong> æ˜ å°„åˆ°å…·ä½“çš„ <strong>æœåŠ¡å™¨æ–‡ä»¶ç³»ç»Ÿè·¯å¾„</strong>ã€‚</p>
<h4 data-id="heading-3">2.1 URI çš„è¯­ä¹‰å·®å¼‚</h4>
<p>åœ¨é…ç½®ä¹‹å‰ï¼Œå¿…é¡»æ˜ç¡® URL å°¾éƒ¨æ–œæ çš„åè®®è¯­ä¹‰ï¼š</p>
<ul>
<li><strong><code>/images</code></strong>ï¼šå®¢æˆ·ç«¯è¯·æ±‚åä¸º <code>images</code> çš„<strong>èµ„æºå®ä½“</strong>ï¼ˆå¯èƒ½æ˜¯æ–‡ä»¶ï¼Œä¹Ÿå¯èƒ½æ˜¯ç›®å½•ï¼‰ã€‚</li>
<li><strong><code>/images/</code></strong>ï¼šå®¢æˆ·ç«¯æ˜ç¡®è¯·æ±‚åä¸º <code>images</code> çš„<strong>ç›®å½•å®¹å™¨</strong>ã€‚</li>
</ul>
<p><strong>å·¥ç¨‹ç»†èŠ‚</strong>ï¼š
å½“ç”¨æˆ·è®¿é—® <code>/images</code>ï¼ˆä¸å¸¦æ–œæ ï¼‰ä¸”æœåŠ¡å™¨ä¸Šå­˜åœ¨åŒåç›®å½•æ—¶ï¼ŒNginx é»˜è®¤ä¼šè¿”å› <strong>301 Moved Permanently</strong>ï¼Œè‡ªåŠ¨é‡å®šå‘åˆ° <code>/images/</code>ã€‚è¿™æ˜¯ä¸ºäº†ç¡®ä¿ç›¸å¯¹è·¯å¾„èµ„æºï¼ˆå¦‚ <code>./logo.png</code>ï¼‰èƒ½åŸºäºæ­£ç¡®çš„ Base URL åŠ è½½ã€‚</p>
<hr/>
<h3 data-id="heading-4">3. èµ„æºæ˜ å°„ä¸‰å‰‘å®¢ï¼šRootã€Alias ä¸ Proxy_Pass</h3>
<p><code>root</code>ã€<code>alias</code> ä¸ <code>proxy_pass</code> æ˜¯ Nginx æµé‡åˆ†å‘çš„æ ¸å¿ƒæŒ‡ä»¤ã€‚å‰ä¸¤è€…è§£å†³çš„æ˜¯å¦‚ä½•å°† URI æ˜ å°„åˆ° <strong>æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿ</strong>ï¼Œè€Œåè€…è§£å†³çš„æ˜¯å¦‚ä½•å°†è¯·æ±‚è½¬å‘åˆ° <strong>ç½‘ç»œæœåŠ¡æ¥å£</strong>ã€‚</p>
<h4 data-id="heading-5">3.1 Rootï¼šè¿½åŠ é€»è¾‘ (Append)</h4>
<p><code>root</code> æŒ‡ä»¤é‡‡ç”¨<strong>è¿½åŠ </strong>ç­–ç•¥ã€‚å®ƒå°†è¯·æ±‚çš„ URI å®Œæ•´æ‹¼æ¥åˆ° <code>root</code> æŒ‡å®šçš„è·¯å¾„ä¹‹åã€‚</p>
<ul>
<li><strong>è®¡ç®—å…¬å¼</strong>ï¼š<code>æœ€ç»ˆç‰©ç†è·¯å¾„ = rootè·¯å¾„ + å®Œæ•´URI</code></li>
<li><strong>é…ç½®ç¤ºä¾‹</strong>ï¼š
<pre><code class="hljs language-nginx" lang="nginx">location /static/ {
    root /var/www/app;
}
</code></pre>
</li>
<li><strong>è§£æè¿‡ç¨‹</strong>ï¼šè¯·æ±‚ <code>GET /static/css/style.css</code> -&gt; ç‰©ç†è·¯å¾„ï¼š<code>/var/www/app/static/css/style.css</code></li>
</ul>
<h4 data-id="heading-6">3.2 Aliasï¼šæ›¿æ¢é€»è¾‘ (Replace)</h4>
<p><code>alias</code> æŒ‡ä»¤é‡‡ç”¨<strong>æ›¿æ¢</strong>ç­–ç•¥ã€‚å®ƒç”¨ <code>alias</code> æŒ‡å®šçš„è·¯å¾„æ›¿æ¢æ‰ <code>location</code> åŒ¹é…åˆ°çš„éƒ¨åˆ†ã€‚</p>
<ul>
<li><strong>è®¡ç®—å…¬å¼</strong>ï¼š<code>æœ€ç»ˆç‰©ç†è·¯å¾„ = aliasè·¯å¾„ + (å®Œæ•´URI - locationåŒ¹é…éƒ¨åˆ†)</code></li>
<li><strong>é…ç½®ç¤ºä¾‹</strong>ï¼š
<pre><code class="hljs language-nginx" lang="nginx">location /static/ {
    alias /var/www/app/public/;
}
</code></pre>
</li>
<li><strong>è§£æè¿‡ç¨‹</strong>ï¼šè¯·æ±‚ <code>GET /static/css/style.css</code> -&gt; åŒ¹é… <code>/static/</code> -&gt; å‰©ä½™ <code>css/style.css</code> -&gt; æœ€ç»ˆè®¿é—®ï¼š<code>/var/www/app/public/css/style.css</code></li>
</ul>
<h4 data-id="heading-7">3.3 Proxy_Passï¼šè¯·æ±‚è½¬å‘é€»è¾‘ (Forward)</h4>
<p>ä¸å¤„ç†æœ¬åœ°æ–‡ä»¶çš„æŒ‡ä»¤ä¸åŒï¼Œ<code>proxy_pass</code> å¤„ç†çš„æ˜¯ç½‘ç»œåè®®æ ˆçš„è½¬å‘ã€‚å…¶è·¯å¾„å¤„ç†é€»è¾‘éµå¾ªç›¸ä¼¼çš„â€œè¿½åŠ â€ä¸â€œæ›¿æ¢â€å“²å­¦ï¼Œç”±ç›®æ ‡ URL ç»“å°¾æ˜¯å¦æœ‰ <strong><code>/</code></strong> å†³å®šã€‚</p>
<h5 data-id="heading-8"><strong>åœºæ™¯ Aï¼šä¸å¸¦æ–œæ ï¼ˆé€æ˜è½¬å‘ï¼Œå¯¹åº” Root é€»è¾‘ï¼‰</strong></h5>
<p>å½“ <code>proxy_pass</code> çš„ç›®æ ‡ URL ä¸å¸¦è·¯å¾„ï¼ˆå³æ²¡æœ‰ç»“å°¾çš„ <code>/</code>ï¼‰æ—¶ï¼ŒNginx ä¼šå°†åŸå§‹è¯·æ±‚çš„ URI å®Œæ•´åœ°ä¼ é€’ç»™åç«¯æœåŠ¡ã€‚</p>
<ul>
<li><strong>é…ç½®ç¤ºä¾‹</strong>ï¼š
<pre><code class="hljs language-nginx" lang="nginx">location /api/ {
    proxy_pass http://127.0.0.1:3000; 
}
</code></pre>
</li>
<li><strong>è·¯å¾„è§£æ</strong>ï¼šè¯·æ±‚ <code>GET /api/user</code> -&gt; è½¬å‘åˆ° <code>http://127.0.0.1:3000/api/user</code>ã€‚</li>
<li><strong>å·¥ç¨‹ç‰¹å¾</strong>ï¼š<code>location</code> åŒ¹é…è·¯å¾„è¢«å®Œæ•´ä¿ç•™ã€‚é€‚ç”¨äºåç«¯æœåŠ¡æœ¬èº«å°±åŒ…å« <code>/api</code> å‰ç¼€çš„åœºæ™¯ã€‚</li>
</ul>
<h5 data-id="heading-9"><strong>åœºæ™¯ Bï¼šå¸¦æ–œæ ï¼ˆè·¯å¾„é‡å†™ï¼Œå¯¹åº” Alias é€»è¾‘ï¼‰</strong></h5>
<p>å½“ <code>proxy_pass</code> çš„ç›®æ ‡ URL åŒ…å«è·¯å¾„ï¼ˆå³ä½¿åªæœ‰ä¸€ä¸ªç»“å°¾çš„ <code>/</code>ï¼‰æ—¶ï¼ŒNginx ä¼šå°† URI ä¸­åŒ¹é… <code>location</code> çš„éƒ¨åˆ†æ›¿æ¢ä¸ºè¯¥è·¯å¾„ã€‚</p>
<ul>
<li><strong>é…ç½®ç¤ºä¾‹</strong>ï¼š
<pre><code class="hljs language-nginx" lang="nginx">location /api/ {
    proxy_pass http://127.0.0.1:3000/; 
}
</code></pre>
</li>
<li><strong>è·¯å¾„è§£æ</strong>ï¼šè¯·æ±‚ <code>GET /api/user</code> -&gt; è½¬å‘åˆ° <code>http://127.0.0.1:3000/user</code>ã€‚</li>
<li><strong>å·¥ç¨‹ç‰¹å¾</strong>ï¼š<code>location</code> åŒ¹é…è·¯å¾„è¢«â€œå‰¥ç¦»â€ã€‚é€‚ç”¨äºåç«¯æœåŠ¡æ˜¯çº¯å‡€æ¥å£ï¼Œä»…é€šè¿‡ Nginx ç»Ÿä¸€å‰ç¼€å…¥å£çš„åœºæ™¯ã€‚</li>
</ul>
<h4 data-id="heading-10">3.4 èµ„æºæ˜ å°„ä¸‰å‰‘å®¢å¯¹æ¯”è¡¨</h4>
<p>å‡è®¾ç»Ÿä¸€é…ç½® <code>location /api/</code>ï¼Œè§‚å¯Ÿä¸åŒæŒ‡ä»¤ä¸‹çš„æ˜ å°„ç»“æœï¼š</p>













































<table><thead><tr><th align="left">æŒ‡ä»¤</th><th align="left">æ˜ å°„ç›®æ ‡</th><th align="left">URI å¤„ç†æ–¹å¼</th><th align="left">ç¤ºä¾‹é…ç½®</th><th align="left">å®é™…è¯·æ±‚ -&gt; ç»“æœæ˜ å°„</th><th align="left">å…¸å‹åœºæ™¯</th></tr></thead><tbody><tr><td align="left"><strong>Root</strong></td><td align="left">æœ¬åœ°ç£ç›˜</td><td align="left"><strong>è¿½åŠ </strong> (Append)</td><td align="left"><code>root /data;</code></td><td align="left"><code>/api/user</code> -&gt; <code>/data/api/user</code></td><td align="left">é™æ€ç«™ç‚¹é»˜è®¤éƒ¨ç½²</td></tr><tr><td align="left"><strong>Alias</strong></td><td align="left">æœ¬åœ°ç£ç›˜</td><td align="left"><strong>æ›¿æ¢</strong> (Replace)</td><td align="left"><code>alias /data/v1/;</code></td><td align="left"><code>/api/user</code> -&gt; <code>/data/v1/user</code></td><td align="left">è™šæ‹Ÿè·¯å¾„ã€èµ„æºåˆ«å</td></tr><tr><td align="left"><strong>Proxy_Pass (æ— /)</strong></td><td align="left">è¿œç¨‹æœåŠ¡</td><td align="left"><strong>é€æ˜è½¬å‘</strong></td><td align="left"><code>proxy_pass http://node:3000;</code></td><td align="left"><code>/api/user</code> -&gt; <code>node:3000/api/user</code></td><td align="left">åç«¯æœåŠ¡è‡ªå¸¦å‰ç¼€</td></tr><tr><td align="left"><strong>Proxy_Pass (å¸¦/)</strong></td><td align="left">è¿œç¨‹æœåŠ¡</td><td align="left"><strong>è·¯å¾„é‡å†™</strong></td><td align="left"><code>proxy_pass http://node:3000/;</code></td><td align="left"><code>/api/user</code> -&gt; <code>node:3000/user</code></td><td align="left">ç»Ÿä¸€å…¥å£ï¼Œåç«¯æ— å‰ç¼€</td></tr></tbody></table>
<hr/>
<h3 data-id="heading-11">4. å·¥ç¨‹åŒ–è½åœ°ï¼šè·¨å¹³å°ç¯å¢ƒå·®å¼‚å¤„ç†</h3>
<p>åœ¨å›¢é˜Ÿåä½œä¸­ï¼Œç»Ÿä¸€å¼€å‘ç¯å¢ƒï¼ˆWindows/Macï¼‰ä¸ç”Ÿäº§ç¯å¢ƒï¼ˆLinuxï¼‰çš„é…ç½®è§„èŒƒè‡³å…³é‡è¦ã€‚</p>
<h4 data-id="heading-12">4.1 Windows å¼€å‘ç¯å¢ƒçš„é™·é˜±</h4>
<p>Windows æ–‡ä»¶ç³»ç»Ÿæœ‰â€œç›˜ç¬¦â€æ¦‚å¿µï¼Œä¸”å¯¹è·¯å¾„åˆ†éš”ç¬¦ä¸æ•æ„Ÿã€‚</p>
<ul>
<li><strong>ç»å¯¹è·¯å¾„é—®é¢˜</strong>ï¼š
åœ¨ Windows ä¸‹é…ç½® <code>root /html;</code>ï¼ŒNginx ä¼šå°†å…¶è§£æä¸ºå½“å‰ç›˜ç¬¦çš„æ ¹ç›®å½•ï¼ˆå¦‚ <code>D:\html</code>ï¼‰ï¼Œè€Œé Nginx å®‰è£…ç›®å½•ã€‚</li>
<li><strong>æœ€ä½³å®è·µ</strong>ï¼š
<strong>ä½¿ç”¨ç›¸å¯¹è·¯å¾„</strong>ã€‚
<pre><code class="hljs language-nginx" lang="nginx"># æ¨èï¼šç›¸å¯¹äº Nginx å®‰è£…ç›®å½• (prefix)
location / {
    root html; 
    index index.html;
}
</code></pre>
</li>
</ul>
<h4 data-id="heading-13">4.2 Linux ç”Ÿäº§ç¯å¢ƒçš„è§„èŒƒ</h4>
<p>Linux ç¯å¢ƒå¼ºè°ƒæƒé™æ§åˆ¶ä¸è·¯å¾„çš„ç¡®å®šæ€§ã€‚</p>
<ul>
<li>
<p><strong>ç»å¯¹è·¯å¾„å¼ºåˆ¶</strong>ï¼š
ç”Ÿäº§é…ç½®å¿…é¡»ä½¿ç”¨ç»å¯¹è·¯å¾„ï¼Œé¿å…å› å¯åŠ¨æ–¹å¼ä¸åŒå¯¼è‡´çš„å·¥ä½œç›®å½•æ¼‚ç§»ã€‚</p>
<pre><code class="hljs language-nginx" lang="nginx">root /usr/share/nginx/html;
</code></pre>
</li>
<li>
<p><strong>æƒé™éš”ç¦» (Permission)</strong>ï¼š
å¸¸è§çš„ 403 Forbidden é”™è¯¯é€šå¸¸å¹¶éé…ç½®é”™è¯¯ï¼Œè€Œæ˜¯æƒé™é—®é¢˜ã€‚</p>
<ul>
<li><strong>è¦æ±‚</strong>ï¼šNginx è¿è¡Œç”¨æˆ·ï¼ˆé€šå¸¸æ˜¯ <code>nginx</code> æˆ– <code>www-data</code>ï¼‰å¿…é¡»æ‹¥æœ‰ä»æ ¹ç›®å½•åˆ°ç›®æ ‡æ–‡ä»¶å…¨è·¯å¾„çš„ <strong>x (æ‰§è¡Œ/æœç´¢)</strong> æƒé™ï¼Œä»¥åŠç›®æ ‡æ–‡ä»¶çš„ <strong>r (è¯»å–)</strong> æƒé™ã€‚</li>
<li><strong>æ’æŸ¥å‘½ä»¤</strong>ï¼š
<pre><code class="hljs language-bash" lang="bash">namei -om /var/www/project/static/image.png
</code></pre>
</li>
</ul>
</li>
<li>
<p><strong>Alias çš„æ–œæ å¯¹ç§°æ€§</strong>ï¼š
è¿™æ˜¯ä¸€ä¸ªå®¹æ˜“è¢«å¿½è§†çš„ Bug æºã€‚åœ¨ Linux ä¸‹ä½¿ç”¨ <code>alias</code> æ—¶ï¼Œå¦‚æœ <code>location</code> åªæœ‰å°¾éƒ¨æ–œæ ï¼Œå»ºè®® <code>alias</code> ä¹ŸåŠ ä¸Šå°¾éƒ¨æ–œæ ï¼Œä¿æŒå¯¹ç§°ï¼Œé¿å…è·¯å¾„æ‹¼æ¥é”™ä½ã€‚</p>
<pre><code class="hljs language-nginx" lang="nginx"># Good
location /img/ {
    alias /var/www/images/;
}
</code></pre>
</li>
</ul>
<h3 data-id="heading-14">5. è°ƒè¯•ä¸æ’é”™æŒ‡å—</h3>
<p>å½“å‡ºç° 404 æˆ– 403 æ—¶ï¼Œä¸è¦ç›²ç›®çŒœæµ‹ï¼Œè¯·éµå¾ªä»¥ä¸‹æ’æŸ¥è·¯å¾„ï¼š</p>
<ol>
<li>
<p><strong>Check Error Log</strong>ï¼š
è¿™æ˜¯æœ€ç›´æ¥çš„è¯æ®ã€‚Nginx çš„ <code>error.log</code> ä¼šæ˜ç¡®æ‰“å°å‡ºå®ƒè¯•å›¾è®¿é—®çš„å®Œæ•´ç‰©ç†è·¯å¾„ã€‚</p>
<pre><code class="hljs language-text" lang="text">open() "/var/www/app/static/css/style.css" failed (2: No such file or directory)
</code></pre>
<p>å¯¹æ¯”æ—¥å¿—ä¸­çš„è·¯å¾„ä¸ä½ é¢„æœŸçš„è·¯å¾„ï¼Œé€šå¸¸èƒ½ç«‹åˆ»å‘ç° <code>root</code> æˆ– <code>alias</code> çš„è¯¯ç”¨ã€‚</p>
</li>
<li>
<p><strong>éªŒè¯æ–‡ä»¶å­˜åœ¨æ€§</strong>ï¼š
ç›´æ¥å¤åˆ¶æ—¥å¿—ä¸­çš„è·¯å¾„ï¼Œåœ¨æœåŠ¡å™¨ä¸Šæ‰§è¡Œ <code>ls -l &lt;path&gt;</code>ï¼Œç¡®è®¤æ–‡ä»¶æ˜¯å¦å­˜åœ¨ä»¥åŠæƒé™æ˜¯å¦æ­£ç¡®ã€‚</p>
</li>
</ol>
<hr/>
<p><strong>æ€»ç»“</strong>ï¼š
Nginx çš„è·¯å¾„æ˜ å°„ä¸è½¬å‘é€»è¾‘è™½ç„¶ç»†ç¢ï¼Œä½†å…¶èƒŒåéµå¾ªç€é«˜åº¦ä¸€è‡´çš„â€œè¿½åŠ â€ä¸â€œæ›¿æ¢â€å“²å­¦ã€‚æŒæ¡ <code>root</code>ã€<code>alias</code> ä¸ <code>proxy_pass</code> çš„åº•å±‚å·®å¼‚ï¼Œä¸ä»…èƒ½è§£å†³ 404/403 ç­‰è¡¨è±¡é—®é¢˜ï¼Œæ›´èƒ½å¸®åŠ©å¼€å‘è€…æ„å»ºå‡ºä¼˜é›…ã€å¯ç»´æŠ¤çš„é…ç½®ä½“ç³»ã€‚åœ¨å·¥ç¨‹å®è·µä¸­ï¼Œå»ºè®®é€šè¿‡<strong>è§„èŒƒåŒ–è·¯å¾„å‘½å</strong>ï¼ˆå¦‚ç»Ÿä¸€ä½¿ç”¨ <code>/api/</code> å‰ç¼€ï¼‰ä¸<strong>ç¯å¢ƒæ„ŸçŸ¥é…ç½®</strong>ï¼ˆå¦‚ Linux ç»å¯¹è·¯å¾„å¼ºåˆ¶åŒ–ï¼‰æ¥é™ä½è¿ç»´å¤æ‚åº¦ï¼Œç¡®ä¿ä»æœ¬åœ°å¼€å‘åˆ°ç”Ÿäº§äº¤ä»˜çš„ä¸æ»‘é¡ºç•…ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ã€ThreeJSå®æˆ˜ã€‘ä»86MBåˆ°4MBï¼šå¤æ‚æ¨¡å‹åŠ è½½ä¼˜åŒ–é»‘é­”æ³•]]></title>    <link>https://juejin.cn/post/7603771025856397363</link>    <guid>https://juejin.cn/post/7603771025856397363</guid>    <pubDate>2026-02-08T05:34:15.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7603771025856397363" data-draft-id="7603771025855922227" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ã€ThreeJSå®æˆ˜ã€‘ä»86MBåˆ°4MBï¼šå¤æ‚æ¨¡å‹åŠ è½½ä¼˜åŒ–é»‘é­”æ³•"/> <meta itemprop="keywords" content="three.js,æ€§èƒ½ä¼˜åŒ–"/> <meta itemprop="datePublished" content="2026-02-08T05:34:15.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å¶æ™ºè¾½"/> <meta itemprop="url" content="https://juejin.cn/user/3320999244205294"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ã€ThreeJSå®æˆ˜ã€‘ä»86MBåˆ°4MBï¼šå¤æ‚æ¨¡å‹åŠ è½½ä¼˜åŒ–é»‘é­”æ³•
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3320999244205294/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å¶æ™ºè¾½
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-08T05:34:15.000Z" title="Sun Feb 08 2026 05:34:15 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»5åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><em>å‰è¨€ï¼šæ­£å½“æˆ‘æ²‰æµ¸åœ¨å°†draw callä»52000ä¼˜åŒ–åˆ°1çš„å–œæ‚¦ä¸­æ— æ³•è‡ªæ‹”æ—¶ï¼Œäº§å“ç»ç†è¿™æ—¶å€™åˆæ€è¿‡æ¥äº†ï¼š"å®¢æˆ·è¯´æ¨¡å‹åŠ è½½è¦30ç§’ï¼Œè¿˜æ²¡è¿›å»å°±å…³é¡µé¢äº†ï¼Œä½ ä¼˜åŒ–ä¸€ä¸‹ï¼Ÿ"æˆ‘æ‰“å¼€Networké¢æ¿ä¸€çœ‹ï¼Œå§æ§½ï¼Œ86MBçš„GLBæ–‡ä»¶ï¼è¿™è°é¡¶å¾—ä½å•Š...</em></p>
<p>å¦‚æœä½ ä¹Ÿé‡åˆ°è¿‡è¿™ç§æƒ…å†µï¼šç²¾å¿ƒæ‰“ç£¨çš„3Dåœºæ™¯ï¼Œæœ¬åœ°è¿è¡Œä¸æ»‘æµç•…ï¼Œä¸€ä¸Šçº¿ç”¨æˆ·éª‚å¨˜â€”â€”"ç ´ç½‘ç«™å¡æ­»äº†"ã€"æ€ä¹ˆè¿˜åœ¨è½¬åœˆ"ã€"æ‰‹æœºç›´æ¥é—ªé€€"ã€‚åˆ«æ€¥ç€æ€ªç”¨æˆ·ç½‘é€Ÿæ…¢ï¼Œå…ˆçœ‹çœ‹ä½ çš„æ¨¡å‹æ˜¯ä¸æ˜¯<strong>å¤ªèƒ–äº†</strong>ã€‚</p>
<p>æˆ‘è¿™æœ‰ä¸ªå¤æ‚æ¨¡å‹ï¼Œå‡ ä½•ä½“+è´´å›¾ä¸€å…±<strong>86MB</strong>ï¼Œåœ¨4Gç½‘ç»œä¸‹åŠ è½½éœ€è¦<strong>30ç§’</strong>ï¼ˆChromeæ¨¡æ‹ŸSlow 4G(3mb/s)ä¸€ç›´åŠ è½½...)ã€‚ä»Šå¤©å’±ä»¬ä¸è®²Blenderæ“ä½œæ¨¡å‹ï¼ˆä¹‹å‰ç”¨Blenderæ˜¯å› ä¸ºæ²¡æ‹›ï¼Œç°åœ¨æœ‰æ›´ç‹ çš„ï¼‰ï¼Œç›´æ¥ç”¨<strong>å‘½ä»¤è¡Œé»‘é­”æ³•</strong>æŠŠå®ƒå‹åˆ°<strong>4MB!!</strong>ï¼ŒåŠ è½½æ—¶é—´ä»30ç§’å¹²åˆ°<strong>1.5ç§’</strong>ã€‚</p>
<p>ä»¥ä¸‹æ˜¯ä¼˜åŒ–å‰çš„ç»æœ›ç°åœºæ•´æ•´åŠ è½½äº†30å¤šç§’...</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/674e9f906cc746b3b8f29b017e4603a1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y-25pm66L69:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771133660&amp;x-signature=tsoCT58MD8cav1uSQnyd2NcJc%2Bc%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-0">ä¸€ã€ä¼˜åŒ–æ€è·¯</h3>
<p>æ—¢ç„¶çŸ¥é“äº†åŠ è½½ä¸ºä»€ä¹ˆé‚£ä¹ˆæ…¢çš„åŸå› ï¼Œé‚£æˆ‘ä»¬å°±å¯ä»¥å¼€å§‹æƒ³æƒ³è¯¥æ€ä¹ˆä¼˜åŒ–äº†</p>
<p>æˆ‘ç›®å‰çš„æ€è·¯å°±æ˜¯ç”¨<code>gltf-transform</code>
å…ˆæŠŠæ¨¡å‹ä½“ç§¯å‹ä¸‹æ¥ï¼Œè¦ä¸ç„¶æ¸²æŸ“çš„æ—¶å€™å†æµç•…ï¼Œå®¢æˆ·ç­‰åˆ°ç¬¬äºŒåç§’çš„æ—¶å€™å…³é—­æµè§ˆå™¨ï¼Œä¹Ÿæ²¡æœ‰æ„ä¹‰äº†ã€‚ã€‚</p>
<h3 data-id="heading-1">äºŒã€DRACOLoader</h3>
<p>ThreeJS DRACOLoaderç›´æ¥æ— ç¼è§£å‹ç¼©è¢«å‹ç¼©çš„æ¨¡å‹</p>
<h4 data-id="heading-2">å®‰è£…å‹ç¼©æ¨¡å‹å·¥å…·ï¼ˆä¸ç”¨Blenderï¼Œå‘½ä»¤è¡Œæå®šï¼‰</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># å®‰è£…gltf-transformï¼ˆä¸€è¡Œå‘½ä»¤æå®šDracoå‹ç¼©+WebP+KTX2ï¼‰</span>
npm install -g @gltf-transform/cli
</code></pre>
<p>è‡³äºæˆ‘ä¸ºä»€ä¹ˆé€‰æ‹©gltf-transformè€Œä¸æ˜¯gltf-pipelineï¼Œä»¥ä¸‹æ˜¯å®ƒä»¬çš„å¯¹æ¯”ï¼š</p>



































<table><thead><tr><th>ç‰¹æ€§</th><th>gltf-pipeline</th><th>gltf-transform</th></tr></thead><tbody><tr><td><strong>Dracoå‹ç¼©</strong></td><td>âœ… æ”¯æŒ</td><td>âœ… æ”¯æŒï¼ˆæ›´å¿«ï¼‰</td></tr><tr><td><strong>WebPçº¹ç†</strong></td><td>âŒ ä¸æ”¯æŒ</td><td>âœ… æ”¯æŒï¼ˆå…³é”®ï¼ï¼‰</td></tr><tr><td><strong>KTX2/Basis</strong></td><td>âŒ ä¸æ”¯æŒ</td><td>âœ… æ”¯æŒ</td></tr><tr><td><strong>å®‰è£…ä½“ç§¯</strong></td><td>å¤§ï¼ˆä¾èµ–å¤šï¼‰</td><td>å°ï¼ˆWASMæ ¸å¿ƒï¼‰</td></tr><tr><td><strong>æ¨èåº¦</strong></td><td>â­â­â­</td><td>â­â­â­â­â­</td></tr></tbody></table>
<h2 data-id="heading-3">å‹ç¼©ä½ çš„GLBï¼ˆ80MB â†’ 4MBï¼‰</h2>
<pre><code class="hljs language-bash" lang="bash">gltf-transform optimize input.glb output.glb \
  --compress draco \
  --texture-compress webp \
  --texture-size 2048
</code></pre>
<p>ä»¥ä¸‹æ˜¯æˆ‘å‹ç¼©ä¹‹åçš„ä½“ç§¯ï¼š</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b7625fd53c564acb8f71b83e39f2cd5a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y-25pm66L69:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771133660&amp;x-signature=Qt6vRnu5GJeXcNUoNO%2By5kpmOEM%3D" alt="image.png" loading="lazy"/></p>
<p>å¯ä»¥çœ‹åˆ°ï¼Œæ¨¡å‹çš„ä½“ç§¯å¾—åˆ°äº†å·¨å¤§çš„ç¼©å‡ï¼Œä»åŸæ¥çš„86mbåˆ°ç°åœ¨çš„4mbå·¦å³ï¼</p>
<p><strong>å‚æ•°è¯´æ˜</strong>ï¼š</p>













































<table><thead><tr><th>å‚æ•°</th><th>è¯´æ˜</th><th>å»ºè®®å€¼</th></tr></thead><tbody><tr><td><code>--texture-compress webp</code></td><td>è´´å›¾è½¬WebPæ ¼å¼</td><td><strong>å¿…åŠ </strong>ï¼Œä½“ç§¯å‡åŠ</td></tr><tr><td><code>--texture-compress ktx2</code></td><td>è´´å›¾è½¬KTX2ï¼ˆGPUç›´è¯»ï¼‰</td><td>å¦‚æœç›®æ ‡è®¾å¤‡æ”¯æŒï¼Œæ¯”WebPæ›´å¥½</td></tr><tr><td><code>--texture-size 2048</code></td><td>é™åˆ¶æœ€å¤§è´´å›¾å°ºå¯¸</td><td><strong>å¿…åŠ </strong>ï¼Œ4096â†’2048çœ4å€æ˜¾å­˜</td></tr><tr><td><code>--compress draco</code></td><td>å¯ç”¨Dracoå‡ ä½•å‹ç¼©</td><td><strong>å¿…åŠ </strong>ï¼Œé»˜è®¤å°±æ˜¯sequentialæ¨¡å¼</td></tr><tr><td><code>--compress-method sequential</code></td><td>Dracoç¼–ç æ¨¡å¼</td><td>sequentialï¼ˆé»˜è®¤ï¼Œå°ä½“ç§¯ï¼‰æˆ– edgeloopï¼ˆå¿«è§£ç ï¼‰</td></tr><tr><td><code>--compress-level 10</code></td><td>Dracoå‹ç¼©çº§åˆ«</td><td>0-10ï¼Œ10å‹æœ€ç‹ ä½†è§£å‹æ…¢ï¼Œå»ºè®®7-10</td></tr><tr><td><code>--flatten</code></td><td>æ‰“å¹³èŠ‚ç‚¹å±‚çº§</td><td>å¦‚æœæ¨¡å‹å±‚çº§å¤ªæ·±ï¼ŒåŠ è¿™ä¸ªå‡å°‘DrawCallï¼ˆä½†ä¼šä¸¢å¤±åŠ¨ç”»ï¼‰</td></tr></tbody></table>
<p>ä»¥ä¸‹æ˜¯ä¼˜åŒ–ä¹‹åçš„åŠ è½½æ—¶é—´ï¼Œå°±é—®ä½ å¿«ä¸å¿«ï¼</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7c128c4ba2d14860b8623cf34327cf21~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y-25pm66L69:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771133660&amp;x-signature=Gj1p3h7rSzkEUOr8ceIYI4kXA2s%3D" alt="image.png" loading="lazy"/></p>
<h4 data-id="heading-4">Three.jsåŠ è½½ä»£ç ï¼ˆå…³é”®ï¼ï¼‰</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">/**
 * ä¼˜åŒ–åçš„ GLB åŠ è½½æ­¥éª¤ï¼ˆDraco / gltf-transformï¼‰
 *
 * ä¾èµ–ï¼šThree.jsã€GLTFLoaderã€DRACOLoader
 * è§£ç å™¨ï¼šæŠŠ three çš„ examples/jsm/libs/draco/gltf/ æ”¾åˆ°ç«™ç‚¹ /draco/ ä¸‹ï¼Œæˆ–ä½¿ç”¨ CDN è·¯å¾„
 */</span>

<span class="hljs-keyword">import</span> { <span class="hljs-title class_">GLTFLoader</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'three/examples/jsm/loaders/GLTFLoader'</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">DRACOLoader</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'three/examples/jsm/loaders/DRACOLoader'</span>;

<span class="hljs-comment">// â€”â€”â€”â€”â€” æ­¥éª¤ 1ï¼šåˆ›å»º Draco è§£ç å™¨å¹¶æŒ‡å®šè·¯å¾„ â€”â€”â€”â€”â€”</span>
<span class="hljs-keyword">const</span> dracoLoader = <span class="hljs-keyword">new</span> <span class="hljs-title class_">DRACOLoader</span>();
dracoLoader.<span class="hljs-title function_">setDecoderPath</span>(<span class="hljs-string">'/draco/'</span>);
<span class="hljs-comment">// æˆ–ç”¨ CDNï¼ˆä¸é¡¹ç›® three ç‰ˆæœ¬ä¸€è‡´ï¼‰ï¼š'https://cdn.jsdelivr.net/npm/three@0.182.0/examples/jsm/libs/draco/gltf/'</span>

<span class="hljs-comment">// â€”â€”â€”â€”â€” æ­¥éª¤ 2ï¼šæŠŠ DRACOLoader æŒ‚åˆ° GLTFLoader ä¸Š â€”â€”â€”â€”â€”</span>
<span class="hljs-keyword">const</span> loader = <span class="hljs-keyword">new</span> <span class="hljs-title class_">GLTFLoader</span>();
loader.<span class="hljs-title function_">setDRACOLoader</span>(dracoLoader);

<span class="hljs-comment">// â€”â€”â€”â€”â€” æ­¥éª¤ 3ï¼šæ­£å¸¸ loadï¼Œæ™®é€š GLB ä¸ Draco å‹ç¼©çš„ GLB éƒ½èƒ½åŠ è½½ â€”â€”â€”â€”â€”</span>
loader.<span class="hljs-title function_">load</span>(
  <span class="hljs-string">'https://your-cdn.com/model-optimized.glb'</span>,
  <span class="hljs-function">(<span class="hljs-params">gltf</span>) =&gt;</span> {
    scene.<span class="hljs-title function_">add</span>(gltf.<span class="hljs-property">scene</span>);
  },
  <span class="hljs-literal">undefined</span>,
  <span class="hljs-function">(<span class="hljs-params">err</span>) =&gt;</span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(err),
);

<span class="hljs-comment">// Promise å†™æ³•ï¼ˆå¯é€‰ï¼‰ï¼š</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">loadOptimizedGLB</span>(<span class="hljs-params">url</span>) {
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> {
    loader.<span class="hljs-title function_">load</span>(url, resolve, <span class="hljs-literal">undefined</span>, reject);
  });
}
<span class="hljs-comment">// ä½¿ç”¨æ–¹å¼ï¼šconst gltf = await loadOptimizedGLB(url);</span>

</code></pre>
<p><strong>æ³¨æ„</strong>ï¼š<code>setDecoderPath</code> æŒ‡å‘çš„æ˜¯ Draco çš„ WASM è§£ç æ–‡ä»¶ï¼Œéœ€è¦ä» Three.js çš„ <code>examples/jsm/libs/draco/</code> ç›®å½•å¤åˆ¶åˆ°ä½ çš„ public æ–‡ä»¶å¤¹ï¼Œæˆ–è€…ç”¨ CDNï¼ˆä¸Šé¢ç¤ºä¾‹ç”¨çš„æ˜¯ä»threejså¤åˆ¶çš„æœ¬åœ°è§£ç æ–‡ä»¶ï¼‰ã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f6056ed4edd8424e9f576076746a6227~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y-25pm66L69:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771133660&amp;x-signature=LfB00kEcCV01BCgkwfo%2BfL0j%2B2E%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0bcc195429b6461dad0a0b37005c7a60~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y-25pm66L69:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771133660&amp;x-signature=Pm6unUZnhNJrWVyGpRLGgHL%2B5u4%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-5">é¿å‘æŒ‡å—</h3>
<ol>
<li><strong>åˆ«é‡å¤å‹ç¼©</strong>ï¼šDracoæ˜¯æœ‰æŸå‹ç¼©ï¼Œå‹ä¸€æ¬¡æŸå¤±ä¸€ç‚¹ç²¾åº¦ï¼Œ<strong>åˆ«å‹ä¸¤é</strong>ï¼å…ˆå¤‡ä»½åŸæ–‡ä»¶ã€‚</li>
<li><strong>WebPå…¼å®¹æ€§</strong>ï¼šè™½ç„¶ç°ä»£æµè§ˆå™¨éƒ½æ”¯æŒWebPï¼Œä½†å¦‚æœä½ è¦å…¼å®¹IE11ï¼ˆè™½ç„¶ä¸åº”è¯¥ï¼‰ï¼Œåªèƒ½ç”¨PNG/JPGã€‚</li>
<li><strong>KTX2è°¨æ…ç”¨</strong>ï¼šKTX2ï¼ˆBasis Universalï¼‰å‹ç¼©ç‡æœ€é«˜ï¼Œä½†éœ€è¦ GPU æ”¯æŒï¼Œè€æ—§æ‰‹æœºå¯èƒ½è§£ç å¤±è´¥ï¼Œå»ºè®® WebP æ›´ç¨³å¦¥ã€‚</li>
<li><strong>é‡åŒ–ç²¾åº¦</strong>ï¼šå¦‚æœä½ å‘ç°å‹ç¼©åçš„æ¨¡å‹å‡ºç°<strong>è£‚ç¼</strong>ï¼ˆé¡¶ç‚¹æ²¡å¯¹é½ï¼‰ï¼ŒæŠŠ <code>--quantization-position</code> ä» 10 è°ƒåˆ° 14ã€‚</li>
</ol>
<p><strong>è¿˜æœ‰ä¸€ä»¶äº‹</strong>ï¼šDracoæ˜¯<strong>æœ‰æŸå‹ç¼©</strong>ï¼Œä½†è§†è§‰ä¸Šå‡ ä¹çœ‹ä¸å‡ºå·®åˆ«ï¼ˆå·¥ä¸šæ¨¡å‹é¡¶ç‚¹ç²¾åº¦å¤Ÿé«˜ï¼‰ï¼Œè§£å‹æ˜¯åœ¨Web Workeré‡Œè¿›è¡Œçš„ï¼Œä¸ä¼šå¡ä¸»çº¿ç¨‹ã€‚</p>
<h3 data-id="heading-6">ä¸‰ã€åˆåˆ°äº†å–œé—»ä¹è§çš„å‰åå¯¹æ¯”ï¼ˆåˆºæ¿€ï¼ï¼‰</h3>




















<table><thead><tr><th>æŒ‡æ ‡</th><th>åŸå§‹æ¨¡å‹</th><th>Dracoå‹ç¼©</th></tr></thead><tbody><tr><td><strong>æ–‡ä»¶ä½“ç§¯</strong></td><td>86MB</td><td>4MB</td></tr><tr><td><strong>4GåŠ è½½æ—¶é—´</strong></td><td>30ç§’</td><td>1.5ç§’</td></tr></tbody></table>
<p>å¯ä»¥çœ‹åˆ°åŠ è½½æ—¶é—´è·¨åº¦å¾ˆå¤§ï¼Œä»30ç§’åˆ°1.5ç§’ï¼Œè¶³è¶³æå‡äº†20å€ï¼Œå®¢æˆ·æœ¬æ¥éƒ½è¦ç¡ç€äº†ï¼Œä½†ç°åœ¨å®¢æˆ·çœ¨äº†ä¸€ä¸‹çœ¼ç›ï¼Œå°±å‘ç°çœ¼å‰å±å¹•é‡Œçš„ä¸–ç•Œéƒ½ä¸ä¸€æ ·äº†~</p>
<h3 data-id="heading-7">æ€»ç»“</h3>
<p>ä¼˜åŒ–è·¯å¾„ï¼š<strong>86MBï¼ˆåŸå§‹ï¼‰â†’ 4MBï¼ˆDraco+WebPï¼‰â†’ 1.5ç§’åŠ è½½å®Œæˆ</strong></p>
<p><strong>æ ¸å¿ƒè®¤çŸ¥</strong>ï¼š</p>
<ul>
<li><strong>gltf-transform</strong>ï¼šä¸€ç«™å¼è§£å†³å‡ ä½•ä½“+è´´å›¾å‹ç¼©ï¼Œä¸ç”¨Blenderï¼Œä¸€è¡Œå‘½ä»¤æå®š</li>
<li><strong>Draco</strong>ï¼šè§£å†³"ä¸‹è½½æ…¢"ï¼ˆå‡ ä½•ä½“ä»18MBå‹åˆ°2MBï¼‰</li>
<li><strong>WebP</strong>ï¼šè§£å†³"è´´å›¾è‚¥"ï¼ˆ68MBå‹åˆ°2MBï¼Œå…¼å®¹æ€§æœ€å¥½ï¼‰</li>
</ul>
<p><strong>æ²¡ç”¨åˆ°çš„æ‰‹æ®µï¼ˆè¿›é˜¶å¯é€‰ï¼‰</strong>ï¼š</p>
<ul>
<li><strong>KTX2</strong>ï¼šæ¯”WebPä½“ç§¯æ›´å°ä¸”GPUç›´è¯»ï¼Œä½†éœ€è¦è®¾å¤‡æ”¯æŒï¼Œè€æ—§æ‰‹æœºå¯èƒ½è§£ç å¤±è´¥</li>
<li><strong>åˆ†å—åŠ è½½</strong>ï¼šå¦‚æœ4MBè¿˜æ˜¯å¤§ï¼Œå¯ä»¥æ‹†æˆ"å¤–å£³1MB+ç»†èŠ‚3MB"ï¼Œé¦–å±ç§’å¼€</li>
</ul>
<p><strong>ä¸ç”¨Blenderï¼Œå…¨ç¨‹å‘½ä»¤è¡Œ+ä»£ç æå®š</strong>ï¼Œè¿™æ‰æ˜¯å·¥ç¨‹å¸ˆçš„æµªæ¼«ã€‚</p>
<p>ä¸‹ç¯‡é¢„å‘Šï¼šã€ThreeJSå®æˆ˜ã€‘GPUè¿˜æ˜¯100%ï¼ŸLODç­–ç•¥ï¼šè®©è¿œå¤„æ¨¡å‹è‡ªåŠ¨"å‡è‚¥"</p>
<p><strong>äº’åŠ¨</strong>ï¼šä½ ç”¨<code>gltf-transform</code>å‹äº†å¤šå°‘å€ï¼Ÿæˆ‘<strong>20å€</strong>ç®—ä¸ç®—ç‹ ï¼Ÿè¯„è®ºåŒºæŠ¥å‡ºä½ çš„<strong>åŸå§‹ä½“ç§¯vsä¼˜åŒ–åä½“ç§¯</strong>ï¼Œçœ‹çœ‹è°æ˜¯çœŸæ­£çš„"å‹ç‹"ğŸ˜</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ç”¨ React æ‰‹æ“ä¸€ä¸ª 3D ç¿»é¡µä¹¦ç±ç»„ä»¶ï¼Œå‘¼å¸æµ·æµªå¼ç¿»é¡µï¼Œäº¤äº’ä½“éªŒå¸¦æ„Ÿï¼]]></title>    <link>https://juejin.cn/post/7603771025856430131</link>    <guid>https://juejin.cn/post/7603771025856430131</guid>    <pubDate>2026-02-08T05:46:14.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7603771025856430131" data-draft-id="7603674653153099785" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ç”¨ React æ‰‹æ“ä¸€ä¸ª 3D ç¿»é¡µä¹¦ç±ç»„ä»¶ï¼Œå‘¼å¸æµ·æµªå¼ç¿»é¡µï¼Œäº¤äº’ä½“éªŒå¸¦æ„Ÿï¼"/> <meta itemprop="keywords" content="å‰ç«¯,GitHub,æ¶æ„"/> <meta itemprop="datePublished" content="2026-02-08T05:46:14.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å‰ç«¯å¸‚ç•Œ"/> <meta itemprop="url" content="https://juejin.cn/user/289926798641176"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ç”¨ React æ‰‹æ“ä¸€ä¸ª 3D ç¿»é¡µä¹¦ç±ç»„ä»¶ï¼Œå‘¼å¸æµ·æµªå¼ç¿»é¡µï¼Œäº¤äº’ä½“éªŒå¸¦æ„Ÿï¼
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/289926798641176/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å‰ç«¯å¸‚ç•Œ
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-08T05:46:14.000Z" title="Sun Feb 08 2026 05:46:14 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»7åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">ç”¨ React æ‰‹æ“ä¸€ä¸ª 3D ç¿»é¡µä¹¦ç±ç»„ä»¶ï¼Œé¡µè§’è¿˜èƒ½å·èµ·æ¥ï¼ä»é›¶åˆ°è¸©å‘å…¨è®°å½•</h2>
<blockquote>
<p>å‰ç«¯å¼€å‘ä¸­ï¼Œä½ æ˜¯å¦ä¹Ÿæƒ³è¿‡æŠŠæ¯ç‡¥çš„å†…å®¹å±•ç¤ºåšå¾—åƒç¿»ä¹¦ä¸€æ ·ï¼Ÿæœ¬æ–‡è®°å½•äº†æˆ‘ä»é›¶å¼€å‘ä¸€ä¸ª <strong>3D äº¤äº’å¼ä¹¦ç±ç»„ä»¶</strong> çš„å®Œæ•´è¿‡ç¨‹â€”â€”åŒ…æ‹¬ CSS 3D ç¿»é¡µã€æ‹–æ‹½æ‰‹åŠ¿ã€é¡µè§’æµ·æµªå·èµ·æ•ˆæœï¼Œä»¥åŠä¸­é—´è¸©è¿‡çš„å‘å’Œæœ€ç»ˆçš„è§£å†³æ–¹æ¡ˆã€‚</p>
</blockquote>
<h3 data-id="heading-1">ä¸€ã€ä¸ºä»€ä¹ˆè¦åšè¿™ä¸ªç»„ä»¶ï¼Ÿ</h3>
<p>åœ¨åšä¸€ä¸ª AI çŸ¥è¯†åº“äº§å“æ—¶ï¼Œäº§å“ç»ç†æäº†ä¸€ä¸ªéœ€æ±‚ï¼š</p>
<blockquote>
<p>ã€Œèƒ½ä¸èƒ½æŠŠæ•™ç¨‹åšæˆä¸€æœ¬å¯ä»¥ç¿»é¡µçš„ä¹¦ï¼Ÿç”¨æˆ·ç‚¹å‡»æˆ–æ‹–æ‹½å°±èƒ½ç¿»é¡µï¼Œä½“éªŒè¦åƒçœŸä¹¦ã€‚ã€</p>
</blockquote>
<p>å¸‚é¢ä¸Šçš„è½®æ’­å›¾ã€Tab åˆ‡æ¢éƒ½å¤ªã€Œå¹³ã€äº†ï¼Œæˆ‘å¸Œæœ›åšä¸€ä¸ª<strong>æœ‰çºµæ·±æ„Ÿçš„ 3D ç¿»ä¹¦äº¤äº’</strong>ã€‚ç¿»éäº† npmï¼Œè¦ä¹ˆåŠŸèƒ½å¤ªç®€é™‹ï¼Œè¦ä¹ˆä¾èµ– Canvas ä½“ç§¯å¤ªå¤§ï¼Œæœ€ç»ˆå†³å®šâ€”â€”<strong>è‡ªå·±å†™ä¸€ä¸ª</strong>ã€‚</p>
<p>ç›®æ ‡å¾ˆæ˜ç¡®ï¼š</p>
<ul>
<li>ğŸ¨ CSS 3D å®ç°çœŸå®ç¿»é¡µæ•ˆæœï¼Œä¸ç”¨ Canvas</li>
<li>âœ‹ æ”¯æŒæ‹–æ‹½ç¿»é¡µã€ç‚¹å‡»ç¿»é¡µã€é”®ç›˜ç¿»é¡µ</li>
<li>ğŸŒŠ é¼ æ ‡æ‚¬åœé¡µè§’æ—¶æœ‰ã€Œæµ·æµªå·èµ·ã€çš„è§†è§‰æç¤º</li>
<li>ğŸ“± ç§»åŠ¨ç«¯è§¦æ‘¸æ”¯æŒ</li>
<li>ğŸ§± çº¯ React ç»„ä»¶ï¼Œé›¶å¤–éƒ¨ç¿»ä¹¦ä¾èµ–</li>
</ul>
<h3 data-id="heading-2">äºŒã€æ¶æ„è®¾è®¡ï¼šä¸€æœ¬ä¹¦çš„ DOM ç»“æ„</h3>
<p>å…ˆæƒ³æ¸…æ¥šä¸€æœ¬ä¹¦çš„ç‰©ç†ç»“æ„ï¼š</p>
<pre><code class="hljs language-css" lang="css">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           Container             â”‚  â† <span class="hljs-attribute">perspective</span>: <span class="hljs-number">2000px</span> æä¾› <span class="hljs-number">3</span>D è§†è§’
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚       BookWrapper         â”‚  â”‚  â† æ‰“å¼€æ—¶ <span class="hljs-built_in">translateX</span>(<span class="hljs-number">50%</span>) å±…ä¸­
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚  â”‚  â”‚      Cover          â”‚  â”‚  â”‚  â† <span class="hljs-built_in">rotateY</span>(-<span class="hljs-number">180deg</span>) ç¿»å¼€
â”‚  â”‚  â”‚  â”Œ front â”â”Œ back â”€â” â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â”‚å°é¢å›¾ç‰‡â”‚â”‚å†…å°é¡µ  â”‚ â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”˜â””â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚  â”‚
â”‚  â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚  â”‚
â”‚  â”‚  â”‚      Pages          â”‚  â”‚  â”‚  â† æ‰€æœ‰é¡µé¢å åœ¨ä¸€èµ·
â”‚  â”‚  â”‚  â”Œ Page <span class="hljs-number">1</span> â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â”‚ front â”‚ back   â”‚ â”‚  â”‚  â”‚  â† æ¯é¡µåŒé¢
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â”Œ Page <span class="hljs-number">2</span> â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â”‚ front â”‚ back   â”‚ â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â”Œ BackCover â”€â”€â”€â”€â”€â” â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â”‚   The End      â”‚ â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚        Navigation Bar           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<p>æ ¸å¿ƒæ€è·¯ï¼š</p>
<ul>
<li>æ¯ä¸€é¡µéƒ½æ˜¯ç»å¯¹å®šä½å åœ¨ä¸€èµ·ï¼Œ<code>transform-origin: left center</code>ï¼Œç¿»é¡µå°±æ˜¯ç»•å·¦è¾¹ç¼˜æ—‹è½¬ -180Â°</li>
<li>ç”¨ <code>backface-visibility: hidden</code> + å‰åä¸¤ä¸ª div æ¨¡æ‹Ÿæ­£åé¢</li>
<li>é€šè¿‡ <code>zIndex</code> æ§åˆ¶ç¿»è¿‡çš„é¡µå’Œæœªç¿»çš„é¡µçš„å±‚å å…³ç³»</li>
</ul>
<h3 data-id="heading-3">ä¸‰ã€æ ¸å¿ƒå®ç°</h3>
<h4 data-id="heading-4">3.1 CSS 3D ç¿»é¡µ</h4>
<p>å…³é”® CSSï¼š</p>
<pre><code class="hljs language-less" lang="less"><span class="hljs-selector-class">.container</span> {
  <span class="hljs-attribute">perspective</span>: <span class="hljs-number">2000px</span>;  <span class="hljs-comment">// 3D è§†è§’è·ç¦»</span>
}

<span class="hljs-selector-class">.page</span> {
  <span class="hljs-attribute">position</span>: absolute;
  inset: 0;
  <span class="hljs-attribute">transform-style</span>: preserve-<span class="hljs-number">3</span>d;
  <span class="hljs-attribute">transform-origin</span>: left;  <span class="hljs-comment">// ç»•å·¦è¾¹è½´ç¿»è½¬</span>
}

<span class="hljs-selector-class">.pageFront</span>, <span class="hljs-selector-class">.pageBack</span> {
  <span class="hljs-attribute">backface-visibility</span>: hidden;  <span class="hljs-comment">// åªæ˜¾ç¤ºæœå‘ç”¨æˆ·çš„é¢</span>
}

<span class="hljs-selector-class">.pageBack</span> {
  <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">rotateY</span>(<span class="hljs-number">180deg</span>) <span class="hljs-built_in">translateZ</span>(<span class="hljs-number">0.5px</span>);  <span class="hljs-comment">// èƒŒé¢ç¿»è½¬ 180Â°</span>
}
</code></pre>
<p>ç”¨ Framer Motion çš„ <code>variants</code> æ§åˆ¶ç¿»è½¬åŠ¨ç”»ï¼š</p>
<pre><code class="hljs language-tsx" lang="tsx"><span class="hljs-keyword">const</span> variants = {
  <span class="hljs-attr">flipped</span>: {
    <span class="hljs-attr">rotateY</span>: -<span class="hljs-number">180</span>,
    <span class="hljs-attr">zIndex</span>: isBuriedLeft ? index + <span class="hljs-number">1</span> : pages.<span class="hljs-property">length</span> + <span class="hljs-number">10</span>,
    <span class="hljs-attr">transition</span>: {
      <span class="hljs-attr">rotateY</span>: { <span class="hljs-attr">duration</span>: <span class="hljs-number">0.6</span>, <span class="hljs-attr">ease</span>: [<span class="hljs-number">0.645</span>, <span class="hljs-number">0.045</span>, <span class="hljs-number">0.355</span>, <span class="hljs-number">1</span>] },
      <span class="hljs-attr">zIndex</span>: { <span class="hljs-attr">delay</span>: <span class="hljs-number">0.6</span> },
    },
  },
  <span class="hljs-attr">unflipped</span>: {
    <span class="hljs-attr">rotateY</span>: <span class="hljs-number">0</span>,
    <span class="hljs-attr">zIndex</span>: pages.<span class="hljs-property">length</span> - index,
    <span class="hljs-attr">transition</span>: {
      <span class="hljs-attr">rotateY</span>: { <span class="hljs-attr">duration</span>: <span class="hljs-number">0.6</span>, <span class="hljs-attr">ease</span>: [<span class="hljs-number">0.645</span>, <span class="hljs-number">0.045</span>, <span class="hljs-number">0.355</span>, <span class="hljs-number">1</span>] },
      <span class="hljs-attr">zIndex</span>: { <span class="hljs-attr">delay</span>: <span class="hljs-number">0.6</span> },
    },
  },
}
</code></pre>
<p>è¿™é‡Œçš„è´å¡å°”æ›²çº¿ <code>[0.645, 0.045, 0.355, 1]</code> æ˜¯ç²¾å¿ƒè°ƒçš„ï¼Œæ¨¡æ‹Ÿçº¸å¼ ç¿»é¡µæ—¶å…ˆå¿«åæ…¢çš„ç‰©ç†æ„Ÿã€‚</p>
<h4 data-id="heading-5">3.2 æ‹–æ‹½ç¿»é¡µ</h4>
<p>å‚è€ƒç”µå­ä¹¦é˜…è¯»å™¨çš„æ‹–æ‹½é€»è¾‘ï¼š</p>
<pre><code class="hljs language-tsx" lang="tsx"><span class="hljs-comment">// mousedown â†’ è®°å½•èµ·ç‚¹</span>
<span class="hljs-comment">// mousemove â†’ è®¡ç®—åç§»ï¼Œç”¨ rAF ä¼˜åŒ–æ€§èƒ½</span>
<span class="hljs-comment">// mouseup â†’ åç§»è¶…è¿‡é˜ˆå€¼(80px)åˆ™è§¦å‘ç¿»é¡µ</span>

<span class="hljs-keyword">const</span> handleMouseMove = <span class="hljs-title function_">useCallback</span>(<span class="hljs-function">(<span class="hljs-params">e: MouseEvent</span>) =&gt;</span> {
  <span class="hljs-keyword">if</span> (!isDragging) <span class="hljs-keyword">return</span>
  currentDragXRef.<span class="hljs-property">current</span> = e.<span class="hljs-property">clientX</span>
  <span class="hljs-keyword">if</span> (rafIdRef.<span class="hljs-property">current</span>) <span class="hljs-title function_">cancelAnimationFrame</span>(rafIdRef.<span class="hljs-property">current</span>)
  rafIdRef.<span class="hljs-property">current</span> = <span class="hljs-title function_">requestAnimationFrame</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-title function_">setDragOffset</span>(currentDragXRef.<span class="hljs-property">current</span> - dragStartXRef.<span class="hljs-property">current</span>)
  })
}, [isDragging])
</code></pre>
<p>æ‹–æ‹½è¿‡ç¨‹ä¸­ï¼Œå½“å‰é¡µé¢ä¼šæœ‰ä¸€ä¸ªã€Œå¼“èµ·ã€æ•ˆæœï¼š</p>
<pre><code class="hljs language-tsx" lang="tsx"><span class="hljs-keyword">const</span> curlAngle = isActiveDragPage
  ? <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">min</span>(<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">abs</span>(dragOffset) * <span class="hljs-number">0.25</span>, <span class="hljs-number">45</span>) * (dragOffset &lt; <span class="hljs-number">0</span> ? -<span class="hljs-number">1</span> : <span class="hljs-number">1</span>)
  : <span class="hljs-number">0</span>
<span class="hljs-keyword">const</span> curlZ = isActiveDragPage
  ? <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">min</span>(<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">abs</span>(dragOffset) * <span class="hljs-number">0.15</span>, <span class="hljs-number">30</span>)
  : <span class="hljs-number">0</span>
</code></pre>
<p>æ ¹æ®æ‹–æ‹½åç§»é‡ï¼Œé¡µé¢æœ€å¤šå¼“èµ· 45Â°ï¼ŒåŒæ—¶æ²¿ Z è½´æŠ¬å‡ 30pxï¼Œé…åˆ <code>box-shadow</code> äº§ç”ŸæŠ•å½±ï¼Œæ•ˆæœéå¸¸é€¼çœŸã€‚</p>
<h4 data-id="heading-6">3.3 é¡µè§’æµ·æµªå·èµ·æ•ˆæœ ğŸŒŠ</h4>
<p>è¿™æ˜¯æ•´ä¸ªç»„ä»¶æœ€æœ‰è¶£çš„äº¤äº’ç»†èŠ‚ï¼šé¼ æ ‡æ‚¬åœåœ¨é¡µè§’æ—¶ï¼Œçº¸å¼ ä¼šåƒæµ·æµªä¸€æ ·å·èµ·æ¥ï¼Œæç¤ºç”¨æˆ·ã€Œè¿™é‡Œå¯ä»¥ç¿»é¡µã€ã€‚</p>
<p><strong>å®ç°åŸç†</strong>ï¼šåœ¨é¡µé¢çš„å³ä¸‹è§’/å·¦ä¸‹è§’æ”¾ç½® 80Ã—80 çš„çƒ­åŒºï¼Œhover æ—¶ç”¨ <code>border-radius: 100%</code> + æ¸å˜èƒŒæ™¯æ¨¡æ‹Ÿå·è§’ï¼Œé…åˆ CSS <code>@keyframes</code> å®ç°å‘¼å¸å¼æ³¢æµªåŠ¨ç”»ã€‚</p>
<pre><code class="hljs language-less" lang="less"><span class="hljs-selector-class">.cornerZone</span> {
  <span class="hljs-attribute">position</span>: absolute;
  <span class="hljs-attribute">width</span>: <span class="hljs-number">80px</span>;
  <span class="hljs-attribute">height</span>: <span class="hljs-number">80px</span>;
  <span class="hljs-attribute">cursor</span>: pointer;
}

<span class="hljs-selector-class">.curlEffect</span> {
  <span class="hljs-attribute">width</span>: <span class="hljs-number">0</span>;
  <span class="hljs-attribute">height</span>: <span class="hljs-number">0</span>;
  <span class="hljs-attribute">transition</span>: width <span class="hljs-number">0.35s</span> <span class="hljs-built_in">cubic-bezier</span>(<span class="hljs-number">0.34</span>, <span class="hljs-number">1.56</span>, <span class="hljs-number">0.64</span>, <span class="hljs-number">1</span>),
              height <span class="hljs-number">0.35s</span> <span class="hljs-built_in">cubic-bezier</span>(<span class="hljs-number">0.34</span>, <span class="hljs-number">1.56</span>, <span class="hljs-number">0.64</span>, <span class="hljs-number">1</span>);
}

<span class="hljs-comment">// hover æ—¶å±•å¼€å·è§’</span>
<span class="hljs-selector-class">.cornerActive</span> <span class="hljs-selector-class">.curlEffect</span> {
  <span class="hljs-attribute">width</span>: <span class="hljs-number">55px</span>;
  <span class="hljs-attribute">height</span>: <span class="hljs-number">55px</span>;
}
</code></pre>
<p>å·è§’çš„æ¸å˜æ¨¡æ‹Ÿäº†çº¸å¼ ç¿»èµ·æ—¶çš„æ˜æš—å˜åŒ–ï¼š</p>
<pre><code class="hljs language-less" lang="less"><span class="hljs-selector-class">.cornerBottomRight</span> <span class="hljs-selector-class">.curlEffect</span> {
  <span class="hljs-attribute">background</span>: <span class="hljs-built_in">linear-gradient</span>(
    <span class="hljs-number">225deg</span>,
    <span class="hljs-built_in">rgba</span>(<span class="hljs-number">253</span>, <span class="hljs-number">251</span>, <span class="hljs-number">247</span>, <span class="hljs-number">0.95</span>) <span class="hljs-number">0%</span>,    <span class="hljs-comment">// ç¿»èµ·çš„çº¸é¢ï¼ˆäº®ï¼‰      </span>
    <span class="hljs-built_in">rgba</span>(<span class="hljs-number">253</span>, <span class="hljs-number">251</span>, <span class="hljs-number">247</span>, <span class="hljs-number">0.9</span>) <span class="hljs-number">35%</span>,
    <span class="hljs-built_in">rgba</span>(<span class="hljs-number">230</span>, <span class="hljs-number">225</span>, <span class="hljs-number">215</span>, <span class="hljs-number">0.85</span>) <span class="hljs-number">50%</span>,   <span class="hljs-comment">// æŠ˜ç—•å¤„ï¼ˆæš—ï¼‰</span>
    <span class="hljs-built_in">rgba</span>(<span class="hljs-number">200</span>, <span class="hljs-number">195</span>, <span class="hljs-number">185</span>, <span class="hljs-number">0.4</span>) <span class="hljs-number">70%</span>,
    transparent <span class="hljs-number">100%</span>                  <span class="hljs-comment">// æ¸éšåˆ°èƒŒæ™¯</span>
  );
  <span class="hljs-attribute">border-top-left-radius</span>: <span class="hljs-number">100%</span>;      <span class="hljs-comment">// å…³é”®ï¼åœ†å¼§å½¢å·è§’</span>
}
</code></pre>
<p>æµ·æµªåŠ¨ç”»é€šè¿‡ <code>@keyframes</code> è®©å·è§’å¤§å°åœ¨ 50px - 70px ä¹‹é—´æ³¢åŠ¨ï¼š</p>
<pre><code class="hljs language-less" lang="less"><span class="hljs-keyword">@keyframes</span> curlWaveRight {
  <span class="hljs-number">0%</span>   { <span class="hljs-attribute">width</span>: <span class="hljs-number">55px</span>; <span class="hljs-attribute">height</span>: <span class="hljs-number">55px</span>; }
  <span class="hljs-number">30%</span>  { <span class="hljs-attribute">width</span>: <span class="hljs-number">70px</span>; <span class="hljs-attribute">height</span>: <span class="hljs-number">70px</span>; }  <span class="hljs-comment">// æµªæ¶Œ</span>
  <span class="hljs-number">60%</span>  { <span class="hljs-attribute">width</span>: <span class="hljs-number">50px</span>; <span class="hljs-attribute">height</span>: <span class="hljs-number">50px</span>; }  <span class="hljs-comment">// å›è½</span>
  <span class="hljs-number">100%</span> { <span class="hljs-attribute">width</span>: <span class="hljs-number">55px</span>; <span class="hljs-attribute">height</span>: <span class="hljs-number">55px</span>; }  <span class="hljs-comment">// å½’ä½</span>
}
</code></pre>
<p>å¼¹æ€§è¿‡æ¸¡çš„è´å¡å°”æ›²çº¿ <code>cubic-bezier(0.34, 1.56, 0.64, 1)</code> è®©å±•å¼€æœ‰ä¸€ä¸ªã€Œå¼¹ä¸€ä¸‹ã€çš„æ•ˆæœï¼Œåƒçº¸å¼ è¢«é£å¹èµ·ã€‚</p>
<h3 data-id="heading-7">å››ã€è¸©å‘å®å½•ï¼šé‚£äº›è®©æˆ‘æŠ“ç‹‚çš„ Bug</h3>
<h4 data-id="heading-8">å‘ 1ï¼šé¡µè§’ç‚¹å‡»ä¸è§¦å‘ç¿»é¡µ</h4>
<p><strong>ç°è±¡</strong>ï¼šé¼ æ ‡åœ¨é¡µè§’å·èµ·åç‚¹å‡»ï¼Œä½†é¡µé¢æ²¡æœ‰ç¿»åŠ¨ã€‚</p>
<p><strong>åŸå› </strong>ï¼š<code>mousedown</code> äº‹ä»¶å†’æ³¡åˆ°äº†çˆ¶å®¹å™¨ <code>.pages</code>ï¼Œè§¦å‘äº†æ‹–æ‹½é€»è¾‘ï¼ˆ<code>isDragging = true</code>ï¼‰ã€‚ç”±äº React çš„æ¡ä»¶æ¸²æŸ“é€»è¾‘å†™äº† <code>!isDragging</code>ï¼Œé¡µè§’åŒºåŸŸç«‹åˆ»è¢«å¸è½½ï¼Œ<code>onClick</code> æ ¹æœ¬æ¥ä¸åŠè§¦å‘ã€‚</p>
<p><strong>è§£å†³</strong>ï¼šåœ¨é¡µè§’çƒ­åŒºä¸Šé˜»æ­¢ <code>mousedown</code> å†’æ³¡ï¼š</p>
<pre><code class="hljs language-tsx" lang="tsx">&lt;div
  className={styles.<span class="hljs-property">cornerZone</span>}
  onMouseDown={<span class="hljs-function">(<span class="hljs-params">e</span>) =&gt;</span> e.<span class="hljs-title function_">stopPropagation</span>()}  <span class="hljs-comment">// å…³é”®ï¼</span>
  onTouchStart={<span class="hljs-function">(<span class="hljs-params">e</span>) =&gt;</span> e.<span class="hljs-title function_">stopPropagation</span>()}
  onClick={<span class="hljs-function">(<span class="hljs-params">e</span>) =&gt;</span> {
    e.<span class="hljs-title function_">stopPropagation</span>()
    <span class="hljs-title function_">setCornerHover</span>(<span class="hljs-string">'none'</span>)
    <span class="hljs-title function_">nextPage</span>(e)
  }}
&gt;
</code></pre>
<h4 data-id="heading-9">å‘ 2ï¼šç¿»åˆ°ä¸‹ä¸€é¡µæ—¶å·¦ä¾§çŸ­æš‚é—ªçƒ</h4>
<p><strong>ç°è±¡</strong>ï¼šç¿»é¡µæ—¶å·¦ä¾§ä¼šçŸ­æš‚æ˜¾ç¤ºå°é¢å†…å®¹ï¼Œç„¶åæ‰å˜æˆå½“å‰é¡µçš„èƒŒé¢ã€‚</p>
<p><strong>ç¬¬ä¸€æ¬¡å°è¯•ï¼ˆå¤±è´¥ï¼‰</strong>ï¼šç”¨ Framer Motion çš„ <code>opacity</code> åŠ¨ç”»å»¶è¿Ÿéšè—å·²ç¿»è¿‡çš„é¡µé¢ã€‚è®¾ç½®äº† <code>delay: 0.65s</code>ï¼Œç­‰ç¿»è½¬åŠ¨ç”»å®Œæˆåå†éšè—ã€‚</p>
<p><strong>ç»“æœ</strong>ï¼šæ—¶åºä¸å¯é ã€‚<code>opacity</code> ä¾èµ– Framer Motion çš„ variant é‡ç®—ï¼Œ<code>isBuriedLeft</code> å˜åŒ–æ—¶ variant å€¼ç«‹åˆ»æ›´æ–°ï¼Œæ— è®º delay å¤šå°‘éƒ½å¯èƒ½å‡ºç°ç«æ€ã€‚</p>
<p><strong>æœ€ç»ˆæ–¹æ¡ˆ</strong>ï¼šå½»åº•æ”¾å¼ƒ <code>opacity</code> åŠ¨ç”»ï¼Œæ”¹ç”¨ CSS <code>visibility</code> éšè—æ·±å±‚é¡µé¢ï¼š</p>
<pre><code class="hljs language-tsx" lang="tsx"><span class="hljs-comment">// åªéšè— "æ·±å±‚" æ©åŸ‹çš„é¡µé¢ï¼ˆindex &lt; currentPageIndex - 1ï¼‰</span>
<span class="hljs-comment">// ä¿ç•™ç´§é‚»çš„å‰ä¸€é¡µå¯è§ï¼Œç¡®ä¿å·¦ä¾§å§‹ç»ˆæœ‰èƒŒé¢å†…å®¹</span>
<span class="hljs-keyword">const</span> isDeeplyBuried = isFlipped &amp;&amp; index &lt; currentPageIndex - <span class="hljs-number">1</span>

&lt;motion.<span class="hljs-property">div</span> style={{
  <span class="hljs-attr">visibility</span>: isDeeplyBuried ? <span class="hljs-string">'hidden'</span> : <span class="hljs-string">'visible'</span>,
}}&gt;
</code></pre>
<p><code>visibility: hidden</code> æ˜¯<strong>å³æ—¶çš„ã€æ— åŠ¨ç”»çš„ã€ç¡®å®šæ€§çš„</strong>â€”â€”å®Œç¾è§£å†³é—ªçƒé—®é¢˜ã€‚</p>
<h4 data-id="heading-10">å‘ 3ï¼šç¿»å›ä¸Šä¸€é¡µæ—¶åˆé—ªäº†</h4>
<p><strong>ç°è±¡</strong>ï¼šä¿®å¥½äº†å‘åç¿»é¡µï¼Œä½†ç¿»å›ä¸Šä¸€é¡µæ—¶åˆå‡ºç°é—ªçƒã€‚</p>
<p><strong>åŸå› </strong>ï¼š<code>unflipped</code> variant çš„ <code>zIndex</code> transition çš„ <code>delay</code> è®¾ä¸ºäº† <code>0</code>ï¼Œå¯¼è‡´é¡µé¢è¿˜åœ¨ç¿»è½¬åŠ¨ç”»è¿‡ç¨‹ä¸­ï¼ŒzIndex å°±æå‰é™ä½äº†ï¼Œè¢«å…¶ä»–é¡µé¢é®æŒ¡ã€‚</p>
<p><strong>è§£å†³</strong>ï¼šåŒå‘ç¿»é¡µçš„ <code>zIndex</code> éƒ½å»¶è¿Ÿåˆ°åŠ¨ç”»ç»“æŸåå†æ›´æ–°ï¼š</p>
<pre><code class="hljs language-tsx" lang="tsx"><span class="hljs-attr">unflipped</span>: {
  <span class="hljs-attr">rotateY</span>: <span class="hljs-number">0</span>,
  <span class="hljs-attr">zIndex</span>: pages.<span class="hljs-property">length</span> - index,
  <span class="hljs-attr">transition</span>: {
    <span class="hljs-attr">rotateY</span>: { <span class="hljs-attr">duration</span>: <span class="hljs-number">0.6</span>, <span class="hljs-attr">ease</span>: [<span class="hljs-number">0.645</span>, <span class="hljs-number">0.045</span>, <span class="hljs-number">0.355</span>, <span class="hljs-number">1</span>] },
    <span class="hljs-attr">zIndex</span>: { <span class="hljs-attr">delay</span>: <span class="hljs-number">0.6</span> },  <span class="hljs-comment">// å’Œç¿»é¡µåŠ¨ç”»æ—¶é•¿ä¸€è‡´ï¼</span>
  },
},
</code></pre>
<h4 data-id="heading-11">å‘ 4ï¼šæœ€åä¸€é¡µæ‹–ä¸åŠ¨ä½†å…‰æ ‡è¿˜æ˜¯ã€ŒæŠ“æ‰‹ã€</h4>
<p><strong>ç°è±¡</strong>ï¼šç¿»åˆ°æœ€åä¸€é¡µï¼ˆThe Endï¼‰ï¼Œè™½ç„¶ç»“æŸé¡µå·²ç»é˜»æ­¢äº†äº‹ä»¶å†’æ³¡ï¼Œä½†åœ¨é¡µé¢ç©ºç™½åŒºåŸŸé¼ æ ‡ä»ç„¶æ˜¾ç¤º <code>grab</code> å…‰æ ‡ã€‚</p>
<p><strong>è§£å†³</strong>ï¼šæ£€æµ‹æœ€åä¸€é¡µçŠ¶æ€ï¼ŒåŒæ—¶ç¦ç”¨æ‹–æ‹½é€»è¾‘å’Œå…‰æ ‡æ ·å¼ï¼š</p>
<pre><code class="hljs language-tsx" lang="tsx"><span class="hljs-keyword">const</span> isLastPage = currentPageIndex &gt;= pages.<span class="hljs-property">length</span> - <span class="hljs-number">1</span>

<span class="hljs-comment">// ç¦ç”¨ mousedown</span>
<span class="hljs-keyword">const</span> handleMouseDown = <span class="hljs-title function_">useCallback</span>(<span class="hljs-function">(<span class="hljs-params">e</span>) =&gt;</span> {
  <span class="hljs-keyword">if</span> (!isOpen || isLastPage) <span class="hljs-keyword">return</span>  <span class="hljs-comment">// æœ€åä¸€é¡µä¸è§¦å‘æ‹–æ‹½</span>
  <span class="hljs-comment">// ...</span>
}, [isOpen, isLastPage])

<span class="hljs-comment">// å…‰æ ‡</span>
<span class="hljs-attr">cursor</span>: isOpen
  ? (isLastPage ? <span class="hljs-string">'default'</span> : isDragging ? <span class="hljs-string">'grabbing'</span> : <span class="hljs-string">'grab'</span>)
  : <span class="hljs-string">'default'</span>
</code></pre>
<h3 data-id="heading-12">äº”ã€æœ€ç»ˆæ•ˆæœ</h3>
<p>ç»„ä»¶æ”¯æŒçš„äº¤äº’æ–¹å¼ä¸€è§ˆï¼š</p>

































<table><thead><tr><th>äº¤äº’æ–¹å¼</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>ğŸ–±ï¸ æ‹–æ‹½ç¿»é¡µ</td><td>æŒ‰ä½é¡µé¢å·¦å³æ‹–æ‹½ï¼Œè¶…è¿‡ 80px é˜ˆå€¼æ¾æ‰‹ç¿»é¡µ</td></tr><tr><td>ğŸŒŠ é¡µè§’ç‚¹å‡»</td><td>æ‚¬åœå³ä¸‹è§’/å·¦ä¸‹è§’å‡ºç°å·èµ·æ•ˆæœï¼Œç‚¹å‡»ç¿»é¡µ</td></tr><tr><td>ğŸ”˜ å¯¼èˆªæ </td><td>åº•éƒ¨å¯¼èˆªæ å‰åç¿»é¡µæŒ‰é’®</td></tr><tr><td>âŒ¨ï¸ é”®ç›˜</td><td>â† â†’ ç¿»é¡µ / Escape å…³é—­ / Home End è·³è½¬</td></tr><tr><td>ğŸ“± è§¦æ‘¸</td><td>ç§»åŠ¨ç«¯è§¦æ‘¸æ»‘åŠ¨ç¿»é¡µ</td></tr><tr><td>ğŸ“• å°é¢</td><td>ç‚¹å‡»æˆ–å‘å·¦æ‹–æ‹½æ‰“å¼€ä¹¦ç±</td></tr></tbody></table>
<p>ä½¿ç”¨æ–¹å¼éå¸¸ç®€å•ï¼š</p>
<pre><code class="hljs language-tsx" lang="tsx"><span class="hljs-keyword">import</span> <span class="hljs-title class_">InteractiveBook</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'@stateless/InteractiveBook'</span>

&lt;<span class="hljs-title class_">InteractiveBook</span>
  coverImage=<span class="hljs-string">"/cover.jpg"</span>
  bookTitle=<span class="hljs-string">"AI Agent å®Œå…¨æŒ‡å—"</span>
  bookAuthor=<span class="hljs-string">"AI ä¸“å®¶"</span>
  pages={[
    {
      <span class="hljs-attr">pageNumber</span>: <span class="hljs-number">1</span>,
      <span class="hljs-attr">title</span>: <span class="hljs-string">'ç¬¬ä¸€ç« '</span>,
      <span class="hljs-attr">content</span>: <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>æ­£é¢å†…å®¹<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>,
      <span class="hljs-attr">backContent</span>: <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>èƒŒé¢å†…å®¹<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>,
    },
    <span class="hljs-comment">// ...</span>
  ]}
  onPageChange={<span class="hljs-function">(<span class="hljs-params">index</span>) =&gt;</span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'å½“å‰é¡µ:'</span>, index)}
  enableKeyboard
/&gt;
</code></pre>
<h3 data-id="heading-13">å…­ã€æŠ€æœ¯æ ˆæ€»ç»“</h3>

































<table><thead><tr><th>æŠ€æœ¯</th><th>ç”¨é€”</th></tr></thead><tbody><tr><td>React + TypeScript</td><td>ç»„ä»¶é€»è¾‘</td></tr><tr><td>Framer Motion</td><td>ç¿»é¡µåŠ¨ç”»ã€å°é¢åŠ¨ç”»ã€å¯¼èˆªæ åŠ¨ç”»</td></tr><tr><td>CSS 3D Transform</td><td><code>perspective</code>ã€<code>rotateY</code>ã€<code>preserve-3d</code>ã€<code>backface-visibility</code></td></tr><tr><td>CSS Modules (Less)</td><td>æ ·å¼éš”ç¦»</td></tr><tr><td>requestAnimationFrame</td><td>æ‹–æ‹½æ€§èƒ½ä¼˜åŒ–</td></tr><tr><td>lucide-react</td><td>å›¾æ ‡</td></tr></tbody></table>
<h3 data-id="heading-14">ä¸ƒã€å†™åœ¨æœ€å</h3>
<p>ä¸€ä¸ªçœ‹ä¼¼ç®€å•çš„ç¿»ä¹¦ç»„ä»¶ï¼Œæ¶‰åŠäº† <strong>CSS 3D å˜æ¢ã€äº‹ä»¶å†’æ³¡æœºåˆ¶ã€Framer Motion variant ç”Ÿå‘½å‘¨æœŸã€zIndex æ—¶åºæ§åˆ¶</strong> ç­‰å¤šä¸ªçŸ¥è¯†ç‚¹ã€‚æœ€å¤§çš„æ•™è®­æ˜¯ï¼š</p>
<blockquote>
<p><strong>ä¸è¦ç”¨åŠ¨ç”»å±æ€§ï¼ˆopacity/transformï¼‰å»åšã€Œæ˜¾ç¤º/éšè—ã€è¿™ç§äºŒå…ƒçŠ¶æ€æ§åˆ¶ã€‚</strong> ç”¨ <code>visibility</code> æˆ–æ¡ä»¶æ¸²æŸ“â€”â€”ç¡®å®šæ€§æ¯”ä¼˜é›…æ›´é‡è¦ã€‚</p>
</blockquote>
<p>å®Œæ•´ä»£ç å·²å¼€æºï¼Œæ¬¢è¿ Star â­</p>
<hr/>
<p>GitHub: <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fwkylin%2Fpro-react-admin" target="_blank" title="https://github.com/wkylin/pro-react-admin" ref="nofollow noopener noreferrer">Pro React Admin</a></p>
<p>é¢„è§ˆåœ°å€: <a href="https://link.juejin.cn?target=https%3A%2F%2Fwkylin.github.io%2Fpro-react-admin%2Fstorybook%2F%3Fpath%3D%2Fdocs%2Fstateless-interactivebook--docs" target="_blank" title="https://wkylin.github.io/pro-react-admin/storybook/?path=/docs/stateless-interactivebook--docs" ref="nofollow noopener noreferrer">Interactive Book</a></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5b38133acbdf4cbdba0dad49c1ca2b75~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uv5biC55WM:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771134374&amp;x-signature=8vi1B84z7aKyHbJ8eF2sJ94Y3%2Fo%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/51fa994a011548d5bab542b32cf4c44d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uv5biC55WM:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771134374&amp;x-signature=jBlMH%2FU9vdjSpkIqb5fewPRH3Lg%3D" alt="image.png" loading="lazy"/></p>
<p><strong>å¦‚æœè¿™ç¯‡æ–‡ç« å¯¹ä½ æœ‰å¸®åŠ©ï¼Œåˆ«å¿˜äº†ç‚¹ä¸ªèµ ğŸ‘ æ”¶è—ä¸€ä¸‹ ğŸ“Œ</strong></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[APPåŸç”Ÿä¸H5äº’è°ƒBridgeæŠ€æœ¯åŸç†åŠåŸºç¡€ä½¿ç”¨]]></title>    <link>https://juejin.cn/post/7603674653153427465</link>    <guid>https://juejin.cn/post/7603674653153427465</guid>    <pubDate>2026-02-08T03:57:08.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7603674653153427465" data-draft-id="7603688142004469769" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="APPåŸç”Ÿä¸H5äº’è°ƒBridgeæŠ€æœ¯åŸç†åŠåŸºç¡€ä½¿ç”¨"/> <meta itemprop="keywords" content="å‰ç«¯"/> <meta itemprop="datePublished" content="2026-02-08T03:57:08.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="é»„è¯‚å¤š"/> <meta itemprop="url" content="https://juejin.cn/user/510642324769053"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            APPåŸç”Ÿä¸H5äº’è°ƒBridgeæŠ€æœ¯åŸç†åŠåŸºç¡€ä½¿ç”¨
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/510642324769053/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    é»„è¯‚å¤š
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-08T03:57:08.000Z" title="Sun Feb 08 2026 03:57:08 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»9åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">APIä½¿ç”¨</h2>
<h4 data-id="heading-1">jsè°ƒç”¨åŸç”Ÿæ’ä»¶åŠŸèƒ½</h4>
<p>è°ƒç”¨å‘½åä¸º'11'çš„æ’ä»¶é‡Œçš„ä¸€ä¸ªå®šæ—¶å™¨apiï¼šjsCallTimer</p>
<p>å¸¦å›è°ƒç»“æœå¸¦å‚æ•°çš„è°ƒç”¨æ–¹å¼ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-variable constant_">YN</span>.<span class="hljs-title function_">callNative</span>(<span class="hljs-string">'11'</span>,<span class="hljs-string">"jsCallTimer"</span>,<span class="hljs-string">'æˆ‘æ˜¯ä¼ åˆ°åŸç”Ÿç«¯çš„å‚æ•°'</span>,<span class="hljs-keyword">function</span> (<span class="hljs-params">value</span>) {
      <span class="hljs-keyword">if</span> (a == <span class="hljs-number">1</span>){
        <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">"progress1"</span>).<span class="hljs-property">innerText</span> = value
      }<span class="hljs-keyword">else</span>{
        <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">"progress2"</span>).<span class="hljs-property">innerText</span> = value
      }
    },<span class="hljs-keyword">function</span> (<span class="hljs-params">error</span>) {
      <span class="hljs-title function_">alert</span>(error)
    })
</code></pre>
<p>ä¸å¸¦å›è°ƒç»“æœå¸¦å‚æ•°çš„è°ƒç”¨æ–¹å¼ï¼š</p>
<pre><code class="hljs language-arduino" lang="arduino">YN.<span class="hljs-built_in">callNative</span>(<span class="hljs-string">'11'</span>,<span class="hljs-string">"jsCallTimer"</span>,<span class="hljs-string">'æˆ‘æ˜¯ä¼ åˆ°åŸç”Ÿç«¯çš„å‚æ•°'</span>)
</code></pre>
<p>ä¸å¸¦å›è°ƒç»“æœä¸å¸¦å‚æ•°çš„è°ƒç”¨æ–¹å¼ï¼š</p>
<pre><code class="hljs language-arduino" lang="arduino">YN.<span class="hljs-built_in">callNative</span>(<span class="hljs-string">'11'</span>,<span class="hljs-string">"jsCallTimer"</span>)
</code></pre>
<h4 data-id="heading-2">åŸç”Ÿè°ƒç”¨jsæ’ä»¶åŠŸèƒ½</h4>
<p>è°ƒç”¨å‘½åä¸º'asynObj'çš„æ’ä»¶é‡Œçš„ä¸€ä¸ªå®šæ—¶å™¨apiï¼šstartTimer</p>
<p>å¸¦å›è°ƒç»“æœå¸¦å‚æ•°çš„è°ƒç”¨æ–¹å¼ï¼š</p>
<pre><code class="hljs language-objectivec" lang="objectivec">[dwebview callHandler:<span class="hljs-string">@"asynObj"</span> action:<span class="hljs-string">@"startTimer"</span> arguments:<span class="hljs-string">@"æˆ‘æ˜¯ä¼ åˆ°jsç«¯çš„å‚æ•°"</span> completionHandler:^(CallbackStatus status, <span class="hljs-type">id</span>  _Nonnull value, <span class="hljs-built_in">NSString</span> * _Nonnull callId, <span class="hljs-type">BOOL</span> complete) {
        [sender setTitle:[<span class="hljs-built_in">NSString</span> stringWithFormat:<span class="hljs-string">@"%@-%@"</span>,value,callId] forState:<span class="hljs-number">0</span>];
    }];
</code></pre>
<p>ä¸å¸¦å›è°ƒç»“æœçš„è°ƒç”¨æ–¹å¼ï¼š</p>
<pre><code class="hljs language-csharp" lang="csharp">[<span class="hljs-meta">dwebview callHandler:@<span class="hljs-string">"asynObj"</span> action:@<span class="hljs-string">"startTimer"</span> arguments:@<span class="hljs-string">"æˆ‘æ˜¯ä¼ åˆ°jsç«¯çš„å‚æ•°"</span> completionHandler:nil</span>];
</code></pre>
<h2 data-id="heading-3">ä¸€äº›å…¨å±€çº¦å®š</h2>
<ul>
<li>
<p>jsè°ƒåŸç”Ÿå’ŒåŸç”Ÿè°ƒjsçš„å‚æ•°ä¼ é€’å¿…é¡»æ˜¯jsonå­—ç¬¦ä¸²æ ¼å¼ã€‚</p>
</li>
<li>
<p>apiè°ƒç”¨,åº•å±‚é€»è¾‘å¿…é¡»ä½¿ç”¨å‘½åç©ºé—´æ–¹å¼å³ï¼šnamespace.apixxxçš„å½¢å¼ã€‚</p>
</li>
<li>
<p>è¿˜æœ‰å¾ˆå¤šè§„èŒƒå’Œçº¦å®šï¼Œåç»­è¡¥å……ã€‚</p>
</li>
</ul>
<h2 data-id="heading-4">js call native</h2>
<h4 data-id="heading-5">å…³é”®æŠ€æœ¯ç‚¹</h4>
<p>åŸç”ŸAndroidç«¯å‘æµè§ˆå™¨æ³¨å…¥ä¾›jsè°ƒç”¨çš„å¯¹è±¡â€˜_anbridgeâ€™ï¼Œå¯¹è±¡é‡Œå®ç°â€˜call()â€™æ–¹æ³•ï¼Œå¹¶ä¸”æ–¹æ³•éœ€è¦åŠ ä¸Š@JavascriptInterfaceæ³¨è§£ï¼Œä»£ç ç¤ºä¾‹ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">WebSettings</span> <span class="hljs-variable">webSettings</span> <span class="hljs-operator">=</span> wv.getSettings();
webSettings.setJavaScriptEnabled(<span class="hljs-literal">true</span>);
wv.addJavascriptInterface(<span class="hljs-keyword">new</span> <span class="hljs-title class_">JsApp</span>(),<span class="hljs-string">"_anbridge"</span>);
<span class="hljs-keyword">class</span> <span class="hljs-title class_">JsApp</span>{
  <span class="hljs-keyword">public</span> <span class="hljs-title function_">JsApp</span><span class="hljs-params">()</span>{}
  <span class="hljs-meta">@JavascriptInterface</span>
  <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">call</span><span class="hljs-params">(Object obj)</span>{

  }
}
</code></pre>
<p>åŸç”ŸiOSç«¯</p>
<p>å‘æµè§ˆå™¨é…ç½®å¯¹è±¡é‡Œæ³¨å…¥â€˜window._ynwk=true;â€™è¿™æ®µjsä»£ç ï¼Œå¹¶ä¸”è®¾ç½®æ³¨å…¥æ—¶æœºä¸ºå¼€å§‹åŠ è½½æ—¶å³ï¼šinjectionTime=WKUserScriptInjectionTimeAtDocumentStart,ä»£ç å®ç°ï¼š</p>
<pre><code class="hljs language-ini" lang="ini">///åˆå§‹åŒ–æ³¨å…¥jsæ ‡è®°
    WKUserScript *<span class="hljs-attr">script</span> = [[WKUserScript alloc] initWithSource:@<span class="hljs-string">"window._ynwk=true;"</span>
                                                  injectionTime:WKUserScriptInjectionTimeAtDocumentStart
                                               forMainFrameOnly:<span class="hljs-literal">YES</span>]<span class="hljs-comment">;</span>
    <span class="hljs-section">[configuration.userContentController addUserScript:script]</span><span class="hljs-comment">;</span>
</code></pre>
<p>å®ç°jsç«¯æ¢èµ·åŸç”Ÿé€šä¿¡çš„å…³é”®æ˜¯å®ç°wkçš„h5è¾“å…¥æ¡†æ‹¦æˆªå›è°ƒæ–¹æ³•- (void)webView:(WKWebView *)webView runJavaScriptTextInputPanelWithPrompt:(NSString *)prompt defaultText:(nullable NSString *)defaultText initiatedByFrame:(WKFrameInfo *)frame completionHandler:(void (^)(NSString * _Nullable result))completionHandler<br/>
å½“jsç«¯æ‰§è¡Œä»£ç â€˜prompt()â€™æ—¶åŸç”Ÿç«¯å°±ä¼šè‡ªåŠ¨è°ƒèµ·è¯¥æ–¹æ³•</p>
<p>åœ¨ä¸Šé¢å®ç°çš„åŸºç¡€ä¸Šï¼Œjsç«¯åˆ¤æ–­window._anbridgeä¸ºtrueåˆ™ä¸ºä¸Androidé€šä¿¡ï¼Œæ‰§è¡Œä»£ç ï¼š_anbridge.call(api, arg)ï¼Œå¦‚æœåˆ¤æ–­window._ynwkä¸ºtrueåˆ™ä¸ºä¸iOSç«¯é€šä¿¡ï¼Œæ‰§è¡Œä»£ç ï¼šprompt('_ynbridge=' + api, arg)ï¼Œjsç«¯ä»£ç å®ç°ï¼š</p>
<pre><code class="hljs language-ini" lang="ini">var <span class="hljs-attr">natiValue</span> = <span class="hljs-string">''</span><span class="hljs-comment">;</span>
if (window._anbridge)
   <span class="hljs-attr">natiValue</span> = _anbridge.call(api, arg)<span class="hljs-comment">;//è°ƒç”¨androidå¯¹è±¡çš„call()</span>
else if (window._ynwk)
   <span class="hljs-attr">natiValue</span> = prompt(<span class="hljs-string">'_ynbridge='</span> + api, arg)<span class="hljs-comment">;</span>
</code></pre>
<p>åŸç”Ÿç«¯ã€jsç«¯æä¾›çš„apiéƒ½è¦é€šè¿‡å‘½åç©ºé—´çš„æ–¹å¼ç®¡ç†ï¼Œå¦‚ï¼šapi_1åœ¨â€˜namespace1â€™è¿™ä¸ªå‘½åç©ºé—´ä¸‹çš„ç±»é‡Œé¢ï¼Œåˆ™jsç«¯è°ƒç”¨api_1ä¹¦å†™å½¢å¼ä¸ºâ€˜namespace1.api_1â€™ã€‚</p>
<p>åŸç”Ÿç«¯å’Œjsç«¯æä¾›çš„åŠŸèƒ½éƒ½ä»¥æ’ä»¶çš„æ–¹å¼æä¾›ï¼Œæ’ä»¶ï¼ˆé™¤åŸºç¡€æ’ä»¶ï¼‰éƒ½ç»§æ‰¿è‡ªä¸€ä¸ªåŸºç¡€æ’ä»¶ç±»ï¼Œæ’ä»¶ç»“æœå›è°ƒéƒ½æ˜¯èµ°å¼‚æ­¥å›ä¼ å€¼æ–¹å¼ï¼ŒåŒæ­¥æ–¹å¼ä¹Ÿå¯ä»¥ä½†æš‚æ²¡å®ç°ã€‚</p>
<h4 data-id="heading-6">iOSç«¯é€»è¾‘æ­¥éª¤</h4>
<p>åŸºç¡€æ’ä»¶å¯¹è±¡æ˜¯å¤„ç†jsé€šè®¯å’Œæ’ä»¶æ‰©å±•çš„å¿…è¦æ¡ä»¶ï¼Œwkæµè§ˆå™¨åˆå§‹åŒ–å¥½åå°†åŸºç¡€æ’ä»¶ç±»æ³¨å†Œè¿›æ’ä»¶é›†åˆï¼Œç„¶åè¯»å–é…ç½®æ–‡ä»¶é‡Œå¯ç”¨çš„å…¶ä»–æ’ä»¶ï¼Œå°†æ¯ä¸ªæ’ä»¶ç±»æ³¨å†Œè¿›æ’ä»¶é›†åˆï¼Œä»£ç å®ç°ï¼š</p>
<pre><code class="hljs language-objectivec" lang="objectivec"><span class="hljs-comment">//æ³¨å†ŒåŸºç¡€æ’ä»¶</span>
    [<span class="hljs-keyword">self</span> addJavascriptObject:<span class="hljs-keyword">self</span>.ynPlugin namespace:baseNameSpace];
    <span class="hljs-comment">//æ³¨å†Œå·²æœ‰æ’ä»¶</span>
    <span class="hljs-built_in">NSString</span>* plistPath = [[<span class="hljs-built_in">NSBundle</span> mainBundle] pathForResource:<span class="hljs-string">@"applyPlugPlist"</span> ofType:<span class="hljs-string">@"plist"</span>];
    <span class="hljs-built_in">NSArray</span> *modules = [<span class="hljs-built_in">NSArray</span> arrayWithContentsOfFile:plistPath];
    <span class="hljs-keyword">for</span> (<span class="hljs-built_in">NSDictionary</span> *obj <span class="hljs-keyword">in</span> modules) {
        Class <span class="hljs-keyword">class</span> = <span class="hljs-built_in">NSClassFromString</span>(obj[<span class="hljs-string">@"plug"</span>]);
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">class</span> != <span class="hljs-literal">nil</span> &amp;&amp; ![<span class="hljs-keyword">class</span> isKindOfClass:[<span class="hljs-built_in">NSNull</span> <span class="hljs-keyword">class</span>]]) {
            [<span class="hljs-keyword">self</span> addJavascriptObject:[[<span class="hljs-keyword">class</span> alloc] init] namespace:obj[<span class="hljs-string">@"namespace"</span>]];
        }
    }
</code></pre>
<ol>
<li>
<p>jsç«¯çš„ç¬¬ä¸€ä¸ªä¿¡å·æ¥è‡ªwkçš„h5è¾“å…¥æ¡†æ‹¦æˆªå›è°ƒæ–¹æ³•ï¼Œå‚æ•°prompté‡Œæºå¸¦jsç«¯è¦è°ƒç”¨çš„apiåå­—ï¼Œå‚æ•°å€¼ä¸ºå­—ç¬¦ä¸²ï¼š_ynbridge=namespace1.api_1ï¼Œ_ynbridge=ä¸ºYNBridgeæ¡†æ¶è°ƒç”¨çš„æ ‡è®°ï¼Œå¦‚æœä¸æ˜¯ä»¥è¿™ä¸ªæ ‡è®°å¼€å¤´åˆ™ä¸åšä»»ä½•å¤„ç†ï¼Œåªå¼¹å‡ºæ­£å¸¸çš„ç³»ç»Ÿå¼¹æ¡†ã€‚</p>
</li>
<li>
<p>é€šè¿‡apiåï¼Œå»æ’ä»¶é›†åˆé‡Œæ‰¾æœ‰æ²¡æœ‰æ³¨å†Œå¯¹åº”çš„æ’ä»¶å¯¹è±¡ï¼Œå¦‚æœæ²¡æœ‰æ‰¾åˆ°æˆ–æ‰¾åˆ°äº†ä½†æ’ä»¶ä¸‹æ²¡æœ‰å¯¹åº”apiåˆ™å°†é”™è¯¯ç»“æœè¿”å›jsç«¯</p>
</li>
<li>
<p>jsè°ƒèµ·çš„apiï¼Œå‚æ•°ç”±defaultTextæºå¸¦ã€‚defaultTextæ˜¯jsonå­—ç¬¦ä¸²ï¼Œéœ€è¦è½¬æ¢ä¸ºjsonå¯¹è±¡æ¥è§£æå‡ºæ•°æ®ï¼Œå‚æ•°å€¼ç¤ºä¾‹ï¼š{"data":null,"callId":"callId0"} data:çœŸå®å‚æ•°å€¼ã€‚ callId:apiè°ƒç”¨äº‹ä»¶idæˆ–å«å›ä¼ å€¼é˜Ÿåˆ—idï¼Œå½“æ¬¡apiè°ƒç”¨jséœ€è¦å›ä¼ å€¼æ—¶æ­¤å‚æ•°ä¸ä¸ºç©ºï¼Œå¦‚æœä¸ºç©ºåˆ™è¡¨ç¤ºå½“æ¬¡apiè°ƒç”¨jsç«¯ä¸éœ€è¦ç»“æœå›è°ƒ</p>
</li>
<li>
<p>-(BOOL)exec:(YNJsCallInfo*)arg æ­¤æ–¹æ³•æ˜¯æ’ä»¶æ¥æ”¶æ•°æ®çš„å…¥å£ï¼Œè¿™æ˜¯ä¸ªå·¥å‚æ–¹æ³•å­ç±»å¿…é¡»å®ç°ï¼Œè§£æå’Œç»„è£…å¥½jsè¿‡æ¥çš„apiå’Œå‚æ•°åç”¨åå°„çš„æ–¹å¼æ‰§è¡Œå¯¹åº”æ’ä»¶çš„exec:æ–¹æ³•ï¼Œè¯¥æ–¹æ³•åŒæ­¥æ–¹å¼è¿”å›ä¸ªboolå€¼ï¼Œè¡¨ç¤ºè°ƒç”¨æˆåŠŸæˆ–å¤±è´¥ï¼Œå¦‚æœå¤±è´¥åˆ™å°†å¤±è´¥ç»“æœè¿”å›ç»™jsï¼Œä»£ç å®ç°ï¼š</p>
</li>
</ol>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-built_in">BOOL</span>(*action)(id,SEL,id) = (BOOL(*)(id,SEL,id))objc_msgSend;
    BOOL ret=<span class="hljs-built_in">action</span>(JavascriptInterfaceObject,sel,info);
    if (ret) {
        return YES;
    }
    return <span class="hljs-selector-attr">[self nativeCallBackWithCode:ret ? OK : ERROR value:ret ? @<span class="hljs-string">"OK"</span> : error complete:YES callId:info.callId]</span>;
</code></pre>
<ol>
<li>
<p>exec:æ–¹æ³•çš„å½¢å‚æ˜¯YNJsCallInfoå¯¹è±¡ï¼Œè¯¥å¯¹è±¡æºå¸¦çš„å‚æ•°ï¼š<br/>
action:apiåï¼Œæˆ–å«åŠ¨ä½œæ ‡è¯†å­—ç¬¦ä¸²ï¼Œå„ä¸šåŠ¡é€šè¿‡è¯¥å­—æ®µåˆ¤æ–­è¯¥æ‰§è¡Œä»€ä¹ˆåŠŸèƒ½ï¼Œå¦‚æœæ’ä»¶å†…æ²¡æœ‰å¤„ç†è¯¥apiåˆ™è¿”å›è°ƒç”¨å¤±è´¥çš„é”™è¯¯å€¼falseåä¹‹è¿”å›trueã€‚<br/>
callId:apiè°ƒç”¨äº‹ä»¶idæˆ–å«å›ä¼ å€¼é˜Ÿåˆ—idï¼Œå½“ç»™jså›ä¼ å€¼æ—¶éœ€è¦å¸¦ä¸Šè¯¥å€¼è¿”å›å»ã€‚<br/>
data:jsç»™è¿‡æ¥çš„å‚æ•°å€¼ã€‚<br/>
callBack:blockå˜é‡ï¼Œç»“æœå›è°ƒå…¥å£ï¼Œå›ä¼ å€¼æ—¶éœ€è¦æŒ‡å®šå››ä¸ªå‚æ•°statusã€valueã€callIdã€completeï¼Œå‚æ•°ç”¨å¤„åé¢è®²è§£ã€‚</p>
</li>
<li>
<p>åŠŸèƒ½å®ç°å®Œæˆåéœ€è¦è°ƒç”¨YNJsCallInfoå¯¹è±¡çš„callBackå›è°ƒæ–¹æ³•ï¼Œæ–¹æ³•å‚æ•°ï¼š<br/>
status:ç»“æœçŠ¶æ€å€¼ï¼Œæ­¤å€¼ä¸ºä¸€ä¸ªæšä¸¾ç±»å‹ï¼ŒOKè¡¨ç¤ºæˆåŠŸERRORè¡¨ç¤ºå¤±è´¥ã€‚<br/>
value:ç»“æœå€¼ï¼Œè¯¥å€¼æœ€ååœ¨è°ƒç”¨jså›ä¼ å€¼apiæ—¶ä¼šè½¬æ¢ä¸ºjsonå­—ç¬¦ä¸²æ ¼å¼ã€‚<br/>
callId:apiè°ƒç”¨äº‹ä»¶idæˆ–å«å›ä¼ å€¼é˜Ÿåˆ—idã€‚<br/>
complete:boolå€¼ï¼Œå½“æ¬¡apiä»»åŠ¡æ˜¯å¦å…¨éƒ¨æ‰§è¡Œå®Œæ¯•ï¼Œå¤„ç†éœ€è¦ä¿æ´»æœåŠ¡çš„é•¿è¿æ¥çŠ¶æ€ï¼Œfalseæ‰§è¡Œå®Œæ¯•ï¼ŒtrueæœåŠ¡éœ€è¦ç»§ç»­ä¿æŒã€‚</p>
</li>
<li>
<p>apiè°ƒç”¨å®Œæ¯•ï¼Œéœ€è¦ç»™jså›ä¼ å€¼æ—¶ï¼Œè°ƒç”¨wkçš„- (void)evaluateJavaScript:(NSString *)javaScriptString completionHandler:(void (^ _Nullable)(_Nullable id, NSError * _Nullable error))completionHandleræ–¹æ³• æ‰§è¡Œè¿™æ®µjsä»£ç ï¼šwindow.nativeCallBack('%@',%ld,%@,%d)ï¼ŒnativeCallBack()æ˜¯jsç«¯æ¥æ”¶åŸç”Ÿç«¯å›ä¼ å€¼çš„æ–¹æ³•ï¼Œæ¥æ”¶å››ä¸ªå‚æ•°ï¼Œå³ä¸ºYNJsCallInfoå¯¹è±¡çš„callBackå›è°ƒå‚æ•°ã€‚</p>
</li>
<li>
<p>åŸç”ŸåŠŸèƒ½é€šè¿‡æ’ä»¶çš„å½¢å¼å®ç°ï¼Œè¦æ–°å¢ä¸€ä¸ªæ’ä»¶åªéœ€è¦ï¼š ç¬¬ä¸€æ­¥æ–°å»ºä¸€ä¸ªç»§æ‰¿'YNPlugin'åŸºç¡€æ’ä»¶ç±»çš„å¯¹è±¡ï¼Œç„¶ååœ¨å¯¹è±¡é‡Œå®ç°æ–¹æ³•-(BOOL)exec:(YNJsCallInfo*)argï¼› ç¬¬äºŒæ­¥åœ¨YNBridgePlugPlist.plistæ–‡ä»¶é‡Œæ·»åŠ ä»¥ä¸‹å½¢å¼çš„ä»£ç </p>
</li>
</ol>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">dict</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">key</span>&gt;</span>namespace<span class="hljs-tag">&lt;/<span class="hljs-name">key</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">string</span>&gt;</span>å‘½åç©ºé—´<span class="hljs-tag">&lt;/<span class="hljs-name">string</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">key</span>&gt;</span>plug<span class="hljs-tag">&lt;/<span class="hljs-name">key</span>&gt;</span>nativeCallBack
        <span class="hljs-tag">&lt;<span class="hljs-name">string</span>&gt;</span>æ’ä»¶ç±»å<span class="hljs-tag">&lt;/<span class="hljs-name">string</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dict</span>&gt;</span>
</code></pre>
<p>ç„¶åå°†å‘½åç©ºé—´åå’Œç›¸åº”çš„apiåå‘Šè¯‰jsç«¯å³å¯</p>
<h4 data-id="heading-7">jsç«¯</h4>
<p>è°ƒèµ·ä¸€ä¸ªåŸç”Ÿæ’ä»¶æ—¶ï¼Œæ‰§è¡ŒYNå¯¹è±¡é‡Œé¢çš„callNative: function (service,action,actionArgs,successCallback,failCallback)æ–¹æ³•ï¼Œæ–¹æ³•å‚æ•°ï¼š<br/>
service:åŸç”Ÿapiå¯¹åº”çš„å‘½åç©ºé—´åã€‚<br/>
action:apiåã€‚<br/>
actionArgs:éœ€è¦ç»™åŸç”Ÿç«¯çš„å‚æ•°ã€‚<br/>
successCallback:æˆåŠŸçš„å›è°ƒã€‚<br/>
failCallback:å¤±è´¥çš„å›è°ƒã€‚ æ¯”å¦‚æˆ‘è¦è°ƒèµ·åŸç”Ÿç«¯11å‘½åç©ºé—´ä¸‹çš„jsCallTimerè¿™ä¸ªapiï¼Œè®©åŸç”Ÿç«¯æ‰§è¡Œä¸€ä¸ªå®šæ—¶å™¨åŠŸèƒ½ï¼Œä»£ç å®ç°ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-variable constant_">YN</span>.<span class="hljs-title function_">callNative</span>(<span class="hljs-string">'11'</span>,<span class="hljs-string">"jsCallTimer"</span>,<span class="hljs-literal">undefined</span>,<span class="hljs-keyword">function</span> (<span class="hljs-params">value</span>) {
      <span class="hljs-keyword">if</span> (a == <span class="hljs-number">1</span>){
        <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">"progress1"</span>).<span class="hljs-property">innerText</span> = value
      }<span class="hljs-keyword">else</span>{
        <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">"progress2"</span>).<span class="hljs-property">innerText</span> = value
      }
    },<span class="hljs-keyword">function</span> (<span class="hljs-params">error</span>) {
      <span class="hljs-title function_">alert</span>(error)
    })
</code></pre>
<ol>
<li>
<p>æ‰§è¡ŒYN.call()æ–¹æ³•ï¼Œå®ç°è°ƒèµ·åŸç”Ÿå’Œç»“æœå›è°ƒé˜Ÿåˆ—çš„ç»´æŠ¤ï¼Œå¦‚æœæ³¨å…¥è¿‡å®‰å“jså¯¹è±¡â€˜window._anbridgeâ€™åˆ™æ‰§è¡Œ_anbridge.call(api, arg)è°ƒèµ·å®‰å“ç«¯ï¼Œå¦‚æœæ³¨å…¥è¿‡â€˜window._ynwkâ€™å€¼ä¸ºtrueåˆ™æ‰§è¡Œprompt('_ynbridge=' + api, arg)è°ƒèµ·iOSç«¯ï¼Œå¦‚æœéœ€è¦æœ‰å›ä¼ å€¼ï¼Œåˆ™argå¯¹è±¡å°†ç»™callIdå­—æ®µèµ‹ä¸€ä¸ªå”¯ä¸€å€¼ï¼Œå¹¶ä¸”åœ¨window.nativeCallBackIdsç¼“å­˜é›†åˆé‡Œæ–°å¢callIdå€¼ï¼Œå€¼å³ä¸ºå›è°ƒå‡½æ•°ã€‚</p>
</li>
<li>
<p>æ‰€æœ‰æ’ä»¶è°ƒç”¨çš„å‰æåŸºç¡€æ˜¯jsç«¯å’ŒåŸç”Ÿç«¯éƒ½å·²æ­£å¸¸åˆå§‹åŒ–ï¼Œå¹¶ä¸”é€šè®¯å·²å»ºç«‹ï¼Œå³deviceReadyå·²ä¸ºtureï¼ŒdeviceReadyçš„è¯¢é—®ä¼šåœ¨jså…¥å£å‡½æ•°é‡Œæ‰§è¡Œï¼Œå³é€šè¿‡YN.call()æ–¹æ³•ï¼Œæ‰§è¡Œä¸€ä¸ªåŸç”ŸYNBase.initçš„apiï¼Œå¦‚æœç»“æœè¿”å›ä¸ºOKåˆ™ä¸ºdeviceReadyæˆåŠŸ</p>
</li>
<li>
<p>åŸç”Ÿç«¯æ’ä»¶æ‰§è¡Œç»“æœå›è°ƒé€šè¿‡â€˜nativeCallBack = function (callId,status,args,complete)â€™æ–¹æ³•æ¥æ”¶å€¼ï¼Œæ–¹æ³•å†…éƒ¨é€šè¿‡callIdåœ¨window.nativeCallBackIdså¯¹è±¡é‡Œæ‰¾åˆ°å›è°ƒæ–¹æ³•ç„¶åæ‰§è¡Œï¼Œå°†argså€¼ç”±jsonå­—ç¬¦ä¸²è½¬jsonå¯¹è±¡åä¼ å…¥ï¼Œåˆ¤æ–­completeå­—æ®µï¼Œä¸ºtrueåˆ™æ‰§è¡Œï¼šdelete window.nativeCallBackIds[callId]ä»£ç ï¼Œå°†è¯¥æœåŠ¡å›è°ƒç§»é™¤é˜Ÿåˆ—ã€‚</p>
</li>
</ol>
<h2 data-id="heading-8">native call js</h2>
<h4 data-id="heading-9">jsç«¯</h4>
<ol>
<li>å®ç°æ€è·¯å’Œè®¾è®¡æ–¹å¼åŒjs call nativeï¼Œå³åªæ˜¯å…¶ä¸€ä¸ªåå‘è¿‡ç¨‹ï¼Œå®ç°åŸºç¡€ä¾ç„¶æ˜¯éœ€è¦å®ç°å’Œæ³¨å†ŒåŸºç¡€æ’ä»¶ç±»ï¼Œå„å­æ’ä»¶ç»§æ‰¿åŸºç¡€æ’ä»¶ï¼Œç»“æœå›è°ƒéƒ½æ˜¯é€šè¿‡å¼‚æ­¥å›ä¼ å€¼ï¼Œæ‰€ä»¥ç»†èŠ‚ä¸åšé‡å¤é˜è¿°ã€‚</li>
<li>åœ¨å…¥å£å‡½æ•°æ‰§è¡ŒåŸºç¡€æ’ä»¶å’Œå„æ’ä»¶å¯¹è±¡çš„æ³¨å†Œï¼Œæ³¨å†Œå®Œæˆåå¯ä»¥è°ƒç”¨åŸç”ŸYNBase.jsinitè¿™ä¸ªapiå‘Šè¯‰åŸç”Ÿç«¯ï¼Œä»£ç å®ç°ï¼š</li>
</ol>
<pre><code class="hljs language-arduino" lang="arduino">YN.<span class="hljs-built_in">register</span>(<span class="hljs-string">'asynObj'</span>,<span class="hljs-keyword">new</span> <span class="hljs-built_in">YNPlugin</span>());
   YN.<span class="hljs-built_in">register</span>(<span class="hljs-string">'YNPlugin1'</span>,<span class="hljs-keyword">new</span> <span class="hljs-built_in">YNPlugin1</span>());
  <span class="hljs-comment">//å‘Šè¯‰åŸç”Ÿjsåˆå§‹åŒ–äº†ï¼Œè°ƒåŸç”Ÿåˆå§‹åŒ–apiï¼ˆåœ¨jsåˆå§‹åŒ–å‰åŸç”Ÿå°±è¦æ±‚æ‰§è¡Œçš„jsæ–¹æ³•å¯åœ¨jsinitæ–¹æ³•é‡Œå¼€å§‹æ‰§è¡Œäº†ï¼‰</span>
  <span class="hljs-keyword">if</span> (deviceReady){
    YN.<span class="hljs-built_in">call</span>(<span class="hljs-string">'YNBase.jsinit'</span>);
  }
</code></pre>
<p>register()æ–¹æ³•å†…éƒ¨å®ç°åŒåŸç”Ÿæ³¨å†Œæ’ä»¶çš„å½¢å¼ï¼Œå°†æ’ä»¶å’Œå¯¹åº”çš„å‘½åç©ºé—´æ·»åŠ è¿›window.nativeNamespaceInterfacesé›†åˆã€‚</p>
<ol start="3">
<li>
<p>æ¥æ”¶åŸç”Ÿç«¯ç¬¬ä¸€ä¸ªä¿¡å·ç”±nativeCallJs = function(callId,service,action,actionArgs)æ–¹æ³•æ¥æ”¶ï¼Œå‚æ•°ï¼š<br/>
callId:apiè°ƒç”¨äº‹ä»¶idæˆ–å«å›ä¼ å€¼é˜Ÿåˆ—idã€‚<br/>
service:js apiå¯¹åº”çš„å‘½åç©ºé—´åã€‚<br/>
action:apiåã€‚<br/>
actionArgs:åŸç”Ÿç«¯çš„å‚æ•°ã€‚ æ–¹æ³•å†…éƒ¨å®ç°åŒåŸç”Ÿæ’ä»¶è°ƒç”¨ï¼Œä¹Ÿæ˜¯æ‰¾åˆ°æ’ä»¶å¹¶æ‰§è¡Œæ’ä»¶æ–¹æ³•exec(action,args,responseCallback)ã€‚</p>
</li>
<li>
<p>æ’ä»¶å›ä¼ å€¼ç»“æœå’Œapiè°ƒç”¨ç»“æœé€šè¿‡è°ƒç”¨åŸç”Ÿçš„YNBase.returnValueè¿™ä¸ªapiå®ç°ï¼Œå³æ‰§è¡ŒYN.call('YNBase.returnValue', value); valueæ˜¯å‚æ•°å¯¹è±¡ï¼ŒåŒ…å«dataã€callIdã€completeã€statuså››ä¸ªå­—æ®µï¼Œå«ä¹‰å’Œç”¨é€”åŒåŸç”Ÿå›è°ƒé‚£é‡Œã€‚</p>
</li>
</ol>
<h4 data-id="heading-10">iOSç«¯</h4>
<ol>
<li>
<p>è°ƒèµ·ä¸€ä¸ªjsç«¯çš„æ’ä»¶åŠŸèƒ½ï¼Œæ‰§è¡Œwkå¯¹è±¡çš„æ–¹æ³•-(void)callHandler:(NSString*)server action:(NSString *)action arguments:(id)args completionHandler:(JSCallback)completionHandler;è¯¥æ–¹æ³•é€»è¾‘åŒjs call nativeæ—¶è°ƒç”¨çš„YN.call()æ–¹æ³•ï¼Œé€šè¿‡ç»´æŠ¤ä¸€ä¸ªcallidæœåŠ¡é˜Ÿåˆ—æ¥å¤„ç†ç»“æœå›ä¼ ã€‚</p>
</li>
<li>
<p>ç»„è£…å¥½å‚æ•°åæµè§ˆå™¨æ‰§è¡Œwindow.nativeCallJs('%@','%@','%@',%@)è¿™ä¸ªjsä»£ç å³å¯è°ƒèµ·jsï¼Œä»£ç ç¤ºä¾‹ï¼š</p>
</li>
</ol>
<pre><code class="hljs language-objectivec" lang="objectivec">[<span class="hljs-keyword">self</span> evaluateJavaScript:[<span class="hljs-built_in">NSString</span> stringWithFormat:<span class="hljs-string">@"window.nativeCallJs('%@','%@','%@',%@)"</span>,info.callId,info.service,info.action,[JSBUtil objToJsonString:info.args]]];
</code></pre>
<p>æ¥æ”¶æ’ä»¶ç»“æœå›ä¼ å€¼åœ¨åŸºç¡€æ’ä»¶é‡Œç›‘å¬returnValueè¿™ä¸ªapiçš„æ‰§è¡Œï¼Œé€»è¾‘å¤„ç†åŒjsç«¯nativeCallBack()æ–¹æ³•ã€‚ä¹Ÿæ˜¯å¦‚æœcompleteå­—æ®µå€¼ä¸ºtrueæ—¶å°†è¯¥æœåŠ¡å¯¹è±¡ä»é˜Ÿåˆ—é‡Œç§»é™¤</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[commandå’Œshellæ¨¡å—åˆ°åº•åŒºåˆ«åœ¨å“ªï¼Ÿ]]></title>    <link>https://juejin.cn/post/7603651011979427882</link>    <guid>https://juejin.cn/post/7603651011979427882</guid>    <pubDate>2026-02-08T04:27:58.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7603651011979427882" data-draft-id="7603769956974936105" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="commandå’Œshellæ¨¡å—åˆ°åº•åŒºåˆ«åœ¨å“ªï¼Ÿ"/> <meta itemprop="keywords" content="Linux,Ansible,äº‘è®¡ç®—"/> <meta itemprop="datePublished" content="2026-02-08T04:27:58.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Sheffield"/> <meta itemprop="url" content="https://juejin.cn/user/362164852109770"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            commandå’Œshellæ¨¡å—åˆ°åº•åŒºåˆ«åœ¨å“ªï¼Ÿ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/362164852109770/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Sheffield
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-08T04:27:58.000Z" title="Sun Feb 08 2026 04:27:58 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    5
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»3åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>åˆšå­¦Ansibleçš„æ–°æ‰‹ï¼Œè‚¯å®šéƒ½æ‡µè¿‡ï¼šcommandå’Œshellæ¨¡å—ï¼Œä¸éƒ½æ˜¯è¿œç¨‹æ‰§è¡Œå‘½ä»¤å—ï¼Ÿä¸ºå•¥æœ‰æ—¶å€™ç”¨commandæŠ¥é”™ï¼Œæ¢shellå°±å¥½ä½¿ï¼Ÿ</p>
<p>æ ¸å¿ƒå°±1å¥å¤§ç™½è¯ï¼š<strong>æ‰§è¡Œå‘½ä»¤æ—¶ï¼Œè¦ä¸è¦æ‰¾â€œä¸­é—´äººâ€ï¼ˆshellè§£é‡Šå™¨ï¼‰å¸®å¿™</strong>ã€‚ä¸ç”¨è®°å¤æ‚æ¦‚å¿µï¼Œä»Šå¤©ç”¨æœ€ç®€å•çš„è¯+å®æ“ä¾‹å­ï¼Œè®²æ¸…ä¸¤è€…åŒºåˆ«ï¼Œæ–°æ‰‹çœ‹å®Œå°±çŸ¥é“è¯¥ç”¨å“ªä¸ªã€‚</p>
<h2 data-id="heading-0">ä¸€ã€å…ˆææ‡‚ï¼šä¸¤è€…æ‰§è¡Œæ–¹å¼ä¸ä¸€æ ·</h2>
<p>ä¸ç”¨ç®¡åº•å±‚åŸç†ï¼Œè®°ä½ä¸¤ä¸ªç±»æ¯”ï¼Œç¬é—´æ˜ç™½ï¼š</p>
<h3 data-id="heading-1">1. commandæ¨¡å—ï¼šç›´æ¥â€œå–Šâ€ç¨‹åºå¹²æ´»ï¼Œä¸æ‰¾ä¸­é—´äºº</h3>
<p>ç”¨commandæ‰§è¡Œå‘½ä»¤ï¼Œä¼šç›´æ¥è°ƒç”¨ç›®æ ‡æœºå™¨ä¸Šçš„ç¨‹åºï¼Œä¸ç»è¿‡ä»»ä½•â€œç¿»è¯‘â€ï¼ˆshellè§£é‡Šå™¨ï¼Œæ¯”å¦‚bashï¼‰ã€‚</p>
<p>ä¾‹å­ï¼šç”¨commandæ‰§è¡Œls /homeï¼ŒAnsibleç›´æ¥æ‰¾åˆ°ç³»ç»Ÿé‡Œçš„lsç¨‹åºï¼Œè®©å®ƒæŸ¥/homeç›®å½•ï¼Œä¸€æ­¥åˆ°ä½ã€‚</p>
<p>ç‰¹ç‚¹ï¼šå¿«ã€ç®€å•ï¼Œä½†ç¬¨â€”â€”ä¸æ”¯æŒä»»ä½•â€œé«˜çº§æ“ä½œâ€ï¼ˆæ¯”å¦‚ç®¡é“ã€é‡å®šå‘ï¼‰ã€‚</p>
<h3 data-id="heading-2">2. shellæ¨¡å—ï¼šå…ˆæ‰¾ä¸­é—´äººï¼Œå†è®©ä¸­é—´äººâ€œå–Šâ€ç¨‹åºå¹²æ´»</h3>
<p>ç”¨shellæ‰§è¡Œå‘½ä»¤ï¼Œä¼šå…ˆå¯åŠ¨ç›®æ ‡æœºå™¨çš„é»˜è®¤â€œä¸­é—´äººâ€ï¼ˆé»˜è®¤æ˜¯/bin/shï¼‰ï¼Œå†è®©è¿™ä¸ªä¸­é—´äººå»è°ƒç”¨ç¨‹åºã€æ‰§è¡Œå‘½ä»¤ã€‚</p>
<p>è¿˜æ˜¯æ‰§è¡Œls /homeï¼Œç”¨shellçš„è¯ï¼Œæµç¨‹æ˜¯ï¼šAnsibleå¯åŠ¨ä¸­é—´äººâ†’ä¸­é—´äººå–Šlsç¨‹åºâ†’æ‰§è¡Œå‘½ä»¤ã€‚</p>
<p>ç‰¹ç‚¹ï¼šçµæ´»ã€èƒ½å¹²â€”â€”æ”¯æŒæ‰€æœ‰é«˜çº§æ“ä½œï¼Œä½†æ¯”commandæ…¢ä¸€ç‚¹ï¼Œè¿˜æœ‰ç‚¹å®‰å…¨é£é™©ã€‚</p>
<h2 data-id="heading-3">äºŒã€æ ¸å¿ƒåŒºåˆ«ï¼šä¸€å¼ è¡¨çœ‹æ¸…</h2>
<p>ä¸ç”¨æ­»è®°ï¼Œé‡åˆ°åˆ†ä¸æ¸…çš„æƒ…å†µï¼Œå¯¹ç…§è¿™å¼ è¡¨æ‰¾ç­”æ¡ˆï¼Œä¸€ç›®äº†ç„¶ï¼š</p>








































<table><thead><tr><th>å¯¹æ¯”ç»´åº¦</th><th>commandæ¨¡å—</th><th>shellæ¨¡å—</th></tr></thead><tbody><tr><td>è¦ä¸è¦ä¸­é—´äººï¼ˆshellï¼‰</td><td>ä¸è¦ï¼Œç›´æ¥è°ƒç”¨ç¨‹åº</td><td>è¦ï¼Œé»˜è®¤ç”¨/bin/sh</td></tr><tr><td>æ”¯æŒç®¡é“(|)</td><td>ä¸æ”¯æŒï¼ˆæ–°æ‰‹è®°æ­»ï¼‰</td><td>æ”¯æŒ</td></tr><tr><td>æ”¯æŒé‡å®šå‘ï¼ˆ&gt;ã€&gt;&gt;ï¼‰</td><td>ä¸æ”¯æŒï¼ˆæ–°æ‰‹è®°æ­»ï¼‰</td><td>æ”¯æŒ</td></tr><tr><td>æ”¯æŒç¯å¢ƒå˜é‡ï¼ˆ$HOMEç­‰ï¼‰</td><td>ä¸æ”¯æŒï¼ˆç›´æ¥è¾“å‡º$HOMEï¼‰</td><td>æ”¯æŒï¼ˆèƒ½è¾“å‡ºçœŸå®è·¯å¾„ï¼‰</td></tr><tr><td>å®‰å…¨æ€§</td><td>é«˜ï¼ˆä¸å®¹æ˜“å‡ºé—®é¢˜ï¼‰</td><td>è¾ƒä½ï¼ˆæœ‰å®‰å…¨é£é™©ï¼‰</td></tr><tr><td>Ansibleé»˜è®¤ç”¨å“ªä¸ª</td><td>æ˜¯ï¼ˆä¸æŒ‡å®šæ¨¡å—å°±ç”¨å®ƒï¼‰</td><td>å¦ï¼ˆè¦æ‰‹åŠ¨æŒ‡å®š-m shellï¼‰</td></tr></tbody></table>
<h2 data-id="heading-4">ä¸‰ã€å®æˆ˜ç¤ºä¾‹ï¼šæ–°æ‰‹æœ€å¸¸é‡åˆ°çš„3ç§æƒ…å†µ</h2>
<p>å…‰çœ‹è¡¨ä¸å¤Ÿï¼Œç»“åˆä¾‹å­ç»ƒ1æ¬¡ï¼Œä»¥åå†ä¹Ÿä¸è¸©å‘ï¼</p>
<h3 data-id="heading-5">åœºæ™¯1ï¼šç®€å•å‘½ä»¤ï¼ˆæ¯”å¦‚é‡å¯æœåŠ¡ï¼‰â€”â€”ä¼˜å…ˆç”¨command</h3>
<p>åƒé‡å¯nginxã€æŸ¥çœ‹æ–‡ä»¶ï¼Œè¿™ç§ç®€å•æ“ä½œï¼Œä¸¤è€…éƒ½èƒ½ç”¨ï¼Œä½†ä¼˜å…ˆé€‰commandï¼ˆå¿«ã€å®‰å…¨ï¼‰ã€‚</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-comment"># æ¨èï¼šç”¨commandé‡å¯nginx</span>
<span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">restart</span> <span class="hljs-string">nginx</span> <span class="hljs-string">with</span> <span class="hljs-string">command</span>
  <span class="hljs-attr">command:</span> <span class="hljs-string">systemctl</span> <span class="hljs-string">restart</span> <span class="hljs-string">nginx</span>

<span class="hljs-comment"># èƒ½ç”¨ä½†æ²¡å¿…è¦ï¼šç”¨shellé‡å¯nginx</span>
<span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">restart</span> <span class="hljs-string">nginx</span> <span class="hljs-string">with</span> <span class="hljs-string">shell</span>
  <span class="hljs-attr">shell:</span> <span class="hljs-string">systemctl</span> <span class="hljs-string">restart</span> <span class="hljs-string">nginx</span>
</code></pre>
<h3 data-id="heading-6">åœºæ™¯2ï¼šç”¨ç®¡é“ã€é‡å®šå‘â€”â€”åªèƒ½ç”¨shell</h3>
<p>æ–°æ‰‹æœ€å®¹æ˜“è¸©å‘çš„åœ°æ–¹ï¼åªè¦å‘½ä»¤é‡Œæœ‰|ã€&gt;ã€&gt;&gt;ï¼Œç”¨commandå¿…æŠ¥é”™ï¼Œæ¢shellå°±å¥½ã€‚</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-comment"># é”™è¯¯ï¼šcommandä¸èƒ½ç”¨ç®¡é“</span>
<span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">æŸ¥çœ‹javaè¿›ç¨‹ï¼ˆæŠ¥é”™ï¼‰</span>
  <span class="hljs-attr">command:</span> <span class="hljs-string">ps</span> <span class="hljs-string">aux</span> <span class="hljs-string">|</span> <span class="hljs-string">grep</span> <span class="hljs-string">java</span>

<span class="hljs-comment"># æ­£ç¡®ï¼šç”¨shellæ‰§è¡Œç®¡é“å‘½ä»¤</span>
<span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">æŸ¥çœ‹javaè¿›ç¨‹ï¼ˆæ­£å¸¸ï¼‰</span>
  <span class="hljs-attr">shell:</span> <span class="hljs-string">ps</span> <span class="hljs-string">aux</span> <span class="hljs-string">|</span> <span class="hljs-string">grep</span> <span class="hljs-string">java</span>

<span class="hljs-comment"># æ­£ç¡®ï¼šç”¨shellé‡å®šå‘å†™å…¥æ–‡ä»¶</span>
<span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">å†™å†…å®¹åˆ°æ–‡ä»¶</span>
  <span class="hljs-attr">shell:</span> <span class="hljs-string">echo</span> <span class="hljs-string">"Sheffield"</span> <span class="hljs-string">&gt;</span> <span class="hljs-string">/tmp/test.txt</span>
</code></pre>
<h3 data-id="heading-7">åœºæ™¯3ï¼šç”¨ç¯å¢ƒå˜é‡ï¼ˆæ¯”å¦‚$HOMEï¼‰â€”â€”åªèƒ½ç”¨shell</h3>
<p>æƒ³è°ƒç”¨<code>$HOMEã€$PATH</code>è¿™ç§ç¯å¢ƒå˜é‡ï¼Œcommandä¸è¯†åˆ«ï¼Œå¿…é¡»ç”¨shellã€‚</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># æ­£ç¡®ï¼šç”¨shellæŸ¥çœ‹å®¶ç›®å½•</span>
- name: æŸ¥çœ‹å®¶ç›®å½•
  shell: <span class="hljs-built_in">echo</span> <span class="hljs-variable">$HOME</span> <span class="hljs-comment"># ä¼šè¾“å‡º/rootï¼ˆç®¡ç†å‘˜ç”¨æˆ·ï¼‰</span>

<span class="hljs-comment"># é”™è¯¯ï¼šcommandæŸ¥çœ‹å®¶ç›®å½•ï¼ˆåªä¼šè¾“å‡º$HOMEï¼‰</span>
- name: æŸ¥çœ‹å®¶ç›®å½•ï¼ˆæŠ¥é”™æ•ˆæœï¼‰
  <span class="hljs-built_in">command</span>: <span class="hljs-built_in">echo</span> <span class="hljs-variable">$HOME</span>
</code></pre>
<h2 data-id="heading-8">å››ã€å®‰å…¨æé†’</h2>
<p>shellè™½ç„¶å¥½ç”¨ï¼Œä½†å¦‚æœå‘½ä»¤é‡Œæœ‰ç”¨æˆ·è¾“å…¥ã€å˜é‡ï¼Œå®¹æ˜“è¢«æ¶æ„æ”»å‡»ï¼ˆæ¯”å¦‚åˆ æ–‡ä»¶ï¼‰ã€‚</p>
<p>ç®€å•è¯´ï¼šèƒ½ä¸ç”¨shellå°±ä¸ç”¨ï¼Œå¿…é¡»ç”¨çš„æ—¶å€™ï¼Œåˆ«éšä¾¿æ”¾ç”¨æˆ·è¾“å…¥çš„å†…å®¹ã€‚</p>
<h2 data-id="heading-9">äº”ã€æ–°æ‰‹é€Ÿè®°ï¼š3å¥è¯æå®šæ‰€æœ‰åœºæ™¯</h2>
<ol>
<li>ç®€å•å‘½ä»¤ï¼ˆä¸æ¶‰åŠ|ã€&gt;ã€$ï¼‰ï¼šä¼˜å…ˆç”¨commandï¼ˆé»˜è®¤ã€å®‰å…¨ã€å¿«ï¼‰ï¼›</li>
<li>ç”¨åˆ°ç®¡é“ã€é‡å®šå‘ã€ç¯å¢ƒå˜é‡ï¼šåªèƒ½ç”¨shellï¼›</li>
<li>å‘½ä»¤é‡Œæœ‰ç”¨æˆ·è¾“å…¥ã€å˜é‡ï¼šä¼˜å…ˆç”¨commandï¼Œé¿å…é£é™©ã€‚</li>
</ol>
<h2 data-id="heading-10">å¸¸è§è¯¯åŒºï¼ˆé¿å‘ï¼ï¼‰</h2>
<ol>
<li>
<p>è¯¯åŒºï¼šshellæ¯”commandå¼ºï¼Œæ‰€æœ‰åœºæ™¯éƒ½ç”¨shell</p>
<p>â€”â€”é”™ï¼éå¿…è¦ä¸ç”¨ï¼Œè´¹èµ„æºè¿˜ä¸å®‰å…¨ï¼›</p>
</li>
<li>
<p>è¯¯åŒºï¼šä¸¤è€…ç”¨æ³•ä¸ä¸€æ ·</p>
<p>â€”â€”é”™ï¼å¸¸ç”¨å‚æ•°ï¼ˆæ¯”å¦‚åˆ‡æ¢ç›®å½•ï¼‰ï¼Œç”¨æ³•å®Œå…¨ç›¸åŒï¼›</p>
</li>
<li>
<p>è¯¯åŒºï¼šcommandç”¨ä¸äº†çš„ï¼Œshellä¹Ÿç”¨ä¸äº†</p>
<p>â€”â€”é”™ï¼åªè¦æœ‰shellè§£é‡Šå™¨ï¼Œshelléƒ½èƒ½æå®šã€‚</p>
</li>
</ol>
<p>å…¶å®æ–°æ‰‹ä¸ç”¨æƒ³å¤ªå¤æ‚ï¼Œè®°ä½â€œç®€å•ç”¨commandï¼Œå¤æ‚ç”¨shellâ€ï¼Œå°±èƒ½åº”å¯¹99%çš„åœºæ™¯ã€‚ç»ƒä¸¤æ¬¡å®æ“ï¼Œå¾ˆå¿«å°±èƒ½åˆ†æ¸…ï½</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[æµ…æäºŒå‰æ ‘ã€Bæ ‘ã€B+æ ‘å’ŒMySQLç´¢å¼•åº•å±‚åŸç†]]></title>    <link>https://juejin.cn/post/7603651855236743177</link>    <guid>https://juejin.cn/post/7603651855236743177</guid>    <pubDate>2026-02-08T06:02:48.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7603651855236743177" data-draft-id="7603674653153689609" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="æµ…æäºŒå‰æ ‘ã€Bæ ‘ã€B+æ ‘å’ŒMySQLç´¢å¼•åº•å±‚åŸç† "/> <meta itemprop="keywords" content="åç«¯"/> <meta itemprop="datePublished" content="2026-02-08T06:02:48.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ç¥å¥‡å°æ±¤åœ†"/> <meta itemprop="url" content="https://juejin.cn/user/1151943919285431"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            æµ…æäºŒå‰æ ‘ã€Bæ ‘ã€B+æ ‘å’ŒMySQLç´¢å¼•åº•å±‚åŸç† 
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1151943919285431/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ç¥å¥‡å°æ±¤åœ†
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-08T06:02:48.000Z" title="Sun Feb 08 2026 06:02:48 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»23åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>æ•°æ®åº“æ˜¯åç«¯å·¥ç¨‹å¸ˆç»•ä¸å¼€çš„æ ¸å¿ƒæŠ€æœ¯ï¼Œè€Œç´¢å¼•åˆ™æ˜¯æ ¸å¿ƒä¸­çš„æ ¸å¿ƒã€‚åœ¨æ—¥å¸¸å·¥ä½œä¸­ï¼Œæˆ‘ä»¬æ¯å¤©éƒ½åœ¨å’Œç´¢å¼•æ‰“äº¤é“ï¼Œç´¢å¼•é—®é¢˜ä¹Ÿæ˜¯é«˜çº§å·¥ç¨‹å¸ˆé¢è¯•ä¸­ï¼Œé¢è¯•å®˜æœ€å–œæ¬¢è€ƒå¯Ÿçš„åœ°æ–¹ã€‚</p>
<p>â€ƒâ€ƒå¾ˆå¤šå¼€å‘è€…åœ¨é¢è¯•ä¸­è°ˆåŠç´¢å¼•æ—¶ï¼Œå¾€å¾€åªèƒ½ç»™å‡ºä¸€äº›é›¶æ•£ã€æœºæ¢°çš„è®°å¿†æ€§ç­”æ¡ˆï¼Œæ¯”å¦‚â€œB+æ ‘æŸ¥è¯¢å¿«â€ã€â€œç´¢å¼•èƒ½æé€Ÿâ€ã€‚è¿™æ ·çš„å›ç­”åœ¨é¢è¯•å®˜å¿ƒä¸­ç•™ä¸‹çš„æ·±åˆ»å°è±¡å°±æ˜¯æ­¤å€™é€‰äººå­¦ä¹ çŸ¥è¯†æµ…å°è¾„æ­¢ï¼Œä¸å¤Ÿæ·±å…¥ï¼Œä¸å¤ŸåŠªåŠ›ã€‚çœŸæ­£ä½“ç°ä¸€ä¸ªå·¥ç¨‹å¸ˆæŠ€æœ¯æ·±åº¦çš„ï¼Œæ˜¯å¯¹ç´¢å¼•èƒŒåè®¾è®¡åŸç†çš„ç³»ç»Ÿæ€§ç†è§£ï¼Œä»¥åŠåœ¨å¤æ‚åœºæ™¯ä¸‹è¿›è¡Œé€‰å‹å’Œä¼˜åŒ–çš„èƒ½åŠ›ã€‚</p>
<p>â€ƒâ€ƒåœ¨ MySQL ä¸­ï¼Œé€šå¸¸æ‰€è¯´çš„ç´¢å¼•ï¼Œå¦‚æœæ²¡æœ‰ç‰¹åˆ«å£°æ˜ï¼Œé»˜è®¤éƒ½æ˜¯æŒ‡ B+ æ ‘æ•°æ®ç»“æ„çš„ç´¢å¼•ã€‚åœ¨ä»‹ç»å„ç§æ ‘çš„æ•°æ®ç»“æ„å’ŒMySQLç´¢å¼•ä¹‹å‰ï¼Œå…ˆä»‹ç»æœ¬æ–‡å¤šæ¬¡ä½¿ç”¨çš„å‡ ä¸ªåŸºæœ¬æ¦‚å¿µï¼š</p>
<p><strong>èŠ‚ç‚¹</strong>ï¼šåŒ…å«ä¸€ä¸ªæ•°æ®å…ƒç´ åŠè‹¥å¹²æŒ‡å‘å­æ ‘çš„æŒ‡é’ˆç­‰ã€‚<br/>
<strong>æ ¹èŠ‚ç‚¹</strong>ï¼šæ˜¯æ ‘çš„èµ·å§‹èŠ‚ç‚¹ï¼Œå®ƒæ²¡æœ‰çˆ¶èŠ‚ç‚¹ï¼Œå°±åƒæ˜¯å¤§æ ‘çš„æ ¹åŸºï¼Œå…¶å®ƒèŠ‚ç‚¹éƒ½ä»æ ¹èŠ‚ç‚¹è¡ç”Ÿå‡ºæ¥ã€‚<br/>
<strong>å¶å­èŠ‚ç‚¹</strong>ï¼šä¹Ÿå«ç»ˆç«¯èŠ‚ç‚¹ï¼Œæ˜¯æ²¡æœ‰å­èŠ‚ç‚¹çš„èŠ‚ç‚¹ï¼Œå®ƒä»¬ä½äºæ ‘çš„æœ€åº•å±‚ï¼Œå°±åƒæ ‘æçš„æœ«æ¢¢ã€‚<br/>
â€Œ<strong>å†…éƒ¨èŠ‚ç‚¹</strong>ï¼ˆinternal Nodeï¼‰â€Œï¼šè‡³å°‘æœ‰ä¸€ä¸ªå­èŠ‚ç‚¹çš„èŠ‚ç‚¹ï¼ŒåŒ…æ‹¬æ ¹èŠ‚ç‚¹å’Œæ‰€æœ‰éå¶å­èŠ‚ç‚¹ã€‚<br/>
<strong>å…„å¼ŸèŠ‚ç‚¹</strong>ï¼š å…·æœ‰ç›¸åŒçˆ¶èŠ‚ç‚¹çš„èŠ‚ç‚¹ã€‚<br/>
<strong>èŠ‚ç‚¹çš„åº¦</strong>ï¼šè¯¥èŠ‚ç‚¹æ‹¥æœ‰çš„å­èŠ‚ç‚¹ä¸ªæ•°ã€‚ä¾‹å¦‚äºŒå‰æ ‘ä¸­èŠ‚ç‚¹çš„åº¦æœ€å¤§ä¸º 2ï¼Œå³æ¯ä¸ªèŠ‚ç‚¹æœ€å¤šæœ‰ä¸¤ä¸ªå­èŠ‚ç‚¹ã€‚<br/>
<strong>æ ‘çš„åº¦</strong>ï¼šæ•´æ£µæ ‘ä¸­æ‰€æœ‰èŠ‚ç‚¹çš„æœ€å¤§åº¦æ•°ã€‚<br/>
<strong>å±‚çº§</strong>ï¼šä»æ ¹èŠ‚ç‚¹å¼€å§‹ï¼Œæ ‘çš„æ¯ä¸€å±‚éƒ½æ˜¯ä¸€ä¸ªå±‚çº§ã€‚<br/>
<strong>é«˜åº¦</strong>ï¼ˆheightï¼‰ï¼šå½“å‰èŠ‚ç‚¹åˆ°æœ€è¿œå¶å­èŠ‚ç‚¹çš„æœ€é•¿è·¯å¾„ä¸Šçš„èŠ‚ç‚¹æ•°ã€‚<br/>
<strong>å¹³è¡¡å› å­</strong>ï¼ˆBalance Factorï¼‰ï¼šç®€ç§°BFï¼Œæ¯ä¸ªèŠ‚ç‚¹çš„å·¦å³å­æ ‘çš„é«˜åº¦ä¹‹å·®ã€‚<br/>
<strong>æ•°æ®é¡µ</strong>ï¼šæ ‘ä¸Šæ¯ä¸ªèŠ‚ç‚¹åœ¨è®¡ç®—æœºä¸­å«åšæ•°æ®é¡µï¼Œæ˜¯ InnoDB å­˜å‚¨å¼•æ“ä¸ç£ç›˜äº¤äº’çš„æœ€å°å•ä½ï¼Œé»˜è®¤å¤§å°ä¸º 16KBã€‚<br/>
<strong>é˜¶æ•°</strong>ï¼šä¸€ä¸ªèŠ‚ç‚¹æœ€å¤šå¯ä»¥æœ‰å¤šå°‘ä¸ªå­èŠ‚ç‚¹ï¼ˆå³èŠ‚ç‚¹çš„æœ€å¤§åº¦æ•°ï¼‰ï¼Œä¸€èˆ¬ç”¨å°å†™å­—æ¯mè¡¨ç¤ºé˜¶æ•°ã€‚ç”¨âŒˆm/2âŒ‰è¡¨ç¤ºå¯¹m/2å‘ä¸Šå–æ•´æ•°ã€‚ä¾‹å¦‚ï¼Œä¸‰é˜¶ B+ æ ‘ â†’ æ¯ä¸ªèŠ‚ç‚¹æœ€å¤š 3 ä¸ªå­èŠ‚ç‚¹ â†’ æœ€å¤§åº¦ = 3ã€‚</p>
<p>â€ƒâ€ƒåœ¨æ•°æ®åº“ä¸­æˆ‘ä»¬å°†B+æ ‘ä½œä¸ºç´¢å¼•ç»“æ„ï¼Œå¯ä»¥åŠ å¿«æŸ¥è¯¢é€Ÿåº¦ï¼Œæ­¤æ—¶æ ‘ä¸­çš„keyä¸€èˆ¬æ˜¯è¡¨çš„ä¸»é”®ã€‚ä¾‹å¦‚ï¼ŒMySQL InnoDB çš„è®°å½•ï¼Œå°±æ˜¯æŒ‰ç…§ä¸»é”®ç”±å°åˆ°å¤§æ’åºåï¼Œå­˜åœ¨ B+ æ ‘çš„å¶å­èŠ‚ç‚¹é‡Œã€‚æ ‘ä¸­æ¯ä¸ªèŠ‚ç‚¹å­˜å‚¨äº†å…³é”®å­—ï¼ˆkeyï¼‰ã€å…³é”®å­—å¯¹åº”çš„æ•°æ®ï¼ˆdataï¼‰ä»¥åŠæŒ‡å‘å­©å­èŠ‚ç‚¹çš„æŒ‡é’ˆã€‚æˆ‘ä»¬å°†ä¸€ä¸ªkeyåŠå…¶å¯¹åº”çš„dataç§°ä¸ºä¸€æ¡Â <strong>è®°å½•</strong>ã€‚ä½†ä¸ºäº†æ–¹ä¾¿æè¿°ï¼Œé™¤éç‰¹åˆ«è¯´æ˜ï¼Œåç»­æ–‡ä¸­å°±ç”¨â€œå…³é”®å­—â€æ¥ä»£æŒ‡ï¼ˆkey, valueï¼‰é”®å€¼å¯¹ã€‚ä¸‹é¢å°±æ˜¯MySQLä¸­ç´¢å¼•çš„æ•°æ®ç»“æ„ï¼š</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1425079df27a4ec6961449e319c95016~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56We5aWH5bCP5rGk5ZyG:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771135404&amp;x-signature=tDSMLNqTd%2FyFEdPl1CSvqd6ZH1w%3D" alt="image" loading="lazy"/><br/>
å›¾1 ç´¢å¼•çš„æ•°æ®ç»“æ„ã€‚å¤‡æ³¨ï¼šç£ç›˜å—4æœ‰ç¬”è¯¯ï¼Œåº”è¯¥åˆ é™¤10ã€‚</p>
<p>â€ƒâ€ƒä¸åŒçš„æ ‘ç»“æ„é€‚ç”¨äºä¸åŒçš„åº”ç”¨åœºæ™¯ï¼Œé€‰æ‹©åˆé€‚çš„æ ‘ç»“æ„å¯ä»¥æ˜¾è‘—æé«˜ç¨‹åºçš„æ€§èƒ½å’Œæ•ˆç‡ã€‚åœ¨åˆ†æä¸ºä»€ä¹ˆMySQL InnoDBå­˜å‚¨å¼•æ“çš„ç´¢å¼•é€‰æ‹©ä½¿ç”¨B+æ ‘ä¹‹å‰ï¼Œæˆ‘ç›¸ä¿¡å¾ˆå¤šæ”»åŸç‹®å¯¹æ•°æ®ç»“æ„ä¸­çš„æ ‘è¿˜æ˜¯æœ‰äº›è®¸æ¨¡ç³Šçš„ï¼Œå› æ­¤å°±è®©æˆ‘ä»¬ä¸€åŒè¸ä¸Šè¿™è¶Ÿç”±æµ…å…¥æ·±æ¢è®¨äºŒå‰æŸ¥æ‰¾æ ‘ã€AVLæ ‘ã€çº¢é»‘æ ‘ã€Bæ ‘å’ŒB*æ ‘çš„å¥‡å¦™ä¹‹æ—…ï¼Œä¸€æ­¥æ­¥å¼•å‡ºB+æ ‘ä»¥åŠä¸ºä»€ä¹ˆMySQL InnoDBæ•°æ®åº“ç´¢å¼•é€‰æ‹©ä½¿ç”¨B+æ ‘ï¼é¢†ç•¥B+æ ‘åœ¨æ•°æ®åº“ç´¢å¼•ä¸­åº”ç”¨çš„ç¥å¥‡é­…åŠ›ã€‚å¸Œæœ›é€šè¿‡æœ¬æ–‡ï¼Œä½ èƒ½æ„å»ºèµ·ä¸€ä¸ªä½“ç³»åŒ–çš„æ ‘å’Œç´¢å¼•çŸ¥è¯†æ¡†æ¶ï¼Œè®©ä½ åœ¨æœªæ¥çš„é¢è¯•å’Œå·¥ä½œä¸­æ¸¸åˆƒæœ‰ä½™ã€‚</p>
<h3 data-id="heading-0">äºŒå‰æŸ¥æ‰¾æ ‘</h3>
<p>â€ƒâ€ƒäºŒå‰æŸ¥æ‰¾æ ‘(Binary Search Tree, BST)ä¹Ÿç§°ä¸ºæœ‰åºäºŒå‰æ ‘ï¼ˆOrdered Binary Treeï¼‰ã€æ’åºäºŒå‰æ ‘ï¼ˆsorted binary treeï¼‰æˆ–è€…äºŒå‰æœç´¢æ ‘ï¼Œæ˜¯ä¸€æ£µæ»¡è¶³ä»¥ä¸‹ä¸‰ä¸ªæ€§è´¨çš„äºŒå‰æ ‘ï¼š</p>
<ol>
<li>æœ‰åºæ€§ï¼šä»»æ„éç©ºå·¦å­æ ‘æ‰€æœ‰èŠ‚ç‚¹çš„å€¼å‡å°äºè¯¥èŠ‚ç‚¹çš„å€¼ï¼›éç©ºå³å­æ ‘æ‰€æœ‰èŠ‚ç‚¹çš„å€¼å‡å¤§äºäºè¯¥èŠ‚ç‚¹çš„å€¼ï¼›</li>
<li>é€’å½’æ€§ï¼šä»»æ„èŠ‚ç‚¹çš„å­æ ‘éƒ½æ˜¯äºŒå‰æŸ¥æ‰¾æ ‘ï¼›</li>
<li>æ¯ä¸ªèŠ‚ç‚¹å­˜å‚¨ä¸€æ¡è®°å½•ï¼Œä¸”æ²¡æœ‰é”®å€¼ç›¸ç­‰çš„èŠ‚ç‚¹ã€‚</li>
</ol>
<p>â€ƒâ€ƒä»é€’å½’å®šä¹‰çš„è§’åº¦æ¥çœ‹ï¼ŒäºŒå‰æŸ¥æ‰¾æ ‘å¯ä»¥è¢«å®šä¹‰ä¸ºï¼šè¦ä¹ˆæ˜¯ä¸€æ£µç©ºæ ‘ï¼Œè¦ä¹ˆæ˜¯ç”±ä¸€ä¸ªæ ¹èŠ‚ç‚¹å’Œä¸¤æ£µäº’ä¸ç›¸äº¤çš„ï¼Œåˆ†åˆ«ç§°ä½œæ ¹çš„å·¦å­æ ‘å’Œå³å­æ ‘ç»„æˆçš„éç©ºæ ‘ï¼›è€Œå·¦å­æ ‘å’Œå³å­æ ‘åˆåŒæ ·éƒ½æ˜¯äºŒå‰æŸ¥æ‰¾æ ‘ã€‚è¿™ç§é€’å½’å®šä¹‰æ–¹å¼ç®€æ´è€Œå‡†ç¡®åœ°æè¿°äº†äºŒå‰æŸ¥æ‰¾æ ‘çš„ç»“æ„ç‰¹ç‚¹ã€‚å®ƒä½œä¸ºåŸºç¡€çš„æ ‘å½¢ç»“æ„ï¼Œ<strong>æ¯ä¸ªèŠ‚ç‚¹æœ€å¤šæœ‰ä¸¤ä¸ªå­èŠ‚ç‚¹</strong>ï¼Œå…¶é€’å½’æ€§å’Œæœ‰åºæ€§ä¸ºæˆ‘ä»¬ç†è§£æ›´å¤æ‚çš„æ ‘ç»“æ„å¥ å®šäº†åŸºç¡€ã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0c3fe3ef4df44f3891671296a5f6f280~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56We5aWH5bCP5rGk5ZyG:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771135404&amp;x-signature=2WNazK3yj09jeAg7U3I%2BfBWNA7E%3D" alt="image" loading="lazy"/><br/>
å›¾2 äºŒå‰æœç´¢æ ‘</p>
<p>â€ƒâ€ƒå¦‚æœæˆ‘ä»¬éœ€è¦æŸ¥æ‰¾id=31çš„è®°å½•ï¼Œåˆ©ç”¨æˆ‘ä»¬åˆ›å»ºçš„BSTï¼ŒåŸºäºäºŒåˆ†æŸ¥æ‰¾ç®—æ³•å®ç°çš„æŸ¥æ‰¾æµç¨‹å¦‚ä¸‹ï¼š</p>
<ol>
<li>å°†æ ¹èŠ‚ç‚¹ä½œä¸ºå½“å‰èŠ‚ç‚¹ï¼ŒæŠŠ31ä¸å½“å‰èŠ‚ç‚¹çš„é”®å€¼33æ¯”è¾ƒï¼Œ31å°äº33ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬æŠŠå½“å‰èŠ‚ç‚¹çš„å·¦å­èŠ‚ç‚¹ä½œä¸ºå½“å‰èŠ‚ç‚¹ã€‚</li>
<li>ç»§ç»­æŠŠ31å’Œå½“å‰èŠ‚ç‚¹çš„é”®å€¼28æ¯”è¾ƒï¼Œå‘ç°31å¤§äº28ï¼ŒæŠŠå½“å‰èŠ‚ç‚¹çš„å³å­èŠ‚ç‚¹ä½œä¸ºå½“å‰èŠ‚ç‚¹ã€‚</li>
<li>æŠŠ31å’Œå½“å‰èŠ‚ç‚¹çš„é”®å€¼31å¯¹æ¯”ï¼Œå‘ç°äºŒè€…ç›¸ç­‰ï¼Œæ»¡è¶³æ¡ä»¶ï¼Œéå†ç»“æŸã€‚</li>
</ol>
<p>â€ƒâ€ƒæ‰€ä»¥ï¼Œæˆ‘ä»¬åˆ©ç”¨BSTåªéœ€è¦3æ¬¡å³å¯æ‰¾åˆ°ç›®æ ‡æ•°æ®ã€‚</p>
<p>â€ƒâ€ƒäºŒå‰æ ‘çš„æŸ¥æ‰¾ã€æ’å…¥å’Œåˆ é™¤æ“ä½œçš„æ—¶é—´å¤æ‚åº¦åœ¨å¹³å‡æƒ…å†µä¸‹ä¸º O(logn) ï¼Œä½†åœ¨æœ€åæƒ…å†µä¸‹ï¼Œå½“äºŒå‰æ ‘é€€åŒ–ä¸ºé“¾è¡¨æ—¶ï¼Œæ—¶é—´å¤æ‚åº¦ä¼šå˜ä¸º O(n) ã€‚è¿™æ˜¯å› ä¸ºåœ¨æœ€åæƒ…å†µä¸‹ï¼Œæ‰€æœ‰èŠ‚ç‚¹éƒ½åœ¨ä¸€æ¡é“¾ä¸Šï¼ŒæŸ¥æ‰¾ã€æ’å…¥å’Œåˆ é™¤éƒ½éœ€è¦éå†æ•´ä¸ªé“¾è¡¨ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºé€€åŒ–çš„äºŒå‰æŸ¥æ‰¾æ ‘ï¼š</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2cdd2f92a86b41e39d80d6337863cad4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56We5aWH5bCP5rGk5ZyG:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771135404&amp;x-signature=UzRdZ3knfyovWg%2BZOtpNmTRnBxI%3D" alt="image" loading="lazy"/></p>
<p>â€ƒâ€ƒäºŒå‰æ ‘å®Œå…¨ä¸å¹³è¡¡æ—¶ï¼ŒæŸ¥æ‰¾çš„æ—¶é—´å¤æ‚åº¦å°±å’Œé“¾è¡¨ä¸€è‡´äº†ï¼šO(n)ã€‚å¯¼è‡´è¿™ä¸ªç°è±¡çš„åŸå› å…¶å®æ˜¯BSTå˜å¾—ä¸å¹³è¡¡äº†ï¼Œä¹Ÿå°±æ˜¯é«˜åº¦å¤ªé«˜äº†ï¼Œä»è€Œå¯¼è‡´æŸ¥æ‰¾æ•ˆç‡çš„ä¸ç¨³å®šã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬éœ€è¦ä¿è¯äºŒå‰æŸ¥æ‰¾æ ‘ä¸€ç›´ä¿æŒå¹³è¡¡ï¼Œä»è€Œå¼•å‡ºäº†ä¸€ä¸ªæ–°çš„å®šä¹‰â€”â€”å¹³è¡¡äºŒå‰æ ‘AVLã€‚</p>
<h3 data-id="heading-1">AVLæ ‘/çº¢é»‘æ ‘</h3>
<p>â€ƒâ€ƒå¹³è¡¡äºŒå‰æ ‘ï¼ˆBalanced Binary Treeï¼‰æ˜¯ä¸€ç§ç‰¹æ®Šçš„ã€å¹³è¡¡çš„äºŒå‰æœç´¢æ ‘ï¼Œé€šè¿‡ä¸¥æ ¼æ§åˆ¶æ¯ä¸ªèŠ‚ç‚¹çš„å¹³è¡¡å› å­æ¥ä¿æŒæ ‘çš„å¹³è¡¡ã€‚å¸¸è§çš„å¹³è¡¡äºŒå‰æ ‘æœ‰AVLæ ‘å’Œçº¢é»‘æ ‘ç­‰ï¼Œåœ¨æ»¡è¶³BSTç‰¹æ€§çš„åŸºç¡€ä¸Šï¼Œå…·æœ‰å¦‚ä¸‹ç‰¹æ€§ï¼š</p>
<ol>
<li>å¹³è¡¡å› å­é™åˆ¶â€Œï¼šè¦æ±‚å¹³è¡¡å› å­çš„ç»å¯¹å€¼ä¸èƒ½è¶…è¿‡1ã€‚</li>
<li>é€’å½’æ€§è´¨â€Œï¼šå·¦å³ä¸¤ä¸ªå­æ ‘æœ¬èº«ä¹Ÿéƒ½æ˜¯å¹³è¡¡äºŒå‰æ ‘ã€‚</li>
</ol>
<p>â€ƒâ€ƒä¸ç®¡æ˜¯æ‰§è¡Œæ’å…¥è¿˜æ˜¯åˆ é™¤æ“ä½œï¼Œåªè¦ä¸æ»¡è¶³ä¸Šé¢çš„æ¡ä»¶ï¼Œå°±è¦é€šè¿‡æ—‹è½¬æ ‘ä¸Šçš„èŠ‚ç‚¹æ¥ä¿æŒå¹³è¡¡ï¼Œä½¿å¾—æ ‘çš„é«˜åº¦å§‹ç»ˆä¿æŒåœ¨ O(logn)çš„èŒƒå›´å†…ã€‚è€Œæ—‹è½¬æ˜¯éå¸¸è€—æ—¶çš„ï¼Œç”±æ­¤æˆ‘ä»¬å¯ä»¥çŸ¥é“AVLæ ‘é€‚åˆç”¨äºæ’å…¥æˆ–è€…åˆ é™¤æ¬¡æ•°æ¯”è¾ƒå°‘ï¼Œä½†æŸ¥æ‰¾å¤šçš„æƒ…å†µã€‚</p>
<p>ğŸ¤” ä¸ºä»€ä¹ˆè¦å¹³è¡¡ï¼Ÿ</p>
<p>â€ƒâ€ƒä¿æŒæ•ˆç‡ï¼šå¹³è¡¡çš„äºŒå‰æœç´¢æ ‘å¯ä»¥ç¡®ä¿ä¸ç®¡æ˜¯æ‰§è¡Œæ’å…¥è¿˜æ˜¯åˆ é™¤æ“ä½œéƒ½èƒ½åœ¨O(logn)æ—¶é—´å†…å®Œæˆï¼Œè¿™å¯¹äºéœ€è¦é«˜æ•ˆå¤„ç†æ•°æ®çš„ç³»ç»Ÿæ¥è¯´è‡³å…³é‡è¦ã€‚</p>
<p>â€ƒâ€ƒé¿å…æœ€åæƒ…å†µï¼šæ²¡æœ‰å¹³è¡¡æœºåˆ¶çš„æ•°æ®ç»“æ„åœ¨æœ€åæƒ…å†µä¸‹å¯èƒ½ä¼šé€€åŒ–æˆé“¾è¡¨ï¼Œå¯¼è‡´æ•ˆç‡å¤§å¤§é™ä½ã€‚å¹³è¡¡æœºåˆ¶é€šè¿‡æ—‹è½¬æ“ä½œ<br/>
å®Œæˆï¼Œè€Œæ—‹è½¬æ“ä½œéå¸¸è€—æ—¶ï¼Œç”±æ­¤æˆ‘ä»¬å¯ä»¥çŸ¥é“AVLæ ‘é€‚åˆç”¨äºæ’å…¥æˆ–è€…åˆ é™¤æ¬¡æ•°æ¯”è¾ƒå°‘ï¼Œä½†æŸ¥æ‰¾å¤šçš„æƒ…å†µã€‚æœ¬æ–‡ä¸ä»‹ç»å…·ä½“çš„æ—‹è½¬æ“ä½œã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/938839846591468ca7f81485a5c664ec~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56We5aWH5bCP5rGk5ZyG:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771135404&amp;x-signature=AKUbnuhg%2F7qN0PNfKup1U%2FG8WeQ%3D" alt="image" loading="lazy"/></p>
<p>â€ƒâ€ƒå¹³è¡¡äºŒå‰æ ‘é€šè¿‡çº¦æŸèŠ‚ç‚¹çš„å­æ ‘é«˜åº¦å·®ï¼Œç¡®ä¿æ ‘çš„é«˜åº¦ä¿æŒå¯¹æ•°çº§ï¼Œç›¸æ¯”äºäºŒå‰æŸ¥æ‰¾æ ‘æ¥è¯´ï¼ŒæŸ¥æ‰¾æ•ˆç‡æ›´ç¨³å®šï¼Œæ€»ä½“çš„æŸ¥æ‰¾é€Ÿåº¦ä¹Ÿæ›´å¿«ã€‚</p>
<p>â€ƒâ€ƒçº¢é»‘æ ‘ï¼ˆRed-Black Treeï¼‰å› èŠ‚ç‚¹æ˜¯çº¢è‰²å’Œé»‘è‰²ä¸¤ç§é¢œè‰²ä¹‹ä¸€è€Œå‘½åï¼Œå®ƒæœ¬èº«æ˜¯ä¸€æ£µäºŒå‰æŸ¥æ‰¾æ ‘ï¼Œåœ¨å…¶åŸºç¡€ä¸Šåšäº†å¦‚ä¸‹çº¦æŸï¼š</p>
<ul>
<li>æ ¹èŠ‚ç‚¹æ˜¯é»‘è‰²èŠ‚ç‚¹</li>
<li>æ‰€æœ‰å¶å­èŠ‚ç‚¹ï¼ˆNILèŠ‚ç‚¹ï¼‰éƒ½æ˜¯é»‘è‰²çš„</li>
<li>èŠ‚ç‚¹çš„é¢œè‰²è¦ä¹ˆæ˜¯é»‘è‰²è¦ä¹ˆæ˜¯çº¢è‰²</li>
<li>æ— è¿ç»­çº¢è‰²èŠ‚ç‚¹ï¼šçº¢è‰²èŠ‚ç‚¹çš„å­èŠ‚ç‚¹ä¸ºé»‘è‰²èŠ‚ç‚¹ï¼ˆå³ç›¸é‚»çš„ä¸¤ä¸ªèŠ‚ç‚¹ä¸å¯èƒ½åŒæ—¶ä¸ºçº¢è‰²ï¼‰</li>
<li>ä»»æ„èŠ‚ç‚¹çš„å·¦å­æ ‘å’Œå³å­æ ‘é«˜åº¦ï¼ˆåªç»Ÿè®¡é»‘è‰²èŠ‚ç‚¹ï¼‰ç›¸åŒ</li>
<li>æ—‹è½¬æ“ä½œï¼šå½“æ’å…¥æˆ–åˆ é™¤å¯¼è‡´æ ‘ä¸å¹³è¡¡æ—¶ï¼Œé€šè¿‡æ—‹è½¬æ“ä½œæ¥æ¢å¤å¹³è¡¡ã€‚</li>
</ul>
<p>â€ƒâ€ƒè¿™äº›è§„åˆ™çœ‹èµ·æ¥æ˜¯å¦æœ‰ç‚¹å¤æ‚ï¼Ÿå…¶å®å®ƒä»¬çš„æ ¸å¿ƒç›®çš„åªæœ‰ä¸€ä¸ªï¼šæ§åˆ¶æ•´æ£µæ ‘çš„é«˜åº¦ï¼Œé˜²æ­¢é€€åŒ–æˆé“¾è¡¨ã€‚</p>
<p>â€ƒâ€ƒä¸‹å›¾æ˜¯ä¸€ä¸ªæ ‡å‡†çš„çº¢é»‘æ ‘ï¼š</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e1d06f02ab84420fa341474d8011b03c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56We5aWH5bCP5rGk5ZyG:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771135404&amp;x-signature=l%2FG6MXeZLG1koYAovjrS7DrFxfo%3D" alt="image" loading="lazy"/></p>
<p>â€ƒâ€ƒé»‘è‰²å®Œç¾å¹³è¡¡ï¼šâ€œä»»æ„èŠ‚ç‚¹çš„å·¦å­æ ‘å’Œå³å­æ ‘é«˜åº¦ï¼ˆåªç»Ÿè®¡é»‘è‰²èŠ‚ç‚¹ï¼‰ç›¸åŒ &amp; çº¢è‰²èŠ‚ç‚¹çš„å­èŠ‚ç‚¹æ˜¯é»‘è‰²èŠ‚ç‚¹â€ã€‚è¿™å°±ä¿è¯äº†çº¢é»‘æ ‘çš„â€œå¹³è¡¡æ€§â€ã€‚ç”±äºè¿™ç§å¹³è¡¡ï¼Œå…¶æŸ¥è¯¢çš„å¤æ‚åº¦è‡ªç„¶ä¹Ÿæ˜¯O(log n)çš„ã€‚</p>
<p>çº¢é»‘æ ‘ä¸AVLæ ‘çš„åŒºåˆ«ï¼š</p>






























<table><thead><tr><th>ç‰¹æ€§</th><th>AVL æ ‘</th><th>çº¢é»‘æ ‘</th></tr></thead><tbody><tr><td>å¹³è¡¡æ€§</td><td>éå¸¸ä¸¥æ ¼ï¼Œå¹³è¡¡å› å­æœ€å¤šä¸º1</td><td>è¿‘ä¼¼å¹³è¡¡ï¼Œåªè¦æ±‚ä»æ ¹åˆ°å¶å­çš„æœ€é•¿è·¯å¾„ä¸è¶…è¿‡æœ€çŸ­è·¯å¾„çš„ä¸¤å€</td></tr><tr><td>æ’å…¥æ€§èƒ½</td><td>å¤šæ¬¡æ—‹è½¬ï¼Œæ•ˆç‡è¾ƒä½</td><td>å¿«ï¼ˆæœ€å¤šä¸¤æ¬¡æ—‹è½¬ï¼‰</td></tr><tr><td>åˆ é™¤æ€§èƒ½</td><td>å¤šæ¬¡æ—‹è½¬ï¼Œæ•ˆç‡æ›´ä½ï¼Œä»£ä»·æ›´é«˜</td><td>è¾ƒå¿«ï¼ˆæœ€å¤šä¸‰æ¬¡æ—‹è½¬ï¼‰</td></tr><tr><td>æŸ¥æ‰¾æ€§èƒ½</td><td>æ›´å¿«</td><td>ç¨æ…¢ï¼ˆä½†ä»ä¸º O(log n)ï¼‰</td></tr></tbody></table>
<p>â€ƒâ€ƒç›¸è¾ƒäº AVL æ ‘ï¼Œå®ƒæ˜¯ä¸€ç§å¼±å¹³è¡¡äºŒå‰æ ‘ï¼Œä¸éœ€è¦åƒ AVL æ ‘é‚£æ ·ä¸¥æ ¼è¦æ±‚å¹³è¡¡ï¼Œè¿™ä¹Ÿå¯¼è‡´å®ƒçš„æŸ¥è¯¢æ•ˆç‡å¹¶æ²¡æœ‰ AVL æ ‘é‚£ä¹ˆé«˜ï¼Œä½†ç›¸å¯¹çš„ï¼Œå®ƒå¸¦æ¥çš„å¥½å¤„æ˜¯å¯¹äºè°ƒæ•´å¤±è¡¡ï¼Œçº¢é»‘æ ‘çš„æ—‹è½¬æ¬¡æ•°æ›´å°‘ï¼Œæ‰€ä»¥é¢‘ç¹çš„æ’å…¥æˆ–åˆ é™¤æ“ä½œï¼Œçº¢é»‘æ ‘æ›´æœ‰ä¼˜åŠ¿ã€‚</p>
<p>â€ƒâ€ƒAVL æ˜¯â€œå¼ºè¿«ç—‡æ‚£è€…â€ï¼Œæ¯æ¬¡æ’å…¥åˆ é™¤éƒ½å¯èƒ½å¼•å‘å¤šæ¬¡æ—‹è½¬ï¼Œä»£ä»·å¤ªé«˜ï¼›è€Œçº¢é»‘æ ‘æ˜¯â€œå®ç”¨ä¸»ä¹‰è€…â€ï¼Œå®ƒä¸è¦æ±‚å®Œå…¨å¹³è¡¡ï¼Œåªè¦èƒ½ä¿è¯æŸ¥æ‰¾æ•ˆç‡ä¸å´©å°±è¡Œã€‚çº¢é»‘æ ‘æ˜¯åœ¨â€œé€Ÿåº¦â€ã€â€œç¨³å®šæ€§â€å’Œâ€œå®ç°æˆæœ¬â€ä¹‹é—´æ‰¾åˆ°çš„ä¸€ä¸ªæŠ˜ä¸­ç‹è€…ï¼</p>
<p>â€ƒâ€ƒçº¢é»‘æ ‘æ›´å¸¸ç”¨äºéœ€è¦é«˜é¢‘æ’å…¥å’Œåˆ é™¤çš„åœºæ™¯ï¼Œä¾‹å¦‚ï¼šjava 8 HashMapå’ŒConcurrentHashMapä¸­é“¾è¡¨è½¬çº¢é»‘æ ‘ï¼›epollåœ¨å†…æ ¸ä¸­çš„å®ç°ï¼Œç”¨çº¢é»‘æ ‘ç®¡ç†äº‹ä»¶å—ï¼ˆæ–‡ä»¶æè¿°ç¬¦ï¼‰ï¼›Javaçš„TreeMapå’ŒTreeSetå®ç°ï¼›linuxè¿›ç¨‹CFSè°ƒåº¦å™¨ï¼ˆCompletely Fair Schedulerï¼‰ç”¨çº¢é»‘æ ‘ç®¡ç†è¿›ç¨‹æ§åˆ¶å— ï¼›nginxä¸­ï¼Œç”¨çº¢é»‘æ ‘ç®¡ç†timerã€‚AVLæ ‘æ›´é€‚åˆè¯»å¤šå†™å°‘çš„åœºæ™¯ï¼Œå› ä¸ºå®ƒçš„æŸ¥æ‰¾æ€§èƒ½æ›´æ¥è¿‘å®Œç¾çš„å¹³è¡¡æ ‘ã€‚</p>
<h3 data-id="heading-2">Bæ ‘(B-tree)</h3>
<p>â€ƒâ€ƒå½“æ•°æ®é‡å¤ªå¤§ï¼Œæ— æ³•å…¨éƒ¨è£…å…¥å†…å­˜æ—¶ï¼Œå°±å¿…é¡»å­˜æ”¾åœ¨ç£ç›˜ä¸Šã€‚ç£ç›˜I/Oï¼ˆè¯»å†™ï¼‰é€Ÿåº¦è¿œè¿œé€Šè‰²äºå†…å­˜è®¿é—®ã€‚Bæ ‘å’ŒB+æ ‘å°±æ˜¯ä¸ºäº†å‡å°‘ç£ç›˜I/Oæ¬¡æ•°è€Œè®¾è®¡çš„å¤šè·¯å¹³è¡¡æœç´¢æ ‘ï¼Œå®ƒä»¬è¢«å¹¿æ³›ç”¨äºæ•°æ®åº“å’Œæ–‡ä»¶ç³»ç»Ÿçš„ç´¢å¼•ã€‚ä¸‹é¢ä»‹ç»Bæ ‘ã€‚</p>
<p>â€ƒâ€ƒBæ ‘ï¼ˆBalance Treeï¼‰ä¹Ÿç§°B-æ ‘ï¼Œæ˜¯ä¸€æ£µå¹³è¡¡å¤šè·¯æŸ¥æ‰¾æ ‘ï¼Œ<strong>èŠ‚ç‚¹çš„å­èŠ‚ç‚¹ä¸ªæ•°å¯èƒ½è¶…è¿‡ä¸¤ä¸ª</strong>ï¼Œç”¨æ¥å­˜å‚¨æ’åºåçš„æ•°æ®ã€‚æˆ‘ä»¬æè¿°ä¸€æ£µBæ ‘æ—¶éœ€è¦æŒ‡å®šå®ƒçš„é˜¶æ•°mï¼Œå½“m=2æ—¶ï¼Œå°±æ˜¯æˆ‘ä»¬å¸¸è§çš„äºŒå‰æœç´¢æ ‘ã€‚Bæ ‘æ˜¯ä¸€ç§è‡ªå¹³è¡¡çš„æ ‘çŠ¶æ•°æ®ç»“æ„ï¼Œèƒ½å¤Ÿè®©æ•°æ®çš„æŸ¥æ‰¾ã€æ’å…¥åŠåˆ é™¤åŠ¨ä½œéƒ½åœ¨å¯¹æ•°æ—¶é—´å†…å®Œæˆï¼Œå¸¸å¸¸ç”¨åœ¨å­˜å‚¨ç³»ç»Ÿä¸Šï¼Œå¦‚æ•°æ®åº“æˆ–æ–‡ä»¶ç³»ç»Ÿã€‚</p>
<p>â€ƒâ€ƒä¸€æ£µmé˜¶çš„Bæ ‘ï¼Œæˆ–ä¸ºç©ºæ ‘ï¼Œæˆ–ä¸ºæ»¡è¶³ä¸‹åˆ—ç‰¹æ€§çš„må‰æ ‘ï¼š</p>
<ol>
<li>æ¯ä¸ªèŠ‚ç‚¹æœ€å¤šæœ‰mï¼ˆm&gt;=2ï¼‰æ£µå­æ ‘ï¼Œé™¤éæ ¹èŠ‚ç‚¹ä¸ºå¶å­èŠ‚ç‚¹ï¼Œå¦åˆ™ï¼Œè‡³å°‘æœ‰ä¸¤æ£µå­æ ‘ã€‚ä¾‹å¦‚ï¼Œå¯¹äºä¸€ä¸ª4é˜¶Bæ ‘ï¼Œæ¯ä¸ªèŠ‚ç‚¹æœ€å¤šæœ‰4ä¸ªå­©å­ï¼Œæœ€å°‘æœ‰2ä¸ªå­©å­ï¼›</li>
<li>æ¯ä¸ªèŠ‚ç‚¹å­˜æ”¾è‡³å°‘Â <strong>âŒˆm/2âŒ‰-1</strong>Â ä¸ªå…³é”®å­—ï¼Œè‡³å¤šÂ <strong>m-1</strong>Â ä¸ªå…³é”®å­—ï¼›</li>
<li>å…³é”®å­—ä¸ªæ•°æ¯”å­©å­èŠ‚ç‚¹ä¸ªæ•°å°1ã€‚å³å¦‚æœä¸€ä¸ªèŠ‚ç‚¹æœ‰kä¸ªå…³é”®å­—ï¼Œé‚£ä¹ˆå®ƒå°±æœ‰k + 1ä¸ªå­©å­ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºä¸ºä¸€æ£µ3é˜¶Bæ ‘çš„ç»“æ„ç¤ºæ„å›¾ï¼Œæ ¹èŠ‚ç‚¹æœ‰2ä¸ªå…³é”®å­—å’Œ3ä¸ªæŒ‡é’ˆï¼Œå®ƒæœ‰3ä¸ªå­©å­ï¼Œè¿™äº›å­©å­åˆ†åˆ«å¯¹åº”å…³é”®å­—åˆ’åˆ†çš„3ä¸ªåŒºé—´ï¼š</li>
</ol>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/91865d6b93bc483a98957fb0e22feb43~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56We5aWH5bCP5rGk5ZyG:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771135404&amp;x-signature=Vr1Eq6Cx%2BOMo6vcD1P2dnT5H%2FEU%3D" alt="image" loading="lazy"/></p>
<ol start="2">
<li>è‹¥æ ¹èŠ‚ç‚¹ä¸æ˜¯å¶å­èŠ‚ç‚¹ï¼Œåˆ™è‡³å°‘åŒ…å«ä¸¤æ£µå­æ ‘ï¼ˆç‰¹æ®Šæƒ…å†µï¼šæ²¡æœ‰å­©å­çš„æ ¹èŠ‚ç‚¹ï¼Œå³æ ¹èŠ‚ç‚¹ä¸ºå¶å­èŠ‚ç‚¹ï¼Œæ•´æ£µæ ‘åªæœ‰ä¸€ä¸ªæ ¹èŠ‚ç‚¹ï¼‰ï¼›</li>
<li>é™¤æ ¹èŠ‚ç‚¹å’Œå¶å­èŠ‚ç‚¹å¤–ï¼Œå…¶å®ƒæ¯ä¸ªèŠ‚ç‚¹è‡³å°‘æœ‰Â <strong>âŒˆm/2âŒ‰</strong>Â æ£µå­æ ‘ï¼›</li>
<li>æ¯ä¸ªèŠ‚ç‚¹ä¸­çš„å…³é”®å­—éƒ½æŒ‰ç…§ä»å°åˆ°å¤§çš„é¡ºåºæ’åˆ—ï¼Œæ¯ä¸ªå…³é”®å­—çš„å·¦å­æ ‘ä¸­çš„æ‰€æœ‰å…³é”®å­—éƒ½å°äºå®ƒï¼Œè€Œå³å­æ ‘ä¸­çš„æ‰€æœ‰å…³é”®å­—éƒ½å¤§äºå®ƒï¼›</li>
<li>æ‰€æœ‰å¶å­èŠ‚ç‚¹éƒ½ä½äºåŒä¸€å±‚ï¼Œæˆ–è€…è¯´æ ¹èŠ‚ç‚¹åˆ°æ¯ä¸ªå¶å­èŠ‚ç‚¹çš„é•¿åº¦éƒ½ç›¸åŒã€‚è¿™ä¿è¯äº†Bæ ‘çš„å¹³è¡¡æ€§ï¼Œä½¿å¾—æŸ¥æ‰¾æ“ä½œçš„æ—¶é—´å¤æ‚åº¦ä¸ºO(logn)ã€‚</li>
</ol>
<p>â€ƒâ€ƒä¸‹å›¾å³æ˜¯ä¸€æ£µ m=3 çš„Bæ ‘ï¼š</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e41b73427d8b47ebb6a039f3b6c8f06c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56We5aWH5bCP5rGk5ZyG:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771135404&amp;x-signature=YJMBBJzKBXHMAR2ikjE1qOXkts8%3D" alt="image" loading="lazy"/></p>
<p>â€ƒâ€ƒåœ¨å®é™…åº”ç”¨ä¸­Bæ ‘çš„é˜¶æ•°éƒ½éå¸¸å¤§ï¼Œé€šå¸¸å¤§äº100ï¼Œæ‰€ä»¥å³ä½¿å­˜å‚¨å¤§é‡çš„æ•°æ®ï¼ŒBæ ‘çš„é«˜åº¦ä»ç„¶æ¯”è¾ƒå°ã€‚æ¯ä¸ªèŠ‚ç‚¹ä¸­å­˜å‚¨äº†å…³é”®å­—ï¼ˆkeyï¼‰å’Œå…³é”®å­—å¯¹åº”çš„æ•°æ®ï¼ˆdataï¼‰ä»¥åŠå­©å­èŠ‚ç‚¹çš„æŒ‡é’ˆã€‚Bæ ‘å’Œå¹³è¡¡äºŒå‰æ ‘çš„ä¸åŒä¹‹å¤„ï¼šBæ ‘å±äºå¤šå‰æ ‘ï¼Œçˆ¶èŠ‚ç‚¹çš„å­èŠ‚ç‚¹ä¸ªæ•°ä¸æ­¢ä¸¤ä¸ªã€‚æ³¨æ„: æœ‰æ–‡ç« æŠŠBæ ‘å’ŒB-treeç†è§£æˆäº†ä¸¤ç§ä¸åŒç±»åˆ«çš„æ ‘ï¼Œå…¶å®äºŒè€…æ˜¯åŒä¸€ç§æ ‘ã€‚Bæ ‘æœ‰å¦‚ä¸‹æ•°æ®ç‰¹å¾ï¼š</p>
<ol>
<li>æ•°æ®å­˜å‚¨åœ¨æ•´æ£µæ ‘ä¸­ï¼›</li>
<li>ä»»ä½•ä¸€ä¸ªå…³é”®å­—å‡ºç°ä¸”åªå‡ºç°åœ¨ä¸€ä¸ªèŠ‚ç‚¹ä¸­ï¼›</li>
<li>æœç´¢æœ‰å¯èƒ½åœ¨éå¶å­èŠ‚ç‚¹ç»“æŸï¼Œæ•…æŸ¥è¯¢æ€§èƒ½ä¸ç¨³å®šï¼›</li>
<li>å…¶æœç´¢æ€§èƒ½ç­‰ä»·äºåœ¨å…³é”®å­—å…¨é›†å†…åšä¸€æ¬¡äºŒåˆ†æŸ¥æ‰¾ï¼›</li>
<li>è‡ªåŠ¨å¹³è¡¡æ ‘çš„é«˜åº¦å’Œæ•°æ®é¡µã€‚</li>
</ol>
<p>â€ƒâ€ƒB-æ ‘çš„æŸ¥è¯¢æ–¹å¼å¦‚ä¸‹ï¼šä»æ ¹èŠ‚ç‚¹å¼€å§‹ï¼Œå¯¹èŠ‚ç‚¹å†…çš„å…³é”®å­—ï¼ˆæœ‰åºï¼‰åºåˆ—è¿›è¡ŒäºŒåˆ†æŸ¥æ‰¾ï¼Œå¦‚æœå‘½ä¸­åˆ™ç»“æŸï¼Œå¦åˆ™è¿›å…¥æŸ¥è¯¢å…³é”®å­—æ‰€å±èŒƒå›´çš„å„¿å­èŠ‚ç‚¹ï¼›é‡å¤ï¼Œç›´åˆ°æ‰€å¯¹åº”çš„å„¿å­æŒ‡é’ˆä¸ºç©ºï¼Œæˆ–å·²ç»æ˜¯å¶å­èŠ‚ç‚¹ã€‚</p>
<h3 data-id="heading-3">B+æ ‘ï¼ˆB+ Treeï¼‰</h3>
<p>â€ƒâ€ƒB+æ ‘æ˜¯åœ¨Bæ ‘çš„åŸºç¡€ä¸Šåˆä¸€æ¬¡æ”¹è¿›çš„å¤šè·¯å¹³è¡¡æœç´¢æ ‘ï¼Œå…¶ä¸»è¦åœ¨ä¸¤ä¸ªæ–¹é¢è¿›è¡Œäº†æå‡ï¼Œä¸€æ–¹é¢æ˜¯æŸ¥è¯¢çš„ç¨³å®šæ€§ï¼Œè®©æŸ¥è¯¢é€Ÿåº¦æ›´åŠ ç¨³å®šï¼Œå…¶é€Ÿåº¦å®Œå…¨æ¥è¿‘äºäºŒåˆ†æŸ¥æ‰¾ï¼›å¦å¤–ä¸€æ–¹é¢æ˜¯åœ¨æ•°æ®æ’åºæ–¹é¢æ›´å‹å¥½ï¼Œæ›´å……åˆ†çš„åˆ©ç”¨èŠ‚ç‚¹çš„ç©ºé—´ã€‚B+æ ‘åŒ…å«ä¸¤ç§ç±»å‹çš„èŠ‚ç‚¹ï¼šå†…éƒ¨èŠ‚ç‚¹ï¼ˆä¹Ÿç§°ç´¢å¼•èŠ‚ç‚¹ï¼‰å’Œå¶å­èŠ‚ç‚¹ã€‚æ ¹èŠ‚ç‚¹æœ¬èº«å³å¯ä»¥æ˜¯å†…éƒ¨èŠ‚ç‚¹ï¼Œä¹Ÿå¯ä»¥æ˜¯å¶å­èŠ‚ç‚¹ã€‚B+æ ‘çš„è§„åˆ™ä¸Bæ ‘åŸºæœ¬ç±»ä¼¼ï¼Œä½†æ˜¯åˆåœ¨Bæ ‘çš„åŸºç¡€ä¸Šåšäº†ä»¥ä¸‹å‡ ç‚¹æ”¹è¿›ï¼š</p>
<ul>
<li>çˆ¶èŠ‚ç‚¹å­˜æœ‰æŒ‡å‘å³å­æ ‘ç¬¬ä¸€ä¸ªå…ƒç´ çš„ç´¢å¼•ã€‚</li>
<li>å†…éƒ¨èŠ‚ç‚¹ä¸å­˜å‚¨æ•°æ®ï¼Œåªå­˜å‚¨ç´¢å¼•ï¼Œç”¨äºè·¯ç”±ï¼Œå¶å­èŠ‚ç‚¹å­˜å®Œæ•´è¡Œæ•°æ®ï¼ˆä¸»é”®ç´¢å¼•ï¼‰æˆ– (ç´¢å¼•åˆ— + ä¸»é”®)ï¼ˆäºŒçº§ç´¢å¼•ï¼‰ã€‚è¿™æ˜¯B+æ ‘ä¸Bæ ‘çš„æœ€å¤§å·®å¼‚ã€‚</li>
<li>å†…éƒ¨èŠ‚ç‚¹çš„å­æ ‘æŒ‡é’ˆä¸å…³é”®å­—ä¸ªæ•°ç›¸åŒã€‚</li>
<li>å†…éƒ¨èŠ‚ç‚¹çš„å…³é”®å­—éƒ½æŒ‰ç…§ä»å°åˆ°å¤§çš„é¡ºåºæ’åˆ—ï¼Œå¯¹äºå†…éƒ¨èŠ‚ç‚¹ä¸­çš„ä¸€ä¸ªå…³é”®å­—ï¼Œå·¦å­æ ‘ä¸­çš„æ‰€æœ‰å…³é”®å­—éƒ½å°äºå®ƒï¼Œå³å­æ ‘ä¸­çš„å…³é”®å­—éƒ½å¤§äºç­‰äºå®ƒã€‚</li>
<li>æ‰€æœ‰å¶å­èŠ‚ç‚¹éƒ½å­˜å‚¨æŒ‡å‘ä¸‹ä¸€ä¸ªç›¸é‚»å¶å­èŠ‚ç‚¹çš„æŒ‡é’ˆï¼Œå½¢æˆä¸€ä¸ªå•å‘é“¾è¡¨ã€‚</li>
</ul>
<p>â€ƒâ€ƒä¸‹å›¾æ˜¯ä¸€æ£µm=3çš„B+æ ‘ï¼š</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/27aaed6dd99840d98bca40692deb7fd5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56We5aWH5bCP5rGk5ZyG:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771135404&amp;x-signature=WinfQPeM4GOFHcisfAwOaVZqoF4%3D" alt="image" loading="lazy"/></p>
<p>MySQLä¸­çš„B+æ ‘æ˜¯ä¸Šè¿°B+æ ‘çš„åˆä¸€æ¬¡è¿›åŒ–ï¼šMySQLåŸºäºæ™®é€šB+Treeï¼Œåœ¨å¶å­èŠ‚ç‚¹æ·»åŠ äº†ä¸€ä¸ªæŒ‡å‘ä¸Šä¸€ä¸ªç›¸é‚»å¶å­èŠ‚ç‚¹çš„æŒ‡é’ˆï¼Œå¹¶ä¸”é¦–å°¾å¶å­èŠ‚ç‚¹ä¹Ÿæ˜¯ç›¸è¿çš„ï¼Œä¹Ÿå°±æ˜¯æ„é€ äº†ä¸€ä¸ªå¦‚å›¾1æ‰€ç¤ºçš„åŒé“¾è¡¨ã€‚ä¸‹æ–‡å†æåŠB+æ ‘æ—¶ï¼ŒæŒ‡å¸¦æœ‰åŒå‘é“¾è¡¨çš„MySQL B+æ ‘ã€‚</p>
<p>â€ƒâ€ƒB+æ ‘ç›¸å¯¹äºBæ ‘æœ‰ä¸€äº›è‡ªå·±çš„å·¨å¤§ä¼˜åŠ¿ï¼Œå¯ä»¥å½’ç»“ä¸ºä¸‹é¢å‡ ç‚¹ï¼š</p>

























<table><thead><tr><th>ä¼˜åŠ¿</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>æ›´ç¨³å®šçš„æŸ¥è¯¢æ•ˆç‡</td><td>æ•°æ®ä»…å­˜å‚¨åœ¨å¶å­èŠ‚ç‚¹ï¼Œä»»ä½•æŸ¥æ‰¾éƒ½å¿…é¡»èµ°åˆ°å¶å­èŠ‚ç‚¹ï¼Œè·¯å¾„é•¿åº¦ç›¸åŒï¼Œæ€§èƒ½ç¨³å®šã€‚</td></tr><tr><td>æ›´é«˜çš„ç©ºé—´åˆ©ç”¨ç‡</td><td>å†…éƒ¨èŠ‚ç‚¹ä¸å­˜æ•°æ®ï¼Œå­˜å‚¨çš„å…³é”®å­—æ›´å¤šï¼Œæ ‘æ›´çŸ®ï¼Œè¯»å–æ•°æ®æ—¶I/Oæ¬¡æ•°æ›´å°‘ã€‚</td></tr><tr><td>å¼ºå¤§çš„èŒƒå›´æŸ¥è¯¢</td><td>å¶å­èŠ‚ç‚¹é€šè¿‡æŒ‡å‘å‰åå¶å­èŠ‚ç‚¹çš„æŒ‡é’ˆå½¢æˆäº†ä¸€ä¸ªæœ‰åºåŒå‘é“¾è¡¨ï¼Œæ•…å¯ä»¥é«˜æ•ˆåœ°è¿›è¡ŒèŒƒå›´æŸ¥è¯¢å’Œåå‘æ’åºï¼Œè€ŒBæ ‘éœ€è¦è¿›è¡Œå¤æ‚çš„ä¸­åºéå†ã€‚</td></tr><tr><td>æ›´é€‚åˆç£ç›˜é¢„è¯»</td><td>ç£ç›˜æŒ‰æ•°æ®é¡µè¯»å†™ã€‚B+æ ‘çš„èŠ‚ç‚¹é€šå¸¸è®¾è®¡ä¸ºæ°å¥½ä¸€æ•°æ®é¡µå¤§å°ï¼Œä¸€æ¬¡I/Oèƒ½åŠ è½½æ›´å¤šé”®ï¼Œè¿›ä¸€æ­¥å‡å°‘I/Oã€‚</td></tr></tbody></table>
<p>â€ƒâ€ƒB+æ ‘çš„æ’å…¥æ“ä½œå¾ˆç®€å•ï¼Œåªéœ€è¦è®°ä½ä¸€ä¸ªæŠ€å·§å³å¯ï¼šå½“èŠ‚ç‚¹å…ƒç´ æ•°é‡å¤§äºm-1çš„æ—¶å€™ï¼Œå°±æŒ‰ä¸­é—´å…ƒç´ åˆ†è£‚æˆå·¦å³ä¸¤éƒ¨åˆ†ï¼Œä¸­é—´å…ƒç´ çš„å…³é”®å­—åˆ†è£‚åˆ°çˆ¶èŠ‚ç‚¹å½“åšç´¢å¼•å­˜å‚¨ï¼Œä½†æ˜¯ï¼Œæœ¬èº«ä¸­é—´å…ƒç´ è¿˜æ˜¯åˆ†è£‚åˆ°å³å­æ ‘ä¸­ã€‚</p>
<blockquote>
<p><strong>é¢è¯•é¢˜</strong>ï¼šB+æ ‘ä¸ºä»€ä¹ˆæ¯”Bæ ‘æ›´é€‚åˆä½œä¸ºæ“ä½œç³»ç»Ÿçš„æ–‡ä»¶ç´¢å¼•å’Œæ•°æ®åº“ç´¢å¼•ï¼Ÿ</p>
</blockquote>
<p>â€ƒâ€ƒç®€ç­”å¦‚ä¸‹ï¼š<br/>
<strong>B+æ ‘çš„ç£ç›˜è¯»å†™ä»£ä»·æ›´ä½</strong>ã€‚å®ƒçš„å†…éƒ¨èŠ‚ç‚¹æ²¡æœ‰å­˜å‚¨è®°å½•ï¼Œå› æ­¤å†…éƒ¨èŠ‚ç‚¹ç›¸å¯¹Bæ ‘å ç”¨çš„å­˜å‚¨ç©ºé—´æ›´å°ã€‚å¦‚æœæŠŠæ‰€æœ‰åŒä¸€å†…éƒ¨èŠ‚ç‚¹çš„å…³é”®å­—æ”¾åœ¨åŒä¸€å—ç£ç›˜ä¸­ï¼Œç›˜å—æ‰€èƒ½å®¹çº³çš„å…³é”®å­—æ•°é‡ä¹Ÿå°±è¶Šå¤šï¼Œä¸€æ¬¡æ€§è¯»å…¥å†…å­˜ä¸­çš„éœ€è¦æŸ¥æ‰¾çš„å…³é”®å­—ä¹Ÿå°±è¶Šå¤šï¼Œç›¸å¯¹I/Oè¯»å†™æ¬¡æ•°é™ä½ã€‚</p>
<p>â€ƒâ€ƒ<strong>B+æ ‘çš„æŸ¥è¯¢æ•ˆç‡æ›´åŠ ç¨³å®š</strong>ã€‚ç”±äºéç»ˆèŠ‚ç‚¹å¹¶ä¸æ˜¯æœ€ç»ˆæŒ‡å‘æ–‡ä»¶å†…å®¹çš„èŠ‚ç‚¹ï¼Œè€Œåªæ˜¯å¶å­èŠ‚ç‚¹ä¸­å…³é”®å­—çš„ç´¢å¼•ã€‚æ‰€ä»¥ä»»ä½•å…³é”®å­—çš„æŸ¥æ‰¾å¿…é¡»èµ°ä¸€æ¡ä»æ ¹èŠ‚ç‚¹åˆ°å¶å­èŠ‚ç‚¹çš„è·¯ã€‚æ‰€æœ‰å…³é”®å­—æŸ¥è¯¢çš„è·¯å¾„é•¿åº¦ç›¸åŒï¼Œå¯¼è‡´æ¯ä¸€ä¸ªæ•°æ®çš„æŸ¥è¯¢æ•ˆç‡ç›¸å½“ã€‚</p>
<p>â€ƒâ€ƒ<strong>B+æ ‘æ”¯æŒèŒƒå›´æŸ¥è¯¢</strong>ã€‚B+æ ‘åªè¦éå†å¶å­èŠ‚ç‚¹å°±å¯ä»¥å®ç°æ•´æ£µæ ‘çš„éå†ï¼Œæ”¯æŒåŸºäºèŒƒå›´æŸ¥è¯¢ï¼Œè€ŒBæ ‘ä¸æ”¯æŒèŒƒå›´æŸ¥æ‰¾ã€‚</p>
<blockquote>
<p>é¢è¯•é¢˜ï¼šä¸ºä»€ä¹ˆ InnoDB é€‰æ‹© B+ æ ‘ä½œä¸ºç´¢å¼•ç»“æ„ï¼Ÿ</p>
</blockquote>
<p>â€ƒâ€ƒç›¸å¯¹äºäºŒå‰æ ‘ï¼ŒB+ æ ‘çš„å±‚çº§æ›´å°‘ï¼Œæœç´¢æ•ˆç‡æ›´é«˜ã€‚ç›¸å¯¹ Hash ç´¢å¼•ï¼ŒB+ æ ‘æ”¯æŒèŒƒå›´æŸ¥æ‰¾ä»¥åŠæ’åºæ“ä½œã€‚å¯¹äº B- æ ‘ï¼Œæ— è®ºæ˜¯å¶å­èŠ‚ç‚¹è¿˜æ˜¯éå¶å­èŠ‚ç‚¹éƒ½ä¼šä¿å­˜æ•°æ®ï¼Œè¿™æ ·ä¼šå¯¼è‡´ä¸€é¡µä¸­å­˜å‚¨çš„é”®å€¼å‡å°‘ï¼ŒæŒ‡é’ˆè·Ÿç€å‡å°‘ï¼›è¦åŒæ ·ä¿å­˜å¤§é‡æ•°æ®ï¼Œåªèƒ½å¢åŠ æ ‘çš„é«˜åº¦ï¼Œå¯¼è‡´æ€§èƒ½é™ä½ã€‚B+ æ ‘ä¸­é—´èŠ‚ç‚¹æ²¡æœ‰å«æ˜Ÿæ•°æ®ï¼ˆç´¢å¼•å…ƒç´ æ‰€æŒ‡å‘çš„æ•°æ®è®°å½•ï¼‰ï¼Œåªæœ‰ç´¢å¼•ã€‚è¿™å°±æ„å‘³ç€åŒæ ·çš„å¤§å°çš„ç£ç›˜é¡µå¯ä»¥å®¹çº³æ›´å¤šèŠ‚ç‚¹å…ƒç´ ï¼Œåœ¨ç›¸åŒçš„æ•°æ®é‡ä¸‹ï¼ŒB+ æ ‘æ›´åŠ  â€œçŸ®èƒ–â€ï¼ŒI/O æ“ä½œæ›´å°‘ã€‚å› ä¸ºå«æ˜Ÿæ•°æ®çš„ä¸åŒï¼Œå¯¼è‡´æŸ¥è¯¢è¿‡ç¨‹ä¹Ÿä¸åŒï¼›B- æ ‘çš„æŸ¥æ‰¾åªéœ€æ‰¾åˆ°åŒ¹é…å…ƒç´ å³å¯ï¼Œæœ€å¥½æƒ…å†µä¸‹æŸ¥æ‰¾åˆ°æ ¹èŠ‚ç‚¹ï¼Œæœ€åæƒ…å†µä¸‹æŸ¥æ‰¾åˆ°å¶å­ç»“ç‚¹ï¼Œæ‰€è¯´æ€§èƒ½å¾ˆä¸ç¨³å®šï¼Œè€Œ B+ æ ‘æ¯æ¬¡å¿…é¡»æŸ¥æ‰¾åˆ°å¶å­ç»“ç‚¹ï¼Œæ€§èƒ½ç¨³å®šã€‚</p>
<h3 data-id="heading-4">B*æ ‘ï¼ˆB star Treeï¼‰</h3>
<p>â€ƒâ€ƒB<em>æ ‘æ˜¯æ™®é€šB+æ ‘çš„å˜å½¢ï¼Œåœ¨æ™®é€šB+æ ‘é™¤æ ¹èŠ‚ç‚¹å¤–çš„å†…éƒ¨èŠ‚ç‚¹å¢åŠ æŒ‡å‘å…„å¼ŸèŠ‚ç‚¹çš„æŒ‡é’ˆï¼Œå°†èŠ‚ç‚¹çš„æœ€ä½åˆ©ç”¨ç‡ä»æ™®é€šB+æ ‘çš„1/2æå‡åˆ°2/3ã€‚ä¸‹å›¾æ˜¯ä¸€æ£µm=3çš„B</em>æ ‘ï¼š</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7fed75f90c5c46acb10d8d338176e70c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56We5aWH5bCP5rGk5ZyG:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771135404&amp;x-signature=lAUbVGEnXpbRU9tng0FiLqEk5tg%3D" alt="image" loading="lazy"/></p>
<p>â€ƒâ€ƒåœ¨B+æ ‘çš„åŸºç¡€ä¸Šå› å…¶åˆå§‹åŒ–çš„å®¹é‡å˜å¤§ï¼Œä½¿å¾—èŠ‚ç‚¹ç©ºé—´ä½¿ç”¨ç‡æ›´é«˜ï¼Œè€Œåˆå­˜æœ‰å…„å¼ŸèŠ‚ç‚¹çš„æŒ‡é’ˆï¼Œå¯ä»¥å‘å…„å¼ŸèŠ‚ç‚¹è½¬ç§»å…³é”®å­—çš„ç‰¹æ€§ä½¿å¾—B*æ ‘åˆ†è£‚æ¬¡æ•°å˜å¾—æ›´å°‘ã€‚</p>
<p>â€ƒâ€ƒB+æ ‘çš„åˆ†è£‚ï¼šå½“ä¸€ä¸ªèŠ‚ç‚¹æ»¡æ—¶ï¼Œåˆ†é…ä¸€ä¸ªæ–°çš„èŠ‚ç‚¹ï¼Œå¹¶å°†åŸèŠ‚ç‚¹ä¸­1/2çš„æ•°æ®å¤åˆ¶åˆ°æ–°èŠ‚ç‚¹ï¼Œæœ€ååœ¨çˆ¶èŠ‚ç‚¹ä¸­å¢åŠ æ–°èŠ‚ç‚¹çš„æŒ‡é’ˆï¼›B+æ ‘çš„åˆ†è£‚åªå½±å“åŸèŠ‚ç‚¹å’Œçˆ¶èŠ‚ç‚¹ï¼Œè€Œä¸ä¼šå½±å“å…„å¼ŸèŠ‚ç‚¹ï¼Œæ‰€ä»¥å®ƒä¸éœ€è¦æŒ‡å‘å…„å¼ŸèŠ‚ç‚¹çš„æŒ‡é’ˆã€‚</p>
<p>â€ƒâ€ƒB<em>æ ‘çš„åˆ†è£‚ï¼šå½“ä¸€ä¸ªèŠ‚ç‚¹æ»¡æ—¶ï¼Œå¦‚æœå®ƒçš„ä¸‹ä¸€ä¸ªå…„å¼ŸèŠ‚ç‚¹æœªæ»¡ï¼Œé‚£ä¹ˆå°†ä¸€éƒ¨åˆ†æ•°æ®ç§»åˆ°å…„å¼ŸèŠ‚ç‚¹ä¸­ï¼Œå†åœ¨åŸèŠ‚ç‚¹æ’å…¥å…³é”®å­—ï¼Œæœ€åä¿®æ”¹çˆ¶èŠ‚ç‚¹ä¸­å…„å¼ŸèŠ‚ç‚¹çš„å…³é”®å­—ï¼ˆå› ä¸ºå…„å¼ŸèŠ‚ç‚¹çš„å…³é”®å­—èŒƒå›´æ”¹å˜äº†ï¼‰ï¼›å¦‚æœå…„å¼Ÿä¹Ÿæ»¡äº†ï¼Œåˆ™åœ¨åŸèŠ‚ç‚¹ä¸å…„å¼ŸèŠ‚ç‚¹ä¹‹é—´å¢åŠ æ–°èŠ‚ç‚¹ï¼Œå¹¶å„è´¡çŒ®ä¸‰åˆ†ä¹‹ä¸€çš„æ•°æ®åˆ°æ–°èŠ‚ç‚¹ï¼Œæœ€ååœ¨çˆ¶èŠ‚ç‚¹å¢åŠ æ–°èŠ‚ç‚¹çš„æŒ‡é’ˆã€‚æ‰€ä»¥ï¼ŒB</em>æ ‘åˆ†é…æ–°èŠ‚ç‚¹çš„æ¦‚ç‡æ¯”B+æ ‘è¦ä½ï¼Œç©ºé—´ä½¿ç”¨ç‡æ›´é«˜ã€‚</p>
<h3 data-id="heading-5">æ ‘çš„æ€»ç»“</h3>
<p>1ã€ç›¸åŒæ€æƒ³å’Œç­–ç•¥</p>
<p>â€ƒâ€ƒä»å¹³è¡¡äºŒå‰æ ‘ã€Bæ ‘ã€B+æ ‘ã€B*æ ‘æ€»ä½“æ¥çœ‹å®ƒä»¬çš„è´¯å½»çš„æ€æƒ³æ˜¯ç›¸åŒçš„ï¼Œéƒ½æ˜¯é‡‡ç”¨äºŒåˆ†æŸ¥æ‰¾å’Œæ•°æ®å¹³è¡¡ç­–ç•¥æ¥æå‡æŸ¥æ‰¾æ•°æ®çš„é€Ÿåº¦ã€‚</p>
<p>2ã€ä¸åŒçš„æ–¹å¼å¯¹æ ‘çš„ä¸æ–­ä¼˜åŒ–</p>
<p>â€ƒâ€ƒä¸ºäº†ä¿è¯æ ‘çš„èŠ‚ç‚¹å‡åŒ€åˆ†å¸ƒï¼Œæ‰€ä»¥åœ¨äºŒå‰æ ‘çš„åŸºç¡€ä¸ŠåŠ ä¸Šäº†å¹³è¡¡ç®—æ³•ï¼Œå°±æœ‰äº†å¹³è¡¡äºŒå‰æ ‘ã€‚</p>
<p>â€ƒâ€ƒä¸ºäº†å‡å°‘æ ‘çš„é«˜åº¦ï¼Œæ‰€ä»¥Bæ ‘ä¸€ä¸ªèŠ‚ç‚¹ä¸‹é¢å¯ä»¥æ·»åŠ Nä¸ªå­èŠ‚ç‚¹ï¼Œç„¶åæ¯ä¸ªèŠ‚ç‚¹çš„å¤§å°é»˜è®¤é™åˆ¶åœ¨16KBï¼Œåªéœ€è¦é€šè¿‡ä¸€æ¬¡IOå°±èƒ½è¯»å–åˆ°èŠ‚ç‚¹ä¸Šçš„æ‰€æœ‰æ•°æ®ï¼Œé€šè¿‡å¢åŠ èŠ‚ç‚¹å­˜å‚¨çš„æ•°æ®å‡å°‘äº†æ ‘çš„é«˜åº¦ï¼Œè€Œå¹¶æ²¡æœ‰è®©IOæ¬¡æ•°å˜å¤šã€‚</p>
<p>â€ƒâ€ƒB+æ ‘åœ¨Bæ ‘çš„åŸºç¡€ä¸Šï¼Œå¯¹æŸ¥è¯¢çš„ç¨³å®šæ€§å’Œæ’åºç­–ç•¥è¿›è¡Œäº†ä¼˜åŒ–ï¼Œå› ä¸ºB+æ ‘æ‰€æœ‰çš„æ•°æ®éƒ½ä¿å­˜åˆ°å¶å­èŠ‚ç‚¹ï¼Œå¹¶ä¸”æ‰€æœ‰å¶å­èŠ‚ç‚¹æœ¬èº«æ˜¯æœ‰åºæ’åˆ—çš„ã€‚</p>
<p>â€ƒâ€ƒB*æ ‘ä¸ºäº†å‡å°‘æ ‘åœ¨æ„å»ºè¿‡ç¨‹ä¸­èŠ‚ç‚¹çš„åˆ†è£‚æˆ–è€…åˆå¹¶æ¬¡æ•°ï¼Œæ‰€ä»¥åœ¨æ¯ä¸ªéæ ¹èŠ‚ç‚¹çš„å†…éƒ¨èŠ‚ç‚¹ä¸Šéƒ½ä¿å­˜äº†å…„å¼ŸèŠ‚ç‚¹çš„æŒ‡é’ˆï¼Œåœ¨èŠ‚ç‚¹éœ€è¦è¿›è¡Œåˆ†è£‚æˆ–è€…åˆå¹¶æ—¶ï¼Œä¼˜å…ˆä»å…„å¼ŸèŠ‚ç‚¹æŒªæ•°æ®ï¼Œä»è€Œå‡å°‘æ„å»ºè¿‡ç¨‹ä¸­èŠ‚ç‚¹åˆ†è£‚æˆ–è€…åˆå¹¶çš„æ¬¡æ•°ï¼Œæå‡äº†æ ‘çš„æ„å»ºæ€§èƒ½ï¼Œå°†èŠ‚ç‚¹çš„æœ€ä½åˆ©ç”¨ç‡ä»1/2æé«˜åˆ°2/3ã€‚</p>
<h3 data-id="heading-6">å®é™…åº”ç”¨ä¸­çš„ç´¢å¼•ä¼˜åŒ–</h3>
<p>â€ƒâ€ƒäº†è§£ Bæ ‘ å’Œ B+æ ‘çš„åŸºæœ¬åŸç†åï¼Œåœ¨å®é™…åº”ç”¨ä¸­å¦‚ä½•åˆç†ä½¿ç”¨ç´¢å¼•å‘¢ï¼Ÿé¦–å…ˆï¼Œè¦é€‰æ‹©åˆé€‚çš„ç´¢å¼•åˆ—ã€‚å¯¹äºç»å¸¸ç”¨ä½œæŸ¥è¯¢æ¡ä»¶å’Œæ’åºçš„åˆ—ï¼Œåº”è¯¥å»ºç«‹ç´¢å¼•ã€‚å…¶æ¬¡ï¼Œè¦æ³¨æ„ç´¢å¼•çš„ç»´æŠ¤ã€‚é¢‘ç¹æ›´æ–°çš„åˆ—ä¼šå¯¼è‡´ç´¢å¼•é‡å»ºï¼Œå› æ­¤è¦æƒè¡¡ç´¢å¼•çš„åˆ©å¼Šã€‚æœ€åï¼Œè¦æ ¹æ®æŸ¥è¯¢éœ€æ±‚é€‰æ‹©åˆé€‚çš„ç´¢å¼•ç±»å‹ã€‚å¯¹äºéœ€è¦é¢‘ç¹è¿›è¡ŒèŒƒå›´æŸ¥è¯¢çš„åˆ—ï¼ŒB+ æ ‘ç´¢å¼•æ˜¯æ›´å¥½çš„é€‰æ‹©ã€‚</p>
<p>â€ƒâ€ƒåœ¨å®é™…åº”ç”¨ä¸­ï¼Œè¿˜å¯ä»¥é€šè¿‡å¤åˆç´¢å¼•ã€è¦†ç›–ç´¢å¼•ç­‰é«˜çº§æŠ€æœ¯è¿›ä¸€æ­¥ä¼˜åŒ–æŸ¥è¯¢æ€§èƒ½ã€‚</p>
<h3 data-id="heading-7">èšé›†ç´¢å¼•å’Œè¾…åŠ©ç´¢å¼•</h3>
<p>â€ƒâ€ƒMySQL InnoDBå­˜å‚¨å¼•æ“æ•°æ®åº“ä¸­çš„B+Treeç´¢å¼•å¯ä»¥åˆ†ä¸ºèšé›†ç´¢å¼•ï¼ˆclustered indexï¼Œä¹Ÿå«ä¸»é”®ç´¢å¼•ã€èšç°‡ç´¢å¼•ï¼‰å’Œè¾…åŠ©ç´¢å¼•ï¼ˆsecondary indexï¼Œä¹Ÿå«éèšé›†ç´¢å¼•ï¼‰ã€‚</p>
<p>â€ƒâ€ƒèšé›†ç´¢å¼•ä¹Ÿå«ä¸»é”®ç´¢å¼•ï¼Œå¶å­èŠ‚ç‚¹ä¸­çš„dataå­˜å‚¨çš„æ˜¯è¯¥ä¸»é”®å¯¹åº”çš„æ•´è¡Œæ•°æ®ï¼Œé€šå¸¸B+Treeçš„é«˜åº¦ä¸º3ï¼Œä¹Ÿå°±æ˜¯æœ‰ä¸‰å±‚èŠ‚ç‚¹ï¼ŒMySQLä¼šæŠŠB+Treeç¬¬ä¸€å±‚ä¹Ÿå°±æ˜¯æ ¹èŠ‚ç‚¹æ”¾åœ¨å†…å­˜ä¸­ï¼Œæˆ‘ä»¬æ ¹æ®ä¸»é”®ç´¢å¼•æŸ¥æ•°æ®ï¼Œåªéœ€è¦ä¸¤æ¬¡ç£ç›˜I\Oï¼ˆç¬¬äºŒå±‚1æ¬¡ï¼Œç¬¬ä¸‰å±‚1æ¬¡ï¼‰å³å¯ã€‚</p>
<p>éèšé›†ç´¢å¼•ä¹Ÿå«è¾…åŠ©ç´¢å¼•ï¼Œå¶å­èŠ‚ç‚¹ä¸­å­˜å‚¨çš„æ˜¯è¯¥ç´¢å¼•æ‰€åœ¨è®°å½•çš„ä¸»é”®å€¼ï¼Œæ‰€ä»¥éèšé›†ç´¢å¼•çš„å¯»å€è¿‡ç¨‹åˆ†ä¸¤ç§æƒ…å†µï¼š</p>
<p>(1) éèšé›†ç´¢å¼•å·²ç»ç´¢å¼•è¦†ç›–äº†ï¼Œé‚£ä¹ˆåªéœ€è¦éå†è¿™éèšé›†ç´¢å¼•è¿™ä¸€ä¸ªB+Treeå³å¯ï¼ŒæŒ‰ç…§ä¸Šé¢çš„åˆ†æï¼Œéœ€è¦ä¸¤æ¬¡ç£ç›˜IOå³å¯ï¼ˆmysqlä¼šæŠŠæ ¹èŠ‚ç‚¹æ”¾åˆ°å†…å­˜ä¸­ï¼‰ã€‚</p>
<p>(2) éèšé›†ç´¢å¼•ä¸èƒ½ç´¢å¼•è¦†ç›–ï¼Œé‚£ä¹ˆéœ€è¦å›è¡¨ã€‚å…ˆéœ€è¦åœ¨éèšé›†ç´¢å¼•è¿™ä¸ªB+Treeä¸Šä¸¤æ¬¡IOæ‰¾åˆ°ä¸»é”®ï¼Œç„¶åæ‹¿ç€ä¸»é”®å»èšé›†ç´¢å¼•çš„B+Treeä¸Šæ‰¾å¯¹åº”çš„å®Œæ•´æ•°æ®è®°å½•ã€‚ç›¸æ¯”ç¬¬ä¸€ç§æƒ…å†µIOæ¬¡æ•°è¦å¤šï¼Œæ‰€ä»¥æˆ‘ä»¬é€šå¸¸å–œæ¬¢ç´¢å¼•è¦†ç›–ã€‚è¿™ä¸ªè¿‡ç¨‹ä¼šå¢åŠ é¢å¤–çš„ IO æ¶ˆè€—å’Œç½‘ç»œä¼ è¾“æ—¶é—´ï¼Œé™ä½æŸ¥è¯¢æ€§èƒ½ã€‚</p>
<p>ä¸‹å›¾è¡¨ç¤ºéèšé›†ç´¢å¼•ä¸èƒ½ç´¢å¼•è¦†ç›–çš„æƒ…å†µï¼šå³ä¾§çš„è¾…åŠ©ç´¢å¼•å…ˆæ‹¿åˆ°ä¸»é”®å€¼5ï¼Œç„¶åå»å·¦ä¾§çš„ä¸»é”®ç´¢å¼•ä¸­å¯»å€ï¼Œæœ€åå¯ä»¥å¾—åˆ°æ•´è¡Œè®°å½•çš„å†…å®¹ã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/700732be249847d893da968764a1b1dd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56We5aWH5bCP5rGk5ZyG:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771135404&amp;x-signature=XPXfhzhzM8GBVCqnQU3LpYYdG80%3D" alt="image" loading="lazy"/></p>
<h3 data-id="heading-8">é¢è¯•å®æˆ˜æŒ‡å—</h3>
<p>â€ƒâ€ƒæŒæ¡äº†ä»¥ä¸Šå„ç§æ ‘çš„çŸ¥è¯†ï¼Œä½ å·²ç»èƒ½åº”å¯¹80%çš„ç´¢å¼•é—®é¢˜ã€‚ä½†æƒ³åœ¨é¢è¯•ä¸­çœŸæ­£å¾æœé¢è¯•å®˜ï¼Œè¿˜éœ€è¦å‡†å¤‡ä¸€äº›æ›´å…·æ·±åº¦å’Œå¹¿åº¦çš„è¯é¢˜ã€‚è¿™é‡Œå†è€ƒå¯Ÿç´¢å¼•é—®é¢˜çš„æ—¶å€™ï¼Œæœ‰ç»éªŒçš„é¢è¯•å®˜å¾ˆå¯èƒ½å¯¹ä»¥ä¸‹ä¸‰ä¸ªé—®é¢˜æ·±æŒ–ï¼Œä½ å¯ä»¥å‡†ç¡®å›ç­”äº†å—ï¼Ÿ</p>
<ul>
<li>B+æ ‘ä¸Bæ ‘ã€çº¢é»‘æ ‘ç­‰å…¶å®ƒæ ‘çš„å¯¹æ¯”</li>
<li>MySQLç´¢å¼•ä¼šå¤±æ•ˆå—</li>
<li>MySQL InnoDBè¡¨ä¸­å«æœ‰NULLå€¼çš„åˆ—å»ºç´¢å¼•æœ‰ä½œç”¨å—</li>
<li>MySQL InnoDBé«˜åº¦ä¸º3çš„B+Treeå¯ä»¥å­˜å‚¨å¤šå°‘æ¡æ•°æ®</li>
</ul>
<p>ç­”æ¡ˆå³å°†æ­æ™“ï¼Œæ•¬è¯·å…³æ³¨å°ç¼–ã€‚</p>
<h3 data-id="heading-9">ç»“æŸè¯­</h3>
<p>â€ƒâ€ƒæœ¬æ–‡ä»‹ç»äº†äºŒå‰æ ‘ã€AVLæ ‘ã€çº¢é»‘æ ‘ã€Bæ ‘å’ŒB+æ ‘äº”ç§æ ‘çš„æ•°æ®ç»“æ„ï¼Œä»‹ç»äº†å¦‚ä½•ä¸€æ­¥æ­¥é™ä½æ ‘çš„é«˜åº¦ï¼Œæå‡å¢åˆ æ”¹æŸ¥æ•ˆç‡ï¼Œæœ€åä»‹ç»äº†MySQL InnoDBç´¢å¼•åŠå…¶ç›¸å…³é«˜é¢‘ã€é«˜é˜¶é¢è¯•é¢˜ã€‚</p>
<p>â€ƒâ€ƒè¯·æš‚æ”¾å·¥ä½œå–§åš£ï¼Œäº«å—æ±—æ°´æ¢æ¥çš„é—²æš‡ï¼Œæƒ¬æ„é˜…è¯»ã€‚è†å¬å†…å¿ƒï¼Œæ„Ÿå—è‡ªç”±ï¼Œé™äº«ä¸°ç›ˆæ—¶å…‰ã€‚æ„¿è¿™ä»½å®é™å’Œè¿™ç¯‡åšæ–‡ï¼Œæ»‹å…»ä½ å‰è¡Œã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Spring Batchå®æˆ˜]]></title>    <link>https://juejin.cn/post/7603575763786874906</link>    <guid>https://juejin.cn/post/7603575763786874906</guid>    <pubDate>2026-02-06T23:44:29.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7603575763786874906" data-draft-id="7603352117640134665" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Spring Batchå®æˆ˜"/> <meta itemprop="keywords" content="Java,Spring"/> <meta itemprop="datePublished" content="2026-02-06T23:44:29.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="é›¨ä¸­é£˜è¡çš„è®°å¿†"/> <meta itemprop="url" content="https://juejin.cn/user/694547077666606"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Spring Batchå®æˆ˜
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/694547077666606/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    é›¨ä¸­é£˜è¡çš„è®°å¿†
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-06T23:44:29.000Z" title="Fri Feb 06 2026 23:44:29 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-06
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»13åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">Spring Batchå®æˆ˜</h2>
<h3 data-id="heading-1">å‰è¨€</h3>
<p>åœ¨ä¼ä¸šçº§åº”ç”¨ä¸­ï¼Œæ‰¹é‡æ•°æ®å¤„ç†æ˜¯ä¸€ä¸ªéå¸¸å¸¸è§çš„éœ€æ±‚ã€‚æ¯”å¦‚æœˆåº•çš„å·¥èµ„ä»£å‘ã€é“¶è¡Œå¯¹è´¦ã€æ•°æ®æŠ¥è¡¨ç”Ÿæˆç­‰ã€‚å½“æ•°æ®é‡è¾¾åˆ°å‡ åä¸‡ç”šè‡³ä¸Šç™¾ä¸‡æ—¶ï¼Œå¦‚ä½•é«˜æ•ˆã€å¯é åœ°å¤„ç†è¿™äº›æ•°æ®ï¼Œå°±æˆäº†ä¸€ä¸ªæŠ€æœ¯æŒ‘æˆ˜ã€‚</p>
<p>æœ¬æ–‡å°†ä»¥"50ä¸‡ç¬”å·¥èµ„ä»£å‘"ä¸ºå®é™…åœºæ™¯ï¼Œè¯¦ç»†ä»‹ç»å¦‚ä½•ä½¿ç”¨Spring Batchæ¡†æ¶æ¥å¤„ç†å¤§è§„æ¨¡æ‰¹é‡æ•°æ®ï¼Œå¹¶é‡ç‚¹è®²è§£å½“å¤„ç†å¤±è´¥æ—¶ï¼Œå¦‚ä½•å®ç°<strong>éƒ¨åˆ†å›æ»šæœºåˆ¶</strong>ï¼Œç¡®ä¿å·²æˆåŠŸå¤„ç†çš„æ•°æ®ä¸ä¼šå› ä¸ºå°‘é‡å¤±è´¥è®°å½•è€Œå…¨éƒ¨å›æ»šã€‚</p>
<hr/>
<h3 data-id="heading-2">ä¸€ã€ä»€ä¹ˆæ˜¯Spring Batchï¼Ÿ</h3>
<h4 data-id="heading-3">1.1 Spring Batchç®€ä»‹</h4>
<p>Spring Batchæ˜¯ä¸€ä¸ªè½»é‡çº§çš„ã€å…¨é¢çš„æ‰¹å¤„ç†æ¡†æ¶ï¼Œç”±Springå›¢é˜Ÿå¼€å‘ï¼Œæ—¨åœ¨å¸®åŠ©ä¼ä¸šå¼€å‘å¥å£®çš„æ‰¹å¤„ç†åº”ç”¨ç¨‹åºã€‚å®ƒäº2008å¹´é¦–æ¬¡å‘å¸ƒï¼Œç»è¿‡åå¤šå¹´çš„å‘å±•ï¼Œå·²ç»æˆä¸ºJavaæ‰¹å¤„ç†é¢†åŸŸçš„äº‹å®æ ‡å‡†ã€‚</p>
<p>Spring Batchçš„æ ¸å¿ƒè®¾è®¡ç†å¿µåŒ…æ‹¬ï¼š</p>
<ul>
<li><strong>Chunk-oriented Processingï¼ˆå—çº§å¤„ç†ï¼‰</strong>ï¼šå°†å¤§é‡æ•°æ®åˆ†æ‰¹å¤„ç†ï¼Œé¿å…å†…å­˜æº¢å‡º</li>
<li><strong>äº‹åŠ¡ç®¡ç†</strong>ï¼šæ¯ä¸ªChunkä½œä¸ºä¸€ä¸ªç‹¬ç«‹çš„äº‹åŠ¡ï¼Œæ”¯æŒéƒ¨åˆ†å›æ»š</li>
<li><strong>å®¹é”™æœºåˆ¶</strong>ï¼šæ”¯æŒè·³è¿‡ï¼ˆSkipï¼‰ã€é‡è¯•ï¼ˆRetryï¼‰ç­‰å®¹é”™ç­–ç•¥</li>
<li><strong>ä½œä¸šè°ƒåº¦</strong>ï¼šæ”¯æŒå®šæ—¶ä»»åŠ¡ã€æ‰‹åŠ¨è§¦å‘ç­‰å¤šç§è°ƒåº¦æ–¹å¼</li>
<li><strong>ç›‘æ§ä¸ç»Ÿè®¡</strong>ï¼šæä¾›å®Œæ•´çš„æ‰§è¡Œè®°å½•å’Œç»Ÿè®¡ä¿¡æ¯</li>
</ul>
<h4 data-id="heading-4">1.2 æ ¸å¿ƒæ¦‚å¿µè¯¦è§£</h4>
<h5 data-id="heading-5">Jobï¼ˆä½œä¸šï¼‰</h5>
<p>Jobæ˜¯æ‰¹å¤„ç†çš„æ ¸å¿ƒæ¦‚å¿µï¼Œä»£è¡¨ä¸€ä¸ªå®Œæ•´çš„æ‰¹å¤„ç†ä»»åŠ¡ã€‚ä¸€ä¸ªJobå¯ä»¥åŒ…å«å¤šä¸ªStepï¼ŒæŒ‰é¡ºåºæˆ–å¹¶è¡Œæ‰§è¡Œã€‚</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Bean</span>
<span class="hljs-keyword">public</span> Job <span class="hljs-title function_">salaryPaymentJob</span><span class="hljs-params">()</span> {
    <span class="hljs-keyword">return</span> jobBuilderFactory.get(<span class="hljs-string">"salaryPaymentJob"</span>)
        .start(step1())
        .next(step2())
        .build();
}
</code></pre>
<h5 data-id="heading-6">Stepï¼ˆæ­¥éª¤ï¼‰</h5>
<p>Stepæ˜¯Jobçš„åŸºæœ¬æ‰§è¡Œå•å…ƒï¼Œæ¯ä¸ªStepåŒ…å«ï¼š</p>
<ul>
<li><strong>ItemReader</strong>ï¼šè¯»å–æ•°æ®</li>
<li><strong>ItemProcessor</strong>ï¼šå¤„ç†æ•°æ®ï¼ˆå¯é€‰ï¼‰</li>
<li><strong>ItemWriter</strong>ï¼šå†™å…¥æ•°æ®</li>
</ul>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Bean</span>
<span class="hljs-keyword">public</span> Step <span class="hljs-title function_">salaryPaymentStep</span><span class="hljs-params">()</span> {
    <span class="hljs-keyword">return</span> stepBuilderFactory.get(<span class="hljs-string">"salaryPaymentStep"</span>)
        .&lt;SalaryPayment, SalaryPayment&gt;chunk(<span class="hljs-number">1000</span>)
        .reader(reader())
        .processor(processor())
        .writer(writer())
        .build();
}
</code></pre>
<h5 data-id="heading-7">Chunkï¼ˆæ•°æ®å—ï¼‰</h5>
<p>Chunkæ˜¯Spring Batchå¤„ç†æ•°æ®çš„åŸºæœ¬å•ä½ã€‚æ¯æ¬¡ä»Readerè¯»å–æŒ‡å®šæ•°é‡çš„è®°å½•ï¼Œå¤„ç†åä¸€èµ·æäº¤åˆ°æ•°æ®åº“ï¼š</p>
<pre><code class="hljs">è¯»å–1000æ¡ â†’ å¤„ç†1000æ¡ â†’ å†™å…¥1000æ¡ â†’ æäº¤äº‹åŠ¡
</code></pre>
<h4 data-id="heading-8">1.3 åº”ç”¨åœºæ™¯</h4>
<p>Spring Batché€‚ç”¨äºä»¥ä¸‹å…¸å‹åœºæ™¯ï¼š</p>






























<table><thead><tr><th>åœºæ™¯</th><th>æè¿°</th><th>ç¤ºä¾‹</th></tr></thead><tbody><tr><td>æ•°æ®è¿ç§»</td><td>è·¨ç³»ç»Ÿæ•°æ®åŒæ­¥</td><td>ä»æ—§ç³»ç»Ÿè¿ç§»æ•°æ®åˆ°æ–°ç³»ç»Ÿ</td></tr><tr><td>æ•°æ®è½¬æ¢</td><td>ETLè¿‡ç¨‹</td><td>ä»æ•°æ®åº“è¯»å–ã€è½¬æ¢ã€å†™å…¥æ•°æ®ä»“åº“</td></tr><tr><td>æ‰¹é‡å¤„ç†</td><td>å®šæœŸæ‰¹é‡æ“ä½œ</td><td>æœˆåº•å·¥èµ„ä»£å‘ã€é“¶è¡Œå¯¹è´¦</td></tr><tr><td>æŠ¥è¡¨ç”Ÿæˆ</td><td>å®šæœŸç”ŸæˆæŠ¥è¡¨</td><td>æ¯æ—¥äº¤æ˜“æ±‡æ€»æŠ¥è¡¨</td></tr></tbody></table>
<h4 data-id="heading-9">1.4 ä¸å…¶ä»–æ¡†æ¶å¯¹æ¯”</h4>









































<table><thead><tr><th>ç‰¹æ€§</th><th>Spring Batch</th><th>Quartz</th><th>Scheduled Executor</th></tr></thead><tbody><tr><td>æ‰¹é‡å¤„ç†</td><td>âœ… ä¸“ç”¨</td><td>éœ€è¦</td><td>éœ€è¦</td></tr><tr><td>äº‹åŠ¡ç®¡ç†</td><td>âœ… å†…ç½®</td><td>æ— </td><td>æ— </td></tr><tr><td>å®¹é”™æœºåˆ¶</td><td>âœ… å®Œå–„çš„Skip/Retry</td><td>æ— </td><td>æ— </td></tr><tr><td>ç›‘æ§ç»Ÿè®¡</td><td>âœ… æ•°æ®åº“æŒä¹…åŒ–</td><td>åŸºç¡€</td><td>æ— </td></tr><tr><td>å¹¶è¡Œå¤„ç†</td><td>âœ… å¤šç§æ¨¡å¼</td><td>æ— </td><td>åŸºç¡€</td></tr></tbody></table>
<p><strong>ä¸ºä»€ä¹ˆéœ€è¦éƒ¨åˆ†å›æ»šï¼Ÿ</strong></p>
<p>æƒ³è±¡ä¸€ä¸‹ï¼šä½ éœ€è¦å¤„ç†50ä¸‡ç¬”å·¥èµ„ä»£å‘ï¼Œå¦‚æœç¬¬49ä¸‡ç¬”è®°å½•å› ä¸ºé“¶è¡Œå¡å·é”™è¯¯è€Œå¤±è´¥ï¼Œåœ¨æ²¡æœ‰éƒ¨åˆ†å›æ»šæœºåˆ¶çš„æƒ…å†µä¸‹ï¼Œå‰é¢489,999ç¬”å·²æˆåŠŸå¤„ç†çš„æ•°æ®ä¼šå…¨éƒ¨å›æ»šï¼è¿™å¯¹äºä¸šåŠ¡æ¥è¯´æ˜¯ä¸å¯æ¥å—çš„ã€‚</p>
<hr/>
<h3 data-id="heading-10">äºŒã€ç³»ç»Ÿæ¶æ„è®¾è®¡</h3>
<p>ä¸ºäº†å®ç°50ä¸‡ç¬”å·¥èµ„ä»£å‘çš„é«˜æ•ˆå¤„ç†ï¼Œæˆ‘ä»¬è®¾è®¡äº†å¦‚ä¸‹çš„ç³»ç»Ÿæ¶æ„ï¼š</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bcd00eb304e3405bba04e396f8f17e3a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zuo5Lit6aOY6I2h55qE6K6w5b-G:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771026268&amp;x-signature=6U7zJ6OTXz6gkHUmSzFWbDGsk6w%3D" alt="" loading="lazy"/></p>
<p>ä¸Šå›¾å±•ç¤ºäº†Spring Batchå·¥èµ„ä»£å‘ç³»ç»Ÿçš„åˆ†å±‚æ¶æ„ï¼š</p>
<ul>
<li><strong>Webå±‚</strong>ï¼šæä¾›ç›‘æ§é¢æ¿ï¼Œæ”¯æŒJobå¯åŠ¨/åœæ­¢ã€å®æ—¶çŠ¶æ€ç›‘æ§å’Œç»Ÿè®¡ä¿¡æ¯æŸ¥è¯¢</li>
<li><strong>Batchæ§åˆ¶å±‚</strong>ï¼šREST APIæ¥å£ï¼ŒåŒ…å«JobLauncherå’ŒJobRepository</li>
<li><strong>Spring Batchæ ¸å¿ƒå±‚</strong>ï¼šJobâ†’Stepâ†’Chunkçš„å¤„ç†æµç¨‹ï¼ŒåŒ…å«Readerã€Processorã€Writerä¸‰å¤§ç»„ä»¶</li>
<li><strong>æ•°æ®å­˜å‚¨å±‚</strong>ï¼šMySQLæ•°æ®åº“ã€CSVæ–‡ä»¶å’ŒJobæ‰§è¡Œæ—¥å¿—</li>
</ul>
<h4 data-id="heading-11">2.1 æ ¸å¿ƒç»„ä»¶è¯´æ˜</h4>



































<table><thead><tr><th>ç»„ä»¶</th><th>èŒè´£</th><th>å®ç°ç±»</th></tr></thead><tbody><tr><td>Job</td><td>æ•´ä¸ªæ‰¹å¤„ç†ä»»åŠ¡</td><td>SalaryPaymentJob</td></tr><tr><td>Step</td><td>ä»»åŠ¡ä¸­çš„ä¸€ä¸ªæ­¥éª¤</td><td>SalaryPaymentStep</td></tr><tr><td>ItemReader</td><td>æ•°æ®è¯»å–å™¨</td><td>FlatFileItemReaderï¼ˆè¯»å–CSVï¼‰</td></tr><tr><td>ItemProcessor</td><td>æ•°æ®å¤„ç†å™¨</td><td>SalaryPaymentProcessorï¼ˆæ•°æ®éªŒè¯ï¼‰</td></tr><tr><td>ItemWriter</td><td>æ•°æ®å†™å…¥å™¨</td><td>JdbcBatchItemWriterï¼ˆæ‰¹é‡å†™å…¥æ•°æ®åº“ï¼‰</td></tr></tbody></table>
<hr/>
<h3 data-id="heading-12">ä¸‰ã€éƒ¨åˆ†å›æ»šæœºåˆ¶åŸç†</h3>
<h4 data-id="heading-13">3.1 Chunk-Oriented Processing</h4>
<p>Spring Batché‡‡ç”¨**Chunk-Oriented Processingï¼ˆå—çº§å¤„ç†ï¼‰**æ¨¡å¼ï¼Œè¿™æ˜¯å®ç°éƒ¨åˆ†å›æ»šçš„æ ¸å¿ƒæœºåˆ¶ï¼š</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d084688d1ebe463c9652b1ba0d53c668~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zuo5Lit6aOY6I2h55qE6K6w5b-G:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771026268&amp;x-signature=UuFoHlDwgOOpU%2FXE5sMRjhtTvc8%3D" alt="" loading="lazy"/></p>
<p>ä¸Šå›¾å±•ç¤ºäº†Batchå¤„ç†çš„æ ¸å¿ƒæµç¨‹ï¼šReaderè¯»å–æ•°æ® â†’ Processorå¤„ç†éªŒè¯ â†’ Writeræ‰¹é‡å†™å…¥ï¼Œå½¢æˆå®Œæ•´çš„å¤„ç†ç®¡é“ã€‚</p>
<p>å¯¹äº50ä¸‡ç¬”æ•°æ®çš„å¤„ç†ï¼ŒChunkæœºåˆ¶çš„å·¥ä½œæ–¹å¼å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-number">50</span>ä¸‡ç¬”æ•°æ®
    â”‚
    â”œâ”€â–º Chunk <span class="hljs-number">1</span> (<span class="hljs-number">1</span>-<span class="hljs-number">1000</span>ç¬”)   â”€â”€â–º ç‹¬ç«‹äº‹åŠ¡ â”€â”€â–º æˆåŠŸæäº¤
    â”œâ”€â–º Chunk <span class="hljs-number">2</span> (<span class="hljs-number">1001</span>-<span class="hljs-number">2000</span>ç¬”) â”€â”€â–º ç‹¬ç«‹äº‹åŠ¡ â”€â”€â–º æˆåŠŸæäº¤
    â”œâ”€â–º Chunk <span class="hljs-number">3</span> (<span class="hljs-number">2001</span>-<span class="hljs-number">3000</span>ç¬”) â”€â”€â–º ç‹¬ç«‹äº‹åŠ¡ â”€â”€â–º ç¬¬<span class="hljs-number">2500</span>ç¬”å¤±è´¥ â†’ é‡è¯•<span class="hljs-number">3</span>æ¬¡ â†’ è·³è¿‡ â†’ å…¶ä½™<span class="hljs-number">999</span>ç¬”æäº¤
    â”œâ”€â–º Chunk <span class="hljs-number">4</span> (<span class="hljs-number">3001</span>-<span class="hljs-number">4000</span>ç¬”) â”€â”€â–º ç‹¬ç«‹äº‹åŠ¡ â”€â”€â–º æˆåŠŸæäº¤
    ...
    â””â”€â–º Chunk <span class="hljs-number">500</span> (<span class="hljs-number">499001</span>-<span class="hljs-number">500000</span>ç¬”) â”€â”€â–º ç‹¬ç«‹äº‹åŠ¡ â”€â”€â–º æˆåŠŸæäº¤

æœ€ç»ˆç»“æœï¼š<span class="hljs-number">499</span>,<span class="hljs-number">999</span>ç¬”æˆåŠŸï¼Œ<span class="hljs-number">1</span>ç¬”è¢«è·³è¿‡
</code></pre>
<p><strong>å…³é”®é…ç½®ï¼š</strong></p>
<ul>
<li><strong>chunkSize</strong>: 1000ï¼ˆæ¯1000ç¬”æäº¤ä¸€æ¬¡ï¼‰</li>
<li><strong>skipLimit</strong>: 100ï¼ˆæœ€å¤šè·³è¿‡100ç¬”å¤±è´¥è®°å½•ï¼‰</li>
<li><strong>retryLimit</strong>: 3ï¼ˆæ¯ç¬”å¤±è´¥é‡è¯•3æ¬¡ï¼‰</li>
</ul>
<h4 data-id="heading-14">3.2 äº‹åŠ¡è¾¹ç•Œä¸éƒ¨åˆ†å›æ»š</h4>
<p>æ¯ä¸ªChunkæ˜¯ç‹¬ç«‹çš„äº‹åŠ¡å•å…ƒï¼Œè¿™æ˜¯å®ç°éƒ¨åˆ†å›æ»šçš„å…³é”®ï¼š</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a3cadc7def044954ab96efb3b4f174c1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zuo5Lit6aOY6I2h55qE6K6w5b-G:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771026268&amp;x-signature=tDesgDqGrq9SQu7Kbxsq%2FXq2ljQ%3D" alt="" loading="lazy"/></p>
<p>ä¸Šå›¾æ¸…æ™°åœ°å±•ç¤ºäº†äº‹åŠ¡è¾¹ç•Œå’Œéƒ¨åˆ†å›æ»šçš„å·¥ä½œæœºåˆ¶ï¼š</p>
<p><strong>äº‹åŠ¡è§„åˆ™ï¼š</strong></p>
<ul>
<li>Chunkå†…ä»»æ„è®°å½•å¤±è´¥ â†’ æ•´ä¸ªChunkå›æ»š</li>
<li>é‡è¯•æˆåŠŸ â†’ ç»§ç»­å¤„ç†</li>
<li>é‡è¯•å¤±è´¥ä¸”å¯è·³è¿‡ â†’ è·³è¿‡è¯¥è®°å½•ï¼Œç»§ç»­å¤„ç†Chunkå†…å‰©ä½™è®°å½•</li>
<li>è·³è¿‡æ¬¡æ•°è¶…é™ â†’ æ•´ä¸ªJobå¤±è´¥</li>
</ul>
<p><strong>å®é™…æ¡ˆä¾‹ï¼š</strong>
å‡è®¾Chunk 3ä¸­æœ‰1000ç¬”æ•°æ®ï¼Œç¬¬500ç¬”éªŒè¯å¤±è´¥ï¼š</p>
<ol>
<li>Spring Batchå›æ»šæ•´ä¸ªChunk 3</li>
<li>é‡æ–°è¯»å–Chunk 3çš„1000ç¬”æ•°æ®</li>
<li>å¤„ç†åˆ°ç¬¬500ç¬”æ—¶ï¼Œæ•è·å¼‚å¸¸</li>
<li>é‡è¯•3æ¬¡åä»ç„¶å¤±è´¥</li>
<li>æ£€æŸ¥æ˜¯å¦å¯è·³è¿‡ï¼ˆIllegalArgumentExceptionåœ¨è·³è¿‡åˆ—è¡¨ä¸­ï¼‰</li>
<li>è·³è¿‡ç¬¬500ç¬”ï¼Œç»§ç»­å¤„ç†501-1000ç¬”</li>
<li>æœ€ç»ˆChunk 3æˆåŠŸæäº¤999ç¬”ï¼Œ1ç¬”è¢«è·³è¿‡</li>
</ol>
<h4 data-id="heading-15">3.3 å®¹é”™ç­–ç•¥é…ç½®</h4>
<pre><code class="hljs language-java" lang="java">.faultTolerant()                    <span class="hljs-comment">// å¯ç”¨å®¹é”™</span>
    .skipLimit(<span class="hljs-number">100</span>)                 <span class="hljs-comment">// æœ€å¤šè·³è¿‡100æ¡</span>
    .skip(IllegalArgumentException.class)    <span class="hljs-comment">// è·³è¿‡æ•°æ®éªŒè¯å¼‚å¸¸</span>
    .skip(NullPointerException.class)        <span class="hljs-comment">// è·³è¿‡ç©ºæŒ‡é’ˆå¼‚å¸¸</span>
    .retryLimit(<span class="hljs-number">3</span>)                  <span class="hljs-comment">// å¤±è´¥é‡è¯•3æ¬¡</span>
    .retry(Exception.class)         <span class="hljs-comment">// é‡è¯•æ‰€æœ‰å¼‚å¸¸</span>
</code></pre>
<hr/>
<h3 data-id="heading-16">å››ã€50ä¸‡ç¬”å·¥èµ„ä»£å‘æ•°æ®å¤„ç†æµç¨‹</h3>
<p>åœ¨ç†è§£äº†éƒ¨åˆ†å›æ»šæœºåˆ¶åï¼Œæˆ‘ä»¬æ¥çœ‹å®Œæ•´çš„å·¥èµ„ä»£å‘æ•°æ®å¤„ç†æµç¨‹ï¼š</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d8b9318892e8425abf7d289b608db5bc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zuo5Lit6aOY6I2h55qE6K6w5b-G:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771026268&amp;x-signature=SIsXxsWk3rb%2BjcCk4aE465G5rXg%3D" alt="" loading="lazy"/></p>
<p>ä¸Šå›¾å±•ç¤ºäº†ä»CSVæ–‡ä»¶è¯»å–åˆ°æ•°æ®åº“å†™å…¥çš„å®Œæ•´æ•°æ®æµï¼ŒåŒ…å«ä»¥ä¸‹å…³é”®æ­¥éª¤ï¼š</p>
<ol>
<li><strong>æ•°æ®è¯»å–</strong>ï¼šFlatFileItemReaderè¯»å–CSVæ–‡ä»¶ï¼Œæ¯è¡Œæ˜ å°„ä¸ºSalaryPaymentå¯¹è±¡</li>
<li><strong>æ•°æ®éªŒè¯</strong>ï¼šSalaryPaymentProcessorè¿›è¡Œæ•°æ®æ ¡éªŒ
<ul>
<li>å‘˜å·¥IDéç©ºéªŒè¯</li>
<li>é‡‘é¢èŒƒå›´éªŒè¯ï¼ˆ0.01-100ä¸‡ï¼‰</li>
<li>é“¶è¡Œå¡å·æ ¼å¼éªŒè¯ï¼ˆ16-19ä½æ•°å­—ï¼‰</li>
</ul>
</li>
<li><strong>çŠ¶æ€æ›´æ–°</strong>ï¼šè®¾ç½®çŠ¶æ€ä¸ºPROCESSINGï¼Œç”Ÿæˆå”¯ä¸€äº¤æ˜“ID</li>
<li><strong>æ‰¹é‡å†™å…¥</strong>ï¼šJdbcBatchItemWriteræ‰¹é‡å†™å…¥æ•°æ®åº“</li>
<li><strong>å¼‚å¸¸å¤„ç†</strong>ï¼šéªŒè¯å¤±è´¥çš„è®°å½•è¢«è·³è¿‡ï¼Œè®°å½•åˆ°å¤±è´¥åˆ—è¡¨</li>
</ol>
<hr/>
<h3 data-id="heading-17">äº”ã€æ ¸å¿ƒä»£ç å®ç°</h3>
<h4 data-id="heading-18">5.1 Jobé…ç½®</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Configuration</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SalaryPaymentJobConfig</span> {

    <span class="hljs-meta">@Value("${batch.chunk.size:1000}")</span>
    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> chunkSize;  <span class="hljs-comment">// æ¯æ¬¡å¤„ç†çš„è®°å½•æ•°</span>

    <span class="hljs-meta">@Value("${batch.skip.limit:100}")</span>
    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> skipLimit;  <span class="hljs-comment">// è·³è¿‡é™åˆ¶</span>

    <span class="hljs-meta">@Value("${batch.retry.limit:3}")</span>
    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> retryLimit; <span class="hljs-comment">// é‡è¯•æ¬¡æ•°</span>

    <span class="hljs-meta">@Bean</span>
    <span class="hljs-keyword">public</span> Step <span class="hljs-title function_">salaryPaymentStep</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> stepBuilderFactory
            .get(<span class="hljs-string">"salaryPaymentStep"</span>)
            .&lt;SalaryPayment, SalaryPayment&gt;chunk(chunkSize)
            .reader(salaryPaymentReader())
            .processor(salaryPaymentProcessor())
            .writer(salaryPaymentWriter())
            .faultTolerant()  <span class="hljs-comment">// å¯ç”¨å®¹é”™</span>
            .skipLimit(skipLimit)
            .skip(IllegalArgumentException.class)
            .skip(NullPointerException.class)
            .retryLimit(retryLimit)
            .retry(Exception.class)
            .listener(<span class="hljs-keyword">new</span> <span class="hljs-title class_">SalaryItemReadListener</span>())
            .listener(<span class="hljs-keyword">new</span> <span class="hljs-title class_">SalaryItemWriteListener</span>())
            .build();
    }

    <span class="hljs-meta">@Bean</span>
    <span class="hljs-keyword">public</span> Job <span class="hljs-title function_">salaryPaymentJob</span><span class="hljs-params">(Step step, SalaryJobExecutionListener listener)</span> {
        <span class="hljs-keyword">return</span> jobBuilderFactory.get(<span class="hljs-string">"salaryPaymentJob"</span>)
            .incrementer(<span class="hljs-keyword">new</span> <span class="hljs-title class_">RunIdIncrementer</span>())
            .listener(listener)
            .start(step)
            .build();
    }
}
</code></pre>
<h4 data-id="heading-19">5.2 æ•°æ®è¯»å–å™¨</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Bean</span>
<span class="hljs-keyword">public</span> FlatFileItemReader&lt;SalaryPayment&gt; <span class="hljs-title function_">salaryPaymentReader</span><span class="hljs-params">()</span> {
    FlatFileItemReader&lt;SalaryPayment&gt; reader = <span class="hljs-keyword">new</span> <span class="hljs-title class_">FlatFileItemReader</span>&lt;&gt;();
    reader.setName(<span class="hljs-string">"salaryPaymentReader"</span>);
    reader.setResource(<span class="hljs-keyword">new</span> <span class="hljs-title class_">ClassPathResource</span>(<span class="hljs-string">"input/salary-payments.csv"</span>));
    reader.setLinesToSkip(<span class="hljs-number">1</span>);  <span class="hljs-comment">// è·³è¿‡CSVæ ‡é¢˜è¡Œ</span>

    <span class="hljs-comment">// è®¾ç½®åˆ—æ˜ å°„</span>
    <span class="hljs-type">DelimitedLineTokenizer</span> <span class="hljs-variable">tokenizer</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">DelimitedLineTokenizer</span>();
    tokenizer.setNames(<span class="hljs-keyword">new</span> <span class="hljs-title class_">String</span>[]{
        <span class="hljs-string">"employeeId"</span>, <span class="hljs-string">"employeeName"</span>, <span class="hljs-string">"accountNumber"</span>,
        <span class="hljs-string">"accountName"</span>, <span class="hljs-string">"bankName"</span>, <span class="hljs-string">"amount"</span>, <span class="hljs-string">"currency"</span>,
        <span class="hljs-string">"paymentDate"</span>, <span class="hljs-string">"remark"</span>
    });

    <span class="hljs-comment">// è®¾ç½®å­—æ®µæ˜ å°„</span>
    BeanWrapperFieldSetMapper&lt;SalaryPayment&gt; mapper = <span class="hljs-keyword">new</span> <span class="hljs-title class_">BeanWrapperFieldSetMapper</span>&lt;&gt;();
    mapper.setTargetType(SalaryPayment.class);

    DefaultLineMapper&lt;SalaryPayment&gt; lineMapper = <span class="hljs-keyword">new</span> <span class="hljs-title class_">DefaultLineMapper</span>&lt;&gt;();
    lineMapper.setLineTokenizer(tokenizer);
    lineMapper.setFieldSetMapper(mapper);
    reader.setLineMapper(lineMapper);

    <span class="hljs-keyword">return</span> reader;
}
</code></pre>
<h4 data-id="heading-20">5.3 æ•°æ®å¤„ç†å™¨ï¼ˆéªŒè¯é€»è¾‘ï¼‰</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SalaryPaymentProcessor</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">ItemProcessor</span>&lt;SalaryPayment, SalaryPayment&gt; {

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">BigDecimal</span> <span class="hljs-variable">MIN_AMOUNT</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BigDecimal</span>(<span class="hljs-string">"0.01"</span>);
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">BigDecimal</span> <span class="hljs-variable">MAX_AMOUNT</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BigDecimal</span>(<span class="hljs-string">"1000000"</span>);

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> SalaryPayment <span class="hljs-title function_">process</span><span class="hljs-params">(SalaryPayment item)</span> <span class="hljs-keyword">throws</span> Exception {
        <span class="hljs-comment">// 1. æ•°æ®éªŒè¯</span>
        <span class="hljs-keyword">if</span> (item.getEmployeeId() == <span class="hljs-literal">null</span> || item.getEmployeeId().trim().isEmpty()) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalArgumentException</span>(<span class="hljs-string">"å‘˜å·¥IDä¸èƒ½ä¸ºç©º"</span>);
        }

        <span class="hljs-comment">// 2. é‡‘é¢éªŒè¯</span>
        <span class="hljs-keyword">if</span> (item.getAmount() == <span class="hljs-literal">null</span>) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalArgumentException</span>(<span class="hljs-string">"å‘æ”¾é‡‘é¢ä¸èƒ½ä¸ºç©º"</span>);
        }
        <span class="hljs-keyword">if</span> (item.getAmount().compareTo(MIN_AMOUNT) &lt; <span class="hljs-number">0</span>) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalArgumentException</span>(<span class="hljs-string">"å‘æ”¾é‡‘é¢ä¸èƒ½å°äº0.01å…ƒ"</span>);
        }
        <span class="hljs-keyword">if</span> (item.getAmount().compareTo(MAX_AMOUNT) &gt; <span class="hljs-number">0</span>) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalArgumentException</span>(<span class="hljs-string">"å‘æ”¾é‡‘é¢ä¸èƒ½å¤§äº100ä¸‡å…ƒ"</span>);
        }

        <span class="hljs-comment">// 3. é“¶è¡Œå¡å·éªŒè¯</span>
        <span class="hljs-keyword">if</span> (item.getAccountNumber() == <span class="hljs-literal">null</span> ||
            item.getAccountNumber().length() &lt; <span class="hljs-number">16</span> ||
            item.getAccountNumber().length() &gt; <span class="hljs-number">19</span>) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalArgumentException</span>(<span class="hljs-string">"é“¶è¡Œè´¦å·é•¿åº¦å¿…é¡»åœ¨16-19ä½ä¹‹é—´"</span>);
        }

        <span class="hljs-comment">// 4. è®¾ç½®å¤„ç†çŠ¶æ€</span>
        item.setStatus(<span class="hljs-string">"PROCESSING"</span>);
        item.setTransactionId(<span class="hljs-string">"SAL"</span> + System.currentTimeMillis() + item.getEmployeeId());

        <span class="hljs-keyword">return</span> item;
    }
}
</code></pre>
<h4 data-id="heading-21">5.4 æ•°æ®å†™å…¥å™¨</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SalaryPaymentWriter</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">ItemWriter</span>&lt;SalaryPayment&gt; {

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> JdbcBatchItemWriter&lt;SalaryPayment&gt; delegate;

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">SalaryPaymentWriter</span><span class="hljs-params">(DataSource dataSource)</span> {
        <span class="hljs-built_in">this</span>.delegate = <span class="hljs-keyword">new</span> <span class="hljs-title class_">JdbcBatchItemWriter</span>&lt;&gt;();
        <span class="hljs-built_in">this</span>.delegate.setDataSource(dataSource);
        <span class="hljs-built_in">this</span>.delegate.setSql(
            <span class="hljs-string">"INSERT INTO salary_payment "</span> +
            <span class="hljs-string">"(employee_id, employee_name, account_number, account_name, "</span> +
            <span class="hljs-string">"bank_name, amount, currency, payment_date, remark, "</span> +
            <span class="hljs-string">"status, transaction_id, create_time, update_time) "</span> +
            <span class="hljs-string">"VALUES (:employeeId, :employeeName, :accountNumber, :accountName, "</span> +
            <span class="hljs-string">":bankName, :amount, :currency, :paymentDate, :remark, "</span> +
            <span class="hljs-string">":status, :transactionId, :createTime, :updateTime)"</span>);
        <span class="hljs-built_in">this</span>.delegate.setItemSqlParameterSourceProvider(
            <span class="hljs-keyword">new</span> <span class="hljs-title class_">BeanPropertyItemSqlParameterSourceProvider</span>&lt;&gt;()
        );
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">write</span><span class="hljs-params">(List&lt;? extends SalaryPayment&gt; items)</span> <span class="hljs-keyword">throws</span> Exception {
        delegate.write(items);
    }
}
</code></pre>
<h4 data-id="heading-22">5.5 è‡ªå®šä¹‰SkipPolicy</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Component</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">PartialRollbackHandler</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">SkipPolicy</span> {

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">SKIP_LIMIT</span> <span class="hljs-operator">=</span> <span class="hljs-number">100</span>;

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">shouldSkip</span><span class="hljs-params">(Throwable throwable, <span class="hljs-type">int</span> skipCount)</span> {
        <span class="hljs-comment">// è¶…è¿‡è·³è¿‡é™åˆ¶</span>
        <span class="hljs-keyword">if</span> (skipCount &gt;= SKIP_LIMIT) {
            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
        }

        <span class="hljs-comment">// æ–‡ä»¶ä¸å­˜åœ¨ï¼Œä¸èƒ½è·³è¿‡</span>
        <span class="hljs-keyword">if</span> (throwable <span class="hljs-keyword">instanceof</span> FileNotFoundException) {
            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
        }

        <span class="hljs-comment">// æ•°æ®æ ¼å¼é”™è¯¯ï¼Œå¯ä»¥è·³è¿‡</span>
        <span class="hljs-keyword">if</span> (throwable <span class="hljs-keyword">instanceof</span> FlatFileParseException) {
            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
        }

        <span class="hljs-comment">// æ•°æ®éªŒè¯å¤±è´¥ï¼Œå¯ä»¥è·³è¿‡</span>
        <span class="hljs-keyword">if</span> (throwable <span class="hljs-keyword">instanceof</span> IllegalArgumentException ||
            throwable <span class="hljs-keyword">instanceof</span> NullPointerException) {
            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
        }

        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
    }
}
</code></pre>
<hr/>
<h3 data-id="heading-23">å…­ã€ç›‘æ§ä¸è°ƒåº¦æ¶æ„</h3>
<p>é™¤äº†æ•°æ®å¤„ç†ï¼ŒSpring Batchè¿˜æä¾›äº†å®Œå–„çš„ç›‘æ§å’Œè°ƒåº¦èƒ½åŠ›ï¼š</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/75d4b1910c2744e1ae48875ce1ce6e31~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zuo5Lit6aOY6I2h55qE6K6w5b-G:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771026268&amp;x-signature=6ByRneA25pJ%2BsYmXWs9B49dsOdQ%3D" alt="" loading="lazy"/></p>
<p>ä¸Šå›¾å±•ç¤ºäº†å®Œæ•´çš„ç›‘æ§ä¸è°ƒåº¦æ¶æ„ï¼š</p>
<p><strong>è°ƒåº¦å±‚</strong>ï¼šæ”¯æŒä¸‰ç§è°ƒåº¦æ–¹å¼</p>
<ul>
<li>Quartzè°ƒåº¦å™¨ï¼šæ”¯æŒåˆ†å¸ƒå¼è°ƒåº¦ï¼Œé€‚åˆé›†ç¾¤ç¯å¢ƒ</li>
<li>Spring Taskè°ƒåº¦ï¼šç®€å•çš„å®šæ—¶ä»»åŠ¡ï¼Œè½»é‡çº§é€‰æ‹©</li>
<li>Cronè¡¨è¾¾å¼ï¼šçµæ´»çš„æ—¶é—´é…ç½®</li>
</ul>
<p><strong>æ‰§è¡Œå±‚</strong>ï¼šæ ¸å¿ƒæ‰§è¡Œç»„ä»¶</p>
<ul>
<li>JobLauncherï¼šå¯åŠ¨ä½œä¸šï¼Œåˆ›å»ºæ‰§è¡Œä¸Šä¸‹æ–‡</li>
<li>JobOperatorï¼šæ“ä½œä½œä¸šï¼Œæ”¯æŒåœæ­¢/é‡å¯/é‡è¯•</li>
<li>StepExecutionï¼šæ­¥éª¤æ‰§è¡Œï¼Œé‡‡ç”¨Chunkå¤„ç†æ¨¡å¼</li>
<li>ThreadPoolExecutorï¼šçº¿ç¨‹æ± ï¼Œå®ç°å¹¶å‘å¤„ç†</li>
</ul>
<p><strong>ç›‘æ§å±‚</strong>ï¼šç›‘æ§ä¸ç»Ÿè®¡</p>
<ul>
<li>JobRepositoryï¼šå­˜å‚¨å…ƒæ•°æ®ï¼ˆBATCH_JOB_INSTANCEã€BATCH_JOB_EXECUTIONã€BATCH_STEP_EXECUTIONï¼‰</li>
<li>JobExplorerï¼šæŸ¥è¯¢ä½œä¸šçŠ¶æ€ã€è·å–æ‰§è¡Œå†å²</li>
<li>Metricsï¼šå¤„ç†è®°å½•æ•°ã€æ‰§è¡Œæ—¶é—´ã€å¤±è´¥ç‡ç»Ÿè®¡</li>
</ul>
<p><strong>æ•°æ®å±‚</strong>ï¼šæ•°æ®å­˜å‚¨</p>
<ul>
<li>MySQL 8.0ï¼šå­˜å‚¨å…ƒæ•°æ®è¡¨ã€ä¸šåŠ¡æ•°æ®è¡¨ã€æ—¥å¿—è®°å½•</li>
<li>Redisç¼“å­˜ï¼šæ‰§è¡ŒçŠ¶æ€ç¼“å­˜ã€è®¡æ•°å™¨ã€åˆ†å¸ƒå¼é”</li>
</ul>
<hr/>
<h3 data-id="heading-24">ä¸ƒã€æ•°æ®åº“è®¾è®¡</h3>
<h4 data-id="heading-25">7.1 å·¥èµ„ä»£å‘è¡¨</h4>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> salary_payment (
    id <span class="hljs-type">BIGINT</span> AUTO_INCREMENT <span class="hljs-keyword">PRIMARY</span> KEY,
    employee_id <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">50</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'å‘˜å·¥ID'</span>,
    employee_name <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">100</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'å‘˜å·¥å§“å'</span>,
    account_number <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">50</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'é“¶è¡Œè´¦å·'</span>,
    account_name <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">100</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'è´¦æˆ·åç§°'</span>,
    bank_name <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">100</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'å¼€æˆ·è¡Œ'</span>,
    amount <span class="hljs-type">DECIMAL</span>(<span class="hljs-number">18</span>,<span class="hljs-number">2</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'å‘æ”¾é‡‘é¢'</span>,
    currency <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">10</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-string">'CNY'</span> COMMENT <span class="hljs-string">'å¸ç§'</span>,
    payment_date DATETIME <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'å‘æ”¾æ—¥æœŸ'</span>,
    remark <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">500</span>) COMMENT <span class="hljs-string">'å¤‡æ³¨'</span>,
    status <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">20</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-string">'PENDING'</span> COMMENT <span class="hljs-string">'çŠ¶æ€'</span>,
    transaction_id <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">100</span>) COMMENT <span class="hljs-string">'äº¤æ˜“ID'</span>,
    error_message <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">1000</span>) COMMENT <span class="hljs-string">'é”™è¯¯ä¿¡æ¯'</span>,
    create_time DATETIME <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span>,
    update_time DATETIME <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span> <span class="hljs-keyword">ON</span> <span class="hljs-keyword">UPDATE</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span>,
    INDEX idx_employee_id (employee_id),
    INDEX idx_status (status)
) ENGINE<span class="hljs-operator">=</span>InnoDB <span class="hljs-keyword">DEFAULT</span> CHARSET<span class="hljs-operator">=</span>utf8mb4;
</code></pre>
<h4 data-id="heading-26">7.2 Spring Batchå…ƒè¡¨</h4>
<p>Spring Batchæ¡†æ¶ä¼šè‡ªåŠ¨åˆ›å»ºä»¥ä¸‹å…ƒè¡¨æ¥å­˜å‚¨Jobæ‰§è¡Œä¿¡æ¯ï¼š</p>
<ul>
<li><code>batch_job_instance</code> - Jobå®ä¾‹è¡¨</li>
<li><code>batch_job_execution</code> - Jobæ‰§è¡Œè¡¨</li>
<li><code>batch_job_execution_params</code> - Jobå‚æ•°è¡¨</li>
<li><code>batch_step_execution</code> - Stepæ‰§è¡Œè¡¨</li>
<li><code>batch_step_execution_context</code> - Stepä¸Šä¸‹æ–‡è¡¨</li>
</ul>
<hr/>
<h3 data-id="heading-27">å…«ã€REST APIè®¾è®¡</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@RestController</span>
<span class="hljs-meta">@RequestMapping("/api/batch")</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">BatchJobController</span> {

    <span class="hljs-comment">// å¯åŠ¨Job</span>
    <span class="hljs-meta">@PostMapping("/start")</span>
    <span class="hljs-keyword">public</span> ResponseEntity&lt;Map&lt;String, Object&gt;&gt; <span class="hljs-title function_">startJob</span><span class="hljs-params">(
        <span class="hljs-meta">@RequestParam</span> String inputFile
    )</span> {
        <span class="hljs-type">JobParameters</span> <span class="hljs-variable">params</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">JobParametersBuilder</span>()
            .addLong(<span class="hljs-string">"startTime"</span>, System.currentTimeMillis())
            .addString(<span class="hljs-string">"inputFile"</span>, inputFile)
            .toJobParameters();
        <span class="hljs-type">JobExecution</span> <span class="hljs-variable">execution</span> <span class="hljs-operator">=</span> jobLauncher.run(salaryPaymentJob, params);
        <span class="hljs-keyword">return</span> ResponseEntity.ok(result);
    }

    <span class="hljs-comment">// è·å–JobçŠ¶æ€</span>
    <span class="hljs-meta">@GetMapping("/status/{jobExecutionId}")</span>
    <span class="hljs-keyword">public</span> ResponseEntity&lt;Map&lt;String, Object&gt;&gt; <span class="hljs-title function_">getJobStatus</span><span class="hljs-params">(
        <span class="hljs-meta">@PathVariable</span> Long jobExecutionId
    )</span> {
        <span class="hljs-type">JobExecution</span> <span class="hljs-variable">execution</span> <span class="hljs-operator">=</span> jobRepository.getJobExecution(jobExecutionId);
        <span class="hljs-comment">// è¿”å›æ‰§è¡Œè¯¦æƒ…</span>
    }

    <span class="hljs-comment">// åœæ­¢Job</span>
    <span class="hljs-meta">@PostMapping("/stop/{jobExecutionId}")</span>
    <span class="hljs-keyword">public</span> ResponseEntity&lt;Map&lt;String, Object&gt;&gt; <span class="hljs-title function_">stopJob</span><span class="hljs-params">(
        <span class="hljs-meta">@PathVariable</span> Long jobExecutionId
    )</span> {
        <span class="hljs-type">JobExecution</span> <span class="hljs-variable">execution</span> <span class="hljs-operator">=</span> jobRepository.getJobExecution(jobExecutionId);
        execution.stop();
        <span class="hljs-keyword">return</span> ResponseEntity.ok(result);
    }

    <span class="hljs-comment">// è·å–ç»Ÿè®¡ä¿¡æ¯</span>
    <span class="hljs-meta">@GetMapping("/statistics")</span>
    <span class="hljs-keyword">public</span> ResponseEntity&lt;Map&lt;String, Object&gt;&gt; <span class="hljs-title function_">getStatistics</span><span class="hljs-params">()</span> {
        <span class="hljs-comment">// è¿”å›æ€»æ•°ã€æˆåŠŸæ•°ã€å¤±è´¥æ•°ç­‰ç»Ÿè®¡</span>
    }

    <span class="hljs-comment">// å¥åº·æ£€æŸ¥</span>
    <span class="hljs-meta">@GetMapping("/health")</span>
    <span class="hljs-keyword">public</span> ResponseEntity&lt;Map&lt;String, Object&gt;&gt; <span class="hljs-title function_">health</span><span class="hljs-params">()</span> {
        <span class="hljs-comment">// è¿”å›ç³»ç»Ÿå¥åº·çŠ¶æ€</span>
    }
}
</code></pre>
<hr/>
<h3 data-id="heading-28">ä¹ã€æ€§èƒ½ä¼˜åŒ–ä¸å¹¶è¡Œå¤„ç†</h3>
<p>å½“æ•°æ®é‡è¾¾åˆ°50ä¸‡ç”šè‡³æ›´å¤šæ—¶ï¼Œå•çº¿ç¨‹å¤„ç†å¯èƒ½æˆä¸ºç“¶é¢ˆã€‚Spring Batchæä¾›äº†å¤šç§å¹¶è¡Œå¤„ç†æ–¹å¼ã€‚</p>
<h4 data-id="heading-29">9.1 å¤šçº¿ç¨‹å¹¶å‘å¤„ç†</h4>
<p>Spring Batchæ”¯æŒå¤šçº¿ç¨‹å¹¶å‘å¤„ç†ï¼Œå¤§å¹…æå‡å¤„ç†æ•ˆç‡ï¼š</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/316e23bab05d4fe596fe18021513b6c8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zuo5Lit6aOY6I2h55qE6K6w5b-G:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771026268&amp;x-signature=0BkUFvIWBtjJgwbQoXjOKq2s7MQ%3D" alt="" loading="lazy"/></p>
<p>ä¸Šå›¾å±•ç¤ºäº†å¤šçº¿ç¨‹å¹¶å‘å¤„ç†çš„å·¥ä½œåŸç†ï¼š</p>
<p><strong>æ ¸å¿ƒæœºåˆ¶ï¼š</strong></p>
<ul>
<li><strong>ä¸»çº¿ç¨‹</strong>ï¼šåˆ›å»ºçº¿ç¨‹æ± ï¼Œåˆ†é…ä»»åŠ¡</li>
<li><strong>å·¥ä½œçº¿ç¨‹</strong>ï¼šå¹¶å‘æ‰§è¡Œå¤šä¸ªStepæˆ–Chunk</li>
<li><strong>çº¿ç¨‹å®‰å…¨</strong>ï¼šJobRepositoryä¿è¯çº¿ç¨‹å®‰å…¨çš„çŠ¶æ€ç®¡ç†</li>
<li><strong>è´Ÿè½½å‡è¡¡</strong>ï¼šä»»åŠ¡å‡åŒ€åˆ†é…åˆ°å„ä¸ªçº¿ç¨‹</li>
</ul>
<p><strong>é…ç½®ç¤ºä¾‹ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Bean</span>
<span class="hljs-keyword">public</span> TaskExecutor <span class="hljs-title function_">taskExecutor</span><span class="hljs-params">()</span> {
    <span class="hljs-type">ThreadPoolTaskExecutor</span> <span class="hljs-variable">executor</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ThreadPoolTaskExecutor</span>();
    executor.setCorePoolSize(<span class="hljs-number">5</span>);
    executor.setMaxPoolSize(<span class="hljs-number">10</span>);
    executor.setQueueCapacity(<span class="hljs-number">100</span>);
    executor.setThreadNamePrefix(<span class="hljs-string">"salary-batch-"</span>);
    executor.initialize();
    <span class="hljs-keyword">return</span> executor;
}

<span class="hljs-comment">// åœ¨Stepä¸­ä½¿ç”¨</span>
.step(stepName)
.chunk(chunkSize)
.taskExecutor(taskExecutor())
.throttleLimit(<span class="hljs-number">10</span>)  <span class="hljs-comment">// é™åˆ¶å¹¶å‘æ•°</span>
.build();
</code></pre>
<h4 data-id="heading-30">9.2 åˆ†åŒºå¤„ç†ï¼ˆPartitioningï¼‰</h4>
<p>å¯¹äºè¶…å¤§æ•°æ®é›†ï¼Œå¯ä»¥ä½¿ç”¨åˆ†åŒºå¤„ç†å®ç°æ›´é«˜ç¨‹åº¦çš„å¹¶è¡Œï¼š</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2f2a8815f01144f197a00ba5ad2c0802~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zuo5Lit6aOY6I2h55qE6K6w5b-G:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771026268&amp;x-signature=9I%2BjxPUBFL%2B5Vi3qT9oI4Xub9sM%3D" alt="" loading="lazy"/></p>
<p>ä¸Šå›¾å±•ç¤ºäº†åˆ†åŒºå¤„ç†çš„æ¶æ„ï¼š</p>
<p><strong>æ ¸å¿ƒç»„ä»¶ï¼š</strong></p>
<ul>
<li><strong>Master Step</strong>ï¼šè´Ÿè´£åˆ›å»ºå’Œç®¡ç†åˆ†åŒº</li>
<li><strong>Slave Step</strong>ï¼šæ¯ä¸ªåˆ†åŒºç‹¬ç«‹æ‰§è¡Œ</li>
<li><strong>Partitioner</strong>ï¼šå°†æ•°æ®åˆ†æˆå¤šä¸ªåˆ†åŒº</li>
<li><strong>TaskExecutor</strong>ï¼šçº¿ç¨‹æ± æ‰§è¡Œåˆ†åŒºä»»åŠ¡</li>
</ul>
<p><strong>é…ç½®ç¤ºä¾‹ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Bean</span>
<span class="hljs-keyword">public</span> Step <span class="hljs-title function_">masterStep</span><span class="hljs-params">()</span> {
    <span class="hljs-keyword">return</span> stepBuilderFactory.get(<span class="hljs-string">"masterStep"</span>)
        .partitioner(slaveStep().getName(), rangePartitioner(<span class="hljs-number">1</span>, <span class="hljs-number">10</span>))
        .step(slaveStep())
        .gridSize(<span class="hljs-number">10</span>)  <span class="hljs-comment">// åˆ†æˆ10ä¸ªåˆ†åŒº</span>
        .taskExecutor(taskExecutor())
        .build();
}

<span class="hljs-meta">@Bean</span>
<span class="hljs-keyword">public</span> Partitioner <span class="hljs-title function_">rangePartitioner</span><span class="hljs-params">(<span class="hljs-type">int</span> min, <span class="hljs-type">int</span> max)</span> {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Partitioner</span>() {
        <span class="hljs-meta">@Override</span>
        <span class="hljs-keyword">public</span> Map&lt;String, ExecutionContext&gt; <span class="hljs-title function_">partition</span><span class="hljs-params">(<span class="hljs-type">int</span> gridSize)</span> {
            Map&lt;String, ExecutionContext&gt; result = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();
            <span class="hljs-type">int</span> <span class="hljs-variable">range</span> <span class="hljs-operator">=</span> (max - min) / gridSize;
            <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; gridSize; i++) {
                <span class="hljs-type">ExecutionContext</span> <span class="hljs-variable">context</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ExecutionContext</span>();
                context.putInt(<span class="hljs-string">"minValue"</span>, min + i * range);
                context.putInt(<span class="hljs-string">"maxValue"</span>, min + (i + <span class="hljs-number">1</span>) * range - <span class="hljs-number">1</span>);
                result.put(<span class="hljs-string">"partition"</span> + i, context);
            }
            <span class="hljs-keyword">return</span> result;
        }
    };
}
</code></pre>
<h4 data-id="heading-31">9.3 è°ƒä¼˜å‚æ•°</h4>






























<table><thead><tr><th>å‚æ•°</th><th>æ¨èå€¼</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>chunkSize</td><td>1000-5000</td><td>æ ¹æ®è®°å½•å¤§å°è°ƒæ•´ï¼Œè¶Šå¤§ååé‡è¶Šé«˜ä½†å†…å­˜å ç”¨ä¹Ÿè¶Šå¤§</td></tr><tr><td>skipLimit</td><td>100-500</td><td>æ ¹æ®æ•°æ®è´¨é‡è®¾ç½®</td></tr><tr><td>retryLimit</td><td>3-5</td><td>è¿‡å¤šä¼šæµªè´¹æ—¶é—´ï¼Œè¿‡å°‘å¯èƒ½è¯¯åˆ¤æš‚æ—¶æ€§æ•…éšœ</td></tr><tr><td>çº¿ç¨‹æ± å¤§å°</td><td>CPUæ ¸å¿ƒæ•°*2</td><td>ç”¨äºå¤šçº¿ç¨‹å¤„ç†</td></tr></tbody></table>
<h4 data-id="heading-32">9.4 æ‰¹é‡å†™å…¥ä¼˜åŒ–</h4>
<p>ä½¿ç”¨JDBCæ‰¹é‡æ“ä½œä»£æ›¿å•æ¡æ’å…¥ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// å•æ¡æ’å…¥ï¼ˆæ…¢ï¼‰</span>
<span class="hljs-keyword">for</span> (SalaryPayment p : payments) {
    jdbcTemplate.update(sql, p.getId(), p.getName(), ...);
}

<span class="hljs-comment">// æ‰¹é‡æ’å…¥ï¼ˆå¿«ï¼‰</span>
jdbcTemplate.batchUpdate(sql, <span class="hljs-keyword">new</span> <span class="hljs-title class_">BatchPreparedStatementSetter</span>() {
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setValues</span><span class="hljs-params">(PreparedStatement ps, <span class="hljs-type">int</span> i)</span> <span class="hljs-keyword">throws</span> SQLException {
        <span class="hljs-comment">// è®¾ç½®å‚æ•°</span>
    }
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getBatchSize</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> payments.size();
    }
});
</code></pre>
<h4 data-id="heading-33">9.5 ç´¢å¼•ä¼˜åŒ–</h4>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- ä¸ºå¸¸ç”¨æŸ¥è¯¢å­—æ®µæ·»åŠ ç´¢å¼•</span>
<span class="hljs-keyword">CREATE</span> INDEX idx_employee_id <span class="hljs-keyword">ON</span> salary_payment(employee_id);
<span class="hljs-keyword">CREATE</span> INDEX idx_status <span class="hljs-keyword">ON</span> salary_payment(status);
<span class="hljs-keyword">CREATE</span> INDEX idx_create_time <span class="hljs-keyword">ON</span> salary_payment(create_time);

<span class="hljs-comment">-- å¤åˆç´¢å¼•</span>
<span class="hljs-keyword">CREATE</span> INDEX idx_status_employee <span class="hljs-keyword">ON</span> salary_payment(status, employee_id);
</code></pre>
<hr/>
<h3 data-id="heading-34">åã€å®é™…åº”ç”¨åœºæ™¯</h3>
<h4 data-id="heading-35">åœºæ™¯1ï¼šæœˆåº•å·¥èµ„ä»£å‘</h4>
<p>æŸå…¬å¸æœˆåº•éœ€è¦ä¸º50,000åå‘˜å·¥å‘æ”¾å·¥èµ„ï¼Œä½¿ç”¨Spring Batchï¼š</p>
<ul>
<li>è®¾ç½®chunkSize=1000ï¼Œåˆ†æˆ50ä¸ªChunkå¤„ç†</li>
<li>å‡è®¾ç¬¬23ä¸ªChunkä¸­ç¬¬23,456å·å‘˜å·¥é“¶è¡Œå¡å·é”™è¯¯</li>
<li>ç³»ç»Ÿé‡è¯•3æ¬¡åè·³è¿‡è¯¥è®°å½•</li>
<li>æœ€ç»ˆç»“æœï¼š49,999ç¬”æˆåŠŸï¼Œ1ç¬”è®°å½•åˆ°å¤±è´¥åˆ—è¡¨ä¾›åç»­å¤„ç†</li>
</ul>
<h4 data-id="heading-36">åœºæ™¯2ï¼šé“¶è¡Œå¯¹è´¦æ–‡ä»¶å¤„ç†</h4>
<p>é“¶è¡Œæä¾›100ä¸‡ç¬”äº¤æ˜“å¯¹è´¦æ–‡ä»¶ï¼š</p>
<ul>
<li>è®¾ç½®chunkSize=5000ï¼Œæé«˜å¤„ç†æ•ˆç‡</li>
<li>ä½¿ç”¨å¤šçº¿ç¨‹å¹¶å‘å¤„ç†ï¼ˆPartitioningï¼‰</li>
<li>å®Œæˆåç”Ÿæˆå¯¹è´¦å·®å¼‚æŠ¥å‘Š</li>
</ul>
<h4 data-id="heading-37">åœºæ™¯3ï¼šæ•°æ®æŠ¥è¡¨ç”Ÿæˆ</h4>
<p>æ¯å¤©å‡Œæ™¨ç”ŸæˆT+1äº¤æ˜“æŠ¥è¡¨ï¼š</p>
<ul>
<li>ä½¿ç”¨Spring Taskå®šæ—¶è°ƒåº¦</li>
<li>è¯»å–å½“æ—¥äº¤æ˜“æ•°æ®</li>
<li>ç”ŸæˆExcelæŠ¥è¡¨å¹¶å‘é€é‚®ä»¶</li>
</ul>
<hr/>
<h3 data-id="heading-38">åä¸€ã€å¸¸è§é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ</h3>
<h4 data-id="heading-39">Q1: Jobæ‰§è¡Œä¸€åŠæŒ‚äº†æ€ä¹ˆåŠï¼Ÿ</h4>
<p>Spring Batchæ”¯æŒJobé‡å¯ã€‚é€šè¿‡JobRepositoryè®°å½•çš„æ‰§è¡ŒçŠ¶æ€ï¼Œå¯ä»¥ä»ä¸Šæ¬¡å¤±è´¥çš„ä½ç½®ç»§ç»­æ‰§è¡Œï¼š</p>
<pre><code class="hljs language-java" lang="java">.job(salaryPaymentJob)
    .allowStartIfComplete(<span class="hljs-literal">false</span>)  <span class="hljs-comment">// å·²å®Œæˆçš„Jobä¸é‡æ–°æ‰§è¡Œ</span>
    .restartable(<span class="hljs-literal">true</span>)  <span class="hljs-comment">// å…è®¸é‡å¯</span>
</code></pre>
<h4 data-id="heading-40">Q2: å¦‚ä½•å®ç°å¹¶è¡Œå¤„ç†ï¼Ÿ</h4>
<p>ä½¿ç”¨Partitioningæ–¹å¼å®ç°å¤šçº¿ç¨‹å¹¶è¡Œå¤„ç†ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Bean</span>
<span class="hljs-keyword">public</span> Step <span class="hljs-title function_">masterStep</span><span class="hljs-params">()</span> {
    <span class="hljs-keyword">return</span> stepBuilderFactory.get(<span class="hljs-string">"masterStep"</span>)
        .partitioner(slaveStep().getName(), partitioner())
        .step(slaveStep())
        .gridSize(<span class="hljs-number">10</span>)  <span class="hljs-comment">// åˆ†æˆ10ä¸ªåˆ†åŒºå¹¶è¡Œå¤„ç†</span>
        .taskExecutor(taskExecutor())
        .build();
}
</code></pre>
<h4 data-id="heading-41">Q3: å¤„ç†å¤±è´¥çš„æ•°æ®å¦‚ä½•é‡è¯•ï¼Ÿ</h4>
<p>å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼é‡è¯•ï¼š</p>
<ol>
<li>æŸ¥è¯¢status='FAILED'çš„è®°å½•</li>
<li>ä¿®æ­£é”™è¯¯æ•°æ®</li>
<li>å°†statusæ”¹å›'PENDING'</li>
<li>é‡æ–°æ‰§è¡ŒJob</li>
</ol>
<hr/>
<h3 data-id="heading-42">åäºŒã€æ€»ç»“</h3>
<p>Spring Batchä½œä¸ºæˆç†Ÿçš„æ‰¹å¤„ç†æ¡†æ¶ï¼Œæä¾›äº†å®Œæ•´çš„è§£å†³æ–¹æ¡ˆæ¥å¤„ç†å¤§è§„æ¨¡æ‰¹é‡æ•°æ®ã€‚</p>
<p><strong>é€‚ç”¨åœºæ™¯ï¼š</strong></p>
<ul>
<li>é“¶è¡Œå¯¹è´¦ã€æ¸…ç®—</li>
<li>å·¥èµ„ä»£å‘ã€æ‰¹é‡è½¬è´¦</li>
<li>æŠ¥è¡¨ç”Ÿæˆã€æ•°æ®å¯¼å‡º</li>
</ul>
<p><strong>æ³¨æ„äº‹é¡¹ï¼š</strong></p>
<ul>
<li>åˆç†è®¾ç½®chunkSizeï¼Œå¹³è¡¡å†…å­˜å’Œæ€§èƒ½</li>
<li>é…ç½®åˆé€‚çš„Skipå’ŒRetryç­–ç•¥</li>
<li>åšå¥½å¤±è´¥è®°å½•çš„é‡å¤„ç†æœºåˆ¶</li>
<li>å®šæœŸæ¸…ç†Jobæ‰§è¡Œå†å²æ•°æ®</li>
</ul>
<hr/></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[è™šæ‹Ÿåˆ—è¡¨ï¼šä»å®šé«˜åˆ°åŠ¨æ€é«˜åº¦çš„ Vue 3 & React æ»¡åˆ†å®ç°]]></title>    <link>https://juejin.cn/post/7603591775392251931</link>    <guid>https://juejin.cn/post/7603591775392251931</guid>    <pubDate>2026-02-07T03:49:36.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7603591775392251931" data-draft-id="7603359026711969802" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="è™šæ‹Ÿåˆ—è¡¨ï¼šä»å®šé«˜åˆ°åŠ¨æ€é«˜åº¦çš„ Vue 3 &amp; React æ»¡åˆ†å®ç°"/> <meta itemprop="keywords" content="å‰ç«¯,Vue.js,React.js"/> <meta itemprop="datePublished" content="2026-02-07T03:49:36.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å‘ç°ä¸€åªå¤§å‘†ç“œ"/> <meta itemprop="url" content="https://juejin.cn/user/180747382561607"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            è™šæ‹Ÿåˆ—è¡¨ï¼šä»å®šé«˜åˆ°åŠ¨æ€é«˜åº¦çš„ Vue 3 &amp; React æ»¡åˆ†å®ç°
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/180747382561607/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å‘ç°ä¸€åªå¤§å‘†ç“œ
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-07T03:49:36.000Z" title="Sat Feb 07 2026 03:49:36 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-07
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»5åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h3 data-id="heading-0">å‰è¨€</h3>
<p>åœ¨å¤„ç†æµ·é‡æ•°æ®æ¸²æŸ“ï¼ˆå¦‚ä¸‡çº§ç”šè‡³åä¸‡çº§åˆ—è¡¨ï¼‰æ—¶ï¼Œç›´æ¥æ“ä½œ DOM ä¼šå¯¼è‡´ä¸¥é‡çš„é¡µé¢å¡é¡¿ç”šè‡³å´©æºƒã€‚<strong>è™šæ‹Ÿåˆ—è¡¨ï¼ˆVirtual Listï¼‰</strong> ä½œä¸ºå‰ç«¯æ€§èƒ½ä¼˜åŒ–çš„â€œæ ¸æ­¦å™¨â€ï¼Œé€šè¿‡â€œåªæ¸²æŸ“å¯è§†åŒºâ€çš„ç­–ç•¥ï¼Œèƒ½å°†æ¸²æŸ“æ€§èƒ½æå‡æ•°ä¸ªé‡çº§ã€‚æœ¬æ–‡å°†å¸¦ä½ ä»é›¶å®ç°ä¸€ä¸ªæ”¯æŒ<strong>åŠ¨æ€é«˜åº¦</strong>çš„é€šç”¨è™šæ‹Ÿåˆ—è¡¨ã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0aeb589869424d08be07ff8183e5af9e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y-R546w5LiA5Y-q5aSn5ZGG55Oc:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771040975&amp;x-signature=83d1HWo%2Fzcfl0pbpVr8sTUG%2Bd4g%3D" alt="å®šé«˜è™šæ‹Ÿåˆ—è¡¨æ»šåŠ¨.gif" loading="lazy"/></p>
<h2 data-id="heading-1">ä¸€ã€ æ ¸å¿ƒåŸç†è§£æ</h2>
<p>è™šæ‹Ÿåˆ—è¡¨æœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªâ€œéšœçœ¼æ³•â€ï¼Œå…¶ç»“æ„é€šå¸¸åˆ†ä¸ºä¸‰å±‚ï¼š</p>
<ol>
<li><strong>å¤–å±‚å®¹å™¨ï¼ˆContainerï¼‰</strong> ï¼šå›ºå®šé«˜åº¦ï¼Œè®¾ç½® <code>overflow: auto</code>ï¼Œè´Ÿè´£ç›‘å¬æ»šåŠ¨äº‹ä»¶ã€‚</li>
<li><strong>å ä½èƒŒæ™¯ï¼ˆPlaceholderï¼‰</strong> ï¼šé«˜åº¦ç­‰äºâ€œæ€»æ•°æ®é‡ Ã— åˆ—è¡¨é¡¹é«˜åº¦â€ï¼Œç”¨äºæ’‘å¼€æ»šåŠ¨æ¡ï¼Œæ¨¡æ‹ŸçœŸå®æ»šåŠ¨çš„è§†è§‰æ•ˆæœã€‚</li>
<li><strong>æ¸²æŸ“å†…å®¹åŒºï¼ˆContent Areaï¼‰</strong> ï¼šç»å¯¹å®šä½ï¼Œæ ¹æ®æ»šåŠ¨è·ç¦»åŠ¨æ€è®¡ç®—èµ·å§‹ç´¢å¼•ï¼Œå¹¶é€šè¿‡ <code>translateY</code> åç§»åˆ°å½“å‰å¯è§†åŒºåŸŸã€‚</li>
</ol>
<p align="center"><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/35758c5b480e4fd4ae543f60afd26730~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y-R546w5LiA5Y-q5aSn5ZGG55Oc:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771040975&amp;x-signature=gm9VzHaAFCGyUyiSagfZbbWktEk%3D" alt="image.png" width="60%" loading="lazy"/></p>
<hr/>
<h2 data-id="heading-2">äºŒã€ å®šé«˜è™šæ‹Ÿåˆ—è¡¨</h2>
<h3 data-id="heading-3">1. è®¾è®¡æ€è·¯</h3>
<ul>
<li><strong>å¯è§†é¡¹æ•°è®¡ç®—</strong>ï¼š<code>Math.ceil(å®¹å™¨é«˜åº¦ / å›ºå®šé«˜åº¦) Â± ç¼“å†²åŒº (BUFFER)</code>ã€‚</li>
<li><strong>èµ·å§‹ç´¢å¼•</strong>ï¼š<code>Math.floor(æ»šåŠ¨è·ç¦» / å›ºå®šé«˜åº¦)</code>ã€‚</li>
<li><strong>åç§»é‡</strong>ï¼š<code>èµ·å§‹ç´¢å¼• * å›ºå®šé«˜åº¦</code>ã€‚</li>
</ul>
<h3 data-id="heading-4">2. Vue 3 + TailwindCSSå®ç°</h3>
<pre><code class="hljs language-vue" lang="vue">&lt;template&gt;
  &lt;div
    class="min-h-screen bg-gradient-to-br from-indigo-600 to-purple-600 py-10 px-5"
  &gt;
    &lt;div class="bg-white mt-20 h-[calc(100vh-200px)] rounded-xl"&gt;
      &lt;!-- æ»šåŠ¨å®¹å™¨ --&gt;
      &lt;div
        ref="virtualListRef"
        class="h-full overflow-auto relative"
        @scroll="handleScroll"
      &gt;
        &lt;!-- å ä½å®¹å™¨ï¼šç”¨äºæ’‘å¼€æ»šåŠ¨æ¡ï¼Œé«˜åº¦ = æ€»æ•°æ®é‡ * æ¯é¡¹é«˜åº¦ --&gt;
        &lt;div :style="{ height: `${totalHeight}px` }"&gt;&lt;/div&gt;

        &lt;!-- å¯è§†åŒºåŸŸåˆ—è¡¨ï¼šé€šè¿‡ transform å®šä½åˆ°æ»šåŠ¨ä½ç½® --&gt;
        &lt;div
          class="absolute top-0 left-0 right-0"
          :style="{ transform: `translateY(${offsetY}px)` }"
        &gt;
          &lt;div
            v-for="item in visibleList"
            :key="item.id"
            class="py-2 px-4 border-b border-gray-200"
            :class="{
              'bg-pink-200 h-[100px]': item.id % 2 !== 0,
              'bg-green-200 h-[100px]': item.id % 2 === 0,
            }"
          &gt;
            {{ item.name }}
          &lt;/div&gt;
        &lt;/div&gt;
      &lt;/div&gt;
    &lt;/div&gt;
    &lt;div
      class="fixed top-2 left-24 -translate-x-1/2 px-8 py-3 bg-white text-indigo-600 rounded-full text-base font-semibold cursor-pointer shadow-lg transition-all duration-300 hover:-translate-x-1/2 hover:-translate-y-0.5 hover:shadow-2xl"
      @click="goBack"
    &gt;
      â† è¿”å›é¦–é¡µ
    &lt;/div&gt;
  &lt;/div&gt;
&lt;/template&gt;

&lt;script setup lang="ts"&gt;
import { ref, onMounted, computed } from 'vue';
import { useRouter } from 'vue-router';

const router = useRouter();

const ITEM_HEIGHT = 100; // åˆ—è¡¨é¡¹å›ºå®šé«˜åº¦ï¼ˆä¸æ ·å¼ä¸­çš„ h-[100px] ä¸€è‡´ï¼‰
const BUFFER = 5; // ç¼“å†²åŒºæ•°é‡ï¼Œé¿å…æ»šåŠ¨æ—¶å‡ºç°ç©ºç™½

const virtualListRef = ref&lt;HTMLDivElement | null&gt;(null);

const ListData = ref&lt;any[]&gt;([]); // å®Œæ•´åˆ—è¡¨æ•°æ®
const scrollTop = ref(0); // æ»šåŠ¨å®¹å™¨çš„æ»šåŠ¨è·ç¦»

// æ€»åˆ—è¡¨é«˜åº¦ï¼ˆæ’‘å¼€æ»šåŠ¨æ¡ç”¨ï¼‰
const totalHeight = computed(() =&gt; ListData.value.length * ITEM_HEIGHT);

// å¯è§†åŒºåŸŸé«˜åº¦ï¼ˆæ»šåŠ¨å®¹å™¨çš„é«˜åº¦ï¼‰
const viewportHeight = computed(() =&gt; {
  return virtualListRef.value?.clientHeight || 0;
});

// å¯è§†åŒºåŸŸå¯æ˜¾ç¤ºçš„åˆ—è¡¨é¡¹æ•°é‡ï¼ˆå‘ä¸Šå–æ•´ + ç¼“å†²åŒºï¼‰
const visibleCount = computed(() =&gt; {
  return Math.ceil(viewportHeight.value / ITEM_HEIGHT) + BUFFER;
});

// å½“å‰æ˜¾ç¤ºçš„èµ·å§‹ç´¢å¼•
const startIndex = computed(() =&gt; {
  // æ»šåŠ¨è·ç¦» / æ¯é¡¹é«˜åº¦ = è·³è¿‡çš„é¡¹æ•°ï¼ˆå‘ä¸‹å–æ•´ï¼‰
  const index = Math.floor(scrollTop.value / ITEM_HEIGHT);
  // é˜²æ­¢ç´¢å¼•ä¸ºè´Ÿæ•°
  return Math.max(0, index);
});

// å½“å‰æ˜¾ç¤ºçš„ç»“æŸç´¢å¼•
const endIndex = computed(() =&gt; {
  const end = startIndex.value + visibleCount.value;
  // é˜²æ­¢è¶…å‡ºæ€»æ•°æ®é•¿åº¦
  return Math.min(end, ListData.value.length);
});

// å¯è§†åŒºåŸŸéœ€è¦æ¸²æŸ“çš„åˆ—è¡¨æ•°æ®
const visibleList = computed(() =&gt; {
  return ListData.value.slice(startIndex.value, endIndex.value);
});

// å¯è§†åŒºåŸŸçš„åç§»é‡ï¼ˆè®©åˆ—è¡¨é¡¹å®šä½åˆ°æ­£ç¡®ä½ç½®ï¼‰
const offsetY = computed(() =&gt; {
  return startIndex.value * ITEM_HEIGHT;
});

// å¤„ç†æ»šåŠ¨äº‹ä»¶
const handleScroll = () =&gt; {
  if (virtualListRef.value) {
    scrollTop.value = virtualListRef.value.scrollTop;
  }
};

// è¿”å›é¦–é¡µ
const goBack = () =&gt; {
  router.push('/home');
};

// åˆå§‹åŒ–
onMounted(() =&gt; {
  // ç”Ÿæˆæ¨¡æ‹Ÿæ•°æ®
  ListData.value = Array.from({ length: 1000 }, (_, index) =&gt; ({
    id: index,
    name: `Item ${index}`,
  }));
});
&lt;/script&gt;

</code></pre>
<h3 data-id="heading-5">3. å®ç°æ•ˆæœå›¾</h3>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0aeb589869424d08be07ff8183e5af9e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y-R546w5LiA5Y-q5aSn5ZGG55Oc:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771040975&amp;x-signature=83d1HWo%2Fzcfl0pbpVr8sTUG%2Bd4g%3D" alt="å®šé«˜è™šæ‹Ÿåˆ—è¡¨æ»šåŠ¨.gif" loading="lazy"/></p>
<hr/>
<h2 data-id="heading-6">ä¸‰ã€ è¿›é˜¶ï¼šä¸å®šé«˜ï¼ˆåŠ¨æ€é«˜åº¦ï¼‰è™šæ‹Ÿåˆ—è¡¨</h2>
<p>åœ¨å®é™…ä¸šåŠ¡ï¼ˆå¦‚ç¤¾äº¤åŠ¨æ€ã€èŠå¤©è®°å½•ï¼‰ä¸­ï¼Œæ¯ä¸ª Item çš„é«˜åº¦å¾€å¾€æ˜¯ä¸å›ºå®šçš„ã€‚</p>
<h3 data-id="heading-7">1. æ ¸å¿ƒæ”¹è¿›æ€è·¯</h3>
<ul>
<li><strong>é«˜åº¦æ˜ å°„è¡¨ï¼ˆMapï¼‰</strong> ï¼šè®°å½•æ¯ä¸€ä¸ª Item æ¸²æŸ“åçš„çœŸå®é«˜åº¦ã€‚</li>
<li><strong>ç´¯è®¡é«˜åº¦æ•°ç»„ï¼ˆCumulative Heightsï¼‰</strong> ï¼šå­˜å‚¨æ¯ä¸€é¡¹ç›¸å¯¹äºé¡¶éƒ¨çš„åç§»ä½ç½®ã€‚</li>
<li><strong>ResizeObserver</strong>ï¼šåˆ©ç”¨è¯¥ API ç›‘å¬å­ç»„ä»¶é«˜åº¦å˜åŒ–ï¼Œå®æ—¶æ›´æ–°æ˜ å°„è¡¨ï¼Œè§£å†³å›¾ç‰‡åŠ è½½æˆ–æ–‡æœ¬æŠ˜è¡Œå¯¼è‡´çš„ä½ç§»ã€‚</li>
</ul>
<h3 data-id="heading-8">2. Vue 3 + tailwindCSS å®ç°ï¼ˆå­ç»„ä»¶æŠ½ç¦»ï¼‰</h3>
<p><strong>å­ç»„ä»¶</strong>ï¼š è´Ÿè´£ä¸ŠæŠ¥çœŸå®é«˜åº¦ï¼š</p>
<pre><code class="hljs language-vue" lang="vue">&lt;template&gt;
  &lt;div
    ref="itemRef"
    class="py-2 px-4 border-b border-gray-200"
    :class="{
      'bg-pink-200': item.id % 2 !== 0,
      'bg-green-200': item.id % 2 === 0,
    }"
    :style="{ height: item.id % 2 === 0 ? '150px' : '100px' }"
  &gt;
    {{ item.name }}
  &lt;/div&gt;
&lt;/template&gt;

&lt;script setup lang="ts"&gt;
import { ref, onMounted, onUpdated, onUnmounted, watch, nextTick } from 'vue';

// å®šä¹‰propsï¼šæ¥æ”¶çˆ¶ç»„ä»¶ä¼ é€’çš„itemæ•°æ®
const props = defineProps&lt;{
  item: {
    id: number;
    name: string;
  };
}&gt;();

// å®šä¹‰emitï¼šå‘çˆ¶ç»„ä»¶ä¼ é€’é«˜åº¦æ›´æ–°äº‹ä»¶
const emit = defineEmits&lt;{
  (e: 'update-height', id: number, height: number): void;
}&gt;();

const itemRef = ref&lt;HTMLDivElement | null&gt;(null);
let resizeObserver: ResizeObserver | null = null;

// è®¡ç®—å¹¶å‘é€å½“å‰ç»„ä»¶çš„é«˜åº¦
const sendItemHeight = () =&gt; {
  if (!itemRef.value) return;
  const realHeight = itemRef.value.offsetHeight;
  emit('update-height', props.item.id, realHeight);
};

// ç›‘å¬ç»„ä»¶æŒ‚è½½ï¼šé¦–æ¬¡å‘é€é«˜åº¦ + ç›‘å¬é«˜åº¦å˜åŒ–
onMounted(() =&gt; {
  // é¦–æ¬¡æ¸²æŸ“å®Œæˆåå‘é€é«˜åº¦
  nextTick(() =&gt; {
    sendItemHeight();
  });

  // ç›‘å¬å…ƒç´ é«˜åº¦å˜åŒ–ï¼ˆé€‚é…åŠ¨æ€å†…å®¹å¯¼è‡´çš„é«˜åº¦å˜åŒ–ï¼‰
  if (window.ResizeObserver) {
    resizeObserver = new ResizeObserver(() =&gt; {
      sendItemHeight();
    });
    if (itemRef.value) {
      resizeObserver.observe(itemRef.value);
    }
  }
});

// ç»„ä»¶æ›´æ–°åé‡æ–°å‘é€é«˜åº¦ï¼ˆæ¯”å¦‚å†…å®¹å˜åŒ–ï¼‰
onUpdated(() =&gt; {
  nextTick(() =&gt; {
    sendItemHeight();
  });
});

// ç»„ä»¶å¸è½½ï¼šæ¸…ç†ç›‘å¬
onUnmounted(() =&gt; {
  if (resizeObserver) {
    resizeObserver.disconnect();
    resizeObserver = null;
  }
});

// ç›‘å¬itemå˜åŒ–ï¼šå¦‚æœitemæ›¿æ¢ï¼Œé‡æ–°è®¡ç®—é«˜åº¦
watch(
  () =&gt; props.item.id,
  () =&gt; {
    nextTick(() =&gt; {
      sendItemHeight();
    });
  }
);
&lt;/script&gt;

</code></pre>
<p><strong>çˆ¶ç»„ä»¶</strong>ï¼šæ ¸å¿ƒé€»è¾‘</p>
<pre><code class="hljs language-vue" lang="vue">&lt;template&gt;
  &lt;div
    class="min-h-screen bg-gradient-to-br from-indigo-600 to-purple-600 py-10 px-5"
  &gt;
    &lt;div class="bg-white mt-20 h-[calc(100vh-200px)] rounded-xl"&gt;
      &lt;!-- æ»šåŠ¨å®¹å™¨ --&gt;
      &lt;div
        ref="virtualListRef"
        class="h-full overflow-auto relative"
        @scroll="handleScroll"
      &gt;
        &lt;!-- å ä½å®¹å™¨ï¼šæ’‘å¼€æ»šåŠ¨æ¡ --&gt;
        &lt;div :style="{ height: `${totalHeight}px` }"&gt;&lt;/div&gt;

        &lt;!-- å¯è§†åŒºåŸŸåˆ—è¡¨ --&gt;
        &lt;div
          class="absolute top-0 left-0 right-0"
          :style="{ transform: `translateY(${offsetY}px)` }"
        &gt;
          &lt;!-- æ¸²æŸ“å­ç»„ä»¶ï¼Œç›‘å¬é«˜åº¦æ›´æ–°äº‹ä»¶ --&gt;
          &lt;VirtualListItem
            v-for="item in visibleList"
            :key="item.id"
            :item="item"
            @update-height="handleItemHeightUpdate"
          /&gt;
        &lt;/div&gt;
      &lt;/div&gt;
    &lt;/div&gt;
    &lt;div
      class="fixed top-2 left-24 -translate-x-1/2 px-8 py-3 bg-white text-indigo-600 rounded-full text-base font-semibold cursor-pointer shadow-lg transition-all duration-300 hover:-translate-x-1/2 hover:-translate-y-0.5 hover:shadow-2xl"
      @click="goBack"
    &gt;
      â† è¿”å›é¦–é¡µ
    &lt;/div&gt;
  &lt;/div&gt;
&lt;/template&gt;

&lt;script setup lang="ts"&gt;
import { ref, onMounted, computed, onUnmounted, nextTick } from 'vue';
import { useRouter } from 'vue-router';
import VirtualListItem from './listItem.vue'; // å¼•å…¥å­ç»„ä»¶

const router = useRouter();

const MIN_ITEM_HEIGHT = 100; // å­é¡¹é¢„è®¾çš„æœ€å°é«˜åº¦
const BUFFER = 5; //ä¸Šä¸‹ç¼“å†²åŒºæ•°ç›®
const virtualListRef = ref&lt;HTMLDivElement | null&gt;(null); // æ»šåŠ¨å®¹å™¨å¼•ç”¨

const ListData = ref&lt;any[]&gt;([]); // å®Œæ•´åˆ—è¡¨æ•°æ®
const scrollTop = ref(0); // æ»šåŠ¨è·ç¦»
const itemHeights = ref&lt;Map&lt;number, number&gt;&gt;(new Map()); // å­ç»„ä»¶é«˜åº¦æ˜ å°„è¡¨
const cumulativeHeights = ref&lt;number[]&gt;([0]); // ç´¯è®¡é«˜åº¦æ•°ç»„
const scrollTimer = ref&lt;number | null&gt;(null); // æ»šåŠ¨èŠ‚æµå®šæ—¶å™¨
const isUpdatingCumulative = ref(false); // ç´¯è®¡é«˜åº¦æ›´æ–°é˜²æŠ–

// åˆå§‹åŒ–ä½ç½®æ•°æ®
const initPositionData = () =&gt; {
  // åˆå§‹åŒ–é«˜åº¦æ˜ å°„è¡¨ï¼ˆé»˜è®¤æœ€å°é«˜åº¦ï¼‰
  const heightMap = new Map&lt;number, number&gt;();
  ListData.value.forEach((item) =&gt; {
    heightMap.set(item.id, MIN_ITEM_HEIGHT);
  });
  // åˆå§‹åŒ–ç´¯è®¡é«˜åº¦
  updateCumulativeHeights();
};

// æ›´æ–°ç´¯è®¡é«˜åº¦ï¼ˆæ ¸å¿ƒï¼‰
const updateCumulativeHeights = () =&gt; {
  if (isUpdatingCumulative.value) return;
  isUpdatingCumulative.value = true;

  const itemCount = ListData.value.length;
  const cumulative = [0];
  let sum = 0;

  for (let i = 0; i &lt; itemCount; i++) {
    const itemId = ListData.value[i].id;
    sum += itemHeights.value.get(itemId) || MIN_ITEM_HEIGHT;
    cumulative.push(sum);
  }

  cumulativeHeights.value = cumulative;
  isUpdatingCumulative.value = false;
};

// å¤„ç†å­ç»„ä»¶çš„é«˜åº¦æ›´æ–°äº‹ä»¶
const handleItemHeightUpdate = (id: number, height: number) =&gt; {
  // é«˜åº¦æœªå˜åŒ–åˆ™è·³è¿‡
  if (itemHeights.value.get(id) === height) return;

  // æ›´æ–°é«˜åº¦æ˜ å°„è¡¨
  itemHeights.value.set(id, height);

  // å¼‚æ­¥æ›´æ–°ç´¯è®¡é«˜åº¦ï¼ˆé¿å…åŒæ­¥æ›´æ–°å¯¼è‡´çš„æ€§èƒ½é—®é¢˜ï¼‰
  nextTick(() =&gt; {
    updateCumulativeHeights();
  });
};

// æ€»é«˜åº¦ï¼Œæ ¹æ®ç»Ÿè®¡é«˜åº¦æ•°ç»„æœ€åä¸€ä¸ªå€¼è®¡ç®—å¾—å‡º
const totalHeight = computed(() =&gt; {
  return cumulativeHeights.value[cumulativeHeights.value.length - 1] || 0;
});

// åˆ—è¡¨å¯è§†åŒºåŸŸé«˜åº¦
const viewportHeight = computed(() =&gt; {
  return virtualListRef.value?.clientHeight || MIN_ITEM_HEIGHT * 5;
});

// è®¡ç®—èµ·å§‹ç´¢å¼•
const startIndex = computed(() =&gt; {
  const totalItemCount = ListData.value.length;
  if (totalItemCount === 0) return 0;
  if (scrollTop.value &lt;= 0) return 0;

  let baseStartIndex = 0;
  // åå‘éå†æ‰¾èµ·å§‹ç´¢å¼•
  for (let i = cumulativeHeights.value.length - 1; i &gt;= 0; i--) {
    if (cumulativeHeights.value[i] &lt;= scrollTop.value) {
      baseStartIndex = i;
      break;
    }
  }
  const finalIndex = Math.max(0, baseStartIndex - BUFFER); // ç¡®ä¿ä¸å°äº0
  return Math.min(finalIndex, totalItemCount - 1);
});

// è®¡ç®—ç»“æŸç´¢å¼•
const endIndex = computed(() =&gt; {
  const totalItemCount = ListData.value.length;
  const viewportHeightVal = viewportHeight.value;
  if (totalItemCount === 0) return 0;

  const targetScrollBottom = scrollTop.value + viewportHeightVal; // ç›®æ ‡æ»šåŠ¨åˆ°åº•éƒ¨ä½ç½®
  let baseEndIndex = totalItemCount - 1;
  for (let i = 0; i &lt; cumulativeHeights.value.length; i++) {
    if (cumulativeHeights.value[i] &gt; targetScrollBottom) {
      baseEndIndex = i - 1;
      break;
    }
  }
  const finalEndIndex = Math.min(baseEndIndex + BUFFER, totalItemCount - 1); // ç¡®ä¿ä¸å¤§äºæ€»é¡¹æ•°-1
  return finalEndIndex;
});

// å¯è§åˆ—è¡¨
const visibleList = computed(() =&gt; {
  const start = startIndex.value;
  const end = endIndex.value;
  return start &lt;= end ? ListData.value.slice(start, end + 1) : [];
});

const offsetY = computed(() =&gt; {
  return cumulativeHeights.value[startIndex.value] || 0;
});

// æ»šåŠ¨èŠ‚æµå¤„ç†
const handleScroll = () =&gt; {
  if (!virtualListRef.value) return;

  if (scrollTimer.value) clearTimeout(scrollTimer.value);
  scrollTimer.value = window.setTimeout(() =&gt; {
    scrollTop.value = virtualListRef.value!.scrollTop;
  }, 20);
};

const handleResize = () =&gt; {
  if (virtualListRef.value) {
    scrollTop.value = virtualListRef.value.scrollTop;
  }
};

const goBack = () =&gt; {
  router.push('/home');
};

// ç”Ÿå‘½å‘¨æœŸ
onMounted(() =&gt; {
  // ç”Ÿæˆæ¨¡æ‹Ÿæ•°æ®
  ListData.value = Array.from({ length: 1000 }, (_, index) =&gt; ({
    id: index,
    name: `Item ${index}`,
  }));
  initPositionData();
  window.addEventListener('resize', handleResize); // ç›‘å¬çª—å£å¤§å°å˜åŒ–
});

onUnmounted(() =&gt; {
  window.removeEventListener('resize', handleResize);
  if (scrollTimer.value) clearTimeout(scrollTimer.value);
  isUpdatingCumulative.value = false;
  itemHeights.value.clear();
});
&lt;/script&gt;
</code></pre>
<h3 data-id="heading-9">3. React + tailwindCSS å®ç°ï¼ˆå­ç»„ä»¶æŠ½ç¦»ï¼‰</h3>
<p><strong>å­ç»„ä»¶ï¼š</strong></p>
<pre><code class="hljs language-tsx" lang="tsx"><span class="hljs-keyword">import</span> <span class="hljs-title class_">React</span>, { useEffect, useRef, useState, useCallback } <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>;

<span class="hljs-keyword">interface</span> <span class="hljs-title class_">VirtualListItemProps</span> {
  <span class="hljs-attr">item</span>: {
    <span class="hljs-attr">id</span>: <span class="hljs-built_in">number</span>;
    <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span>;
  };
  <span class="hljs-attr">onUpdateHeight</span>: <span class="hljs-function">(<span class="hljs-params">id: <span class="hljs-built_in">number</span>, height: <span class="hljs-built_in">number</span></span>) =&gt;</span> <span class="hljs-built_in">void</span>; <span class="hljs-comment">// æ›¿ä»£ Vue çš„ emit</span>
}

<span class="hljs-keyword">const</span> <span class="hljs-title class_">VirtualListItem</span>: <span class="hljs-title class_">React</span>.<span class="hljs-property">FC</span>&lt;<span class="hljs-title class_">VirtualListItemProps</span>&gt; = <span class="hljs-function">(<span class="hljs-params">{
  item,
  onUpdateHeight,
}</span>) =&gt;</span> {
  <span class="hljs-keyword">const</span> itemRef = useRef&lt;<span class="hljs-title class_">HTMLDivElement</span>&gt;(<span class="hljs-literal">null</span>);
  <span class="hljs-comment">// å­˜å‚¨ ResizeObserver å®ä¾‹ï¼ˆé¿å…é‡å¤åˆ›å»ºï¼‰</span>
  <span class="hljs-keyword">const</span> resizeObserverRef = useRef&lt;<span class="hljs-title class_">ResizeObserver</span> | <span class="hljs-literal">null</span>&gt;(<span class="hljs-literal">null</span>);

  <span class="hljs-comment">// è®¡ç®—å¹¶ä¸ŠæŠ¥é«˜åº¦</span>
  <span class="hljs-keyword">const</span> sendItemHeight = <span class="hljs-title function_">useCallback</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">if</span> (!itemRef.<span class="hljs-property">current</span>) <span class="hljs-keyword">return</span>;
    <span class="hljs-keyword">const</span> realHeight = itemRef.<span class="hljs-property">current</span>.<span class="hljs-property">offsetHeight</span>;
    <span class="hljs-title function_">onUpdateHeight</span>(item.<span class="hljs-property">id</span>, realHeight);
  }, [item.<span class="hljs-property">id</span>, onUpdateHeight]);

  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">const</span> timer = <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
      <span class="hljs-title function_">sendItemHeight</span>();
    }, <span class="hljs-number">0</span>);

    <span class="hljs-comment">// åˆå§‹åŒ– ResizeObserver ç›‘å¬é«˜åº¦å˜åŒ–</span>
    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">window</span>.<span class="hljs-property">ResizeObserver</span>) {
      resizeObserverRef.<span class="hljs-property">current</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ResizeObserver</span>(<span class="hljs-function">() =&gt;</span> {
        <span class="hljs-title function_">sendItemHeight</span>();
      });
      <span class="hljs-keyword">if</span> (itemRef.<span class="hljs-property">current</span>) {
        resizeObserverRef.<span class="hljs-property">current</span>.<span class="hljs-title function_">observe</span>(itemRef.<span class="hljs-property">current</span>);
      }
    }

    <span class="hljs-comment">// æ¸…ç†å®šæ—¶å™¨ï¼ˆå¯¹åº” Vue çš„ onUnmounted éƒ¨åˆ†ï¼‰</span>
    <span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> {
      <span class="hljs-built_in">clearTimeout</span>(timer);
      <span class="hljs-keyword">if</span> (resizeObserverRef.<span class="hljs-property">current</span>) {
        resizeObserverRef.<span class="hljs-property">current</span>.<span class="hljs-title function_">disconnect</span>();
        resizeObserverRef.<span class="hljs-property">current</span> = <span class="hljs-literal">null</span>;
      }
    };
  }, [sendItemHeight]); <span class="hljs-comment">// ä»…é¦–æ¬¡æŒ‚è½½æ‰§è¡Œ</span>

  <span class="hljs-comment">//ç›‘å¬ item å˜åŒ–é‡æ–°è®¡ç®—é«˜åº¦</span>
  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">const</span> timer = <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
      <span class="hljs-title function_">sendItemHeight</span>();
    }, <span class="hljs-number">0</span>);
    <span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">clearTimeout</span>(timer);
  }, [item.<span class="hljs-property">id</span>, sendItemHeight]); <span class="hljs-comment">// item.id å˜åŒ–æ—¶æ‰§è¡Œ</span>

  <span class="hljs-keyword">const</span> itemClass = <span class="hljs-string">`py-2 px-4 border-b border-gray-200 <span class="hljs-subst">${
    item.id % <span class="hljs-number">2</span> !== <span class="hljs-number">0</span> ? <span class="hljs-string">'bg-pink-200'</span> : <span class="hljs-string">'bg-green-200'</span>
  }</span>`</span>;

  <span class="hljs-keyword">const</span> <span class="hljs-attr">itemStyle</span>: <span class="hljs-title class_">React</span>.<span class="hljs-property">CSSProperties</span> = {
    <span class="hljs-attr">height</span>: item.<span class="hljs-property">id</span> % <span class="hljs-number">2</span> === <span class="hljs-number">0</span> ? <span class="hljs-string">'150px'</span> : <span class="hljs-string">'100px'</span>,
  };

  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">{itemRef}</span> <span class="hljs-attr">className</span>=<span class="hljs-string">{itemClass}</span> <span class="hljs-attr">style</span>=<span class="hljs-string">{itemStyle}</span>&gt;</span>
      {item.name}
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  );
};

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title class_">VirtualListItem</span>;


</code></pre>
<p><strong>çˆ¶ç»„ä»¶ï¼š</strong></p>
<pre><code class="hljs language-tsx" lang="tsx"><span class="hljs-keyword">import</span> <span class="hljs-title class_">React</span>, {
  useEffect,
  useRef,
  useState,
  useCallback,
  useMemo,
} <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>;
<span class="hljs-keyword">import</span> <span class="hljs-title class_">VirtualListItem</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'./listItem'</span>;

<span class="hljs-keyword">const</span> <span class="hljs-title class_">VirtualList</span>: <span class="hljs-title class_">React</span>.<span class="hljs-property">FC</span> = <span class="hljs-function">() =&gt;</span> {
  <span class="hljs-keyword">const</span> <span class="hljs-variable constant_">MIN_ITEM_HEIGHT</span> = <span class="hljs-number">100</span>; <span class="hljs-comment">// æœ€å°é¡¹é«˜åº¦</span>
  <span class="hljs-keyword">const</span> <span class="hljs-variable constant_">BUFFER</span> = <span class="hljs-number">5</span>; <span class="hljs-comment">// ç¼“å†²åŒºé¡¹æ•°</span>

  <span class="hljs-keyword">const</span> virtualListRef = useRef&lt;<span class="hljs-title class_">HTMLDivElement</span>&gt;(<span class="hljs-literal">null</span>); <span class="hljs-comment">// è™šæ‹Ÿåˆ—è¡¨å®¹å™¨å¼•ç”¨</span>

  <span class="hljs-keyword">const</span> [listData, setListData] = useState&lt;<span class="hljs-title class_">Array</span>&lt;{ <span class="hljs-attr">id</span>: <span class="hljs-built_in">number</span>; <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span> }&gt;&gt;(
    []
  ); <span class="hljs-comment">// åˆ—è¡¨æ•°æ®</span>
  <span class="hljs-keyword">const</span> [scrollTop, setScrollTop] = <span class="hljs-title function_">useState</span>(<span class="hljs-number">0</span>); <span class="hljs-comment">// æ»šåŠ¨ä½ç½®</span>
  <span class="hljs-keyword">const</span> [itemHeights, setItemHeights] = useState&lt;<span class="hljs-title class_">Map</span>&lt;<span class="hljs-built_in">number</span>, <span class="hljs-built_in">number</span>&gt;&gt;(
    <span class="hljs-keyword">new</span> <span class="hljs-title class_">Map</span>()
  ); <span class="hljs-comment">// é«˜åº¦æ˜ å°„è¡¨ï¼ˆMap ç»“æ„ï¼‰</span>
  <span class="hljs-keyword">const</span> [cumulativeHeights, setCumulativeHeights] = useState&lt;<span class="hljs-built_in">number</span>[]&gt;([<span class="hljs-number">0</span>]); <span class="hljs-comment">// ç´¯è®¡é«˜åº¦æ•°ç»„</span>
  <span class="hljs-keyword">const</span> scrollTimerRef = useRef&lt;<span class="hljs-built_in">number</span> | <span class="hljs-literal">null</span>&gt;(<span class="hljs-literal">null</span>); <span class="hljs-comment">// æ»šåŠ¨èŠ‚æµå®šæ—¶å™¨</span>

  <span class="hljs-comment">// åˆå§‹åŒ–æ¨¡æ‹Ÿæ•°æ®</span>
  <span class="hljs-keyword">const</span> <span class="hljs-title function_">initData</span> = (<span class="hljs-params"/>) =&gt; {
    <span class="hljs-keyword">const</span> mockData = <span class="hljs-title class_">Array</span>.<span class="hljs-title function_">from</span>({ <span class="hljs-attr">length</span>: <span class="hljs-number">1000</span> }, <span class="hljs-function">(<span class="hljs-params">_, index</span>) =&gt;</span> ({
      <span class="hljs-attr">id</span>: index,
      <span class="hljs-attr">name</span>: <span class="hljs-string">`Item <span class="hljs-subst">${index}</span>`</span>,
    }));
    <span class="hljs-title function_">setListData</span>(mockData);
    <span class="hljs-comment">// åˆå§‹åŒ–é«˜åº¦æ˜ å°„è¡¨ï¼ˆé»˜è®¤æœ€å°é«˜åº¦ï¼‰</span>
    <span class="hljs-keyword">const</span> initHeightMap = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Map</span>&lt;<span class="hljs-built_in">number</span>, <span class="hljs-built_in">number</span>&gt;();
    mockData.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">item</span>) =&gt;</span> {
      initHeightMap.<span class="hljs-title function_">set</span>(item.<span class="hljs-property">id</span>, <span class="hljs-variable constant_">MIN_ITEM_HEIGHT</span>);
    });
    <span class="hljs-title function_">setItemHeights</span>(initHeightMap);
    <span class="hljs-comment">// åˆå§‹åŒ–ç´¯è®¡é«˜åº¦</span>
    <span class="hljs-title function_">updateCumulativeHeights</span>(initHeightMap, mockData);
  };

  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-title function_">initData</span>();
    <span class="hljs-comment">// ç›‘å¬çª—å£å¤§å°å˜åŒ–</span>
    <span class="hljs-keyword">const</span> <span class="hljs-title function_">handleResize</span> = (<span class="hljs-params"/>) =&gt; {
      <span class="hljs-keyword">if</span> (virtualListRef.<span class="hljs-property">current</span>) {
        <span class="hljs-title function_">setScrollTop</span>(virtualListRef.<span class="hljs-property">current</span>.<span class="hljs-property">scrollTop</span>);
      }
    };
    <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'resize'</span>, handleResize);

    <span class="hljs-comment">// æ¸…ç†ç›‘å¬</span>
    <span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> {
      <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">removeEventListener</span>(<span class="hljs-string">'resize'</span>, handleResize);
      <span class="hljs-keyword">if</span> (scrollTimerRef.<span class="hljs-property">current</span>) {
        <span class="hljs-built_in">clearTimeout</span>(scrollTimerRef.<span class="hljs-property">current</span>);
      }
      itemHeights.<span class="hljs-title function_">clear</span>(); <span class="hljs-comment">// æ¸…ç©º Map é‡Šæ”¾å†…å­˜</span>
    };
  }, []);

  <span class="hljs-comment">// æ›´æ–°ç´¯è®¡é«˜åº¦ï¼ˆæ ¸å¿ƒå‡½æ•°ï¼‰</span>
  <span class="hljs-keyword">const</span> updateCumulativeHeights = <span class="hljs-title function_">useCallback</span>(
    <span class="hljs-function">(<span class="hljs-params">heightMap: <span class="hljs-built_in">Map</span>&lt;<span class="hljs-built_in">number</span>, <span class="hljs-built_in">number</span>&gt;, data: <span class="hljs-keyword">typeof</span> listData</span>) =&gt;</span> {
      <span class="hljs-keyword">const</span> cumulative = [<span class="hljs-number">0</span>];
      <span class="hljs-keyword">let</span> sum = <span class="hljs-number">0</span>;
      <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; data.<span class="hljs-property">length</span>; i++) {
        <span class="hljs-keyword">const</span> itemId = data[i].<span class="hljs-property">id</span>;
        sum += heightMap.<span class="hljs-title function_">get</span>(itemId) || <span class="hljs-variable constant_">MIN_ITEM_HEIGHT</span>;
        cumulative.<span class="hljs-title function_">push</span>(sum);
      }
      <span class="hljs-title function_">setCumulativeHeights</span>(cumulative);
    },
    [<span class="hljs-variable constant_">MIN_ITEM_HEIGHT</span>]
  );

  <span class="hljs-comment">// å¤„ç†å­ç»„ä»¶çš„é«˜åº¦æ›´æ–°äº‹ä»¶ï¼ˆå¯¹åº” Vue çš„ handleItemHeightUpdateï¼‰</span>
  <span class="hljs-keyword">const</span> handleItemHeightUpdate = <span class="hljs-title function_">useCallback</span>(
    <span class="hljs-function">(<span class="hljs-params">id: <span class="hljs-built_in">number</span>, height: <span class="hljs-built_in">number</span></span>) =&gt;</span> {
      <span class="hljs-comment">// é«˜åº¦æœªå˜åŒ–åˆ™è·³è¿‡</span>
      <span class="hljs-keyword">if</span> (itemHeights.<span class="hljs-title function_">get</span>(id) === height) <span class="hljs-keyword">return</span>;

      <span class="hljs-comment">// æ›´æ–°é«˜åº¦æ˜ å°„è¡¨</span>
      <span class="hljs-keyword">const</span> newHeightMap = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Map</span>(itemHeights);
      newHeightMap.<span class="hljs-title function_">set</span>(id, height);
      <span class="hljs-title function_">setItemHeights</span>(newHeightMap);

      <span class="hljs-comment">// å¼‚æ­¥æ›´æ–°ç´¯è®¡é«˜åº¦</span>
      <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
        <span class="hljs-title function_">updateCumulativeHeights</span>(newHeightMap, listData);
      }, <span class="hljs-number">0</span>);
    },
    [itemHeights, listData, updateCumulativeHeights]
  );

  <span class="hljs-comment">// æ»šåŠ¨èŠ‚æµå¤„ç†</span>
  <span class="hljs-keyword">const</span> handleScroll = <span class="hljs-title function_">useCallback</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">if</span> (!virtualListRef.<span class="hljs-property">current</span>) <span class="hljs-keyword">return</span>;

    <span class="hljs-comment">// èŠ‚æµï¼š20ms å†…åªæ›´æ–°ä¸€æ¬¡ scrollTop</span>
    <span class="hljs-keyword">if</span> (scrollTimerRef.<span class="hljs-property">current</span>) {
      <span class="hljs-built_in">clearTimeout</span>(scrollTimerRef.<span class="hljs-property">current</span>);
    }
    scrollTimerRef.<span class="hljs-property">current</span> = <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
      <span class="hljs-title function_">setScrollTop</span>(virtualListRef.<span class="hljs-property">current</span>!.<span class="hljs-property">scrollTop</span>);
    }, <span class="hljs-number">20</span>);
  }, []);

  <span class="hljs-comment">// å¯è§†åŒºåŸŸé«˜åº¦</span>
  <span class="hljs-keyword">const</span> viewportHeight = <span class="hljs-title function_">useMemo</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">return</span> virtualListRef.<span class="hljs-property">current</span>?.<span class="hljs-property">clientHeight</span> || <span class="hljs-variable constant_">MIN_ITEM_HEIGHT</span> * <span class="hljs-number">5</span>;
  }, []);

  <span class="hljs-comment">//  æ€»åˆ—è¡¨é«˜åº¦</span>
  <span class="hljs-keyword">const</span> totalHeight = <span class="hljs-title function_">useMemo</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">return</span> cumulativeHeights[cumulativeHeights.<span class="hljs-property">length</span> - <span class="hljs-number">1</span>] || <span class="hljs-number">0</span>;
  }, [cumulativeHeights]);

  <span class="hljs-comment">// èµ·å§‹ç´¢å¼•</span>
  <span class="hljs-keyword">const</span> startIndex = <span class="hljs-title function_">useMemo</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">const</span> totalItemCount = listData.<span class="hljs-property">length</span>;
    <span class="hljs-keyword">if</span> (totalItemCount === <span class="hljs-number">0</span>) <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
    <span class="hljs-keyword">if</span> (scrollTop &lt;= <span class="hljs-number">0</span>) <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;

    <span class="hljs-comment">// åå‘éå†æ‰¾èµ·å§‹ç´¢å¼•</span>
    <span class="hljs-keyword">let</span> baseStartIndex = <span class="hljs-number">0</span>;
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = cumulativeHeights.<span class="hljs-property">length</span> - <span class="hljs-number">1</span>; i &gt;= <span class="hljs-number">0</span>; i--) {
      <span class="hljs-keyword">if</span> (cumulativeHeights[i] &lt;= scrollTop) {
        baseStartIndex = i;
        <span class="hljs-keyword">break</span>;
      }
    }

    <span class="hljs-keyword">const</span> finalIndex = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">max</span>(<span class="hljs-number">0</span>, baseStartIndex - <span class="hljs-variable constant_">BUFFER</span>);
    <span class="hljs-keyword">return</span> <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">min</span>(finalIndex, totalItemCount - <span class="hljs-number">1</span>);
  }, [
    scrollTop,
    viewportHeight,
    totalHeight,
    cumulativeHeights,
    listData.<span class="hljs-property">length</span>,
  ]);

  <span class="hljs-comment">// ç»“æŸç´¢å¼•</span>
  <span class="hljs-keyword">const</span> endIndex = <span class="hljs-title function_">useMemo</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">const</span> totalItemCount = listData.<span class="hljs-property">length</span>;
    <span class="hljs-keyword">if</span> (totalItemCount === <span class="hljs-number">0</span>) <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;

    <span class="hljs-keyword">const</span> targetScrollBottom = scrollTop + viewportHeight;
    <span class="hljs-keyword">let</span> baseEndIndex = totalItemCount - <span class="hljs-number">1</span>;

    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; cumulativeHeights.<span class="hljs-property">length</span>; i++) {
      <span class="hljs-keyword">if</span> (cumulativeHeights[i] &gt; targetScrollBottom) {
        baseEndIndex = i - <span class="hljs-number">1</span>;
        <span class="hljs-keyword">break</span>;
      }
    }

    <span class="hljs-keyword">let</span> finalEndIndex = baseEndIndex + <span class="hljs-variable constant_">BUFFER</span>;
    finalEndIndex = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">min</span>(finalEndIndex, totalItemCount - <span class="hljs-number">1</span>);
    <span class="hljs-keyword">return</span> finalEndIndex;
  }, [scrollTop, viewportHeight, cumulativeHeights, listData.<span class="hljs-property">length</span>]);

  <span class="hljs-comment">// å¯è§†åŒºåˆ—è¡¨</span>
  <span class="hljs-keyword">const</span> visibleList = <span class="hljs-title function_">useMemo</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">return</span> startIndex &lt;= endIndex
      ? listData.<span class="hljs-title function_">slice</span>(startIndex, endIndex + <span class="hljs-number">1</span>)
      : [];
  }, [startIndex, endIndex, listData]);

  <span class="hljs-comment">// åç§»é‡</span>
  <span class="hljs-keyword">const</span> offsetY = <span class="hljs-title function_">useMemo</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">return</span> cumulativeHeights[startIndex] || <span class="hljs-number">0</span>;
  }, [startIndex, cumulativeHeights]);

  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"h-full bg-gradient-to-br from-indigo-600 to-purple-600 py-10 px-5"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"bg-white mt-10 h-[calc(100vh-200px)] rounded-xl"</span>&gt;</span>
        {/* æ»šåŠ¨å®¹å™¨ */}
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span>
          <span class="hljs-attr">ref</span>=<span class="hljs-string">{virtualListRef}</span>
          <span class="hljs-attr">className</span>=<span class="hljs-string">"h-full overflow-auto relative"</span>
          <span class="hljs-attr">onScroll</span>=<span class="hljs-string">{handleScroll}</span>
        &gt;</span>
          {/* å ä½å®¹å™¨ï¼šæ’‘å¼€æ»šåŠ¨æ¡ */}
          <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">style</span>=<span class="hljs-string">{{</span> <span class="hljs-attr">height:</span> `${<span class="hljs-attr">totalHeight</span>}<span class="hljs-attr">px</span>` }}&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>

          {/* å¯è§†åŒºåŸŸåˆ—è¡¨ï¼štransform åç§» */}
          <span class="hljs-tag">&lt;<span class="hljs-name">div</span>
            <span class="hljs-attr">className</span>=<span class="hljs-string">"absolute top-0 left-0 right-0"</span>
            <span class="hljs-attr">style</span>=<span class="hljs-string">{{</span> <span class="hljs-attr">transform:</span> `<span class="hljs-attr">translateY</span>(${<span class="hljs-attr">offsetY</span>}<span class="hljs-attr">px</span>)` }}
          &gt;</span>
            {visibleList.map((item) =&gt; (
              <span class="hljs-tag">&lt;<span class="hljs-name">VirtualListItem</span>
                <span class="hljs-attr">key</span>=<span class="hljs-string">{item.id}</span>
                <span class="hljs-attr">item</span>=<span class="hljs-string">{item}</span>
                <span class="hljs-attr">onUpdateHeight</span>=<span class="hljs-string">{handleItemHeightUpdate}</span>
              /&gt;</span>
            ))}
          <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  );
};

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title class_">VirtualList</span>;

</code></pre>
<h3 data-id="heading-10">4. å®ç°æ•ˆæœå›¾</h3>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2f94fc95662c463caed332ed77b1d3c6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y-R546w5LiA5Y-q5aSn5ZGG55Oc:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771040975&amp;x-signature=SGyg1H2pDISwd9X9leROtXl7YlA%3D" alt="åŠ¨é«˜è™šæ‹Ÿåˆ—è¡¨æ»šåŠ¨.gif" loading="lazy"/></p>
<hr/>
<h2 data-id="heading-11">å››ã€ æ€»ç»“ä¸é¿å‘æŒ‡å—</h2>
<h3 data-id="heading-12">1. ä¸ºä»€ä¹ˆéœ€è¦ç¼“å†²åŒºï¼ˆBUFFERï¼‰ï¼Ÿ</h3>
<p>å¦‚æœåªæ¸²æŸ“å¯è§éƒ¨åˆ†ï¼Œç”¨æˆ·å¿«é€Ÿæ»šåŠ¨æ—¶ï¼Œå¼‚æ­¥æ¸²æŸ“å¯èƒ½ä¼šå¯¼è‡´ç¬é—´çš„â€œç™½å±â€ã€‚è®¾ç½®ä¸Šä¸‹ç¼“å†²åŒºå¯ä»¥é¢„åŠ è½½éƒ¨åˆ† DOMï¼Œè®©æ»‘åŠ¨æ›´é¡ºæ»‘ã€‚</p>
<h3 data-id="heading-13">2. æ€§èƒ½è¿›ä¸€æ­¥ä¼˜åŒ–</h3>
<ul>
<li><strong>æ»šåŠ¨èŠ‚æµï¼ˆThrottleï¼‰</strong> ï¼šè™½ç„¶æ»šåŠ¨ç›‘å¬å¾ˆå¿«ï¼Œä½†åœ¨ <code>handleScroll</code> ä¸­åŠ å…¥ <code>requestAnimationFrame</code> æˆ– 20ms çš„èŠ‚æµï¼Œèƒ½æœ‰æ•ˆå‡è½»ä¸»çº¿ç¨‹å‹åŠ›ã€‚</li>
<li><strong>Key çš„é€‰æ‹©</strong>ï¼šåœ¨è™šæ‹Ÿåˆ—è¡¨ä¸­ï¼Œ<code>key</code> å¿…é¡»æ˜¯å”¯ä¸€çš„ <code>id</code>ï¼Œç»å¯¹ä¸èƒ½ä½¿ç”¨ <code>index</code>ï¼Œå¦åˆ™åœ¨æ»šåŠ¨é‡ç”¨ DOM æ—¶ä¼šå‡ºç°çŠ¶æ€é”™ä¹±ã€‚</li>
</ul>
<h3 data-id="heading-14">3. æ³¨æ„äº‹é¡¹</h3>
<ul>
<li><strong>å®šé«˜</strong>ï¼šé€»è¾‘ç®€å•ï¼Œæ€§èƒ½æé«˜ã€‚</li>
<li><strong>ä¸å®šé«˜</strong>ï¼šä¾èµ– <code>ResizeObserver</code>ï¼Œéœ€æ³¨æ„é¢‘ç¹é‡æ’å¯¹æ€§èƒ½çš„å½±å“ï¼Œå»ºè®®å¯¹ <code>updateCumulativeHeights</code> åšå¼‚æ­¥æ‰¹å¤„ç†ã€‚</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[è„šæœ¬ä¼ªè£…ï¼šè®© Python ä¸ Node.js åƒåŸç”Ÿ Shell å‘½ä»¤ä¸€æ ·è¿è¡Œ]]></title>    <link>https://juejin.cn/post/7603591775391973403</link>    <guid>https://juejin.cn/post/7603591775391973403</guid>    <pubDate>2026-02-07T01:59:16.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7603591775391973403" data-draft-id="7603584155785379890" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="è„šæœ¬ä¼ªè£…ï¼šè®© Python ä¸ Node.js åƒåŸç”Ÿ Shell å‘½ä»¤ä¸€æ ·è¿è¡Œ"/> <meta itemprop="keywords" content="JavaScript,Python,è¿ç»´"/> <meta itemprop="datePublished" content="2026-02-07T01:59:16.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ç«è½¦å¼ä½"/> <meta itemprop="url" content="https://juejin.cn/user/1345457960792808"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            è„šæœ¬ä¼ªè£…ï¼šè®© Python ä¸ Node.js åƒåŸç”Ÿ Shell å‘½ä»¤ä¸€æ ·è¿è¡Œ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1345457960792808/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ç«è½¦å¼ä½
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-07T01:59:16.000Z" title="Sat Feb 07 2026 01:59:16 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-07
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    18
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»3åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>åœ¨å¼€å‘è‡ªåŠ¨åŒ–å·¥å…·æˆ–å‘½ä»¤è¡Œå°ç©å…·æ—¶ï¼Œé¢‘ç¹è¾“å…¥ <code>python myscript.py</code> æˆ– <code>node index.js</code> éš¾å…æ˜¾å¾—ç¬¨æ‹™ã€‚ä¸ºäº†è®©è¿™äº›è„šæœ¬çœ‹èµ·æ¥æ›´åƒç³»ç»ŸåŸç”Ÿçš„äºŒè¿›åˆ¶å·¥å…·ï¼Œæˆ‘ä»¬éœ€è¦å¯¹å…¶è¿›è¡Œâ€œä¼ªè£…â€ã€‚</p>
<p>æœ¬æ–‡å°†å¸¦ä½ æ”»å…‹ Linux å’Œ Windows ä¸¤å¤§å¹³å°ï¼Œå®ç°è„šæœ¬çš„ç›´æ¥è°ƒç”¨ã€‚</p>
<h2 data-id="heading-0">ä¸€ã€ Linux ç¯å¢ƒï¼šåˆ©ç”¨ Shebang å®ç°ä¼˜é›…è°ƒç”¨</h2>
<p>åœ¨ç±» Unix ç³»ç»Ÿï¼ˆLinux, macOS, BSDï¼‰ä¸­ï¼Œå†…æ ¸æ”¯æŒä¸€ç§åä¸º <strong>Shebang</strong> çš„æœºåˆ¶ã€‚é€šè¿‡åœ¨æ–‡ä»¶å¤´éƒ¨æŒ‡å®šè§£é‡Šå™¨è·¯å¾„ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨è°ƒç”¨ç›¸åº”çš„ç¯å¢ƒæ¥è¿è¡Œä»£ç ã€‚</p>
<h4 data-id="heading-1">1. æ ¸å¿ƒæ­¥éª¤ï¼šShebang + å¯æ‰§è¡Œæƒé™</h4>
<p>è¦åœ¨ Linux ä¸Šå®ç°â€œä¼ªè£…â€ï¼Œä½ éœ€è¦å®Œæˆä»¥ä¸‹ä¸¤ä¸ªåŠ¨ä½œï¼š</p>
<p><strong>ç¬¬ä¸€æ­¥ï¼šåœ¨è„šæœ¬é¦–è¡Œæ·»åŠ  Shebang</strong>
æ¨èä½¿ç”¨ <code>/usr/bin/env</code> æ–¹å¼ï¼Œå®ƒä¼šè‡ªåŠ¨ä»ç”¨æˆ·çš„ <code>PATH</code> ç¯å¢ƒå˜é‡ä¸­å¯»æ‰¾è§£é‡Šå™¨ï¼Œå…·æœ‰æå¼ºçš„å¯ç§»æ¤æ€§ã€‚</p>
<ul>
<li><strong>Python ç¤ºä¾‹ï¼š</strong></li>
</ul>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment">#!/usr/bin/env python3</span>
<span class="hljs-comment"># -*- coding: utf-8 -*-</span>
<span class="hljs-keyword">import</span> sys
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"Python æ­£åœ¨è¿è¡Œï¼Œå‚æ•°ä¸º: <span class="hljs-subst">{sys.argv[<span class="hljs-number">1</span>:]}</span>"</span>)

</code></pre>
<ul>
<li><strong>Node.js ç¤ºä¾‹ï¼š</strong></li>
</ul>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-meta">#!/usr/bin/env node</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"Node.js è„šæœ¬å·²å¯åŠ¨ï¼Œå½“å‰å·¥ä½œç›®å½•:"</span>, process.<span class="hljs-title function_">cwd</span>());

</code></pre>
<p><strong>ç¬¬äºŒæ­¥ï¼šèµ‹äºˆæ‰§è¡Œæƒé™</strong>
åœ¨ç»ˆç«¯è¿è¡Œ <code>chmod +x</code> å‘½ä»¤ï¼Œå‘Šè¯‰æ–‡ä»¶ç³»ç»Ÿè¯¥æ–‡ä»¶å¯ä»¥è¢«æ‰§è¡Œï¼š</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">chmod</span> +x my_script.py

</code></pre>
<p>æ­¤æ—¶ï¼Œä½ å°±å¯ä»¥é€šè¿‡ <code>./my_script.py</code> ç›´æ¥è¿è¡Œå®ƒäº†ã€‚</p>
<h4 data-id="heading-2">2. è¿›é˜¶ï¼šå»é™¤åç¼€å¹¶å…¨å±€åŒ–</h4>
<p>å¦‚æœä½ æƒ³åœ¨ä»»ä½•è·¯å¾„ä¸‹é€šè¿‡è¾“å…¥ <code>mytool</code>ï¼ˆè€Œä¸æ˜¯ <code>./mytool.py</code>ï¼‰æ¥è¿è¡Œè„šæœ¬ï¼š</p>
<ol>
<li><strong>é‡å‘½åå¹¶å»æ‰åç¼€</strong>ï¼š<code>mv my_script.py mytool</code></li>
<li><strong>ç§»å…¥ PATH è·¯å¾„</strong>ï¼š</li>
</ol>
<pre><code class="hljs language-bash" lang="bash">sudo <span class="hljs-built_in">mv</span> mytool /usr/local/bin/

</code></pre>
<p><em>æ³¨ï¼š<code>/usr/local/bin</code> é€šå¸¸é»˜è®¤åœ¨ç³»ç»Ÿ PATH ä¸­ï¼Œè¿™æ ·ä½ åªéœ€è¾“å…¥ <code>mytool</code> å³å¯ç›´æ¥è§¦å‘ã€‚</em></p>
<hr/>
<h2 data-id="heading-3">äºŒã€ Windows ç¯å¢ƒï¼šä»æ‰¹å¤„ç†åˆ°ç¯å¢ƒå…³è”</h2>
<p>Windows å¹¶ä¸åŸç”Ÿæ”¯æŒ Shebang æœºåˆ¶ï¼ˆé™¤éåœ¨ WSL å†…éƒ¨è¿è¡Œï¼‰ã€‚å®ƒä¸»è¦ä¾é <strong>æ–‡ä»¶æ‰©å±•åå…³è”</strong>ã€‚</p>
<h4 data-id="heading-4">1. æ–¹æ¡ˆ Aï¼šä½¿ç”¨ .bat åŒ…è£…å™¨ï¼ˆæ¨èï¼‰</h4>
<p>è¿™æ˜¯æœ€ç¨³å¦¥çš„æ–¹æ³•ã€‚é€šè¿‡åˆ›å»ºä¸€ä¸ªç®€å•çš„æ‰¹å¤„ç†æ–‡ä»¶ï¼Œå°†æ¥æ”¶åˆ°çš„æ‰€æœ‰å‚æ•°ï¼ˆç”¨ <code>%*</code> è¡¨ç¤ºï¼‰è½¬å‘ç»™è„šæœ¬è§£é‡Šå™¨ã€‚</p>
<ul>
<li><strong>åˆ›å»º <code>mytool.bat</code>ï¼š</strong></li>
</ul>
<pre><code class="hljs language-batch" lang="batch">@echo off
python "C:\scripts\my_script.py" %*

</code></pre>
<p><em>æ³¨ï¼š<code>@echo off</code> ç”¨äºéšè—å‘½ä»¤æœ¬èº«çš„æ‰§è¡Œè¡Œï¼Œ<code>%*</code> ç¡®ä¿ä½ ä¼ é€’ç»™ <code>.bat</code> çš„å‚æ•°èƒ½åŸå°ä¸åŠ¨åœ°ä¼ ç»™ Pythonã€‚</em></p>
<h4 data-id="heading-5">2. æ–¹æ¡ˆ Bï¼šåˆ©ç”¨æ–‡ä»¶å…³è”</h4>
<p>å¦‚æœä½ å®‰è£… Python æ—¶å‹¾é€‰äº† <strong>"Add Python to PATH"</strong>ï¼ŒWindows ä¼šè‡ªåŠ¨å°† <code>.py</code> æ–‡ä»¶å…³è”åˆ° <code>python.exe</code>ã€‚</p>
<ul>
<li>åœ¨å‘½ä»¤è¡Œç›´æ¥è¾“å…¥ <code>script.py</code> å³å¯è¿è¡Œã€‚</li>
<li><strong>æ³¨æ„</strong>ï¼š<code>.js</code> æ–‡ä»¶åœ¨ Windows ä¸Šé»˜è®¤å…³è”çš„æ˜¯è€æ—§çš„ <code>WScript</code> (Windows Script Host)ï¼Œè¿™ä¼šå¯¼è‡´è¿è¡Œ Node.js è„šæœ¬æ—¶æŠ¥é”™ã€‚ä½ éœ€è¦æ‰‹åŠ¨ä¿®æ”¹ <code>.js</code> çš„æ‰“å¼€æ–¹å¼ä¸º <code>node.exe</code>ã€‚</li>
</ul>
<h4 data-id="heading-6">3. æ–¹æ¡ˆ Cï¼šPowerShell åˆ«åï¼ˆAliasï¼‰</h4>
<p>å¦‚æœä½ æ˜¯ PowerShell ç”¨æˆ·ï¼Œå¯ä»¥åœ¨é…ç½®æ–‡ä»¶ä¸­å®šä¹‰å‡½æ•°æ¥å®ç°ï¼š</p>
<pre><code class="hljs language-powershell" lang="powershell"># åœ¨ $PROFILE æ–‡ä»¶ä¸­æ·»åŠ 
function Run-MyTool { python "C:\path\to\script.py" $args }
Set-Alias -Name mytool -Value Run-MyTool

</code></pre>
<hr/>
<h2 data-id="heading-7">ä¸‰ã€ è·¨å¹³å°å¯¹æ¯”æ€»ç»“</h2>






























<table><thead><tr><th>ç‰¹æ€§</th><th>Linux / macOS</th><th>Windows</th></tr></thead><tbody><tr><td><strong>åº•å±‚æœºåˆ¶</strong></td><td>Shebang (<code>#!</code>)</td><td>æ–‡ä»¶åç¼€åå…³è”</td></tr><tr><td><strong>æ¨èåšæ³•</strong></td><td><code>chmod +x</code> + <code>/usr/bin/env</code></td><td><code>.bat</code> æˆ– <code>.cmd</code> åŒ…è£…</td></tr><tr><td><strong>å…¨å±€è°ƒç”¨</strong></td><td>æ”¾å…¥ <code>/usr/local/bin</code></td><td>å°†è„šæœ¬æ‰€åœ¨æ–‡ä»¶å¤¹åŠ å…¥ç¯å¢ƒå˜é‡ <code>Path</code></td></tr><tr><td><strong>å‚æ•°ä¼ é€’</strong></td><td>åŸç”Ÿæ”¯æŒ</td><td>éœ€åœ¨æ‰¹å¤„ç†ä¸­ä½¿ç”¨ <code>%*</code></td></tr></tbody></table>
<hr/>
<h2 data-id="heading-8">å››ã€ ç»“è®ºä¸è¡ŒåŠ¨å»ºè®®</h2>
<p>å°†è„šæœ¬è½¬åŒ–ä¸ºå·¥å…·ä¸ä»…æ˜¯ä¸ºäº†â€œå¥½çœ‹â€ï¼Œæ›´æ˜¯ä¸ºäº†æå‡è‡ªåŠ¨åŒ–æµè½¬çš„æ•ˆç‡ã€‚</p>
<h4 data-id="heading-9">æ ¸å¿ƒè¡ŒåŠ¨å»ºè®®ï¼š</h4>
<ol>
<li>**ä¼˜å…ˆä½¿ç”¨ <code>/usr/bin/env**</code>ï¼šæ— è®ºå¼€å‘ä»€ä¹ˆè„šæœ¬ï¼Œé¦–è¡Œå…»æˆå†™ Shebang çš„ä¹ æƒ¯ï¼Œè¿™èƒ½æ˜¾è‘—é™ä½ Linux ç”¨æˆ·çš„ä½¿ç”¨é—¨æ§›ã€‚</li>
<li><strong>å°è£…ä¸ºå·¥å…·åŒ…</strong>ï¼šå¦‚æœä½ çš„è„šæœ¬è¾ƒå¤šï¼Œå»ºè®®å°†å…¶ç»Ÿä¸€æ”¾åœ¨ä¸€ä¸ªç›®å½•ä¸‹ï¼ˆå¦‚ <code>~/bin</code> æˆ– <code>C:\tools</code>ï¼‰ï¼Œå¹¶å°†è¯¥ç›®å½•æ·»åŠ åˆ°ç³»ç»Ÿçš„ <code>PATH</code> ç¯å¢ƒå˜é‡ä¸­ã€‚</li>
<li><strong>å¤„ç†è·¨å¹³å°å·®å¼‚</strong>ï¼šå¯¹äºéœ€è¦è·¨å¹³å°åˆ†å‘çš„å·¥å…·ï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨ <code>poetry</code> (Python) æˆ– <code>npm bin</code> (Node.js) æä¾›çš„ Entry Points åŠŸèƒ½ï¼Œå®ƒä»¬ä¼šè‡ªåŠ¨ä¸ºä½ ç”Ÿæˆé€‚é…å„å¹³å°çš„å¯åŠ¨å™¨ã€‚</li>
</ol>
<hr/>
<p><strong>å‚è€ƒæ¥æºï¼š</strong></p>
<ul>
<li>Linux Manual Pages: <a href="https://link.juejin.cn?target=https%3A%2F%2Fman7.org%2Flinux%2Fman-pages%2Fman2%2Fexecve.2.html" target="_blank" title="https://man7.org/linux/man-pages/man2/execve.2.html" ref="nofollow noopener noreferrer">execve(2) - Shebang mechanism</a></li>
<li>Python Documentation: <a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.python.org%2F3%2Fusing%2Fwindows.html" target="_blank" title="https://docs.python.org/3/using/windows.html" ref="nofollow noopener noreferrer">Using Python on Windows</a></li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item>  </channel></rss>