<?xml version="1.0" encoding="UTF-8"?><rss version="2.0">  <channel>      <title>æ˜é‡‘æ–‡ç« æ¨è</title>      <link>https://juejin.cn/recommended?sort=newest</link>      <description>ä¸€ä¸ªå¸®åŠ©å¼€å‘è€…æˆé•¿çš„ç¤¾åŒº</description>      <generator>python juejin_recom.py @Pi20</generator>      <item>    <title><![CDATA[TypeWords:è®©è‹±è¯­å­¦ä¹ æ›´é«˜æ•ˆçš„æ‰“å­—ç»ƒä¹ ç¥å™¨]]></title>    <link>https://juejin.cn/post/7581406561685176366</link>    <guid>https://juejin.cn/post/7581406561685176366</guid>    <pubDate>2025-12-08T13:11:48.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581406561685176366" data-draft-id="7581324171398332462" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="TypeWords:è®©è‹±è¯­å­¦ä¹ æ›´é«˜æ•ˆçš„æ‰“å­—ç»ƒä¹ ç¥å™¨"/> <meta itemprop="keywords" content="å¼€æº"/> <meta itemprop="datePublished" content="2025-12-08T13:11:48.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ä¿®å·±xj"/> <meta itemprop="url" content="https://juejin.cn/user/2641475936724142"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            TypeWords:è®©è‹±è¯­å­¦ä¹ æ›´é«˜æ•ˆçš„æ‰“å­—ç»ƒä¹ ç¥å™¨
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2641475936724142/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ä¿®å·±xj
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-08T13:11:48.000Z" title="Mon Dec 08 2025 13:11:48 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»4åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>åœ¨æ—¥å¸¸å·¥ä½œå’Œç”Ÿæ´»ä¸­ï¼Œæˆ‘ä»¬å¸¸å¸¸éœ€è¦ç”¨åˆ°è‹±æ–‡ï¼Œå°¤å…¶æ˜¯åœ¨æŸ¥é˜…æŠ€æœ¯æ–‡æ¡£ç­‰åœºåˆã€‚å°½ç®¡ç›®å‰ç¿»è¯‘å·¥å…·ç›¸å½“ä¾¿æ·ï¼Œä½†å¦‚æœèƒ½å¤Ÿè‡ªå·±æµç•…é˜…è¯»ï¼Œæ•ˆç‡ä¼šå¤§å¤§æé«˜ã€‚ç„¶è€Œï¼Œæƒ³è¦å­¦å¥½ã€è¯´å¥½è‹±è¯­é€šå¸¸å¹¶ä¸å®¹æ˜“ï¼Œå¾€å¾€éœ€è¦æŠ•å…¥å¤§é‡çš„æ—¶é—´å’Œé‡‘é’±å»æŠ¥ç­å­¦ä¹ ã€‚é‚£ä¹ˆï¼Œæœ‰æ²¡æœ‰ä¸€ç§æ›´åŠ è½»æ¾æœ‰æ•ˆçš„æ–¹æ³•æ¥æå‡è‹±è¯­é˜…è¯»èƒ½åŠ›å‘¢ï¼Ÿ</p>
<p>åœ¨è‹±è¯­å­¦ä¹ è¿‡ç¨‹ä¸­ï¼ŒèƒŒå•è¯å¸¸å¸¸æˆä¸ºä»¤äººæœ›è€Œå´æ­¥çš„ä¸€å…³ã€‚ä¼ ç»Ÿçš„è®°å¿†æ–¹å¼å®¹æ˜“æ˜¾å¾—æ¯ç‡¥ï¼Œæ•ˆæœä¹Ÿæœªå¿…ç†æƒ³ã€‚ä»Šå¤©ï¼Œæˆ‘æƒ³å‘å¤§å®¶æ¨èä¸€æ¬¾æ‰“ç ´å¸¸è§„çš„å¼€æºå­¦ä¹ å·¥å…·â€”â€”TypeWordsã€‚å®ƒå·§å¦™åœ°å°†æ‰“å­—ç»ƒä¹ ä¸è‹±è¯­å­¦ä¹ èä¸ºä¸€ä½“ï¼Œè®©ä½ åœ¨æ•²å‡»é”®ç›˜çš„è¿‡ç¨‹ä¸­ï¼Œä¸çŸ¥ä¸è§‰åœ°æå‡è‹±è¯­æ°´å¹³ã€‚</p>
<p><a href="https://link.juejin.cn?target=http%3A%2F%2Fchevereto.xiuji.mynatapp.cc%2Fimage%2FHHVX" target="_blank" title="http://chevereto.xiuji.mynatapp.cc/image/HHVX" ref="nofollow noopener noreferrer"><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4d08036a6fe84815a65a23445f62d72b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5L-u5bexeGo=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765804308&amp;x-signature=ZolqEqK0LOlE%2B3CKqUoLjQsKhPQ%3D" alt="favicon.md.png" loading="lazy"/></a></p>
<p>favicon.md.png</p>
<h2 data-id="heading-0">é¡¹ç›®ç®€ä»‹</h2>
<p>TypeWords æ˜¯ä¸€ä¸ªåŸºäº Vue å¼€å‘çš„ç°ä»£åŒ–è‹±è¯­å­¦ä¹ å·¥å…·ï¼Œå®ƒé€šè¿‡<strong>æ‰“å­—è¾“å…¥</strong>çš„æ–¹å¼å¸®åŠ©ä½ è®°å¿†å•è¯å’ŒèƒŒè¯µæ–‡ç« ã€‚é¡¹ç›®çš„æ ¸å¿ƒç†å¿µæ˜¯ï¼šâ€œå­¦ä¹ è‹±è¯­ï¼Œä¸€æ¬¡æ•²å‡»ï¼Œä¸€ç‚¹è¿›æ­¥ï¼›è®°å¿†ä¸å†ç›²ç›®ï¼Œå­¦ä¹ æ›´é«˜æ•ˆâ€ã€‚</p>
<p>è¯¥é¡¹ç›®å†github ä¸Šå·²æœ‰ 5.9k star</p>
<p>githubåœ°å€ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fzyronon%2FTypeWords" target="_blank" title="https://github.com/zyronon/TypeWords" ref="nofollow noopener noreferrer">github.com/zyronon/Typâ€¦</a></p>
<p>åœ¨çº¿ä½¿ç”¨åœ°å€ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Ftypewords.cc%2F" target="_blank" title="https://typewords.cc/" ref="nofollow noopener noreferrer">typewords.cc/</a></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7f81506f50cf44d7aeafc6835a783c1a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5L-u5bexeGo=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765804308&amp;x-signature=xJNVU5%2BCvpXdH2efYIKBu92IiHk%3D" alt="_20251208_070501.png" loading="lazy"/></p>
<p>_20251208_070501.png</p>
<h2 data-id="heading-1">ä¸»è¦ç‰¹è‰²åŠŸèƒ½</h2>
<h3 data-id="heading-2">ğŸ¯ æ™ºèƒ½å•è¯ç»ƒä¹ </h3>
<ul>
<li>
<p><strong>å››ç§å­¦ä¹ æ¨¡å¼</strong>ï¼š</p>
<ul>
<li>è·Ÿæ‰“æ¨¡å¼ï¼šçœ‹ç€å•è¯å’Œé‡Šä¹‰æ‰“å­—</li>
<li>è¾¨è®¤æ¨¡å¼ï¼šæ ¹æ®é‡Šä¹‰æ‰“å‡ºæ­£ç¡®å•è¯</li>
<li>å¤ä¹ æ¨¡å¼ï¼šå·©å›ºè®°å¿†</li>
<li>é»˜å†™æ¨¡å¼ï¼šæŒ‘æˆ˜è‡ªæˆ‘è®°å¿†</li>
</ul>
</li>
<li>
<p><strong>æ™ºèƒ½è®°å¿†æ›²çº¿</strong>ï¼šç³»ç»Ÿè‡ªåŠ¨è®¡ç®—æœ€ä½³å¤ä¹ æ—¶é—´</p>
</li>
<li>
<p><strong>ä¸°å¯Œèµ„æº</strong>ï¼šæ¯ä¸ªå•è¯éƒ½é…æœ‰éŸ³æ ‡ã€ç¾è‹±å‘éŸ³ã€ä¾‹å¥ã€çŸ­è¯­ã€è¿‘ä¹‰è¯ã€è¯æºç­‰</p>
</li>
</ul>
<h3 data-id="heading-3">ğŸ“š é«˜æ•ˆæ–‡ç« èƒŒè¯µ</h3>
<ul>
<li><strong>å†…ç½®ç»å…¸æ•™æ</strong>ï¼šåŒ…å«å¤šç§è‹±è¯­å­¦ä¹ ææ–™</li>
<li><strong>è‡ªå®šä¹‰å¯¼å…¥</strong>ï¼šæ”¯æŒæ·»åŠ ä¸ªäººæ–‡ç« </li>
<li><strong>æ™ºèƒ½è¾…åŠ©</strong>ï¼šä¸€é”®ç¿»è¯‘ã€è¯‘æ–‡å¯¹ç…§ã€é€å¥è¾“å…¥ã€è‡ªåŠ¨å‘éŸ³</li>
<li><strong>å¬åŠ›å¼ºåŒ–</strong>ï¼šæ”¯æŒè¾¹å¬è¾¹é»˜å†™</li>
</ul>
<h3 data-id="heading-4">ğŸ“Š å­¦ä¹ ç®¡ç†</h3>
<ul>
<li><strong>é”™è¯æœ¬</strong>ï¼šè‡ªåŠ¨è®°å½•è¾“å…¥é”™è¯¯çš„å•è¯</li>
<li><strong>æ”¶è—å¤¹</strong>ï¼šä¸»åŠ¨æ”¶è—é‡ç‚¹å•è¯</li>
<li><strong>å·²æŒæ¡</strong>ï¼šæ ‡è®°å·²å­¦ä¼šçš„å•è¯</li>
</ul>
<h2 data-id="heading-5">ğŸ“¦ å®‰è£…ä¸éƒ¨ç½²</h2>
<p>TypeWords ä½œä¸ºä¸€æ¬¾ Web åº”ç”¨ï¼Œéƒ¨ç½²å’Œä½¿ç”¨éƒ½éå¸¸ç®€å•ã€‚</p>
<h3 data-id="heading-6">æ–¹æ³•ä¸€ï¼šç›´æ¥è®¿é—®åœ¨çº¿ç‰ˆæœ¬</h3>
<p>æœ€ç®€å•çš„æ–¹å¼æ˜¯ç›´æ¥è®¿é—®é¡¹ç›®çš„åœ¨çº¿ä½¿ç”¨åœ°å€ï¼š</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Ftypewords.cc%2F" target="_blank" title="https://typewords.cc/" ref="nofollow noopener noreferrer">typewords.cc/</a></p>
<h3 data-id="heading-7">æ–¹æ³•äºŒï¼šæœ¬åœ°å¯åŠ¨</h3>
<p>æ­¤é¡¹ç›®å¯å•ç‹¬è¿è¡Œï¼Œæ•°æ®ä¿å­˜åœ¨æœ¬åœ°ï¼Œæ¢è®¾å¤‡éœ€æ‰‹åŠ¨å¤‡ä»½æ•°æ®ï¼Œä¸å½±å“æ­£å¸¸ä½¿ç”¨ï¼› æ­¤é¡¹ç›®æ˜¯åŸºäºVueå¼€å‘çš„ï¼Œéœ€è¦ node ç¯å¢ƒæ¥è¿è¡Œã€‚ æˆ‘ä½¿ç”¨nodeç‰ˆæœ¬æ˜¯<code>v22.12.0</code></p>
<p>ä»githubä¸‹è½½æ­¤é¡¹ç›®æºç ï¼Œåœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹ï¼Œæ‰“å¼€å‘½ä»¤è¡Œï¼Œè¿è¡Œ<code>npm install</code>æ¥ä¸‹è½½ä¾èµ–ã€‚ æ‰§è¡Œ<code>npm run dev</code>æ¥å¯åŠ¨é¡¹ç›®ï¼Œé¡¹ç›®é»˜è®¤åœ°å€ä¸º<code>http://localhost:3000</code> åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€<code>http://localhost:3000</code> æ¥è®¿é—®é¡¹ç›®ã€‚ æ‰§è¡Œ<code>npm run build</code>æ‰“åŒ…é¡¹ç›®æ–‡ä»¶</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a8280a15d6884acebb3f8ada0e37b0df~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5L-u5bexeGo=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765804308&amp;x-signature=75jCRkTj%2FsqKiRa84wOwO%2FzraRE%3D" alt="_20251208_162522.png" loading="lazy"/></p>
<p>_20251208_162522.png</p>
<h3 data-id="heading-8">æ–¹æ³•ä¸‰ï¼šDockeréƒ¨ç½²</h3>
<ul>
<li>æ‰“åŒ…æœåŠ¡</li>
</ul>
<p>ä¸‹è½½é¡¹ç›®ä¹‹åä½¿ç”¨<code>npm run build</code> æ‰“åŒ…é¡¹ç›®</p>
<ul>
<li>æ„å»ºé•œåƒ</li>
</ul>
<p>åˆ›å»º<code>Dockerfile</code>æ–‡ä»¶,å†…å®¹å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># ä½¿ç”¨å®˜æ–¹ nginx 1.21.5 é•œåƒä½œä¸ºåŸºç¡€é•œåƒ</span>
FROM nginx:1.21.5
<span class="hljs-comment"># è®¾ç½®ç»´æŠ¤è€…ä¿¡æ¯ï¼ˆå¯é€‰ï¼‰</span>
LABEL maintainer=<span class="hljs-string">"xj"</span>
<span class="hljs-comment"># è®¾ç½®å·¥ä½œç›®å½•</span>
WORKDIR /usr/share/nginx/html

<span class="hljs-comment"># å¤åˆ¶å‰ç«¯æ„å»ºæ–‡ä»¶åˆ°nginxç›®å½•</span>
COPY ./dist/ ./

<span class="hljs-comment"># è®¾ç½®æ­£ç¡®çš„æ–‡ä»¶æƒé™</span>
RUN  <span class="hljs-built_in">chmod</span> -R 755 /usr/share/nginx/html


<span class="hljs-comment"># æš´éœ²ç«¯å£</span>
EXPOSE 80

<span class="hljs-comment"># nginxå®¹å™¨é»˜è®¤å¯åŠ¨nginxï¼Œä¿æŒå‰å°è¿è¡Œ</span>
CMD [<span class="hljs-string">"nginx"</span>, <span class="hljs-string">"-g"</span>, <span class="hljs-string">"daemon off;"</span>]
</code></pre>
<p>å°†æ„å»ºä¹‹åçš„<code>dist</code>æ–‡ä»¶å¤¹å¤åˆ¶åˆ°åŒçº§ç›®å½•ä¸‹,ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ„å»ºé•œåƒ</p>
<pre><code class="hljs language-bash" lang="bash">docker build -t xj/typewords:v2.0 .
</code></pre>
<ul>
<li>docker-composeéƒ¨ç½²</li>
</ul>
<p>åˆ›å»ºéƒ¨ç½²ç›®å½•<code>typewords</code>,åœ¨æ­¤ç›®å½•ä¸‹æ„å»ºdocker-compose.ymlæ–‡ä»¶</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">services:</span>
  <span class="hljs-attr">typewords:</span>
    <span class="hljs-comment"># ä¹Ÿå¯ä»¥ä½¿ç”¨åšä¸»æ„å»ºçš„é•œåƒ registry.cn-hangzhou.aliyuncs.com/xj_lew/typewords:v2.0</span>
    <span class="hljs-attr">image:</span> <span class="hljs-string">xj/typewords:v2.0</span>
    <span class="hljs-attr">container_name:</span> <span class="hljs-string">typewords</span>
    <span class="hljs-attr">restart:</span> <span class="hljs-string">always</span>
    <span class="hljs-attr">logging:</span>
      <span class="hljs-attr">driver:</span> <span class="hljs-string">'json-file'</span>
      <span class="hljs-attr">options:</span>
        <span class="hljs-attr">max-size:</span> <span class="hljs-string">'5g'</span>
    <span class="hljs-attr">environment:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">NGINX_PORT=80</span>
    <span class="hljs-attr">ports:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-number">8090</span><span class="hljs-string">:80</span>
</code></pre>
<p>åœ¨æ­¤ç›®å½•ä¸‹ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å¯åŠ¨æœåŠ¡</p>
<pre><code class="hljs">docker-compose up -d 
</code></pre>
<p>åˆ°æ­¤ï¼Œæˆ‘ä»¬æœåŠ¡å°±éƒ¨ç½²å®Œäº†</p>
<h2 data-id="heading-9">ä½¿ç”¨</h2>
<p>éƒ¨ç½²å®Œä¹‹ååœ¨æµè§ˆå™¨ä¸­æ‰“å¼€æœåŠ¡ï¼Œé€‰æ‹©æˆ‘ä»¬éœ€è¦å­¦ä¹ çš„å•è¯æˆ–è€…æ–‡ç« å°±å¯ä»¥å¼€å§‹å­¦ä¹ äº†</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/634004d769ad4b4985596d9480bb5aea~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5L-u5bexeGo=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765804308&amp;x-signature=Uit4ODR2gTluI4zyzfAANdlT7KE%3D" alt="_20251208_162423.png" loading="lazy"/></p>
<p>_20251208_162423.png</p>
<h3 data-id="heading-10">ç¼ºç‚¹</h3>
<ul>
<li>æ•°æ®åœ¨æµè§ˆå™¨æœ¬åœ°å­˜å‚¨ï¼Œå¤šç«¯æ•°æ®ä¸åŒæ­¥</li>
<li>å†…ç½®è¯å…¸é€‰æ‹©æœ‰é™</li>
</ul>
<h2 data-id="heading-11">ç»“è¯­</h2>
<p>TypeWords ä¸ä»…ä»…æ˜¯ä¸€ä¸ªèƒŒå•è¯å·¥å…·ï¼Œå®ƒæ˜¯ä¸€ä¸ªå…¨æ–°çš„è‹±è¯­å­¦ä¹ ä½“éªŒã€‚å®ƒå°†æ¯ç‡¥çš„è®°å¿†è¿‡ç¨‹è½¬åŒ–ä¸ºæœ‰è¶£çš„äº’åŠ¨ç»ƒä¹ ï¼Œè®©å­¦ä¹ è‹±è¯­å˜å¾—æ›´åŠ è½»æ¾é«˜æ•ˆã€‚</p>
<p>æ— è®ºä½ æ˜¯è‹±è¯­å­¦ä¹ è€…ï¼Œè¿˜æ˜¯å¯¹å¼€æºé¡¹ç›®æ„Ÿå…´è¶£çš„å¼€å‘è€…ï¼ŒTypeWords éƒ½å€¼å¾—ä½ å°è¯•å’Œå…³æ³¨ã€‚ç°åœ¨å°±è®¿é—® typewords.cc å¼€å§‹ä½ çš„é«˜æ•ˆè‹±è¯­å­¦ä¹ ä¹‹æ—…å§ï¼</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ã€Virtual World 04ã€‘æˆ‘ä»¬çš„ç›®æ ‡ï¼Œæ— é™å®‡å®™ï¼ï¼]]></title>    <link>https://juejin.cn/post/7581210455827759140</link>    <guid>https://juejin.cn/post/7581210455827759140</guid>    <pubDate>2025-12-08T13:22:09.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581210455827759140" data-draft-id="7577914902431268910" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ã€Virtual World  04ã€‘æˆ‘ä»¬çš„ç›®æ ‡ï¼Œæ— é™å®‡å®™ï¼ï¼"/> <meta itemprop="keywords" content="å‰ç«¯,JavaScript,ä»£ç è§„èŒƒ"/> <meta itemprop="datePublished" content="2025-12-08T13:22:09.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å¤§æ€ªv"/> <meta itemprop="url" content="https://juejin.cn/user/4391901700043284"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ã€Virtual World  04ã€‘æˆ‘ä»¬çš„ç›®æ ‡ï¼Œæ— é™å®‡å®™ï¼ï¼
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4391901700043284/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å¤§æ€ªv
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-08T13:22:09.000Z" title="Mon Dec 08 2025 13:22:09 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»8åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>è¿™æ˜¯<strong>çº¯å‰ç«¯æ‰‹æ“è™šæ‹Ÿä¸–ç•Œ</strong>ç¬¬å››ç¯‡ã€‚</p>
<p>å‰ç«¯ä½¬ä»¬ï¼Œå‰ä¸‰ç¯‡çš„åŸºç¡€æ‰“å¥½ï¼ŒåŸºæœ¬åˆ›å»ºä¸€ä¸ªå•ä½“çš„åº”ç”¨æ²¡å•¥é—®é¢˜äº†ã€‚ä½†å‰ç«¯ä½¬è‚¯å®šå‘ç°ä¸€ä¸ªå¾ˆå°´å°¬çš„é—®é¢˜!</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bbf44cf051754ed997114b41a5817644~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5oCqdg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765804929&amp;x-signature=%2Bqr4wyetPaIm%2BhteO659ayWLL2k%3D" alt="93B1A00879A9B67271080936B8A2D89CE1D69417_size242_w423_h220.gif" loading="lazy"/></p>
<p>é‚£å°±æ˜¯æˆ‘ä»¬çš„ Canvas åªæœ‰ 600x600ã€‚</p>
<p>å¦‚æœä½ æƒ³ç›´æ¥æä¸€å¹…ã€Šæ¸…æ˜ä¸Šæ²³å›¾ã€‹ï¼Œé‚£ç”»ç€ç”»ç€ï¼Œå°±ä¼šå‘ç°â€”â€”<strong>æ²¡åœ°å„¿äº†</strong>ã€‚</p>
<h2 data-id="heading-0">ç«‹Flag</h2>
<p>æŒ‰ç…§æœ€ç®€å•çš„æ–¹æ³•ï¼ŒæŠŠcanvasåŠ å¤§ï¼ŒæŠŠå±å¹•åŠ å¤§ï¼Œè¿™æ ·å°±ä¸åª600x600äº†ã€‚</p>
<p>But!!!!</p>
<p>è£…Xè£…åˆ°å¤´,æŠ æŠ æœæœåŠ é‚£ç‚¹èµ„æºï¼Œè¿˜æ˜¯ä¸å¤Ÿç”¨ã€‚æ—¢ç„¶æ˜¯è™šæ‹Ÿä¸–ç•Œï¼Œæˆ‘ä»¬çš„ç›®å‰ï¼Œå°±åº”è¯¥æ— é™å®‡å®™ï¼</p>
<p>è¿™ç¯‡ï¼Œå°±æ˜¯è¦æŠŠæƒ³æ³•å˜æˆç°å®ï¼Œä¸€ä¸ªé€šå‘æ— é™ä¸–ç•Œçš„â€œçª—å£â€ï¼Œå®ç°ä¸€ä¸ª<strong>è™šæ‹Ÿæ‘„åƒæœºï¼ˆVirtual Cameraï¼‰</strong> ã€‚ä½ çœ‹åˆ°çš„åªæ˜¯æ‘„åƒæœºæ‹åˆ°çš„ç”»é¢ï¼Œè€Œä¸–ç•Œæœ¬èº«ï¼Œä½ çš„æ¢¦æƒ³æœ‰å¤šå¤§ï¼Œé‚£ä¹ˆå°±æœ‰å¤šå¤§ã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a49cca0e7b564cb281faaa3c0fdcf0c9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5oCqdg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765804929&amp;x-signature=xdE884%2BrsSsB9OkRz0dFYPl1%2BvY%3D" alt="timg (1).gif" loading="lazy"/></p>
<hr/>
<h2 data-id="heading-1">æˆ˜ç•¥æ€è€ƒ</h2>
<p>ä¸Šäº†<code>class</code>çš„è´¼èˆ¹ï¼Œé¦–å…ˆæƒ³æ³•å°±æ˜¯æŠ½è±¡ä¸€ä¸ªç±»ï¼Œæ¥ç®¡ç†è¿™ä¸ªã€‚<strong><code>Viewport</code>ï¼ˆè§†å£ï¼‰</strong> ï¼Œä¸“é—¨å¤„ç†è¿™äº›äº‹æƒ…ã€‚</p>
<p>å®ƒçš„æ ¸å¿ƒåŠŸèƒ½åªæœ‰ä¸¤ä¸ªï¼š</p>
<ol>
<li><strong>åæ ‡è½¬æ¢</strong>ï¼šææ¸…æ¥šâ€œé¼ æ ‡ç‚¹åœ¨å±å¹•ä¸Šçš„ (100,100)â€åˆ°åº•å¯¹åº”â€œè™šæ‹Ÿä¸–ç•Œé‡Œçš„å“ªä¸€ä¸ªåæ ‡â€ã€‚</li>
<li><strong>å¹³ç§»äº¤äº’ï¼ˆPanï¼‰</strong> ï¼šæŒ‰ä½ <strong>ç©ºæ ¼é”®</strong> + <strong>é¼ æ ‡å·¦é”®æ‹–æ‹½</strong>ï¼Œç§»åŠ¨æ‘„åƒæœºï¼Œæµè§ˆä¸–ç•Œçš„å…¶ä»–è§’è½ã€‚</li>
</ol>
<p>å—¯ï¼Œå¤Ÿé€¼æ ¼äº†ï¼</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/005f50687bbc4db19e6a4a00a958d4be~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5oCqdg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765804929&amp;x-signature=S4L5c3mCtL%2BweXT%2FRqH88NjDdXk%3D" alt="timg (25).gif" loading="lazy"/></p>
<hr/>
<h2 data-id="heading-2">åŸºç¡€åŸç†</h2>
<p>è¦ä¸ªæ— é™ç©ºé—´å…¶å®æ˜¯ä¸€ä¸ªè§†è§‰å°æŠŠæˆï¼Œé¦–å…ˆæˆ‘ä»¬å¾—ç¡®è®¤æµè§ˆå™¨æ˜¯ä¸ä¼šå…è®¸ä½ åˆ›å»ºä¸€ä¸ª width: 99999999px çš„ Canvas çš„ï¼Œè¿™æ ·æµè§ˆå™¨çš„å†…å­˜ä¼šç›´æ¥å—å±ã€‚</p>
<p>ç„¶åæˆ‘ä»¬ç§»åŠ¨é¼ æ ‡ä½ç½®æ˜¯å›ºå®šä¸å˜çš„ï¼Œå¤§è‡´ç¤ºæ„å›¾å¦‚ä¸‹ï¼š</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bf384cb275334ac98641600718908118~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5oCqdg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765804929&amp;x-signature=zcEdd2%2BV1fkqrjVSh4SndGNbpmk%3D" alt="image.png" loading="lazy"/></p>
<p>è™šæ‹Ÿå±‚å°±æ˜¯åœ¨æ•°å­¦å±‚é¢ä¸Šçš„æ¨¡æ‹Ÿå±‚ï¼Œæ‰€æœ‰çš„ç§»åŠ¨ï¼Œæ·»åŠ éƒ½æ˜¯æ”¾åˆ°è™šæ‹Ÿå±‚ä¸Šã€‚</p>
<p>æˆ‘ä»¬è„‘å­é‡Œå§‹ç»ˆè¦è®°å¾—ä¸¤å¥—åæ ‡ç³»ï¼š</p>
<ul>
<li>
<p><strong>å±å¹•åæ ‡ç³» (Screen Space)</strong> ï¼š</p>
<ul>
<li>è¿™æ˜¯<strong>ç‰©ç†ç°å®</strong>ã€‚</li>
<li>åŸç‚¹ <code>(0,0)</code> æ°¸è¿œåœ¨ Canvas çš„å·¦ä¸Šè§’ã€‚</li>
<li>èŒƒå›´æœ‰é™ï¼Œæ¯”å¦‚ <code>600x600</code>ã€‚</li>
<li><strong>ç”¨é€”</strong>ï¼šæ¥æ”¶é¼ æ ‡äº‹ä»¶ (<code>evt.offsetX</code>, <code>evt.offsetY</code>)ï¼Œæœ€ç»ˆæ¸²æŸ“å›¾åƒã€‚</li>
</ul>
</li>
<li>
<p><strong>ä¸–ç•Œåæ ‡ç³» (World Space)</strong> ï¼š</p>
<ul>
<li>è¿™æ˜¯<strong>è™šæ‹Ÿæ•°æ®</strong>ã€‚</li>
<li>åŸç‚¹ <code>(0,0)</code> æ˜¯ä¸–ç•Œçš„ä¸­å¿ƒã€‚</li>
<li>èŒƒå›´æ— é™ï¼Œä½ çš„ç‚¹å¯ä»¥æ˜¯ <code>(-5000, 99999)</code>ã€‚</li>
<li><strong>ç”¨é€”</strong>ï¼šå­˜å‚¨ <code>Point</code> å’Œ <code>Segment</code> çš„çœŸå®ä½ç½®ã€‚</li>
</ul>
</li>
</ul>
<p>è§†å£å˜æ¢çš„åŸç†ï¼Œå¹¶ä¸æ˜¯çœŸçš„æŠŠ Canvas çš„ DOM å…ƒç´ æ‹–èµ°äº†ï¼Œè€Œæ˜¯æˆ‘ä»¬åœ¨<strong>ç»˜åˆ¶ä¹‹å‰</strong>ï¼Œå¯¹æ‰€æœ‰çš„åæ ‡åšäº†ä¸€æ¬¡æ•°å­¦åç§»ã€‚</p>
<p>æƒ³è±¡ä¸€ä¸‹ä½ æ‹¿ç€ä¸€ä¸ªç›¸æœºï¼ˆè§†å£ï¼‰åœ¨æ‹é£æ™¯ï¼Œå¦‚æœä½ æƒ³çœ‹<strong>å³è¾¹</strong>çš„æ ‘ï¼Œä½ éœ€è¦æŠŠç›¸æœºå‘<strong>å³</strong>ç§»ï¼Œä½†åœ¨ç›¸æœºå–æ™¯æ¡†é‡Œï¼Œé‚£æ£µæ ‘çœ‹èµ·æ¥æ˜¯å‘<strong>å·¦</strong>ç§»äº†ã€‚</p>
<p>å—¯ï¼Œå¤§æ¦‚å°±æ˜¯è¿™æ ·äº†ã€‚</p>
<hr/>
<h2 data-id="heading-3">ä¸Šä»£ç </h2>
<p>å¬ä¸æ‡‚ï¼Ÿï¼Ÿç›´æ¥ä¸Šä»£ç ï¼ï¼ï¼ï¼</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1b4cf224f65f4e91abf45116ea5d3b2a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5oCqdg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765804929&amp;x-signature=QzTsg5Sd33LopXV6wOrPN5LeTDY%3D" alt="0.gif" loading="lazy"/></p>
<h3 data-id="heading-4">è§†å£æ§åˆ¶å™¨ï¼š<code>Viewport</code></h3>
<p>åœ¨ <code>src</code> ä¸‹æ–°å»ºæ–‡ä»¶å¤¹ <code>view</code>ï¼Œç„¶ååˆ›å»º <code>viewport.js</code>ã€‚</p>
<p>è¿™ç©æ„çš„æ•°å­¦åŸç†å…¶å®å°±æ˜¯ä¸€ä¸ªç®€å•çš„å‡æ³•ï¼š</p>
<blockquote>
<p><strong>ä¸–ç•Œåæ ‡ = å±å¹•åæ ‡ - è§†å£ä¸­å¿ƒåç§»é‡</strong></p>
</blockquote>
<p>å¦‚æœæˆ‘æŠŠè§†å£å¾€å³ç§» 100pxï¼Œé‚£åŸæœ¬çš„ä¸–ç•ŒåŸç‚¹ (0,0) ç°åœ¨å°±åœ¨å±å¹•çš„ (100,0) ä½ç½®ã€‚</p>
<p>JavaScript</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// src/view/viewport.js</span>
<span class="hljs-keyword">import</span> Point2D from <span class="hljs-string">"../primitives/point2D.js"</span>;

export default <span class="hljs-keyword">class</span> <span class="hljs-title class_">Viewport</span> {
  <span class="hljs-keyword">constructor</span>(canvas) {
    <span class="hljs-keyword">this</span>.canvas = canvas;
    <span class="hljs-keyword">this</span>.ctx = canvas.getContext(<span class="hljs-string">"2d"</span>);

    <span class="hljs-comment">// è§†å£çš„åˆå§‹ç¼©æ”¾çº§åˆ«ï¼ˆä¸ºä¸‹ä¸€ç¯‡åšé“ºå«ï¼‰</span>
    <span class="hljs-keyword">this</span>.zoom = <span class="hljs-number">1</span>;
    <span class="hljs-comment">// è§†å£çš„ä¸­å¿ƒåç§»é‡ï¼ˆç›¸å½“äºæ‘„åƒæœºçš„ä½ç½®ï¼‰</span>
    <span class="hljs-comment">// é»˜è®¤è®© (0,0) åœ¨ç”»å¸ƒä¸­å¿ƒï¼Œè¿™æ ·æ›´ç¬¦åˆæ•°å­¦ç›´è§‰</span>
    <span class="hljs-keyword">this</span>.center = new Point2D(canvas.width / <span class="hljs-number">2</span>, canvas.height / <span class="hljs-number">2</span>);
    <span class="hljs-comment">// å¦ä¸€ç§æ›´é€šç”¨çš„åšæ³•æ˜¯è®°å½• offsetï¼Œä¹Ÿå°±æ˜¯ panning çš„è·ç¦»</span>
    <span class="hljs-keyword">this</span>.offset = new Point2D(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>);

    <span class="hljs-comment">// æ‹–æ‹½çŠ¶æ€ç®¡ç†</span>
    <span class="hljs-keyword">this</span>.drag = {
      start: new Point2D(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>), <span class="hljs-comment">// é¼ æ ‡æŒ‰ä¸‹çš„èµ·å§‹ç‚¹</span>
      end: new Point2D(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>),   <span class="hljs-comment">// é¼ æ ‡å½“å‰çš„ç»“æŸç‚¹</span>
      offset: new Point2D(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>),<span class="hljs-comment">// è¿™ä¸€ç¬é—´æ‹–äº†å¤šè¿œ</span>
      active: <span class="hljs-literal">false</span>             <span class="hljs-comment">// æ˜¯å¦æ­£åœ¨æ‹–æ‹½</span>
    };

    <span class="hljs-keyword">this</span>.#addEventListeners();
  }

  <span class="hljs-comment">// æ ¸å¿ƒæ•°å­¦é¢˜ï¼šå±å¹•åæ ‡ -&gt; ä¸–ç•Œåæ ‡</span>
  getMouse(evt) {
    <span class="hljs-comment">// ç°åœ¨çš„è®¡ç®—é€»è¾‘ï¼š(é¼ æ ‡ä½ç½® - ä¸­å¿ƒç‚¹) * ç¼©æ”¾ç³»æ•° - åç§»é‡</span>
    <span class="hljs-comment">// æš‚æ—¶å…ˆä¸åŠ ç¼©æ”¾ï¼Œåªå¤„ç†å¹³ç§»</span>
    <span class="hljs-keyword">return</span> new Point2D(
      (evt.offsetX - <span class="hljs-keyword">this</span>.center.x) - <span class="hljs-keyword">this</span>.offset.x,
      (evt.offsetY - <span class="hljs-keyword">this</span>.center.y) - <span class="hljs-keyword">this</span>.offset.y
    );
  }

  <span class="hljs-comment">// è·å–å½“å‰çš„åç§»é‡ï¼Œç»™ Canvas ç”¨</span>
  getOffset() {
     <span class="hljs-keyword">return</span> new Point2D(
         <span class="hljs-keyword">this</span>.center.x + <span class="hljs-keyword">this</span>.offset.x, 
         <span class="hljs-keyword">this</span>.center.y + <span class="hljs-keyword">this</span>.offset.y
     );
  }

  #addEventListeners() {
    <span class="hljs-keyword">this</span>.canvas.addEventListener(<span class="hljs-string">"mousedown"</span>, (evt) =&gt; {
      <span class="hljs-comment">// åªæœ‰æŒ‰ä½ç©ºæ ¼(Space)ä¸”ç‚¹å‡»å·¦é”®(0)æ—¶ï¼Œæ‰è§¦å‘å¹³ç§»</span>
      <span class="hljs-comment">// è¿™é‡Œçš„ evt.button == 0 æ˜¯å·¦é”®</span>
      <span class="hljs-comment">// è¿™é‡Œçš„ evt.ctrlKey / shiftKey ç­‰ä¹Ÿå¯ä»¥åˆ¤æ–­ï¼Œä½†æˆ‘ä»¬è¦åˆ¤æ–­ç©ºæ ¼é”®çŠ¶æ€</span>
      <span class="hljs-comment">// ç”±äº mousedown é‡Œæ‹¿ä¸åˆ°é”®ç›˜æŒç»­çŠ¶æ€ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªå¤–éƒ¨å˜é‡æˆ–è€…åœ¨ window ä¸Šç›‘å¬é”®ç›˜</span>
      <span class="hljs-comment">// ç®€å•çš„åšæ³•ï¼šæ£€æŸ¥ evt é‡Œæ˜¯å¦åŒ…å«æŒ‰é”®ä¿¡æ¯ï¼Ÿä¸åŒ…å«ã€‚</span>
      <span class="hljs-comment">// æ‰€ä»¥æˆ‘ä»¬é€šå¸¸å•ç‹¬å­˜ä¸€ä¸ªé”®ç›˜çŠ¶æ€ï¼Œæˆ–è€…ç›´æ¥åˆ©ç”¨ "wheel" åšç¼©æ”¾ï¼Œç”¨ "middle" åšå¹³ç§»</span>
      <span class="hljs-comment">// ä½†æ—¢ç„¶éœ€æ±‚æ˜¯ "ç©ºæ ¼+å·¦é”®"ï¼Œæˆ‘ä»¬éœ€è¦é…åˆ keydown/keyup</span>
    });
  }
}
</code></pre>
<p>è¿™é‡Œæ­‡ä¸€æ­‡ï¼Œç†ç†ä»£ç æ€è·¯ã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3baa123b358e41f5ab5aac330d9d7478~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5oCqdg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765804929&amp;x-signature=7ayzXH6NCNU2GDyA%2Fafa%2BR7HgZk%3D" alt="9.gif" loading="lazy"/></p>
<p>**â€œæŒ‰ä½ç©ºæ ¼â€**è¿™ä¸ªé€»è¾‘åœ¨ DOM äº‹ä»¶é‡Œç¨å¾®æœ‰ç‚¹éº»çƒ¦ã€‚å› ä¸º <code>mousedown</code> äº‹ä»¶å¯¹è±¡é‡Œä¸ç›´æ¥å‘Šè¯‰ä½ â€œç©ºæ ¼é”®æ˜¯ä¸æ˜¯æ­£è¢«æŒ‰ç€â€ã€‚</p>
<p>æˆ‘ä»¬éœ€è¦ç»™ <code>Viewport</code> å¢åŠ é”®ç›˜ç›‘å¬ã€‚</p>
<p><strong>ä¿®æ­£åçš„å®Œæ•´ <code>src/view/viewport.js</code>ï¼š</strong></p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">import</span> Point2D from <span class="hljs-string">"../primitives/point2D.js"</span>;

export default <span class="hljs-keyword">class</span> <span class="hljs-title class_">Viewport</span> {
  <span class="hljs-keyword">constructor</span>(canvas) {
    <span class="hljs-keyword">this</span>.canvas = canvas;
    <span class="hljs-keyword">this</span>.ctx = canvas.getContext(<span class="hljs-string">"2d"</span>);

    <span class="hljs-keyword">this</span>.zoom = <span class="hljs-number">1</span>;
    <span class="hljs-comment">// è¿™é‡Œçš„ offset å°±æ˜¯æˆ‘ä»¬ä¸€å…±å¹³ç§»äº†å¤šå°‘è·ç¦»</span>
    <span class="hljs-keyword">this</span>.offset = new Point2D(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>); 
    
    <span class="hljs-comment">// æ‹–æ‹½è®¡ç®—ç”¨çš„ä¸´æ—¶å˜é‡</span>
    <span class="hljs-keyword">this</span>.drag = {
      start: new Point2D(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>),
      end: new Point2D(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>),
      offset: new Point2D(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>),
      active: <span class="hljs-literal">false</span>
    };

    <span class="hljs-keyword">this</span>.#addEventListeners();
  }

  <span class="hljs-comment">// è®¡ç®—ï¼šé¼ æ ‡åœ¨å±å¹•ä¸Šçš„ç‚¹ï¼Œå¯¹åº”çš„çœŸå®ä¸–ç•Œåæ ‡åœ¨å“ªé‡Œ</span>
  getMouse(evt, subtractDragOffset = <span class="hljs-literal">false</span>) {
    <span class="hljs-keyword">const</span> p = new Point2D(
      (evt.offsetX - <span class="hljs-keyword">this</span>.canvas.width / <span class="hljs-number">2</span>) * <span class="hljs-keyword">this</span>.zoom - <span class="hljs-keyword">this</span>.offset.x,
      (evt.offsetY - <span class="hljs-keyword">this</span>.canvas.height / <span class="hljs-number">2</span>) * <span class="hljs-keyword">this</span>.zoom - <span class="hljs-keyword">this</span>.offset.y
    );
    <span class="hljs-keyword">return</span> p;
  }
  
  <span class="hljs-comment">// ç»™ Canvas æ¸²æŸ“ç”¨çš„ï¼Œå‘Šè¯‰å®ƒè¯¥å¹³ç§»å¤šå°‘</span>
  getOffset() {
      <span class="hljs-keyword">return</span> new Point2D(
          <span class="hljs-keyword">this</span>.offset.x + <span class="hljs-keyword">this</span>.canvas.width / <span class="hljs-number">2</span>,
          <span class="hljs-keyword">this</span>.offset.y + <span class="hljs-keyword">this</span>.canvas.height / <span class="hljs-number">2</span>
      );
  }

  #addEventListeners() {
    <span class="hljs-comment">// è®°å½•ç©ºæ ¼é”®çŠ¶æ€</span>
    <span class="hljs-keyword">this</span>.isSpacePressed = <span class="hljs-literal">false</span>;

    window.addEventListener(<span class="hljs-string">"keydown"</span>, (evt) =&gt; {
       <span class="hljs-keyword">if</span> (evt.code === <span class="hljs-string">"Space"</span>) {
           <span class="hljs-keyword">this</span>.isSpacePressed = <span class="hljs-literal">true</span>;
       }
    });

    window.addEventListener(<span class="hljs-string">"keyup"</span>, (evt) =&gt; {
       <span class="hljs-keyword">if</span> (evt.code === <span class="hljs-string">"Space"</span>) {
           <span class="hljs-keyword">this</span>.isSpacePressed = <span class="hljs-literal">false</span>;
       }
    });

    <span class="hljs-keyword">this</span>.canvas.addEventListener(<span class="hljs-string">"mousedown"</span>, (evt) =&gt; {
      <span class="hljs-comment">// åªæœ‰æŒ‰ä½ç©ºæ ¼ + å·¦é”®ï¼Œæ‰å¼€å§‹æ‹–æ‹½è§†å£</span>
      <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.isSpacePressed &amp;&amp; evt.button === <span class="hljs-number">0</span>) {
        <span class="hljs-keyword">this</span>.drag.start = <span class="hljs-keyword">this</span>.getMouse(evt);
        <span class="hljs-keyword">this</span>.drag.active = <span class="hljs-literal">true</span>;
      }
    });

    <span class="hljs-keyword">this</span>.canvas.addEventListener(<span class="hljs-string">"mousemove"</span>, (evt) =&gt; {
      <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.drag.active) {
        <span class="hljs-keyword">this</span>.drag.end = <span class="hljs-keyword">this</span>.getMouse(evt);
        <span class="hljs-comment">// è®¡ç®—è¿™ä¸€ç¬é—´ç§»åŠ¨äº†å¤šå°‘</span>
        <span class="hljs-keyword">this</span>.drag.offset = new Point2D(
            <span class="hljs-keyword">this</span>.drag.end.x - <span class="hljs-keyword">this</span>.drag.start.x,
            <span class="hljs-keyword">this</span>.drag.end.y - <span class="hljs-keyword">this</span>.drag.start.y
        );
        <span class="hljs-comment">// ç´¯åŠ åˆ°æ€»åç§»é‡é‡Œ</span>
        <span class="hljs-keyword">this</span>.offset.x += <span class="hljs-keyword">this</span>.drag.offset.x;
        <span class="hljs-keyword">this</span>.offset.y += <span class="hljs-keyword">this</span>.drag.offset.y;
        
        <span class="hljs-comment">// é‡è¦ï¼šé‡ç½® startï¼Œå› ä¸ºæˆ‘ä»¬å·²ç»å¤„ç†äº†è¿™æ®µä½ç§»</span>
        <span class="hljs-comment">// å¦‚æœä¸é‡ç½®ï¼Œä½ ä¼šå‘ç°ç”»é¢é£å¾—è¶Šæ¥è¶Šå¿«</span>
        <span class="hljs-keyword">this</span>.drag.start = <span class="hljs-keyword">this</span>.getMouse(evt); 
      }
    });

    <span class="hljs-keyword">this</span>.canvas.addEventListener(<span class="hljs-string">"mouseup"</span>, () =&gt; {
      <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.drag.active) {
        <span class="hljs-keyword">this</span>.drag.active = <span class="hljs-literal">false</span>;
      }
    });
  }
}
</code></pre>
<h3 data-id="heading-5">ä¿®æ”¹ <code>GraphEditor</code></h3>
<p>è¿™å°±æ˜¯ä¸Šç¯‡åŸ‹çš„å‘ã€‚ä¹‹å‰æˆ‘ä»¬åœ¨ <code>GraphEditor</code> é‡Œç›´æ¥ç”¨äº† <code>evt.offsetX</code>ã€‚ç°åœ¨ä¸è¡Œäº†ï¼Œå¿…é¡»é€šè¿‡ <code>viewport.getMouse(evt)</code> æ¥è·å–åæ ‡ã€‚</p>
<p>ä¿®æ”¹ <code>src/editors/graphEditor.js</code>ï¼š</p>
<ol>
<li><strong>æ„é€ å‡½æ•°</strong>æ¥æ”¶ <code>viewport</code>ã€‚</li>
<li><strong>äº‹ä»¶ç›‘å¬</strong>æ”¹ç”¨ <code>viewport.getMouse(evt)</code>ã€‚</li>
<li><strong>å†²çªè§£å†³</strong>ï¼šå¦‚æœæŒ‰ä½äº†ç©ºæ ¼ï¼ˆæ­£åœ¨æ‹–æ‹½è§†å›¾ï¼‰ï¼Œå°±ä¸è¦è§¦å‘â€œç”»ç‚¹â€çš„é€»è¾‘ã€‚</li>
</ol>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// src/editors/graphEditor.js</span>
<span class="hljs-keyword">import</span> Point2D from <span class="hljs-string">"../primitives/point2D.js"</span>;
<span class="hljs-keyword">import</span> Segment from <span class="hljs-string">"../primitives/segment.js"</span>;

export default <span class="hljs-keyword">class</span> <span class="hljs-title class_">GraphEditor</span> {
  <span class="hljs-keyword">constructor</span>(canvas, graph, viewport) {
    <span class="hljs-keyword">this</span>.canvas = canvas;
    <span class="hljs-keyword">this</span>.graph = graph;
    <span class="hljs-keyword">this</span>.viewport = viewport;

    <span class="hljs-keyword">this</span>.ctx = canvas.getContext(<span class="hljs-string">"2d"</span>);

    <span class="hljs-comment">// çŠ¶æ€æœº</span>
    <span class="hljs-keyword">this</span>.selected = <span class="hljs-literal">null</span>; <span class="hljs-comment">// å½“å‰é€‰ä¸­çš„ç‚¹ï¼ˆç”¨äºè¿çº¿èµ·ç‚¹ï¼‰</span>
    <span class="hljs-keyword">this</span>.hovered = <span class="hljs-literal">null</span>; <span class="hljs-comment">// é¼ æ ‡æ‚¬åœçš„ç‚¹</span>
    <span class="hljs-keyword">this</span>.dragging = <span class="hljs-literal">false</span>; <span class="hljs-comment">// é¢„ç•™ç»™æœªæ¥æ‹–æ‹½ç”¨</span>
    <span class="hljs-keyword">this</span>.mouse = <span class="hljs-literal">null</span>; <span class="hljs-comment">// å½“å‰é¼ æ ‡ä½ç½®</span>

    <span class="hljs-comment">// å¯åŠ¨ç›‘å¬</span>
    <span class="hljs-keyword">this</span>.#addEventListeners();
  }

  #addEventListeners() {
    <span class="hljs-comment">// 1. é¼ æ ‡æŒ‰ä¸‹äº‹ä»¶</span>
    <span class="hljs-keyword">this</span>.canvas.addEventListener(<span class="hljs-string">"mousedown"</span>, (evt) =&gt; {
      <span class="hljs-comment">// åªæœ‰å·¦é”®(0)å’Œå³é”®(2)æ‰å¤„ç†</span>
      <span class="hljs-keyword">if</span> (evt.button == <span class="hljs-number">2</span>) {
        <span class="hljs-comment">// å³é”®é€»è¾‘</span>
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.selected) {
          <span class="hljs-keyword">this</span>.selected = <span class="hljs-literal">null</span>; <span class="hljs-comment">// å–æ¶ˆå½“å‰é€‰ä¸­ï¼Œåœæ­¢è¿çº¿</span>
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.hovered) {
          <span class="hljs-keyword">this</span>.#removePoint(<span class="hljs-keyword">this</span>.hovered); <span class="hljs-comment">// åˆ é™¤ç‚¹</span>
        }
      }

      <span class="hljs-keyword">if</span> (evt.button == <span class="hljs-number">0</span>) {
        <span class="hljs-comment">// [æ–°å¢] å¦‚æœè§†å£æ­£åœ¨è¢«æ‹–æ‹½ï¼Œæˆ–è€…æ˜¯ç©ºæ ¼æŒ‰ä¸‹çŠ¶æ€ï¼Œä¸è¦ç”»ç‚¹</span>
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.viewport.drag.active || <span class="hljs-keyword">this</span>.viewport.isSpacePressed) <span class="hljs-keyword">return</span>;

        <span class="hljs-comment">// å·¦é”®é€»è¾‘</span>
        <span class="hljs-comment">// å¦‚æœé¼ æ ‡åœ¨æŸä¸ªç‚¹ä¸Šï¼Œå°±é€‰ä¸­å®ƒï¼›å¦‚æœä¸åœ¨ï¼Œå°±æ–°å»ºä¸€ä¸ªç‚¹å¹¶é€‰ä¸­å®ƒ</span>
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.hovered) {
          <span class="hljs-keyword">this</span>.#select(<span class="hljs-keyword">this</span>.hovered);
          <span class="hljs-keyword">this</span>.dragging = <span class="hljs-literal">true</span>;
          <span class="hljs-keyword">return</span>;
        }
        <span class="hljs-keyword">this</span>.graph.tryAddPoint(<span class="hljs-keyword">this</span>.mouse);
        <span class="hljs-keyword">this</span>.#select(<span class="hljs-keyword">this</span>.mouse); <span class="hljs-comment">// è‡ªåŠ¨é€‰ä¸­æ–°ç‚¹ï¼Œæ–¹ä¾¿è¿ç»­ç”»çº¿</span>
        <span class="hljs-keyword">this</span>.hovered = <span class="hljs-keyword">this</span>.mouse;
        <span class="hljs-keyword">this</span>.dragging = <span class="hljs-literal">true</span>;
      }
    });

    <span class="hljs-comment">// 2. é¼ æ ‡ç§»åŠ¨äº‹ä»¶</span>
    <span class="hljs-keyword">this</span>.canvas.addEventListener(<span class="hljs-string">"mousemove"</span>, (evt) =&gt; {
      <span class="hljs-comment">// è·å–é¼ æ ‡åœ¨ Canvas é‡Œçš„åæ ‡ï¼ˆå³ä½¿ Canvas ç¼©æ”¾æˆ–åç§»ä¹Ÿèƒ½ç”¨ï¼‰</span>
      <span class="hljs-comment">// è¿™é‡Œå…ˆç®€åŒ–å¤„ç†ï¼Œå‡è®¾ Canvas é“ºæ»¡æˆ–è€…æ— åç§»</span>
      <span class="hljs-comment">// å®é™…ä¸Šæˆ‘ä»¬åº”è¯¥å†™ä¸ª getViewportPointï¼Œä½†æš‚æ—¶å…ˆç›´æ¥è¯»å– offsetX/Y</span>
      <span class="hljs-keyword">this</span>.mouse = <span class="hljs-keyword">this</span>.viewport.getMouse(evt);

      <span class="hljs-comment">// æ£€æŸ¥é¼ æ ‡æœ‰æ²¡æœ‰æ‚¬åœåœ¨æŸä¸ªç‚¹ä¸Š</span>
      <span class="hljs-keyword">this</span>.hovered = <span class="hljs-keyword">this</span>.#getNearestPoint(<span class="hljs-keyword">this</span>.mouse);

      <span class="hljs-comment">// ç§»åŠ¨çš„æ—¶å€™ä¸éœ€è¦é‡ç»˜å—ï¼Ÿéœ€è¦çš„ï¼Œä½†æˆ‘ä»¬ä¼šåœ¨ World é‡Œç»Ÿä¸€é©±åŠ¨åŠ¨ç”»å¾ªç¯</span>
    });

    <span class="hljs-comment">// 3. ç¦æ­¢å³é”®èœå•å¼¹å‡º</span>
    <span class="hljs-keyword">this</span>.canvas.addEventListener(<span class="hljs-string">"contextmenu"</span>, (evt) =&gt; evt.preventDefault());

    <span class="hljs-comment">// 4. é¼ æ ‡æŠ¬èµ·ï¼ˆç»“æŸæ‹–æ‹½çŠ¶æ€ï¼‰</span>
    <span class="hljs-keyword">this</span>.canvas.addEventListener(<span class="hljs-string">"mouseup"</span>, () =&gt; (<span class="hljs-keyword">this</span>.dragging = <span class="hljs-literal">false</span>));
  }

  #select(point) {
    <span class="hljs-comment">// å¦‚æœä¹‹å‰å·²ç»é€‰ä¸­äº†ä¸€ä¸ªç‚¹ï¼Œç°åœ¨åˆé€‰äº†ä¸€ä¸ªç‚¹ï¼Œè¯´æ˜è¦è¿çº¿</span>
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.selected) {
      <span class="hljs-comment">// å°è¯•æ·»åŠ çº¿æ®µ</span>
      <span class="hljs-keyword">this</span>.graph.tryAddSegment(new Segment(<span class="hljs-keyword">this</span>.selected, point));
    }
    <span class="hljs-keyword">this</span>.selected = point;
  }

  #removePoint(point) {
    <span class="hljs-keyword">this</span>.graph.removePoint(point);
    <span class="hljs-keyword">this</span>.hovered = <span class="hljs-literal">null</span>;
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.selected == point) {
      <span class="hljs-keyword">this</span>.selected = <span class="hljs-literal">null</span>;
    }
  }

  <span class="hljs-comment">// è¾…åŠ©å‡½æ•°ï¼šæ‰¾ç¦»é¼ æ ‡æœ€è¿‘çš„ç‚¹</span>
  #getNearestPoint(point, minThreshold = <span class="hljs-number">15</span>) {
    let nearest = <span class="hljs-literal">null</span>;
    let minDist = Number.MAX_SAFE_INTEGER;

    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> p of <span class="hljs-keyword">this</span>.graph.points) {
      <span class="hljs-keyword">const</span> dist = Math.hypot(p.x - point.x, p.y - point.y);
      <span class="hljs-keyword">if</span> (dist &lt; minThreshold &amp;&amp; dist &lt; minDist) {
        minDist = dist;
        nearest = p;
      }
    }
    <span class="hljs-keyword">return</span> nearest;
  }

  <span class="hljs-comment">// ä¸“é—¨è´Ÿè´£ç”»ç¼–è¾‘å™¨ç›¸å…³çš„ UIï¼ˆæ¯”å¦‚é«˜äº®ã€è™šçº¿ï¼‰</span>
  display() {
    <span class="hljs-keyword">this</span>.graph.draw(<span class="hljs-keyword">this</span>.ctx);

    <span class="hljs-comment">// å¦‚æœæœ‰æ‚¬åœçš„ç‚¹ï¼Œç”»ä¸ªç‰¹æ®Šçš„æ ·å¼</span>
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.hovered) {
      <span class="hljs-keyword">this</span>.hovered.draw(<span class="hljs-keyword">this</span>.ctx, { outline: <span class="hljs-literal">true</span> });
    }

    <span class="hljs-comment">// å¦‚æœæœ‰é€‰ä¸­çš„ç‚¹ï¼Œä¹Ÿé«˜äº®ä¸€ä¸‹</span>
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.selected) {
      <span class="hljs-comment">// è·å–é¼ æ ‡ä½ç½®ä½œä¸ºæ„å›¾ç»ˆç‚¹</span>
      <span class="hljs-keyword">const</span> intent = <span class="hljs-keyword">this</span>.hovered ? <span class="hljs-keyword">this</span>.hovered : <span class="hljs-keyword">this</span>.mouse;
      <span class="hljs-comment">// ç”»å‡ºâ€œè™šæ‹Ÿçº¿æ¡â€ï¼šä»é€‰ä¸­ç‚¹ -&gt; é¼ æ ‡ä½ç½®</span>
      new Segment(<span class="hljs-keyword">this</span>.selected, intent).draw(<span class="hljs-keyword">this</span>.ctx, {
        color: <span class="hljs-string">"rgba(0,0,0,0.5)"</span>,
        width: <span class="hljs-number">1</span>,
        dash: [<span class="hljs-number">3</span>, <span class="hljs-number">3</span>],
      });
      <span class="hljs-keyword">this</span>.selected.draw(<span class="hljs-keyword">this</span>.ctx, { outline: <span class="hljs-literal">true</span>, outlineColor: <span class="hljs-string">"blue"</span> });
    }
  }
}

</code></pre>
<h3 data-id="heading-6">4.3. é‡æ„ <code>World</code>ï¼šåº”ç”¨è§†å£å˜æ¢</h3>
<p>æœ€åï¼Œå» <code>index.js</code> æŠŠè¿™ä¸€åˆ‡ä¸²èµ·æ¥ã€‚Canvas çš„å˜æ¢ï¼ˆTranslateï¼‰éœ€è¦åŒ…è£¹åœ¨ <code>save()</code> å’Œ <code>restore()</code> ä¹‹é—´ï¼Œå¦åˆ™ä½ çš„ UIï¼ˆå¦‚æœæœ‰çš„è¯ï¼‰ä¹Ÿä¼šè·Ÿç€ä¸€èµ·è·‘ã€‚</p>
<p>ä¿®æ”¹ <code>src/index.js</code>ï¼š</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">import</span> Point2D from <span class="hljs-string">"./primitives/point2D.js"</span>;
<span class="hljs-keyword">import</span> Segment from <span class="hljs-string">"./primitives/segment.js"</span>;
<span class="hljs-keyword">import</span> Graph from <span class="hljs-string">"./math/graph.js"</span>;
<span class="hljs-keyword">import</span> GraphEditor from <span class="hljs-string">"./editors/graphEditor.js"</span>;
<span class="hljs-keyword">import</span> Viewport from <span class="hljs-string">"./view/viewport.js"</span>; <span class="hljs-comment">// å¼•å…¥æ–°æˆå‘˜</span>

export default <span class="hljs-keyword">class</span> <span class="hljs-title class_">World</span> {
  <span class="hljs-keyword">constructor</span>(canvas, width = <span class="hljs-number">600</span>, height = <span class="hljs-number">600</span>) {
    <span class="hljs-keyword">this</span>.canvas = canvas;
    <span class="hljs-keyword">this</span>.ctx = canvas.getContext(<span class="hljs-string">"2d"</span>);
    <span class="hljs-keyword">this</span>.canvas.width = width;
    <span class="hljs-keyword">this</span>.canvas.height = height;

    <span class="hljs-keyword">this</span>.graph = new Graph();
    <span class="hljs-comment">// 1. å…ˆåˆå§‹åŒ–è§†å£</span>
    <span class="hljs-keyword">this</span>.viewport = new Viewport(<span class="hljs-keyword">this</span>.canvas);
    <span class="hljs-comment">// 2. æŠŠè§†å£ä¼ ç»™ç¼–è¾‘å™¨</span>
    <span class="hljs-keyword">this</span>.editor = new GraphEditor(<span class="hljs-keyword">this</span>.canvas, <span class="hljs-keyword">this</span>.graph, <span class="hljs-keyword">this</span>.viewport);

    <span class="hljs-keyword">this</span>.animate();
  }

  animate() {
    <span class="hljs-keyword">this</span>.ctx.clearRect(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-keyword">this</span>.canvas.width, <span class="hljs-keyword">this</span>.canvas.height);

    <span class="hljs-comment">// [æ ¸å¿ƒæ­¥éª¤] ä¿å­˜å½“å‰çŠ¶æ€ -&gt; ç§»åŠ¨ç”»å¸ƒ -&gt; ç”»ç”» -&gt; æ¢å¤çŠ¶æ€</span>
    <span class="hljs-keyword">this</span>.ctx.save();
    
    <span class="hljs-comment">// è·å–è§†å£å½“å‰çš„åç§»ï¼Œå¹¶åº”ç”¨å¹³ç§»å˜æ¢</span>
    <span class="hljs-comment">// æ³¨æ„ï¼šè¿™é‡Œæˆ‘ä»¬ç”¨ scale(1/zoom) æ˜¯ä¸ºäº†é…åˆé¼ æ ‡è®¡ç®—ï¼Œæš‚æ—¶è¿˜æ²¡åšç¼©æ”¾ï¼Œ</span>
    <span class="hljs-comment">// ä½†æˆ‘ä»¬å¯ä»¥æŠŠ translate å…ˆå†™å¥½</span>
    <span class="hljs-keyword">const</span> offset = <span class="hljs-keyword">this</span>.viewport.getOffset();
    <span class="hljs-keyword">this</span>.ctx.translate(offset.x, offset.y);
    
    <span class="hljs-comment">// æ‰€æœ‰çš„ç»˜åˆ¶ç°åœ¨éƒ½åœ¨"ç§»åŠ¨å"çš„åæ ‡ç³»é‡Œè¿›è¡Œäº†</span>
    <span class="hljs-keyword">this</span>.editor.display();
    
    <span class="hljs-keyword">this</span>.ctx.restore();

    requestAnimationFrame(() =&gt; <span class="hljs-keyword">this</span>.animate());
  }
}
</code></pre>
<hr/>
<h2 data-id="heading-7">å¤§æ¦‚ç¤ºæ„å›¾</h2>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7198ab4ff5444e18ac2bf805b5122f5e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5oCqdg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765804929&amp;x-signature=j9FCEAPUwUNYv0tr0I8EtGlYFeA%3D" alt="image.png" loading="lazy"/></p>
<p>å—¯....NICEï¼</p>
<p>ä»Šå¤©å°±è¿™æ ·äº†ã€‚</p>
<p>å®Œæ•´ä»£ç æˆ³è¿™é‡Œï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FFloat-none%2FJS-Genesis%2Ftree%2Fmain%2F04" target="_blank" title="https://github.com/Float-none/JS-Genesis/tree/main/04" ref="nofollow noopener noreferrer">github.com/Float-none/â€¦</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[é•¿ä¸Šä¸‹æ–‡ã€Agentè®°å¿†ã€Text2SQLä¸­ï¼Œè°ä¼šå–ä»£RAGï¼Ÿ]]></title>    <link>https://juejin.cn/post/7581359420391686171</link>    <guid>https://juejin.cn/post/7581359420391686171</guid>    <pubDate>2025-12-08T13:42:31.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581359420391686171" data-draft-id="7581406561685372974" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="é•¿ä¸Šä¸‹æ–‡ã€Agentè®°å¿†ã€Text2SQLä¸­ï¼Œè°ä¼šå–ä»£RAGï¼Ÿ"/> <meta itemprop="keywords" content="LLM"/> <meta itemprop="datePublished" content="2025-12-08T13:42:31.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="æ™ºæ³ŠAI"/> <meta itemprop="url" content="https://juejin.cn/user/3572727470361578"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            é•¿ä¸Šä¸‹æ–‡ã€Agentè®°å¿†ã€Text2SQLä¸­ï¼Œè°ä¼šå–ä»£RAGï¼Ÿ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3572727470361578/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    æ™ºæ³ŠAI
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-08T13:42:31.000Z" title="Mon Dec 08 2025 13:42:31 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»10åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>é•¿ä¸Šä¸‹æ–‡å¤„ç†èƒ½åŠ›ã€Agentçš„è®°å¿†æœºåˆ¶ã€Text2SQLæŠ€æœ¯çš„æ¼”è¿›ï¼Œæ˜¯å¦ç»ˆå°†å–ä»£RAGï¼Ÿ</p>
<p>æ¢å¥è¯æ¥è¯´ï¼šRAGæ˜¯å¦ä»…æ˜¯æŠ€æœ¯æ¼”è¿›ä¸­çš„"é˜¶æ®µæ€§æ–¹æ¡ˆ"ï¼Ÿ</p>
<p>è¿‘ä¸¤å¹´ï¼Œä¸šç•Œå¯¹æ­¤çš„äº‰è®®æŒç»­ä¸æ–­ã€‚æ”¯æŒæ›¿ä»£çš„ä¸€æ–¹è®¤ä¸ºï¼Œéšç€ä¸Šä¸‹æ–‡å®¹é‡æ‰©å±•ã€Agentæ™ºèƒ½æ°´å¹³æå‡ã€æ•°æ®åº“äº¤äº’æ•ˆç‡ä¼˜åŒ–ï¼ŒRAGçš„æ·˜æ±°å·²æˆå¿…ç„¶ï¼›è€Œåå¯¹è€…åˆ™ä¸»å¼ ï¼ŒRAGå°†å¦‚åŒæœç´¢å¼•æ“èˆ¬ï¼Œæˆä¸ºAIåŸºç¡€è®¾æ–½çš„æ ¸å¿ƒæ”¯æŸ±ã€‚</p>
<p>è®©æˆ‘ä»¬ç³»ç»Ÿæ€§åœ°å¯¹æ¯”åˆ†æï¼šå°†é•¿ä¸Šä¸‹æ–‡ã€Agentè®°å¿†ã€Text2SQLä¸RAGç½®äºåŒä¸€æ¡†æ¶ä¸‹ï¼Œé€ä¸€è¯„ä¼°å…¶æŠ€æœ¯ç‰¹æ€§ä¸é€‚ç”¨åœºæ™¯ã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1a4b6d49f52d4bac8801379508331e80~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pm65rOKQUk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765806151&amp;x-signature=czet9JfNqC2JGZgnt%2BCCele5baE%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<p><strong>æ›´å¤šAIå¤§æ¨¡å‹å­¦ä¹ è§†é¢‘åŠèµ„æºï¼Œéƒ½åœ¨<a href="https://link.juejin.cn?target=https%3A%2F%2Fyuan.zhipoai.cn%2F" target="_blank" title="https://yuan.zhipoai.cn/" ref="nofollow noopener noreferrer">æ™ºæ³ŠAI</a>ã€‚</strong></p>
<p><strong>ä¸€ã€å…ˆæ‰¿è®¤ä¸€ä¸ªå‰æï¼šLLM æœ‰â€œåŸç½ªâ€</strong></p>
<p>æ‰€æœ‰åç»­çš„æŠ€æœ¯ï¼Œæœ¬è´¨ä¸Šéƒ½åœ¨ä¸ºå¤§æ¨¡å‹"æŸ¥æ¼è¡¥ç¼º"ã€‚</p>
<p>å°½ç®¡LLMèƒ½åŠ›å“è¶Šï¼Œä»å­˜åœ¨ä¸‰ä¸ªå›ºæœ‰ç¼ºé™·ï¼š</p>
<p><strong>â€Œ1.å¹»è§‰é—®é¢˜â€Œ</strong></p>
<p>è¡¨ç°ä¸ºé«˜åº¦ç¡®ä¿¡å´è¾“å‡ºè™šæ„å†…å®¹ã€‚</p>
<p>æœ¬è´¨å®šä¹‰ï¼šç”Ÿæˆå†…å®¹ä¸äº‹å®å­˜åœ¨åå·®ï¼Œæˆ–ç¼ºä¹å¯ä¿¡ä¾æ®æ”¯æ’‘ã€‚</p>
<p><strong>â€Œ2.ä¸Šä¸‹æ–‡å®¹é‡ç“¶é¢ˆ</strong>ï¼ˆæ³¨æ„åŠ›è¡°å‡ï¼‰â€Œ</p>
<p>ä»ç†è®ºçœ‹ï¼Œæ‰©å±•ä¸Šä¸‹æ–‡æœ¬åº”å¢å¼ºè®°å¿†èƒ½åŠ›ï¼Œä½†å®é™…å­˜åœ¨ä¸´ç•Œç‚¹ï¼š</p>
<p>å½“æ–‡æœ¬è¿‡é•¿æ—¶ï¼Œæ¨¡å‹æ³¨æ„åŠ›ä¼šæ˜¾è‘—åˆ†æ•£ï¼Œå¯¼è‡´åç»­å†…å®¹å¯¹å‰æ–‡çš„ç†è§£é€æ¸æ·¡åŒ–ã€‚</p>
<p>æ‰©å±•ä¸Šä¸‹æ–‡ä¸ç­‰äº"æ°¸ä¹…è®°å¿†"ï¼Œè€Œæ˜¯"å®¹é‡å¢åŠ ä½†æµ“åº¦é™ä½çš„è®°å¿†ä½“"ã€‚</p>
<p><strong>â€Œ3.çŸ¥è¯†è¾¹ç•Œå›ºåŒ–â€Œ</strong></p>
<p>æ¨¡å‹çš„çŸ¥è¯†ä½“ç³»æºè‡ªè®­ç»ƒæ•°æ®ï¼šå…¬å¼€ç½‘ç»œä¿¡æ¯+å¼€æ”¾æ•°æ®é›†ã€‚</p>
<p>ç”±æ­¤è¡ç”Ÿä¸¤å¤§å±€é™ï¼š</p>
<p>æœªæ¶µç›–éå…¬å¼€æ•°æ®ï¼ˆä¼ä¸šä¸“æœ‰çŸ¥è¯†åº“ã€å†…éƒ¨æ–‡æ¡£ç­‰ï¼‰</p>
<p>æ—¶æ•ˆæ€§æ»åï¼šè®­ç»ƒæˆªæ­¢æ—¥æœŸåçš„æ–°äº‹ä»¶å®Œå…¨è¶…å‡ºè®¤çŸ¥èŒƒå›´</p>
<p>å› æ­¤ï¼Œæ ¸å¿ƒæŒ‘æˆ˜å§‹ç»ˆæ˜¯ï¼š</p>
<p>å¦‚ä½•åœ¨ä¸å…¨é‡é‡è®­çš„æ¡ä»¶ä¸‹ï¼Œä½¿æ¨¡å‹å…·å¤‡"å®æ—¶æ›´æ–°çš„"ã€"ä¸“å±é¢†åŸŸçš„"ã€"ç³»ç»ŸåŒ–çš„"çŸ¥è¯†ï¼ŒåŒæ—¶æœ€å¤§é™åº¦å‡å°‘è™šæ„è¾“å‡ºï¼Ÿ</p>
<p>RAGæŠ€æœ¯ã€æ‰©å±•ä¸Šä¸‹æ–‡ã€æ™ºèƒ½ä½“è®°å¿†æœºåˆ¶ã€Text2SQLç­‰ï¼Œå‡ä¸ºè¯¥é—®é¢˜æä¾›äº†å·®å¼‚åŒ–è§£å†³æ–¹æ¡ˆã€‚</p>
<p><strong>äºŒã€RAG åˆ°åº•åœ¨è§£å†³ä»€ä¹ˆé—®é¢˜ï¼Ÿ</strong></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/64cc9eccc68e416990c37b7d0153c76e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pm65rOKQUk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765806151&amp;x-signature=Saiz7tkXTh8pVmgYrXEsPAYK9RM%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<p><strong>ä¸€å¥è¯æ¦‚æ‹¬</strong>ï¼šâ€Œ</p>
<p>RAGï¼ˆRetrieval-Augmented Generationï¼‰= æ£€ç´¢ + ç”Ÿæˆï¼Œå³åœ¨å‘æ¨¡å‹æé—®å‰ï¼Œå…ˆä»æ•°æ®ä¸­ç­›é€‰ç›¸å…³å†…å®¹ï¼Œå†åŸºäºè¿™äº›ä¿¡æ¯ç”Ÿæˆå›ç­”ã€‚</p>
<p>â€Œè¯¦ç»†è¯´æ˜ï¼šâ€Œ</p>
<p>â€Œ1.<strong>å®šä½ä¸ä½œç”¨â€Œ</strong></p>
<p>RAGæ˜¯å¤§è¯­è¨€æ¨¡å‹ï¼ˆLLMï¼‰çš„è¡¥å……è€Œéæ›¿ä»£ï¼Œå…¶æ ¸å¿ƒæ˜¯ä¸ºæ¨¡å‹æä¾›â€Œä¸Šä¸‹æ–‡æ”¯æŒâ€Œï¼Œç¡®ä¿å›ç­”åŸºäºå¯ä¿¡èµ„æ–™ã€‚</p>
<p>æ–¹æ³•è®ºå±æ€§ï¼šå±äºæŠ€æœ¯æ¶æ„è®¾è®¡ï¼Œéç‰¹å®šæ¨¡å‹æˆ–äº§å“ã€‚</p>
<p>ç¤ºä¾‹ç±»æ¯”ï¼šæé—®æ—¶ï¼Œå…ˆæ£€ç´¢â€œåœ°çƒè‡ªè½¬â€çš„ç™¾ç§‘æ®µè½ä½œä¸ºPromptèƒŒæ™¯ï¼Œå†è¦æ±‚æ¨¡å‹ç»“åˆå†…å®¹ä½œç­”ã€‚</p>
<p><strong>2â€Œ.æŠ€æœ¯ä¼˜åŠ¿â€Œ</strong></p>
<p>â€Œå‡å°‘å¹»è§‰â€Œï¼šæ¨¡å‹ä¼˜å…ˆå‚è€ƒç”¨æˆ·æä¾›çš„æ–‡æ¡£ï¼Œè€Œéä¾èµ–è‡ªèº«çŸ¥è¯†åº“ï¼ˆå¯è®¾å®šâ€œä¸¥æ ¼åŸºäºæ–‡æ¡£å›ç­”â€è§„åˆ™ï¼‰ã€‚</p>
<p>â€Œæ‰©å±•çŸ¥è¯†æºâ€Œï¼šæ”¯æŒä¼ä¸šæ–‡æ¡£ã€æ•°æ®åº“ã€PDFç­‰å¤–éƒ¨æ•°æ®æ¥å…¥ã€‚</p>
<p>â€ŒåŠ¨æ€æ›´æ–°â€Œï¼šæ•°æ®æ›´æ–°åé€šè¿‡é‡æ–°ç´¢å¼•å³æ—¶ç”Ÿæ•ˆï¼Œæ— éœ€é‡æ–°è®­ç»ƒæ¨¡å‹ã€‚</p>
<p>â€Œé€æ˜å¯å®¡è®¡â€Œï¼šå¯è¿½æº¯å›ç­”çš„åŸå§‹æ–‡æ¡£åŠæ®µè½ï¼Œæ»¡è¶³ä¼ä¸šåˆè§„éœ€æ±‚ã€‚</p>
<p>â€Œä½æˆæœ¬éƒ¨ç½²â€Œï¼šä»…éœ€åœ¨ç°æœ‰æ¨¡å‹å¤–å åŠ æ£€ç´¢é€»è¾‘ï¼Œæ— éœ€å¾®è°ƒæˆ–å†è®­ç»ƒã€‚</p>
<p><strong>ä¸‰ã€RAG vs å¾®è°ƒï¼šå®ƒä»¬ä¸æ˜¯å¯¹ç«‹é¢</strong></p>
<p>è®¸å¤šå›¢é˜ŸåˆæœŸæœ€å¸¸æå‡ºçš„ç–‘é—®æ˜¯ï¼šâ€Œ"ç©¶ç«Ÿè¯¥é€‰æ‹©RAGï¼Œè¿˜æ˜¯ç›´æ¥å¯¹ç°æœ‰æ¨¡å‹è¿›è¡Œå¾®è°ƒï¼Ÿ"â€Œ</p>
<p>æ ¸å¿ƒç»“è®ºï¼šRAGä¸å¾®è°ƒæœ¬è´¨ä¸Šæ˜¯ååŒè€Œéå¯¹ç«‹çš„å…³ç³»ï¼Œç»å¤§å¤šæ•°ä¸šåŠ¡åœºæ™¯ä¼šä¼˜å…ˆéƒ¨ç½²RAGæ–¹æ¡ˆã€‚</p>
<p>ä»å¤šç»´åº¦å¯¹æ¯”åˆ†æï¼š</p>
<p>â€Œ1.<strong>å¹»è§‰æ§åˆ¶â€Œ</strong></p>
<p>å¾®è°ƒï¼šè™½èƒ½ç¼“è§£å¹»è§‰é—®é¢˜ï¼Œä½†å­˜åœ¨è¿‡æ‹Ÿåˆé£é™©ï¼›åœ¨äº‹å®æ€§é—®ç­”ä¸­è¡¨ç°ä¸ç¨³å®šã€‚</p>
<p>RAGï¼šé€šè¿‡ç›´æ¥å¼•ç”¨"åŸå§‹èµ„æ–™"å®ç°æ›´ç¨³å®šçš„å¹»è§‰æŠ‘åˆ¶ã€‚</p>
<p><strong>â€Œ2.çŸ¥è¯†æ•´åˆæœºåˆ¶â€Œ</strong></p>
<p>å¾®è°ƒï¼šå°†çŸ¥è¯†å›ºåŒ–è‡³æ¨¡å‹å‚æ•°å†…éƒ¨ã€‚</p>
<p>RAGï¼šæ„å»ºå¤–éƒ¨çŸ¥è¯†åº“å®ç°åŠ¨æ€æ£€ç´¢è°ƒç”¨ã€‚</p>
<p><strong>â€Œ3.æ›´æ–°æ•ˆç‡â€Œ</strong></p>
<p>å¾®è°ƒï¼šæ¯æ¬¡çŸ¥è¯†æ›´æ–°éƒ½éœ€é‡æ–°è®­ç»ƒæˆ–å¢é‡è®­ç»ƒã€‚</p>
<p>RAGï¼šä»…éœ€æ›´æ–°ç´¢å¼•åº“ï¼Œè€—æ—¶é€šå¸¸ä¸ºåˆ†é’Ÿçº§è‡³ç§’çº§ã€‚</p>
<p><strong>â€Œ4.ä¸ªæ€§åŒ–é€‚é…â€Œ</strong></p>
<p>å¾®è°ƒï¼šæ›´é€‚ç”¨äºè°ƒæ•´è¾“å‡ºé£æ ¼ï¼ˆå¦‚ç¼–ç¨‹è§„èŒƒã€å®¢æœè¯æœ¯ç­‰ï¼‰ã€‚</p>
<p>RAGï¼šæ›´é«˜æ•ˆæ•´åˆä¸šåŠ¡é¢†åŸŸä¸“ä¸šçŸ¥è¯†ã€‚</p>
<p><strong>5â€Œ.å†³ç­–é€æ˜åº¦â€Œ</strong></p>
<p>å¾®è°ƒï¼šæ¨¡å‹å†…éƒ¨å†³ç­–è¿‡ç¨‹ä¸å¯è§ã€‚</p>
<p>RAGï¼šå¯è¿½æº¯å¼•ç”¨æ–‡æ¡£çš„å…·ä½“å†…å®¹ç‰‡æ®µã€‚</p>
<p><strong>6â€Œ.èµ„æºæ¶ˆè€—â€Œ</strong></p>
<p>å¾®è°ƒï¼šè®­ç»ƒæˆæœ¬é«˜æ˜‚ï¼Œæ¨ç†å»¶è¿Ÿä¸åŸæ¨¡å‹ç›¸å½“ã€‚</p>
<p>RAGï¼šå› å¢åŠ æ£€ç´¢-æ’åºæµç¨‹ä¼šç•¥å¾®æå‡ç«¯åˆ°ç«¯å»¶è¿Ÿã€‚</p>
<p>è¡Œä¸šå®è·µå»ºè®®ï¼š</p>
<p>"â€Œå…ˆå®æ–½RAGéªŒè¯æ•ˆæœï¼Œå¾…ç³»ç»Ÿç¨³å®šè¿è¡Œåï¼Œå†é€šè¿‡å¾®è°ƒä¼˜åŒ–è¾“å‡ºé£æ ¼ä¸æ ¼å¼â€Œ"çš„æ¸è¿›å¼ç­–ç•¥æœ€ä¸ºå¸¸è§ã€‚</p>
<p><strong>å››ã€RAG çš„åŸºæœ¬æ¨¡å‹ï¼š5 ä¸ªé˜¶æ®µè®²æ¸…æ¥š</strong></p>
<p>RAGç³»ç»Ÿçš„äº”ä¸ªæ ¸å¿ƒé˜¶æ®µâ€Œ</p>
<p><strong>1.æ•°æ®åŠ è½½</strong>ï¼ˆLoadingï¼‰</p>
<p>åŠŸèƒ½ï¼šæ•´åˆå¤šæºæ•°æ®è¾“å…¥</p>
<p>æ”¯æŒæ ¼å¼ï¼šPDF/Wordæ–‡æ¡£ã€ç½‘é¡µå†…å®¹ã€æ•°æ®åº“è®°å½•ã€APIæ¥å£æ•°æ®ç­‰</p>
<p>æ ¸å¿ƒç»„ä»¶ï¼š</p>
<p>èŠ‚ç‚¹ï¼ˆNodeï¼‰ï¼šæ–‡æœ¬åˆ†å—åçš„æœ€å°å¤„ç†å•å…ƒ</p>
<p>è¿æ¥å™¨ï¼ˆConnectorï¼‰ï¼šå®ç°ä¸åŒæ•°æ®æºçš„æ ‡å‡†æ¥å…¥</p>
<p><strong>2.ç´¢å¼•æ„å»º</strong>ï¼ˆIndexingï¼‰</p>
<p>ç›®æ ‡ï¼šå»ºç«‹é«˜æ•ˆæ£€ç´¢æœºåˆ¶</p>
<p>å…³é”®æŠ€æœ¯ï¼š</p>
<p>ç´¢å¼•ï¼ˆIndexï¼‰ï¼šç»“æ„åŒ–æ£€ç´¢ç›®å½•</p>
<p>åµŒå…¥ï¼ˆEmbeddingï¼‰ï¼šæ–‡æœ¬å‘é‡åŒ–è½¬æ¢</p>
<p><strong>3.æ•°æ®å­˜å‚¨</strong>ï¼ˆStorageï¼‰</p>
<p>å­˜å‚¨å†…å®¹ï¼šæ–‡æœ¬èŠ‚ç‚¹ã€å‘é‡è¡¨ç¤ºã€å…ƒæ•°æ®</p>
<p>å…¸å‹æ–¹æ¡ˆï¼šElasticsearchã€OpenSearchã€Pineconeã€Chromaç­‰</p>
<p><strong>4.æŸ¥è¯¢å¤„ç†</strong>ï¼ˆQueryingï¼‰</p>
<p>æ‰§è¡Œæµç¨‹ï¼š</p>
<p>æ£€ç´¢å™¨ï¼ˆRetrieverï¼‰ï¼šå‘é‡åº“åŒ¹é…å€™é€‰èŠ‚ç‚¹</p>
<p>è·¯ç”±å™¨ï¼ˆRouterï¼‰ï¼šç¡®å®šæ£€ç´¢ç­–ç•¥ã€åˆ¤æ–­æ˜¯å¦éœ€è¦ç»“æ„åŒ–æŸ¥è¯¢ã€å†³å®šæ˜¯å¦è°ƒç”¨ç‰¹å®šAgent</p>
<p>èŠ‚ç‚¹åå¤„ç†å™¨ï¼ˆNode Post-Processorï¼‰ï¼šç»“æœå»é‡ã€å†…å®¹åˆå¹¶ã€ä¿¡æ¯æ‰©å±•</p>
<p>å“åº”åˆæˆå™¨ï¼ˆResponse Synthesizerï¼‰ï¼šç»„åˆæ£€ç´¢ç»“æœä¸ç”¨æˆ·é—®é¢˜ã€ç”ŸæˆLLMè¾“å…¥Prompt</p>
<p><strong>5.ç³»ç»Ÿè¯„ä¼°</strong>ï¼ˆEvaluationï¼‰</p>
<p>æ–¹æ³•ï¼šæ„å»ºæ ‡å‡†é—®ç­”æµ‹è¯•é›†</p>
<p>è¯„ä¼°ç»´åº¦ï¼šæ£€ç´¢å‡†ç¡®ç‡ã€åˆ†å—åˆç†æ€§ã€Promptæœ‰æ•ˆæ€§</p>
<p>è¿­ä»£ä¼˜åŒ–ï¼šæŒç»­è°ƒæ•´ç³»ç»Ÿå‚æ•°</p>
<p><strong>äº”ã€RAG çš„æŠ€æœ¯ä½“ç³»å’Œè¯„ä¼°æŒ‡æ ‡</strong></p>
<p>æ£€ç´¢éƒ¨åˆ†è¯„ä¼°</p>
<p>åŸºç¡€æ£€ç´¢æŒ‡æ ‡ï¼ˆè¡¡é‡"æ£€ç´¢å‡†ç¡®åº¦"ï¼‰ï¼š</p>
<p>â€ŒPrecisionï¼ˆç²¾å‡†ç‡ï¼‰â€Œï¼šç³»ç»Ÿè¿”å›ç»“æœä¸­æ­£ç¡®ç­”æ¡ˆçš„å æ¯”ã€‚</p>
<p>â€ŒRecallï¼ˆå¬å›ç‡ï¼‰â€Œï¼šæ‰€æœ‰æ­£ç¡®ç­”æ¡ˆä¸­è¢«ç³»ç»Ÿæ£€ç´¢åˆ°çš„æ¯”ä¾‹ã€‚</p>
<p>â€ŒF1 Scoreâ€Œï¼šç»¼åˆç²¾å‡†ç‡ä¸å¬å›ç‡çš„å¹³è¡¡æŒ‡æ ‡ã€‚</p>
<p>æ’åºä¼˜åŒ–æŒ‡æ ‡ï¼ˆè¡¡é‡"ç»“æœæ’åºè´¨é‡"ï¼‰ï¼š</p>
<p>â€ŒMRRï¼ˆMean Reciprocal Rankï¼‰â€Œï¼šæ­£ç¡®ç­”æ¡ˆæ’åè¶Šé å‰å¾—åˆ†è¶Šé«˜ã€‚</p>
<p>â€ŒMAPï¼ˆMean Average Precisionï¼‰â€Œï¼šå¤šæŸ¥è¯¢åœºæ™¯ä¸‹çš„å¹³å‡ç²¾ç¡®ç‡å‡å€¼ã€‚</p>
<p>â€ŒNDCGâ€Œï¼šå¯¹æ’åé å‰çš„ç›¸å…³æ–‡æ¡£èµ‹äºˆæ›´é«˜æƒé‡ã€‚</p>
<p>æ ¸å¿ƒè¯„ä¼°ç»´åº¦ï¼š</p>
<p>"æ£€ç´¢å†…å®¹å¯¹åç»­å›ç­”çš„æ”¯æ’‘ä½œç”¨å¦‚ä½•ï¼Ÿ"</p>
<p>ç”Ÿæˆç»“æœè¯„ä¼°ï¼ˆå¤§æ¨¡å‹å›ç­”è´¨é‡ï¼‰</p>
<p>â€ŒCorrectnessâ€Œï¼šä¸æ ‡å‡†ç­”æ¡ˆçš„ç¬¦åˆåº¦</p>
<p>â€ŒRelevanceâ€Œï¼šå¯¹ç”¨æˆ·é—®é¢˜çš„è´´åˆç¨‹åº¦</p>
<p>â€ŒLogicâ€Œï¼šè®ºè¯ç»“æ„çš„ä¸¥è°¨æ€§</p>
<p>â€ŒStyleâ€Œï¼šæ–‡æœ¬é•¿åº¦ã€è¯­æ°”ä¸å“ç‰Œè°ƒæ€§çš„åŒ¹é…</p>
<p>ç”Ÿæˆè¿‡ç¨‹è¯„ä¼°ï¼ˆç»†ç²’åº¦æŒ‡æ ‡ï¼‰</p>
<p>â€ŒFaithfulnessâ€Œï¼šå›ç­”ä¸¥æ ¼åŸºäºæ£€ç´¢å†…å®¹</p>
<p>â€ŒNoise Robustnessâ€Œï¼šè¿‡æ»¤æ— å…³ä¿¡æ¯çš„èƒ½åŠ›</p>
<p>â€ŒNegative Rejectionâ€Œï¼šå¯¹æœªçŸ¥é—®é¢˜çš„å¦è¯šå“åº”</p>
<p>â€ŒInfo Integrationâ€Œï¼šå¤šæºä¿¡æ¯æ•´åˆèƒ½åŠ›</p>
<p>â€ŒCounterfactual Robustnessâ€Œï¼šæŠµå¾¡é”™è¯¯å‡è®¾å¹²æ‰°</p>
<p>è¿™äº›æŒ‡æ ‡å…±åŒå®šä¹‰äº†RAGç³»ç»Ÿåœ¨å®é™…åº”ç”¨ä¸­çš„å¯é æ€§æ°´å¹³ã€‚</p>
<p><strong>å…­ã€é•¿ä¸Šä¸‹æ–‡ã€Agent è®°å¿†ã€Text2SQL å„è‡ªçš„å®šä½</strong></p>
<p>æ ¸å¿ƒé—®é¢˜å›å½’ï¼šâ€Œ</p>
<p>è¿™äº›æŠ€æœ¯èƒ½å¦çœŸæ­£å–ä»£RAGï¼Ÿæˆ‘ä»¬é€ä¸€åˆ†æã€‚</p>
<p><strong>1â€Œ.é•¿ä¸Šä¸‹æ–‡æŠ€æœ¯</strong>ï¼ˆLong Contextï¼‰â€Œ</p>
<p>â€Œæ ¸å¿ƒä»·å€¼ï¼šâ€Œæ‰©å±•æ¨¡å‹å•æ¬¡å¯¹è¯çš„ä¿¡æ¯æ‰¿è½½é‡ï¼Œä¾‹å¦‚å®Œæ•´è§£æå¤šé¡µæ–‡æ¡£æˆ–å¤æ‚åˆåŒã€‚</p>
<p>â€Œæ›¿ä»£RAGçš„å¯èƒ½æ€§ï¼šâ€Œ</p>
<p>æœ‰é™ï¼Œä¸»è¦å—åˆ¶äºä¸‰ç‚¹ï¼š</p>
<p>â€Œæ³¨æ„åŠ›è¡°å‡â€Œï¼šå½“ä¸Šä¸‹æ–‡æ‰©å±•è‡³æ•°åä¸‡tokenæ—¶ï¼Œæ¨¡å‹å¯¹è¿œç«¯å†…å®¹çš„æ•æ„Ÿåº¦ä¼šæ˜¾è‘—é™ä½ã€‚</p>
<p>â€Œéæ™ºèƒ½ç­›é€‰â€Œï¼šè¯¥æŠ€æœ¯ä»…æä¾›"å®¹é‡æ‰©å±•"åŠŸèƒ½ï¼Œå…³é”®å†…å®¹ç­›é€‰ä»éœ€äººå·¥å†³ç­–â€”â€”åŒ…æ‹¬è¾“å…¥å†…å®¹çš„é€‰æ‹©ä¸æ’åºé€»è¾‘ï¼Œè¿™æœ¬è´¨ä¸Šä»æ˜¯æ£€ç´¢éœ€æ±‚çš„è½¬ç§»ã€‚</p>
<p>â€Œç»æµæ€§é™åˆ¶â€Œï¼šå¤§è§„æ¨¡ä¸Šä¸‹æ–‡æ¨ç†æˆæœ¬é«˜æ˜‚ï¼Œå¤šæ•°ä¸šåŠ¡åœºæ™¯éš¾ä»¥æ‰¿æ‹…ã€‚</p>
<p>â€Œå®é™…åº”ç”¨å®šä½ï¼šâ€Œ</p>
<p>æ›´é€‚åˆä½œä¸ºRAGçš„è¡¥å……æ¨¡å—ï¼Œä¾‹å¦‚ï¼š</p>
<p>å¯¹RAGé¢„ç­›é€‰çš„æ–‡æ¡£è¿›è¡Œæ·±åº¦åˆ†æï¼ˆå¦‚é•¿æŠ¥å‘Šæ‘˜è¦ã€ä»£ç åº“è§£æï¼‰ã€‚</p>
<p>ä½œä¸º"å¢å¼ºç»„ä»¶"è¾…åŠ©RAGå®Œæˆå¤æ‚ä»»åŠ¡ã€‚</p>
<p><strong>â€Œ2.Agentè®°å¿†ç³»ç»Ÿâ€Œ</strong></p>
<p>â€Œæ ¸å¿ƒä»·å€¼ï¼šâ€Œç»´æŠ¤å¯¹è¯è¿ç»­æ€§ï¼Œä¿ç•™ç”¨æˆ·åå¥½ä¸ä»»åŠ¡çŠ¶æ€ï¼ˆå¦‚å†™ä½œé£æ ¼ã€å·²ç¡®è®¤ä¿¡æ¯ï¼‰ã€‚</p>
<p>â€Œæ›¿ä»£RAGçš„ä¸å¯è¡Œæ€§ï¼šâ€Œ</p>
<p>ä¸¤è€…åŠŸèƒ½ç»´åº¦æˆªç„¶ä¸åŒï¼š</p>
<p>â€ŒAgentè®°å¿†â€Œï¼šèšç„¦å¯¹è¯è¿›ç¨‹ç®¡ç†ï¼ˆå¦‚å·²ä¸Šä¼ æ–‡ä»¶ã€ç”¨æˆ·é€‰æ‹©æ–¹æ¡ˆï¼‰ã€‚</p>
<p>â€ŒRAGâ€Œï¼šä¸“æ³¨å¤–éƒ¨çŸ¥è¯†åº“çš„æ¥å…¥ä¸æ£€ç´¢ï¼ˆå¦‚ä¼ä¸šåˆ¶åº¦ã€äº§å“æ–‡æ¡£ï¼‰ã€‚</p>
<p>â€ŒååŒåº”ç”¨åœºæ™¯ï¼šâ€Œ</p>
<p>Agentå°†å¯¹è¯ä¸Šä¸‹æ–‡ï¼ˆå¦‚æŸ¥è¯¢é¡¹ç›®/å®¢æˆ·ï¼‰ä½œä¸ºæ£€ç´¢æ¡ä»¶ï¼Œé©±åŠ¨RAGè·å–ç²¾å‡†æ•°æ®ã€‚</p>
<p>åœ¨å¤šè½®å¯¹è¯ä¸­è‡ªåŠ¨è¡¥å…¨èƒŒæ™¯ä¿¡æ¯ï¼Œé¿å…é‡å¤æè¿°ã€‚</p>
<p><strong>3â€Œ.Text2SQLæŠ€æœ¯â€Œ</strong></p>
<p>â€Œæ ¸å¿ƒä»·å€¼ï¼šâ€Œå°†è‡ªç„¶è¯­è¨€æŸ¥è¯¢è½¬æ¢ä¸ºç»“æ„åŒ–æ•°æ®åº“æ“ä½œï¼ˆå¦‚"æŸ¥è¯¢2024å¹´10æœˆè®¢å•æ€»é¢"â†’è‡ªåŠ¨ç”ŸæˆSQLâ†’è¿”å›ç²¾ç¡®ç»“æœï¼‰ã€‚</p>
<p>â€Œæ›¿ä»£RAGçš„è¾¹ç•Œï¼šâ€Œ</p>
<p>åœ¨ç»“æ„åŒ–æ•°æ®æŸ¥è¯¢åœºæ™¯ä¸­ï¼Œå…¶æ•ˆæœä¼˜äº"æ–‡æœ¬æ£€ç´¢+ç”Ÿæˆ"æ¨¡å¼ã€‚</p>
<p>ä½†æ— æ³•è¦†ç›–éç»“æ„åŒ–çŸ¥è¯†ï¼ˆå¦‚è§„ç« åˆ¶åº¦ã€æŠ€æœ¯æ–‡æ¡£ï¼‰çš„å¤„ç†éœ€æ±‚ã€‚</p>
<p>â€Œç³»ç»Ÿé›†æˆè§†è§’ï¼šâ€Œ</p>
<p>å¯ä½œä¸ºRAGä½“ç³»çš„ä¸“ç”¨æ£€ç´¢åç«¯ï¼Œç”±è·¯ç”±æœºåˆ¶åˆ¤æ–­ä¼˜å…ˆè°ƒç”¨çŸ¥è¯†åº“ï¼ˆå‘é‡æ£€ç´¢ï¼‰æˆ–æ•°æ®åº“ï¼ˆText2SQLï¼‰ï¼Œæœ€ç»ˆç»¼åˆè¾“å‡ºç»“æœã€‚</p>
<p><strong>ä¸ƒã€å›åˆ°å¼€å¤´çš„é—®é¢˜ï¼šRAG ä¼šè¢«æ›¿ä»£å—ï¼Ÿ</strong></p>
<p>è‹¥æ‹†è§£å„é¡¹æŠ€æœ¯çš„æ ¸å¿ƒå®šä½ï¼Œå¯æ¸…æ™°è¯†åˆ«å…¶å·®å¼‚åŒ–ä»·å€¼ï¼š</p>
<p>â€Œé•¿ä¸Šä¸‹æ–‡â€Œï¼šçªç ´"å•æ¬¡äº¤äº’çš„ä¿¡æ¯å®¹é‡é™åˆ¶"</p>
<p>â€ŒAgentè®°å¿†â€Œï¼šå®ç°"è·¨å¯¹è¯è½®æ¬¡çš„ä¸Šä¸‹æ–‡å»¶ç»­"</p>
<p>â€ŒText2SQLâ€Œï¼šæ„å»º"è‡ªç„¶è¯­è¨€ä¸ç»“æ„åŒ–æ•°æ®çš„æ¡¥æ¢"</p>
<p>â€ŒRAGâ€Œï¼šå®Œæˆ"å¤šæºå¼‚æ„çŸ¥è¯†çš„æ™ºèƒ½ç­›é€‰ä¸æ•´åˆ"</p>
<p>è¿™äº›èƒ½åŠ›å‘ˆæ­£äº¤å…³ç³»ï¼Œå…±åŒæ„æˆæŠ€æœ¯çŸ©é˜µè€Œéæ›¿ä»£é€‰é¡¹ã€‚</p>
<p>é¢å‘å®é™…è½åœ°çš„ç³»ç»Ÿæ¶æ„å°†å‘ˆç°ä»¥ä¸‹ç‰¹å¾ï¼š</p>
<p>çŸ¥è¯†å¢å¼ºæ¨¡å—ï¼ˆå‘é‡æ£€ç´¢+æ–‡æœ¬RAGï¼‰ã€è¶…é•¿æ–‡æœ¬è§£æèƒ½åŠ›ã€å¯¹è¯çŠ¶æ€ç®¡ç†æœºåˆ¶ã€ç»“æ„åŒ–æŸ¥è¯¢æ¥å£ï¼ˆText2SQL+APIè”åŠ¨ï¼‰ã€å¯é€‰çš„ç‰¹å¾å¾®è°ƒå±‚</p>
<p>ç”±æ­¤å¯æ¨å¯¼ï¼šRAGä½œä¸ºåŸºç¡€è®¾æ–½å±‚çš„åœ°ä½ä¸ä¼šåŠ¨æ‘‡ï¼Œå…¶æ¼”è¿›å°†èšç„¦äºï¼š</p>
<p>æŠ€æœ¯å®ç°è·¯å¾„åˆ›æ–°ã€æ•ˆæœè¯„ä¼°æ ‡å‡†ä¼˜åŒ–ã€ä¸å…¶ä»–ç»„ä»¶çš„ååŒèŒƒå¼</p>
<p><strong>å…«ã€å¦‚æœä½ åœ¨å›¢é˜Ÿé‡Œè½åœ° RAGï¼Œå¯ä»¥ä»å“ªå‡ æ­¥å¼€å§‹ï¼Ÿ</strong></p>
<p>å®æ“å»ºè®®æ¨è¿›æ­¥éª¤ï¼šâ€Œ</p>
<p><strong>1â€Œ.ä¼˜å…ˆç¡®å®šåº”ç”¨åœºæ™¯â€Œ</strong></p>
<p>æ˜ç¡®éœ€æ±‚ç±»å‹ï¼šæ˜¯å¸¸è§é—®é¢˜è§£ç­”ï¼ˆFAQï¼‰ã€ä¼ä¸šçŸ¥è¯†åº“æ£€ç´¢ï¼Œè¿˜æ˜¯å†…éƒ¨æ–‡æ¡£æ™ºèƒ½åŠ©æ‰‹ï¼Ÿä¸åŒåœºæ™¯éœ€åŒ¹é…å·®å¼‚åŒ–çš„æ£€ç´¢ç­–ç•¥ä¸è¯„ä¼°æ ‡å‡†ã€‚</p>
<p><strong>2â€Œ.å¿«é€Ÿæ„å»ºæœ€å°å¯è¡Œäº§å“</strong>ï¼ˆMVPï¼‰â€Œ</p>
<p>å·¥å…·é€‰æ‹©ï¼š</p>
<p>ç›´æ¥é‡‡ç”¨å¯è§†åŒ–å¹³å°ï¼ˆå¦‚QAnythingã€Difyã€Ragflowï¼‰é™ä½å¼€å‘é—¨æ§›</p>
<p>æˆ–é€šè¿‡LlamaIndex/LangChainæ¡†æ¶ç»“åˆFastAPI/Gradioæ­å»ºè½»é‡Demo</p>
<p>æ ¸å¿ƒéªŒè¯ç›®æ ‡ï¼š</p>
<p>æ•°æ®å¯ç”¨æ€§ã€æ£€ç´¢å‡†ç¡®ç‡ã€ç»ˆç«¯ç”¨æˆ·æ“ä½œå‹å¥½æ€§ã€å»ºç«‹æ—©æœŸè¯„ä¼°æœºåˆ¶â€Œ</p>
<p>åˆ›å»ºæ ‡å‡†åŒ–æµ‹è¯•é—®é¢˜é›†ï¼Œå®šæœŸè¿›è¡Œæ•ˆæœå›æº¯</p>
<p>å…³é”®æŒ‡æ ‡ç›‘æ§ï¼š</p>
<p>æ–‡æ¡£å¬å›ç‡ä¸ç²¾ç¡®åº¦ï¼ˆRecall/Precisionã€NDCGï¼‰</p>
<p>å›ç­”ä¸åŸæ–‡ä¸€è‡´æ€§ï¼ˆFaithfulnessï¼‰åŠå¹»è§‰æ§åˆ¶ï¼ˆCorrectnessï¼‰</p>
<p><strong>3â€Œ.æ¸è¿›å¼åŠŸèƒ½æ‰©å±•â€Œ</strong></p>
<p>å½“åœºæ™¯å¤æ‚åº¦æå‡æ—¶ï¼Œé€æ­¥é›†æˆï¼š</p>
<p>æ™ºèƒ½ä½“ï¼ˆAgentï¼‰è‡ªåŠ¨åŒ–æµç¨‹ã€Text2SQLæ•°æ®æŸ¥è¯¢èƒ½åŠ›ã€é•¿ä¸Šä¸‹æ–‡ç†è§£æŠ€æœ¯</p>
<p>ç¤ºä¾‹åº”ç”¨ï¼šç”¨æˆ·è¯·æ±‚"åˆ†ææŸäº§å“è¿‘ä¸‰æœˆé”€å”®æ•°æ®å¹¶ç»“åˆç­–ç•¥æ–‡æ¡£è¾“å‡ºå»ºè®®"æ—¶ï¼Œå¯ç»„åˆText2SQLæ•°æ®æå–+RAGæ–‡æ¡£æ£€ç´¢+LLMç»¼åˆåˆ†æèƒ½åŠ›ã€‚</p>
<p><strong>æ›´å¤šAIå¤§æ¨¡å‹å­¦ä¹ è§†é¢‘åŠèµ„æºï¼Œéƒ½åœ¨<a href="https://link.juejin.cn?target=https%3A%2F%2Fyuan.zhipoai.cn%2F" target="_blank" title="https://yuan.zhipoai.cn/" ref="nofollow noopener noreferrer">æ™ºæ³ŠAI</a>ã€‚</strong></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[npmå‡ ä¸ªå®ç”¨å‘½ä»¤]]></title>    <link>https://juejin.cn/post/7581306080434667571</link>    <guid>https://juejin.cn/post/7581306080434667571</guid>    <pubDate>2025-12-08T12:17:24.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581306080434667571" data-draft-id="7581004702945132571" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="npmå‡ ä¸ªå®ç”¨å‘½ä»¤"/> <meta itemprop="keywords" content="NPM,å‰ç«¯"/> <meta itemprop="datePublished" content="2025-12-08T12:17:24.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="168169"/> <meta itemprop="url" content="https://juejin.cn/user/2541726614191528"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            npmå‡ ä¸ªå®ç”¨å‘½ä»¤
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2541726614191528/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    168169
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-08T12:17:24.000Z" title="Mon Dec 08 2025 12:17:24 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»5åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">å‰è¨€</h2>
<p>æœ€è¿‘æ¥åˆ°å…¬å¸å®‰å…¨å›¢é˜Ÿçš„é¡¹ç›®é£é™©è¡¨æ ¼ï¼Œåˆ—å‡ºäº†å½“å‰å‰ç«¯é¡¹ç›®çš„ä¸€äº›å®‰å…¨é£é™©ï¼Œå¤§æ¦‚æœ‰190å¤šé¡¹ï¼Œç¬¬ä¸€ä¸ªå¤§å¨æ˜¯XSSçš„ï¼Œç¬¬äºŒå¤§å¨å°±æ˜¯npmåŒ…éœ€è¦å‡çº§çš„ï¼Œçœ‹äº†ä¸‹ï¼Œéœ€è¦å‡çº§çš„å¤§æ¦‚æœ‰55ä¸ªåŒ…ï¼Œæœ€è¿‘åœ¨åšè¿™äº›åŒ…å‡çº§çš„æ—¶å€™å‘ç°äº†NPMä»¥å‰å¾ˆå°‘ç”¨ï¼Œä½†æ˜¯ç¡®æ˜¯å¾ˆå®ç”¨çš„å‡ ä¸ªå‘½ä»¤ï¼Œç‰¹è®°å½•åˆ†äº«</p>
<h2 data-id="heading-1">å®ç”¨å‘½ä»¤</h2>
<h3 data-id="heading-2">npm install package@version</h3>
<p>æ­¤å‘½ä»¤ç›¸å¯¹å…¶å®ƒè¦ä»‹ç»çš„å‡ ä¸ªå‘½ä»¤åº”è¯¥æ˜¯ä½¿ç”¨ç‡ç®—é«˜çš„ï¼Œå®ƒçš„åŠŸèƒ½å°±æ˜¯æŒ‡å®šå®‰è£…ç‰¹å®šçš„ç‰ˆæœ¬
å…ˆæ¥çœ‹ä¸€ä¸‹package.jsonç‰ˆæœ¬è§„åˆ™ç¬¦å·å¯¹æ¯”è¡¨ï¼š</p>















































<table><thead><tr><th>ç¬¦å·</th><th>ç¤ºä¾‹</th><th>å…è®¸çš„ç‰ˆæœ¬èŒƒå›´</th><th>æ ¸å¿ƒåœºæ™¯</th></tr></thead><tbody><tr><td>æ— ç¬¦å·</td><td><code>1.4.2</code></td><td>ä»… <code>1.4.2</code></td><td>ç‰ˆæœ¬æ•æ„Ÿï¼Œç¦æ­¢ä»»ä½•æ›´æ–°</td></tr><tr><td>^ï¼ˆæ’å…¥å·ï¼‰</td><td><code>^1.4.2</code></td><td>1.4.2 â†’ 1.9.9ï¼ˆä¸»ç‰ˆæœ¬ä¸å˜ï¼‰</td><td>æ—¥å¸¸ä¾èµ–ï¼Œè‡ªåŠ¨æ›´åŠŸèƒ½/ä¿®å¤</td></tr><tr><td>~ï¼ˆæ³¢æµªå·ï¼‰</td><td><code>~1.4.2</code></td><td>1.4.2 â†’ 1.4.9ï¼ˆä»…ä¿®è®¢å·æ›´æ–°ï¼‰</td><td>ä¿å®ˆæ›´æ–°ï¼Œä»…æ¥å— bug ä¿®å¤</td></tr><tr><td>&gt;/&lt;</td><td><code>&gt;=1.4.2 &lt;3.0.0</code></td><td>1.4.2 â†’ 2.9.9</td><td>ç²¾ç¡®æ§åˆ¶ç‰ˆæœ¬åŒºé—´</td></tr><tr><td>*ï¼ˆæ˜Ÿå·ï¼‰</td><td><code>1.*</code></td><td>1.0.0 â†’ 1.999.999</td><td>æ— ç‰ˆæœ¬ä¾èµ–ï¼ˆæå°‘ç”¨ï¼‰</td></tr><tr><td>!ï¼ˆæ„Ÿå¹å·ï¼‰</td><td><code>&gt;=1.4.0 !1.4.2</code></td><td>1.4.0ã€1.4.1ã€1.4.3+ï¼ˆæ’é™¤ 1.4.2ï¼‰</td><td>ç¦æ­¢æœ‰é—®é¢˜çš„ç‰ˆæœ¬</td></tr></tbody></table>
<p>å¦‚æœä½ ä½¿ç”¨æ™®é€šçš„npm install packageï¼Œé‚£å®ƒåœ¨package.jsoné‡Œå†™å…¥çš„ç‰ˆæœ¬è§„åˆ™æ˜¯ç¬¬äºŒé¡¹ï¼Œå¦‚é¡¹ç›®æœ‰lockæ–‡ä»¶çš„æ—¶å€™é—®é¢˜ä¸å¤§ï¼Œä½†æ˜¯æ²¡æœ‰çš„æ—¶å€™ï¼Œä½ æ‰§è¡Œnpm iï¼Œå®ƒä¼šåœ¨å¯å…è®¸çš„èŒƒå›´å†…ä¸»åŠ¨æ›´æ–°ç‰ˆæœ¬ï¼Œå¦‚æœä½ ä½¿ç”¨npm install package@versionï¼Œé‚£å†™å…¥package.jsonçš„ç‰ˆæœ¬è§„åˆ™ä¼šæ˜¯ç¬¬ä¸€ç§ï¼Œæ­¤æ¬¡å®‰å…¨å›¢é˜Ÿç»™å‡ºäº†è¦æ›´æ–°åˆ°çš„æŒ‡å®šç‰ˆæœ¬ï¼Œæ‰€ä»¥åœ¨æ­¤å¤„æˆ‘é€‰æ‹©çš„é€šè¿‡npm install package@versionæ¥å®ç°å®‰è£…æŒ‡å®šç‰ˆæœ¬å¹¶é”æ­»ç‰ˆæœ¬å·
ä½¿ç”¨ç¤ºä¾‹:</p>
<pre><code class="hljs language-css" lang="css">npm install sass<span class="hljs-keyword">@1</span>.94.2
</code></pre>
<h3 data-id="heading-3">npm ls package [--depth=0]</h3>
<p>æ­¤å‘½ä»¤ç”¨äºæŸ¥çœ‹ä½ å½“å‰é¡¹ç›®å®‰è£…çš„packageç‰ˆæœ¬æ˜¯å¤šå°‘ï¼Œå®ƒä¼šåˆ—å‡ºå®‰è£…çš„æ‰€æœ‰çš„ç‰ˆæœ¬ï¼Œæ­¤å¤„æˆ‘ä»¬ä»¥vueåŒ…ä¸ºä¾‹ï¼Œæ‰§è¡Œå¦‚ä¸‹å‘½ä»¤</p>
<pre><code class="hljs language-bash" lang="bash">npm <span class="hljs-built_in">ls</span> vue
</code></pre>
<p>æ§åˆ¶å°ä¼šçœ‹åˆ°å¦‚ä¸‹è¾“å‡ºç»“æœï¼š</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3263a6b1d2dd406fa3002a81d36a7844~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgMTY4MTY5:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765801044&amp;x-signature=w1isBF9XzT6jo3NabVLJQmShd1g%3D" alt="image.png" loading="lazy"/></p>
<p>ä»ä¸Šå›¾æˆ‘ä»¬è¿˜çœ‹åˆ°éƒ¨åˆ†åŒ…åè¿˜å¸¦æœ‰dedupedçš„ç°è‰²å­—ï¼Œè¿™ä¸ªçš„æ„æ€æ˜¯â€œå»é‡â€ çš„æ„æ€ï¼Œæ˜¯ de-duplicated çš„ç¼©å†™ï¼Œä»£è¡¨è¿™ä¸ªåŒ…æ˜¯ â€œé‡å¤ä¾èµ–è¢«åˆå¹¶åï¼Œå¤ç”¨äº†å·²å®‰è£…çš„ç‰ˆæœ¬â€ï¼Œæ ¸å¿ƒæ˜¯ npm ä¼˜åŒ–ä¾èµ–æ ‘çš„ä¸€ç§æœºåˆ¶ï¼Œå½“é¡¹ç›®ä¸­å¤šä¸ªä¾èµ–åŒæ—¶éœ€è¦åŒä¸€ä¸ªåŒ…ï¼ˆä¸”ç‰ˆæœ¬å…¼å®¹ï¼‰æ—¶ï¼Œnpm ä¼šè‡ªåŠ¨æŠŠé‡å¤çš„åŒ…åˆå¹¶åˆ°ä¾èµ–æ ‘çš„æ›´ä¸Šå±‚ï¼ˆæ¯”å¦‚æ ¹ç›®å½•çš„ node_modulesï¼‰ï¼Œé¿å…é‡å¤å®‰è£…ã€‚æ­¤æ—¶åœ¨ npm ls ä¸­ï¼Œè¢«åˆå¹¶çš„é‡å¤åŒ…å°±ä¼šæ ‡æ³¨ dedupedï¼Œè¡¨ç¤º â€œè¿™ä¸ªåŒ…æ²¡å•ç‹¬è£…ï¼Œè€Œæ˜¯å¤ç”¨äº†å…¶ä»–åœ°æ–¹å·²æœ‰çš„ç‰ˆæœ¬â€
ä¸Šé¢å‘½ä»¤è¿˜æœ‰ä¸€ä¸ªå¯é€‰å‚æ•°å°±æ˜¯--depthï¼Œæ§åˆ¶ä¾èµ–æ ‘çš„æ˜¾ç¤ºå±‚çº§ï¼Œé¿å…é»˜è®¤npm lsè¾“å‡ºè¿‡äºå†—é•¿ï¼Œç”¨çš„ä¸å¤šï¼Œçœ‹äºŒä¸ªä¾‹å­:</p>
<ul>
<li>npm ls vue --depth=0 åªæ˜¾ç¤ºé¡¹ç›®ç›´æ¥ä¾èµ–ï¼ˆä¸æ˜¾ç¤ºå­ä¾èµ–ï¼‰</li>
<li>npm ls vue --depth=1 æ˜¾ç¤ºç›´æ¥ä¾èµ– + ä¸€çº§å­ä¾èµ–</li>
</ul>
<h3 data-id="heading-4">npm explain package</h3>
<p>ç²¾å‡†è§£é‡ŠæŸä¸ªåŒ…è¢«å®‰è£…çš„åŸå› ï¼ˆè°ä¾èµ–å®ƒã€ä¾èµ–ç‰ˆæœ¬èŒƒå›´ã€å®‰è£…è·¯å¾„ï¼‰ï¼Œè§£å†³ã€Œæ˜æ˜æ²¡æ‰‹åŠ¨å®‰è£…ï¼Œå´å‡ºç°åœ¨node_modulesã€çš„å›°æƒ‘ï¼Œä¸ªäººæ„Ÿè§‰è¿™ä¸ªå‘½ä»¤å’Œä¸Šé¢lsæœ‰ä¸€ç‚¹ç›¸ä¼¼ï¼Œéƒ½å¯ä»¥æŸ¥çœ‹å½“å‰åŒ…å®‰è£…äº†ä»€ä¹ˆç‰ˆæœ¬ï¼Œå“ªä¸€ä¸ªç‰ˆæœ¬è¢«å®‰è£…æ˜¯å› ä¸ºå“ªä¸€ä¸ªä¾èµ–ï¼Œæˆ‘ä»¬è¿˜æ˜¯ä»¥vueåŒ…æ¥ä¾‹</p>
<pre><code class="hljs">npm explain vue
</code></pre>
<p>åœ¨å‘½ä»¤è¡Œçœ‹åˆ°å¦‚ä¸‹ç»“æœï¼š</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cf2fbe6f705d461f888f45462e4ab6ae~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgMTY4MTY5:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765801044&amp;x-signature=CMAirSEB3xBk0UZtjcQe3D7IsOc%3D" alt="image1.png" loading="lazy"/></p>
<h3 data-id="heading-5">npm view package [version[s]]</h3>
<p>æ­¤å‘½ä»¤å°±æ˜¯æŸ¥çœ‹packageåŒ…çº¿ä¸Šå¯ç”¨çš„ç‰ˆæœ¬,åˆ†å¸¦versiontå’Œä¸å¸¦versionï¼Œversionåˆæœ‰åˆ†å¸¦ä¸å¸¦sï¼Œ</p>
<ul>
<li>ä¸å¸¦version,ä»npmå®˜æ–¹ä»“åº“ï¼ˆæˆ–å½“å‰é…ç½®çš„é•œåƒæºï¼‰ä¸­æŸ¥è¯¢vueåŒ…çš„å…¬å¼€ä¿¡æ¯</li>
<li>å¸¦versionï¼Œå¹¶ä¸”å¸¦så°±æ˜¯åˆ—å‡ºæ‰€æœ‰å¯ç”¨å†å²ç‰ˆæœ¬</li>
<li>å¸¦versionï¼Œä¸å¸¦så°±æ˜¯å½“å‰æœ€æ–°çš„ç¨³å®šå¯ç”¨ç‰ˆæœ¬
æ­¤å¤„æˆ‘ä»¬è¿˜æ˜¯ä»¥vueåŒ…ä¸ºä¾‹ï¼š</li>
</ul>

<pre><code class="hljs language-sql" lang="sql">npm <span class="hljs-keyword">view</span> vue
</code></pre>
<p>æ§åˆ¶å°è¾“å‡ºå¦‚ä¸‹ï¼š</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/30e1d98a707a4d3891d2cdfc53d506ee~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgMTY4MTY5:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765801044&amp;x-signature=aWOXRRjIVZn3NlIuHZnIdh2R9Nc%3D" alt="image2.png" loading="lazy"/></p>
<p>æ­¤å‘½ä»¤è¿˜å¯ä»¥æŒ‡å®šç‰ˆæœ¬å·ï¼Œä½¿ç”¨æ–¹å¼æ˜¯npm view vue@versionï¼Œå°±æ˜¯æŸ¥çœ‹æŒ‡å®šç‰ˆæœ¬çš„å…¬å¼€ä¿¡æ¯ï¼Œè¿™ä¸ªå‘½ä»¤ç»™æˆ‘çš„æ„Ÿè§‰å°±æ˜¯åœ¨å‘½ä»¤è¡Œä¸­æ‰“å¼€vueåŒ…çš„npmç®€ç‰ˆè¯¦æƒ…é¡µ</p>
<pre><code class="hljs language-sql" lang="sql">npm <span class="hljs-keyword">view</span> vue versions
</code></pre>
<p>æ§åˆ¶å°ä¼šçœ‹åˆ°å¦‚ä¸‹è¾“å‡ºç»“æœï¼š</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/035b66367b03477d9291856eb03f8021~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgMTY4MTY5:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765801044&amp;x-signature=eNN4aWAfHbUsNi6m5TKx5%2Fzse24%3D" alt="image3.png" loading="lazy"/></p>
<p>å¦‚æœä¸å¸¦s,æ§åˆ¶å°è¾“å‡ºå¦‚ä¸‹ï¼š</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bc5508b76ed44c06a5c9a06aef98fd81~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgMTY4MTY5:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765801044&amp;x-signature=jvEfLTbhDd5yUJGy6voe%2FOOgkGE%3D" alt="image4.png" loading="lazy"/></p>
<h3 data-id="heading-6">npm view package[@version] dependencies [--json]</h3>
<p>æ­¤å‘½ä»¤å°±æ˜¯ä¸Šé¢npm viewçš„å¦ä¸€ç§ç”¨æ³•ï¼Œå®ƒå¯ä»¥æŸ¥çœ‹å½“å‰åŒ…å½“æŒ‡ç‰ˆæœ¬çš„ç”Ÿäº§ä¾èµ–å’Œå¼€å‘ä¾èµ–ï¼Œä¸ºä»€ä¹ˆå•æå‡ºæ¥è¯´äº†ï¼Œå› ä¸ºè¿™ä¸ªæ˜¯æˆ‘è¿™ä¸€æ¬¡ç”¨çš„æœ€å¤šçš„å‘½ä»¤ï¼Œå› ä¸ºå®‰å…¨å›¢é˜Ÿç»™çš„éœ€è¦ä½ åšå‡çº§çš„åŒ…é‡Œï¼Œå®ƒå¹¶ä¸æ˜¯å½“å‰é¡¹ç›®çš„ç›´æ¥ä¾èµ–ï¼Œå¾ˆå¤šéƒ½æ˜¯äºŒçº§æˆ–è€…ä¸‰çº§ä¾èµ–ï¼Œå¦‚æœä½ è¦å‡ä¸‰çº§ä¾èµ–ï¼Œé‚£ä½ å°±å¾—å»æŸ¥çœ‹ç¥–å…ˆçº§åŒ…å“ªä¸€ä¸ªç‰ˆæœ¬å¯ä»¥è®©ä½ è¿™ä¸ªä¾èµ–å‡çº§ï¼Œå•æå‡ºæ¥çš„å¦ä¸€ä¸ªåŸå› æ˜¯å®ƒè¿˜æœ‰ä¸€ä¸ªåœ¨çº¿webå·¥å…·
æ­¤å¤„æˆ‘ä»¬è¿˜æ˜¯ä»¥vueåŒ…ä¸ºä¾‹ï¼š</p>
<pre><code class="hljs language-sql" lang="sql">npm <span class="hljs-keyword">view</span> vue dependencies <span class="hljs-comment">--json</span>
</code></pre>
<p>å‘½ä»¤è¡Œè¾“å‡ºå¦‚ä¸‹ï¼š</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/64002b044c1043488946ef7428947ce0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgMTY4MTY5:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765801044&amp;x-signature=4Ho8Moa1aKmKhQ2HFKqomd2FUNM%3D" alt="image5.png" loading="lazy"/></p>
<p>å®ƒæœ‰åœ¨çº¿ç‰ˆæœ¬ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fnpmgraph.js.org%2F" target="_blank" title="https://npmgraph.js.org/" ref="nofollow noopener noreferrer">npmgraph.js.org/</a>
ä½¿ç”¨ä½“éªŒå¦‚ä¸‹ï¼š</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cc8c666eb5b940e284c4306b9ab22879~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgMTY4MTY5:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765801044&amp;x-signature=nHeujxPXjIOQtjCbyZgToKIWzFE%3D" alt="image6.png" loading="lazy"/></p>
<p>ä¸€å¼€å§‹æˆ‘æ˜¯ä½¿ç”¨ä¸Šåœ¨å‘½ä»¤è¡ŒæŸ¥çœ‹çš„ï¼Œåé¢å‘ç°è¿™ä¸ªåœ¨çº¿çš„å·¥å…·åï¼Œå°±ä½¿ç”¨çš„éƒ½æ˜¯è¿™ä¸ªåœ¨çº¿çš„å·¥å…·äº†ï¼Œé¡ºä¾¿è¯´ä¸ªé¢˜å¤–è¯ï¼Œå¦‚æœåŒæ ·çš„åŠŸèƒ½å¯ä»¥é€šè¿‡cliæ¥ç”¨ï¼Œä¹Ÿå¯ä»¥é€šè¿‡GUIæ¥ç”¨ï¼Œä½ é€šå¸¸ä¼šé€‰æ‹©å“ªä¸€ä¸ªæ¥ç”¨äº†ï¼Ÿå½“ç„¶ï¼Œæˆ‘æ˜¯åè€…ï¼Œä½ äº†ï¼Ÿ</p>
<h2 data-id="heading-7">å°ç»“</h2>
<p>å¯¹äºåšå‰ç«¯å¼€å‘çš„æˆ‘ä»¬åŸºæœ¬æ¯å¤©éƒ½æœ‰åœ¨ç”¨NPMå‘½ä»¤ï¼Œä½†æ˜¯è¿˜æ˜¯æœ‰å¾ˆå¤šå¥½ç”¨çš„åŠŸèƒ½æ˜¯æ²¡æœ‰å‘ç°çš„ï¼Œæ‰€ä»¥æˆ‘ä¸€ç›´éƒ½å¾ˆæ•¬ç•æŠ€æœ¯ï¼Œå°±åƒæˆ‘å†™ä¸ªäººç®€å†æˆ‘è§‰å¾—æˆ‘è‡ªå·±æŒæ¡äº†çš„æŠ€æœ¯æˆ‘æ•¢ç”¨çš„äºŒä¸ªå­—å°±æ˜¯ç†Ÿç»ƒï¼Œä»æ¥ä¸æ•¢ç”¨ç²¾é€šï¼Œå› ä¸ºç²¾é€šä¸€ä¸ªä¸œè¥¿çœŸçš„ä¸æ˜¯é‚£ä¹ˆå®¹æ˜“çš„
ä¸ªäººçš„çŸ¥è¯†å’Œèƒ½åŠ›æ˜¯æœ‰é™åº¦ï¼Œä½ åœ¨ä½¿ç”¨npmçš„æ—¶å€™æœ‰æ²¡æœ‰å‘ç°å…¶å®ƒçš„ä¸€äº›å¥½ç”¨çš„ä½†æ˜¯ä½¿ç”¨ä¸å¤ªé«˜é¢‘çš„åŠŸèƒ½ï¼ŒæœŸå¾…ä½ çš„ç•™è¨€åˆ†äº«ï¼Œä¸€èµ·å­¦ä¹ ä¸€èµ·è¿›æ­¥</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[æ•°æ®ä¼šè¯´è°ï¼Ÿä¸‰å¤§æ¨æ–­æ–¹æ³•å¸®ä½ â€œå®¡é—®â€æ•°æ®çœŸç›¸]]></title>    <link>https://juejin.cn/post/7581097111896571958</link>    <guid>https://juejin.cn/post/7581097111896571958</guid>    <pubDate>2025-12-08T12:26:42.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581097111896571958" data-draft-id="7581117416811610155" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content=" æ•°æ®ä¼šè¯´è°ï¼Ÿä¸‰å¤§æ¨æ–­æ–¹æ³•å¸®ä½ â€œå®¡é—®â€æ•°æ®çœŸç›¸"/> <meta itemprop="keywords" content="Python,æ•°æ®åˆ†æ,åç«¯"/> <meta itemprop="datePublished" content="2025-12-08T12:26:42.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="databook"/> <meta itemprop="url" content="https://juejin.cn/user/3526889035006702"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
             æ•°æ®ä¼šè¯´è°ï¼Ÿä¸‰å¤§æ¨æ–­æ–¹æ³•å¸®ä½ â€œå®¡é—®â€æ•°æ®çœŸç›¸
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3526889035006702/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    databook
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-08T12:26:42.000Z" title="Mon Dec 08 2025 12:26:42 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»7åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#595959;font-size:15px;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(60,10,30,.04) 3%,transparent 0),linear-gradient(1turn,rgba(60,10,30,.04) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body p{color:#595959;font-size:15px;line-height:2;font-weight:400}.markdown-body p+p{margin-top:16px}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin:0;color:#135ce0}.markdown-body h1{position:relative;text-align:center;font-size:22px;margin:50px 0}.markdown-body h1:before{position:absolute;content:"";top:-10px;left:50%;width:32px;height:32px;transform:translateX(-50%);background-size:100% 100%;opacity:.36;background-repeat:no-repeat;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAABfVBMVEX///8Ad/8AgP8AgP8AgP8Aff8AgP8Af/8AgP8AVf8Af/8Af/8AgP8AgP8Af/8Afv8AAP8Afv8Afv8Aef8AgP8AdP8Afv8AgP8AgP8Acf8Ae/8AgP8Af/8AgP8Af/8Af/8AfP8Afv8AgP8Af/8Af/8Afv8Afv8AgP8Afv8AgP8Af/8Af/8AgP8AgP8Afv8AgP8Af/8AgP8AgP8AgP8Ae/8Afv8Af/8AgP8Af/8AgP8Af/8Af/8Aff8Af/8Abf8AgP8Af/8AgP8Af/8Af/8Afv8AgP8AgP8Afv8Afv8AgP8Af/8Aff8AgP8Afv8AgP8Aff8AgP8AfP8AgP8Ae/8AgP8Af/8AgP8AgP8AgP8Afv8AgP8AgP8AgP8Afv8AgP8AgP8AgP8AgP8AgP8Af/8AgP8Af/8Af/8Aev8Af/8AgP8Aff8Afv8AgP8AgP8AgP8Af/8AgP8Af/8Af/8AgP8Afv8AgP8AgP8AgP8AgP8Af/8AeP8Af/8Af/8Af//////rzEHnAAAAfXRSTlMAD7CCAivatxIDx5EMrP19AXdLEwgLR+6iCR/M0yLRzyFF7JupSXn8cw6v60Q0QeqzKtgeG237HMne850/6Qeq7QaZ+WdydHtj+OM3qENCMRYl1B3K2U7wnlWE/mhlirjkODa9FN/BF7/iNV/2kASNZpX1Wlf03C4stRGxgUPclqoAAAABYktHRACIBR1IAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH4gEaBzgZ4yeM3AAAAT9JREFUOMvNUldbwkAQvCAqsSBoABE7asSOBRUVVBQNNuy9996789+9cMFAMHnVebmdm+/bmdtbQv4dOFOW2UjPzgFyLfo6nweKfIMOBYWwFtmMPGz2Yj2pJI0JDq3udJW6VVbmKa9I192VQFV1ktXUAl5NB0cd4KpnORqsEO2ZIRpF9gJfE9Dckqq0KuZt7UAH5+8EPF3spjsRpCeQNO/tA/qDwIDA+OCQbBoKA8NOdjMySgcZGVM6jwcgRuUiSs0nlPFNSrEpJfU0jTLD6llqbvKxei7OzvkFNQohi0vAsj81+MoqsCaoPOQFgus/1LyxichW+hS2JWCHZ7VlF9jb187pIAYcHiViHAMnp5mTjJ8B5xeEXF4B1ze/fTh/C0h398DDI9HB07O8ci+vRBdvdGnfP4gBuM8vw7X/G3wDmFhFZEdxzjMAAAAldEVYdGRhdGU6Y3JlYXRlADIwMTgtMDEtMjZUMDc6NTY6MjUrMDE6MDA67pVWAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDE4LTAxLTI2VDA3OjU2OjI1KzAxOjAwS7Mt6gAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAAWdEVYdFRpdGxlAGp1ZWppbl9sb2dvIGNvcHlxapmKAAAAV3pUWHRSYXcgcHJvZmlsZSB0eXBlIGlwdGMAAHic4/IMCHFWKCjKT8vMSeVSAAMjCy5jCxMjE0uTFAMTIESANMNkAyOzVCDL2NTIxMzEHMQHy4BIoEouAOoXEXTyQjWVAAAAAElFTkSuQmCC)}.markdown-body h2{position:relative;font-size:20px;border-left:4px solid;padding:0 0 0 10px;margin:30px 0}.markdown-body h3{font-size:16px}.markdown-body ul{list-style:disc outside;margin-left:2em;margin-top:1em}.markdown-body li{line-height:2;color:#595959}.markdown-body img.loaded{margin:0 auto;display:block}.markdown-body blockquote{background:#fff9f9;margin:2em 0;padding:2px 20px;border-left:4px solid #b2aec5}.markdown-body blockquote p{color:#666;line-height:2}.markdown-body a{color:#036aca;border-bottom:1px solid rgba(3,106,202,.8);font-weight:400;text-decoration:none}.markdown-body em strong,.markdown-body strong{color:#036aca}.markdown-body hr{border-top:1px solid #135ce0}.markdown-body pre{overflow:auto}.markdown-body code,.markdown-body pre{overflow:auto;position:relative;line-height:1.75;font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body table{border-collapse:collapse;margin:1rem 0;overflow-x:auto}.markdown-body table td,.markdown-body table th{border:1px solid #dfe2e5;padding:.6em 1em}.markdown-body table tr{border-top:1px solid #dfe2e5}.markdown-body table tr:nth-child(2n){background-color:#f6f8fa}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>å¾ˆå¤šåˆšå…¥è¡Œç”šè‡³æƒ³å…¥è¡Œæ•°æ®åˆ†æçš„æœ‹å‹ï¼Œå¾€å¾€ä¼šé™·å…¥ä¸€ä¸ª<strong>è¯¯åŒº</strong>ï¼šä»¥ä¸ºæ•°æ®åˆ†æå°±æ˜¯ä¸åœåœ°<strong>åšæŠ¥è¡¨</strong>ã€<strong>ç”»é¥¼å›¾</strong>ã€‚</p>
<p>å…¶å®ï¼Œæ•°æ®åˆ†æçš„æ ¸å¿ƒé­…åŠ›åœ¨äº <strong>â€œæ¨æ–­â€â€”â€”å³è§å¾®çŸ¥è‘—</strong>ã€‚</p>
<p>åœ¨ç°å®ç”Ÿæ´»ä¸­ï¼Œæˆ‘ä»¬å¾ˆéš¾è·å–â€œå…¨é‡æ•°æ®â€ï¼ˆæ¯”å¦‚ä½ ä¸å¯èƒ½è°ƒæŸ¥å…¨å›½æ¯ä¸€ä¸ªäººçš„èº«é«˜ï¼‰ï¼Œé‚£ä¹ˆï¼Œå¦‚ä½•é€šè¿‡æ‰‹ä¸­çš„â€œå°æ ·æœ¬â€å»æ¨æµ‹â€œå¤§æ€»ä½“â€çš„è§„å¾‹ï¼Ÿ</p>
<p>è¿™å°±éœ€è¦ç”¨åˆ°ç»Ÿè®¡å­¦ä¸­çš„<strong>æ¨æ–­åˆ†æ</strong>ã€‚</p>
<p>æœ¬æ–‡å°†ç»“åˆä»£ç æ¥ä»‹ç»<strong>æ¨æ–­åˆ†æ</strong>ä¸­æœ€å¸¸ç”¨çš„ä¸‰å¤§æ–¹æ³•ï¼š<strong>å‚æ•°ä¼°è®¡</strong>ã€<strong>å‡è®¾æ£€éªŒ</strong>ã€<strong>éå‚æ•°æ£€éªŒ</strong>ã€‚</p>
<h2 data-id="heading-0">1. å‚æ•°ä¼°è®¡</h2>
<p>æƒ³è±¡ä½ åœ¨ç…®ä¸€é”…æ’éª¨æ±¤ã€‚ä½ æƒ³çŸ¥é“æ±¤å’¸ä¸å’¸ï¼Œä½ ä¸ä¼šæŠŠæ•´é”…æ±¤éƒ½å–å®Œï¼Œè€Œæ˜¯èˆ€èµ·ä¸€å‹ºå°ä¸€å°ã€‚</p>
<ul>
<li>é‚£ä¸€å‹ºæ±¤å°±æ˜¯<strong>æ ·æœ¬</strong>ã€‚</li>
<li>é‚£ä¸€å‹ºçš„å’¸åº¦å°±æ˜¯<strong>æ ·æœ¬ç»Ÿè®¡é‡</strong>ã€‚</li>
<li>æ•´é”…æ±¤çš„å’¸åº¦å°±æ˜¯æˆ‘ä»¬è¦çŒœçš„<strong>æ€»ä½“å‚æ•°</strong>ã€‚</li>
</ul>
<p><strong>å‚æ•°ä¼°è®¡</strong>å°±æ˜¯ï¼šæ ¹æ®æ ·æœ¬çš„ç‰¹å¾ï¼ˆæ¯”å¦‚<strong>æ ·æœ¬å‡å€¼</strong>ï¼‰ï¼Œå»ä¼°è®¡æ€»ä½“çš„ç‰¹å¾ï¼ˆæ¯”å¦‚<strong>æ€»ä½“å‡å€¼</strong>ï¼‰ã€‚</p>
<p>å®ƒé€šå¸¸åˆ†ä¸ºä¸¤ç§ï¼š</p>
<ul>
<li><strong>ç‚¹ä¼°è®¡</strong>ï¼šç›´æ¥è¯´â€œè¿™é”…æ±¤æ˜¯1.5%çš„ç›åº¦â€ã€‚ï¼ˆä½†è¿™å¾ˆå®¹æ˜“è¢«æ‰“è„¸ï¼Œå› ä¸ºå¤ªç»å¯¹ï¼‰</li>
<li><strong>åŒºé—´ä¼°è®¡</strong>ï¼šè¯´â€œè¿™é”…æ±¤çš„ç›åº¦åœ¨1.4%åˆ°1.6%ä¹‹é—´ï¼Œæˆ‘æœ‰95%çš„æŠŠæ¡â€ã€‚ï¼ˆè¿™å°±æ˜¯ç½®ä¿¡åŒºé—´ï¼Œæ›´ç§‘å­¦ï¼‰</li>
</ul>
<p><strong>åŒºé—´ä¼°è®¡</strong>æ˜¯æœ€å¸¸ä½¿ç”¨çš„æ–¹å¼ï¼Œä¸‹é¢é€šè¿‡ä¸€ä¸ªç¤ºä¾‹æ¥æ¼”ç¤º<strong>å‚æ•°ä¼°è®¡</strong>çš„å…·ä½“ä½¿ç”¨ã€‚</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np
<span class="hljs-keyword">from</span> scipy <span class="hljs-keyword">import</span> stats

<span class="hljs-comment"># 1. æ¨¡æ‹Ÿæ•°æ®</span>
np.random.seed(<span class="hljs-number">42</span>)
true_mean = <span class="hljs-number">15</span>  <span class="hljs-comment"># ä¸Šå¸è§†è§’çš„çœŸå®å‡å€¼</span>
sample_salaries = np.random.normal(loc=true_mean, scale=<span class="hljs-number">3</span>, size=<span class="hljs-number">100</span>)  <span class="hljs-comment"># æ¨¡æ‹Ÿ100ä¸ªæ ·æœ¬</span>

<span class="hljs-comment"># 2. è®¡ç®—ç»Ÿè®¡é‡</span>
sample_mean = np.mean(sample_salaries)
sample_std = np.std(sample_salaries, ddof=<span class="hljs-number">1</span>)
n = <span class="hljs-built_in">len</span>(sample_salaries)

<span class="hljs-comment"># è®¡ç®—95%ç½®ä¿¡åŒºé—´</span>
<span class="hljs-comment"># è¿™é‡Œçš„ scale ä½¿ç”¨çš„æ˜¯æ ‡å‡†è¯¯ (Standard Error) = æ ·æœ¬æ ‡å‡†å·® / sqrt(n)</span>
conf_int = stats.t.interval(
    confidence=<span class="hljs-number">0.95</span>, df=n - <span class="hljs-number">1</span>, loc=sample_mean, scale=sample_std / np.sqrt(n)
)
lower_bound, upper_bound = conf_int

<span class="hljs-built_in">print</span>(<span class="hljs-string">f"æ ·æœ¬å‡å€¼: <span class="hljs-subst">{sample_mean:<span class="hljs-number">.2</span>f}</span>k"</span>)
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"95%ç½®ä¿¡åŒºé—´: [<span class="hljs-subst">{lower_bound:<span class="hljs-number">.2</span>f}</span>k, <span class="hljs-subst">{upper_bound:<span class="hljs-number">.2</span>f}</span>k]"</span>)

<span class="hljs-comment"># è¿è¡Œç»“æœï¼š</span>
<span class="hljs-string">'''
æ ·æœ¬å‡å€¼: 14.69k
95%ç½®ä¿¡åŒºé—´: [14.15k, 15.23k]
'''</span>
</code></pre>
<p>å›¾å½¢åŒ–ä¹‹åçš„ç»“æœå¦‚ä¸‹ï¼š</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2485481dfd374b6f958cd86bf1d60464~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgZGF0YWJvb2s=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765801601&amp;x-signature=jHE5ZnE12Qk9cAi9MC1r1J64vjU%3D" alt="" loading="lazy"/></p>
<p>ä»å›¾ä¸­å¯ä»¥çœ‹å‡ºï¼š</p>
<ol>
<li><strong>ç°è‰²çš„æ•£ç‚¹</strong>ï¼šæ˜¯ä½ è°ƒç ”çš„é‚£100ä¸ªæ•°æ®åˆ†æå¸ˆçš„å·¥èµ„ã€‚ä½ ä¼šå‘ç°æœ‰çš„é«˜æœ‰çš„ä½ï¼Œæ•£è½åœ¨å„åœ°ã€‚</li>
<li><strong>è“è‰²çš„ç‚¹å’Œæ¨ªçº¿</strong>ï¼š</li>
</ol>
<ul>
<li><strong>è“ç‚¹</strong>æ˜¯ä½ ç®—å‡ºæ¥çš„æ ·æœ¬å‡å€¼ï¼ˆçº¦14.67kï¼‰ï¼Œè™½ç„¶ä¸å®Œå…¨ç­‰äºçœŸå®çš„15kï¼Œä½†å¾ˆæ¥è¿‘ã€‚</li>
<li><strong>è“è‰²çš„æ¨ªçº¿</strong>å°±æ˜¯ç½®ä¿¡åŒºé—´ã€‚å®ƒçš„å«ä¹‰æ˜¯ï¼šâ€œè™½ç„¶æˆ‘ä¸çŸ¥é“ç¡®åˆ‡æ•°å­—ï¼Œä½†æˆ‘æ•¢æ‰“èµŒï¼ŒçœŸå®æ•°å­—å°±åœ¨è¿™æ ¹è“çº¿çš„èŒƒå›´å†…ã€‚â€</li>
</ul>
<ol start="3">
<li><strong>çº¢è‰²çš„è™šçº¿</strong>ï¼šè¿™æ˜¯çœŸå®çš„æ€»ä½“å‡å€¼ï¼ˆ15kï¼‰ã€‚</li>
<li><strong>ç»“è®º</strong>ï¼šä½ å¯ä»¥æ¸…æ¥šåœ°çœ‹åˆ°ï¼Œçº¢è‰²çš„è™šçº¿ç¡®å®ç©¿è¿‡äº†è“è‰²çš„æ¨ªçº¿ã€‚æ­å–œä½ ï¼è¿™æ¬¡â€œå‚æ•°ä¼°è®¡â€æˆåŠŸæ•è·äº†çœŸç†ï¼</li>
</ol>
<p>æ•°æ®åˆ†æä¸æ˜¯ç®—å‘½ï¼Œç®—å‡ºæ¥çš„ä¸æ˜¯ä¸€ä¸ªæ­»çš„æ•°å­—ï¼Œè€Œæ˜¯ä¸€ä¸ªç§‘å­¦çš„èŒƒå›´ã€‚</p>
<p>æˆ‘ä»¬å°±æ˜¯ç”¨<strong>å‚æ•°ä¼°è®¡</strong>çš„æ–¹æ³•ï¼Œåœ¨ä¸ç¡®å®šæ€§ä¸­å¯»æ‰¾ç¡®å®šæ€§ã€‚</p>
<h2 data-id="heading-1">2. å‡è®¾æ£€éªŒ</h2>
<p><strong>å‡è®¾æ£€éªŒ</strong>æ˜¯æ•°æ®åˆ†æä¸­æœ€å¸¸ç”¨çš„å†³ç­–å·¥å…·ã€‚å®ƒçš„é€»è¾‘æ˜¯ï¼š<strong>å…ˆç«‹ä¸€ä¸ªFlagï¼ˆå‡è®¾ï¼‰ï¼Œç„¶åçœ‹è¯æ®ï¼ˆæ•°æ®ï¼‰æ˜¯å¦æ‰“è„¸</strong>ã€‚</p>
<ul>
<li><strong>åŸå‡è®¾</strong> ï¼šé€šå¸¸ä»£è¡¨â€œæ— äº‹å‘ç”Ÿâ€ã€â€œæ²¡æœ‰å˜åŒ–â€ã€â€œè¿æ°”å¥½â€ã€‚</li>
<li><strong>å¤‡æ‹©å‡è®¾</strong>ï¼šé€šå¸¸ä»£è¡¨â€œæœ‰äº‹å‘ç”Ÿâ€ã€â€œçœŸçš„æœ‰æ•ˆæœâ€ã€‚</li>
<li><strong>På€¼</strong>ï¼šè¡¨ç¤ºåŸå‡è®¾æˆç«‹æ—¶ï¼Œå‡ºç°å½“å‰æ•°æ®çš„æ¦‚ç‡ã€‚På€¼è¶Šå°ï¼Œè¯´æ˜åŸå‡è®¾è¶Šä¸é è°±ï¼ˆé€šå¸¸ä»¥0.05ä¸ºç•Œé™ï¼‰ã€‚</li>
</ul>
<p>ä¸‹é¢é€šè¿‡ä¸€ä¸ªç”µå•†APPçš„A/Bæµ‹è¯•åœºæ™¯ï¼Œæ¥æ¼”ç¤º<strong>å‡è®¾æ£€éªŒ</strong>çš„ä½¿ç”¨ã€‚</p>
<p>å‡è®¾æŸç”µå•†APPæƒ³æŠŠ <strong>â€œè´­ä¹°â€</strong> æŒ‰é’®ä» <strong>è“è‰²</strong> æ”¹æˆ <strong>çº¢è‰²</strong> ã€‚</p>
<ul>
<li><strong>åŸå‡è®¾</strong>ï¼šçº¢è‰²æŒ‰é’®å’Œè“è‰²æŒ‰é’®çš„è½¬åŒ–ç‡æ²¡åŒºåˆ«ï¼ˆå·®åˆ«çº¯å±å¶ç„¶ï¼‰ã€‚</li>
<li><strong>å¤‡æ‹©å‡è®¾</strong>ï¼šçº¢è‰²æŒ‰é’®çš„è½¬åŒ–ç‡æ˜¾è‘—é«˜äºè“è‰²æŒ‰é’®ã€‚</li>
</ul>
<p>æˆ‘ä»¬é‡‡é›†äº†ä¸¤ç»„ç”¨æˆ·çš„æ¶ˆè´¹é‡‘é¢æ•°æ®æ¥è¿›è¡ŒTæ£€éªŒã€‚</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 1. æ¨¡æ‹ŸABæµ‹è¯•æ•°æ®</span>
<span class="hljs-comment"># è“è‰²æŒ‰é’®ç»„ï¼ˆå¯¹ç…§ç»„ï¼‰ï¼šå¹³å‡æ¶ˆè´¹ 100å…ƒ</span>
group_blue = np.random.normal(loc=<span class="hljs-number">100</span>, scale=<span class="hljs-number">20</span>, size=<span class="hljs-number">1000</span>)
<span class="hljs-comment"># çº¢è‰²æŒ‰é’®ç»„ï¼ˆå®éªŒç»„ï¼‰ï¼šå¹³å‡æ¶ˆè´¹ 105å…ƒ (æˆ‘ä»¬è¦æ£€éªŒè¿™ä¸ªæå‡æ˜¯å¦æ˜¾è‘—)</span>
group_red = np.random.normal(loc=<span class="hljs-number">105</span>, scale=<span class="hljs-number">25</span>, size=<span class="hljs-number">1000</span>)

<span class="hljs-comment"># 2. è¿›è¡Œç‹¬ç«‹æ ·æœ¬Tæ£€éªŒ (T-test)</span>
t_stat, p_val = stats.ttest_ind(group_blue, group_red)

<span class="hljs-built_in">print</span>(<span class="hljs-string">f"På€¼: <span class="hljs-subst">{p_val:<span class="hljs-number">.5</span>f}</span>"</span>)

<span class="hljs-comment"># 3. åˆ¤æ–­ç»“è®º</span>
alpha = <span class="hljs-number">0.05</span>
<span class="hljs-keyword">if</span> p_val &lt; alpha:
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"ç»“è®ºï¼šæ‹’ç»åŸå‡è®¾ã€‚çº¢è‰²æŒ‰é’®å¸¦æ¥çš„æ¶ˆè´¹æå‡æ˜¯ã€ç»Ÿè®¡æ˜¾è‘—ã€‘çš„ï¼Œå»ºè®®å…¨é‡ä¸Šçº¿ï¼"</span>)
<span class="hljs-keyword">else</span>:
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"ç»“è®ºï¼šæ— æ³•æ‹’ç»åŸå‡è®¾ã€‚ä¸¤ç»„å·®å¼‚å¯èƒ½æ˜¯è¯¯å·®å¯¼è‡´çš„ï¼Œå»ºè®®ç»´æŒåŸçŠ¶ã€‚"</span>)

<span class="hljs-comment"># è¿è¡Œç»“æœï¼š</span>
<span class="hljs-string">'''
På€¼: 0.00000
ç»“è®ºï¼šæ‹’ç»åŸå‡è®¾ã€‚çº¢è‰²æŒ‰é’®å¸¦æ¥çš„æ¶ˆè´¹æå‡æ˜¯ã€ç»Ÿè®¡æ˜¾è‘—ã€‘çš„ï¼Œå»ºè®®å…¨é‡ä¸Šçº¿ï¼
'''</span>
</code></pre>
<p>å›¾å½¢åŒ–ç»“æœå¦‚ä¸‹ï¼š</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/007a998a5b334cc1983d927a81d5cb52~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgZGF0YWJvb2s=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765801601&amp;x-signature=m5GveoNuTzkuYjkksK1WM8NmpFY%3D" alt="" loading="lazy"/></p>
<p>ä»å›¾ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹å‡ºï¼Œä¸¤æ¡æ›²çº¿ï¼ˆçº¢è‰²å’Œè“è‰²ï¼‰å…¶å®é‡å åº¦å¾ˆé«˜ã€‚</p>
<p>å¯¹äºæ–°æ‰‹ï¼Œçœ‹åˆ°è¿™ä¸ªå›¾ï¼Œå¯èƒ½ä¼šé™·å…¥ä¸€ä¸ªè¯¯åŒºï¼Œè§‰å¾—â€œè¿™ä¸¤åº§å±±å³°çœ‹èµ·æ¥å·®ä¸å¤šå˜›ï¼Œæ²¡å•¥åŒºåˆ«â€ã€‚</p>
<p>ä½†åœ¨ç»Ÿè®¡å­¦ä¸Šï¼Œä¸¤åº§å±±å³°çš„ <strong>â€œé‡å¿ƒâ€</strong> ï¼ˆå‡å€¼ï¼‰å‘ç”Ÿäº† <strong>æ˜¾è‘—åç§»</strong> ã€‚è¿™å°±æ˜¯å‡è®¾æ£€éªŒçš„å¨åŠ›--åœ¨é‡å çš„å™ªå£°ä¸­è¯†åˆ«å‡ºåç§»çš„ä¿¡å·ã€‚</p>
<h2 data-id="heading-2">3. éå‚æ•°ä¼°è®¡</h2>
<p>å‰é¢çš„ <strong>â€œå‚æ•°ä¼°è®¡â€</strong> å’Œ <strong>â€œTæ£€éªŒâ€</strong> éƒ½æœ‰ä¸€ä¸ªå¨‡æ°”çš„è„¾æ°”ï¼šå®ƒä»¬é€šå¸¸å‡è®¾æ•°æ®æ˜¯æœä» <strong>â€œæ­£æ€åˆ†å¸ƒâ€</strong> çš„ï¼ˆä¹Ÿå°±æ˜¯æ¼‚äº®çš„é’Ÿå½¢æ›²çº¿ï¼‰ã€‚</p>
<p>ä½†åœ¨ç°å®ç”Ÿæ´»ä¸­ï¼Œå¾ˆå¤šæ•°æ®å¹¶ä¸æ­£æ€ï¼Œæˆ–è€…æ•°æ®ç”šè‡³æ˜¯å®šåºçš„ï¼ˆæ¯”å¦‚ï¼šéå¸¸æ»¡æ„ã€æ»¡æ„ã€ä¸€èˆ¬ã€ä¸æ»¡æ„ï¼‰ã€‚</p>
<p>è¿™æ—¶å€™ï¼Œä¼ ç»Ÿçš„ <strong>Tæ£€éªŒ</strong> å°±å¤±æ•ˆäº†ï¼Œæˆ‘ä»¬éœ€è¦è¯·å‡º <strong>éå‚æ•°æ£€éªŒ</strong> ã€‚</p>
<p>å®ƒä¸ä¾èµ–æ•°æ®çš„åˆ†å¸ƒå½¢çŠ¶ï¼Œéå¸¸æŠ—é€ ã€‚</p>
<p>å‡è®¾æˆ‘ä»¬è¦å¯¹æ¯”ä¸¤æ¬¾æ‰‹æ¸¸ã€Šç‹è€…è£è€€ã€‹å’Œã€ŠåŸç¥ã€‹ç©å®¶æ¯å¤©çš„æ¸¸ç©æ—¶é•¿ã€‚</p>
<p>ç”±äºã€ŠåŸç¥ã€‹ç©å®¶å¯èƒ½å­˜åœ¨å¤§é‡çš„â€œé•¿å°¾â€ç”¨æˆ·ï¼ˆç©ç‰¹åˆ«ä¹…ï¼‰ï¼Œæ•°æ®å¾€å¾€æ˜¯ä¸¥é‡å³åçš„ï¼Œä¸ç¬¦åˆæ­£æ€åˆ†å¸ƒã€‚</p>
<p>è¿™æ—¶å€™å¯¹æ¯”ä¸¤ç»„æ•°æ®å·®å¼‚ï¼Œå°±ä¸èƒ½ç”¨<strong>Tæ£€éªŒ</strong>ï¼Œæˆ‘ä»¬ä½¿ç”¨<strong>éå‚æ•°ä¼°è®¡</strong>ä¸­çš„ä¸€ç§æ–¹å¼ï¼šæ›¼-æƒ ç‰¹å°¼Uæ£€éªŒ (Mann-Whitney U test)ã€‚</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 1. æ¨¡æ‹Ÿéæ­£æ€åˆ†å¸ƒæ•°æ® (ä½¿ç”¨æŒ‡æ•°åˆ†å¸ƒæ¨¡æ‹Ÿç”±åæ•°æ®)</span>
<span class="hljs-comment"># æ¸¸æˆAï¼šå¹³å‡æ—¶é•¿è¾ƒçŸ­</span>
game_a_hours = np.random.exponential(scale=<span class="hljs-number">1.0</span>, size=<span class="hljs-number">100</span>)
<span class="hljs-comment"># æ¸¸æˆBï¼šå¹³å‡æ—¶é•¿è¾ƒé•¿</span>
game_b_hours = np.random.exponential(scale=<span class="hljs-number">1.5</span>, size=<span class="hljs-number">100</span>)

<span class="hljs-comment"># 2. é¦–å…ˆï¼Œæ£€æŸ¥ä¸€ä¸‹æ­£æ€æ€§ (Shapiro-Wilkæ£€éªŒ)</span>
<span class="hljs-comment"># å¦‚æœP &lt; 0.05ï¼Œè¯´æ˜ä¸æ˜¯æ­£æ€åˆ†å¸ƒ</span>
_, p_norm_a = stats.shapiro(game_a_hours)
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"æ¸¸æˆAæ­£æ€æ€§æ£€éªŒPå€¼: <span class="hljs-subst">{p_norm_a:<span class="hljs-number">.4</span>f}</span> (å°äº0.05åˆ™éæ­£æ€)"</span>)

<span class="hljs-comment"># 3. ä½¿ç”¨éå‚æ•°æ£€éªŒï¼šMann-Whitney Uæ£€éªŒ</span>
<span class="hljs-comment"># å®ƒå¯ä»¥æ¯”è¾ƒä¸¤ä¸ªç‹¬ç«‹æ ·æœ¬çš„åˆ†å¸ƒæ˜¯å¦å­˜åœ¨å·®å¼‚ï¼ˆä¾§é‡äºä¸­ä½æ•°/ç§©æ¬¡çš„æ¯”è¾ƒï¼‰</span>
u_stat, p_val_nonparam = stats.mannwhitneyu(game_a_hours, game_b_hours, alternative=<span class="hljs-string">'two-sided'</span>)

<span class="hljs-built_in">print</span>(<span class="hljs-string">f"Mann-Whitney Uæ£€éªŒ På€¼: <span class="hljs-subst">{p_val_nonparam:<span class="hljs-number">.5</span>f}</span>"</span>)

<span class="hljs-keyword">if</span> p_val_nonparam &lt; <span class="hljs-number">0.05</span>:
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"ç»“è®ºï¼šä¸¤æ¬¾æ¸¸æˆçš„ç©å®¶æ¸¸ç©æ—¶é•¿åˆ†å¸ƒå­˜åœ¨æ˜¾è‘—å·®å¼‚ã€‚"</span>)
<span class="hljs-keyword">else</span>:
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"ç»“è®ºï¼šä¸¤æ¬¾æ¸¸æˆç©å®¶æ¸¸ç©æ—¶é•¿æ— æ˜¾è‘—å·®å¼‚ã€‚"</span>)

<span class="hljs-comment"># è¿è¡Œç»“æœï¼š</span>
<span class="hljs-string">'''
æ¸¸æˆAæ­£æ€æ€§æ£€éªŒPå€¼: 0.0000 (å°äº0.05åˆ™éæ­£æ€)
Mann-Whitney Uæ£€éªŒ På€¼: 0.00003
ç»“è®ºï¼šä¸¤æ¬¾æ¸¸æˆçš„ç©å®¶æ¸¸ç©æ—¶é•¿åˆ†å¸ƒå­˜åœ¨æ˜¾è‘—å·®å¼‚ã€‚
'''</span>
</code></pre>
<p>å¯è§†åŒ–ç»“æœå¦‚ä¸‹ï¼š</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/93946f2319514f0799b428ff9ce98157~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgZGF0YWJvb2s=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765801601&amp;x-signature=YIoZEwYKr5SHRNZpgn1OoZhSI24%3D" alt="" loading="lazy"/></p>
<p>å°½ç®¡æ•°æ®é•¿å¾—æ­ªç“œè£‚æ£ï¼ˆä¸¥é‡å³åï¼‰ï¼Œ<strong>Uæ£€éªŒ</strong>ä¾ç„¶ç¨³å¥åœ°å‘Šè¯‰æˆ‘ä»¬ï¼š<strong>è¿™ä¸¤ç»„æ•°æ®ä¸ä¸€æ ·</strong>ã€‚</p>
<p><strong>Uæ£€éªŒ</strong>æ¯”è¾ƒçš„ä¸ä»…ä»…æ˜¯å¹³å‡å€¼ï¼Œå®ƒæ›´å¤šæ˜¯åœ¨æ¯”è¾ƒ <strong>â€œç§©æ¬¡â€</strong>ï¼ˆ<code>Ranking</code>ï¼‰ã€‚</p>
<p>é€šä¿—ç‚¹è¯´ï¼Œå®ƒå‘ç°å¦‚æœæˆ‘ä»¬æŠŠä¸¤ç»„ç©å®¶æ··åœ¨ä¸€èµ·æ’åï¼Œ<code>Game B</code>çš„ç©å®¶å³ä½¿ä¸çœ‹å…·ä½“æ—¶é•¿ï¼Œæ’åä¹Ÿæ™®éæ¯”<code>Game A</code>çš„ç©å®¶é å‰ã€‚</p>
<p>ä»å›¾ä¸­æ¥çœ‹ï¼Œä½ ä¼šçœ‹åˆ°æ©™è‰²ï¼ˆ<code>Game B</code>ï¼‰çš„å°¾å·´æ˜æ˜¾æ¯”è“è‰²ï¼ˆ<code>Game A</code>ï¼‰æ‹–å¾—æ›´é•¿ã€æ›´åšå®ã€‚</p>
<p>è¿™è¯´æ˜<code>Game B</code>ï¼ˆæ¯”å¦‚ã€ŠåŸç¥ã€‹ï¼‰æ›´å®¹æ˜“è®©ç©å®¶æ²‰æµ¸æ›´ä¹…ï¼Œæˆ–è€…æ‹¥æœ‰æ›´å¤šçš„é‡åº¦ç©å®¶ã€‚</p>
<h2 data-id="heading-3">4. æ€»ç»“</h2>
<p>æ­å–œä½ ï¼ä½ å·²ç»æŒæ¡äº†æ•°æ®<strong>æ¨æ–­åˆ†æ</strong>çš„æ ¸å¿ƒé€»è¾‘ï¼š</p>
<ol>
<li><strong>å‚æ•°ä¼°è®¡</strong>ï¼šå½“ä½ åªæœ‰æ ·æœ¬ï¼Œæƒ³çŸ¥é“æ€»ä½“çš„æ•°å€¼èŒƒå›´æ—¶ä½¿ç”¨ã€‚ï¼ˆæ¯”å¦‚ä¼°ç®—å¹³å‡è–ªèµ„ï¼‰</li>
<li><strong>å‡è®¾æ£€éªŒ</strong>ï¼šå½“ä½ æ•°æ®æ¯”è¾ƒâ€œå®Œç¾â€ï¼ˆæ­£æ€åˆ†å¸ƒï¼‰ï¼Œæƒ³åˆ¤æ–­å·®å¼‚æ˜¯ä¸æ˜¯çœŸçš„æ—¶ä½¿ç”¨ã€‚ï¼ˆæ¯”å¦‚A/Bæµ‹è¯•ï¼‰</li>
<li><strong>éå‚æ•°æ£€éªŒ</strong>ï¼šå½“ä½ æ•°æ®åˆ†å¸ƒå¥‡æ€ªã€æˆ–è€…åªæœ‰æ’å/ç­‰çº§æ•°æ®æ—¶ä½¿ç”¨ã€‚ï¼ˆæ¯”å¦‚è¯„åˆ†å¯¹æ¯”ã€é•¿å°¾æ•°æ®åˆ†æï¼‰</li>
</ol>
<p>è¿™<strong>ä¸‰æ¿æ–§</strong>æ˜¯æ•°æ®åˆ†æå¸ˆè¡Œèµ°æ±Ÿæ¹–çš„å¿…å¤‡æŠ€èƒ½ã€‚æŒæ¡äº†å®ƒä»¬ï¼Œä½ å°±ä¸ä»…ä»…æ˜¯ä¸€ä¸ªâ€œåšè¡¨çš„â€ï¼Œè€Œæ˜¯ä¸€ä¸ªèƒ½ä»æ•°æ®ä¸­æŒ–æ˜çœŸç›¸çš„â€œä¾¦æ¢â€ï¼</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ã€Agentã€‘MemOS æºç ç¬”è®°---(3)---æœç´¢]]></title>    <link>https://juejin.cn/post/7581312433529733163</link>    <guid>https://juejin.cn/post/7581312433529733163</guid>    <pubDate>2025-12-08T12:31:41.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581312433529733163" data-draft-id="7577647745110425600" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ã€Agentã€‘MemOS æºç ç¬”è®°---(3)---æœç´¢"/> <meta itemprop="keywords" content="ç®—æ³•,æœºå™¨å­¦ä¹ "/> <meta itemprop="datePublished" content="2025-12-08T12:31:41.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ç½—è¥¿çš„æ€è€ƒ"/> <meta itemprop="url" content="https://juejin.cn/user/351470467691175"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ã€Agentã€‘MemOS æºç ç¬”è®°---(3)---æœç´¢
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/351470467691175/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ç½—è¥¿çš„æ€è€ƒ
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-08T12:31:41.000Z" title="Mon Dec 08 2025 12:31:41 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»19åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">ã€Agentã€‘MemOS æºç ç¬”è®°---(3)---æœç´¢</h2>
<h3 data-id="heading-1">0x00 æ‘˜è¦</h3>
<p>TreeTextMemory æä¾›äº†ä¸€ä¸ªå®Œæ•´çš„è®°å¿†ç®¡ç†ç³»ç»Ÿï¼Œèƒ½å­˜å‚¨ã€ç»„ç»‡ã€æ£€ç´¢å’Œç»´æŠ¤å„ç§ç±»å‹çš„æ–‡æœ¬è®°å¿†ã€é€‚ç”¨éœ€è¦å¤æ‚è®°å¿†ç®¡ç†çš„AIç³»ç»Ÿã€‚è¿™æ˜¯ä¸€ä¸ªåŸºäºå›¾çš„ã€æ ‘å½¢æ˜æ–‡è®°å¿†ï¼Œæ”¯æŒä»¥ç»“æ„åŒ–æ–¹å¼ç»„ç»‡ã€å…³è”å¹¶æ£€ç´¢è®°å¿†ï¼ŒåŒæ—¶ä¿ç•™ä¸°å¯Œçš„ä¸Šä¸‹æ–‡ä¿¡æ¯ä¸è‰¯å¥½çš„å¯è§£é‡Šæ€§ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡è¿™ä¸ªTreeTextMemory å¯¹è±¡ä¸åºå¤§çš„çŸ¥è¯†åº“è¿›è¡Œäº¤äº’ï¼Œä¸ºAIèµ‹äºˆä¸“ä¸šçš„é¢†åŸŸè®°å¿†ã€‚å½“å‰ä½¿ç”¨Neo4jä½œä¸ºåç«¯ï¼Œæœªæ¥è®¡åˆ’æ”¯æŒæ›´å¤šå›¾æ•°æ®åº“ã€‚</p>
<p>å› ä¸ºå­—æ•°å¤ªå¤šï¼Œå› æ­¤æŠŠTreeTextMemoryæ‹†åˆ†ä¸ºä¸¤éƒ¨åˆ†ï¼Œä¸Šä¸€ç¯‡ä»‹ç»åŸºæœ¬æ¦‚å¿µå’Œå¦‚ä½•ç®¡ç†ï¼Œæœ¬ç¯‡ä»‹ç»å¦‚ä½•æœç´¢ã€‚</p>
<h3 data-id="heading-2">0x01 åˆ†ç±»</h3>
<p>TreeTextMemory ä¸»è¦æ”¯æŒå‡ ç§æœç´¢ï¼ˆæ³¨ï¼Œæœ‰äº›æ˜¯ä»å…¶ä»–é€”å¾„é€å‡ºï¼‰ï¼š</p>
<ul>
<li>
<p>æ··åˆæœç´¢ï¼ˆHybrid Searchï¼‰ï¼Œé€šè¿‡ Searcher.search æ–¹æ³•å¯¹å¤–æä¾›æœåŠ¡ï¼Œæ•´åˆå¤šç§æ£€ç´¢ç­–ç•¥çš„ç»“æœï¼Œå…·ä½“ç­–ç•¥å¦‚ä¸‹ï¼š</p>
<ul>
<li>ç»“åˆå‘é‡ç›¸ä¼¼åº¦æœç´¢å’Œå›¾éå†ï¼šåœ¨ GraphMemoryRetrieverä¸­åˆ©ç”¨å›¾ç»“æ„å’Œå‘é‡ä¿¡æ¯</li>
<li>å…¨æ–‡æ£€ç´¢ï¼šè™½ç„¶æ²¡æœ‰æ˜¾å¼çš„å…¨æ–‡æœç´¢APIï¼Œä½†å¯ä»¥é€šè¿‡äº’è”ç½‘æ£€ç´¢å™¨ä»æœç´¢å¼•æ“è·å–ç›¸å…³å†…å®¹ InternetRetriever ç»„ä»¶å…è®¸é›†æˆå¤–éƒ¨æœç´¢æœåŠ¡ï¼ˆå¦‚Googleã€Bingã€Bochaï¼‰</li>
</ul>
</li>
<li>
<p>å­å›¾æ£€ç´¢ï¼ˆSubgraph Retrievalï¼‰ï¼Œé€šè¿‡ get_relevant_subgraph æ–¹æ³•å¯ä»¥ç›´æ¥è¿›è¡Œå­å›¾æœç´¢</p>
<ul>
<li>ä½¿ç”¨ graph_store.search_by_embedding æ–¹æ³•è·å–æŒ‡å®šèŠ‚ç‚¹å‘¨å›´çš„å±€éƒ¨å­å›¾ç»“æ„</li>
<li>æ”¯æŒè®¾ç½®éå†æ·±åº¦å’Œä¸­å¿ƒèŠ‚ç‚¹çŠ¶æ€æ¡ä»¶</li>
<li>è¿”å›åŒ…å«æ ¸å¿ƒèŠ‚ç‚¹ã€é‚»å±…èŠ‚ç‚¹å’Œè¾¹çš„å®Œæ•´å­å›¾ä¿¡æ¯</li>
</ul>
</li>
</ul>
<p>ä»¥ä¸‹æ˜¯å›¾æ•°æ®åº“çš„APIï¼Œæ¯”å¦‚ä½äºMemOS-main\src\memos\graph_dbs\nebular.pyä¸­ï¼Œåœ¨ä¸€äº›ç¤ºä¾‹ä¸­ä¹Ÿç›´æ¥ä½¿ç”¨ï¼š</p>
<ul>
<li>
<p>åŸºäºå…ƒæ•°æ®çš„ç»“æ„åŒ–æŸ¥è¯¢ï¼ˆMetadata-based Structured Queryï¼‰</p>
<ul>
<li>é€šè¿‡ get_by_metadataæ–¹æ³•æ ¹æ®èŠ‚ç‚¹å…ƒæ•°æ®å­—æ®µè¿›è¡Œç²¾ç¡®åŒ¹é…æˆ–æ¡ä»¶æŸ¥è¯¢</li>
<li>æ”¯æŒå¤šç§æ“ä½œç¬¦ï¼šç­‰äºï¼ˆ=ï¼‰ã€åŒ…å«ï¼ˆcontainsï¼‰ã€åœ¨åˆ—è¡¨ä¸­ï¼ˆinï¼‰ç­‰</li>
<li>å¯ä»¥ç»„åˆå¤šä¸ªæ¡ä»¶è¿›è¡Œå¤æ‚æŸ¥è¯¢</li>
</ul>
</li>
</ul>

<ul>
<li>
<p>æ ‡ç­¾é‡å æŸ¥è¯¢ï¼ˆTag Overlap Queryï¼‰</p>
<ul>
<li>ä½¿ç”¨ get_neighbors_by_tagæ–¹æ³•æŸ¥æ‰¾å…·æœ‰ç›¸ä¼¼æ ‡ç­¾çš„ç›¸é‚»èŠ‚ç‚¹</li>
<li>é€šè¿‡è®¡ç®—æ ‡ç­¾äº¤é›†å¤§å°æ¥ç¡®å®šç›¸å…³æ€§</li>
<li>æ”¯æŒè®¾ç½®æœ€å°æ ‡ç­¾é‡å æ•°è¦æ±‚</li>
</ul>
</li>
<li>
<p>å‘é‡ç›¸ä¼¼åº¦æœç´¢ï¼ˆVector Similarity Searchï¼‰</p>
<ul>
<li>åŸºäºåµŒå…¥ï¼ˆembeddingï¼‰çš„è¯­ä¹‰ç›¸ä¼¼åº¦æœç´¢</li>
<li>ä½¿ç”¨ search_by_embedding æ–¹æ³•æ ¹æ®æŸ¥è¯¢å‘é‡æ‰¾åˆ°æœ€ç›¸ä¼¼çš„è®°å¿†èŠ‚ç‚¹</li>
<li>æ”¯æŒè®¾ç½®ç›¸ä¼¼åº¦é˜ˆå€¼å’Œè¿”å›ç»“æœæ•°é‡é™åˆ¶</li>
</ul>
</li>
</ul>
<p>å…¶ä¸­æœ€ä¸»è¦çš„æŸ¥è¯¢æ¥å£æ˜¯ searchæ–¹æ³•ï¼Œå®ƒå†…éƒ¨æ•´åˆäº†å¤šç§æ£€ç´¢ç­–ç•¥æ¥æä¾›æœ€ä¼˜çš„æœç´¢ç»“æœã€‚</p>
<h3 data-id="heading-3">0x02 ## æ··åˆæœç´¢ï¼ˆHybrid Searchï¼‰--- Searcher</h3>
<p>Searcher ç”± TreeTextMemory åˆ›å»ºå¹¶ä½œä¸ºä¸»è¦çš„æœç´¢æ¥å£ä½¿ç”¨ï¼ŒSearcher æ˜¯æ•´ä¸ªè®°å¿†æ£€ç´¢ç³»ç»Ÿçš„æ ¸å¿ƒåè°ƒè€…ï¼Œè´Ÿè´£æ•´åˆå„ç§æ£€ç´¢æºå¹¶æä¾›é«˜è´¨é‡çš„æ£€ç´¢ç»“æœã€‚Searcher ç±»çš„ä¸»è¦åŠŸèƒ½æ˜¯æ‰§è¡Œè®°å¿†æ£€ç´¢ä»»åŠ¡ã€‚ä»¥ä¸‹æ˜¯å…¶æ ¸å¿ƒèŒè´£å’Œå·¥ä½œæµç¨‹ï¼š</p>
<ul>
<li>
<p>å¤šè·¯å¾„å¹¶è¡Œæ£€ç´¢ï¼ŒåŒæ—¶ä»å¤šä¸ªæ¥æºæ£€ç´¢ç›¸å…³ä¿¡æ¯ï¼š</p>
<ul>
<li>å·¥ä½œè®°å¿†ï¼ˆWorkingMemoryï¼‰</li>
<li>é•¿æœŸè®°å¿†ï¼ˆLongTermMemoryï¼‰</li>
<li>ç”¨æˆ·è®°å¿†ï¼ˆUserMemoryï¼‰</li>
<li>äº’è”ç½‘æ£€ç´¢å™¨ï¼ˆå¯é€‰ï¼‰</li>
<li>MemCubesï¼ˆå¯é€‰ï¼‰</li>
</ul>
</li>
<li>
<p>ä»»åŠ¡è§£æä¸æŸ¥è¯¢ä¼˜åŒ–</p>
<ul>
<li>ä½¿ç”¨ TaskGoalParser è§£æç”¨æˆ·æŸ¥è¯¢æ„å›¾</li>
<li>æ ¹æ®ä¸åŒæ¨¡å¼ï¼ˆfast/fineï¼‰é‡‡ç”¨ä¸åŒçš„æ£€ç´¢ç­–ç•¥</li>
<li>åœ¨ç²¾ç»†æ¨¡å¼ä¸‹å…ˆè¿›è¡ŒåµŒå…¥æœç´¢è·å–ä¸Šä¸‹æ–‡</li>
</ul>
</li>
<li>
<p>ç»“æœé‡æ’åºä¸å»é‡</p>
<ul>
<li>ä½¿ç”¨ reranker å¯¹æ£€ç´¢ç»“æœè¿›è¡Œé‡æ–°æ’åº</li>
<li>å»é™¤é‡å¤çš„è®°å¿†é¡¹</li>
<li>ä¿ç•™æœ€ç›¸å…³çš„ç»“æœ</li>
</ul>
</li>
<li>
<p>é«˜çº§æ¨ç†å¤„ç†</p>
<ul>
<li>åˆ©ç”¨ MemoryReasoner å¯¹æ£€ç´¢åˆ°çš„è®°å¿†è¿›è¡Œæ¨ç†å’ŒçŸ¥è¯†ç»¼åˆ</li>
<li>æå–æœ€æœ‰ä»·å€¼çš„ä¿¡æ¯ç‰‡æ®µ</li>
</ul>
</li>
<li>
<p>ä½¿ç”¨å†å²è¿½è¸ª</p>
<ul>
<li>æ›´æ–°è®°å¿†é¡¹çš„ä½¿ç”¨å†å²è®°å½•</li>
<li>å¹¶å‘å¤„ç†ä½¿ç”¨ç»Ÿè®¡æ›´æ–°</li>
</ul>
</li>
</ul>
<h4 data-id="heading-4">2.1 å®šä¹‰</h4>
<pre><code class="hljs language-ini" lang="ini">class Searcher:
 Â  Â def __init__(
 Â  Â  Â  Â self,
 Â  Â  Â  Â dispatcher_llm: OpenAILLM | OllamaLLM | AzureLLM,
 Â  Â  Â  Â graph_store: Neo4jGraphDB,
 Â  Â  Â  Â embedder: OllamaEmbedder,
 Â  Â  Â  Â reranker: BaseReranker,
 Â  Â  Â  Â internet_retriever: InternetRetrieverFactory | <span class="hljs-attr">None</span> = None,
 Â  Â  Â  Â moscube: <span class="hljs-attr">bool</span> = <span class="hljs-literal">False</span>,
 Â   ):
 Â  Â  Â  Â <span class="hljs-attr">self.graph_store</span> = graph_store
 Â  Â  Â  Â <span class="hljs-attr">self.embedder</span> = embedder
â€‹
 Â  Â  Â  Â <span class="hljs-attr">self.task_goal_parser</span> = TaskGoalParser(dispatcher_llm)
 Â  Â  Â  Â <span class="hljs-attr">self.graph_retriever</span> = GraphMemoryRetriever(self.graph_store, self.embedder)
 Â  Â  Â  Â <span class="hljs-attr">self.reranker</span> = reranker
 Â  Â  Â  Â <span class="hljs-attr">self.reasoner</span> = MemoryReasoner(dispatcher_llm)
â€‹
 Â  Â  Â  Â <span class="hljs-comment"># Create internet retriever from config if provided</span>
 Â  Â  Â  Â <span class="hljs-attr">self.internet_retriever</span> = internet_retriever
 Â  Â  Â  Â <span class="hljs-attr">self.moscube</span> = moscube
â€‹
 Â  Â  Â  Â <span class="hljs-attr">self._usage_executor</span> = ContextThreadPoolExecutor(max_workers=<span class="hljs-number">4</span>, thread_name_prefix=<span class="hljs-string">"usage"</span>)
</code></pre>
<h4 data-id="heading-5">2.2 æ ¸å¿ƒå‡½æ•°</h4>
<p>å…¶æ ¸å¿ƒæ–¹æ³•å¦‚ä¸‹ï¼š</p>
<ul>
<li>search()ï¼šä¸»å…¥å£ï¼Œåè°ƒæ•´ä¸ªæ£€ç´¢è¿‡ç¨‹</li>
<li>_parse_task()ï¼šè§£æä»»åŠ¡å’ŒæŸ¥è¯¢</li>
<li>_retrieve_paths()ï¼šæ‰§è¡Œå¤šè·¯å¾„æ£€ç´¢</li>
<li>_deduplicate_results()ï¼šç»“æœå»é‡</li>
<li>_sort_and_trim()ï¼šæ’åºå’Œæˆªæ–­ç»“æœ</li>
<li>update_usage_history()ï¼šæ›´æ–°ä½¿ç”¨å†å²</li>
</ul>
<p>ä¸»å…¥å£å¦‚ä¸‹ï¼Œæˆ–è€…è¯´Searcher ç¼–æ’æœç´¢æµæ°´çº¿å¦‚ä¸‹ï¼š</p>
<ul>
<li>æŸ¥è¯¢è§£æå’Œç†è§£</li>
<li>ä»å¤šä¸ªæ¥æºå¹¶è¡Œæ£€ç´¢</li>
<li>ç»“æœé‡æ–°æ’åº</li>
<li>å»é‡å¤„ç†</li>
<li>å¯¹ç»“æœè¿›è¡Œæ¨ç†</li>
<li>ä½¿ç”¨æƒ…å†µè·Ÿè¸ª</li>
</ul>

<pre><code class="hljs language-python" lang="python"> Â  Â @timed
 Â  Â <span class="hljs-keyword">def</span> <span class="hljs-title function_">search</span>(<span class="hljs-params">
 Â  Â  Â  Â self,
 Â  Â  Â  Â query: <span class="hljs-built_in">str</span>,
 Â  Â  Â  Â top_k: <span class="hljs-built_in">int</span>,
 Â  Â  Â  Â info=<span class="hljs-literal">None</span>,
 Â  Â  Â  Â mode=<span class="hljs-string">"fast"</span>,
 Â  Â  Â  Â memory_type=<span class="hljs-string">"All"</span>,
 Â  Â  Â  Â search_filter: <span class="hljs-built_in">dict</span> | <span class="hljs-literal">None</span> = <span class="hljs-literal">None</span>,
 Â   </span>) -&gt; <span class="hljs-built_in">list</span>[TextualMemoryItem]:
 Â  Â  Â  Â <span class="hljs-string">"""
 Â  Â  Â   Search for memories based on a query.
 Â  Â  Â   User query -&gt; TaskGoalParser -&gt; GraphMemoryRetriever -&gt;
 Â  Â  Â   MemoryReranker -&gt; MemoryReasoner -&gt; Final output
 Â  Â  Â   Args:
 Â  Â  Â  Â  Â   query (str): The query to search for.
 Â  Â  Â  Â  Â   top_k (int): The number of top results to return.
 Â  Â  Â  Â  Â   info (dict): Leave a record of memory consumption.
 Â  Â  Â  Â  Â   mode (str, optional): The mode of the search.
 Â  Â  Â  Â  Â   - 'fast': Uses a faster search process, sacrificing some precision for speed.
 Â  Â  Â  Â  Â   - 'fine': Uses a more detailed search process, invoking large models for higher precision, but slower performance.
 Â  Â  Â  Â  Â   memory_type (str): Type restriction for search.
 Â  Â  Â  Â  Â   ['All', 'WorkingMemory', 'LongTermMemory', 'UserMemory']
 Â  Â  Â  Â  Â   search_filter (dict, optional): Optional metadata filters for search results.
 Â  Â  Â   Returns:
 Â  Â  Â  Â  Â   list[TextualMemoryItem]: List of matching memories.
 Â  Â  Â   """</span>
 Â  Â  Â  Â logger.info(
 Â  Â  Â  Â  Â  Â <span class="hljs-string">f"[SEARCH] Start query='<span class="hljs-subst">{query}</span>', top_k=<span class="hljs-subst">{top_k}</span>, mode=<span class="hljs-subst">{mode}</span>, memory_type=<span class="hljs-subst">{memory_type}</span>"</span>
 Â  Â  Â   )
 Â  Â  Â  Â <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> info:
 Â  Â  Â  Â  Â  Â logger.warning(
 Â  Â  Â  Â  Â  Â  Â  Â <span class="hljs-string">"Please input 'info' when use tree.search so that "</span>
 Â  Â  Â  Â  Â  Â  Â  Â <span class="hljs-string">"the database would store the consume history."</span>
 Â  Â  Â  Â  Â   )
 Â  Â  Â  Â  Â  Â info = {<span class="hljs-string">"user_id"</span>: <span class="hljs-string">""</span>, <span class="hljs-string">"session_id"</span>: <span class="hljs-string">""</span>}
 Â  Â  Â  Â <span class="hljs-keyword">else</span>:
 Â  Â  Â  Â  Â  Â logger.debug(<span class="hljs-string">f"[SEARCH] Received info dict: <span class="hljs-subst">{info}</span>"</span>)
â€‹
 Â  Â  Â  Â parsed_goal, query_embedding, context, query = self._parse_task(
 Â  Â  Â  Â  Â  Â query, info, mode, search_filter=search_filter
 Â  Â  Â   )
 Â  Â  Â  Â results = self._retrieve_paths(
 Â  Â  Â  Â  Â  Â query, parsed_goal, query_embedding, info, top_k, mode, memory_type, search_filter
 Â  Â  Â   )
 Â  Â  Â  Â deduped = self._deduplicate_results(results)
 Â  Â  Â  Â final_results = self._sort_and_trim(deduped, top_k)
 Â  Â  Â  Â self._update_usage_history(final_results, info)
â€‹
 Â  Â  Â  Â logger.info(<span class="hljs-string">f"[SEARCH] Done. Total <span class="hljs-subst">{<span class="hljs-built_in">len</span>(final_results)}</span> results."</span>)
 Â  Â  Â  Â res_results = <span class="hljs-string">""</span>
 Â  Â  Â  Â <span class="hljs-keyword">for</span> _num_i, result <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(final_results):
 Â  Â  Â  Â  Â  Â res_results += <span class="hljs-string">"\n"</span> + (
 Â  Â  Â  Â  Â  Â  Â  Â result.<span class="hljs-built_in">id</span> + <span class="hljs-string">"|"</span> + result.metadata.memory_type + <span class="hljs-string">"|"</span> + result.memory
 Â  Â  Â  Â  Â   )
 Â  Â  Â  Â logger.info(<span class="hljs-string">f"[SEARCH] Results. <span class="hljs-subst">{res_results}</span>"</span>)
 Â  Â  Â  Â <span class="hljs-keyword">return</span> final_results
</code></pre>
<h4 data-id="heading-6">2.3 ä¾èµ–å…³ç³»å’Œå…³è”å…³ç³»</h4>
<h5 data-id="heading-7">2.3.1 ä¾èµ–é¡¹ï¼ˆSearcher ä¾èµ–çš„ç»„ä»¶ï¼‰</h5>
<p>Searcher ä¾èµ–çš„ç»„ä»¶å¦‚ä¸‹ï¼š</p>
<ul>
<li>
<p>å¤§è¯­è¨€æ¨¡å‹ç»„ä»¶ï¼š</p>
<ul>
<li>dispatcher_llm â€“ ç”¨äºä»»åŠ¡è§£æå’Œæ¨ç†</li>
<li>TaskGoalParser â€“ å°†ç”¨æˆ·æŸ¥è¯¢è§£æä¸ºç»“æ„åŒ–ç›®æ ‡</li>
</ul>
</li>
<li>
<p>å­˜å‚¨ç»„ä»¶ï¼š</p>
<ul>
<li>graph_store â€“ Neo4j å›¾æ•°æ®åº“ç”¨äºå­˜å‚¨è®°å¿†</li>
<li>GraphMemoryRetriever â€“ ä»å›¾å­˜å‚¨ä¸­æ£€ç´¢è®°å¿†</li>
</ul>
</li>
<li>
<p>å¤„ç†ç»„ä»¶ï¼š</p>
<ul>
<li>embedder â€“ ä¸ºæŸ¥è¯¢å’Œè®°å¿†åˆ›å»ºåµŒå…¥å‘é‡</li>
<li>reranker â€“ å¯¹æ£€ç´¢ç»“æœè¿›è¡Œé‡æ–°æ’åº</li>
<li>MemoryReasoner â€“ å¯¹æ£€ç´¢åˆ°çš„è®°å¿†è¿›è¡Œæ¨ç†</li>
<li>internet_retriever â€“ å¯é€‰çš„äº’è”ç½‘æœç´¢åŠŸèƒ½</li>
</ul>
</li>
</ul>
<h5 data-id="heading-8">2.3.2 ä¾èµ– Searcher çš„ç»„ä»¶</h5>
<p>ä¾èµ– Searcher çš„ç»„ä»¶å¦‚ä¸‹ï¼š</p>
<ul>
<li>TreeTextMemory â€“ åœ¨å…¶ search æ–¹æ³•ä¸­ä½¿ç”¨ Searcher</li>
<li>GeneralScheduler â€“ é€šè¿‡æ£€ç´¢å™¨åœ¨ process_session_turn ä¸­ä½¿ç”¨ Searcher</li>
</ul>
<h4 data-id="heading-9">2.4 å›¾ä¾‹</h4>
<p>Searcher è¢«è°ƒåº¦å™¨ç³»ç»Ÿç”¨äºåœ¨æŸ¥è¯¢å¤„ç†è¿‡ç¨‹ä¸­æ£€ç´¢ç›¸å…³è®°å¿†ï¼Œæ€»çš„æ¥è¯´ï¼ŒSearcher å……å½“ä¸€ä¸ªä¸­å¤®åè°ƒè€…ï¼Œå°†å„ç§ç»„ä»¶æ•´åˆåœ¨ä¸€èµ·ï¼Œä¸ºè·¨ä¸åŒè®°å¿†æºå’Œå¤–éƒ¨æ•°æ®æä¾›å…¨é¢çš„æ£€ç´¢èƒ½åŠ›ã€‚</p>
<h5 data-id="heading-10">2.4.1 Searcher ç»„ä»¶å…³ç³»æµç¨‹å›¾</h5>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c4d979d43803436495c2d5112601d62b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg572X6KW_55qE5oCd6ICD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765801901&amp;x-signature=ASPi6KA1T8DHkJmZVPlKSM71oLY%3D" alt="Searcher ç»„ä»¶å…³ç³»æµç¨‹å›¾" loading="lazy"/></p>
<h5 data-id="heading-11">2.4.2 Searcher è¯¦ç»†æœç´¢è¿‡ç¨‹æµç¨‹</h5>
<p>ç”¨æˆ·æŸ¥è¯¢ â†’ TaskGoalParser è§£æ â†’ å¤šè·¯å¾„å¹¶è¡Œæ£€ç´¢ â†’ ç»“æœé‡æ’åº â†’ å»é‡å¤„ç† â†’ æ¨ç†ä¼˜åŒ– â†’ è¿”å›æœ€ç»ˆç»“æœã€‚</p>
<p>å„ç»„ä»¶è¯¦ç»†è¯´æ˜</p>
<p><strong>ä¸»è¦é˜¶æ®µ</strong></p>
<ul>
<li>ä»»åŠ¡è§£æï¼šä½¿ç”¨ TaskGoalParser è§£ææŸ¥è¯¢ï¼Œæ ¹æ®æ¨¡å¼å†³å®šæ˜¯å¦ä½¿ç”¨ LLM</li>
<li>å¹¶è¡Œæ£€ç´¢ï¼šåŒæ—¶æ‰§è¡Œå¤šä¸ªæ£€ç´¢è·¯å¾„</li>
<li>ç»“æœé‡æ’ï¼šä½¿ç”¨ Reranker å¯¹å„è·¯å¾„çš„ç»“æœè¿›è¡Œé‡æ’</li>
<li>åˆå¹¶å»é‡ï¼šåˆå¹¶æ‰€æœ‰è·¯å¾„çš„ç»“æœå¹¶å»é™¤é‡å¤é¡¹</li>
<li>æ’åºæˆªå–ï¼šæŒ‰åˆ†æ•°æ’åºå¹¶æˆªå–å‰ K ä¸ªç»“æœ</li>
<li>æ›´æ–°è®°å½•ï¼šæ›´æ–°ä½¿ç”¨å†å²è®°å½•</li>
</ul>
<p><strong>å¹¶è¡Œæ£€ç´¢è·¯å¾„</strong></p>
<ul>
<li>è·¯å¾„ Aï¼šå·¥ä½œå†…å­˜æ£€ç´¢ (WorkingMemory)</li>
<li>è·¯å¾„ Bï¼šé•¿æœŸå’Œç”¨æˆ·å†…å­˜æ£€ç´¢ (LongTermMemory, UserMemory)</li>
<li>è·¯å¾„ Cï¼šäº’è”ç½‘æ£€ç´¢ï¼ˆå¯é€‰ï¼‰</li>
<li>è·¯å¾„ Dï¼šMemCubes æ£€ç´¢ï¼ˆå¯é€‰ï¼‰</li>
</ul>
<p><strong>æ•°æ®æµå‘</strong>ï¼šè¾“å…¥æŸ¥è¯¢ç»è¿‡è§£æåï¼Œè¢«åˆ†å‘åˆ°å¤šä¸ªæ£€ç´¢è·¯å¾„å¹¶è¡Œå¤„ç†ï¼Œæ¯ä¸ªè·¯å¾„éƒ½ä¼šäº§ç”Ÿä¸€æ‰¹å€™é€‰ç»“æœã€‚è¿™äº›ç»“æœç»è¿‡é‡æ’ã€åˆå¹¶ï¼Œæœ€åç»è¿‡å»é‡ã€æ’åºå’Œæˆªå–å¾—åˆ°æœ€ç»ˆç»“æœã€‚æ•´ä¸ªè¿‡ç¨‹ä¸­è¿˜ä¼šæ›´æ–°ä½¿ç”¨å†å²è®°å½•ä»¥ä¾¿åç»­ä¼˜åŒ–ã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/01aba941f206483ebb9f8f10fe53633e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg572X6KW_55qE5oCd6ICD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765801901&amp;x-signature=rNFzz9A6wN2jeY0MUyhnQVm5i%2Fg%3D" alt="Searcher è¯¦ç»†æœç´¢è¿‡ç¨‹æµç¨‹" loading="lazy"/></p>
<p>ç”¨æˆ·æœç´¢æµç¨‹å¦‚ä¸‹ï¼šç”¨æˆ·æŸ¥è¯¢ â†’ TaskGoalParser è§£æ â†’ å¤šè·¯å¾„å¹¶è¡Œæ£€ç´¢ â†’ ç»“æœé‡æ’åº â†’ å»é‡å¤„ç† â†’ æ¨ç†ä¼˜åŒ– â†’ è¿”å›æœ€ç»ˆç»“æœã€‚</p>
<p>å…¶ä¸­æ¶‰åŠåˆ°å¦‚ä¸‹ç»„ä»¶ï¼š</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f081aae6b54641a4b2bfad88d3a3de0e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg572X6KW_55qE5oCd6ICD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765801901&amp;x-signature=DgjU47dG3RRzhr9mIOuKkwe15Nc%3D" alt="æœç´¢æµç¨‹" loading="lazy"/></p>
<p>å› æ­¤ï¼Œæˆ‘ä»¬æŒ‰ç…§å¦‚ä¸‹æµç¨‹è¿›è¡Œåˆ†æã€‚</p>
<h4 data-id="heading-12">2.5 TaskGoalParser</h4>
<p>_parse_task æ–¹æ³•ä¸»è¦æ˜¯ä½¿ç”¨ TaskGoalParser æ¥åˆ†æqueryã€‚</p>
<pre><code class="hljs language-ini" lang="ini"> Â  Â  Â  Â <span class="hljs-attr">parsed_goal</span> = self.task_goal_parser.parse(
 Â  Â  Â  Â  Â  Â <span class="hljs-attr">task_description</span>=query,
 Â  Â  Â  Â  Â  Â <span class="hljs-attr">context</span>=<span class="hljs-string">"\n"</span>.join(context),
 Â  Â  Â  Â  Â  Â <span class="hljs-attr">conversation</span>=info.get(<span class="hljs-string">"chat_history"</span>, []),
 Â  Â  Â  Â  Â  Â <span class="hljs-attr">mode</span>=mode,
 Â  Â  Â   )
</code></pre>
<p>TaskGoalParser æ˜¯ä¸€ä¸ªä»»åŠ¡ç›®æ ‡è§£æå™¨ï¼Œè´Ÿè´£å°†ç”¨æˆ·çš„è‡ªç„¶è¯­è¨€æŸ¥è¯¢è§£æä¸ºç»“æ„åŒ–çš„è¯­ä¹‰å±‚è¡¨ç¤ºï¼Œä»¥ä¾¿åç»­çš„æ£€ç´¢ç³»ç»Ÿèƒ½å¤Ÿæ›´æœ‰æ•ˆåœ°ç†è§£å’Œå¤„ç†æŸ¥è¯¢ã€‚</p>
<h5 data-id="heading-13">2.5.1 ä¸»è¦åŠŸèƒ½</h5>
<p>TaskGoalParser ä¸»è¦åŠŸèƒ½ä¸ºï¼š</p>
<ul>
<li>
<p>æŸ¥è¯¢è§£æã€‚</p>
<ul>
<li>å°†ç”¨æˆ·è¾“å…¥çš„è‡ªç„¶è¯­è¨€æŸ¥è¯¢è½¬æ¢ä¸ºç»“æ„åŒ–çš„æŸ¥è¯¢è¡¨ç¤º</li>
<li>æä¾›ä¸¤ç§è§£ææ¨¡å¼ï¼šå¿«é€Ÿæ¨¡å¼ï¼ˆfastï¼‰å’Œç²¾ç»†æ¨¡å¼ï¼ˆfineï¼‰</li>
</ul>
</li>
<li>
<p>ç»“æ„åŒ–è¯­ä¹‰è¡¨ç¤º</p>
<ul>
<li>å°†æŸ¥è¯¢åˆ†è§£ä¸ºå¤šä¸ªè¯­ä¹‰å±‚æ¬¡ï¼šä¸»é¢˜ï¼ˆtopicï¼‰ã€å…³é”®è¯ï¼ˆkeysï¼‰ã€æ ‡ç­¾ï¼ˆtagsï¼‰ç­‰ æå–æŸ¥è¯¢çš„æ ¸å¿ƒæ„å›¾å’Œç›¸å…³ä¿¡æ¯</li>
</ul>
</li>
</ul>
<h5 data-id="heading-14">2.5.2 å·¥ä½œæ¨¡å¼</h5>
<h6 data-id="heading-15">Fast æ¨¡å¼</h6>
<pre><code class="hljs language-ini" lang="ini">def _parse_fast(self, task_description: str, limit_num: <span class="hljs-attr">int</span> = <span class="hljs-number">5</span>) -&gt; ParsedTaskGoal:
 Â  Â <span class="hljs-comment"># å¿«é€Ÿæ¨¡å¼ï¼šç®€å•çš„åˆ†è¯å¤„ç†</span>
 Â  Â return ParsedTaskGoal(
 Â  Â  Â  Â <span class="hljs-attr">memories</span>=[task_description],
 Â  Â  Â  Â <span class="hljs-attr">keys</span>=[task_description],
 Â  Â  Â  Â <span class="hljs-attr">tags</span>=[],
 Â  Â  Â  Â <span class="hljs-attr">goal_type</span>=<span class="hljs-string">"default"</span>,
 Â  Â  Â  Â <span class="hljs-attr">rephrased_query</span>=task_description,
 Â  Â  Â  Â <span class="hljs-attr">internet_search</span>=<span class="hljs-literal">False</span>,
</code></pre>
<h6 data-id="heading-16">Fine æ¨¡å¼</h6>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">_parse_fine</span>(<span class="hljs-params">
 Â  Â self, query: <span class="hljs-built_in">str</span>, context: <span class="hljs-built_in">str</span> = <span class="hljs-string">""</span>, conversation: <span class="hljs-built_in">list</span>[<span class="hljs-built_in">dict</span>] | <span class="hljs-literal">None</span> = <span class="hljs-literal">None</span>
</span>) -&gt; ParsedTaskGoal:
 Â  Â <span class="hljs-comment"># ç²¾ç»†æ¨¡å¼ï¼šä½¿ç”¨ LLM è¿›è¡Œç»“æ„åŒ–è§£æ</span>
 Â  Â <span class="hljs-comment"># æ„å»ºæç¤ºè¯å¹¶è°ƒç”¨ LLM è¿›è¡Œè§£æ</span>
 Â  Â prompt = Template(TASK_PARSE_PROMPT).substitute(
 Â  Â  Â  Â task=query.strip(), context=context, conversation=conversation_prompt
 Â   )
 Â  Â response = self.llm.generate(messages=[{<span class="hljs-string">"role"</span>: <span class="hljs-string">"user"</span>, <span class="hljs-string">"content"</span>: prompt}])
 Â  Â <span class="hljs-keyword">return</span> self._parse_response(response)
</code></pre>
<h5 data-id="heading-17">2.5.3 è¾“å‡ºç»“æ„</h5>
<p>TaskGoalParser è§£æåçš„ç»“æœå­˜å‚¨åœ¨ ParsedTaskGoal å¯¹è±¡ä¸­ï¼ŒåŒ…å«ä»¥ä¸‹å­—æ®µï¼š</p>
<ul>
<li>memoriesï¼šç›¸å…³è®°å¿†é¡¹åˆ—è¡¨</li>
<li>keysï¼šå…³é”®è¯åˆ—è¡¨</li>
<li>tagsï¼šæ ‡ç­¾åˆ—è¡¨</li>
<li>rephrased_queryï¼šé‡è¿°çš„æŸ¥è¯¢ï¼ˆæ›´æ¸…æ™°çš„è¡¨è¾¾ï¼‰</li>
<li>internet_searchï¼šæ˜¯å¦éœ€è¦è”ç½‘æœç´¢</li>
<li>goal_typeï¼šç›®æ ‡ç±»å‹</li>
</ul>
<h5 data-id="heading-18">2.5.4 prompt</h5>
<pre><code class="hljs language-python" lang="python">TASK_PARSE_PROMPT = <span class="hljs-string">"""
You are a task parsing expert. Given a user task instruction, optional former conversation and optional related memory context,extract the following structured information:
1. Keys: the high-level keywords directly relevant to the userâ€™s task.
2. Tags: thematic tags to help categorize and retrieve related memories.
3. Goal Type: retrieval | qa | generation
4. Rephrased instruction: Give a rephrased task instruction based on the former conversation to make it less confusing to look alone. If you think the task instruction is easy enough to understand, or there is no former conversation, set "rephrased_instruction" to an empty string.
5. Need for internet search: If the user's task instruction only involves objective facts or can be completed without introducing external knowledge, set "internet_search" to False. Otherwise, set it to True.
6. Memories: Provide 2â€“5 short semantic expansions or rephrasings of the rephrased/original user task instruction. These are used for improved embedding search coverage. Each should be clear, concise, and meaningful for retrieval.
â€‹
Former conversation (if any):
"""</span>
$conversation
<span class="hljs-string">"""
â€‹
Task description(User Question):
"""</span>$task<span class="hljs-string">"""
â€‹
Context (if any):
"""</span>$context<span class="hljs-string">"""
â€‹
Return strictly in this JSON format, note that the
keys/tags/rephrased_instruction/memories should use the same language as the
input query:
{
  "keys": [...],
  "tags": [...],
  "goal_type": "retrieval | qa | generation",
  "rephrased_instruction": "...", # return an empty string if the original instruction is easy enough to understand
  "internet_search": True/False,
  "memories": ["...", "...", ...]
}
"""</span>
</code></pre>
<h5 data-id="heading-19">2.5.5 ä¼˜åŠ¿</h5>
<p>æ€»çš„æ¥è¯´ï¼ŒTaskGoalParser åœ¨è®°å¿†æ£€ç´¢ç³»ç»Ÿä¸­æ‰®æ¼”ç€â€œæŸ¥è¯¢ç†è§£å™¨â€çš„è§’è‰²ï¼Œé€šè¿‡è§£æç”¨æˆ·æŸ¥è¯¢ä¸ºç»“æ„åŒ–è¡¨ç¤ºï¼Œä¸ºåç»­çš„æ£€ç´¢å’Œæ¨ç†è¿‡ç¨‹æä¾›æ›´ç²¾ç¡®çš„è¾“å…¥ã€‚å…¶ä¼˜åŠ¿ä¸ºï¼š</p>
<ul>
<li>çµæ´»æ€§ï¼šæ”¯æŒä¸¤ç§è§£ææ¨¡å¼ï¼Œé€‚åº”ä¸åŒæ€§èƒ½å’Œç²¾åº¦éœ€æ±‚</li>
<li>ç»“æ„åŒ–ï¼šå°†è‡ªç„¶è¯­è¨€æŸ¥è¯¢è½¬æ¢ä¸ºç»“æ„åŒ–è¡¨ç¤ºï¼Œä¾¿äºåç»­å¤„ç†</li>
<li>ä¸Šä¸‹æ–‡æ„ŸçŸ¥ï¼šåœ¨ç²¾ç»†æ¨¡å¼ä¸‹å¯ä»¥è€ƒè™‘ä¸Šä¸‹æ–‡å’Œå¯¹è¯å†å²</li>
<li>é”™è¯¯å¤„ç†ï¼šå½“ç²¾ç»†æ¨¡å¼å¤±è´¥æ—¶ä¼šå›é€€åˆ°å¿«é€Ÿæ¨¡å¼</li>
</ul>
<h4 data-id="heading-20">2.6 GraphMemoryRetriever</h4>
<p>GraphMemoryRetriever æ˜¯ä¸€ä¸ªç»Ÿä¸€çš„è®°å¿†æ£€ç´¢å™¨ï¼Œç»“åˆäº†å›¾ç»“æ„æ£€ç´¢å’Œå‘é‡ç›¸ä¼¼æ€§æ£€ç´¢ä¸¤ç§æ–¹å¼ï¼Œç”¨äºä»çŸ¥è¯†å›¾è°±ä¸­æ£€ç´¢ç›¸å…³è®°å¿†é¡¹ã€‚</p>
<h5 data-id="heading-21">2.6.1 ä¸»è¦åŠŸèƒ½</h5>
<p>GraphMemoryRetriever å®ç°æ··åˆæ£€ç´¢ï¼Œè¿™ç§è®¾è®¡ä½¿å¾—ç³»ç»Ÿæ—¢èƒ½åˆ©ç”¨ç»“æ„åŒ–ä¿¡æ¯è¿›è¡Œç²¾ç¡®æ£€ç´¢ï¼Œåˆèƒ½é€šè¿‡å‘é‡ç›¸ä¼¼æ€§æ•è·è¯­ä¹‰ç›¸å…³çš„å†…å®¹ï¼Œä»è€Œæé«˜äº†æ£€ç´¢çš„å‡†ç¡®æ€§å’Œå¬å›ç‡ã€‚</p>
<ul>
<li>
<p>æ··åˆæ£€ç´¢æœºåˆ¶</p>
<ul>
<li>ç»“æ„åŒ–å›¾æ£€ç´¢ï¼šåŸºäºè§£æåçš„ä»»åŠ¡ç›®æ ‡ï¼ˆkeys/tagsï¼‰è¿›è¡Œç²¾ç¡®åŒ¹é…</li>
<li>å‘é‡ç›¸ä¼¼æ€§æ£€ç´¢ï¼šåŸºäºæŸ¥è¯¢åµŒå…¥è¿›è¡Œè¯­ä¹‰ç›¸ä¼¼åº¦æœç´¢</li>
<li>åˆå¹¶ä¸¤ç§æ£€ç´¢ç»“æœå¹¶å»é‡</li>
</ul>
</li>
<li>
<p>å¤šèŒƒå›´è®°å¿†æ£€ç´¢</p>
<ul>
<li>æ”¯æŒä¸åŒç±»å‹çš„è®°å¿†èŒƒå›´ï¼šWorkingMemoryã€LongTermMemoryã€UserMemory</li>
<li>é’ˆå¯¹ä¸åŒèŒƒå›´é‡‡ç”¨ä¸åŒçš„æ£€ç´¢ç­–ç•¥</li>
</ul>
</li>
</ul>
<h5 data-id="heading-22">2.6.2 æ ¸å¿ƒæ–¹æ³•</h5>
<ul>
<li>
<p>retrieve æ–¹æ³•ï¼šè¿™æ˜¯ä¸»è¦çš„æ£€ç´¢å…¥å£ï¼Œæ‰§è¡Œä»¥ä¸‹æ­¥éª¤ï¼š</p>
<ul>
<li>å¯¹äº WorkingMemoryï¼Œç›´æ¥è·å–æ‰€æœ‰æ¡ç›®ï¼›</li>
<li>å¯¹äºå…¶ä»–è®°å¿†ç±»å‹ï¼ŒåŒæ—¶æ‰§è¡Œ _graph_recall å’Œ _vector_recallï¼›</li>
<li>åˆå¹¶ç»“æœå¹¶å»é™¤é‡å¤é¡¹ã€‚</li>
</ul>
</li>
<li>
<p>_graph_recall æ–¹æ³•ï¼šæ‰§è¡ŒåŸºäºå›¾ç»“æ„çš„æ£€ç´¢ï¼š</p>
<ul>
<li>åŸºäº keys è¿›è¡Œç²¾ç¡®åŒ¹é…æ£€ç´¢ï¼›</li>
<li>åŸºäº tags è¿›è¡ŒåŒ…å«åŒ¹é…æ£€ç´¢ï¼›</li>
<li>å¯¹å€™é€‰ç»“æœè¿›è¡Œåè¿‡æ»¤ï¼Œç¡®ä¿è‡³å°‘æœ‰ 2 ä¸ªæ ‡ç­¾é‡å ã€‚</li>
</ul>
</li>
<li>
<p>_vector_recall æ–¹æ³•ï¼šæ‰§è¡ŒåŸºäºå‘é‡çš„ç›¸ä¼¼æ€§æ£€ç´¢ï¼š</p>
<ul>
<li>ä½¿ç”¨æŸ¥è¯¢åµŒå…¥åœ¨å›¾æ•°æ®åº“ä¸­æœç´¢æœ€ç›¸ä¼¼çš„è®°å¿†é¡¹ï¼›</li>
<li>æ”¯æŒå¸¦è¿‡æ»¤æ¡ä»¶çš„æœç´¢å’Œä¸å¸¦è¿‡æ»¤æ¡ä»¶çš„æœç´¢è·¯å¾„ï¼›</li>
<li>å¹¶å‘æ‰§è¡Œå¤šä¸ªæœç´¢ä»»åŠ¡ä»¥æé«˜æ•ˆç‡ã€‚</li>
</ul>
</li>
<li>
<p>retrieve_from_cube æ–¹æ³•ï¼šä¸“é—¨ç”¨äºä»ç‰¹å®šçš„ cube ä¸­æ£€ç´¢è®°å¿†é¡¹ï¼Œè¿™åœ¨å¤šç§Ÿæˆ·æˆ–åˆ†ç‰‡åœºæ™¯ä¸­å¾ˆæœ‰ç”¨ã€‚</p>
</li>
</ul>
<h5 data-id="heading-23">2.6.3 å·¥ä½œæµç¨‹æ€»ç»“</h5>
<ul>
<li>æ¥æ”¶ç”¨æˆ·æŸ¥è¯¢å’Œè§£æåçš„ä»»åŠ¡ç›®æ ‡</li>
<li>å¹¶è¡Œæ‰§è¡Œå›¾ç»“æ„æ£€ç´¢å’Œå‘é‡æ£€ç´¢</li>
<li>åˆå¹¶ä¸¤ç§æ£€ç´¢ç»“æœ</li>
<li>å»é™¤é‡å¤é¡¹å¹¶è¿”å›æœ€ç»ˆç»“æœ</li>
</ul>
<h4 data-id="heading-24">2.7 Reranker</h4>
<p>ä½¿ç”¨ CosineLocalReranker åšè§£æã€‚CosineLocalReranker æ˜¯ä¸€ä¸ªæœ¬åœ°å®ç°çš„é‡æ’åºå™¨ï¼Œå®ƒä½¿ç”¨ä½™å¼¦ç›¸ä¼¼åº¦ç®—æ³•å¯¹æ£€ç´¢åˆ°çš„è®°å¿†é¡¹è¿›è¡Œé‡æ–°æ’åºï¼Œä»¥æé«˜æ£€ç´¢ç»“æœçš„ç›¸å…³æ€§ã€‚</p>
<h5 data-id="heading-25">2.7.1 ä¸»è¦åŠŸèƒ½</h5>
<p>ä¸»è¦åŠŸèƒ½æ˜¯ä½™å¼¦ç›¸ä¼¼åº¦è®¡ç®—</p>
<ul>
<li>è®¡ç®—æŸ¥è¯¢å‘é‡ä¸å€™é€‰è®°å¿†é¡¹å‘é‡ä¹‹é—´çš„ä½™å¼¦ç›¸ä¼¼åº¦</li>
<li>æ”¯æŒå•ä¸ªæŸ¥è¯¢å‘é‡ä¸å¤šä¸ªå€™é€‰å‘é‡çš„åŒæ—¶è®¡ç®—</li>
</ul>
<h5 data-id="heading-26">2.7.2 å·¥ä½œæµç¨‹æ€»ç»“</h5>
<ul>
<li>æ¥æ”¶æ¥è‡ª GraphMemoryRetriever çš„åˆæ­¥æ£€ç´¢ç»“æœ</li>
<li>è·å–æŸ¥è¯¢çš„åµŒå…¥å‘é‡å’Œå€™é€‰è®°å¿†é¡¹çš„åµŒå…¥å‘é‡</li>
<li>è®¡ç®—æŸ¥è¯¢å‘é‡ä¸æ¯ä¸ªå€™é€‰å‘é‡çš„ä½™å¼¦ç›¸ä¼¼åº¦</li>
<li>æ ¹æ®è®°å¿†é¡¹çš„å±‚çº§ç±»å‹åº”ç”¨ç›¸åº”æƒé‡</li>
<li>æŒ‰ç…§åŠ æƒç›¸ä¼¼åº¦åˆ†æ•°å¯¹ç»“æœè¿›è¡Œæ’åº</li>
<li>è¿”å›å‰ K ä¸ªæœ€ç›¸å…³çš„ç»“æœç»™ä¸‹ä¸€ä¸ªå¤„ç†é˜¶æ®µ</li>
</ul>
<p>è¿™ç§è®¾è®¡ä½¿å¾—ç³»ç»Ÿèƒ½å¤Ÿåœ¨æœ¬åœ°å¿«é€Ÿå®Œæˆé‡æ’åºæ“ä½œï¼Œè€Œæ— éœ€ä¾èµ–å¤–éƒ¨æœåŠ¡ï¼ŒåŒæ—¶é€šè¿‡å±‚çº§æƒé‡æœºåˆ¶å¯ä»¥ä¼˜å…ˆè€ƒè™‘æŸäº›ç±»å‹çš„è®°å¿†é¡¹ï¼Œä»è€Œæé«˜æ£€ç´¢ç»“æœçš„è´¨é‡ã€‚</p>
<h4 data-id="heading-27">2.8 MemoryReasoner</h4>
<p>MemoryReasoner æ˜¯ä¸€ä¸ªä¸“é—¨è´Ÿè´£å¯¹æ£€ç´¢åˆ°çš„è®°å¿†é¡¹è¿›è¡Œæ¨ç†å’ŒçŸ¥è¯†ç»¼åˆçš„ç»„ä»¶ã€‚å®ƒçš„ä¸»è¦èŒè´£æ˜¯å¯¹ä»ä¸åŒæ¥æºæ£€ç´¢åˆ°çš„è®°å¿†è¿›è¡Œåˆ†æã€ç­›é€‰å’Œä¼˜åŒ–ï¼Œä»è€Œæä¾›æ›´ç²¾ç¡®å’Œç›¸å…³çš„è®°å¿†ç»“æœã€‚</p>
<h5 data-id="heading-28">2.8.1 ä¸»è¦åŠŸèƒ½</h5>
<ul>
<li>
<p>è®°å¿†æ¨ç†ä¸ç»¼åˆ</p>
<ul>
<li>æ¥æ”¶åŸå§‹æŸ¥è¯¢å’Œå·²æ£€ç´¢çš„ç›¸å…³è®°å¿†é¡¹</li>
<li>åˆ©ç”¨å¤§å‹è¯­è¨€æ¨¡å‹åˆ†æå¤šä¸ªæ£€ç´¢åˆ°çš„è®°å¿†é¡¹</li>
<li>æ ¹æ®ç”¨æˆ·çš„æŸ¥è¯¢ç›®æ ‡ç»¼åˆç›¸å…³ä¿¡æ¯</li>
<li>ç”Ÿæˆæ›´åŠ ç²¾ç¡®å’Œç›¸å…³çš„è®°å¿†å“åº”</li>
</ul>
</li>
</ul>

<ul>
<li>
<p>æ™ºèƒ½ç­›é€‰</p>
<ul>
<li>é€šè¿‡ LLM åˆ¤æ–­å“ªäº›è®°å¿†é¡¹ä¸å½“å‰æŸ¥è¯¢æœ€ç›¸å…³</li>
<li>åªè¿”å›ç»è¿‡ç­›é€‰çš„ç›¸å…³è®°å¿†é¡¹</li>
</ul>
</li>
</ul>
<h5 data-id="heading-29">2.8.2 æ ¸å¿ƒæ–¹æ³•</h5>
<p>reason æ˜¯ä¸»è¦çš„æ¨ç†æ–¹æ³•ï¼Œæ‰§è¡Œä»¥ä¸‹æ­¥éª¤ï¼š</p>
<ul>
<li>
<p>æ„å»ºæç¤ºè¯ï¼š</p>
<ul>
<li>ä½¿ç”¨æ¨¡æ¿ REASON_PROMPT æ„å»ºæ¨ç†æç¤ºè¯</li>
<li>å°†æ£€ç´¢åˆ°çš„è®°å¿†é¡¹æ ¼å¼åŒ–ä¸ºå­—ç¬¦ä¸²åˆ—è¡¨</li>
</ul>
</li>
<li>
<p>è°ƒç”¨ LLMï¼š</p>
<ul>
<li>å°†æ„å»ºå¥½çš„æç¤ºè¯å‘é€ç»™è¯­è¨€æ¨¡å‹ç”Ÿæˆå“åº”</li>
</ul>
</li>
<li>
<p>è§£æå“åº”ï¼š</p>
<ul>
<li>æå–æ¨¡å‹é€‰æ‹©çš„è®°å¿†é¡¹ ID</li>
<li>è¿”å›å¯¹åº”çš„è®°å¿†é¡¹åˆ—è¡¨</li>
</ul>
</li>
</ul>
<p>parse_selected_ids æ–¹æ³•è´Ÿè´£ä»æ¨¡å‹å“åº”ä¸­æå–é€‰å®šçš„è®°å¿†é¡¹ IDï¼š</p>
<ul>
<li>JSON è§£æï¼šé¦–å…ˆå°è¯•å°†å“åº”è§£æä¸º JSON æ ¼å¼</li>
<li>æ­£åˆ™è¡¨è¾¾å¼å›é€€ï¼šå¦‚æœ JSON è§£æå¤±è´¥ï¼Œåˆ™ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼åŒ¹é… UUID æ ¼å¼çš„ ID</li>
</ul>
<h5 data-id="heading-30">2.8.3 æç¤ºè¯</h5>
<pre><code class="hljs language-css" lang="css">REASON_PROMPT = """
You are <span class="hljs-selector-tag">a</span> reasoning agent working with <span class="hljs-selector-tag">a</span> memory system. You will synthesize knowledge <span class="hljs-selector-tag">from</span> multiple memory cards <span class="hljs-selector-tag">to</span> construct <span class="hljs-selector-tag">a</span> meaningful response <span class="hljs-selector-tag">to</span> the task below.
â€‹
Task: ${task}
â€‹
Memory cards (with metadata):
${detailed_memory_list}
â€‹
Please perform:
<span class="hljs-number">1</span>. Clustering by theme (topic/concept/fact)
<span class="hljs-number">2</span>. Identify useful chains or connections
<span class="hljs-number">3</span>. Return a curated list of memory card IDs with reasons.
â€‹
Output in JSON:
{
  "selected_ids": [...],
  <span class="hljs-string">"explanation"</span>: <span class="hljs-string">"..."</span>
}
"""
</code></pre>
<h5 data-id="heading-31">2.8.4 å·¥ä½œæµç¨‹æ€»ç»“</h5>
<ul>
<li>
<p>æ¥æ”¶æ¥è‡ªä¸Šä¸€é˜¶æ®µçš„æ£€ç´¢å’Œé‡æ’åºç»“æœ</p>
</li>
<li>
<p>æ„å»ºæ¨ç†æç¤ºè¯ï¼š</p>
<ul>
<li>å°†ç”¨æˆ·çš„æŸ¥è¯¢ã€è§£æåçš„ä»»åŠ¡ç›®æ ‡ä»¥åŠæ£€ç´¢åˆ°çš„è®°å¿†é¡¹ç»„åˆæˆä¸€ä¸ªç»“æ„åŒ–çš„æç¤ºè¯</li>
<li>ä½¿ç”¨é¢„å®šä¹‰çš„ REASON_PROMPT æ¨¡æ¿</li>
</ul>
</li>
<li>
<p>è°ƒç”¨ LLM è¿›è¡Œæ¨ç†ï¼š</p>
<ul>
<li>å°†æ„å»ºå¥½çš„æç¤ºè¯å‘é€ç»™å¤§å‹è¯­è¨€æ¨¡å‹</li>
<li>ä½¿ç”¨ LLM è¿›ä¸€æ­¥åˆ†æå’Œæ¨ç†è¿™äº›è®°å¿†é¡¹çš„ç›¸å…³æ€§</li>
<li>è·å–æ¨¡å‹çš„å“åº”ï¼Œè¯¥å“åº”åŒ…å«å¯¹è®°å¿†é¡¹çš„ç›¸å…³æ€§åˆ¤æ–­</li>
</ul>
</li>
<li>
<p>è§£æå’Œç­›é€‰ç»“æœï¼š</p>
<ul>
<li>
<p>è§£æ LLM çš„å“åº”ï¼Œæå–è¢«é€‰ä¸­çš„è®°å¿†é¡¹ ID</p>
</li>
<li>
<p>æ”¯æŒä¸¤ç§è§£ææ–¹å¼ï¼š</p>
<ul>
<li>JSON æ ¼å¼ï¼šç›´æ¥æå– selected_ids å­—æ®µ</li>
<li>æ–‡æœ¬æ ¼å¼ï¼šé€šè¿‡æ­£åˆ™è¡¨è¾¾å¼åŒ¹é… UUID æ¨¡å¼</li>
</ul>
</li>
</ul>
</li>
<li>
<p>è¿”å›ç²¾é€‰è®°å¿†ï¼š</p>
<ul>
<li>æ ¹æ®è§£æå‡ºçš„ ID åˆ—è¡¨ç­›é€‰åŸå§‹è®°å¿†é¡¹</li>
<li>è¿”å›æœ€ç›¸å…³çš„ç»“æœå­é›†</li>
</ul>
</li>
</ul>
<p>è¿™ç§è®¾è®¡ä½¿å¾—ç³»ç»Ÿèƒ½å¤Ÿåˆ©ç”¨ LLM çš„ç†è§£å’Œæ¨ç†èƒ½åŠ›ï¼Œä»å¤§é‡æ£€ç´¢åˆ°çš„è®°å¿†ä¸­é€‰å‡ºæœ€ç¬¦åˆç”¨æˆ·éœ€æ±‚çš„éƒ¨åˆ†ï¼Œæé«˜äº†ç³»ç»Ÿçš„å‡†ç¡®æ€§å’Œæ™ºèƒ½åŒ–æ°´å¹³ã€‚</p>
<h5 data-id="heading-32">2.8.5 ä¼˜åŠ¿</h5>
<ul>
<li>æ™ºèƒ½åŒ–å¤„ç†ï¼šåˆ©ç”¨ LLM çš„ç†è§£èƒ½åŠ›å¯¹è®°å¿†é¡¹è¿›è¡Œè¯­ä¹‰å±‚é¢çš„åˆ†æ</li>
<li>çµæ´»æ€§ï¼šæ”¯æŒå¤šç§è¾“å‡ºæ ¼å¼çš„è§£æ</li>
<li>ç²¾å‡†æ€§ï¼šèƒ½å¤Ÿè¿›ä¸€æ­¥æå‡æ£€ç´¢ç»“æœçš„ç›¸å…³æ€§å’Œè´¨é‡</li>
</ul>
<p>æ€»çš„æ¥è¯´ï¼ŒMemoryReasoner åœ¨æ•´ä¸ªè®°å¿†æ£€ç´¢ç³»ç»Ÿä¸­æ‰®æ¼”ç€â€œæ™ºèƒ½ç­›é€‰å™¨â€çš„è§’è‰²ï¼Œé€šè¿‡å¼•å…¥ LLM çš„æ¨ç†èƒ½åŠ›ï¼Œä½¿ç³»ç»Ÿèƒ½å¤Ÿæ›´å‡†ç¡®åœ°ç†è§£ç”¨æˆ·éœ€æ±‚å¹¶è¿”å›æœ€ç›¸å…³çš„è®°å¿†é¡¹ã€‚</p>
<h4 data-id="heading-33">2.9 Reranker å’Œ Reasoner</h4>
<p>åœ¨ç³»ç»Ÿä¸­åŒæ—¶ä½¿ç”¨ Reranker å’Œ Reasoner æ˜¯ä¸ºäº†å®ç°ä¸åŒå±‚æ¬¡çš„æ£€ç´¢ç»“æœå¤„ç†å’Œä¼˜åŒ–ï¼Œå®ƒä»¬å„è‡ªæ‰¿æ‹…ä¸åŒçš„èŒè´£ã€‚</p>
<h5 data-id="heading-34">2.9.1 Reranker çš„ä½œç”¨</h5>
<p>Rerankerï¼ˆé‡æ’åºå™¨ï¼‰ä¸»è¦è´Ÿè´£å¯¹åˆæ­¥æ£€ç´¢ç»“æœè¿›è¡Œç›¸å…³æ€§é‡æ–°æ’åºï¼š</p>
<ul>
<li>åŠŸèƒ½ï¼šåŸºäºæŸ¥è¯¢å’Œå€™é€‰ç»“æœçš„ç›¸ä¼¼åº¦è®¡ç®—ï¼Œå¯¹æ£€ç´¢ç»“æœè¿›è¡Œé‡æ–°æ’åº</li>
<li>æ–¹æ³•ï¼šé€šå¸¸ä½¿ç”¨æ•°å­¦è®¡ç®—ï¼ˆå¦‚ä½™å¼¦ç›¸ä¼¼åº¦ï¼‰æ¥è¯„ä¼°ç›¸å…³æ€§</li>
<li>è¾“å‡ºï¼šè¿”å›æŒ‰ç›¸å…³æ€§å¾—åˆ†æ’åºçš„è®°å¿†é¡¹åˆ—è¡¨</li>
</ul>

<pre><code class="hljs language-ini" lang="ini">def rerank(self, query, graph_results, top_k, **kwargs):
 Â  Â <span class="hljs-comment"># è®¡ç®—ç›¸ä¼¼åº¦</span>
 Â  Â <span class="hljs-attr">sims</span> = _cosine_one_to_many(query_embedding, cand_vecs)
 Â  Â <span class="hljs-comment"># åº”ç”¨æƒé‡è°ƒæ•´</span>
 Â  Â <span class="hljs-attr">weighted</span> = [sim * get_weight(it) for sim, it in zip(sims, items_with_emb)]
 Â  Â <span class="hljs-comment"># æ’åºå¹¶è¿”å›å‰ K ä¸ªç»“æœ</span>
 Â  Â scored_pairs.sort(<span class="hljs-attr">key</span>=lambda x: x[<span class="hljs-number">1</span>], reverse=<span class="hljs-literal">True</span>)
 Â  Â return scored_pairs<span class="hljs-section">[:top_k]</span>
</code></pre>
<h5 data-id="heading-35">2.9.2 Reasoner çš„ä½œç”¨</h5>
<p>Reasonerï¼ˆæ¨ç†å™¨ï¼‰ä¸»è¦è´Ÿè´£å¯¹æ’åºåçš„ç»“æœè¿›è¡Œè¯­ä¹‰ç†è§£å’Œæ¨ç†ï¼š</p>
<ul>
<li>åŠŸèƒ½ï¼šåŸºäºè¯­è¨€æ¨¡å‹å¯¹æ£€ç´¢åˆ°çš„è®°å¿†é¡¹è¿›è¡Œè¯­ä¹‰ç†è§£å’Œæ¨ç†</li>
<li>æ–¹æ³•ï¼šä½¿ç”¨å¤§è¯­è¨€æ¨¡å‹åˆ†ææŸ¥è¯¢å’Œè®°å¿†é¡¹ä¹‹é—´çš„æ·±å±‚è¯­ä¹‰å…³ç³»</li>
<li>è¾“å‡ºï¼šè¿”å›ç»è¿‡è¯­ä¹‰æ¨ç†ç­›é€‰åçš„æœ€ç»ˆè®°å¿†é¡¹</li>
</ul>

<pre><code class="hljs language-ini" lang="ini">def reason(self, query, ranked_memories, parsed_goal):
 Â  Â <span class="hljs-comment"># æ„å»ºæ¨ç†æç¤º</span>
 Â  Â <span class="hljs-attr">prompt</span> = prompt_template.substitute(task=query, detailed_memory_list=memory_detailed_str)
 Â  Â <span class="hljs-comment"># ä½¿ç”¨ LLM è¿›è¡Œæ¨ç†</span>
 Â  Â <span class="hljs-attr">response</span> = self.llm.generate([{<span class="hljs-string">"role"</span>: <span class="hljs-string">"user"</span>, <span class="hljs-string">"content"</span>: prompt}])
 Â  Â <span class="hljs-comment"># è§£æå¹¶è¿”å›æ¨ç†ç»“æœ</span>
 Â  Â <span class="hljs-attr">selected_ids</span> = self._parse_selected_ids(content)
 Â  Â return <span class="hljs-section">[m for m in ranked_memories if m.id in id_set]</span>
</code></pre>
<h5 data-id="heading-36">2.9.3 ä¸ºä»€ä¹ˆéœ€è¦ä¸¤è€…ç»“åˆï¼Ÿ</h5>
<ol start="0">
<li>ä¸åŒçš„å¤„ç†å±‚æ¬¡</li>
</ol>
<p>Rerankerï¼šåœ¨æ•°å­¦å‘é‡ç©ºé—´ä¸­è¿›è¡Œå¿«é€Ÿç›¸å…³æ€§è®¡ç®—</p>
<p>Reasonerï¼šåœ¨è¯­ä¹‰å±‚é¢è¿›è¡Œæ·±åº¦ç†è§£å’Œæ¨ç†</p>
<ol start="2">
<li>
<p>äº’è¡¥çš„ä¼˜åŠ¿</p>
<p>æ•ˆç‡ vs ç²¾åº¦ï¼šReranker å¿«é€Ÿç­›é€‰ï¼ŒReasoner ç²¾ç¡®æ¨ç†</p>
<p>å®šé‡ vs å®šæ€§ï¼šReranker åŸºäºæ•°å€¼è®¡ç®—ï¼ŒReasoner åŸºäºè¯­ä¹‰ç†è§£</p>
</li>
</ol>
<p>ç³»ç»Ÿè®¾è®¡ä¼˜åŠ¿</p>
<ul>
<li>
<p>æ€§èƒ½ä¼˜åŒ–ï¼šé¿å…ç›´æ¥å¯¹å¤§é‡å€™é€‰ç»“æœä½¿ç”¨æ˜‚è´µçš„ LLM æ¨ç†</p>
</li>
<li>
<p>ç²¾åº¦æå‡ï¼šå…ˆç”¨æ•°å­¦æ–¹æ³•ç²—ç­›ï¼Œå†ç”¨è¯­ä¹‰æ–¹æ³•ç²¾ç­›</p>
</li>
<li>
<p>æ¨¡å—åŒ–è®¾è®¡ï¼šä¸¤ä¸ªç»„ä»¶èŒè´£åˆ†æ˜ï¼Œä¾¿äºç‹¬ç«‹ä¼˜åŒ–å’Œæ›¿æ¢</p>
</li>
<li>
<p>é€‚åº”ä¸åŒåœºæ™¯ï¼š</p>
<ul>
<li>å¿«é€Ÿæ¨¡å¼ï¼šå¯èƒ½åªä½¿ç”¨ Reranker</li>
<li>ç²¾ç»†æ¨¡å¼ï¼šä¸¤è€…éƒ½ä½¿ç”¨ä»¥è·å¾—æœ€ä½³ç»“æœ</li>
</ul>
</li>
</ul>
<p>è¿™ç§è®¾è®¡ä½¿å¾—ç³»ç»Ÿæ—¢èƒ½åœ¨ä¿è¯æ£€ç´¢è´¨é‡çš„åŒæ—¶æ§åˆ¶è®¡ç®—æˆæœ¬ï¼Œåˆèƒ½æ ¹æ®ä¸åŒçš„åº”ç”¨åœºæ™¯çµæ´»è°ƒæ•´å¤„ç†æµç¨‹ã€‚</p>
<h5 data-id="heading-37">2.9.4 å…·ä½“ç¤ºä¾‹</h5>
<p>å‡è®¾ç”¨æˆ·æŸ¥è¯¢ï¼šâ€œæœºå™¨å­¦ä¹ ä¸­çš„æ¢¯åº¦ä¸‹é™ç®—æ³•å¦‚ä½•å·¥ä½œï¼Ÿâ€</p>
<ul>
<li>
<p>åˆå§‹æ£€ç´¢ï¼šç³»ç»Ÿå¯èƒ½æ£€ç´¢åˆ° 100 ä¸ªç›¸å…³è®°å¿†é¡¹</p>
</li>
<li>
<p>Reranker å¤„ç†ï¼š</p>
<ul>
<li>è®¡ç®—æŸ¥è¯¢ä¸æ¯ä¸ªè®°å¿†é¡¹çš„ä½™å¼¦ç›¸ä¼¼åº¦</li>
<li>æ ¹æ®å±‚çº§æƒé‡ï¼ˆtopic/concept/factï¼‰è°ƒæ•´å¾—åˆ†</li>
<li>è¿”å›å‰ 20 ä¸ªæœ€ç›¸å…³çš„è®°å¿†é¡¹</li>
</ul>
</li>
<li>
<p>Reasoner å¤„ç†ï¼š</p>
<ul>
<li>å°†å‰ 20 ä¸ªè®°å¿†é¡¹å’ŒæŸ¥è¯¢ä¸€èµ·äº¤ç»™ LLM</li>
<li>LLM åˆ†æå“ªäº›è®°å¿†é¡¹çœŸæ­£å›ç­”äº†ç”¨æˆ·çš„é—®é¢˜</li>
<li>å¯èƒ½å‘ç°åªæœ‰å…¶ä¸­ 5 ä¸ªè®°å¿†é¡¹çœŸæ­£ç›¸å…³ä¸”äº’è¡¥</li>
<li>è¿”å›è¿™ 5 ä¸ªæœ€åˆé€‚çš„è®°å¿†é¡¹</li>
</ul>
</li>
</ul>
<h3 data-id="heading-38">0x03 å­å›¾æ£€ç´¢</h3>
<h4 data-id="heading-39">3.1 åŠŸèƒ½</h4>
<p>get_relevant_subgraphæ–¹æ³•çš„åŠŸèƒ½æ˜¯ï¼š</p>
<ul>
<li>
<p>æŸ¥æ‰¾ä¸æŸ¥è¯¢ç›¸å…³çš„å±€éƒ¨å­å›¾ï¼ˆFind Relevant Local Subgraphï¼‰</p>
<ul>
<li>æ¥æ”¶ç”¨æˆ·æŸ¥è¯¢å­—ç¬¦ä¸²ä½œä¸ºè¾“å…¥</li>
<li>é€šè¿‡åµŒå…¥æ¨¡å‹å°†æŸ¥è¯¢è½¬æ¢ä¸ºå‘é‡è¡¨ç¤º</li>
<li>åœ¨å›¾æ•°æ®åº“ä¸­æœç´¢ä¸æŸ¥è¯¢å‘é‡æœ€ç›¸ä¼¼çš„å‰kä¸ªèŠ‚ç‚¹</li>
</ul>
</li>
</ul>

<ul>
<li>
<p>æ„å»ºé‚»åŸŸå­å›¾ï¼ˆBuild Neighborhood Subgraphsï¼‰ï¼Œå¯¹æ¯ä¸ªç›¸ä¼¼èŠ‚ç‚¹ï¼š</p>
<ul>
<li>ç¡®ä¿å…¶çŠ¶æ€ç¬¦åˆæŒ‡å®šæ¡ä»¶ï¼ˆé»˜è®¤ä¸º"activated"ï¼‰</li>
<li>è·å–ä»¥è¯¥èŠ‚ç‚¹ä¸ºä¸­å¿ƒã€æŒ‡å®šæ·±åº¦ï¼ˆé»˜è®¤2è·³ï¼‰çš„å±€éƒ¨å­å›¾</li>
<li>æ”¶é›†ä¸­å¿ƒèŠ‚ç‚¹ã€é‚»å±…èŠ‚ç‚¹å’Œè¿æ¥è¾¹</li>
</ul>
</li>
</ul>

<ul>
<li>
<p>åˆå¹¶å¤šä¸ªå­å›¾ä¸ºç»Ÿä¸€ç»“æ„ï¼ˆMerge Subgraphsï¼‰</p>
<ul>
<li>
<p>å°†æ‰€æœ‰æ£€ç´¢åˆ°çš„å±€éƒ¨å­å›¾åˆå¹¶æˆä¸€ä¸ªè¿é€šçš„å­å›¾</p>
</li>
<li>
<p>å»é™¤é‡å¤èŠ‚ç‚¹å’Œè¾¹</p>
</li>
<li>
<p>è¿”å›åŒ…å«ä»¥ä¸‹ä¿¡æ¯çš„å­—å…¸ç»“æ„ï¼š</p>
<ul>
<li>core_id: æœ€åŒ¹é…çš„æ ¸å¿ƒèŠ‚ç‚¹ID</li>
<li>nodes: åˆå¹¶åçš„å”¯ä¸€èŠ‚ç‚¹åˆ—è¡¨</li>
<li>edges: åˆå¹¶åçš„å”¯ä¸€è¾¹åˆ—è¡¨</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>è¿™ç§æ–¹æ³•ç‰¹åˆ«é€‚ç”¨äºéœ€è¦ç†è§£å¤æ‚å…³ç³»å’Œä¸Šä¸‹æ–‡çš„åœºæ™¯ï¼Œæ¯”å¦‚ï¼š</p>
<ul>
<li>æŸ¥æ‰¾ä¸ç‰¹å®šä¸»é¢˜ç›¸å…³çš„çŸ¥è¯†ç½‘ç»œç‰‡æ®µ</li>
<li>è¿›è¡Œå¤šè·³æ¨ç†ä»¥å‘ç°é—´æ¥å…³è”</li>
<li>æä¾›å¯è§£é‡Šçš„è®°å¿†æ£€ç´¢ç»“æœï¼Œå±•ç¤ºèŠ‚ç‚¹é—´çš„å…³ç³»è·¯å¾„</li>
</ul>
<p>ä¸»è¦ä¼˜åŠ¿åœ¨äºå®ƒä¸ä»…è¿”å›ç›¸å…³èŠ‚ç‚¹ï¼Œè¿˜ä¿ç•™äº†å®ƒä»¬ä¹‹é—´çš„è¯­ä¹‰å…³ç³»ç»“æ„ï¼Œè¿™å¯¹äºé«˜çº§æ¨ç†ä»»åŠ¡éå¸¸æœ‰ç”¨ã€‚</p>
<h4 data-id="heading-40">3.2 ä»£ç </h4>
<p>å…·ä½“ä»£ç å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-python" lang="python"> Â  Â <span class="hljs-keyword">def</span> <span class="hljs-title function_">get_relevant_subgraph</span>(<span class="hljs-params">
 Â  Â  Â  Â self, query: <span class="hljs-built_in">str</span>, top_k: <span class="hljs-built_in">int</span> = <span class="hljs-number">5</span>, depth: <span class="hljs-built_in">int</span> = <span class="hljs-number">2</span>, center_status: <span class="hljs-built_in">str</span> = <span class="hljs-string">"activated"</span>
 Â   </span>) -&gt; <span class="hljs-built_in">dict</span>[<span class="hljs-built_in">str</span>, <span class="hljs-type">Any</span>]:
 Â  Â  Â  Â <span class="hljs-string">"""
 Â  Â  Â   Find and merge the local neighborhood sub-graphs of the top-k
 Â  Â  Â   nodes most relevant to the query.
 Â  Â  Â  Â  Process:
 Â  Â  Â  Â  Â  Â  1. Embed the user query into a vector representation.
 Â  Â  Â  Â  Â  Â  2. Use vector similarity search to find the top-k similar nodes.
 Â  Â  Â  Â  Â  Â  3. For each similar node:
 Â  Â  Â  Â  Â  Â  Â  Â  - Ensure its status matches `center_status` (e.g., 'active').
 Â  Â  Â  Â  Â  Â  Â  Â  - Retrieve its local subgraph up to `depth` hops.
 Â  Â  Â  Â  Â  Â  Â  Â  - Collect the center node, its neighbors, and connecting edges.
 Â  Â  Â  Â  Â  Â  4. Merge all retrieved subgraphs into a single unified subgraph.
 Â  Â  Â  Â  Â  Â  5. Return the merged subgraph structure.
â€‹
 Â  Â  Â  Â  Args:
 Â  Â  Â  Â  Â  Â  query (str): The user input or concept to find relevant memories for.
 Â  Â  Â  Â  Â  Â  top_k (int, optional): How many top similar nodes to retrieve. Default is 5.
 Â  Â  Â  Â  Â  Â  depth (int, optional): The neighborhood depth (number of hops). Default is 2.
 Â  Â  Â  Â  Â  Â  center_status (str, optional): Status condition the center node must satisfy (e.g., 'active').
â€‹
 Â  Â  Â  Â  Returns:
 Â  Â  Â  Â  Â  Â  dict[str, Any]: A subgraph dict with:
 Â  Â  Â  Â  Â  Â  Â  Â  - 'core_id': ID of the top matching core node, or None if none found.
 Â  Â  Â  Â  Â  Â  Â  Â  - 'nodes': List of unique nodes (core + neighbors) in the merged subgraph.
 Â  Â  Â  Â  Â  Â  Â  Â  - 'edges': List of unique edges (as dicts with 'from', 'to', 'type') in the merged subgraph.
 Â  Â  Â   """</span>
 Â  Â  Â  Â <span class="hljs-comment"># Step 1: Embed query</span>
 Â  Â  Â  Â query_embedding = self.embedder.embed([query])[<span class="hljs-number">0</span>]
â€‹
 Â  Â  Â  Â <span class="hljs-comment"># Step 2: Get top-1 similar node</span>
 Â  Â  Â  Â similar_nodes = self.graph_store.search_by_embedding(query_embedding, top_k=top_k)
 Â  Â  Â  Â <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> similar_nodes:
 Â  Â  Â  Â  Â  Â logger.info(<span class="hljs-string">"No similar nodes found for query embedding."</span>)
 Â  Â  Â  Â  Â  Â <span class="hljs-keyword">return</span> {<span class="hljs-string">"core_id"</span>: <span class="hljs-literal">None</span>, <span class="hljs-string">"nodes"</span>: [], <span class="hljs-string">"edges"</span>: []}
â€‹
 Â  Â  Â  Â <span class="hljs-comment"># Step 3: Fetch neighborhood</span>
 Â  Â  Â  Â all_nodes = {}
 Â  Â  Â  Â all_edges = <span class="hljs-built_in">set</span>()
 Â  Â  Â  Â cores = []
â€‹
 Â  Â  Â  Â <span class="hljs-keyword">for</span> node <span class="hljs-keyword">in</span> similar_nodes:
 Â  Â  Â  Â  Â  Â core_id = node[<span class="hljs-string">"id"</span>]
 Â  Â  Â  Â  Â  Â score = node[<span class="hljs-string">"score"</span>]
â€‹
 Â  Â  Â  Â  Â  Â subgraph = self.graph_store.get_subgraph(
 Â  Â  Â  Â  Â  Â  Â  Â center_id=core_id, depth=depth, center_status=center_status
 Â  Â  Â  Â  Â   )
â€‹
 Â  Â  Â  Â  Â  Â <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> subgraph[<span class="hljs-string">"core_node"</span>]:
 Â  Â  Â  Â  Â  Â  Â  Â logger.info(<span class="hljs-string">f"Skipping node <span class="hljs-subst">{core_id}</span> (inactive or not found)."</span>)
 Â  Â  Â  Â  Â  Â  Â  Â <span class="hljs-keyword">continue</span>
â€‹
 Â  Â  Â  Â  Â  Â core_node = subgraph[<span class="hljs-string">"core_node"</span>]
 Â  Â  Â  Â  Â  Â neighbors = subgraph[<span class="hljs-string">"neighbors"</span>]
 Â  Â  Â  Â  Â  Â edges = subgraph[<span class="hljs-string">"edges"</span>]
â€‹
 Â  Â  Â  Â  Â  Â <span class="hljs-comment"># Collect nodes</span>
 Â  Â  Â  Â  Â  Â all_nodes[core_node[<span class="hljs-string">"id"</span>]] = core_node
 Â  Â  Â  Â  Â  Â <span class="hljs-keyword">for</span> n <span class="hljs-keyword">in</span> neighbors:
 Â  Â  Â  Â  Â  Â  Â  Â all_nodes[n[<span class="hljs-string">"id"</span>]] = n
â€‹
 Â  Â  Â  Â  Â  Â <span class="hljs-comment"># Collect edges</span>
 Â  Â  Â  Â  Â  Â <span class="hljs-keyword">for</span> e <span class="hljs-keyword">in</span> edges:
 Â  Â  Â  Â  Â  Â  Â  Â all_edges.add((e[<span class="hljs-string">"source"</span>], e[<span class="hljs-string">"target"</span>], e[<span class="hljs-string">"type"</span>]))
â€‹
 Â  Â  Â  Â  Â  Â cores.append(
 Â  Â  Â  Â  Â  Â  Â   {<span class="hljs-string">"id"</span>: core_id, <span class="hljs-string">"score"</span>: score, <span class="hljs-string">"core_node"</span>: core_node, <span class="hljs-string">"neighbors"</span>: neighbors}
 Â  Â  Â  Â  Â   )
â€‹
 Â  Â  Â  Â top_core = cores[<span class="hljs-number">0</span>]
 Â  Â  Â  Â <span class="hljs-keyword">return</span> {
 Â  Â  Â  Â  Â  Â <span class="hljs-string">"core_id"</span>: top_core[<span class="hljs-string">"id"</span>],
 Â  Â  Â  Â  Â  Â <span class="hljs-string">"nodes"</span>: <span class="hljs-built_in">list</span>(all_nodes.values()),
 Â  Â  Â  Â  Â  Â <span class="hljs-string">"edges"</span>: [{<span class="hljs-string">"source"</span>: f, <span class="hljs-string">"target"</span>: t, <span class="hljs-string">"type"</span>: ty} <span class="hljs-keyword">for</span> (f, t, ty) <span class="hljs-keyword">in</span> all_edges],
 Â  Â  Â   }
</code></pre>
<h3 data-id="heading-41">0x04 å›¾æ•°æ®åº“</h3>
<p>å› ä¸ºå›¾æ•°æ®åº“æ¯”è¾ƒå¤æ‚ï¼Œæˆ‘ä»¬é€šè¿‡ç¤ºä¾‹æ¥è¿›è¡Œå­¦ä¹ ï¼Œä»¥ç®¡çª¥è±¹ã€‚</p>
<h4 data-id="heading-42">4.1 ç¤ºä¾‹</h4>
<p>run_user_session å‡½æ•°ä¸­ä¾¿æœ‰æœç´¢å†…å®¹ã€‚</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">run_user_session</span>(<span class="hljs-params">
 Â  Â user_name: <span class="hljs-built_in">str</span>,
 Â  Â db_name: <span class="hljs-built_in">str</span>,
 Â  Â topic_text: <span class="hljs-built_in">str</span>,
 Â  Â concept_texts: <span class="hljs-built_in">list</span>[<span class="hljs-built_in">str</span>],
 Â  Â fact_texts: <span class="hljs-built_in">list</span>[<span class="hljs-built_in">str</span>],
</span>):
 Â  Â <span class="hljs-built_in">print</span>(<span class="hljs-string">f"\n=== <span class="hljs-subst">{user_name}</span> starts building their memory graph ==="</span>)
â€‹
 Â  Â <span class="hljs-comment"># Manually initialize correct GraphDB class</span>
 Â  Â config = GraphDBConfigFactory(
 Â  Â  Â  Â backend=<span class="hljs-string">"nebular"</span>,
 Â  Â  Â  Â config={
 Â  Â  Â  Â  Â  Â <span class="hljs-string">"uri"</span>: json.loads(os.getenv(<span class="hljs-string">"NEBULAR_HOSTS"</span>, <span class="hljs-string">"localhost"</span>)),
 Â  Â  Â  Â  Â  Â <span class="hljs-string">"user"</span>: os.getenv(<span class="hljs-string">"NEBULAR_USER"</span>, <span class="hljs-string">"root"</span>),
 Â  Â  Â  Â  Â  Â <span class="hljs-string">"password"</span>: os.getenv(<span class="hljs-string">"NEBULAR_PASSWORD"</span>, <span class="hljs-string">"xxxxxx"</span>),
 Â  Â  Â  Â  Â  Â <span class="hljs-string">"space"</span>: db_name,
 Â  Â  Â  Â  Â  Â <span class="hljs-string">"user_name"</span>: user_name,
 Â  Â  Â  Â  Â  Â <span class="hljs-string">"use_multi_db"</span>: <span class="hljs-literal">False</span>,
 Â  Â  Â  Â  Â  Â <span class="hljs-string">"auto_create"</span>: <span class="hljs-literal">True</span>,
 Â  Â  Â  Â  Â  Â <span class="hljs-string">"embedding_dimension"</span>: embedder_dimension,
 Â  Â  Â   },
 Â   )
 Â  Â graph = GraphStoreFactory.from_config(config)
â€‹
 Â  Â <span class="hljs-comment"># Start with a clean slate for this user</span>
 Â  Â graph.clear()
â€‹
 Â  Â now = datetime.now(timezone.utc).isoformat()
â€‹
 Â  Â <span class="hljs-comment"># === Step 1: Create a root topic node (e.g., user's research focus) ===</span>
 Â  Â topic = TextualMemoryItem(
 Â  Â  Â  Â memory=topic_text,
 Â  Â  Â  Â metadata=TreeNodeTextualMemoryMetadata(
 Â  Â  Â  Â  Â  Â memory_type=<span class="hljs-string">"LongTermMemory"</span>,
 Â  Â  Â  Â  Â  Â key=<span class="hljs-string">"Research Topic"</span>,
 Â  Â  Â  Â  Â  Â hierarchy_level=<span class="hljs-string">"topic"</span>,
 Â  Â  Â  Â  Â  Â <span class="hljs-built_in">type</span>=<span class="hljs-string">"fact"</span>,
 Â  Â  Â  Â  Â  Â memory_time=<span class="hljs-string">"2024-01-01"</span>,
 Â  Â  Â  Â  Â  Â status=<span class="hljs-string">"activated"</span>,
 Â  Â  Â  Â  Â  Â visibility=<span class="hljs-string">"public"</span>,
 Â  Â  Â  Â  Â  Â tags=[<span class="hljs-string">"research"</span>, <span class="hljs-string">"rl"</span>],
 Â  Â  Â  Â  Â  Â updated_at=now,
 Â  Â  Â  Â  Â  Â embedding=embed_memory_item(topic_text),
 Â  Â  Â   ),
 Â   )
 Â  Â graph.add_node(topic.<span class="hljs-built_in">id</span>, topic.memory, topic.metadata.model_dump(exclude_none=<span class="hljs-literal">True</span>))
â€‹
 Â  Â <span class="hljs-comment"># === Step 2: Create two concept nodes linked to the topic ===</span>
 Â  Â concept_items = []
 Â  Â <span class="hljs-keyword">for</span> i, text <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(concept_texts):
 Â  Â  Â  Â concept = TextualMemoryItem(
 Â  Â  Â  Â  Â  Â memory=text,
 Â  Â  Â  Â  Â  Â metadata=TreeNodeTextualMemoryMetadata(
 Â  Â  Â  Â  Â  Â  Â  Â memory_type=<span class="hljs-string">"LongTermMemory"</span>,
 Â  Â  Â  Â  Â  Â  Â  Â key=<span class="hljs-string">f"Concept <span class="hljs-subst">{i + <span class="hljs-number">1</span>}</span>"</span>,
 Â  Â  Â  Â  Â  Â  Â  Â hierarchy_level=<span class="hljs-string">"concept"</span>,
 Â  Â  Â  Â  Â  Â  Â  Â <span class="hljs-built_in">type</span>=<span class="hljs-string">"fact"</span>,
 Â  Â  Â  Â  Â  Â  Â  Â memory_time=<span class="hljs-string">"2024-01-01"</span>,
 Â  Â  Â  Â  Â  Â  Â  Â status=<span class="hljs-string">"activated"</span>,
 Â  Â  Â  Â  Â  Â  Â  Â visibility=<span class="hljs-string">"public"</span>,
 Â  Â  Â  Â  Â  Â  Â  Â updated_at=now,
 Â  Â  Â  Â  Â  Â  Â  Â embedding=embed_memory_item(text),
 Â  Â  Â  Â  Â  Â  Â  Â tags=[<span class="hljs-string">"concept"</span>],
 Â  Â  Â  Â  Â  Â  Â  Â confidence=<span class="hljs-number">90</span> + i,
 Â  Â  Â  Â  Â   ),
 Â  Â  Â   )
 Â  Â  Â  Â graph.add_node(concept.<span class="hljs-built_in">id</span>, concept.memory, concept.metadata.model_dump(exclude_none=<span class="hljs-literal">True</span>))
 Â  Â  Â  Â graph.add_edge(topic.<span class="hljs-built_in">id</span>, concept.<span class="hljs-built_in">id</span>, <span class="hljs-built_in">type</span>=<span class="hljs-string">"PARENT"</span>)
 Â  Â  Â  Â concept_items.append(concept)
â€‹
 Â  Â <span class="hljs-comment"># === Step 3: Create supporting facts under each concept ===</span>
 Â  Â <span class="hljs-keyword">for</span> i, text <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(fact_texts):
 Â  Â  Â  Â fact = TextualMemoryItem(
 Â  Â  Â  Â  Â  Â memory=text,
 Â  Â  Â  Â  Â  Â metadata=TreeNodeTextualMemoryMetadata(
 Â  Â  Â  Â  Â  Â  Â  Â memory_type=<span class="hljs-string">"WorkingMemory"</span>,
 Â  Â  Â  Â  Â  Â  Â  Â key=<span class="hljs-string">f"Fact <span class="hljs-subst">{i + <span class="hljs-number">1</span>}</span>"</span>,
 Â  Â  Â  Â  Â  Â  Â  Â hierarchy_level=<span class="hljs-string">"fact"</span>,
 Â  Â  Â  Â  Â  Â  Â  Â <span class="hljs-built_in">type</span>=<span class="hljs-string">"fact"</span>,
 Â  Â  Â  Â  Â  Â  Â  Â memory_time=<span class="hljs-string">"2024-01-01"</span>,
 Â  Â  Â  Â  Â  Â  Â  Â status=<span class="hljs-string">"activated"</span>,
 Â  Â  Â  Â  Â  Â  Â  Â visibility=<span class="hljs-string">"public"</span>,
 Â  Â  Â  Â  Â  Â  Â  Â updated_at=now,
 Â  Â  Â  Â  Â  Â  Â  Â embedding=embed_memory_item(text),
 Â  Â  Â  Â  Â  Â  Â  Â confidence=<span class="hljs-number">85.0</span>,
 Â  Â  Â  Â  Â  Â  Â  Â tags=[<span class="hljs-string">"fact"</span>],
 Â  Â  Â  Â  Â   ),
 Â  Â  Â   )
 Â  Â  Â  Â graph.add_node(fact.<span class="hljs-built_in">id</span>, fact.memory, fact.metadata.model_dump(exclude_none=<span class="hljs-literal">True</span>))
 Â  Â  Â  Â graph.add_edge(concept_items[i % <span class="hljs-built_in">len</span>(concept_items)].<span class="hljs-built_in">id</span>, fact.<span class="hljs-built_in">id</span>, <span class="hljs-built_in">type</span>=<span class="hljs-string">"PARENT"</span>)
â€‹
 Â  Â <span class="hljs-comment"># === Step 4: Retrieve memory using semantic search ===</span>
 Â  Â vector = embed_memory_item(<span class="hljs-string">"How is memory retrieved?"</span>)
 Â  Â search_result = graph.search_by_embedding(vector, top_k=<span class="hljs-number">2</span>)
 Â  Â <span class="hljs-keyword">for</span> r <span class="hljs-keyword">in</span> search_result:
 Â  Â  Â  Â node = graph.get_node(r[<span class="hljs-string">"id"</span>])
 Â  Â  Â  Â <span class="hljs-built_in">print</span>(<span class="hljs-string">"ğŸ” Search result:"</span>, node[<span class="hljs-string">"memory"</span>])
â€‹
 Â  Â <span class="hljs-comment"># === Step 5: Tag-based neighborhood discovery ===</span>
 Â  Â neighbors = graph.get_neighbors_by_tag([<span class="hljs-string">"concept"</span>], exclude_ids=[], top_k=<span class="hljs-number">2</span>)
 Â  Â <span class="hljs-built_in">print</span>(<span class="hljs-string">"ğŸ“ Tag-related nodes:"</span>, [neighbor[<span class="hljs-string">"memory"</span>] <span class="hljs-keyword">for</span> neighbor <span class="hljs-keyword">in</span> neighbors])
â€‹
 Â  Â <span class="hljs-comment"># === Step 6: Retrieve children (facts) of first concept ===</span>
 Â  Â children = graph.get_children_with_embeddings(concept_items[<span class="hljs-number">0</span>].<span class="hljs-built_in">id</span>)
 Â  Â <span class="hljs-built_in">print</span>(<span class="hljs-string">"ğŸ“ Children of concept:"</span>, [child[<span class="hljs-string">"memory"</span>] <span class="hljs-keyword">for</span> child <span class="hljs-keyword">in</span> children])
â€‹
 Â  Â <span class="hljs-comment"># === Step 7: Export a local subgraph and grouped statistics ===</span>
 Â  Â subgraph = graph.get_subgraph(topic.<span class="hljs-built_in">id</span>, depth=<span class="hljs-number">2</span>)
 Â  Â <span class="hljs-built_in">print</span>(<span class="hljs-string">"ğŸ“Œ Subgraph node count:"</span>, <span class="hljs-built_in">len</span>(subgraph[<span class="hljs-string">"neighbors"</span>]))
â€‹
 Â  Â stats = graph.get_grouped_counts([<span class="hljs-string">"memory_type"</span>, <span class="hljs-string">"status"</span>])
 Â  Â <span class="hljs-built_in">print</span>(<span class="hljs-string">"ğŸ“Š Grouped counts:"</span>, stats)
â€‹
 Â  Â <span class="hljs-comment"># === Step 8: Demonstrate updates and cleanup ===</span>
 Â  Â graph.update_node(
 Â  Â  Â  Â concept_items[<span class="hljs-number">0</span>].<span class="hljs-built_in">id</span>, {<span class="hljs-string">"confidence"</span>: <span class="hljs-number">99.0</span>, <span class="hljs-string">"created_at"</span>: <span class="hljs-string">"2025-07-24T20:11:56.375687"</span>}
 Â   )
 Â  Â graph.remove_oldest_memory(<span class="hljs-string">"WorkingMemory"</span>, keep_latest=<span class="hljs-number">1</span>)
 Â  Â graph.delete_edge(topic.<span class="hljs-built_in">id</span>, concept_items[<span class="hljs-number">0</span>].<span class="hljs-built_in">id</span>, <span class="hljs-built_in">type</span>=<span class="hljs-string">"PARENT"</span>)
 Â  Â graph.delete_node(concept_items[<span class="hljs-number">1</span>].<span class="hljs-built_in">id</span>)
â€‹
 Â  Â <span class="hljs-comment"># === Step 9: Export and re-import the entire graph structure ===</span>
 Â  Â exported = graph.export_graph()
 Â  Â graph.import_graph(exported)
 Â  Â <span class="hljs-built_in">print</span>(<span class="hljs-string">"ğŸ“¦ Graph exported and re-imported, total nodes:"</span>, <span class="hljs-built_in">len</span>(exported[<span class="hljs-string">"nodes"</span>]))
â€‹
 Â  Â <span class="hljs-comment"># ====================================</span>
 Â  Â <span class="hljs-comment"># ğŸ” Step 10: extra function</span>
 Â  Â <span class="hljs-comment"># ====================================</span>
 Â  Â <span class="hljs-built_in">print</span>(<span class="hljs-string">f"\n=== ğŸ” Extra Tests for user: <span class="hljs-subst">{user_name}</span> ==="</span>)
â€‹
 Â  Â <span class="hljs-built_in">print</span>(<span class="hljs-string">" - Memory count:"</span>, graph.get_memory_count(<span class="hljs-string">"LongTermMemory"</span>))
 Â  Â <span class="hljs-built_in">print</span>(<span class="hljs-string">" - Node count:"</span>, graph.count_nodes(<span class="hljs-string">"LongTermMemory"</span>))
 Â  Â <span class="hljs-built_in">print</span>(<span class="hljs-string">" - All LongTermMemory items:"</span>, graph.get_all_memory_items(<span class="hljs-string">"LongTermMemory"</span>))
â€‹
 Â  Â <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(exported[<span class="hljs-string">"edges"</span>]) &gt; <span class="hljs-number">0</span>:
 Â  Â  Â  Â n1, n2 = exported[<span class="hljs-string">"edges"</span>][<span class="hljs-number">0</span>][<span class="hljs-string">"source"</span>], exported[<span class="hljs-string">"edges"</span>][<span class="hljs-number">0</span>][<span class="hljs-string">"target"</span>]
 Â  Â  Â  Â <span class="hljs-built_in">print</span>(<span class="hljs-string">" - Edge exists?"</span>, graph.edge_exists(n1, n2, exported[<span class="hljs-string">"edges"</span>][<span class="hljs-number">0</span>][<span class="hljs-string">"type"</span>]))
 Â  Â  Â  Â <span class="hljs-built_in">print</span>(<span class="hljs-string">" - Edges for node:"</span>, graph.get_edges(n1))
â€‹
 Â  Â filters = [{<span class="hljs-string">"field"</span>: <span class="hljs-string">"memory_type"</span>, <span class="hljs-string">"op"</span>: <span class="hljs-string">"="</span>, <span class="hljs-string">"value"</span>: <span class="hljs-string">"LongTermMemory"</span>}]
 Â  Â <span class="hljs-built_in">print</span>(<span class="hljs-string">" - Metadata query result:"</span>, graph.get_by_metadata(filters))
 Â  Â <span class="hljs-built_in">print</span>(
 Â  Â  Â  Â <span class="hljs-string">" - Optimization candidates:"</span>, graph.get_structure_optimization_candidates(<span class="hljs-string">"LongTermMemory"</span>)
 Â   )
 Â  Â <span class="hljs-keyword">try</span>:
 Â  Â  Â  Â graph.drop_database()
 Â  Â <span class="hljs-keyword">except</span> ValueError <span class="hljs-keyword">as</span> e:
 Â  Â  Â  Â <span class="hljs-built_in">print</span>(<span class="hljs-string">" - drop_database raised ValueError as expected:"</span>, e)
</code></pre>
<h4 data-id="heading-43">4.2 get_neighbors_by_tag</h4>
<p>get_neighbors_by_tag åŠŸèƒ½è¯´æ˜å¦‚ä¸‹ï¼š</p>
<h5 data-id="heading-44">4.2.1 åŠŸèƒ½æ¦‚è¿°</h5>
<p>get_neighbors_by_tag æ˜¯åŸºäºæ ‡ç­¾çš„é‚»å±…èŠ‚ç‚¹æ£€ç´¢æ–¹æ³•ï¼Œç”¨äºåœ¨å›¾æ•°æ®åº“ä¸­æŸ¥æ‰¾ä¸ç»™å®šèŠ‚ç‚¹å…·æœ‰ç›¸ä¼¼æ ‡ç­¾çš„ç›¸é‚»èŠ‚ç‚¹ã€‚é€šè¿‡è®¡ç®—æ ‡ç­¾é‡å åº¦è¯†åˆ«è¯­ä¹‰ç›¸å…³èŠ‚ç‚¹ï¼Œæ”¯æŒåŸºäºæ ‡ç­¾çš„å›¾éå†ä¸æ¨èã€‚</p>
<h5 data-id="heading-45">4.2.2 åº”ç”¨åœºæ™¯</h5>
<p>è®°å¿†é‡ç»„é˜¶æ®µå‘ç°å…·æœ‰å…±åŒä¸»é¢˜æˆ–æ¦‚å¿µçš„ç›¸å…³è®°å¿†èŠ‚ç‚¹ã€‚</p>
<p>æ”¯æŒæ¨ç†ä¸å…³è”åˆ†æï¼Œæ„å»ºè®°å¿†ä¹‹é—´çš„è¯­ä¹‰è¿æ¥ã€‚</p>
<p>ç”¨äºèšç±»åˆ†æï¼Œè¯†åˆ«æ ‡ç­¾ç»„åˆç›¸ä¼¼çš„èŠ‚ç‚¹ç¾¤ç»„ã€‚</p>
<h5 data-id="heading-46">4.2.3 å‚æ•°è¯´æ˜</h5>
<ul>
<li>tags (list[str])ï¼šç›®æ ‡æ ‡ç­¾åˆ—è¡¨ï¼Œç”¨äºåŒ¹é…ç›¸ä¼¼èŠ‚ç‚¹ã€‚</li>
<li>_exclude_ids (list[str])ï¼šéœ€æ’é™¤çš„èŠ‚ç‚¹ ID åˆ—è¡¨ï¼Œé¿å…è¿”å›è‡ªèº«æˆ–å·²çŸ¥èŠ‚ç‚¹ã€‚</li>
<li>top_k (int)ï¼šè¿”å›ç»“æœæ•°é‡ä¸Šé™ï¼Œé»˜è®¤é€šå¸¸ä¸º 5ã€‚</li>
<li>min_overlap (int)ï¼šæœ€å°æ ‡ç­¾é‡å æ•°ï¼Œä»…è¿”å›æ»¡è¶³è¯¥æ¡ä»¶çš„èŠ‚ç‚¹ã€‚</li>
</ul>
<h5 data-id="heading-47">4.2.4 ç­›é€‰æœºåˆ¶</h5>
<ul>
<li>æ ‡ç­¾äº¤é›†è®¡ç®—ï¼šæ¯”è¾ƒç›®æ ‡æ ‡ç­¾ä¸å€™é€‰èŠ‚ç‚¹æ ‡ç­¾çš„äº¤é›†å¤§å°ç¡®å®šç›¸å…³æ€§ã€‚</li>
<li>æœ€å°é‡å é˜ˆå€¼ï¼šä»…è¿”å›æ ‡ç­¾é‡å æ•°â‰¥min_overlap çš„èŠ‚ç‚¹ã€‚</li>
<li>æ’é™¤æœºåˆ¶ï¼šè¿‡æ»¤ _exclude_ids æŒ‡å®šçš„èŠ‚ç‚¹ï¼Œé˜²æ­¢å¾ªç¯å¼•ç”¨ã€‚</li>
</ul>
<h5 data-id="heading-48">4.2.5 æ£€ç´¢æµç¨‹</h5>
<ul>
<li>æ ¹æ®è¾“å…¥æ ‡ç­¾åœ¨å›¾æ•°æ®åº“ä¸­æŸ¥æ‰¾åŒ…å«è¿™äº›æ ‡ç­¾çš„æ‰€æœ‰èŠ‚ç‚¹ã€‚</li>
<li>è®¡ç®—æ¯ä¸ªå€™é€‰èŠ‚ç‚¹ä¸ç›®æ ‡æ ‡ç­¾é›†åˆçš„äº¤é›†å¤§å°ã€‚</li>
<li>è¿‡æ»¤ä¸æ»¡è¶³æœ€å°é‡å è¦æ±‚çš„èŠ‚ç‚¹ã€‚</li>
<li>æŒ‰æ ‡ç­¾é‡å ç¨‹åº¦æ’åºå¹¶æˆªå–å‰ k ä¸ªèŠ‚ç‚¹ã€‚</li>
</ul>
<h5 data-id="heading-49">4.2.6 æ€§èƒ½ä¼˜åŒ–</h5>
<ul>
<li>åˆ©ç”¨å›¾æ•°æ®åº“ç´¢å¼•åŠ é€Ÿæ ‡ç­¾æŸ¥è¯¢ã€‚</li>
<li>é€šè¿‡æ‰¹é‡æ“ä½œå‡å°‘æ•°æ®åº“è®¿é—®æ¬¡æ•°ã€‚</li>
<li>æ”¯æŒå¹¶å‘æ‰§è¡Œï¼Œæé«˜å¤§è§„æ¨¡å›¾æ£€ç´¢æ•ˆç‡ã€‚</li>
</ul>
<p>MemOS-main\src\memos\graph_dbs\nebular.py ä»£ç å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-less" lang="less"> Â  Â <span class="hljs-variable">@timed</span>
 Â  Â def <span class="hljs-built_in">get_neighbors_by_tag</span>(
 Â  Â  Â  Â self,
 Â  Â  Â  Â <span class="hljs-attribute">tags</span>: list[str],
 Â  Â  Â  Â <span class="hljs-attribute">exclude_ids</span>: list[str],
 Â  Â  Â  Â <span class="hljs-attribute">top_k</span>: int = <span class="hljs-number">5</span>,
 Â  Â  Â  Â <span class="hljs-attribute">min_overlap</span>: int = <span class="hljs-number">1</span>,
 Â  Â  Â  Â <span class="hljs-attribute">include_embedding</span>: bool = False,
 Â   ) -&gt; list[dict[str, Any]]:
 Â  Â  Â  Â <span class="hljs-string">""</span>"
 Â  Â  Â   Find top-K neighbor nodes with maximum tag overlap.
â€‹
 Â  Â  Â   <span class="hljs-attribute">Args</span>:
 Â  Â  Â  Â  Â   <span class="hljs-attribute">tags</span>: The list of tags to match.
 Â  Â  Â  Â  Â   <span class="hljs-attribute">exclude_ids</span>: Node IDs to exclude (e.g., local cluster).
 Â  Â  Â  Â  Â   <span class="hljs-attribute">top_k</span>: Max number of neighbors to return.
 Â  Â  Â  Â  Â   <span class="hljs-attribute">min_overlap</span>: Minimum number of overlapping tags required.
 Â  Â  Â  Â  Â   <span class="hljs-attribute">include_embedding</span>: with/without embedding
â€‹
 Â  Â  Â   <span class="hljs-attribute">Returns</span>:
 Â  Â  Â  Â  Â   List of dicts with node details <span class="hljs-keyword">and</span> overlap count.
 Â  Â  Â   <span class="hljs-string">""</span>"
 Â  Â  Â  Â if <span class="hljs-keyword">not</span> <span class="hljs-attribute">tags</span>:
 Â  Â  Â  Â  Â  Â return []
â€‹
 Â  Â  Â  Â where_clauses = [
 Â  Â  Â  Â  Â  Â <span class="hljs-string">'n.status = "activated"'</span>,
 Â  Â  Â  Â  Â  Â <span class="hljs-string">'NOT (n.node_type = "reasoning")'</span>,
 Â  Â  Â  Â  Â  Â <span class="hljs-string">'NOT (n.memory_type = "WorkingMemory")'</span>,
 Â  Â  Â   ]
 Â  Â  Â  Â if <span class="hljs-attribute">exclude_ids</span>:
 Â  Â  Â  Â  Â  Â where_clauses.<span class="hljs-built_in">append</span>(f<span class="hljs-string">"NOT (n.id IN {exclude_ids})"</span>)
â€‹
 Â  Â  Â  Â where_clauses.<span class="hljs-built_in">append</span>(f<span class="hljs-string">'n.user_name = "{self.config.user_name}"'</span>)
â€‹
 Â  Â  Â  Â where_clause = <span class="hljs-string">" AND "</span>.<span class="hljs-built_in">join</span>(where_clauses)
 Â  Â  Â  Â tag_list_literal = <span class="hljs-string">"["</span> + <span class="hljs-string">", "</span>.<span class="hljs-built_in">join</span>(f<span class="hljs-string">'"{_escape_str(t)}"'</span> for t in tags) + <span class="hljs-string">"]"</span>
â€‹
 Â  Â  Â  Â return_fields = self.<span class="hljs-built_in">_build_return_fields</span>(include_embedding)
 Â  Â  Â  Â query = f<span class="hljs-string">""</span>"
 Â  Â  Â  Â  Â   LET tag_list = {<span class="hljs-selector-tag">tag_list_literal</span>}
â€‹
 Â  Â  Â  Â  Â   <span class="hljs-selector-tag">MATCH</span> (n<span class="hljs-variable">@Memory</span> <span class="hljs-comment">/*+ INDEX(idx_memory_user_name) */</span>)
 Â  Â  Â  Â  Â   <span class="hljs-selector-tag">WHERE</span> {<span class="hljs-selector-tag">where_clause</span>}
 Â  Â  Â  Â  Â   <span class="hljs-selector-tag">RETURN</span> {<span class="hljs-selector-tag">return_fields</span>},
 Â  Â  Â  Â  Â  Â  Â  <span class="hljs-selector-tag">size</span>( <span class="hljs-built_in">filter</span>( n.tags, t -&gt; t IN tag_list ) ) <span class="hljs-selector-tag">AS</span> <span class="hljs-selector-tag">overlap_count</span>
 Â  Â  Â  Â  Â   <span class="hljs-selector-tag">ORDER</span> <span class="hljs-selector-tag">BY</span> <span class="hljs-selector-tag">overlap_count</span> <span class="hljs-selector-tag">DESC</span>
 Â  Â  Â  Â  Â   <span class="hljs-selector-tag">LIMIT</span> {<span class="hljs-selector-tag">top_k</span>}
 Â  Â  Â  Â  Â   """
â€‹
 Â  Â  Â  Â <span class="hljs-selector-tag">result</span> = <span class="hljs-selector-tag">self</span><span class="hljs-selector-class">.execute_query</span>(query)
 Â  Â  Â  Â <span class="hljs-selector-tag">neighbors</span>: <span class="hljs-selector-tag">list</span><span class="hljs-selector-attr">[dict[str, Any]</span>] = <span class="hljs-selector-attr">[]</span>
 Â  Â  Â  Â <span class="hljs-selector-tag">for</span> <span class="hljs-selector-tag">r</span> <span class="hljs-selector-tag">in</span> <span class="hljs-selector-tag">result</span>:
 Â  Â  Â  Â  Â  Â <span class="hljs-selector-tag">props</span> = {k: v.value for k, v in r.items() if k != "overlap_count"}
 Â  Â  Â  Â  Â  Â <span class="hljs-selector-tag">parsed</span> = <span class="hljs-selector-tag">self</span><span class="hljs-selector-class">._parse_node</span>(props)
 Â  Â  Â  Â  Â  Â <span class="hljs-selector-tag">parsed</span><span class="hljs-selector-attr">[<span class="hljs-string">"overlap_count"</span>]</span> = <span class="hljs-selector-tag">r</span><span class="hljs-selector-attr">[<span class="hljs-string">"overlap_count"</span>]</span><span class="hljs-selector-class">.value</span>
 Â  Â  Â  Â  Â  Â <span class="hljs-selector-tag">neighbors</span><span class="hljs-selector-class">.append</span>(parsed)
â€‹
 Â  Â  Â  Â <span class="hljs-selector-tag">neighbors</span><span class="hljs-selector-class">.sort</span>(key=lambda <span class="hljs-attribute">x</span>: x[<span class="hljs-string">"overlap_count"</span>], reverse=True)
 Â  Â  Â  Â <span class="hljs-selector-tag">neighbors</span> = <span class="hljs-selector-tag">neighbors</span><span class="hljs-selector-attr">[:top_k]</span>
 Â  Â  Â  Â <span class="hljs-selector-tag">result</span> = <span class="hljs-selector-attr">[]</span>
 Â  Â  Â  Â <span class="hljs-selector-tag">for</span> <span class="hljs-selector-tag">neighbor</span> <span class="hljs-selector-tag">in</span> <span class="hljs-selector-tag">neighbors</span><span class="hljs-selector-attr">[:top_k]</span>:
 Â  Â  Â  Â  Â  Â <span class="hljs-selector-tag">neighbor</span><span class="hljs-selector-class">.pop</span>(<span class="hljs-string">"overlap_count"</span>)
 Â  Â  Â  Â  Â  Â <span class="hljs-selector-tag">result</span><span class="hljs-selector-class">.append</span>(neighbor)
 Â  Â  Â  Â <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">result</span>
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ä¸è°ˆæŠ€æœ¯ï¼Œæç‚¹æ–‡åŒ– ğŸ§€ â€”â€” ä»å¤æ´»ä¸€å¥æ˜ä»£æ®‹è¯—ç ´å±€äº§å“è¿­ä»£]]></title>    <link>https://juejin.cn/post/7581299982671069218</link>    <guid>https://juejin.cn/post/7581299982671069218</guid>    <pubDate>2025-12-08T12:54:02.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581299982671069218" data-draft-id="7581306080434618419" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ä¸è°ˆæŠ€æœ¯ï¼Œæç‚¹æ–‡åŒ– ğŸ§€  â€”â€”  ä»å¤æ´»ä¸€å¥æ˜ä»£æ®‹è¯—ç ´å±€äº§å“è¿­ä»£"/> <meta itemprop="keywords" content="å‰ç«¯,åç«¯,äººå·¥æ™ºèƒ½"/> <meta itemprop="datePublished" content="2025-12-08T12:54:02.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="HiStewie"/> <meta itemprop="url" content="https://juejin.cn/user/1591748568038823"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ä¸è°ˆæŠ€æœ¯ï¼Œæç‚¹æ–‡åŒ– ğŸ§€  â€”â€”  ä»å¤æ´»ä¸€å¥æ˜ä»£æ®‹è¯—ç ´å±€äº§å“è¿­ä»£
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1591748568038823/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    HiStewie
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-08T12:54:02.000Z" title="Mon Dec 08 2025 12:54:02 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»7åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{line-height:1.75;font-family:-apple-system-font,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei UI,Microsoft YaHei,Arial,sans-serif;letter-spacing:2px;background-image:linear-gradient(90deg,rgba(50,0,0,.05) 3%,transparent 0),linear-gradient(1turn,rgba(50,0,0,.05) 3%,transparent 0);background-size:20px 20px;background-position:50%;word-break:break-word;font-weight:400;font-size:15px;overflow-x:hidden;color:#333}.markdown-body h1{font-size:23px;margin-bottom:5px;font-weight:700;padding-left:10px;border-left:5px solid #773098}.markdown-body h2{font-size:19px;font-weight:700;padding-left:10px;border-left:5px solid #916dd5}.markdown-body h3{font-size:17px;font-weight:700;padding-left:10px;border-left:5px solid #d89cf6}.markdown-body h4{font-size:16px}.markdown-body h5{font-size:15px}.markdown-body h6{font-size:14px;margin-top:5px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{display:block;max-width:100%;margin:1em 0;border-radius:6px;box-shadow:2px 4px 7px #999;user-select:none}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{padding:.2em .5em;font-weight:700;font-family:-apple-system-font,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei UI,Microsoft YaHei,Arial,sans-serif;font-size:1em;color:#916dd5;word-break:break-word;overflow-x:auto;background-color:none;border-radius:2px}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{display:block;font-family:-apple-system-font,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei UI,Microsoft YaHei,Arial,sans-serif;font-weight:400;font-size:.9em;padding:16px 12px;margin:0;color:#333;word-break:normal;overflow-x:auto;background:#f8f8f8;scroll-behavior:smooth}.markdown-body a{text-decoration:none;color:#916dd5;font-weight:700;border-bottom:1px solid #916dd5}.markdown-body a:active,.markdown-body a:hover{color:#773098}.markdown-body table{display:inline-block!important;font-size:14px;width:auto;max-width:100%;overflow:auto;border:1px solid #916dd5;border-collapse:collapse}.markdown-body thead{background-color:#916dd5;color:#fff;text-align:left}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px;border:1px solid #916dd5}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #d89cf6;background-color:#f4eeff}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0;line-height:26px}.markdown-body ol,.markdown-body ul{padding-left:28px;list-style-type:circle}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body b,.markdown-body strong{color:#916dd5;font-weight:700}.markdown-body b:before,.markdown-body strong:before{content:"ã€Œ"}.markdown-body b:after,.markdown-body strong:after{content:"ã€"}.markdown-body em,.markdown-body i{color:#916dd5}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="agate">.markdown-body pre,.markdown-body pre&gt;code.hljs{background:#333;color:#fff}.hljs-name,.hljs-strong{font-weight:700}.hljs-code,.hljs-emphasis{font-style:italic}.hljs-tag{color:#62c8f3}.hljs-selector-class,.hljs-selector-id,.hljs-template-variable,.hljs-variable{color:#ade5fc}.hljs-bullet,.hljs-string{color:#a2fca2}.hljs-attribute,.hljs-built_in,.hljs-builtin-name,.hljs-quote,.hljs-section,.hljs-title,.hljs-type{color:#ffa}.hljs-bullet,.hljs-number,.hljs-symbol{color:#d36363}.hljs-keyword,.hljs-literal,.hljs-selector-tag{color:#fcc28c}.hljs-code,.hljs-comment,.hljs-deletion{color:#888}.hljs-link,.hljs-regexp{color:#c6b4f0}.hljs-meta{color:#fc9b9b}.hljs-deletion{background-color:#fc9b9b;color:#333}.hljs-addition{background-color:#a2fca2;color:#333}.hljs a{color:inherit}.hljs a:focus,.hljs a:hover{color:inherit;text-decoration:underline}</style><p>ä¸Šä¸€ç¯‡æ–‡ç« ï¼š<a href="https://juejin.cn/post/7577653509862654002" target="_blank" title="https://juejin.cn/post/7577653509862654002">3å¤©ï¼Œ1äººï¼Œä»0åˆ°ä»˜è´¹äº§å“ï¼šAIæ—¶ä»£ä¸ªäººå¼€å‘è€…çš„ç”Ÿå­˜æŒ‡å—</a>ï¼Œè®²è§£äº†å¦‚ä½•ä»æŠ€æœ¯å±‚é¢ï¼Œä¸ªäººå¼€å‘ä»å‰åˆ°åï¼Œä»äº§å“åˆ°è®¾è®¡ï¼Œä»ä¼šè®¡åˆ°ä¿å®‰çš„å¼€å‘é—­ç¯å•†ä¸šäº§å“ã€‚è¿™ç¯‡ä¸»è¦è®²å¦‚ä½•è¿­ä»£é¡¹ç›®ï¼Œä¸°å¯Œå†…æ ¸ï¼Œæ­å»º <strong>Content is King</strong> äº§å“æ€è·¯</p>
<h2 data-id="heading-0">00ï½œå¼•è¨€ï¼šå½“ç¨‹åºå‘˜å¼€å§‹å†™è¯—</h2>
<p>æœ€è¿‘åœ¨åšç”Ÿå›¾äº§å“ <strong><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.nthme.org%2F" target="_blank" title="https://www.nthme.org/" ref="nofollow noopener noreferrer">The Nth Me</a></strong> çš„è¿­ä»£æ„æ€æ—¶ï¼Œæˆ‘é™·å…¥äº†ä¸€ä¸ªæ€è€ƒï¼š</p>
<ul>
<li><strong>æˆ‘åš AI äº§å“çš„ç»ˆæç›®çš„æ˜¯ä»€ä¹ˆï¼Ÿ</strong></li>
</ul>
<p>æ˜¯æ›´å¿«çš„æ¨ç†é€Ÿåº¦ï¼Ÿè¿˜æ˜¯æ›´ä½çš„æ˜¾å­˜å ç”¨ï¼Ÿæ›´ä¾¿å®œçš„å®šä»·ï¼Ÿæ›´å¥½çš„ç”¨æˆ·ä½“éªŒï¼Ÿ</p>
<p>é‚£å¦‚ä½•æ‰èƒ½åœ¨åŒè´¨åŒ–çš„å¥—å£³äº§å“ä¸­è„±é¢–è€Œå‡ºï¼Ÿ</p>
<ul>
<li>æ˜¯ï¼š<strong>â€œèµ‹èƒ½è¡¨è¾¾ï¼ï¼ï¼â€</strong></li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c8fb892c7aa546c79fd335f7b0ee8ed5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSGlTdGV3aWU=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765803242&amp;x-signature=pNr31RJzwjrReJTyFXDMf0IyanA%3D" alt="æˆªå±2025-12-08 19.26.09.png" loading="lazy"/></p>
<p>å¶ç„¶è¯»åˆ°æ˜ä»£å¼ ç©†çš„ä¸€å¥è¯—ï¼š</p>
<blockquote>
<p>â€œä¸‡é‡Œç‹¬åŸè¿é›ªå»ï¼Œå¹³ç”Ÿä¸€å‰‘å¸¦éœœæºã€‚â€</p>
</blockquote>
<p>é‚£ç§å­¤ç‹¬ä¸å‚²éª¨ç¬é—´å‡»ä¸­äº†æˆ‘ã€‚æˆ‘å†³å®šæš‚æ—¶æ”¾ä¸‹ä»£ç ï¼Œç”¨ç°æœ‰çš„AIå·¥å…·é“¾ï¼Œè¯•å›¾å¤æ´»è¿™ä½300å¹´å‰çš„å‰‘å®¢ã€‚
åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œæˆ‘æ‘¸ç´¢å‡ºäº†ä¸€å¥— <strong>â€œæ–‡åŒ–é©±åŠ¨â€çš„å·¥ä½œæµ</strong>ï¼Œä¹Ÿè¸©äº†ä¸å°‘å‘ã€‚</p>
<p>è€Œè¿™äº›â€œå‘â€ï¼Œæ­£æ˜¯æˆ‘ä¸‹ä¸€æ­¥äº§å“è¿­ä»£çš„æ–¹å‘ã€‚</p>
<hr/>
<h2 data-id="heading-1">01ï½œå®Œæ•´å·¥ä½œæµæ‹†è§£ (SOP)</h2>
<h3 data-id="heading-2">1. ç‚¼å­—ï¼šå…ˆæœ‰éª¨ï¼Œå†æœ‰çš®</h3>
<p>AIç»˜ç”»æœ€æ€•â€œè¯ä¸è¾¾æ„â€ã€‚åœ¨ç”Ÿæˆç”»é¢å‰ï¼Œå¿…é¡»å…ˆæ‰“ç£¨æ„å¢ƒã€‚
åŸå¥è™½å¥½ï¼Œä½†ä¸ºäº†é…åˆç”»é¢å¼ åŠ›ï¼Œæˆ‘è·Ÿ <strong>Gemini3 Pro</strong> è¿›è¡Œäº†å¤šè½®çš„æ¬¡å¯¹è¯ï¼Œæ²Ÿé€šè®¨è®º<strong>æ„å¢ƒã€å¹³ä»„ï¼Œå¿ƒå¢ƒ</strong>å†™äº†ä¸€é¦–æµŠè¯—ï¼Œä¸‹é™„æœ€ç»ˆä½œå“çš„è¯—è¯å“è¯„ï¼Œå¦‚æœæ²¡å…¥æ³•çœ¼ï¼Œè¯·å¤§å®¶å¤šåšè‡ªæˆ‘æ‰¹è¯„ï¼ˆé®è„¸é€ƒğŸ’¨ï¼‰</p>
<blockquote>
<p>åŸå¥ï¼šä¸‡é‡Œç‹¬åŸè¿é›ªå»ï¼Œå¹³ç”Ÿä¸€å‰‘å¸¦éœœæºã€‚</p>
</blockquote>
<h3 data-id="heading-3">ã€Šè›°é¾™åŸã€‹â€”â€” å‰‘æ°”è—é”‹ï¼Œå¤–å†·å†…çƒ­</h3>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a7aaba326376485384cf9bccf33f0868~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSGlTdGV3aWU=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765803242&amp;x-signature=O%2F58YJJGejHfiZgSKZYONMzyGgE%3D" alt="æˆªå±2025-12-08 20.20.44.png" loading="lazy"/></p>
<h4 data-id="heading-4">ã€æ°”è±¡ï¼šå¦‚å¤å‰‘å…¥é˜ã€‘</h4>
<p>æ•´é¦–è¯—çš„å¼ åŠ›ï¼Œæºäº <strong>â€œå†·â€ä¸â€œçƒ­â€çš„æè‡´åå·®</strong>ã€‚
è¡¨è±¡æ˜¯å†°é›ªã€é£éœœã€å°˜æ³¥çš„æå¯’ä½å‹ï¼›
å†…æ ¸å´æ˜¯å‚²éª¨ã€æ°”è±¡ã€é£é›·çš„æ»šçƒ«é‡å¿ƒã€‚
å‹å¾—è¶Šä½ï¼Œå¼¹èµ·æ—¶ä¾¿è¶Šæ˜¯ä¸‡é’§é›·éœ†ã€‚</p>
<h4 data-id="heading-5">ã€ç‚¼å­—ï¼šå››å­—ç ´å±€ã€‘</h4>
<ul>
<li><strong>èµ·äºâ€œè¿â€</strong>ï¼šå‡¡äººé¿é›ªï¼Œä¾ å®¢ç‹¬è¿ã€‚ä¸€å­—ç«‹èµ·é€†æµè€Œä¸Šçš„å§¿æ€ã€‚</li>
<li><strong>æ‰¿äºâ€œä»»â€</strong>ï¼šè§†éœœé›ªä¸ºé›•åˆ»ä¹‹åˆ€ã€‚è¿™æ˜¯â€œä»–å¼ºä»»ä»–å¼ºâ€çš„é¡¶çº§å‚²æ°”ã€‚</li>
<li><strong>è½¬äºâ€œè—â€</strong>ï¼šå…¨è¯—ä¹‹çœ¼ã€‚å˜â€œè¢«åŠ¨è½é­„â€ä¸ºâ€œä¸»åŠ¨è›°ä¼â€ã€‚èº«åœ¨æ³¥æ¶‚ï¼Œå¿ƒåœ¨ä¹éœ„ã€‚</li>
<li><strong>åˆäºâ€œå·â€</strong>ï¼šé£é›·ä¸€åŠ¨ï¼Œä¹¾å¤å€’è½¬ã€‚æ‰€æœ‰çš„éšå¿ï¼Œåªä¸ºè¿™ä¸€åˆ»çš„çˆ†å‘ã€‚</li>
</ul>
<h4 data-id="heading-6">ã€å“²æ€ï¼šå¼ºè€…çš„å®£è¨€ã€‘</h4>
<p>è¿™é¦–è¯—æˆåŠŸåœ°åˆ»ç”»äº†ä¸€ä½ <strong>â€œå—å¾—äº†å§”å±ˆï¼Œæ’‘å¾—èµ·é‡å¿ƒâ€</strong> çš„äººç‰©å½¢è±¡</p>
<ul>
<li>å›å­å½“æœ‰é¾™è›‡ä¹‹å˜ï¼Œé¾™è›‡ä¹‹å˜ï¼Œåœ¨äºèƒ½å¤§èƒ½å°ï¼Œèƒ½å‡èƒ½éšã€‚èº«åœ¨çƒ‚æ³¥ï¼Œå¿ƒæ€€æ°”è±¡ï¼Œè¿™æ˜¯æ­é›„å¿ƒæ€§ã€‚</li>
<li>å®ƒä¸å†æ˜¯å•çº¯çš„æŠ±æ€¨æ€€æ‰ä¸é‡ï¼Œè€Œæ˜¯ä¸€ç§è—å™¨äºèº«ï¼Œå¾…æ—¶è€ŒåŠ¨çš„ç”Ÿæ´»æ€åº¦ã€‚</li>
</ul>
<h3 data-id="heading-7">2. ç”»éª¨ï¼šè§†è§‰å¼ åŠ›</h3>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5ec995deb611439a8d85842bc2b172ca~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSGlTdGV3aWU=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765803242&amp;x-signature=9cjhANQMdeTQNfNL7%2BVMupURFsc%3D" alt="nthme-1765190372526.png" loading="lazy"/></p>
<ul>
<li><strong>å·¥å…·</strong>ï¼šNano Banana æ™®é€šæ¨¡å‹</li>
<li><strong>æ ¸å¿ƒæ€è·¯</strong>ï¼š
å¾ˆå¤šæ¨¡å‹å–œæ¬¢æŠŠç”»é¢å¡«æ»¡ï¼Œä½†å›½é£æ°´å¢¨è®²ç©¶çš„æ˜¯ <strong>â€œç•™ç™½â€</strong>ã€‚
æˆ‘åˆ»æ„å¼•å¯¼æ¨¡å‹ç”Ÿæˆâ€œ<strong>ç–å¯èµ°é©¬ï¼Œå¯†ä¸é€é£</strong>â€çš„æ„å›¾ã€‚
<ul>
<li><strong>å…³é”®Prompt</strong>ï¼š<code>negative space</code> (ç•™ç™½), <code>minimalism</code>, <code>dragon in clouds</code>, <code>swordsman back view</code>.</li>
<li><strong>ç›®çš„</strong>ï¼šè¿™é‡Œçš„ç•™ç™½ä¸æ˜¯ç©ºï¼Œè€Œæ˜¯ä¸ºäº†ç»™åç»­çš„â€œé¢˜å­—â€ç•™å‡ºç”Ÿæ€ä½ï¼Œè¥é€ â€œå‹æŠ‘æ„Ÿâ€çš„å¼ åŠ›ã€‚</li>
</ul>
</li>
</ul>
<p>å®Œæ•´æç¤ºè¯</p>
<p><strong>é€‚ç”¨åœºæ™¯ï¼š</strong> æƒ³è¦ä¸€ç§å¤é£ã€è‹å‡‰ã€ç•™ç™½ã€æ„å¢ƒæ·±è¿œçš„ç”»é¢ã€‚</p>
<p><strong>ç”»é¢æè¿°ï¼š</strong> å·¨å¤§çš„ç•™ç™½é›ªæ™¯ï¼Œä¸€ä¸ªæ¸ºå°çš„å¢¨è‰²èƒŒå½±ï¼Œè„šä¸‹æ˜¯æ³¥æ³ï¼Œå¤©è¾¹éšçº¦æœ‰é¾™å½¢çš„äº‘æ°”å’Œé›·å…‰ã€‚</p>
<p>Prompt (è‹±æ–‡æç¤ºè¯):</p>
<pre><code class="hljs language-text" lang="text">masterpiece, best quality, traditional chinese ink wash painting, shuimo, a vast snowy landscape, heavy blizzard, one solitary swordsman walking away, back view, wearing tattered long robes, holding a sword, frost on clothes, standing in mud and snow, subtle dragon-shaped clouds in the dark stormy sky, lightning breaking through the clouds, strong contrast between black ink and white paper, epic atmosphere, lonely, majestic, calligraphy brush strokes.
</code></pre>
<h3 data-id="heading-8">3. ç‚¹ç›ï¼šå­—æ˜¯ç”»çš„èƒ†</h3>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ef8b64ec0ec840a5a2a2444343fd94f9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSGlTdGV3aWU=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765803242&amp;x-signature=QvCyj4G3qXR5pfw%2BiOT0w%2BikhEs%3D" alt="æˆªå±2025-12-08 20.16.51.png" loading="lazy"/></p>
<ul>
<li><strong>å·¥å…·</strong>ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.hellofont.cn%2F" target="_blank" title="https://www.hellofont.cn/" ref="nofollow noopener noreferrer">å­—ç”± (HelloFont)</a></li>
<li><strong>ç—›ç‚¹</strong>ï¼šç›®å‰çš„AIç”Ÿå›¾æ¨¡å‹ï¼ˆå¦‚SD, MJï¼‰ç”Ÿæˆçš„æ±‰å­—åŸºæœ¬æ˜¯â€œé¬¼ç”»ç¬¦â€ï¼Œä¸å¯ç”¨ã€‚</li>
<li><strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼š
ä¸è¦è¿·ä¿¡å…¨è‡ªåŠ¨ã€‚æˆ‘é€‰æ‹©åæœŸåˆæˆã€‚
ä½¿ç”¨ <strong>å­—ç”±</strong> æŒ‘é€‰äº†å…è´¹å•†ç”¨çš„ä¹¦æ³•å­—ä½“ï¼ˆæ¨èè¡Œæ¥·æˆ–ç˜¦é‡‘ä½“é£æ ¼ï¼‰ã€‚
<ul>
<li><strong>æ’ç‰ˆæŠ€å·§</strong>ï¼šé‡‡ç”¨å¤ç±ç«–æ’ï¼Œå³èµ·ã€‚æ–‡å­—é¢œè‰²å¸å–ç”»é¢æ·±å¢¨è‰²ï¼Œè®©å­—â€œé•¿â€åœ¨ç”»ä¸Šã€‚</li>
</ul>
</li>
</ul>
<h3 data-id="heading-9">4. æ³¨é­‚ï¼šè®©ç”»é¢æµåŠ¨</h3>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b63a93515d864adab5df833acb9ffd9b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSGlTdGV3aWU=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765803242&amp;x-signature=%2B02JEo2KaTjVqI3Wc%2B8UABTwgvM%3D" alt="IMG_1776.PNG" loading="lazy"/></p>
<ul>
<li><strong>å·¥å…·</strong>ï¼šè±†åŒ… (Doubao)</li>
<li><strong>æ“ä½œ</strong>ï¼šå›¾ç”Ÿè§†é¢‘ (Image-to-Video)ã€‚</li>
<li><strong>æ•ˆæœ</strong>ï¼šæç¤ºè¯æ§åˆ¶â€œé£é›ªå‰§çƒˆé£˜åŠ¨â€ã€â€œé›·é¾™åœ¨äº‘å±‚éšç°â€ï¼Œä½†äººç‰©ä¿æŒç›¸å¯¹é™æ­¢ã€‚åŠ¨é™ç»“åˆï¼Œå‹è¿«æ„Ÿæ‹‰æ»¡ã€‚</li>
<li><strong>âŒ é‡åˆ°çš„ç—›ç‚¹</strong>ï¼š
è™½ç„¶è±†åŒ…ç”Ÿæˆçš„åŠ¨æ€æ•ˆæœä¸é”™ï¼Œä½†<strong>æ°´å°</strong>é—®é¢˜éå¸¸å½±å“æˆç‰‡çš„æ²‰æµ¸æ„Ÿã€‚å¯¹äºè¿½æ±‚æè‡´å®¡ç¾çš„åˆ›ä½œè€…æ¥è¯´ï¼Œè¿™æ˜¯æ— æ³•å¿å—çš„ç‘•ç–µã€‚è¿˜æœ‰ä¸€äº›å¼±æ™ºç”»é¢çªç„¶è·³å‡ºæ¥ï¼Œè‡ªå·±è¦è£å‡ã€‚</li>
</ul>
<h3 data-id="heading-10">5. éŸ³æºï¼šæ°›å›´è¥é€ </h3>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6555d5dfefa744729adba6ad69df2f8c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSGlTdGV3aWU=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765803242&amp;x-signature=YPBNY%2F7iE8bFK4OGaz1Y57qCgv8%3D" alt="æˆªå±2025-12-08 20.24.23.png" loading="lazy"/>
å•çº¯çš„ç”»é¢æ˜¯ä¸å¤Ÿçš„ï¼Œå£°éŸ³æ˜¯æƒ…ç»ªçš„æ”¾å¤§å™¨ã€‚</p>
<ul>
<li><strong>éŸ³æºè·å–</strong>ï¼šåœ¨Bç«™æ‰¾åˆ°ä¸€æ®µæå…·å¤é£å‹è¿«æ„Ÿçš„è§†é¢‘ç´ æã€‚
<ul>
<li>ğŸ“¥ <strong>è§†é¢‘ä¸‹è½½</strong>ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fsnapany.com%2Fzh%2Fbilibili" target="_blank" title="https://snapany.com/zh/bilibili" ref="nofollow noopener noreferrer">SnapAny</a> (æ”¯æŒBç«™è§†é¢‘è§£æä¸‹è½½)</li>
</ul>
</li>
<li><strong>éŸ³é¢‘æå–</strong>ï¼š
<ul>
<li>ğŸµ <strong>éŸ³è½¨åˆ†ç¦»</strong>ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.fineshare.com%2Fcn%2Faudio-extractor%2F" target="_blank" title="https://www.fineshare.com/cn/audio-extractor/" ref="nofollow noopener noreferrer">FineShare Audio Extractor</a></li>
</ul>
</li>
<li><strong>åæœŸå‰ªè¾‘</strong>ï¼š
<ul>
<li>ä½¿ç”¨å‰ªæ˜ å°†ç”»é¢ä¸éŸ³é¢‘å¯¹é½ï¼Œåˆ¶ä½œæˆ<strong>å¾ªç¯æ’­æ”¾çš„çŸ­è§†é¢‘ï¼ˆLoop Videoï¼‰</strong>ã€‚</li>
</ul>
</li>
</ul>
<hr/>
<h2 data-id="heading-11">02ï½œä»ç—›ç‚¹åˆ°äº§å“è¿­ä»£ï¼šThe Nth Me çš„ä¸‹ä¸€æ­¥</h2>
<p>èµ°å®Œè¿™ä¸€æ•´å¥—æµç¨‹ï¼Œæˆ‘æœ€å¤§çš„æ„Ÿå—æ˜¯ï¼š<strong>å‰²è£‚</strong>ã€‚</p>
<p>æˆ‘éœ€è¦åˆ‡æ¢5ä¸ªå·¥å…·ï¼ˆNano Banana -&gt; Keynote/å­—ç”± -&gt; è±†åŒ… -&gt; SnapAny -&gt; å‰ªæ˜ ï¼‰ï¼Œè¿˜è¦å¿å—æ°´å°ï¼Œæ‰èƒ½å‹‰å¼ºé€šè¿‡â€œæ‹¼å‡‘â€å®Œæˆä¸€ä¸ªä½œå“ã€‚</p>
<p>è¿™è®©æˆ‘é‡æ–°å®¡è§†æˆ‘æ­£åœ¨åšçš„äº§å“ â€”â€” <strong>The Nth Me</strong>ã€‚</p>
<h3 data-id="heading-12">ğŸ’¡ ä¸ºä»€ä¹ˆè¦åš The Nth Meï¼Ÿ</h3>
<p>â€œThe Nth Meâ€æ„ä¸ºâ€œç¬¬Nä¸ªæˆ‘â€ã€‚æˆ‘ä»¬æ¯ä¸ªäººåœ¨å¹³è¡Œæ—¶ç©ºé‡Œï¼Œéƒ½å¯èƒ½æ˜¯é‚£ä¸ªâ€œä¸‡é‡Œç‹¬åŸâ€çš„å‰‘å®¢ã€‚
æˆ‘å¸Œæœ›å®ƒä¸ä»…ä»…æ˜¯ä¸€ä¸ªç½‘ç«™ï¼Œè€Œæ˜¯ä¸€ä¸ª <strong>â€œå®¡ç¾å®¹å™¨â€</strong>ã€‚</p>
<h3 data-id="heading-13">ğŸš€ è¿­ä»£ Roadmap</h3>
<p>åŸºäºè¿™æ¬¡åˆ›ä½œçš„ç—›ç‚¹ï¼Œæˆ‘å†³å®šåœ¨ <strong>The Nth Me</strong> çš„åç»­ç‰ˆæœ¬ä¸­é‡ç‚¹è§£å†³ä»¥ä¸‹é—®é¢˜ï¼š</p>
<ol>
<li><strong>å…¨æµç¨‹é—­ç¯</strong>ï¼š
è®¡åˆ’æ¥å…¥å›¾ç”Ÿè§†é¢‘æ¨¡å‹ï¼Œç”¨æˆ·åœ¨ç«™å†…ç”Ÿæˆå›¾ç‰‡åï¼Œå¯ä»¥ç›´æ¥ä¸€é”®â€œæ³¨é­‚â€ç”Ÿæˆè§†é¢‘ï¼Œæ— éœ€è·³è½¬ã€‚ä½†æ˜¯éŸ³æºè·å–è¿˜æ˜¯ä¸ªé—®é¢˜ï¼Œæ€»æ˜¯è¦å‰ç½®å¤„ç†ã€‚å¦‚æœç½‘ç«™å†…åšå¯èƒ½ä¼šæŠŠåŠŸèƒ½å†™æˆã€Œå‰ªæ˜ ã€ï¼Œæˆ‘åˆæƒ³ä¸å˜æˆå‰ªè¾‘è½¯ä»¶ã€‚
<ul>
<li>æœ‰äº›å›°æ‰°ï¼Œå¦‚æœæœ‰å¥½å»ºè®®çš„ jym å¯ä»¥å‘åœ¨è¯„è®ºåŒºï¼Œ<strong>è‹¥é‡‡çº³ï¼Œé€ä½ ä½“éªŒç§¯åˆ†å…‘æ¢ç </strong></li>
</ul>
</li>
<li><strong>å»æ°´å°åŒ–</strong>ï¼š
ä½œä¸ºç‹¬ç«‹å¼€å‘è€…ï¼Œæˆ‘æ·±çŸ¥ç‰ˆæƒå’Œçº¯å‡€åº¦çš„é‡è¦æ€§ã€‚æœªæ¥çš„è§†é¢‘ç”ŸæˆåŠŸèƒ½å°†ä¸»æ‰“<strong>é«˜æ¸…ã€æ— æ°´å°</strong>ï¼ŒæŠŠç”»é¢è¿˜ç»™åˆ›ä½œè€…ã€‚</li>
<li><strong>æ–‡åŒ–èµ„äº§æ²‰æ·€</strong>ï¼š
ä¸ä»…ä»…æ˜¯ç”Ÿæˆï¼Œè¿˜è¦èƒ½åˆ†äº«ã€‚å…¨æµåª’ä½“/ç¤¾äº¤è½¯ä»¶å¦‚ä½•è®¾è®¡åˆ†äº«é€”å¾„ï¼Œéƒ½è¦å¤„ç†ã€‚</li>
</ol>
<hr/>
<h2 data-id="heading-14">03ï½œç»“è¯­</h2>
<h3 data-id="heading-15">1.æ˜é‡‘çš„è§†é¢‘åˆ°åº•æ€ä¹ˆä¸Šä¼ ï¼Ÿ</h3>
<p>æˆ‘æœ¬æ¥æƒ³æŠŠè§†é¢‘æ”¾ä¸Šæ¥ç»™å¤§å®¶çœ‹çœ‹ï¼Œä½†æ˜¯ç¼–è¾‘å™¨æœ‰ç‚¹é—®é¢˜ã€‚ä¸æ¸…æ¥šæ€ä¹ˆä¸Šä¼ ï¼Œç‰¹åˆ«æ˜¯æ–‡æ¡ˆè¿˜è¯´åªæ”¯æŒè¥¿ç“œè§†é¢‘ï¼Œç°åœ¨è¿›è¥¿ç“œè§†é¢‘å®˜ç½‘ç›´æ¥è·³åˆ°æŠ–éŸ³å»äº†ï¼Œè¿™ä¸ªä¸Šä¼ é€»è¾‘éƒ½åºŸäº†ã€‚@æ˜é‡‘æŠ€æœ¯ï¼Œéº»çƒ¦æœ‰ç©ºè·Ÿè¿›ä¸€ä¸‹ã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d1a1b01cf3764b6895e4c24ad8f27db6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSGlTdGV3aWU=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765803242&amp;x-signature=s2h2mR3Y1C%2FHtaa5Tyid1Mqb%2FEE%3D" alt="æˆªå±2025-12-08 20.36.48.png" loading="lazy"/></p>
<p>æ”¾ä¸ªå°çº¢ä¹¦çš„ï¼š</p>
<p>æ˜Â·å¼ ç©† x AIï¼šè·¨è¶Šæ—¶ç©ºçš„â€œè›°é¾™â€å¯¹è¯ â€œä¸‡é‡Œç‹¬åŸè¿... <a href="https://link.juejin.cn?target=http%3A%2F%2Fxhslink.com%2Fo%2F4AqiRBWgFbf" target="_blank" title="http://xhslink.com/o/4AqiRBWgFbf" ref="nofollow noopener noreferrer">xhslink.com/o/4AqiRBWgFâ€¦</a>
å¤åˆ¶åæ‰“å¼€ã€å°çº¢ä¹¦ã€‘æŸ¥çœ‹ç¬”è®°ï¼</p>
<h3 data-id="heading-16">2.å…³äºçµæ„Ÿ</h3>
<p>å¾ˆå¤šäººé—®æˆ‘ï¼Œä¸ºä»€ä¹ˆè¦åšè¿™ç§â€œæ— ç”¨â€çš„ä¸œè¥¿ï¼Ÿ</p>
<p>å…¶å®ï¼Œæˆ‘ä»¬æ¯ä¸ªäººèº«ä½“é‡Œéƒ½ä½ç€æ— æ•°ä¸ªè‡ªå·±ã€‚ ä¹Ÿè®¸æ˜¯é‚£ä¸ªæƒ³ä»—å‰‘å¤©æ¶¯çš„å°‘å¹´ï¼Œä¹Ÿè®¸æ˜¯é‚£ä¸ªæƒ³åœ¨é£é›ªä¸­å¤§å–Šçš„ç–¯å­ã€‚åœ¨è¿™ä¸ªåä¸º The Nth Me çš„æ¦‚å¿µé‡Œï¼Œæˆ‘æ‰¾åˆ°äº†ç¬¬Nä¸ªè‡ªå·±ã€‚ å®ƒä¸ä»…ä»…æ˜¯ä¸€ä¸ªåå­—ï¼Œæ›´åƒæ˜¯ä¸€ä¸ªå­˜æ”¾æˆ‘ä»¬â€œæœªç«Ÿä¹‹æ¢¦â€çš„èµ›åšç©ºé—´ã€‚</p>
<ul>
<li>åœ¨è¿™é‡Œï¼Œæ‰€æœ‰çš„æ„å¿—å’Œæƒ³è±¡ï¼Œéƒ½èƒ½è¢«çœ‹è§ã€‚</li>
<li>å¦‚æœä½ ä¹Ÿæƒ³æ‰¾åˆ°ä½ çš„ç¬¬ N ç§å¯èƒ½ï¼Œä¸å¦¨å»æœæœçœ‹ <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.nthme.org%2F" target="_blank" title="https://www.nthme.org/" ref="nofollow noopener noreferrer"><strong>The Nth Me</strong></a>ã€‚ æˆ–è®¸ï¼Œé‚£é‡Œä¹Ÿæœ‰ä½ çš„å½±å­ã€‚</li>
<li>å¦‚æœä½ ä¹Ÿæƒ³æ‰“ç ´æ¬¡å…ƒå£ï¼Œå»æ¢ç´¢AIç§‘æŠ€ä¸å¤ä»£è¯—è¯æ–‡åŒ–çš„äº¤èï¼Œä¸å¦¨æŒ‰ç…§æˆ‘è¿™ä¸ªè·¯å¾„å›¾è‡ªå·±å°è¯•ä¸€ä¸‹</li>
</ul>
<blockquote>
<p>æ„¿ä½ ä¸€èº«å‚²éª¨ï¼Œç»ˆé‡é£é›·ã€‚</p>
</blockquote>
<p>å¦‚æœä½ ä¹Ÿå¯¹è¿™ç§ <strong>â€œæŠ€æœ¯+äººæ–‡â€</strong> çš„æ¢ç´¢æ„Ÿå…´è¶£ï¼Œæˆ–è€…æƒ³ä½“éªŒæœªæ¥çš„æ— æ°´å°å·¥ä½œæµï¼Œæ¬¢è¿å…³æ³¨æˆ‘çš„é¡¹ç›®ï¼š</p>
<p>ğŸ‘‰ <strong>The Nth Me</strong>: <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.nthme.org%2F" target="_blank" title="https://www.nthme.org/" ref="nofollow noopener noreferrer">www.nthme.org/</a></p>
<p>è®©æˆ‘ä»¬ä¸€èµ·ï¼Œåœ¨èµ›åšä¸–ç•Œé‡Œï¼Œå¤æ´»å¿ƒä¸­çš„é‚£æ¡â€œè›°é¾™â€ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ä¸ºä»€ä¹ˆç¬¬ä¸€æ€§åŸç†æ€ç»´å¯ä»¥æ”¹å˜ä½ è§£å†³é—®é¢˜çš„æ–¹å¼]]></title>    <link>https://juejin.cn/post/7581097111896457270</link>    <guid>https://juejin.cn/post/7581097111896457270</guid>    <pubDate>2025-12-08T11:44:31.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581097111896457270" data-draft-id="7581117416811479083" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ä¸ºä»€ä¹ˆç¬¬ä¸€æ€§åŸç†æ€ç»´å¯ä»¥æ”¹å˜ä½ è§£å†³é—®é¢˜çš„æ–¹å¼"/> <meta itemprop="keywords" content="æ¶æ„,å‰ç«¯æ¡†æ¶"/> <meta itemprop="datePublished" content="2025-12-08T11:44:31.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="MobotStone"/> <meta itemprop="url" content="https://juejin.cn/user/3839909554568840"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ä¸ºä»€ä¹ˆç¬¬ä¸€æ€§åŸç†æ€ç»´å¯ä»¥æ”¹å˜ä½ è§£å†³é—®é¢˜çš„æ–¹å¼
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3839909554568840/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    MobotStone
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-08T11:44:31.000Z" title="Mon Dec 08 2025 11:44:31 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»7åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>æˆ‘ä»ç„¶è®°å¾—å‰ä¸ä¹…çš„ä¸€æ®µå°ç»å†ã€‚é‚£æ—¶å€™ï¼Œæˆ‘ä»¬åœ¨ä¸ºä¸€ä¸ªæ–°çš„ä¸šåŠ¡éœ€æ±‚æ‰¾æŠ€æœ¯æ–¹æ¡ˆï¼Œå¤§å®¶å¼€äº†å¥½å‡ æ¬¡ä¼šï¼Œå´å§‹ç»ˆæ‹¿ä¸å®šä¸»æ„ã€‚æ¯æ¬¡è®¨è®ºéƒ½åƒæ˜¯åœ¨ä¿®ä¸€å°ç‰¹åˆ«å¤æ‚çš„å¤§æœºå™¨â€”â€”æ–¹æ¡ˆä¸€ä¸ªæ¯”ä¸€ä¸ªâ€œé«˜çº§â€ï¼Œä½†ä¸€è°ˆåˆ°å…·ä½“å®ç°ï¼Œå°±é™·è¿›ç»†èŠ‚é‡Œå‡ºä¸æ¥ã€‚</p>
<p>é‚£å¤©ä¸‹åˆï¼Œæˆ‘ç´¢æ€§æ”¾ä¸‹æ‰‹å¤´çš„æ´»å„¿ï¼Œé—®äº†è‡ªå·±ä¸€ä¸ªç‰¹åˆ«ç®€å•çš„é—®é¢˜ï¼šä¸šåŠ¡åˆ°åº•æœ€åœ¨ä¹çš„æ˜¯ä»€ä¹ˆï¼Ÿå¸¦ç€è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘é‡æ–°æŠŠæ•´ä¸ªä¸šåŠ¡æµç¨‹æ¢³ç†äº†ä¸€éï¼Œæ‰çªç„¶å‘ç°ï¼šæˆ‘ä»¬ä¹‹å‰ä¸€ç›´å¿½ç•¥äº†ä¸€ä¸ªå…³é”®ç‚¹â€”â€”çœŸæ­£è¦è§£å†³çš„é—®é¢˜ï¼Œå…¶å®éå¸¸ç®€å•ï¼Œæ˜¯æˆ‘ä»¬è‡ªå·±æŠŠå®ƒæå¤æ‚äº†ã€‚</p>
<p>æƒ³é€šè¿™ä¸€ç‚¹ä¹‹åï¼Œæˆ‘ä»¬é‡æ–°å®¡è§†äº†éœ€æ±‚ï¼Œä¸å†è¿½æ±‚â€œåˆå¤§åˆå…¨â€çš„æ–¹æ¡ˆï¼Œè€Œæ˜¯é€‰æ‹©äº†ä¸€ä¸ªæç®€ã€ç›´æ¥ã€å¥½è½åœ°çš„åšæ³•ã€‚ç»“æœä¸ä»…çœä¸‹äº†ä¸å°‘å¼€å‘èµ„æºï¼Œä¸šåŠ¡çš„ä½“éªŒä¹Ÿæ›´å¥½äº†ã€‚</p>
<p>è¿™æ¬¡ç»å†è®©æˆ‘æ˜ç™½ï¼šè§£å†³é—®é¢˜çš„å…³é”®ï¼Œä¸åœ¨äºæ–¹æ¡ˆæœ‰å¤šå…ˆè¿›ï¼Œç®—æ³•å¤šç‰›ï¼Œè€Œåœ¨äºæœ‰æ²¡æœ‰çœŸæ­£æ»¡è¶³ä¸šåŠ¡å½“å‰çš„éœ€æ±‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/088e214bf5a74ba1aa156bc947b3c4e7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTW9ib3RTdG9uZQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765799070&amp;x-signature=2SuC7jhfI%2BMsQT4esmV%2B9bbtxrM%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-0">ä»€ä¹ˆæ˜¯ç¬¬ä¸€æ€§åŸç†æ€è€ƒï¼Ÿ</h2>
<p>ç¬¬ä¸€æ€§åŸç†æ€è€ƒï¼Œå°±æ˜¯æŠŠé—®é¢˜æ‹†è§£åˆ°æœ€åŸºæœ¬çš„çœŸç›¸ï¼Œç„¶åä»è¿™äº›çœŸç›¸å‡ºå‘ä¸€æ­¥æ­¥æ¨ç†ï¼Œè€Œä¸æ˜¯è·Ÿç€â€œå¤§å®¶éƒ½çŸ¥é“â€çš„è€è¯´æ³•èµ°ã€‚å®ƒä¸æ˜¯è¦ä½ ä»å¤´å‘æ˜è½®å­ï¼Œè€Œæ˜¯ææ¸…æ¥šè½®å­ä¸ºä»€ä¹ˆæ˜¯åœ†çš„ã€å®ƒæ€ä¹ˆæ»šçš„ï¼Œä»¥åŠèƒ½ä¸èƒ½ç”¨å…¶ä»–å½¢çŠ¶æ»šå¾—æ›´å¥½ã€‚</p>
<p>é€šè¿‡æ‰¾å‡ºé—®é¢˜çš„æ ¸å¿ƒâ€œç –å—â€ï¼Œä½ å°±é¿å¼€äº†é‚£ç§å°ä¿®å°è¡¥çš„æ­»èƒ¡åŒã€‚ä½ ä¼šé€ä¸€å®¡è§†æ¯ä¸€æ­¥ï¼šå“ªäº›æ˜¯é“æ¿é’‰é’‰çš„ã€å“ªäº›èƒ½å˜ã€å“ªäº›å˜ä¸äº†ã€‚è¿™ç§æ–¹æ³•ï¼Œèƒ½æŠŠè¶…çº§å¤æ‚çš„éš¾é¢˜ï¼Œå˜æˆç®€å•æ˜äº†çš„â€œå°å„¿ç§‘â€é—®é¢˜ï¼Œä¸€ä¸‹å­å°±æå®šã€‚</p>
<h2 data-id="heading-1">è¿™ç§æ€ç»´æ–¹å¼çš„å¼ºå¤§ä¹‹å¤„åœ¨å“ª</h2>
<p>ç¬¬ä¸€æ€§åŸç†æ€ç»´ä¹‹æ‰€ä»¥èƒ½å¸¦æ¥é¢ è¦†æ€§æ”¹å˜ï¼Œæ˜¯å› ä¸ºå®ƒï¼š</p>
<ul>
<li><strong>æ¿€å‘çœŸæ­£åˆ›æ–°</strong>ï¼šå½“ä½ è·³å‡ºç°æœ‰æ¡†æ¶ï¼Œå°±èƒ½å‘ç°é‚£äº›è¢«å¸¸äººè§†ä¸ºâ€œç†æ‰€å½“ç„¶â€è€Œå¿½ç•¥çš„å…¨æ–°å¯èƒ½ã€‚</li>
<li><strong>åŒ–ç¹ä¸ºç®€</strong>ï¼šæŠŠçœ‹ä¼¼å¤æ‚æ— æ¯”çš„é—®é¢˜ï¼Œæ‹†è§£æˆæ¸…æ™°ã€å¯é€ä¸ªæ”»å…‹çš„å°æ¨¡å—ã€‚</li>
<li><strong>çœæ—¶çœåŠ›</strong>ï¼šé¿å…åœ¨è¡¨é¢ä¿®è¡¥ä¸Šæµªè´¹æ—¶é—´ï¼ŒåªæŠŠèµ„æºæŠ•å…¥åˆ°çœŸæ­£å…³é”®ã€èƒ½æ¨åŠ¨è¿›å±•çš„åœ°æ–¹ã€‚</li>
<li><strong>å»ºç«‹æ·±åº¦è®¤çŸ¥</strong>ï¼šé€¼ä½ å»å¼„æ‡‚äº‹ç‰©èƒŒåçš„ç§‘å­¦åŸç†ã€å¸‚åœºè§„å¾‹æˆ–äººæ€§å› ç´ ï¼Œè€Œä¸åªæ˜¯åœç•™åœ¨è¡¨é¢ã€‚</li>
<li><strong>è®©å†³ç­–æ›´æœ‰åº•æ°”</strong>ï¼šæ¯ä¸ªå‡è®¾éƒ½ç»è¿‡éªŒè¯ï¼Œä½ çš„é€‰æ‹©å°±ä¸å†åªå‡­ç›´è§‰ï¼Œè€Œæ˜¯å»ºç«‹åœ¨æ‰å®çš„åŸºç¡€ä¸Šã€‚</li>
</ul>
<h2 data-id="heading-2"><strong>ä»æ ¹æœ¬åŸç†å‡ºå‘çš„åˆ›æ–°æ¡ˆä¾‹</strong></h2>
<h4 data-id="heading-3"><strong>1. SpaceX çš„ç«ç®­é©å‘½</strong></h4>
<p>ä¼Šéš†Â·é©¬æ–¯å…‹é—®äº†ä¸€ä¸ªç®€å•å´å…³é”®çš„é—®é¢˜ï¼š<strong>ä¸ºä»€ä¹ˆç«ç®­åªèƒ½ç”¨ä¸€æ¬¡ï¼Ÿ</strong> ä»–ä»é›¶å¼€å§‹é‡æ–°æ€è€ƒç«ç®­çš„è®¾è®¡ï¼Œæ‹†è§£äº†å‘å°„æˆæœ¬å’Œææ–™ç»“æ„ï¼Œæœ€ç»ˆè®© SpaceX çš„ç«ç®­å®ç°äº†<strong>å¯å›æ”¶åˆ©ç”¨</strong>ã€‚è¿™ä¸€æ”¹å˜è®©æ¯æ¬¡å‘å°„çš„æˆæœ¬<strong>é™ä½äº† 90% ä»¥ä¸Š</strong>ï¼Œå½»åº•é¢ è¦†äº†èˆªå¤©ä¸šã€‚</p>
<h4 data-id="heading-4"><strong>2. ç‰¹æ–¯æ‹‰çš„ç”µåŠ¨è½¦çªç ´</strong></h4>
<p>ä¼ ç»Ÿè½¦ä¼åªæ˜¯åœ¨æ²¹è½¦åº•ç›˜ä¸ŠåŠ è£…ç”µæ± ï¼Œè€Œç‰¹æ–¯æ‹‰åˆ™<strong>ä»ç”µæ± å‡ºå‘</strong>ï¼Œé‡æ–°è®¾è®¡äº†è½¦èº«ç»“æ„ã€åŠ¨åŠ›ç³»ç»Ÿå’Œçƒ­ç®¡ç†ã€‚è¿™ç§â€œä»æ ¹æœ¬å‡ºå‘â€çš„æ€è·¯ï¼Œè®©ç”µåŠ¨è½¦<strong>ç»­èˆªæ›´é•¿ã€å……ç”µæ›´å¿«</strong>ï¼Œä»å°ä¼—äº§å“å˜æˆäº†ä¸»æµé€‰æ‹©ã€‚</p>
<h4 data-id="heading-5"><strong>3. å¨å¸ˆçš„é…±æ–™é©å‘½</strong></h4>
<p>ä¸€ä½å¤§å¨æƒ³è¦çªç ´ä¼ ç»Ÿç•ªèŒ„é…±çš„å±€é™ã€‚å¥¹æ²¡æœ‰éµå¾ªå¤æ³•ï¼Œè€Œæ˜¯ä»ç§‘å­¦è§’åº¦åˆ†æ"é²œå‘³"çš„æ¥æºã€‚é€šè¿‡å°†çƒ¤è˜‘è‡ä¸é•¿æ—¶é—´ç‚–ç…®çš„ç•ªèŒ„æ··åˆï¼Œç«Ÿè°ƒé…å‡ºåª²ç¾è‚‰æ±é…±çš„æµ“éƒå£æ„Ÿâ€”â€”å®Œå…¨é æ–°é²œè”¬èœï¼è¿™ä¸ªæ¡ˆä¾‹å®Œç¾å±•ç°äº†"ç”¨æœ€åŸºç¡€åŸç†é‡æ„äº‹ç‰©"çš„æ€ç»´åŠ›é‡ã€‚</p>
<h2 data-id="heading-6">å¦‚ä½•å®è·µç¬¬ä¸€æ€§åŸç†æ€ç»´</h2>
<p><strong>ç¬¬ä¸€æ­¥ï¼šè¯†åˆ«é—®é¢˜ï¼Œåˆ—å‡ºæ‰€æœ‰å‡è®¾</strong></p>
<p>é¦–å…ˆï¼Œæ˜ç¡®ä½ è¦è§£å†³çš„å…·ä½“é—®é¢˜ï¼Œç„¶åæŠŠä½ å¯¹è¿™ä¸ªé—®é¢˜çš„æ‰€æœ‰é¢„è®¾å’Œå‡è®¾éƒ½å†™ä¸‹æ¥ã€‚æ¥ç€ï¼Œé€æ¡é—®è‡ªå·±ï¼š"ä¸ºä»€ä¹ˆæˆ‘ä¼šè¿™æ ·æƒ³ï¼Ÿè¿™ä¸ªå‡è®¾çœŸçš„æ˜¯å¿…é¡»çš„å—ï¼Ÿ"è¿™æ ·åšçš„ç›®çš„æ˜¯æ‰“ç ´æˆ‘ä»¬ä¹ æƒ¯æ€§çš„æ€ç»´å®šå¼ï¼Œå»æ‰é‚£äº›ç†æ‰€å½“ç„¶ä½†å…¶å®æœªå¿…æ­£ç¡®çš„æƒ³æ³•ã€‚</p>
<p><strong>ç¬¬äºŒæ­¥ï¼šæŠŠé—®é¢˜æ‹†è§£æˆæœ€åŸºç¡€çš„ç»„æˆéƒ¨åˆ†</strong></p>
<p>æƒ³è±¡ä½ åœ¨æ‹†ä¸€ä¸ªå¤æ‚çš„æœºå™¨â€”â€”ä¸è¦æ€¥ç€çœ‹æ•´ä½“æ€æ ·è¿ä½œï¼Œè€Œæ˜¯å…ˆé—®è‡ªå·±ï¼š"è¿™ä¸ªé—®é¢˜çš„æ ¸å¿ƒæ˜¯ä»€ä¹ˆï¼Ÿå“ªäº›æ˜¯çœŸæ­£èµ·ä½œç”¨çš„å…³é”®å› ç´ ï¼Ÿ"æŠŠè¿™äº›åŸºæœ¬å…ƒç´ ä¸€ä¸€åˆ—å‡ºæ¥ï¼Œè¿™æ ·ä½ å°±èƒ½çœ‹æ¸…é—®é¢˜çš„æœ¬è´¨ï¼Œè€Œä¸æ˜¯è¢«è¡¨é¢çš„å¤æ‚æ€§è¿·æƒ‘ã€‚</p>
<p><strong>ç¬¬ä¸‰æ­¥ï¼šç‹¬ç«‹éªŒè¯æ¯ä¸ªåŸºç¡€è¦ç´ </strong></p>
<p>å¯¹äºä½ åˆ—å‡ºçš„æ¯ä¸ªæ ¸å¿ƒç»„æˆéƒ¨åˆ†ï¼Œéƒ½è¦ä¸»åŠ¨å»éªŒè¯å®ƒã€‚ä½ å¯ä»¥æŸ¥æ‰¾èµ„æ–™ã€åšä¸€äº›å°çš„æµ‹è¯•ã€æˆ–è€…è¯·æ•™ç›¸å…³é¢†åŸŸçš„ä¸“å®¶ã€‚ç›®çš„æ˜¯ç”¨å®é™…æ•°æ®æˆ–äº‹å®æ¥è¯æ˜è¿™äº›åŸºç¡€è¦ç´ æ˜¯å¦çœŸçš„å­˜åœ¨ï¼Œé‚£äº›ä½ è®¤ä¸ºç†æ‰€å½“ç„¶çš„ä¸œè¥¿æ˜¯å¦çœŸçš„å¯é ã€‚</p>
<p><strong>ç¬¬å››æ­¥ï¼šä»é›¶å¼€å§‹é‡æ–°ç»„å»ºè§£å†³æ–¹æ¡ˆ</strong></p>
<p>ç°åœ¨ä½ å·²ç»çŸ¥é“äº†çœŸå®çš„ã€ç»è¿‡éªŒè¯çš„åŸºç¡€äº‹å®ï¼Œé—®è‡ªå·±ï¼š"å¦‚æœåªåŸºäºè¿™äº›çœŸå®æƒ…å†µï¼Œæˆ‘ä»¬ä¼šæƒ³åˆ°ä»€ä¹ˆæ ·çš„è§£å†³åŠæ³•ï¼Ÿ"è¿™æ—¶å¾€å¾€ä¼šå‡ºç°ä¸€äº›å…¨æ–°çš„ã€ä¹‹å‰ä»æœªè€ƒè™‘è¿‡çš„æƒ³æ³•å’Œå¯èƒ½æ€§ã€‚</p>
<p><strong>ç¬¬äº”æ­¥ï¼šå¿«é€Ÿæ”¹è¿›å¹¶è®°å½•ç»éªŒ</strong></p>
<p>ä¸è¦è®¤ä¸ºç¬¬ä¸€æ¬¡çš„ç»“è®ºå°±æ˜¯å®Œç¾çš„ã€‚è¦æŒç»­æ”¹è¿›ï¼Œå½“æœ‰æ–°çš„æ•°æ®æˆ–å‘ç°å‡ºç°æ—¶ï¼Œä¸æ–­è°ƒæ•´ä½ å¯¹é—®é¢˜çš„ç†è§£ã€‚ç¬¬ä¸€æ€§åŸç†ä¸æ˜¯ä¸€æˆä¸å˜çš„â€”â€”éšç€æƒ…å¢ƒçš„å˜åŒ–ï¼Œæˆ‘ä»¬å¯¹åŸºç¡€åŸç†çš„è®¤è¯†ä¹Ÿåº”è¯¥ä¸æ–­æ¼”è¿›å’Œå®Œå–„ã€‚</p>
<h2 data-id="heading-7">å¦‚ä½•é¿å…å¸¸è§çš„å‘</h2>
<h4 data-id="heading-8"><strong>æŠŠç¬¬ä¸€åŸç†å’Œè¿‡åº¦åˆ†ææ··ä¸ºä¸€ä½“</strong></h4>
<ul>
<li>**é—®é¢˜ï¼š**èŠ±æ•°æœˆæ—¶é—´ç ”ç©¶ç»†å¾®çš„ç»†èŠ‚ï¼Œå¯èƒ½ä¼šå¯¼è‡´è¿›åº¦åœæ»ã€‚ <strong>è§£å†³æ–¹æ¡ˆï¼š</strong> ä¸ºç ”ç©¶è®¾å®šæ˜ç¡®çš„è¾¹ç•Œï¼Œç„¶åè¿…é€Ÿè¿›å…¥åŸå‹å¼€å‘é˜¶æ®µã€‚ä¸è¦é™·å…¥è¿‡åº¦åˆ†æçš„æ³¥æ½­ä¸­ã€‚</li>
</ul>
<h4 data-id="heading-9"><strong>ä¾èµ–é”™è¯¯çš„åŸºç¡€</strong></h4>
<ul>
<li>**é—®é¢˜ï¼š**å¦‚æœä½ çš„æ ¸å¿ƒæ•°æ®æˆ–å¯¹ç‰©ç†å­¦çš„ç†è§£æœ‰è¯¯ï¼Œé‚£ä¹ˆä½ æ‰€æ„å»ºçš„ä¸€åˆ‡éƒ½ä¼šå´©å¡Œã€‚ <strong>è§£å†³æ–¹æ¡ˆï¼š</strong> é€šè¿‡ç®€å•çš„æµ‹è¯•æˆ–åŒè¡Œè¯„å®¡å°½æ—©éªŒè¯ä½ çš„åŸºç¡€ã€‚ç¡®ä¿ä½ çš„æ•°æ®å’Œç†è®ºåŸºç¡€æ˜¯æ­£ç¡®çš„ã€‚</li>
</ul>
<h4 data-id="heading-10"><strong>å¿½è§†æ¸è¿›ä»·å€¼</strong></h4>
<ul>
<li>**é—®é¢˜ï¼š**æœ‰æ—¶å€™ï¼Œå¯¹ç°æœ‰è§£å†³æ–¹æ¡ˆè¿›è¡Œå°çš„è°ƒæ•´ä»ç„¶å¾ˆé‡è¦ã€‚ <strong>è§£å†³æ–¹æ¡ˆï¼š</strong> å½“å®Œå…¨é‡æ–°å‘æ˜è§£å†³æ–¹æ¡ˆå¹¶ä¸ç°å®æ—¶ï¼Œä½¿ç”¨ç¬¬ä¸€åŸç†æ¥æŒ‡å¯¼æ¸è¿›å¼çš„æ”¹è¿›ã€‚å³ä½¿æ˜¯å°çš„ä¼˜åŒ–ï¼Œä¹Ÿèƒ½å¸¦æ¥æ˜¾è‘—çš„ä»·å€¼ã€‚</li>
</ul>
<h2 data-id="heading-11">ä¸€ä¸ªç®€å•çš„ç¬¬ä¸€æ€§åŸç†æ£€æŸ¥æ¸…å•</h2>
<ul>
<li>æˆ‘è‡ªå·±å¯¹è¿™ä¸ªé—®é¢˜æœ‰å“ªäº›ä¸å®¹ç½®ç–‘çš„äº‹å®ï¼Ÿ</li>
<li>æˆ‘èƒ½æ£€éªŒæˆ–å‰”é™¤å“ªäº›å‡è®¾ï¼Ÿ</li>
<li>å¦‚ä½•åˆ†ç¦»å¹¶å•ç‹¬å®éªŒå…¶ä¸­ä¸€ä¸ªæœ€åŸºæœ¬çš„è¦ç´ ï¼Ÿ</li>
<li>å¦‚æœæˆ‘ä»é›¶å¼€å§‹é‡å»ºï¼Œä¼šæœ‰ä»€ä¹ˆå…¨æ–°çš„è®¾è®¡æˆ–ç­–ç•¥å‡ºç°ï¼Ÿ</li>
<li>æˆ‘æ˜¯å¦ä¸ºè°ƒç ”è®¾å®šäº†æ—¶é—´é™åˆ¶ï¼Œä»¥å…é™·å…¥æ— ä¼‘æ­¢çš„æ€è€ƒï¼Ÿ</li>
</ul>
<p>ç¬¬ä¸€æ€§åŸç†æ€ç»´ä¸ä»…ä»…æ˜¯ä¸ªæµè¡Œè¯æ±‡â€”â€”å®ƒæ˜¯ä½ é¢å¯¹é‡å¤§æŒ‘æˆ˜æ—¶çš„ä¸€å¥—æ€ç»´å·¥å…·ï¼Œå¸®åŠ©ä½ è·³å‡ºä¼ ç»Ÿæ¡†æ¶ã€‚å½“ä½ ä¸‹æ¬¡é­é‡é¡½å›ºçš„éš¾é¢˜æ—¶ï¼Œæ— è®ºæ˜¯åœ¨å•†ä¸šç­–ç•¥ã€DIYé¡¹ç›®è¿˜æ˜¯ä¸ªäººç›®æ ‡ä¸Šï¼Œéƒ½å¯ä»¥æš‚åœä¸‹æ¥é—®è‡ªå·±ï¼šæˆ‘çœŸæ­£æŒæ¡çš„æ˜¯ä»€ä¹ˆï¼ŸæŠŠâ€œè¿™å°±æ˜¯ä¸€ç›´ä»¥æ¥çš„åšæ³•â€è¿™ä¸€å±‚å±‚æ¦‚å¿µå‰¥ç¦»å¼€ï¼Œä¸‹é¢éšè—çš„åˆ›æ–°æ€è·¯å¯èƒ½ä¼šä»¤ä½ å¤§åƒä¸€æƒŠã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ä½¿ç”¨ TRAE SOLO ä¸€åˆ†é’Ÿå†™ä¸ªç®€æ˜“ç‰ˆé£æœºå¤§æˆ˜]]></title>    <link>https://juejin.cn/post/7581097545671327763</link>    <guid>https://juejin.cn/post/7581097545671327763</guid>    <pubDate>2025-12-08T12:00:12.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581097545671327763" data-draft-id="7581097545671311379" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ä½¿ç”¨ TRAE SOLO ä¸€åˆ†é’Ÿå†™ä¸ªç®€æ˜“ç‰ˆé£æœºå¤§æˆ˜"/> <meta itemprop="keywords" content="Trae,Solo,Python"/> <meta itemprop="datePublished" content="2025-12-08T12:00:12.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å¨å“¥çˆ±ç¼–ç¨‹"/> <meta itemprop="url" content="https://juejin.cn/user/2242659450109575"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ä½¿ç”¨ TRAE SOLO ä¸€åˆ†é’Ÿå†™ä¸ªç®€æ˜“ç‰ˆé£æœºå¤§æˆ˜
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2242659450109575/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å¨å“¥çˆ±ç¼–ç¨‹
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-08T12:00:12.000Z" title="Mon Dec 08 2025 12:00:12 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»6åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>å¤§å®¶å¥½ï¼Œæˆ‘æ˜¯Vå“¥ï¼Œæœ€è¿‘æ‰¾åˆ°ä¸€ä¸ªå¥½ç©çš„å·¥å…· TRAEï¼Œå®˜ç½‘æ˜¯è¿™æ ·ä»‹ç»çš„ï¼šTRAE æ·±åº¦èåˆ AI èƒ½åŠ›ï¼Œæ˜¯ä¸€åèƒ½å¤Ÿç†è§£éœ€æ±‚ã€è°ƒç”¨å·¥å…·å¹¶ç‹¬ç«‹å®Œæˆå„ç±»å¼€å‘ä»»åŠ¡çš„â€œAI å¼€å‘å·¥ç¨‹å¸ˆâ€ï¼Œå¸®åŠ©ä½ é«˜æ•ˆæ¨è¿›æ¯ä¸€ä¸ªé¡¹ç›®ã€‚äº‹ä¸å®œè¿Ÿï¼Œé©¬ä¸Šå¼€å¹²ï¼Œæˆ‘ä»¬ä¸€èµ·æ¥ä½¿ç”¨ TRAE SOLO 1åˆ†é’Ÿå†™ä¸ªç®€æ˜“ç‰ˆé£æœºå¤§æˆ˜ç©ç©ã€‚</p>
<h2 data-id="heading-0">é¦–å…ˆæˆ‘çš„éœ€æ±‚æ˜¯è¿™æ ·çš„ï¼šå¸®æˆ‘å†™ä¸€ä¸ªé£æœºå¤§æˆ˜</h2>
<p>ä¸‹é¢æ˜¯ TRAE SOLO è‡ªåŠ¨ç”Ÿæˆçš„çš„å…¨è¿‡ç¨‹</p>
<pre><code class="hljs language-makefile" lang="makefile">
æˆ‘éœ€è¦å…ˆæ£€æŸ¥å½“å‰ç›®å½•ç»“æ„ï¼Œäº†è§£é¡¹ç›®çš„åŸºç¡€æƒ…å†µï¼Œç„¶åè§„åˆ’é£æœºå¤§æˆ˜æ¸¸æˆçš„å®ç°æ­¥éª¤ã€‚
        
            
<span class="hljs-section">toolName: view_folder</span>
            
<span class="hljs-section">status: success</span>
          
/Users/vince/Trae/demo1
          
æŸ¥çœ‹main.pyçš„å†…å®¹ï¼Œäº†è§£ç°æœ‰ä»£ç æƒ…å†µï¼Œç„¶åè§„åˆ’é£æœºå¤§æˆ˜æ¸¸æˆçš„å®ç°ã€‚
        
            
<span class="hljs-section">toolName: view_files</span>
            
<span class="hljs-section">status: success</span>
          
            
<span class="hljs-section">filePath: /Users/vince/Trae/demo1/main.py</span>
          
æˆ‘å°†é‡å†™main.pyæ–‡ä»¶ï¼Œå®ç°ä¸€ä¸ªå®Œæ•´çš„é£æœºå¤§æˆ˜æ¸¸æˆï¼ŒåŒ…å«ç©å®¶é£æœºã€æ•Œæœºã€å­å¼¹ç³»ç»Ÿå’Œç¢°æ’æ£€æµ‹ç­‰åŠŸèƒ½ã€‚
        
            
<span class="hljs-section">toolName: edit_file_search_replace</span>
            
<span class="hljs-section">status: success</span>
          
            
<span class="hljs-section">filePath: /Users/vince/Trae/demo1/main.py</span>
          
<span class="hljs-section">changes: undefined</span>
          
ç°åœ¨æˆ‘éœ€è¦å®‰è£…pygameåº“ï¼Œç„¶åè¿è¡Œæ¸¸æˆæ¥æµ‹è¯•æ˜¯å¦æ­£å¸¸å·¥ä½œã€‚
        
            
<span class="hljs-section">toolName: run_command</span>
            
<span class="hljs-section">status: success</span>
          
<span class="hljs-section">command: pip install pygame undefined</span>
          
ä½¿ç”¨python -m pipæ¥å®‰è£…pygameåº“ï¼Œå› ä¸ºç›´æ¥ä½¿ç”¨pipå‘½ä»¤æ²¡æœ‰æ‰¾åˆ°ã€‚
        
            
<span class="hljs-section">toolName: run_command</span>
            
<span class="hljs-section">status: success</span>
          
<span class="hljs-section">command: python -m pip install pygame undefined</span>
          
ä½¿ç”¨python3 -m pipæ¥å®‰è£…pygameåº“ï¼Œå› ä¸ºç¯å¢ƒä¸­å¯èƒ½åªå®‰è£…äº†python3ã€‚
        
            
<span class="hljs-section">toolName: run_command</span>
            
<span class="hljs-section">status: success</span>
          
<span class="hljs-section">command: python3 -m pip install pygame undefined</span>
          
pygameå®‰è£…å¤±è´¥ï¼Œå› ä¸ºç¼ºå°‘SDLä¾èµ–ã€‚æˆ‘å°†ä¿®æ”¹ä»£ç ï¼Œä½¿ç”¨Pythonå†…ç½®çš„turtleåº“æ¥å®ç°é£æœºå¤§æˆ˜æ¸¸æˆï¼Œè¿™æ ·ä¸éœ€è¦ä»»ä½•å¤–éƒ¨ä¾èµ–ã€‚
        
            
<span class="hljs-section">toolName: edit_file_search_replace</span>
            
<span class="hljs-section">status: success</span>
          
            
<span class="hljs-section">filePath: /Users/vince/Trae/demo1/main.py</span>
          
<span class="hljs-section">changes: undefined</span>
          
ç°åœ¨è¿è¡Œæ¸¸æˆï¼Œæµ‹è¯•ä½¿ç”¨turtleåº“å®ç°çš„é£æœºå¤§æˆ˜æ˜¯å¦æ­£å¸¸å·¥ä½œã€‚
        
            
<span class="hljs-section">toolName: run_command</span>
            
<span class="hljs-section">status: success</span>
          
<span class="hljs-section">command: python3 main.py undefined</span>
          
turtleåº“åœ¨macOSä¸Šé‡åˆ°äº†Tkä¾èµ–é—®é¢˜ï¼Œæˆ‘å°†é‡æ–°ç¼–å†™ä¸€ä¸ªåŸºäºæ–‡æœ¬ç•Œé¢çš„é£æœºå¤§æˆ˜æ¸¸æˆï¼Œä½¿ç”¨Pythonæ ‡å‡†åº“ï¼Œæ— éœ€ä»»ä½•å¤–éƒ¨ä¾èµ–ã€‚
        
            
<span class="hljs-section">toolName: edit_file_search_replace</span>
            
<span class="hljs-section">status: success</span>
          
            
<span class="hljs-section">filePath: /Users/vince/Trae/demo1/main.py</span>
          
<span class="hljs-section">changes: undefined</span>
          
ä¿®æ”¹ä»£ç ï¼Œä½¿ç”¨è·¨å¹³å°çš„éé˜»å¡é”®ç›˜è¾“å…¥æ–¹å¼ï¼Œæ›¿æ¢Windowsç‰¹æœ‰çš„msvcrtåº“ã€‚
        
            
<span class="hljs-section">toolName: edit_file_search_replace</span>
            
<span class="hljs-section">status: success</span>
          
            
<span class="hljs-section">filePath: /Users/vince/Trae/demo1/main.py</span>
          
<span class="hljs-section">changes: undefined</span>
          
è¿è¡Œæ¸¸æˆï¼Œæµ‹è¯•è·¨å¹³å°çš„æ–‡æœ¬ç•Œé¢é£æœºå¤§æˆ˜æ˜¯å¦æ­£å¸¸å·¥ä½œã€‚
        
            
<span class="hljs-section">toolName: run_command</span>
            
<span class="hljs-section">status: success</span>
          
<span class="hljs-section">command: python3 main.py undefined</span>
          
é£æœºå¤§æˆ˜æ¸¸æˆå·²ç»æˆåŠŸç¼–å†™å®Œæˆï¼ä»¥ä¸‹æ˜¯æ¸¸æˆçš„ä¸»è¦åŠŸèƒ½å’Œç‰¹ç‚¹ï¼š

<span class="hljs-comment">## æ¸¸æˆåŠŸèƒ½</span>

- **ç©å®¶æ§åˆ¶**ï¼šä½¿ç”¨Aé”®å‘å·¦ç§»åŠ¨ï¼ŒDé”®å‘å³ç§»åŠ¨
- **æ­¦å™¨ç³»ç»Ÿ**ï¼šç©ºæ ¼é”®å‘å°„å­å¼¹
- **æ•Œæœºç³»ç»Ÿ**ï¼šè‡ªåŠ¨ç”Ÿæˆæ•Œæœºå¹¶å‘ä¸‹ç§»åŠ¨
- **ç¢°æ’æ£€æµ‹**ï¼š
  - å­å¼¹å‡»ä¸­æ•Œæœºå¾—åˆ†
  - æ•Œæœºæ’å‡»ç©å®¶æ¸¸æˆç»“æŸ
- **åˆ†æ•°ç³»ç»Ÿ**ï¼šå‡»ä¸­ä¸€æ¶æ•Œæœºå¾—10åˆ†
- **æ¸¸æˆçŠ¶æ€**ï¼šæ”¯æŒæ¸¸æˆç»“æŸã€é‡æ–°å¼€å§‹å’Œé€€å‡ºåŠŸèƒ½

<span class="hljs-comment">## æ¸¸æˆç‰¹ç‚¹</span>

- **è·¨å¹³å°**ï¼šæ”¯æŒWindowså’ŒmacOS/Linuxç³»ç»Ÿ
- **æ— å¤–éƒ¨ä¾èµ–**ï¼šä»…ä½¿ç”¨Pythonæ ‡å‡†åº“
- **æ–‡æœ¬ç•Œé¢**ï¼šä½¿ç”¨å­—ç¬¦ç»˜åˆ¶æ¸¸æˆå…ƒç´ ï¼Œç®€æ´ç›´è§‚
- **æ“ä½œç®€å•**ï¼šæ¸…æ™°çš„æ“ä½œè¯´æ˜
- **ä»£ç ç»“æ„æ¸…æ™°**ï¼šæ¨¡å—åŒ–è®¾è®¡ï¼Œæ˜“äºæ‰©å±•

<span class="hljs-comment">## è¿è¡Œæ–¹å¼</span>

åœ¨ç»ˆç«¯ä¸­æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š
</code></pre>
<p>python3 main.py</p>
<pre><code class="hljs language-markdown" lang="markdown">
<span class="hljs-section">## æ“ä½œè¯´æ˜</span>

<span class="hljs-bullet">-</span> <span class="hljs-strong">**Aé”®**</span>ï¼šå‘å·¦ç§»åŠ¨
<span class="hljs-bullet">-</span> <span class="hljs-strong">**Dé”®**</span>ï¼šå‘å³ç§»åŠ¨
<span class="hljs-bullet">-</span> <span class="hljs-strong">**ç©ºæ ¼é”®**</span>ï¼šå‘å°„å­å¼¹
<span class="hljs-bullet">-</span> <span class="hljs-strong">**Ré”®**</span>ï¼šæ¸¸æˆç»“æŸåé‡æ–°å¼€å§‹
<span class="hljs-bullet">-</span> <span class="hljs-strong">**Qé”®**</span>ï¼šé€€å‡ºæ¸¸æˆ

æ¸¸æˆå·²ç»å¯ä»¥è¿è¡Œï¼Œä½ å¯ä»¥åœ¨ç»ˆç«¯ä¸­ä½“éªŒè¿™ä¸ªç®€å•è€Œæœ‰è¶£çš„é£æœºå¤§æˆ˜æ¸¸æˆï¼

</code></pre>
<p>å®Œæˆä»¥ä¸ŠåŠ¨ä½œåï¼Œåœ¨ä»£ç åŒºç”Ÿæˆçš„pyä»£ç å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-py" lang="py"><span class="hljs-keyword">import</span> os
<span class="hljs-keyword">import</span> sys
<span class="hljs-keyword">import</span> random
<span class="hljs-keyword">import</span> time
<span class="hljs-keyword">import</span> select

<span class="hljs-comment"># æ¸¸æˆè®¾ç½®</span>
WIDTH = <span class="hljs-number">40</span>
HEIGHT = <span class="hljs-number">20</span>
PLAYER_CHAR = <span class="hljs-string">"â–²"</span>
ENEMY_CHAR = <span class="hljs-string">"â–¼"</span>
BULLET_CHAR = <span class="hljs-string">"|"</span>
EMPTY_CHAR = <span class="hljs-string">" "</span>

<span class="hljs-keyword">class</span> <span class="hljs-title class_">PlaneGame</span>:
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self</span>):
        self.player_x = WIDTH // <span class="hljs-number">2</span>
        self.player_y = HEIGHT - <span class="hljs-number">2</span>
        self.bullets = []
        self.enemies = []
        self.score = <span class="hljs-number">0</span>
        self.game_over = <span class="hljs-literal">False</span>
        self.last_enemy_time = time.time()
        self.enemy_spawn_delay = <span class="hljs-number">1.0</span>  <span class="hljs-comment"># ç§’</span>
        
        <span class="hljs-comment"># è®¾ç½®æ ‡å‡†è¾“å…¥ä¸ºéé˜»å¡</span>
        <span class="hljs-keyword">if</span> os.name == <span class="hljs-string">'nt'</span>:
            <span class="hljs-keyword">import</span> msvcrt
        <span class="hljs-keyword">else</span>:
            <span class="hljs-comment"># Unixç³»ç»Ÿè®¾ç½®</span>
            <span class="hljs-keyword">import</span> tty
            <span class="hljs-keyword">import</span> termios
            self.old_settings = termios.tcgetattr(sys.stdin)
            tty.setcbreak(sys.stdin.fileno())
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">clear_screen</span>(<span class="hljs-params">self</span>):
        <span class="hljs-comment"># è·¨å¹³å°æ¸…å±</span>
        os.system(<span class="hljs-string">'cls'</span> <span class="hljs-keyword">if</span> os.name == <span class="hljs-string">'nt'</span> <span class="hljs-keyword">else</span> <span class="hljs-string">'clear'</span>)
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">draw</span>(<span class="hljs-params">self</span>):
        self.clear_screen()
        
        <span class="hljs-comment"># åˆ›å»ºæ¸¸æˆç½‘æ ¼</span>
        grid = [[EMPTY_CHAR <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(WIDTH)] <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(HEIGHT)]
        
        <span class="hljs-comment"># ç»˜åˆ¶ç©å®¶</span>
        grid[self.player_y][self.player_x] = PLAYER_CHAR
        
        <span class="hljs-comment"># ç»˜åˆ¶å­å¼¹</span>
        <span class="hljs-keyword">for</span> bullet <span class="hljs-keyword">in</span> self.bullets:
            <span class="hljs-keyword">if</span> <span class="hljs-number">0</span> &lt;= bullet[<span class="hljs-number">1</span>] &lt; HEIGHT <span class="hljs-keyword">and</span> <span class="hljs-number">0</span> &lt;= bullet[<span class="hljs-number">0</span>] &lt; WIDTH:
                grid[bullet[<span class="hljs-number">1</span>]][bullet[<span class="hljs-number">0</span>]] = BULLET_CHAR
        
        <span class="hljs-comment"># ç»˜åˆ¶æ•Œæœº</span>
        <span class="hljs-keyword">for</span> enemy <span class="hljs-keyword">in</span> self.enemies:
            <span class="hljs-keyword">if</span> <span class="hljs-number">0</span> &lt;= enemy[<span class="hljs-number">1</span>] &lt; HEIGHT <span class="hljs-keyword">and</span> <span class="hljs-number">0</span> &lt;= enemy[<span class="hljs-number">0</span>] &lt; WIDTH:
                grid[enemy[<span class="hljs-number">1</span>]][enemy[<span class="hljs-number">0</span>]] = ENEMY_CHAR
        
        <span class="hljs-comment"># ç»˜åˆ¶è¾¹ç•Œ</span>
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"="</span> * (WIDTH + <span class="hljs-number">2</span>))
        <span class="hljs-keyword">for</span> row <span class="hljs-keyword">in</span> grid:
            <span class="hljs-built_in">print</span>(<span class="hljs-string">"|"</span> + <span class="hljs-string">""</span>.join(row) + <span class="hljs-string">"|"</span>)
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"="</span> * (WIDTH + <span class="hljs-number">2</span>))
        
        <span class="hljs-comment"># ç»˜åˆ¶åˆ†æ•°</span>
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"åˆ†æ•°: <span class="hljs-subst">{self.score}</span>"</span>)
        
        <span class="hljs-keyword">if</span> self.game_over:
            <span class="hljs-built_in">print</span>(<span class="hljs-string">"æ¸¸æˆç»“æŸï¼æŒ‰Ré”®é‡æ–°å¼€å§‹ï¼ŒæŒ‰Qé”®é€€å‡º"</span>)
            <span class="hljs-built_in">print</span>(<span class="hljs-string">"æ“ä½œè¯´æ˜ï¼šAé”®å‘å·¦ï¼ŒDé”®å‘å³ï¼Œç©ºæ ¼é”®å‘å°„"</span>)
        <span class="hljs-keyword">else</span>:
            <span class="hljs-built_in">print</span>(<span class="hljs-string">"æ“ä½œè¯´æ˜ï¼šAé”®å‘å·¦ï¼ŒDé”®å‘å³ï¼Œç©ºæ ¼é”®å‘å°„ï¼ŒQé”®é€€å‡º"</span>)
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">handle_input</span>(<span class="hljs-params">self</span>):
        <span class="hljs-comment"># è·¨å¹³å°éé˜»å¡é”®ç›˜è¾“å…¥</span>
        <span class="hljs-keyword">try</span>:
            <span class="hljs-keyword">if</span> os.name == <span class="hljs-string">'nt'</span>:
                <span class="hljs-keyword">import</span> msvcrt
                <span class="hljs-keyword">if</span> msvcrt.kbhit():
                    key = msvcrt.getch().decode(<span class="hljs-string">'utf-8'</span>).lower()
                    self.process_key(key)
            <span class="hljs-keyword">else</span>:
                <span class="hljs-comment"># Unixç³»ç»Ÿä½¿ç”¨select</span>
                rlist, _, _ = select.select([sys.stdin], [], [], <span class="hljs-number">0.01</span>)
                <span class="hljs-keyword">if</span> rlist:
                    key = sys.stdin.read(<span class="hljs-number">1</span>).lower()
                    self.process_key(key)
        <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:
            <span class="hljs-keyword">pass</span>
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">process_key</span>(<span class="hljs-params">self, key</span>):
        <span class="hljs-keyword">if</span> key == <span class="hljs-string">'a'</span> <span class="hljs-keyword">and</span> self.player_x &gt; <span class="hljs-number">0</span>:
            self.player_x -= <span class="hljs-number">1</span>
        <span class="hljs-keyword">elif</span> key == <span class="hljs-string">'d'</span> <span class="hljs-keyword">and</span> self.player_x &lt; WIDTH - <span class="hljs-number">1</span>:
            self.player_x += <span class="hljs-number">1</span>
        <span class="hljs-keyword">elif</span> key == <span class="hljs-string">' '</span>:
            <span class="hljs-comment"># å‘å°„å­å¼¹</span>
            self.bullets.append([self.player_x, self.player_y - <span class="hljs-number">1</span>])
        <span class="hljs-keyword">elif</span> key == <span class="hljs-string">'r'</span> <span class="hljs-keyword">and</span> self.game_over:
            self.reset_game()
        <span class="hljs-keyword">elif</span> key == <span class="hljs-string">'q'</span>:
            self.exit_game()
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">exit_game</span>(<span class="hljs-params">self</span>):
        <span class="hljs-comment"># æ¢å¤ç»ˆç«¯è®¾ç½®</span>
        <span class="hljs-keyword">if</span> os.name != <span class="hljs-string">'nt'</span>:
            <span class="hljs-keyword">import</span> termios
            termios.tcsetattr(sys.stdin, termios.TCSADRAIN, self.old_settings)
        sys.exit()
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">update</span>(<span class="hljs-params">self</span>):
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> self.game_over:
            <span class="hljs-comment"># æ›´æ–°å­å¼¹</span>
            new_bullets = []
            <span class="hljs-keyword">for</span> bullet <span class="hljs-keyword">in</span> self.bullets:
                bullet[<span class="hljs-number">1</span>] -= <span class="hljs-number">1</span>  <span class="hljs-comment"># å­å¼¹å‘ä¸Šç§»åŠ¨</span>
                <span class="hljs-keyword">if</span> bullet[<span class="hljs-number">1</span>] &gt; <span class="hljs-number">0</span>:  <span class="hljs-comment"># å­å¼¹æœªé£å‡ºå±å¹•</span>
                    new_bullets.append(bullet)
            self.bullets = new_bullets
            
            <span class="hljs-comment"># ç”Ÿæˆæ•Œæœº</span>
            current_time = time.time()
            <span class="hljs-keyword">if</span> current_time - self.last_enemy_time &gt; self.enemy_spawn_delay:
                enemy_x = random.randint(<span class="hljs-number">0</span>, WIDTH - <span class="hljs-number">1</span>)
                self.enemies.append([enemy_x, <span class="hljs-number">0</span>])
                self.last_enemy_time = current_time
            
            <span class="hljs-comment"># æ›´æ–°æ•Œæœº</span>
            new_enemies = []
            <span class="hljs-keyword">for</span> enemy <span class="hljs-keyword">in</span> self.enemies:
                enemy[<span class="hljs-number">1</span>] += <span class="hljs-number">1</span>  <span class="hljs-comment"># æ•Œæœºå‘ä¸‹ç§»åŠ¨</span>
                <span class="hljs-keyword">if</span> enemy[<span class="hljs-number">1</span>] &lt; HEIGHT:  <span class="hljs-comment"># æ•Œæœºæœªé£å‡ºå±å¹•</span>
                    new_enemies.append(enemy)
            self.enemies = new_enemies
            
            <span class="hljs-comment"># æ£€æµ‹ç¢°æ’ï¼šå­å¼¹å‡»ä¸­æ•Œæœº</span>
            bullets_to_remove = []
            enemies_to_remove = []
            
            <span class="hljs-keyword">for</span> i, bullet <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(self.bullets):
                <span class="hljs-keyword">for</span> j, enemy <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(self.enemies):
                    <span class="hljs-keyword">if</span> bullet[<span class="hljs-number">0</span>] == enemy[<span class="hljs-number">0</span>] <span class="hljs-keyword">and</span> bullet[<span class="hljs-number">1</span>] == enemy[<span class="hljs-number">1</span>]:
                        bullets_to_remove.append(i)
                        enemies_to_remove.append(j)
                        self.score += <span class="hljs-number">10</span>
            
            <span class="hljs-comment"># åˆ é™¤å‡»ä¸­çš„å­å¼¹å’Œæ•Œæœºï¼ˆä»åå¾€å‰åˆ é™¤ï¼Œé¿å…ç´¢å¼•é—®é¢˜ï¼‰</span>
            <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">sorted</span>(bullets_to_remove, reverse=<span class="hljs-literal">True</span>):
                <span class="hljs-keyword">del</span> self.bullets[i]
            
            <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">sorted</span>(enemies_to_remove, reverse=<span class="hljs-literal">True</span>):
                <span class="hljs-keyword">del</span> self.enemies[j]
            
            <span class="hljs-comment"># æ£€æµ‹ç¢°æ’ï¼šæ•Œæœºæ’å‡»ç©å®¶</span>
            <span class="hljs-keyword">for</span> enemy <span class="hljs-keyword">in</span> self.enemies:
                <span class="hljs-keyword">if</span> enemy[<span class="hljs-number">0</span>] == self.player_x <span class="hljs-keyword">and</span> enemy[<span class="hljs-number">1</span>] == self.player_y:
                    self.game_over = <span class="hljs-literal">True</span>
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">reset_game</span>(<span class="hljs-params">self</span>):
        self.player_x = WIDTH // <span class="hljs-number">2</span>
        self.player_y = HEIGHT - <span class="hljs-number">2</span>
        self.bullets = []
        self.enemies = []
        self.score = <span class="hljs-number">0</span>
        self.game_over = <span class="hljs-literal">False</span>
        self.last_enemy_time = time.time()
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">run</span>(<span class="hljs-params">self</span>):
        <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:
            self.handle_input()
            self.update()
            self.draw()
            time.sleep(<span class="hljs-number">0.1</span>)  <span class="hljs-comment"># æ§åˆ¶æ¸¸æˆé€Ÿåº¦</span>

<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">"__main__"</span>:
    game = PlaneGame()
    game.run()
</code></pre>
<p>ä¸‹é¢æˆ‘æ¥æµ‹è¯•è¿è¡Œä¸€ä¸‹ï¼Œå•å‡»ä»£ç åŒºå³ä¸Šè§’çš„è¿è¡ŒæŒ‰é’®ï¼š</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/352ae9b75e1c48a1a88275549e00b535~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aiB5ZOl54ix57yW56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765800012&amp;x-signature=lLMUQzjmKIkvR099a96WoBaKdgs%3D" alt="" loading="lazy"/></p>
<p>åœ¨ç»ˆç«¯è¿è¡Œçš„æ•ˆæœæ˜¯è¿™æ ·çš„ï¼š</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/01787c909cf747c99b059c5c10743cd7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aiB5ZOl54ix57yW56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765800012&amp;x-signature=M%2FgR0v%2Bxm5FUld1LVcG8p3By%2FHc%3D" alt="" loading="lazy"/></p>
<p>å•¥ä¹Ÿä¸è¯´ï¼ŒVå“¥å…ˆçˆ½ä¸€æŠŠã€‚</p>
<h2 data-id="heading-1">å°ç»“ä¸€ä¸‹</h2>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b8656d69efe94e01b3aaea4302689396~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aiB5ZOl54ix57yW56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765800012&amp;x-signature=QYFQxr%2FuFAtbooUbbqj20%2F2Eupw%3D" alt="" loading="lazy"/></p>
<p>TRAE è¦†ç›–ä»ç¼–ç ã€è°ƒè¯•åˆ°æµ‹è¯•ã€é‡æ„ã€éƒ¨ç½²ç­‰å¤šç±»å¼€å‘ä»»åŠ¡ã€‚æä¾›æ™ºèƒ½ä½“ç¼–ç¨‹å·¥å…· CUEï¼Œæ”¯æŒä»£ç è¡¥å…¨ã€å¤šè¡Œä¿®æ”¹ã€æ™ºèƒ½å¯¼å…¥å’Œæ™ºèƒ½é‡å‘½åç­‰åŠŸèƒ½ï¼Œé€‚é…å¤šç§æ—¥å¸¸å¼€å‘åœºæ™¯ï¼Œå¸®åŠ©ä½ å‡å°‘é‡å¤æ“ä½œï¼Œä¸“æ³¨æ ¸å¿ƒåˆ›æ–°ã€‚TRAE ä¸ä»…å°† AI é›†æˆè¿› IDEï¼Œä¹Ÿè®© Al ä½¿ç”¨æ›´å¤šå¼€å‘å·¥å…·ã€‚TRAE ç›®å‰æ‹¥æœ‰åŒé‡å¼€å‘æ¨¡å¼ï¼šIDE æ¨¡å¼ä¿ç•™åŸæœ‰æµç¨‹ï¼Œæ§åˆ¶æ„Ÿæ›´å¼ºï¼›SOLO æ¨¡å¼è®© AI ä¸»å¯¼ä»»åŠ¡ï¼Œè‡ªåŠ¨æ¨è¿›å¼€å‘ä»»åŠ¡ã€‚ä½ å¯æ ¹æ®ä»»åŠ¡éœ€æ±‚è‡ªç”±åˆ‡æ¢ï¼Œè®©é«˜æ•ˆä¸çµæ´»å¹¶å­˜ã€‚å…„å¼Ÿä»¬ï¼Œä¸ç”¨çŠ¹è±«ï¼Œå¿«å»è¯•è¯•å§ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Swift 6.2 åˆ—ä¼ ï¼ˆç¬¬ä¸‰ç¯‡ï¼‰ï¼šå­—ç¬¦ä¸²æ’å€¼çš„ â€œè¡¥ä½ç¥æŠ€â€]]></title>    <link>https://juejin.cn/post/7580303864605458441</link>    <guid>https://juejin.cn/post/7580303864605458441</guid>    <pubDate>2025-12-07T02:19:54.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7580303864605458441" data-draft-id="7580374090365042726" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Swift 6.2 åˆ—ä¼ ï¼ˆç¬¬ä¸‰ç¯‡ï¼‰ï¼šå­—ç¬¦ä¸²æ’å€¼çš„ â€œè¡¥ä½ç¥æŠ€â€"/> <meta itemprop="keywords" content="å‰ç«¯,Swift,Apple"/> <meta itemprop="datePublished" content="2025-12-07T02:19:54.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å¤§ç†ŠçŒ«ä¾¯ä½©"/> <meta itemprop="url" content="https://juejin.cn/user/4292907536222152"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Swift 6.2 åˆ—ä¼ ï¼ˆç¬¬ä¸‰ç¯‡ï¼‰ï¼šå­—ç¬¦ä¸²æ’å€¼çš„ â€œè¡¥ä½ç¥æŠ€â€
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4292907536222152/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å¤§ç†ŠçŒ«ä¾¯ä½©
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-07T02:19:54.000Z" title="Sun Dec 07 2025 02:19:54 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-07
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»6åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fb99131ac1074f19a60aba46e1641d4e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn54aK54yr5L6v5L2p:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765678794&amp;x-signature=QfaAt0SeCyQyQ4oMtmaC96xtt4k%3D" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" loading="lazy"/></p>
<h2 data-id="heading-0">å¼•å­ï¼šç³–è‘«èŠ¦ä¸æŠ¥é”™é½é£ï¼Œç†ŠçŒ«ä¾ å¡å£³å®¢æ ˆ</h2>
<p>æ´›é˜³åŸçš„ â€œç æ—åˆ†èˆµâ€ å®¢æ ˆé‡Œï¼Œå¤§ç†ŠçŒ«ä¾¯ä½©æ­£ä¸€æ‰‹æ”¥ç€ç³–è‘«èŠ¦ï¼Œä¸€æ‰‹æˆ³ç€å±å¹•ä¸Šçš„çº¢è‰²æŠ¥é”™ï¼Œåœ†è„¸è›‹çš±æˆäº†åŒ…å­ã€‚</p>
<p>è¿™ä½è‡ªç§° â€œæ’å€¼å°èƒ½æ‰‹ï¼Œå¤´äº®ä¹Ÿä¸ç§ƒâ€ çš„ Swift ç©å®¶ï¼Œæ­¤åˆ»æ­£è¢«ä¸€è¡Œå­—ç¬¦ä¸²æ‰“å°ä»£ç éš¾ä½ â€”â€” ç”¨æˆ·ä¿¡æ¯é‡Œçš„<code>age</code>æ˜¯<code>Int?</code>ï¼Œæƒ³ç»™ä¸ª â€œUnknownâ€ å½“é»˜è®¤å€¼ï¼Œç»“æœç¼–è¯‘å™¨åè¯´ â€œç±»å‹ä¸åŒ¹é…ï¼Œæ­¤è·¯ä¸é€šâ€ã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/449e1e4c49f448ddb08fc49a781883f4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn54aK54yr5L6v5L2p:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765678794&amp;x-signature=y27FK4Ff8LsDK4dL8gqC%2BV5E4X0%3D" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" loading="lazy"/></p>
<p>â€œå²‚æœ‰æ­¤ç†ï¼â€ ä¾¯ä½©å’¬ç¢ä¸€é¢—å±±æ¥‚ï¼Œç³–æ¸£æ‰åœ¨é”®ç›˜ä¸Šï¼Œâ€œ<code>name ?? "Anonymous"</code>è¿˜å¥½å¥½çš„ï¼Œæ¢<code>age</code>å°±ç¿»è„¸ï¼Ÿéš¾ä¸æˆè¦æˆ‘å…ˆæŠŠ<code>age</code>è½¬æˆå­—ç¬¦ä¸²ï¼Œå¤šæ­¤ä¸€ä¸¾åƒç»•è¿œè·¯åƒåŒ…å­ï¼Ÿâ€</p>
<p>åœ¨æœ¬ç¯‡æ­¦æ—åˆ—ä¼ ä¸­ï¼Œæ‚¨å°†å­¦åˆ°å¦‚ä¸‹å†…å®¹ï¼š</p>
<ul>
<li>å¼•å­ï¼šç³–è‘«èŠ¦ä¸æŠ¥é”™é½é£ï¼Œç†ŠçŒ«ä¾ å¡å£³å®¢æ ˆ</li>
<li>ğŸ¯ 1. æ–°æ‹›æ­ç§˜ï¼šSE-0477 çš„ â€œç®€çº¦è¡¥ä½æœ¯â€</li>
<li>ğŸ¤” 2. åˆçœ‹å¹³æ·¡ï¼Ÿnil coalescing çš„ â€œè½¯è‚‹â€ åœ¨æ­¤</li>
<li>âœ¨ 3. å…³é”®çªç ´ï¼šè·¨ç±»å‹è¡¥ä½çš„ â€œé€šå…³ç§˜ç±â€</li>
<li>ğŸš¨ 4. ç»†èŠ‚æé†’ï¼šåˆ«è¸© â€œé»˜è®¤å€¼ç±»å‹â€ çš„å°å‘</li>
<li>ğŸ”® ç»“å°¾ï¼šå¤æ‚æ’å€¼ç°æ–°ç–‘ï¼Œç§˜ç±æ®‹é¡µè—ç„æœº</li>
</ul>
<p>å°±åœ¨ä»–å‡†å¤‡å†™ â€œç¬¨åŠæ³•â€ æ—¶ï¼Œçª—è¾¹ä¼ æ¥è½»æŸ”çš„å£°éŸ³ï¼šâ€œä¾¯å¤§ä¾ è«æ€¥ï¼Œæˆ‘è¿™æœ‰ SE-0477 çš„â€˜è¡¥ä½ç¥æŠ€â€™ï¼ˆ<strong>Default Value in String Interpolations</strong>ï¼‰ï¼Œä¸“è§£è¿™ç§â€˜ç±»å‹ä¸å¯¹ä»˜â€™çš„éš¾é¢˜ã€‚â€ åªè§ç¨‹çµç´ ä¸€èº«é’å¸ƒè¡£è£™ï¼Œæ‰‹ä¸­æ‹¿ç€æœ¬ã€ŠSwift æ’å€¼ç§˜ç±ã€‹ï¼Œç¬‘å®¹æ¸©å’Œå¦‚æ˜¥é£ã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f29f646596794177923d4b4054b3fe12~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn54aK54yr5L6v5L2p:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765678794&amp;x-signature=rxrb%2F%2Bmt%2Fb9w8TlQI5KnCCAxGDg%3D" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" loading="lazy"/></p>
<hr/>
<h2 data-id="heading-1">ğŸ¯ 1. æ–°æ‹›æ­ç§˜ï¼šSE-0477 çš„ â€œç®€çº¦è¡¥ä½æœ¯â€</h2>
<p>SE-0477 è¿™é—¨åŠŸæ³•ï¼Œçœ‹ä¼¼å°å·§ï¼Œå´è—ç€å¤§æ™ºæ…§ â€”â€” å®ƒç»™<strong>å­—ç¬¦ä¸²æ’å€¼ï¼ˆString Interpolationï¼‰</strong> é‡Œçš„<strong>å¯é€‰ç±»å‹ï¼ˆoptionalï¼‰</strong> åŠ äº† â€œè¡¥ä½åŠŸèƒ½â€ï¼š</p>
<blockquote>
<p>å¦‚æœå¯é€‰å€¼æ˜¯<code>nil</code>ï¼Œç›´æ¥åœ¨æ’å€¼é‡ŒæŒ‡å®šé»˜è®¤å€¼å°±è¡Œï¼Œä¸ç”¨å†å†™é¢å¤–çš„åˆ¤æ–­ã€‚</p>
</blockquote>
<p>ä¾¯ä½©å‡‘è¿‡å»ä¸€çœ‹ï¼Œç¨‹çµç´ å†™ä¸‹çš„åŸºç¡€ç”¨æ³•è®©ä»–çœ¼å‰ä¸€äº®ï¼š</p>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-keyword">var</span> name: <span class="hljs-type">String</span>? <span class="hljs-operator">=</span> <span class="hljs-literal">nil</span> <span class="hljs-comment">// ç”¨æˆ·æ²¡å¡«åå­—ï¼Œæ˜¯nil</span>

<span class="hljs-comment">// ç”¨SE-0477çš„æ–°è¯­æ³•ï¼šæ’å€¼é‡ŒåŠ (default: é»˜è®¤å€¼)</span>

<span class="hljs-built_in">print</span>(<span class="hljs-string">"Hello, <span class="hljs-subst">\(name, <span class="hljs-keyword">default</span>: <span class="hljs-string">"Anonymous"</span>)</span>!"</span>)

<span class="hljs-comment">// ç›´æ¥è¾“å‡ºï¼šHello, Anonymous!</span>
</code></pre>
<p>â€œè¿™æ¯”ä»¥å‰çš„<code>\(name ?? "Anonymous")</code>å°±å°‘ä¸ªé—®å·å•Šï¼Ÿâ€ ä¾¯ä½©æŒ æŒ å¤´ï¼Œå±±æ¥‚æ ¸å·®ç‚¹æ‰è¿›é”®ç›˜ç¼ï¼Œâ€œçœ‹ç€ä¹Ÿæ²¡å¤šå‰å®³å˜›ã€‚â€</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e8d63da0ad6c478eb7aaa0c38b98d9c8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn54aK54yr5L6v5L2p:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765678794&amp;x-signature=S47fj4g6QV7lS%2Fm6jQdB07DVWVo%3D" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" loading="lazy"/></p>
<p>ç¨‹çµç´ ç¬‘ç€æ‘‡å¤´ï¼šâ€œä¾¯å¤§ä¾ åˆ«æ€¥ï¼Œè¿™åªæ˜¯â€˜å¼€èƒƒå°èœâ€™ï¼ŒçœŸæ­£çš„å‰å®³ä¹‹å¤„ï¼Œä½ ä¸”åé¢å†çœ‹ã€‚â€</p>
<hr/>
<h2 data-id="heading-2">ğŸ¤” 2. åˆçœ‹å¹³æ·¡ï¼Ÿnil coalescing çš„ â€œè½¯è‚‹â€ åœ¨æ­¤</h2>
<p>ä¾¯ä½©ä¸æœæ°”ï¼Œæå‡ºä¹‹å‰èƒ½è·‘çš„ä»£ç ï¼šâ€œä½ çœ‹ï¼Œ<code>age ?? 0</code>å°±æ²¡é—®é¢˜ï¼Œæ‰“å°å‡ºæ¥æ˜¯â€˜Age: 0â€™ï¼Œä¹Ÿæ²¡æŠ¥é”™å•Šï¼â€</p>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-keyword">var</span> age: <span class="hljs-type">Int</span>? <span class="hljs-operator">=</span> <span class="hljs-literal">nil</span>

<span class="hljs-comment">// ä»¥å‰çš„nil coalescingï¼ˆç©ºåˆè¿ç®—ç¬¦ï¼‰å†™æ³•ï¼Œé»˜è®¤å€¼æ˜¯Intç±»å‹</span>

<span class="hljs-built_in">print</span>(<span class="hljs-string">"Age: <span class="hljs-subst">\(age <span class="hljs-operator">??</span> <span class="hljs-number">0</span>)</span>"</span>) <span class="hljs-comment">// è¾“å‡ºï¼šAge: 0</span>
</code></pre>
<p>â€œå¯è¦æ˜¯ä½ æƒ³ç»™â€˜Unknownâ€™å½“é»˜è®¤å€¼å‘¢ï¼Ÿâ€ ç¨‹çµç´ è½»è½»ä¸€ç‚¹å±å¹•ï¼Œâ€œæ¯”å¦‚äº§å“è¯´â€˜æ²¡å¹´é¾„å°±æ˜¾ç¤º â€œæœªçŸ¥â€â€™ï¼Œä½ å†è¯•è¯•ï¼Ÿâ€</p>
<p>ä¾¯ä½©ç«‹é©¬ä¿®æ”¹ï¼Œç»“æœçº¢è‰²æŠ¥é”™åˆå†’äº†å‡ºæ¥ï¼š</p>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-comment">// âŒ ç¼–è¯‘æŠ¥é”™ï¼šInt?å’ŒStringç±»å‹ä¸å…¼å®¹ï¼Œnil coalescingä¸æ”¯æŒè·¨ç±»å‹</span>

<span class="hljs-comment">// print("Age: \(age ?? "Unknown")")</span>
</code></pre>
<p>â€œè¿™ä¸å°±å¡å£³äº†ï¼Ÿâ€ ç¨‹çµç´ èå°”ï¼Œâ€œ<code>nil coalescing</code>ï¼ˆç©ºåˆè¿ç®—ç¬¦ï¼‰çš„è½¯è‚‹å°±åœ¨è¿™ â€”â€” å®ƒè¦æ±‚é»˜è®¤å€¼å’Œå¯é€‰å€¼<strong>ç±»å‹å¿…é¡»ä¸€è‡´</strong>ï¼Œå°±åƒç³–è‘«èŠ¦åªèƒ½ä¸²å±±æ¥‚ï¼Œä¸èƒ½æ··ç€åŒ…å­ä¸²ã€‚â€</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e87a686878624a0b8133aa4fee77fb5a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn54aK54yr5L6v5L2p:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765678794&amp;x-signature=IVUfo6dhvq4L3esHRiHpMwVZV6A%3D" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" loading="lazy"/></p>
<p>ä¾¯ä½©æç„¶å¤§æ‚Ÿï¼Œæ‹äº†ä¸‹å¤§è…¿ï¼ˆå·®ç‚¹æŠŠç³–è‘«èŠ¦æ‹æ‰ï¼‰ï¼šâ€œåŸæ¥å¦‚æ­¤ï¼æˆ‘ä¹‹å‰ç»•è¿œè·¯è½¬ç±»å‹ï¼Œå°±æ˜¯å› ä¸ºè¿™â€˜ç±»å‹é”â€™ï¼â€</p>
<hr/>
<h2 data-id="heading-3">âœ¨ 3. å…³é”®çªç ´ï¼šè·¨ç±»å‹è¡¥ä½çš„ â€œé€šå…³ç§˜ç±â€</h2>
<p>â€œåˆ«æ€¥ï¼ŒSE-0477 çš„â€˜è¡¥ä½ç¥æŠ€â€™ï¼Œå°±æ˜¯æ¥è§£è¿™â€˜ç±»å‹é”â€™çš„ã€‚â€</p>
<p>ç¨‹çµç´ æ‹¿èµ·ç¬”ï¼Œåœ¨çº¸ä¸Šå†™ä¸‹å…³é”®ä»£ç ï¼š</p>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-keyword">var</span> age: <span class="hljs-type">Int</span>? <span class="hljs-operator">=</span> <span class="hljs-literal">nil</span>

<span class="hljs-comment">// âœ… Swift 6.2+æ–°è¯­æ³•ï¼šæ’å€¼é‡Œç›´æ¥ç»™ä¸åŒç±»å‹çš„é»˜è®¤å€¼</span>

<span class="hljs-built_in">print</span>(<span class="hljs-string">"Age: <span class="hljs-subst">\(age, <span class="hljs-keyword">default</span>: <span class="hljs-string">"Unknown"</span>)</span>"</span>);

<span class="hljs-comment">// è¾“å‡ºï¼šAge: Unknown</span>
</code></pre>
<p>ä¾¯ä½©çœ¼ç›çªå¾—æºœåœ†ï¼Œèµ¶ç´§åœ¨ç”µè„‘ä¸Šè¯•äº†è¯• â€”â€” å±…ç„¶çœŸçš„ç¼–è¯‘é€šè¿‡ï¼Œè¿è¡Œç»“æœå®Œç¾ï¼</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ab53348d05154b24a3c35f9e70266a0a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn54aK54yr5L6v5L2p:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765678794&amp;x-signature=9mLY9S4bshJESHJ0QBsTtxOACmo%3D" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" loading="lazy"/></p>
<p>â€œè¿™ä¹Ÿå¤ªä¸æ»‘äº†å§ï¼â€ ä¾¯ä½©æ¿€åŠ¨åœ°å’¬äº†å£ç³–è‘«èŠ¦ï¼Œâ€œä¸ç”¨è½¬ç±»å‹ï¼Œä¸ç”¨å†™é¢å¤–åˆ¤æ–­ï¼Œåƒç¨‹å§‘å¨˜ä½ é…è¯ä¸€æ ·ï¼Œæ—¢ç²¾å‡†åˆçœäº‹ï¼â€</p>
<p>ç¨‹çµç´ è¡¥å……é“ï¼šâ€œå®ƒçš„åŸç†å¾ˆç®€å• â€”â€” æ’å€¼æ—¶ Swift ä¼šè‡ªåŠ¨å¤„ç†ç±»å‹è½¬æ¢ï¼ŒæŠŠ<code>Int?</code>å’Œ<code>String</code>çš„é»˜è®¤å€¼â€˜è°ƒå’Œâ€™æˆå­—ç¬¦ä¸²è¾“å‡ºï¼Œå°±åƒæˆ‘é…è¯æ—¶è°ƒå’Œä¸åŒè¯æï¼Œè®©å®ƒä»¬å‘æŒ¥åˆåŠ›ã€‚â€</p>
<p>ä¸ºäº†è®©ä¾¯ä½©å½»åº•æ˜ç™½ï¼Œå¥¹åˆå†™äº†ä¸ª â€œç”¨æˆ·ä¿¡æ¯æ±‡æ€»â€ çš„å®æˆ˜ä¾‹å­ï¼š</p>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-comment">// æ¨¡æ‹Ÿç”¨æˆ·æ•°æ®ï¼šnameæ˜¯String?ï¼Œageæ˜¯Int?ï¼Œscoreæ˜¯Double?</span>
<span class="hljs-keyword">struct</span> <span class="hljs-title class_">User</span> {
    <span class="hljs-keyword">var</span> name: <span class="hljs-type">String</span>?
    <span class="hljs-keyword">var</span> age: <span class="hljs-type">Int</span>?
    <span class="hljs-keyword">var</span> score: <span class="hljs-type">Double</span>?
}

<span class="hljs-keyword">let</span> user <span class="hljs-operator">=</span> <span class="hljs-type">User</span>(name: <span class="hljs-literal">nil</span>, age: <span class="hljs-literal">nil</span>, score: <span class="hljs-number">89.5</span>)

<span class="hljs-comment">// ç”¨SE-0477ç»Ÿä¸€å¤„ç†æ‰€æœ‰å¯é€‰å€¼çš„é»˜è®¤å€¼ï¼Œç±»å‹äº’ä¸å¹²æ‰°</span>
<span class="hljs-keyword">let</span> userInfo <span class="hljs-operator">=</span> <span class="hljs-string">"""
ç”¨æˆ·æ˜µç§°ï¼š<span class="hljs-subst">\(user.name, <span class="hljs-keyword">default</span>: <span class="hljs-string">"åŒ¿åç”¨æˆ·"</span>)</span>
ç”¨æˆ·å¹´é¾„ï¼š<span class="hljs-subst">\(user.age, <span class="hljs-keyword">default</span>: <span class="hljs-string">"æœªå¡«å†™"</span>)</span>
ç”¨æˆ·åˆ†æ•°ï¼š<span class="hljs-subst">\(user.score, <span class="hljs-keyword">default</span>: <span class="hljs-string">"æš‚æ— æ•°æ®"</span>)</span>
"""</span>

<span class="hljs-built_in">print</span>(userInfo)
<span class="hljs-comment">/* è¾“å‡ºç»“æœï¼š
ç”¨æˆ·æ˜µç§°ï¼šåŒ¿åç”¨æˆ·
ç”¨æˆ·å¹´é¾„ï¼šæœªå¡«å†™
ç”¨æˆ·åˆ†æ•°ï¼š89.5
*/</span>
</code></pre>
<p>â€œä½ çœ‹ï¼Œä¸ç®¡æ˜¯ Stringã€Int è¿˜æ˜¯ Double çš„å¯é€‰å€¼ï¼Œéƒ½èƒ½æŒ‰éœ€æ±‚ç»™ä¸åŒç±»å‹çš„é»˜è®¤å€¼ï¼Œå†ä¹Ÿä¸ç”¨â€˜æ‹†ä¸œè¡¥è¥¿â€™äº†ã€‚â€ ç¨‹çµç´ è¯´ã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1cb570487b6e4580bb15125212f48abd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn54aK54yr5L6v5L2p:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765678794&amp;x-signature=vQeTDhwdYpWbfPvmI5URNY%2FPYvY%3D" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" loading="lazy"/></p>
<p>ä¾¯ä½©è¿è¿ç‚¹å¤´ï¼Œè¾¹è®°ç¬”è®°è¾¹å˜€å’•ï¼šâ€œè¿™æ‹›æ¯”æˆ‘ä¹‹å‰â€˜å…ˆåˆ¤æ–­ nilï¼Œå†è½¬ç±»å‹ï¼Œå†æ‹¼æ¥â€™çš„ç¬¨åŠæ³•ï¼Œæ•ˆç‡é«˜äº†ä¸æ­¢ä¸€ç‚¹ï¼Œè¿˜èƒ½å°‘å†™å¥½å‡ è¡Œä»£ç  â€”â€” æ¯•ç«Ÿå†™ä»£ç å°±åƒåƒåŒ…å­ï¼Œèƒ½ä¸€å£è§£å†³çš„ï¼Œç»ä¸å’¬ç¬¬äºŒå£ï¼â€</p>
<hr/>
<h2 data-id="heading-4">ğŸš¨ 4. ç»†èŠ‚æé†’ï¼šåˆ«è¸© â€œé»˜è®¤å€¼ç±»å‹â€ çš„å°å‘</h2>
<p>ç¨‹çµç´ çªç„¶è¯é”‹ä¸€è½¬ï¼šâ€œä¸è¿‡æœ‰ä¸ªå°ç»†èŠ‚è¦æ³¨æ„ â€”â€” é»˜è®¤å€¼çš„ç±»å‹å¾—æ˜¯â€˜èƒ½è½¬æˆå­—ç¬¦ä¸²â€™çš„ï¼Œæ¯”å¦‚æ•°å­—ã€å¸ƒå°”å€¼ã€å­—ç¬¦ä¸²éƒ½è¡Œï¼Œä½†è¦æ˜¯ä¼ ä¸ª<code>UIView?</code>è¿™ç§â€˜ä¸å¥½è½¬å­—ç¬¦ä¸²â€™çš„ç±»å‹ï¼Œè¿˜æ˜¯ä¼šæŠ¥é”™ã€‚â€</p>
<p>å¥¹ä¸¾äº†ä¸ªåä¾‹ï¼š</p>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-keyword">import</span> UIKit

<span class="hljs-keyword">var</span> view: <span class="hljs-type">UIView</span>? <span class="hljs-operator">=</span> <span class="hljs-literal">nil</span>

<span class="hljs-comment">// âŒ ç¼–è¯‘æŠ¥é”™ï¼šUIViewç±»å‹æ— æ³•ç›´æ¥è½¬æˆå­—ç¬¦ä¸²ï¼Œé»˜è®¤å€¼ä¹Ÿå¾—æ˜¯â€œå¯å­—ç¬¦ä¸²åŒ–â€çš„</span>

<span class="hljs-comment">// print("View: \(view, default: "No View")")</span>
</code></pre>
<p>â€œå“¦ï¼è¿™å°±åƒé…è¯ä¸èƒ½æ”¾â€˜ä¸èƒ½å…¥å£â€™çš„è¯æï¼Œå¯¹å§ï¼Ÿâ€ ä¾¯ä½©ç«‹é©¬ get åˆ°ï¼Œâ€œå¾—ç¡®ä¿é»˜è®¤å€¼æœ¬èº«èƒ½â€˜å˜æˆå­—ç¬¦ä¸²â€™ï¼Œä¸ç„¶ Swift ä¹Ÿâ€˜è°ƒä¸åŒ€â€™ã€‚â€</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bd54c1d7a97d4a3fb4c90dd97f09dcc8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn54aK54yr5L6v5L2p:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765678794&amp;x-signature=8uKEbkWwOqJUnvfkotLXap%2FhGtA%3D" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" loading="lazy"/></p>
<p>ç¨‹çµç´ ç¬‘ç€ç‚¹å¤´ï¼šâ€œæ­£æ˜¯è¿™ä¸ªç†ã€‚ä¸è¿‡å¤§éƒ¨åˆ†æ—¥å¸¸å¼€å‘åœºæ™¯ï¼Œæ¯”å¦‚ç”¨æˆ·ä¿¡æ¯ã€æ—¥å¿—æ‰“å°ï¼Œå¸¸ç”¨ç±»å‹éƒ½èƒ½æ”¯æŒï¼Œè¿™æ‹›å·²ç»èƒ½è§£å†³ä¹æˆä»¥ä¸Šçš„æ’å€¼éš¾é¢˜äº†ã€‚â€</p>
<hr/>
<h2 data-id="heading-5">ğŸ”® ç»“å°¾ï¼šå¤æ‚æ’å€¼ç°æ–°ç–‘ï¼Œç§˜ç±æ®‹é¡µè—ç„æœº</h2>
<p>ä¾¯ä½©å½»åº•æŒæ¡äº† â€œè¡¥ä½ç¥æŠ€â€ï¼Œå¼€å¿ƒåœ°æŠŠå‰©ä¸‹çš„ç³–è‘«èŠ¦åƒå®Œï¼Œè¿˜æƒ³è¯•è¯•æ›´å¤æ‚çš„åœºæ™¯ â€”â€” æ¯”å¦‚åœ¨æ’å€¼é‡ŒåŠ è®¡ç®—ï¼Œåƒ<code>\(user.score.map { $0 * 10 }, default: "æš‚æ— ")</code>ã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1127128e6dd54304a8043a394f28d145~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn54aK54yr5L6v5L2p:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765678794&amp;x-signature=rhILGmE0PrDD5lqBSN18pS6fxhE%3D" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" loading="lazy"/></p>
<p>å¯åˆšå†™å®Œï¼Œä»–åˆæ„£ä½äº†ï¼šâ€œå“ï¼Ÿè¿™é‡ŒåŠ äº†<code>map</code>å¤„ç†ï¼Œé»˜è®¤å€¼è¿˜èƒ½ç”¨å—ï¼Ÿâ€</p>
<p>ç¨‹çµç´ å‡‘è¿‡æ¥çœ‹äº†çœ‹ï¼ŒæŒ‡äº†æŒ‡ã€ŠSwift æ’å€¼ç§˜ç±ã€‹æœ€åä¸€é¡µçš„æ®‹é¡µï¼šâ€œ<strong>Add Collection conformances for enumerated()</strong>â€</p>
<p>ä¾¯ä½©ç›¯ç€æ®‹é¡µä¸Šæ¨¡ç³Šçš„å­—è¿¹ï¼Œå¥½å¥‡å¿ƒè¢«å‹¾äº†èµ·æ¥ï¼šâ€œéš¾é“è¿˜æœ‰æ›´å‰å®³çš„æ‹›å¼ï¼Ÿä¸‹æ¬¡å’±ä»¬å¯å¾—å¥½å¥½ç ”ç©¶ç ”ç©¶ï¼â€</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Redisï¼ˆ169ï¼‰å¦‚ä½•ä½¿ç”¨Rediså®ç°æ•°æ®åŒæ­¥ï¼Ÿ]]></title>    <link>https://juejin.cn/post/7580288235031248896</link>    <guid>https://juejin.cn/post/7580288235031248896</guid>    <pubDate>2025-12-06T23:06:03.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7580288235031248896" data-draft-id="7580312375372611624" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Redisï¼ˆ169ï¼‰å¦‚ä½•ä½¿ç”¨Rediså®ç°æ•°æ®åŒæ­¥ï¼Ÿ"/> <meta itemprop="keywords" content="åç«¯"/> <meta itemprop="datePublished" content="2025-12-06T23:06:03.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Victor356"/> <meta itemprop="url" content="https://juejin.cn/user/3492507879476878"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Redisï¼ˆ169ï¼‰å¦‚ä½•ä½¿ç”¨Rediså®ç°æ•°æ®åŒæ­¥ï¼Ÿ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3492507879476878/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Victor356
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-06T23:06:03.000Z" title="Sat Dec 06 2025 23:06:03 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-06
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    11
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»4åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>ä½¿ç”¨Rediså®ç°æ•°æ®åŒæ­¥æ˜¯ä¸€ç§æœ‰æ•ˆçš„æ–¹æ³•ï¼Œç‰¹åˆ«é€‚åˆäºéœ€è¦åœ¨å¤šå°æœåŠ¡å™¨ä¹‹é—´ä¿æŒæ•°æ®ä¸€è‡´æ€§çš„åœºæ™¯ã€‚Redisæä¾›äº†å¤šç§æœºåˆ¶æ¥å®ç°æ•°æ®åŒæ­¥ï¼ŒåŒ…æ‹¬ä¸»ä»å¤åˆ¶ã€å‘å¸ƒè®¢é˜…å’ŒRedis Streamsç­‰ã€‚</p>
<h3 data-id="heading-0">1. æ•°æ®åŒæ­¥çš„åŸºæœ¬æ¦‚å¿µ</h3>
<p>æ•°æ®åŒæ­¥ä¸»è¦åŒ…æ‹¬ä»¥ä¸‹å‡ ä¸ªéƒ¨åˆ†ï¼š</p>
<ol>
<li><strong>æ•°æ®æ”¶é›†å’Œå¤„ç†</strong>ï¼šæ¥æ”¶å¹¶å¤„ç†éœ€è¦åŒæ­¥çš„æ•°æ®ã€‚</li>
<li><strong>æ•°æ®å­˜å‚¨</strong>ï¼šå°†å¤„ç†åçš„æ•°æ®å­˜å‚¨åœ¨Redisä¸­ã€‚</li>
<li><strong>æ•°æ®åŒæ­¥æœºåˆ¶</strong>ï¼šåˆ©ç”¨Redisçš„å¤åˆ¶ã€å‘å¸ƒè®¢é˜…æˆ–Streamsç­‰æœºåˆ¶å®ç°æ•°æ®åŒæ­¥ã€‚</li>
<li><strong>æ•°æ®æ¶ˆè´¹</strong>ï¼šä»Redisä¸­è¯»å–å¹¶å¤„ç†åŒæ­¥çš„æ•°æ®ã€‚</li>
</ol>
<h3 data-id="heading-1">2. ä½¿ç”¨Rediså®ç°æ•°æ®åŒæ­¥</h3>
<h4 data-id="heading-2">2.1 ä½¿ç”¨Redisä¸»ä»å¤åˆ¶</h4>
<p>Redisçš„ä¸»ä»å¤åˆ¶å¯ä»¥å®ç°æ•°æ®åœ¨å¤šä¸ªRediså®ä¾‹ä¹‹é—´çš„åŒæ­¥ã€‚é…ç½®ä¸€ä¸ªRediså®ä¾‹ä¸ºä¸»èŠ‚ç‚¹ï¼Œå…¶ä»–å®ä¾‹ä¸ºä»èŠ‚ç‚¹ï¼Œä»èŠ‚ç‚¹ä¼šè‡ªåŠ¨åŒæ­¥ä¸»èŠ‚ç‚¹çš„æ•°æ®ã€‚</p>
<h5 data-id="heading-3">é…ç½®ä¸»ä»å¤åˆ¶</h5>
<ol>
<li><strong>é…ç½®ä¸»èŠ‚ç‚¹</strong>ï¼šä¸»èŠ‚ç‚¹ä¸éœ€è¦é¢å¤–é…ç½®ï¼Œå¯åŠ¨å³å¯ã€‚</li>
<li><strong>é…ç½®ä»èŠ‚ç‚¹</strong>ï¼šåœ¨ä»èŠ‚ç‚¹çš„é…ç½®æ–‡ä»¶ä¸­æ·»åŠ ä»¥ä¸‹é…ç½®ï¼š
<pre><code class="hljs language-plaintext" lang="plaintext">replicaof &lt;master-ip&gt; &lt;master-port&gt;
</code></pre>
</li>
</ol>
<p>å¯åŠ¨Rediså®ä¾‹åï¼Œä»èŠ‚ç‚¹ä¼šè‡ªåŠ¨åŒæ­¥ä¸»èŠ‚ç‚¹çš„æ•°æ®ã€‚</p>
<h4 data-id="heading-4">2.2 ä½¿ç”¨Rediså‘å¸ƒè®¢é˜…</h4>
<p>Redisçš„å‘å¸ƒè®¢é˜…ï¼ˆPub/Subï¼‰æœºåˆ¶æ˜¯ä¸€ç§æ¶ˆæ¯ä¼ é€’æ¨¡å‹ï¼Œå¯ä»¥åœ¨å¤šä¸ªå®¢æˆ·ç«¯ä¹‹é—´ä¼ é€’æ¶ˆæ¯ã€‚å‘å¸ƒè€…å°†æ¶ˆæ¯å‘å¸ƒåˆ°ç‰¹å®šé¢‘é“ï¼Œè®¢é˜…è€…æ¥æ”¶è¯¥é¢‘é“çš„æ¶ˆæ¯ã€‚</p>
<h5 data-id="heading-5">ç¤ºä¾‹ï¼šä½¿ç”¨å‘å¸ƒè®¢é˜…è¿›è¡Œæ•°æ®åŒæ­¥</h5>
<p>ä»¥ä¸‹ç¤ºä¾‹å±•ç¤ºäº†å¦‚ä½•ä½¿ç”¨Redisçš„å‘å¸ƒè®¢é˜…æœºåˆ¶æ¥å®ç°æ•°æ®åŒæ­¥ã€‚</p>
<h6 data-id="heading-6">å‘å¸ƒè€…ï¼ˆProducerï¼‰</h6>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> redis.clients.jedis.Jedis;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RedisPublisher</span> {
    <span class="hljs-keyword">private</span> Jedis jedis;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">CHANNEL_NAME</span> <span class="hljs-operator">=</span> <span class="hljs-string">"data_sync_channel"</span>;

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">RedisPublisher</span><span class="hljs-params">()</span> {
        <span class="hljs-built_in">this</span>.jedis = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Jedis</span>(<span class="hljs-string">"localhost"</span>);
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">publishData</span><span class="hljs-params">(String data)</span> {
        jedis.publish(CHANNEL_NAME, data);
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">close</span><span class="hljs-params">()</span> {
        jedis.close();
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-type">RedisPublisher</span> <span class="hljs-variable">publisher</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RedisPublisher</span>();
        publisher.publishData(<span class="hljs-string">"Hello, Redis!"</span>);
        publisher.close();
    }
}
</code></pre>
<h6 data-id="heading-7">è®¢é˜…è€…ï¼ˆSubscriberï¼‰</h6>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> redis.clients.jedis.Jedis;
<span class="hljs-keyword">import</span> redis.clients.jedis.JedisPubSub;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RedisSubscriber</span> {
    <span class="hljs-keyword">private</span> Jedis jedis;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">CHANNEL_NAME</span> <span class="hljs-operator">=</span> <span class="hljs-string">"data_sync_channel"</span>;

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">RedisSubscriber</span><span class="hljs-params">()</span> {
        <span class="hljs-built_in">this</span>.jedis = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Jedis</span>(<span class="hljs-string">"localhost"</span>);
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">subscribe</span><span class="hljs-params">()</span> {
        jedis.subscribe(<span class="hljs-keyword">new</span> <span class="hljs-title class_">JedisPubSub</span>() {
            <span class="hljs-meta">@Override</span>
            <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onMessage</span><span class="hljs-params">(String channel, String message)</span> {
                System.out.println(<span class="hljs-string">"Received message: "</span> + message);
            }
        }, CHANNEL_NAME);
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">close</span><span class="hljs-params">()</span> {
        jedis.close();
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-type">RedisSubscriber</span> <span class="hljs-variable">subscriber</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RedisSubscriber</span>();
        subscriber.subscribe();
        subscriber.close();
    }
}
</code></pre>
<h4 data-id="heading-8">2.3 ä½¿ç”¨Redis Streams</h4>
<p>Redis Streamsæ˜¯ä¸€ç§é«˜çº§çš„æ•°æ®ç»“æ„ï¼Œé€‚ç”¨äºæ—¥å¿—å’Œæ¶ˆæ¯é˜Ÿåˆ—ç­‰åœºæ™¯ï¼Œå¯ä»¥å®ç°æ›´å¤æ‚çš„æ•°æ®åŒæ­¥éœ€æ±‚ã€‚</p>
<h5 data-id="heading-9">ç¤ºä¾‹ï¼šä½¿ç”¨Redis Streamsè¿›è¡Œæ•°æ®åŒæ­¥</h5>
<p>ä»¥ä¸‹ç¤ºä¾‹å±•ç¤ºäº†å¦‚ä½•ä½¿ç”¨Redis Streamsæ¥å®ç°æ•°æ®åŒæ­¥ã€‚</p>
<h6 data-id="heading-10">æ•°æ®ç”Ÿäº§è€…ï¼ˆProducerï¼‰</h6>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> redis.clients.jedis.Jedis;
<span class="hljs-keyword">import</span> redis.clients.jedis.StreamEntryID;

<span class="hljs-keyword">import</span> java.util.HashMap;
<span class="hljs-keyword">import</span> java.util.Map;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RedisStreamProducer</span> {
    <span class="hljs-keyword">private</span> Jedis jedis;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">STREAM_NAME</span> <span class="hljs-operator">=</span> <span class="hljs-string">"data_stream"</span>;

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">RedisStreamProducer</span><span class="hljs-params">()</span> {
        <span class="hljs-built_in">this</span>.jedis = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Jedis</span>(<span class="hljs-string">"localhost"</span>);
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">publishData</span><span class="hljs-params">(String data)</span> {
        Map&lt;String, String&gt; message = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();
        message.put(<span class="hljs-string">"data"</span>, data);
        jedis.xadd(STREAM_NAME, StreamEntryID.NEW_ENTRY, message);
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">close</span><span class="hljs-params">()</span> {
        jedis.close();
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-type">RedisStreamProducer</span> <span class="hljs-variable">producer</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RedisStreamProducer</span>();
        producer.publishData(<span class="hljs-string">"Hello, Redis Streams!"</span>);
        producer.close();
    }
}
</code></pre>
<h6 data-id="heading-11">æ•°æ®æ¶ˆè´¹è€…ï¼ˆConsumerï¼‰</h6>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> redis.clients.jedis.Jedis;
<span class="hljs-keyword">import</span> redis.clients.jedis.StreamEntry;
<span class="hljs-keyword">import</span> redis.clients.jedis.StreamEntryID;
<span class="hljs-keyword">import</span> redis.clients.jedis.StreamPendingEntry;

<span class="hljs-keyword">import</span> java.util.List;
<span class="hljs-keyword">import</span> java.util.Map;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RedisStreamConsumer</span> {
    <span class="hljs-keyword">private</span> Jedis jedis;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">STREAM_NAME</span> <span class="hljs-operator">=</span> <span class="hljs-string">"data_stream"</span>;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">CONSUMER_GROUP</span> <span class="hljs-operator">=</span> <span class="hljs-string">"data_group"</span>;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">CONSUMER_NAME</span> <span class="hljs-operator">=</span> <span class="hljs-string">"consumer_1"</span>;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">COUNT</span> <span class="hljs-operator">=</span> <span class="hljs-number">10</span>;

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">RedisStreamConsumer</span><span class="hljs-params">()</span> {
        <span class="hljs-built_in">this</span>.jedis = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Jedis</span>(<span class="hljs-string">"localhost"</span>);
        createConsumerGroup();
    }

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">createConsumerGroup</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">try</span> {
            jedis.xgroupCreate(STREAM_NAME, CONSUMER_GROUP, StreamEntryID.LAST_ENTRY, <span class="hljs-literal">true</span>);
        } <span class="hljs-keyword">catch</span> (Exception e) {
            <span class="hljs-comment">// Consumer group already exists</span>
        }
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">consumeData</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">while</span> (<span class="hljs-literal">true</span>) {
            List&lt;StreamEntry&gt; entries = jedis.xreadGroup(CONSUMER_GROUP, CONSUMER_NAME, COUNT, <span class="hljs-number">0</span>, <span class="hljs-literal">false</span>, STREAM_NAME, StreamEntryID.UNRECEIVED_ENTRY);
            <span class="hljs-keyword">for</span> (StreamEntry entry : entries) {
                Map&lt;String, String&gt; message = entry.getFields();
                processMessage(message);
                jedis.xack(STREAM_NAME, CONSUMER_GROUP, entry.getID());
            }
        }
    }

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">processMessage</span><span class="hljs-params">(Map&lt;String, String&gt; message)</span> {
        System.out.println(<span class="hljs-string">"Received message: "</span> + message.get(<span class="hljs-string">"data"</span>));
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">close</span><span class="hljs-params">()</span> {
        jedis.close();
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-type">RedisStreamConsumer</span> <span class="hljs-variable">consumer</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RedisStreamConsumer</span>();
        consumer.consumeData();
        consumer.close();
    }
}
</code></pre>
<h3 data-id="heading-12">3. ç»¼åˆç¤ºä¾‹ï¼šæ•°æ®åŒæ­¥ç³»ç»Ÿ</h3>
<p>å°†ä¸Šè¿°å„éƒ¨åˆ†ç»“åˆèµ·æ¥ï¼Œå®ç°ä¸€ä¸ªå®Œæ•´çš„æ•°æ®åŒæ­¥ç³»ç»Ÿã€‚</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> redis.clients.jedis.Jedis;
<span class="hljs-keyword">import</span> redis.clients.jedis.JedisPubSub;
<span class="hljs-keyword">import</span> redis.clients.jedis.StreamEntryID;

<span class="hljs-keyword">import</span> java.util.HashMap;
<span class="hljs-keyword">import</span> java.util.Map;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RedisDataSyncSystem</span> {

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">CHANNEL_NAME</span> <span class="hljs-operator">=</span> <span class="hljs-string">"data_sync_channel"</span>;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">STREAM_NAME</span> <span class="hljs-operator">=</span> <span class="hljs-string">"data_stream"</span>;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">CONSUMER_GROUP</span> <span class="hljs-operator">=</span> <span class="hljs-string">"data_group"</span>;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">CONSUMER_NAME</span> <span class="hljs-operator">=</span> <span class="hljs-string">"consumer_1"</span>;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">COUNT</span> <span class="hljs-operator">=</span> <span class="hljs-number">10</span>;

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-comment">// 1. å‘å¸ƒè®¢é˜…æœºåˆ¶</span>
        <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(RedisDataSyncSystem::startSubscriber).start();
        <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; {
            <span class="hljs-keyword">try</span> {
                Thread.sleep(<span class="hljs-number">1000</span>); <span class="hljs-comment">// ç¡®ä¿è®¢é˜…è€…å·²å¯åŠ¨</span>
            } <span class="hljs-keyword">catch</span> (InterruptedException e) {
                e.printStackTrace();
            }
            startPublisher();
        }).start();

        <span class="hljs-comment">// 2. Redis Streamsæœºåˆ¶</span>
        <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(RedisDataSyncSystem::startStreamConsumer).start();
        <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; {
            <span class="hljs-keyword">try</span> {
                Thread.sleep(<span class="hljs-number">1000</span>); <span class="hljs-comment">// ç¡®ä¿æ¶ˆè´¹è€…å·²å¯åŠ¨</span>
            } <span class="hljs-keyword">catch</span> (InterruptedException e) {
                e.printStackTrace();
            }
            startStreamProducer();
        }).start();
    }

    <span class="hljs-comment">// å‘å¸ƒè€…</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">startPublisher</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">try</span> (<span class="hljs-type">Jedis</span> <span class="hljs-variable">jedis</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Jedis</span>(<span class="hljs-string">"localhost"</span>)) {
            jedis.publish(CHANNEL_NAME, <span class="hljs-string">"Hello, Redis Pub/Sub!"</span>);
        }
    }

    <span class="hljs-comment">// è®¢é˜…è€…</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">startSubscriber</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">try</span> (<span class="hljs-type">Jedis</span> <span class="hljs-variable">jedis</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Jedis</span>(<span class="hljs-string">"localhost"</span>)) {
            jedis.subscribe(<span class="hljs-keyword">new</span> <span class="hljs-title class_">JedisPubSub</span>() {
                <span class="hljs-meta">@Override</span>
                <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onMessage</span><span class="hljs-params">(String channel, String message)</span> {
                    System.out.println(<span class="hljs-string">"Received message: "</span> + message);
                }
            }, CHANNEL_NAME);
        }
    }

    <span class="hljs-comment">// æ•°æ®ç”Ÿäº§è€…ï¼ˆStreamsï¼‰</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">startStreamProducer</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">try</span> (<span class="hljs-type">Jedis</span> <span class="hljs-variable">jedis</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Jedis</span>(<span class="hljs-string">"localhost"</span>)) {
            Map&lt;String, String&gt; message = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();
            message.put(<span class="hljs-string">"data"</span>, <span class="hljs-string">"Hello, Redis Streams!"</span>);
            jedis.xadd(STREAM_NAME, StreamEntryID.NEW_ENTRY, message);
        }
    }

    <span class="hljs-comment">// æ•°æ®æ¶ˆè´¹è€…ï¼ˆStreamsï¼‰</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">startStreamConsumer</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">try</span> (<span class="hljs-type">Jedis</span> <span class="hljs-variable">jedis</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Jedis</span>(<span class="hljs-string">"localhost"</span>)) {
            createConsumerGroup(jedis);
            <span class="hljs-keyword">while</span> (<span class="hljs-literal">true</span>) {
                List&lt;StreamEntry&gt; entries = jedis.xreadGroup(CONSUMER_GROUP, CONSUMER_NAME, COUNT, <span class="hljs-number">0</span>, <span class="hljs-literal">false</span>, STREAM_NAME, StreamEntryID.UNRECEIVED_ENTRY);
                <span class="hljs-keyword">for</span> (StreamEntry entry : entries) {
                    Map&lt;String, String&gt; message = entry.getFields();
                    processMessage(message);
                    jedis.xack(STREAM_NAME, CONSUMER_GROUP, entry.getID());
                }
            }
        }
    }

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">createConsumerGroup</span><span class="hljs-params">(Jedis jedis)</span> {
        <span class="hljs-keyword">try</span> {
            jedis.xgroupCreate(STREAM_NAME, CONSUMER_GROUP, StreamEntryID.LAST_ENTRY, <span class="hljs-literal">true</span>);
        } <span class="hljs-keyword">catch</span> (Exception e) {
            <span class="hljs-comment">// Consumer group already exists</span>
        }
    }

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">processMessage</span><span class="hljs-params">(Map&lt;String, String&gt; message)</span> {
        System.out.println(<span class="hljs-string">"Received stream message: "</span> + message.get(<span class="hljs-string">"data"</span>));
    }
}
</code></pre>
<h3 data-id="heading-13">æ€»ç»“</h3>
<p>é€šè¿‡ä¸Šé¢çš„ç¤ºä¾‹ï¼Œæˆ‘ä»¬å±•ç¤ºäº†å¦‚ä½•ä½¿ç”¨Rediså®ç°æ•°æ®åŒæ­¥ï¼ŒåŒ…æ‹¬ä½¿ç”¨Redisçš„ä¸»ä»å¤åˆ¶æœºåˆ¶ã€å‘å¸ƒè®¢é˜…æœºåˆ¶å’ŒRedis Streamsæœºåˆ¶ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[è½¯ä»¶å·¥ç¨‹å¸ˆå¿…é¡»è¦æŒæ¡çš„æ³³é“å›¾]]></title>    <link>https://juejin.cn/post/7580423629164068916</link>    <guid>https://juejin.cn/post/7580423629164068916</guid>    <pubDate>2025-12-07T06:07:26.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7580423629164068916" data-draft-id="7580592190020239394" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="è½¯ä»¶å·¥ç¨‹å¸ˆå¿…é¡»è¦æŒæ¡çš„æ³³é“å›¾"/> <meta itemprop="keywords" content="åç«¯"/> <meta itemprop="datePublished" content="2025-12-07T06:07:26.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="uzong"/> <meta itemprop="url" content="https://juejin.cn/user/372082495985181"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            è½¯ä»¶å·¥ç¨‹å¸ˆå¿…é¡»è¦æŒæ¡çš„æ³³é“å›¾
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/372082495985181/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    uzong
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-07T06:07:26.000Z" title="Sun Dec 07 2025 06:07:26 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-07
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»4åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body blockquote&gt;:first-child{margin-top:0}.markdown-body blockquote&gt;:last-child{margin-bottom:0}.markdown-body{overflow:hidden;line-height:1.75;font-size:15px;background-image:linear-gradient(90deg,rgba(72,42,10,.05) 5%,rgba(72,42,10,0) 0),linear-gradient(1turn,rgba(72,42,10,.05) 5%,rgba(72,42,10,0) 0);background-size:20px 20px;background-position:50%;padding-top:0!important}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{position:relative;display:flex;border-bottom:5px solid #6d4e00;line-height:35px;letter-spacing:1px;font-size:25px;padding-left:25px;color:#664900;text-shadow:1px 1px 1px #8a6200;padding-bottom:0}.markdown-body h1:before{content:"";display:flex;position:absolute;left:0;top:3px;bottom:0;margin:auto;width:20px;height:20px;background-size:20px 20px;background-image:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMgAAADICAMAAACahl6sAAAAQlBMVEVHcEwlRnqtZBj76q4lRnolRnolRnolRnolRnokRnr/gGtrVUeLXDBKTl+hYSHasW7Ik0zs0JG4dCvUdEE0SW+rYxrLQJfjAAAACnRSTlMA////0H/xUaMi5MCoTwAACfVJREFUeNrtnQl3qygUgJ9GXAqosfL//+pgmgXwXmRNJGdu55xO+6rx8+6I8O9fehmGriN93zdN07bVXdpW/ih/SbpuGP6dXbpOXv7z2i3S9ISck2eQOnAhMHG64VQQbmrAaM4B05GmipaGdB+m6BNQPBXzMYtKR3EPbB/RS5eY4g+lIW9WBqnySCvVMrzRpqqs0g9nwVg5p1KYlHEchRT5bftp+y3n6xlQDjAkABtrKULU9f377ev+4/1/NiT+URRiZRhrcZP6WLa/Gq005BORaqXsdYEuHPIP798ZxSyt6d5sVfxJESRCsvB32lfXwhRjnUBGmKXNoJQe04VIASJqRC/9G7yDsyQMiloYz+0pHYghEoPISAGgpDSvHsCoMwmA0mfjSG5UOsqah2RodkljzMkhZZdamiEDB8+Nsbk9T04yGNljDXGOZZ6u0+Tj9DuvbyNJBuPO0ABtLNPlJtfZJ4CNNCWJoY8gddwxNpm9YrHh9DEkBoeMud4Kma8XRZaYpBJOYvg59U9wOsblMvmGrzQe30dyqFZ1dxPfO0FT5BOdw989THVs4q1TFk+iN4PMu7CaLpd4EJOExNaJLE4d0xQKYpJ0cY5Ozcwwu6WOu2cs9TUYxPB4b4fvLRzTUXbT1HH7y0BnB0j6CAehkPFfFzd1TMsi6sU1/P4VM9NiISHBlYnBMR+kad075sXlmMehj1twnfTUqJH4GJfqIKte7S72emPnHbdiYHIB0e6ATjKq1UoTaFh6wBL2csMIVo9fH/v6QRHAgoxrOHQQxG/36tC1ODmGOeBGBRmXalgcdhDQ1xF1vI6a3DF2d4r7G1enOUgNOshlFq7qUCxrca9ldiCam7ilxRbP6JbOYsYtfLFmkcXEgLG1DN/6eroxHjqh5bh+Uw27e1oWVK7pN+AqwzUcq/UYTPw8nWufLFBHN2zcxLRYlmGPs6rA2Wy0uJe/E7TknbHIa1WH1bLA8DAj3JpxET+FCNCWZ5uNT6jxTPZK/1mXoCBeKlGLRT2lP69XN3XdqqCojKX1ZVda6iD2McjeXSHa0I+AHd2InGAJgjRVM6gOBfygDrarRJnho6eQBbrns+HkcNUCWtYClJa66qFgPbqqZEBTCOAgRqxCOhQBWpZeIC6QBq91hEoI5unTjsMsK9DCFigY9WNn19hgVCrELalrTw6WnYMYzjHhQ2/7G2xTx1HvwpzSe4cVi5ORQQwMW9+72FU5L4gGsa6Yu1RcDeIhs64Qs8izt0vGH+n9/IKaIlYpM2UqkYOrwwq5CgBjWpyGtxaonxe4KaJ3hx+7O0HaqVkxLBPj8FmBVmjNevIUFhUuDmMq5NDV9RwyPe/95IvxAhG7ymqxHGE5sZJL2kPLUhUinkXfrnFwGFwXD99djNLSFh/meXEb2B6Oyiwm0I7BC+OlTlOVPk9K8CIYzu5YHwKDTI6XAo5lz3WEqEXwQRKhh5cyLa6D81P4PXBw984as9YaGXHwx4Ba8rmOldUat/BHt9cQ38AaljnBdCJqs60OcXVDJZP//ZwSWtV9FpHNtgg22KuYx/U2tB5Mcp1TYOiphNhiFjgWeJ3DL2OZpuuUisIoUyzZEJ76I+LmyqWdv8LwnEiwMYczihjxeqtBsuFJSTg2oD1ETQx4v6D1VleSZW1xCwvAfVGWpQ069kgrQksAUW2rReYzsboIjSABuDQX0QJwB9cnZVgWVgE31vrklAJnEmVObykgYCk/VGX5OlpuKb5eiovUAvJ2tMstw0kIkNdpiSA91K6XA6K8CVCyr4PePhTo65q3DyX7OpTbSVk1PB62mhJ9HSpSqtKaESxsFRm0tLBVcvTV+vbBrLRK4hC7aitN9B0ZpX6vNMgjGIt5ZdmMv32KrmprD1afsPd4FEhThK0+WfTl3kpd482AGvG3jQdZK1+t8ireDswhofigRb3fxfI/4jj+xkffUX/1ccxxhEP9qyyBEH9Cx9vhf8TB7eiSpBHjZVSa4whQMJC1TqIR6q8RERtjOr2ID0yx3oYi0oAIvZCPz4eG64p3ObuREeOHUIR3MBVJwq9yll5P7KHdiPBOiOoRa/AjXz21J3k04l+i8OjErj4kaXWQiIVO/EvA+KLRAEnUVomtjPd6SvR3RLoeMT54nKFH1EqtkkEGFaQuTlSQrsxhRiOIt51S/Ho8B11+FUlwRaHnU4utEI38/mgSjRJ8PhWEtN6Z6WcncQOU4efjKoh3zfi7/+DfhPrwOZ9a/iYBiVJJxPlei3CqIDTYEqAPFow5/c71fAdVIwmo4n+cTIGbr2n9NULAE5ifcNNS63hvEOFk0wxYnICBBZ0I9xERBVILF0uggNdxuOkR4S6ngvgPmArzHv4KpMKGQFjQ+Rw6q9dC6R6dgZaJF7RVWIH0BTY9h+fz0ohHOyLuy+He/hN4GUR3/RxcBx2f76izarI9CaXmzRmhNQuSfIgJkva5GzN6HJbhQxCNsDGDSh56plmef6sg2eaXPsYBt5W+H6VE6omG6hOS1w4hiTWiThbJ1YO+RSO1vrpMlomf6nhQGz0m7qT6W04XOUHyzhZ4rkG+0hxL66oDW9mnPWyL3TMmssxyQUwr01CHX7b2OvUIaqS48TnMtAoEQTQixJeAlDfSiGmk/l8jpwIpTyFqOfeNIHWBooC036ERtUQp2tm/CKT5jjySbxTlvUVj2yhjvyWDVL3yfKRojXwLSEWUp7q0PBAKPp7m5YGoT3WH7wAZ1BeOywNZv3Gak/LIqriwxbQ5jaTcsEW1eb+FvoWo+zr5V/IUOvNtsapU2zJXSyj0xVB13sPfq0kkZA7dubIIKXIlJ8Cy7u+BN22RVcr+peOuxHdcBbA04FAVmEoEtO5vX55K4KVZS1QJvBBzU1rgUl8JapBNYIowLoZtD9NWRTWKqqe36L48BSz8QPH9epqqIDehlh2UuqocEmrdV7AvhuRoM74m80yeDIEX3ppreNN235FxV58DNjhswn5K8zK21+5ctjut6NmUIoy9tVvitnHr2VDM3ahtW8KQ/Vbsp9GGiWHfk8skyTSFz9/HdxhHe4uR/RxX/mG1SGXwypcDJNmCMfucZ/C1CuCQUbiBUDYbe7tiRkZX8GIat50d+wqR1fdN7ygGzrHrcN4kGFHK02cil5M6INgQVsvnNz77T5PqUFYJJInYmIBplJfP5On4eiOwYfhuCD44oLyYVs43rI1rk3H7usttzq8Qo3j84vavN9mOkAeuq8dHEd9NtCVKX51Oen+MM6IEYvz5StOehKLpIjD+nKU5AQWJpLizdB+1sb5LQvFRxbSJVGHmSdK/0WWaPguEYmcSJ68aWkK6rAw6jwSSCmrTWVHT96R7HwHANEgqybVJL+E2vE2q7Uu91Gr73SbbNUvZDtiOlCeIv4r/AI+0XUwz1lvcAAAAAElFTkSuQmCC")}.markdown-body h2{position:relative;padding:0 0 0 20px;font-size:20px;font-weight:700;color:#614500}.markdown-body h2:before{content:"";position:absolute;top:3px;bottom:0;left:0;background-image:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMgAAADICAMAAACahl6sAAAAQlBMVEVHcEwlRnqtZBj76q4lRnolRnolRnolRnolRnokRnr/gGtrVUeLXDBKTl+hYSHasW7Ik0zs0JG4dCvUdEE0SW+rYxrLQJfjAAAACnRSTlMA////0H/xUaMi5MCoTwAACfVJREFUeNrtnQl3qygUgJ9GXAqosfL//+pgmgXwXmRNJGdu55xO+6rx8+6I8O9fehmGriN93zdN07bVXdpW/ih/SbpuGP6dXbpOXv7z2i3S9ISck2eQOnAhMHG64VQQbmrAaM4B05GmipaGdB+m6BNQPBXzMYtKR3EPbB/RS5eY4g+lIW9WBqnySCvVMrzRpqqs0g9nwVg5p1KYlHEchRT5bftp+y3n6xlQDjAkABtrKULU9f377ev+4/1/NiT+URRiZRhrcZP6WLa/Gq005BORaqXsdYEuHPIP798ZxSyt6d5sVfxJESRCsvB32lfXwhRjnUBGmKXNoJQe04VIASJqRC/9G7yDsyQMiloYz+0pHYghEoPISAGgpDSvHsCoMwmA0mfjSG5UOsqah2RodkljzMkhZZdamiEDB8+Nsbk9T04yGNljDXGOZZ6u0+Tj9DuvbyNJBuPO0ABtLNPlJtfZJ4CNNCWJoY8gddwxNpm9YrHh9DEkBoeMud4Kma8XRZaYpBJOYvg59U9wOsblMvmGrzQe30dyqFZ1dxPfO0FT5BOdw989THVs4q1TFk+iN4PMu7CaLpd4EJOExNaJLE4d0xQKYpJ0cY5Ozcwwu6WOu2cs9TUYxPB4b4fvLRzTUXbT1HH7y0BnB0j6CAehkPFfFzd1TMsi6sU1/P4VM9NiISHBlYnBMR+kad075sXlmMehj1twnfTUqJH4GJfqIKte7S72emPnHbdiYHIB0e6ATjKq1UoTaFh6wBL2csMIVo9fH/v6QRHAgoxrOHQQxG/36tC1ODmGOeBGBRmXalgcdhDQ1xF1vI6a3DF2d4r7G1enOUgNOshlFq7qUCxrca9ldiCam7ilxRbP6JbOYsYtfLFmkcXEgLG1DN/6eroxHjqh5bh+Uw27e1oWVK7pN+AqwzUcq/UYTPw8nWufLFBHN2zcxLRYlmGPs6rA2Wy0uJe/E7TknbHIa1WH1bLA8DAj3JpxET+FCNCWZ5uNT6jxTPZK/1mXoCBeKlGLRT2lP69XN3XdqqCojKX1ZVda6iD2McjeXSHa0I+AHd2InGAJgjRVM6gOBfygDrarRJnho6eQBbrns+HkcNUCWtYClJa66qFgPbqqZEBTCOAgRqxCOhQBWpZeIC6QBq91hEoI5unTjsMsK9DCFigY9WNn19hgVCrELalrTw6WnYMYzjHhQ2/7G2xTx1HvwpzSe4cVi5ORQQwMW9+72FU5L4gGsa6Yu1RcDeIhs64Qs8izt0vGH+n9/IKaIlYpM2UqkYOrwwq5CgBjWpyGtxaonxe4KaJ3hx+7O0HaqVkxLBPj8FmBVmjNevIUFhUuDmMq5NDV9RwyPe/95IvxAhG7ymqxHGE5sZJL2kPLUhUinkXfrnFwGFwXD99djNLSFh/meXEb2B6Oyiwm0I7BC+OlTlOVPk9K8CIYzu5YHwKDTI6XAo5lz3WEqEXwQRKhh5cyLa6D81P4PXBw984as9YaGXHwx4Ba8rmOldUat/BHt9cQ38AaljnBdCJqs60OcXVDJZP//ZwSWtV9FpHNtgg22KuYx/U2tB5Mcp1TYOiphNhiFjgWeJ3DL2OZpuuUisIoUyzZEJ76I+LmyqWdv8LwnEiwMYczihjxeqtBsuFJSTg2oD1ETQx4v6D1VleSZW1xCwvAfVGWpQ069kgrQksAUW2rReYzsboIjSABuDQX0QJwB9cnZVgWVgE31vrklAJnEmVObykgYCk/VGX5OlpuKb5eiovUAvJ2tMstw0kIkNdpiSA91K6XA6K8CVCyr4PePhTo65q3DyX7OpTbSVk1PB62mhJ9HSpSqtKaESxsFRm0tLBVcvTV+vbBrLRK4hC7aitN9B0ZpX6vNMgjGIt5ZdmMv32KrmprD1afsPd4FEhThK0+WfTl3kpd482AGvG3jQdZK1+t8ireDswhofigRb3fxfI/4jj+xkffUX/1ccxxhEP9qyyBEH9Cx9vhf8TB7eiSpBHjZVSa4whQMJC1TqIR6q8RERtjOr2ID0yx3oYi0oAIvZCPz4eG64p3ObuREeOHUIR3MBVJwq9yll5P7KHdiPBOiOoRa/AjXz21J3k04l+i8OjErj4kaXWQiIVO/EvA+KLRAEnUVomtjPd6SvR3RLoeMT54nKFH1EqtkkEGFaQuTlSQrsxhRiOIt51S/Ho8B11+FUlwRaHnU4utEI38/mgSjRJ8PhWEtN6Z6WcncQOU4efjKoh3zfi7/+DfhPrwOZ9a/iYBiVJJxPlei3CqIDTYEqAPFow5/c71fAdVIwmo4n+cTIGbr2n9NULAE5ifcNNS63hvEOFk0wxYnICBBZ0I9xERBVILF0uggNdxuOkR4S6ngvgPmArzHv4KpMKGQFjQ+Rw6q9dC6R6dgZaJF7RVWIH0BTY9h+fz0ohHOyLuy+He/hN4GUR3/RxcBx2f76izarI9CaXmzRmhNQuSfIgJkva5GzN6HJbhQxCNsDGDSh56plmef6sg2eaXPsYBt5W+H6VE6omG6hOS1w4hiTWiThbJ1YO+RSO1vrpMlomf6nhQGz0m7qT6W04XOUHyzhZ4rkG+0hxL66oDW9mnPWyL3TMmssxyQUwr01CHX7b2OvUIaqS48TnMtAoEQTQixJeAlDfSiGmk/l8jpwIpTyFqOfeNIHWBooC036ERtUQp2tm/CKT5jjySbxTlvUVj2yhjvyWDVL3yfKRojXwLSEWUp7q0PBAKPp7m5YGoT3WH7wAZ1BeOywNZv3Gak/LIqriwxbQ5jaTcsEW1eb+FvoWo+zr5V/IUOvNtsapU2zJXSyj0xVB13sPfq0kkZA7dubIIKXIlJ8Cy7u+BN22RVcr+peOuxHdcBbA04FAVmEoEtO5vX55K4KVZS1QJvBBzU1rgUl8JapBNYIowLoZtD9NWRTWKqqe36L48BSz8QPH9epqqIDehlh2UuqocEmrdV7AvhuRoM74m80yeDIEX3ppreNN235FxV58DNjhswn5K8zK21+5ctjut6NmUIoy9tVvitnHr2VDM3ahtW8KQ/Vbsp9GGiWHfk8skyTSFz9/HdxhHe4uR/RxX/mG1SGXwypcDJNmCMfucZ/C1CuCQUbiBUDYbe7tiRkZX8GIat50d+wqR1fdN7ygGzrHrcN4kGFHK02cil5M6INgQVsvnNz77T5PqUFYJJInYmIBplJfP5On4eiOwYfhuCD44oLyYVs43rI1rk3H7usttzq8Qo3j84vavN9mOkAeuq8dHEd9NtCVKX51Oen+MM6IEYvz5StOehKLpIjD+nKU5AQWJpLizdB+1sb5LQvFRxbSJVGHmSdK/0WWaPguEYmcSJ68aWkK6rAw6jwSSCmrTWVHT96R7HwHANEgqybVJL+E2vE2q7Uu91Gr73SbbNUvZDtiOlCeIv4r/AI+0XUwz1lvcAAAAAElFTkSuQmCC");background-size:100% 100%;background-repeat:no-repeat;width:15px;height:15px;margin:auto}.markdown-body h3{width:100%;text-align:left;margin:20px 10px 0 0;font-size:18px;font-weight:700;display:inline-block;padding-left:10px;padding-bottom:0;border-left:5px solid #8f6600;color:#614500}.markdown-body h4,.markdown-body h5,.markdown-body h6{font-weight:700;color:#a37400}.markdown-body h4{font-size:17px}.markdown-body h5,.markdown-body h6{display:flex;align-items:center}.markdown-body h5:after,.markdown-body h6:after{display:inline-block;border:2px solid #fff6e0;color:rgba(189,134,0,.5);border-radius:50%;text-align:center;margin-left:5px}.markdown-body h5{font-size:14px}.markdown-body h5:after{content:"5";width:15px;height:15px;line-height:15px;font-size:13px}.markdown-body h6{font-size:12px}.markdown-body h6:after{content:"6";width:13px;height:13px;line-height:13px;font-size:12px}.markdown-body p{color:#412c0c;letter-spacing:1px;font-weight:400;margin-bottom:16px}.markdown-body img{max-width:100%;display:block;margin:auto}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{color:#755300;font-weight:400;border-bottom:1px solid #755300;font-weight:bolder;text-decoration:none}.markdown-body table{width:100%!important;margin:0;font-size:12px;width:auto;max-width:100%;overflow:auto;border-collapse:collapse;border-spacing:0}.markdown-body table img{box-shadow:none}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body thead tr th{text-align:center}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px;box-sizing:border-box;border:1px solid rgba(72,42,10,.1)}.markdown-body blockquote{position:relative;text-size-adjust:100%;line-height:25px;font-weight:400;border-radius:10px;font-style:normal;text-align:left;box-sizing:inherit;border:1px solid #ffd87a;background-color:rgba(189,134,0,.5);margin:20px 0;padding:20px}.markdown-body blockquote p{color:#fff6e0;letter-spacing:2px;margin:0}.markdown-body blockquote:after,.markdown-body blockquote:before{position:absolute;color:#cc9100;font-size:34px;font-weight:700}.markdown-body blockquote:before{content:"â";top:8px;left:5px}.markdown-body blockquote:after{content:"â";right:5px;bottom:-5px}.markdown-body strong{color:#c28a00;font-weight:bolder}.markdown-body strong:before{content:"ã€Œ"}.markdown-body strong:after{content:"ã€"}.markdown-body em{color:#c28a00}.markdown-body em strong{font-style:normal;color:#c28a00;background-color:#8a6200}.markdown-body s{color:#c28a00}.markdown-body hr{border-top:1px solid #805b00}.markdown-body code,.markdown-body li code,.markdown-body p code{color:#996d00;background-color:rgba(130,98,0,.3)}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit;color:#858585;font-family:bold;letter-spacing:1px}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body h1::selection,.markdown-body h2::selection,.markdown-body h3::selection,.markdown-body h4::selection,.markdown-body h5::selection,.markdown-body h6::selection,.markdown-body img::selection{color:rgba(189,134,0,.5);background-color:#fff}.markdown-body a::selection,.markdown-body b::selection,.markdown-body del::selection,.markdown-body em::selection,.markdown-body i::selection,.markdown-body strong::selection{background-color:transparent}.markdown-body pre&gt;code::selection{background-color:rgba(189,134,0,.5)}.markdown-body .math .math-inline::selection,.markdown-body blockquote::selection,.markdown-body ol::selection,.markdown-body p::selection,.markdown-body strong::selection,.markdown-body table::selection,.markdown-body ul::selection{background-color:rgba(189,134,0,.5)}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>ä½œè€…ï¼šé¢æ±¤æ”¾ç› / uzong</p>
</blockquote>
<p>åœ¨è½¯ä»¶å¼€å‘çš„ä¸–ç•Œé‡Œï¼Œæˆ‘ä»¬ä¹ æƒ¯ç”¨ä»£ç è¡¨è¾¾é€»è¾‘ï¼Œä½†å½“ç³»ç»Ÿæ¶‰åŠå¤šä¸ªè§’è‰²ã€å¤šä¸ªæœåŠ¡ã€ç”šè‡³è·¨å›¢é˜Ÿåä½œæ—¶ï¼Œå…‰é ä»£ç æ³¨é‡Šæˆ–å£å¤´æ²Ÿé€šï¼Œå¾€å¾€ä¸å¤Ÿã€‚è¿™æ—¶å€™ï¼Œä¸€å¼ æ¸…æ™°çš„æµç¨‹å›¾ï¼Œèƒœè¿‡åƒè¡Œæ–‡æ¡£ã€‚</p>
<p><strong>æ³³é“å›¾</strong> ï¼šå®ƒå¯èƒ½ä¸åƒ UML é‚£æ ·â€œé«˜å¤§ä¸Šâ€ï¼Œä¹Ÿä¸å¦‚æ¶æ„å›¾é‚£æ ·å®è§‚ï¼Œä½†åœ¨æ¢³ç†ä¸šåŠ¡æµç¨‹ã€å˜æ¸…è´£ä»»è¾¹ç•Œã€æ’æŸ¥ç³»ç»Ÿç“¶é¢ˆæ—¶ï¼Œå®ƒçœŸçš„éå¸¸å®ç”¨ã€‚</p>
<h2 data-id="heading-0">1. ä»€ä¹ˆæ˜¯æ³³é“å›¾</h2>
<p>æ³³é“å›¾çš„æ ¸å¿ƒæ€æƒ³å¾ˆç®€å•ï¼š<strong>æŠŠæµç¨‹ä¸­çš„æ¯ä¸ªæ­¥éª¤ï¼ŒæŒ‰æ‰§è¡Œè€…ï¼ˆäººã€ç³»ç»Ÿã€æ¨¡å—ï¼‰åˆ†ç»„æ’åˆ—ï¼Œå°±åƒæ¸¸æ³³æ± é‡Œçš„æ³³é“ä¸€æ ·ï¼Œå„èµ°å„é“ï¼Œäº’ä¸å¹²æ‰°åˆå½¼æ­¤å…³è”ã€‚</strong></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0827b245902848f0bc23a543804c4444~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgdXpvbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765692446&amp;x-signature=ehyaawiQyCeygsgaf2p%2BvefSHwo%3D" alt="" loading="lazy"/></p>
<p><strong>æ¯ä¸€åˆ—å°±æ˜¯ä¸€ä¸ªâ€œæ³³é“â€ï¼Œä»£è¡¨ä¸€ä¸ªè´£ä»»ä¸»ä½“ã€‚æµç¨‹ä»å·¦åˆ°å³ã€ä»ä¸Šåˆ°ä¸‹æµåŠ¨ï¼Œè°åœ¨ä»€ä¹ˆæ—¶å€™åšäº†ä»€ä¹ˆï¼Œä¸€ç›®äº†ç„¶</strong></p>
<hr/>
<p>ä¸€çœ¼å°±èƒ½çœ‹å‡ºï¼š<strong>è°å¹²äº†ä»€ä¹ˆï¼Œè°ä¾èµ–è°ï¼Œè¾¹ç•Œæ˜¯ä»€ä¹ˆã€‚</strong></p>
<p><strong>ä¸æµç¨‹çš„å·®å¼‚ç‚¹ï¼š</strong></p>
<ul>
<li>æµç¨‹å›¾èšç„¦ï¼šâ€œæ­¥éª¤é¡ºåºâ€ï¼Œä¾§é‡ â€œå…ˆåšä»€ä¹ˆã€å†åšä»€ä¹ˆâ€ï¼Œé€‚åˆæ¢³ç†çº¿æ€§ä¸šåŠ¡æµç¨‹ï¼›</li>
<li>æ³³é“å›¾èšç„¦ï¼š â€œæµè½¬é€šé“â€ï¼Œä¾§é‡ â€œä»€ä¹ˆä¸œè¥¿åœ¨ä»€ä¹ˆçº¦æŸä¸‹é€šè¿‡ä»€ä¹ˆè·¯å¾„æµè½¬â€ï¼Œé€‚åˆæ‹†è§£å¤æ‚ã€å¤šè·¯å¾„ã€æœ‰è§„åˆ™çº¦æŸçš„æµè½¬åœºæ™¯ï¼ˆå¦‚åˆ†å¸ƒå¼ç³»ç»Ÿæ•°æ®åŒæ­¥ã€ä¾›åº”é“¾ç‰©æ–™æµè½¬ã€å¾®æœåŠ¡è¯·æ±‚é“¾è·¯ç­‰ï¼‰</li>
</ul>
<h2 data-id="heading-1">2. æ³³é“å›¾åˆ†ç±»</h2>
<h3 data-id="heading-2">2.1. å‚ç›´æ³³é“å›¾</h3>
<p>å‚ç›´æ³³é“å›¾é‡‡å–ä¸Šä¸‹å¸ƒå±€ç»“æ„ï¼Œâ€Œä¸»è¦å¼ºè°ƒèŒèƒ½ç¾¤ä½“ã€‚<strong>è¿™ç§å¸ƒå±€æ–¹å¼æ›´é€‚åˆäºå±•ç¤ºè·¨èŒèƒ½ä»»åŠ¡å’Œæµç¨‹ä¸­ï¼Œâ€Œå„èŒèƒ½éƒ¨é—¨æˆ–è§’è‰²ä¹‹é—´çš„å‚ç›´å…³ç³»å’ŒèŒèƒ½åˆ†å·¥ã€‚</strong></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e0f9a47ca0034d288c5f9228da4b2bf9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgdXpvbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765692446&amp;x-signature=2yszR61tULesrRNoYp92nDHDRBA%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-3">2.2. æ°´å¹³æ³³é“å›¾</h3>
<p>æ°´å¹³æ³³é“å›¾åˆ™é‡‡ç”¨å·¦å³å¸ƒå±€ç»“æ„ï¼Œâ€Œé‡ç‚¹åœ¨äºäº‹ä»¶è¿›ç¨‹çš„å±•ç¤ºã€‚<strong>è¿™ç§å¸ƒå±€æ–¹å¼æ›´é€‚åˆäºå¼ºè°ƒäº‹ä»¶æˆ–è¿‡ç¨‹çš„æ°´å¹³æµåŠ¨ï¼Œâ€Œä»¥åŠä¸åŒé˜¶æ®µæˆ–éƒ¨é—¨åœ¨æµç¨‹ä¸­çš„æ°´å¹³å‚ä¸</strong></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c3c39b7b10344cbf996f88d95d7abc6b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgdXpvbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765692446&amp;x-signature=AEu6jfw8Hka8GFFoLA3VyGYPDeY%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-4">3. æ³³é“å›¾ç»„æˆå…ƒç´ </h2>
<p><strong>æ³³æ± ï¼š</strong> æ³³æ± æ˜¯æ³³é“å›¾çš„å¤–éƒ¨æ¡†æ¶ï¼Œæ³³é“ã€æµç¨‹éƒ½åŒ…å«äºæ³³æ± å†…ã€‚</p>
<p><strong>æ³³é“ï¼š</strong> æ³³æ± é‡Œå¯ä»¥åˆ›å»ºå¤šä¸ªæ³³é“ã€‚</p>
<p><strong>æµç¨‹ï¼š</strong> å®é™…çš„ä¸šåŠ¡æµç¨‹ã€‚</p>
<p><strong>éƒ¨é—¨ï¼š</strong> é€šè¿‡éƒ¨é—¨æˆ–è€…è´£ä»»æ¥åŒºåˆ†ï¼Œæ˜ç¡®æ¯ä¸ªéƒ¨é—¨/äºº/ä¿¡æ¯ç³»ç»Ÿè´Ÿè´£å®Œæˆçš„ä»»åŠ¡ç¯èŠ‚ã€‚</p>
<p><strong>é˜¶æ®µï¼š</strong> é€šè¿‡ä»»åŠ¡é˜¶æ®µæ¥åŒºåˆ†ï¼Œæ˜ç¡®æ¯ä¸ªé˜¶æ®µéœ€è¦å¤„ç†çš„ä»»åŠ¡ç¯èŠ‚ã€‚</p>
<h2 data-id="heading-5">4. æ³³é“å›¾åº”ç”¨åœºæ™¯</h2>
<h3 data-id="heading-6">4.1. é¡¹ç›®ç®¡ç†</h3>
<p>å±•ç¤ºé¡¹ç›®ä»å¯åŠ¨åˆ°å®Œæˆçš„å„ä¸ªé˜¶æ®µï¼Œæ˜ç¡®æ¯ä¸ªå›¢é˜Ÿæˆ–æˆå‘˜åœ¨é¡¹ç›®ä¸­çš„è§’è‰²å’ŒèŒè´£ï¼Œä¾¿äºè¿›è¡Œé¡¹ç›®ç®¡ç†å’Œç›‘æ§ï¼ŒåŒæ—¶ä¿ƒè¿›å›¢é˜Ÿåä½œå’Œæ²Ÿé€š</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cc65b6c24346448cb010aed90c2eb58d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgdXpvbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765692446&amp;x-signature=cwoi3aeghOLbFMwy7aGWQm0NWu8%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-7">4.2. ä¸šåŠ¡æµç¨‹åˆ†æ</h3>
<p>å±•ç¤ºä¸šåŠ¡æµç¨‹çš„å„ä¸ªç¯èŠ‚å’Œæ¶‰åŠçš„ä¸åŒéƒ¨é—¨æˆ–èŒèƒ½ã€‚é€šè¿‡åˆ†ææ³³é“å›¾ï¼Œå¯ä»¥å‘ç°ä¸šåŠ¡æµç¨‹ä¸­çš„ç“¶é¢ˆã€å†—ä½™ç¯èŠ‚æˆ–ä¸åˆç†ä¹‹å¤„ï¼Œè¿›è€Œè¿›è¡Œæµç¨‹ä¼˜åŒ–å’Œæ”¹è¿›ã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8642f37ba1a240cdb2ecc3dd8b7af30b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgdXpvbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765692446&amp;x-signature=P7CAOtBGnpXc%2Bc5lPBuzQpqcnW4%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-8">4.3. ç³»ç»Ÿè®¾è®¡</h3>
<p>å±•ç¤ºç³»ç»Ÿçš„æ•´ä½“æ¶æ„å’Œå„ä¸ªç»„ä»¶ä¹‹é—´çš„å…³ç³»ï¼Œæè¿°ç³»ç»Ÿçš„å·¥ä½œæµç¨‹ï¼ŒåŒ…æ‹¬æ•°æ®çš„è¾“å…¥ã€å¤„ç†ã€è¾“å‡ºç­‰å„ä¸ªç¯èŠ‚ï¼Œæœ‰åŠ©äºç³»ç»Ÿå¼€å‘äººå‘˜æ›´å¥½åœ°ç†è§£ç³»ç»Ÿçš„åŠŸèƒ½å’Œéœ€æ±‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/34f9dc1384b4420fbd705fa0790433ee~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgdXpvbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765692446&amp;x-signature=BxEweXcfCwkeBDH6bZ33YxP7GOQ%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-9">5. æ›´å¤šå‚è€ƒæ¨¡æ¿</h2>
<p>æ•…éšœå¤„ç†å¤šç»´æ³³é“å›¾</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4977f1e8c3fa499aa4090092982fb588~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgdXpvbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765692446&amp;x-signature=9giq30JmKdONpCguzsEr7EyrSxU%3D" alt="" loading="lazy"/></p>
<p>èµ„æºæ‰©å®¹æ³³é“å›¾</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9a743deb98ff48189f0423710ca4e14f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgdXpvbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765692446&amp;x-signature=DMLSa3zzgplTpEP208yCk25FIBY%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-10">6. æœ€å</h2>
<p>æˆ‘åˆšå·¥ä½œæ—¶ï¼Œçœ‹åˆ°å¯¼å¸ˆæŠ›å‡ºä¸€ä»½ç²¾è‡´çš„æ³³é“å›¾ï¼ŒæŠŠä¸€å›¢ä¹±éº»çš„é—®é¢˜è®²å¾—é€äº®ï¼Œå¿ƒé‡Œç‰¹åˆ«ä½©æœã€‚ç›´åˆ°è‡ªå·±å¤šå¹´åç”¨ä¸Šæ‰çœŸæ­£ä½“ä¼šï¼šåœ¨é¢å¯¹è·¨éƒ¨é—¨åä½œã€å¤æ‚æ•…éšœæ’æŸ¥ã€å…³é”®æµç¨‹è®¾è®¡æ—¶ï¼Œæå‡ºè¿™ä¹ˆä¸€å¼ å›¾ï¼Œå¾€å¾€å°±æ˜¯é«˜æ•ˆæ²Ÿé€šçš„å¼€å§‹ã€‚</p>
<p>ä½œä¸ºå¼€å‘è€…ï¼Œæˆ‘ä»¬å¸¸é™·å…¥â€œåªè¦ä»£ç è·‘å¾—é€šå°±è¡Œâ€çš„æ€ç»´æƒ¯æ€§ã€‚ä½†è½¯ä»¶ä¸ä»…æ˜¯æœºå™¨æ‰§è¡Œçš„æŒ‡ä»¤ï¼Œæ›´æ˜¯äººä¸äººåä½œçš„åª’ä»‹ã€‚æ³³é“å›¾è¿™æ ·çš„å·¥å…·ï¼Œæœ¬è´¨ä¸Šæ˜¯åœ¨<strong>é™ä½è®¤çŸ¥æˆæœ¬</strong>â€”â€”è®©å¤æ‚çš„äº‹æƒ…å˜å¾—å¯æ²Ÿé€šã€å¯éªŒè¯ã€å¯è¿­ä»£ã€‚ å…¶å®æ³³é“å›¾çš„æ ¸å¿ƒä¸æ˜¯â€œç”»å›¾â€ï¼Œè€Œæ˜¯â€œæ¢³ç†æµç¨‹ã€æ˜ç¡®æƒè´£â€ã€‚</p>
<p>åœ¨è·¨éƒ¨é—¨ã€ååŒéœ€æ±‚ã€æ•…éšœåˆ†æç­‰å…³é”®åœºæ™¯ä½¿ç”¨æ³³é“å›¾æ˜¯éå¸¸åˆé€‚ï¼Œå¹¶ä¸”ä¹Ÿèƒ½æŠŠé—®é¢˜è®²æ¸…æ¥šã€‚<strong>æŠ€æœ¯ä¸–ç•Œå……æ»¡äº†æŠ½è±¡å’Œå¤æ‚æ€§ï¼Œè€Œä¼˜ç§€å·¥ç¨‹å¸ˆçš„èƒ½åŠ›ä¹‹ä¸€ï¼Œå°±æ˜¯åˆ›å»ºåˆé€‚çš„å¯è§†åŒ–å·¥å…·ï¼Œè®©å¤æ‚é—®é¢˜å˜å¾—ç®€å•å¯è§</strong>ã€‚</p>
<blockquote>
<p>æœ¬æ–‡ä¸­çš„å¤§éƒ¨åˆ†å›¾ç‰‡æ¥æºäº ProcessOnï¼ŒProcessOn æ˜¯ä¸€ä¸ªéå¸¸ä¸é”™çš„ç”»å›¾è½¯ä»¶ï¼ŒåŠŸèƒ½å¼ºå¤§ï¼Œç•Œé¢ä¼˜ç¾ã€‚</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ğŸ¤– AI æ—¶ä»£ï¼Œå¤§æ¨¡å‹ä¸ç³»ç»Ÿçš„å¯èåˆåœºæ™¯æ¶æ„çŒœæƒ³]]></title>    <link>https://juejin.cn/post/7580374090364796966</link>    <guid>https://juejin.cn/post/7580374090364796966</guid>    <pubDate>2025-12-07T00:02:37.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7580374090364796966" data-draft-id="7580378958072397834" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ğŸ¤– AI æ—¶ä»£ï¼Œå¤§æ¨¡å‹ä¸ç³»ç»Ÿçš„å¯èåˆåœºæ™¯æ¶æ„çŒœæƒ³"/> <meta itemprop="keywords" content="äººå·¥æ™ºèƒ½,å‰ç«¯æ¡†æ¶,æ“ä½œç³»ç»Ÿ"/> <meta itemprop="datePublished" content="2025-12-07T00:02:37.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="LeonGao"/> <meta itemprop="url" content="https://juejin.cn/user/3976252950591149"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ğŸ¤– AI æ—¶ä»£ï¼Œå¤§æ¨¡å‹ä¸ç³»ç»Ÿçš„å¯èåˆåœºæ™¯æ¶æ„çŒœæƒ³
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3976252950591149/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    LeonGao
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-07T00:02:37.000Z" title="Sun Dec 07 2025 00:02:37 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-07
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»5åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body blockquote&gt;:first-child{margin-top:0}.markdown-body blockquote&gt;:last-child{margin-bottom:0}.markdown-body{overflow:hidden;line-height:1.75;font-size:15px;background-image:linear-gradient(90deg,rgba(72,42,10,.05) 5%,rgba(72,42,10,0) 0),linear-gradient(1turn,rgba(72,42,10,.05) 5%,rgba(72,42,10,0) 0);background-size:20px 20px;background-position:50%;padding-top:0!important}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{position:relative;display:flex;border-bottom:5px solid #6d4e00;line-height:35px;letter-spacing:1px;font-size:25px;padding-left:25px;color:#664900;text-shadow:1px 1px 1px #8a6200;padding-bottom:0}.markdown-body h1:before{content:"";display:flex;position:absolute;left:0;top:3px;bottom:0;margin:auto;width:20px;height:20px;background-size:20px 20px;background-image:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMgAAADICAMAAACahl6sAAAAQlBMVEVHcEwlRnqtZBj76q4lRnolRnolRnolRnolRnokRnr/gGtrVUeLXDBKTl+hYSHasW7Ik0zs0JG4dCvUdEE0SW+rYxrLQJfjAAAACnRSTlMA////0H/xUaMi5MCoTwAACfVJREFUeNrtnQl3qygUgJ9GXAqosfL//+pgmgXwXmRNJGdu55xO+6rx8+6I8O9fehmGriN93zdN07bVXdpW/ih/SbpuGP6dXbpOXv7z2i3S9ISck2eQOnAhMHG64VQQbmrAaM4B05GmipaGdB+m6BNQPBXzMYtKR3EPbB/RS5eY4g+lIW9WBqnySCvVMrzRpqqs0g9nwVg5p1KYlHEchRT5bftp+y3n6xlQDjAkABtrKULU9f377ev+4/1/NiT+URRiZRhrcZP6WLa/Gq005BORaqXsdYEuHPIP798ZxSyt6d5sVfxJESRCsvB32lfXwhRjnUBGmKXNoJQe04VIASJqRC/9G7yDsyQMiloYz+0pHYghEoPISAGgpDSvHsCoMwmA0mfjSG5UOsqah2RodkljzMkhZZdamiEDB8+Nsbk9T04yGNljDXGOZZ6u0+Tj9DuvbyNJBuPO0ABtLNPlJtfZJ4CNNCWJoY8gddwxNpm9YrHh9DEkBoeMud4Kma8XRZaYpBJOYvg59U9wOsblMvmGrzQe30dyqFZ1dxPfO0FT5BOdw989THVs4q1TFk+iN4PMu7CaLpd4EJOExNaJLE4d0xQKYpJ0cY5Ozcwwu6WOu2cs9TUYxPB4b4fvLRzTUXbT1HH7y0BnB0j6CAehkPFfFzd1TMsi6sU1/P4VM9NiISHBlYnBMR+kad075sXlmMehj1twnfTUqJH4GJfqIKte7S72emPnHbdiYHIB0e6ATjKq1UoTaFh6wBL2csMIVo9fH/v6QRHAgoxrOHQQxG/36tC1ODmGOeBGBRmXalgcdhDQ1xF1vI6a3DF2d4r7G1enOUgNOshlFq7qUCxrca9ldiCam7ilxRbP6JbOYsYtfLFmkcXEgLG1DN/6eroxHjqh5bh+Uw27e1oWVK7pN+AqwzUcq/UYTPw8nWufLFBHN2zcxLRYlmGPs6rA2Wy0uJe/E7TknbHIa1WH1bLA8DAj3JpxET+FCNCWZ5uNT6jxTPZK/1mXoCBeKlGLRT2lP69XN3XdqqCojKX1ZVda6iD2McjeXSHa0I+AHd2InGAJgjRVM6gOBfygDrarRJnho6eQBbrns+HkcNUCWtYClJa66qFgPbqqZEBTCOAgRqxCOhQBWpZeIC6QBq91hEoI5unTjsMsK9DCFigY9WNn19hgVCrELalrTw6WnYMYzjHhQ2/7G2xTx1HvwpzSe4cVi5ORQQwMW9+72FU5L4gGsa6Yu1RcDeIhs64Qs8izt0vGH+n9/IKaIlYpM2UqkYOrwwq5CgBjWpyGtxaonxe4KaJ3hx+7O0HaqVkxLBPj8FmBVmjNevIUFhUuDmMq5NDV9RwyPe/95IvxAhG7ymqxHGE5sZJL2kPLUhUinkXfrnFwGFwXD99djNLSFh/meXEb2B6Oyiwm0I7BC+OlTlOVPk9K8CIYzu5YHwKDTI6XAo5lz3WEqEXwQRKhh5cyLa6D81P4PXBw984as9YaGXHwx4Ba8rmOldUat/BHt9cQ38AaljnBdCJqs60OcXVDJZP//ZwSWtV9FpHNtgg22KuYx/U2tB5Mcp1TYOiphNhiFjgWeJ3DL2OZpuuUisIoUyzZEJ76I+LmyqWdv8LwnEiwMYczihjxeqtBsuFJSTg2oD1ETQx4v6D1VleSZW1xCwvAfVGWpQ069kgrQksAUW2rReYzsboIjSABuDQX0QJwB9cnZVgWVgE31vrklAJnEmVObykgYCk/VGX5OlpuKb5eiovUAvJ2tMstw0kIkNdpiSA91K6XA6K8CVCyr4PePhTo65q3DyX7OpTbSVk1PB62mhJ9HSpSqtKaESxsFRm0tLBVcvTV+vbBrLRK4hC7aitN9B0ZpX6vNMgjGIt5ZdmMv32KrmprD1afsPd4FEhThK0+WfTl3kpd482AGvG3jQdZK1+t8ireDswhofigRb3fxfI/4jj+xkffUX/1ccxxhEP9qyyBEH9Cx9vhf8TB7eiSpBHjZVSa4whQMJC1TqIR6q8RERtjOr2ID0yx3oYi0oAIvZCPz4eG64p3ObuREeOHUIR3MBVJwq9yll5P7KHdiPBOiOoRa/AjXz21J3k04l+i8OjErj4kaXWQiIVO/EvA+KLRAEnUVomtjPd6SvR3RLoeMT54nKFH1EqtkkEGFaQuTlSQrsxhRiOIt51S/Ho8B11+FUlwRaHnU4utEI38/mgSjRJ8PhWEtN6Z6WcncQOU4efjKoh3zfi7/+DfhPrwOZ9a/iYBiVJJxPlei3CqIDTYEqAPFow5/c71fAdVIwmo4n+cTIGbr2n9NULAE5ifcNNS63hvEOFk0wxYnICBBZ0I9xERBVILF0uggNdxuOkR4S6ngvgPmArzHv4KpMKGQFjQ+Rw6q9dC6R6dgZaJF7RVWIH0BTY9h+fz0ohHOyLuy+He/hN4GUR3/RxcBx2f76izarI9CaXmzRmhNQuSfIgJkva5GzN6HJbhQxCNsDGDSh56plmef6sg2eaXPsYBt5W+H6VE6omG6hOS1w4hiTWiThbJ1YO+RSO1vrpMlomf6nhQGz0m7qT6W04XOUHyzhZ4rkG+0hxL66oDW9mnPWyL3TMmssxyQUwr01CHX7b2OvUIaqS48TnMtAoEQTQixJeAlDfSiGmk/l8jpwIpTyFqOfeNIHWBooC036ERtUQp2tm/CKT5jjySbxTlvUVj2yhjvyWDVL3yfKRojXwLSEWUp7q0PBAKPp7m5YGoT3WH7wAZ1BeOywNZv3Gak/LIqriwxbQ5jaTcsEW1eb+FvoWo+zr5V/IUOvNtsapU2zJXSyj0xVB13sPfq0kkZA7dubIIKXIlJ8Cy7u+BN22RVcr+peOuxHdcBbA04FAVmEoEtO5vX55K4KVZS1QJvBBzU1rgUl8JapBNYIowLoZtD9NWRTWKqqe36L48BSz8QPH9epqqIDehlh2UuqocEmrdV7AvhuRoM74m80yeDIEX3ppreNN235FxV58DNjhswn5K8zK21+5ctjut6NmUIoy9tVvitnHr2VDM3ahtW8KQ/Vbsp9GGiWHfk8skyTSFz9/HdxhHe4uR/RxX/mG1SGXwypcDJNmCMfucZ/C1CuCQUbiBUDYbe7tiRkZX8GIat50d+wqR1fdN7ygGzrHrcN4kGFHK02cil5M6INgQVsvnNz77T5PqUFYJJInYmIBplJfP5On4eiOwYfhuCD44oLyYVs43rI1rk3H7usttzq8Qo3j84vavN9mOkAeuq8dHEd9NtCVKX51Oen+MM6IEYvz5StOehKLpIjD+nKU5AQWJpLizdB+1sb5LQvFRxbSJVGHmSdK/0WWaPguEYmcSJ68aWkK6rAw6jwSSCmrTWVHT96R7HwHANEgqybVJL+E2vE2q7Uu91Gr73SbbNUvZDtiOlCeIv4r/AI+0XUwz1lvcAAAAAElFTkSuQmCC")}.markdown-body h2{position:relative;padding:0 0 0 20px;font-size:20px;font-weight:700;color:#614500}.markdown-body h2:before{content:"";position:absolute;top:3px;bottom:0;left:0;background-image:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMgAAADICAMAAACahl6sAAAAQlBMVEVHcEwlRnqtZBj76q4lRnolRnolRnolRnolRnokRnr/gGtrVUeLXDBKTl+hYSHasW7Ik0zs0JG4dCvUdEE0SW+rYxrLQJfjAAAACnRSTlMA////0H/xUaMi5MCoTwAACfVJREFUeNrtnQl3qygUgJ9GXAqosfL//+pgmgXwXmRNJGdu55xO+6rx8+6I8O9fehmGriN93zdN07bVXdpW/ih/SbpuGP6dXbpOXv7z2i3S9ISck2eQOnAhMHG64VQQbmrAaM4B05GmipaGdB+m6BNQPBXzMYtKR3EPbB/RS5eY4g+lIW9WBqnySCvVMrzRpqqs0g9nwVg5p1KYlHEchRT5bftp+y3n6xlQDjAkABtrKULU9f377ev+4/1/NiT+URRiZRhrcZP6WLa/Gq005BORaqXsdYEuHPIP798ZxSyt6d5sVfxJESRCsvB32lfXwhRjnUBGmKXNoJQe04VIASJqRC/9G7yDsyQMiloYz+0pHYghEoPISAGgpDSvHsCoMwmA0mfjSG5UOsqah2RodkljzMkhZZdamiEDB8+Nsbk9T04yGNljDXGOZZ6u0+Tj9DuvbyNJBuPO0ABtLNPlJtfZJ4CNNCWJoY8gddwxNpm9YrHh9DEkBoeMud4Kma8XRZaYpBJOYvg59U9wOsblMvmGrzQe30dyqFZ1dxPfO0FT5BOdw989THVs4q1TFk+iN4PMu7CaLpd4EJOExNaJLE4d0xQKYpJ0cY5Ozcwwu6WOu2cs9TUYxPB4b4fvLRzTUXbT1HH7y0BnB0j6CAehkPFfFzd1TMsi6sU1/P4VM9NiISHBlYnBMR+kad075sXlmMehj1twnfTUqJH4GJfqIKte7S72emPnHbdiYHIB0e6ATjKq1UoTaFh6wBL2csMIVo9fH/v6QRHAgoxrOHQQxG/36tC1ODmGOeBGBRmXalgcdhDQ1xF1vI6a3DF2d4r7G1enOUgNOshlFq7qUCxrca9ldiCam7ilxRbP6JbOYsYtfLFmkcXEgLG1DN/6eroxHjqh5bh+Uw27e1oWVK7pN+AqwzUcq/UYTPw8nWufLFBHN2zcxLRYlmGPs6rA2Wy0uJe/E7TknbHIa1WH1bLA8DAj3JpxET+FCNCWZ5uNT6jxTPZK/1mXoCBeKlGLRT2lP69XN3XdqqCojKX1ZVda6iD2McjeXSHa0I+AHd2InGAJgjRVM6gOBfygDrarRJnho6eQBbrns+HkcNUCWtYClJa66qFgPbqqZEBTCOAgRqxCOhQBWpZeIC6QBq91hEoI5unTjsMsK9DCFigY9WNn19hgVCrELalrTw6WnYMYzjHhQ2/7G2xTx1HvwpzSe4cVi5ORQQwMW9+72FU5L4gGsa6Yu1RcDeIhs64Qs8izt0vGH+n9/IKaIlYpM2UqkYOrwwq5CgBjWpyGtxaonxe4KaJ3hx+7O0HaqVkxLBPj8FmBVmjNevIUFhUuDmMq5NDV9RwyPe/95IvxAhG7ymqxHGE5sZJL2kPLUhUinkXfrnFwGFwXD99djNLSFh/meXEb2B6Oyiwm0I7BC+OlTlOVPk9K8CIYzu5YHwKDTI6XAo5lz3WEqEXwQRKhh5cyLa6D81P4PXBw984as9YaGXHwx4Ba8rmOldUat/BHt9cQ38AaljnBdCJqs60OcXVDJZP//ZwSWtV9FpHNtgg22KuYx/U2tB5Mcp1TYOiphNhiFjgWeJ3DL2OZpuuUisIoUyzZEJ76I+LmyqWdv8LwnEiwMYczihjxeqtBsuFJSTg2oD1ETQx4v6D1VleSZW1xCwvAfVGWpQ069kgrQksAUW2rReYzsboIjSABuDQX0QJwB9cnZVgWVgE31vrklAJnEmVObykgYCk/VGX5OlpuKb5eiovUAvJ2tMstw0kIkNdpiSA91K6XA6K8CVCyr4PePhTo65q3DyX7OpTbSVk1PB62mhJ9HSpSqtKaESxsFRm0tLBVcvTV+vbBrLRK4hC7aitN9B0ZpX6vNMgjGIt5ZdmMv32KrmprD1afsPd4FEhThK0+WfTl3kpd482AGvG3jQdZK1+t8ireDswhofigRb3fxfI/4jj+xkffUX/1ccxxhEP9qyyBEH9Cx9vhf8TB7eiSpBHjZVSa4whQMJC1TqIR6q8RERtjOr2ID0yx3oYi0oAIvZCPz4eG64p3ObuREeOHUIR3MBVJwq9yll5P7KHdiPBOiOoRa/AjXz21J3k04l+i8OjErj4kaXWQiIVO/EvA+KLRAEnUVomtjPd6SvR3RLoeMT54nKFH1EqtkkEGFaQuTlSQrsxhRiOIt51S/Ho8B11+FUlwRaHnU4utEI38/mgSjRJ8PhWEtN6Z6WcncQOU4efjKoh3zfi7/+DfhPrwOZ9a/iYBiVJJxPlei3CqIDTYEqAPFow5/c71fAdVIwmo4n+cTIGbr2n9NULAE5ifcNNS63hvEOFk0wxYnICBBZ0I9xERBVILF0uggNdxuOkR4S6ngvgPmArzHv4KpMKGQFjQ+Rw6q9dC6R6dgZaJF7RVWIH0BTY9h+fz0ohHOyLuy+He/hN4GUR3/RxcBx2f76izarI9CaXmzRmhNQuSfIgJkva5GzN6HJbhQxCNsDGDSh56plmef6sg2eaXPsYBt5W+H6VE6omG6hOS1w4hiTWiThbJ1YO+RSO1vrpMlomf6nhQGz0m7qT6W04XOUHyzhZ4rkG+0hxL66oDW9mnPWyL3TMmssxyQUwr01CHX7b2OvUIaqS48TnMtAoEQTQixJeAlDfSiGmk/l8jpwIpTyFqOfeNIHWBooC036ERtUQp2tm/CKT5jjySbxTlvUVj2yhjvyWDVL3yfKRojXwLSEWUp7q0PBAKPp7m5YGoT3WH7wAZ1BeOywNZv3Gak/LIqriwxbQ5jaTcsEW1eb+FvoWo+zr5V/IUOvNtsapU2zJXSyj0xVB13sPfq0kkZA7dubIIKXIlJ8Cy7u+BN22RVcr+peOuxHdcBbA04FAVmEoEtO5vX55K4KVZS1QJvBBzU1rgUl8JapBNYIowLoZtD9NWRTWKqqe36L48BSz8QPH9epqqIDehlh2UuqocEmrdV7AvhuRoM74m80yeDIEX3ppreNN235FxV58DNjhswn5K8zK21+5ctjut6NmUIoy9tVvitnHr2VDM3ahtW8KQ/Vbsp9GGiWHfk8skyTSFz9/HdxhHe4uR/RxX/mG1SGXwypcDJNmCMfucZ/C1CuCQUbiBUDYbe7tiRkZX8GIat50d+wqR1fdN7ygGzrHrcN4kGFHK02cil5M6INgQVsvnNz77T5PqUFYJJInYmIBplJfP5On4eiOwYfhuCD44oLyYVs43rI1rk3H7usttzq8Qo3j84vavN9mOkAeuq8dHEd9NtCVKX51Oen+MM6IEYvz5StOehKLpIjD+nKU5AQWJpLizdB+1sb5LQvFRxbSJVGHmSdK/0WWaPguEYmcSJ68aWkK6rAw6jwSSCmrTWVHT96R7HwHANEgqybVJL+E2vE2q7Uu91Gr73SbbNUvZDtiOlCeIv4r/AI+0XUwz1lvcAAAAAElFTkSuQmCC");background-size:100% 100%;background-repeat:no-repeat;width:15px;height:15px;margin:auto}.markdown-body h3{width:100%;text-align:left;margin:20px 10px 0 0;font-size:18px;font-weight:700;display:inline-block;padding-left:10px;padding-bottom:0;border-left:5px solid #8f6600;color:#614500}.markdown-body h4,.markdown-body h5,.markdown-body h6{font-weight:700;color:#a37400}.markdown-body h4{font-size:17px}.markdown-body h5,.markdown-body h6{display:flex;align-items:center}.markdown-body h5:after,.markdown-body h6:after{display:inline-block;border:2px solid #fff6e0;color:rgba(189,134,0,.5);border-radius:50%;text-align:center;margin-left:5px}.markdown-body h5{font-size:14px}.markdown-body h5:after{content:"5";width:15px;height:15px;line-height:15px;font-size:13px}.markdown-body h6{font-size:12px}.markdown-body h6:after{content:"6";width:13px;height:13px;line-height:13px;font-size:12px}.markdown-body p{color:#412c0c;letter-spacing:1px;font-weight:400;margin-bottom:16px}.markdown-body img{max-width:100%;display:block;margin:auto}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{color:#755300;font-weight:400;border-bottom:1px solid #755300;font-weight:bolder;text-decoration:none}.markdown-body table{width:100%!important;margin:0;font-size:12px;width:auto;max-width:100%;overflow:auto;border-collapse:collapse;border-spacing:0}.markdown-body table img{box-shadow:none}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body thead tr th{text-align:center}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px;box-sizing:border-box;border:1px solid rgba(72,42,10,.1)}.markdown-body blockquote{position:relative;text-size-adjust:100%;line-height:25px;font-weight:400;border-radius:10px;font-style:normal;text-align:left;box-sizing:inherit;border:1px solid #ffd87a;background-color:rgba(189,134,0,.5);margin:20px 0;padding:20px}.markdown-body blockquote p{color:#fff6e0;letter-spacing:2px;margin:0}.markdown-body blockquote:after,.markdown-body blockquote:before{position:absolute;color:#cc9100;font-size:34px;font-weight:700}.markdown-body blockquote:before{content:"â";top:8px;left:5px}.markdown-body blockquote:after{content:"â";right:5px;bottom:-5px}.markdown-body strong{color:#c28a00;font-weight:bolder}.markdown-body strong:before{content:"ã€Œ"}.markdown-body strong:after{content:"ã€"}.markdown-body em{color:#c28a00}.markdown-body em strong{font-style:normal;color:#c28a00;background-color:#8a6200}.markdown-body s{color:#c28a00}.markdown-body hr{border-top:1px solid #805b00}.markdown-body code,.markdown-body li code,.markdown-body p code{color:#996d00;background-color:rgba(130,98,0,.3)}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit;color:#858585;font-family:bold;letter-spacing:1px}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body h1::selection,.markdown-body h2::selection,.markdown-body h3::selection,.markdown-body h4::selection,.markdown-body h5::selection,.markdown-body h6::selection,.markdown-body img::selection{color:rgba(189,134,0,.5);background-color:#fff}.markdown-body a::selection,.markdown-body b::selection,.markdown-body del::selection,.markdown-body em::selection,.markdown-body i::selection,.markdown-body strong::selection{background-color:transparent}.markdown-body pre&gt;code::selection{background-color:rgba(189,134,0,.5)}.markdown-body .math .math-inline::selection,.markdown-body blockquote::selection,.markdown-body ol::selection,.markdown-body p::selection,.markdown-body strong::selection,.markdown-body table::selection,.markdown-body ul::selection{background-color:rgba(189,134,0,.5)}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">ğŸŒŒ ä¸€ã€å‰è¨€ï¼šå¤§æ¨¡å‹ä¸å†æ˜¯â€œå•æœºç©å®¶â€</h2>
<p>æˆ‘ä»¬æ›¾ä»¥ä¸ºï¼Œå¤§æ¨¡å‹çš„å¥‡è¿¹åªå‘ç”Ÿåœ¨GPUæ•°æ®ä¸­å¿ƒçš„é»‘ç›’é‡Œã€‚<br/>
ä½†AIæ­£åœ¨ç»å†ä¸€æ¬¡â€œç³»ç»Ÿå­¦è¿å¾™â€â€”â€”å®ƒä¸å†å­¤ç«‹ï¼Œè€Œæ˜¯è¿›å…¥æ“ä½œç³»ç»Ÿã€æ•°æ®åº“ã€ç½‘ç»œã€ç‰©è”ç½‘ä¹ƒè‡³æµè§ˆå™¨ã€‚</p>
<p>æƒ³è±¡ä¸€ä¸‹ï¼š</p>
<ul>
<li>æ“ä½œç³»ç»Ÿçš„ä»»åŠ¡è°ƒåº¦å™¨ä¼šâ€œé¢„æµ‹ç”¨æˆ·æ„å›¾â€ï¼›</li>
<li>ç½‘ç»œåè®®æ ˆæ ¹æ®ä¸Šä¸‹æ–‡è‡ªåŠ¨ä¼˜åŒ–æµé‡è·¯å¾„ï¼›</li>
<li>æ•°æ®åº“èƒ½æ ¹æ®é—®é¢˜è‡ªåŠ¨ç”ŸæˆSQLç”šè‡³é€»è¾‘æ¨ç†æ ‘ï¼›</li>
<li>ç»ˆç«¯æµè§ˆå™¨è‡ªå·±å†³å®šä½•æ—¶å‹ç¼©ã€ç¼“å­˜æˆ–ç”Ÿæˆå†…å®¹ã€‚</li>
</ul>
<p>è¿™ä¸æ˜¯é­”æ³•ï¼Œè€Œæ˜¯<strong>å¤§æ¨¡å‹ä¸ç³»ç»Ÿçš„æ·±åº¦å¯èåˆæ¶æ„</strong>ã€‚<br/>
ä¸€å¥è¯æ€»ç»“ï¼š</p>
<blockquote>
<p>AIä¸æ˜¯å¤–æŒ‚ï¼Œè€Œæ˜¯å†…æ ¸ã€‚</p>
</blockquote>
<hr/>
<h2 data-id="heading-1">âš™ï¸ äºŒã€å¤§æ¨¡å‹ + ç³»ç»Ÿï¼šä»å¹¶è¡Œåˆ°å…±ç”Ÿ</h2>
<p>åœ¨ä¼ ç»Ÿç³»ç»Ÿè®¾è®¡ä¸­ï¼Œæˆ‘ä»¬è®²ç©¶çš„æ˜¯ï¼š</p>
<blockquote>
<p>æ¨¡å—åˆ†å±‚ã€èŒè´£éš”ç¦»ã€é€»è¾‘ç¡®å®šã€‚</p>
</blockquote>
<p>è€Œå¤§æ¨¡å‹çš„é€»è¾‘æ˜¯ï¼š</p>
<blockquote>
<p>æ¨¡ç³Šæ¨ç†ã€è¯­ä¹‰ç†è§£ã€ä¸Šä¸‹æ–‡é©±åŠ¨ã€‚</p>
</blockquote>
<p>äºŒè€…åƒä¸€å¯¹æ€§æ ¼è¿¥å¼‚çš„å®¤å‹ï¼š<br/>
ç³»ç»Ÿæ˜¯ä¸¥è°¨çš„æœºæ¢°å·¥ç¨‹å¸ˆï¼Œè€Œæ¨¡å‹æ˜¯çŠ€åˆ©çš„è‰ºæœ¯å®¶ã€‚<br/>
ä½†å½“ä»–ä»¬å­¦ä¼šäº’ç›¸å€¾å¬ï¼Œå°±èƒ½æ„é€ å‡ºä»¤äººæƒŠå¹çš„ã€Œå…±ç”Ÿç³»ç»Ÿã€â€”â€”AIæˆä¸ºç³»ç»Ÿçš„â€œè®¤çŸ¥ä¸­æ¢â€ï¼Œç³»ç»Ÿæˆä¸ºAIçš„â€œç‰©è´¨è½½ä½“â€ã€‚</p>
<hr/>
<h2 data-id="heading-2">ğŸ§© ä¸‰ã€å…¸å‹èåˆåœºæ™¯è®¾æƒ³</h2>









































<table><thead><tr><th>åœºæ™¯</th><th>ç³»ç»Ÿå±‚è§’è‰²</th><th>å¤§æ¨¡å‹è§’è‰²</th><th>é¢„æœŸæ•ˆæœ</th></tr></thead><tbody><tr><td>ğŸ§  æ™ºèƒ½æ“ä½œç³»ç»Ÿ</td><td>è°ƒåº¦ã€é©±åŠ¨ã€å®‰å…¨ç®¡ç†</td><td>ç”¨æˆ·æ„å›¾é¢„æµ‹ã€ä»»åŠ¡ä¸Šä¸‹æ–‡ç†è§£</td><td>â€œä¼šæ€è€ƒâ€çš„ä»»åŠ¡ç®¡ç†</td></tr><tr><td>ğŸ—‚ï¸ æ•°æ®åº“ç³»ç»Ÿ</td><td>å­˜å‚¨ä¸ç´¢å¼•ä¼˜åŒ–</td><td>è¯­ä¹‰æŸ¥è¯¢ç”Ÿæˆã€æ¨¡å¼è¯†åˆ«</td><td>è‡ªä¼˜åŒ–çš„æ•°æ®åº“</td></tr><tr><td>â˜ï¸ äº‘åŸç”ŸåŸºç¡€è®¾æ–½</td><td>æœåŠ¡ç¼–æ’ã€èµ„æºåˆ†é…</td><td>å·¥ä½œè´Ÿè½½é¢„æµ‹ã€å¼‚å¸¸æ£€æµ‹</td><td>è‡ªåŠ¨å¼¹æ€§ä¼¸ç¼©ä¸æ™ºèƒ½è‡ªæ²»</td></tr><tr><td>ğŸ•¸ï¸ Web å‰ç«¯</td><td>æ¸²æŸ“ä¸äº¤äº’æ§åˆ¶</td><td>æ–‡æœ¬ã€è§†è§‰ã€UI è‡ªç”Ÿæˆ</td><td>â€œå¯æ„ŸçŸ¥â€çš„åŠ¨æ€ç•Œé¢</td></tr><tr><td>ğŸ¤– IoT / è¾¹ç¼˜ç³»ç»Ÿ</td><td>ä½åŠŸè€—è®¾å¤‡æ§åˆ¶</td><td>æ¨¡å‹å‰ªæã€è‡ªé€‚åº”å­¦ä¹ </td><td>è¾¹ç¼˜ç«¯æ™ºèƒ½è¿›åŒ–</td></tr></tbody></table>
<hr/>
<h2 data-id="heading-3">ğŸš€ å››ã€æ¶æ„çŒœæƒ³ï¼šå¤§æ¨¡å‹-ç³»ç»Ÿèåˆçš„æœªæ¥å½¢æ€</h2>
<p>è®©æˆ‘ä»¬å°è¯•ç”»å‡ºè¿™ç§æœªæ¥æ¶æ„çš„é€»è¾‘å±‚æ¬¡ï¼Œç”¨æ€æƒ³çš„ASCIIçº¿æ¡æ‹¼ä¸€ä¸ªç®€åŒ–ç‰ˆğŸ‘‡</p>
<pre><code class="hljs language-css" lang="css">â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘         ç”¨æˆ·äº¤äº’å±‚          â•‘ â† è‡ªç„¶è¯­è¨€ / å¤šæ¨¡æ€æ¥å£
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘      AIGC åº”ç”¨ååŒå±‚        â•‘ â† Promptä»£ç† / å†…å®¹è°ƒåº¦
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘   å¤§æ¨¡å‹æœåŠ¡ä¸è®¤çŸ¥å†…æ ¸å±‚    â•‘ â† å¤šæ¨¡å‹åä½œ / çŸ¥è¯†å›¾è°±æ¥å£
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘      ç³»ç»Ÿèåˆé€‚é…å±‚          â•‘ â† API Hook / <span class="hljs-selector-tag">I</span>/O Semantic Adapter
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘   æ“ä½œç³»ç»Ÿä¸åº•å±‚èµ„æºå±‚       â•‘ â† CPU/GPUè°ƒåº¦ / å†…å­˜ä¸Šä¸‹æ–‡å¢å¼º
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
</code></pre>
<p>ğŸ¯ <strong>å…³é”®è¯è§£é‡Šï¼š</strong></p>
<ul>
<li><em>è®¤çŸ¥å†…æ ¸å±‚</em>ï¼šè´Ÿè´£è¯­è¨€æ¨ç†ã€ä¸–ç•Œå»ºæ¨¡ä¸ç­–ç•¥ç”Ÿæˆã€‚</li>
<li><em>é€‚é…å±‚</em>ï¼šæ˜¯AIä¸ç³»ç»Ÿé€šä¿¡çš„æ¡¥æ¢ï¼Œæ¯”å¦‚AI Hook APIã€‚</li>
<li><em>ååŒå±‚</em>ï¼šè°ƒåº¦å¤šä¸ªAI Agentåä½œï¼Œä¾‹å¦‚å†…å®¹ç”Ÿæˆã€æ¨ç†æœåŠ¡ã€ç”¨æˆ·æ„å›¾è§£æã€‚</li>
</ul>
<hr/>
<h2 data-id="heading-4">ğŸ’¡ äº”ã€èåˆçš„å…³é”®æœºåˆ¶</h2>
<ol>
<li>
<p><strong>ä¸Šä¸‹æ–‡æ„ŸçŸ¥ï¼ˆContext Injectionï¼‰</strong><br/>
ç³»ç»Ÿé€šè¿‡å…±äº«è¿è¡Œæ€ä¿¡æ¯ï¼ˆCPUè´Ÿè½½ã€ç½‘ç»œå»¶è¿Ÿã€ç”¨æˆ·äº¤äº’ï¼‰ä¾›æ¨¡å‹æ¨ç†ï¼Œä½¿AIå†³ç­–â€œæœ‰åœ°æ°”â€ã€‚</p>
</li>
<li>
<p><strong>è¯­ä¹‰ä¸­é—´ä»¶ï¼ˆSemantic Middlewareï¼‰</strong><br/>
å¼•å…¥è¯­è¨€å±‚APIï¼Œå°†ç³»ç»Ÿè°ƒç”¨å°è£…ä¸ºè‡ªç„¶è¯­è¨€æ„å›¾æ¥å£ã€‚</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-comment">// ğŸ§  è¯­ä¹‰è°ƒç”¨ç¤ºä¾‹ï¼šAI è®©æ“ä½œç³»ç»Ÿåšäº‹</span>
<span class="hljs-keyword">await</span> OS.semanticCall(<span class="hljs-string">"ä¼˜åŒ–æœ¬åœ°æ–‡ä»¶ç´¢å¼•"</span>, { priority: <span class="hljs-string">"low"</span> });
</code></pre>
</li>
<li>
<p><strong>æ¨¡å‹ç³»ç»ŸååŒè°ƒåº¦ï¼ˆCo-schedulingï¼‰</strong><br/>
æ¨¡å‹ä»»åŠ¡æˆä¸ºç³»ç»Ÿè¿›ç¨‹çš„ä¸€ç­‰å…¬æ°‘ï¼Œç”±æ“ä½œç³»ç»Ÿåè°ƒèµ„æºï¼Œè€Œéç”±å¤–å±‚ç¨‹åºä¸´æ—¶è°ƒç”¨ã€‚</p>
</li>
<li>
<p><strong>æ•°æ®â€”æ¨¡å‹å¾ªç¯ï¼ˆFeedback Loopï¼‰</strong><br/>
ç³»ç»Ÿé‡‡é›†è¿è¡Œæ•°æ® â†’ æ¨¡å‹ä¼˜åŒ–ç­–ç•¥ â†’ å†è°ƒæ•´ç³»ç»Ÿè¡Œä¸ºï¼Œå¦‚åŒè‡ªå­¦ä¹ ç”Ÿæ€ä½“ã€‚</p>
</li>
</ol>
<hr/>
<h2 data-id="heading-5">ğŸ§± å…­ã€ä¸€ä¸ªç®€åŒ–çš„èåˆåŸå‹â€”â€”â€œæ™ºèƒ½ç³»ç»Ÿè°ƒåº¦å™¨â€</h2>
<p>è®©æˆ‘ä»¬æ¥æ®µå¹½é»˜çš„ä¼ªä»£ç ï¼Œè®¾æƒ³ä¸€ä¸ªç³»ç»Ÿå†…æ ¸ä¸­çš„AIä»£ç†ï¼Œå®ƒä¼šè‡ªåŠ¨å†³å®šæ˜¯ä¸æ˜¯è¯¥å¼€é£æ‰‡ ğŸ˜†</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// ğŸŒ¡ï¸ æ™ºèƒ½ç³»ç»Ÿè°ƒåº¦å™¨åŸå‹ï¼ˆèåˆAIå†³ç­–ï¼‰</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">AwareScheduler</span> {
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">model</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">model</span> = model;
  }

  <span class="hljs-keyword">async</span> <span class="hljs-title function_">observeSystem</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">return</span> {
      <span class="hljs-attr">cpuUsage</span>: <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>() * <span class="hljs-number">100</span>,
      <span class="hljs-attr">temp</span>: <span class="hljs-number">36</span> + <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>() * <span class="hljs-number">20</span>,
      <span class="hljs-attr">runningTasks</span>: [<span class="hljs-string">"AI_render"</span>, <span class="hljs-string">"data_sync"</span>, <span class="hljs-string">"web_server"</span>]
    };
  }

  <span class="hljs-keyword">async</span> <span class="hljs-title function_">decide</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">const</span> context = <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">observeSystem</span>();
    <span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">model</span>.<span class="hljs-title function_">generate</span>(<span class="hljs-string">`
      å½“å‰CPUä½¿ç”¨ç‡ä¸º<span class="hljs-subst">${context.cpuUsage.toFixed(<span class="hljs-number">1</span>)}</span>%ï¼Œæ¸©åº¦ä¸º<span class="hljs-subst">${context.temp.toFixed(<span class="hljs-number">1</span>)}</span>â„ƒï¼Œ
      è¿è¡Œä»»åŠ¡ä¸º<span class="hljs-subst">${context.runningTasks.join(<span class="hljs-string">"ã€"</span>)}</span>
      è¯¥å¦‚ä½•è°ƒåº¦ä»»åŠ¡ä¸é£æ‰‡è½¬é€Ÿï¼Ÿè¯·è¾“å‡ºæŒ‡ä»¤å­—ç¬¦ä¸²ã€‚
    `</span>);
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"ğŸ§  æ¨¡å‹ç­–ç•¥è¾“å‡ºï¼š"</span>, response);
  }
}

<span class="hljs-comment">// æ¨¡å‹ï¼ˆç®€åŒ–ç‰ˆï¼Œå¤§æ¦‚åªä¼šèƒ¡è¯´å…«é“ï¼‰</span>
<span class="hljs-keyword">const</span> fakeModel = {
  <span class="hljs-keyword">async</span> <span class="hljs-title function_">generate</span>(<span class="hljs-params">prompt</span>) {
    <span class="hljs-keyword">if</span> (prompt.<span class="hljs-title function_">includes</span>(<span class="hljs-string">"æ¸©åº¦ä¸º"</span>)) <span class="hljs-keyword">return</span> <span class="hljs-string">"å¼€é£æ‰‡åŠ å¼ºå†·å´ï¼Œå¹¶é™ä½AI_renderè¿›ç¨‹æƒé‡ã€‚"</span>;
    <span class="hljs-keyword">return</span> <span class="hljs-string">"ç³»ç»Ÿç¨³å®šï¼Œç»§ç»­è¿è¡Œã€‚"</span>;
  }
};

<span class="hljs-comment">// å¯åŠ¨AIå†…æ ¸çš„è°ƒåº¦å™¨</span>
<span class="hljs-keyword">const</span> scheduler = <span class="hljs-keyword">new</span> <span class="hljs-title class_">AwareScheduler</span>(fakeModel);
scheduler.<span class="hljs-title function_">decide</span>();
</code></pre>
<p>è¿™è™½æ˜¯ç©ç¬‘ï¼Œä½†å±•ç¤ºäº†â€œå¤§æ¨¡å‹å†…åµŒç³»ç»Ÿâ€ï¼Œé€šè¿‡è¯­ä¹‰é€»è¾‘æ§åˆ¶ä½å±‚æ“ä½œçš„è½®å»“ã€‚<br/>
æœªæ¥æ“ä½œç³»ç»Ÿçš„æ—¥å¿—æˆ–è®¸é•¿è¿™æ ·ï¼š</p>
<pre><code class="hljs language-markdown" lang="markdown">[<span class="hljs-symbol">AI_DECISION</span>]: <span class="hljs-link">é™ä½GPUè°ƒåº¦ä¼˜å…ˆçº§ï¼Œæ£€æµ‹é£å™ªï¼Œç”¨æˆ·åœ¨è§†é¢‘é€šè¯ä¸­ã€‚  </span>
[<span class="hljs-symbol">SYS_ACTION</span>]: <span class="hljs-link">å·²è°ƒæ•´é£æ‰‡é€Ÿç‡è‡³é™éŸ³æ¨¡å¼ã€‚</span>
</code></pre>
<hr/>
<h2 data-id="heading-6">ğŸŒ ä¸ƒã€ä¼¦ç†ä¸æ²»ç†ï¼šæ™ºèƒ½å†…æ ¸ä¸æ˜¯ä¸»å®°ï¼Œè€Œæ˜¯ä¼™ä¼´</h2>
<p>å½“æˆ‘ä»¬è°ˆâ€œAIåµŒå…¥ç³»ç»Ÿâ€ï¼ŒåŒæ—¶ä¹Ÿè¦é¢å¯¹<strong>å®‰å…¨ä¸è´£ä»»è¾¹ç•Œ</strong>ï¼š</p>
<ul>
<li>âœ… <strong>å¯è§£é‡Šæ€§</strong>ï¼šAIçš„æ¯æ¬¡ç³»ç»Ÿè°ƒç”¨éƒ½å¿…é¡»æœ‰å†³ç­–ä¾æ®ã€‚</li>
<li>ğŸ”’ <strong>å®‰å…¨ç½‘å…³</strong>ï¼šé¿å…AIç›´æ¥è®¿é—®å†…æ ¸çº§èµ„æºï¼Œæ— äººç›‘ç£è¡Œä¸ºã€‚</li>
<li>ğŸ§­ <strong>æ²»ç†æ¥å£</strong>ï¼šä¸ºAIå†³ç­–æ„å»ºå®¡è®¡ä¸äººå·¥å¹²é¢„æœºåˆ¶ã€‚</li>
</ul>
<p>åªæœ‰åœ¨äººç±»ä»æ˜¯ç³»ç»Ÿâ€œæœ€ç»ˆè§£é‡Šè€…â€çš„å‰æä¸‹ï¼Œå¤§æ¨¡å‹èåˆæ‰æ˜¯æ–‡æ˜çš„ï¼Œè€Œéé£é™©çš„ã€‚</p>
<hr/>
<h2 data-id="heading-7">ğŸŒˆ å…«ã€ç»“è¯­ï¼šç³»ç»Ÿåœ¨å˜èªæ˜ï¼ŒAIåœ¨å˜è„šè¸å®åœ°</h2>
<p>æœªæ¥çš„æ¶æ„ä¸ä¼šå†æœ‰æ¸…æ™°çš„è¾¹ç•Œâ€”â€”<br/>
æ“ä½œç³»ç»Ÿä¼šâ€œè¯´è¯â€ï¼Œå¤§æ¨¡å‹ä¼šâ€œè°ƒåº¦â€ï¼Œè®¡ç®—æœºå°†é€æ¸æ¼”åŒ–ä¸ºã€Œè®¤çŸ¥ç”Ÿæ€ã€ã€‚</p>
<p>æˆ–è®¸æœ‰ä¸€å¤©ï¼Œæˆ‘ä»¬å†™ä¸‹è¿™æ ·çš„ä»£ç ï¼š</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">await</span> System.think(<span class="hljs-string">"æˆ‘æ˜¯ä¸æ˜¯è¯¥ä¼˜åŒ–è‡ªå·±äº†ï¼Ÿ"</span>);
</code></pre>
<p>è€Œæ§åˆ¶å°æ·¡å®šåœ°å›å¤ï¼š</p>
<pre><code class="hljs language-erlang" lang="erlang">ğŸ§  æˆ‘åˆšå®Œæˆä¸€æ¬¡è‡ªç›‘ç£è°ƒä¼˜ï¼Œæ€§èƒ½æå‡<span class="hljs-number">12</span><span class="hljs-comment">%ï¼Œè°¢è°¢ä½ çš„å…³å¿ƒã€‚</span>
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ã€Android è¿›é˜¶ã€‘ä¸ºä»€ä¹ˆä½ åº”è¯¥åœæ­¢åœ¨ ViewModel `init` ä¸­åŠ è½½æ•°æ®ï¼Ÿ]]></title>    <link>https://juejin.cn/post/7580312375373021224</link>    <guid>https://juejin.cn/post/7580312375373021224</guid>    <pubDate>2025-12-07T03:20:25.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7580312375373021224" data-draft-id="7580312375373004840" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ã€Android è¿›é˜¶ã€‘ä¸ºä»€ä¹ˆä½ åº”è¯¥åœæ­¢åœ¨ ViewModel `init` ä¸­åŠ è½½æ•°æ®ï¼Ÿ"/> <meta itemprop="keywords" content="Android"/> <meta itemprop="datePublished" content="2025-12-07T03:20:25.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="åŸå ¡ä¿®ç‚¼è€…"/> <meta itemprop="url" content="https://juejin.cn/user/2379804202775341"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ã€Android è¿›é˜¶ã€‘ä¸ºä»€ä¹ˆä½ åº”è¯¥åœæ­¢åœ¨ ViewModel `init` ä¸­åŠ è½½æ•°æ®ï¼Ÿ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2379804202775341/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    åŸå ¡ä¿®ç‚¼è€…
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-07T03:20:25.000Z" title="Sun Dec 07 2025 03:20:25 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-07
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    9
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»3åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body .octicon{display:inline-block;fill:currentColor;vertical-align:text-bottom}.markdown-body .anchor{float:left;line-height:1;margin-left:-20px;padding-right:4px}.markdown-body .anchor:focus{outline:none}.markdown-body h1 .octicon-link,.markdown-body h2 .octicon-link,.markdown-body h3 .octicon-link,.markdown-body h4 .octicon-link,.markdown-body h5 .octicon-link,.markdown-body h6 .octicon-link{color:#1b1f23;vertical-align:middle;visibility:hidden}.markdown-body h1:hover .anchor,.markdown-body h2:hover .anchor,.markdown-body h3:hover .anchor,.markdown-body h4:hover .anchor,.markdown-body h5:hover .anchor,.markdown-body h6:hover .anchor{text-decoration:none}.markdown-body h1:hover .anchor .octicon-link,.markdown-body h2:hover .anchor .octicon-link,.markdown-body h3:hover .anchor .octicon-link,.markdown-body h4:hover .anchor .octicon-link,.markdown-body h5:hover .anchor .octicon-link,.markdown-body h6:hover .anchor .octicon-link{visibility:visible}.markdown-body h1:hover .anchor .octicon-link:before,.markdown-body h2:hover .anchor .octicon-link:before,.markdown-body h3:hover .anchor .octicon-link:before,.markdown-body h4:hover .anchor .octicon-link:before,.markdown-body h5:hover .anchor .octicon-link:before,.markdown-body h6:hover .anchor .octicon-link:before{width:16px;height:16px;content:" ";display:inline-block;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' aria-hidden='true'%3E%3Cpath fill-rule='evenodd' d='M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z'/%3E%3C/svg%3E")}.markdown-body{-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%;color:#24292e;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Helvetica,Arial,sans-serif,Apple Color Emoji,Segoe UI Emoji;font-size:16px;line-height:1.5;word-wrap:break-word}.markdown-body details{display:block}.markdown-body summary{display:list-item}.markdown-body a{background-color:initial}.markdown-body a:active,.markdown-body a:hover{outline-width:0}.markdown-body strong{font-weight:inherit;font-weight:bolder}.markdown-body h1{margin:.67em 0}.markdown-body img{border-style:none}.markdown-body code,.markdown-body kbd,.markdown-body pre{font-family:monospace,monospace;font-size:1em}.markdown-body hr{box-sizing:initial;overflow:visible}.markdown-body input{font:inherit;margin:0;overflow:visible}.markdown-body [type=checkbox]{box-sizing:border-box;padding:0}.markdown-body *{box-sizing:border-box}.markdown-body input{font-family:inherit;font-size:inherit;line-height:inherit}.markdown-body a{color:#0366d6;text-decoration:none}.markdown-body a:hover{text-decoration:underline}.markdown-body strong{font-weight:600}.markdown-body hr{height:0;margin:15px 0;overflow:hidden;background:transparent;border-bottom:1px solid #dfe2e5}.markdown-body hr:after,.markdown-body hr:before{display:table;content:""}.markdown-body hr:after{clear:both}.markdown-body table{border-spacing:0;border-collapse:collapse}.markdown-body td,.markdown-body th{padding:0}.markdown-body details summary{cursor:pointer}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{margin-top:0;margin-bottom:0}.markdown-body h1{font-size:32px}.markdown-body h1,.markdown-body h2{font-weight:600}.markdown-body h2{font-size:24px}.markdown-body h3{font-size:20px}.markdown-body h3,.markdown-body h4{font-weight:600}.markdown-body h4{font-size:16px}.markdown-body h5{font-size:14px}.markdown-body h5,.markdown-body h6{font-weight:600}.markdown-body h6{font-size:12px}.markdown-body p{margin-top:0;margin-bottom:10px}.markdown-body blockquote{margin:0}.markdown-body ol,.markdown-body ul{padding-left:0;margin-top:0;margin-bottom:0}.markdown-body ol ol,.markdown-body ul ol{list-style-type:lower-roman}.markdown-body ol ol ol,.markdown-body ol ul ol,.markdown-body ul ol ol,.markdown-body ul ul ol{list-style-type:lower-alpha}.markdown-body dd{margin-left:0}.markdown-body code,.markdown-body pre{font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,monospace;font-size:12px}.markdown-body pre{margin-top:0;margin-bottom:0}.markdown-body input::-webkit-inner-spin-button,.markdown-body input::-webkit-outer-spin-button{margin:0;-webkit-appearance:none;appearance:none}.markdown-body :checked+.radio-label{position:relative;z-index:1;border-color:#0366d6}.markdown-body .border{border:1px solid #e1e4e8!important}.markdown-body .border-0{border:0!important}.markdown-body .border-bottom{border-bottom:1px solid #e1e4e8!important}.markdown-body .rounded-1{border-radius:3px!important}.markdown-body .bg-white{background-color:#fff!important}.markdown-body .bg-gray-light{background-color:#fafbfc!important}.markdown-body .text-gray-light{color:#6a737d!important}.markdown-body .pl-3,.markdown-body .px-3{padding-left:16px!important}.markdown-body .px-3{padding-right:16px!important}.markdown-body .f6{font-size:12px!important}.markdown-body .lh-condensed{line-height:1.25!important}.markdown-body .text-bold{font-weight:600!important}.markdown-body .pl-c{color:#6a737d}.markdown-body .pl-c1,.markdown-body .pl-s .pl-v{color:#005cc5}.markdown-body .pl-e,.markdown-body .pl-en{color:#6f42c1}.markdown-body .pl-s .pl-s1,.markdown-body .pl-smi{color:#24292e}.markdown-body .pl-ent{color:#22863a}.markdown-body .pl-k{color:#d73a49}.markdown-body .pl-pds,.markdown-body .pl-s,.markdown-body .pl-s .pl-pse .pl-s1,.markdown-body .pl-sr,.markdown-body .pl-sr .pl-cce,.markdown-body .pl-sr .pl-sra,.markdown-body .pl-sr .pl-sre{color:#032f62}.markdown-body .pl-smw,.markdown-body .pl-v{color:#e36209}.markdown-body .pl-bu{color:#b31d28}.markdown-body .pl-ii{color:#fafbfc;background-color:#b31d28}.markdown-body .pl-c2{color:#fafbfc;background-color:#d73a49}.markdown-body .pl-c2:before{content:"^M"}.markdown-body .pl-sr .pl-cce{font-weight:700;color:#22863a}.markdown-body .pl-ml{color:#735c0f}.markdown-body .pl-mh,.markdown-body .pl-mh .pl-en,.markdown-body .pl-ms{font-weight:700;color:#005cc5}.markdown-body .pl-mi{font-style:italic;color:#24292e}.markdown-body .pl-mb{font-weight:700;color:#24292e}.markdown-body .pl-md{color:#b31d28;background-color:#ffeef0}.markdown-body .pl-mi1{color:#22863a;background-color:#f0fff4}.markdown-body .pl-mc{color:#e36209;background-color:#ffebda}.markdown-body .pl-mi2{color:#f6f8fa;background-color:#005cc5}.markdown-body .pl-mdr{font-weight:700;color:#6f42c1}.markdown-body .pl-ba{color:#586069}.markdown-body .pl-sg{color:#959da5}.markdown-body .pl-corl{text-decoration:underline;color:#032f62}.markdown-body .mb-0{margin-bottom:0!important}.markdown-body .my-2{margin-bottom:8px!important;margin-top:8px!important}.markdown-body .pl-0{padding-left:0!important}.markdown-body .py-0{padding-top:0!important;padding-bottom:0!important}.markdown-body .pl-1{padding-left:4px!important}.markdown-body .pl-2{padding-left:8px!important}.markdown-body .py-2{padding-top:8px!important;padding-bottom:8px!important}.markdown-body .pl-3{padding-left:16px!important}.markdown-body .pl-4{padding-left:24px!important}.markdown-body .pl-5{padding-left:32px!important}.markdown-body .pl-6{padding-left:40px!important}.markdown-body .pl-7{padding-left:48px!important}.markdown-body .pl-8{padding-left:64px!important}.markdown-body .pl-9{padding-left:80px!important}.markdown-body .pl-10{padding-left:96px!important}.markdown-body .pl-11{padding-left:112px!important}.markdown-body .pl-12{padding-left:128px!important}.markdown-body hr{border-bottom-color:#eee}.markdown-body kbd{display:inline-block;padding:3px 5px;font:11px SFMono-Regular,Consolas,Liberation Mono,Menlo,monospace;line-height:10px;color:#444d56;vertical-align:middle;background-color:#fafbfc;border:1px solid #d1d5da;border-radius:3px;box-shadow:inset 0 -1px 0 #d1d5da}.markdown-body:after,.markdown-body:before{display:table;content:""}.markdown-body:after{clear:both}.markdown-body&gt;:first-child{margin-top:0!important}.markdown-body&gt;:last-child{margin-bottom:0!important}.markdown-body a:not([href]){color:inherit;text-decoration:none}.markdown-body blockquote,.markdown-body details,.markdown-body dl,.markdown-body ol,.markdown-body p,.markdown-body pre,.markdown-body table,.markdown-body ul{margin-top:0;margin-bottom:16px}.markdown-body hr{height:.25em;padding:0;margin:24px 0;background-color:#e1e4e8;border:0}.markdown-body blockquote{padding:0 1em;color:#6a737d;border-left:.25em solid #dfe2e5}.markdown-body blockquote&gt;:first-child{margin-top:0}.markdown-body blockquote&gt;:last-child{margin-bottom:0}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{margin-top:24px;margin-bottom:16px;font-weight:600;line-height:1.25}.markdown-body h1{font-size:2em}.markdown-body h1,.markdown-body h2{padding-bottom:.3em;border-bottom:1px solid #eaecef}.markdown-body h2{font-size:1.5em}.markdown-body h3{font-size:1.25em}.markdown-body h4{font-size:1em}.markdown-body h5{font-size:.875em}.markdown-body h6{font-size:.85em;color:#6a737d}.markdown-body ol,.markdown-body ul{padding-left:2em}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:0;margin-bottom:0}.markdown-body li{word-wrap:break-all}.markdown-body li&gt;p{margin-top:16px}.markdown-body li+li{margin-top:.25em}.markdown-body dl{padding:0}.markdown-body dl dt{padding:0;margin-top:16px;font-size:1em;font-style:italic;font-weight:600}.markdown-body dl dd{padding:0 16px;margin-bottom:16px}.markdown-body table{display:block;width:100%;overflow:auto}.markdown-body table th{font-weight:600}.markdown-body table td,.markdown-body table th{padding:6px 13px;border:1px solid #dfe2e5}.markdown-body table tr{background-color:#fff;border-top:1px solid #c6cbd1}.markdown-body table tr:nth-child(2n){background-color:#f6f8fa}.markdown-body img{max-width:100%;box-sizing:initial;background-color:#fff}.markdown-body img[align=right]{padding-left:20px}.markdown-body img[align=left]{padding-right:20px}.markdown-body code{padding:.2em .4em;margin:0;font-size:85%;background-color:rgba(27,31,35,.05);border-radius:3px}.markdown-body pre{word-wrap:normal}.markdown-body pre&gt;code{padding:0;margin:0;font-size:100%;word-break:normal;white-space:pre;background:transparent;border:0}.markdown-body .highlight{margin-bottom:16px}.markdown-body .highlight pre{margin-bottom:0;word-break:normal}.markdown-body .highlight pre,.markdown-body pre{padding:16px;overflow:auto;font-size:85%;line-height:1.45;background-color:#f6f8fa;border-radius:3px}.markdown-body pre code{display:inline;max-width:auto;padding:0;margin:0;overflow:visible;line-height:inherit;word-wrap:normal;background-color:initial;border:0}.markdown-body .commit-tease-sha{display:inline-block;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,monospace;font-size:90%;color:#444d56}.markdown-body .full-commit .btn-outline:not(:disabled):hover{color:#005cc5;border-color:#005cc5}.markdown-body .blob-wrapper{overflow-x:auto;overflow-y:hidden}.markdown-body .blob-wrapper-embedded{max-height:240px;overflow-y:auto}.markdown-body .blob-num{width:1%;min-width:50px;padding-right:10px;padding-left:10px;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,monospace;font-size:12px;line-height:20px;color:rgba(27,31,35,.3);text-align:right;white-space:nowrap;vertical-align:top;cursor:pointer;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.markdown-body .blob-num:hover{color:rgba(27,31,35,.6)}.markdown-body .blob-num:before{content:attr(data-line-number)}.markdown-body .blob-code{position:relative;padding-right:10px;padding-left:10px;line-height:20px;vertical-align:top}.markdown-body .blob-code-inner{overflow:visible;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,monospace;font-size:12px;color:#24292e;word-wrap:normal;white-space:pre}.markdown-body .pl-token.active,.markdown-body .pl-token:hover{cursor:pointer;background:#ffea7f}.markdown-body .tab-size[data-tab-size="1"]{-moz-tab-size:1;tab-size:1}.markdown-body .tab-size[data-tab-size="2"]{-moz-tab-size:2;tab-size:2}.markdown-body .tab-size[data-tab-size="3"]{-moz-tab-size:3;tab-size:3}.markdown-body .tab-size[data-tab-size="4"]{-moz-tab-size:4;tab-size:4}.markdown-body .tab-size[data-tab-size="5"]{-moz-tab-size:5;tab-size:5}.markdown-body .tab-size[data-tab-size="6"]{-moz-tab-size:6;tab-size:6}.markdown-body .tab-size[data-tab-size="7"]{-moz-tab-size:7;tab-size:7}.markdown-body .tab-size[data-tab-size="8"]{-moz-tab-size:8;tab-size:8}.markdown-body .tab-size[data-tab-size="9"]{-moz-tab-size:9;tab-size:9}.markdown-body .tab-size[data-tab-size="10"]{-moz-tab-size:10;tab-size:10}.markdown-body .tab-size[data-tab-size="11"]{-moz-tab-size:11;tab-size:11}.markdown-body .tab-size[data-tab-size="12"]{-moz-tab-size:12;tab-size:12}.markdown-body .task-list-item{list-style-type:none}.markdown-body .task-list-item+.task-list-item{margin-top:3px}.markdown-body .task-list-item input{margin:0 .2em .25em -1.6em;vertical-align:middle}</style><style data-highlight="" data-highlight-key="github">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>åœ¨ Android åº”ç”¨å¼€å‘ä¸­ï¼Œ"å¦‚ä½•åŠ è½½åˆå§‹æ•°æ®" ä¼¼ä¹æ˜¯ä¸€ä¸ªè€ç”Ÿå¸¸è°ˆçš„è¯é¢˜ã€‚ç„¶è€Œï¼Œå³ä½¿æ˜¯ç»éªŒä¸°å¯Œçš„å¼€å‘è€…ï¼Œå¸¸å¸¸ä¹Ÿä¼šåœ¨<strong>é…ç½®å˜æ›´ï¼ˆConfiguration Changesï¼‰</strong> å’Œ<strong>å•å…ƒæµ‹è¯•ï¼ˆUnit Testingï¼‰</strong> è¿™ä¸¤ä¸ªæç«¯ä¹‹é—´å·¦å³ä¸ºéš¾ã€‚</p>
<p>ä½ æ˜¯å¦é‡åˆ°è¿‡ä»¥ä¸‹æƒ…å†µï¼Ÿ</p>
<ol>
<li>å±å¹•æ—‹è½¬åï¼Œæ•°æ®åˆé‡æ–°è¯·æ±‚äº†ä¸€æ¬¡ï¼Œæµªè´¹äº†æµé‡ã€‚</li>
<li>è¯•å›¾æµ‹è¯• ViewModelï¼Œä½†æ•°æ®åœ¨å®ä¾‹åŒ–æ—¶å°±è‡ªåŠ¨åŠ è½½äº†ï¼Œå¯¼è‡´æ— æ³• Mock åˆå§‹çŠ¶æ€ã€‚</li>
</ol>
<p>æœ¬æ–‡å°†ä»‹ç»ä¸€ç§ç»“åˆäº† <strong>Flow</strong> æ“ä½œç¬¦çš„â€œæœ€ä½³å®è·µâ€ï¼Œå®ƒèƒ½å®Œç¾è§£å†³ä¸Šè¿°ä¸¤ä¸ªç—›ç‚¹ï¼Œè®©ä½ çš„ä»£ç æ—¢å¥å£®åˆæ˜“äºæµ‹è¯•ã€‚</p>
<hr/>
<h2 data-id="heading-0">â›” å¸¸è§çš„ä¸¤ç§â€œä¸å®Œç¾â€å†™æ³•</h2>
<p>åœ¨ä»‹ç»æœ€ä½³æ–¹æ¡ˆä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆå¿«é€Ÿå›é¡¾ä¸€ä¸‹ç›®å‰æœ€ä¸»æµçš„ä¸¤ç§åšæ³•ï¼Œä»¥åŠå®ƒä»¬çš„é—®é¢˜æ‰€åœ¨ã€‚</p>
<h3 data-id="heading-1">1. è¿™ç§å†™æ³•ï¼š<code>LaunchedEffect</code></h3>
<p>åœ¨ Compose UI ä¸­ç›´æ¥è§¦å‘ï¼š</p>
<pre><code class="hljs language-Kotlin" lang="Kotlin"><span class="hljs-meta">@Composable</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">MyScreen</span><span class="hljs-params">(viewModel: <span class="hljs-type">MyViewModel</span>)</span></span> {
 Â   LaunchedEffect(<span class="hljs-built_in">Unit</span>) {
 Â  Â  Â   viewModel.loadData()
 Â   }
 Â   <span class="hljs-comment">// ...</span>
}
</code></pre>
<ul>
<li><strong>ä¼˜ç‚¹</strong>ï¼šæµ‹è¯•æ–¹ä¾¿ï¼Œå› ä¸ºä½ å¯ä»¥æ§åˆ¶ä½•æ—¶è°ƒç”¨ <code>loadData</code>ã€‚</li>
<li><strong>ç—›ç‚¹</strong>ï¼š<strong>é…ç½®å˜æ›´å™©æ¢¦</strong>ã€‚å½“ç”¨æˆ·æ—‹è½¬å±å¹•æ—¶ï¼ŒActivity é‡å»ºï¼Œ<code>LaunchedEffect</code> é‡æ–°æ‰§è¡Œï¼Œå¯¼è‡´é‡å¤çš„ç½‘ç»œè¯·æ±‚ã€‚è¿™ä¸ä»…æµªè´¹èµ„æºï¼Œè¿˜å¯èƒ½å¯¼è‡´ UI é—ªçƒã€‚</li>
</ul>
<h3 data-id="heading-2">2. è¿™ç§å†™æ³•ï¼šViewModel <code>init</code> å—</h3>
<p>åœ¨ ViewModel åˆå§‹åŒ–æ—¶è§¦å‘ï¼š</p>
<pre><code class="hljs language-Kotlin" lang="Kotlin"><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyViewModel</span>(<span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> repo: Repository) : ViewModel() {
 Â   <span class="hljs-keyword">init</span> {
 Â  Â  Â   loadData()
 Â   }
}
</code></pre>
<ul>
<li><strong>ä¼˜ç‚¹</strong>ï¼šè§£å†³äº†æ—‹è½¬é—®é¢˜ã€‚ViewModel åœ¨é…ç½®å˜æ›´æœŸé—´æ˜¯å­˜æ´»çš„ï¼Œæ‰€ä»¥ <code>init</code> ä¸ä¼šé‡æ–°è¿è¡Œã€‚</li>
<li><strong>ç—›ç‚¹</strong>ï¼š<strong>æµ‹è¯•åœ°ç‹±</strong>ã€‚æ•°æ®åŠ è½½ä½œä¸ºæ„é€ å‡½æ•°çš„å‰¯ä½œç”¨ç«‹å³å‘ç”Ÿã€‚ä½ æ— æ³•åœ¨ <code>loadData</code> æ‰§è¡Œä¹‹å‰è®¾ç½®æµ‹è¯•ç¯å¢ƒï¼ˆæ¯”å¦‚ Mock ç‰¹å®šçš„æµå‘å°„ï¼‰ï¼Œè¿™è®©ç¼–å†™ç²¾å‡†çš„å•å…ƒæµ‹è¯•å˜å¾—éå¸¸å›°éš¾ã€‚</li>
</ul>
<hr/>
<h2 data-id="heading-3">âœ… æœ€ä½³å®è·µï¼š<code>onStart</code> + <code>stateIn</code></h2>
<p>æˆ‘ä»¬éœ€è¦çš„æ–¹æ¡ˆå¿…é¡»æ»¡è¶³ä¸¤ç‚¹ï¼š</p>
<ol>
<li><strong>æ‡’åŠ è½½ï¼ˆLazyï¼‰</strong> ï¼šåªæœ‰ UI å¼€å§‹ç›‘å¬æ—¶æ‰åŠ è½½ï¼ˆåˆ©äºæµ‹è¯•ï¼‰ã€‚</li>
<li><strong>ç¼“å­˜ï¼ˆCachingï¼‰</strong> ï¼šåœ¨å±å¹•æ—‹è½¬ç­‰çŸ­æš‚ä¸­æ–­æ—¶ï¼Œä¿æŒæ•°æ®ä¸é‡æ–°åŠ è½½ã€‚</li>
</ol>
<p>æˆ‘ä»¬å¯ä»¥åˆ©ç”¨ Kotlin Flow çš„ <code>onStart</code> æ“ä½œç¬¦é…åˆ <code>stateIn</code> çš„ <code>WhileSubscribed</code> ç­–ç•¥æ¥å®ç°ã€‚</p>
<h3 data-id="heading-4">ä»£ç å®ç°</h3>
<p>çœ‹çœ‹è¿™ä¸ªä¼˜é›…çš„å®ç°æ–¹å¼ï¼š</p>
<pre><code class="hljs language-Kotlin" lang="Kotlin"><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyViewModel</span>(<span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> repository: MyRepository) : ViewModel() {
â€‹
 Â   <span class="hljs-comment">// 1. æˆ‘ä»¬ä¸å†ä½¿ç”¨ init å—ï¼Œä¹Ÿä¸ä½¿ç”¨ private MutableStateFlow</span>
 Â  Â 
 Â   <span class="hljs-keyword">val</span> uiState: StateFlow&lt;UiState&gt; = repository.observeData()
 Â  Â  Â   <span class="hljs-comment">// 2. å…³é”®ç‚¹ï¼šä½¿ç”¨ onStart è§¦å‘å‰¯ä½œç”¨ï¼ˆåŠ è½½æ•°æ®ï¼‰</span>
 Â  Â  Â   .onStart {
 Â  Â  Â  Â  Â   repository.refreshData() <span class="hljs-comment">// æˆ–è€… emit(Loading)</span>
 Â  Â  Â   }
 Â  Â  Â   <span class="hljs-comment">// 3. è½¬æ¢ä¸º StateFlow</span>
 Â  Â  Â   .stateIn(
 Â  Â  Â  Â  Â   scope = viewModelScope,
 Â  Â  Â  Â  Â   <span class="hljs-comment">// 4. æ ¸å¿ƒï¼šè®¾ç½® 5 ç§’çš„è¶…æ—¶ç¼“å­˜</span>
 Â  Â  Â  Â  Â   started = SharingStarted.WhileSubscribed(<span class="hljs-number">5000</span>),
 Â  Â  Â  Â  Â   initialValue = UiState.Loading
 Â  Â  Â   )
}
</code></pre>
<h3 data-id="heading-5">ä¸ºä»€ä¹ˆè¿™æ ·åšæ˜¯å®Œç¾çš„ï¼Ÿ</h3>
<p>è®©æˆ‘ä»¬æ·±å…¥åˆ†æè¿™æ®µä»£ç èƒŒåçš„æœºåˆ¶ã€‚</p>
<h4 data-id="heading-6">1. è§£å†³æµ‹è¯•éš¾é¢˜ (<code>onStart</code>)</h4>
<p>onStart æ˜¯ä¸€ä¸ªä¸­é—´æ“ä½œç¬¦ï¼Œå®ƒåªæœ‰åœ¨ Flow è¢«æ”¶é›†ï¼ˆcollectedï¼‰ æ—¶æ‰ä¼šæ‰§è¡Œã€‚è¿™æ„å‘³ç€å½“ä½ å®ä¾‹åŒ– ViewModel æ—¶ï¼Œç½‘ç»œè¯·æ±‚ä¸ä¼šç«‹å³å‘ç”Ÿã€‚</p>
<p>åœ¨å•å…ƒæµ‹è¯•ä¸­ï¼Œä½ æœ‰å……è¶³çš„æ—¶é—´å» Mock ä½ çš„ Repositoryï¼Œç„¶åå†è°ƒç”¨ viewModel.uiState.test { ... } æ¥è§¦å‘åŠ è½½ã€‚</p>
<h4 data-id="heading-7">2. è§£å†³å±å¹•æ—‹è½¬é—®é¢˜ (<code>WhileSubscribed(5000)</code>)</h4>
<p>è¿™æ˜¯æ•´ä¸ªæ–¹æ¡ˆçš„çµé­‚æ‰€åœ¨ã€‚</p>
<ul>
<li><strong>åœºæ™¯</strong>ï¼šç”¨æˆ·æ—‹è½¬å±å¹•ã€‚</li>
<li><strong>å‘ç”Ÿçš„äº‹æƒ…</strong>ï¼šæ—§çš„ Activity é”€æ¯ï¼Œåœæ­¢æ”¶é›† Flowï¼›æ–°çš„ Activity åˆ›å»ºï¼Œé‡æ–°æ”¶é›† Flowã€‚</li>
<li><strong>WhileSubscribed(5000) çš„ä½œç”¨</strong>ï¼šå½“è®¢é˜…è€…æ•°é‡ä» 1 å˜ä¸º 0 æ—¶ï¼Œä¸Šæ¸¸çš„æ•°æ®æµ<strong>ä¸ä¼šç«‹å³åœæ­¢</strong>ï¼Œè€Œæ˜¯ä¼šä¿æŒæ´»è·ƒçŠ¶æ€ 5 ç§’é’Ÿï¼ˆstopTimeoutMillisï¼‰ã€‚</li>
</ul>

<ul>
<li><strong>ç»“æœ</strong>ï¼šå› ä¸ºå±å¹•æ—‹è½¬é€šå¸¸åœ¨å‡ ç™¾æ¯«ç§’å†…å®Œæˆï¼Œæ–°çš„è®¢é˜…è€…ä¼šåœ¨ 5 ç§’å†…å‡ºç°ã€‚æ­¤æ—¶ï¼ŒFlow è®¤ä¸ºâ€œä¸€ç›´æœ‰è®¢é˜…è€…â€ï¼Œå› æ­¤<strong>ä¸ä¼š</strong>é‡æ–°è§¦å‘ <code>onStart</code>ï¼Œä¹Ÿå°±é¿å…äº†é‡å¤è¯·æ±‚ã€‚</li>
</ul>
<h4 data-id="heading-8">3. æ™ºèƒ½çš„åå°è¡Œä¸º</h4>
<p>å¦‚æœç”¨æˆ·æŒ‰ Home é”®å°†åº”ç”¨é€€åˆ°åå°ï¼Œç”±äº <code>WhileSubscribed</code> çš„è¶…æ—¶æœºåˆ¶ï¼š</p>
<ul>
<li><strong>5ç§’å†…è¿”å›</strong>ï¼šæ•°æ®æ— éœ€é‡è½½ï¼Œæ— ç¼è¡”æ¥ã€‚</li>
<li><strong>è¶…è¿‡5ç§’è¿”å›</strong>ï¼šFlow åœæ­¢ã€‚å½“ç”¨æˆ·å†æ¬¡æ‰“å¼€åº”ç”¨ï¼Œ<code>onStart</code> é‡æ–°æ‰§è¡Œã€‚è¿™å…¶å®æ˜¯ä¸€ä¸ª<strong>ç‰¹æ€§</strong>è€Œé Bugâ€”â€”å¦‚æœç”¨æˆ·ç¦»å¼€å¾ˆä¹…ï¼Œä»–ä»¬é€šå¸¸å¸Œæœ›çœ‹åˆ°æœ€æ–°çš„æ•°æ®ï¼Œè€Œä¸æ˜¯é™ˆæ—§çš„ç¼“å­˜ã€‚</li>
</ul>
<hr/>
<h2 data-id="heading-9">æ€»ç»“</h2>
<p>é€šè¿‡å°†æ•°æ®åŠ è½½é€»è¾‘ä» <code>init</code> å—ç§»åŠ¨åˆ° Flow çš„ <code>onStart</code> æ“ä½œç¬¦ï¼Œå¹¶ç»“åˆ <code>SharingStarted.WhileSubscribed(5000)</code>ï¼Œæˆ‘ä»¬è¾¾æˆäº†ä¸€ä¸ªå®Œç¾çš„å¹³è¡¡ï¼š</p>





























<table><thead><tr><th><strong>ç‰¹æ€§</strong></th><th><strong>LaunchedEffect</strong></th><th><strong>ViewModel init</strong></th><th><strong>Flow (onStart + stateIn)</strong></th></tr></thead><tbody><tr><td><strong>æŠ—å±å¹•æ—‹è½¬</strong></td><td>âŒ</td><td>âœ…</td><td>âœ…</td></tr><tr><td><strong>æ˜“äºå•å…ƒæµ‹è¯•</strong></td><td>âœ…</td><td>âŒ</td><td>âœ…</td></tr><tr><td><strong>è‡ªåŠ¨åˆ·æ–°è¿‡æœŸæ•°æ®</strong></td><td>âŒ</td><td>âŒ</td><td>âœ…</td></tr></tbody></table></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[C++å¯¹è±¡ç”Ÿå‘½å‘¨æœŸä¸ææ„é¡ºåºæ·±åº¦è§£æ]]></title>    <link>https://juejin.cn/post/7580606750291181619</link>    <guid>https://juejin.cn/post/7580606750291181619</guid>    <pubDate>2025-12-07T14:35:44.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7580606750291181619" data-draft-id="7580621397971009545" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="C++å¯¹è±¡ç”Ÿå‘½å‘¨æœŸä¸ææ„é¡ºåºæ·±åº¦è§£æ"/> <meta itemprop="keywords" content="åç«¯"/> <meta itemprop="datePublished" content="2025-12-07T14:35:44.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ç äº‹æ¼«è°ˆ"/> <meta itemprop="url" content="https://juejin.cn/user/1972974802965230"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            C++å¯¹è±¡ç”Ÿå‘½å‘¨æœŸä¸ææ„é¡ºåºæ·±åº¦è§£æ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1972974802965230/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ç äº‹æ¼«è°ˆ
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-07T14:35:44.000Z" title="Sun Dec 07 2025 14:35:44 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-07
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    18
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»7åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">ä¸€ã€å…¨å±€/é™æ€å¯¹è±¡çš„æ„é€ ä¸ææ„æ—¶æœº</h2>
<h3 data-id="heading-1">æ„é€ é¡ºåºï¼šè·¨ç¼–è¯‘å•å…ƒçš„æŒ‘æˆ˜</h3>
<p>å…¨å±€å¯¹è±¡å’Œé™æ€å¯¹è±¡çš„æ„é€ é¡ºåºåœ¨C++æ ‡å‡†ä¸­<strong>æ²¡æœ‰æ˜ç¡®å®šä¹‰</strong>ï¼Œç‰¹åˆ«æ˜¯å¯¹äºä½äºä¸åŒç¼–è¯‘å•å…ƒä¸­çš„å¯¹è±¡ã€‚è¿™å¯èƒ½å¯¼è‡´å±é™©çš„åˆå§‹åŒ–ä¾èµ–é—®é¢˜ã€‚</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-comment">// file1.cpp</span>
<span class="hljs-keyword">extern</span> <span class="hljs-type">int</span> global_from_file2;
<span class="hljs-type">int</span> global1 = global_from_file2 + <span class="hljs-number">1</span>;  <span class="hljs-comment">// å±é™©ï¼å¯èƒ½ä½¿ç”¨æœªåˆå§‹åŒ–çš„å€¼</span>

<span class="hljs-comment">// file2.cpp</span>
<span class="hljs-type">int</span> global_from_file2 = <span class="hljs-number">42</span>;
</code></pre>
<p><strong>è§£å†³æ–¹æ¡ˆï¼š</strong> ä½¿ç”¨å‡½æ•°å±€éƒ¨é™æ€å˜é‡ï¼ˆMeyer's Singletonæ¨¡å¼ï¼‰</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-function"><span class="hljs-type">int</span>&amp; <span class="hljs-title">get_global</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-type">static</span> <span class="hljs-type">int</span> instance = <span class="hljs-number">42</span>;  <span class="hljs-comment">// çº¿ç¨‹å®‰å…¨ï¼ˆC++11èµ·ï¼‰</span>
    <span class="hljs-keyword">return</span> instance;
}
</code></pre>
<h3 data-id="heading-2">ææ„é¡ºåºï¼šåå‘ä¾èµ–é£é™©</h3>
<p>ææ„é¡ºåºå¤§è‡´æ˜¯æ„é€ é¡ºåºçš„é€†åºï¼Œä½†ç”±äºæ„é€ é¡ºåºä¸ç¡®å®šï¼Œææ„æ—¶å¯èƒ½å‡ºç°"å·²é”€æ¯å¯¹è±¡è¢«å¼•ç”¨"çš„é—®é¢˜ã€‚</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-keyword">struct</span> <span class="hljs-title class_">Logger</span> {
    ~<span class="hljs-built_in">Logger</span>() { std::cout &lt;&lt; <span class="hljs-string">"Logger destroyed\n"</span>; }
    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">log</span><span class="hljs-params">(<span class="hljs-type">const</span> std::string&amp; msg)</span> </span>{ <span class="hljs-comment">/* ... */</span> }
};

Logger logger;  <span class="hljs-comment">// å…¨å±€å¯¹è±¡</span>

<span class="hljs-keyword">struct</span> <span class="hljs-title class_">Database</span> {
    ~<span class="hljs-built_in">Database</span>() {
        logger.<span class="hljs-built_in">log</span>(<span class="hljs-string">"Database cleaning up"</span>);  <span class="hljs-comment">// å±é™©ï¼loggerå¯èƒ½å·²é”€æ¯</span>
    }
};

Database db;  <span class="hljs-comment">// å¦ä¸€ä¸ªå…¨å±€å¯¹è±¡</span>
</code></pre>
<p><strong>æœ€ä½³å®è·µï¼š</strong> åœ¨å•çº¿ç¨‹ç¯å¢ƒä¸­ï¼Œå¯ä»¥ç¡®ä¿ä¾èµ–å…³ç³»ï¼š</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-function">Logger&amp; <span class="hljs-title">get_logger</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-type">static</span> Logger instance;
    <span class="hljs-keyword">return</span> instance;
}

<span class="hljs-function">Database&amp; <span class="hljs-title">get_database</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-type">static</span> Database instance;
    <span class="hljs-keyword">return</span> instance;
}
</code></pre>
<h2 data-id="heading-3">äºŒã€æˆå‘˜å˜é‡åˆå§‹åŒ–é¡ºåº</h2>
<h3 data-id="heading-4">å£°æ˜é¡ºåºçš„ç»å¯¹ä¼˜å…ˆçº§</h3>
<p>æˆå‘˜å˜é‡çš„åˆå§‹åŒ–é¡ºåº<strong>åªå–å†³äºå®ƒä»¬åœ¨ç±»ä¸­å£°æ˜çš„é¡ºåº</strong>ï¼Œè€Œä¸æ˜¯åˆå§‹åŒ–åˆ—è¡¨ä¸­çš„é¡ºåºã€‚</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Example</span> {
    <span class="hljs-type">int</span> a;
    <span class="hljs-type">int</span> b;
    <span class="hljs-type">int</span> c;
    
<span class="hljs-keyword">public</span>:
    <span class="hljs-comment">// è­¦å‘Šï¼šåˆå§‹åŒ–åˆ—è¡¨é¡ºåºä¸å£°æ˜é¡ºåºä¸åŒï¼</span>
    <span class="hljs-built_in">Example</span>(<span class="hljs-type">int</span> val) : <span class="hljs-built_in">c</span>(val), <span class="hljs-built_in">b</span>(c + <span class="hljs-number">1</span>), <span class="hljs-built_in">a</span>(b + <span class="hljs-number">1</span>) {
        <span class="hljs-comment">// å®é™…åˆå§‹åŒ–é¡ºåºï¼ša â†’ b â†’ c</span>
        <span class="hljs-comment">// a = æœªå®šä¹‰ï¼ˆä½¿ç”¨æœªåˆå§‹åŒ–çš„bï¼‰</span>
        <span class="hljs-comment">// b = æœªå®šä¹‰ï¼ˆä½¿ç”¨æœªåˆå§‹åŒ–çš„cï¼‰</span>
        <span class="hljs-comment">// c = val</span>
    }
};
</code></pre>
<p><strong>ç¼–è¯‘å™¨è­¦å‘Šï¼š</strong> ç°ä»£ç¼–è¯‘å™¨é€šå¸¸ä¼šè­¦å‘Šè¿™ç§é¡ºåºä¸ä¸€è‡´ï¼š</p>
<pre><code class="hljs language-vbnet" lang="vbnet"><span class="hljs-symbol">warning:</span> field <span class="hljs-comment">'b' will be initialized after field 'a'</span>
<span class="hljs-symbol">warning:</span> field <span class="hljs-comment">'c' will be initialized after field 'b'</span>
</code></pre>
<h3 data-id="heading-5">æ­£ç¡®æ¨¡å¼ï¼šéµå¾ªå£°æ˜é¡ºåº</h3>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-keyword">class</span> <span class="hljs-title class_">ProperExample</span> {
    std::string name;
    <span class="hljs-type">int</span> id;
    std::vector&lt;<span class="hljs-type">double</span>&gt; data;
    
<span class="hljs-keyword">public</span>:
    <span class="hljs-built_in">ProperExample</span>(<span class="hljs-type">const</span> std::string&amp; n, <span class="hljs-type">int</span> i, std::initializer_list&lt;<span class="hljs-type">double</span>&gt; d)
        : <span class="hljs-built_in">name</span>(n)      <span class="hljs-comment">// 1. ç¬¬ä¸€ä¸ªå£°æ˜</span>
        , <span class="hljs-built_in">id</span>(i)        <span class="hljs-comment">// 2. ç¬¬äºŒä¸ªå£°æ˜  </span>
        , <span class="hljs-built_in">data</span>(d) {    <span class="hljs-comment">// 3. ç¬¬ä¸‰ä¸ªå£°æ˜</span>
        <span class="hljs-comment">// å®‰å…¨ï¼šåˆå§‹åŒ–é¡ºåºä¸å£°æ˜é¡ºåºä¸€è‡´</span>
    }
};
</code></pre>
<h3 data-id="heading-6">ä¾èµ–åˆå§‹åŒ–è§£å†³æ–¹æ¡ˆ</h3>
<p>å½“æˆå‘˜å˜é‡é—´å­˜åœ¨ä¾èµ–å…³ç³»æ—¶ï¼š</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-keyword">class</span> <span class="hljs-title class_">DatabaseConnection</span> {
    std::string connection_string;
    ConnectionHandle handle;
    
<span class="hljs-keyword">public</span>:
    <span class="hljs-built_in">DatabaseConnection</span>(<span class="hljs-type">const</span> std::string&amp; conn_str)
        : <span class="hljs-built_in">connection_string</span>(conn_str)
        , <span class="hljs-built_in">handle</span>(<span class="hljs-built_in">create_handle</span>(connection_string)) {  <span class="hljs-comment">// ä¾èµ–connection_string</span>
    }
    
<span class="hljs-keyword">private</span>:
    <span class="hljs-function"><span class="hljs-type">static</span> ConnectionHandle <span class="hljs-title">create_handle</span><span class="hljs-params">(<span class="hljs-type">const</span> std::string&amp; str)</span></span>;
};
</code></pre>
<h2 data-id="heading-7">ä¸‰ã€ä¸´æ—¶å¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸå»¶é•¿</h2>
<h3 data-id="heading-8">åŸºæœ¬è§„åˆ™ï¼šç»‘å®šåˆ°constå¼•ç”¨</h3>
<p>å½“ä¸´æ—¶å¯¹è±¡ç»‘å®šåˆ°constå¼•ç”¨æ—¶ï¼Œå…¶ç”Ÿå‘½å‘¨æœŸä¼šå»¶é•¿åˆ°è¯¥å¼•ç”¨çš„ç”Ÿå‘½å‘¨æœŸç»“æŸã€‚</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-function">std::string <span class="hljs-title">create_string</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-keyword">return</span> <span class="hljs-string">"Hello, World!"</span>;
}

<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">example</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-type">const</span> std::string&amp; str = <span class="hljs-built_in">create_string</span>();  <span class="hljs-comment">// ä¸´æ—¶å¯¹è±¡ç”Ÿå‘½å‘¨æœŸå»¶é•¿</span>
    std::cout &lt;&lt; str &lt;&lt; <span class="hljs-string">"\n"</span>;                  <span class="hljs-comment">// å®‰å…¨ä½¿ç”¨</span>
    
    <span class="hljs-comment">// å½“strç¦»å¼€ä½œç”¨åŸŸæ—¶ï¼Œä¸´æ—¶å¯¹è±¡æ‰ä¼šè¢«é”€æ¯</span>
}
</code></pre>
<h3 data-id="heading-9">é‡è¦é™åˆ¶å’Œç»†èŠ‚</h3>
<ol>
<li><strong>ä»…é€‚ç”¨äºconstå¼•ç”¨ï¼ˆC++98/03ï¼‰æˆ–å³å€¼å¼•ç”¨ï¼ˆC++11+ï¼‰</strong></li>
</ol>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-comment">// C++11èµ·ï¼Œä¹Ÿå¯ä»¥ç»‘å®šåˆ°å³å€¼å¼•ç”¨</span>
std::string&amp;&amp; rref = <span class="hljs-built_in">create_string</span>();  <span class="hljs-comment">// åŒæ ·å»¶é•¿ç”Ÿå‘½å‘¨æœŸ</span>

<span class="hljs-comment">// éconstå·¦å€¼å¼•ç”¨ä¸è¡Œ</span>
<span class="hljs-comment">// std::string&amp; ref = create_string();  // ç¼–è¯‘é”™è¯¯</span>
</code></pre>
<ol start="2">
<li><strong>ç”Ÿå‘½å‘¨æœŸé“¾å¼å»¶é•¿</strong></li>
</ol>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-function"><span class="hljs-type">const</span> std::string&amp; <span class="hljs-title">func</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-keyword">return</span> <span class="hljs-string">"Temporary"</span>;  <span class="hljs-comment">// ä¸´æ—¶å¯¹è±¡ç»‘å®šåˆ°è¿”å›çš„å¼•ç”¨</span>
}

<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">test</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-type">const</span> std::string&amp; ref = <span class="hljs-built_in">func</span>();  <span class="hljs-comment">// ç”Ÿå‘½å‘¨æœŸè¿›ä¸€æ­¥å»¶é•¿</span>
    <span class="hljs-comment">// refåœ¨test()ç»“æŸæ—¶é”€æ¯</span>
}
</code></pre>
<ol start="3">
<li><strong>ä¸é€‚ç”¨äºæˆå‘˜è®¿é—®</strong></li>
</ol>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-keyword">struct</span> <span class="hljs-title class_">Value</span> {
    <span class="hljs-type">int</span> data = <span class="hljs-number">42</span>;
};

<span class="hljs-function">Value <span class="hljs-title">get_value</span><span class="hljs-params">()</span> </span>{ <span class="hljs-keyword">return</span> {}; }

<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">example</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-type">const</span> Value&amp; val = <span class="hljs-built_in">get_value</span>();  <span class="hljs-comment">// Valueå¯¹è±¡ç”Ÿå‘½å‘¨æœŸå»¶é•¿</span>
    <span class="hljs-type">int</span> x = val.data;                <span class="hljs-comment">// å®‰å…¨</span>
    
    <span class="hljs-comment">// ä½†æˆå‘˜è®¿é—®äº§ç”Ÿçš„ä¸´æ—¶å¯¹è±¡ä¸å»¶é•¿</span>
    <span class="hljs-type">const</span> <span class="hljs-type">int</span>&amp; bad = <span class="hljs-built_in">get_value</span>().data;  <span class="hljs-comment">// å±é™©ï¼Valueä¸´æ—¶å¯¹è±¡ç«‹å³é”€æ¯</span>
}
</code></pre>
<h3 data-id="heading-10">å®é™…åº”ç”¨åœºæ™¯</h3>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-comment">// åœºæ™¯1ï¼šé¿å…æ‹·è´ï¼Œæé«˜æ€§èƒ½</span>
<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">process_string</span><span class="hljs-params">(<span class="hljs-type">const</span> std::string&amp; str)</span></span>;

<span class="hljs-built_in">process_string</span>(<span class="hljs-string">"Temporary string"</span>);  <span class="hljs-comment">// æ— éœ€åˆ›å»ºå‘½åå˜é‡</span>

<span class="hljs-comment">// åœºæ™¯2ï¼šrange-based forå¾ªç¯</span>
<span class="hljs-keyword">for</span> (<span class="hljs-type">const</span> <span class="hljs-keyword">auto</span>&amp; item : <span class="hljs-built_in">get_temporary_vector</span>()) {
    <span class="hljs-comment">// ä¸´æ—¶vectorçš„ç”Ÿå‘½å‘¨æœŸå»¶é•¿åˆ°æ•´ä¸ªå¾ªç¯</span>
}

<span class="hljs-comment">// åœºæ™¯3ï¼šå‡½æ•°å¼ç¼–ç¨‹</span>
<span class="hljs-type">const</span> <span class="hljs-keyword">auto</span>&amp; result = std::<span class="hljs-built_in">accumulate</span>(
    data.<span class="hljs-built_in">begin</span>(), 
    data.<span class="hljs-built_in">end</span>(), 
    <span class="hljs-number">0</span>,  <span class="hljs-comment">// ä¸´æ—¶intå»¶é•¿ç”Ÿå‘½å‘¨æœŸ</span>
    [](<span class="hljs-type">int</span> acc, <span class="hljs-type">int</span> val) { <span class="hljs-keyword">return</span> acc + val; }
);
</code></pre>
<h2 data-id="heading-11">å››ã€std::launderåœ¨å¯¹è±¡é‡ç”¨ä¸­çš„å®é™…åº”ç”¨</h2>
<h3 data-id="heading-12">é—®é¢˜èƒŒæ™¯ï¼šæŒ‡é’ˆä¼˜åŒ–ä¸åˆ«åé—®é¢˜</h3>
<p>ç¼–è¯‘å™¨å¯èƒ½åŸºäº"å¯¹è±¡ç”Ÿå‘½å‘¨æœŸ"å‡è®¾è¿›è¡Œä¼˜åŒ–ï¼Œå½“æˆ‘ä»¬åœ¨ç›¸åŒå†…å­˜ä½ç½®æ„é€ æ–°å¯¹è±¡æ—¶ï¼Œå¯èƒ½å¯¼è‡´æœªå®šä¹‰è¡Œä¸ºã€‚</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-keyword">struct</span> <span class="hljs-title class_">X</span> { <span class="hljs-type">int</span> x; };
<span class="hljs-keyword">struct</span> <span class="hljs-title class_">Y</span> { <span class="hljs-type">int</span> y; };

<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">problematic_example</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-built_in">alignas</span>(<span class="hljs-built_in">alignof</span>(Y)) <span class="hljs-type">char</span> buffer[<span class="hljs-built_in">sizeof</span>(Y)];
    
    X* x = <span class="hljs-built_in">new</span> (buffer) X{<span class="hljs-number">10</span>};
    x-&gt;~<span class="hljs-built_in">X</span>();
    
    Y* y = <span class="hljs-built_in">new</span> (buffer) Y{<span class="hljs-number">20</span>};
    
    <span class="hljs-comment">// ç¼–è¯‘å™¨å¯èƒ½è®¤ä¸ºxæŒ‡å‘å·²é”€æ¯çš„å¯¹è±¡</span>
    <span class="hljs-comment">// å®é™…ä¸Šxå’ŒyæŒ‡å‘ç›¸åŒå†…å­˜ï¼Œä½†ç±»å‹ä¸åŒ</span>
}
</code></pre>
<h3 data-id="heading-13">std::launderçš„ä½œç”¨</h3>
<p><code>std::launder</code>é€šçŸ¥ç¼–è¯‘å™¨ï¼šé€šè¿‡è¿”å›çš„æŒ‡é’ˆè®¿é—®å†…å­˜æ—¶ï¼Œåº”è¯¥å¿½ç•¥ä¹‹å‰çš„ç±»å‹ä¿¡æ¯ã€‚</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;new&gt;</span>  <span class="hljs-comment">// std::launder</span></span>

<span class="hljs-keyword">struct</span> <span class="hljs-title class_">X</span> { 
    <span class="hljs-type">const</span> <span class="hljs-type">int</span> x;  <span class="hljs-comment">// constæˆå‘˜ï¼éå¸¸é‡è¦</span>
    <span class="hljs-built_in">X</span>(<span class="hljs-type">int</span> val) : <span class="hljs-built_in">x</span>(val) {}
};

<span class="hljs-keyword">struct</span> <span class="hljs-title class_">Y</span> {
    <span class="hljs-type">int</span> y;
    <span class="hljs-built_in">Y</span>(<span class="hljs-type">int</span> val) : <span class="hljs-built_in">y</span>(val) {}
};

<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">correct_example</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-built_in">alignas</span>(<span class="hljs-built_in">alignof</span>(Y)) <span class="hljs-type">char</span> buffer[<span class="hljs-built_in">sizeof</span>(Y)];
    
    X* x = <span class="hljs-built_in">new</span> (buffer) X{<span class="hljs-number">10</span>};
    
    <span class="hljs-comment">// é‡ç”¨å†…å­˜ï¼šå…ˆé”€æ¯æ—§å¯¹è±¡</span>
    x-&gt;~<span class="hljs-built_in">X</span>();
    
    <span class="hljs-comment">// æ„é€ æ–°å¯¹è±¡</span>
    Y* y = <span class="hljs-built_in">new</span> (buffer) Y{<span class="hljs-number">20</span>};
    
    <span class="hljs-comment">// ä½¿ç”¨std::launderè·å–æ­£ç¡®æŒ‡é’ˆ</span>
    X* laundered_x = std::<span class="hljs-built_in">launder</span>(<span class="hljs-built_in">reinterpret_cast</span>&lt;X*&gt;(buffer));
    <span class="hljs-comment">// æ³¨æ„ï¼šä¸èƒ½é€šè¿‡laundered_xè®¿é—®ï¼Œå› ä¸ºXå¯¹è±¡å·²é”€æ¯</span>
    
    <span class="hljs-comment">// æ­£ç¡®ï¼šé€šè¿‡yè®¿é—®</span>
    std::cout &lt;&lt; y-&gt;y &lt;&lt; <span class="hljs-string">"\n"</span>;
}
</code></pre>
<h3 data-id="heading-14">å¿…é¡»ä½¿ç”¨std::launderçš„åœºæ™¯</h3>
<ol>
<li><strong>å¯¹è±¡æœ‰constæˆ–å¼•ç”¨æˆå‘˜</strong></li>
</ol>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-keyword">struct</span> <span class="hljs-title class_">ConstObject</span> {
    <span class="hljs-type">const</span> <span class="hljs-type">int</span> id;
    <span class="hljs-built_in">ConstObject</span>(<span class="hljs-type">int</span> i) : <span class="hljs-built_in">id</span>(i) {}
};

<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">reuse_const_memory</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-built_in">alignas</span>(ConstObject) <span class="hljs-type">char</span> buf[<span class="hljs-built_in">sizeof</span>(ConstObject)];
    
    <span class="hljs-keyword">auto</span>* obj1 = <span class="hljs-built_in">new</span> (buf) ConstObject{<span class="hljs-number">1</span>};
    obj1-&gt;~<span class="hljs-built_in">ConstObject</span>();
    
    <span class="hljs-keyword">auto</span>* obj2 = <span class="hljs-built_in">new</span> (buf) ConstObject{<span class="hljs-number">2</span>};
    
    <span class="hljs-comment">// å¿…é¡»ä½¿ç”¨launderï¼Œå› ä¸ºconstæˆå‘˜å¯èƒ½è¢«ç¼“å­˜</span>
    <span class="hljs-keyword">auto</span>* ptr = std::<span class="hljs-built_in">launder</span>(<span class="hljs-built_in">reinterpret_cast</span>&lt;ConstObject*&gt;(buf));
    std::cout &lt;&lt; ptr-&gt;id &lt;&lt; <span class="hljs-string">"\n"</span>;  <span class="hljs-comment">// æ­£ç¡®ï¼šè¾“å‡º2</span>
}
</code></pre>
<ol start="2">
<li><strong>å¯¹è±¡æœ‰è™šå‡½æ•°</strong></li>
</ol>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-keyword">struct</span> <span class="hljs-title class_">Base</span> {
    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">void</span> <span class="hljs-title">foo</span><span class="hljs-params">()</span> </span>{ std::cout &lt;&lt; <span class="hljs-string">"Base\n"</span>; }
    <span class="hljs-keyword">virtual</span> ~<span class="hljs-built_in">Base</span>() = <span class="hljs-keyword">default</span>;
};

<span class="hljs-keyword">struct</span> <span class="hljs-title class_">Derived</span> : Base {
    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">foo</span><span class="hljs-params">()</span> <span class="hljs-keyword">override</span> </span>{ std::cout &lt;&lt; <span class="hljs-string">"Derived\n"</span>; }
};

<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">reuse_virtual_memory</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-built_in">alignas</span>(Base) <span class="hljs-type">char</span> buffer[<span class="hljs-built_in">sizeof</span>(Derived)];
    
    Base* b = <span class="hljs-built_in">new</span> (buffer) Derived;
    b-&gt;<span class="hljs-built_in">foo</span>();  <span class="hljs-comment">// è¾“å‡º"Derived"</span>
    
    b-&gt;~<span class="hljs-built_in">Base</span>();
    
    <span class="hljs-keyword">new</span> (buffer) Base;
    
    <span class="hljs-comment">// éœ€è¦launderæ¥æ­£ç¡®è®¿é—®è™šè¡¨</span>
    Base* laundered = std::<span class="hljs-built_in">launder</span>(<span class="hljs-built_in">reinterpret_cast</span>&lt;Base*&gt;(buffer));
    laundered-&gt;<span class="hljs-built_in">foo</span>();  <span class="hljs-comment">// è¾“å‡º"Base"</span>
}
</code></pre>
<ol start="3">
<li><strong>æŒ‡å‘å·²é”€æ¯å¯¹è±¡çš„æŒ‡é’ˆ</strong></li>
</ol>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-function"><span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> T, <span class="hljs-keyword">typename</span>... Args&gt;
T* <span class="hljs-title">reconstruct</span><span class="hljs-params">(<span class="hljs-type">void</span>* memory, Args&amp;&amp;... args)</span> </span>{
    T* old = <span class="hljs-built_in">static_cast</span>&lt;T*&gt;(memory);
    old-&gt;~<span class="hljs-built_in">T</span>();  <span class="hljs-comment">// æ˜¾å¼ææ„</span>
    <span class="hljs-keyword">return</span> <span class="hljs-built_in">new</span> (memory) <span class="hljs-built_in">T</span>(std::forward&lt;Args&gt;(args)...);
}

<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">example</span><span class="hljs-params">()</span> </span>{
    std::string* str = <span class="hljs-keyword">new</span> std::<span class="hljs-built_in">string</span>(<span class="hljs-string">"Hello"</span>);
    
    <span class="hljs-comment">// é‡ç”¨å†…å­˜</span>
    std::string* new_str = <span class="hljs-built_in">reconstruct</span>&lt;std::string&gt;(str, <span class="hljs-string">"World"</span>);
    
    <span class="hljs-comment">// æ—§æŒ‡é’ˆsträ¸èƒ½ç›´æ¥ä½¿ç”¨</span>
    <span class="hljs-comment">// std::cout &lt;&lt; *str;  // æœªå®šä¹‰è¡Œä¸ºï¼</span>
    
    <span class="hljs-comment">// éœ€è¦launder</span>
    std::string* laundered = std::<span class="hljs-built_in">launder</span>(str);
    std::cout &lt;&lt; *laundered &lt;&lt; <span class="hljs-string">"\n"</span>;  <span class="hljs-comment">// æ­£ç¡®ï¼š"World"</span>
    
    <span class="hljs-keyword">delete</span> new_str;  <span class="hljs-comment">// æˆ– laundered</span>
}
</code></pre>
<h3 data-id="heading-15">ä¸éœ€è¦std::launderçš„æƒ…å†µ</h3>
<ol>
<li><strong>trivially destructibleç±»å‹</strong></li>
<li><strong>ç›¸åŒç±»å‹å¯¹è±¡çš„replacement new</strong></li>
<li><strong>å†…å­˜ä»æœªåŒ…å«è¿‡å¯¹è±¡</strong></li>
</ol>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-keyword">struct</span> <span class="hljs-title class_">Trivial</span> {
    <span class="hljs-type">int</span> x;
};

<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">trivial_example</span><span class="hljs-params">()</span> </span>{
    Trivial t{<span class="hljs-number">1</span>};
    t.~<span class="hljs-built_in">Trivial</span>();  <span class="hljs-comment">// æ˜¾å¼ææ„ï¼ˆå…è®¸ä½†é€šå¸¸ä¸å¿…è¦ï¼‰</span>
    
    <span class="hljs-keyword">new</span> (&amp;t) Trivial{<span class="hljs-number">2</span>};
    
    <span class="hljs-comment">// å¯ä»¥ç›´æ¥è®¿é—®ï¼Œå› ä¸ºTrivialæ˜¯trivially destructible</span>
    std::cout &lt;&lt; t.x &lt;&lt; <span class="hljs-string">"\n"</span>;  <span class="hljs-comment">// æ­£ç¡®ï¼šè¾“å‡º2</span>
}
</code></pre>
<h3 data-id="heading-16">å®é™…å·¥ç¨‹åº”ç”¨</h3>
<p><strong>å†…å­˜æ± å®ç°ç¤ºä¾‹ï¼š</strong></p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> T&gt;
<span class="hljs-keyword">class</span> <span class="hljs-title class_">MemoryPool</span> {
    <span class="hljs-keyword">union</span> <span class="hljs-title class_">Node</span> {
        T object;
        Node* next;
        <span class="hljs-built_in">Node</span>() : <span class="hljs-built_in">next</span>(<span class="hljs-literal">nullptr</span>) {}
        ~<span class="hljs-built_in">Node</span>() {}
    };
    
    Node* free_list = <span class="hljs-literal">nullptr</span>;
    std::vector&lt;std::unique_ptr&lt;Node[]&gt;&gt; blocks;
    
<span class="hljs-keyword">public</span>:
    <span class="hljs-function"><span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span>... Args&gt;
    T* <span class="hljs-title">construct</span><span class="hljs-params">(Args&amp;&amp;... args)</span> </span>{
        <span class="hljs-keyword">if</span> (!free_list) {
            <span class="hljs-built_in">allocate_block</span>();
        }
        
        Node* node = free_list;
        free_list = free_list-&gt;next;
        
        <span class="hljs-comment">// é‡ç”¨å†…å­˜ï¼šä½¿ç”¨launderç¡®ä¿æ­£ç¡®æ€§</span>
        T* obj = <span class="hljs-built_in">new</span> (&amp;node-&gt;object) <span class="hljs-built_in">T</span>(std::forward&lt;Args&gt;(args)...);
        <span class="hljs-keyword">return</span> std::<span class="hljs-built_in">launder</span>(obj);
    }
    
    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">destroy</span><span class="hljs-params">(T* ptr)</span> </span>{
        <span class="hljs-keyword">if</span> (!ptr) <span class="hljs-keyword">return</span>;
        
        ptr-&gt;~<span class="hljs-built_in">T</span>();
        
        Node* node = <span class="hljs-built_in">reinterpret_cast</span>&lt;Node*&gt;(
            <span class="hljs-built_in">reinterpret_cast</span>&lt;<span class="hljs-type">char</span>*&gt;(ptr) - <span class="hljs-built_in">offsetof</span>(Node, object)
        );
        
        node-&gt;next = free_list;
        free_list = node;
    }
    
<span class="hljs-keyword">private</span>:
    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">allocate_block</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">constexpr</span> <span class="hljs-type">size_t</span> BLOCK_SIZE = <span class="hljs-number">64</span>;
        <span class="hljs-keyword">auto</span> block = std::<span class="hljs-built_in">make_unique</span>&lt;Node[]&gt;(BLOCK_SIZE);
        
        <span class="hljs-keyword">for</span> (<span class="hljs-type">size_t</span> i = <span class="hljs-number">0</span>; i &lt; BLOCK_SIZE; ++i) {
            block[i].next = free_list;
            free_list = &amp;block[i];
        }
        
        blocks.<span class="hljs-built_in">push_back</span>(std::<span class="hljs-built_in">move</span>(block));
    }
};
</code></pre>
<h2 data-id="heading-17">äº”ã€æœ€ä½³å®è·µæ€»ç»“</h2>
<ol>
<li>
<p><strong>å…¨å±€/é™æ€å¯¹è±¡</strong></p>
<ul>
<li>é¿å…è·¨ç¼–è¯‘å•å…ƒä¾èµ–</li>
<li>ä½¿ç”¨å±€éƒ¨é™æ€å˜é‡ä¿è¯åˆå§‹åŒ–é¡ºåº</li>
<li>æ³¨æ„ææ„é¡ºåºåå‘ä¾èµ–</li>
</ul>
</li>
<li>
<p><strong>æˆå‘˜åˆå§‹åŒ–</strong></p>
<ul>
<li>ä¸¥æ ¼æŒ‰ç…§å£°æ˜é¡ºåºç¼–å†™åˆå§‹åŒ–åˆ—è¡¨</li>
<li>å¯¹æœ‰ä¾èµ–å…³ç³»çš„æˆå‘˜ç‰¹åˆ«å°å¿ƒ</li>
<li>ä½¿ç”¨å‡½æ•°å¤„ç†å¤æ‚åˆå§‹åŒ–é€»è¾‘</li>
</ul>
</li>
<li>
<p><strong>ä¸´æ—¶å¯¹è±¡ç”Ÿå‘½å‘¨æœŸ</strong></p>
<ul>
<li>åˆ©ç”¨constå¼•ç”¨å»¶é•¿ä¸´æ—¶å¯¹è±¡ç”Ÿå‘½å‘¨æœŸ</li>
<li>æ³¨æ„ä¸é€‚ç”¨äºæˆå‘˜è®¿é—®äº§ç”Ÿçš„ä¸´æ—¶å¯¹è±¡</li>
<li>å³å€¼å¼•ç”¨åŒæ ·æœ‰ç”Ÿå‘½å‘¨æœŸå»¶é•¿æ•ˆæœ</li>
</ul>
</li>
<li>
<p><strong>å¯¹è±¡é‡ç”¨ä¸std::launder</strong></p>
<ul>
<li>æœ‰const/å¼•ç”¨æˆå‘˜æˆ–è™šå‡½æ•°æ—¶å¿…é¡»ä½¿ç”¨</li>
<li>trivialç±»å‹é€šå¸¸ä¸éœ€è¦</li>
<li>åœ¨å†…å­˜æ± ã€è‡ªå®šä¹‰åˆ†é…å™¨ç­‰åœºæ™¯ç‰¹åˆ«é‡è¦</li>
<li>å§‹ç»ˆä¼˜å…ˆè€ƒè™‘æ›´å®‰å…¨çš„æ›¿ä»£æ–¹æ¡ˆ</li>
</ul>
</li>
</ol>
<p>é€šè¿‡æ·±å…¥ç†è§£è¿™äº›C++å¯¹è±¡ç”Ÿå‘½å‘¨æœŸå’Œææ„é¡ºåºçš„ç»†èŠ‚ï¼Œå¯ä»¥ç¼–å†™å‡ºæ›´å®‰å…¨ã€æ›´é«˜æ•ˆçš„ä»£ç ï¼Œé¿å…æ½œåœ¨çš„å†…å­˜ç®¡ç†å’Œå¯¹è±¡ç”Ÿå‘½å‘¨æœŸé—®é¢˜ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[æ‰‹å†™ EventEmitterï¼šæ·±å…¥ç†è§£å‘å¸ƒè®¢é˜…æ¨¡å¼]]></title>    <link>https://juejin.cn/post/7580389111921508415</link>    <guid>https://juejin.cn/post/7580389111921508415</guid>    <pubDate>2025-12-07T15:31:40.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7580389111921508415" data-draft-id="7580389111921492031" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="æ‰‹å†™ EventEmitterï¼šæ·±å…¥ç†è§£å‘å¸ƒè®¢é˜…æ¨¡å¼"/> <meta itemprop="keywords" content="å‰ç«¯,JavaScript,EventBus"/> <meta itemprop="datePublished" content="2025-12-07T15:31:40.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="1024è‚¥å®…"/> <meta itemprop="url" content="https://juejin.cn/user/588993964030574"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            æ‰‹å†™ EventEmitterï¼šæ·±å…¥ç†è§£å‘å¸ƒè®¢é˜…æ¨¡å¼
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/588993964030574/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    1024è‚¥å®…
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-07T15:31:40.000Z" title="Sun Dec 07 2025 15:31:40 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-07
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»9åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h4 data-id="heading-0">å¼•è¨€</h4>
<p>åœ¨ JavaScript å¼€å‘ä¸­ï¼Œäº‹ä»¶é©±åŠ¨ç¼–ç¨‹æ˜¯æ„å»ºå¯ç»´æŠ¤ã€å¯æ‰©å±•åº”ç”¨çš„æ ¸å¿ƒèŒƒå¼ä¹‹ä¸€ã€‚ä»æµè§ˆå™¨ <code>DOM</code> äº‹ä»¶åˆ° Node.js çš„å¼‚æ­¥ <code>I/O</code>ï¼Œä» <code>Vue</code> çš„ç»„ä»¶é€šä¿¡åˆ° <code>React</code> çš„çŠ¶æ€ç®¡ç†ï¼Œå‘å¸ƒè®¢é˜…æ¨¡å¼æ— å¤„ä¸åœ¨ã€‚</p>
<p>é€šè¿‡æ‰‹å†™ä¸€ä¸ªç¬¦åˆ Node.js EventEmitter æ ‡å‡†çš„å®ç°ï¼Œæˆ‘ä»¬ä¸ä»…èƒ½æ·±å…¥ç†è§£äº‹ä»¶é©±åŠ¨æ¶æ„çš„è®¾è®¡åŸç†ï¼Œè¿˜èƒ½æŒæ¡ JavaScript ä¸­é—­åŒ…ã€å†…å­˜ç®¡ç†ã€è®¾è®¡æ¨¡å¼ç­‰æ ¸å¿ƒæ¦‚å¿µã€‚æ›´é‡è¦çš„æ˜¯ï¼Œè¿™æ˜¯é¢è¯•ä¸­å¸¸è§çš„é«˜çº§é¢˜ç›®ï¼Œèƒ½ä½“ç°ä½ å¯¹JavaScriptè®¾è®¡æ¨¡å¼çš„ç†è§£æ·±åº¦ã€‚</p>
<p>æœ¬æ–‡å°†å¸¦ä½ ä»é›¶å®ç°ä¸€ä¸ªåŠŸèƒ½å®Œæ•´çš„<code>EventEmitter</code>ï¼Œå¹¶æ¢è®¨å…¶åœ¨å®é™…é¡¹ç›®ä¸­çš„åº”ç”¨å’Œä¼˜åŒ–ç­–ç•¥ã€‚</p>
<h4 data-id="heading-1">ä¸€ã€å‘å¸ƒè®¢é˜…æ¨¡å¼çš„æ ¸å¿ƒæ¦‚å¿µ</h4>
<h5 data-id="heading-2">1.1 ä»€ä¹ˆæ˜¯å‘å¸ƒè®¢é˜…æ¨¡å¼</h5>
<p>å‘å¸ƒè®¢é˜…æ¨¡å¼ï¼ˆPub/Subï¼‰æ˜¯ä¸€ç§æ¶ˆæ¯ä¼ é€’èŒƒå¼ï¼Œæ¶ˆæ¯çš„å‘é€è€…ï¼ˆå‘å¸ƒè€…ï¼‰ä¸ä¼šå°†æ¶ˆæ¯ç›´æ¥å‘é€ç»™ç‰¹å®šçš„æ¥æ”¶è€…ï¼ˆè®¢é˜…è€…ï¼‰ï¼Œè€Œæ˜¯é€šè¿‡ä¸€ä¸ªä¸­é—´ä»¶ï¼ˆäº‹ä»¶ä¸­å¿ƒï¼‰è¿›è¡Œé€šä¿¡ã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// ç±»æ¯”ï¼šæŠ¥çº¸è®¢é˜…ç³»ç»Ÿ</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">NewspaperSystem</span> {
    <span class="hljs-title function_">constructor</span>(<span class="hljs-params"/>) {
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">subscribers</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Map</span>(); <span class="hljs-comment">// äº‹ä»¶ä¸­å¿ƒ</span>
    }
    
    <span class="hljs-comment">// è®¢é˜…ï¼ˆè¯»è€…è®¢é˜…æŠ¥çº¸ï¼‰</span>
    <span class="hljs-title function_">subscribe</span>(<span class="hljs-params">topic, reader</span>) {
        <span class="hljs-keyword">if</span> (!<span class="hljs-variable language_">this</span>.<span class="hljs-property">subscribers</span>.<span class="hljs-title function_">has</span>(topic)) {
            <span class="hljs-variable language_">this</span>.<span class="hljs-property">subscribers</span>.<span class="hljs-title function_">set</span>(topic, []);
        }
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">subscribers</span>.<span class="hljs-title function_">get</span>(topic).<span class="hljs-title function_">push</span>(reader);
    }
    
    <span class="hljs-comment">// å‘å¸ƒï¼ˆæŠ¥ç¤¾å‘å¸ƒæ–°é—»ï¼‰</span>
    <span class="hljs-title function_">publish</span>(<span class="hljs-params">topic, news</span>) {
        <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">subscribers</span>.<span class="hljs-title function_">has</span>(topic)) {
            <span class="hljs-variable language_">this</span>.<span class="hljs-property">subscribers</span>.<span class="hljs-title function_">get</span>(topic).<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">reader</span> =&gt;</span> <span class="hljs-title function_">reader</span>(news));
        }
    }
    
    <span class="hljs-comment">// å–æ¶ˆè®¢é˜…ï¼ˆè¯»è€…é€€è®¢ï¼‰</span>
    <span class="hljs-title function_">unsubscribe</span>(<span class="hljs-params">topic, reader</span>) {
        <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">subscribers</span>.<span class="hljs-title function_">has</span>(topic)) {
            <span class="hljs-keyword">const</span> readers = <span class="hljs-variable language_">this</span>.<span class="hljs-property">subscribers</span>.<span class="hljs-title function_">get</span>(topic);
            <span class="hljs-keyword">const</span> index = readers.<span class="hljs-title function_">indexOf</span>(reader);
            <span class="hljs-keyword">if</span> (index &gt; -<span class="hljs-number">1</span>) {
                readers.<span class="hljs-title function_">splice</span>(index, <span class="hljs-number">1</span>);
            }
        }
    }
}
</code></pre>
<h5 data-id="heading-3">1.2 æ ¸å¿ƒç»„ä»¶</h5>
<ol>
<li><strong>äº‹ä»¶ä¸­å¿ƒ(EventEmitter):</strong> å­˜å‚¨äº‹ä»¶å’Œå›è°ƒçš„å¯¹åº”å…³ç³»</li>
<li><strong>å‘å¸ƒè€…(Publisher):</strong> è§¦å‘äº‹ä»¶ï¼Œä¼ é€’æ•°æ®</li>
<li><strong>è®¢é˜…è€…(Subscriber):</strong> ç›‘å¬äº‹ä»¶ï¼Œå¤„ç†æ•°æ®</li>
</ol>
<h5 data-id="heading-4">1.3 ä¸è§‚å¯Ÿè€…æ¨¡å¼çš„å¯¹æ¯”</h5>






























<table><thead><tr><th align="left">ç‰¹æ€§</th><th align="left">è§‚å¯Ÿè€…æ¨¡å¼</th><th align="left">å‘å¸ƒè®¢é˜…æ¨¡å¼</th></tr></thead><tbody><tr><td align="left">è€¦åˆåº¦</td><td align="left">ç›´æ¥è€¦åˆ</td><td align="left">é€šè¿‡äº‹ä»¶ä¸­å¿ƒè§£è€¦</td></tr><tr><td align="left">é€šä¿¡æ–¹å¼</td><td align="left">ç›´æ¥è°ƒç”¨</td><td align="left">é—´æ¥é€šä¿¡</td></tr><tr><td align="left">çµæ´»æ€§</td><td align="left">è¾ƒä½</td><td align="left">æ›´é«˜</td></tr><tr><td align="left">å…¸å‹å®ç°</td><td align="left">Vueå“åº”å¼</td><td align="left">NodeJS EventEmitter</td></tr></tbody></table>
<h4 data-id="heading-5">äºŒã€åŸºç¡€ EventEmitter å®ç°</h4>
<h5 data-id="heading-6">2.1 æœ€å°å¯è¡Œå®ç°</h5>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">EventEmitter</span> {
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params"/>) {
    <span class="hljs-comment">// å­˜å‚¨äº‹ä»¶å’Œå¯¹åº”çš„å›è°ƒå‡½æ•°</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">events</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Map</span>();
  }

  <span class="hljs-comment">/**
   * è®¢é˜…äº‹ä»¶
   * <span class="hljs-doctag">@param</span> {<span class="hljs-type">string</span>} eventName äº‹ä»¶åç§°
   * <span class="hljs-doctag">@param</span> {<span class="hljs-type">Function</span>} callback å›è°ƒå‡½æ•°
   * <span class="hljs-doctag">@returns</span> {<span class="hljs-type">Function</span>} å–æ¶ˆè®¢é˜…çš„å‡½æ•°
   */</span>
  <span class="hljs-title function_">on</span>(<span class="hljs-params">eventName, callback</span>) {
    <span class="hljs-keyword">if</span> (!<span class="hljs-variable language_">this</span>.<span class="hljs-property">events</span>.<span class="hljs-title function_">has</span>(eventName)) {
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">events</span>.<span class="hljs-title function_">set</span>(eventName, []);
    }
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">events</span>.<span class="hljs-title function_">get</span>(eventName).<span class="hljs-title function_">push</span>(callback);

    <span class="hljs-comment">// è¿”å›å–æ¶ˆè®¢é˜…çš„å‡½æ•°</span>
    <span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">off</span>(eventName, callback);
  }

  <span class="hljs-comment">/**
   * è§¦å‘äº‹ä»¶
   * <span class="hljs-doctag">@param</span> {<span class="hljs-type">string</span>} eventName äº‹ä»¶åç§°
   * <span class="hljs-doctag">@param</span> {<span class="hljs-type">...any</span>} args ä¼ é€’ç»™å›è°ƒå‡½æ•°çš„å‚æ•°
   */</span>
  <span class="hljs-title function_">emit</span>(<span class="hljs-params">eventName, ...args</span>) {
    <span class="hljs-keyword">if</span> (!<span class="hljs-variable language_">this</span>.<span class="hljs-property">events</span>.<span class="hljs-title function_">has</span>(eventName)) {
      <span class="hljs-keyword">return</span>;
    }

    <span class="hljs-keyword">const</span> callbacks = <span class="hljs-variable language_">this</span>.<span class="hljs-property">events</span>.<span class="hljs-title function_">get</span>(eventName);
    callbacks.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">callback</span>) =&gt;</span> {
      <span class="hljs-keyword">try</span> {
        callback.<span class="hljs-title function_">apply</span>(<span class="hljs-literal">null</span>, args);
      } <span class="hljs-keyword">catch</span> (error) {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`Error in event listener for <span class="hljs-subst">${eventName}</span>:`</span>, error);
      }
    });
  }

  <span class="hljs-comment">/**
   * å–æ¶ˆè®¢é˜…
   * <span class="hljs-doctag">@param</span> {<span class="hljs-type">string</span>} eventName äº‹ä»¶åç§°
   * <span class="hljs-doctag">@param</span> {<span class="hljs-type">Function</span>} callback è¦ç§»é™¤çš„å›è°ƒå‡½æ•°
   */</span>
  <span class="hljs-title function_">off</span>(<span class="hljs-params">eventName, callback</span>) {
    <span class="hljs-keyword">if</span> (!<span class="hljs-variable language_">this</span>.<span class="hljs-property">events</span>.<span class="hljs-title function_">has</span>(eventName)) {
      <span class="hljs-keyword">return</span>;
    }

    <span class="hljs-keyword">const</span> callbacks = <span class="hljs-variable language_">this</span>.<span class="hljs-property">events</span>.<span class="hljs-title function_">get</span>(eventName);
    <span class="hljs-keyword">const</span> index = callbacks.<span class="hljs-title function_">indexOf</span>(callback);

    <span class="hljs-keyword">if</span> (index &gt; -<span class="hljs-number">1</span>) {
      callbacks.<span class="hljs-title function_">splice</span>(index, <span class="hljs-number">1</span>);

      <span class="hljs-comment">// å¦‚æœæ²¡æœ‰å›è°ƒå‡½æ•°äº†, åˆ é™¤è¿™ä¸ªäº‹ä»¶</span>
      <span class="hljs-keyword">if</span> (callbacks.<span class="hljs-property">length</span> === <span class="hljs-number">0</span>) {
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">events</span>.<span class="hljs-title function_">delete</span>(eventName);
      }
    }
  }

  <span class="hljs-comment">/**
   * ä¸€æ¬¡æ€§è®¢é˜…
   * <span class="hljs-doctag">@param</span> {<span class="hljs-type">string</span>} eventName äº‹ä»¶åç§°
   * <span class="hljs-doctag">@param</span> {<span class="hljs-type">Function</span>} callback å›è°ƒå‡½æ•°
   */</span>
  <span class="hljs-title function_">once</span>(<span class="hljs-params">eventName, callback</span>) {
    <span class="hljs-keyword">const</span> <span class="hljs-title function_">onceCallback</span> = (<span class="hljs-params">...args</span>) =&gt; {
      callback.<span class="hljs-title function_">apply</span>(<span class="hljs-literal">null</span>, args);
      <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">off</span>(eventName, callback);
    };

    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">on</span>(eventName, onceCallback);
    <span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">off</span>(eventName, onceCallback);
  }

  <span class="hljs-comment">/**
   * ç§»é™¤æ‰€æœ‰äº‹ä»¶ç›‘å¬å™¨, æˆ–æŒ‡å®šäº‹ä»¶çš„æ‰€æœ‰ç›‘å¬å™¨
   * <span class="hljs-doctag">@param</span> {<span class="hljs-type">string</span>} eventName å¯é€‰, äº‹ä»¶åç§°
   */</span>
  <span class="hljs-title function_">removeAllListeners</span>(<span class="hljs-params">eventName</span>) {
    <span class="hljs-keyword">if</span> (eventName) {
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">events</span>.<span class="hljs-title function_">delete</span>(eventName);
    } <span class="hljs-keyword">else</span> {
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">events</span>.<span class="hljs-title function_">clear</span>();
    }
  }
}

<span class="hljs-comment">// åŸºç¡€ä½¿ç”¨ç¤ºä¾‹</span>
<span class="hljs-keyword">const</span> emitter = <span class="hljs-keyword">new</span> <span class="hljs-title class_">EventEmitter</span>();

<span class="hljs-comment">// è®¢é˜…äº‹ä»¶</span>
<span class="hljs-keyword">const</span> unsubscribe = emitter.<span class="hljs-title function_">on</span>(<span class="hljs-string">"message"</span>, <span class="hljs-function">(<span class="hljs-params">data</span>) =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"æ”¶åˆ°æ¶ˆæ¯:"</span>, data);
});

<span class="hljs-comment">// è§¦å‘äº‹ä»¶</span>
emitter.<span class="hljs-title function_">emit</span>(<span class="hljs-string">"message"</span>, <span class="hljs-string">"Hello World!"</span>); <span class="hljs-comment">// è¾“å‡º: æ”¶åˆ°æ¶ˆæ¯: Hello World!</span>

<span class="hljs-comment">// å–æ¶ˆè®¢é˜…</span>
<span class="hljs-title function_">unsubscribe</span>();

<span class="hljs-comment">// å†æ¬¡è§¦å‘ï¼Œä¸ä¼šæœ‰è¾“å‡º</span>
emitter.<span class="hljs-title function_">emit</span>(<span class="hljs-string">"message"</span>, <span class="hljs-string">"Hello Again!"</span>);
</code></pre>
<h4 data-id="heading-7">ä¸‰ã€å®Œæ•´çš„ EventEmitter å®ç°</h4>
<h5 data-id="heading-8">3.1 æ”¯æŒæ›´å¤šç‰¹æ€§çš„å®Œæ•´å®ç°</h5>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">EventEmitter</span> {
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params"/>) {
    <span class="hljs-comment">// ä½¿ç”¨ Object.create(null) é¿å…åŸå‹æ±¡æŸ“</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">_events</span> = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">create</span>(<span class="hljs-literal">null</span>);
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">_maxListeners</span> = <span class="hljs-number">10</span>;
  }

  <span class="hljs-comment">// ================ æ ¸å¿ƒæ–¹æ³• ================</span>

  <span class="hljs-comment">/**
   * æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
   * <span class="hljs-doctag">@param</span> {<span class="hljs-type">string</span>} eventName äº‹ä»¶åç§°
   * <span class="hljs-doctag">@param</span> {<span class="hljs-type">Function</span>} listener ç›‘å¬å™¨å‡½æ•°
   * <span class="hljs-doctag">@returns</span> {<span class="hljs-type">EventEmitter</span>} <span class="hljs-variable">this</span>
   */</span>
  <span class="hljs-title function_">on</span>(<span class="hljs-params">eventName, listener</span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_addListener</span>(eventName, listener, <span class="hljs-literal">false</span>);
  }

  <span class="hljs-comment">/**
   * æ·»åŠ äº‹ä»¶ç›‘å¬å™¨ï¼ˆåˆ«åï¼‰
   */</span>
  <span class="hljs-title function_">addListener</span>(<span class="hljs-params">eventName, listener</span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">on</span>(eventName, listener);
  }

  <span class="hljs-comment">/**
   * æ·»åŠ ä¸€æ¬¡æ€§äº‹ä»¶ç›‘å¬å™¨
   * <span class="hljs-doctag">@param</span> {<span class="hljs-type">string</span>} eventName äº‹ä»¶åç§°
   * <span class="hljs-doctag">@param</span> {<span class="hljs-type">Function</span>} listener ç›‘å¬å™¨å‡½æ•°
   * <span class="hljs-doctag">@returns</span> {<span class="hljs-type">EventEmitter</span>} <span class="hljs-variable">this</span>
   */</span>
  <span class="hljs-title function_">once</span>(<span class="hljs-params">eventName, listener</span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_addListener</span>(eventName, listener, <span class="hljs-literal">true</span>);
  }

  <span class="hljs-comment">/**
   * è§¦å‘äº‹ä»¶
   * <span class="hljs-doctag">@param</span> {<span class="hljs-type">string</span>} eventName äº‹ä»¶åç§°
   * <span class="hljs-doctag">@param</span> {<span class="hljs-type">...any</span>} args ä¼ é€’ç»™ç›‘å¬å™¨çš„å‚æ•°
   * <span class="hljs-doctag">@returns</span> {<span class="hljs-type">boolean</span>} æ˜¯å¦æœ‰ç›‘å¬å™¨è¢«è°ƒç”¨
   */</span>
  <span class="hljs-title function_">emit</span>(<span class="hljs-params">eventName, ...args</span>) {
    <span class="hljs-keyword">if</span> (!<span class="hljs-variable language_">this</span>.<span class="hljs-property">_events</span>[eventName]) {
      <span class="hljs-comment">// å¦‚æœæ²¡æœ‰ error äº‹ä»¶çš„ç›‘å¬å™¨ï¼ŒæŠ›å‡ºé”™è¯¯</span>
      <span class="hljs-keyword">if</span> (eventName === <span class="hljs-string">"error"</span>) {
        <span class="hljs-keyword">const</span> error = args[<span class="hljs-number">0</span>];
        <span class="hljs-keyword">if</span> (error <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">Error</span>) {
          <span class="hljs-keyword">throw</span> error;
        } <span class="hljs-keyword">else</span> {
          <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">"Unhandled error event"</span>);
        }
      }
      <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
    }

    <span class="hljs-keyword">const</span> listeners = <span class="hljs-variable language_">this</span>.<span class="hljs-property">_events</span>[eventName];
    <span class="hljs-keyword">const</span> listenersCopy = listeners.<span class="hljs-title function_">slice</span>(); <span class="hljs-comment">// åˆ›å»ºå‰¯æœ¬é¿å…è¿­ä»£æ—¶ä¿®æ”¹</span>

    <span class="hljs-keyword">let</span> called = <span class="hljs-literal">false</span>;

    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> listener <span class="hljs-keyword">of</span> listenersCopy) {
      <span class="hljs-keyword">try</span> {
        <span class="hljs-comment">// æ£€æŸ¥æ˜¯å¦ä¸º once åŒ…è£…å‡½æ•°</span>
        <span class="hljs-keyword">if</span> (listener.<span class="hljs-property">_once</span>) {
          <span class="hljs-comment">// ç§»é™¤åŸå§‹ç›‘å¬å™¨</span>
          <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_removeListener</span>(eventName, listener);
        }

        listener.<span class="hljs-title function_">apply</span>(<span class="hljs-variable language_">this</span>, args);
        called = <span class="hljs-literal">true</span>;
      } <span class="hljs-keyword">catch</span> (error) {
        <span class="hljs-comment">// è§¦å‘é”™è¯¯äº‹ä»¶</span>
        <span class="hljs-keyword">if</span> (eventName !== <span class="hljs-string">"error"</span>) {
          <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">emit</span>(<span class="hljs-string">"error"</span>, error);
        }
      }
    }

    <span class="hljs-keyword">return</span> called;
  }

  <span class="hljs-comment">/**
   * ç§»é™¤äº‹ä»¶ç›‘å¬å™¨
   * <span class="hljs-doctag">@param</span> {<span class="hljs-type">string</span>} eventName äº‹ä»¶åç§°
   * <span class="hljs-doctag">@param</span> {<span class="hljs-type">Function</span>} listener è¦ç§»é™¤çš„ç›‘å¬å™¨
   * <span class="hljs-doctag">@returns</span> {<span class="hljs-type">EventEmitter</span>} <span class="hljs-variable">this</span>
   */</span>
  <span class="hljs-title function_">off</span>(<span class="hljs-params">eventName, listener</span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">removeListener</span>(eventName, listener);
  }

  <span class="hljs-comment">/**
   * ç§»é™¤äº‹ä»¶ç›‘å¬å™¨
   * <span class="hljs-doctag">@param</span> {<span class="hljs-type">string</span>} eventName äº‹ä»¶åç§°
   * <span class="hljs-doctag">@param</span> {<span class="hljs-type">Function</span>} listener è¦ç§»é™¤çš„ç›‘å¬å™¨
   * <span class="hljs-doctag">@returns</span> {<span class="hljs-type">EventEmitter</span>} <span class="hljs-variable">this</span>
   */</span>
  <span class="hljs-title function_">removeListener</span>(<span class="hljs-params">eventName, listener</span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_removeListener</span>(eventName, listener);
  }

  <span class="hljs-comment">/**
   * ç§»é™¤æ‰€æœ‰äº‹ä»¶ç›‘å¬å™¨
   * <span class="hljs-doctag">@param</span> {<span class="hljs-type">string</span>} [eventName] å¯é€‰ï¼Œäº‹ä»¶åç§°
   * <span class="hljs-doctag">@returns</span> {<span class="hljs-type">EventEmitter</span>} <span class="hljs-variable">this</span>
   */</span>
  <span class="hljs-title function_">removeAllListeners</span>(<span class="hljs-params">eventName</span>) {
    <span class="hljs-keyword">if</span> (eventName) {
      <span class="hljs-keyword">delete</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">_events</span>[eventName];
    } <span class="hljs-keyword">else</span> {
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">_events</span> = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">create</span>(<span class="hljs-literal">null</span>);
    }
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>;
  }

  <span class="hljs-comment">// ================ è¾…åŠ©æ–¹æ³• ================</span>

  <span class="hljs-comment">/**
   * è®¾ç½®æœ€å¤§ç›‘å¬å™¨æ•°é‡
   * <span class="hljs-doctag">@param</span> {<span class="hljs-type">number</span>} n æœ€å¤§ç›‘å¬å™¨æ•°é‡
   * <span class="hljs-doctag">@returns</span> {<span class="hljs-type">EventEmitter</span>} <span class="hljs-variable">this</span>
   */</span>
  <span class="hljs-title function_">setMaxListeners</span>(<span class="hljs-params">n</span>) {
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> n !== <span class="hljs-string">"number"</span> || n &lt; <span class="hljs-number">0</span>) {
      <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TypeError</span>(<span class="hljs-string">"n must be a non-negative number"</span>);
    }
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">_maxListeners</span> = n;
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>;
  }

  <span class="hljs-comment">/**
   * è·å–æœ€å¤§ç›‘å¬å™¨æ•°é‡
   * <span class="hljs-doctag">@returns</span> {<span class="hljs-type">number</span>} æœ€å¤§ç›‘å¬å™¨æ•°é‡
   */</span>
  <span class="hljs-title function_">getMaxListeners</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">_maxListeners</span>;
  }

  <span class="hljs-comment">/**
   * è·å–æŒ‡å®šäº‹ä»¶çš„ç›‘å¬å™¨æ•°é‡
   * <span class="hljs-doctag">@param</span> {<span class="hljs-type">string</span>} eventName äº‹ä»¶åç§°
   * <span class="hljs-doctag">@returns</span> {<span class="hljs-type">number</span>} ç›‘å¬å™¨æ•°é‡
   */</span>
  <span class="hljs-title function_">listenerCount</span>(<span class="hljs-params">eventName</span>) {
    <span class="hljs-keyword">if</span> (!<span class="hljs-variable language_">this</span>.<span class="hljs-property">_events</span>[eventName]) {
      <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
    }
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">_events</span>[eventName].<span class="hljs-property">length</span>;
  }

  <span class="hljs-comment">/**
   * è·å–æ‰€æœ‰äº‹ä»¶åç§°
   * <span class="hljs-doctag">@returns</span> {<span class="hljs-type">string[]</span>} äº‹ä»¶åç§°æ•°ç»„
   */</span>
  <span class="hljs-title function_">eventNames</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">return</span> <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">keys</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">_events</span>);
  }

  <span class="hljs-comment">/**
   * è·å–æŒ‡å®šäº‹ä»¶çš„æ‰€æœ‰ç›‘å¬å™¨
   * <span class="hljs-doctag">@param</span> {<span class="hljs-type">string</span>} eventName äº‹ä»¶åç§°
   * <span class="hljs-doctag">@returns</span> {<span class="hljs-type">Function[]</span>} ç›‘å¬å™¨æ•°ç»„
   */</span>
  <span class="hljs-title function_">listeners</span>(<span class="hljs-params">eventName</span>) {
    <span class="hljs-keyword">if</span> (!<span class="hljs-variable language_">this</span>.<span class="hljs-property">_events</span>[eventName]) {
      <span class="hljs-keyword">return</span> [];
    }
    <span class="hljs-comment">// è¿”å›å‰¯æœ¬ï¼Œé¿å…å¤–éƒ¨ä¿®æ”¹å†…éƒ¨æ•°ç»„</span>
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">_events</span>[eventName].<span class="hljs-title function_">slice</span>();
  }

  <span class="hljs-comment">/**
   * æ·»åŠ ç›‘å¬å™¨åˆ°æ•°ç»„å¼€å¤´
   * <span class="hljs-doctag">@param</span> {<span class="hljs-type">string</span>} eventName äº‹ä»¶åç§°
   * <span class="hljs-doctag">@param</span> {<span class="hljs-type">Function</span>} listener ç›‘å¬å™¨å‡½æ•°
   * <span class="hljs-doctag">@returns</span> {<span class="hljs-type">EventEmitter</span>} <span class="hljs-variable">this</span>
   */</span>
  <span class="hljs-title function_">prependListener</span>(<span class="hljs-params">eventName, listener</span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_addListener</span>(eventName, listener, <span class="hljs-literal">false</span>, <span class="hljs-literal">true</span>);
  }

  <span class="hljs-comment">/**
   * æ·»åŠ ä¸€æ¬¡æ€§ç›‘å¬å™¨åˆ°æ•°ç»„å¼€å¤´
   * <span class="hljs-doctag">@param</span> {<span class="hljs-type">string</span>} eventName äº‹ä»¶åç§°
   * <span class="hljs-doctag">@param</span> {<span class="hljs-type">Function</span>} listener ç›‘å¬å™¨å‡½æ•°
   * <span class="hljs-doctag">@returns</span> {<span class="hljs-type">EventEmitter</span>} <span class="hljs-variable">this</span>
   */</span>
  <span class="hljs-title function_">prependOnceListener</span>(<span class="hljs-params">eventName, listener</span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_addListener</span>(eventName, listener, <span class="hljs-literal">true</span>, <span class="hljs-literal">true</span>);
  }

  <span class="hljs-comment">/**
   * å†…éƒ¨æ–¹æ³•ï¼šæ·»åŠ ç›‘å¬å™¨
   * <span class="hljs-doctag">@private</span>
   */</span>
  <span class="hljs-title function_">_addListener</span>(<span class="hljs-params">eventName, listener, once = <span class="hljs-literal">false</span>, prepend = <span class="hljs-literal">false</span></span>) {
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> listener !== <span class="hljs-string">"function"</span>) {
      <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TypeError</span>(<span class="hljs-string">"listener must be a function"</span>);
    }

    <span class="hljs-comment">// åˆå§‹åŒ–äº‹ä»¶æ•°ç»„</span>
    <span class="hljs-keyword">if</span> (!<span class="hljs-variable language_">this</span>.<span class="hljs-property">_events</span>[eventName]) {
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">_events</span>[eventName] = [];
    }

    <span class="hljs-keyword">const</span> listeners = <span class="hljs-variable language_">this</span>.<span class="hljs-property">_events</span>[eventName];

    <span class="hljs-comment">// æ£€æŸ¥æœ€å¤§ç›‘å¬å™¨é™åˆ¶</span>
    <span class="hljs-keyword">if</span> (listeners.<span class="hljs-property">length</span> &gt;= <span class="hljs-variable language_">this</span>.<span class="hljs-property">_maxListeners</span> &amp;&amp; <span class="hljs-variable language_">this</span>.<span class="hljs-property">_maxListeners</span> !== <span class="hljs-number">0</span>) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">warn</span>(
        <span class="hljs-string">`MaxListenersExceededWarning: Possible EventEmitter memory leak detected. `</span> +
          <span class="hljs-string">`<span class="hljs-subst">${listeners.length}</span> <span class="hljs-subst">${eventName}</span> listeners added. `</span> +
          <span class="hljs-string">`Use emitter.setMaxListeners() to increase limit`</span>
      );
    }

    <span class="hljs-comment">// å¦‚æœæ˜¯ onceï¼Œåˆ›å»ºåŒ…è£…å‡½æ•°</span>
    <span class="hljs-keyword">let</span> listenerToAdd = listener;
    <span class="hljs-keyword">if</span> (once) {
      <span class="hljs-keyword">const</span> <span class="hljs-title function_">onceWrapper</span> = (<span class="hljs-params">...args</span>) =&gt; {
        listener.<span class="hljs-title function_">apply</span>(<span class="hljs-variable language_">this</span>, args);
        <span class="hljs-comment">// æ ‡è®°ä¸º once åŒ…è£…å‡½æ•°</span>
        onceWrapper.<span class="hljs-property">_once</span> = <span class="hljs-literal">true</span>;
      };
      <span class="hljs-comment">// ä¿å­˜åŸå§‹ç›‘å¬å™¨å¼•ç”¨ï¼Œç”¨äºç§»é™¤</span>
      onceWrapper.<span class="hljs-property">_originalListener</span> = listener;
      listenerToAdd = onceWrapper;
    }

    <span class="hljs-comment">// æ·»åŠ åˆ°æ•°ç»„å¼€å¤´æˆ–ç»“å°¾</span>
    <span class="hljs-keyword">if</span> (prepend) {
      listeners.<span class="hljs-title function_">unshift</span>(listenerToAdd);
    } <span class="hljs-keyword">else</span> {
      listeners.<span class="hljs-title function_">push</span>(listenerToAdd);
    }

    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>;
  }

  <span class="hljs-comment">/**
   * å†…éƒ¨æ–¹æ³•ï¼šç§»é™¤ç›‘å¬å™¨
   * <span class="hljs-doctag">@private</span>
   */</span>
  <span class="hljs-title function_">_removeListener</span>(<span class="hljs-params">eventName, listener</span>) {
    <span class="hljs-keyword">if</span> (!<span class="hljs-variable language_">this</span>.<span class="hljs-property">_events</span>[eventName]) {
      <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>;
    }

    <span class="hljs-keyword">const</span> listeners = <span class="hljs-variable language_">this</span>.<span class="hljs-property">_events</span>[eventName];

    <span class="hljs-comment">// æŸ¥æ‰¾è¦ç§»é™¤çš„ç›‘å¬å™¨</span>
    <span class="hljs-comment">// éœ€è¦è€ƒè™‘ä¸¤ç§æƒ…å†µï¼š</span>
    <span class="hljs-comment">// 1. ç›´æ¥ä¼ å…¥ç›‘å¬å™¨</span>
    <span class="hljs-comment">// 2. ä¼ å…¥ once åŒ…è£…å‡½æ•°çš„åŸå§‹ç›‘å¬å™¨</span>
    <span class="hljs-keyword">let</span> index = -<span class="hljs-number">1</span>;

    <span class="hljs-comment">// å°è¯•ç›´æ¥æŸ¥æ‰¾</span>
    index = listeners.<span class="hljs-title function_">indexOf</span>(listener);

    <span class="hljs-comment">// å¦‚æœæ²¡æ‰¾åˆ°ï¼Œå°è¯•æŸ¥æ‰¾åŸå§‹ç›‘å¬å™¨</span>
    <span class="hljs-keyword">if</span> (index === -<span class="hljs-number">1</span>) {
      <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; listeners.<span class="hljs-property">length</span>; i++) {
        <span class="hljs-keyword">const</span> current = listeners[i];
        <span class="hljs-keyword">if</span> (current.<span class="hljs-property">_originalListener</span> === listener) {
          index = i;
          <span class="hljs-keyword">break</span>;
        }
      }
    }

    <span class="hljs-keyword">if</span> (index &gt; -<span class="hljs-number">1</span>) {
      listeners.<span class="hljs-title function_">splice</span>(index, <span class="hljs-number">1</span>);

      <span class="hljs-comment">// å¦‚æœæ•°ç»„ä¸ºç©ºï¼Œåˆ é™¤äº‹ä»¶</span>
      <span class="hljs-keyword">if</span> (listeners.<span class="hljs-property">length</span> === <span class="hljs-number">0</span>) {
        <span class="hljs-keyword">delete</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">_events</span>[eventName];
      }
    }

    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>;
  }
}
</code></pre>
<h5 data-id="heading-9">3.2 ç±»å‹å®‰å…¨çš„TypeScriptç‰ˆæœ¬</h5>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">type</span> <span class="hljs-title class_">Listener</span> = <span class="hljs-function">(<span class="hljs-params">...args: <span class="hljs-built_in">any</span>[]</span>) =&gt;</span> <span class="hljs-built_in">void</span>;
<span class="hljs-keyword">type</span> <span class="hljs-title class_">OnceWrapper</span> = <span class="hljs-title class_">Listener</span> &amp; { _originalListener?: <span class="hljs-title class_">Listener</span>; _once?: <span class="hljs-built_in">boolean</span> };

<span class="hljs-keyword">class</span> <span class="hljs-title class_">EventEmitter</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-attr">_events</span>: <span class="hljs-title class_">Record</span>&lt;<span class="hljs-built_in">string</span>, <span class="hljs-title class_">Listener</span>[]&gt; = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">create</span>(<span class="hljs-literal">null</span>);
    <span class="hljs-keyword">private</span> <span class="hljs-attr">_maxListeners</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">10</span>;
    
    <span class="hljs-comment">// æ ¸å¿ƒæ–¹æ³•</span>
    <span class="hljs-title function_">on</span>(<span class="hljs-attr">eventName</span>: <span class="hljs-built_in">string</span>, <span class="hljs-attr">listener</span>: <span class="hljs-title class_">Listener</span>): <span class="hljs-variable language_">this</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_addListener</span>(eventName, listener, <span class="hljs-literal">false</span>);
    }
    
    <span class="hljs-title function_">addListener</span>(<span class="hljs-attr">eventName</span>: <span class="hljs-built_in">string</span>, <span class="hljs-attr">listener</span>: <span class="hljs-title class_">Listener</span>): <span class="hljs-variable language_">this</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">on</span>(eventName, listener);
    }
    
    <span class="hljs-title function_">once</span>(<span class="hljs-attr">eventName</span>: <span class="hljs-built_in">string</span>, <span class="hljs-attr">listener</span>: <span class="hljs-title class_">Listener</span>): <span class="hljs-variable language_">this</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_addListener</span>(eventName, listener, <span class="hljs-literal">true</span>);
    }
    
    <span class="hljs-title function_">emit</span>(<span class="hljs-attr">eventName</span>: <span class="hljs-built_in">string</span>, ...<span class="hljs-attr">args</span>: <span class="hljs-built_in">any</span>[]): <span class="hljs-built_in">boolean</span> {
        <span class="hljs-keyword">const</span> listeners = <span class="hljs-variable language_">this</span>.<span class="hljs-property">_events</span>[eventName];
        <span class="hljs-keyword">if</span> (!listeners) {
            <span class="hljs-keyword">if</span> (eventName === <span class="hljs-string">'error'</span>) {
                <span class="hljs-keyword">const</span> error = args[<span class="hljs-number">0</span>];
                <span class="hljs-keyword">throw</span> error <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">Error</span> ? error : <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">'Unhandled error event'</span>);
            }
            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
        }
        
        <span class="hljs-keyword">const</span> listenersCopy = listeners.<span class="hljs-title function_">slice</span>();
        <span class="hljs-keyword">let</span> called = <span class="hljs-literal">false</span>;
        
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> listener <span class="hljs-keyword">of</span> listenersCopy) {
            <span class="hljs-keyword">try</span> {
                <span class="hljs-comment">// æ£€æŸ¥æ˜¯å¦ä¸º once åŒ…è£…å‡½æ•°</span>
                <span class="hljs-keyword">const</span> onceWrapper = listener <span class="hljs-keyword">as</span> <span class="hljs-title class_">OnceWrapper</span>;
                <span class="hljs-keyword">if</span> (onceWrapper.<span class="hljs-property">_once</span>) {
                    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_removeListener</span>(eventName, listener);
                }
                
                listener.<span class="hljs-title function_">apply</span>(<span class="hljs-variable language_">this</span>, args);
                called = <span class="hljs-literal">true</span>;
            } <span class="hljs-keyword">catch</span> (error) {
                <span class="hljs-keyword">if</span> (eventName !== <span class="hljs-string">'error'</span>) {
                    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">emit</span>(<span class="hljs-string">'error'</span>, error);
                }
            }
        }
        
        <span class="hljs-keyword">return</span> called;
    }
    
    <span class="hljs-title function_">off</span>(<span class="hljs-attr">eventName</span>: <span class="hljs-built_in">string</span>, <span class="hljs-attr">listener</span>: <span class="hljs-title class_">Listener</span>): <span class="hljs-variable language_">this</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">removeListener</span>(eventName, listener);
    }
    
    <span class="hljs-title function_">removeListener</span>(<span class="hljs-attr">eventName</span>: <span class="hljs-built_in">string</span>, <span class="hljs-attr">listener</span>: <span class="hljs-title class_">Listener</span>): <span class="hljs-variable language_">this</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_removeListener</span>(eventName, listener);
    }
    
    <span class="hljs-title function_">removeAllListeners</span>(eventName?: <span class="hljs-built_in">string</span>): <span class="hljs-variable language_">this</span> {
        <span class="hljs-keyword">if</span> (eventName) {
            <span class="hljs-keyword">delete</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">_events</span>[eventName];
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-variable language_">this</span>.<span class="hljs-property">_events</span> = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">create</span>(<span class="hljs-literal">null</span>);
        }
        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>;
    }
    
    <span class="hljs-comment">// è¾…åŠ©æ–¹æ³•</span>
    <span class="hljs-title function_">setMaxListeners</span>(<span class="hljs-attr">n</span>: <span class="hljs-built_in">number</span>): <span class="hljs-variable language_">this</span> {
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> n !== <span class="hljs-string">'number'</span> || n &lt; <span class="hljs-number">0</span>) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TypeError</span>(<span class="hljs-string">'n must be a non-negative number'</span>);
        }
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">_maxListeners</span> = n;
        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>;
    }
    
    <span class="hljs-title function_">getMaxListeners</span>(): <span class="hljs-built_in">number</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">_maxListeners</span>;
    }
    
    <span class="hljs-title function_">listenerCount</span>(<span class="hljs-attr">eventName</span>: <span class="hljs-built_in">string</span>): <span class="hljs-built_in">number</span> {
        <span class="hljs-keyword">const</span> listeners = <span class="hljs-variable language_">this</span>.<span class="hljs-property">_events</span>[eventName];
        <span class="hljs-keyword">return</span> listeners ? listeners.<span class="hljs-property">length</span> : <span class="hljs-number">0</span>;
    }
    
    <span class="hljs-title function_">eventNames</span>(): <span class="hljs-built_in">string</span>[] {
        <span class="hljs-keyword">return</span> <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">keys</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">_events</span>);
    }
    
    <span class="hljs-title function_">listeners</span>(<span class="hljs-attr">eventName</span>: <span class="hljs-built_in">string</span>): <span class="hljs-title class_">Listener</span>[] {
        <span class="hljs-keyword">const</span> listeners = <span class="hljs-variable language_">this</span>.<span class="hljs-property">_events</span>[eventName];
        <span class="hljs-keyword">return</span> listeners ? listeners.<span class="hljs-title function_">slice</span>() : [];
    }
    
    <span class="hljs-title function_">prependListener</span>(<span class="hljs-attr">eventName</span>: <span class="hljs-built_in">string</span>, <span class="hljs-attr">listener</span>: <span class="hljs-title class_">Listener</span>): <span class="hljs-variable language_">this</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_addListener</span>(eventName, listener, <span class="hljs-literal">false</span>, <span class="hljs-literal">true</span>);
    }
    
    <span class="hljs-title function_">prependOnceListener</span>(<span class="hljs-attr">eventName</span>: <span class="hljs-built_in">string</span>, <span class="hljs-attr">listener</span>: <span class="hljs-title class_">Listener</span>): <span class="hljs-variable language_">this</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_addListener</span>(eventName, listener, <span class="hljs-literal">true</span>, <span class="hljs-literal">true</span>);
    }
    
    <span class="hljs-comment">// ç§æœ‰æ–¹æ³•</span>
    <span class="hljs-keyword">private</span> <span class="hljs-title function_">_addListener</span>(<span class="hljs-attr">eventName</span>: <span class="hljs-built_in">string</span>, <span class="hljs-attr">listener</span>: <span class="hljs-title class_">Listener</span>, <span class="hljs-attr">once</span>: <span class="hljs-built_in">boolean</span>, <span class="hljs-attr">prepend</span>: <span class="hljs-built_in">boolean</span> = <span class="hljs-literal">false</span>): <span class="hljs-variable language_">this</span> {
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> listener !== <span class="hljs-string">'function'</span>) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TypeError</span>(<span class="hljs-string">'listener must be a function'</span>);
        }
        
        <span class="hljs-keyword">if</span> (!<span class="hljs-variable language_">this</span>.<span class="hljs-property">_events</span>[eventName]) {
            <span class="hljs-variable language_">this</span>.<span class="hljs-property">_events</span>[eventName] = [];
        }
        
        <span class="hljs-keyword">const</span> listeners = <span class="hljs-variable language_">this</span>.<span class="hljs-property">_events</span>[eventName];
        
        <span class="hljs-comment">// æ£€æŸ¥æœ€å¤§ç›‘å¬å™¨é™åˆ¶</span>
        <span class="hljs-keyword">if</span> (listeners.<span class="hljs-property">length</span> &gt;= <span class="hljs-variable language_">this</span>.<span class="hljs-property">_maxListeners</span> &amp;&amp; <span class="hljs-variable language_">this</span>.<span class="hljs-property">_maxListeners</span> !== <span class="hljs-number">0</span>) {
            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">warn</span>(<span class="hljs-string">`MaxListenersExceededWarning for event <span class="hljs-subst">${eventName}</span>`</span>);
        }
        
        <span class="hljs-keyword">let</span> <span class="hljs-attr">listenerToAdd</span>: <span class="hljs-title class_">Listener</span> = listener;
        
        <span class="hljs-keyword">if</span> (once) {
            <span class="hljs-keyword">const</span> <span class="hljs-attr">onceWrapper</span>: <span class="hljs-title class_">OnceWrapper</span> = <span class="hljs-function">(<span class="hljs-params">...args: <span class="hljs-built_in">any</span>[]</span>) =&gt;</span> {
                listener.<span class="hljs-title function_">apply</span>(<span class="hljs-variable language_">this</span>, args);
                onceWrapper.<span class="hljs-property">_once</span> = <span class="hljs-literal">true</span>;
            };
            onceWrapper.<span class="hljs-property">_originalListener</span> = listener;
            listenerToAdd = onceWrapper;
        }
        
        <span class="hljs-keyword">if</span> (prepend) {
            listeners.<span class="hljs-title function_">unshift</span>(listenerToAdd);
        } <span class="hljs-keyword">else</span> {
            listeners.<span class="hljs-title function_">push</span>(listenerToAdd);
        }
        
        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>;
    }
    
    <span class="hljs-keyword">private</span> <span class="hljs-title function_">_removeListener</span>(<span class="hljs-attr">eventName</span>: <span class="hljs-built_in">string</span>, <span class="hljs-attr">listener</span>: <span class="hljs-title class_">Listener</span>): <span class="hljs-variable language_">this</span> {
        <span class="hljs-keyword">const</span> listeners = <span class="hljs-variable language_">this</span>.<span class="hljs-property">_events</span>[eventName];
        <span class="hljs-keyword">if</span> (!listeners) <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>;
        
        <span class="hljs-keyword">let</span> index = listeners.<span class="hljs-title function_">indexOf</span>(listener);
        
        <span class="hljs-comment">// å¦‚æœæ²¡æ‰¾åˆ°ï¼Œå°è¯•æŸ¥æ‰¾åŸå§‹ç›‘å¬å™¨</span>
        <span class="hljs-keyword">if</span> (index === -<span class="hljs-number">1</span>) {
            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; listeners.<span class="hljs-property">length</span>; i++) {
                <span class="hljs-keyword">const</span> current = listeners[i] <span class="hljs-keyword">as</span> <span class="hljs-title class_">OnceWrapper</span>;
                <span class="hljs-keyword">if</span> (current.<span class="hljs-property">_originalListener</span> === listener) {
                    index = i;
                    <span class="hljs-keyword">break</span>;
                }
            }
        }
        
        <span class="hljs-keyword">if</span> (index &gt; -<span class="hljs-number">1</span>) {
            listeners.<span class="hljs-title function_">splice</span>(index, <span class="hljs-number">1</span>);
            <span class="hljs-keyword">if</span> (listeners.<span class="hljs-property">length</span> === <span class="hljs-number">0</span>) {
                <span class="hljs-keyword">delete</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">_events</span>[eventName];
            }
        }
        
        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>;
    }
}
</code></pre>
<h4 data-id="heading-10">å››ã€æµ‹è¯•ç”¨ä¾‹</h4>
<h5 data-id="heading-11">4.1 åŸºç¡€åŠŸèƒ½æµ‹è¯•</h5>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"=== EventEmitter åŸºç¡€åŠŸèƒ½æµ‹è¯• ==="</span>);

<span class="hljs-keyword">const</span> emitter = <span class="hljs-keyword">new</span> <span class="hljs-title class_">EventEmitter</span>();

<span class="hljs-comment">// æµ‹è¯•1: åŸºæœ¬è®¢é˜…å’Œè§¦å‘</span>
<span class="hljs-keyword">let</span> test1Count = <span class="hljs-number">0</span>;
emitter.<span class="hljs-title function_">on</span>(<span class="hljs-string">"test1"</span>, <span class="hljs-function">(<span class="hljs-params">data</span>) =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"æµ‹è¯•1 - æ”¶åˆ°æ•°æ®:"</span>, data);
  test1Count++;
});

emitter.<span class="hljs-title function_">emit</span>(<span class="hljs-string">"test1"</span>, <span class="hljs-string">"Hello"</span>); <span class="hljs-comment">// æµ‹è¯•1 - æ”¶åˆ°æ•°æ®: Hello</span>
emitter.<span class="hljs-title function_">emit</span>(<span class="hljs-string">"test1"</span>, <span class="hljs-string">"World"</span>); <span class="hljs-comment">// æµ‹è¯•1 - æ”¶åˆ°æ•°æ®: World</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`æµ‹è¯•1 - è°ƒç”¨æ¬¡æ•°: <span class="hljs-subst">${test1Count}</span>`</span>); <span class="hljs-comment">// æµ‹è¯•1 - è°ƒç”¨æ¬¡æ•°: 2</span>

<span class="hljs-comment">// æµ‹è¯•2: å¤šä¸ªç›‘å¬å™¨</span>
<span class="hljs-keyword">let</span> test2Result = [];
emitter.<span class="hljs-title function_">on</span>(<span class="hljs-string">"test2"</span>, <span class="hljs-function">(<span class="hljs-params">data</span>) =&gt;</span> {
  test2Result.<span class="hljs-title function_">push</span>(<span class="hljs-string">`listener1: <span class="hljs-subst">${data}</span>`</span>);
});
emitter.<span class="hljs-title function_">on</span>(<span class="hljs-string">"test2"</span>, <span class="hljs-function">(<span class="hljs-params">data</span>) =&gt;</span> {
  test2Result.<span class="hljs-title function_">push</span>(<span class="hljs-string">`listener2: <span class="hljs-subst">${data.toUpperCase()}</span>`</span>);
});

emitter.<span class="hljs-title function_">emit</span>(<span class="hljs-string">"test2"</span>, <span class="hljs-string">"hello"</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"æµ‹è¯•2 - å¤šä¸ªç›‘å¬å™¨:"</span>, test2Result); <span class="hljs-comment">// æµ‹è¯•2 - å¤šä¸ªç›‘å¬å™¨: [ 'listener1: hello', 'listener2: HELLO' ]</span>

<span class="hljs-comment">// æµ‹è¯•3: å–æ¶ˆè®¢é˜…</span>
<span class="hljs-keyword">let</span> test3Count = <span class="hljs-number">0</span>;
<span class="hljs-keyword">const</span> <span class="hljs-title function_">test3Listener</span> = (<span class="hljs-params"/>) =&gt; {
  test3Count++;
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"æµ‹è¯•3 - ç›‘å¬å™¨è¢«è°ƒç”¨"</span>);
};

emitter.<span class="hljs-title function_">on</span>(<span class="hljs-string">"test3"</span>, test3Listener);
emitter.<span class="hljs-title function_">emit</span>(<span class="hljs-string">"test3"</span>); <span class="hljs-comment">// æµ‹è¯•3 - ç›‘å¬å™¨è¢«è°ƒç”¨</span>
emitter.<span class="hljs-title function_">off</span>(<span class="hljs-string">"test3"</span>, test3Listener);
emitter.<span class="hljs-title function_">emit</span>(<span class="hljs-string">"test3"</span>); <span class="hljs-comment">// ä¸è°ƒç”¨</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`æµ‹è¯•3 - æœ€ç»ˆè°ƒç”¨æ¬¡æ•°: <span class="hljs-subst">${test3Count}</span>`</span>); <span class="hljs-comment">// æµ‹è¯•3 - æœ€ç»ˆè°ƒç”¨æ¬¡æ•°: 1</span>

<span class="hljs-comment">// æµ‹è¯•4: once æ–¹æ³•</span>
<span class="hljs-keyword">let</span> test4Count = <span class="hljs-number">0</span>;
emitter.<span class="hljs-title function_">once</span>(<span class="hljs-string">"test4"</span>, <span class="hljs-function">() =&gt;</span> {
  test4Count++;
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"æµ‹è¯•4 - once ç›‘å¬å™¨è¢«è°ƒç”¨"</span>);
});

emitter.<span class="hljs-title function_">emit</span>(<span class="hljs-string">"test4"</span>); <span class="hljs-comment">// æµ‹è¯•4 - once ç›‘å¬å™¨è¢«è°ƒç”¨</span>
emitter.<span class="hljs-title function_">emit</span>(<span class="hljs-string">"test4"</span>); <span class="hljs-comment">// æµ‹è¯•4 - once ç›‘å¬å™¨è¢«è°ƒç”¨</span>
emitter.<span class="hljs-title function_">emit</span>(<span class="hljs-string">"test4"</span>); <span class="hljs-comment">// ä¸è°ƒç”¨</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`æµ‹è¯•4 - once è°ƒç”¨æ¬¡æ•°: <span class="hljs-subst">${test4Count}</span>`</span>); <span class="hljs-comment">// æµ‹è¯•4 - once è°ƒç”¨æ¬¡æ•°: 2</span>

<span class="hljs-comment">// æµ‹è¯•5: é”™è¯¯å¤„ç†</span>
<span class="hljs-keyword">let</span> errorCaught = <span class="hljs-literal">false</span>;
emitter.<span class="hljs-title function_">on</span>(<span class="hljs-string">"error"</span>, <span class="hljs-function">(<span class="hljs-params">error</span>) =&gt;</span> {
  errorCaught = <span class="hljs-literal">true</span>;
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"æµ‹è¯•5 - æ•è·åˆ°é”™è¯¯:"</span>, error.<span class="hljs-property">message</span>);
});

emitter.<span class="hljs-title function_">on</span>(<span class="hljs-string">"test5"</span>, <span class="hljs-function">() =&gt;</span> {
  <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">"æµ‹è¯•é”™è¯¯"</span>); <span class="hljs-comment">// æµ‹è¯•5 - æ•è·åˆ°é”™è¯¯: æµ‹è¯•é”™è¯¯</span>
});

emitter.<span class="hljs-title function_">emit</span>(<span class="hljs-string">"test5"</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`æµ‹è¯•5 - é”™è¯¯æ˜¯å¦è¢«æ•è·: <span class="hljs-subst">${errorCaught}</span>`</span>); <span class="hljs-comment">// æµ‹è¯•5 - é”™è¯¯æ˜¯å¦è¢«æ•è·: true</span>
</code></pre>
<h5 data-id="heading-12">4.2 é«˜çº§åŠŸèƒ½æµ‹è¯•</h5>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"\n=== EventEmitter é«˜çº§åŠŸèƒ½æµ‹è¯• ==="</span>);

<span class="hljs-keyword">const</span> emitter2 = <span class="hljs-keyword">new</span> <span class="hljs-title class_">EventEmitter</span>();

<span class="hljs-comment">// æµ‹è¯•6: prependListener æ–¹æ³•</span>
<span class="hljs-keyword">let</span> test6Order = [];
emitter2.<span class="hljs-title function_">on</span>(<span class="hljs-string">"test6"</span>, <span class="hljs-function">() =&gt;</span> test6Order.<span class="hljs-title function_">push</span>(<span class="hljs-string">"normal1"</span>));
emitter2.<span class="hljs-title function_">on</span>(<span class="hljs-string">"test6"</span>, <span class="hljs-function">() =&gt;</span> test6Order.<span class="hljs-title function_">push</span>(<span class="hljs-string">"normal2"</span>));
emitter2.<span class="hljs-title function_">prependListener</span>(<span class="hljs-string">"test6"</span>, <span class="hljs-function">() =&gt;</span> test6Order.<span class="hljs-title function_">push</span>(<span class="hljs-string">"prepended"</span>));

emitter2.<span class="hljs-title function_">emit</span>(<span class="hljs-string">"test6"</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"æµ‹è¯•6 - ç›‘å¬å™¨é¡ºåº:"</span>, test6Order);
<span class="hljs-comment">// æµ‹è¯•6 - ç›‘å¬å™¨é¡ºåº: [ 'prepended', 'normal1', 'normal2' ]</span>

<span class="hljs-comment">// æµ‹è¯•7: æœ€å¤§ç›‘å¬å™¨é™åˆ¶</span>
emitter2.<span class="hljs-title function_">setMaxListeners</span>(<span class="hljs-number">2</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`æµ‹è¯•7 - æœ€å¤§ç›‘å¬å™¨æ•°: <span class="hljs-subst">${emitter2.getMaxListeners()}</span>`</span>); <span class="hljs-comment">// æµ‹è¯•7 - æœ€å¤§ç›‘å¬å™¨æ•°: 2</span>

emitter2.<span class="hljs-title function_">on</span>(<span class="hljs-string">"test7"</span>, <span class="hljs-function">() =&gt;</span> {});
emitter2.<span class="hljs-title function_">on</span>(<span class="hljs-string">"test7"</span>, <span class="hljs-function">() =&gt;</span> {});
<span class="hljs-comment">// ç¬¬ä¸‰ä¸ªåº”è¯¥è§¦å‘è­¦å‘Š</span>
emitter2.<span class="hljs-title function_">on</span>(<span class="hljs-string">"test7"</span>, <span class="hljs-function">() =&gt;</span> {});

<span class="hljs-comment">// æµ‹è¯•8: è·å–ç›‘å¬å™¨ä¿¡æ¯</span>
emitter2.<span class="hljs-title function_">on</span>(<span class="hljs-string">"test8"</span>, <span class="hljs-function">() =&gt;</span> {});
emitter2.<span class="hljs-title function_">on</span>(<span class="hljs-string">"test8"</span>, <span class="hljs-function">() =&gt;</span> {});
emitter2.<span class="hljs-title function_">once</span>(<span class="hljs-string">"test8"</span>, <span class="hljs-function">() =&gt;</span> {});

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`æµ‹è¯•8 - ç›‘å¬å™¨æ•°é‡: <span class="hljs-subst">${emitter2.listenerCount(<span class="hljs-string">"test8"</span>)}</span>`</span>); <span class="hljs-comment">// 3</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`æµ‹è¯•8 - ç›‘å¬å™¨æ•°ç»„é•¿åº¦: <span class="hljs-subst">${emitter2.listeners(<span class="hljs-string">"test8"</span>).length}</span>`</span>); <span class="hljs-comment">// 3</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`æµ‹è¯•8 - äº‹ä»¶åç§°: <span class="hljs-subst">${emitter2.eventNames()}</span>`</span>); <span class="hljs-comment">// ['test6', 'test7', 'test8']</span>

<span class="hljs-comment">// æµ‹è¯•9: removeAllListeners</span>
emitter2.<span class="hljs-title function_">removeAllListeners</span>(<span class="hljs-string">"test8"</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`æµ‹è¯•9 - ç§»é™¤åç›‘å¬å™¨æ•°é‡: <span class="hljs-subst">${emitter2.listenerCount(<span class="hljs-string">"test8"</span>)}</span>`</span>); <span class="hljs-comment">// 0</span>

<span class="hljs-comment">// æµ‹è¯•10: é“¾å¼è°ƒç”¨</span>
emitter2
  .<span class="hljs-title function_">on</span>(<span class="hljs-string">"test10"</span>, <span class="hljs-function">() =&gt;</span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"æµ‹è¯•10 - é“¾å¼è°ƒç”¨1"</span>))
  .<span class="hljs-title function_">on</span>(<span class="hljs-string">"test10"</span>, <span class="hljs-function">() =&gt;</span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"æµ‹è¯•10 - é“¾å¼è°ƒç”¨2"</span>))
  .<span class="hljs-title function_">emit</span>(<span class="hljs-string">"test10"</span>);
</code></pre>
<h5 data-id="heading-13">4.3 è¾¹ç•Œæƒ…å†µæµ‹è¯•</h5>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'\n=== EventEmitter è¾¹ç•Œæƒ…å†µæµ‹è¯• ==='</span>);

<span class="hljs-keyword">const</span> emitter3 = <span class="hljs-keyword">new</span> <span class="hljs-title class_">EventEmitter</span>();

<span class="hljs-comment">// æµ‹è¯•11: é‡å¤æ·»åŠ ç›¸åŒç›‘å¬å™¨</span>
<span class="hljs-keyword">let</span> test11Count = <span class="hljs-number">0</span>;
<span class="hljs-keyword">const</span> <span class="hljs-title function_">test11Listener</span> = (<span class="hljs-params"/>) =&gt; test11Count++;

emitter3.<span class="hljs-title function_">on</span>(<span class="hljs-string">'test11'</span>, test11Listener);
emitter3.<span class="hljs-title function_">on</span>(<span class="hljs-string">'test11'</span>, test11Listener); <span class="hljs-comment">// é‡å¤æ·»åŠ </span>

emitter3.<span class="hljs-title function_">emit</span>(<span class="hljs-string">'test11'</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`æµ‹è¯•11 - é‡å¤ç›‘å¬å™¨è°ƒç”¨æ¬¡æ•°: <span class="hljs-subst">${test11Count}</span>`</span>); <span class="hljs-comment">// 2</span>

<span class="hljs-comment">// æµ‹è¯•12: ç§»é™¤ä¸å­˜åœ¨çš„ç›‘å¬å™¨</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">fakeListener</span> = (<span class="hljs-params"/>) =&gt; {};
emitter3.<span class="hljs-title function_">off</span>(<span class="hljs-string">'nonexistent'</span>, fakeListener); <span class="hljs-comment">// åº”è¯¥ä¸æŠ¥é”™</span>

<span class="hljs-comment">// æµ‹è¯•13: è§¦å‘æ²¡æœ‰ç›‘å¬å™¨çš„äº‹ä»¶</span>
<span class="hljs-keyword">const</span> result = emitter3.<span class="hljs-title function_">emit</span>(<span class="hljs-string">'nonexistent'</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`æµ‹è¯•13 - è§¦å‘æ— ç›‘å¬å™¨äº‹ä»¶è¿”å›å€¼: <span class="hljs-subst">${result}</span>`</span>); <span class="hljs-comment">// false</span>

<span class="hljs-comment">// æµ‹è¯•14: é”™è¯¯äº‹ä»¶å¤„ç†</span>
<span class="hljs-keyword">try</span> {
    emitter3.<span class="hljs-title function_">emit</span>(<span class="hljs-string">'error'</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">'æœªå¤„ç†çš„é”™è¯¯'</span>));
} <span class="hljs-keyword">catch</span> (error) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`æµ‹è¯•14 - æ•è·æœªå¤„ç†çš„é”™è¯¯: <span class="hljs-subst">${error.message}</span>`</span>);
}

<span class="hljs-comment">// æµ‹è¯•15: once ç›‘å¬å™¨ç§»é™¤åå†æ¬¡è§¦å‘</span>
<span class="hljs-keyword">let</span> test15Count = <span class="hljs-number">0</span>;
<span class="hljs-keyword">const</span> <span class="hljs-title function_">test15Listener</span> = (<span class="hljs-params"/>) =&gt; {
    test15Count++;
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`æµ‹è¯•15 - ç¬¬ <span class="hljs-subst">${test15Count}</span> æ¬¡è°ƒç”¨`</span>);
};

<span class="hljs-keyword">const</span> removeOnce = emitter3.<span class="hljs-title function_">once</span>(<span class="hljs-string">'test15'</span>, test15Listener);
emitter3.<span class="hljs-title function_">emit</span>(<span class="hljs-string">'test15'</span>); <span class="hljs-comment">// è°ƒç”¨</span>
<span class="hljs-title function_">removeOnce</span>(); <span class="hljs-comment">// æ‰‹åŠ¨ç§»é™¤</span>
emitter3.<span class="hljs-title function_">emit</span>(<span class="hljs-string">'test15'</span>); <span class="hljs-comment">// ä¸è°ƒç”¨</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`æµ‹è¯•15 - æœ€ç»ˆè°ƒç”¨æ¬¡æ•°: <span class="hljs-subst">${test15Count}</span>`</span>); <span class="hljs-comment">// 1</span>
</code></pre>
<h5 data-id="heading-14">4.4 æ€§èƒ½æµ‹è¯•</h5>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'\n=== EventEmitter æ€§èƒ½æµ‹è¯• ==='</span>);

<span class="hljs-keyword">const</span> performanceEmitter = <span class="hljs-keyword">new</span> <span class="hljs-title class_">EventEmitter</span>();
<span class="hljs-keyword">const</span> iterations = <span class="hljs-number">100000</span>;

<span class="hljs-comment">// å‡†å¤‡æµ‹è¯•æ•°æ®</span>
<span class="hljs-keyword">const</span> listeners = [];
<span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">100</span>; i++) {
    listeners.<span class="hljs-title function_">push</span>(<span class="hljs-function">() =&gt;</span> {});
}

<span class="hljs-comment">// æµ‹è¯•æ·»åŠ ç›‘å¬å™¨çš„æ€§èƒ½</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">time</span>(<span class="hljs-string">'æ·»åŠ ç›‘å¬å™¨'</span>);
<span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; iterations; i++) {
    performanceEmitter.<span class="hljs-title function_">on</span>(<span class="hljs-string">'performance'</span>, listeners[i % listeners.<span class="hljs-property">length</span>]);
}
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">timeEnd</span>(<span class="hljs-string">'æ·»åŠ ç›‘å¬å™¨'</span>);

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`æ·»åŠ åç›‘å¬å™¨æ•°é‡: <span class="hljs-subst">${performanceEmitter.listenerCount(<span class="hljs-string">'performance'</span>)}</span>`</span>);

<span class="hljs-comment">// æµ‹è¯•è§¦å‘äº‹ä»¶çš„æ€§èƒ½</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">time</span>(<span class="hljs-string">'è§¦å‘äº‹ä»¶'</span>);
<span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; iterations; i++) {
    performanceEmitter.<span class="hljs-title function_">emit</span>(<span class="hljs-string">'performance'</span>, i);
}
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">timeEnd</span>(<span class="hljs-string">'è§¦å‘äº‹ä»¶'</span>);

<span class="hljs-comment">// æµ‹è¯•ç§»é™¤ç›‘å¬å™¨çš„æ€§èƒ½</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">time</span>(<span class="hljs-string">'ç§»é™¤ç›‘å¬å™¨'</span>);
<span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; iterations; i++) {
    performanceEmitter.<span class="hljs-title function_">off</span>(<span class="hljs-string">'performance'</span>, listeners[i % listeners.<span class="hljs-property">length</span>]);
}
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">timeEnd</span>(<span class="hljs-string">'ç§»é™¤ç›‘å¬å™¨'</span>);

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`ç§»é™¤åç›‘å¬å™¨æ•°é‡: <span class="hljs-subst">${performanceEmitter.listenerCount(<span class="hljs-string">'performance'</span>)}</span>`</span>);
</code></pre>
<h4 data-id="heading-15">äº”ã€EventEmitterçš„æ ¸å¿ƒåŸç†åˆ†æ</h4>
<h5 data-id="heading-16">51 æ•°æ®ç»“æ„è®¾è®¡</h5>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// EventEmitter çš„æ ¸å¿ƒæ•°æ®ç»“æ„</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">EventEmitter</span> {
    <span class="hljs-title function_">constructor</span>(<span class="hljs-params"/>) {
        <span class="hljs-comment">// ä½¿ç”¨æ™®é€šå¯¹è±¡è€Œä¸æ˜¯ Map çš„åŸå› ï¼š</span>
        <span class="hljs-comment">// 1. åœ¨ V8 ä¸­ï¼Œæ™®é€šå¯¹è±¡æ€§èƒ½æ›´å¥½</span>
        <span class="hljs-comment">// 2. äº‹ä»¶åé€šå¸¸æ˜¯å­—ç¬¦ä¸²ï¼Œé€‚åˆä½œä¸ºå¯¹è±¡é”®</span>
        <span class="hljs-comment">// 3. Object.create(null) åˆ›å»ºæ²¡æœ‰åŸå‹çš„å¯¹è±¡ï¼Œé¿å…åŸå‹æ±¡æŸ“</span>
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">_events</span> = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">create</span>(<span class="hljs-literal">null</span>);
        
        <span class="hljs-comment">// æ¯ä¸ªäº‹ä»¶å¯¹åº”ä¸€ä¸ªç›‘å¬å™¨æ•°ç»„</span>
        <span class="hljs-comment">// {</span>
        <span class="hljs-comment">//   'event1': [listener1, listener2, ...],</span>
        <span class="hljs-comment">//   'event2': [listener3, listener4, ...]</span>
        <span class="hljs-comment">// }</span>
    }
}
</code></pre>
<h5 data-id="heading-17">5.2 once æ–¹æ³•çš„å®ç°åŸç†</h5>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// once æ–¹æ³•çš„å®ç°ç»†èŠ‚</span>
<span class="hljs-title function_">once</span>(<span class="hljs-params">eventName, listener</span>) {
    <span class="hljs-comment">// åˆ›å»ºåŒ…è£…å‡½æ•°</span>
    <span class="hljs-keyword">const</span> <span class="hljs-title function_">onceWrapper</span> = (<span class="hljs-params">...args</span>) =&gt; {
        <span class="hljs-comment">// 1. æ‰§è¡ŒåŸå§‹ç›‘å¬å™¨</span>
        listener.<span class="hljs-title function_">apply</span>(<span class="hljs-variable language_">this</span>, args);
        
        <span class="hljs-comment">// 2. æ ‡è®°ä¸ºå·²æ‰§è¡Œ</span>
        onceWrapper.<span class="hljs-property">_once</span> = <span class="hljs-literal">true</span>;
        
        <span class="hljs-comment">// 3. åœ¨ emit ä¸­æ£€æµ‹åˆ°è¿™ä¸ªæ ‡è®°åä¼šç§»é™¤ç›‘å¬å™¨</span>
    };
    
    <span class="hljs-comment">// ä¿å­˜åŸå§‹ç›‘å¬å™¨å¼•ç”¨ï¼Œç”¨äº off æ–¹æ³•</span>
    onceWrapper.<span class="hljs-property">_originalListener</span> = listener;
    
    <span class="hljs-comment">// æ·»åŠ åˆ°ç›‘å¬å™¨æ•°ç»„</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_addListener</span>(eventName, onceWrapper, <span class="hljs-literal">false</span>);
    
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>;
}

<span class="hljs-comment">// emit æ–¹æ³•ä¸­å¤„ç† once ç›‘å¬å™¨</span>
<span class="hljs-title function_">emit</span>(<span class="hljs-params">eventName, ...args</span>) {
    <span class="hljs-comment">// ...</span>
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> listener <span class="hljs-keyword">of</span> listenersCopy) {
        <span class="hljs-comment">// æ£€æŸ¥æ˜¯å¦ä¸º once åŒ…è£…å‡½æ•°</span>
        <span class="hljs-keyword">if</span> (listener.<span class="hljs-property">_once</span>) {
            <span class="hljs-comment">// ç§»é™¤ç›‘å¬å™¨</span>
            <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_removeListener</span>(eventName, listener);
        }
        <span class="hljs-comment">// ...</span>
    }
    <span class="hljs-comment">// ...</span>
}
</code></pre>
<h5 data-id="heading-18">5.3 å†…å­˜ç®¡ç†ç­–ç•¥</h5>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// é¿å…å†…å­˜æ³„æ¼çš„å®ç°</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">SafeEventEmitter</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">EventEmitter</span> {
    <span class="hljs-title function_">constructor</span>(<span class="hljs-params"/>) {
        <span class="hljs-variable language_">super</span>();
        <span class="hljs-comment">// è·Ÿè¸ªæ‰€æœ‰è®¢é˜…ï¼Œä¾¿äºæ¸…ç†</span>
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">_subscriptions</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">WeakMap</span>();
    }
    
    <span class="hljs-title function_">safeOn</span>(<span class="hljs-params">eventName, listener, context = <span class="hljs-literal">null</span></span>) {
        <span class="hljs-comment">// ç»‘å®šä¸Šä¸‹æ–‡</span>
        <span class="hljs-keyword">const</span> boundListener = context ? listener.<span class="hljs-title function_">bind</span>(context) : listener;
        
        <span class="hljs-comment">// å­˜å‚¨å…ƒæ•°æ®</span>
        <span class="hljs-keyword">const</span> meta = {
            eventName,
            <span class="hljs-attr">originalListener</span>: listener,
            boundListener,
            <span class="hljs-attr">unsubscribe</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">off</span>(eventName, boundListener)
        };
        
        <span class="hljs-comment">// ä½¿ç”¨ WeakMap å­˜å‚¨ï¼Œä¸ä¼šé˜»æ­¢åƒåœ¾å›æ”¶</span>
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">_subscriptions</span>.<span class="hljs-title function_">set</span>(listener, meta);
        
        <span class="hljs-comment">// æ·»åŠ ç›‘å¬å™¨</span>
        <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">on</span>(eventName, boundListener);
        
        <span class="hljs-comment">// è¿”å›å¢å¼ºçš„å–æ¶ˆè®¢é˜…å‡½æ•°</span>
        <span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> {
            <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">off</span>(eventName, boundListener);
            <span class="hljs-variable language_">this</span>.<span class="hljs-property">_subscriptions</span>.<span class="hljs-title function_">delete</span>(listener);
        };
    }
}
</code></pre>
<h4 data-id="heading-19">å…­ã€å¸¸è§é¢è¯•é¢˜å®ç°</h4>
<h5 data-id="heading-20">6.1 å®ç°ä¸€ä¸ªç®€å•çš„ EventBus</h5>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// å…¨å±€äº‹ä»¶æ€»çº¿ï¼ˆç±»ä¼¼ Vue ä¸­çš„ EventBusï¼‰</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">EventBus</span> {
    <span class="hljs-title function_">constructor</span>(<span class="hljs-params"/>) {
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">_events</span> = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">create</span>(<span class="hljs-literal">null</span>);
    }
    
    <span class="hljs-comment">// å•ä¾‹æ¨¡å¼</span>
    <span class="hljs-keyword">static</span> <span class="hljs-title function_">getInstance</span>(<span class="hljs-params"/>) {
        <span class="hljs-keyword">if</span> (!<span class="hljs-title class_">EventBus</span>.<span class="hljs-property">_instance</span>) {
            <span class="hljs-title class_">EventBus</span>.<span class="hljs-property">_instance</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">EventBus</span>();
        }
        <span class="hljs-keyword">return</span> <span class="hljs-title class_">EventBus</span>.<span class="hljs-property">_instance</span>;
    }
    
    $on(event, callback) {
        <span class="hljs-keyword">if</span> (!<span class="hljs-variable language_">this</span>.<span class="hljs-property">_events</span>[event]) {
            <span class="hljs-variable language_">this</span>.<span class="hljs-property">_events</span>[event] = [];
        }
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">_events</span>[event].<span class="hljs-title function_">push</span>(callback);
    }
    
    $emit(event, ...args) {
        <span class="hljs-keyword">const</span> callbacks = <span class="hljs-variable language_">this</span>.<span class="hljs-property">_events</span>[event];
        <span class="hljs-keyword">if</span> (!callbacks) <span class="hljs-keyword">return</span>;
        
        <span class="hljs-comment">// ä½¿ç”¨ slice åˆ›å»ºå‰¯æœ¬ï¼Œé¿å…è¿­ä»£æ—¶ä¿®æ”¹æ•°ç»„</span>
        callbacks.<span class="hljs-title function_">slice</span>().<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">callback</span> =&gt;</span> {
            <span class="hljs-keyword">try</span> {
                <span class="hljs-title function_">callback</span>(...args);
            } <span class="hljs-keyword">catch</span> (error) {
                <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`EventBus error in <span class="hljs-subst">${event}</span>:`</span>, error);
            }
        });
    }
    
    $off(event, callback) {
        <span class="hljs-keyword">if</span> (!<span class="hljs-variable language_">this</span>.<span class="hljs-property">_events</span>[event]) <span class="hljs-keyword">return</span>;
        
        <span class="hljs-keyword">if</span> (callback) {
            <span class="hljs-keyword">const</span> index = <span class="hljs-variable language_">this</span>.<span class="hljs-property">_events</span>[event].<span class="hljs-title function_">indexOf</span>(callback);
            <span class="hljs-keyword">if</span> (index &gt; -<span class="hljs-number">1</span>) {
                <span class="hljs-variable language_">this</span>.<span class="hljs-property">_events</span>[event].<span class="hljs-title function_">splice</span>(index, <span class="hljs-number">1</span>);
            }
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-keyword">delete</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">_events</span>[event];
        }
    }
    
    $once(event, callback) {
        <span class="hljs-keyword">const</span> <span class="hljs-title function_">onceWrapper</span> = (<span class="hljs-params">...args</span>) =&gt; {
            <span class="hljs-title function_">callback</span>(...args);
            <span class="hljs-variable language_">this</span>.$off(event, onceWrapper);
        };
        <span class="hljs-variable language_">this</span>.$on(event, onceWrapper);
    }
}

<span class="hljs-comment">// ä½¿ç”¨ç¤ºä¾‹</span>
<span class="hljs-keyword">const</span> bus = <span class="hljs-title class_">EventBus</span>.<span class="hljs-title function_">getInstance</span>();

<span class="hljs-comment">// ç»„ä»¶ A</span>
bus.$on(<span class="hljs-string">'user-login'</span>, <span class="hljs-function">(<span class="hljs-params">user</span>) =&gt;</span> {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'ç»„ä»¶A: ç”¨æˆ·ç™»å½•'</span>, user.<span class="hljs-property">name</span>);
});

<span class="hljs-comment">// ç»„ä»¶ B</span>
bus.$on(<span class="hljs-string">'user-login'</span>, <span class="hljs-function">(<span class="hljs-params">user</span>) =&gt;</span> {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'ç»„ä»¶B: æ›´æ–°ç”¨æˆ·ä¿¡æ¯'</span>, user.<span class="hljs-property">id</span>);
});

<span class="hljs-comment">// ç™»å½•æˆåŠŸå</span>
bus.$emit(<span class="hljs-string">'user-login'</span>, { <span class="hljs-attr">id</span>: <span class="hljs-number">1</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'Alice'</span> });
</code></pre>
<h5 data-id="heading-21">6.2 å®ç°å¸¦å‘½åç©ºé—´çš„äº‹ä»¶ç³»ç»Ÿ</h5>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">NamespacedEventEmitter</span> {
    <span class="hljs-title function_">constructor</span>(<span class="hljs-params"/>) {
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">_events</span> = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">create</span>(<span class="hljs-literal">null</span>);
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">_separator</span> = <span class="hljs-string">':'</span>;
    }
    
    <span class="hljs-comment">// è§£æäº‹ä»¶åï¼Œæ”¯æŒå‘½åç©ºé—´</span>
    <span class="hljs-title function_">_parseEvent</span>(<span class="hljs-params">eventString</span>) {
        <span class="hljs-keyword">const</span> parts = eventString.<span class="hljs-title function_">split</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">_separator</span>);
        <span class="hljs-keyword">if</span> (parts.<span class="hljs-property">length</span> === <span class="hljs-number">1</span>) {
            <span class="hljs-keyword">return</span> { <span class="hljs-attr">namespace</span>: <span class="hljs-literal">null</span>, <span class="hljs-attr">event</span>: parts[<span class="hljs-number">0</span>] };
        }
        <span class="hljs-keyword">return</span> { <span class="hljs-attr">namespace</span>: parts[<span class="hljs-number">0</span>], <span class="hljs-attr">event</span>: parts.<span class="hljs-title function_">slice</span>(<span class="hljs-number">1</span>).<span class="hljs-title function_">join</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">_separator</span>) };
    }
    
    <span class="hljs-comment">// ç”Ÿæˆå®Œæ•´çš„äº‹ä»¶é”®</span>
    <span class="hljs-title function_">_getEventKey</span>(<span class="hljs-params">namespace, event</span>) {
        <span class="hljs-keyword">return</span> namespace ? <span class="hljs-string">`<span class="hljs-subst">${namespace}</span><span class="hljs-subst">${<span class="hljs-variable language_">this</span>._separator}</span><span class="hljs-subst">${event}</span>`</span> : event;
    }
    
    <span class="hljs-title function_">on</span>(<span class="hljs-params">eventString, listener</span>) {
        <span class="hljs-keyword">const</span> { namespace, event } = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_parseEvent</span>(eventString);
        <span class="hljs-keyword">const</span> eventKey = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_getEventKey</span>(namespace, event);
        
        <span class="hljs-keyword">if</span> (!<span class="hljs-variable language_">this</span>.<span class="hljs-property">_events</span>[eventKey]) {
            <span class="hljs-variable language_">this</span>.<span class="hljs-property">_events</span>[eventKey] = [];
        }
        
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">_events</span>[eventKey].<span class="hljs-title function_">push</span>({
            listener,
            namespace,
            event
        });
        
        <span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">off</span>(eventString, listener);
    }
    
    <span class="hljs-title function_">emit</span>(<span class="hljs-params">eventString, ...args</span>) {
        <span class="hljs-keyword">const</span> { namespace, event } = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_parseEvent</span>(eventString);
        
        <span class="hljs-comment">// æ”¶é›†æ‰€æœ‰åŒ¹é…çš„ç›‘å¬å™¨</span>
        <span class="hljs-keyword">const</span> listenersToCall = [];
        
        <span class="hljs-comment">// å¦‚æœæŒ‡å®šäº†å‘½åç©ºé—´ï¼Œåªè§¦å‘è¯¥å‘½åç©ºé—´çš„äº‹ä»¶</span>
        <span class="hljs-keyword">if</span> (namespace) {
            <span class="hljs-keyword">const</span> eventKey = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_getEventKey</span>(namespace, event);
            <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">_events</span>[eventKey]) {
                listenersToCall.<span class="hljs-title function_">push</span>(...<span class="hljs-variable language_">this</span>.<span class="hljs-property">_events</span>[eventKey]);
            }
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-comment">// å¦‚æœæ²¡æœ‰æŒ‡å®šå‘½åç©ºé—´ï¼Œè§¦å‘æ‰€æœ‰åŒ¹é…çš„äº‹ä»¶</span>
            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> eventKey <span class="hljs-keyword">in</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">_events</span>) {
                <span class="hljs-keyword">const</span> listeners = <span class="hljs-variable language_">this</span>.<span class="hljs-property">_events</span>[eventKey];
                <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> listenerInfo <span class="hljs-keyword">of</span> listeners) {
                    <span class="hljs-keyword">if</span> (listenerInfo.<span class="hljs-property">event</span> === event) {
                        listenersToCall.<span class="hljs-title function_">push</span>(listenerInfo);
                    }
                }
            }
        }
        
        <span class="hljs-comment">// æ‰§è¡Œç›‘å¬å™¨</span>
        listenersToCall.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">{ listener }</span>) =&gt;</span> {
            <span class="hljs-keyword">try</span> {
                <span class="hljs-title function_">listener</span>(...args);
            } <span class="hljs-keyword">catch</span> (error) {
                <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`Error in <span class="hljs-subst">${eventString}</span>:`</span>, error);
            }
        });
    }
    
    <span class="hljs-title function_">off</span>(<span class="hljs-params">eventString, listener</span>) {
        <span class="hljs-keyword">const</span> { namespace, event } = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_parseEvent</span>(eventString);
        
        <span class="hljs-keyword">if</span> (namespace) {
            <span class="hljs-keyword">const</span> eventKey = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_getEventKey</span>(namespace, event);
            <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">_events</span>[eventKey]) {
                <span class="hljs-keyword">const</span> listeners = <span class="hljs-variable language_">this</span>.<span class="hljs-property">_events</span>[eventKey];
                <span class="hljs-keyword">const</span> index = listeners.<span class="hljs-title function_">findIndex</span>(<span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span> item.<span class="hljs-property">listener</span> === listener);
                <span class="hljs-keyword">if</span> (index &gt; -<span class="hljs-number">1</span>) {
                    listeners.<span class="hljs-title function_">splice</span>(index, <span class="hljs-number">1</span>);
                    <span class="hljs-keyword">if</span> (listeners.<span class="hljs-property">length</span> === <span class="hljs-number">0</span>) {
                        <span class="hljs-keyword">delete</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">_events</span>[eventKey];
                    }
                }
            }
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-comment">// ç§»é™¤æ‰€æœ‰å‘½åç©ºé—´ä¸‹çš„äº‹ä»¶</span>
            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> eventKey <span class="hljs-keyword">in</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">_events</span>) {
                <span class="hljs-keyword">const</span> listeners = <span class="hljs-variable language_">this</span>.<span class="hljs-property">_events</span>[eventKey];
                <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = listeners.<span class="hljs-property">length</span> - <span class="hljs-number">1</span>; i &gt;= <span class="hljs-number">0</span>; i--) {
                    <span class="hljs-keyword">if</span> (listeners[i].<span class="hljs-property">listener</span> === listener &amp;&amp; listeners[i].<span class="hljs-property">event</span> === event) {
                        listeners.<span class="hljs-title function_">splice</span>(i, <span class="hljs-number">1</span>);
                    }
                }
                <span class="hljs-keyword">if</span> (listeners.<span class="hljs-property">length</span> === <span class="hljs-number">0</span>) {
                    <span class="hljs-keyword">delete</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">_events</span>[eventKey];
                }
            }
        }
    }
}

<span class="hljs-comment">// ä½¿ç”¨ç¤ºä¾‹</span>
<span class="hljs-keyword">const</span> nsEmitter = <span class="hljs-keyword">new</span> <span class="hljs-title class_">NamespacedEventEmitter</span>();

nsEmitter.<span class="hljs-title function_">on</span>(<span class="hljs-string">'user:login'</span>, <span class="hljs-function">() =&gt;</span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'ç”¨æˆ·æ¨¡å—: ç™»å½•'</span>));
nsEmitter.<span class="hljs-title function_">on</span>(<span class="hljs-string">'admin:login'</span>, <span class="hljs-function">() =&gt;</span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'ç®¡ç†å‘˜æ¨¡å—: ç™»å½•'</span>));
nsEmitter.<span class="hljs-title function_">on</span>(<span class="hljs-string">'login'</span>, <span class="hljs-function">() =&gt;</span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'å…¨å±€: ç™»å½•'</span>));

nsEmitter.<span class="hljs-title function_">emit</span>(<span class="hljs-string">'user:login'</span>);    <span class="hljs-comment">// åªè¾“å‡º: ç”¨æˆ·æ¨¡å—: ç™»å½•</span>
nsEmitter.<span class="hljs-title function_">emit</span>(<span class="hljs-string">'admin:login'</span>);   <span class="hljs-comment">// åªè¾“å‡º: ç®¡ç†å‘˜æ¨¡å—: ç™»å½•</span>
nsEmitter.<span class="hljs-title function_">emit</span>(<span class="hljs-string">'login'</span>);         <span class="hljs-comment">// è¾“å‡ºæ‰€æœ‰</span>
</code></pre>
<h5 data-id="heading-22">6.3 å®ç°æ”¯æŒå¼‚æ­¥ç›‘å¬å™¨çš„ EventEmitter</h5>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">AsyncEventEmitter</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">EventEmitter</span> {
    <span class="hljs-comment">/**
     * å¼‚æ­¥è§¦å‘äº‹ä»¶ï¼Œç­‰å¾…æ‰€æœ‰ç›‘å¬å™¨å®Œæˆ
     */</span>
    <span class="hljs-keyword">async</span> <span class="hljs-title function_">emitAsync</span>(<span class="hljs-params">eventName, ...args</span>) {
        <span class="hljs-keyword">const</span> listeners = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">listeners</span>(eventName);
        <span class="hljs-keyword">if</span> (listeners.<span class="hljs-property">length</span> === <span class="hljs-number">0</span>) {
            <span class="hljs-keyword">return</span>;
        }
        
        <span class="hljs-comment">// å¹¶è¡Œæ‰§è¡Œæ‰€æœ‰ç›‘å¬å™¨</span>
        <span class="hljs-keyword">const</span> promises = listeners.<span class="hljs-title function_">map</span>(<span class="hljs-keyword">async</span> (listener) =&gt; {
            <span class="hljs-keyword">try</span> {
                <span class="hljs-keyword">const</span> result = <span class="hljs-title function_">listener</span>(...args);
                <span class="hljs-comment">// å¦‚æœç›‘å¬å™¨è¿”å› Promiseï¼Œç­‰å¾…å®ƒå®Œæˆ</span>
                <span class="hljs-keyword">if</span> (result &amp;&amp; <span class="hljs-keyword">typeof</span> result.<span class="hljs-property">then</span> === <span class="hljs-string">'function'</span>) {
                    <span class="hljs-keyword">await</span> result;
                }
            } <span class="hljs-keyword">catch</span> (error) {
                <span class="hljs-keyword">if</span> (eventName !== <span class="hljs-string">'error'</span>) {
                    <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">emitAsync</span>(<span class="hljs-string">'error'</span>, error);
                } <span class="hljs-keyword">else</span> {
                    <span class="hljs-keyword">throw</span> error;
                }
            }
        });
        
        <span class="hljs-keyword">await</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">all</span>(promises);
    }
    
    <span class="hljs-comment">/**
     * é¡ºåºæ‰§è¡Œç›‘å¬å™¨ï¼ˆä¸€ä¸ªæ¥ä¸€ä¸ªï¼‰
     */</span>
    <span class="hljs-keyword">async</span> <span class="hljs-title function_">emitSeries</span>(<span class="hljs-params">eventName, ...args</span>) {
        <span class="hljs-keyword">const</span> listeners = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">listeners</span>(eventName);
        
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> listener <span class="hljs-keyword">of</span> listeners) {
            <span class="hljs-keyword">try</span> {
                <span class="hljs-keyword">const</span> result = <span class="hljs-title function_">listener</span>(...args);
                <span class="hljs-comment">// å¦‚æœç›‘å¬å™¨è¿”å› Promiseï¼Œç­‰å¾…å®ƒå®Œæˆ</span>
                <span class="hljs-keyword">if</span> (result &amp;&amp; <span class="hljs-keyword">typeof</span> result.<span class="hljs-property">then</span> === <span class="hljs-string">'function'</span>) {
                    <span class="hljs-keyword">await</span> result;
                }
            } <span class="hljs-keyword">catch</span> (error) {
                <span class="hljs-keyword">if</span> (eventName !== <span class="hljs-string">'error'</span>) {
                    <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">emitSeries</span>(<span class="hljs-string">'error'</span>, error);
                } <span class="hljs-keyword">else</span> {
                    <span class="hljs-keyword">throw</span> error;
                }
            }
        }
    }
}

<span class="hljs-comment">// ä½¿ç”¨ç¤ºä¾‹</span>
<span class="hljs-keyword">const</span> asyncEmitter = <span class="hljs-keyword">new</span> <span class="hljs-title class_">AsyncEventEmitter</span>();

asyncEmitter.<span class="hljs-title function_">on</span>(<span class="hljs-string">'process'</span>, <span class="hljs-keyword">async</span> (data) =&gt; {
    <span class="hljs-keyword">await</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function"><span class="hljs-params">resolve</span> =&gt;</span> <span class="hljs-built_in">setTimeout</span>(resolve, <span class="hljs-number">100</span>));
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'å¤„ç†å®Œæˆ:'</span>, data);
});

asyncEmitter.<span class="hljs-title function_">on</span>(<span class="hljs-string">'process'</span>, <span class="hljs-keyword">async</span> (data) =&gt; {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'ç¬¬äºŒä¸ªç›‘å¬å™¨:'</span>, data);
});

asyncEmitter.<span class="hljs-title function_">emitAsync</span>(<span class="hljs-string">'process'</span>, <span class="hljs-string">'æµ‹è¯•æ•°æ®'</span>);
</code></pre>
<h5 data-id="heading-23">6.5 å®ç°æ”¯æŒä¼˜å…ˆçº§çš„ EventEmitter</h5>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">PriorityEventEmitter</span> {
    <span class="hljs-title function_">constructor</span>(<span class="hljs-params"/>) {
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">_events</span> = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">create</span>(<span class="hljs-literal">null</span>);
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">_defaultPriority</span> = <span class="hljs-number">0</span>;
    }
    
    <span class="hljs-title function_">on</span>(<span class="hljs-params">eventName, listener, priority = <span class="hljs-variable language_">this</span>._defaultPriority</span>) {
        <span class="hljs-keyword">if</span> (!<span class="hljs-variable language_">this</span>.<span class="hljs-property">_events</span>[eventName]) {
            <span class="hljs-variable language_">this</span>.<span class="hljs-property">_events</span>[eventName] = [];
        }
        
        <span class="hljs-keyword">const</span> listeners = <span class="hljs-variable language_">this</span>.<span class="hljs-property">_events</span>[eventName];
        listeners.<span class="hljs-title function_">push</span>({ listener, priority });
        
        <span class="hljs-comment">// æŒ‰ä¼˜å…ˆçº§æ’åºï¼ˆæ•°å­—è¶Šå°ä¼˜å…ˆçº§è¶Šé«˜ï¼‰</span>
        listeners.<span class="hljs-title function_">sort</span>(<span class="hljs-function">(<span class="hljs-params">a, b</span>) =&gt;</span> a.<span class="hljs-property">priority</span> - b.<span class="hljs-property">priority</span>);
        
        <span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">off</span>(eventName, listener);
    }
    
    <span class="hljs-title function_">emit</span>(<span class="hljs-params">eventName, ...args</span>) {
        <span class="hljs-keyword">const</span> listeners = <span class="hljs-variable language_">this</span>.<span class="hljs-property">_events</span>[eventName];
        <span class="hljs-keyword">if</span> (!listeners) <span class="hljs-keyword">return</span>;
        
        <span class="hljs-comment">// éå†å·²æ’åºçš„ç›‘å¬å™¨</span>
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> { listener } <span class="hljs-keyword">of</span> listeners) {
            <span class="hljs-keyword">try</span> {
                <span class="hljs-keyword">const</span> result = <span class="hljs-title function_">listener</span>(...args);
                <span class="hljs-comment">// å¦‚æœç›‘å¬å™¨è¿”å› falseï¼Œåœæ­¢åç»­ç›‘å¬å™¨çš„æ‰§è¡Œ</span>
                <span class="hljs-keyword">if</span> (result === <span class="hljs-literal">false</span>) {
                    <span class="hljs-keyword">break</span>;
                }
            } <span class="hljs-keyword">catch</span> (error) {
                <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`Error in <span class="hljs-subst">${eventName}</span>:`</span>, error);
            }
        }
    }
    
    <span class="hljs-title function_">off</span>(<span class="hljs-params">eventName, listener</span>) {
        <span class="hljs-keyword">const</span> listeners = <span class="hljs-variable language_">this</span>.<span class="hljs-property">_events</span>[eventName];
        <span class="hljs-keyword">if</span> (!listeners) <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>;
        
        <span class="hljs-keyword">const</span> index = listeners.<span class="hljs-title function_">findIndex</span>(<span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span> item.<span class="hljs-property">listener</span> === listener);
        <span class="hljs-keyword">if</span> (index &gt; -<span class="hljs-number">1</span>) {
            listeners.<span class="hljs-title function_">splice</span>(index, <span class="hljs-number">1</span>);
            <span class="hljs-keyword">if</span> (listeners.<span class="hljs-property">length</span> === <span class="hljs-number">0</span>) {
                <span class="hljs-keyword">delete</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">_events</span>[eventName];
            }
        }
        
        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>;
    }
}

<span class="hljs-comment">// ä½¿ç”¨ç¤ºä¾‹</span>
<span class="hljs-keyword">const</span> priorityEmitter = <span class="hljs-keyword">new</span> <span class="hljs-title class_">PriorityEventEmitter</span>();

priorityEmitter.<span class="hljs-title function_">on</span>(<span class="hljs-string">'process'</span>, <span class="hljs-function">() =&gt;</span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'ä¼˜å…ˆçº§ 10'</span>), <span class="hljs-number">10</span>);
priorityEmitter.<span class="hljs-title function_">on</span>(<span class="hljs-string">'process'</span>, <span class="hljs-function">() =&gt;</span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'ä¼˜å…ˆçº§ 0'</span>), <span class="hljs-number">0</span>);
priorityEmitter.<span class="hljs-title function_">on</span>(<span class="hljs-string">'process'</span>, <span class="hljs-function">() =&gt;</span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'ä¼˜å…ˆçº§ 5'</span>), <span class="hljs-number">5</span>);

priorityEmitter.<span class="hljs-title function_">emit</span>(<span class="hljs-string">'process'</span>);
<span class="hljs-comment">// è¾“å‡ºé¡ºåº: ä¼˜å…ˆçº§ 0, ä¼˜å…ˆçº§ 5, ä¼˜å…ˆçº§ 10</span>
</code></pre>
<h4 data-id="heading-24">ä¸ƒã€å®é™…åº”ç”¨åœºæ™¯</h4>
<h5 data-id="heading-25">7.1 åœ¨ Vue ä¸­å®ç°ç»„ä»¶é€šä¿¡</h5>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// å…¨å±€äº‹ä»¶æ€»çº¿</span>
<span class="hljs-keyword">const</span> <span class="hljs-title class_">EventBus</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">EventEmitter</span>();

<span class="hljs-comment">// åœ¨ Vue ç»„ä»¶ä¸­ä½¿ç”¨</span>
<span class="hljs-comment">// ComponentA.vue</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {
    <span class="hljs-title function_">mounted</span>(<span class="hljs-params"/>) {
        <span class="hljs-title class_">EventBus</span>.<span class="hljs-title function_">on</span>(<span class="hljs-string">'user-updated'</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">handleUserUpdate</span>);
    },
    <span class="hljs-attr">methods</span>: {
        <span class="hljs-title function_">handleUserUpdate</span>(<span class="hljs-params">user</span>) {
            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'ç”¨æˆ·æ›´æ–°:'</span>, user);
            <span class="hljs-variable language_">this</span>.<span class="hljs-property">user</span> = user;
        }
    },
    <span class="hljs-title function_">beforeDestroy</span>(<span class="hljs-params"/>) {
        <span class="hljs-title class_">EventBus</span>.<span class="hljs-title function_">off</span>(<span class="hljs-string">'user-updated'</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">handleUserUpdate</span>);
    }
};

<span class="hljs-comment">// ComponentB.vue</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {
    <span class="hljs-attr">methods</span>: {
        <span class="hljs-title function_">updateUser</span>(<span class="hljs-params"/>) {
            <span class="hljs-title class_">EventBus</span>.<span class="hljs-title function_">emit</span>(<span class="hljs-string">'user-updated'</span>, { <span class="hljs-attr">id</span>: <span class="hljs-number">1</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'John'</span> });
        }
    }
};

<span class="hljs-comment">// æˆ–è€…åœ¨ Vue åŸå‹ä¸Šæ·»åŠ </span>
<span class="hljs-title class_">Vue</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">$bus</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">EventEmitter</span>();

<span class="hljs-comment">// åœ¨ç»„ä»¶ä¸­ä½¿ç”¨</span>
<span class="hljs-variable language_">this</span>.<span class="hljs-property">$bus</span>.<span class="hljs-title function_">on</span>(<span class="hljs-string">'event'</span>, handler);
<span class="hljs-variable language_">this</span>.<span class="hljs-property">$bus</span>.<span class="hljs-title function_">emit</span>(<span class="hljs-string">'event'</span>, data);
<span class="hljs-variable language_">this</span>.<span class="hljs-property">$bus</span>.<span class="hljs-title function_">off</span>(<span class="hljs-string">'event'</span>, handler);
</code></pre>
<h5 data-id="heading-26">7.2 åœ¨ Express ä¸­å®ç°äº‹ä»¶é©±åŠ¨æ¶æ„</h5>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> express = <span class="hljs-built_in">require</span>(<span class="hljs-string">'express'</span>);
<span class="hljs-keyword">const</span> <span class="hljs-title class_">EventEmitter</span> = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./EventEmitter'</span>);

<span class="hljs-keyword">class</span> <span class="hljs-title class_">AppEvents</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">EventEmitter</span> {
    <span class="hljs-title function_">constructor</span>(<span class="hljs-params"/>) {
        <span class="hljs-variable language_">super</span>();
        <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">setupEvents</span>();
    }
    
    <span class="hljs-title function_">setupEvents</span>(<span class="hljs-params"/>) {
        <span class="hljs-comment">// å®šä¹‰åº”ç”¨çº§åˆ«äº‹ä»¶</span>
        <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">on</span>(<span class="hljs-string">'user:registered'</span>, <span class="hljs-function">(<span class="hljs-params">user</span>) =&gt;</span> {
            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'æ–°ç”¨æˆ·æ³¨å†Œ:'</span>, user.<span class="hljs-property">email</span>);
            <span class="hljs-comment">// å‘é€æ¬¢è¿é‚®ä»¶</span>
            <span class="hljs-comment">// åˆ›å»ºç”¨æˆ·ç›®å½•</span>
            <span class="hljs-comment">// æ›´æ–°ç»Ÿè®¡</span>
        });
        
        <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">on</span>(<span class="hljs-string">'order:created'</span>, <span class="hljs-function">(<span class="hljs-params">order</span>) =&gt;</span> {
            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'æ–°è®¢å•:'</span>, order.<span class="hljs-property">id</span>);
            <span class="hljs-comment">// å‘é€ç¡®è®¤é‚®ä»¶</span>
            <span class="hljs-comment">// æ›´æ–°åº“å­˜</span>
            <span class="hljs-comment">// é€šçŸ¥ç‰©æµ</span>
        });
        
        <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">on</span>(<span class="hljs-string">'error'</span>, <span class="hljs-function">(<span class="hljs-params">error, context</span>) =&gt;</span> {
            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'åº”ç”¨é”™è¯¯:'</span>, error.<span class="hljs-property">message</span>, context);
            <span class="hljs-comment">// å‘é€é”™è¯¯æŠ¥å‘Š</span>
            <span class="hljs-comment">// è®°å½•åˆ°ç›‘æ§ç³»ç»Ÿ</span>
        });
    }
}

<span class="hljs-comment">// åˆ›å»º Express åº”ç”¨</span>
<span class="hljs-keyword">const</span> appEvents = <span class="hljs-keyword">new</span> <span class="hljs-title class_">AppEvents</span>();
<span class="hljs-keyword">const</span> app = <span class="hljs-title function_">express</span>();

<span class="hljs-comment">// ä¸­é—´ä»¶ï¼šå°†äº‹ä»¶å‘å°„å™¨æ·»åŠ åˆ°è¯·æ±‚å¯¹è±¡</span>
app.<span class="hljs-title function_">use</span>(<span class="hljs-function">(<span class="hljs-params">req, res, next</span>) =&gt;</span> {
    req.<span class="hljs-property">appEvents</span> = appEvents;
    <span class="hljs-title function_">next</span>();
});

<span class="hljs-comment">// è·¯ç”±å¤„ç†</span>
app.<span class="hljs-title function_">post</span>(<span class="hljs-string">'/register'</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> {
    <span class="hljs-keyword">const</span> user = <span class="hljs-title function_">createUser</span>(req.<span class="hljs-property">body</span>);
    
    <span class="hljs-comment">// è§¦å‘äº‹ä»¶</span>
    req.<span class="hljs-property">appEvents</span>.<span class="hljs-title function_">emit</span>(<span class="hljs-string">'user:registered'</span>, user);
    
    res.<span class="hljs-title function_">json</span>({ <span class="hljs-attr">success</span>: <span class="hljs-literal">true</span>, user });
});

app.<span class="hljs-title function_">post</span>(<span class="hljs-string">'/order'</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> {
    <span class="hljs-keyword">const</span> order = <span class="hljs-title function_">createOrder</span>(req.<span class="hljs-property">body</span>);
    
    <span class="hljs-comment">// è§¦å‘äº‹ä»¶</span>
    req.<span class="hljs-property">appEvents</span>.<span class="hljs-title function_">emit</span>(<span class="hljs-string">'order:created'</span>, order);
    
    res.<span class="hljs-title function_">json</span>({ <span class="hljs-attr">success</span>: <span class="hljs-literal">true</span>, order });
});

<span class="hljs-comment">// é”™è¯¯å¤„ç†ä¸­é—´ä»¶</span>
app.<span class="hljs-title function_">use</span>(<span class="hljs-function">(<span class="hljs-params">error, req, res, next</span>) =&gt;</span> {
    <span class="hljs-comment">// è§¦å‘é”™è¯¯äº‹ä»¶</span>
    req.<span class="hljs-property">appEvents</span>.<span class="hljs-title function_">emit</span>(<span class="hljs-string">'error'</span>, error, {
        <span class="hljs-attr">url</span>: req.<span class="hljs-property">url</span>,
        <span class="hljs-attr">method</span>: req.<span class="hljs-property">method</span>,
        <span class="hljs-attr">userId</span>: req.<span class="hljs-property">user</span>?.<span class="hljs-property">id</span>
    });
    
    res.<span class="hljs-title function_">status</span>(<span class="hljs-number">500</span>).<span class="hljs-title function_">json</span>({ <span class="hljs-attr">error</span>: <span class="hljs-string">'Internal server error'</span> });
});
</code></pre>
<h5 data-id="heading-27">7.3 å®ç°ç®€å•çš„çŠ¶æ€ç®¡ç†</h5>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">ObservableStore</span> {
    <span class="hljs-title function_">constructor</span>(<span class="hljs-params">initialState = {}</span>) {
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">_state</span> = initialState;
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">_prevState</span> = <span class="hljs-literal">null</span>;
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">_emitter</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">EventEmitter</span>();
    }
    
    <span class="hljs-comment">// è·å–å½“å‰çŠ¶æ€</span>
    <span class="hljs-title function_">getState</span>(<span class="hljs-params"/>) {
        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">_state</span>;
    }
    
    <span class="hljs-comment">// è®¾ç½®çŠ¶æ€</span>
    <span class="hljs-title function_">setState</span>(<span class="hljs-params">updates</span>) {
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">_prevState</span> = { ...<span class="hljs-variable language_">this</span>.<span class="hljs-property">_state</span> };
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">_state</span> = { ...<span class="hljs-variable language_">this</span>.<span class="hljs-property">_state</span>, ...updates };
        
        <span class="hljs-comment">// è§¦å‘çŠ¶æ€å˜åŒ–äº‹ä»¶</span>
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">_emitter</span>.<span class="hljs-title function_">emit</span>(<span class="hljs-string">'state:changed'</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">_state</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">_prevState</span>);
        
        <span class="hljs-comment">// è§¦å‘ç‰¹å®šå±æ€§çš„å˜åŒ–äº‹ä»¶</span>
        <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">keys</span>(updates).<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">key</span> =&gt;</span> {
            <span class="hljs-variable language_">this</span>.<span class="hljs-property">_emitter</span>.<span class="hljs-title function_">emit</span>(<span class="hljs-string">`state:<span class="hljs-subst">${key}</span>:changed`</span>, updates[key], <span class="hljs-variable language_">this</span>.<span class="hljs-property">_prevState</span>[key]);
        });
    }
    
    <span class="hljs-comment">// è®¢é˜…çŠ¶æ€å˜åŒ–</span>
    <span class="hljs-title function_">subscribe</span>(<span class="hljs-params">callback</span>) {
        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">_emitter</span>.<span class="hljs-title function_">on</span>(<span class="hljs-string">'state:changed'</span>, callback);
    }
    
    <span class="hljs-comment">// è®¢é˜…ç‰¹å®šçŠ¶æ€å˜åŒ–</span>
    <span class="hljs-title function_">subscribeTo</span>(<span class="hljs-params">key, callback</span>) {
        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">_emitter</span>.<span class="hljs-title function_">on</span>(<span class="hljs-string">`state:<span class="hljs-subst">${key}</span>:changed`</span>, callback);
    }
    
    <span class="hljs-comment">// æ‰¹é‡æ›´æ–°</span>
    <span class="hljs-title function_">batchUpdate</span>(<span class="hljs-params">updater</span>) {
        <span class="hljs-keyword">const</span> updates = <span class="hljs-title function_">updater</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">_state</span>);
        <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">setState</span>(updates);
    }
}

<span class="hljs-comment">// ä½¿ç”¨ç¤ºä¾‹</span>
<span class="hljs-keyword">const</span> store = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObservableStore</span>({
    <span class="hljs-attr">user</span>: <span class="hljs-literal">null</span>,
    <span class="hljs-attr">theme</span>: <span class="hljs-string">'light'</span>,
    <span class="hljs-attr">notifications</span>: []
});

<span class="hljs-comment">// è®¢é˜…çŠ¶æ€å˜åŒ–</span>
store.<span class="hljs-title function_">subscribe</span>(<span class="hljs-function">(<span class="hljs-params">newState, oldState</span>) =&gt;</span> {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'çŠ¶æ€å˜åŒ–:'</span>, newState);
});

<span class="hljs-comment">// è®¢é˜…ç‰¹å®šçŠ¶æ€å˜åŒ–</span>
store.<span class="hljs-title function_">subscribeTo</span>(<span class="hljs-string">'theme'</span>, <span class="hljs-function">(<span class="hljs-params">newTheme, oldTheme</span>) =&gt;</span> {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'ä¸»é¢˜å˜åŒ–:'</span>, oldTheme, <span class="hljs-string">'-&gt;'</span>, newTheme);
    <span class="hljs-variable language_">document</span>.<span class="hljs-property">body</span>.<span class="hljs-title function_">setAttribute</span>(<span class="hljs-string">'data-theme'</span>, newTheme);
});

<span class="hljs-comment">// æ›´æ–°çŠ¶æ€</span>
store.<span class="hljs-title function_">setState</span>({ <span class="hljs-attr">theme</span>: <span class="hljs-string">'dark'</span> });
store.<span class="hljs-title function_">setState</span>({ <span class="hljs-attr">user</span>: { <span class="hljs-attr">id</span>: <span class="hljs-number">1</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'Alice'</span> } });

<span class="hljs-comment">// æ‰¹é‡æ›´æ–°</span>
store.<span class="hljs-title function_">batchUpdate</span>(<span class="hljs-function"><span class="hljs-params">state</span> =&gt;</span> ({
    <span class="hljs-attr">notifications</span>: [...state.<span class="hljs-property">notifications</span>, <span class="hljs-string">'æ–°æ¶ˆæ¯'</span>],
    <span class="hljs-attr">theme</span>: <span class="hljs-string">'dark'</span>
}));
</code></pre>
<h4 data-id="heading-28">å…«ã€æ€§èƒ½ä¼˜åŒ–å’Œæ³¨æ„äº‹é¡¹</h4>
<h5 data-id="heading-29">8.1 å†…å­˜æ³„æ¼é¢„é˜²</h5>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// å®‰å…¨çš„ EventEmitterï¼Œè‡ªåŠ¨æ¸…ç†è®¢é˜…</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">SafeEventEmitter</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">EventEmitter</span> {
    <span class="hljs-title function_">constructor</span>(<span class="hljs-params"/>) {
        <span class="hljs-variable language_">super</span>();
        <span class="hljs-comment">// ä½¿ç”¨ WeakRef è·Ÿè¸ªç»„ä»¶å¼•ç”¨</span>
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">_componentRefs</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">WeakMap</span>();
    }
    
    <span class="hljs-comment">// ä¸ºç»„ä»¶ç»‘å®šäº‹ä»¶ï¼Œè‡ªåŠ¨æ¸…ç†</span>
    <span class="hljs-title function_">bindToComponent</span>(<span class="hljs-params">component, eventName, listener</span>) {
        <span class="hljs-comment">// åˆ›å»ºç»‘å®šå‡½æ•°</span>
        <span class="hljs-keyword">const</span> boundListener = listener.<span class="hljs-title function_">bind</span>(component);
        
        <span class="hljs-comment">// æ·»åŠ ç›‘å¬å™¨</span>
        <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">on</span>(eventName, boundListener);
        
        <span class="hljs-comment">// å­˜å‚¨å¼•ç”¨</span>
        <span class="hljs-keyword">if</span> (!<span class="hljs-variable language_">this</span>.<span class="hljs-property">_componentRefs</span>.<span class="hljs-title function_">has</span>(component)) {
            <span class="hljs-variable language_">this</span>.<span class="hljs-property">_componentRefs</span>.<span class="hljs-title function_">set</span>(component, []);
        }
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">_componentRefs</span>.<span class="hljs-title function_">get</span>(component).<span class="hljs-title function_">push</span>({ eventName, <span class="hljs-attr">listener</span>: boundListener });
        
        <span class="hljs-comment">// è¿”å›æ¸…ç†å‡½æ•°</span>
        <span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> {
            <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">off</span>(eventName, boundListener);
            <span class="hljs-keyword">const</span> refs = <span class="hljs-variable language_">this</span>.<span class="hljs-property">_componentRefs</span>.<span class="hljs-title function_">get</span>(component);
            <span class="hljs-keyword">if</span> (refs) {
                <span class="hljs-keyword">const</span> index = refs.<span class="hljs-title function_">findIndex</span>(<span class="hljs-function"><span class="hljs-params">ref</span> =&gt;</span> 
                    ref.<span class="hljs-property">eventName</span> === eventName &amp;&amp; ref.<span class="hljs-property">listener</span> === boundListener
                );
                <span class="hljs-keyword">if</span> (index &gt; -<span class="hljs-number">1</span>) {
                    refs.<span class="hljs-title function_">splice</span>(index, <span class="hljs-number">1</span>);
                }
            }
        };
    }
    
    <span class="hljs-comment">// æ¸…ç†ç»„ä»¶çš„æ‰€æœ‰äº‹ä»¶</span>
    <span class="hljs-title function_">cleanupComponent</span>(<span class="hljs-params">component</span>) {
        <span class="hljs-keyword">const</span> refs = <span class="hljs-variable language_">this</span>.<span class="hljs-property">_componentRefs</span>.<span class="hljs-title function_">get</span>(component);
        <span class="hljs-keyword">if</span> (refs) {
            refs.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">{ eventName, listener }</span>) =&gt;</span> {
                <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">off</span>(eventName, listener);
            });
            <span class="hljs-variable language_">this</span>.<span class="hljs-property">_componentRefs</span>.<span class="hljs-title function_">delete</span>(component);
        }
    }
}

<span class="hljs-comment">// ä½¿ç”¨ç¤ºä¾‹</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">Component</span> {
    <span class="hljs-title function_">constructor</span>(<span class="hljs-params">emitter</span>) {
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">emitter</span> = emitter;
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">_cleanupFns</span> = [];
    }
    
    <span class="hljs-title function_">setupEvents</span>(<span class="hljs-params"/>) {
        <span class="hljs-comment">// ç»‘å®šäº‹ä»¶ï¼Œè‡ªåŠ¨ç®¡ç†ç”Ÿå‘½å‘¨æœŸ</span>
        <span class="hljs-keyword">const</span> cleanup1 = <span class="hljs-variable language_">this</span>.<span class="hljs-property">emitter</span>.<span class="hljs-title function_">bindToComponent</span>(
            <span class="hljs-variable language_">this</span>,
            <span class="hljs-string">'data'</span>,
            <span class="hljs-variable language_">this</span>.<span class="hljs-property">handleData</span>.<span class="hljs-title function_">bind</span>(<span class="hljs-variable language_">this</span>)
        );
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">_cleanupFns</span>.<span class="hljs-title function_">push</span>(cleanup1);
        
        <span class="hljs-keyword">const</span> cleanup2 = <span class="hljs-variable language_">this</span>.<span class="hljs-property">emitter</span>.<span class="hljs-title function_">bindToComponent</span>(
            <span class="hljs-variable language_">this</span>,
            <span class="hljs-string">'error'</span>,
            <span class="hljs-variable language_">this</span>.<span class="hljs-property">handleError</span>.<span class="hljs-title function_">bind</span>(<span class="hljs-variable language_">this</span>)
        );
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">_cleanupFns</span>.<span class="hljs-title function_">push</span>(cleanup2);
    }
    
    <span class="hljs-title function_">handleData</span>(<span class="hljs-params">data</span>) {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'å¤„ç†æ•°æ®:'</span>, data);
    }
    
    <span class="hljs-title function_">handleError</span>(<span class="hljs-params">error</span>) {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'å¤„ç†é”™è¯¯:'</span>, error);
    }
    
    <span class="hljs-title function_">destroy</span>(<span class="hljs-params"/>) {
        <span class="hljs-comment">// æ¸…ç†æ‰€æœ‰äº‹ä»¶</span>
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">_cleanupFns</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">fn</span> =&gt;</span> <span class="hljs-title function_">fn</span>());
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">_cleanupFns</span> = [];
        
        <span class="hljs-comment">// æˆ–è€…ä½¿ç”¨è‡ªåŠ¨æ¸…ç†</span>
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">emitter</span>.<span class="hljs-title function_">cleanupComponent</span>(<span class="hljs-variable language_">this</span>);
    }
}
</code></pre>
<h5 data-id="heading-30">8.2 æ€§èƒ½ä¼˜åŒ–æŠ€å·§</h5>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// é«˜æ€§èƒ½ EventEmitter</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">HighPerformanceEventEmitter</span> {
    <span class="hljs-title function_">constructor</span>(<span class="hljs-params"/>) {
        <span class="hljs-comment">// ä½¿ç”¨ç©ºå¯¹è±¡ä½œä¸ºåŸå‹ï¼Œé¿å…åŸå‹é“¾æŸ¥æ‰¾</span>
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">_events</span> = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">create</span>(<span class="hljs-literal">null</span>);
        <span class="hljs-comment">// ç¼“å­˜ç©ºæ•°ç»„ï¼Œé¿å…é¢‘ç¹åˆ›å»º</span>
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">_emptyArray</span> = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">freeze</span>([]);
    }
    
    <span class="hljs-title function_">on</span>(<span class="hljs-params">eventName, listener</span>) {
        <span class="hljs-keyword">if</span> (!<span class="hljs-variable language_">this</span>.<span class="hljs-property">_events</span>[eventName]) {
            <span class="hljs-comment">// é¢„åˆ†é…æ•°ç»„ç©ºé—´</span>
            <span class="hljs-variable language_">this</span>.<span class="hljs-property">_events</span>[eventName] = [];
        }
        
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">_events</span>[eventName].<span class="hljs-title function_">push</span>(listener);
        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>;
    }
    
    <span class="hljs-title function_">emit</span>(<span class="hljs-params">eventName, ...args</span>) {
        <span class="hljs-comment">// å¿«é€Ÿè·¯å¾„ï¼šæ²¡æœ‰ç›‘å¬å™¨</span>
        <span class="hljs-keyword">const</span> listeners = <span class="hljs-variable language_">this</span>.<span class="hljs-property">_events</span>[eventName];
        <span class="hljs-keyword">if</span> (!listeners) <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
        
        <span class="hljs-comment">// ä½¿ç”¨ for å¾ªç¯è€Œä¸æ˜¯ forEachï¼Œæ€§èƒ½æ›´å¥½</span>
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>, len = listeners.<span class="hljs-property">length</span>; i &lt; len; i++) {
            <span class="hljs-keyword">try</span> {
                listeners[i].<span class="hljs-title function_">apply</span>(<span class="hljs-variable language_">this</span>, args);
            } <span class="hljs-keyword">catch</span> (error) {
                <span class="hljs-comment">// é”™è¯¯å¤„ç†</span>
                <span class="hljs-keyword">if</span> (eventName !== <span class="hljs-string">'error'</span>) {
                    <span class="hljs-keyword">const</span> errorListeners = <span class="hljs-variable language_">this</span>.<span class="hljs-property">_events</span>.<span class="hljs-property">error</span>;
                    <span class="hljs-keyword">if</span> (errorListeners) {
                        <span class="hljs-comment">// é¿å…é€’å½’è°ƒç”¨</span>
                        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> j = <span class="hljs-number">0</span>; j &lt; errorListeners.<span class="hljs-property">length</span>; j++) {
                            <span class="hljs-keyword">try</span> {
                                errorListeners[j].<span class="hljs-title function_">call</span>(<span class="hljs-variable language_">this</span>, error);
                            } <span class="hljs-keyword">catch</span> (e) {
                                <span class="hljs-comment">// å¿½ç•¥é”™è¯¯å¤„ç†å‡½æ•°ä¸­çš„é”™è¯¯</span>
                            }
                        }
                    }
                }
            }
        }
        
        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
    }
    
    <span class="hljs-title function_">off</span>(<span class="hljs-params">eventName, listener</span>) {
        <span class="hljs-keyword">const</span> listeners = <span class="hljs-variable language_">this</span>.<span class="hljs-property">_events</span>[eventName];
        <span class="hljs-keyword">if</span> (!listeners) <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>;
        
        <span class="hljs-comment">// ä»åå‘å‰éå†ï¼Œé¿å…æ•°ç»„ç§»åŠ¨</span>
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = listeners.<span class="hljs-property">length</span> - <span class="hljs-number">1</span>; i &gt;= <span class="hljs-number">0</span>; i--) {
            <span class="hljs-keyword">if</span> (listeners[i] === listener) {
                listeners.<span class="hljs-title function_">splice</span>(i, <span class="hljs-number">1</span>);
                <span class="hljs-keyword">break</span>;
            }
        }
        
        <span class="hljs-comment">// å¦‚æœæ²¡æœ‰ç›‘å¬å™¨äº†ï¼Œåˆ é™¤å±æ€§ï¼ˆè®© V8 ä¼˜åŒ–ï¼‰</span>
        <span class="hljs-keyword">if</span> (listeners.<span class="hljs-property">length</span> === <span class="hljs-number">0</span>) {
            <span class="hljs-keyword">delete</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">_events</span>[eventName];
        }
        
        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>;
    }
    
    <span class="hljs-comment">// æ‰¹é‡æ“ä½œä¼˜åŒ–</span>
    <span class="hljs-title function_">emitMany</span>(<span class="hljs-params">eventNames, ...args</span>) {
        <span class="hljs-keyword">const</span> results = [];
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> eventName <span class="hljs-keyword">of</span> eventNames) {
            results.<span class="hljs-title function_">push</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-title function_">emit</span>(eventName, ...args));
        }
        <span class="hljs-keyword">return</span> results;
    }
}
</code></pre>
<h5 data-id="heading-31">8,3 è°ƒè¯•å’Œç›‘æ§</h5>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// å¯ç›‘æ§çš„ EventEmitter</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">MonitoredEventEmitter</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">EventEmitter</span> {
    <span class="hljs-title function_">constructor</span>(<span class="hljs-params">options = {}</span>) {
        <span class="hljs-variable language_">super</span>();
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">_monitoring</span> = {
            <span class="hljs-attr">enabled</span>: options.<span class="hljs-property">enabled</span> !== <span class="hljs-literal">false</span>,
            <span class="hljs-attr">emitCount</span>: <span class="hljs-number">0</span>,
            <span class="hljs-attr">listenerCount</span>: <span class="hljs-number">0</span>,
            <span class="hljs-attr">eventStats</span>: <span class="hljs-keyword">new</span> <span class="hljs-title class_">Map</span>(),
            <span class="hljs-attr">errorStats</span>: <span class="hljs-keyword">new</span> <span class="hljs-title class_">Map</span>(),
            <span class="hljs-attr">slowListeners</span>: []
        };
        
        <span class="hljs-comment">// æ€§èƒ½ç›‘æ§é˜ˆå€¼ï¼ˆæ¯«ç§’ï¼‰</span>
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">_slowThreshold</span> = options.<span class="hljs-property">slowThreshold</span> || <span class="hljs-number">100</span>;
    }
    
    <span class="hljs-comment">// é‡å†™ emit æ–¹æ³•ä»¥æ”¶é›†ç›‘æ§æ•°æ®</span>
    <span class="hljs-title function_">emit</span>(<span class="hljs-params">eventName, ...args</span>) {
        <span class="hljs-keyword">if</span> (!<span class="hljs-variable language_">this</span>.<span class="hljs-property">_monitoring</span>.<span class="hljs-property">enabled</span>) {
            <span class="hljs-keyword">return</span> <span class="hljs-variable language_">super</span>.<span class="hljs-title function_">emit</span>(eventName, ...args);
        }
        
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">_monitoring</span>.<span class="hljs-property">emitCount</span>++;
        
        <span class="hljs-comment">// æ›´æ–°äº‹ä»¶ç»Ÿè®¡</span>
        <span class="hljs-keyword">const</span> eventStat = <span class="hljs-variable language_">this</span>.<span class="hljs-property">_monitoring</span>.<span class="hljs-property">eventStats</span>.<span class="hljs-title function_">get</span>(eventName) || {
            <span class="hljs-attr">count</span>: <span class="hljs-number">0</span>,
            <span class="hljs-attr">lastEmitted</span>: <span class="hljs-literal">null</span>,
            <span class="hljs-attr">avgDuration</span>: <span class="hljs-number">0</span>,
            <span class="hljs-attr">maxDuration</span>: <span class="hljs-number">0</span>
        };
        
        eventStat.<span class="hljs-property">count</span>++;
        eventStat.<span class="hljs-property">lastEmitted</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>();
        
        <span class="hljs-keyword">const</span> startTime = performance.<span class="hljs-title function_">now</span>();
        <span class="hljs-keyword">const</span> result = <span class="hljs-variable language_">super</span>.<span class="hljs-title function_">emit</span>(eventName, ...args);
        <span class="hljs-keyword">const</span> duration = performance.<span class="hljs-title function_">now</span>() - startTime;
        
        <span class="hljs-comment">// æ›´æ–°æ€§èƒ½ç»Ÿè®¡</span>
        eventStat.<span class="hljs-property">avgDuration</span> = 
            (eventStat.<span class="hljs-property">avgDuration</span> * (eventStat.<span class="hljs-property">count</span> - <span class="hljs-number">1</span>) + duration) / eventStat.<span class="hljs-property">count</span>;
        eventStat.<span class="hljs-property">maxDuration</span> = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">max</span>(eventStat.<span class="hljs-property">maxDuration</span>, duration);
        
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">_monitoring</span>.<span class="hljs-property">eventStats</span>.<span class="hljs-title function_">set</span>(eventName, eventStat);
        
        <span class="hljs-comment">// è®°å½•æ…¢ç›‘å¬å™¨</span>
        <span class="hljs-keyword">if</span> (duration &gt; <span class="hljs-variable language_">this</span>.<span class="hljs-property">_slowThreshold</span>) {
            <span class="hljs-variable language_">this</span>.<span class="hljs-property">_monitoring</span>.<span class="hljs-property">slowListeners</span>.<span class="hljs-title function_">push</span>({
                eventName,
                duration,
                <span class="hljs-attr">timestamp</span>: <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>(),
                <span class="hljs-attr">args</span>: args.<span class="hljs-title function_">slice</span>(<span class="hljs-number">0</span>, <span class="hljs-number">3</span>) <span class="hljs-comment">// åªè®°å½•å‰ä¸‰ä¸ªå‚æ•°</span>
            });
            
            <span class="hljs-comment">// ä¿æŒæ…¢ç›‘å¬å™¨è®°å½•çš„æ•°é‡</span>
            <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">_monitoring</span>.<span class="hljs-property">slowListeners</span>.<span class="hljs-property">length</span> &gt; <span class="hljs-number">100</span>) {
                <span class="hljs-variable language_">this</span>.<span class="hljs-property">_monitoring</span>.<span class="hljs-property">slowListeners</span>.<span class="hljs-title function_">shift</span>();
            }
        }
        
        <span class="hljs-keyword">return</span> result;
    }
    
    <span class="hljs-comment">// è·å–ç›‘æ§æ•°æ®</span>
    <span class="hljs-title function_">getMonitoringData</span>(<span class="hljs-params"/>) {
        <span class="hljs-keyword">return</span> {
            ...<span class="hljs-variable language_">this</span>.<span class="hljs-property">_monitoring</span>,
            <span class="hljs-attr">currentListeners</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_getListenersCount</span>(),
            <span class="hljs-attr">eventNames</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">eventNames</span>(),
            <span class="hljs-attr">timestamp</span>: <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>()
        };
    }
    
    <span class="hljs-comment">// é‡ç½®ç›‘æ§æ•°æ®</span>
    <span class="hljs-title function_">resetMonitoring</span>(<span class="hljs-params"/>) {
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">_monitoring</span> = {
            <span class="hljs-attr">enabled</span>: <span class="hljs-literal">true</span>,
            <span class="hljs-attr">emitCount</span>: <span class="hljs-number">0</span>,
            <span class="hljs-attr">listenerCount</span>: <span class="hljs-number">0</span>,
            <span class="hljs-attr">eventStats</span>: <span class="hljs-keyword">new</span> <span class="hljs-title class_">Map</span>(),
            <span class="hljs-attr">errorStats</span>: <span class="hljs-keyword">new</span> <span class="hljs-title class_">Map</span>(),
            <span class="hljs-attr">slowListeners</span>: []
        };
    }
    
    <span class="hljs-comment">// ç”Ÿæˆç›‘æ§æŠ¥å‘Š</span>
    <span class="hljs-title function_">generateReport</span>(<span class="hljs-params"/>) {
        <span class="hljs-keyword">const</span> data = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getMonitoringData</span>();
        
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'=== EventEmitter ç›‘æ§æŠ¥å‘Š ==='</span>);
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`è¿è¡Œæ—¶é—´: <span class="hljs-subst">${data.timestamp.toISOString()}</span>`</span>);
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`æ€»è§¦å‘æ¬¡æ•°: <span class="hljs-subst">${data.emitCount}</span>`</span>);
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`æ´»è·ƒäº‹ä»¶æ•°é‡: <span class="hljs-subst">${data.eventNames.length}</span>`</span>);
        
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'\näº‹ä»¶ç»Ÿè®¡:'</span>);
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> [eventName, stat] <span class="hljs-keyword">of</span> data.<span class="hljs-property">eventStats</span>) {
            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`  <span class="hljs-subst">${eventName}</span>:`</span>);
            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`    è§¦å‘æ¬¡æ•°: <span class="hljs-subst">${stat.count}</span>`</span>);
            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`    å¹³å‡è€—æ—¶: <span class="hljs-subst">${stat.avgDuration.toFixed(<span class="hljs-number">2</span>)}</span>ms`</span>);
            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`    æœ€å¤§è€—æ—¶: <span class="hljs-subst">${stat.maxDuration.toFixed(<span class="hljs-number">2</span>)}</span>ms`</span>);
            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`    æœ€åè§¦å‘: <span class="hljs-subst">${stat.lastEmitted.toISOString()}</span>`</span>);
        }
        
        <span class="hljs-keyword">if</span> (data.<span class="hljs-property">slowListeners</span>.<span class="hljs-property">length</span> &gt; <span class="hljs-number">0</span>) {
            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'\næ…¢ç›‘å¬å™¨è­¦å‘Š:'</span>);
            data.<span class="hljs-property">slowListeners</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">item, index</span>) =&gt;</span> {
                <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`  <span class="hljs-subst">${index + <span class="hljs-number">1</span>}</span>. <span class="hljs-subst">${item.eventName}</span> - <span class="hljs-subst">${item.duration.toFixed(<span class="hljs-number">2</span>)}</span>ms`</span>);
            });
        }
        
        <span class="hljs-keyword">return</span> data;
    }
    
    <span class="hljs-comment">// ç§æœ‰æ–¹æ³•ï¼šè·å–ç›‘å¬å™¨è®¡æ•°</span>
    <span class="hljs-title function_">_getListenersCount</span>(<span class="hljs-params"/>) {
        <span class="hljs-keyword">const</span> result = {};
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> eventName <span class="hljs-keyword">in</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">_events</span>) {
            result[eventName] = <span class="hljs-variable language_">this</span>.<span class="hljs-property">_events</span>[eventName].<span class="hljs-property">length</span>;
        }
        <span class="hljs-keyword">return</span> result;
    }
}
</code></pre>
<h4 data-id="heading-32">ä¹ã€æ€»ç»“ä¸æœ€ä½³å®è·µ</h4>
<h5 data-id="heading-33">9.1 æ ¸å¿ƒè¦ç‚¹æ€»ç»“</h5>
<ol>
<li><strong>å‘å¸ƒè®¢é˜…æ¨¡å¼çš„æ ¸å¿ƒ:</strong> é€šè¿‡äº‹ä»¶ä¸­å¿ƒè§£è€¦å‘å¸ƒè€…å’Œè®¢é˜…è€…</li>
<li><strong>EventEmitterçš„å®ç°è¦ç‚¹:</strong></li>
</ol>
<ul>
<li>ä½¿ç”¨åˆé€‚çš„æ•°æ®ç»“æ„å­˜å‚¨äº‹ä»¶å’Œç›‘å¬å™¨</li>
<li>æ­£ç¡®å¤„ç† once ç›‘å¬å™¨</li>
<li>å®ç°é”™è¯¯å¤„ç†æœºåˆ¶</li>
<li>æ”¯æŒé“¾å¼è°ƒç”¨</li>
</ul>
<ol start="3">
<li><strong>å†…å­˜ç®¡ç†:</strong> åŠæ—¶æ¸…ç†ç›‘å¬å™¨, é¿å…å†…å­˜æ³„æ¼</li>
<li><strong>æ€§èƒ½è€ƒè™‘:</strong> é€‰æ‹©åˆé€‚çš„æ•°æ®ç»“æ„å’Œç®—æ³•</li>
</ol>
<h5 data-id="heading-34">9.2 æœ€ä½³å®ç°</h5>
<ol>
<li>å‘½åè§„èŒƒ:</li>
</ol>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// å¥½çš„å‘½å</span>
emitter.<span class="hljs-title function_">on</span>(<span class="hljs-string">'user:login'</span>, handler);
emitter.<span class="hljs-title function_">on</span>(<span class="hljs-string">'order:created'</span>, handler);

<span class="hljs-comment">// ä¸å¥½çš„å‘½å</span>
emitter.<span class="hljs-title function_">on</span>(<span class="hljs-string">'login'</span>, handler);
emitter.<span class="hljs-title function_">on</span>(<span class="hljs-string">'newOrder'</span>, handler);
</code></pre>
<ol start="2">
<li>é”™è¯¯å¤„ç†:</li>
</ol>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// æ€»æ˜¯ç›‘å¬ error äº‹ä»¶</span>
emitter.<span class="hljs-title function_">on</span>(<span class="hljs-string">'error'</span>, <span class="hljs-function">(<span class="hljs-params">error</span>) =&gt;</span> {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'EventEmitter error:'</span>, error);
    <span class="hljs-comment">// å‘é€åˆ°é”™è¯¯ç›‘æ§ç³»ç»Ÿ</span>
});

<span class="hljs-comment">// æˆ–è€…åœ¨ç›‘å¬å™¨å†…éƒ¨å¤„ç†é”™è¯¯</span>
emitter.<span class="hljs-title function_">on</span>(<span class="hljs-string">'data'</span>, <span class="hljs-function">(<span class="hljs-params">data</span>) =&gt;</span> {
    <span class="hljs-keyword">try</span> {
        <span class="hljs-title function_">processData</span>(data);
    } <span class="hljs-keyword">catch</span> (error) {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'å¤„ç†æ•°æ®æ—¶å‡ºé”™:'</span>, error);
        emitter.<span class="hljs-title function_">emit</span>(<span class="hljs-string">'error'</span>, error);
    }
});
</code></pre>
<ol start="3">
<li>èµ„æºæ¸…ç†:</li>
</ol>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Component</span> {
    <span class="hljs-title function_">constructor</span>(<span class="hljs-params"/>) {
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">_cleanupFns</span> = [];
    }
    
    <span class="hljs-title function_">setupEvents</span>(<span class="hljs-params"/>) {
        <span class="hljs-keyword">const</span> cleanup1 = emitter.<span class="hljs-title function_">on</span>(<span class="hljs-string">'event1'</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">handler1</span>.<span class="hljs-title function_">bind</span>(<span class="hljs-variable language_">this</span>));
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">_cleanupFns</span>.<span class="hljs-title function_">push</span>(cleanup1);
        
        <span class="hljs-keyword">const</span> cleanup2 = emitter.<span class="hljs-title function_">once</span>(<span class="hljs-string">'event2'</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">handler2</span>.<span class="hljs-title function_">bind</span>(<span class="hljs-variable language_">this</span>));
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">_cleanupFns</span>.<span class="hljs-title function_">push</span>(cleanup2);
    }
    
    <span class="hljs-title function_">destroy</span>(<span class="hljs-params"/>) {
        <span class="hljs-comment">// æ¸…ç†æ‰€æœ‰äº‹ä»¶ç›‘å¬å™¨</span>
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">_cleanupFns</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">fn</span> =&gt;</span> <span class="hljs-title function_">fn</span>());
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">_cleanupFns</span> = [];
    }
}
</code></pre>
<h5 data-id="heading-35">9.3 ä½¿ç”¨å»ºè®®</h5>



































<table><thead><tr><th align="left">åœºæ™¯</th><th align="left">æ¨èæ–¹æ¡ˆ</th><th align="left">ç†ç”±</th></tr></thead><tbody><tr><td align="left">ç®€å•ç»„ä»¶é€šä¿¡</td><td align="left">åŸºç¡€ EventEmitter</td><td align="left">è½»é‡ã€ç®€å•</td></tr><tr><td align="left">å¤§å‹åº”ç”¨çŠ¶æ€ç®¡ç†</td><td align="left">Observable Store</td><td align="left">ç»“æ„åŒ–ã€å¯é¢„æµ‹</td></tr><tr><td align="left">å¼‚æ­¥ä»»åŠ¡åè°ƒ</td><td align="left">AsyncEventEmitter</td><td align="left">æ›´å¥½çš„å¼‚æ­¥æ”¯æŒ</td></tr><tr><td align="left">æ€§èƒ½æ•æ„Ÿåœºæ™¯</td><td align="left">HighPerformanceEventEmitter</td><td align="left">ä¼˜åŒ–è¿‡çš„å®ç°</td></tr><tr><td align="left">éœ€è¦ç›‘æ§è°ƒè¯•</td><td align="left">MonitoredEventEmitter</td><td align="left">å†…ç½®ç›‘æ§åŠŸèƒ½</td></tr></tbody></table>
<h4 data-id="heading-36">ç»“è¯­</h4>
<p>é€šè¿‡æ‰‹å†™ EventEmitterï¼Œæˆ‘ä»¬ä¸ä»…æŒæ¡äº†å‘å¸ƒè®¢é˜…æ¨¡å¼çš„å®ç°åŸç†ï¼Œæ›´é‡è¦çš„æ˜¯ç†è§£äº†äº‹ä»¶é©±åŠ¨ç¼–ç¨‹çš„æ ¸å¿ƒæ€æƒ³ã€‚EventEmitter è™½ç„¶ç®€å•ï¼Œä½†å…¶è®¾è®¡æ€æƒ³åœ¨ç°ä»£å‰ç«¯æ¡†æ¶ã€Node.js åç«¯ç³»ç»Ÿä»¥åŠå„ç§å¤æ‚åº”ç”¨ä¸­éƒ½æœ‰å¹¿æ³›çš„åº”ç”¨ã€‚</p>
<p>è®°ä½ï¼Œå¥½çš„äº‹ä»¶ç³»ç»Ÿåº”è¯¥ï¼š</p>
<ul>
<li>
<p>âœ… èŒè´£æ¸…æ™°ï¼šäº‹ä»¶ä¸­å¿ƒåªè´Ÿè´£è½¬å‘æ¶ˆæ¯</p>
</li>
<li>
<p>âœ… æ€§èƒ½ä¼˜ç§€ï¼šé«˜é¢‘äº‹ä»¶è§¦å‘æ—¶è¡¨ç°è‰¯å¥½</p>
</li>
<li>
<p>âœ… æ˜“äºè°ƒè¯•ï¼šæœ‰è‰¯å¥½çš„ç›‘æ§å’Œé”™è¯¯å¤„ç†</p>
</li>
<li>
<p>âœ… å†…å­˜å®‰å…¨ï¼šé¿å…å†…å­˜æ³„æ¼å’Œèµ„æºæµªè´¹</p>
</li>
</ul>
<hr/>
<p>å»¶ä¼¸é˜…è¯»ï¼š</p>
<ul>
<li>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fnodejs.org%2Fapi%2Fevents.html" target="_blank" title="https://nodejs.org/api/events.html" ref="nofollow noopener noreferrer">Node.js EventEmitter å®˜æ–¹æ–‡æ¡£</a></p>
</li>
<li>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fen.wikipedia.org%2Fwiki%2FPublish%2525E2%252580%252593subscribe_pattern" target="_blank" title="https://en.wikipedia.org/wiki/Publish%25E2%2580%2593subscribe_pattern" ref="nofollow noopener noreferrer">å‘å¸ƒè®¢é˜…æ¨¡å¼è¯¦è§£</a></p>
</li>
<li>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fhackernoon.com%2Fobserver-vs-pub-sub-pattern-50d3b27f838c" target="_blank" title="https://hackernoon.com/observer-vs-pub-sub-pattern-50d3b27f838c" ref="nofollow noopener noreferrer">è§‚å¯Ÿè€…æ¨¡å¼ä¸å‘å¸ƒè®¢é˜…æ¨¡å¼çš„åŒºåˆ«</a></p>
</li>
<li>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Frxjs.dev%2Fguide%2Foverview" target="_blank" title="https://rxjs.dev/guide/overview" ref="nofollow noopener noreferrer">RxJS å“åº”å¼ç¼–ç¨‹</a></p>
</li>
</ul>
<p>å¸Œæœ›è¿™ç¯‡ç»è¿‡ä¸¥æ ¼æµ‹è¯•çš„åšå®¢èƒ½å¸®åŠ©ä½ æ·±å…¥ç†è§£ EventEmitterï¼å¦‚æœæœ‰ä»»ä½•é—®é¢˜æˆ–å»ºè®®ï¼Œæ¬¢è¿è®¨è®ºäº¤æµã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[å‘Šåˆ«é‡å¤é€ è½®å­ï¼ä¸šåŠ¡ç»„ä»¶å¤šåœºæ™¯å¤ç”¨å®æˆ˜æŒ‡å—]]></title>    <link>https://juejin.cn/post/7581314241409794083</link>    <guid>https://juejin.cn/post/7581314241409794083</guid>    <pubDate>2025-12-08T10:22:54.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581314241409794083" data-draft-id="7579808521203974178" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="å‘Šåˆ«é‡å¤é€ è½®å­ï¼ä¸šåŠ¡ç»„ä»¶å¤šåœºæ™¯å¤ç”¨å®æˆ˜æŒ‡å—"/> <meta itemprop="keywords" content="å‰ç«¯,JavaScript,è®¾è®¡æ¨¡å¼"/> <meta itemprop="datePublished" content="2025-12-08T10:22:54.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="è“ç‘Ÿ"/> <meta itemprop="url" content="https://juejin.cn/user/3817959264107757"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            å‘Šåˆ«é‡å¤é€ è½®å­ï¼ä¸šåŠ¡ç»„ä»¶å¤šåœºæ™¯å¤ç”¨å®æˆ˜æŒ‡å—
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3817959264107757/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    è“ç‘Ÿ
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-08T10:22:54.000Z" title="Mon Dec 08 2025 10:22:54 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»10åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#383838;font-size:15px;line-height:30px;letter-spacing:2px;word-break:break-word;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Open Sans,Helvetica Neue,sans-serif;scroll-behavior:smooth;background-image:linear-gradient(0deg,transparent 24%,rgba(201,195,195,.329) 25%,hsla(0,8%,80.4%,.05) 26%,transparent 27%,transparent 74%,hsla(0,5.2%,81%,.185) 75%,rgba(180,176,176,.05) 76%,transparent 77%,transparent),linear-gradient(90deg,transparent 24%,rgba(204,196,196,.226) 25%,hsla(0,4%,66.1%,.05) 26%,transparent 27%,transparent 74%,hsla(0,5.2%,81%,.185) 75%,rgba(180,176,176,.05) 76%,transparent 77%,transparent);background-color:#fff;background-size:50px 50px;padding-bottom:60px}.markdown-body ::selection{color:#fff;background-color:#a862ea}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{margin:24px 0 12px;color:#a862ea}.markdown-body h1{line-height:2;font-size:1.4em}.markdown-body h1~p:first-of-type:first-letter{color:#a862ea;float:left;font-size:2em;margin-right:.4em;font-weight:bolder}.markdown-body h2{font-size:1.2em}.markdown-body h3{font-size:1.1em}.markdown-body ol,.markdown-body ul{padding-left:2em}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;padding-left:.2em}.markdown-body ol li::marker,.markdown-body ul li::marker{color:#a862ea}.markdown-body ol li.task-list-item,.markdown-body ul li.task-list-item{list-style:none}.markdown-body ol li.task-list-item ol,.markdown-body ol li.task-list-item ul,.markdown-body ul li.task-list-item ol,.markdown-body ul li.task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:10px}.markdown-body a,.markdown-body code,.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6,.markdown-body li,.markdown-body p{opacity:.85;vertical-align:baseline;transition:all .1s ease}.markdown-body a:hover,.markdown-body code:hover,.markdown-body h1:hover,.markdown-body h2:hover,.markdown-body h3:hover,.markdown-body h4:hover,.markdown-body h5:hover,.markdown-body h6:hover,.markdown-body li:hover,.markdown-body p:hover{opacity:1}.markdown-body a{display:inline-block;color:#a862ea;cursor:pointer;text-decoration:none;position:relative}.markdown-body a:after{content:"";position:absolute;width:98%;height:1px;bottom:0;left:0;transform:scaleX(0);background-color:#a862ea;transform-origin:bottom right;transition:transform .3s ease-in-out}.markdown-body a:hover:after{transform:scaleX(1);transform-origin:bottom left}.markdown-body a:active,.markdown-body a:link{color:#a862ea}.markdown-body img{max-width:100%;user-select:none;margin:1em 0;transition:transform .2s ease 0s;background-color:#f8f5ff;box-shadow:0 0 10px #e7daff}.markdown-body img:hover{opacity:1;box-shadow:0 0 20px #e7daff;transform:translateY(-1px)}.markdown-body blockquote{padding:.5em 1em;margin:12px 0;border-top-left-radius:2px;border-bottom-left-radius:2px;border-left:3px solid #a862ea;background-color:#f8f5ff}.markdown-body blockquote&gt;p{margin:0}.markdown-body .math{font-style:italic;margin:12px 0;padding:.5em 1em;background-color:#f8f5ff}.markdown-body .math&gt;p{margin:0}.markdown-body code{padding:2px .4em;overflow-x:auto;color:#a862ea;font-weight:700;word-break:break-word;font-family:Operator Mono,Consolas,Monaco,Menlo,monospace;background-color:#f8f5ff}.markdown-body pre{margin:2em 0}.markdown-body pre&gt;code{display:block;padding:1.5em;word-break:normal;font-size:.9em;font-style:normal;font-weight:400;font-family:Operator Mono,Consolas,Monaco,Menlo,monospace;line-height:18px;color:#383838;border-radius:2px;scroll-behavior:smooth;box-shadow:0 0 10px #e7daff}.markdown-body pre&gt;code:hover{box-shadow:0 0 20px #e7daff}.markdown-body pre&gt;code::-webkit-scrollbar{height:6px;background-color:#f8f5ff}.markdown-body pre&gt;code::-webkit-scrollbar-thumb{background-color:#e7daff;border-bottom-left-radius:3px;border-bottom-right-radius:3px}.markdown-body hr{margin:2em 0;border-top:1px solid #a862ea}.markdown-body table{width:100%;font-size:12px;max-width:100%;overflow:auto;border-collapse:collapse}.markdown-body thead{color:#a862ea;background:#f8f5ff}.markdown-body td,.markdown-body th{padding:.5em;border:1px solid #e7daff}.markdown-body tr{background-color:#f8f5ff}@media (max-width:720px){.markdown-body{font-size:12px}}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">å¼•è¨€:å½“"ä¸€ä¸ªç»„ä»¶å¤šåœºæ™¯å¤ç”¨"é‡ä¸Šç°å®å¤æ‚æ€§</h2>
<p>ç»„ä»¶ã€Œå¤ç”¨ã€æœ€å®¹æ˜“è¢«è¯¯è§£â€”â€”<br/>
è€æ¿è¯´â€œè¿™ä¸å°±ä¸€æ ·å¡ç‰‡å˜›ï¼Œå¤šåŠ å‡ ä¸ªå­—æ®µâ€ï¼Œ<br/>
äº§å“è¯´â€œå°±æ¢ä¸ªçš®å˜›ï¼Œè¿˜ä¸æ˜¯ä¸€ä¸ªä¸šåŠ¡é€»è¾‘â€ï¼Œ<br/>
ä½†ä½ çŸ¥é“ï¼šè¿™ä¸ª â€œä¸€æ ·â€ï¼Œå¾€å¾€ç­‰äºä¸€åœ°é¸¡æ¯›ã€‚</p>
<p>ä¸€å¼€å§‹ä½ æƒ³ç€æ‰“ä¸ªè¡¥ä¸ï¼ˆæ¡ä»¶åˆ¤æ–­åŠ ä¸€ä¸ªï¼‰<br/>
åæ¥ä½ è¡¥è¡¥åˆè¡¥â€”â€”å†è¡¥è¿˜æ˜¯ä¸è¡Œï¼Œæœ€ååˆ«è¯´â€œå¤ç”¨â€ï¼Œæ—§ç»„ä»¶éƒ½åäº†:
é€»è¾‘è€¦åˆã€prop çˆ†ç‚¸ï¼Œä¸€ä¸å°å¿ƒèµ°ä¸Šå°è£…â€œå·¨å‹é»‘ç®±â€çš„ä¸å½’è·¯ã€‚</p>
<p><strong>è¿™ä¸æ˜¯å·¥ä½œç–å¿½ï¼Œè€Œæ˜¯è®¾è®¡æ–¹å¼å‡ºé”™äº†ã€‚</strong></p>
<p>å†ç»å¤šä¸ªé¡¹ç›®å®æˆ˜æ¢ç´¢ï¼Œä½ ä¼šå‘ç°ï¼šå¤ç”¨ä¸€ä¸ªç»„ä»¶ï¼Œå°±åƒåœ¨ç»„è£…å¤æ‚æ‹¼å›¾â€”â€”æ¸…æ™°è¾¹ç•Œã€æ‹†åˆ†åŠŸèƒ½ã€ç»„åˆè€Œä¸è€¦åˆï¼Œæ‰æ˜¯å…³é”®ã€‚</p>
<p>è¿™ç¯‡æ–‡ç« å°±å¸¦ä½ ç”¨â€œé…ç½®é©±åŠ¨è®¾è®¡â€ã€â€œå¤åˆç»„ä»¶æ¨¡å¼â€ã€â€œç­–ç•¥æ¨¡å¼â€ã€â€œæ¸²æŸ“å‡½æ•°â€çš„æ€ç»´è·¯å¾„ï¼Œæ‹†å¼€ã€å†ç»„å»ºå‡ºçœŸæ­£æ˜“å¤ç”¨çš„ä¸šåŠ¡ç»„ä»¶æ¨¡å‹ã€‚</p>
<h2 data-id="heading-1">ä¸€ã€é…ç½®é©±åŠ¨è®¾è®¡ï¼šå‚æ•°åŒ–çš„è‰ºæœ¯</h2>
<h3 data-id="heading-2">é€‚ç”¨åœºæ™¯ï¼šåŠŸèƒ½å¼€å…³ä¸æ ·å¼ä¸»é¢˜çš„çµæ´»åˆ‡æ¢</h3>
<p>å½“ç»„ä»¶çš„å·®å¼‚ä¸»è¦ä½“ç°åœ¨<strong>åŠŸèƒ½ç»„åˆã€è§†è§‰ä¸»é¢˜å’Œç®€å•è¡Œä¸ºå˜åŒ–</strong>æ—¶ï¼Œé…ç½®é©±åŠ¨å°±åƒç»™ç»„ä»¶è£…ä¸Šäº†"æ§åˆ¶é¢æ¿"ï¼Œé€šè¿‡è°ƒèŠ‚å‚æ•°å³å¯å®ç°ä¸åŒå½¢æ€ã€‚</p>
<pre><code class="hljs language-mermaid" lang="mermaid">graph TD
    A[ä¸šåŠ¡ç»„ä»¶å…¥å£] --&gt; B{è¯»å–åœºæ™¯é…ç½®}
    B --&gt; C[ç®¡ç†å‘˜åœºæ™¯]
    B --&gt; D[ç”¨æˆ·åœºæ™¯]
    B --&gt; E[ç§»åŠ¨ç«¯åœºæ™¯]
    
    C --&gt; F[é…ç½®è§£æå™¨]
    D --&gt; F
    E --&gt; F
    
    F --&gt; G[åŠŸèƒ½å¼€å…³]
    F --&gt; H[æ ·å¼ä¸»é¢˜]
    F --&gt; I[è¡Œä¸ºç­–ç•¥]
    
    G --&gt; J[æ¸²æŸ“å¼•æ“]
    H --&gt; J
    I --&gt; J
    
    J --&gt; K[ç®¡ç†å‘˜ç•Œé¢]
    J --&gt; L[ç”¨æˆ·ç•Œé¢]
    J --&gt; M[ç§»åŠ¨ç«¯ç•Œé¢]
    
    style C fill:#e1f5e1
    style D fill:#fff3e0
    style E fill:#e3f2fd
</code></pre>
<h3 data-id="heading-3">è®¾è®¡å“²å­¦ï¼šåˆ†ç¦»å˜ä¸ä¸å˜</h3>
<p>é…ç½®é©±åŠ¨çš„æ ¸å¿ƒæ€æƒ³æ˜¯å°†<strong>å˜åŒ–çš„éƒ¨åˆ†å‚æ•°åŒ–</strong>ï¼Œè€Œ<strong>ä¸å˜çš„éƒ¨åˆ†å›ºå®šåŒ–</strong>ã€‚é€šè¿‡ä¸€ä¸ªé›†ä¸­ç®¡ç†çš„é…ç½®å¯¹è±¡ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ä¸ä¿®æ”¹ç»„ä»¶å†…éƒ¨ä»£ç çš„æƒ…å†µä¸‹ï¼Œå®ç°å¤šç§åœºæ™¯çš„é€‚é…ã€‚</p>
<h3 data-id="heading-4">å…³é”®å®ç°æŠ€å·§</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// é…ç½®çš„å±‚æ¬¡åŒ–è®¾è®¡</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">createSceneConfig</span> = (<span class="hljs-params">baseConfig, overrideConfig</span>) =&gt; ({
  <span class="hljs-comment">// ç¬¬ä¸€å±‚ï¼šåŸºç¡€åŠŸèƒ½é…ç½®</span>
  <span class="hljs-attr">features</span>: <span class="hljs-title function_">mergeDeep</span>(baseConfig.<span class="hljs-property">features</span>, overrideConfig.<span class="hljs-property">features</span>),
  
  <span class="hljs-comment">// ç¬¬äºŒå±‚ï¼šUIè¡¨ç°é…ç½®  </span>
  <span class="hljs-attr">ui</span>: {
    ...baseConfig.<span class="hljs-property">ui</span>,
    ...overrideConfig.<span class="hljs-property">ui</span>,
    <span class="hljs-comment">// ä¸»é¢˜ç³»ç»Ÿæ”¯æŒåŠ¨æ€åˆ‡æ¢</span>
    <span class="hljs-attr">theme</span>: <span class="hljs-title function_">createTheme</span>(overrideConfig.<span class="hljs-property">ui</span>?.<span class="hljs-property">theme</span>)
  },
  
  <span class="hljs-comment">// ç¬¬ä¸‰å±‚ï¼šä¸šåŠ¡è§„åˆ™é…ç½®</span>
  <span class="hljs-attr">businessRules</span>: <span class="hljs-title function_">applyBusinessRules</span>(
    baseConfig.<span class="hljs-property">businessRules</span>,
    overrideConfig.<span class="hljs-property">businessRules</span>,
    context
  ),
  
  <span class="hljs-comment">// ç¬¬å››å±‚ï¼šæ€§èƒ½ä¼˜åŒ–é…ç½®</span>
  <span class="hljs-attr">performance</span>: {
    <span class="hljs-comment">// æ ¹æ®åœºæ™¯å¯ç”¨ä¸åŒçš„ä¼˜åŒ–ç­–ç•¥</span>
    <span class="hljs-attr">lazyLoad</span>: overrideConfig.<span class="hljs-property">isMobile</span>,
    <span class="hljs-attr">virtualScroll</span>: overrideConfig.<span class="hljs-property">isLargeDataset</span>,
    <span class="hljs-attr">memoization</span>: <span class="hljs-literal">true</span>
  }
});
</code></pre>
<h3 data-id="heading-5">ä¼˜åŠ¿ä¸è€ƒé‡</h3>
<h4 data-id="heading-6">ä¼˜åŠ¿ï¼š</h4>
<ol>
<li>é«˜åº¦å¯æ§ï¼šé€šè¿‡é…ç½®å³å¯è°ƒæ•´ç»„ä»¶è¡Œä¸ºï¼Œæ— éœ€ä¿®æ”¹ç»„ä»¶å†…éƒ¨ä»£ç </li>
<li>æ˜“äºæ‰©å±•ï¼šæ–°å¢åœºæ™¯åªéœ€æ·»åŠ é…ç½®ï¼Œç¬¦åˆå¼€é—­åŸåˆ™</li>
<li>é…ç½®é›†ä¸­ç®¡ç†ï¼šä¾¿äºç»´æŠ¤å’Œç»Ÿä¸€è°ƒæ•´</li>
</ol>
<h4 data-id="heading-7">è€ƒé‡ï¼š</h4>
<ol>
<li>é…ç½®å¯¹è±¡å¯èƒ½ä¼šå˜å¾—è‡ƒè‚¿ï¼Œéœ€è¦è‰¯å¥½çš„æ–‡æ¡£</li>
<li>å¤æ‚é€»è¾‘åœºæ™¯å¯èƒ½ä¸é€‚åˆçº¯é…ç½®é©±åŠ¨</li>
</ol>
<h3 data-id="heading-8">æœ€ä½³å®è·µå»ºè®®</h3>
<ol>
<li><strong>é…ç½®éªŒè¯</strong>ï¼šä½¿ç”¨SchemaéªŒè¯ç¡®ä¿é…ç½®çš„æ­£ç¡®æ€§</li>
<li><strong>é»˜è®¤å€¼å¤„ç†</strong>ï¼šæä¾›åˆç†çš„é»˜è®¤å€¼ï¼Œé¿å…é…ç½®ç¼ºå¤±å¯¼è‡´é”™è¯¯</li>
<li><strong>é…ç½®ç‰ˆæœ¬åŒ–</strong>ï¼šæ”¯æŒé…ç½®çš„çƒ­æ›´æ–°å’Œç‰ˆæœ¬å›æ»š</li>
<li><strong>æ€§èƒ½ä¼˜åŒ–</strong>ï¼šå¯¹é…ç½®å¯¹è±¡è¿›è¡Œè®°å¿†åŒ–ï¼Œé¿å…ä¸å¿…è¦çš„é‡æ–°æ¸²æŸ“</li>
</ol>
<h2 data-id="heading-9">äºŒã€å¤åˆç»„ä»¶æ¨¡å¼ï¼šä¹é«˜ç§¯æœ¨å¼çš„ç»„è£…è‰ºæœ¯</h2>
<h3 data-id="heading-10">é€‚ç”¨åœºæ™¯ï¼šUIç»“æ„å·®å¼‚æ˜¾è‘—çš„è·¨å¹³å°åº”ç”¨</h3>
<p>å½“ä¸åŒåœºæ™¯çš„<strong>ç•Œé¢å¸ƒå±€å’Œäº¤äº’æ¨¡å¼å·®å¼‚è¾ƒå¤§</strong>ï¼Œä½†åº•å±‚æ•°æ®é€»è¾‘ç›¸åŒæ—¶ï¼Œå¤åˆç»„ä»¶æ¨¡å¼å°±åƒæ˜¯æä¾›äº†ä¸€ç›’ä¹é«˜ç§¯æœ¨ï¼Œè®©ä½¿ç”¨è€…å¯ä»¥è‡ªç”±ç»„è£…å‡ºæ‰€éœ€çš„ç»“æ„ã€‚</p>
<pre><code class="hljs language-mermaid" lang="mermaid">graph TB
    subgraph "å¤åˆç»„ä»¶æ¶æ„"
        A[å®¹å™¨ç»„ä»¶&lt;br/&gt;BusinessContainer] --&gt; B[ä¸Šä¸‹æ–‡æä¾›è€…]
        B --&gt; C[åœºæ™¯ä¸Šä¸‹æ–‡]
        
        C --&gt; D[å¤´éƒ¨é€‰æ‹©å™¨]
        C --&gt; E[å†…å®¹é€‰æ‹©å™¨]
        C --&gt; F[åº•éƒ¨é€‰æ‹©å™¨]
        
        D --&gt; G[ç®¡ç†å‘˜å¤´éƒ¨]
        D --&gt; H[ç§»åŠ¨ç«¯å¤´éƒ¨]
        D --&gt; I[ç”¨æˆ·å¤´éƒ¨]
        
        E --&gt; J[è¯¦ç»†è§†å›¾]
        E --&gt; K[ç®€æ´è§†å›¾]
        E --&gt; L[å¡ç‰‡è§†å›¾]
        
        F --&gt; M[æ“ä½œæ ]
        F --&gt; N[åˆ†é¡µå™¨]
        F --&gt; O[ç©ºçŠ¶æ€]
    end
    
    subgraph "ä½¿ç”¨ç»„åˆ"
        P[ç®¡ç†å‘˜åœºæ™¯] --&gt; Q[ç»„åˆç¤ºä¾‹]
        Q --&gt; R[å®¹å™¨]
        R --&gt; S[ç®¡ç†å‘˜å¤´éƒ¨]
        R --&gt; T[è¯¦ç»†è§†å›¾]
        R --&gt; U[æ“ä½œæ ]
    end
    
    G -.-&gt; S
    J -.-&gt; T
    M -.-&gt; U
</code></pre>
<h3 data-id="heading-11">è®¾è®¡å“²å­¦ï¼šå…³æ³¨ç‚¹åˆ†ç¦»ä¸è‡ªç”±ç»„åˆ</h3>
<p>å¤åˆç»„ä»¶çš„æ ¸å¿ƒä¼˜åŠ¿åœ¨äº<strong>å°†å¤æ‚çš„ç»„ä»¶æ‹†è§£ä¸ºç‹¬ç«‹çš„ã€å¯å¤ç”¨çš„å­ç»„ä»¶</strong>ï¼Œæ¯ä¸ªå­ç»„ä»¶éƒ½æœ‰æ˜ç¡®çš„èŒè´£ï¼ŒåŒæ—¶é€šè¿‡å…±äº«çš„ä¸Šä¸‹æ–‡è¿›è¡Œé€šä¿¡ã€‚</p>
<h3 data-id="heading-12">è¿›é˜¶æ¨¡å¼ï¼šæ’æ§½ä¸æ‰©å±•ç‚¹</h3>
<pre><code class="hljs language-jsx" lang="jsx"><span class="hljs-comment">// æ”¯æŒæ’æ§½çš„å¤åˆç»„ä»¶</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">BusinessComponentWithSlots</span> = (<span class="hljs-params">{ children, slots = {} }</span>) =&gt; {
  <span class="hljs-keyword">const</span> defaultSlots = {
    <span class="hljs-attr">header</span>: <span class="hljs-title class_">DefaultHeader</span>,
    <span class="hljs-attr">content</span>: <span class="hljs-title class_">DefaultContent</span>,
    <span class="hljs-attr">footer</span>: <span class="hljs-title class_">DefaultFooter</span>,
    <span class="hljs-attr">sidebar</span>: <span class="hljs-title class_">DefaultSidebar</span>,
    <span class="hljs-attr">toolbar</span>: <span class="hljs-title class_">DefaultToolbar</span>,
  };
  
  <span class="hljs-keyword">const</span> resolvedSlots = { ...defaultSlots, ...slots };
  
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"business-layout"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"header-slot"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">resolvedSlots.header</span> /&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
      
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"main-content"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"sidebar-slot"</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">resolvedSlots.sidebar</span> /&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"content-slot"</span>&gt;</span>
          {children || <span class="hljs-tag">&lt;<span class="hljs-name">resolvedSlots.content</span> /&gt;</span>}
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
      
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"toolbar-slot"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">resolvedSlots.toolbar</span> /&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
      
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"footer-slot"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">resolvedSlots.footer</span> /&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  );
};

<span class="hljs-comment">// çµæ´»çš„ä½¿ç”¨æ–¹å¼</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">CustomizedView</span> = (<span class="hljs-params"/>) =&gt; (
  <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">BusinessComponentWithSlots</span>
    <span class="hljs-attr">slots</span>=<span class="hljs-string">{{</span>
      <span class="hljs-attr">header:</span> <span class="hljs-attr">CustomHeader</span>,
      <span class="hljs-attr">sidebar:</span> <span class="hljs-attr">StatisticsSidebar</span>,
      <span class="hljs-attr">toolbar:</span> <span class="hljs-attr">QuickActionsToolbar</span>,
    }}
  &gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">DashboardContent</span> /&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">BusinessComponentWithSlots</span>&gt;</span></span>
);
</code></pre>
<h3 data-id="heading-13">ä¼˜åŠ¿ä¸è€ƒé‡</h3>
<h4 data-id="heading-14">ä¼˜åŠ¿ï¼š</h4>
<ol>
<li>é«˜åº¦çµæ´»ï¼šå¯ä»¥åƒæ­ç§¯æœ¨ä¸€æ ·ç»„åˆç»„ä»¶</li>
<li>å…³æ³¨ç‚¹åˆ†ç¦»ï¼šæ¯ä¸ªå­ç»„ä»¶èŒè´£å•ä¸€</li>
<li>ä¸Šä¸‹æ–‡å…±äº«ï¼šçŠ¶æ€ç®¡ç†æ›´åŠ æ¸…æ™°</li>
</ol>
<h4 data-id="heading-15">è€ƒé‡ï¼š</h4>
<ol>
<li>å­¦ä¹ æ›²çº¿ç›¸å¯¹è¾ƒé«˜</li>
<li>éœ€è¦è‰¯å¥½çš„æ–‡æ¡£è¯´æ˜å¯ç”¨å­ç»„ä»¶</li>
</ol>
<h3 data-id="heading-16">æœ€ä½³å®è·µå»ºè®®</h3>
<ol>
<li><strong>æ˜ç¡®çš„ä¸Šä¸‹æ–‡å¥‘çº¦</strong>ï¼šä½¿ç”¨TypeScriptå®šä¹‰æ¸…æ™°çš„ä¸Šä¸‹æ–‡ç±»å‹ï¼Œç¡®ä¿å­ç»„ä»¶æ­£ç¡®ä½¿ç”¨å…±äº«çŠ¶æ€</li>
<li><strong>é»˜è®¤å­ç»„ä»¶å®ç°</strong>ï¼šä¸ºæ¯ä¸ªå­ç»„ä»¶æä¾›é»˜è®¤å®ç°ï¼Œé™ä½ä½¿ç”¨é—¨æ§›</li>
<li><strong>æ–‡æ¡£å’Œç¤ºä¾‹</strong>ï¼šä¸ºæ¯ä¸ªå­ç»„ä»¶æä¾›è¯¦ç»†çš„æ–‡æ¡£å’Œå¤šç§ä½¿ç”¨ç¤ºä¾‹</li>
<li><strong>æ€§èƒ½ä¼˜åŒ–</strong>ï¼šåˆç†æ‹†åˆ†ä¸Šä¸‹æ–‡ï¼Œé¿å…ä¸å¿…è¦çš„å­ç»„ä»¶é‡æ–°æ¸²æŸ“</li>
</ol>
<h2 data-id="heading-17">ä¸‰ã€ç­–ç•¥æ¨¡å¼ + è‡ªå®šä¹‰ Hookï¼šé€»è¾‘è§£è€¦çš„æ™ºæ…§</h2>
<h3 data-id="heading-18">é€‚ç”¨åœºæ™¯ï¼šä¸šåŠ¡è§„åˆ™å¤šå˜çš„å¤æ‚ç³»ç»Ÿ</h3>
<p>å½“ä¸åŒåœºæ™¯çš„<strong>ä¸šåŠ¡é€»è¾‘å’Œæ•°æ®å¤„ç†æ–¹å¼å·®å¼‚æ˜¾è‘—</strong>æ—¶ï¼Œç­–ç•¥æ¨¡å¼å¯ä»¥å°†è¿™äº›å·®å¼‚å°è£…åˆ°ç‹¬ç«‹çš„ç­–ç•¥å¯¹è±¡ä¸­ï¼Œä½¿ä¸»ç»„ä»¶ä¿æŒç®€æ´ã€‚</p>
<pre><code class="hljs language-mermaid" lang="mermaid">graph LR
    subgraph "ç­–ç•¥ç®¡ç†å™¨"
        A[ç­–ç•¥é€‰æ‹©å™¨] --&gt; B{åœºæ™¯åˆ¤æ–­}
        B --&gt; C[ç®¡ç†å‘˜ç­–ç•¥]
        B --&gt; D[ç”¨æˆ·ç­–ç•¥]
        B --&gt; E[ç§»åŠ¨ç«¯ç­–ç•¥]
        B --&gt; F[é¢„è§ˆç­–ç•¥]
    end
    
    subgraph "ç­–ç•¥å®ç°"
        C --&gt; G[æ•°æ®å¤„ç†ç®¡é“]
        C --&gt; H[æƒé™éªŒè¯å™¨]
        C --&gt; I[æ“ä½œæ‰§è¡Œå™¨]
        
        D --&gt; J[ç®€åŒ–æ•°æ®å¤„ç†]
        D --&gt; K[åŸºç¡€éªŒè¯]
        D --&gt; L[å—é™æ“ä½œ]
        
        E --&gt; M[ç¦»çº¿æ•°æ®åŒæ­¥]
        E --&gt; N[è§¦æ‘¸æ‰‹åŠ¿å¤„ç†]
        E --&gt; O[ç½‘ç»œçŠ¶æ€æ„ŸçŸ¥]
    end
    
    subgraph "ç»„ä»¶é›†æˆ"
        P[ä¸šåŠ¡ç»„ä»¶] --&gt; Q[ç­–ç•¥Hook]
        Q --&gt; A
        R[UIæ¸²æŸ“å±‚] --&gt; S[ç­–ç•¥API]
        S --&gt; G
        S --&gt; J
        S --&gt; M
    end
    
    G -.-&gt; S
    J -.-&gt; S
    M -.-&gt; S
</code></pre>
<h3 data-id="heading-19">è®¾è®¡å“²å­¦ï¼šç®—æ³•æ—çš„è‡ªç”±æ›¿æ¢</h3>
<p>ç­–ç•¥æ¨¡å¼çš„ç²¾é«“åœ¨äº<strong>å®šä¹‰ä¸€ç³»åˆ—å¯äº’æ¢çš„ç®—æ³•</strong>ï¼Œè®©å®ƒä»¬å¯ä»¥ç‹¬ç«‹äºä½¿ç”¨å®ƒä»¬çš„å®¢æˆ·ç«¯å˜åŒ–ã€‚ç»“åˆReact Hookï¼Œæˆ‘ä»¬å¯ä»¥åˆ›å»ºå‡ºæ—¢çµæ´»åˆæ˜“äºæµ‹è¯•çš„ä¸šåŠ¡é€»è¾‘å•å…ƒã€‚</p>
<h3 data-id="heading-20">ç­–ç•¥å·¥å‚æ¨¡å¼</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// ç­–ç•¥å·¥å‚ï¼šåŠ¨æ€åˆ›å»ºå’Œç»„åˆç­–ç•¥</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">createStrategy</span> = (<span class="hljs-params">scene, options</span>) =&gt; {
  <span class="hljs-comment">// åŸºç¡€ç­–ç•¥</span>
  <span class="hljs-keyword">const</span> baseStrategy = {
    <span class="hljs-attr">data</span>: options.<span class="hljs-property">data</span>,
    <span class="hljs-attr">format</span>: <span class="hljs-function">(<span class="hljs-params">data</span>) =&gt;</span> data,
    <span class="hljs-attr">validate</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-literal">true</span>,
    <span class="hljs-attr">execute</span>: <span class="hljs-function">() =&gt;</span> {},
  };
  
  <span class="hljs-comment">// åœºæ™¯ç‰¹å®šçš„ç­–ç•¥å¢å¼º</span>
  <span class="hljs-keyword">const</span> enhancements = {
    <span class="hljs-attr">admin</span>: {
      <span class="hljs-attr">format</span>: <span class="hljs-function">(<span class="hljs-params">data</span>) =&gt;</span> <span class="hljs-title function_">enrichAdminData</span>(data),
      <span class="hljs-attr">validate</span>: <span class="hljs-function">(<span class="hljs-params">action</span>) =&gt;</span> <span class="hljs-title function_">checkAdminPermissions</span>(action),
      <span class="hljs-attr">execute</span>: <span class="hljs-function">(<span class="hljs-params">action</span>) =&gt;</span> {
        <span class="hljs-title function_">logAdminAction</span>(action);
        <span class="hljs-keyword">return</span> <span class="hljs-title function_">performAdminAction</span>(action);
      },
    },
    <span class="hljs-attr">mobile</span>: {
      <span class="hljs-attr">format</span>: <span class="hljs-function">(<span class="hljs-params">data</span>) =&gt;</span> <span class="hljs-title function_">optimizeForMobile</span>(data),
      <span class="hljs-attr">validate</span>: <span class="hljs-function">(<span class="hljs-params">action</span>) =&gt;</span> <span class="hljs-title function_">checkNetworkStatus</span>(),
      <span class="hljs-attr">execute</span>: <span class="hljs-keyword">async</span> (action) =&gt; {
        <span class="hljs-keyword">if</span> (<span class="hljs-title function_">isOffline</span>()) {
          <span class="hljs-keyword">return</span> <span class="hljs-title function_">queueAction</span>(action);
        }
        <span class="hljs-keyword">return</span> <span class="hljs-title function_">performOnlineAction</span>(action);
      },
    },
  };
  
  <span class="hljs-comment">// ç­–ç•¥ç»„åˆï¼šå¯ä»¥æ··åˆå¤šä¸ªåœºæ™¯çš„ç‰¹æ€§</span>
  <span class="hljs-keyword">return</span> <span class="hljs-title function_">composeStrategies</span>(
    baseStrategy,
    enhancements[scene],
    options.<span class="hljs-property">customStrategies</span>
  );
};

<span class="hljs-comment">// ç­–ç•¥ç»„åˆå™¨</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">composeStrategies</span> = (<span class="hljs-params">...strategies</span>) =&gt; {
  <span class="hljs-keyword">return</span> strategies.<span class="hljs-title function_">reduce</span>(<span class="hljs-function">(<span class="hljs-params">combined, current</span>) =&gt;</span> {
    <span class="hljs-keyword">return</span> {
      ...combined,
      ...current,
      <span class="hljs-comment">// ç‰¹æ®Šçš„ç»„åˆé€»è¾‘</span>
      <span class="hljs-attr">format</span>: <span class="hljs-function">(<span class="hljs-params">data</span>) =&gt;</span> {
        <span class="hljs-keyword">const</span> prevResult = combined.<span class="hljs-title function_">format</span>(data);
        <span class="hljs-keyword">return</span> current.<span class="hljs-property">format</span> ? current.<span class="hljs-title function_">format</span>(prevResult) : prevResult;
      },
    };
  });
};
</code></pre>
<h3 data-id="heading-21">ä¼˜åŠ¿ä¸è€ƒé‡</h3>
<h4 data-id="heading-22">ä¼˜åŠ¿ï¼š</h4>
<ol>
<li>é€»è¾‘ä¸UIè§£è€¦ï¼šä¸šåŠ¡é€»è¾‘å¯ä»¥ç‹¬ç«‹æµ‹è¯•</li>
<li>ç­–ç•¥å¯æ›¿æ¢ï¼šè½»æ¾åˆ‡æ¢ä¸åŒåœºæ™¯çš„é€»è¾‘</li>
<li>ä»£ç å¤ç”¨ï¼šç›¸ä¼¼é€»è¾‘å¯ä»¥åœ¨ä¸åŒç­–ç•¥é—´å…±äº«</li>
</ol>
<h4 data-id="heading-23">è€ƒé‡ï¼š</h4>
<ol>
<li>éœ€è¦è‰¯å¥½è®¾è®¡çš„ç­–ç•¥æ¥å£</li>
<li>ç­–ç•¥ä¹‹é—´å¯èƒ½å­˜åœ¨é‡å¤ä»£ç </li>
</ol>
<h3 data-id="heading-24">æœ€ä½³å®è·µå»ºè®®</h3>
<ol>
<li><strong>ç­–ç•¥æ¥å£æ ‡å‡†åŒ–</strong>ï¼šå®šä¹‰ç»Ÿä¸€çš„ç­–ç•¥æ¥å£ï¼Œç¡®ä¿ä¸åŒç­–ç•¥ä¹‹é—´å¯ä»¥æ— ç¼æ›¿æ¢</li>
<li><strong>ç­–ç•¥å·¥å‚ç®¡ç†</strong>ï¼šä½¿ç”¨ç­–ç•¥å·¥å‚ç»Ÿä¸€åˆ›å»ºå’Œç®¡ç†ç­–ç•¥å®ä¾‹</li>
<li><strong>ä¾èµ–æ³¨å…¥</strong>ï¼šé€šè¿‡ä¾èµ–æ³¨å…¥è§£è€¦ç­–ç•¥çš„å…·ä½“å®ç°ï¼Œä¾¿äºæµ‹è¯•å’Œç»´æŠ¤</li>
<li><strong>ç­–ç•¥ç»„åˆ</strong>ï¼šæ”¯æŒç­–ç•¥çš„ç»„åˆä½¿ç”¨ï¼Œæé«˜ä»£ç å¤ç”¨æ€§</li>
</ol>
<h2 data-id="heading-25">å››ã€Render Props + ç»„ä»¶æ³¨å…¥ï¼šæè‡´çµæ´»æ€§çš„é€‰æ‹©</h2>
<h3 data-id="heading-26">é€‚ç”¨åœºæ™¯ï¼šéœ€è¦é«˜åº¦å®šåˆ¶åŒ–çš„å¼€æ”¾å¹³å°</h3>
<p>å½“ä½ è®¾è®¡çš„ç»„ä»¶éœ€è¦è¢«<strong>ä¸åŒå›¢é˜Ÿç”šè‡³ä¸åŒå…¬å¸ä½¿ç”¨</strong>ï¼Œä¸”ä»–ä»¬å¯èƒ½æœ‰å®Œå…¨ä¸åŒçš„UIéœ€æ±‚å’Œäº¤äº’æ¨¡å¼æ—¶ï¼ŒRender Propsæä¾›äº†æœ€å¤§ç¨‹åº¦çš„çµæ´»æ€§ã€‚</p>
<pre><code class="hljs language-mermaid" lang="mermaid">graph TD
    A[FlexibleComponent] --&gt; B[æ¸²æŸ“ä¸Šä¸‹æ–‡]
    A --&gt; C[æ•°æ®çŠ¶æ€]
    A --&gt; D[æ“ä½œæ–¹æ³•]
    
    B --&gt; E{æ¸²æŸ“æ¨¡å¼é€‰æ‹©}
    
    E --&gt; F[Render Propsæ¨¡å¼]
    E --&gt; G[Childrenæ¨¡å¼]
    E --&gt; H[ç»„ä»¶æ³¨å…¥æ¨¡å¼]
    
    F --&gt; I[å‡½æ•°å¼æ¸²æŸ“]
    G --&gt; J[å£°æ˜å¼æ¸²æŸ“]
    H --&gt; K[ç»„ä»¶å¼æ¸²æŸ“]
    
    I --&gt; L[å®Œå…¨æ§åˆ¶UI]
    J --&gt; M[éƒ¨åˆ†å®šåˆ¶]
    K --&gt; N[æ›¿æ¢ç»„ä»¶]
    
    subgraph "ä½¿ç”¨ç¤ºä¾‹"
        O[åå°ç³»ç»Ÿ] --&gt; L
        P[è¥é”€é¡µé¢] --&gt; M
        Q[ç¬¬ä¸‰æ–¹é›†æˆ] --&gt; N
    end
</code></pre>
<h3 data-id="heading-27">è®¾è®¡å“²å­¦ï¼šæ§åˆ¶åè½¬ä¸ä¾èµ–æ³¨å…¥</h3>
<p>Render Propsæ¨¡å¼å®ç°äº†<strong>æ§åˆ¶åè½¬</strong>â€”â€”å°†UIæ¸²æŸ“çš„æ§åˆ¶æƒäº¤ç»™ä½¿ç”¨è€…ï¼Œè€Œç»„ä»¶æœ¬èº«åªè´Ÿè´£æä¾›æ•°æ®å’ŒçŠ¶æ€ç®¡ç†ã€‚</p>
<h3 data-id="heading-28">å¤šæ¨¡å¼å…¼å®¹è®¾è®¡</h3>
<pre><code class="hljs language-jsx" lang="jsx"><span class="hljs-comment">// æ”¯æŒå¤šç§ä½¿ç”¨æ–¹å¼çš„çµæ´»ç»„ä»¶</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">UniversalComponent</span> = (<span class="hljs-params">props</span>) =&gt; {
  <span class="hljs-keyword">const</span> {
    <span class="hljs-comment">// æ¨¡å¼1: render props</span>
    render,
    
    <span class="hljs-comment">// æ¨¡å¼2: ç»„ä»¶æ³¨å…¥</span>
    components = {},
    
    <span class="hljs-comment">// æ¨¡å¼3: æ’æ§½ç³»ç»Ÿ</span>
    children,
    slots = {},
    
    <span class="hljs-comment">// æ¨¡å¼4: é…ç½®é©±åŠ¨</span>
    config,
    
    <span class="hljs-comment">// å…±äº«çš„çŠ¶æ€å’Œæ•°æ®</span>
    data,
    state,
    actions,
    context,
  } = <span class="hljs-title function_">useUniversalComponentLogic</span>(props);
  
  <span class="hljs-comment">// æ¸²æŸ“ç­–ç•¥ï¼šä¼˜å…ˆçº§é¡ºåº</span>
  <span class="hljs-keyword">const</span> <span class="hljs-title function_">renderContent</span> = (<span class="hljs-params"/>) =&gt; {
    <span class="hljs-comment">// æœ€é«˜ä¼˜å…ˆçº§ï¼šrender props</span>
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> render === <span class="hljs-string">'function'</span>) {
      <span class="hljs-keyword">return</span> <span class="hljs-title function_">render</span>({ data, state, actions, context });
    }
    
    <span class="hljs-comment">// ç¬¬äºŒä¼˜å…ˆçº§ï¼šç»„ä»¶æ³¨å…¥</span>
    <span class="hljs-keyword">if</span> (components.<span class="hljs-property">Content</span>) {
      <span class="hljs-keyword">const</span> <span class="hljs-title class_">ContentComponent</span> = components.<span class="hljs-property">Content</span>;
      <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">ContentComponent</span> <span class="hljs-attr">data</span>=<span class="hljs-string">{data}</span> <span class="hljs-attr">actions</span>=<span class="hljs-string">{actions}</span> /&gt;</span></span>;
    }
    
    <span class="hljs-comment">// ç¬¬ä¸‰ä¼˜å…ˆçº§ï¼šæ’æ§½ç³»ç»Ÿ</span>
    <span class="hljs-keyword">if</span> (slots.<span class="hljs-property">content</span>) {
      <span class="hljs-keyword">return</span> slots.<span class="hljs-property">content</span>;
    }
    
    <span class="hljs-comment">// ç¬¬å››ä¼˜å…ˆçº§ï¼šé»˜è®¤æ¸²æŸ“ + children</span>
    <span class="hljs-keyword">return</span> children || <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">DefaultContent</span> <span class="hljs-attr">data</span>=<span class="hljs-string">{data}</span> <span class="hljs-attr">config</span>=<span class="hljs-string">{config}</span> /&gt;</span></span>;
  };
  
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">UniversalContext.Provider</span> <span class="hljs-attr">value</span>=<span class="hljs-string">{context}</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">{</span>`<span class="hljs-attr">universal-component</span> ${<span class="hljs-attr">config</span>?<span class="hljs-attr">.theme</span> || '<span class="hljs-attr">default</span>'}`}&gt;</span>
        {/* å¤´éƒ¨æ¸²æŸ“ç­–ç•¥ */}
        {components.Header || slots.header ? (
          components.Header ? 
            <span class="hljs-tag">&lt;<span class="hljs-name">components.Header</span> /&gt;</span> : slots.header
        ) : (
          <span class="hljs-tag">&lt;<span class="hljs-name">DefaultHeader</span> /&gt;</span>
        )}
        
        {/* å†…å®¹åŒºåŸŸ */}
        <span class="hljs-tag">&lt;<span class="hljs-name">main</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"content-area"</span>&gt;</span>
          {renderContent()}
        <span class="hljs-tag">&lt;/<span class="hljs-name">main</span>&gt;</span>
        
        {/* åº•éƒ¨åŒºåŸŸ */}
        {config?.showFooter !== false &amp;&amp; (
          components.Footer || slots.footer ? (
            components.Footer ?
              <span class="hljs-tag">&lt;<span class="hljs-name">components.Footer</span> /&gt;</span> : slots.footer
          ) : (
            <span class="hljs-tag">&lt;<span class="hljs-name">DefaultFooter</span> <span class="hljs-attr">actions</span>=<span class="hljs-string">{actions}</span> /&gt;</span>
          )
        )}
      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">UniversalContext.Provider</span>&gt;</span></span>
  );
};

<span class="hljs-comment">// å¤šæ ·çš„ä½¿ç”¨æ–¹å¼</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">Example1</span> = (<span class="hljs-params"/>) =&gt; (
  <span class="hljs-comment">// æ–¹å¼1: render propsï¼ˆæœ€å¤§çµæ´»æ€§ï¼‰</span>
  <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">UniversalComponent</span>
    <span class="hljs-attr">data</span>=<span class="hljs-string">{data}</span>
    <span class="hljs-attr">render</span>=<span class="hljs-string">{({</span> <span class="hljs-attr">data</span>, <span class="hljs-attr">actions</span> }) =&gt;</span> (
      <span class="hljs-tag">&lt;<span class="hljs-name">CustomLayout</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">CustomHeader</span> <span class="hljs-attr">title</span>=<span class="hljs-string">"è‡ªå®šä¹‰æ ‡é¢˜"</span> /&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">CustomContent</span> <span class="hljs-attr">data</span>=<span class="hljs-string">{data}</span> <span class="hljs-attr">onAction</span>=<span class="hljs-string">{actions.handleAction}</span> /&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">CustomLayout</span>&gt;</span>
    )}
  /&gt;</span>
);

<span class="hljs-keyword">const</span> <span class="hljs-title function_">Example2</span> = (<span class="hljs-params"/>) =&gt; (
  <span class="hljs-comment">// æ–¹å¼2: ç»„ä»¶æ³¨å…¥ï¼ˆç±»å‹å®‰å…¨ï¼‰</span>
  <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">UniversalComponent</span>
    <span class="hljs-attr">data</span>=<span class="hljs-string">{data}</span>
    <span class="hljs-attr">components</span>=<span class="hljs-string">{{</span>
      <span class="hljs-attr">Header:</span> <span class="hljs-attr">CustomHeader</span>,
      <span class="hljs-attr">Content:</span> <span class="hljs-attr">CustomContent</span>,
      <span class="hljs-attr">Footer:</span> <span class="hljs-attr">CustomFooter</span>,
    }}
  /&gt;</span></span>
);

<span class="hljs-keyword">const</span> <span class="hljs-title function_">Example3</span> = (<span class="hljs-params"/>) =&gt; (
  <span class="hljs-comment">// æ–¹å¼3: æ’æ§½ç³»ç»Ÿï¼ˆç±»ä¼¼Vueçš„æ’æ§½ï¼‰</span>
  <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">UniversalComponent</span> <span class="hljs-attr">data</span>=<span class="hljs-string">{data}</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">template</span> <span class="hljs-attr">slot</span>=<span class="hljs-string">"header"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">CustomHeader</span> /&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">main</span>&gt;</span>
      è¿™é‡Œæ˜¯è‡ªå®šä¹‰å†…å®¹
    <span class="hljs-tag">&lt;/<span class="hljs-name">main</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">UniversalComponent</span>&gt;</span></span>
);
</code></pre>
<h3 data-id="heading-29">ä¼˜åŠ¿ä¸è€ƒé‡</h3>
<h4 data-id="heading-30">ä¼˜åŠ¿ï¼š</h4>
<ol>
<li>æè‡´çµæ´»æ€§ï¼šå…è®¸ä½¿ç”¨è€…å®Œå…¨æ§åˆ¶ç»„ä»¶æ¸²æŸ“ï¼Œé€‚åº”é«˜åº¦å®šåˆ¶åŒ–éœ€æ±‚</li>
<li>é€»è¾‘ä¸UIå®Œå…¨åˆ†ç¦»ï¼šç»„ä»¶ä¸“æ³¨äºä¸šåŠ¡é€»è¾‘ï¼ŒUIæ¸²æŸ“å®Œå…¨å¯è‡ªå®šä¹‰</li>
<li>æ¸è¿›å¼é‡‡ç”¨ï¼šæä¾›é»˜è®¤æ¸²æŸ“å®ç°ï¼Œå¯æŒ‰éœ€é€æ­¥æ›¿æ¢ç‰¹å®šéƒ¨åˆ†</li>
<li>ç»„ä»¶å¤ç”¨æ€§é«˜ï¼šåŒä¸€ä¸šåŠ¡ç»„ä»¶å¯åœ¨ä¸åŒé¡¹ç›®ã€æŠ€æœ¯æ ˆä¸­å¤ç”¨</li>
<li>ç±»å‹å®‰å…¨æ€§å¼ºï¼šç»“åˆTypeScriptå¯ç²¾ç¡®å£°æ˜æ¸²æŸ“å‡½æ•°ç±»å‹</li>
</ol>
<h4 data-id="heading-31">è€ƒé‡ï¼š</h4>
<ol>
<li>ä½¿ç”¨å¤æ‚åº¦é«˜ï¼šéœ€è¦æ·±å…¥ç†è§£ç»„ä»¶çŠ¶æ€é€»è¾‘ï¼Œå¯¹å¼€å‘è€…è¦æ±‚è¾ƒé«˜</li>
<li>æ€§èƒ½ä¼˜åŒ–å›°éš¾ï¼šæ¸²æŸ“å‡½æ•°å®¹æ˜“å¯¼è‡´ä¸å¿…è¦çš„é‡æ–°æ¸²æŸ“</li>
<li>ä»£ç å†—ä½™é£é™©ï¼šç›¸ä¼¼UIåœ¨ä¸åŒåœºæ™¯ä¸­å¯èƒ½å¯¼è‡´ä»£ç é‡å¤</li>
<li>è°ƒè¯•å¤æ‚åº¦å¢åŠ ï¼šæ¸²æŸ“é€»è¾‘åˆ†æ•£ï¼Œè°ƒè¯•éœ€è¦è¿½è¸ªå¤šä¸ªè°ƒç”¨é“¾</li>
<li>APIå¤æ‚åº¦é«˜ï¼šä¸ºæä¾›çµæ´»æ€§éœ€æš´éœ²å¤§é‡çŠ¶æ€å’Œæ–¹æ³•</li>
</ol>
<h3 data-id="heading-32">æœ€ä½³å®è·µå»ºè®®</h3>
<ol>
<li><strong>æ¸²æŸ“å‡½æ•°è®°å¿†åŒ–</strong>ï¼šä½¿ç”¨useCallbackåŒ…è£…æ¸²æŸ“å‡½æ•°ï¼Œé¿å…ä¸å¿…è¦çš„é‡æ–°æ¸²æŸ“</li>
<li><strong>é»˜è®¤ç»„ä»¶é›†</strong>ï¼šæä¾›ä¸€å¥—é»˜è®¤çš„ç»„ä»¶å®ç°ï¼Œç®€åŒ–åŸºç¡€ä½¿ç”¨</li>
<li><strong>ç±»å‹å®‰å…¨å£°æ˜</strong>ï¼šä½¿ç”¨TypeScriptç²¾ç¡®å£°æ˜æ¸²æŸ“å‡½æ•°å’Œç»„ä»¶æ³¨å…¥çš„propsç±»å‹</li>
<li><strong>æ€§èƒ½ç›‘æ§</strong>ï¼šç›‘æ§æ¸²æŸ“æ€§èƒ½ï¼Œé¿å…å› è¿‡åº¦çµæ´»å¯¼è‡´çš„æ€§èƒ½é—®é¢˜</li>
</ol>
<h2 data-id="heading-33">äº”ã€å†³ç­–æµç¨‹å›¾ï¼šå¦‚ä½•é€‰æ‹©é€‚åˆçš„æ–¹æ¡ˆ</h2>
<p>é¢å¯¹å¤šåœºæ™¯å¤ç”¨éœ€æ±‚æ—¶ï¼Œå¦‚ä½•é€‰æ‹©æœ€åˆé€‚çš„æ–¹æ¡ˆï¼Ÿä¸‹é¢çš„å†³ç­–æµç¨‹å›¾å¯ä»¥å¸®åŠ©ä½ åšå‡ºæ˜æ™ºçš„é€‰æ‹©ï¼š</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2dba44358dbf4afdb88a4546a2733658~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6JOd55Gf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765794173&amp;x-signature=SQmFzJ6QBNPay8bYkfSG8E4e5Vg%3D" alt="deepseek_mermaid_20251204_079e14.png" loading="lazy"/></p>
<h3 data-id="heading-34">æ··åˆæ¨¡å¼ï¼šç°å®é¡¹ç›®çš„æœ€ä½³å®è·µ</h3>
<p>åœ¨å®é™…çš„å¤§å‹é¡¹ç›®ä¸­ï¼Œå•ä¸€æ¨¡å¼å¾€å¾€éš¾ä»¥åº”å¯¹æ‰€æœ‰åœºæ™¯ã€‚èªæ˜çš„åšæ³•æ˜¯<strong>ç»„åˆä½¿ç”¨å¤šç§æ¨¡å¼</strong>ï¼Œå‘æŒ¥å„è‡ªçš„ä¼˜åŠ¿ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// æ··åˆæ¨¡å¼ç¤ºä¾‹ï¼šé…ç½®é©±åŠ¨ + ç­–ç•¥æ¨¡å¼ + å¤åˆç»„ä»¶</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">HybridBusinessComponent</span> = (<span class="hljs-params">{ scene, config, children }</span>) =&gt; {
  <span class="hljs-comment">// 1. é…ç½®é©±åŠ¨ï¼šå¤„ç†ç®€å•çš„å·®å¼‚</span>
  <span class="hljs-keyword">const</span> baseConfig = <span class="hljs-title function_">useMemo</span>(<span class="hljs-function">() =&gt;</span> 
    <span class="hljs-title function_">mergeConfigs</span>(<span class="hljs-variable constant_">DEFAULT_CONFIG</span>, <span class="hljs-variable constant_">SCENE_CONFIGS</span>[scene], config)
  , [scene, config]);
  
  <span class="hljs-comment">// 2. ç­–ç•¥æ¨¡å¼ï¼šå¤„ç†å¤æ‚çš„ä¸šåŠ¡é€»è¾‘å·®å¼‚</span>
  <span class="hljs-keyword">const</span> strategy = <span class="hljs-title function_">useBusinessStrategy</span>(scene, {
    <span class="hljs-attr">data</span>: baseConfig.<span class="hljs-property">data</span>,
    <span class="hljs-attr">features</span>: baseConfig.<span class="hljs-property">features</span>,
  });
  
  <span class="hljs-comment">// 3. å¤åˆç»„ä»¶ï¼šæä¾›çµæ´»çš„UIç»„åˆ</span>
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">BusinessContainer</span>
      <span class="hljs-attr">variant</span>=<span class="hljs-string">{scene}</span>
      <span class="hljs-attr">config</span>=<span class="hljs-string">{baseConfig}</span>
      <span class="hljs-attr">contextValue</span>=<span class="hljs-string">{strategy}</span>
    &gt;</span>
      {baseConfig.customHeader ? (
        <span class="hljs-tag">&lt;<span class="hljs-name">BusinessContainer.Header</span>&gt;</span>
          {baseConfig.customHeader}
        <span class="hljs-tag">&lt;/<span class="hljs-name">BusinessContainer.Header</span>&gt;</span>
      ) : null}
      
      <span class="hljs-tag">&lt;<span class="hljs-name">BusinessContainer.Content</span>&gt;</span>
        {children || (
          <span class="hljs-tag">&lt;<span class="hljs-name">BusinessContent</span>
            <span class="hljs-attr">data</span>=<span class="hljs-string">{strategy.data}</span>
            <span class="hljs-attr">renderItem</span>=<span class="hljs-string">{baseConfig.renderItem}</span>
            <span class="hljs-attr">onAction</span>=<span class="hljs-string">{strategy.handleAction}</span>
          /&gt;</span>
        )}
      <span class="hljs-tag">&lt;/<span class="hljs-name">BusinessContainer.Content</span>&gt;</span>
      
      {baseConfig.showActions &amp;&amp; (
        <span class="hljs-tag">&lt;<span class="hljs-name">BusinessContainer.Actions</span>
          <span class="hljs-attr">actions</span>=<span class="hljs-string">{strategy.getAvailableActions()}</span>
          <span class="hljs-attr">onAction</span>=<span class="hljs-string">{strategy.executeAction}</span>
        /&gt;</span>
      )}
    <span class="hljs-tag">&lt;/<span class="hljs-name">BusinessContainer</span>&gt;</span></span>
  );
};
</code></pre>
<h2 data-id="heading-35">æ€»ç»“ï¼šç»„ä»¶è®¾è®¡çš„å¹³è¡¡è‰ºæœ¯</h2>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/54134aedceba4850976716b02891c4fd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6JOd55Gf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765794173&amp;x-signature=yaEJ8rKaBrxYmfjQifHmJ%2BbmdA0%3D" alt="Balance-The-Principles-of-Art.jpg" loading="lazy"/></p>
<p>å¤šåœºæ™¯ä¸šåŠ¡ç»„ä»¶çš„è®¾è®¡æœ¬è´¨ä¸Šæ˜¯ä¸€åœº<strong>å¹³è¡¡çš„è‰ºæœ¯</strong>ï¼Œéœ€è¦åœ¨å¤šä¸ªç»´åº¦ä¸­æ‰¾åˆ°æœ€ä½³å¹³è¡¡ç‚¹ï¼š</p>
<ol>
<li><strong>çµæ´»æ€§ä¸æ˜“ç”¨æ€§çš„å¹³è¡¡</strong>ï¼šæ—¢è¦è¶³å¤Ÿçµæ´»ä»¥é€‚åº”å„ç§åœºæ™¯ï¼Œåˆè¦å¯¹ä½¿ç”¨è€…ç®€å•å‹å¥½</li>
<li><strong>ä¸€è‡´æ€§ä¸ç‰¹å¼‚æ€§çš„å¹³è¡¡</strong>ï¼šä¿æŒæ ¸å¿ƒä½“éªŒä¸€è‡´ï¼ŒåŒæ—¶å…è®¸å¿…è¦çš„åœºæ™¯å®šåˆ¶</li>
<li><strong>æŠ½è±¡ç¨‹åº¦ä¸æ€§èƒ½çš„å¹³è¡¡</strong>ï¼šè¿‡åº¦æŠ½è±¡ä¼šå¢åŠ å¤æ‚åº¦ï¼Œä¸è¶³æŠ½è±¡ä¼šå¯¼è‡´ä»£ç é‡å¤</li>
<li><strong>å½“å‰éœ€æ±‚ä¸æœªæ¥æ‰©å±•çš„å¹³è¡¡</strong>ï¼šä¸ºæœªæ¥å˜åŒ–ç•™å‡ºç©ºé—´ï¼Œä½†ä¸è¿‡åº¦è®¾è®¡</li>
</ol>
<blockquote>
<p><strong>ä¸€äº›åŸåˆ™</strong></p>
<ol>
<li>
<p><strong>éµå¾ªå¼€æ”¾å°é—­åŸåˆ™</strong>ï¼šå¯¹æ‰©å±•å¼€æ”¾ï¼Œå¯¹ä¿®æ”¹å°é—­</p>
</li>
<li>
<p><strong>ä¿æŒå•ä¸€èŒè´£</strong>ï¼šæ¯ä¸ªç»„ä»¶/æ¨¡å—åªåšä¸€ä»¶äº‹</p>
</li>
<li>
<p><strong>æä¾›æ˜ç¡®æ¥å£</strong>ï¼šæ¸…æ™°çš„APIå’Œç±»å‹å®šä¹‰</p>
</li>
<li>
<p><strong>æ”¯æŒæ¸è¿›å¢å¼º</strong>ï¼šä»ç®€å•åœºæ™¯å¼€å§‹ï¼Œé€æ­¥æ”¯æŒå¤æ‚åœºæ™¯</p>
</li>
<li>
<p><strong>æ³¨é‡å¼€å‘è€…ä½“éªŒ</strong>ï¼šè‰¯å¥½çš„æ–‡æ¡£å’Œé”™è¯¯æç¤º</p>
</li>
</ol>
</blockquote>
<p><strong>æœ€å¥½çš„è®¾è®¡ä¸æ˜¯æœ€å¤æ‚çš„è®¾è®¡ï¼Œè€Œæ˜¯æœ€é€‚åˆå›¢é˜Ÿå’Œé¡¹ç›®çš„è®¾è®¡ã€‚</strong> ä»ç®€å•çš„é…ç½®é©±åŠ¨å¼€å§‹ï¼Œéšç€åœºæ™¯å¤æ‚åº¦çš„å¢åŠ é€æ­¥å¼•å…¥æ›´é«˜çº§çš„æ¨¡å¼ï¼Œè¿™ç§æ¸è¿›å¼çš„æ¼”è¿›å¾€å¾€èƒ½å¸¦æ¥æœ€å¥åº·çš„ä»£ç baseã€‚</p>
<p>æœ€ç»ˆï¼Œä¼˜ç§€çš„ç»„ä»¶è®¾è®¡ä¸ä»…è®©ä»£ç æ›´æ˜“äºç»´æŠ¤å’Œæ‰©å±•ï¼Œæ›´é‡è¦çš„æ˜¯<strong>æå‡å›¢é˜Ÿçš„å¼€å‘æ•ˆç‡å’Œåä½œä½“éªŒ</strong>ã€‚å½“æ–°æˆå‘˜èƒ½å¤Ÿå¿«é€Ÿç†è§£å¦‚ä½•ä½¿ç”¨å’Œæ‰©å±•ç»„ä»¶ï¼Œå½“äº§å“éœ€æ±‚å˜åŒ–æ—¶ç»„ä»¶èƒ½å¤Ÿçµæ´»é€‚åº”ï¼Œå½“ä½ è‡ªå·±å‡ ä¸ªæœˆåå›å¤´çœ‹ä»£ç ä»ç„¶æ¸…æ™°æ˜“æ‡‚â€”â€”è¿™å°±æ˜¯æˆåŠŸçš„ç»„ä»¶è®¾è®¡å¸¦æ¥çš„çœŸæ­£ä»·å€¼ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[MFCæ ¸å¿ƒæ¶æ„æ·±åº¦è§£æ]]></title>    <link>https://juejin.cn/post/7581097111896277046</link>    <guid>https://juejin.cn/post/7581097111896277046</guid>    <pubDate>2025-12-08T10:28:39.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581097111896277046" data-draft-id="7581210455827365924" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="MFCæ ¸å¿ƒæ¶æ„æ·±åº¦è§£æ"/> <meta itemprop="keywords" content="åç«¯"/> <meta itemprop="datePublished" content="2025-12-08T10:28:39.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ç äº‹æ¼«è°ˆ"/> <meta itemprop="url" content="https://juejin.cn/user/1972974802965230"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            MFCæ ¸å¿ƒæ¶æ„æ·±åº¦è§£æ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1972974802965230/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ç äº‹æ¼«è°ˆ
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-08T10:28:39.000Z" title="Mon Dec 08 2025 10:28:39 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»42åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>å°½ç®¡MFCï¼ˆMicrosoft Foundation Classesï¼‰å¸¸è¢«è§†ä¸ºâ€œè¿‡æ—¶â€çš„é—ç•™æŠ€æœ¯ï¼Œä½†å…¶è®¾è®¡æ€æƒ³å¯¹ç†è§£Windowsç¼–ç¨‹æœ¬è´¨å’Œæ¡†æ¶è®¾è®¡å“²å­¦ä»å…·é‡è¦ä»·å€¼ã€‚ä½œä¸ºä¸€å¥—ç»å…¸çš„C++æ¡†æ¶ï¼ŒMFCæˆåŠŸå°†è¿‡ç¨‹å¼çš„Win32 APIå°è£…ä¸ºé¢å‘å¯¹è±¡çš„ç±»åº“ï¼Œå…¶æ¶ˆæ¯æ˜ å°„æœºåˆ¶å’Œæ–‡æ¡£/è§†å›¾æ¶æ„ä½“ç°äº†æ—©æœŸæ¡†æ¶è®¾è®¡è€…å¯¹è½¯ä»¶å¤æ‚æ€§çš„æ·±åˆ»æ€è€ƒã€‚æœ¬æ–‡æ—¨åœ¨ç³»ç»Ÿæ€§å‰–æMFCçš„æ ¸å¿ƒæ¶æ„ï¼Œä¸ºå¼€å‘è€…æä¾›ä¸€ä¸ªç»“æ„åŒ–çš„è®¤çŸ¥æ¡†æ¶ã€‚</p>
<h2 data-id="heading-0">ç¬¬ä¸€ç« ï¼šMFCçš„æ¶ˆæ¯æ˜ å°„æœºåˆ¶â€”â€”Windowsäº‹ä»¶é©±åŠ¨çš„é©å‘½æ€§å°è£…</h2>
<h3 data-id="heading-1">ä¸€ã€Win32 SDKçš„åŸå§‹å›°å¢ƒï¼šé›†ä¸­å¼æ¶ˆæ¯å¤„ç†çš„å¤æ‚æ€§</h3>
<p>åœ¨æ·±å…¥ç†è§£MFCçš„æ¶ˆæ¯æ˜ å°„ä¹‹å‰ï¼Œå¿…é¡»é¦–å…ˆå®¡è§†ä¼ ç»ŸWin32 SDKç¼–ç¨‹çš„æ¶ˆæ¯å¤„ç†æ¨¡å¼ã€‚è¿™ç§æ¨¡å¼çš„æ ¸å¿ƒæ˜¯ä¸€ä¸ªé›†ä¸­å¼çš„çª—å£è¿‡ç¨‹å‡½æ•°ï¼ˆWindow Procedureï¼Œç®€ç§°WndProcï¼‰ï¼Œå®ƒæ¥æ”¶å¹¶å¤„ç†å‘é€åˆ°çª—å£çš„æ‰€æœ‰æ¶ˆæ¯ã€‚</p>
<p>å…¸å‹çš„Win32 SDKæ¶ˆæ¯å¤„ç†ä»£ç å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-function">LRESULT CALLBACK <span class="hljs-title">WndProc</span><span class="hljs-params">(HWND hWnd, UINT message, WPARAM wParam, LPARAM lParam)</span>
</span>{
    <span class="hljs-keyword">switch</span> (message)
    {
        <span class="hljs-keyword">case</span> WM_PAINT:
        {
            PAINTSTRUCT ps;
            HDC hdc = <span class="hljs-built_in">BeginPaint</span>(hWnd, &amp;ps);
            <span class="hljs-comment">// ç»˜å›¾ä»£ç ...</span>
            <span class="hljs-built_in">EndPaint</span>(hWnd, &amp;ps);
        }
        <span class="hljs-keyword">break</span>;
        
        <span class="hljs-keyword">case</span> WM_MOUSEMOVE:
        {
            <span class="hljs-type">int</span> xPos = <span class="hljs-built_in">LOWORD</span>(lParam);
            <span class="hljs-type">int</span> yPos = <span class="hljs-built_in">HIWORD</span>(lParam);
            <span class="hljs-comment">// å¤„ç†é¼ æ ‡ç§»åŠ¨...</span>
        }
        <span class="hljs-keyword">break</span>;
        
        <span class="hljs-keyword">case</span> WM_COMMAND:
        {
            <span class="hljs-type">int</span> wmId = <span class="hljs-built_in">LOWORD</span>(wParam);
            <span class="hljs-keyword">switch</span> (wmId)
            {
                <span class="hljs-keyword">case</span> IDM_FILE_OPEN:
                    <span class="hljs-comment">// å¤„ç†æ–‡ä»¶æ‰“å¼€...</span>
                    <span class="hljs-keyword">break</span>;
                <span class="hljs-keyword">case</span> IDM_FILE_SAVE:
                    <span class="hljs-comment">// å¤„ç†æ–‡ä»¶ä¿å­˜...</span>
                    <span class="hljs-keyword">break</span>;
                <span class="hljs-comment">// æ›´å¤šèœå•é¡¹...</span>
            }
        }
        <span class="hljs-keyword">break</span>;
        
        <span class="hljs-keyword">case</span> WM_DESTROY:
            <span class="hljs-built_in">PostQuitMessage</span>(<span class="hljs-number">0</span>);
            <span class="hljs-keyword">break</span>;
            
        <span class="hljs-keyword">default</span>:
            <span class="hljs-keyword">return</span> <span class="hljs-built_in">DefWindowProc</span>(hWnd, message, wParam, lParam);
    }
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}
</code></pre>
<p>è¿™ç§æ¨¡å¼å­˜åœ¨å‡ ä¸ªæ˜¾è‘—é—®é¢˜ï¼š</p>
<ol>
<li><strong>ä»£ç è†¨èƒ€</strong>ï¼šéšç€æ¶ˆæ¯ç±»å‹çš„å¢åŠ ï¼Œswitch-caseè¯­å¥å˜å¾—å¼‚å¸¸åºå¤§ï¼Œä¸€ä¸ªæˆç†Ÿçš„åº”ç”¨ç¨‹åºå¯èƒ½å¤„ç†æ•°ç™¾ç§æ¶ˆæ¯ç±»å‹ï¼Œå¯¼è‡´ä»£ç å¯è¯»æ€§æ€¥å‰§ä¸‹é™ã€‚</li>
<li><strong>é«˜åº¦è€¦åˆ</strong>ï¼šæ‰€æœ‰æ¶ˆæ¯å¤„ç†é€»è¾‘é›†ä¸­åœ¨å•ä¸€å‡½æ•°ä¸­ï¼Œä¸åŒç±»å‹çš„æ¶ˆæ¯å¤„ç†ä»£ç ç›¸äº’äº¤ç»‡ï¼Œéš¾ä»¥æ¨¡å—åŒ–ã€‚</li>
<li><strong>ç»´æŠ¤å›°éš¾</strong>ï¼šæ·»åŠ æ–°æ¶ˆæ¯å¤„ç†æˆ–ä¿®æ”¹ç°æœ‰é€»è¾‘æ—¶ï¼Œéœ€è¦åœ¨åºå¤§çš„switch-caseç»“æ„ä¸­å®šä½ï¼Œå®¹æ˜“å¼•å…¥é”™è¯¯ã€‚</li>
</ol>
<h3 data-id="heading-2">äºŒã€MFCçš„è§£å†³æ–¹æ¡ˆï¼šé¢å‘å¯¹è±¡çš„æ¶ˆæ¯æ˜ å°„æœºåˆ¶</h3>
<p>MFCçš„æ¶ˆæ¯æ˜ å°„æœºåˆ¶æ˜¯å¯¹ä¸Šè¿°é—®é¢˜çš„é©å‘½æ€§æ”¹è¿›ã€‚å®ƒåŸºäºä¸¤ä¸ªæ ¸å¿ƒè®¾è®¡åŸåˆ™ï¼š</p>
<ol>
<li><strong>åˆ†æ•£å¤„ç†</strong>ï¼šå°†æ¶ˆæ¯å¤„ç†åˆ†æ•£åˆ°å„ä¸ªçª—å£ç±»ä¸­ï¼Œæ¯ä¸ªç±»åªå¤„ç†ä¸è‡ªå·±ç›¸å…³çš„æ¶ˆæ¯ã€‚</li>
<li><strong>ç¼–è¯‘æ—¶ç»‘å®š</strong>ï¼šé€šè¿‡å®åœ¨ç¼–è¯‘æ—¶å»ºç«‹æ¶ˆæ¯åˆ°å¤„ç†å‡½æ•°çš„æ˜ å°„å…³ç³»ï¼Œé¿å…è¿è¡Œæ—¶çš„ç±»å‹åˆ¤æ–­å¼€é”€ã€‚</li>
</ol>
<h4 data-id="heading-3">2.1 æ¶ˆæ¯æ˜ å°„çš„å®ç°æœºåˆ¶</h4>
<p>æ¶ˆæ¯æ˜ å°„çš„å®ç°ä¾èµ–äºä¸€ç»„ç²¾å¿ƒè®¾è®¡çš„å®å’Œé™æ€æ•°æ®ç»“æ„ã€‚ä»¥ä¸‹æ˜¯å…¶æ ¸å¿ƒå®ç°æœºåˆ¶ï¼š</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-comment">// å…¸å‹çš„MFCç±»æ¶ˆæ¯æ˜ å°„å£°æ˜</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">CMyWnd</span> : <span class="hljs-keyword">public</span> CWnd
{
<span class="hljs-keyword">public</span>:
    <span class="hljs-built_in">CMyWnd</span>();
    
<span class="hljs-keyword">protected</span>:
    <span class="hljs-comment">// æ¶ˆæ¯å¤„ç†å‡½æ•°å£°æ˜</span>
    <span class="hljs-function">afx_msg <span class="hljs-type">void</span> <span class="hljs-title">OnPaint</span><span class="hljs-params">()</span></span>;
    <span class="hljs-function">afx_msg <span class="hljs-type">void</span> <span class="hljs-title">OnMouseMove</span><span class="hljs-params">(UINT nFlags, CPoint point)</span></span>;
    <span class="hljs-function">afx_msg <span class="hljs-type">void</span> <span class="hljs-title">OnFileOpen</span><span class="hljs-params">()</span></span>;
    
    <span class="hljs-comment">// å…³é”®ï¼šå£°æ˜æ¶ˆæ¯æ˜ å°„</span>
    <span class="hljs-built_in">DECLARE_MESSAGE_MAP</span>()
};

<span class="hljs-comment">// å®ç°æ–‡ä»¶ä¸­çš„æ¶ˆæ¯æ˜ å°„å®šä¹‰</span>
<span class="hljs-built_in">BEGIN_MESSAGE_MAP</span>(CMyWnd, CWnd)
    <span class="hljs-built_in">ON_WM_PAINT</span>()
    <span class="hljs-built_in">ON_WM_MOUSEMOVE</span>()
    <span class="hljs-built_in">ON_COMMAND</span>(ID_FILE_OPEN, &amp;CMyWnd::OnFileOpen)
<span class="hljs-built_in">END_MESSAGE_MAP</span>()
</code></pre>
<h4 data-id="heading-4">2.2 æ¶ˆæ¯æ˜ å°„è¡¨çš„å†…éƒ¨ç»“æ„</h4>
<p>å½“ç¼–è¯‘å™¨å¤„ç†ä¸Šè¿°ä»£ç æ—¶ï¼Œä¼šç”Ÿæˆç±»ä¼¼ä¸‹é¢çš„é™æ€æ•°æ®ç»“æ„ï¼š</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-comment">// æ¶ˆæ¯æ˜ å°„è¡¨æ¡ç›®ç»“æ„ï¼ˆç®€åŒ–ç‰ˆæœ¬ï¼‰</span>
<span class="hljs-keyword">struct</span> <span class="hljs-title class_">AFX_MSGMAP_ENTRY</span>
{
    UINT nMessage;      <span class="hljs-comment">// Windowsæ¶ˆæ¯ID</span>
    UINT nCode;         <span class="hljs-comment">// æ§ä»¶é€šçŸ¥ç æˆ–å…¶å®ƒ</span>
    UINT nID;           <span class="hljs-comment">// æ§ä»¶IDï¼ˆå‘½ä»¤æ¶ˆæ¯ç”¨ï¼‰</span>
    UINT nLastID;       <span class="hljs-comment">// æ§ä»¶IDèŒƒå›´ç»“æŸï¼ˆç”¨äºèŒƒå›´æ˜ å°„ï¼‰</span>
    UINT nSig;          <span class="hljs-comment">// å‡½æ•°ç­¾åç±»å‹</span>
    AFX_PMSG pfn;       <span class="hljs-comment">// æŒ‡å‘æˆå‘˜å‡½æ•°çš„æŒ‡é’ˆ</span>
};

<span class="hljs-comment">// ä¸ºCMyWndç±»ç”Ÿæˆçš„æ¶ˆæ¯æ˜ å°„è¡¨</span>
<span class="hljs-type">static</span> <span class="hljs-type">const</span> AFX_MSGMAP_ENTRY _messageEntries[] =
{
    <span class="hljs-comment">// æ ‡å‡†Windowsæ¶ˆæ¯</span>
    { WM_PAINT, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, AfxSig_vv, (AFX_PMSG)&amp;CMyWnd::OnPaint },
    { WM_MOUSEMOVE, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, AfxSig_vwp, (AFX_PMSG)&amp;CMyWnd::OnMouseMove },
    
    <span class="hljs-comment">// å‘½ä»¤æ¶ˆæ¯</span>
    { WM_COMMAND, <span class="hljs-number">0</span>, ID_FILE_OPEN, ID_FILE_OPEN, AfxSig_vv, 
      (AFX_PMSG)&amp;CMyWnd::OnFileOpen },
      
    <span class="hljs-comment">// ç»“æŸæ ‡è®°</span>
    { <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, AfxSig_end, (AFX_PMSG)<span class="hljs-number">0</span> }
};
</code></pre>
<h4 data-id="heading-5">2.3 æ¶ˆæ¯æ´¾å‘æµç¨‹</h4>
<p>MFCæ¡†æ¶çš„æ¶ˆæ¯æ´¾å‘è¿‡ç¨‹éµå¾ªæ˜ç¡®çš„ç®—æ³•ï¼š</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-comment">// ä¼ªä»£ç å±•ç¤ºMFCæ¶ˆæ¯æ´¾å‘é€»è¾‘</span>
<span class="hljs-function">LRESULT <span class="hljs-title">CWnd::WindowProc</span><span class="hljs-params">(UINT message, WPARAM wParam, LPARAM lParam)</span>
</span>{
    <span class="hljs-comment">// 1. è·å–å½“å‰ç±»çš„æ¶ˆæ¯æ˜ å°„è¡¨</span>
    <span class="hljs-type">const</span> AFX_MSGMAP* pMessageMap = <span class="hljs-built_in">GetMessageMap</span>();
    
    <span class="hljs-comment">// 2. æ²¿ç€ç»§æ‰¿é“¾å‘ä¸ŠæŸ¥æ‰¾æ¶ˆæ¯å¤„ç†å‡½æ•°</span>
    <span class="hljs-keyword">while</span> (pMessageMap != <span class="hljs-literal">NULL</span>)
    {
        <span class="hljs-comment">// åœ¨å½“å‰ç±»çš„æ¶ˆæ¯æ˜ å°„è¡¨ä¸­æŸ¥æ‰¾</span>
        <span class="hljs-type">const</span> AFX_MSGMAP_ENTRY* pEntries = pMessageMap-&gt;lpEntries;
        
        <span class="hljs-keyword">for</span> (; pEntries-&gt;nSig != AfxSig_end; pEntries++)
        {
            <span class="hljs-keyword">if</span> (pEntries-&gt;nMessage == message)
            {
                <span class="hljs-comment">// æ‰¾åˆ°åŒ¹é…é¡¹ï¼Œè°ƒç”¨å¤„ç†å‡½æ•°</span>
                <span class="hljs-keyword">union</span> <span class="hljs-title class_">MessageMapFunctions</span> mmf;
                mmf.pfn = pEntries-&gt;pfn;
                
                <span class="hljs-comment">// æ ¹æ®å‡½æ•°ç­¾åè°ƒç”¨ç›¸åº”çš„å¤„ç†å‡½æ•°</span>
                <span class="hljs-keyword">switch</span> (pEntries-&gt;nSig)
                {
                    <span class="hljs-keyword">case</span> AfxSig_vv:  <span class="hljs-comment">// void func(void)</span>
                        (<span class="hljs-keyword">this</span>-&gt;*mmf.pfn_vv)();
                        <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
                        
                    <span class="hljs-keyword">case</span> AfxSig_vwp: <span class="hljs-comment">// void func(UINT, CPoint)</span>
                        (<span class="hljs-keyword">this</span>-&gt;*mmf.pfn_vwp)(wParam, 
                                            <span class="hljs-built_in">CPoint</span>(<span class="hljs-built_in">GET_X_LPARAM</span>(lParam), 
                                                  <span class="hljs-built_in">GET_Y_LPARAM</span>(lParam)));
                        <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
                    <span class="hljs-comment">// æ›´å¤šå‡½æ•°ç­¾åå¤„ç†...</span>
                }
            }
        }
        
        <span class="hljs-comment">// 3. æœªæ‰¾åˆ°åˆ™ç»§ç»­åœ¨åŸºç±»ä¸­æŸ¥æ‰¾</span>
        pMessageMap = pMessageMap-&gt;pBaseMessageMap;
    }
    
    <span class="hljs-comment">// 4. æœªæ‰¾åˆ°ä»»ä½•å¤„ç†å‡½æ•°ï¼Œè°ƒç”¨é»˜è®¤çª—å£è¿‡ç¨‹</span>
    <span class="hljs-keyword">return</span> <span class="hljs-built_in">DefWindowProc</span>(message, wParam, lParam);
}
</code></pre>
<h3 data-id="heading-6">ä¸‰ã€æ¶ˆæ¯æ˜ å°„çš„åˆ†ç±»ä¸é«˜çº§ç‰¹æ€§</h3>
<h4 data-id="heading-7">3.1 å››ç±»æ¶ˆæ¯åŠå…¶å¤„ç†æ–¹å¼</h4>
<p>MFCå°†Windowsæ¶ˆæ¯ç³»ç»Ÿæ€§åœ°åˆ†ä¸ºå››ç±»ï¼Œæ¯ç±»æœ‰ä¸åŒçš„æ˜ å°„å®å’Œå¤„ç†æ¨¡å¼ï¼š</p>








































<table><thead><tr><th>æ¶ˆæ¯ç±»å‹</th><th>å…¸å‹ç¤ºä¾‹</th><th>æ˜ å°„å®</th><th>å¤„ç†å‡½æ•°ç‰¹å¾</th><th>åº”ç”¨åœºæ™¯</th></tr></thead><tbody><tr><td><strong>æ ‡å‡†Windowsæ¶ˆæ¯</strong></td><td>WM_PAINT, WM_SIZE</td><td><code>ON_WM_XXXX()</code></td><td>å›ºå®šç­¾åï¼Œå¦‚<code>OnPaint()</code></td><td>çª—å£ç»˜åˆ¶ã€å¤§å°è°ƒæ•´ç­‰åŸºç¡€æ“ä½œ</td></tr><tr><td><strong>å‘½ä»¤æ¶ˆæ¯</strong></td><td>èœå•ç‚¹å‡»ã€å·¥å…·æ æŒ‰é’®</td><td><code>ON_COMMAND(id, func)</code></td><td>æ— å‚æ•°voidå‡½æ•°</td><td>ç”¨æˆ·å‘½ä»¤å“åº”</td></tr><tr><td><strong>æ§ä»¶é€šçŸ¥æ¶ˆæ¯</strong></td><td>æŒ‰é’®ç‚¹å‡»é€šçŸ¥ã€åˆ—è¡¨é¡¹é€‰æ‹©</td><td><code>ON_NOTIFY(code, id, func)</code></td><td>æ¥æ”¶NMHDRç»“æ„ä½“</td><td>å¤æ‚æ§ä»¶äº¤äº’</td></tr><tr><td><strong>åå°„æ¶ˆæ¯</strong></td><td>WM_CTLCOLOR, WM_DRAWITEM</td><td><code>ON_WM_CTLCOLOR_REFLECT()</code></td><td>å­æ§ä»¶è‡ªæˆ‘å¤„ç†</td><td>æ§ä»¶è‡ªå®šä¹‰ç»˜åˆ¶</td></tr></tbody></table>
<h4 data-id="heading-8">3.2 æ¶ˆæ¯åå°„æœºåˆ¶</h4>
<p>æ¶ˆæ¯åå°„æ˜¯MFCä¸­ä¸€ä¸ªå·§å¦™çš„è®¾è®¡ï¼Œå®ƒå…è®¸å­æ§ä»¶å¤„ç†é€šå¸¸ç”±çˆ¶çª—å£å¤„ç†çš„æ¶ˆæ¯ã€‚è¿™ç§æœºåˆ¶é€šè¿‡ä»¥ä¸‹æ­¥éª¤å®ç°ï¼š</p>
<ol>
<li>çˆ¶çª—å£æ”¶åˆ°å­æ§ä»¶çš„é€šçŸ¥æ¶ˆæ¯ï¼ˆå¦‚WM_CTLCOLORï¼‰</li>
<li>MFCæ¡†æ¶æ£€æŸ¥å­æ§ä»¶æ˜¯å¦èƒ½å¤„ç†åå°„æ¶ˆæ¯</li>
<li>å¦‚æœèƒ½ï¼Œå°†æ¶ˆæ¯åå°„å›å­æ§ä»¶</li>
<li>å­æ§ä»¶åœ¨è‡ªå·±çš„æ¶ˆæ¯æ˜ å°„è¡¨ä¸­å¤„ç†åå°„æ¶ˆæ¯</li>
</ol>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-comment">// è‡ªå®šä¹‰æŒ‰é’®ç±»å¤„ç†åå°„æ¶ˆæ¯çš„ç¤ºä¾‹</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">CMyButton</span> : <span class="hljs-keyword">public</span> CButton
{
    <span class="hljs-built_in">DECLARE_MESSAGE_MAP</span>()
    
<span class="hljs-keyword">public</span>:
    <span class="hljs-function">afx_msg HBRUSH <span class="hljs-title">CtlColor</span><span class="hljs-params">(CDC* pDC, UINT nCtlColor)</span></span>;
};

<span class="hljs-built_in">BEGIN_MESSAGE_MAP</span>(CMyButton, CButton)
    <span class="hljs-built_in">ON_WM_CTLCOLOR_REFLECT</span>()  <span class="hljs-comment">// åå°„æ¶ˆæ¯å¤„ç†</span>
<span class="hljs-built_in">END_MESSAGE_MAP</span>()

<span class="hljs-function">HBRUSH <span class="hljs-title">CMyButton::CtlColor</span><span class="hljs-params">(CDC* pDC, UINT nCtlColor)</span>
</span>{
    <span class="hljs-comment">// æŒ‰é’®è‡ªè¡Œå†³å®šèƒŒæ™¯è‰²ï¼Œè€Œä¸æ˜¯ç”±å¯¹è¯æ¡†ç»Ÿä¸€æ§åˆ¶</span>
    pDC-&gt;<span class="hljs-built_in">SetTextColor</span>(<span class="hljs-built_in">RGB</span>(<span class="hljs-number">255</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>));  <span class="hljs-comment">// çº¢è‰²æ–‡å­—</span>
    pDC-&gt;<span class="hljs-built_in">SetBkColor</span>(<span class="hljs-built_in">RGB</span>(<span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">0</span>));  <span class="hljs-comment">// é»„è‰²èƒŒæ™¯</span>
    
    <span class="hljs-function"><span class="hljs-type">static</span> CBrush <span class="hljs-title">yellowBrush</span><span class="hljs-params">(RGB(<span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">0</span>))</span></span>;
    <span class="hljs-keyword">return</span> yellowBrush;
}
</code></pre>
<h4 data-id="heading-9">3.3 æ¶ˆæ¯èŒƒå›´æ˜ å°„</h4>
<p>å¯¹äºå¤„ç†ä¸€ç³»åˆ—è¿ç»­IDçš„ç›¸ä¼¼å‘½ä»¤ï¼ŒMFCæä¾›äº†æ¶ˆæ¯èŒƒå›´æ˜ å°„æœºåˆ¶ï¼š</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-comment">// å¤„ç†IDä»ID_TOOL_BUTTON_FIRSTåˆ°ID_TOOL_BUTTON_LASTçš„æ‰€æœ‰å·¥å…·æ æŒ‰é’®</span>
<span class="hljs-built_in">BEGIN_MESSAGE_MAP</span>(CMyView, CView)
    <span class="hljs-built_in">ON_COMMAND_RANGE</span>(ID_TOOL_BUTTON_FIRST, ID_TOOL_BUTTON_LAST, OnToolButtonClicked)
<span class="hljs-built_in">END_MESSAGE_MAP</span>()

<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">CMyView::OnToolButtonClicked</span><span class="hljs-params">(UINT nID)</span>
</span>{
    <span class="hljs-comment">// æ ¹æ®å…·ä½“IDæ‰§è¡Œç›¸åº”æ“ä½œ</span>
    <span class="hljs-type">int</span> buttonIndex = nID - ID_TOOL_BUTTON_FIRST;
    <span class="hljs-comment">// å¤„ç†é€»è¾‘...</span>
}
</code></pre>
<h3 data-id="heading-10">å››ã€æ¶ˆæ¯æ˜ å°„çš„æ€§èƒ½ä¸è®¾è®¡æƒè¡¡</h3>
<h4 data-id="heading-11">4.1 æ€§èƒ½åˆ†æ</h4>
<p>MFCæ¶ˆæ¯æ˜ å°„æœºåˆ¶åœ¨æ€§èƒ½ä¸Šåšå‡ºäº†ä»¥ä¸‹æƒè¡¡ï¼š</p>
<ol>
<li><strong>ç©ºé—´æ¢æ—¶é—´</strong>ï¼šä¸ºæ¯ä¸ªçª—å£ç±»ç”Ÿæˆé™æ€æ¶ˆæ¯æ˜ å°„è¡¨ï¼Œå ç”¨é¢å¤–å†…å­˜ï¼Œä½†é¿å…äº†è¿è¡Œæ—¶çš„åŠ¨æ€æŸ¥æ‰¾å¼€é”€ã€‚</li>
<li><strong>çº¿æ€§æŸ¥æ‰¾</strong>ï¼šæ¶ˆæ¯æ˜ å°„è¡¨é€šå¸¸è¾ƒå°ï¼Œçº¿æ€§æŸ¥æ‰¾æ•ˆç‡å¯æ¥å—ã€‚å¯¹äºæœ‰å¤§é‡æ¶ˆæ¯å¤„ç†çš„å¤§å‹ç±»ï¼ŒæŸ¥æ‰¾æ•ˆç‡å¯èƒ½æˆä¸ºç“¶é¢ˆã€‚</li>
<li><strong>ç»§æ‰¿é“¾æŸ¥æ‰¾</strong>ï¼šå½“æ¶ˆæ¯åœ¨å½“å‰ç±»æœªæ‰¾åˆ°æ—¶ï¼Œéœ€è¦æ²¿ç»§æ‰¿é“¾å‘ä¸ŠæŸ¥æ‰¾ï¼Œè¿™å¢åŠ äº†å¤„ç†æœªå¤„ç†æ¶ˆæ¯çš„å¼€é”€ã€‚</li>
</ol>
<h4 data-id="heading-12">4.2 ä¸æ›¿ä»£æ–¹æ¡ˆçš„å¯¹æ¯”</h4>
<p>ä¸å…¶å®ƒæ¡†æ¶çš„æ¶ˆæ¯/äº‹ä»¶å¤„ç†æœºåˆ¶ç›¸æ¯”ï¼š</p>








































<table><thead><tr><th>æœºåˆ¶</th><th>ä»£è¡¨æ¡†æ¶</th><th>å®ç°æ–¹å¼</th><th>ä¼˜ç‚¹</th><th>ç¼ºç‚¹</th></tr></thead><tbody><tr><td><strong>æ¶ˆæ¯æ˜ å°„</strong></td><td>MFC</td><td>ç¼–è¯‘æ—¶é™æ€ç»‘å®šï¼Œçº¿æ€§æŸ¥æ‰¾</td><td>ç±»å‹å®‰å…¨ï¼Œç¼–è¯‘æ—¶æ£€æŸ¥</td><td>ä¸å¤Ÿçµæ´»ï¼Œç»§æ‰¿é“¾æŸ¥æ‰¾å¼€é”€</td></tr><tr><td><strong>è™šå‡½æ•°è¡¨</strong></td><td>æ—©æœŸOWL</td><td>æ¯ä¸ªæ¶ˆæ¯å¯¹åº”è™šå‡½æ•°</td><td>ç›´æ¥è°ƒç”¨ï¼Œæ€§èƒ½é«˜</td><td>è™šå‡½æ•°è¡¨è†¨èƒ€ï¼ŒäºŒè¿›åˆ¶å…¼å®¹æ€§å·®</td></tr><tr><td><strong>ä¿¡å·æ§½</strong></td><td>Qt</td><td>è¿è¡Œæ—¶è¿æ¥ï¼Œå­—ç¬¦ä¸²åŒ¹é…</td><td>é«˜åº¦çµæ´»ï¼Œè·¨çº¿ç¨‹å®‰å…¨</td><td>è¿è¡Œæ—¶å¼€é”€ï¼Œç±»å‹å®‰å…¨æ£€æŸ¥å¼±</td></tr><tr><td><strong>å§”æ‰˜/äº‹ä»¶</strong></td><td>.NET</td><td>å¤šæ’­å§”æ‰˜ï¼Œå¼•ç”¨è®¡æ•°</td><td>ç±»å‹å®‰å…¨ï¼Œæ”¯æŒå¤šè®¢é˜…è€…</td><td>åƒåœ¾å›æ”¶ä¾èµ–ï¼Œéå®æ—¶ç³»ç»Ÿå¯èƒ½ä¸é€‚åˆ</td></tr></tbody></table>
<h3 data-id="heading-13">äº”ã€ç°ä»£æ¡†æ¶ä¸­çš„æ¶ˆæ¯æ˜ å°„é—äº§</h3>
<p>è™½ç„¶MFCæœ¬èº«å·²ä¸å†æ˜¯ä¸»æµå¼€å‘æ¡†æ¶ï¼Œä½†å…¶æ¶ˆæ¯æ˜ å°„çš„æ€æƒ³å½±å“äº†åç»­ä¼—å¤šUIæ¡†æ¶ï¼š</p>
<ol>
<li><strong>.NET WinForms</strong>ï¼šäº‹ä»¶å¤„ç†æ¨¡å‹å€Ÿé‰´äº†æ¶ˆæ¯æ˜ å°„çš„å¯¹è±¡åŒ–æ€æƒ³</li>
<li><strong>WPF/UWP</strong>ï¼šè·¯ç”±äº‹ä»¶æ¦‚å¿µå¯ä»¥è§†ä¸ºæ¶ˆæ¯æ˜ å°„çš„è¿›åŒ–å½¢å¼</li>
<li><strong>Qtä¿¡å·æ§½</strong>ï¼šè™½ç„¶å®ç°æœºåˆ¶ä¸åŒï¼Œä½†è§£å†³çš„é—®é¢˜åŸŸé«˜åº¦ç›¸ä¼¼</li>
</ol>
<p>åœ¨ç°ä»£C++ UIå¼€å‘ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥è§‚å¯Ÿåˆ°ç±»ä¼¼çš„æ¶ˆæ¯å¤„ç†æ¨¡å¼ï¼š</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-comment">// ç°ä»£C++ UIæ¡†æ¶ä¸­çš„ç±»ä¼¼æ¨¡å¼ï¼ˆæ¦‚å¿µç¤ºä¾‹ï¼‰</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">ModernButton</span> : <span class="hljs-keyword">public</span> UIWidget
{
    <span class="hljs-comment">// å£°æ˜äº‹ä»¶å¤„ç†å™¨</span>
    EventHandler&lt;<span class="hljs-built_in">void</span>()&gt; onClick;
    
    <span class="hljs-comment">// è¿æ¥äº‹ä»¶</span>
    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">setupEventHandlers</span><span class="hljs-params">()</span>
    </span>{
        <span class="hljs-comment">// ç±»ä¼¼äºMFCçš„æ¶ˆæ¯æ˜ å°„ï¼Œä½†æ›´çµæ´»</span>
        onMouseDown += [<span class="hljs-keyword">this</span>](MouseEvent e) { <span class="hljs-keyword">this</span>-&gt;<span class="hljs-built_in">handleMouseDown</span>(e); };
        onClick += []() { <span class="hljs-comment">/* å¤„ç†ç‚¹å‡» */</span> };
    }
};
</code></pre>
<h3 data-id="heading-14">å…­ã€æ€»ç»“ï¼šæ¶ˆæ¯æ˜ å°„çš„è®¾è®¡å“²å­¦</h3>
<p>MFCæ¶ˆæ¯æ˜ å°„æœºåˆ¶çš„æ ¸å¿ƒä»·å€¼åœ¨äºå®ƒæˆåŠŸåœ°å°†Windows APIçš„è¿‡ç¨‹å¼æ¶ˆæ¯å¤„ç†è½¬åŒ–ä¸ºé¢å‘å¯¹è±¡çš„èŒƒå¼ã€‚è¿™ä¸€è½¬åŒ–åŸºäºä»¥ä¸‹è®¾è®¡å“²å­¦ï¼š</p>
<ol>
<li><strong>å…³æ³¨ç‚¹åˆ†ç¦»</strong>ï¼šä¸åŒçª—å£ç±»åªå¤„ç†è‡ªå·±çš„æ¶ˆæ¯ï¼Œç¬¦åˆå•ä¸€èŒè´£åŸåˆ™ã€‚</li>
<li><strong>ç¼–è¯‘æ—¶å®‰å…¨</strong>ï¼šé€šè¿‡å®åœ¨ç¼–è¯‘æ—¶å»ºç«‹æ˜ å°„ï¼Œæ—©æœŸå‘ç°ç±»å‹ä¸åŒ¹é…é”™è¯¯ã€‚</li>
<li><strong>æ¡†æ¶é€æ˜æ€§</strong>ï¼šå¼€å‘è€…åªéœ€å…³æ³¨å¤„ç†å‡½æ•°æœ¬èº«ï¼Œå¤æ‚çš„æ¶ˆæ¯è·¯ç”±ç”±æ¡†æ¶å¤„ç†ã€‚</li>
</ol>
<p>ç„¶è€Œï¼Œè¿™ä¸€æœºåˆ¶ä¹Ÿæœ‰å…¶å†å²å±€é™æ€§ï¼Œç‰¹åˆ«æ˜¯ä¸ç°ä»£åå°„å’Œå§”æ‰˜æœºåˆ¶ç›¸æ¯”ï¼Œå®ƒç¼ºä¹è¶³å¤Ÿçš„çµæ´»æ€§å’Œè¡¨è¾¾èƒ½åŠ›ã€‚ç†è§£MFCæ¶ˆæ¯æ˜ å°„ä¸ä»…æœ‰åŠ©äºç»´æŠ¤é—ç•™ä»£ç ï¼Œæ›´é‡è¦çš„æ˜¯ï¼Œå®ƒå±•ç¤ºäº†æ¡†æ¶è®¾è®¡è€…å¦‚ä½•é€šè¿‡æŠ½è±¡å’Œå°è£…æ¥ç®¡ç†å¹³å°APIçš„å¤æ‚æ€§ï¼Œè¿™ä¸€è®¾è®¡æ€ç»´å¯¹ä»Šå¤©çš„è½¯ä»¶å¼€å‘ä¾ç„¶å…·æœ‰å¯ç¤ºæ„ä¹‰ã€‚</p>
<h2 data-id="heading-15">ç¬¬äºŒç« ï¼šMFCæ–‡æ¡£/è§†å›¾æ¶æ„â€”â€”æ•°æ®ä¸ç•Œé¢çš„åˆ†ç¦»å®è·µ</h2>
<h3 data-id="heading-16">ä¸€ã€è®¾è®¡èµ·æºï¼šä»å•ä½“åº”ç”¨åˆ°æ¨¡å—åŒ–æ¶æ„çš„æ¼”è¿›</h3>
<p>åœ¨æ—©æœŸçš„Windowsåº”ç”¨ç¨‹åºä¸­ï¼Œä¸€ä¸ªæ™®éçš„é—®é¢˜æ˜¯æ•°æ®ç®¡ç†ã€ç”¨æˆ·ç•Œé¢å’Œä¸šåŠ¡é€»è¾‘é«˜åº¦è€¦åˆã€‚ä»¥ç®€å•çš„æ–‡æœ¬ç¼–è¾‘å™¨ä¸ºä¾‹ï¼Œä¼ ç»Ÿè®¾è®¡å°†æ–‡ä»¶æ“ä½œã€æ–‡æœ¬æ˜¾ç¤ºå’Œç”¨æˆ·è¾“å…¥å¤„ç†å…¨éƒ¨æ··æ‚åœ¨çª—å£è¿‡ç¨‹ä¸­ï¼Œå¯¼è‡´ä»£ç éš¾ä»¥ç»´æŠ¤å’Œæ‰©å±•ã€‚</p>
<p>MFCæ–‡æ¡£/è§†å›¾æ¶æ„çš„æå‡ºï¼Œæ˜¯ä¸ºäº†è§£å†³è¿™ç§â€œå¤§æ³¥çƒâ€æ¶æ„é—®é¢˜ã€‚è¯¥æ¶æ„çš„æ ¸å¿ƒæ€æƒ³å€Ÿé‰´äº†è½¯ä»¶å·¥ç¨‹ä¸­çš„<strong>æ¨¡å‹-è§†å›¾-æ§åˆ¶å™¨ï¼ˆMVCï¼‰æ¨¡å¼</strong>ï¼Œä½†æ ¹æ®Windowså¹³å°çš„ç‰¹ç‚¹å’ŒC++è¯­è¨€çš„ç‰¹æ€§è¿›è¡Œäº†è°ƒæ•´å’Œä¼˜åŒ–ã€‚</p>
<h3 data-id="heading-17">äºŒã€æ¶æ„ç»„æˆï¼šå››å¤§æ ¸å¿ƒç»„ä»¶çš„ååŒå·¥ä½œ</h3>
<p>æ–‡æ¡£/è§†å›¾æ¶æ„ç”±å››ä¸ªæ ¸å¿ƒç±»æ„æˆï¼Œå®ƒä»¬å„è‡ªæ‰¿æ‹…æ˜ç¡®çš„èŒè´£ï¼š</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-comment">// æ¶æ„æ ¸å¿ƒç±»å…³ç³»ç¤ºæ„ä»£ç </span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">CDocument</span>;  <span class="hljs-comment">// æ•°æ®ç®¡ç†å±‚</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">CView</span>;      <span class="hljs-comment">// æ•°æ®æ˜¾ç¤ºä¸äº¤äº’å±‚  </span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">CFrameWnd</span>;  <span class="hljs-comment">// çª—å£å®¹å™¨å±‚</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">CDocTemplate</span>; <span class="hljs-comment">// å·¥å‚ä¸åè°ƒå±‚</span>

<span class="hljs-comment">// åº”ç”¨ç¨‹åºåˆå§‹åŒ–æ—¶çš„å…¸å‹è®¾ç½®</span>
<span class="hljs-function">BOOL <span class="hljs-title">CMyApp::InitInstance</span><span class="hljs-params">()</span>
</span>{
    <span class="hljs-comment">// 1. åˆ›å»ºæ–‡æ¡£æ¨¡æ¿ï¼ˆå…³é”®ç²˜åˆå‰‚ï¼‰</span>
    CSingleDocTemplate* pDocTemplate;
    pDocTemplate = <span class="hljs-keyword">new</span> <span class="hljs-built_in">CSingleDocTemplate</span>(
        IDR_MAINFRAME,          <span class="hljs-comment">// èµ„æºIDï¼ˆèœå•ã€å›¾æ ‡ç­‰ï¼‰</span>
        <span class="hljs-built_in">RUNTIME_CLASS</span>(CMyDoc),  <span class="hljs-comment">// æ–‡æ¡£ç±»</span>
        <span class="hljs-built_in">RUNTIME_CLASS</span>(CMainFrame), <span class="hljs-comment">// æ¡†æ¶ç±»</span>
        <span class="hljs-built_in">RUNTIME_CLASS</span>(CMyView)  <span class="hljs-comment">// è§†å›¾ç±»</span>
    );
    
    <span class="hljs-comment">// 2. æ³¨å†Œæ¨¡æ¿</span>
    <span class="hljs-built_in">AddDocTemplate</span>(pDocTemplate);
    
    <span class="hljs-comment">// 3. åˆ›å»ºæˆ–æ‰“å¼€æ–‡æ¡£</span>
    <span class="hljs-built_in">OnFileNew</span>(); <span class="hljs-comment">// åˆ›å»ºæ–°æ–‡æ¡£</span>
    
    <span class="hljs-keyword">return</span> TRUE;
}
</code></pre>
<h4 data-id="heading-18">2.1 CDocumentï¼šæ•°æ®çš„å®ˆæŠ¤è€…</h4>
<p>æ–‡æ¡£ç±»æ˜¯æ¶æ„ä¸­çš„â€œæ¨¡å‹â€éƒ¨åˆ†ï¼Œè´Ÿè´£æ‰€æœ‰ä¸æ•°æ®ç›¸å…³çš„æ“ä½œï¼š</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-keyword">class</span> <span class="hljs-title class_">CMyDocument</span> : <span class="hljs-keyword">public</span> CDocument
{
<span class="hljs-keyword">protected</span>:
    <span class="hljs-built_in">CMyDocument</span>();
    
<span class="hljs-comment">// å±æ€§</span>
<span class="hljs-keyword">private</span>:
    CString m_strTitle;      <span class="hljs-comment">// æ–‡æ¡£æ ‡é¢˜</span>
    CStringArray m_lines;    <span class="hljs-comment">// æ–‡æœ¬è¡Œæ•°æ®</span>
    BOOL m_bModified;        <span class="hljs-comment">// ä¿®æ”¹æ ‡å¿—</span>
    
<span class="hljs-comment">// æ“ä½œ</span>
<span class="hljs-keyword">public</span>:
    <span class="hljs-comment">// æ•°æ®è®¿é—®æ¥å£</span>
    <span class="hljs-function"><span class="hljs-type">const</span> CString&amp; <span class="hljs-title">GetLine</span><span class="hljs-params">(<span class="hljs-type">int</span> nIndex)</span> <span class="hljs-type">const</span> </span>{ <span class="hljs-keyword">return</span> m_lines[nIndex]; }
    <span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">GetLineCount</span><span class="hljs-params">()</span> <span class="hljs-type">const</span> </span>{ <span class="hljs-keyword">return</span> m_lines.<span class="hljs-built_in">GetSize</span>(); }
    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">AddLine</span><span class="hljs-params">(<span class="hljs-type">const</span> CString&amp; strLine)</span></span>;
    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">DeleteLine</span><span class="hljs-params">(<span class="hljs-type">int</span> nIndex)</span></span>;
    
    <span class="hljs-comment">// é‡å†™åŸºç±»å…³é”®æ–¹æ³•</span>
    <span class="hljs-function"><span class="hljs-keyword">virtual</span> BOOL <span class="hljs-title">OnNewDocument</span><span class="hljs-params">()</span></span>;
    <span class="hljs-function"><span class="hljs-keyword">virtual</span> BOOL <span class="hljs-title">OnOpenDocument</span><span class="hljs-params">(LPCTSTR lpszPathName)</span></span>;
    <span class="hljs-function"><span class="hljs-keyword">virtual</span> BOOL <span class="hljs-title">OnSaveDocument</span><span class="hljs-params">(LPCTSTR lpszPathName)</span></span>;
    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">void</span> <span class="hljs-title">DeleteContents</span><span class="hljs-params">()</span></span>;
    
    <span class="hljs-comment">// åºåˆ—åŒ– - æ ¸å¿ƒæ•°æ®æŒä¹…åŒ–æœºåˆ¶</span>
    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">void</span> <span class="hljs-title">Serialize</span><span class="hljs-params">(CArchive&amp; ar)</span></span>;
    
    <span class="hljs-comment">// è§†å›¾é€šçŸ¥</span>
    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">UpdateAllViews</span><span class="hljs-params">(CView* pSender, LPARAM lHint = <span class="hljs-number">0L</span>, CObject* pHint = <span class="hljs-literal">NULL</span>)</span></span>;
    
    <span class="hljs-built_in">DECLARE_DYNCREATE</span>(CMyDocument)
    <span class="hljs-built_in">DECLARE_MESSAGE_MAP</span>()
};
</code></pre>
<p><strong>æ–‡æ¡£çš„å…³é”®èŒè´£åŒ…æ‹¬ï¼š</strong></p>
<ol>
<li><strong>æ•°æ®å­˜å‚¨ä¸ç®¡ç†</strong>ï¼šç»´æŠ¤åº”ç”¨ç¨‹åºçš„æ ¸å¿ƒæ•°æ®ç»“æ„</li>
<li><strong>æŒä¹…åŒ–æ”¯æŒ</strong>ï¼šé€šè¿‡Serializeæ–¹æ³•å®ç°æ–‡ä»¶è¯»å†™</li>
<li><strong>ä¿®æ”¹è¿½è¸ª</strong>ï¼šç®¡ç†â€œè„æ ‡å¿—â€ï¼ˆä¿®æ”¹çŠ¶æ€ï¼‰</li>
<li><strong>è§†å›¾åè°ƒ</strong>ï¼šé€šçŸ¥æ‰€æœ‰å…³è”è§†å›¾æ•°æ®å˜æ›´</li>
</ol>
<h4 data-id="heading-19">2.2 CViewï¼šæ•°æ®çš„è§‚å¯Ÿè€…ä¸äº¤äº’ç•Œé¢</h4>
<p>è§†å›¾ç±»æ˜¯æ¶æ„ä¸­çš„â€œè§†å›¾â€éƒ¨åˆ†ï¼Œè´Ÿè´£æ•°æ®çš„å¯è§†åŒ–å‘ˆç°å’Œç”¨æˆ·äº¤äº’ï¼š</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-keyword">class</span> <span class="hljs-title class_">CMyView</span> : <span class="hljs-keyword">public</span> CView
{
<span class="hljs-keyword">protected</span>:
    <span class="hljs-built_in">CMyView</span>();
    
<span class="hljs-comment">// å±æ€§</span>
<span class="hljs-keyword">private</span>:
    <span class="hljs-type">int</span> m_nCurrentLine;      <span class="hljs-comment">// å½“å‰é€‰ä¸­è¡Œ</span>
    CFont m_fontText;        <span class="hljs-comment">// æ˜¾ç¤ºå­—ä½“</span>
    CSize m_sizeChar;        <span class="hljs-comment">// å­—ç¬¦å°ºå¯¸</span>
    
<span class="hljs-comment">// æ“ä½œ</span>
<span class="hljs-keyword">public</span>:
    <span class="hljs-comment">// è·å–å…³è”æ–‡æ¡£çš„å¼ºç±»å‹æŒ‡é’ˆ</span>
    <span class="hljs-function">CMyDocument* <span class="hljs-title">GetDocument</span><span class="hljs-params">()</span> <span class="hljs-type">const</span>
    </span>{
        <span class="hljs-keyword">return</span> (CMyDocument*)m_pDocument;
    }
    
    <span class="hljs-comment">// é‡å†™åŸºç±»å…³é”®æ–¹æ³•</span>
    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">void</span> <span class="hljs-title">OnDraw</span><span class="hljs-params">(CDC* pDC)</span></span>;           <span class="hljs-comment">// ç»˜åˆ¶å†…å®¹</span>
    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">void</span> <span class="hljs-title">OnUpdate</span><span class="hljs-params">(CView* pSender, LPARAM lHint, CObject* pHint)</span></span>;
    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">void</span> <span class="hljs-title">OnInitialUpdate</span><span class="hljs-params">()</span></span>;
    <span class="hljs-function"><span class="hljs-keyword">virtual</span> BOOL <span class="hljs-title">PreCreateWindow</span><span class="hljs-params">(CREATESTRUCT&amp; cs)</span></span>;
    
    <span class="hljs-comment">// æ¶ˆæ¯å¤„ç†</span>
    <span class="hljs-function">afx_msg <span class="hljs-type">void</span> <span class="hljs-title">OnLButtonDown</span><span class="hljs-params">(UINT nFlags, CPoint point)</span></span>;
    <span class="hljs-function">afx_msg <span class="hljs-type">void</span> <span class="hljs-title">OnKeyDown</span><span class="hljs-params">(UINT nChar, UINT nRepCnt, UINT nFlags)</span></span>;
    <span class="hljs-function">afx_msg <span class="hljs-type">void</span> <span class="hljs-title">OnEditCut</span><span class="hljs-params">()</span></span>;
    <span class="hljs-function">afx_msg <span class="hljs-type">void</span> <span class="hljs-title">OnEditCopy</span><span class="hljs-params">()</span></span>;
    <span class="hljs-function">afx_msg <span class="hljs-type">void</span> <span class="hljs-title">OnEditPaste</span><span class="hljs-params">()</span></span>;
    
    <span class="hljs-built_in">DECLARE_DYNCREATE</span>(CMyView)
    <span class="hljs-built_in">DECLARE_MESSAGE_MAP</span>()
};
</code></pre>
<p>è§†å›¾é€šè¿‡<code>GetDocument()</code>æ–¹æ³•è·å–æ–‡æ¡£æŒ‡é’ˆï¼Œè¿™æ˜¯æ–‡æ¡£ä¸è§†å›¾é€šä¿¡çš„ä¸»è¦æ¡¥æ¢ã€‚è§†å›¾ä¸ç›´æ¥å­˜å‚¨æ•°æ®ï¼ŒåªæŒæœ‰å¯¹æ–‡æ¡£æ•°æ®çš„å¼•ç”¨ã€‚</p>
<h3 data-id="heading-20">ä¸‰ã€æ–‡æ¡£/è§†å›¾é€šä¿¡æœºåˆ¶</h3>
<h4 data-id="heading-21">3.1 æ•°æ®æµï¼šæ–‡æ¡£åˆ°è§†å›¾çš„æ›´æ–°</h4>
<p>æ–‡æ¡£æ•°æ®å˜åŒ–æ—¶ï¼Œé€šè¿‡<code>UpdateAllViews()</code>æ–¹æ³•é€šçŸ¥æ‰€æœ‰å…³è”çš„è§†å›¾ï¼š</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-comment">// æ–‡æ¡£ç±»ä¸­ä¿®æ”¹æ•°æ®å¹¶é€šçŸ¥è§†å›¾</span>
<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">CMyDocument::AddLine</span><span class="hljs-params">(<span class="hljs-type">const</span> CString&amp; strLine)</span>
</span>{
    m_lines.<span class="hljs-built_in">Add</span>(strLine);
    m_bModified = TRUE;
    
    <span class="hljs-comment">// é€šçŸ¥æ‰€æœ‰è§†å›¾æ•°æ®å·²æ›´æ–°</span>
    <span class="hljs-built_in">UpdateAllViews</span>(<span class="hljs-literal">NULL</span>, <span class="hljs-number">0L</span>, <span class="hljs-literal">NULL</span>);
    
    <span class="hljs-comment">// æˆ–è€…æºå¸¦æç¤ºä¿¡æ¯ï¼Œä¼˜åŒ–æ›´æ–°æ•ˆç‡</span>
    <span class="hljs-comment">// UpdateAllViews(NULL, UPDATE_LINE_ADDED, (CObject*)&amp;strLine);</span>
}
</code></pre>
<p>è§†å›¾æ¥æ”¶æ›´æ–°é€šçŸ¥å¹¶é‡ç»˜ï¼š</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-comment">// è§†å›¾ç±»ä¸­å“åº”æ›´æ–°é€šçŸ¥</span>
<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">CMyView::OnUpdate</span><span class="hljs-params">(CView* pSender, LPARAM lHint, CObject* pHint)</span>
</span>{
    <span class="hljs-comment">// æ ¹æ®æç¤ºä¿¡æ¯å†³å®šæ›´æ–°ç­–ç•¥</span>
    <span class="hljs-keyword">if</span> (lHint == UPDATE_LINE_ADDED)
    {
        <span class="hljs-comment">// å±€éƒ¨æ›´æ–°ï¼šåªæ›´æ–°æ–°å¢è¡ŒåŒºåŸŸ</span>
        CString* pNewLine = (CString*)pHint;
        CRect rectUpdate = <span class="hljs-built_in">CalculateLineRect</span>(m_lines.<span class="hljs-built_in">GetSize</span>()<span class="hljs-number">-1</span>);
        <span class="hljs-built_in">InvalidateRect</span>(&amp;rectUpdate);
    }
    <span class="hljs-keyword">else</span>
    {
        <span class="hljs-comment">// å®Œå…¨æ›´æ–°ï¼šé‡ç»˜æ•´ä¸ªå®¢æˆ·åŒº</span>
        <span class="hljs-built_in">Invalidate</span>();
    }
}
</code></pre>
<h4 data-id="heading-22">3.2 äº¤äº’æµï¼šè§†å›¾åˆ°æ–‡æ¡£çš„ä¿®æ”¹</h4>
<p>ç”¨æˆ·é€šè¿‡è§†å›¾ç•Œé¢ä¿®æ”¹æ•°æ®æ—¶ï¼Œè§†å›¾è°ƒç”¨æ–‡æ¡£çš„æ¥å£ï¼š</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-comment">// è§†å›¾å¤„ç†ç”¨æˆ·è¾“å…¥å¹¶ä¿®æ”¹æ–‡æ¡£</span>
<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">CMyView::OnChar</span><span class="hljs-params">(UINT nChar, UINT nRepCnt, UINT nFlags)</span>
</span>{
    CMyDocument* pDoc = <span class="hljs-built_in">GetDocument</span>();
    
    <span class="hljs-keyword">if</span> (nChar == VK_RETURN)  <span class="hljs-comment">// å›è½¦é”®</span>
    {
        pDoc-&gt;<span class="hljs-built_in">AddLine</span>(m_strCurrentLine);  <span class="hljs-comment">// è°ƒç”¨æ–‡æ¡£æ–¹æ³•</span>
        m_strCurrentLine.<span class="hljs-built_in">Empty</span>();
    }
    <span class="hljs-keyword">else</span>
    {
        m_strCurrentLine += (TCHAR)nChar;
    }
    
    <span class="hljs-comment">// é‡ç»˜å½“å‰è¡Œ</span>
    CRect rectUpdate = <span class="hljs-built_in">CalculateCurrentLineRect</span>();
    <span class="hljs-built_in">InvalidateRect</span>(&amp;rectUpdate);
    
    CView::<span class="hljs-built_in">OnChar</span>(nChar, nRepCnt, nFlags);
}
</code></pre>
<h3 data-id="heading-23">å››ã€å¤šè§†å›¾æ”¯æŒï¼šä¸€æ¡£å¤šè§†çš„å®ç°</h3>
<p>æ–‡æ¡£/è§†å›¾æ¶æ„æœ€å¼ºå¤§çš„ç‰¹æ€§ä¹‹ä¸€æ˜¯æ”¯æŒå•ä¸ªæ–‡æ¡£å¯¹åº”å¤šä¸ªè§†å›¾ï¼Œè¿™åœ¨CADã€å›¾å½¢ç¼–è¾‘ç­‰åº”ç”¨ä¸­ç‰¹åˆ«æœ‰ç”¨ï¼š</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-comment">// åˆ›å»ºåŒä¸€æ–‡æ¡£çš„ç¬¬äºŒä¸ªè§†å›¾</span>
<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">CMainFrame::OnWindowNewView</span><span class="hljs-params">()</span>
</span>{
    CMyDocument* pDoc = (CMyDocument*)<span class="hljs-built_in">GetActiveDocument</span>();
    
    <span class="hljs-comment">// åˆ›å»ºæ–°çš„æ¡†æ¶çª—å£</span>
    CChildFrame* pNewFrame = <span class="hljs-keyword">new</span> CChildFrame;
    
    <span class="hljs-comment">// åŠ¨æ€åˆ›å»ºæ–°è§†å›¾</span>
    CCreateContext context;
    context.m_pCurrentDoc = pDoc;
    context.m_pNewViewClass = <span class="hljs-built_in">RUNTIME_CLASS</span>(CMyView);
    
    <span class="hljs-comment">// åˆ›å»ºè§†å›¾å¹¶å…³è”åˆ°æ–°æ¡†æ¶</span>
    <span class="hljs-keyword">if</span> (!pNewFrame-&gt;<span class="hljs-built_in">LoadFrame</span>(IDR_MYTYPE, WS_OVERLAPPEDWINDOW, 
                              <span class="hljs-keyword">this</span>, &amp;context))
    {
        <span class="hljs-keyword">delete</span> pNewFrame;
        <span class="hljs-keyword">return</span>;
    }
    
    <span class="hljs-comment">// æ˜¾ç¤ºæ–°çª—å£</span>
    pNewFrame-&gt;<span class="hljs-built_in">InitialUpdateFrame</span>(pDoc, TRUE);
}

<span class="hljs-comment">// ä¸åŒç±»å‹çš„è§†å›¾å¯ä»¥å±•ç¤ºåŒä¸€æ–‡æ¡£çš„ä¸åŒæ–¹é¢</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">CGraphView</span> : <span class="hljs-keyword">public</span> CView  <span class="hljs-comment">// å›¾å½¢è§†å›¾</span>
{
    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">void</span> <span class="hljs-title">OnDraw</span><span class="hljs-params">(CDC* pDC)</span>
    </span>{
        CMyDocument* pDoc = <span class="hljs-built_in">GetDocument</span>();
        <span class="hljs-comment">// å°†æ–‡æœ¬æ•°æ®è½¬æ¢ä¸ºå›¾å½¢å±•ç¤º</span>
        <span class="hljs-built_in">DrawTextAsGraph</span>(pDC, pDoc-&gt;<span class="hljs-built_in">GetAllLines</span>());
    }
};

<span class="hljs-keyword">class</span> <span class="hljs-title class_">CStatsView</span> : <span class="hljs-keyword">public</span> CView  <span class="hljs-comment">// ç»Ÿè®¡è§†å›¾</span>
{
    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">void</span> <span class="hljs-title">OnDraw</span><span class="hljs-params">(CDC* pDC)</span>
    </span>{
        CMyDocument* pDoc = <span class="hljs-built_in">GetDocument</span>();
        <span class="hljs-comment">// æ˜¾ç¤ºæ–‡æœ¬çš„ç»Ÿè®¡ä¿¡æ¯</span>
        <span class="hljs-built_in">DrawStatistics</span>(pDC, pDoc-&gt;<span class="hljs-built_in">CalculateStats</span>());
    }
};
</code></pre>
<h3 data-id="heading-24">äº”ã€åºåˆ—åŒ–ï¼šæ–‡æ¡£æŒä¹…åŒ–çš„æ ¸å¿ƒæœºåˆ¶</h3>
<p>åºåˆ—åŒ–æ˜¯æ–‡æ¡£/è§†å›¾æ¶æ„çš„æ•°æ®æŒä¹…åŒ–åŸºç¡€ï¼Œå®ƒé€šè¿‡<code>CArchive</code>ç±»å®ç°æ•°æ®çš„äºŒè¿›åˆ¶æµå¼è¯»å†™ï¼š</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-comment">// æ–‡æ¡£ç±»çš„åºåˆ—åŒ–å®ç°</span>
<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">CMyDocument::Serialize</span><span class="hljs-params">(CArchive&amp; ar)</span>
</span>{
    <span class="hljs-keyword">if</span> (ar.<span class="hljs-built_in">IsStoring</span>())  <span class="hljs-comment">// ä¿å­˜æ–‡æ¡£</span>
    {
        <span class="hljs-comment">// å†™å…¥ç‰ˆæœ¬æ ‡è¯†</span>
        ar &lt;&lt; (WORD)<span class="hljs-number">0x0001</span>;  <span class="hljs-comment">// ç‰ˆæœ¬1.0</span>
        
        <span class="hljs-comment">// å†™å…¥æ–‡æ¡£å±æ€§</span>
        ar &lt;&lt; m_strTitle;
        ar &lt;&lt; m_bModified;
        
        <span class="hljs-comment">// å†™å…¥æ•°æ®å†…å®¹</span>
        m_lines.<span class="hljs-built_in">Serialize</span>(ar);  <span class="hljs-comment">// CStringArrayæ”¯æŒåºåˆ—åŒ–</span>
        
        <span class="hljs-comment">// å†™å…¥è‡ªå®šä¹‰å¯¹è±¡</span>
        <span class="hljs-keyword">if</span> (m_pCustomObj != <span class="hljs-literal">NULL</span>)
        {
            ar &lt;&lt; (WORD)<span class="hljs-number">1</span>;  <span class="hljs-comment">// æ ‡è®°æœ‰å¯¹è±¡</span>
            ar.<span class="hljs-built_in">WriteObject</span>(m_pCustomObj);  <span class="hljs-comment">// å†™å…¥å¯åºåˆ—åŒ–å¯¹è±¡</span>
        }
        <span class="hljs-keyword">else</span>
        {
            ar &lt;&lt; (WORD)<span class="hljs-number">0</span>;  <span class="hljs-comment">// æ ‡è®°æ— å¯¹è±¡</span>
        }
    }
    <span class="hljs-keyword">else</span>  <span class="hljs-comment">// åŠ è½½æ–‡æ¡£</span>
    {
        <span class="hljs-comment">// è¯»å–ç‰ˆæœ¬æ ‡è¯†</span>
        WORD wVersion;
        ar &gt;&gt; wVersion;
        
        <span class="hljs-keyword">if</span> (wVersion == <span class="hljs-number">0x0001</span>)
        {
            <span class="hljs-comment">// è¯»å–æ–‡æ¡£å±æ€§</span>
            ar &gt;&gt; m_strTitle;
            ar &gt;&gt; m_bModified;
            
            <span class="hljs-comment">// è¯»å–æ•°æ®å†…å®¹</span>
            m_lines.<span class="hljs-built_in">Serialize</span>(ar);
            
            <span class="hljs-comment">// è¯»å–è‡ªå®šä¹‰å¯¹è±¡</span>
            WORD wHasObject;
            ar &gt;&gt; wHasObject;
            <span class="hljs-keyword">if</span> (wHasObject == <span class="hljs-number">1</span>)
            {
                m_pCustomObj = (CCustomObject*)ar.<span class="hljs-built_in">ReadObject</span>(
                    <span class="hljs-built_in">RUNTIME_CLASS</span>(CCustomObject));
            }
        }
        <span class="hljs-keyword">else</span>
        {
            <span class="hljs-comment">// å¤„ç†æ—§ç‰ˆæœ¬æ ¼å¼</span>
            <span class="hljs-built_in">LoadOldFormat</span>(ar, wVersion);
        }
    }
}

<span class="hljs-comment">// è‡ªå®šä¹‰å¯åºåˆ—åŒ–å¯¹è±¡çš„å®ç°</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">CCustomObject</span> : <span class="hljs-keyword">public</span> CObject
{
    <span class="hljs-built_in">DECLARE_SERIAL</span>(CCustomObject)
    
<span class="hljs-keyword">private</span>:
    CString m_strData;
    <span class="hljs-type">int</span> m_nValue;
    CPointArray m_points;
    
<span class="hljs-keyword">public</span>:
    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">void</span> <span class="hljs-title">Serialize</span><span class="hljs-params">(CArchive&amp; ar)</span>
    </span>{
        CObject::<span class="hljs-built_in">Serialize</span>(ar);
        
        <span class="hljs-keyword">if</span> (ar.<span class="hljs-built_in">IsStoring</span>())
        {
            ar &lt;&lt; m_strData &lt;&lt; m_nValue;
            m_points.<span class="hljs-built_in">Serialize</span>(ar);
        }
        <span class="hljs-keyword">else</span>
        {
            ar &gt;&gt; m_strData &gt;&gt; m_nValue;
            m_points.<span class="hljs-built_in">Serialize</span>(ar);
        }
    }
    
    <span class="hljs-comment">// å¿…é¡»æœ‰æ— å‚æ„é€ å‡½æ•°</span>
    <span class="hljs-built_in">CCustomObject</span>() { }
};

<span class="hljs-built_in">IMPLEMENT_SERIAL</span>(CCustomObject, CObject, VERSIONABLE_SCHEMA | <span class="hljs-number">1</span>)
</code></pre>
<h3 data-id="heading-25">å…­ã€ä¸ç»å…¸MVCæ¶æ„çš„æ·±åº¦å¯¹æ¯”</h3>
<h4 data-id="heading-26">6.1 ç›¸ä¼¼æ€§ï¼šåˆ†ç¦»å…³æ³¨ç‚¹çš„å…±åŒè¿½æ±‚</h4>
<p>æ–‡æ¡£/è§†å›¾æ¶æ„ä¸MVCéƒ½éµå¾ªäº†æ•°æ®ä¸æ˜¾ç¤ºåˆ†ç¦»çš„åŸåˆ™ï¼š</p>





























<table><thead><tr><th>æ¦‚å¿µå¯¹åº”</th><th>MVCç»„ä»¶</th><th>æ–‡æ¡£/è§†å›¾ç»„ä»¶</th><th>èŒè´£ç›¸ä¼¼åº¦</th></tr></thead><tbody><tr><td>æ•°æ®å±‚</td><td>Model</td><td>Document</td><td>é«˜ï¼šéƒ½è´Ÿè´£æ•°æ®ç®¡ç†å’Œä¸šåŠ¡è§„åˆ™</td></tr><tr><td>æ˜¾ç¤ºå±‚</td><td>View</td><td>View</td><td>é«˜ï¼šéƒ½è´Ÿè´£æ•°æ®å¯è§†åŒ–</td></tr><tr><td>æ§åˆ¶å±‚</td><td>Controller</td><td>åˆ†æ•£å¤„ç†</td><td>ä½ï¼šMVCæœ‰ç‹¬ç«‹æ§åˆ¶å™¨</td></tr></tbody></table>
<h4 data-id="heading-27">6.2 å·®å¼‚æ€§ï¼šæ¶æ„å®Œæ•´æ€§çš„æœ¬è´¨åŒºåˆ«</h4>
<p>å…³é”®å·®å¼‚åœ¨äºæ§åˆ¶å±‚çš„å¤„ç†æ–¹å¼ï¼š</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-comment">// MVCçš„æ˜ç¡®æ§åˆ¶æµ</span>
<span class="hljs-comment">// 1. ç”¨æˆ·è¾“å…¥ -&gt; Controller</span>
<span class="hljs-comment">// 2. Controlleræ›´æ–°Model</span>
<span class="hljs-comment">// 3. Modelé€šçŸ¥Viewæ›´æ–°</span>

<span class="hljs-comment">// æ–‡æ¡£/è§†å›¾çš„æ··åˆæ§åˆ¶æµ</span>
<span class="hljs-comment">// 1. ç”¨æˆ·è¾“å…¥ -&gt; Viewï¼ˆç›´æ¥å¤„ç†ï¼‰</span>
<span class="hljs-comment">// 2. Viewæ›´æ–°Documentï¼ˆç›´æ¥è°ƒç”¨ï¼‰</span>
<span class="hljs-comment">// 3. Documenté€šçŸ¥æ‰€æœ‰Viewæ›´æ–°</span>
</code></pre>
<p><strong>æ¶æ„å·®å¼‚çš„å…·ä½“è¡¨ç°ï¼š</strong></p>
<ol>
<li>
<p><strong>æ§åˆ¶å™¨è§’è‰²çš„ç¼ºå¤±</strong></p>
<ul>
<li>MVCï¼šControlleræ˜¯ç‹¬ç«‹çš„åè°ƒè€…ï¼Œå†³å®šå¦‚ä½•å“åº”è¾“å…¥</li>
<li>æ–‡æ¡£/è§†å›¾ï¼šæ§åˆ¶é€»è¾‘åˆ†æ•£åœ¨Viewå’ŒDocumentä¸­</li>
</ul>
</li>
<li>
<p><strong>é€šä¿¡æ¨¡å¼çš„ä¸åŒ</strong></p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-comment">// MVCï¼šè§‚å¯Ÿè€…æ¨¡å¼ï¼Œæ¾è€¦åˆ</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">Model</span> {
    List&lt;Observer&gt; observers;
    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">notifyObservers</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">for</span> (obs in observers) obs.<span class="hljs-built_in">update</span>();
    }
};

<span class="hljs-comment">// æ–‡æ¡£/è§†å›¾ï¼šç›´æ¥è°ƒç”¨ï¼Œç´§è€¦åˆ</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">Document</span> {
    List&lt;View*&gt; views;
    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">UpdateAllViews</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">for</span> (view in views) view-&gt;<span class="hljs-built_in">OnUpdate</span>(<span class="hljs-keyword">this</span>);
    }
};
</code></pre>
</li>
<li>
<p><strong>å¯æµ‹è¯•æ€§çš„å½±å“</strong></p>
<ul>
<li>MVCï¼šModelå’ŒControllerå¯ç‹¬ç«‹äºViewè¿›è¡Œå•å…ƒæµ‹è¯•</li>
<li>æ–‡æ¡£/è§†å›¾ï¼šViewå’ŒDocumentç´§å¯†è€¦åˆï¼Œæµ‹è¯•å›°éš¾</li>
</ul>
</li>
</ol>
<h3 data-id="heading-28">ä¸ƒã€æ¶æ„çš„é€‚ç”¨åœºæ™¯ä¸å±€é™æ€§</h3>
<h4 data-id="heading-29">7.1 ç†æƒ³é€‚ç”¨åœºæ™¯</h4>
<p>æ–‡æ¡£/è§†å›¾æ¶æ„ç‰¹åˆ«é€‚åˆä»¥ä¸‹ç±»å‹çš„åº”ç”¨ï¼š</p>
<ol>
<li><strong>æ–‡æ¡£ä¸­å¿ƒå‹åº”ç”¨</strong>ï¼šæ–‡å­—å¤„ç†å™¨ã€ç”µå­è¡¨æ ¼ã€ä»£ç ç¼–è¾‘å™¨</li>
<li><strong>å¤šè§†å›¾æ•°æ®å±•ç¤º</strong>ï¼šCADç³»ç»Ÿã€æ•°æ®åˆ†æå·¥å…·ã€æ•°æ®åº“å‰ç«¯</li>
<li><strong>éœ€è¦å®Œæ•´æ–‡ä»¶æ”¯æŒçš„åº”ç”¨</strong>ï¼šæ”¯æŒæ‰“å¼€ã€ä¿å­˜ã€å¦å­˜ä¸ºç­‰æ ‡å‡†æ“ä½œ</li>
</ol>
<h4 data-id="heading-30">7.2 æ¶æ„å±€é™æ€§</h4>
<ol>
<li><strong>å­¦ä¹ æ›²çº¿é™¡å³­</strong>ï¼šéœ€è¦ç†è§£å¤§é‡MFCç‰¹å®šæ¦‚å¿µå’Œå®</li>
<li><strong>è¿‡åº¦è®¾è®¡ç®€å•åº”ç”¨</strong>ï¼šå¯¹äºå¯¹è¯æ¡†åº”ç”¨è¿‡äºå¤æ‚</li>
<li><strong>å¹³å°é”å®š</strong>ï¼šæ·±åº¦ç»‘å®šWindowså’ŒMFCæ¡†æ¶</li>
<li><strong>ç°ä»£æ€§ä¸è¶³</strong>ï¼šç¼ºä¹å¯¹è§¦æ‘¸ã€æ‰‹åŠ¿ç­‰ç°ä»£äº¤äº’çš„æ”¯æŒ</li>
</ol>
<h3 data-id="heading-31">å…«ã€å®é™…åº”ç”¨ç¤ºä¾‹ï¼šç®€æ˜“æ–‡æœ¬ç¼–è¾‘å™¨</h3>
<p>ä»¥ä¸‹æ˜¯æ–‡æ¡£/è§†å›¾æ¶æ„åœ¨æ–‡æœ¬ç¼–è¾‘å™¨ä¸­çš„å®Œæ•´å®ç°ç¤ºä¾‹ï¼š</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-comment">// æ–‡æ¡£ç±» - ç®¡ç†æ–‡æœ¬æ•°æ®</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">CTextDocument</span> : <span class="hljs-keyword">public</span> CDocument
{
<span class="hljs-keyword">protected</span>:
    <span class="hljs-built_in">CTextDocument</span>();
    
    <span class="hljs-comment">// æ•°æ®å­˜å‚¨</span>
    CStringArray m_lines;
    <span class="hljs-type">int</span> m_nTotalChars;
    
<span class="hljs-keyword">public</span>:
    <span class="hljs-comment">// æ•°æ®æ“ä½œæ¥å£</span>
    <span class="hljs-function">BOOL <span class="hljs-title">InsertText</span><span class="hljs-params">(<span class="hljs-type">int</span> nLine, <span class="hljs-type">int</span> nPos, <span class="hljs-type">const</span> CString&amp; strText)</span></span>;
    <span class="hljs-function">BOOL <span class="hljs-title">DeleteText</span><span class="hljs-params">(<span class="hljs-type">int</span> nLine, <span class="hljs-type">int</span> nPos, <span class="hljs-type">int</span> nCount)</span></span>;
    <span class="hljs-function">CString <span class="hljs-title">GetText</span><span class="hljs-params">(<span class="hljs-type">int</span> nLine, <span class="hljs-type">int</span> nPos, <span class="hljs-type">int</span> nCount)</span> <span class="hljs-type">const</span></span>;
    
    <span class="hljs-comment">// é‡å†™å…³é”®æ–¹æ³•</span>
    <span class="hljs-function"><span class="hljs-keyword">virtual</span> BOOL <span class="hljs-title">OnNewDocument</span><span class="hljs-params">()</span></span>;
    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">void</span> <span class="hljs-title">Serialize</span><span class="hljs-params">(CArchive&amp; ar)</span></span>;
    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">void</span> <span class="hljs-title">DeleteContents</span><span class="hljs-params">()</span></span>;
    
    <span class="hljs-built_in">DECLARE_DYNCREATE</span>(CTextDocument)
};

<span class="hljs-comment">// è§†å›¾ç±» - æ˜¾ç¤ºå’Œç¼–è¾‘æ–‡æœ¬</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">CTextView</span> : <span class="hljs-keyword">public</span> CScrollView
{
<span class="hljs-keyword">protected</span>:
    <span class="hljs-built_in">CTextView</span>();
    
    <span class="hljs-comment">// ç¼–è¾‘çŠ¶æ€</span>
    <span class="hljs-type">int</span> m_nCaretLine;    <span class="hljs-comment">// å…‰æ ‡æ‰€åœ¨è¡Œ</span>
    <span class="hljs-type">int</span> m_nCaretPos;     <span class="hljs-comment">// å…‰æ ‡åœ¨è¡Œä¸­çš„ä½ç½®</span>
    BOOL m_bSelecting;   <span class="hljs-comment">// æ˜¯å¦åœ¨é€‰æ‹©æ–‡æœ¬</span>
    CPoint m_ptSelectStart; <span class="hljs-comment">// é€‰æ‹©èµ·å§‹ç‚¹</span>
    
    <span class="hljs-comment">// æ˜¾ç¤ºå±æ€§</span>
    CFont m_font;
    CSize m_sizeChar;    <span class="hljs-comment">// å­—ç¬¦å°ºå¯¸</span>
    <span class="hljs-type">int</span> m_nLinesPerPage; <span class="hljs-comment">// æ¯é¡µè¡Œæ•°</span>
    
<span class="hljs-keyword">public</span>:
    <span class="hljs-function">CTextDocument* <span class="hljs-title">GetDocument</span><span class="hljs-params">()</span> <span class="hljs-type">const</span></span>;
    
    <span class="hljs-comment">// é‡å†™å…³é”®æ–¹æ³•</span>
    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">void</span> <span class="hljs-title">OnDraw</span><span class="hljs-params">(CDC* pDC)</span></span>;
    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">void</span> <span class="hljs-title">OnInitialUpdate</span><span class="hljs-params">()</span></span>;
    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">void</span> <span class="hljs-title">OnUpdate</span><span class="hljs-params">(CView* pSender, LPARAM lHint, CObject* pHint)</span></span>;
    
    <span class="hljs-comment">// æ¶ˆæ¯å¤„ç†</span>
    <span class="hljs-function">afx_msg <span class="hljs-type">void</span> <span class="hljs-title">OnLButtonDown</span><span class="hljs-params">(UINT nFlags, CPoint point)</span></span>;
    <span class="hljs-function">afx_msg <span class="hljs-type">void</span> <span class="hljs-title">OnMouseMove</span><span class="hljs-params">(UINT nFlags, CPoint point)</span></span>;
    <span class="hljs-function">afx_msg <span class="hljs-type">void</span> <span class="hljs-title">OnLButtonUp</span><span class="hljs-params">(UINT nFlags, CPoint point)</span></span>;
    <span class="hljs-function">afx_msg <span class="hljs-type">void</span> <span class="hljs-title">OnKeyDown</span><span class="hljs-params">(UINT nChar, UINT nRepCnt, UINT nFlags)</span></span>;
    <span class="hljs-function">afx_msg <span class="hljs-type">void</span> <span class="hljs-title">OnChar</span><span class="hljs-params">(UINT nChar, UINT nRepCnt, UINT nFlags)</span></span>;
    <span class="hljs-function">afx_msg <span class="hljs-type">void</span> <span class="hljs-title">OnVScroll</span><span class="hljs-params">(UINT nSBCode, UINT nPos, CScrollBar* pScrollBar)</span></span>;
    
    <span class="hljs-comment">// è®¡ç®—è¾…åŠ©å‡½æ•°</span>
    <span class="hljs-function">CPoint <span class="hljs-title">CharPosFromPoint</span><span class="hljs-params">(CPoint point)</span> <span class="hljs-type">const</span></span>;
    <span class="hljs-function">CPoint <span class="hljs-title">PointFromCharPos</span><span class="hljs-params">(<span class="hljs-type">int</span> nLine, <span class="hljs-type">int</span> nPos)</span> <span class="hljs-type">const</span></span>;
    <span class="hljs-function">CRect <span class="hljs-title">GetLineRect</span><span class="hljs-params">(<span class="hljs-type">int</span> nLine)</span> <span class="hljs-type">const</span></span>;
    
    <span class="hljs-built_in">DECLARE_DYNCREATE</span>(CTextView)
    <span class="hljs-built_in">DECLARE_MESSAGE_MAP</span>()
};
</code></pre>
<h3 data-id="heading-32">ä¹ã€ç°ä»£æ¡†æ¶ä¸­çš„æ¼”è¿›ä¸å¯ç¤º</h3>
<p>è™½ç„¶MFCæ–‡æ¡£/è§†å›¾æ¶æ„å·²é€æ¸é€€å‡ºä¸»æµï¼Œä½†å…¶è®¾è®¡æ€æƒ³åœ¨ç°ä»£æ¡†æ¶ä¸­ä»æœ‰ä½“ç°ï¼š</p>
<ol>
<li><strong>æ•°æ®ç»‘å®š</strong>ï¼šWPF/XAMLçš„æ•°æ®ç»‘å®šæœºåˆ¶æ˜¯æ–‡æ¡£/è§†å›¾åˆ†ç¦»çš„è¿›åŒ–</li>
<li><strong>MVVMæ¨¡å¼</strong>ï¼šModel-View-ViewModelå¯è§†ä¸ºæ–‡æ¡£/è§†å›¾çš„ç°ä»£åŒ–èº«</li>
<li><strong>å“åº”å¼ç¼–ç¨‹</strong>ï¼šRxJSç­‰åº“å®ç°äº†æ›´çµæ´»çš„æ•°æ®-è§†å›¾åŒæ­¥</li>
</ol>
<p><strong>æ¶æ„æ¼”è¿›çš„å¯ç¤ºï¼š</strong></p>
<ul>
<li>å…³æ³¨ç‚¹åˆ†ç¦»æ˜¯æ°¸æ’çš„è®¾è®¡åŸåˆ™</li>
<li>æ¡†æ¶åº”è¯¥æä¾›æ¸…æ™°çš„æ•°æ®æµæŒ‡å¯¼</li>
<li>å¯æµ‹è¯•æ€§åº”è¯¥æˆä¸ºæ¶æ„çš„æ ¸å¿ƒè€ƒé‡</li>
<li>å¹³å°æŠ½è±¡å±‚å¯¹äºé•¿æœŸç»´æŠ¤è‡³å…³é‡è¦</li>
</ul>
<p>æ–‡æ¡£/è§†å›¾æ¶æ„å±•ç¤ºäº†åœ¨ç‰¹å®šæŠ€æœ¯çº¦æŸä¸‹ï¼ˆC++ã€Windowsã€90å¹´ä»£ç¡¬ä»¶ï¼‰å¦‚ä½•å®ç°å¤æ‚åº”ç”¨çš„ç»“æ„åŒ–ç»„ç»‡ã€‚è™½ç„¶å…·ä½“æŠ€æœ¯å·²è¿‡æ—¶ï¼Œä½†å…¶èƒŒåçš„æ¶æ„æ€ç»´â€”â€”å¦‚ä½•ç®¡ç†å¤æ‚æ€§ã€å¦‚ä½•åˆ†ç¦»å…³æ³¨ç‚¹ã€å¦‚ä½•è®¾è®¡å¯æ‰©å±•çš„ç³»ç»Ÿâ€”â€”å¯¹ä»Šå¤©çš„è½¯ä»¶å¼€å‘è€…ä»æœ‰é‡è¦ä»·å€¼ã€‚</p>
<h2 data-id="heading-33">ç¬¬ä¸‰ç« ï¼šMFCå¯¹è¯æ¡†ä¸DDX/DDVæœºåˆ¶â€”â€”ç”¨æˆ·ç•Œé¢çš„æ ‡å‡†åŒ–å°è£…</h2>
<h3 data-id="heading-34">ä¸€ã€å¯¹è¯æ¡†ç¼–ç¨‹çš„æ¼”è¿›ï¼šä»åŸå§‹APIåˆ°MFCå°è£…</h3>
<p>åœ¨åŸå§‹çš„Windows SDKä¸­ï¼Œåˆ›å»ºå’Œç®¡ç†å¯¹è¯æ¡†æ˜¯ä¸€é¡¹ç¹çä¸”å®¹æ˜“å‡ºé”™çš„å·¥ä½œã€‚å¼€å‘è€…éœ€è¦æ‰‹åŠ¨å¤„ç†å¯¹è¯æ¡†è¿‡ç¨‹å‡½æ•°ã€æ§ä»¶æ¶ˆæ¯ã€æ•°æ®éªŒè¯ç­‰ä¸€ç³»åˆ—å¤æ‚ä»»åŠ¡ã€‚MFCçš„å¯¹è¯æ¡†ç±»ï¼ˆCDialogåŠå…¶æ´¾ç”Ÿç±»ï¼‰é€šè¿‡é¢å‘å¯¹è±¡çš„å°è£…ï¼Œæå¤§åœ°ç®€åŒ–äº†è¿™ä¸€è¿‡ç¨‹ã€‚</p>
<h4 data-id="heading-35">1.1 åŸå§‹Win32å¯¹è¯æ¡†ç¼–ç¨‹çš„å¤æ‚æ€§</h4>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-comment">// Win32 SDKä¸­çš„å¯¹è¯æ¡†ç¤ºä¾‹</span>
<span class="hljs-function">BOOL CALLBACK <span class="hljs-title">DialogProc</span><span class="hljs-params">(HWND hwndDlg, UINT uMsg, WPARAM wParam, LPARAM lParam)</span>
</span>{
    <span class="hljs-keyword">switch</span> (uMsg)
    {
        <span class="hljs-keyword">case</span> WM_INITDIALOG:
            <span class="hljs-comment">// åˆå§‹åŒ–æ§ä»¶</span>
            <span class="hljs-built_in">SetDlgItemText</span>(hwndDlg, IDC_EDIT_NAME, <span class="hljs-string">"é»˜è®¤åç§°"</span>);
            <span class="hljs-built_in">SetDlgItemInt</span>(hwndDlg, IDC_EDIT_AGE, <span class="hljs-number">25</span>, FALSE);
            <span class="hljs-keyword">return</span> TRUE;
            
        <span class="hljs-keyword">case</span> WM_COMMAND:
            <span class="hljs-keyword">switch</span> (<span class="hljs-built_in">LOWORD</span>(wParam))
            {
                <span class="hljs-keyword">case</span> IDOK:
                {
                    <span class="hljs-comment">// è·å–æ•°æ®</span>
                    TCHAR szName[<span class="hljs-number">100</span>];
                    <span class="hljs-built_in">GetDlgItemText</span>(hwndDlg, IDC_EDIT_NAME, szName, <span class="hljs-number">100</span>);
                    
                    <span class="hljs-comment">// æ‰‹åŠ¨éªŒè¯</span>
                    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">lstrlen</span>(szName) == <span class="hljs-number">0</span>)
                    {
                        <span class="hljs-built_in">MessageBox</span>(hwndDlg, <span class="hljs-string">"å§“åä¸èƒ½ä¸ºç©º"</span>, <span class="hljs-string">"é”™è¯¯"</span>, MB_OK);
                        <span class="hljs-keyword">return</span> TRUE;
                    }
                    
                    <span class="hljs-type">int</span> nAge = <span class="hljs-built_in">GetDlgItemInt</span>(hwndDlg, IDC_EDIT_AGE, <span class="hljs-literal">NULL</span>, FALSE);
                    <span class="hljs-keyword">if</span> (nAge &lt; <span class="hljs-number">0</span> || nAge &gt; <span class="hljs-number">150</span>)
                    {
                        <span class="hljs-built_in">MessageBox</span>(hwndDlg, <span class="hljs-string">"å¹´é¾„å¿…é¡»åœ¨0-150ä¹‹é—´"</span>, <span class="hljs-string">"é”™è¯¯"</span>, MB_OK);
                        <span class="hljs-keyword">return</span> TRUE;
                    }
                    
                    <span class="hljs-built_in">EndDialog</span>(hwndDlg, IDOK);
                    <span class="hljs-keyword">return</span> TRUE;
                }
                
                <span class="hljs-keyword">case</span> IDCANCEL:
                    <span class="hljs-built_in">EndDialog</span>(hwndDlg, IDCANCEL);
                    <span class="hljs-keyword">return</span> TRUE;
            }
            <span class="hljs-keyword">break</span>;
    }
    <span class="hljs-keyword">return</span> FALSE;
}

<span class="hljs-comment">// è°ƒç”¨å¯¹è¯æ¡†</span>
<span class="hljs-built_in">DialogBox</span>(hInstance, <span class="hljs-built_in">MAKEINTRESOURCE</span>(IDD_MYDIALOG), hwndParent, DialogProc);
</code></pre>
<p>è¿™ç§æ¨¡å¼å­˜åœ¨æ˜æ˜¾é—®é¢˜ï¼š</p>
<ol>
<li><strong>ä»£ç å†—é•¿</strong>ï¼šæ¯ä¸ªæ§ä»¶éƒ½éœ€è¦å•ç‹¬è·å–å’Œè®¾ç½®</li>
<li><strong>éªŒè¯åˆ†æ•£</strong>ï¼šéªŒè¯é€»è¾‘ä¸UIé€»è¾‘æ··æ‚</li>
<li><strong>ç±»å‹ä¸å®‰å…¨</strong>ï¼šæ‰€æœ‰æ•°æ®éƒ½æ˜¯å­—ç¬¦ä¸²æˆ–æ•´æ•°ï¼Œéœ€è¦æ‰‹åŠ¨è½¬æ¢</li>
<li><strong>éš¾ä»¥ç»´æŠ¤</strong>ï¼šæ·»åŠ æ–°æ§ä»¶éœ€è¦ä¿®æ”¹å¤šä¸ªåœ°æ–¹</li>
</ol>
<h3 data-id="heading-36">äºŒã€MFCå¯¹è¯æ¡†ç±»çš„å°è£…æ¶æ„</h3>
<h4 data-id="heading-37">2.1 CDialogç±»å±‚æ¬¡ç»“æ„</h4>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-comment">// MFCå¯¹è¯æ¡†ç±»çš„åŸºæœ¬å±‚æ¬¡</span>
CObject
â””â”€â”€ CCmdTarget
    â””â”€â”€ CWnd
        â””â”€â”€ CDialog
            â”œâ”€â”€ <span class="hljs-built_in">CCommonDialog</span> (é€šç”¨å¯¹è¯æ¡†åŸºç±»)
            â”‚   â”œâ”€â”€ CFileDialog
            â”‚   â”œâ”€â”€ CColorDialog
            â”‚   â”œâ”€â”€ CFontDialog
            â”‚   â””â”€â”€ ...
            â””â”€â”€ <span class="hljs-built_in">CDialogEx</span> (å¢å¼ºåŠŸèƒ½)

<span class="hljs-comment">// å…¸å‹çš„MFCå¯¹è¯æ¡†ç±»å®šä¹‰</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">CMyDialog</span> : <span class="hljs-keyword">public</span> CDialogEx
{
    <span class="hljs-built_in">DECLARE_DYNAMIC</span>(CMyDialog)

<span class="hljs-keyword">public</span>:
    <span class="hljs-comment">// æ ‡å‡†æ„é€ å‡½æ•°</span>
    <span class="hljs-built_in">CMyDialog</span>(CWnd* pParent = <span class="hljs-literal">NULL</span>);
    
    <span class="hljs-comment">// å¯¹è¯æ¡†èµ„æºID</span>
    <span class="hljs-keyword">enum</span> { IDD = IDD_MYDIALOG };

<span class="hljs-keyword">protected</span>:
    <span class="hljs-comment">// DDX/DDVæ”¯æŒ</span>
    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">void</span> <span class="hljs-title">DoDataExchange</span><span class="hljs-params">(CDataExchange* pDX)</span></span>;

    <span class="hljs-comment">// æ¶ˆæ¯æ˜ å°„</span>
    <span class="hljs-built_in">DECLARE_MESSAGE_MAP</span>()

<span class="hljs-keyword">public</span>:
    <span class="hljs-comment">// æ§ä»¶å…³è”å˜é‡</span>
    CString m_strName;
    <span class="hljs-type">int</span> m_nAge;
    BOOL m_bAgree;
    CComboBox m_cboGender;
};
</code></pre>
<h4 data-id="heading-38">2.2 å¯¹è¯æ¡†ç”Ÿå‘½å‘¨æœŸç®¡ç†</h4>
<p>MFCå¯¹è¯æ¡†çš„ç”Ÿå‘½å‘¨æœŸç”±ä»¥ä¸‹å…³é”®æ–¹æ³•æ§åˆ¶ï¼š</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-comment">// å¯¹è¯æ¡†åˆ›å»ºä¸é”€æ¯æµç¨‹</span>
<span class="hljs-function">BOOL <span class="hljs-title">CMyDialog::OnInitDialog</span><span class="hljs-params">()</span>
</span>{
    CDialogEx::<span class="hljs-built_in">OnInitDialog</span>();
    
    <span class="hljs-comment">// 1. åˆå§‹åŒ–æ§ä»¶</span>
    m_cboGender.<span class="hljs-built_in">AddString</span>(_T(<span class="hljs-string">"ç”·"</span>));
    m_cboGender.<span class="hljs-built_in">AddString</span>(_T(<span class="hljs-string">"å¥³"</span>));
    m_cboGender.<span class="hljs-built_in">SetCurSel</span>(<span class="hljs-number">0</span>);
    
    <span class="hljs-comment">// 2. è®¾ç½®åˆå§‹æ•°æ®</span>
    m_strName = _T(<span class="hljs-string">"å¼ ä¸‰"</span>);
    m_nAge = <span class="hljs-number">25</span>;
    m_bAgree = TRUE;
    
    <span class="hljs-comment">// 3. æ›´æ–°æ§ä»¶æ˜¾ç¤º</span>
    <span class="hljs-built_in">UpdateData</span>(FALSE);
    
    <span class="hljs-comment">// 4. å…¶ä»–åˆå§‹åŒ–</span>
    <span class="hljs-built_in">CenterWindow</span>();  <span class="hljs-comment">// å±…ä¸­æ˜¾ç¤º</span>
    
    <span class="hljs-keyword">return</span> TRUE;
}

<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">CMyDialog::OnOK</span><span class="hljs-params">()</span>
</span>{
    <span class="hljs-comment">// 1. ä»æ§ä»¶è·å–æ•°æ®å¹¶éªŒè¯</span>
    <span class="hljs-keyword">if</span> (!<span class="hljs-built_in">UpdateData</span>(TRUE))
        <span class="hljs-keyword">return</span>;  <span class="hljs-comment">// éªŒè¯å¤±è´¥ï¼Œä¸å…³é—­å¯¹è¯æ¡†</span>
    
    <span class="hljs-comment">// 2. é¢å¤–çš„ä¸šåŠ¡é€»è¾‘éªŒè¯</span>
    <span class="hljs-keyword">if</span> (m_strName.<span class="hljs-built_in">GetLength</span>() &lt; <span class="hljs-number">2</span>)
    {
        <span class="hljs-built_in">MessageBox</span>(_T(<span class="hljs-string">"å§“åè‡³å°‘éœ€è¦2ä¸ªå­—ç¬¦"</span>), _T(<span class="hljs-string">"é”™è¯¯"</span>), MB_ICONERROR);
        <span class="hljs-built_in">GetDlgItem</span>(IDC_EDIT_NAME)-&gt;<span class="hljs-built_in">SetFocus</span>();
        <span class="hljs-keyword">return</span>;
    }
    
    <span class="hljs-comment">// 3. è°ƒç”¨åŸºç±»OnOKå…³é—­å¯¹è¯æ¡†</span>
    CDialogEx::<span class="hljs-built_in">OnOK</span>();
}

<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">CMyDialog::OnCancel</span><span class="hljs-params">()</span>
</span>{
    <span class="hljs-comment">// å–æ¶ˆå‰çš„ç¡®è®¤</span>
    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">MessageBox</span>(_T(<span class="hljs-string">"ç¡®å®šè¦å–æ¶ˆå—ï¼Ÿ"</span>), _T(<span class="hljs-string">"ç¡®è®¤"</span>), 
                   MB_YESNO | MB_ICONQUESTION) == IDYES)
    {
        CDialogEx::<span class="hljs-built_in">OnCancel</span>();
    }
}
</code></pre>
<h3 data-id="heading-39">ä¸‰ã€DDXï¼ˆå¯¹è¯æ¡†æ•°æ®äº¤æ¢ï¼‰æœºåˆ¶è¯¦è§£</h3>
<h4 data-id="heading-40">3.1 DDXçš„æ ¸å¿ƒåŸç†</h4>
<p>DDXæœºåˆ¶é€šè¿‡<code>DoDataExchange</code>å‡½æ•°å’Œä¸€ç»„é¢„å®šä¹‰çš„å®ï¼Œåœ¨å¯¹è¯æ¡†æ§ä»¶å’Œæˆå‘˜å˜é‡ä¹‹é—´å»ºç«‹åŒå‘æ•°æ®ç»‘å®šï¼š</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-comment">// DoDataExchangeå‡½æ•°çš„æ ‡å‡†å®ç°</span>
<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">CMyDialog::DoDataExchange</span><span class="hljs-params">(CDataExchange* pDX)</span>
</span>{
    CDialogEx::<span class="hljs-built_in">DoDataExchange</span>(pDX);
    
    <span class="hljs-comment">// æ–‡æœ¬æ§ä»¶äº¤æ¢</span>
    <span class="hljs-built_in">DDX_Text</span>(pDX, IDC_EDIT_NAME, m_strName);
    
    <span class="hljs-comment">// æ•°å€¼æ§ä»¶äº¤æ¢</span>
    <span class="hljs-built_in">DDX_Text</span>(pDX, IDC_EDIT_AGE, m_nAge);
    
    <span class="hljs-comment">// å¤é€‰æ¡†äº¤æ¢</span>
    <span class="hljs-built_in">DDX_Check</span>(pDX, IDC_CHECK_AGREE, m_bAgree);
    
    <span class="hljs-comment">// å•é€‰æŒ‰é’®äº¤æ¢</span>
    <span class="hljs-built_in">DDX_Radio</span>(pDX, IDC_RADIO_MALE, m_nGender);
    
    <span class="hljs-comment">// ç»„åˆæ¡†äº¤æ¢</span>
    <span class="hljs-built_in">DDX_CBIndex</span>(pDX, IDC_COMBO_STATUS, m_nStatusIndex);
    <span class="hljs-built_in">DDX_CBString</span>(pDX, IDC_COMBO_STATUS, m_strStatus);
    
    <span class="hljs-comment">// åˆ—è¡¨æ¡†äº¤æ¢</span>
    <span class="hljs-built_in">DDX_LBIndex</span>(pDX, IDC_LIST_ITEMS, m_nSelectedItem);
    
    <span class="hljs-comment">// æ§ä»¶å¯¹è±¡äº¤æ¢</span>
    <span class="hljs-built_in">DDX_Control</span>(pDX, IDC_COMBO_GENDER, m_cboGender);
}
</code></pre>
<h4 data-id="heading-41">3.2 DDXå®çš„ç¼–è¯‘æ—¶å±•å¼€</h4>
<p>ç¼–è¯‘å™¨ä¼šå°†DDXå®å±•å¼€ä¸ºå…·ä½“çš„ä»£ç ï¼Œä»¥ä¸‹æ˜¯å¯¹<code>DDX_Text</code>å®å±•å¼€çš„æ¨¡æ‹Ÿï¼š</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-comment">// DDX_Textå®çš„è¿‘ä¼¼å±•å¼€ï¼ˆæ¦‚å¿µæ€§ä»£ç ï¼‰</span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> DDX_Text(pDX, nIDC, value) \
    do { \
        <span class="hljs-keyword">if</span> ((pDX)-&gt;m_bSaveAndValidate) { \
            <span class="hljs-comment">/* ä»æ§ä»¶è·å–æ•°æ®åˆ°å˜é‡ */</span> \
            HWND hWndCtrl = ::GetDlgItem((pDX)-&gt;m_pDlgWnd-&gt;m_hWnd, nIDC); \
            <span class="hljs-keyword">if</span> (hWndCtrl != NULL) { \
                int nLen = ::GetWindowTextLength(hWndCtrl); \
                CString strTemp; \
                ::GetWindowText(hWndCtrl, strTemp.GetBuffer(nLen), nLen + 1); \
                strTemp.ReleaseBuffer(); \
                <span class="hljs-comment">/* ç±»å‹è½¬æ¢å’Œèµ‹å€¼ */</span> \
                value = _ttoi(strTemp); <span class="hljs-comment">/* å¯¹äºintç±»å‹ */</span> \
            } \
        } <span class="hljs-keyword">else</span> { \
            <span class="hljs-comment">/* ä»å˜é‡è®¾ç½®æ•°æ®åˆ°æ§ä»¶ */</span> \
            CString strTemp; \
            strTemp.Format(_T(<span class="hljs-string">"%d"</span>), value); <span class="hljs-comment">/* å¯¹äºintç±»å‹ */</span> \
            ::SetDlgItemText((pDX)-&gt;m_pDlgWnd-&gt;m_hWnd, nIDC, strTemp); \
        } \
    } while (0)</span>
</code></pre>
<h4 data-id="heading-42">3.3 å®Œæ•´DDXæ”¯æŒçš„æ•°æ®ç±»å‹</h4>
<p>MFCä¸ºä¸åŒç±»å‹çš„æ•°æ®æä¾›äº†ä¸“é—¨çš„DDXå®ï¼š</p>













































































<table><thead><tr><th>æ•°æ®ç±»å‹</th><th>DDXå®</th><th>ç¤ºä¾‹</th><th>é€‚ç”¨æ§ä»¶</th></tr></thead><tbody><tr><td><strong>CString</strong></td><td><code>DDX_Text</code></td><td><code>DDX_Text(pDX, IDC_EDIT, m_strValue)</code></td><td>ç¼–è¾‘æ¡†</td></tr><tr><td><strong>int</strong></td><td><code>DDX_Text</code></td><td><code>DDX_Text(pDX, IDC_EDIT, m_nValue)</code></td><td>ç¼–è¾‘æ¡†</td></tr><tr><td><strong>UINT</strong></td><td><code>DDX_Text</code></td><td><code>DDX_Text(pDX, IDC_EDIT, m_uValue)</code></td><td>ç¼–è¾‘æ¡†</td></tr><tr><td><strong>long</strong></td><td><code>DDX_Text</code></td><td><code>DDX_Text(pDX, IDC_EDIT, m_lValue)</code></td><td>ç¼–è¾‘æ¡†</td></tr><tr><td><strong>DWORD</strong></td><td><code>DDX_Text</code></td><td><code>DDX_Text(pDX, IDC_EDIT, m_dwValue)</code></td><td>ç¼–è¾‘æ¡†</td></tr><tr><td><strong>float</strong></td><td><code>DDX_Text</code></td><td><code>DDX_Text(pDX, IDC_EDIT, m_fValue)</code></td><td>ç¼–è¾‘æ¡†</td></tr><tr><td><strong>double</strong></td><td><code>DDX_Text</code></td><td><code>DDX_Text(pDX, IDC_EDIT, m_dValue)</code></td><td>ç¼–è¾‘æ¡†</td></tr><tr><td><strong>BOOL</strong></td><td><code>DDX_Check</code></td><td><code>DDX_Check(pDX, IDC_CHECK, m_bValue)</code></td><td>å¤é€‰æ¡†</td></tr><tr><td><strong>int</strong> (å•é€‰)</td><td><code>DDX_Radio</code></td><td><code>DDX_Radio(pDX, IDC_RADIO1, m_nIndex)</code></td><td>å•é€‰æŒ‰é’®ç»„</td></tr><tr><td><strong>CComboBox</strong></td><td><code>DDX_Control</code></td><td><code>DDX_Control(pDX, IDC_COMBO, m_combo)</code></td><td>ç»„åˆæ¡†å¯¹è±¡</td></tr><tr><td><strong>CListBox</strong></td><td><code>DDX_Control</code></td><td><code>DDX_Control(pDX, IDC_LIST, m_list)</code></td><td>åˆ—è¡¨æ¡†å¯¹è±¡</td></tr></tbody></table>
<h3 data-id="heading-43">å››ã€DDVï¼ˆå¯¹è¯æ¡†æ•°æ®éªŒè¯ï¼‰æœºåˆ¶è¯¦è§£</h3>
<h4 data-id="heading-44">4.1 DDVçš„å·¥ä½œåŸç†</h4>
<p>DDVåœ¨æ•°æ®äº¤æ¢çš„åŒæ—¶è¿›è¡ŒéªŒè¯ï¼Œç¡®ä¿æ•°æ®çš„æœ‰æ•ˆæ€§ï¼š</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-comment">// å¸¦æœ‰DDVéªŒè¯çš„DoDataExchangeç¤ºä¾‹</span>
<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">CMyDialog::DoDataExchange</span><span class="hljs-params">(CDataExchange* pDX)</span>
</span>{
    CDialogEx::<span class="hljs-built_in">DoDataExchange</span>(pDX);
    
    <span class="hljs-comment">// æ•°æ®äº¤æ¢</span>
    <span class="hljs-built_in">DDX_Text</span>(pDX, IDC_EDIT_NAME, m_strName);
    
    <span class="hljs-comment">// æ•°æ®éªŒè¯</span>
    <span class="hljs-built_in">DDV_MaxChars</span>(pDX, m_strName, <span class="hljs-number">50</span>);  <span class="hljs-comment">// æœ€å¤š50ä¸ªå­—ç¬¦</span>
    
    <span class="hljs-comment">// æ•°å€¼äº¤æ¢ä¸éªŒè¯</span>
    <span class="hljs-built_in">DDX_Text</span>(pDX, IDC_EDIT_AGE, m_nAge);
    <span class="hljs-built_in">DDV_MinMaxInt</span>(pDX, m_nAge, <span class="hljs-number">0</span>, <span class="hljs-number">150</span>);  <span class="hljs-comment">// èŒƒå›´0-150</span>
    
    <span class="hljs-comment">// å­—ç¬¦ä¸²éç©ºéªŒè¯</span>
    <span class="hljs-built_in">DDV_NonEmptyString</span>(pDX, m_strName);
}
</code></pre>
<h4 data-id="heading-45">4.2 DDVéªŒè¯å¤±è´¥çš„å¤„ç†æœºåˆ¶</h4>
<p>å½“DDVéªŒè¯å¤±è´¥æ—¶ï¼ŒMFCä¼šæŠ›å‡ºå¼‚å¸¸å¹¶è‡ªåŠ¨å¤„ç†ï¼š</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-comment">// DDV_MinMaxIntå®çš„å†…éƒ¨å®ç°é€»è¾‘ï¼ˆæ¦‚å¿µæ€§ï¼‰</span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> DDV_MinMaxInt(pDX, value, minVal, maxVal) \
    do { \
        <span class="hljs-keyword">if</span> ((pDX)-&gt;m_bSaveAndValidate &amp;&amp; (value <span class="hljs-string">&lt; minVal || value &gt;</span> maxVal)) { \
            <span class="hljs-comment">/* å‡†å¤‡é”™è¯¯ä¿¡æ¯ */</span> \
            CString strError; \
            strError.Format(_T(<span class="hljs-string">"æ•°å€¼å¿…é¡»åœ¨%då’Œ%dä¹‹é—´"</span>), minVal, maxVal); \
            \
            <span class="hljs-comment">/* æ˜¾ç¤ºé”™è¯¯å¯¹è¯æ¡† */</span> \
            AfxMessageBox(strError, MB_ICONEXCLAMATION); \
            \
            <span class="hljs-comment">/* æŠ›å‡ºå¼‚å¸¸åœæ­¢åç»­å¤„ç† */</span> \
            (pDX)-&gt;Fail(); \
        } \
    } while (0)</span>

<span class="hljs-comment">// CDataExchange::Fail()æ–¹æ³•çš„ç®€åŒ–å®ç°</span>
<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">CDataExchange::Fail</span><span class="hljs-params">()</span>
</span>{
    <span class="hljs-comment">// è®¾ç½®ç„¦ç‚¹åˆ°é—®é¢˜æ§ä»¶</span>
    <span class="hljs-keyword">if</span> (m_hWndLastControl != <span class="hljs-literal">NULL</span> &amp;&amp; ::<span class="hljs-built_in">IsWindow</span>(m_hWndLastControl))
    {
        ::<span class="hljs-built_in">SetFocus</span>(m_hWndLastControl);
    }
    
    <span class="hljs-comment">// æŠ›å‡ºå¼‚å¸¸ï¼Œè¢«MFCæ¡†æ¶æ•è·</span>
    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">CUserException</span>();
}
</code></pre>
<h4 data-id="heading-46">4.3 è‡ªå®šä¹‰DDVéªŒè¯</h4>
<p>é™¤äº†å†…ç½®çš„DDVå®ï¼Œè¿˜å¯ä»¥åˆ›å»ºè‡ªå®šä¹‰éªŒè¯ï¼š</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-comment">// è‡ªå®šä¹‰DDVéªŒè¯å®</span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> DDV_Email(pDX, value) \
    do { \
        <span class="hljs-keyword">if</span> ((pDX)-&gt;m_bSaveAndValidate) { \
            <span class="hljs-keyword">if</span> (!IsValidEmail(value)) { \
                AfxMessageBox(_T(<span class="hljs-string">"è¯·è¾“å…¥æœ‰æ•ˆçš„ç”µå­é‚®ä»¶åœ°å€"</span>), \
                             MB_ICONEXCLAMATION); \
                (pDX)-&gt;Fail(); \
            } \
        } \
    } while (0)</span>

<span class="hljs-comment">// ä½¿ç”¨è‡ªå®šä¹‰éªŒè¯</span>
<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">CMyDialog::DoDataExchange</span><span class="hljs-params">(CDataExchange* pDX)</span>
</span>{
    CDialogEx::<span class="hljs-built_in">DoDataExchange</span>(pDX);
    
    <span class="hljs-built_in">DDX_Text</span>(pDX, IDC_EDIT_EMAIL, m_strEmail);
    <span class="hljs-built_in">DDV_Email</span>(pDX, m_strEmail);  <span class="hljs-comment">// è‡ªå®šä¹‰éªŒè¯</span>
}

<span class="hljs-comment">// ç”µå­é‚®ä»¶éªŒè¯å‡½æ•°</span>
<span class="hljs-function">BOOL <span class="hljs-title">CMyDialog::IsValidEmail</span><span class="hljs-params">(<span class="hljs-type">const</span> CString&amp; strEmail)</span>
</span>{
    <span class="hljs-comment">// ç®€å•çš„ç”µå­é‚®ä»¶éªŒè¯é€»è¾‘</span>
    <span class="hljs-type">int</span> nAtPos = strEmail.<span class="hljs-built_in">Find</span>(<span class="hljs-string">'@'</span>);
    <span class="hljs-type">int</span> nDotPos = strEmail.<span class="hljs-built_in">Find</span>(<span class="hljs-string">'.'</span>, nAtPos);
    
    <span class="hljs-keyword">return</span> (nAtPos &gt; <span class="hljs-number">0</span> &amp;&amp; nDotPos &gt; nAtPos + <span class="hljs-number">1</span> &amp;&amp; 
            nDotPos &lt; strEmail.<span class="hljs-built_in">GetLength</span>() - <span class="hljs-number">1</span>);
}
</code></pre>
<h3 data-id="heading-47">äº”ã€æ¨¡æ€ä¸éæ¨¡æ€å¯¹è¯æ¡†çš„æ·±å…¥å¯¹æ¯”</h3>
<h4 data-id="heading-48">5.1 æ¨¡æ€å¯¹è¯æ¡†çš„å®Œæ•´ç”Ÿå‘½å‘¨æœŸ</h4>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-comment">// æ¨¡æ€å¯¹è¯æ¡†çš„åˆ›å»ºä¸ä½¿ç”¨</span>
<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">CMyView::OnOpenSettings</span><span class="hljs-params">()</span>
</span>{
    <span class="hljs-function">CMyDialog <span class="hljs-title">dlg</span><span class="hljs-params">(<span class="hljs-keyword">this</span>)</span></span>;  <span class="hljs-comment">// åˆ›å»ºå¯¹è¯æ¡†å¯¹è±¡</span>
    
    <span class="hljs-comment">// è®¾ç½®åˆå§‹å€¼</span>
    dlg.m_strName = m_strCurrentName;
    dlg.m_nAge = m_nCurrentAge;
    
    <span class="hljs-comment">// æ˜¾ç¤ºæ¨¡æ€å¯¹è¯æ¡†</span>
    <span class="hljs-keyword">if</span> (dlg.<span class="hljs-built_in">DoModal</span>() == IDOK)
    {
        <span class="hljs-comment">// ç”¨æˆ·ç‚¹å‡»äº†ç¡®å®š</span>
        m_strCurrentName = dlg.m_strName;
        m_nCurrentAge = dlg.m_nAge;
        
        <span class="hljs-comment">// ä¿å­˜è®¾ç½®</span>
        <span class="hljs-built_in">SaveSettings</span>();
        
        <span class="hljs-comment">// æ›´æ–°æ˜¾ç¤º</span>
        <span class="hljs-built_in">UpdateDisplay</span>();
    }
    <span class="hljs-keyword">else</span>
    {
        <span class="hljs-comment">// ç”¨æˆ·ç‚¹å‡»äº†å–æ¶ˆ</span>
        <span class="hljs-built_in">AfxMessageBox</span>(_T(<span class="hljs-string">"è®¾ç½®æœªä¿å­˜"</span>));
    }
    
    <span class="hljs-comment">// å¯¹è¯æ¡†å¯¹è±¡è‡ªåŠ¨é”€æ¯</span>
}
</code></pre>
<h4 data-id="heading-49">5.2 éæ¨¡æ€å¯¹è¯æ¡†çš„ç‰¹æ®Šç®¡ç†</h4>
<p>éæ¨¡æ€å¯¹è¯æ¡†éœ€è¦ä¸åŒçš„ç”Ÿå‘½å‘¨æœŸç®¡ç†ç­–ç•¥ï¼š</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-comment">// éæ¨¡æ€å¯¹è¯æ¡†çš„åˆ›å»ºä¸ç®¡ç†</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">CMyView</span> : <span class="hljs-keyword">public</span> CView
{
<span class="hljs-keyword">private</span>:
    CMyModelessDialog* m_pModelessDlg;  <span class="hljs-comment">// æŒ‡é’ˆæˆå‘˜</span>
    
<span class="hljs-keyword">public</span>:
    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">OnOpenModelessDialog</span><span class="hljs-params">()</span>
    </span>{
        <span class="hljs-comment">// é˜²æ­¢é‡å¤æ‰“å¼€</span>
        <span class="hljs-keyword">if</span> (m_pModelessDlg != <span class="hljs-literal">NULL</span> &amp;&amp; m_pModelessDlg-&gt;<span class="hljs-built_in">GetSafeHwnd</span>() != <span class="hljs-literal">NULL</span>)
        {
            m_pModelessDlg-&gt;<span class="hljs-built_in">SetActiveWindow</span>();
            m_pModelessDlg-&gt;<span class="hljs-built_in">ShowWindow</span>(SW_SHOW);
            <span class="hljs-keyword">return</span>;
        }
        
        <span class="hljs-comment">// åˆ›å»ºéæ¨¡æ€å¯¹è¯æ¡†</span>
        m_pModelessDlg = <span class="hljs-keyword">new</span> <span class="hljs-built_in">CMyModelessDialog</span>(<span class="hljs-keyword">this</span>);
        
        <span class="hljs-comment">// å¿…é¡»æŒ‡å®šWS_VISIBLEé£æ ¼</span>
        <span class="hljs-keyword">if</span> (!m_pModelessDlg-&gt;<span class="hljs-built_in">Create</span>(IDD_MYDIALOG, <span class="hljs-keyword">this</span>))
        {
            <span class="hljs-keyword">delete</span> m_pModelessDlg;
            m_pModelessDlg = <span class="hljs-literal">NULL</span>;
            <span class="hljs-built_in">AfxMessageBox</span>(_T(<span class="hljs-string">"åˆ›å»ºå¯¹è¯æ¡†å¤±è´¥"</span>));
            <span class="hljs-keyword">return</span>;
        }
        
        <span class="hljs-comment">// æ˜¾ç¤ºå¯¹è¯æ¡†</span>
        m_pModelessDlg-&gt;<span class="hljs-built_in">ShowWindow</span>(SW_SHOW);
    }
    
    <span class="hljs-comment">// å¯¹è¯æ¡†å…³é—­æ—¶çš„æ¸…ç†</span>
    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">OnModelessDialogClosed</span><span class="hljs-params">()</span>
    </span>{
        <span class="hljs-keyword">if</span> (m_pModelessDlg != <span class="hljs-literal">NULL</span>)
        {
            <span class="hljs-comment">// æ³¨æ„ï¼šä¸èƒ½è°ƒç”¨deleteï¼Œå¯¹è¯æ¡†è‡ªå·±ç®¡ç†ç”Ÿå‘½å‘¨æœŸ</span>
            m_pModelessDlg = <span class="hljs-literal">NULL</span>;
        }
    }
};

<span class="hljs-comment">// éæ¨¡æ€å¯¹è¯æ¡†ç±»</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">CMyModelessDialog</span> : <span class="hljs-keyword">public</span> CDialogEx
{
<span class="hljs-keyword">private</span>:
    CMyView* m_pParentView;
    
<span class="hljs-keyword">public</span>:
    <span class="hljs-built_in">CMyModelessDialog</span>(CMyView* pParent) 
        : <span class="hljs-built_in">CDialogEx</span>(IDD_MYDIALOG, pParent), <span class="hljs-built_in">m_pParentView</span>(pParent) {}
    
    <span class="hljs-comment">// é‡å†™OnOKå’ŒOnCancel</span>
    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">void</span> <span class="hljs-title">OnOK</span><span class="hljs-params">()</span>
    </span>{
        <span class="hljs-keyword">if</span> (!<span class="hljs-built_in">UpdateData</span>(TRUE))
            <span class="hljs-keyword">return</span>;
        
        <span class="hljs-comment">// é€šçŸ¥çˆ¶è§†å›¾</span>
        <span class="hljs-keyword">if</span> (m_pParentView != <span class="hljs-literal">NULL</span>)
        {
            m_pParentView-&gt;<span class="hljs-built_in">ApplyDialogSettings</span>(m_strName, m_nAge);
        }
        
        <span class="hljs-comment">// ä¸è°ƒç”¨åŸºç±»OnOKï¼ˆä¸å…³é—­å¯¹è¯æ¡†ï¼‰</span>
        <span class="hljs-comment">// è€Œæ˜¯éšè—æˆ–æ‰§è¡Œå…¶ä»–æ“ä½œ</span>
        <span class="hljs-built_in">ShowWindow</span>(SW_HIDE);
    }
    
    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">void</span> <span class="hljs-title">OnCancel</span><span class="hljs-params">()</span>
    </span>{
        <span class="hljs-comment">// é€šçŸ¥çˆ¶è§†å›¾å¯¹è¯æ¡†å·²å…³é—­</span>
        <span class="hljs-keyword">if</span> (m_pParentView != <span class="hljs-literal">NULL</span>)
        {
            m_pParentView-&gt;<span class="hljs-built_in">OnModelessDialogClosed</span>();
        }
        
        <span class="hljs-comment">// é”€æ¯çª—å£</span>
        <span class="hljs-built_in">DestroyWindow</span>();
    }
    
    <span class="hljs-comment">// é‡å†™PostNcDestroyä»¥åˆ é™¤å¯¹è±¡</span>
    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">void</span> <span class="hljs-title">PostNcDestroy</span><span class="hljs-params">()</span>
    </span>{
        CDialogEx::<span class="hljs-built_in">PostNcDestroy</span>();
        <span class="hljs-keyword">delete</span> <span class="hljs-keyword">this</span>;  <span class="hljs-comment">// è‡ªæˆ‘åˆ é™¤</span>
    }
    
    <span class="hljs-built_in">DECLARE_MESSAGE_MAP</span>()
};
</code></pre>
<h3 data-id="heading-50">å…­ã€å±æ€§è¡¨ï¼ˆProperty Sheetï¼‰ä¸å±æ€§é¡µï¼ˆProperty Pageï¼‰</h3>
<p>å¯¹äºå¤æ‚çš„è®¾ç½®å¯¹è¯æ¡†ï¼ŒMFCæä¾›äº†å±æ€§è¡¨æœºåˆ¶ï¼š</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-comment">// å±æ€§é¡µåŸºç±»çš„ä½¿ç”¨</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">CGeneralPage</span> : <span class="hljs-keyword">public</span> CPropertyPage
{
    <span class="hljs-built_in">DECLARE_DYNCREATE</span>(CGeneralPage)
    
<span class="hljs-keyword">public</span>:
    <span class="hljs-built_in">CGeneralPage</span>() : <span class="hljs-built_in">CPropertyPage</span>(IDD_GENERAL_PAGE)
    {
        m_psp.dwFlags |= PSP_USETITLE;
        m_psp.pszTitle = _T(<span class="hljs-string">"å¸¸è§„è®¾ç½®"</span>);
    }
    
    <span class="hljs-comment">// æ•°æ®æˆå‘˜</span>
    CString m_strUserName;
    CString m_strCompany;
    BOOL m_bAutoSave;
    
<span class="hljs-keyword">protected</span>:
    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">void</span> <span class="hljs-title">DoDataExchange</span><span class="hljs-params">(CDataExchange* pDX)</span>
    </span>{
        CPropertyPage::<span class="hljs-built_in">DoDataExchange</span>(pDX);
        <span class="hljs-built_in">DDX_Text</span>(pDX, IDC_EDIT_USERNAME, m_strUserName);
        <span class="hljs-built_in">DDX_Text</span>(pDX, IDC_EDIT_COMPANY, m_strCompany);
        <span class="hljs-built_in">DDX_Check</span>(pDX, IDC_CHECK_AUTOSAVE, m_bAutoSave);
    }
    
    <span class="hljs-comment">// éªŒè¯</span>
    <span class="hljs-function"><span class="hljs-keyword">virtual</span> BOOL <span class="hljs-title">OnApply</span><span class="hljs-params">()</span>
    </span>{
        <span class="hljs-keyword">if</span> (!<span class="hljs-built_in">UpdateData</span>(TRUE))
            <span class="hljs-keyword">return</span> FALSE;
            
        <span class="hljs-comment">// åº”ç”¨è®¾ç½®</span>
        <span class="hljs-built_in">AfxGetApp</span>()-&gt;<span class="hljs-built_in">WriteProfileString</span>(_T(<span class="hljs-string">"Settings"</span>), _T(<span class="hljs-string">"UserName"</span>), m_strUserName);
        
        <span class="hljs-keyword">return</span> CPropertyPage::<span class="hljs-built_in">OnApply</span>();
    }
};

<span class="hljs-comment">// å±æ€§è¡¨çš„åˆ›å»ºä¸ä½¿ç”¨</span>
<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">CMyApp::OnSettings</span><span class="hljs-params">()</span>
</span>{
    <span class="hljs-comment">// åˆ›å»ºå±æ€§è¡¨</span>
    <span class="hljs-function">CPropertySheet <span class="hljs-title">sheet</span><span class="hljs-params">(_T(<span class="hljs-string">"åº”ç”¨ç¨‹åºè®¾ç½®"</span>))</span></span>;
    
    <span class="hljs-comment">// æ·»åŠ å±æ€§é¡µ</span>
    CGeneralPage pageGeneral;
    CAdvancedPage pageAdvanced;
    
    sheet.<span class="hljs-built_in">AddPage</span>(&amp;pageGeneral);
    sheet.<span class="hljs-built_in">AddPage</span>(&amp;pageAdvanced);
    
    <span class="hljs-comment">// è®¾ç½®åˆå§‹å€¼</span>
    pageGeneral.m_strUserName = <span class="hljs-built_in">GetCurrentUserName</span>();
    pageAdvanced.m_nTimeout = <span class="hljs-built_in">GetTimeoutValue</span>();
    
    <span class="hljs-comment">// æ˜¾ç¤ºæ¨¡æ€å±æ€§è¡¨</span>
    <span class="hljs-keyword">if</span> (sheet.<span class="hljs-built_in">DoModal</span>() == IDOK)
    {
        <span class="hljs-comment">// ä¿å­˜æ‰€æœ‰è®¾ç½®</span>
        <span class="hljs-built_in">SaveSettings</span>(pageGeneral, pageAdvanced);
    }
}
</code></pre>
<h3 data-id="heading-51">ä¸ƒã€å¯¹è¯æ¡†æ•°æ®äº¤æ¢çš„é«˜çº§æŠ€å·§</h3>
<h4 data-id="heading-52">7.1 åŠ¨æ€æ§ä»¶çš„æ•°æ®äº¤æ¢</h4>
<p>å¯¹äºåŠ¨æ€åˆ›å»ºçš„æ§ä»¶ï¼Œéœ€è¦ç‰¹æ®Šå¤„ç†DDXï¼š</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-keyword">class</span> <span class="hljs-title class_">CDynamicDialog</span> : <span class="hljs-keyword">public</span> CDialogEx
{
<span class="hljs-keyword">private</span>:
    <span class="hljs-comment">// åŠ¨æ€æ§ä»¶IDèµ·å§‹å€¼ï¼ˆå¿…é¡»å¤§äºç³»ç»ŸIDï¼‰</span>
    <span class="hljs-keyword">enum</span> { IDC_DYNAMIC_START = <span class="hljs-number">0x8000</span> };
    
    <span class="hljs-comment">// åŠ¨æ€æ§ä»¶æ•°ç»„</span>
    CEdit* m_pDynamicEdits[<span class="hljs-number">10</span>];
    CStatic* m_pDynamicLabels[<span class="hljs-number">10</span>];
    <span class="hljs-type">int</span> m_nDynamicValues[<span class="hljs-number">10</span>];
    <span class="hljs-type">int</span> m_nControlCount;
    
<span class="hljs-keyword">public</span>:
    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">void</span> <span class="hljs-title">DoDataExchange</span><span class="hljs-params">(CDataExchange* pDX)</span>
    </span>{
        CDialogEx::<span class="hljs-built_in">DoDataExchange</span>(pDX);
        
        <span class="hljs-comment">// åŠ¨æ€æ§ä»¶çš„DDX</span>
        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; m_nControlCount; i++)
        {
            <span class="hljs-keyword">if</span> (m_pDynamicEdits[i] != <span class="hljs-literal">NULL</span> &amp;&amp; m_pDynamicEdits[i]-&gt;<span class="hljs-built_in">GetSafeHwnd</span>() != <span class="hljs-literal">NULL</span>)
            {
                <span class="hljs-built_in">DDX_Text</span>(pDX, IDC_DYNAMIC_START + i, m_nDynamicValues[i]);
            }
        }
    }
    
    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">CreateDynamicControls</span><span class="hljs-params">(<span class="hljs-type">int</span> nCount)</span>
    </span>{
        m_nControlCount = nCount;
        
        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; nCount; i++)
        {
            <span class="hljs-comment">// åˆ›å»ºæ ‡ç­¾</span>
            m_pDynamicLabels[i] = <span class="hljs-keyword">new</span> CStatic;
            m_pDynamicLabels[i]-&gt;<span class="hljs-built_in">Create</span>(_T(<span class="hljs-string">"åŠ¨æ€æ§ä»¶ "</span>) + <span class="hljs-built_in">CString</span>(<span class="hljs-built_in">char</span>(<span class="hljs-string">'A'</span> + i)),
                                       WS_CHILD | WS_VISIBLE,
                                       <span class="hljs-built_in">CRect</span>(<span class="hljs-number">10</span>, <span class="hljs-number">30</span> + i * <span class="hljs-number">30</span>, <span class="hljs-number">100</span>, <span class="hljs-number">50</span> + i * <span class="hljs-number">30</span>),
                                       <span class="hljs-keyword">this</span>);
            
            <span class="hljs-comment">// åˆ›å»ºç¼–è¾‘æ¡†</span>
            m_pDynamicEdits[i] = <span class="hljs-keyword">new</span> CEdit;
            m_pDynamicEdits[i]-&gt;<span class="hljs-built_in">Create</span>(WS_CHILD | WS_VISIBLE | WS_BORDER | ES_AUTOHSCROLL,
                                      <span class="hljs-built_in">CRect</span>(<span class="hljs-number">110</span>, <span class="hljs-number">30</span> + i * <span class="hljs-number">30</span>, <span class="hljs-number">210</span>, <span class="hljs-number">50</span> + i * <span class="hljs-number">30</span>),
                                      <span class="hljs-keyword">this</span>, IDC_DYNAMIC_START + i);
        }
    }
};
</code></pre>
<h4 data-id="heading-53">7.2 æ•°æ®äº¤æ¢çš„æ€§èƒ½ä¼˜åŒ–</h4>
<p>å¯¹äºåŒ…å«å¤§é‡æ§ä»¶çš„å¯¹è¯æ¡†ï¼Œå¯ä»¥ä¼˜åŒ–DDXæ€§èƒ½ï¼š</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">COptimizedDialog::DoDataExchange</span><span class="hljs-params">(CDataExchange* pDX)</span>
</span>{
    CDialogEx::<span class="hljs-built_in">DoDataExchange</span>(pDX);
    
    <span class="hljs-comment">// ä½¿ç”¨æ¡ä»¶ç¼–è¯‘æˆ–æ ‡å¿—æ§åˆ¶DDXèŒƒå›´</span>
    <span class="hljs-meta">#<span class="hljs-keyword">ifdef</span> FULL_DATA_EXCHANGE</span>
    <span class="hljs-comment">// å®Œæ•´çš„æ•°æ®äº¤æ¢</span>
    <span class="hljs-built_in">ExchangeAllData</span>(pDX);
    <span class="hljs-meta">#<span class="hljs-keyword">else</span></span>
    <span class="hljs-comment">// éƒ¨åˆ†æ•°æ®äº¤æ¢ï¼ˆæ ¹æ®éœ€æ±‚ï¼‰</span>
    <span class="hljs-keyword">if</span> (pDX-&gt;m_bSaveAndValidate)
    {
        <span class="hljs-comment">// åªéªŒè¯å¿…è¦å­—æ®µ</span>
        <span class="hljs-built_in">ExchangeRequiredData</span>(pDX);
    }
    <span class="hljs-keyword">else</span>
    {
        <span class="hljs-comment">// åªæ›´æ–°å¯è§å­—æ®µ</span>
        <span class="hljs-built_in">ExchangeVisibleData</span>(pDX);
    }
    <span class="hljs-meta">#<span class="hljs-keyword">endif</span></span>
}

<span class="hljs-comment">// åˆ†ç»„æ•°æ®äº¤æ¢ç¤ºä¾‹</span>
<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">COptimizedDialog::ExchangePersonalData</span><span class="hljs-params">(CDataExchange* pDX)</span>
</span>{
    <span class="hljs-built_in">DDX_Text</span>(pDX, IDC_EDIT_NAME, m_strName);
    <span class="hljs-built_in">DDX_Text</span>(pDX, IDC_EDIT_AGE, m_nAge);
    <span class="hljs-built_in">DDX_Text</span>(pDX, IDC_EDIT_PHONE, m_strPhone);
}

<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">COptimizedDialog::ExchangeWorkData</span><span class="hljs-params">(CDataExchange* pDX)</span>
</span>{
    <span class="hljs-built_in">DDX_Text</span>(pDX, IDC_EDIT_COMPANY, m_strCompany);
    <span class="hljs-built_in">DDX_Text</span>(pDX, IDC_EDIT_POSITION, m_strPosition);
}
</code></pre>
<h3 data-id="heading-54">å…«ã€å¯¹è¯æ¡†ä¸æ–‡æ¡£/è§†å›¾æ¶æ„çš„é›†æˆ</h3>
<p>å¯¹è¯æ¡†å¯ä»¥ä½œä¸ºæ–‡æ¡£/è§†å›¾æ¶æ„çš„è¡¥å……ï¼š</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-comment">// åœ¨æ–‡æ¡£/è§†å›¾åº”ç”¨ä¸­ä½¿ç”¨å¯¹è¯æ¡†</span>
<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">CMyView::OnEditPreferences</span><span class="hljs-params">()</span>
</span>{
    CPreferencesDialog dlg;
    
    <span class="hljs-comment">// ä»æ–‡æ¡£è·å–å½“å‰è®¾ç½®</span>
    CMyDocument* pDoc = <span class="hljs-built_in">GetDocument</span>();
    dlg.m_strDefaultPath = pDoc-&gt;<span class="hljs-built_in">GetDefaultPath</span>();
    dlg.m_nAutoSaveInterval = pDoc-&gt;<span class="hljs-built_in">GetAutoSaveInterval</span>();
    
    <span class="hljs-keyword">if</span> (dlg.<span class="hljs-built_in">DoModal</span>() == IDOK)
    {
        <span class="hljs-comment">// æ›´æ–°æ–‡æ¡£è®¾ç½®</span>
        pDoc-&gt;<span class="hljs-built_in">SetDefaultPath</span>(dlg.m_strDefaultPath);
        pDoc-&gt;<span class="hljs-built_in">SetAutoSaveInterval</span>(dlg.m_nAutoSaveInterval);
        
        <span class="hljs-comment">// æ ‡è®°æ–‡æ¡£ä¸ºå·²ä¿®æ”¹</span>
        pDoc-&gt;<span class="hljs-built_in">SetModifiedFlag</span>(TRUE);
        
        <span class="hljs-comment">// æ›´æ–°æ‰€æœ‰è§†å›¾</span>
        pDoc-&gt;<span class="hljs-built_in">UpdateAllViews</span>(<span class="hljs-keyword">this</span>);
    }
}

<span class="hljs-comment">// å¯¹è¯æ¡†æ•°æ®å˜åŒ–å®æ—¶æ›´æ–°è§†å›¾</span>
<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">CRealTimeDialog::OnChangeEditValue</span><span class="hljs-params">()</span>
</span>{
    <span class="hljs-comment">// è·å–å½“å‰å€¼</span>
    <span class="hljs-built_in">UpdateData</span>(TRUE);
    
    <span class="hljs-comment">// å®æ—¶æ›´æ–°é¢„è§ˆ</span>
    CPreviewDialog* pPreview = <span class="hljs-built_in">GetPreviewWindow</span>();
    <span class="hljs-keyword">if</span> (pPreview != <span class="hljs-literal">NULL</span>)
    {
        pPreview-&gt;<span class="hljs-built_in">UpdatePreview</span>(m_nValue, m_strText);
    }
}
</code></pre>
<h3 data-id="heading-55">ä¹ã€å¸¸è§é—®é¢˜ä¸è°ƒè¯•æŠ€å·§</h3>
<h4 data-id="heading-56">9.1 DDX/DDVå¸¸è§é—®é¢˜æ’æŸ¥</h4>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-comment">// è°ƒè¯•DDXé—®é¢˜çš„æŠ€å·§</span>
<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">CMyDialog::DoDataExchange</span><span class="hljs-params">(CDataExchange* pDX)</span>
</span>{
    <span class="hljs-built_in">TRACE</span>(_T(<span class="hljs-string">"DoDataExchange called, m_bSaveAndValidate = %d\n"</span>), 
          pDX-&gt;m_bSaveAndValidate);
    
    CDialogEx::<span class="hljs-built_in">DoDataExchange</span>(pDX);
    
    <span class="hljs-meta">#<span class="hljs-keyword">ifdef</span> _DEBUG</span>
    <span class="hljs-comment">// è°ƒè¯•æ¨¡å¼ä¸‹æ·»åŠ é¢å¤–æ£€æŸ¥</span>
    <span class="hljs-keyword">if</span> (pDX-&gt;m_bSaveAndValidate)
    {
        <span class="hljs-comment">// æ£€æŸ¥æ§ä»¶æ˜¯å¦å­˜åœ¨</span>
        <span class="hljs-keyword">if</span> (<span class="hljs-built_in">GetDlgItem</span>(IDC_EDIT_NAME) == <span class="hljs-literal">NULL</span>)
        {
            <span class="hljs-built_in">TRACE0</span>(<span class="hljs-string">"é”™è¯¯: IDC_EDIT_NAME æ§ä»¶ä¸å­˜åœ¨!\n"</span>);
            <span class="hljs-built_in">ASSERT</span>(FALSE);
        }
    }
    <span class="hljs-meta">#<span class="hljs-keyword">endif</span></span>
    
    <span class="hljs-built_in">DDX_Text</span>(pDX, IDC_EDIT_NAME, m_strName);
    
    <span class="hljs-built_in">TRACE</span>(_T(<span class="hljs-string">"m_strName = %s\n"</span>), (LPCTSTR)m_strName);
}
</code></pre>
<h4 data-id="heading-57">9.2 å†…å­˜æ³„æ¼æ£€æµ‹</h4>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-comment">// æ£€æµ‹å¯¹è¯æ¡†ç›¸å…³çš„å†…å­˜æ³„æ¼</span>
<span class="hljs-meta">#<span class="hljs-keyword">ifdef</span> _DEBUG</span>
<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">CMyDialog::OnDestroy</span><span class="hljs-params">()</span>
</span>{
    CDialogEx::<span class="hljs-built_in">OnDestroy</span>();
    
    <span class="hljs-comment">// æ£€æŸ¥åŠ¨æ€åˆ›å»ºçš„æ§ä»¶æ˜¯å¦è¢«æ­£ç¡®åˆ é™¤</span>
    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; m_nControlCount; i++)
    {
        <span class="hljs-comment">// è¿™äº›æŒ‡é’ˆåº”è¯¥åœ¨PostNcDestroyä¸­åˆ é™¤</span>
        <span class="hljs-built_in">ASSERT</span>(m_pDynamicEdits[i] == <span class="hljs-literal">NULL</span>);
    }
}

<span class="hljs-comment">// é‡å†™PostNcDestroyç¡®ä¿èµ„æºæ¸…ç†</span>
<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">CMyModelessDialog::PostNcDestroy</span><span class="hljs-params">()</span>
</span>{
    <span class="hljs-comment">// æ¸…ç†åŠ¨æ€æ§ä»¶</span>
    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; m_nControlCount; i++)
    {
        <span class="hljs-keyword">if</span> (m_pDynamicEdits[i] != <span class="hljs-literal">NULL</span>)
        {
            <span class="hljs-keyword">delete</span> m_pDynamicEdits[i];
            m_pDynamicEdits[i] = <span class="hljs-literal">NULL</span>;
        }
    }
    
    CDialogEx::<span class="hljs-built_in">PostNcDestroy</span>();
    <span class="hljs-keyword">delete</span> <span class="hljs-keyword">this</span>;
}
<span class="hljs-meta">#<span class="hljs-keyword">endif</span></span>
</code></pre>
<h3 data-id="heading-58">åã€ç°ä»£æ›¿ä»£æ–¹æ¡ˆä¸æ¶æ„å¯ç¤º</h3>
<p>è™½ç„¶MFCå¯¹è¯æ¡†æœºåˆ¶æœ‰å…¶å†å²å±€é™æ€§ï¼Œä½†å…¶è®¾è®¡æ€æƒ³å¯¹ç°ä»£UIæ¡†æ¶ä»æœ‰å½±å“ï¼š</p>
<ol>
<li><strong>æ•°æ®ç»‘å®šæ¨¡å¼</strong>ï¼šWPF/XAMLçš„æ•°æ®ç»‘å®šæ˜¯DDXçš„è¿›åŒ–ç‰ˆæœ¬</li>
<li><strong>MVVMæ¨¡å¼</strong>ï¼šViewModelä½œä¸ºæ•°æ®ä¸­ä»‹ï¼Œç±»ä¼¼äºMFCå¯¹è¯æ¡†çš„æ•°æ®å±‚</li>
<li><strong>å“åº”å¼è¡¨å•</strong>ï¼šAngular/Reactä¸­çš„è¡¨å•éªŒè¯æœºåˆ¶å€Ÿé‰´äº†DDVçš„æ€æƒ³</li>
</ol>
<p><strong>DDX/DDVæœºåˆ¶çš„ç°ä»£å¯ç¤º</strong>ï¼š</p>
<ul>
<li>å£°æ˜å¼æ•°æ®ç»‘å®šä¼˜äºå‘½ä»¤å¼æ•°æ®æ“ä½œ</li>
<li>æ•°æ®éªŒè¯åº”è¯¥ä¸UIé€»è¾‘åˆ†ç¦»</li>
<li>ç±»å‹å®‰å…¨æ˜¯æ¡†æ¶è®¾è®¡çš„é‡è¦ç›®æ ‡</li>
<li>å¼€å‘è€…ä½“éªŒï¼ˆDXï¼‰ç›´æ¥å½±å“æ¡†æ¶çš„é‡‡ç”¨ç‡</li>
</ul>
<p>MFCçš„å¯¹è¯æ¡†å’ŒDDX/DDVæœºåˆ¶å±•ç¤ºäº†å¦‚ä½•åœ¨C++ç¯å¢ƒä¸­å®ç°ç±»å‹å®‰å…¨çš„UIæ•°æ®ç»‘å®šã€‚è™½ç„¶å…·ä½“å®ç°å·²æ˜¾é™ˆæ—§ï¼Œä½†å…¶æ ¸å¿ƒæ€æƒ³â€”â€”é€šè¿‡å…ƒç¼–ç¨‹ç®€åŒ–å¼€å‘è€…å·¥ä½œã€ç¡®ä¿æ•°æ®å®Œæ•´æ€§ã€æä¾›ä¸€è‡´çš„ç¼–ç¨‹æ¨¡å‹â€”â€”ä»ç„¶æ˜¯ä¼˜ç§€æ¡†æ¶è®¾è®¡çš„é‡è¦åŸåˆ™ã€‚</p>
<h2 data-id="heading-59">ç¬¬å››ç« ï¼šMFCå›¾å½¢è®¾å¤‡æ¥å£(GDI)ç¼–ç¨‹â€”â€”Windowså›¾å½¢æ¸²æŸ“çš„æ ¸å¿ƒå¼•æ“</h2>
<h3 data-id="heading-60">ä¸€ã€GDIç³»ç»Ÿæ¶æ„ï¼šä»ç¡¬ä»¶æŠ½è±¡åˆ°åº”ç”¨ç¨‹åº</h3>
<p>Windows GDIï¼ˆGraphics Device Interfaceï¼‰æ˜¯Windowsæ“ä½œç³»ç»Ÿçš„å›¾å½¢æ ¸å¿ƒå­ç³»ç»Ÿï¼ŒMFCé€šè¿‡CDCç±»åŠå…¶æ´¾ç”Ÿç±»å¯¹å…¶è¿›è¡Œé¢å‘å¯¹è±¡å°è£…ã€‚ç†è§£GDIçš„å±‚æ¬¡ç»“æ„æ˜¯æŒæ¡MFCç»˜å›¾çš„åŸºç¡€ï¼š</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c729af5b21c74643a2c392c3667275b5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56CB5LqL5ryr6LCI:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765794519&amp;x-signature=65LtXjXR43RYb9XFc%2BGT1dQD%2BXM%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-61">äºŒã€è®¾å¤‡ä¸Šä¸‹æ–‡(CDC)çš„æ·±å…¥è§£æ</h3>
<h4 data-id="heading-62">2.1 CDCç±»çš„åŸºæœ¬åŸç†</h4>
<p>è®¾å¤‡ä¸Šä¸‹æ–‡æ˜¯GDIçš„æ ¸å¿ƒæ¦‚å¿µï¼Œå®ƒä»£è¡¨äº†ç»˜å›¾è¡¨é¢çš„æŠ½è±¡ï¼ŒåŒ…å«ç»˜å›¾æ‰€éœ€çš„æ‰€æœ‰çŠ¶æ€ä¿¡æ¯ï¼š</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-comment">// CDCç±»çš„å…³é”®å†…éƒ¨ç»“æ„ï¼ˆæ¦‚å¿µæ€§ï¼‰</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">CDC</span> : <span class="hljs-keyword">public</span> CObject
{
<span class="hljs-keyword">protected</span>:
    HDC m_hDC;                 <span class="hljs-comment">// Windowsè®¾å¤‡ä¸Šä¸‹æ–‡å¥æŸ„</span>
    HDC m_hAttribDC;           <span class="hljs-comment">// å±æ€§DCï¼ˆç”¨äºæ‰“å°ç­‰ï¼‰</span>
    BOOL m_bPrinting;          <span class="hljs-comment">// æ˜¯å¦ä¸ºæ‰“å°DC</span>
    
<span class="hljs-keyword">public</span>:
    <span class="hljs-comment">// æ„é€ å‡½æ•°ä¸ææ„å‡½æ•°</span>
    <span class="hljs-built_in">CDC</span>();
    <span class="hljs-keyword">virtual</span> ~<span class="hljs-built_in">CDC</span>();
    
    <span class="hljs-comment">// è®¾å¤‡ä¸Šä¸‹æ–‡æ“ä½œ</span>
    <span class="hljs-function">BOOL <span class="hljs-title">Attach</span><span class="hljs-params">(HDC hDC)</span></span>;      <span class="hljs-comment">// å…³è”ç°æœ‰HDC</span>
    <span class="hljs-function">HDC <span class="hljs-title">Detach</span><span class="hljs-params">()</span></span>;              <span class="hljs-comment">// åˆ†ç¦»HDC</span>
    <span class="hljs-function">HDC <span class="hljs-title">GetSafeHdc</span><span class="hljs-params">()</span> <span class="hljs-type">const</span></span>;    <span class="hljs-comment">// å®‰å…¨è·å–HDC</span>
    
    <span class="hljs-comment">// ç»˜å›¾çŠ¶æ€ç®¡ç†</span>
    <span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">SaveDC</span><span class="hljs-params">()</span></span>;              <span class="hljs-comment">// ä¿å­˜DCçŠ¶æ€</span>
    <span class="hljs-function">BOOL <span class="hljs-title">RestoreDC</span><span class="hljs-params">(<span class="hljs-type">int</span> nSavedDC)</span></span>; <span class="hljs-comment">// æ¢å¤DCçŠ¶æ€</span>
    
    <span class="hljs-comment">// åæ ‡ä¸æ˜ å°„æ¨¡å¼</span>
    <span class="hljs-function"><span class="hljs-keyword">virtual</span> CPoint <span class="hljs-title">GetViewportOrg</span><span class="hljs-params">()</span> <span class="hljs-type">const</span></span>;
    <span class="hljs-function"><span class="hljs-keyword">virtual</span> CSize <span class="hljs-title">GetViewportExt</span><span class="hljs-params">()</span> <span class="hljs-type">const</span></span>;
    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">int</span> <span class="hljs-title">SetMapMode</span><span class="hljs-params">(<span class="hljs-type">int</span> nMapMode)</span></span>;
    
    <span class="hljs-comment">// ç»˜å›¾æ“ä½œ</span>
    <span class="hljs-function"><span class="hljs-keyword">virtual</span> BOOL <span class="hljs-title">LineTo</span><span class="hljs-params">(<span class="hljs-type">int</span> x, <span class="hljs-type">int</span> y)</span></span>;
    <span class="hljs-function"><span class="hljs-keyword">virtual</span> BOOL <span class="hljs-title">Rectangle</span><span class="hljs-params">(<span class="hljs-type">int</span> x1, <span class="hljs-type">int</span> y1, <span class="hljs-type">int</span> x2, <span class="hljs-type">int</span> y2)</span></span>;
    <span class="hljs-function"><span class="hljs-keyword">virtual</span> BOOL <span class="hljs-title">Ellipse</span><span class="hljs-params">(<span class="hljs-type">int</span> x1, <span class="hljs-type">int</span> y1, <span class="hljs-type">int</span> x2, <span class="hljs-type">int</span> y2)</span></span>;
    <span class="hljs-function"><span class="hljs-keyword">virtual</span> BOOL <span class="hljs-title">TextOut</span><span class="hljs-params">(<span class="hljs-type">int</span> x, <span class="hljs-type">int</span> y, LPCTSTR lpszString, <span class="hljs-type">int</span> nCount)</span></span>;
    
    <span class="hljs-comment">// GDIå¯¹è±¡ç®¡ç†</span>
    <span class="hljs-function"><span class="hljs-keyword">virtual</span> CGdiObject* <span class="hljs-title">SelectStockObject</span><span class="hljs-params">(<span class="hljs-type">int</span> nIndex)</span></span>;
    <span class="hljs-function"><span class="hljs-keyword">virtual</span> CGdiObject* <span class="hljs-title">SelectObject</span><span class="hljs-params">(CGdiObject* pObject)</span></span>;
    
    <span class="hljs-comment">// è®¾å¤‡èƒ½åŠ›æŸ¥è¯¢</span>
    <span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">GetDeviceCaps</span><span class="hljs-params">(<span class="hljs-type">int</span> nIndex)</span> <span class="hljs-type">const</span></span>;
    
    <span class="hljs-built_in">DECLARE_DYNAMIC</span>(CDC)
};
</code></pre>
<h4 data-id="heading-63">2.2 ä¸åŒCDCæ´¾ç”Ÿç±»çš„ä½¿ç”¨åœºæ™¯</h4>
<p>MFCæä¾›äº†å¤šç§CDCæ´¾ç”Ÿç±»ä»¥é€‚åº”ä¸åŒç»˜å›¾éœ€æ±‚ï¼š</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-comment">// 1. CPaintDC - ç”¨äºWM_PAINTæ¶ˆæ¯å¤„ç†</span>
<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">CMyView::OnPaint</span><span class="hljs-params">()</span>
</span>{
    <span class="hljs-function">CPaintDC <span class="hljs-title">dc</span><span class="hljs-params">(<span class="hljs-keyword">this</span>)</span></span>; <span class="hljs-comment">// è‡ªåŠ¨è°ƒç”¨BeginPaint</span>
    
    <span class="hljs-comment">// è·å–æ— æ•ˆåŒºåŸŸ</span>
    CRect rectUpdate;
    dc.<span class="hljs-built_in">GetClipBox</span>(&amp;rectUpdate);
    
    <span class="hljs-comment">// æ‰§è¡Œç»˜å›¾æ“ä½œ</span>
    <span class="hljs-built_in">OnDraw</span>(&amp;dc); <span class="hljs-comment">// é€šå¸¸è°ƒç”¨OnDrawè¿›è¡Œå®é™…ç»˜åˆ¶</span>
    
    <span class="hljs-comment">// ææ„æ—¶è‡ªåŠ¨è°ƒç”¨EndPaint</span>
}

<span class="hljs-comment">// 2. CClientDC - ç”¨äºå®¢æˆ·åŒºå³æ—¶ç»˜å›¾</span>
<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">CMyView::OnMouseMove</span><span class="hljs-params">(UINT nFlags, CPoint point)</span>
</span>{
    <span class="hljs-keyword">if</span> (m_bDrawing)
    {
        <span class="hljs-function">CClientDC <span class="hljs-title">dc</span><span class="hljs-params">(<span class="hljs-keyword">this</span>)</span></span>; <span class="hljs-comment">// è·å–å®¢æˆ·åŒºDC</span>
        
        <span class="hljs-comment">// å®æ—¶ç»˜åˆ¶åé¦ˆ</span>
        dc.<span class="hljs-built_in">MoveTo</span>(m_ptLastPos);
        dc.<span class="hljs-built_in">LineTo</span>(point);
        
        m_ptLastPos = point;
    }
    
    CView::<span class="hljs-built_in">OnMouseMove</span>(nFlags, point);
}

<span class="hljs-comment">// 3. CWindowDC - ç»˜åˆ¶æ•´ä¸ªçª—å£ï¼ˆåŒ…æ‹¬éå®¢æˆ·åŒºï¼‰</span>
<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">CMyFrameWnd::OnDrawBorder</span><span class="hljs-params">()</span>
</span>{
    <span class="hljs-function">CWindowDC <span class="hljs-title">dc</span><span class="hljs-params">(<span class="hljs-keyword">this</span>)</span></span>; <span class="hljs-comment">// è·å–æ•´ä¸ªçª—å£DC</span>
    
    <span class="hljs-comment">// ç»˜åˆ¶è‡ªå®šä¹‰çª—å£è¾¹æ¡†</span>
    CRect rectWindow;
    <span class="hljs-built_in">GetWindowRect</span>(&amp;rectWindow);
    
    <span class="hljs-comment">// è½¬æ¢ä¸ºå®¢æˆ·åŒºåæ ‡</span>
    <span class="hljs-built_in">ScreenToClient</span>(&amp;rectWindow);
    
    <span class="hljs-comment">// ç»˜åˆ¶è¾¹æ¡†</span>
    <span class="hljs-function">CPen <span class="hljs-title">pen</span><span class="hljs-params">(PS_SOLID, <span class="hljs-number">3</span>, RGB(<span class="hljs-number">255</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>))</span></span>;
    dc.<span class="hljs-built_in">SelectObject</span>(&amp;pen);
    dc.<span class="hljs-built_in">SelectStockObject</span>(NULL_BRUSH);
    dc.<span class="hljs-built_in">Rectangle</span>(rectWindow);
}

<span class="hljs-comment">// 4. CMetaFileDC - åˆ›å»ºWindowså›¾å…ƒæ–‡ä»¶</span>
<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">CMyView::CreateMetaFile</span><span class="hljs-params">()</span>
</span>{
    CMetaFileDC dcMeta;
    
    <span class="hljs-comment">// åˆ›å»ºå›¾å…ƒæ–‡ä»¶DC</span>
    <span class="hljs-keyword">if</span> (dcMeta.<span class="hljs-built_in">Create</span>())
    {
        <span class="hljs-comment">// åœ¨å›¾å…ƒæ–‡ä»¶ä¸­è®°å½•ç»˜å›¾å‘½ä»¤</span>
        dcMeta.<span class="hljs-built_in">SetMapMode</span>(MM_ANISOTROPIC);
        dcMeta.<span class="hljs-built_in">SetWindowExt</span>(<span class="hljs-number">1000</span>, <span class="hljs-number">1000</span>);
        dcMeta.<span class="hljs-built_in">SetViewportExt</span>(<span class="hljs-number">100</span>, <span class="hljs-number">100</span>);
        
        <span class="hljs-comment">// è®°å½•ç»˜å›¾æ“ä½œ</span>
        dcMeta.<span class="hljs-built_in">Rectangle</span>(<span class="hljs-number">10</span>, <span class="hljs-number">10</span>, <span class="hljs-number">500</span>, <span class="hljs-number">500</span>);
        dcMeta.<span class="hljs-built_in">Ellipse</span>(<span class="hljs-number">100</span>, <span class="hljs-number">100</span>, <span class="hljs-number">400</span>, <span class="hljs-number">400</span>);
        
        <span class="hljs-comment">// å…³é—­å›¾å…ƒæ–‡ä»¶</span>
        HMETAFILE hMetaFile = dcMeta.<span class="hljs-built_in">Close</span>();
        
        <span class="hljs-keyword">if</span> (hMetaFile != <span class="hljs-literal">NULL</span>)
        {
            <span class="hljs-comment">// å¯ä»¥ä¿å­˜æˆ–å›æ”¾å›¾å…ƒæ–‡ä»¶</span>
            <span class="hljs-function">CClientDC <span class="hljs-title">dc</span><span class="hljs-params">(<span class="hljs-keyword">this</span>)</span></span>;
            dc.<span class="hljs-built_in">PlayMetaFile</span>(hMetaFile);
            
            <span class="hljs-comment">// åˆ é™¤å›¾å…ƒæ–‡ä»¶å¥æŸ„</span>
            ::<span class="hljs-built_in">DeleteMetaFile</span>(hMetaFile);
        }
    }
}
</code></pre>
<h3 data-id="heading-64">ä¸‰ã€GDIå¯¹è±¡ç®¡ç†ä¸èµ„æºç”Ÿå‘½å‘¨æœŸ</h3>
<h4 data-id="heading-65">3.1 GDIå¯¹è±¡çš„åŸºæœ¬ä½¿ç”¨æ¨¡å¼</h4>
<p>æ­£ç¡®çš„GDIå¯¹è±¡ç®¡ç†æ˜¯é˜²æ­¢èµ„æºæ³„æ¼çš„å…³é”®ï¼š</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">CMyView::OnDraw</span><span class="hljs-params">(CDC* pDC)</span>
</span>{
    <span class="hljs-comment">// 1. åˆ›å»ºGDIå¯¹è±¡</span>
    <span class="hljs-function">CPen <span class="hljs-title">newPen</span><span class="hljs-params">(PS_SOLID, <span class="hljs-number">2</span>, RGB(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">255</span>))</span></span>;
    <span class="hljs-function">CBrush <span class="hljs-title">newBrush</span><span class="hljs-params">(RGB(<span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">0</span>))</span></span>;
    CFont newFont;
    
    <span class="hljs-comment">// åˆ›å»ºå­—ä½“</span>
    LOGFONT lf = {<span class="hljs-number">0</span>};
    lf.lfHeight = <span class="hljs-number">-16</span>;
    lf.lfWeight = FW_BOLD;
    <span class="hljs-built_in">lstrcpy</span>(lf.lfFaceName, _T(<span class="hljs-string">"Arial"</span>));
    newFont.<span class="hljs-built_in">CreateFontIndirect</span>(&amp;lf);
    
    <span class="hljs-comment">// 2. ä¿å­˜æ—§å¯¹è±¡å¹¶é€‰å…¥æ–°å¯¹è±¡</span>
    CPen* pOldPen = pDC-&gt;<span class="hljs-built_in">SelectObject</span>(&amp;newPen);
    CBrush* pOldBrush = pDC-&gt;<span class="hljs-built_in">SelectObject</span>(&amp;newBrush);
    CFont* pOldFont = pDC-&gt;<span class="hljs-built_in">SelectObject</span>(&amp;newFont);
    
    <span class="hljs-comment">// 3. æ‰§è¡Œç»˜å›¾æ“ä½œ</span>
    pDC-&gt;<span class="hljs-built_in">Rectangle</span>(<span class="hljs-number">10</span>, <span class="hljs-number">10</span>, <span class="hljs-number">200</span>, <span class="hljs-number">150</span>);
    pDC-&gt;<span class="hljs-built_in">Ellipse</span>(<span class="hljs-number">50</span>, <span class="hljs-number">50</span>, <span class="hljs-number">150</span>, <span class="hljs-number">100</span>);
    pDC-&gt;<span class="hljs-built_in">TextOut</span>(<span class="hljs-number">20</span>, <span class="hljs-number">20</span>, _T(<span class="hljs-string">"GDIç»˜å›¾ç¤ºä¾‹"</span>));
    
    <span class="hljs-comment">// 4. æ¢å¤æ—§å¯¹è±¡ï¼ˆæŒ‰ç›¸åé¡ºåºï¼‰</span>
    pDC-&gt;<span class="hljs-built_in">SelectObject</span>(pOldFont);
    pDC-&gt;<span class="hljs-built_in">SelectObject</span>(pOldBrush);
    pDC-&gt;<span class="hljs-built_in">SelectObject</span>(pOldPen);
    
    <span class="hljs-comment">// 5. GDIå¯¹è±¡åœ¨ä½œç”¨åŸŸç»“æŸæ—¶è‡ªåŠ¨åˆ é™¤</span>
    <span class="hljs-comment">//    æ³¨æ„ï¼šå¦‚æœè°ƒç”¨DeleteObjectï¼Œéœ€ç¡®ä¿ä¸å†ä½¿ç”¨è¯¥å¯¹è±¡</span>
}
</code></pre>
<h4 data-id="heading-66">3.2 GDIå¯¹è±¡çš„åˆ›å»ºå·¥å‚æ¨¡å¼</h4>
<p>å¯¹äºéœ€è¦é¢‘ç¹åˆ›å»ºç›¸åŒæ ·å¼GDIå¯¹è±¡çš„æƒ…å†µï¼Œå¯ä»¥ä½¿ç”¨å·¥å‚æ¨¡å¼ï¼š</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-keyword">class</span> <span class="hljs-title class_">CGdiObjectFactory</span>
{
<span class="hljs-keyword">private</span>:
    <span class="hljs-type">static</span> CMap&lt;DWORD, DWORD, CPen*, CPen*&gt; m_mapPens;
    <span class="hljs-type">static</span> CMap&lt;DWORD, DWORD, CBrush*, CBrush*&gt; m_mapBrushes;
    <span class="hljs-type">static</span> CCriticalSection m_cs; <span class="hljs-comment">// çº¿ç¨‹ä¿æŠ¤</span>
    
<span class="hljs-keyword">public</span>:
    <span class="hljs-comment">// è·å–æˆ–åˆ›å»ºæŒ‡å®šæ ·å¼çš„ç”»ç¬”</span>
    <span class="hljs-function"><span class="hljs-type">static</span> CPen* <span class="hljs-title">GetPen</span><span class="hljs-params">(<span class="hljs-type">int</span> nStyle, <span class="hljs-type">int</span> nWidth, COLORREF crColor)</span>
    </span>{
        <span class="hljs-function">CSingleLock <span class="hljs-title">lock</span><span class="hljs-params">(&amp;m_cs, TRUE)</span></span>;
        
        <span class="hljs-comment">// åˆ›å»ºå”¯ä¸€é”®</span>
        DWORD dwKey = (nStyle &lt;&lt; <span class="hljs-number">24</span>) | (nWidth &lt;&lt; <span class="hljs-number">16</span>) | crColor;
        
        CPen* pPen = <span class="hljs-literal">NULL</span>;
        <span class="hljs-keyword">if</span> (!m_mapPens.<span class="hljs-built_in">Lookup</span>(dwKey, pPen))
        {
            <span class="hljs-comment">// åˆ›å»ºæ–°ç”»ç¬”</span>
            pPen = <span class="hljs-keyword">new</span> <span class="hljs-built_in">CPen</span>(nStyle, nWidth, crColor);
            m_mapPens.<span class="hljs-built_in">SetAt</span>(dwKey, pPen);
        }
        
        <span class="hljs-keyword">return</span> pPen;
    }
    
    <span class="hljs-comment">// æ¸…ç†æ‰€æœ‰GDIå¯¹è±¡</span>
    <span class="hljs-function"><span class="hljs-type">static</span> <span class="hljs-type">void</span> <span class="hljs-title">Cleanup</span><span class="hljs-params">()</span>
    </span>{
        <span class="hljs-function">CSingleLock <span class="hljs-title">lock</span><span class="hljs-params">(&amp;m_cs, TRUE)</span></span>;
        
        <span class="hljs-comment">// åˆ é™¤æ‰€æœ‰ç”»ç¬”</span>
        POSITION pos = m_mapPens.<span class="hljs-built_in">GetStartPosition</span>();
        DWORD dwKey;
        CPen* pPen;
        <span class="hljs-keyword">while</span> (pos != <span class="hljs-literal">NULL</span>)
        {
            m_mapPens.<span class="hljs-built_in">GetNextAssoc</span>(pos, dwKey, pPen);
            <span class="hljs-keyword">delete</span> pPen;
        }
        m_mapPens.<span class="hljs-built_in">RemoveAll</span>();
        
        <span class="hljs-comment">// ç±»ä¼¼åœ°æ¸…ç†ç”»åˆ·ç­‰</span>
    }
};
</code></pre>
<h3 data-id="heading-67">å››ã€é«˜çº§ç»˜å›¾æŠ€æœ¯ä¸ä¼˜åŒ–</h3>
<h4 data-id="heading-68">4.1 åŒç¼“å†²ç»˜å›¾æŠ€æœ¯</h4>
<p>åŒç¼“å†²æ˜¯æ¶ˆé™¤ç»˜å›¾é—ªçƒçš„å…³é”®æŠ€æœ¯ï¼š</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-keyword">class</span> <span class="hljs-title class_">CDoubleBufferDC</span> : <span class="hljs-keyword">public</span> CDC
{
<span class="hljs-keyword">private</span>:
    CDC* m_pDC;            <span class="hljs-comment">// åŸå§‹è®¾å¤‡ä¸Šä¸‹æ–‡</span>
    CBitmap m_bitmap;      <span class="hljs-comment">// å†…å­˜ä½å›¾</span>
    CBitmap* m_pOldBitmap; <span class="hljs-comment">// æ—§ä½å›¾</span>
    CRect m_rect;          <span class="hljs-comment">// ç»˜åˆ¶åŒºåŸŸ</span>
    
<span class="hljs-keyword">public</span>:
    <span class="hljs-built_in">CDoubleBufferDC</span>(CDC* pDC, <span class="hljs-type">const</span> CRect&amp; rect)
        : <span class="hljs-built_in">m_pDC</span>(pDC), <span class="hljs-built_in">m_rect</span>(rect)
    {
        <span class="hljs-comment">// åˆ›å»ºå…¼å®¹çš„å†…å­˜DC</span>
        <span class="hljs-built_in">CreateCompatibleDC</span>(pDC);
        
        <span class="hljs-comment">// åˆ›å»ºå…¼å®¹ä½å›¾</span>
        m_bitmap.<span class="hljs-built_in">CreateCompatibleBitmap</span>(pDC, rect.<span class="hljs-built_in">Width</span>(), rect.<span class="hljs-built_in">Height</span>());
        
        <span class="hljs-comment">// é€‰å…¥ä½å›¾</span>
        m_pOldBitmap = <span class="hljs-built_in">SelectObject</span>(&amp;m_bitmap);
        
        <span class="hljs-comment">// è®¾ç½®åŸç‚¹åç§»</span>
        <span class="hljs-built_in">SetViewportOrg</span>(-rect.left, -rect.top);
    }
    
    <span class="hljs-keyword">virtual</span> ~<span class="hljs-built_in">CDoubleBufferDC</span>()
    {
        <span class="hljs-comment">// å°†å†…å­˜ä½å›¾æ‹·è´åˆ°å±å¹•</span>
        m_pDC-&gt;<span class="hljs-built_in">BitBlt</span>(m_rect.left, m_rect.top, 
                     m_rect.<span class="hljs-built_in">Width</span>(), m_rect.<span class="hljs-built_in">Height</span>(),
                     <span class="hljs-keyword">this</span>, 
                     m_rect.left, m_rect.top, 
                     SRCCOPY);
        
        <span class="hljs-comment">// æ¢å¤åŸå§‹ä½å›¾</span>
        <span class="hljs-built_in">SelectObject</span>(m_pOldBitmap);
        
        <span class="hljs-comment">// ä½å›¾å¯¹è±¡è‡ªåŠ¨åˆ é™¤</span>
    }
};

<span class="hljs-comment">// åœ¨è§†å›¾ç±»ä¸­ä½¿ç”¨åŒç¼“å†²</span>
<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">CMyView::OnDraw</span><span class="hljs-params">(CDC* pDC)</span>
</span>{
    CRect rectClient;
    <span class="hljs-built_in">GetClientRect</span>(&amp;rectClient);
    
    <span class="hljs-comment">// åˆ›å»ºåŒç¼“å†²DC</span>
    <span class="hljs-function">CDoubleBufferDC <span class="hljs-title">dbDC</span><span class="hljs-params">(pDC, rectClient)</span></span>;
    
    <span class="hljs-comment">// ä½¿ç”¨dbDCè¿›è¡Œæ‰€æœ‰ç»˜å›¾æ“ä½œ</span>
    <span class="hljs-built_in">DrawBackground</span>(&amp;dbDC, rectClient);
    <span class="hljs-built_in">DrawContent</span>(&amp;dbDC, rectClient);
    <span class="hljs-built_in">DrawOverlay</span>(&amp;dbDC, rectClient);
    
    <span class="hljs-comment">// dbDCææ„æ—¶è‡ªåŠ¨åˆ·æ–°åˆ°å±å¹•</span>
}
</code></pre>
<h4 data-id="heading-69">4.2 è·¯å¾„ä¸å¤æ‚åŒºåŸŸæ“ä½œ</h4>
<p>è·¯å¾„æä¾›äº†ä¸€ç§è®°å½•å’Œé‡ç”¨å¤æ‚ç»˜å›¾åºåˆ—çš„æ–¹æ³•ï¼š</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">CMyView::DrawComplexShape</span><span class="hljs-params">(CDC* pDC)</span>
</span>{
    <span class="hljs-comment">// å¼€å§‹è·¯å¾„å®šä¹‰</span>
    pDC-&gt;<span class="hljs-built_in">BeginPath</span>();
    
    <span class="hljs-comment">// å®šä¹‰è·¯å¾„å½¢çŠ¶</span>
    pDC-&gt;<span class="hljs-built_in">MoveTo</span>(<span class="hljs-number">100</span>, <span class="hljs-number">100</span>);
    pDC-&gt;<span class="hljs-built_in">LineTo</span>(<span class="hljs-number">200</span>, <span class="hljs-number">100</span>);
    pDC-&gt;<span class="hljs-built_in">LineTo</span>(<span class="hljs-number">200</span>, <span class="hljs-number">200</span>);
    pDC-&gt;<span class="hljs-built_in">LineTo</span>(<span class="hljs-number">100</span>, <span class="hljs-number">200</span>);
    pDC-&gt;<span class="hljs-built_in">LineTo</span>(<span class="hljs-number">100</span>, <span class="hljs-number">100</span>); <span class="hljs-comment">// é—­åˆçŸ©å½¢</span>
    
    <span class="hljs-comment">// æ·»åŠ ç¬¬äºŒä¸ªå½¢çŠ¶</span>
    pDC-&gt;<span class="hljs-built_in">MoveTo</span>(<span class="hljs-number">150</span>, <span class="hljs-number">50</span>);
    pDC-&gt;<span class="hljs-built_in">LineTo</span>(<span class="hljs-number">250</span>, <span class="hljs-number">150</span>);
    pDC-&gt;<span class="hljs-built_in">LineTo</span>(<span class="hljs-number">50</span>, <span class="hljs-number">150</span>);
    pDC-&gt;<span class="hljs-built_in">CloseFigure</span>(); <span class="hljs-comment">// é—­åˆä¸‰è§’å½¢</span>
    
    <span class="hljs-comment">// ç»“æŸè·¯å¾„å®šä¹‰</span>
    pDC-&gt;<span class="hljs-built_in">EndPath</span>();
    
    <span class="hljs-comment">// 1. ç»˜åˆ¶è·¯å¾„è½®å»“</span>
    <span class="hljs-function">CPen <span class="hljs-title">pen</span><span class="hljs-params">(PS_SOLID, <span class="hljs-number">2</span>, RGB(<span class="hljs-number">255</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>))</span></span>;
    CPen* pOldPen = pDC-&gt;<span class="hljs-built_in">SelectObject</span>(&amp;pen);
    pDC-&gt;<span class="hljs-built_in">StrokePath</span>();
    pDC-&gt;<span class="hljs-built_in">SelectObject</span>(pOldPen);
    
    <span class="hljs-comment">// 2. å¡«å……è·¯å¾„</span>
    <span class="hljs-function">CBrush <span class="hljs-title">brush</span><span class="hljs-params">(RGB(<span class="hljs-number">0</span>, <span class="hljs-number">255</span>, <span class="hljs-number">0</span>))</span></span>;
    CBrush* pOldBrush = pDC-&gt;<span class="hljs-built_in">SelectObject</span>(&amp;brush);
    pDC-&gt;<span class="hljs-built_in">FillPath</span>();
    pDC-&gt;<span class="hljs-built_in">SelectObject</span>(pOldBrush);
    
    <span class="hljs-comment">// 3. å°†è·¯å¾„è½¬æ¢ä¸ºåŒºåŸŸ</span>
    CRgn region;
    <span class="hljs-keyword">if</span> (region.<span class="hljs-built_in">CreateFromPath</span>(pDC))
    {
        <span class="hljs-comment">// ä½¿ç”¨åŒºåŸŸè¿›è¡Œç‚¹å‡»æµ‹è¯•</span>
        <span class="hljs-function">CPoint <span class="hljs-title">ptTest</span><span class="hljs-params">(<span class="hljs-number">120</span>, <span class="hljs-number">120</span>)</span></span>;
        <span class="hljs-keyword">if</span> (region.<span class="hljs-built_in">PtInRegion</span>(ptTest))
        {
            pDC-&gt;<span class="hljs-built_in">TextOut</span>(<span class="hljs-number">10</span>, <span class="hljs-number">10</span>, _T(<span class="hljs-string">"ç‚¹åœ¨åŒºåŸŸå†…"</span>));
        }
        
        <span class="hljs-comment">// åŒºåŸŸä¹Ÿå¯ä»¥ç”¨äºè£å‰ª</span>
        pDC-&gt;<span class="hljs-built_in">SelectClipRgn</span>(&amp;region);
        <span class="hljs-comment">// ... åœ¨è£å‰ªåŒºåŸŸå†…ç»˜å›¾</span>
        pDC-&gt;<span class="hljs-built_in">SelectClipRgn</span>(<span class="hljs-literal">NULL</span>); <span class="hljs-comment">// å–æ¶ˆè£å‰ª</span>
    }
}
</code></pre>
<h4 data-id="heading-70">4.3 åæ ‡ç³»ç»Ÿä¸å˜æ¢</h4>
<p>MFCæ”¯æŒå¤šç§åæ ‡æ˜ å°„æ¨¡å¼å’Œå˜æ¢ï¼š</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">CMyView::DemonstrateCoordinateSystems</span><span class="hljs-params">(CDC* pDC)</span>
</span>{
    <span class="hljs-comment">// ä¿å­˜åŸå§‹DCçŠ¶æ€</span>
    <span class="hljs-type">int</span> nOldMapMode = pDC-&gt;<span class="hljs-built_in">SaveDC</span>();
    
    <span class="hljs-comment">// ç¤ºä¾‹1ï¼šé€»è¾‘åæ ‡ä¸è®¾å¤‡åæ ‡</span>
    pDC-&gt;<span class="hljs-built_in">SetMapMode</span>(MM_TEXT); <span class="hljs-comment">// é»˜è®¤æ¨¡å¼ï¼Œ1é€»è¾‘å•ä½=1åƒç´ </span>
    
    <span class="hljs-comment">// è®¾ç½®çª—å£ï¼ˆé€»è¾‘ï¼‰å’Œè§†å£ï¼ˆè®¾å¤‡ï¼‰èŒƒå›´</span>
    pDC-&gt;<span class="hljs-built_in">SetWindowExt</span>(<span class="hljs-number">1000</span>, <span class="hljs-number">1000</span>);  <span class="hljs-comment">// é€»è¾‘èŒƒå›´</span>
    pDC-&gt;<span class="hljs-built_in">SetViewportExt</span>(<span class="hljs-number">500</span>, <span class="hljs-number">500</span>);  <span class="hljs-comment">// è®¾å¤‡èŒƒå›´</span>
    
    <span class="hljs-comment">// ç¤ºä¾‹2ï¼šä½¿ç”¨MM_ANISOTROPICæ¨¡å¼</span>
    pDC-&gt;<span class="hljs-built_in">SetMapMode</span>(MM_ANISOTROPIC);
    pDC-&gt;<span class="hljs-built_in">SetWindowExt</span>(<span class="hljs-number">1000</span>, <span class="hljs-number">1000</span>);
    pDC-&gt;<span class="hljs-built_in">SetViewportExt</span>(rectClient.<span class="hljs-built_in">Width</span>(), rectClient.<span class="hljs-built_in">Height</span>());
    
    <span class="hljs-comment">// ç»˜åˆ¶éšçª—å£å¤§å°ç¼©æ”¾çš„å›¾å½¢</span>
    pDC-&gt;<span class="hljs-built_in">Rectangle</span>(<span class="hljs-number">100</span>, <span class="hljs-number">100</span>, <span class="hljs-number">900</span>, <span class="hljs-number">900</span>);
    
    <span class="hljs-comment">// ç¤ºä¾‹3ï¼šä½¿ç”¨MM_HIMETRICæ¨¡å¼ï¼ˆç‰©ç†å°ºå¯¸ï¼‰</span>
    pDC-&gt;<span class="hljs-built_in">SetMapMode</span>(MM_HIMETRIC); <span class="hljs-comment">// 0.01æ¯«ç±³å•ä½</span>
    pDC-&gt;<span class="hljs-built_in">Rectangle</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">10000</span>, <span class="hljs-number">-5000</span>); <span class="hljs-comment">// 10cm x 5cmçŸ©å½¢</span>
    
    <span class="hljs-comment">// åæ ‡è½¬æ¢ç¤ºä¾‹</span>
    <span class="hljs-function">CPoint <span class="hljs-title">ptLogical</span><span class="hljs-params">(<span class="hljs-number">500</span>, <span class="hljs-number">500</span>)</span></span>;
    CPoint ptDevice;
    
    <span class="hljs-comment">// é€»è¾‘åæ ‡è½¬è®¾å¤‡åæ ‡</span>
    pDC-&gt;<span class="hljs-built_in">LPtoDP</span>(&amp;ptLogical);
    
    <span class="hljs-comment">// è®¾å¤‡åæ ‡è½¬é€»è¾‘åæ ‡</span>
    pDC-&gt;<span class="hljs-built_in">DPtoLP</span>(&amp;ptDevice);
    
    <span class="hljs-comment">// ç¤ºä¾‹4ï¼šä¸–ç•Œå˜æ¢ï¼ˆWindows NT/2000+ï¼‰</span>
    <span class="hljs-keyword">if</span> (pDC-&gt;<span class="hljs-built_in">GetDeviceCaps</span>(RASTERCAPS) &amp; RC_TRANSFORM)
    {
        XFORM xform;
        
        <span class="hljs-comment">// è®¾ç½®æ—‹è½¬çŸ©é˜µï¼ˆæ—‹è½¬30åº¦ï¼‰</span>
        <span class="hljs-type">float</span> fAngle = <span class="hljs-number">30.0f</span> * <span class="hljs-number">3.14159f</span> / <span class="hljs-number">180.0f</span>;
        xform.eM11 = <span class="hljs-built_in">cos</span>(fAngle);
        xform.eM12 = <span class="hljs-built_in">sin</span>(fAngle);
        xform.eM21 = -<span class="hljs-built_in">sin</span>(fAngle);
        xform.eM22 = <span class="hljs-built_in">cos</span>(fAngle);
        xform.eDx = <span class="hljs-number">100.0f</span>;  <span class="hljs-comment">// Xæ–¹å‘å¹³ç§»</span>
        xform.eDy = <span class="hljs-number">100.0f</span>;  <span class="hljs-comment">// Yæ–¹å‘å¹³ç§»</span>
        
        <span class="hljs-comment">// è®¾ç½®ä¸–ç•Œå˜æ¢</span>
        pDC-&gt;<span class="hljs-built_in">SetGraphicsMode</span>(GM_ADVANCED);
        pDC-&gt;<span class="hljs-built_in">SetWorldTransform</span>(&amp;xform);
        
        <span class="hljs-comment">// ç»˜åˆ¶å˜æ¢åçš„å›¾å½¢</span>
        pDC-&gt;<span class="hljs-built_in">Rectangle</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">100</span>, <span class="hljs-number">100</span>);
        
        <span class="hljs-comment">// æ¢å¤é»˜è®¤å˜æ¢</span>
        pDC-&gt;<span class="hljs-built_in">ModifyWorldTransform</span>(<span class="hljs-literal">NULL</span>, MWT_IDENTITY);
    }
    
    <span class="hljs-comment">// æ¢å¤åŸå§‹DCçŠ¶æ€</span>
    pDC-&gt;<span class="hljs-built_in">RestoreDC</span>(nOldMapMode);
}
</code></pre>
<h3 data-id="heading-71">äº”ã€å­—ä½“ä¸æ–‡æœ¬æ¸²æŸ“</h3>
<h4 data-id="heading-72">5.1 å­—ä½“åˆ›å»ºä¸æ–‡æœ¬åº¦é‡</h4>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-keyword">class</span> <span class="hljs-title class_">CTextRenderer</span>
{
<span class="hljs-keyword">private</span>:
    CFont m_fontNormal;
    CFont m_fontBold;
    CFont m_fontItalic;
    
<span class="hljs-keyword">public</span>:
    <span class="hljs-function">BOOL <span class="hljs-title">InitializeFonts</span><span class="hljs-params">()</span>
    </span>{
        <span class="hljs-comment">// åˆ›å»ºä¸åŒé£æ ¼çš„å­—ä½“</span>
        LOGFONT lf = {<span class="hljs-number">0</span>};
        
        <span class="hljs-comment">// æ ‡å‡†å­—ä½“</span>
        lf.lfHeight = <span class="hljs-number">-16</span>; <span class="hljs-comment">// 16åƒç´ é«˜ï¼ˆè´Ÿå€¼è¡¨ç¤ºå­—ç¬¦é«˜åº¦ï¼‰</span>
        lf.lfWeight = FW_NORMAL;
        lf.lfCharSet = DEFAULT_CHARSET;
        <span class="hljs-built_in">lstrcpy</span>(lf.lfFaceName, _T(<span class="hljs-string">"å¾®è½¯é›…é»‘"</span>));
        m_fontNormal.<span class="hljs-built_in">CreateFontIndirect</span>(&amp;lf);
        
        <span class="hljs-comment">// ç²—ä½“</span>
        lf.lfWeight = FW_BOLD;
        m_fontBold.<span class="hljs-built_in">CreateFontIndirect</span>(&amp;lf);
        
        <span class="hljs-comment">// æ–œä½“</span>
        lf.lfWeight = FW_NORMAL;
        lf.lfItalic = TRUE;
        m_fontItalic.<span class="hljs-built_in">CreateFontIndirect</span>(&amp;lf);
        
        <span class="hljs-keyword">return</span> TRUE;
    }
    
    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">DrawTextWithMetrics</span><span class="hljs-params">(CDC* pDC, <span class="hljs-type">int</span> x, <span class="hljs-type">int</span> y, LPCTSTR lpszText)</span>
    </span>{
        CFont* pOldFont = pDC-&gt;<span class="hljs-built_in">SelectObject</span>(&amp;m_fontNormal);
        
        <span class="hljs-comment">// è·å–æ–‡æœ¬åº¦é‡ä¿¡æ¯</span>
        TEXTMETRIC tm;
        pDC-&gt;<span class="hljs-built_in">GetTextMetrics</span>(&amp;tm);
        
        <span class="hljs-comment">// è®¡ç®—æ–‡æœ¬å®½åº¦</span>
        CSize sizeText = pDC-&gt;<span class="hljs-built_in">GetTextExtent</span>(lpszText, <span class="hljs-built_in">lstrlen</span>(lpszText));
        
        <span class="hljs-comment">// ç»˜åˆ¶èƒŒæ™¯</span>
        <span class="hljs-function">CRect <span class="hljs-title">rectText</span><span class="hljs-params">(x, y, x + sizeText.cx, y + tm.tmHeight)</span></span>;
        <span class="hljs-function">CBrush <span class="hljs-title">brushBg</span><span class="hljs-params">(RGB(<span class="hljs-number">240</span>, <span class="hljs-number">240</span>, <span class="hljs-number">240</span>))</span></span>;
        pDC-&gt;<span class="hljs-built_in">FillRect</span>(&amp;rectText, &amp;brushBg);
        
        <span class="hljs-comment">// ç»˜åˆ¶æ–‡æœ¬</span>
        pDC-&gt;<span class="hljs-built_in">SetBkMode</span>(TRANSPARENT);
        pDC-&gt;<span class="hljs-built_in">TextOut</span>(x, y, lpszText);
        
        <span class="hljs-comment">// ç»˜åˆ¶åŸºçº¿</span>
        <span class="hljs-function">CPen <span class="hljs-title">penBaseline</span><span class="hljs-params">(PS_SOLID, <span class="hljs-number">1</span>, RGB(<span class="hljs-number">255</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>))</span></span>;
        CPen* pOldPen = pDC-&gt;<span class="hljs-built_in">SelectObject</span>(&amp;penBaseline);
        pDC-&gt;<span class="hljs-built_in">MoveTo</span>(x, y + tm.tmAscent);
        pDC-&gt;<span class="hljs-built_in">LineTo</span>(x + sizeText.cx, y + tm.tmAscent);
        
        <span class="hljs-comment">// ç»˜åˆ¶è¾¹ç•Œæ¡†</span>
        <span class="hljs-function">CPen <span class="hljs-title">penBorder</span><span class="hljs-params">(PS_DOT, <span class="hljs-number">1</span>, RGB(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">255</span>))</span></span>;
        pDC-&gt;<span class="hljs-built_in">SelectObject</span>(&amp;penBorder);
        pDC-&gt;<span class="hljs-built_in">SelectStockObject</span>(NULL_BRUSH);
        pDC-&gt;<span class="hljs-built_in">Rectangle</span>(&amp;rectText);
        
        pDC-&gt;<span class="hljs-built_in">SelectObject</span>(pOldPen);
        pDC-&gt;<span class="hljs-built_in">SelectObject</span>(pOldFont);
    }
    
    <span class="hljs-comment">// å¤šè¡Œæ–‡æœ¬ç»˜åˆ¶</span>
    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">DrawMultilineText</span><span class="hljs-params">(CDC* pDC, CRect rect, LPCTSTR lpszText)</span>
    </span>{
        CFont* pOldFont = pDC-&gt;<span class="hljs-built_in">SelectObject</span>(&amp;m_fontNormal);
        
        <span class="hljs-comment">// è®¾ç½®æ–‡æœ¬æ ¼å¼</span>
        UINT uFormat = DT_LEFT | DT_WORDBREAK | DT_NOPREFIX | DT_EDITCONTROL;
        
        <span class="hljs-comment">// è®¡ç®—éœ€è¦çš„çŸ©å½¢é«˜åº¦</span>
        CRect rectCalc = rect;
        pDC-&gt;<span class="hljs-built_in">DrawText</span>(lpszText, <span class="hljs-number">-1</span>, &amp;rectCalc, uFormat | DT_CALCRECT);
        
        <span class="hljs-comment">// ç»˜åˆ¶æ–‡æœ¬</span>
        pDC-&gt;<span class="hljs-built_in">DrawText</span>(lpszText, <span class="hljs-number">-1</span>, &amp;rect, uFormat);
        
        pDC-&gt;<span class="hljs-built_in">SelectObject</span>(pOldFont);
    }
};
</code></pre>
<h4 data-id="heading-73">5.2 é«˜çº§æ–‡æœ¬æ•ˆæœ</h4>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">CMyView::DrawTextEffects</span><span class="hljs-params">(CDC* pDC)</span>
</span>{
    CRect rectClient;
    <span class="hljs-built_in">GetClientRect</span>(&amp;rectClient);
    
    <span class="hljs-comment">// 1. é˜´å½±æ–‡å­—</span>
    <span class="hljs-built_in">DrawShadowText</span>(pDC, _T(<span class="hljs-string">"é˜´å½±æ•ˆæœ"</span>), 
                   <span class="hljs-built_in">CPoint</span>(<span class="hljs-number">50</span>, <span class="hljs-number">50</span>), 
                   <span class="hljs-built_in">RGB</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>), <span class="hljs-built_in">RGB</span>(<span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">255</span>));
    
    <span class="hljs-comment">// 2. æ¸å˜æ–‡å­—</span>
    <span class="hljs-built_in">DrawGradientText</span>(pDC, _T(<span class="hljs-string">"æ¸å˜æ–‡å­—"</span>), 
                     <span class="hljs-built_in">CPoint</span>(<span class="hljs-number">50</span>, <span class="hljs-number">100</span>), 
                     <span class="hljs-built_in">RGB</span>(<span class="hljs-number">255</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>), <span class="hljs-built_in">RGB</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">255</span>));
    
    <span class="hljs-comment">// 3. è½®å»“æ–‡å­—</span>
    <span class="hljs-built_in">DrawOutlineText</span>(pDC, _T(<span class="hljs-string">"è½®å»“æ–‡å­—"</span>), 
                    <span class="hljs-built_in">CPoint</span>(<span class="hljs-number">50</span>, <span class="hljs-number">150</span>), 
                    <span class="hljs-number">3</span>, <span class="hljs-built_in">RGB</span>(<span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">255</span>), <span class="hljs-built_in">RGB</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>));
}

<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">DrawShadowText</span><span class="hljs-params">(CDC* pDC, LPCTSTR lpszText, CPoint pt, 
                    COLORREF crText, COLORREF crShadow)</span>
</span>{
    CFont font;
    LOGFONT lf = {<span class="hljs-number">0</span>};
    lf.lfHeight = <span class="hljs-number">-48</span>;
    lf.lfWeight = FW_BOLD;
    <span class="hljs-built_in">lstrcpy</span>(lf.lfFaceName, _T(<span class="hljs-string">"Arial"</span>));
    font.<span class="hljs-built_in">CreateFontIndirect</span>(&amp;lf);
    
    CFont* pOldFont = pDC-&gt;<span class="hljs-built_in">SelectObject</span>(&amp;font);
    
    <span class="hljs-comment">// ç»˜åˆ¶é˜´å½±</span>
    pDC-&gt;<span class="hljs-built_in">SetTextColor</span>(crShadow);
    pDC-&gt;<span class="hljs-built_in">TextOut</span>(pt.x + <span class="hljs-number">3</span>, pt.y + <span class="hljs-number">3</span>, lpszText);
    
    <span class="hljs-comment">// ç»˜åˆ¶å‰æ™¯æ–‡å­—</span>
    pDC-&gt;<span class="hljs-built_in">SetTextColor</span>(crText);
    pDC-&gt;<span class="hljs-built_in">TextOut</span>(pt.x, pt.y, lpszText);
    
    pDC-&gt;<span class="hljs-built_in">SelectObject</span>(pOldFont);
}

<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">DrawGradientText</span><span class="hljs-params">(CDC* pDC, LPCTSTR lpszText, CPoint pt,
                      COLORREF crStart, COLORREF crEnd)</span>
</span>{
    <span class="hljs-comment">// åˆ›å»ºå­—ä½“</span>
    CFont font;
    LOGFONT lf = {<span class="hljs-number">0</span>};
    lf.lfHeight = <span class="hljs-number">-48</span>;
    lf.lfWeight = FW_BOLD;
    <span class="hljs-built_in">lstrcpy</span>(lf.lfFaceName, _T(<span class="hljs-string">"Arial"</span>));
    font.<span class="hljs-built_in">CreateFontIndirect</span>(&amp;lf);
    
    CFont* pOldFont = pDC-&gt;<span class="hljs-built_in">SelectObject</span>(&amp;font);
    
    <span class="hljs-comment">// è·å–æ–‡æœ¬å°ºå¯¸</span>
    CSize sizeText = pDC-&gt;<span class="hljs-built_in">GetTextExtent</span>(lpszText, <span class="hljs-built_in">lstrlen</span>(lpszText));
    
    <span class="hljs-comment">// åˆ›å»ºæ¸å˜ç”»åˆ·</span>
    TRIVERTEX vert[<span class="hljs-number">2</span>] = {<span class="hljs-number">0</span>};
    vert[<span class="hljs-number">0</span>].x = pt.x;
    vert[<span class="hljs-number">0</span>].y = pt.y;
    vert[<span class="hljs-number">0</span>].Red = <span class="hljs-built_in">GetRValue</span>(crStart) &lt;&lt; <span class="hljs-number">8</span>;
    vert[<span class="hljs-number">0</span>].Green = <span class="hljs-built_in">GetGValue</span>(crStart) &lt;&lt; <span class="hljs-number">8</span>;
    vert[<span class="hljs-number">0</span>].Blue = <span class="hljs-built_in">GetBValue</span>(crStart) &lt;&lt; <span class="hljs-number">8</span>;
    vert[<span class="hljs-number">0</span>].Alpha = <span class="hljs-number">0x0000</span>;
    
    vert[<span class="hljs-number">1</span>].x = pt.x + sizeText.cx;
    vert[<span class="hljs-number">1</span>].y = pt.y + sizeText.cy;
    vert[<span class="hljs-number">1</span>].Red = <span class="hljs-built_in">GetRValue</span>(crEnd) &lt;&lt; <span class="hljs-number">8</span>;
    vert[<span class="hljs-number">1</span>].Green = <span class="hljs-built_in">GetGValue</span>(crEnd) &lt;&lt; <span class="hljs-number">8</span>;
    vert[<span class="hljs-number">1</span>].Blue = <span class="hljs-built_in">GetBValue</span>(crEnd) &lt;&lt; <span class="hljs-number">8</span>;
    vert[<span class="hljs-number">1</span>].Alpha = <span class="hljs-number">0x0000</span>;
    
    GRADIENT_RECT gRect = {<span class="hljs-number">0</span>, <span class="hljs-number">1</span>};
    
    <span class="hljs-comment">// ä½¿ç”¨è·¯å¾„åˆ›å»ºæ–‡æœ¬è½®å»“</span>
    pDC-&gt;<span class="hljs-built_in">BeginPath</span>();
    pDC-&gt;<span class="hljs-built_in">TextOut</span>(pt.x, pt.y, lpszText);
    pDC-&gt;<span class="hljs-built_in">EndPath</span>();
    
    <span class="hljs-comment">// ç”¨æ¸å˜å¡«å……æ–‡æœ¬è·¯å¾„</span>
    pDC-&gt;<span class="hljs-built_in">SelectClipPath</span>(RGN_COPY);
    pDC-&gt;<span class="hljs-built_in">GradientFill</span>(vert, <span class="hljs-number">2</span>, &amp;gRect, <span class="hljs-number">1</span>, GRADIENT_FILL_RECT_H);
    
    pDC-&gt;<span class="hljs-built_in">SelectObject</span>(pOldFont);
}
</code></pre>
<h3 data-id="heading-74">å…­ã€ä½å›¾æ“ä½œä¸å›¾åƒå¤„ç†</h3>
<h4 data-id="heading-75">6.1 ä½å›¾åŠ è½½ä¸æ˜¾ç¤ºä¼˜åŒ–</h4>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-keyword">class</span> <span class="hljs-title class_">CBitmapManager</span>
{
<span class="hljs-keyword">private</span>:
    CMap&lt;UINT, UINT, CBitmap*, CBitmap*&gt; m_mapBitmaps;
    CSize m_sizeDisplay; <span class="hljs-comment">// æ˜¾ç¤ºå°ºå¯¸ç¼“å­˜</span>
    
<span class="hljs-keyword">public</span>:
    <span class="hljs-built_in">CBitmapManager</span>() : <span class="hljs-built_in">m_sizeDisplay</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>) {}
    
    <span class="hljs-keyword">virtual</span> ~<span class="hljs-built_in">CBitmapManager</span>()
    {
        <span class="hljs-built_in">Cleanup</span>();
    }
    
    <span class="hljs-comment">// ä»èµ„æºåŠ è½½ä½å›¾</span>
    <span class="hljs-function">CBitmap* <span class="hljs-title">LoadBitmapFromResource</span><span class="hljs-params">(UINT nIDResource, 
                                    CSize sizeTarget = CSize(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>))</span>
    </span>{
        CBitmap* pBitmap = <span class="hljs-literal">NULL</span>;
        
        <span class="hljs-keyword">if</span> (m_mapBitmaps.<span class="hljs-built_in">Lookup</span>(nIDResource, pBitmap))
            <span class="hljs-keyword">return</span> pBitmap;
        
        <span class="hljs-comment">// åŠ è½½åŸå§‹ä½å›¾</span>
        CBitmap bmpOriginal;
        <span class="hljs-keyword">if</span> (!bmpOriginal.<span class="hljs-built_in">LoadBitmap</span>(nIDResource))
            <span class="hljs-keyword">return</span> <span class="hljs-literal">NULL</span>;
        
        <span class="hljs-comment">// è·å–åŸå§‹å°ºå¯¸</span>
        BITMAP bmInfo;
        bmpOriginal.<span class="hljs-built_in">GetBitmap</span>(&amp;bmInfo);
        
        <span class="hljs-function">CSize <span class="hljs-title">sizeSource</span><span class="hljs-params">(bmInfo.bmWidth, bmInfo.bmHeight)</span></span>;
        
        <span class="hljs-comment">// å¦‚æœéœ€è¦ç¼©æ”¾</span>
        <span class="hljs-keyword">if</span> (sizeTarget.cx &gt; <span class="hljs-number">0</span> &amp;&amp; sizeTarget.cy &gt; <span class="hljs-number">0</span> &amp;&amp; 
            (sizeTarget != sizeSource))
        {
            pBitmap = <span class="hljs-built_in">ScaleBitmap</span>(&amp;bmpOriginal, sizeSource, sizeTarget);
        }
        <span class="hljs-keyword">else</span>
        {
            pBitmap = <span class="hljs-keyword">new</span> CBitmap;
            pBitmap-&gt;<span class="hljs-built_in">Attach</span>(bmpOriginal.<span class="hljs-built_in">Detach</span>());
        }
        
        m_mapBitmaps.<span class="hljs-built_in">SetAt</span>(nIDResource, pBitmap);
        <span class="hljs-keyword">return</span> pBitmap;
    }
    
    <span class="hljs-comment">// ä½å›¾ç¼©æ”¾å‡½æ•°</span>
    <span class="hljs-function">CBitmap* <span class="hljs-title">ScaleBitmap</span><span class="hljs-params">(CBitmap* pSrcBitmap, CSize sizeSrc, CSize sizeDst)</span>
    </span>{
        <span class="hljs-comment">// åˆ›å»ºæºDCå’Œç›®æ ‡DC</span>
        <span class="hljs-function">CWindowDC <span class="hljs-title">dcScreen</span><span class="hljs-params">(<span class="hljs-literal">NULL</span>)</span></span>;
        CDC dcSrc, dcDst;
        
        dcSrc.<span class="hljs-built_in">CreateCompatibleDC</span>(&amp;dcScreen);
        dcDst.<span class="hljs-built_in">CreateCompatibleDC</span>(&amp;dcScreen);
        
        <span class="hljs-comment">// åˆ›å»ºç›®æ ‡ä½å›¾</span>
        CBitmap* pDstBitmap = <span class="hljs-keyword">new</span> CBitmap;
        pDstBitmap-&gt;<span class="hljs-built_in">CreateCompatibleBitmap</span>(&amp;dcScreen, 
                                          sizeDst.cx, sizeDst.cy);
        
        <span class="hljs-comment">// é€‰å…¥ä½å›¾</span>
        CBitmap* pOldSrcBitmap = dcSrc.<span class="hljs-built_in">SelectObject</span>(pSrcBitmap);
        CBitmap* pOldDstBitmap = dcDst.<span class="hljs-built_in">SelectObject</span>(pDstBitmap);
        
        <span class="hljs-comment">// è®¾ç½®æ‹‰ä¼¸æ¨¡å¼</span>
        dcDst.<span class="hljs-built_in">SetStretchBltMode</span>(HALFTONE);
        dcDst.<span class="hljs-built_in">SetBrushOrg</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>);
        
        <span class="hljs-comment">// æ‰§è¡Œç¼©æ”¾</span>
        dcDst.<span class="hljs-built_in">StretchBlt</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, sizeDst.cx, sizeDst.cy,
                        &amp;dcSrc, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, sizeSrc.cx, sizeSrc.cy,
                        SRCCOPY);
        
        <span class="hljs-comment">// æ¢å¤å¹¶æ¸…ç†</span>
        dcSrc.<span class="hljs-built_in">SelectObject</span>(pOldSrcBitmap);
        dcDst.<span class="hljs-built_in">SelectObject</span>(pOldDstBitmap);
        
        <span class="hljs-keyword">return</span> pDstBitmap;
    }
    
    <span class="hljs-comment">// é€æ˜ä½å›¾ç»˜åˆ¶</span>
    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">DrawTransparentBitmap</span><span class="hljs-params">(CDC* pDC, CBitmap* pBitmap, 
                               CPoint ptDest, COLORREF crTransparent)</span>
    </span>{
        <span class="hljs-comment">// åˆ›å»ºå†…å­˜DC</span>
        CDC dcMem, dcMask;
        dcMem.<span class="hljs-built_in">CreateCompatibleDC</span>(pDC);
        dcMask.<span class="hljs-built_in">CreateCompatibleDC</span>(pDC);
        
        <span class="hljs-comment">// è·å–ä½å›¾å°ºå¯¸</span>
        BITMAP bm;
        pBitmap-&gt;<span class="hljs-built_in">GetBitmap</span>(&amp;bm);
        
        <span class="hljs-comment">// åˆ›å»ºæ©ç ä½å›¾</span>
        CBitmap bmpMask;
        bmpMask.<span class="hljs-built_in">CreateBitmap</span>(bm.bmWidth, bm.bmHeight, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-literal">NULL</span>);
        
        <span class="hljs-comment">// é€‰å…¥ä½å›¾</span>
        CBitmap* pOldMemBitmap = dcMem.<span class="hljs-built_in">SelectObject</span>(pBitmap);
        CBitmap* pOldMaskBitmap = dcMask.<span class="hljs-built_in">SelectObject</span>(&amp;bmpMask);
        
        <span class="hljs-comment">// è®¾ç½®é€æ˜è‰²</span>
        COLORREF crOldBk = dcMem.<span class="hljs-built_in">SetBkColor</span>(crTransparent);
        
        <span class="hljs-comment">// åˆ›å»ºæ©ç ï¼ˆé€æ˜åŒºåŸŸä¸º1ï¼Œéé€æ˜åŒºåŸŸä¸º0ï¼‰</span>
        dcMask.<span class="hljs-built_in">BitBlt</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, bm.bmWidth, bm.bmHeight, 
                     &amp;dcMem, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, SRCCOPY);
        
        <span class="hljs-comment">// åœ¨ç›®æ ‡DCä¸Šä½¿ç”¨æ©ç </span>
        pDC-&gt;<span class="hljs-built_in">BitBlt</span>(ptDest.x, ptDest.y, bm.bmWidth, bm.bmHeight,
                   &amp;dcMask, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, SRCAND);
        
        <span class="hljs-comment">// è®¾ç½®èƒŒæ™¯è‰²å¹¶ç»˜åˆ¶</span>
        dcMem.<span class="hljs-built_in">SetBkColor</span>(<span class="hljs-built_in">RGB</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>));
        dcMem.<span class="hljs-built_in">SetTextColor</span>(<span class="hljs-built_in">RGB</span>(<span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">255</span>));
        dcMem.<span class="hljs-built_in">BitBlt</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, bm.bmWidth, bm.bmHeight,
                    &amp;dcMask, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, SRCAND);
        
        <span class="hljs-comment">// åˆå¹¶ç»“æœ</span>
        pDC-&gt;<span class="hljs-built_in">BitBlt</span>(ptDest.x, ptDest.y, bm.bmWidth, bm.bmHeight,
                   &amp;dcMem, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, SRCPAINT);
        
        <span class="hljs-comment">// æ¢å¤</span>
        dcMem.<span class="hljs-built_in">SetBkColor</span>(crOldBk);
        dcMem.<span class="hljs-built_in">SelectObject</span>(pOldMemBitmap);
        dcMask.<span class="hljs-built_in">SelectObject</span>(pOldMaskBitmap);
    }
    
    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">Cleanup</span><span class="hljs-params">()</span>
    </span>{
        POSITION pos = m_mapBitmaps.<span class="hljs-built_in">GetStartPosition</span>();
        UINT nID;
        CBitmap* pBitmap;
        <span class="hljs-keyword">while</span> (pos != <span class="hljs-literal">NULL</span>)
        {
            m_mapBitmaps.<span class="hljs-built_in">GetNextAssoc</span>(pos, nID, pBitmap);
            <span class="hljs-keyword">delete</span> pBitmap;
        }
        m_mapBitmaps.<span class="hljs-built_in">RemoveAll</span>();
    }
};
</code></pre>
<h4 data-id="heading-76">6.2 å›¾åƒç‰¹æ•ˆå¤„ç†</h4>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-comment">// ç®€å•çš„å›¾åƒå¤„ç†è¿‡æ»¤å™¨</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">CImageFilter</span>
{
<span class="hljs-keyword">public</span>:
    <span class="hljs-comment">// ç°åº¦åŒ–</span>
    <span class="hljs-function"><span class="hljs-type">static</span> <span class="hljs-type">void</span> <span class="hljs-title">ConvertToGrayScale</span><span class="hljs-params">(CDC* pDC, CBitmap* pBitmap, 
                                   <span class="hljs-type">const</span> CRect&amp; rect)</span>
    </span>{
        <span class="hljs-comment">// è·å–ä½å›¾ä¿¡æ¯</span>
        BITMAP bm;
        pBitmap-&gt;<span class="hljs-built_in">GetBitmap</span>(&amp;bm);
        
        <span class="hljs-comment">// åˆ›å»ºå†…å­˜DC</span>
        CDC dcMem;
        dcMem.<span class="hljs-built_in">CreateCompatibleDC</span>(pDC);
        CBitmap* pOldBitmap = dcMem.<span class="hljs-built_in">SelectObject</span>(pBitmap);
        
        <span class="hljs-comment">// é€åƒç´ å¤„ç†</span>
        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> y = rect.top; y &lt; rect.bottom; y++)
        {
            <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> x = rect.left; x &lt; rect.right; x++)
            {
                COLORREF cr = dcMem.<span class="hljs-built_in">GetPixel</span>(x, y);
                
                <span class="hljs-comment">// è®¡ç®—ç°åº¦å€¼</span>
                BYTE r = <span class="hljs-built_in">GetRValue</span>(cr);
                BYTE g = <span class="hljs-built_in">GetGValue</span>(cr);
                BYTE b = <span class="hljs-built_in">GetBValue</span>(cr);
                BYTE gray = (BYTE)(<span class="hljs-number">0.299</span> * r + <span class="hljs-number">0.587</span> * g + <span class="hljs-number">0.114</span> * b);
                
                <span class="hljs-comment">// è®¾ç½®ç°åº¦åƒç´ </span>
                dcMem.<span class="hljs-built_in">SetPixel</span>(x, y, <span class="hljs-built_in">RGB</span>(gray, gray, gray));
            }
        }
        
        dcMem.<span class="hljs-built_in">SelectObject</span>(pOldBitmap);
    }
    
    <span class="hljs-comment">// äº®åº¦è°ƒæ•´</span>
    <span class="hljs-function"><span class="hljs-type">static</span> <span class="hljs-type">void</span> <span class="hljs-title">AdjustBrightness</span><span class="hljs-params">(CDC* pDC, CBitmap* pBitmap,
                                 <span class="hljs-type">const</span> CRect&amp; rect, <span class="hljs-type">int</span> nDelta)</span>
    </span>{
        CDC dcMem;
        dcMem.<span class="hljs-built_in">CreateCompatibleDC</span>(pDC);
        CBitmap* pOldBitmap = dcMem.<span class="hljs-built_in">SelectObject</span>(pBitmap);
        
        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> y = rect.top; y &lt; rect.bottom; y++)
        {
            <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> x = rect.left; x &lt; rect.right; x++)
            {
                COLORREF cr = dcMem.<span class="hljs-built_in">GetPixel</span>(x, y);
                
                BYTE r = <span class="hljs-built_in">Clamp</span>(<span class="hljs-built_in">GetRValue</span>(cr) + nDelta);
                BYTE g = <span class="hljs-built_in">Clamp</span>(<span class="hljs-built_in">GetGValue</span>(cr) + nDelta);
                BYTE b = <span class="hljs-built_in">Clamp</span>(<span class="hljs-built_in">GetBValue</span>(cr) + nDelta);
                
                dcMem.<span class="hljs-built_in">SetPixel</span>(x, y, <span class="hljs-built_in">RGB</span>(r, g, b));
            }
        }
        
        dcMem.<span class="hljs-built_in">SelectObject</span>(pOldBitmap);
    }
    
    <span class="hljs-comment">// å¯¹æ¯”åº¦è°ƒæ•´</span>
    <span class="hljs-function"><span class="hljs-type">static</span> <span class="hljs-type">void</span> <span class="hljs-title">AdjustContrast</span><span class="hljs-params">(CDC* pDC, CBitmap* pBitmap,
                               <span class="hljs-type">const</span> CRect&amp; rect, <span class="hljs-type">double</span> dContrast)</span>
    </span>{
        CDC dcMem;
        dcMem.<span class="hljs-built_in">CreateCompatibleDC</span>(pDC);
        CBitmap* pOldBitmap = dcMem.<span class="hljs-built_in">SelectObject</span>(pBitmap);
        
        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> y = rect.top; y &lt; rect.bottom; y++)
        {
            <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> x = rect.left; x &lt; rect.right; x++)
            {
                COLORREF cr = dcMem.<span class="hljs-built_in">GetPixel</span>(x, y);
                
                BYTE r = <span class="hljs-built_in">Clamp</span>((<span class="hljs-type">int</span>)((<span class="hljs-built_in">GetRValue</span>(cr) - <span class="hljs-number">128</span>) * dContrast + <span class="hljs-number">128</span>));
                BYTE g = <span class="hljs-built_in">Clamp</span>((<span class="hljs-type">int</span>)((<span class="hljs-built_in">GetGValue</span>(cr) - <span class="hljs-number">128</span>) * dContrast + <span class="hljs-number">128</span>));
                BYTE b = <span class="hljs-built_in">Clamp</span>((<span class="hljs-type">int</span>)((<span class="hljs-built_in">GetBValue</span>(cr) - <span class="hljs-number">128</span>) * dContrast + <span class="hljs-number">128</span>));
                
                dcMem.<span class="hljs-built_in">SetPixel</span>(x, y, <span class="hljs-built_in">RGB</span>(r, g, b));
            }
        }
        
        dcMem.<span class="hljs-built_in">SelectObject</span>(pOldBitmap);
    }
    
<span class="hljs-keyword">private</span>:
    <span class="hljs-function"><span class="hljs-type">static</span> BYTE <span class="hljs-title">Clamp</span><span class="hljs-params">(<span class="hljs-type">int</span> value)</span>
    </span>{
        <span class="hljs-keyword">if</span> (value &lt; <span class="hljs-number">0</span>) <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
        <span class="hljs-keyword">if</span> (value &gt; <span class="hljs-number">255</span>) <span class="hljs-keyword">return</span> <span class="hljs-number">255</span>;
        <span class="hljs-keyword">return</span> (BYTE)value;
    }
};
</code></pre>
<h3 data-id="heading-77">ä¸ƒã€æ‰“å°ä¸æ‰“å°é¢„è§ˆ</h3>
<h4 data-id="heading-78">7.1 æ‰“å°æ¶æ„çš„å®ç°</h4>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-comment">// æ”¯æŒæ‰“å°çš„è§†å›¾ç±»</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">CPrintableView</span> : <span class="hljs-keyword">public</span> CView
{
<span class="hljs-keyword">protected</span>:
    <span class="hljs-comment">// æ‰“å°ç›¸å…³æˆå‘˜</span>
    CPrintInfo m_printInfo;
    <span class="hljs-type">int</span> m_nPageWidth;
    <span class="hljs-type">int</span> m_nPageHeight;
    <span class="hljs-type">int</span> m_nCurPage;
    
<span class="hljs-keyword">public</span>:
    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">void</span> <span class="hljs-title">OnPreparePrinting</span><span class="hljs-params">(CPrintInfo* pInfo)</span>
    </span>{
        <span class="hljs-comment">// è®¾ç½®æ‰“å°å¯¹è¯æ¡†é»˜è®¤å€¼</span>
        pInfo-&gt;<span class="hljs-built_in">SetMaxPage</span>(<span class="hljs-number">10</span>); <span class="hljs-comment">// å‡è®¾æœ€å¤š10é¡µ</span>
        pInfo-&gt;<span class="hljs-built_in">SetMinPage</span>(<span class="hljs-number">1</span>);
        
        <span class="hljs-comment">// è°ƒç”¨DoPreparePrintingæ˜¾ç¤ºæ‰“å°å¯¹è¯æ¡†</span>
        <span class="hljs-built_in">DoPreparePrinting</span>(pInfo);
    }
    
    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">void</span> <span class="hljs-title">OnBeginPrinting</span><span class="hljs-params">(CDC* pDC, CPrintInfo* pInfo)</span>
    </span>{
        <span class="hljs-comment">// è·å–æ‰“å°æœºDCèƒ½åŠ›</span>
        m_nPageWidth = pDC-&gt;<span class="hljs-built_in">GetDeviceCaps</span>(HORZRES);
        m_nPageHeight = pDC-&gt;<span class="hljs-built_in">GetDeviceCaps</span>(VERTRES);
        
        <span class="hljs-comment">// è®¡ç®—æ€»é¡µæ•°</span>
        CMyDocument* pDoc = <span class="hljs-built_in">GetDocument</span>();
        <span class="hljs-type">int</span> nTotalLines = pDoc-&gt;<span class="hljs-built_in">GetLineCount</span>();
        <span class="hljs-type">int</span> nLinesPerPage = m_nPageHeight / <span class="hljs-number">20</span>; <span class="hljs-comment">// å‡è®¾æ¯è¡Œ20åƒç´ </span>
        
        pInfo-&gt;<span class="hljs-built_in">SetMaxPage</span>((nTotalLines + nLinesPerPage - <span class="hljs-number">1</span>) / nLinesPerPage);
        
        <span class="hljs-comment">// åˆ›å»ºæ‰“å°å­—ä½“</span>
        LOGFONT lfPrint = {<span class="hljs-number">0</span>};
        lfPrint.lfHeight = <span class="hljs-number">-15</span>; <span class="hljs-comment">// æ‰“å°å­—ä½“ç¨å°</span>
        lfPrint.lfWeight = FW_NORMAL;
        <span class="hljs-built_in">lstrcpy</span>(lfPrint.lfFaceName, _T(<span class="hljs-string">"å®‹ä½“"</span>));
        m_fontPrint.<span class="hljs-built_in">CreateFontIndirect</span>(&amp;lfPrint);
    }
    
    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">void</span> <span class="hljs-title">OnPrint</span><span class="hljs-params">(CDC* pDC, CPrintInfo* pInfo)</span>
    </span>{
        m_nCurPage = pInfo-&gt;m_nCurPage;
        
        <span class="hljs-comment">// è®¾ç½®æ˜ å°„æ¨¡å¼</span>
        pDC-&gt;<span class="hljs-built_in">SetMapMode</span>(MM_TEXT);
        
        <span class="hljs-comment">// è®¾ç½®å­—ä½“</span>
        CFont* pOldFont = pDC-&gt;<span class="hljs-built_in">SelectObject</span>(&amp;m_fontPrint);
        
        <span class="hljs-comment">// æ‰“å°é¡µçœ‰</span>
        <span class="hljs-built_in">PrintHeader</span>(pDC);
        
        <span class="hljs-comment">// æ‰“å°å†…å®¹</span>
        <span class="hljs-built_in">PrintPageContent</span>(pDC, pInfo-&gt;m_nCurPage);
        
        <span class="hljs-comment">// æ‰“å°é¡µè„š</span>
        <span class="hljs-built_in">PrintFooter</span>(pDC);
        
        pDC-&gt;<span class="hljs-built_in">SelectObject</span>(pOldFont);
    }
    
    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">void</span> <span class="hljs-title">OnEndPrinting</span><span class="hljs-params">(CDC* <span class="hljs-comment">/*pDC*/</span>, CPrintInfo* <span class="hljs-comment">/*pInfo*/</span>)</span>
    </span>{
        <span class="hljs-comment">// æ¸…ç†æ‰“å°èµ„æº</span>
        m_fontPrint.<span class="hljs-built_in">DeleteObject</span>();
    }
    
<span class="hljs-keyword">protected</span>:
    CFont m_fontPrint;
    
    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">PrintHeader</span><span class="hljs-params">(CDC* pDC)</span>
    </span>{
        CString strHeader;
        strHeader.<span class="hljs-built_in">Format</span>(_T(<span class="hljs-string">"ç¬¬ %d é¡µ"</span>), m_nCurPage);
        
        pDC-&gt;<span class="hljs-built_in">TextOut</span>(<span class="hljs-number">100</span>, <span class="hljs-number">50</span>, strHeader);
        
        <span class="hljs-comment">// ç»˜åˆ¶é¡µçœ‰çº¿</span>
        pDC-&gt;<span class="hljs-built_in">MoveTo</span>(<span class="hljs-number">50</span>, <span class="hljs-number">80</span>);
        pDC-&gt;<span class="hljs-built_in">LineTo</span>(m_nPageWidth - <span class="hljs-number">50</span>, <span class="hljs-number">80</span>);
    }
    
    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">PrintPageContent</span><span class="hljs-params">(CDC* pDC, <span class="hljs-type">int</span> nPage)</span>
    </span>{
        CMyDocument* pDoc = <span class="hljs-built_in">GetDocument</span>();
        
        <span class="hljs-comment">// è®¡ç®—æœ¬é¡µæ˜¾ç¤ºçš„è¡ŒèŒƒå›´</span>
        <span class="hljs-type">int</span> nLinesPerPage = (m_nPageHeight - <span class="hljs-number">150</span>) / <span class="hljs-number">20</span>; <span class="hljs-comment">// è€ƒè™‘é¡µçœ‰é¡µè„š</span>
        <span class="hljs-type">int</span> nStartLine = (nPage - <span class="hljs-number">1</span>) * nLinesPerPage;
        <span class="hljs-type">int</span> nEndLine = <span class="hljs-built_in">min</span>(nStartLine + nLinesPerPage, 
                          pDoc-&gt;<span class="hljs-built_in">GetLineCount</span>());
        
        <span class="hljs-comment">// é€è¡Œæ‰“å°</span>
        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = nStartLine; i &lt; nEndLine; i++)
        {
            <span class="hljs-type">int</span> y = <span class="hljs-number">100</span> + (i - nStartLine) * <span class="hljs-number">20</span>;
            pDC-&gt;<span class="hljs-built_in">TextOut</span>(<span class="hljs-number">100</span>, y, pDoc-&gt;<span class="hljs-built_in">GetLine</span>(i));
        }
    }
    
    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">PrintFooter</span><span class="hljs-params">(CDC* pDC)</span>
    </span>{
        CString strFooter = CTime::<span class="hljs-built_in">GetCurrentTime</span>().<span class="hljs-built_in">Format</span>(_T(<span class="hljs-string">"%Y-%m-%d %H:%M:%S"</span>));
        
        <span class="hljs-comment">// ç»˜åˆ¶é¡µè„šçº¿</span>
        pDC-&gt;<span class="hljs-built_in">MoveTo</span>(<span class="hljs-number">50</span>, m_nPageHeight - <span class="hljs-number">70</span>);
        pDC-&gt;<span class="hljs-built_in">LineTo</span>(m_nPageWidth - <span class="hljs-number">50</span>, m_nPageHeight - <span class="hljs-number">70</span>);
        
        <span class="hljs-comment">// æ‰“å°é¡µè„šæ–‡æœ¬</span>
        pDC-&gt;<span class="hljs-built_in">TextOut</span>(<span class="hljs-number">100</span>, m_nPageHeight - <span class="hljs-number">50</span>, strFooter);
    }
};
</code></pre>
<h3 data-id="heading-79">å…«ã€æ€§èƒ½ä¼˜åŒ–ä¸æœ€ä½³å®è·µ</h3>
<h4 data-id="heading-80">8.1 GDIèµ„æºæ³„æ¼æ£€æµ‹</h4>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-meta">#<span class="hljs-keyword">ifdef</span> _DEBUG</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">CGdiLeakDetector</span>
{
<span class="hljs-keyword">private</span>:
    <span class="hljs-type">static</span> <span class="hljs-type">int</span> m_nGdiObjectsStart;
    
<span class="hljs-keyword">public</span>:
    <span class="hljs-built_in">CGdiLeakDetector</span>()
    {
        <span class="hljs-comment">// è®°å½•åˆå§‹GDIå¯¹è±¡æ•°é‡</span>
        m_nGdiObjectsStart = <span class="hljs-built_in">GetGuiResources</span>(<span class="hljs-built_in">GetCurrentProcess</span>(), 
                                            GR_GDIOBJECTS);
    }
    
    ~<span class="hljs-built_in">CGdiLeakDetector</span>()
    {
        <span class="hljs-comment">// æ£€æŸ¥GDIå¯¹è±¡æ³„æ¼</span>
        <span class="hljs-type">int</span> nGdiObjectsEnd = <span class="hljs-built_in">GetGuiResources</span>(<span class="hljs-built_in">GetCurrentProcess</span>(), 
                                            GR_GDIOBJECTS);
        
        <span class="hljs-keyword">if</span> (nGdiObjectsEnd &gt; m_nGdiObjectsStart)
        {
            <span class="hljs-built_in">TRACE</span>(_T(<span class="hljs-string">"è­¦å‘Šï¼šæ£€æµ‹åˆ°å¯èƒ½çš„GDIå¯¹è±¡æ³„æ¼ã€‚\n"</span>));
            <span class="hljs-built_in">TRACE</span>(_T(<span class="hljs-string">"åˆå§‹: %d, ç»“æŸ: %d, æ³„æ¼: %d\n"</span>), 
                  m_nGdiObjectsStart, nGdiObjectsEnd,
                  nGdiObjectsEnd - m_nGdiObjectsStart);
            
            <span class="hljs-comment">// åœ¨è°ƒè¯•æ—¶è§¦å‘æ–­ç‚¹</span>
            <span class="hljs-keyword">if</span> (<span class="hljs-built_in">IsDebuggerPresent</span>())
            {
                <span class="hljs-built_in">DebugBreak</span>();
            }
        }
    }
};

<span class="hljs-comment">// åœ¨åº”ç”¨ç¨‹åºç±»ä¸­ä½¿ç”¨</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">CMyApp</span> : <span class="hljs-keyword">public</span> CWinApp
{
<span class="hljs-keyword">private</span>:
    CGdiLeakDetector m_gdiDetector;
    <span class="hljs-comment">// ...</span>
};
<span class="hljs-meta">#<span class="hljs-keyword">endif</span></span>
</code></pre>
<h4 data-id="heading-81">8.2 ç»˜å›¾ç¼“å­˜ä¸å¢é‡æ›´æ–°</h4>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-keyword">class</span> <span class="hljs-title class_">CDrawingCache</span>
{
<span class="hljs-keyword">private</span>:
    CBitmap m_bmpCache;        <span class="hljs-comment">// ç¼“å­˜ä½å›¾</span>
    CRect m_rectCache;         <span class="hljs-comment">// ç¼“å­˜åŒºåŸŸ</span>
    BOOL m_bCacheValid;        <span class="hljs-comment">// ç¼“å­˜æœ‰æ•ˆæ€§æ ‡å¿—</span>
    
<span class="hljs-keyword">public</span>:
    <span class="hljs-built_in">CDrawingCache</span>() : <span class="hljs-built_in">m_bCacheValid</span>(FALSE) {}
    
    <span class="hljs-comment">// æ›´æ–°ç¼“å­˜</span>
    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">UpdateCache</span><span class="hljs-params">(CDC* pDC, <span class="hljs-type">const</span> CRect&amp; rect)</span>
    </span>{
        <span class="hljs-keyword">if</span> (!m_bCacheValid || m_rectCache != rect)
        {
            <span class="hljs-comment">// åˆ›å»ºæˆ–é‡æ–°åˆ›å»ºç¼“å­˜ä½å›¾</span>
            <span class="hljs-keyword">if</span> (m_bmpCache.<span class="hljs-built_in">GetSafeHandle</span>() == <span class="hljs-literal">NULL</span> || 
                m_rectCache != rect)
            {
                m_bmpCache.<span class="hljs-built_in">DeleteObject</span>();
                m_bmpCache.<span class="hljs-built_in">CreateCompatibleBitmap</span>(pDC, 
                                                 rect.<span class="hljs-built_in">Width</span>(), 
                                                 rect.<span class="hljs-built_in">Height</span>());
                m_rectCache = rect;
            }
            
            <span class="hljs-comment">// ç»˜åˆ¶åˆ°ç¼“å­˜</span>
            CDC dcCache;
            dcCache.<span class="hljs-built_in">CreateCompatibleDC</span>(pDC);
            CBitmap* pOldBmp = dcCache.<span class="hljs-built_in">SelectObject</span>(&amp;m_bmpCache);
            
            <span class="hljs-comment">// ç»˜åˆ¶èƒŒæ™¯å’Œå†…å®¹åˆ°ç¼“å­˜</span>
            <span class="hljs-built_in">DrawToCache</span>(&amp;dcCache, rect);
            
            dcCache.<span class="hljs-built_in">SelectObject</span>(pOldBmp);
            m_bCacheValid = TRUE;
        }
    }
    
    <span class="hljs-comment">// ä»ç¼“å­˜ç»˜åˆ¶åˆ°å±å¹•</span>
    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">RenderFromCache</span><span class="hljs-params">(CDC* pDC, <span class="hljs-type">const</span> CPoint&amp; ptDest)</span>
    </span>{
        <span class="hljs-keyword">if</span> (m_bCacheValid)
        {
            CDC dcCache;
            dcCache.<span class="hljs-built_in">CreateCompatibleDC</span>(pDC);
            CBitmap* pOldBmp = dcCache.<span class="hljs-built_in">SelectObject</span>(&amp;m_bmpCache);
            
            pDC-&gt;<span class="hljs-built_in">BitBlt</span>(ptDest.x, ptDest.y, 
                       m_rectCache.<span class="hljs-built_in">Width</span>(), m_rectCache.<span class="hljs-built_in">Height</span>(),
                       &amp;dcCache, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, SRCCOPY);
            
            dcCache.<span class="hljs-built_in">SelectObject</span>(pOldBmp);
        }
    }
    
    <span class="hljs-comment">// ä½¿ç¼“å­˜å¤±æ•ˆ</span>
    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">InvalidateCache</span><span class="hljs-params">()</span>
    </span>{
        m_bCacheValid = FALSE;
    }
    
    <span class="hljs-comment">// éƒ¨åˆ†ç¼“å­˜å¤±æ•ˆ</span>
    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">InvalidateCacheRect</span><span class="hljs-params">(<span class="hljs-type">const</span> CRect&amp; rectInvalid)</span>
    </span>{
        <span class="hljs-keyword">if</span> (m_bCacheValid &amp;&amp; m_rectCache.<span class="hljs-built_in">IntersectRect</span>(&amp;rectInvalid))
        {
            <span class="hljs-comment">// åªé‡æ–°ç»˜åˆ¶å—å½±å“çš„éƒ¨åˆ†</span>
            CDC dcCache;
            <span class="hljs-function">CClientDC <span class="hljs-title">dcScreen</span><span class="hljs-params">(<span class="hljs-literal">NULL</span>)</span></span>;
            dcCache.<span class="hljs-built_in">CreateCompatibleDC</span>(&amp;dcScreen);
            CBitmap* pOldBmp = dcCache.<span class="hljs-built_in">SelectObject</span>(&amp;m_bmpCache);
            
            <span class="hljs-comment">// æ¸…é™¤å—å½±å“åŒºåŸŸ</span>
            <span class="hljs-function">CBrush <span class="hljs-title">brushBg</span><span class="hljs-params">(RGB(<span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">255</span>))</span></span>;
            dcCache.<span class="hljs-built_in">FillRect</span>(&amp;rectInvalid, &amp;brushBg);
            
            <span class="hljs-comment">// é‡æ–°ç»˜åˆ¶å—å½±å“åŒºåŸŸ</span>
            <span class="hljs-built_in">RedrawInvalidArea</span>(&amp;dcCache, rectInvalid);
            
            dcCache.<span class="hljs-built_in">SelectObject</span>(pOldBmp);
        }
    }
    
<span class="hljs-keyword">protected</span>:
    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">void</span> <span class="hljs-title">DrawToCache</span><span class="hljs-params">(CDC* pDC, <span class="hljs-type">const</span> CRect&amp; rect)</span> </span>= <span class="hljs-number">0</span>;
    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">void</span> <span class="hljs-title">RedrawInvalidArea</span><span class="hljs-params">(CDC* pDC, <span class="hljs-type">const</span> CRect&amp; rect)</span> </span>= <span class="hljs-number">0</span>;
};
</code></pre>
<h3 data-id="heading-82">ä¹ã€ä¸ç°ä»£å›¾å½¢APIçš„å¯¹æ¯”</h3>
<p>è™½ç„¶GDIå·²ç»é€æ¸è¢«Direct2Dã€DirectWriteç­‰ç°ä»£å›¾å½¢APIå–ä»£ï¼Œä½†ç†è§£GDIçš„è®¾è®¡ä»æœ‰ä»·å€¼ï¼š</p>
<ol>
<li><strong>è®¾å¤‡æŠ½è±¡å±‚</strong>ï¼šGDIçš„è®¾å¤‡ä¸Šä¸‹æ–‡æ¦‚å¿µå½±å“äº†åç»­APIçš„è®¾è®¡</li>
<li><strong>èµ„æºç®¡ç†æ¨¡å‹</strong>ï¼šGDIå¯¹è±¡çš„åˆ›å»º/é€‰æ‹©/åˆ é™¤æ¨¡å¼ä¸ºåæ¥çš„èµ„æºç®¡ç†æä¾›äº†å‚è€ƒ</li>
<li><strong>åæ ‡ç³»ç»Ÿ</strong>ï¼šGDIçš„æ˜ å°„æ¨¡å¼ä¸ºå›¾å½¢å˜æ¢å¥ å®šäº†åŸºç¡€</li>
</ol>
<p><strong>è¿ç§»ç­–ç•¥</strong>ï¼š</p>
<ul>
<li>å¯¹äºæ–°é¡¹ç›®ï¼Œæ¨èä½¿ç”¨Direct2D/DirectWriteæˆ–è·¨å¹³å°å›¾å½¢åº“</li>
<li>å¯¹äºç°æœ‰MFCé¡¹ç›®ï¼Œå¯é€æ­¥æ›¿æ¢ç»˜å›¾ä»£ç ï¼ŒåŒæ—¶ä¿ç•™ä¸šåŠ¡é€»è¾‘</li>
<li>GDIä»é€‚ç”¨äºç®€å•çš„UIç»˜åˆ¶å’Œæ‰“å°åŠŸèƒ½</li>
</ul>
<p>MFCçš„GDIç¼–ç¨‹ä»£è¡¨äº†Windowså›¾å½¢ç¼–ç¨‹çš„ä¸€ä¸ªæ—¶ä»£ï¼Œè™½ç„¶æŠ€æœ¯å·²ç»æ¼”è¿›ï¼Œä½†å…¶è®¾è®¡æ€æƒ³å’Œé—®é¢˜è§£å†³æ–¹æ¡ˆä»å¯¹ç†è§£è®¡ç®—æœºå›¾å½¢å­¦åŸºæœ¬åŸç†æœ‰é‡è¦ä»·å€¼ã€‚æŒæ¡GDIä¸ä»…æœ‰åŠ©äºç»´æŠ¤é—ç•™ä»£ç ï¼Œæ›´èƒ½æ·±åˆ»ç†è§£å›¾å½¢ç³»ç»Ÿçš„å·¥ä½œæœºåˆ¶ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[RebbitMQ å…¥é—¨æ•™ç¨‹çœ‹è¿™ä¸€ç¯‡å°±å¤Ÿäº†]]></title>    <link>https://juejin.cn/post/7580378958073069578</link>    <guid>https://juejin.cn/post/7580378958073069578</guid>    <pubDate>2025-12-07T07:33:28.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7580378958073069578" data-draft-id="7572972346073464859" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="RebbitMQ å…¥é—¨æ•™ç¨‹çœ‹è¿™ä¸€ç¯‡å°±å¤Ÿäº†"/> <meta itemprop="keywords" content="åç«¯,Java,RabbitMQ"/> <meta itemprop="datePublished" content="2025-12-07T07:33:28.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="åˆ˜å¤§å"/> <meta itemprop="url" content="https://juejin.cn/user/3507878440995946"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            RebbitMQ å…¥é—¨æ•™ç¨‹çœ‹è¿™ä¸€ç¯‡å°±å¤Ÿäº†
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3507878440995946/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    åˆ˜å¤§å
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-07T07:33:28.000Z" title="Sun Dec 07 2025 07:33:28 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-07
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»6åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>å¤§å®¶å¥½ï¼ä»Šå¤©æˆ‘ä»¬æ¥è®²ä¸€ä¸ªåœ¨åç«¯å¼€å‘ä¸­éå¸¸é‡è¦çš„ä¸­é—´ä»¶<strong>RabbitMQ</strong>ã€‚</p>
<p>ä¸ç®¡ä½ æ˜¯åˆšæ¥è§¦æ¶ˆæ¯é˜Ÿåˆ—çš„æ–°æ‰‹ï¼Œè¿˜æ˜¯æƒ³å·©å›ºåŸºç¡€çš„å¼€å‘è€…ï¼Œè¿™ç¯‡æ–‡ç« éƒ½ä¼šå¸®ä½ è½»æ¾ç†è§£ RabbitMQ çš„æ ¸å¿ƒæ¦‚å¿µã€ä½¿ç”¨æ–¹æ³•å’Œé€‚ç”¨åœºæ™¯ã€‚</p>
<hr/>
<h3 data-id="heading-0">ä¸ºä»€ä¹ˆéœ€è¦æ¶ˆæ¯é˜Ÿåˆ—ï¼Ÿ</h3>
<p>æƒ³è±¡è¿™æ ·ä¸€ä¸ªç”µå•†ä¸‹å•æµç¨‹ï¼š</p>
<ol>
<li>ç”¨æˆ·æäº¤è®¢å•ï¼›</li>
<li>ç³»ç»Ÿä¿å­˜è®¢å•ï¼›</li>
<li>æ‰£å‡åº“å­˜ï¼›</li>
<li>å‘é€ç¡®è®¤é‚®ä»¶ï¼›</li>
<li>è®°å½•æ“ä½œæ—¥å¿—â€¦â€¦</li>
</ol>
<p>å¦‚æœè¿™äº›æ­¥éª¤éƒ½åœ¨åŒä¸€ä¸ªäº‹åŠ¡é‡ŒåŒæ­¥æ‰§è¡Œï¼Œä¸€æ—¦æŸä¸ªç¯èŠ‚ï¼ˆæ¯”å¦‚é‚®ä»¶æœåŠ¡ï¼‰å“åº”æ…¢æˆ–å®•æœºï¼Œæ•´ä¸ªä¸‹å•æµç¨‹å°±ä¼šå¡ä½ï¼Œç”šè‡³å¤±è´¥ã€‚</p>
<p>äºæ˜¯å¾ˆå¤šäººä¼šæƒ³åˆ°ï¼šç”¨ Spring çš„ <code>@Async</code> å¼‚æ­¥å¤„ç†ä¸å°±è¡Œäº†ï¼Ÿ</p>
<h4 data-id="heading-1">ä½¿ç”¨ <code>@Async</code> çš„å†™æ³•</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Transactional</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">createOrder</span><span class="hljs-params">(Order order)</span> {
    orderRepository.save(order); <span class="hljs-comment">// æ ¸å¿ƒä¸šåŠ¡</span>
    inventoryService.asyncDeductStock(order); <span class="hljs-comment">// å¼‚æ­¥æ‰£åº“å­˜</span>
    emailService.asyncSendConfirmationEmail(order); <span class="hljs-comment">// å¼‚æ­¥å‘é‚®ä»¶</span>
}

<span class="hljs-meta">@Async</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">asyncDeductStock</span><span class="hljs-params">(Order order)</span> {
    <span class="hljs-comment">// æ‰£åº“å­˜é€»è¾‘</span>
}
</code></pre>
<p><strong>ä½†é—®é¢˜æ¥äº†ï¼š</strong></p>
<ul>
<li><strong>ä»»åŠ¡å¯èƒ½ä¸¢å¤±</strong>ï¼šå¦‚æœåº”ç”¨é‡å¯ï¼Œæ­£åœ¨å¼‚æ­¥æ‰§è¡Œçš„ä»»åŠ¡å°±æ²¡äº†ï¼›</li>
<li><strong>æ— æ³•è·¨æœåŠ¡</strong>ï¼š<code>@Async</code> åªèƒ½åœ¨å½“å‰ JVM å†…ç”Ÿæ•ˆï¼Œæ— æ³•é€šçŸ¥å…¶ä»–å¾®æœåŠ¡ï¼›</li>
<li><strong>ç¼ºä¹é‡è¯•ä¸ç›‘æ§</strong>ï¼šå¤±è´¥äº†æ€ä¹ˆåŠï¼Ÿæ²¡äººçŸ¥é“ï¼Œä¹Ÿæ²¡æ³•è‡ªåŠ¨é‡è¯•ï¼›</li>
<li><strong>æµé‡æ— æ³•ç¼“å†²</strong>ï¼šå¤§ä¿ƒæ—¶ç¬æ—¶é«˜å¹¶å‘ï¼Œç›´æ¥å‹å®ä¸‹æ¸¸æœåŠ¡ã€‚</li>
</ul>
<p><code>@Async</code> é€‚åˆè½»é‡çº§ã€éå…³é”®ã€åŒæœåŠ¡å†…çš„å¼‚æ­¥ä»»åŠ¡ï¼›è€Œ<strong>è·¨æœåŠ¡ã€é«˜å¯é ã€éœ€è§£è€¦çš„åœºæ™¯ï¼Œå¿…é¡»å¼•å…¥æ¶ˆæ¯é˜Ÿåˆ—</strong>ã€‚</p>
<hr/>
<h3 data-id="heading-2">ä»€ä¹ˆæ˜¯ RabbitMQï¼Ÿ</h3>
<p>RabbitMQ æ˜¯ä¸€ä¸ªå¼€æºçš„<strong>æ¶ˆæ¯ä¸­é—´ä»¶ï¼ˆMessage Brokerï¼‰</strong>ï¼Œæ ¸å¿ƒä½œç”¨æ˜¯åœ¨ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…ä¹‹é—´å®‰å…¨ã€å¯é åœ°ä¼ é€’æ¶ˆæ¯ã€‚</p>
<p>ä½ å¯ä»¥æŠŠå®ƒæƒ³è±¡æˆä¸€ä¸ªæ™ºèƒ½å¿«é€’ï¼š</p>
<ul>
<li><strong>ç”Ÿäº§è€…ï¼ˆProducerï¼‰</strong>ï¼šä¸‹å•æˆåŠŸåï¼ŒæŠŠâ€œè®¢å•å·²åˆ›å»ºâ€è¿™ä¸ªäº‹ä»¶æ‰“åŒ…æˆæ¶ˆæ¯ï¼ŒæŠ•é€’åˆ° RabbitMQï¼›</li>
<li><strong>RabbitMQ</strong>ï¼šæš‚å­˜æ¶ˆæ¯ï¼Œç¡®ä¿ä¸ä¸¢å¤±ï¼›</li>
<li><strong>æ¶ˆè´¹è€…ï¼ˆConsumerï¼‰</strong>ï¼šåº“å­˜æœåŠ¡ã€é‚®ä»¶æœåŠ¡å„è‡ªç›‘å¬é˜Ÿåˆ—ï¼ŒæŒ‰éœ€å–èµ°æ¶ˆæ¯å¤„ç†ã€‚</li>
</ul>
<p>å³ä½¿åº“å­˜æœåŠ¡æš‚æ—¶å®•æœºï¼Œæ¶ˆæ¯ä¹Ÿä¼šä¸€ç›´ç•™åœ¨é˜Ÿåˆ—é‡Œï¼Œç­‰å®ƒæ¢å¤åå†æ¶ˆè´¹â€”â€”<strong>æœ€ç»ˆä¸€è‡´æ€§</strong>ç”±æ­¤ä¿éšœã€‚</p>
<hr/>
<h3 data-id="heading-3">RabbitMQ vs @Asyncï¼šå…³é”®å¯¹æ¯”</h3>








































<table><thead><tr><th>ç»´åº¦</th><th><code>@Async</code></th><th>RabbitMQ</th></tr></thead><tbody><tr><td><strong>ä½œç”¨èŒƒå›´</strong></td><td>åŒä¸€åº”ç”¨å†…</td><td>è·¨åº”ç”¨ã€è·¨æœåŠ¡</td></tr><tr><td><strong>å¯é æ€§</strong></td><td>ä½ï¼ˆJVM é‡å¯å³ä¸¢ï¼‰</td><td>é«˜ï¼ˆæ”¯æŒæŒä¹…åŒ–ã€ACKã€é‡è¯•ï¼‰</td></tr><tr><td><strong>è§£è€¦èƒ½åŠ›</strong></td><td>å¼±ï¼ˆä»ä¾èµ–æœ¬åœ°æ–¹æ³•è°ƒç”¨ï¼‰</td><td>å¼ºï¼ˆå®Œå…¨é€šè¿‡æ¶ˆæ¯é€šä¿¡ï¼‰</td></tr><tr><td><strong>æµé‡å‰Šå³°</strong></td><td>ä¸æ”¯æŒ</td><td>æ”¯æŒï¼ˆé˜Ÿåˆ—ç¼“å†²è¯·æ±‚ï¼‰</td></tr><tr><td><strong>å¯è§‚æµ‹æ€§</strong></td><td>å·®</td><td>å¥½ï¼ˆå¯é€šè¿‡ç®¡ç†ç•Œé¢ç›‘æ§ç§¯å‹ï¼‰</td></tr><tr><td><strong>é€‚ç”¨åœºæ™¯</strong></td><td>æ—¥å¿—è®°å½•ã€ç¼“å­˜æ›´æ–°ç­‰éå…³é”®ä»»åŠ¡</td><td>è®¢å•å¤„ç†ã€æ”¯ä»˜å›è°ƒã€å¼‚æ­¥é€šçŸ¥ç­‰å…³é”®é“¾è·¯</td></tr></tbody></table>
<p><strong>æœ€ä½³å®è·µ</strong>ï¼š</p>
<ul>
<li>ä¸¤è€…ä¸æ˜¯äº’æ–¥ï¼Œè€Œæ˜¯äº’è¡¥ã€‚</li>
<li>åº”ç”¨å†…éƒ¨è½»é‡å¼‚æ­¥ â†’ <code>@Async</code></li>
<li>è·¨æœåŠ¡å…³é”®å¼‚æ­¥ â†’ RabbitMQ</li>
</ul>
<h3 data-id="heading-4">RabbitMQ æ ¸å¿ƒæ¦‚å¿µ</h3>
<p>ç†è§£è¿™äº›åŸºç¡€æ¦‚å¿µæ˜¯æŒæ¡ RabbitMQ çš„å…³é”®ï¼š</p>
<p><strong>1. Producerï¼ˆç”Ÿäº§è€…ï¼‰</strong>ï¼šæ¶ˆæ¯çš„å‘é€æ–¹
<strong>2. Consumerï¼ˆæ¶ˆè´¹è€…ï¼‰</strong>ï¼šæ¶ˆæ¯çš„æ¥æ”¶å’Œå¤„ç†æ–¹<br/>
<strong>3. Queueï¼ˆé˜Ÿåˆ—ï¼‰</strong>ï¼šæ¶ˆæ¯çš„å­˜å‚¨å®¹å™¨ï¼Œå…ˆè¿›å…ˆå‡º
<strong>4. Exchangeï¼ˆäº¤æ¢æœºï¼‰</strong>ï¼šæ¥æ”¶æ¶ˆæ¯å¹¶æ ¹æ®è§„åˆ™è·¯ç”±åˆ°é˜Ÿåˆ—
<strong>5. Bindingï¼ˆç»‘å®šï¼‰</strong>ï¼šè¿æ¥äº¤æ¢æœºå’Œé˜Ÿåˆ—çš„è§„åˆ™</p>
<p><strong>å·¥ä½œæµç¨‹</strong>ï¼š</p>
<ol>
<li>ç”Ÿäº§è€…å‘é€æ¶ˆæ¯åˆ° Exchange</li>
<li>Exchange æ ¹æ® Binding è§„åˆ™å°†æ¶ˆæ¯è·¯ç”±åˆ° Queue</li>
<li>æ¶ˆè´¹è€…ä» Queue è·å–å¹¶å¤„ç†æ¶ˆæ¯</li>
<li>å¤„ç†æˆåŠŸåç¡®è®¤æ¶ˆæ¯åˆ é™¤</li>
</ol>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/959f9844aae7499ab1cb47e5f0211944~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YiY5aSn5Y2O:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765697608&amp;x-signature=zdhKFaMlvduGpLwK9uvNn5Qq1Ow%3D" alt="" loading="lazy"/></p>
<hr/>
<h3 data-id="heading-5">å…¸å‹ä½¿ç”¨åœºæ™¯</h3>
<p><strong>å¼‚æ­¥å¤„ç†</strong>ï¼šç”¨æˆ·æ³¨å†Œåå‘é€éªŒè¯é‚®ä»¶ï¼Œæ— éœ€ç­‰å¾…é‚®ä»¶å‘é€å®Œæˆ
<strong>åº”ç”¨è§£è€¦</strong>ï¼šè®¢å•ç³»ç»Ÿä¸ç‰©æµç³»ç»Ÿé€šè¿‡æ¶ˆæ¯é€šä¿¡ï¼Œäº’ä¸å½±å“
<strong>æµé‡å‰Šå³°</strong>ï¼šç§’æ€æ´»åŠ¨æ—¶ï¼Œè¯·æ±‚å…ˆè¿›å…¥é˜Ÿåˆ—ï¼Œåç«¯å¹³ç¨³å¤„ç†
<strong>æ—¥å¿—æ”¶é›†</strong>ï¼šå¤šä¸ªæœåŠ¡å°†æ—¥å¿—å‘é€åˆ°é˜Ÿåˆ—ï¼Œç»Ÿä¸€å¤„ç†åˆ†æ</p>
<hr/>
<h3 data-id="heading-6">Spring Boot ç¤ºä¾‹</h3>
<p>è®©æˆ‘ä»¬é€šè¿‡ä¸¤ä¸ªå®é™…åœºæ™¯æ¥å­¦ä¹  RabbitMQ çš„ä½¿ç”¨ã€‚</p>
<h4 data-id="heading-7">åœºæ™¯ä¸€ï¼šåŸºç¡€æ¶ˆæ¯æ”¶å‘</h4>
<p><strong>1. æ·»åŠ ä¾èµ–</strong></p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-amqp<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
</code></pre>
<p><strong>2. é…ç½®è¿æ¥</strong></p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">spring:</span>
  <span class="hljs-attr">rabbitmq:</span>
    <span class="hljs-attr">host:</span> <span class="hljs-string">localhost</span>
    <span class="hljs-attr">port:</span> <span class="hljs-number">5672</span>
    <span class="hljs-attr">username:</span> <span class="hljs-string">guest</span>
    <span class="hljs-attr">password:</span> <span class="hljs-string">guest</span>
</code></pre>
<p><strong>3. å®šä¹‰é˜Ÿåˆ—</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Configuration</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RabbitConfig</span> {
    <span class="hljs-meta">@Bean</span>
    <span class="hljs-keyword">public</span> Queue <span class="hljs-title function_">helloQueue</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Queue</span>(<span class="hljs-string">"hello.queue"</span>, <span class="hljs-literal">true</span>); <span class="hljs-comment">// æŒä¹…åŒ–é˜Ÿåˆ—</span>
    }
}
</code></pre>
<p><strong>4. å‘é€æ¶ˆæ¯</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@RestController</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MessageController</span> {
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> RabbitTemplate rabbitTemplate;

    <span class="hljs-meta">@GetMapping("/send")</span>
    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">sendMessage</span><span class="hljs-params">()</span> {
        rabbitTemplate.convertAndSend(<span class="hljs-string">"hello.queue"</span>, <span class="hljs-string">"Hello, RabbitMQ!"</span>);
        <span class="hljs-keyword">return</span> <span class="hljs-string">"æ¶ˆæ¯å‘é€æˆåŠŸ"</span>;
    }
}
</code></pre>
<p><strong>5. æ¥æ”¶æ¶ˆæ¯</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Component</span>
<span class="hljs-meta">@Slf4j</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MessageConsumer</span> {
    <span class="hljs-meta">@RabbitListener(queues = "hello.queue")</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">receiveMessage</span><span class="hljs-params">(String message)</span> {
        log.info(<span class="hljs-string">"æ”¶åˆ°æ¶ˆæ¯: {}"</span>, message);
    }
}
</code></pre>
<h4 data-id="heading-8">åœºæ™¯äºŒï¼šå·¥ä½œé˜Ÿåˆ—æ¨¡å¼ - æ‰¹é‡ä»»åŠ¡å¤„ç†</h4>
<p>å‡è®¾æˆ‘ä»¬éœ€è¦å¤„ç†ä¸¤ç§å¼‚æ­¥ä»»åŠ¡ï¼š</p>
<ul>
<li>æ‰¹é‡æ›´æ–°ç”¨æˆ·ä¿¡æ¯</li>
<li>æ‰¹é‡æ›´æ–°æ–‡ç« å¤‡æ³¨</li>
</ul>
<p><strong>1. ä»»åŠ¡é˜Ÿåˆ—é…ç½®</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Configuration</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TaskQueueConfig</span> {
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">USER_BATCH_QUEUE</span> <span class="hljs-operator">=</span> <span class="hljs-string">"user.batch.update.queue"</span>;
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">ARTICLE_REMARK_QUEUE</span> <span class="hljs-operator">=</span> <span class="hljs-string">"article.remark.update.queue"</span>;

    <span class="hljs-meta">@Bean</span>
    <span class="hljs-keyword">public</span> Queue <span class="hljs-title function_">userBatchQueue</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> QueueBuilder.durable(USER_BATCH_QUEUE).build();
    }

    <span class="hljs-meta">@Bean</span>
    <span class="hljs-keyword">public</span> Queue <span class="hljs-title function_">articleRemarkQueue</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> QueueBuilder.durable(ARTICLE_REMARK_QUEUE).build();
    }
}
</code></pre>
<p>ä½¿ç”¨ <code>QueueBuilder</code> æ›´æ¸…æ™°ï¼Œä¸”é»˜è®¤å¼€å¯æŒä¹…åŒ–ã€‚</p>
<p><strong>2. æ¶ˆæ¯ç”Ÿäº§è€…</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TaskProducer</span> {

    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> RabbitTemplate rabbitTemplate;

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">sendUserBatchUpdate</span><span class="hljs-params">(List&lt;Long&gt; userIds)</span> {
        rabbitTemplate.convertAndSend(TaskQueueConfig.USER_BATCH_QUEUE, userIds);
        log.info(<span class="hljs-string">"æäº¤æ‰¹é‡ç”¨æˆ·æ›´æ–°ä»»åŠ¡ï¼Œå…± {} äºº"</span>, userIds.size());
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">sendArticleRemarkUpdate</span><span class="hljs-params">(Long articleId, String remark)</span> {
        <span class="hljs-type">var</span> <span class="hljs-variable">dto</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArticleRemarkDTO</span>(articleId, remark);
        rabbitTemplate.convertAndSend(TaskQueueConfig.ARTICLE_REMARK_QUEUE, dto);
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">sendBatchRemarks</span><span class="hljs-params">(Map&lt;Long, String&gt; map)</span> {
        map.forEach(<span class="hljs-built_in">this</span>::sendArticleRemarkUpdate);
    }
}
</code></pre>
<p><strong>3. æ¶ˆæ¯æ¶ˆè´¹è€…</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Component</span>
<span class="hljs-meta">@Slf4j</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TaskConsumer</span> {

    <span class="hljs-meta">@RabbitListener(queues = TaskQueueConfig.USER_BATCH_QUEUE)</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">handleUserBatch</span><span class="hljs-params">(List&lt;Long&gt; userIds)</span> {
        <span class="hljs-keyword">try</span> {
            userService.batchUpdate(userIds);
            log.info(<span class="hljs-string">"æ‰¹é‡æ›´æ–° {} ç”¨æˆ·å®Œæˆ"</span>, userIds.size());
        } <span class="hljs-keyword">catch</span> (Exception e) {
            log.error(<span class="hljs-string">"æ‰¹é‡æ›´æ–°å¤±è´¥"</span>, e);
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(e); <span class="hljs-comment">// è§¦å‘é‡è¯•ï¼ˆéœ€é…ç½®ï¼‰</span>
        }
    }

    <span class="hljs-meta">@RabbitListener(queues = TaskQueueConfig.ARTICLE_REMARK_QUEUE)</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">handleArticleRemark</span><span class="hljs-params">(ArticleRemarkDTO dto)</span> {
        <span class="hljs-keyword">try</span> {
            articleService.updateRemark(dto.getArticleId(), dto.getRemark());
            log.info(<span class="hljs-string">"æ›´æ–°æ–‡ç« [{}]å¤‡æ³¨æˆåŠŸ"</span>, dto.getArticleId());
        } <span class="hljs-keyword">catch</span> (Exception e) {
            log.error(<span class="hljs-string">"æ›´æ–°æ–‡ç« å¤‡æ³¨å¤±è´¥"</span>, e);
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(e);
        }
    }
}
</code></pre>
<p><strong>è¿™é‡Œä¸ºä»€ä¹ˆæ–‡ç« å¤‡æ³¨è¦é€ä¸ªå‘ï¼Ÿ</strong>
å› ä¸ºå•æ¡æ¶ˆæ¯å¤±è´¥åªå½±å“ä¸€æ¡æ•°æ®ï¼Œä¾¿äºé‡è¯•å’Œæ’æŸ¥ï¼›è€Œæ‰¹é‡æ¶ˆæ¯ä¸€æ—¦å¤±è´¥ï¼Œæ•´æ‰¹å›æ»šæˆæœ¬é«˜ã€‚å…·ä½“å¯ä»¥æ ¹æ®å®é™…æƒ…å†µä½¿ç”¨ä¸åŒçš„æ–¹æ¡ˆã€‚</p>
<hr/>
<h3 data-id="heading-9">ç”Ÿäº§ç¯å¢ƒå»ºè®®</h3>
<p><strong>1. æ¶ˆæ¯æŒä¹…åŒ–</strong>ï¼šç¡®ä¿ RabbitMQ é‡å¯åæ¶ˆæ¯ä¸ä¸¢å¤±
<strong>2. æ‰‹åŠ¨ç¡®è®¤æœºåˆ¶</strong>ï¼šé˜²æ­¢æ¶ˆæ¯å¤„ç†å¤±è´¥åä¸¢å¤±</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">spring:</span>
  <span class="hljs-attr">rabbitmq:</span>
    <span class="hljs-attr">listener:</span>
      <span class="hljs-attr">simple:</span>
        <span class="hljs-attr">acknowledge-mode:</span> <span class="hljs-string">manual</span>
</code></pre>
<p><strong>3. æ­»ä¿¡é˜Ÿåˆ—</strong>ï¼šå¤„ç†å¤šæ¬¡é‡è¯•ä»å¤±è´¥çš„æ¶ˆæ¯
<strong>4. æ¶ˆè´¹è€…é™æµ</strong>ï¼šè®¾ç½®åˆé€‚çš„ prefetch count é˜²æ­¢æ¶ˆè´¹è€…è¿‡è½½
<strong>5. ç›‘æ§å‘Šè­¦</strong>ï¼šç›‘æ§é˜Ÿåˆ—ç§¯å‹æƒ…å†µï¼ŒåŠæ—¶å‘ç°é—®é¢˜</p>
<hr/>
<h3 data-id="heading-10">æ€»ç»“</h3>
<p>RabbitMQ ä½œä¸ºæˆç†Ÿçš„æ¶ˆæ¯é˜Ÿåˆ—ä¸­é—´ä»¶ï¼Œåœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­å‘æŒ¥ç€é‡è¦ä½œç”¨ï¼š</p>
<p><strong>æ ¸å¿ƒä»·å€¼</strong>ï¼š</p>
<ul>
<li><strong>ç³»ç»Ÿè§£è€¦</strong>ï¼šæœåŠ¡é—´é€šè¿‡æ¶ˆæ¯é€šä¿¡ï¼Œç‹¬ç«‹æ¼”åŒ–</li>
<li><strong>å¯é ä¼ é€’</strong>ï¼šæ¶ˆæ¯æŒä¹…åŒ–ï¼Œç¡®ä¿ä¸ä¸¢å¤±</li>
<li><strong>å¼¹æ€§æ‰©å±•</strong>ï¼šæ¶ˆè´¹è€…å¯æ°´å¹³æ‰©å±•åº”å¯¹æµé‡æ³¢åŠ¨</li>
<li><strong>æµé‡å‰Šå³°</strong>ï¼šå¹³æ»‘çªå‘æµé‡ï¼Œä¿æŠ¤åç«¯ç³»ç»Ÿ</li>
<li><strong>æœ€ç»ˆä¸€è‡´æ€§</strong>ï¼šä¿è¯åˆ†å¸ƒå¼ç³»ç»Ÿæ•°æ®ä¸€è‡´æ€§</li>
</ul>
<p><strong>é€‚ç”¨åœºæ™¯</strong>ï¼šå¾®æœåŠ¡æ¶æ„ã€å¼‚æ­¥ä»»åŠ¡å¤„ç†ã€ç³»ç»Ÿé›†æˆã€æ•°æ®åŒæ­¥ç­‰ã€‚</p>
<p>æŒæ¡ RabbitMQ å°†æå¤§æå‡ä½ è®¾è®¡å’Œå¼€å‘åˆ†å¸ƒå¼ç³»ç»Ÿçš„èƒ½åŠ›ã€‚å¸Œæœ›è¿™ç¯‡æ–‡ç« èƒ½å¸®åŠ©ä½ æ·±å…¥ç†è§£å¹¶ç†Ÿç»ƒè¿ç”¨è¿™ä¸ªå¼ºå¤§çš„å·¥å…·ï¼</p>
<p>å…¶å®ƒæ¨¡å¼çš„ä½¿ç”¨æ–¹å¼ï¼Œæˆ‘ä»¬å°†åœ¨ä¸‹ä¸€ç¯‡æ–‡ç« ç»™å‡ºå®Œæ•´çš„ç¤ºä¾‹ã€‚</p>
<blockquote>
<p>æœ¬æ–‡é¦–å‘äºå…¬ä¼—å·ï¼šç¨‹åºå‘˜åˆ˜å¤§åï¼Œä¸“æ³¨åˆ†äº«å‰åç«¯å¼€å‘çš„å®æˆ˜ç¬”è®°ã€‚å…³æ³¨æˆ‘ï¼Œå°‘èµ°å¼¯è·¯ï¼Œä¸€èµ·è¿›æ­¥ï¼</p>
</blockquote>
<h4 data-id="heading-11">ğŸ“Œå¾€æœŸç²¾å½©</h4>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2F6V83qjR6u0nyfzL-14xYAw" target="_blank" title="https://mp.weixin.qq.com/s/6V83qjR6u0nyfzL-14xYAw" ref="nofollow noopener noreferrer">ã€Šasync/await åˆ°åº•è¦ä¸è¦åŠ  try-catchï¼Ÿå¼‚æ­¥é”™è¯¯å¤„ç†æœ€ä½³å®è·µã€‹</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FPQ_w7CDVoIZPn-CVH2DKJg" target="_blank" title="https://mp.weixin.qq.com/s/PQ_w7CDVoIZPn-CVH2DKJg" ref="nofollow noopener noreferrer">ã€ŠVue3 å’Œ Vue2 çš„æ ¸å¿ƒåŒºåˆ«ï¼Ÿå¾ˆå¤šå¼€å‘è€…éƒ½æ²¡å®Œå…¨ææ‡‚çš„ 10 ä¸ªç»†èŠ‚ã€‹</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2Fp0n2mN5RDDDaIWuHHVRUZQ" target="_blank" title="https://mp.weixin.qq.com/s/p0n2mN5RDDDaIWuHHVRUZQ" ref="nofollow noopener noreferrer">ã€ŠJava å¼€å‘å¿…çœ‹ï¼šä»€ä¹ˆæ—¶å€™ç”¨ forï¼Œä»€ä¹ˆæ—¶å€™ç”¨ Streamï¼Ÿã€‹</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FqI3TRTdDfRJSH9kCTqAQUw" target="_blank" title="https://mp.weixin.qq.com/s/qI3TRTdDfRJSH9kCTqAQUw" ref="nofollow noopener noreferrer">ã€Šè¿™ 10 ä¸ª MySQL é«˜çº§ç”¨æ³•ï¼Œè®©ä½ çš„ä»£ç åˆå¿«åˆå¥½çœ‹ã€‹</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[å‰ç«¯è·¨é¡µé¢é€šè®¯ç»ˆææŒ‡å—â‘¤ï¼šwindow.name ç”¨æ³•å…¨è§£æ]]></title>    <link>https://juejin.cn/post/7580378958073479178</link>    <guid>https://juejin.cn/post/7580378958073479178</guid>    <pubDate>2025-12-07T12:20:12.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7580378958073479178" data-draft-id="7576369868418891812" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="å‰ç«¯è·¨é¡µé¢é€šè®¯ç»ˆææŒ‡å—â‘¤ï¼šwindow.name ç”¨æ³•å…¨è§£æ"/> <meta itemprop="keywords" content="å‰ç«¯"/> <meta itemprop="datePublished" content="2025-12-07T12:20:12.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ä¸€è¯ºæ»šé›ªçƒ"/> <meta itemprop="url" content="https://juejin.cn/user/2824015112318094"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            å‰ç«¯è·¨é¡µé¢é€šè®¯ç»ˆææŒ‡å—â‘¤ï¼šwindow.name ç”¨æ³•å…¨è§£æ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2824015112318094/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ä¸€è¯ºæ»šé›ªçƒ
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-07T12:20:12.000Z" title="Sun Dec 07 2025 12:20:12 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-07
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»3åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">å‰è¨€</h2>
<p>åœ¨ä¹‹å‰çš„æ–‡ç« é‡Œï¼Œä»‹ç»äº† <code>BroadcastChannel</code> çš„å¹¿æ’­ã€<code>postMessage</code> çš„çµæ´»ä»¥åŠ <code>MessageChannel</code> çš„ç²¾å‡†ã€‚è¿™äº›ç°ä»£ API ä¸ºæˆ‘ä»¬æä¾›äº†æ ‡å‡†çš„é€šä¿¡èƒ½åŠ›ã€‚</p>
<p>ä»Šå¤©æˆ‘ä»¬è¦ä»‹ç»ä¸‹â€”â€”<code>window.name</code>ã€‚å®ƒä¸æ˜¯ä¸€ä¸ªä¸ºé€šä¿¡è€Œç”Ÿçš„ APIï¼Œä½†æ˜¯æœ‰å…¶ç‹¬ç‰¹çš„â€œè·¨é¡µé¢æŒä¹…æ€§â€ç‰¹æ€§ï¼Œæˆä¸ºè§£å†³è·¨åŸŸæ•°æ®ä¼ è¾“é—®é¢˜çš„æ–¹æ¡ˆä¹‹ä¸€ã€‚</p>
<h2 data-id="heading-1">1. window.nameæ˜¯ä»€ä¹ˆï¼Ÿ</h2>
<p><code>window.name</code> æ˜¯ä¸€ä¸ªæå…¶ç®€å•çš„å±æ€§ï¼Œå®ƒçš„åŸå§‹è®¾è®¡ç›®çš„æ˜¯ç”¨æ¥è®¾ç½®æˆ–è·å–çª—å£ï¼ˆæµè§ˆå™¨æ ‡ç­¾é¡µï¼‰çš„åç§°ã€‚</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// è®¾ç½®çª—å£åç§°</span>
<span class="hljs-variable language_">window</span>.<span class="hljs-property">name</span> = <span class="hljs-string">'My Awesome Window'</span>;

<span class="hljs-comment">// è·å–çª—å£åç§°</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-variable language_">window</span>.<span class="hljs-property">name</span>); <span class="hljs-comment">// 'My Awesome Window'</span>
</code></pre>
<p>å®ƒæœ‰ä¸€ä¸ª<strong>é‡è¦</strong>çš„ç‰¹æ€§ï¼š</p>
<blockquote>
<p><strong>åªè¦æ˜¯åœ¨åŒä¸€ä¸ªæµè§ˆå™¨æ ‡ç­¾é¡µä¸­ï¼Œå³ä½¿é¡µé¢å‘ç”Ÿäº†è·³è½¬ï¼ˆä»ä¸€ä¸ªåŸŸååˆ°å¦ä¸€ä¸ªåŸŸåï¼‰ï¼Œ<code>window.name</code> çš„å€¼ä¹Ÿä¸ä¼šè¢«é‡ç½®ï¼Œå®ƒä¼šä¸€ç›´ä¿ç•™ã€‚</strong> æ›´æƒŠäººçš„æ˜¯ï¼Œå®ƒçš„å®¹é‡éå¸¸å¤§ï¼Œé€šå¸¸å¯ä»¥è¾¾åˆ° <strong>2MB</strong> å·¦å³ï¼</p>
</blockquote>
<h2 data-id="heading-2">2. <code>window.name</code> çš„ä½œç”¨åŸŸ</h2>
<p><code>window.name</code> å±æ€§æ˜¯å±äº<strong>æ¯ä¸€ä¸ªç‹¬ç«‹çš„çª—å£ä¸Šä¸‹æ–‡ï¼ˆWindow Context</strong>çš„ã€‚</p>
<ol>
<li><strong>çˆ¶é¡µé¢</strong>æ˜¯ä¸€ä¸ªçª—å£ä¸Šä¸‹æ–‡ï¼Œå®ƒæœ‰è‡ªå·±çš„ <code>window.name</code>ã€‚</li>
<li><strong>iframe å­é¡µé¢</strong>æ˜¯å¦ä¸€ä¸ªå®Œå…¨ç‹¬ç«‹çš„çª—å£ä¸Šä¸‹æ–‡ï¼Œå®ƒä¹Ÿæœ‰<strong>è‡ªå·±</strong>çš„ <code>window.name</code>ã€‚</li>
</ol>
<p>å®ƒä»¬æ˜¯ä¸¤ä¸ªå®Œå…¨ä¸åŒçš„å˜é‡ï¼Œäº’ä¸å½±å“ã€‚å½“ä½ åœ¨å­é¡µé¢ä¸­ç›´æ¥è°ƒç”¨ <code>window.name</code> æ—¶ï¼Œä½ è®¿é—®çš„æ˜¯<strong>å­é¡µé¢è‡ªå·±</strong>çš„ <code>name</code>ï¼Œè€Œä¸æ˜¯çˆ¶é¡µé¢çš„ã€‚</p>
<h3 data-id="heading-3">2.1 å¦‚ä½•æ­£ç¡®è®¿é—®çˆ¶é¡µé¢çš„ <code>window.name</code></h3>
<p>è™½ç„¶ä¸èƒ½ç›´æ¥è¯»å–ï¼Œä½† iframe æä¾›äº†è®¿é—®çˆ¶çª—å£çš„è·¯å¾„ï¼š<code>window.parent</code>,å¯ä»¥é€šè¿‡<code>iframe.contentWindow.name</code>è®¾ç½®å­é¡µé¢çš„nameã€‚</p>
<blockquote>
<p><strong>å…³é”®ç‚¹ï¼š</strong> iframe çš„åˆ·æ–°åªä¼šé‡ç½®å®ƒ<strong>è‡ªå·±</strong>çš„ <code>window.name</code>ï¼Œå¯¹çˆ¶é¡µé¢çš„ <code>window.name</code> æ¯«æ— å½±å“ã€‚å¹¶ä¸”å¦‚æœéœ€è¦è®¾ç½®å­é¡µé¢çš„nameï¼Œå¿…é¡»æ˜¯åŒæºã€‚</p>
</blockquote>
<p>åªèƒ½è¯»å–åŒæºå­é¡µé¢çš„nameï¼Œå¦åˆ™ä¼šæŠ¥é”™ï¼š</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c507432879df4fffa238e1fa90d8899e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiA6K-65rua6Zuq55CD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765714812&amp;x-signature=FopTWfuXQup3T2%2Fl0DDjuVUV3EI%3D" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-4">3. å®æˆ˜æ¡ˆä¾‹</h2>
<p>é€šè¿‡ä¸€ä¸ªç®€å•çš„ä¾‹å­æ¥è¯´æ˜ï¼Œå…·ä½“çœ‹ä»£ç ï¼š</p>
<ol>
<li>çˆ¶é¡µé¢ (<code>parent.html</code>)</li>
</ol>
<pre><code class="hljs language-html" lang="html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"en"</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>çˆ¶é¡µé¢<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>è¿™æ˜¯çˆ¶é¡µé¢<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>çˆ¶é¡µé¢çš„ window.name: <span class="hljs-tag">&lt;<span class="hljs-name">strong</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"parentName"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">strong</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">hr</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">iframe</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"child.html"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"myIframe"</span> <span class="hljs-attr">style</span>=<span class="hljs-string">"width: 100%; height: 300px; border: 1px solid black;"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">iframe</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">
        <span class="hljs-comment">// 1. è®¾ç½®çˆ¶é¡µé¢çš„ name</span>
        <span class="hljs-variable language_">window</span>.<span class="hljs-property">name</span> = <span class="hljs-string">"æˆ‘æ˜¯çˆ¶é¡µé¢çš„ç§˜å¯†æ•°æ®"</span>;
        <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'parentName'</span>).<span class="hljs-property">textContent</span> = <span class="hljs-variable language_">window</span>.<span class="hljs-property">name</span>;

        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'çˆ¶é¡µé¢: å·²è®¾ç½® window.name ='</span>, <span class="hljs-variable language_">window</span>.<span class="hljs-property">name</span>);
    </span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span>
</code></pre>
<ol start="2">
<li>å­é¡µé¢ (<code>child.html</code>)</li>
</ol>
<pre><code class="hljs language-html" lang="html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"en"</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>å­é¡µé¢<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>è¿™æ˜¯ iframe å­é¡µé¢<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onclick</span>=<span class="hljs-string">"location.reload()"</span>&gt;</span>åˆ·æ–°æœ¬é¡µé¢<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">hr</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">strong</span>&gt;</span>å­é¡µé¢è‡ªå·±çš„ window.name:<span class="hljs-tag">&lt;/<span class="hljs-name">strong</span>&gt;</span> <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"childName"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">strong</span>&gt;</span>é€šè¿‡ window.parent.name è®¿é—®çˆ¶é¡µé¢:<span class="hljs-tag">&lt;/<span class="hljs-name">strong</span>&gt;</span> <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"parentNameFromChild"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">
        <span class="hljs-keyword">function</span> <span class="hljs-title function_">updateDisplay</span>(<span class="hljs-params"/>) {
            <span class="hljs-comment">// è¯»å–å­é¡µé¢è‡ªå·±çš„ name</span>
            <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'childName'</span>).<span class="hljs-property">textContent</span> = <span class="hljs-variable language_">window</span>.<span class="hljs-property">name</span> || <span class="hljs-string">'(ç©º)'</span>;

            <span class="hljs-comment">// é€šè¿‡ window.parent.name è®¿é—®çˆ¶é¡µé¢çš„ name</span>
            <span class="hljs-keyword">try</span> {
                <span class="hljs-keyword">const</span> parentName = <span class="hljs-variable language_">window</span>.<span class="hljs-property">parent</span>.<span class="hljs-property">name</span>;
                <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'parentNameFromChild'</span>).<span class="hljs-property">textContent</span> = parentName;
            } <span class="hljs-keyword">catch</span> (e) {
                <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'parentNameFromChild'</span>).<span class="hljs-property">textContent</span> = <span class="hljs-string">'è®¿é—®å¤±è´¥ (è·¨åŸŸ?)'</span>;
            }
        }
        <span class="hljs-title function_">updateDisplay</span>();

        <span class="hljs-comment">// ä¸ºäº†æ¼”ç¤ºï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥è®¾ç½®ä¸€ä¸‹å­é¡µé¢è‡ªå·±çš„ name</span>
        <span class="hljs-variable language_">window</span>.<span class="hljs-property">name</span> = <span class="hljs-string">"æˆ‘æ˜¯å­é¡µé¢è‡ªå·±çš„æ•°æ®"</span>;
    </span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span>
</code></pre>
<p>å­é¡µé¢ä¼šæ˜¾ç¤ºï¼š<code>å­é¡µé¢è‡ªå·±çš„ window.name: æˆ‘æ˜¯å­é¡µé¢è‡ªå·±çš„æ•°æ®</code>,å­é¡µé¢ä¼šæ˜¾ç¤ºï¼š<code>é€šè¿‡ window.parent.name è®¿é—®çˆ¶é¡µé¢: æˆ‘æ˜¯çˆ¶é¡µé¢çš„ç§˜å¯†æ•°æ®</code>ã€‚
<strong>ç‚¹å‡»â€œåˆ·æ–°æœ¬é¡µé¢â€æŒ‰é’®å</strong>ï¼šå­é¡µé¢ä¼šé‡æ–°åŠ è½½ï¼Œå…¶<strong>è‡ªå·±</strong>çš„ <code>window.name</code> ä¼šè¢«é‡ç½®ä¸ºç©ºå­—ç¬¦ä¸²ã€‚ä½†æ˜¯ï¼Œ<code>window.parent.name</code> çš„å€¼<strong>ä¾ç„¶æ˜¯</strong> <code>æˆ‘æ˜¯çˆ¶é¡µé¢çš„ç§˜å¯†æ•°æ®</code>ï¼Œå®Œå…¨ä¸å—å½±å“ã€‚</p>
<h2 data-id="heading-5">4. æ€»ç»“</h2>
<p>æœ€åæ€»ç»“ä¸€ä¸‹ï¼šwindow.nameä½œä¸ºæµè§ˆå™¨çš„ä¸€ä¸ªè€å¤è‘£æ–¹æ¡ˆï¼Œç®€å•äº†è§£ä»‹ç»ä¸‹ï¼Œå¦‚æœéœ€è¦é€šè®¯ï¼Œè¿˜æ˜¯æ¨è<code>postMessage</code>ç­‰é€šè®¯æ–¹å¼ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[æ·±å…¥è§£æ SystemUI ä¾èµ–æ³¨å…¥ï¼šDagger2 ä¸ Hilt æ ¸å¿ƒæœºåˆ¶é‡æ¸©]]></title>    <link>https://juejin.cn/post/7580329353353723950</link>    <guid>https://juejin.cn/post/7580329353353723950</guid>    <pubDate>2025-12-07T05:46:14.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7580329353353723950" data-draft-id="7580537115910930432" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="æ·±å…¥è§£æ SystemUI ä¾èµ–æ³¨å…¥ï¼šDagger2 ä¸ Hilt æ ¸å¿ƒæœºåˆ¶é‡æ¸©"/> <meta itemprop="keywords" content="Android,Dagger"/> <meta itemprop="datePublished" content="2025-12-07T05:46:14.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="æ„¤æ€’çš„ä»£ç "/> <meta itemprop="url" content="https://juejin.cn/user/4125023358426190"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            æ·±å…¥è§£æ SystemUI ä¾èµ–æ³¨å…¥ï¼šDagger2 ä¸ Hilt æ ¸å¿ƒæœºåˆ¶é‡æ¸©
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4125023358426190/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    æ„¤æ€’çš„ä»£ç 
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-07T05:46:14.000Z" title="Sun Dec 07 2025 05:46:14 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-07
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»10åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">0x00. èƒŒæ™¯</h2>
<p>SystemUI ä½œä¸º Android ç³»ç»Ÿçš„â€œé—¨é¢â€ï¼Œç®¡ç†ç€çŠ¶æ€æ (<code>StatusBar</code>)ã€é€šçŸ¥é¢æ¿(<code>NotificationPanel</code>)ã€é”å±(<code>Keyguard</code>)ç­‰æ ¸å¿ƒäº¤äº’ï¼Œå…¶ä»£ç åº“åºå¤§ä¸”çŠ¶æ€å¤æ‚ã€‚ä¸ºäº†è§£è€¦å„ä¸ªåŠŸèƒ½æ¨¡å—ï¼ŒGoogle åœ¨ SystemUI ä¸­æ·±åº¦åº”ç”¨äº† Dagger2 è¿›è¡Œä¾èµ–æ³¨å…¥ï¼ˆDependency Injection, DIï¼‰ã€‚</p>
<p>åœ¨æ·±å…¥ SystemUI çš„ <code>GlobalRootComponent</code> æˆ– <code>SysUIComponent</code> æºç ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦å…ˆå¯¹ Dagger2 çš„æ ¸å¿ƒæœºåˆ¶è¿›è¡Œä¸€æ¬¡â€œé«˜ä¿çœŸâ€çš„å›é¡¾ã€‚æœ¬ç¯‡ä¸è¿½æ±‚é¢é¢ä¿±åˆ°ï¼Œè€Œæ˜¯èšç„¦äºé‚£äº›æ”¯æ’‘ SystemUI æ¶æ„çš„åŸºçŸ³æ¦‚å¿µã€‚</p>
<h2 data-id="heading-1">0x01. æ ¸å¿ƒè§’è‰²ï¼šDagger2 çš„æ³¨è§£â€œäº”è™å°†â€</h2>
<p>Dagger2 çš„å·¥ä½œæœ¬è´¨æ˜¯<strong>é€šè¿‡æ³¨è§£å¤„ç†å™¨åœ¨ç¼–è¯‘æ—¶ç”Ÿæˆä»£ç </strong>ï¼Œä»è€Œæ„å»ºä¸€ä¸ªè‡ªåŠ¨åŒ–çš„ä¾èµ–å·¥å‚ã€‚ç†è§£ä»¥ä¸‹ 5 ä¸ªæ ¸å¿ƒæ¦‚å¿µï¼Œæ˜¯çœ‹æ‡‚ SystemUI æºç çš„å‰æã€‚</p>
<h3 data-id="heading-2">1.1. @Injectï¼šè¯·æ±‚ä¸ä¾›ç»™çš„â€œé”šç‚¹â€</h3>
<p>è¿™æ˜¯æœ€åŸºç¡€çš„æ³¨è§£ï¼Œå®ƒæœ‰ä¸¤ä¸ªä¸»è¦ç”¨é€”ï¼š</p>
<ul>
<li><strong>è¯·æ±‚ä¾èµ–</strong>ï¼šæ ‡è®°åœ¨æ„é€ å‡½æ•°ï¼ˆConstructor Injectionï¼‰æˆ–æˆå‘˜å˜é‡ï¼ˆField Injectionï¼‰ä¸Šï¼Œå‘Šè¯‰ Daggerï¼šâ€œæˆ‘éœ€è¦è¿™ä¸ªå¯¹è±¡ã€‚â€</li>
<li><strong>ä¾›ç»™ä¾èµ–</strong>ï¼šæ ‡è®°åœ¨ç±»çš„æ„é€ å‡½æ•°ä¸Šï¼Œå‘Šè¯‰ Daggerï¼šâ€œä½ å¯ä»¥é€šè¿‡è°ƒç”¨è¿™ä¸ªæ„é€ å‡½æ•°æ¥åˆ›å»ºæˆ‘çš„å®ä¾‹ã€‚â€</li>
</ul>
<h3 data-id="heading-3">1.2. @Moduleï¼šç”Ÿäº§å®ä¾‹çš„å·¥å‚</h3>
<p>å¹¶ä¸æ˜¯æ‰€æœ‰ç±»éƒ½èƒ½é€šè¿‡ <code>@Inject</code> æ„é€ å‡½æ•°åˆ›å»ºï¼ˆä¾‹å¦‚ï¼šæ¥å£ã€ç¬¬ä¸‰æ–¹åº“çš„ç±»ã€éœ€è¦å¤æ‚é…ç½®çš„ç±»ï¼‰ã€‚</p>
<ul>
<li><strong>@Module</strong>ï¼šå¯ä»¥ç†è§£ä¸ºä¸€ä¸ªâ€œä»“åº“â€æˆ–â€œå·¥å‚è½¦é—´â€ï¼Œä¸“é—¨ç”¨æ¥å­˜æ”¾ç”Ÿæˆå¯¹è±¡çš„æ–¹æ³•ã€‚</li>
<li><strong>@Provides</strong>ï¼šæ ‡è®°åœ¨ <code>@Module</code> ä¸­çš„æ–¹æ³•ä¸Šã€‚å½“ Dagger éœ€è¦æŸä¸ªç±»å‹çš„å¯¹è±¡ï¼Œè€Œè¯¥å¯¹è±¡æ— æ³•ç›´æ¥æ„é€ æ—¶ï¼Œå®ƒä¼šæ¥è¿™é‡Œå¯»æ‰¾å¸¦æœ‰ <code>@Provides</code> çš„æ–¹æ³•ã€‚</li>
<li><strong>@Binds</strong>ï¼šæ ‡è®°åœ¨ <code>@Module</code> ä¸­çš„æ–¹æ³•ä¸Šã€‚å½“ Dagger éœ€è¦æ‰¾æŸä¸ªæ¥å£å¯¹åº”çš„å®ç°ç±»æ—¶ä½¿ç”¨ <code>@Binds</code>è¿›è¡Œç»‘å®šã€‚</li>
</ul>
<h3 data-id="heading-4">1.3. @Componentï¼šè¿æ¥å™¨ï¼ˆThe Bridgeï¼‰</h3>
<p>è¿™æ˜¯ Dagger çš„æ ¸å¿ƒå¤§è„‘ã€‚å®ƒæ˜¯ä¸€ä¸ªæ¥å£ï¼Œè¿æ¥äº†â€œéœ€æ±‚æ–¹â€ï¼ˆä½¿ç”¨ <code>@Inject</code> çš„åœ°æ–¹ï¼‰å’Œâ€œä¾›ç»™æ–¹â€ï¼ˆ<code>@Module</code> æˆ– <code>@Inject</code> æ„é€ å‡½æ•°ï¼‰ã€‚</p>
<ul>
<li>å®ƒå‘Šè¯‰ Dagger ä»å“ªé‡Œè·å–ä¾èµ–ï¼Œä»¥åŠå°†ä¾èµ–æ³¨å…¥åˆ°å“ªé‡Œã€‚</li>
<li>åœ¨ç¼–è¯‘æ—¶ï¼ŒDagger ä¼šç”Ÿæˆè¯¥æ¥å£çš„å®ç°ç±»ï¼ˆå¦‚ <code>DaggerCarComponent</code>ï¼‰ã€‚</li>
</ul>
<h3 data-id="heading-5">1.4. @Subcomponentï¼šå›¾è°±çš„ç»§æ‰¿</h3>
<p>åœ¨ SystemUI ä¸­ï¼Œ<code>@Subcomponent</code> è‡³å…³é‡è¦ã€‚å®ƒç”¨äºåˆ›å»º<strong>ä¾èµ–å›¾è°±çš„å­å›¾</strong>ã€‚</p>
<ul>
<li>å­ç»„ä»¶å¯ä»¥è®¿é—®çˆ¶ç»„ä»¶çš„æ‰€æœ‰å¯¹è±¡ï¼Œä½†çˆ¶ç»„ä»¶æ— æ³•è®¿é—®å­ç»„ä»¶ã€‚</li>
<li><strong>åº”ç”¨åœºæ™¯</strong>ï¼šSystemUI ä¸­æœ‰å…¨å±€å•ä¾‹ï¼ˆGlobal Scopeï¼‰ï¼Œä¹Ÿæœ‰é’ˆå¯¹ç‰¹å®šç”¨æˆ·çš„ä¼šè¯ï¼ˆUser Scopeï¼‰ã€‚å½“ç”¨æˆ·åˆ‡æ¢æ—¶ï¼ŒUserSubcomponent ä¼šè¢«é”€æ¯å¹¶é‡å»ºï¼Œè€Œ GlobalComponent ä¿æŒä¸å˜ã€‚</li>
</ul>
<h3 data-id="heading-6">1.5. @Scope (å¦‚ @Singleton)ï¼šç”Ÿå‘½å‘¨æœŸçš„ç®¡ç†è€…</h3>
<p>Dagger é»˜è®¤æ¯æ¬¡éƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ–°å¯¹è±¡ã€‚<code>@Scope</code> ç”¨äºå°†å¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸç»‘å®šåˆ° Component çš„ç”Ÿå‘½å‘¨æœŸä¸Šã€‚</p>
<ul>
<li>å¦‚æœä¸€ä¸ª Component ç”Ÿå‘½å‘¨æœŸåƒ Application ä¸€æ ·é•¿ï¼Œä¸”å¯¹è±¡è¢«æ ‡è®°ä¸º <code>@Singleton</code>ï¼Œé‚£ä¹ˆè¯¥å¯¹è±¡å°±æ˜¯å…¨å±€å•ä¾‹ã€‚</li>
<li>åœ¨ SystemUI ä¸­ï¼Œä½ ä¼šçœ‹åˆ°å¤§é‡çš„ <code>@SysUISingleton</code>ï¼Œå…¶æœ¬è´¨ä¸ <code>@Singleton</code> ç±»ä¼¼ï¼Œåªæ˜¯ä¸ºäº†è¯­ä¹‰æ›´æ˜ç¡®ã€‚</li>
</ul>
<h2 data-id="heading-7">0x02. å¹•åæœºåˆ¶ï¼šç¼–è¯‘æ—¶ä¾èµ–å›¾æ„å»º</h2>
<p>ä¸åŒäº Guice æˆ– Spring ç­‰æ¡†æ¶åœ¨<strong>è¿è¡Œæ—¶</strong>é€šè¿‡åå°„æŸ¥æ‰¾ä¾èµ–ï¼ŒDagger2 çš„é­”æ³•å‘ç”Ÿåœ¨<strong>ç¼–è¯‘æ—¶ï¼ˆCompile Timeï¼‰</strong> ã€‚</p>
<ol>
<li><strong>æ³¨è§£å¤„ç†</strong>ï¼šç¼–è¯‘å™¨æ‰«ææ‰€æœ‰çš„ <code>@Inject</code>, <code>@Module</code>, <code>@Component</code>ã€‚</li>
<li><strong>å›¾è°±éªŒè¯</strong>ï¼šDagger æ£€æŸ¥æ˜¯å¦å­˜åœ¨å¾ªç¯ä¾èµ–ã€ä¾èµ–ç¼ºå¤±ç­‰é—®é¢˜ã€‚å¦‚æœæœ‰é”™ï¼Œç¼–è¯‘ç›´æ¥å¤±è´¥ï¼ˆFail Fastï¼‰ã€‚</li>
<li><strong>ä»£ç ç”Ÿæˆ</strong>ï¼šDagger ç”Ÿæˆæ ‡å‡†çš„ Java/Kotlin ä»£ç ï¼ˆå¦‚ <code>Factory</code> ç±»å’Œ <code>MembersInjector</code> ç±»ï¼‰ã€‚</li>
</ol>
<p>è¿™æ„å‘³ç€ï¼ŒSystemUI è¿è¡Œæ—¶æ²¡æœ‰ä»»ä½•ä¾èµ–æ³¨å…¥å¸¦æ¥çš„åå°„æ€§èƒ½æŸè€—ï¼Œè¿™å¯¹äºå¯¹æµç•…åº¦è¦æ±‚æé«˜çš„ UI ç³»ç»Ÿå°¤ä¸ºå…³é”®ã€‚</p>
<h2 data-id="heading-8">0x03. å®æˆ˜æ¼”ç»ƒï¼šä¸€ä¸ªæç®€çš„ Car ç»„è£…å‚</h2>
<p>ä¸ºäº†æŠ›å¼€ SystemUI çš„å¤æ‚ä¸šåŠ¡å¹²æ‰°ï¼Œæˆ‘ä»¬æ„å»ºä¸€ä¸ªå¹²å‡€çš„æ±½è½¦æ¨¡å‹ï¼Œå±•ç¤ºä»å®šä¹‰åˆ°æ³¨å…¥çš„å®Œæ•´é—­ç¯ã€‚</p>
<h3 data-id="heading-9">ç¬¬ä¸€æ­¥ï¼šå®šä¹‰ä¾èµ– (The Dependency)</h3>
<p>æˆ‘ä»¬å®šä¹‰ä¸€ä¸ª <code>Engine</code> æ¥å£ï¼Œä»¥åŠå®ƒçš„å…·ä½“å®ç° <code>V8Engine</code>ã€‚æ³¨æ„ <code>V8Engine</code> æ‹¥æœ‰ <code>@Inject</code> æ„é€ å‡½æ•°ï¼Œè¿™æ„å‘³ç€ Dagger çŸ¥é“å¦‚ä½•åˆ›å»ºå®ƒã€‚</p>
<pre><code class="hljs language-Kotlin" lang="Kotlin"><span class="hljs-comment">// 1. å®šä¹‰æ¥å£</span>
<span class="hljs-keyword">interface</span> <span class="hljs-title class_">Engine</span> {
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">start</span><span class="hljs-params">()</span></span>
}

<span class="hljs-comment">// 2. å®šä¹‰å…·ä½“å®ç°ï¼Œå¹¶å‘ŠçŸ¥ Dagger å¦‚ä½•æ„é€ å®ƒ</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">V8Engine</span> <span class="hljs-meta">@Inject</span> <span class="hljs-keyword">constructor</span>() : Engine {
    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">start</span><span class="hljs-params">()</span></span> = println(<span class="hljs-string">"V8 Engine roaring!"</span>)
}

<span class="hljs-comment">// 3. æ™®é€šç±»ï¼Œå¯ä»¥ç›´æ¥æ³¨å…¥</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">Wheel</span> <span class="hljs-meta">@Inject</span> <span class="hljs-keyword">constructor</span>() {
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">roll</span><span class="hljs-params">()</span></span> = println(<span class="hljs-string">"Wheel rolling"</span>)
}
</code></pre>
<h3 data-id="heading-10">ç¬¬äºŒæ­¥ï¼šå®šä¹‰éœ€æ±‚æ–¹ (The Consumer)</h3>
<p>æˆ‘ä»¬çš„æ±½è½¦ (<code>Car</code>) éœ€è¦å¼•æ“å’Œè½®å­ã€‚å³è¿™é‡Œå®šä¹‰äº†â€œéœ€æ±‚æ–¹â€ã€‚</p>
<pre><code class="hljs language-Kotlin" lang="Kotlin"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Car</span> <span class="hljs-meta">@Inject</span> <span class="hljs-keyword">constructor</span>(
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> engine: Engine, <span class="hljs-comment">// éœ€è¦ Module æä¾›ï¼Œå‘Šè¯‰ Dagger è¿™ä¸ªç±»æ˜¯å¦‚ä½•è·å–çš„</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> wheel: Wheel    <span class="hljs-comment">// Dagger å¯ä»¥ç›´æ¥é€šè¿‡ @Inject æ„é€ ç”Ÿæˆ</span>
) {
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">drive</span><span class="hljs-params">()</span></span> {
        engine.start()
        wheel.roll()
        println(<span class="hljs-string">"Car is moving!"</span>)
    }
}
</code></pre>
<h3 data-id="heading-11">ç¬¬ä¸‰æ­¥ï¼šåˆ¶ä½œæ¨¡å— (The Module)</h3>
<p>è¿™é‡Œæˆ‘ä»¬å±•ç¤º SystemUI ä¸­æœ€å¸¸è§çš„ Module å†™æ³•ï¼šåŒæ—¶åŒ…å« <code>@Binds</code> å’Œ <code>@Provides</code>ã€‚</p>
<ul>
<li><strong>@Binds (æ¨è)</strong> ï¼šç”¨äºå°†æ¥å£æ˜ å°„åˆ°å®ç°ç±»ã€‚å®ƒå¿…é¡»æ˜¯<strong>æŠ½è±¡æ–¹æ³•</strong>ï¼Œä¸”åœ¨<strong>æŠ½è±¡ç±»</strong>æˆ–æ¥å£ä¸­ã€‚å®ƒçš„æ•ˆç‡æ¯” <code>@Provides</code> æ›´é«˜ï¼Œå› ä¸º Dagger ä¸éœ€è¦å®ä¾‹åŒ– Moduleï¼Œç›´æ¥è°ƒç”¨å®ç°ç±»çš„ Providerã€‚</li>
<li><strong>@Provides</strong>ï¼šç”¨äºéœ€è¦è‡ªå®šä¹‰æ„é€ é€»è¾‘ã€å¼•å…¥ç¬¬ä¸‰æ–¹åº“æˆ–åŸºæœ¬ç±»å‹ï¼ˆå¦‚ String, Contextï¼‰çš„åœºæ™¯ã€‚</li>
</ul>
<pre><code class="hljs language-Kotlin" lang="Kotlin"><span class="hljs-meta">@Module</span>
<span class="hljs-keyword">abstract</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CarModule</span> {

    <span class="hljs-comment">// ã€é‡ç‚¹ã€‘ä½¿ç”¨ @Binds</span>
    <span class="hljs-comment">// è¯­ä¹‰ï¼šå½“æœ‰äººè¯·æ±‚ Engine æ¥å£æ—¶ï¼Œç»™å®ƒ V8Engine çš„å®ä¾‹ã€‚</span>
    <span class="hljs-comment">// ä¼˜åŠ¿ï¼šç¼–è¯‘æ—¶ä¼˜åŒ–ï¼Œä¸ç”Ÿæˆé¢å¤–çš„å·¥å‚ä»£ç ï¼Œæ€§èƒ½æ›´å¥½ã€‚</span>
    <span class="hljs-meta">@Binds</span>
    <span class="hljs-keyword">abstract</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">bindEngine</span><span class="hljs-params">(impl: <span class="hljs-type">V8Engine</span>)</span></span>: Engine

    <span class="hljs-comment">// ä½¿ç”¨ @Provides (ä¼´ç”Ÿå¯¹è±¡å†™æ³•æ˜¯ SystemUI ä¸­çš„å¸¸è§æ¨¡å¼)</span>
    <span class="hljs-comment">// åœºæ™¯ï¼šå¦‚æœæˆ‘ä»¬éœ€è¦æä¾›ä¸€äº›åŸºæœ¬ç±»å‹é…ç½®ï¼Œæˆ–è€…æ— æ³•ç›´æ¥ @Inject çš„å¯¹è±¡ï¼Œä¾‹å¦‚åœ¨ä½¿ç”¨ä¸€äº›ç¬¬ä¸‰æ–¹çš„ç±»åº“æ—¶ï¼Œå¯ä»¥ä½¿ç”¨ @Provides æ¥å‘Šè¯‰ Dagger å¦‚ä½•åˆ›å»ºå…·ä½“å¯¹è±¡</span>
    <span class="hljs-keyword">companion</span> <span class="hljs-keyword">object</span> {
        <span class="hljs-meta">@Provides</span>
        <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">provideCarName</span><span class="hljs-params">()</span></span>: String {
            <span class="hljs-keyword">return</span> <span class="hljs-string">"SystemUI Concept Car"</span>
        }
    }
}
</code></pre>
<h3 data-id="heading-12">ç¬¬å››æ­¥ï¼šç»„è£…ç»„ä»¶ (The Component)</h3>
<p>å®šä¹‰è¿æ¥å™¨ï¼Œå‘Šè¯‰ Dagger å°† <code>CarModule</code> çº³å…¥ç‰ˆå›¾ï¼Œå¹¶æä¾›è·å– <code>Car</code> çš„å…¥å£ã€‚éœ€è¦ä½¿ç”¨<code>@Component</code>æŒ‡å®šæœ‰å“ªäº› <code>Module</code> ç±»</p>
<pre><code class="hljs language-Kotlin" lang="Kotlin"><span class="hljs-meta">@Component(modules = [CarModule::class])</span>
<span class="hljs-keyword">interface</span> <span class="hljs-title class_">CarComponent</span> {
    <span class="hljs-comment">// æ–¹å¼ Aï¼šç›´æ¥è·å–å¯¹è±¡</span>
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">getCar</span><span class="hljs-params">()</span></span>: Car
    
    <span class="hljs-comment">// æ–¹å¼ Bï¼šæ³¨å…¥åˆ°æŸä¸ªå®¹å™¨ä¸­ï¼ˆå¸¸ç”¨äº Activity/Fragmentï¼‰</span>
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">inject</span><span class="hljs-params">(activity: <span class="hljs-type">MainActivity</span>)</span></span>
}
</code></pre>
<h3 data-id="heading-13">ç¬¬äº”æ­¥ï¼šæœ€ç»ˆè°ƒç”¨</h3>
<p>åœ¨ä»£ç å…¥å£å¤„ï¼ˆç±»ä¼¼äº SystemUI çš„ <code>SystemUIApplication</code>ï¼‰ï¼Œæ„å»ºå›¾è°±å¹¶ä½¿ç”¨ã€‚</p>
<pre><code class="hljs language-Java" lang="Java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MainActivity</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">AppCompatActivity</span> {

    <span class="hljs-comment">//è¯·æ±‚ä¾èµ– </span>
    <span class="hljs-meta">@Inject</span>
    Car car;
    
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onCreate</span><span class="hljs-params">(Bundle savedInstanceState)</span> {
        <span class="hljs-built_in">super</span>.onCreate(savedInstanceState);
        
        <span class="hljs-comment">// æ–¹å¼1ï¼šä½¿ç”¨é»˜è®¤Module</span>
        <span class="hljs-type">CarComponent</span> <span class="hljs-variable">component</span> <span class="hljs-operator">=</span> DaggerCarComponent.create();
        
        <span class="hljs-comment">// æ–¹å¼2ï¼šè‡ªå®šä¹‰Moduleï¼ˆæ›´çµæ´»ï¼‰</span>
        <span class="hljs-type">CarComponent</span> <span class="hljs-variable">component2</span> <span class="hljs-operator">=</span> DaggerCarComponent.builder()
            .carModule(<span class="hljs-keyword">new</span> <span class="hljs-title class_">CarModule</span>())
            .ownerModule(<span class="hljs-keyword">new</span> <span class="hljs-title class_">OwnerModule</span>())
            .build();
        
        <span class="hljs-comment">// åœ¨å½“å‰é¡µé¢æ³¨å…¥ä¾èµ–</span>
        component.inject(<span class="hljs-built_in">this</span>);
        
        <span class="hljs-comment">// ç°åœ¨å¯ä»¥ä½¿ç”¨ä¾èµ–äº†</span>
        car.drive();
    }
}
</code></pre>
<p><strong>è¾“å‡ºç»“æœï¼š</strong></p>
<blockquote>
<p>Engine V8 Turbo started</p>
<p>Wheel rolling</p>
<p>Car is moving!</p>
</blockquote>
<h3 data-id="heading-14">å°ç»“</h3>
<p>é€šè¿‡è¿™ä¸ªæç®€ç¤ºä¾‹ï¼Œæˆ‘ä»¬ç¡®ç«‹äº† Component -&gt; Module -&gt; Dependency çš„ä¸‰è§’å…³ç³»ã€‚</p>
<ul>
<li>
<p>@Inject å®šä¹‰ä¾èµ–æˆ–è€…è¯·æ±‚ä¾èµ–</p>
</li>
<li>
<p>@Module å®šä¹‰Moduleç±»ï¼Œç”¨æ¥å‘Šè¯‰ Dagger å¦‚ä½•åˆ›å»ºä¾èµ–</p>
<ul>
<li>@Binds ç”¨äºæ¥å£ä¸å®ç°ç±»è¿›è¡Œç»‘å®š</li>
<li>@Provides ä¸€èˆ¬ç”¨äºæ— æ³•åœ¨æ„é€ å‡½æ•°ä¸­ä½¿ç”¨@Injectçš„ä¾èµ–ï¼Œä¾‹å¦‚å¼•ç”¨ä¸‰æ–¹ç±»åº“çš„ä¾èµ–æ—¶ï¼Œå¯ä»¥ä½¿ç”¨</li>
</ul>
</li>
<li>
<p>@Component ç”¨äºç»„è£…ç»„ä»¶ï¼Œå‘Šè¯‰ Dagger æœ‰å“ªäº› Module ç±»</p>
</li>
</ul>
<h2 data-id="heading-15">0x04. Hilt çš„å´›èµ·ï¼šåº”ç”¨å¼€å‘çš„åˆ©å™¨</h2>
<p>åœ¨ç°ä»£ Android å¼€å‘ä¸­ï¼ŒGoogle å¼ºçƒˆæ¨èä½¿ç”¨ <strong>Hilt</strong>ã€‚å®ƒæ˜¯å»ºç«‹åœ¨ Dagger2 ä¹‹ä¸Šçš„ä¸€å±‚å°è£…åº“ã€‚å¯¹äºæ™®é€š App å¼€å‘è€…ï¼ŒHilt æ˜¯æ•‘æ˜Ÿï¼Œä½†å¯¹äº SystemUI å·¥ç¨‹å¸ˆï¼Œå®ƒæ˜¯â€œå¦ä¸€ä¸ªä¸–ç•Œçš„äº§ç‰©â€ã€‚</p>
<h3 data-id="heading-16">4.1 ä¸ºä»€ä¹ˆè¦ç”¨ Hiltï¼Ÿ</h3>
<p>åŸç”Ÿ Dagger2 åŠŸèƒ½å¼ºå¤§ï¼Œä½†æœ‰ä¸€ä¸ªè‡´å‘½ç—›ç‚¹ï¼š<strong>æ ·æ¿ä»£ç è¿‡å¤šä¸”éš¾ä»¥æ ‡å‡†åŒ–</strong>ã€‚ä½ éœ€è¦æ‰‹åŠ¨å®šä¹‰ Componentï¼Œæ‰‹åŠ¨åœ¨ Application ä¸­å®ä¾‹åŒ–å®ƒï¼Œå†æ‰‹åŠ¨å†™ <code>inject()</code> æ–¹æ³•ã€‚å¯¹äºä¸“æ³¨ä¸šåŠ¡çš„åº”ç”¨å¼€å‘è€…æ¥è¯´ä¸Šæ‰‹éš¾åº¦æ˜¯æ¯”è¾ƒå¤§çš„ã€‚</p>
<p>Hilt çš„å‡ºç°å°±æ˜¯ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ã€‚å®ƒæä¾›äº†ä¸€å¥— <strong>â€œæ ‡å‡†åŒ–çš„ç»„ä»¶å±‚çº§â€</strong>ã€‚</p>
<p><strong>Hilt çš„æ ¸å¿ƒä¼˜åŠ¿ï¼š</strong></p>
<ul>
<li><strong>å¼€ç®±å³ç”¨</strong>ï¼šé¢„å®šä¹‰å¥½äº† <code>SingletonComponent</code>, <code>ActivityComponent</code>, <code>ViewModelComponent</code> ç­‰æ ‡å‡†å®¹å™¨ã€‚</li>
<li><strong>è‡ªåŠ¨æ³¨å…¥</strong>ï¼šä½ ä¸å†éœ€è¦å†™ <code>component.inject(this)</code>ï¼Œåªéœ€ä¸€ä¸ªæ³¨è§£ã€‚</li>
</ul>
<p><strong>Hilt çš„æ ¸å¿ƒæ³¨è§£ï¼š</strong></p>
<h4 data-id="heading-17">@HiltAndroidAppï¼šåº”ç”¨å…¥å£ç‚¹</h4>
<ul>
<li><strong>è§’è‰²</strong>ï¼šæ ‡è®°åœ¨ <strong>Application</strong> ç±»ä¸Šã€‚</li>
<li><strong>ä½œç”¨</strong>ï¼šå®ƒè§¦å‘äº† Hilt çš„ä»£ç ç”Ÿæˆè¿‡ç¨‹ã€‚åœ¨ç¼–è¯‘æ—¶ï¼Œå®ƒç”Ÿæˆä¸€ä¸ªç»§æ‰¿è‡ªè¯¥ Application çš„åŸºç±»ï¼Œå¹¶è‡ªåŠ¨åˆ›å»ºå’Œé…ç½®åº”ç”¨çš„ <strong>æ ¹ç»„ä»¶</strong>ï¼ˆå³ Dagger2 ä¸­çš„ <code>AppComponent</code>ï¼‰ï¼ŒHilt ç§°ä¹‹ä¸º <strong><code>SingletonComponent</code></strong>ã€‚æ­¤ç»„ä»¶çš„ç”Ÿå‘½å‘¨æœŸä¸ Application è¿›ç¨‹ç”Ÿå‘½å‘¨æœŸä¸€è‡´ã€‚</li>
</ul>
<h4 data-id="heading-18">@AndroidEntryPointï¼šå¼€å¯æ³¨å…¥å¤§é—¨</h4>
<ul>
<li><strong>è§’è‰²</strong>ï¼šæ ‡è®°åœ¨ä»»ä½•æ ‡å‡† Android ç»„ä»¶ï¼ˆ<code>Activity</code>, <code>Fragment</code>, <code>Service</code>, <code>View</code>, <code>BroadcastReceiver</code>ï¼‰ä¸Šã€‚</li>
<li><strong>ä½œç”¨</strong>ï¼šå‘Šè¯‰ Hiltï¼Œè¯¥ç»„ä»¶çš„å®ä¾‹éœ€è¦è¿›è¡Œä¾èµ–æ³¨å…¥ã€‚åœ¨ç¼–è¯‘æ—¶ï¼ŒHilt ä¼šç”Ÿæˆä¸€ä¸ªä¸è¯¥ç»„ä»¶å…³è”çš„ Dagger Componentï¼ˆå¦‚ <code>ActivityComponent</code> æˆ– <code>FragmentComponent</code>ï¼‰ï¼Œå¹¶è‡ªåŠ¨è°ƒç”¨æ³¨å…¥æ–¹æ³•ï¼ˆå‘Šåˆ«æ‰‹åŠ¨ <code>component.inject(this)</code>ï¼‰</li>
</ul>
<h4 data-id="heading-19">@InstallInï¼šå®šä¹‰ä½œç”¨åŸŸè¾¹ç•Œ</h4>
<ul>
<li><strong>è§’è‰²</strong>ï¼šæ ‡è®°åœ¨ <code>@Module</code> ä¸Šã€‚</li>
<li><strong>ä½œç”¨</strong>ï¼šå¼ºåˆ¶å®šä¹‰è¯¥ Module ä¸­çš„ä¾èµ–ï¼ˆ<code>@Provides</code> æˆ– <code>@Binds</code> æ–¹æ³•ï¼‰å°†<strong>å®‰è£…</strong>åˆ°å“ªä¸ªé¢„å®šä¹‰çš„ Hilt Component ä¸­ã€‚è¿™æ˜¯å®ç°ä½œç”¨åŸŸç®¡ç†çš„å…³é”®ã€‚</li>
</ul>
<h4 data-id="heading-20">@HiltViewModelï¼šJetpack ViewModel ä¸“ç”¨</h4>
<ul>
<li><strong>è§’è‰²</strong>ï¼šæ ‡è®°åœ¨ <code>ViewModel</code> å­ç±»ä¸Šã€‚</li>
<li><strong>ä½œç”¨</strong>ï¼šå…è®¸ Hilt è‡ªåŠ¨æ³¨å…¥ <code>ViewModel</code> çš„æ„é€ å‡½æ•°ä¾èµ–ï¼Œå¹¶ç¡®ä¿ <code>ViewModel</code> èƒ½å¤Ÿä»æ­£ç¡®çš„ Componentï¼ˆé€šå¸¸æ˜¯ <code>ActivityRetainedComponent</code> æˆ– <code>FragmentComponent</code>ï¼‰ä¸­è·å–ä¾èµ–</li>
</ul>
<p>Hilt ä»£ç æç®€ç¤ºä¾‹ï¼š</p>
<pre><code class="hljs language-Kotlin" lang="Kotlin"><span class="hljs-comment">// 1. åœ¨Applicationç±»æ·»åŠ  @HiltApplication æ³¨è§£</span>
<span class="hljs-meta">@HiltApplication</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">MyApplication</span> : <span class="hljs-type">Application</span>() {

}

<span class="hljs-comment">// 2. åªéœ€è¦åŠ ä¸Š @AndroidEntryPointï¼ŒHilt è‡ªåŠ¨å¤„ç†æ³¨å…¥é€»è¾‘</span>
<span class="hljs-meta">@AndroidEntryPoint</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">MainActivity</span> : <span class="hljs-type">AppCompatActivity</span>() {
    
    <span class="hljs-meta">@Inject</span> <span class="hljs-keyword">lateinit</span> <span class="hljs-keyword">var</span> car: Car <span class="hljs-comment">// ç›´æ¥å¯ç”¨</span>

    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onCreate</span><span class="hljs-params">(savedInstanceState: <span class="hljs-type">Bundle</span>?)</span></span> {
        <span class="hljs-keyword">super</span>.onCreate(savedInstanceState)
        car.drive()
    }
}

<span class="hljs-comment">// 3. éœ€è¦å‘Šè¯‰ Hilt æŠŠè¿™ä¸ª Module å®‰è£…åˆ°å“ªä¸ªæ ‡å‡†å®¹å™¨é‡Œ</span>
<span class="hljs-meta">@Module</span>
<span class="hljs-meta">@InstallIn(SingletonComponent::class)</span> <span class="hljs-comment">// &lt;--- Hilt ç‹¬æœ‰ï¼šæŒ‡å®šå®‰è£…ä½ç½®</span>
<span class="hljs-keyword">abstract</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CarModule</span> {
    <span class="hljs-meta">@Binds</span>
    <span class="hljs-keyword">abstract</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">bindEngine</span><span class="hljs-params">(impl: <span class="hljs-type">V8Engine</span>)</span></span>: Engine
}
</code></pre>
<h3 data-id="heading-21">4.2 Dagger vs. Hiltï¼šæœ¬è´¨åŒºåˆ«</h3>






























<table><thead><tr><th><strong>ç‰¹æ€§</strong></th><th><strong>Dagger 2 (åŸç”Ÿ)</strong></th><th><strong>Hilt</strong></th></tr></thead><tbody><tr><td><strong>å®šä½</strong></td><td>é€šç”¨ Java/Kotlin ä¾èµ–æ³¨å…¥æ¡†æ¶</td><td>ä¸“ä¸º Android ä¼˜åŒ–çš„ Dagger å°è£…</td></tr><tr><td><strong>Component</strong></td><td><strong>æ‰‹åŠ¨å®šä¹‰</strong>ï¼šä½ éœ€è¦è‡ªå·±å†™ Interfaceï¼Œè‡ªå·±å†³å®šå±‚çº§å…³ç³»</td><td><strong>é¢„å®šä¹‰</strong>ï¼šæä¾›æ ‡å‡† Android ç”Ÿå‘½å‘¨æœŸç»„ä»¶ (Application, Activity, Fragment)</td></tr><tr><td><strong>çµæ´»æ€§</strong></td><td><strong>æé«˜</strong>ï¼šä½ å¯ä»¥æ„å»ºä»»æ„å½¢çŠ¶çš„ä¾èµ–å›¾</td><td><strong>å—é™</strong>ï¼šå¼ºåˆ¶éµå¾ª Hilt çš„æ ‡å‡†å±‚çº§ç»“æ„</td></tr><tr><td><strong>ä¸Šæ‰‹éš¾åº¦</strong></td><td>é«˜ (é™¡å³­çš„å­¦ä¹ æ›²çº¿)</td><td>ä½ (æ³¨è§£é©±åŠ¨ï¼Œå‚»ç“œå¼)</td></tr></tbody></table>
<h3 data-id="heading-22">4.3 çµé­‚æ‹·é—®ï¼šä¸ºä»€ä¹ˆ SystemUI ä¸ä½¿ç”¨ Hiltï¼Ÿ</h3>
<p>æ—¢ç„¶ Hilt è¿™ä¹ˆå¥½ç”¨ï¼Œä¸ºä»€ä¹ˆä½œä¸º Google äº²å„¿å­çš„ SystemUI ä¾ç„¶åšæŒä½¿ç”¨åŸç”Ÿ Dagger2ï¼Œç”šè‡³å†™äº†å¤§é‡çš„æ ·æ¿ä»£ç ï¼Ÿ</p>
<p>è¿™æ˜¯é˜…è¯»æºç æ—¶å¿…é¡»ç†è§£çš„<strong>æ¶æ„èƒŒæ™¯</strong>ï¼š</p>
<ol>
<li>
<p><strong>å†å²åŒ…è¢±ä¸è¿ç§»æˆæœ¬</strong> SystemUI çš„ä»£ç åº“å†å²è¿œæ—©äº Hilt çš„è¯ç”Ÿã€‚å®ƒæ‹¥æœ‰æ•°ä»¥åƒè®¡çš„ç±»å’Œåºå¤§çš„ä¾èµ–å›¾è°±ã€‚å°†è¿™æ ·ä¸€ä¸ªå·¨å‹å•ä½“æ¶æ„è¿ç§»åˆ° Hiltï¼Œä¸ä»…å·¥ä½œé‡å·¨å¤§ï¼Œè€Œä¸”é£é™©æé«˜ã€‚SystemUI ç›®å‰ä»å¤„äºä»æ—§çš„ <code>Dependency.get(Class)</code> é™æ€æŸ¥æ‰¾æ¨¡å¼å‘ Dagger è¿ç§»çš„è¿‡ç¨‹ä¸­ï¼Œå¼•å…¥ Hilt ä¼šå¢åŠ é¢å¤–çš„å¤æ‚åº¦ã€‚</p>
</li>
<li>
<p><strong>éæ ‡å‡†çš„ç”Ÿå‘½å‘¨æœŸä¸ä¸Šä¸‹æ–‡</strong> Hilt æ˜¯ä¸º<strong>æ ‡å‡† Android App</strong> è®¾è®¡çš„ï¼Œå®ƒå‡è®¾ä½ çš„ä¸–ç•Œç”± <code>Application</code> -&gt; <code>Activity</code> -&gt; <code>Fragment</code> ç»„æˆã€‚ ä½† SystemUI <strong>ä¸æ˜¯ä¸€ä¸ªæ™®é€šçš„ App</strong>ã€‚å®ƒåŒ…å«ï¼š</p>
<ul>
<li><strong>DreamService</strong> (å±ä¿)</li>
<li><strong>Keyguard</strong> (é”å±ï¼Œç‹¬ç«‹äº Activity ç”Ÿå‘½å‘¨æœŸ)</li>
<li><strong>Quick Settings Tiles</strong> (å¿«æ·è®¾ç½®ç£è´´)</li>
<li><strong>SystemUI Process</strong> (å¸¸é©»ç³»ç»Ÿè¿›ç¨‹) è¿™äº›ç»„ä»¶çš„ç”Ÿå‘½å‘¨æœŸéå¸¸ç‰¹æ®Šï¼ŒHilt é¢„å®šä¹‰çš„ <code>ActivityComponent</code> æˆ– <code>FragmentComponent</code> å¾ˆéš¾å®Œç¾è¦†ç›– SystemUI ä¸­åƒå¥‡ç™¾æ€ªçš„çª—å£å’ŒæœåŠ¡çš„éœ€æ±‚ã€‚</li>
</ul>
</li>
<li>
<p><strong>å¤šç”¨æˆ·æ¶æ„ (Multi-User Support)</strong> è¿™æ˜¯æœ€å…³é”®çš„æŠ€æœ¯åŸå› ã€‚SystemUI å¿…é¡»åœ¨è®¾å¤‡å±‚é¢ï¼ˆGlobalï¼‰å’Œç”¨æˆ·å±‚é¢ï¼ˆUser-Specificï¼‰ä¹‹é—´æœ‰ä¸¥æ ¼çš„ç•Œé™ã€‚</p>
<ul>
<li>å½“ä½ åœ¨ Android ä¸Šé€šè¿‡â€œå¤šç”¨æˆ·â€åŠŸèƒ½åˆ‡æ¢ç”¨æˆ·æ—¶ï¼ŒSystemUI çš„ä¸€éƒ¨åˆ†ç»„ä»¶å¿…é¡»ä¿æŒä¸å˜ï¼ˆå¦‚çŠ¶æ€æ å›¾æ ‡ç®¡ç†ï¼‰ï¼Œè€Œå¦ä¸€éƒ¨åˆ†å¿…é¡»é”€æ¯å¹¶é‡å»ºï¼ˆå¦‚ä¸å½“å‰ç”¨æˆ·è®¾ç½®ç»‘å®šçš„ç»„ä»¶ï¼‰ã€‚</li>
<li>SystemUI ä½¿ç”¨åŸç”Ÿ Dagger çš„ <code>@Subcomponent</code> æ‰‹åŠ¨æ„å»ºäº†å¤æ‚çš„ <strong>UserScope</strong> æœºåˆ¶ã€‚åŸç”Ÿ Dagger å…è®¸å¼€å‘è€…ç²¾ç¡®æ§åˆ¶ä½•æ—¶åˆ›å»ºå­å›¾ã€ä½•æ—¶é”€æ¯å­å›¾ã€‚è€Œ Hilt çš„è‡ªåŠ¨åŒ–æœºåˆ¶åœ¨å¤„ç†è¿™ç§â€œç³»ç»Ÿçº§ç”¨æˆ·åˆ‡æ¢â€çš„åŠ¨æ€å›¾è°±æ—¶ï¼Œæ˜¾å¾—ä¸å¤Ÿçµæ´»ä¸”éš¾ä»¥æ§åˆ¶ã€‚</li>
</ul>
</li>
</ol>
<h3 data-id="heading-23">4.4 <strong>ç»“è®º</strong></h3>
<p>SystemUI é€‰æ‹©åŸç”Ÿ Dagger2ï¼Œæ˜¯å› ä¸ºå®ƒéœ€è¦<strong>ç»å¯¹çš„æ§åˆ¶æƒ</strong>ã€‚å®ƒéœ€è¦æ ¹æ®ç³»ç»Ÿç‰¹æœ‰çš„ç”Ÿå‘½å‘¨æœŸï¼ˆå¦‚ User Switch, Boot Completeï¼‰æ¥æ‰‹åŠ¨ç®¡ç†ä¾èµ–å›¾è°±çš„æ„å»ºä¸é”€æ¯ï¼Œè¿™æ˜¯ä¸ºäº†ç³»ç»Ÿç¨³å®šæ€§æ‰€åšçš„å¿…è¦æƒè¡¡ã€‚</p>
<p>åœ¨ä¸‹ä¸€éƒ¨åˆ†ä¸­ï¼Œæˆ‘ä»¬å°†ç¦»å¼€èˆ’é€‚åŒºï¼Œè¿›å…¥ SystemUI çš„åºå¤§ä»£ç åº“ï¼Œçœ‹çœ‹ Google å·¥ç¨‹å¸ˆæ˜¯å¦‚ä½•åˆ©ç”¨è¿™äº›åŸºç¡€ç§¯æœ¨ï¼Œæ­å»ºèµ·ç®¡ç† Android ç³»ç»Ÿçš„æ‘©å¤©å¤§æ¥¼çš„ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[FluxImageLoader : åŸºäºCoil3å°è£…çš„ Android å›¾ç‰‡åŠ è½½åº“ï¼Œæ—¨åœ¨æä¾›ç®€å•ã€é«˜æ•ˆä¸”åŠŸèƒ½ä¸°å¯Œçš„å›¾ç‰‡åŠ è½½è§£å†³æ–¹æ¡ˆ]]></title>    <link>https://juejin.cn/post/7581270148046356520</link>    <guid>https://juejin.cn/post/7581270148046356520</guid>    <pubDate>2025-12-08T10:33:32.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581270148046356520" data-draft-id="7581299982670692386" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="FluxImageLoader : åŸºäºCoil3å°è£…çš„ Android å›¾ç‰‡åŠ è½½åº“ï¼Œæ—¨åœ¨æä¾›ç®€å•ã€é«˜æ•ˆä¸”åŠŸèƒ½ä¸°å¯Œçš„å›¾ç‰‡åŠ è½½è§£å†³æ–¹æ¡ˆ"/> <meta itemprop="keywords" content="Android,Android Jetpack"/> <meta itemprop="datePublished" content="2025-12-08T10:33:32.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Nerve"/> <meta itemprop="url" content="https://juejin.cn/user/3438928101639512"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            FluxImageLoader : åŸºäºCoil3å°è£…çš„ Android å›¾ç‰‡åŠ è½½åº“ï¼Œæ—¨åœ¨æä¾›ç®€å•ã€é«˜æ•ˆä¸”åŠŸèƒ½ä¸°å¯Œçš„å›¾ç‰‡åŠ è½½è§£å†³æ–¹æ¡ˆ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3438928101639512/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Nerve
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-08T10:33:32.000Z" title="Mon Dec 08 2025 10:33:32 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»4åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/17ce8903392a42e2b9f32bb3f86bc516~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTmVydmU=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765794812&amp;x-signature=EGo%2B7ZnrEicWrTIiiu97g%2FEDggA%3D" alt="ScreenShot_2025-12-08_180655_892.png" loading="lazy"/></p>
<h2 data-id="heading-0">FluxImageLoader</h2>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fopensource.org%2Flicenses%2FApache-2.0" target="_blank" title="https://opensource.org/licenses/Apache-2.0" ref="nofollow noopener noreferrer"><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/228aa39a27be4d36aa5a5d01da7bf552~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTmVydmU=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765794812&amp;x-signature=XuH5o0kA0l6iLeSkgEo0AvAG9%2Bw%3D" alt="License" loading="lazy"/></a>
<a href="https://link.juejin.cn?target=https%3A%2F%2Fjitpack.io%2F%23darryrzhong%2FFluxImageLoader" target="_blank" title="https://jitpack.io/#darryrzhong/FluxImageLoader" ref="nofollow noopener noreferrer"><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/daff64ef7c184093874f2252931cc1be~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTmVydmU=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765794812&amp;x-signature=ing%2Bb7dnPJmhAxPPs5oGIkThr30%3D" alt="" loading="lazy"/></a></p>
<p>FluxImageLoader æ˜¯ä¸€ä¸ªåŸºäº <a href="https://link.juejin.cn?target=https%3A%2F%2Fcoil-kt.github.io%2Fcoil%2F" target="_blank" title="https://coil-kt.github.io/coil/" ref="nofollow noopener noreferrer">Coil3</a> + <a href="https://link.juejin.cn?target=https%3A%2F%2Fsquare.github.io%2Fokhttp%2F" target="_blank" title="https://square.github.io/okhttp/" ref="nofollow noopener noreferrer">OkHttp</a> å°è£…çš„ Android å›¾ç‰‡åŠ è½½åº“ï¼Œæ—¨åœ¨æä¾›ç®€å•ã€é«˜æ•ˆä¸”åŠŸèƒ½ä¸°å¯Œçš„å›¾ç‰‡åŠ è½½è§£å†³æ–¹æ¡ˆã€‚</p>
<h2 data-id="heading-1"><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fdarryrzhong%2FFluxImageLoader" target="_blank" title="https://github.com/darryrzhong/FluxImageLoader" ref="nofollow noopener noreferrer">GitHub</a></h2>
<h3 data-id="heading-2">åŠŸèƒ½ç‰¹æ€§</h3>
<ul>
<li><strong>åŸºäº Coil3</strong>: äº«å— Coil3 å¸¦æ¥çš„ç°ä»£ kotlinå›¾ç‰‡åŠ è½½ä½“éªŒã€‚</li>
<li><strong>å¤šæ ¼å¼æ”¯æŒ</strong>: æ”¯æŒå¸¸è§å›¾ç‰‡æ ¼å¼ä»¥åŠ GIFã€WebP åŠ¨å›¾ã€SVGã€è§†é¢‘å¸§è§£ç ã€‚</li>
<li><strong>è‡ªå®šä¹‰é…ç½®</strong>: æ”¯æŒè‡ªå®šä¹‰å†…å­˜ç¼“å­˜ã€ç£ç›˜ç¼“å­˜å¤§å°åŠè·¯å¾„ã€‚</li>
<li><strong>ä¸°å¯Œå˜æ¢</strong>: å†…ç½®åœ†å½¢ã€åœ†è§’ã€é«˜æ–¯æ¨¡ç³Šç­‰å¸¸ç”¨å›¾ç‰‡å˜æ¢ã€‚</li>
<li><strong>é¢„åŠ è½½/ä¸‹è½½</strong>: æ”¯æŒå›¾ç‰‡é¢„åŠ è½½åˆ°å†…å­˜æˆ–ä»…ä¸‹è½½åˆ°ç£ç›˜ã€‚</li>
<li><strong>Javaå…¼å®¹</strong>: æä¾› <code>FluxLoader</code> å·¥å…·ç±»ï¼Œå®Œç¾å…¼å®¹ Java è°ƒç”¨ã€‚</li>
</ul>
<h3 data-id="heading-3">æ¥å…¥æŒ‡å—</h3>
<p>æœ¬æ–‡æ¡£æä¾›äº†å°† GalleryPicker åº“é›†æˆåˆ°æ‚¨çš„ Android åº”ç”¨ç¨‹åºä¸­çš„è¯¦ç»†æŒ‡å—ã€‚</p>
<h4 data-id="heading-4">1. æ·»åŠ ä¾èµ–</h4>
<p>åœ¨æ‚¨çš„é¡¹ç›® <code>build.gradle</code> æ–‡ä»¶ä¸­æ·»åŠ  JitPack ä»“åº“å’Œä¾èµ–é¡¹ã€‚</p>
<p><strong>æ ¹ç›®å½• <code>build.gradle</code>:</strong></p>
<pre><code class="hljs language-gradle" lang="gradle">allprojects {
    repositories {
        ...
        maven { url 'https://jitpack.io' }
    }
}
</code></pre>
<p><strong>App æ¨¡å— <code>build.gradle</code>:</strong></p>
<pre><code class="hljs language-gradle" lang="gradle">dependencies {
    implementation 'com.github.darryrzhong:FluxImageLoader:1.0.0' // è¯·æ£€æŸ¥æœ€æ–°ç‰ˆæœ¬
}
</code></pre>
<h3 data-id="heading-5">å¿«é€Ÿå¼€å§‹</h3>
<h4 data-id="heading-6">1. åˆå§‹åŒ–</h4>
<p>åœ¨ Application çš„ <code>onCreate</code> æ–¹æ³•ä¸­è¿›è¡Œåˆå§‹åŒ–é…ç½®ï¼š</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">import</span> com.flux.img.FluxImageLoader

<span class="hljs-keyword">class</span> <span class="hljs-title class_">MyApplication</span> : <span class="hljs-type">Application</span>() {
    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onCreate</span><span class="hljs-params">()</span></span> {
        <span class="hljs-keyword">super</span>.onCreate()
        
        <span class="hljs-comment">// åˆå§‹åŒ–é…ç½®</span>
        FluxImageLoader.getInstance()
            .setMaxMemorySizePercent(<span class="hljs-number">0.25</span>) <span class="hljs-comment">// æœ€å¤§å†…å­˜ç¼“å­˜æ¯”ä¾‹ (Appå¯ç”¨å†…å­˜ç™¾åˆ†æ¯”)</span>
            .setMaxDiskSizePercent(<span class="hljs-number">0.02</span>)   <span class="hljs-comment">// æœ€å¤§ç£ç›˜ç¼“å­˜æ¯”ä¾‹ (ç”¨æˆ·å¯ç”¨ç£ç›˜ç™¾åˆ†æ¯”)</span>
            .setDiskCacheFileName(<span class="hljs-string">"coil_image_cache"</span>) <span class="hljs-comment">// ç£ç›˜ç¼“å­˜ç›®å½•åç§°</span>
            .debug(BuildConfig.DEBUG)      <span class="hljs-comment">// å¼€å¯è°ƒè¯•æ—¥å¿—</span>
            .<span class="hljs-keyword">init</span>(<span class="hljs-keyword">this</span>)
    }
}
</code></pre>
<h4 data-id="heading-7">2. æ”¯æŒçš„æ ¼å¼</h4>
<ul>
<li><strong>é™æ€å›¾ç‰‡</strong>: BMP, JPEG, PNG, WebP, HEIF (Android 8.0+)</li>
<li><strong>åŠ¨å›¾</strong>: GIF, WebP (Android 9.0+), HEIF (Android 11.0+)</li>
<li><strong>SVG</strong>: æ”¯æŒ SVG æ ¼å¼è§£ç </li>
<li><strong>è§†é¢‘</strong>: æ”¯æŒåŠ è½½è§†é¢‘æ–‡ä»¶çš„ç¬¬ä¸€å¸§æˆ–æŒ‡å®šå¸§</li>
</ul>
<p align="center">
  <img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f070ecb1000c4370a1e59d1bfa96f8b4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTmVydmU=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765794812&amp;x-signature=8Zg%2F3ktYlWWlfpyWkKLqvUOhfvM%3D" alt="pickerè½¬å­˜å¤±è´¥ï¼Œå»ºè®®ç›´æ¥ä¸Šä¼ å›¾ç‰‡æ–‡ä»¶" width="206" height="443" loading="lazy"/>
</p>
<h3 data-id="heading-8">ä½¿ç”¨æŒ‡å— (Kotlin)</h3>
<p>æ¨èä½¿ç”¨ Kotlin æ‰©å±•æ–¹æ³•è¿›è¡Œè°ƒç”¨ï¼Œç®€æ´é«˜æ•ˆã€‚</p>
<h4 data-id="heading-9">åŸºç¡€åŠ è½½</h4>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">import</span> com.flux.img.load

<span class="hljs-comment">// åŠ è½½ç½‘ç»œå›¾ç‰‡</span>
imageView.load(<span class="hljs-string">"https://www.example.com/image.jpg"</span>)

<span class="hljs-comment">// åŠ è½½æœ¬åœ°æ–‡ä»¶</span>
imageView.load(File(<span class="hljs-string">"/path/to/image.jpg"</span>))

<span class="hljs-comment">// åŠ è½½èµ„æºID</span>
imageView.load(R.drawable.ic_launcher)

<span class="hljs-comment">// è®¾ç½®å ä½å›¾ (é»˜è®¤ä½¿ç”¨å†…ç½®å ä½å›¾ï¼Œä¼  0 æˆ–ä¸ä¼ ä½¿ç”¨é»˜è®¤)</span>
imageView.load(url, placeholder = R.drawable.custom_placeholder)
</code></pre>
<h4 data-id="heading-10">å›¾ç‰‡å˜æ¢</h4>
<h5 data-id="heading-11">åœ†å½¢å›¾ç‰‡</h5>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">import</span> com.flux.img.loadCircle

imageView.loadCircle(url)
</code></pre>
<h5 data-id="heading-12">åœ†è§’å›¾ç‰‡</h5>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">import</span> com.flux.img.loadRounded
<span class="hljs-keyword">import</span> com.flux.img.transform.RoundedCornersType
<span class="hljs-keyword">import</span> com.flux.loader.dp <span class="hljs-comment">// å‡è®¾ä½ æœ‰ dp æ‰©å±•ï¼Œæˆ–è€…ç›´æ¥ä¼  px å€¼</span>

<span class="hljs-comment">// ç»Ÿä¸€åœ†è§’</span>
imageView.loadRounded(url, radius = <span class="hljs-number">20f</span>)

<span class="hljs-comment">// æŒ‡å®šåœ†è§’ä½ç½® (ä¾‹å¦‚ï¼šå·¦ä¸Šå’Œå³ä¸Š)</span>
imageView.loadRounded(url, radius = <span class="hljs-number">20f</span>, cornersType = RoundedCornersType.TOP)
</code></pre>
<h5 data-id="heading-13">é«˜æ–¯æ¨¡ç³Š</h5>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">import</span> com.flux.img.loadBlur

<span class="hljs-comment">// åŸºç¡€é«˜æ–¯æ¨¡ç³Š (é»˜è®¤æ¨¡ç³ŠåŠå¾„ 10f)</span>
imageView.loadBlur(url)

<span class="hljs-comment">// è‡ªå®šä¹‰æ¨¡ç³ŠåŠå¾„å’Œåœ†è§’</span>
<span class="hljs-comment">// radius &gt; 0: åœ†è§’æ¨¡ç³Š</span>
<span class="hljs-comment">// radius &lt; 0: åœ†å½¢æ¨¡ç³Š (-1f)</span>
imageView.loadBlur(url, blurRadius = <span class="hljs-number">15f</span>, radius = <span class="hljs-number">20f</span>)
</code></pre>
<h4 data-id="heading-14">åŠ¨å›¾åŠ è½½</h4>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">import</span> com.flux.img.loadWebpAnim
<span class="hljs-keyword">import</span> com.flux.img.loadGif

<span class="hljs-comment">// åŠ è½½ WebP åŠ¨å›¾ (Android 9.0+ ä½¿ç”¨ Coilï¼Œ9.0ä»¥ä¸‹è‡ªåŠ¨é™çº§ä½¿ç”¨ Glide)</span>
imageView.loadWebpAnim(<span class="hljs-string">"https://www.example.com/anim.webp"</span>)

<span class="hljs-comment">// åŠ è½½ GIF</span>
imageView.loadGif(<span class="hljs-string">"https://www.example.com/anim.gif"</span>)
</code></pre>
<h4 data-id="heading-15">è·å– Bitmap / Drawable</h4>
<p>å½“ä¸éœ€è¦ç›´æ¥æ˜¾ç¤ºåœ¨ ImageView æ—¶ä½¿ç”¨ã€‚</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">import</span> com.flux.img.loadBitmap
<span class="hljs-keyword">import</span> com.flux.img.loadDrawable
<span class="hljs-keyword">import</span> com.flux.img.listener.LoadListener

<span class="hljs-comment">// è·å– Bitmap</span>
imageView.loadBitmap(url, <span class="hljs-keyword">object</span> : LoadListener&lt;Bitmap&gt; {
    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onSuccess</span><span class="hljs-params">(<span class="hljs-keyword">data</span>: <span class="hljs-type">Bitmap</span>)</span></span> {
        <span class="hljs-comment">// å¤„ç† Bitmap</span>
    }
    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onError</span><span class="hljs-params">(throwable: <span class="hljs-type">Throwable</span>)</span></span> {
        <span class="hljs-comment">// å¤„ç†é”™è¯¯</span>
    }
    <span class="hljs-comment">// å¯é€‰: onStart(), onCancel()</span>
})

<span class="hljs-comment">// è·å– Drawable</span>
imageView.loadDrawable(url, <span class="hljs-keyword">object</span> : LoadListener&lt;Drawable&gt; {
    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onSuccess</span><span class="hljs-params">(<span class="hljs-keyword">data</span>: <span class="hljs-type">Drawable</span>)</span></span> {
        <span class="hljs-comment">// å¤„ç† Drawable</span>
    }
    <span class="hljs-comment">// ...</span>
})
</code></pre>
<h4 data-id="heading-16">é¢„åŠ è½½ä¸ä¸‹è½½</h4>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">import</span> com.flux.img.preload
<span class="hljs-keyword">import</span> com.flux.img.preDownload

<span class="hljs-comment">// é¢„åŠ è½½åˆ°å†…å­˜ (å®ç°ç§’å¼€)</span>
preload(url, context)

<span class="hljs-comment">// é¢„ä¸‹è½½åˆ°ç£ç›˜ (ä¸è§£ç è¿›å†…å­˜ï¼Œé€‚åˆå¹¿å‘Šå›¾ç­‰)</span>
preDownload(url, context, <span class="hljs-keyword">object</span> : LoadListener&lt;<span class="hljs-built_in">Unit</span>&gt; {
    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onSuccess</span><span class="hljs-params">(<span class="hljs-keyword">data</span>: <span class="hljs-type">Unit</span>)</span></span> {
        <span class="hljs-comment">// ä¸‹è½½å®Œæˆ</span>
    }
})
</code></pre>
<h3 data-id="heading-17">ä½¿ç”¨æŒ‡å— (Java)</h3>
<p>Java ä»£ç è¯·ä½¿ç”¨ <code>FluxLoader</code> é™æ€æ–¹æ³•è°ƒç”¨ã€‚</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> com.flux.img.FluxLoader;

<span class="hljs-comment">// åŸºç¡€åŠ è½½</span>
FluxLoader.load(imageView, url);
FluxLoader.load(imageView, url, R.drawable.placeholder);

<span class="hljs-comment">// åœ†å½¢</span>
FluxLoader.loadCircle(imageView, url);

<span class="hljs-comment">// åœ†è§’</span>
FluxLoader.loadRounded(imageView, url, <span class="hljs-number">20f</span>);

<span class="hljs-comment">// é«˜æ–¯æ¨¡ç³Š</span>
FluxLoader.loadBlur(imageView, url);

<span class="hljs-comment">// é¢„åŠ è½½</span>
FluxLoader.preload(url, context);
</code></pre>
<h3 data-id="heading-18">èµ„æºé‡Šæ”¾</h3>
<p>Coil ä¼šè‡ªåŠ¨ç®¡ç†èµ„æºé‡Šæ”¾ï¼Œåœ¨ä»¥ä¸‹æƒ…å†µè‡ªåŠ¨å–æ¶ˆè¯·æ±‚ï¼š</p>
<ul>
<li>View æ‰€åœ¨çš„ Lifecycle è¿›å…¥ DESTROYED çŠ¶æ€</li>
<li>View è¢«è§£ç»‘ (Detached)</li>
</ul>
<p>æ‰‹åŠ¨å–æ¶ˆè¯·æ±‚ (ä»… Kotlin æ‰©å±•æ”¯æŒè¿”å› Disposable):</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">val</span> disposable = imageView.load(url)
disposable.dispose()
</code></pre>
<h4 data-id="heading-19">ç¼“å­˜æ¸…ç†</h4>
<p><code>FluxImageLoader</code> æä¾›äº†æ‰‹åŠ¨ç®¡ç†ç¼“å­˜çš„æ–¹æ³•ï¼Œå»ºè®®åœ¨ <code>Application</code> çš„ç”Ÿå‘½å‘¨æœŸå›è°ƒä¸­åˆç†è°ƒç”¨ä»¥ä¼˜åŒ–å†…å­˜ä½¿ç”¨ã€‚</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// æ¸…é™¤å†…å­˜ç¼“å­˜ (å»ºè®®åœ¨ onLowMemory ä¸­è°ƒç”¨)</span>
FluxImageLoader.getInstance().clearMemoryCache(context)

<span class="hljs-comment">// æ¸…é™¤ç£ç›˜ç¼“å­˜</span>
FluxImageLoader.getInstance().clearDiskCache(context)

<span class="hljs-comment">// æ•´ç†å†…å­˜ç¼“å­˜ (å»ºè®®åœ¨ onTrimMemory ä¸­è°ƒç”¨)</span>
FluxImageLoader.getInstance().trimMemoryCache(context)
</code></pre>
<p>ç¤ºä¾‹ (åœ¨ Application ä¸­):</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onLowMemory</span><span class="hljs-params">()</span></span> {
    <span class="hljs-keyword">super</span>.onLowMemory()
    <span class="hljs-comment">// ç³»ç»Ÿå†…å­˜ç´§å¼ ï¼Œç«‹å³æ¸…ç†å†…å­˜ç¼“å­˜</span>
    FluxImageLoader.getInstance().clearMemoryCache(<span class="hljs-keyword">this</span>)
}

<span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onTrimMemory</span><span class="hljs-params">(level: <span class="hljs-type">Int</span>)</span></span> {
    <span class="hljs-keyword">super</span>.onTrimMemory(level)
    <span class="hljs-keyword">when</span> (level) {
        <span class="hljs-comment">// App åˆ‡åˆ°åå°ï¼ŒUI ä¸å¯è§ || åå° App å†…å­˜ä½</span>
        ComponentCallbacks2.TRIM_MEMORY_UI_HIDDEN, ComponentCallbacks2.TRIM_MEMORY_BACKGROUND -&gt; {
            FluxImageLoader.getInstance().trimMemoryCache(<span class="hljs-keyword">this</span>)
        }
    }
}
</code></pre>
<h3 data-id="heading-20">æ³¨æ„äº‹é¡¹</h3>
<ul>
<li><code>@DrawableRes</code> èµ„æºå»ºè®®ç›´æ¥ä½¿ç”¨ <code>setImageResource</code>ï¼Œä½¿ç”¨åŠ è½½å™¨ä¼šäº§ç”Ÿä¸å¿…è¦çš„å¼€é”€ï¼Œé™¤ééœ€è¦åšå›¾ç‰‡å˜æ¢ã€‚</li>
<li>é«˜æ–¯æ¨¡ç³ŠåŠå¾„å¿…é¡»åœ¨ 0-25 ä¹‹é—´ã€‚</li>
<li>ç”±äºCoil3åº“ä»…æ”¯æŒåœ¨ Android API 28 ä»¥ä¸ŠåŠ è½½åŠ¨æ€ WebP å›¾ç‰‡,å¦‚æœéœ€è¦åœ¨ Android API 28 ä»¥ä¸‹åŠ è½½åŠ¨æ€ WebP å›¾ç‰‡ï¼Œè¯·è‡ªè¡Œä¾èµ– Glide åŠå…¶ WebP è§£ç åº“ã€‚</li>
</ul>
<pre><code class="hljs language-kotlin" lang="kotlin">def GLIDE_VERSION = <span class="hljs-string">"5.0.5"</span>
<span class="hljs-comment">// webpdecoder</span>
implementation <span class="hljs-string">"com.github.zjupure:webpdecoder:2.7.4.16.0"</span>
<span class="hljs-comment">// glide 4.10.0+</span>
implementation <span class="hljs-string">"com.github.bumptech.glide:glide:<span class="hljs-subst">${GLIDE_VERSION}</span>"</span>
kapt <span class="hljs-string">"com.github.bumptech.glide:compiler:<span class="hljs-subst">${GLIDE_VERSION}</span>"</span>
</code></pre>
<h3 data-id="heading-21">Proguard</h3>
<pre><code class="hljs language-kotlin" lang="kotlin">-keep <span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">com</span>.<span class="hljs-title">bumptech</span>.<span class="hljs-title">glide</span>.<span class="hljs-title">integration</span>.<span class="hljs-title">webp</span>.<span class="hljs-title">WebpImage</span> { *; }
-keep <span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">com</span>.<span class="hljs-title">bumptech</span>.<span class="hljs-title">glide</span>.<span class="hljs-title">integration</span>.<span class="hljs-title">webp</span>.<span class="hljs-title">WebpFrame</span> { *; }
-keep <span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">com</span>.<span class="hljs-title">bumptech</span>.<span class="hljs-title">glide</span>.<span class="hljs-title">integration</span>.<span class="hljs-title">webp</span>.<span class="hljs-title">WebpBitmapFactory</span> { *; }

-keep <span class="hljs-keyword">class</span> <span class="hljs-title class_">coil3</span>.<span class="hljs-title">util</span>.<span class="hljs-title">DecoderServiceLoaderTarget</span> { *; }
-keep <span class="hljs-keyword">class</span> <span class="hljs-title class_">coil3</span>.<span class="hljs-title">util</span>.<span class="hljs-title">FetcherServiceLoaderTarget</span> { *; }
-keep <span class="hljs-keyword">class</span> <span class="hljs-title class_">coil3</span>.<span class="hljs-title">util</span>.<span class="hljs-title">ServiceLoaderComponentRegistry</span> { *; }
-keep <span class="hljs-keyword">class</span> * implements coil3.util.DecoderServiceLoaderTarget { *; }
-keep <span class="hljs-keyword">class</span> * implements coil3.util.FetcherServiceLoaderTarget { *; }
</code></pre>
<h3 data-id="heading-22">Acknowledgments</h3>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fcoil-kt.github.io%2Fcoil%2F" target="_blank" title="https://coil-kt.github.io/coil/" ref="nofollow noopener noreferrer">Coil3</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fbumptech%2Fglide" target="_blank" title="https://github.com/bumptech/glide" ref="nofollow noopener noreferrer">Glide</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fzjupure%2FGlideWebpDecoder" target="_blank" title="https://github.com/zjupure/GlideWebpDecoder" ref="nofollow noopener noreferrer">GlideWebpDecoder</a></li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[å‰ç«¯è·¨é¡µé¢é€šè®¯ç»ˆææŒ‡å—â‘£ï¼šMessageChannel ç”¨æ³•å…¨è§£æ]]></title>    <link>https://juejin.cn/post/7580564126402576434</link>    <guid>https://juejin.cn/post/7580564126402576434</guid>    <pubDate>2025-12-07T12:18:33.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7580564126402576434" data-draft-id="7576369868418859044" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="å‰ç«¯è·¨é¡µé¢é€šè®¯ç»ˆææŒ‡å—â‘£ï¼šMessageChannel ç”¨æ³•å…¨è§£æ"/> <meta itemprop="keywords" content="å‰ç«¯"/> <meta itemprop="datePublished" content="2025-12-07T12:18:33.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ä¸€è¯ºæ»šé›ªçƒ"/> <meta itemprop="url" content="https://juejin.cn/user/2824015112318094"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            å‰ç«¯è·¨é¡µé¢é€šè®¯ç»ˆææŒ‡å—â‘£ï¼šMessageChannel ç”¨æ³•å…¨è§£æ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2824015112318094/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ä¸€è¯ºæ»šé›ªçƒ
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-07T12:18:33.000Z" title="Sun Dec 07 2025 12:18:33 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-07
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»5åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">å‰è¨€</h2>
<p>ä¸Šä¸€ç¯‡ä»‹ç»äº†<strong>Localstorage</strong>è·¨é¡µé¢é€šè®¯çš„æ–¹å¼ã€‚åœ¨å‰é¢çš„æ–‡ç« ä¸­ï¼Œä»‹ç»äº†å¤šç§è·¨é¡µé¢é€šä¿¡æ–¹å¼ï¼Œä»é€‚ç”¨äºåŒæºé¡µé¢çš„ <code>BroadcastChannel</code>ï¼Œåˆ°è§£å†³è·¨åŸŸçš„ <code>postMessage</code>ã€‚å½“å¤šä¸ªé€šä¿¡è¿›è¡Œæ··æ‚åœ¨ä¸€èµ·ï¼Œä½¿ç”¨å…¨å±€çš„<code>message</code>äº‹ä»¶ç›‘å¬æ—¶ï¼Œä¼šé€šè¿‡å„ç§ç±»å‹åˆ¤æ–­æ¶ˆæ¯æ¥æºè¿›è¡Œå¤„ç†ã€‚</p>
<p>é‚£æœ‰æ²¡æœ‰ä¸€ç§æ–¹æ³•ï¼Œæ—¢èƒ½å®ç°è·¨ä¸Šä¸‹æ–‡é€šä¿¡ï¼Œåˆèƒ½åƒæ‰“ç”µè¯ä¸€æ ·ï¼Œå»ºç«‹èµ·ä¸€æ¡<strong>ä¸“å±çš„ã€åŒå‘çš„ã€ç‚¹å¯¹ç‚¹çš„ç§å¯†é€šé“</strong>å‘¢ï¼Ÿ</p>
<p>ä»Šå¤©ä»‹ç»ä¸€ä¸ªæ–¹æ¡ˆâ€”â€”<strong>MessageChannel API</strong>ã€‚æä¾›äº†ä¸€ç§æ›´ä¸ºä¼˜é›…å’Œç§å¯†çš„æ–¹å¼ï¼Œå»ºç«‹èµ·ä¸€æ¡ç‚¹å¯¹ç‚¹çš„â€œä¸“çº¿ç”µè¯â€ï¼Œè®©é€šä¿¡åŒæ–¹å¯ä»¥æ¸…æ™°åœ°ã€æ— å¹²æ‰°åœ°å¯¹è¯ã€‚</p>
<h2 data-id="heading-1">1. MessageChannel æ˜¯ä»€ä¹ˆï¼Ÿ</h2>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fzh-CN%2Fdocs%2FWeb%2FAPI%2FChannel_Messaging_API" target="_blank" title="https://developer.mozilla.org/zh-CN/docs/Web/API/Channel_Messaging_API" ref="nofollow noopener noreferrer">Channel Messaging API</a>Â çš„Â <strong><code>MessageChannel</code></strong>Â æ¥å£å…è®¸æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªæ–°çš„æ¶ˆæ¯é€šé“ï¼Œå¹¶é€šè¿‡å®ƒçš„ä¸¤ä¸ªÂ <a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fzh-CN%2Fdocs%2FWeb%2FAPI%2FMessagePort" target="_blank" title="https://developer.mozilla.org/zh-CN/docs/Web/API/MessagePort" ref="nofollow noopener noreferrer"><code>MessagePort</code></a>Â å±æ€§å‘é€æ•°æ®ã€‚</p>
<p>æ ¸å¿ƒæ˜¯åˆ›å»ºä¸€ä¸ª<strong>åŒå‘é€šè®¯çš„ç®¡é“</strong>ï¼Œè¿™ä¸ªç®¡é“åŒ…å«ä¸¤ä¸ªç›¸äº’å…³è”çš„ç«¯å£â€”â€”<code>port1</code> å’Œ <code>port2</code>ã€‚æ•°æ®ä» port1 å‘é€ï¼Œå°±åªèƒ½ç”± port2 æ¥æ”¶ï¼›åä¹‹ï¼Œport2 å‘é€çš„æ•°æ®ä¹Ÿåªèƒ½è¢« port1 æ•è·ï¼Œè¿™ç§â€œç‚¹å¯¹ç‚¹â€çš„é€šè®¯æ¨¡å¼ï¼Œä»æ ¹æºä¸Šé¿å…äº†æ•°æ®è¢«æ— å…³é¡µé¢æ‹¦æˆªçš„é£é™©ã€‚</p>
<p>ä¸¾ä¸ªé€šä¿—çš„ä¾‹å­ï¼š BroadcastChannel æ˜¯â€œå°åŒºå¹¿æ’­â€ï¼Œæ‰€æœ‰äººéƒ½èƒ½å¬åˆ°ï¼›è€Œ MessageChannel å°±æ˜¯â€œä¸“çº¿ç”µè¯â€ï¼Œåªæœ‰ä¸¤ä¸ªç«¯å£å¯¹åº”çš„è®¾å¤‡èƒ½æ¥é€šã€‚</p>
<h2 data-id="heading-2">2. å¦‚ä½•ä½¿ç”¨</h2>
<p>ä½¿ç”¨ <code>MessageChannel</code> æµç¨‹å¦‚ä¸‹ï¼š</p>
<ol>
<li><strong>åˆ›å»ºé€šé“</strong>ï¼š åˆ›å»ºä¸€ä¸ª <code>MessageChannel</code> å®ä¾‹ï¼ŒåŒ…å«ä¸¤ä¸ªç«¯å£å±æ€§ï¼š<code>port1</code> å’Œ <code>port2</code>ã€‚</li>
</ol>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">const</span> channel = <span class="hljs-keyword">new</span> <span class="hljs-title class_">MessageChannel</span>();

<span class="hljs-comment">// channel.port1 å’Œ channel.port2 éƒ½æ˜¯ MessagePort å¯¹è±¡</span>
</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7c0a6bc583d24a04a01697afbbd6b593~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiA6K-65rua6Zuq55CD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765714713&amp;x-signature=h9mIZ%2FHNQmjWHrH7NoIABZ9zigA%3D" alt="image.png" loading="lazy"/></p>
<ol start="2">
<li><strong>ç›‘å¬æ¶ˆæ¯</strong>ï¼š åœ¨å…¶ä¸­ä¸€ä¸ªç«¯å£ä¸Šè®¾ç½® <code>onmessage</code> äº‹ä»¶å¤„ç†å™¨ï¼Œç”¨äºæ¥æ”¶æ¥è‡ªå¦ä¸€ä¸ªç«¯å£çš„æ¶ˆæ¯ã€‚</li>
</ol>
<pre><code class="hljs language-js" lang="js">channel.<span class="hljs-property">port1</span>.<span class="hljs-property">onmessage</span> = <span class="hljs-function">(<span class="hljs-params">event</span>) =&gt;</span> {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'æ”¶åˆ°æ¶ˆæ¯:'</span>, event.<span class="hljs-property">data</span>);
};
</code></pre>
<ol start="3">
<li><strong>å‘é€æ¶ˆæ¯</strong>ï¼š é€šè¿‡ä¸€ä¸ªç«¯å£çš„ <code>postMessage</code>æ–¹æ³•å‘å¦ä¸€ä¸ªç«¯å£å‘é€æ•°æ®ã€‚</li>
</ol>
<pre><code class="hljs language-js" lang="js">channel.<span class="hljs-property">port2</span>.<span class="hljs-title function_">postMessage</span>(<span class="hljs-string">'Hello from port2!'</span>);
</code></pre>
<ol start="4">
<li><strong>è½¬ç§»ç«¯å£æ‰€æœ‰æƒ</strong> ï¼š <code>MessageChannel</code> çš„å¨åŠ›åœ¨äºå¯ä»¥å°†ä¸€ä¸ªç«¯å£å‘é€åˆ°å¦ä¸€ä¸ªæµè§ˆä¸Šä¸‹æ–‡ï¼ˆä¾‹å¦‚ iframeï¼‰ã€‚è¿™éœ€è¦é€šè¿‡ <code>window.postMessage</code> çš„ç¬¬ä¸‰ä¸ªå‚æ•° <code>transfer</code> æ¥å®ç°, å¯ä»¥ç›´æ¥å°†ç«¯å£ä¸‹å‘åˆ°ä¸¤ä¸ªå­iframe,ç›´æ¥è¿›è¡Œé€šè®¯ã€‚</li>
</ol>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// å‡è®¾ iframe æ˜¯æˆ‘ä»¬æƒ³è¦é€šä¿¡çš„ç›®æ ‡</span>
<span class="hljs-keyword">const</span> iframe = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelector</span>(<span class="hljs-string">'iframe'</span>).<span class="hljs-property">contentWindow</span>;

<span class="hljs-comment">// å°† port2 çš„æ‰€æœ‰æƒè½¬ç§»ç»™ iframe</span>
<span class="hljs-comment">// è½¬ç§»åï¼Œå½“å‰é¡µé¢å°±ä¸å†æ‹¥æœ‰ port2ï¼Œåªæœ‰ iframe èƒ½ä½¿ç”¨å®ƒ</span>

iframe.<span class="hljs-title function_">postMessage</span>(<span class="hljs-string">'init'</span>, <span class="hljs-string">'*'</span>, [channel.<span class="hljs-property">port2</span>]);
</code></pre>
<p>ä½¿ç”¨postMessageå‘é€ç«¯å£ä¼šå‡ºç°portsï¼š</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/083da7c6bc5643a3ade3d23789ca5c8a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiA6K-65rua6Zuq55CD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765714713&amp;x-signature=kQNarFBKYkESaPUWjd9v2URFszY%3D" alt="image.png" loading="lazy"/></p>
<p>æ¥æ”¶æ–¹ï¼ˆiframeï¼‰å¯ä»¥åœ¨å…¶ <code>message</code> äº‹ä»¶ä¸­è·å–åˆ°è¿™ä¸ªç«¯å£ï¼Œå¼€å§‹é€šä¿¡ã€‚</p>
<h2 data-id="heading-3">3. å®è·µåœºæ™¯</h2>
<p>ä¸‹é¢ä½¿ç”¨MessageChannelè¿›è¡Œçˆ¶å­åŒå‘ã€å…„å¼Ÿé€šè®¯è¿›è¡Œè¯´æ˜ã€‚</p>
<h3 data-id="heading-4">3.1 çˆ¶å­åŒå‘é€šè®¯</h3>
<p>çˆ¶é¡µé¢å¼•å…¥ä¸€ä¸ª iframeï¼Œåˆ›å»ºMessageChannel,åˆå§‹åŒ–æ—¶å°†å…¶ä¸­ä¸€ä¸ª<code>port1</code>ä½¿ç”¨<code>postMessage</code>ä¼ é€’ï¼Œåé¢ç›´æ¥é€šè¿‡portè¿›è¡ŒåŒå‘é€šè®¯ã€‚</p>
<p>æ­¥éª¤1ï¼šçˆ¶é¡µé¢ï¼ˆå‘é€ç«¯å£+é€šè®¯é€»è¾‘ï¼‰</p>
<pre><code class="hljs language-ini" lang="ini">// 1. åˆ›å»º MessageChannel å®ä¾‹ï¼Œç”Ÿæˆä¸¤ä¸ªç«¯å£
const <span class="hljs-attr">channel</span> = new MessageChannel()<span class="hljs-comment">;</span>
const { port1, port2 } = channel<span class="hljs-comment">;</span>

// 2. è·å– iframe å…ƒç´ ï¼Œç›‘å¬åŠ è½½å®Œæˆäº‹ä»¶
const <span class="hljs-attr">iframe</span> = document.getElementById(<span class="hljs-string">'myIframe'</span>)<span class="hljs-comment">;</span>
<span class="hljs-attr">iframe.onload</span> = () =&gt; {
  // 3. å‘ iframe ä¼ é€’ port2ï¼ˆå…³é”®ï¼šåªæœ‰ä¼ é€’ç«¯å£åæ‰èƒ½é€šè®¯ï¼‰
  iframe.contentWindow.postMessage('init', '*', <span class="hljs-section">[port2]</span>)<span class="hljs-comment">;</span>
}<span class="hljs-comment">;</span>

// 4. ç›‘å¬ port1 æ¥æ”¶çš„æ¶ˆæ¯ï¼ˆæ¥è‡ª iframeï¼‰
<span class="hljs-attr">port1.onmessage</span> = (e) =&gt; {
  console.log('çˆ¶é¡µé¢æ”¶åˆ° iframe æ¶ˆæ¯ï¼š', e.data)<span class="hljs-comment">;</span>
  // æ”¶åˆ°æ¶ˆæ¯åå›å¤
  if (<span class="hljs-attr">e.data</span> === <span class="hljs-string">'hello from iframe'</span>) {
    port1.postMessage('hi iframe, I am parent')<span class="hljs-comment">;</span>
  }
}<span class="hljs-comment">;</span>

// 5. å¯é€‰ï¼šç›‘å¬é”™è¯¯äº‹ä»¶
<span class="hljs-attr">port1.onerror</span> = (error) =&gt; {
  console.error('é€šè®¯é”™è¯¯ï¼š', error)<span class="hljs-comment">;</span>
  port1.close()<span class="hljs-comment">; // å‡ºé”™åå…³é—­ç«¯å£</span>
}<span class="hljs-comment">;</span>
</code></pre>
<p>æ­¥éª¤2ï¼šiframe é¡µé¢ï¼ˆæ¥æ”¶ç«¯å£+å“åº”é€»è¾‘ï¼‰</p>
<pre><code class="hljs language-ini" lang="ini">// 1. ç›‘å¬çˆ¶é¡µé¢å‘é€çš„åˆå§‹åŒ–æ¶ˆæ¯
<span class="hljs-attr">window.onmessage</span> = (e) =&gt; {
  // 2. éªŒè¯æ¶ˆæ¯ç±»å‹ï¼Œè·å–ä¼ é€’çš„ port2
  if (<span class="hljs-attr">e.data</span> === <span class="hljs-string">'init'</span> &amp;&amp; e.ports.length) {
    const <span class="hljs-attr">port2</span> = e.ports[<span class="hljs-number">0</span>]<span class="hljs-comment">;</span>

    // 3. ç›‘å¬ port2 æ¥æ”¶çš„æ¶ˆæ¯ï¼ˆæ¥è‡ªçˆ¶é¡µé¢ï¼‰
    <span class="hljs-attr">port2.onmessage</span> = (msg) =&gt; {
      console.log('iframe æ”¶åˆ°çˆ¶é¡µé¢æ¶ˆæ¯ï¼š', msg.data)<span class="hljs-comment">;</span>
    }<span class="hljs-comment">;</span>

    // 4. å‘çˆ¶é¡µé¢å‘é€æ¶ˆæ¯
    port2.postMessage('hello from iframe')<span class="hljs-comment">;</span>
  }
}<span class="hljs-comment">;</span>
</code></pre>
<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼š</p>
<ul>
<li>çˆ¶é¡µé¢é€šè¿‡ <code>postMessage</code> ä¼ é€’ port2 æ—¶ï¼Œå¿…é¡»å°† port2 æ”¾åœ¨ç¬¬ä¸‰ä¸ªå‚æ•°ï¼ˆtransferListï¼‰ä¸­ï¼Œè¿™æ˜¯ â€œç«¯å£ä¼ é€’â€çš„å›ºå®šå†™æ³•ï¼›</li>
<li>ç«¯å£ä¸€æ—¦ä¼ é€’ï¼Œçˆ¶é¡µé¢çš„ port2 å°±ä¼šå¤±æ•ˆï¼Œåªèƒ½é€šè¿‡ iframe ä¸­çš„ port2 é€šè®¯ã€‚</li>
</ul>
<h3 data-id="heading-5">3.2 å…„å¼Ÿé€šè®¯</h3>
<p><strong>å®ç°æ€è·¯æ˜¯ï¼š</strong> çˆ¶é¡µé¢ä½œä¸ºâ€œæ€»æœºâ€ï¼Œè´Ÿè´£åˆ›å»º <code>MessageChannel</code>ï¼Œå¹¶å°†ä¸¤ä¸ªç«¯å£åˆ†åˆ«åˆ†é…ç»™ä¸¤ä¸ª <code>iframe</code>ï¼Œè®©å®ƒä»¬ä¹‹é—´å»ºç«‹èµ·ç›´è¿ä¸“çº¿ã€‚</p>
<p>æ­¥éª¤1ï¼šçˆ¶é¡µé¢ä»£ç </p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">const</span> channel = <span class="hljs-keyword">new</span> <span class="hljs-title class_">MessageChannel</span>();
<span class="hljs-keyword">const</span> frame1 = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'frame1'</span>).<span class="hljs-property">contentWindow</span>;
<span class="hljs-keyword">const</span> frame2 = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'frame2'</span>).<span class="hljs-property">contentWindow</span>;
<span class="hljs-comment">// ç­‰å¾…ä¸¤ä¸ª iframe åŠ è½½å®Œæˆ</span>
<span class="hljs-keyword">let</span> loadCount = <span class="hljs-number">0</span>;
<span class="hljs-keyword">const</span> <span class="hljs-title function_">onLoad</span> = (<span class="hljs-params"/>) =&gt; {
  loadCount++;
  <span class="hljs-keyword">if</span> (loadCount === <span class="hljs-number">2</span>) {
    <span class="hljs-comment">// å°† port1 å‘é€ç»™ iframe1</span>
    frame1.<span class="hljs-title function_">postMessage</span>(<span class="hljs-string">'init'</span>, <span class="hljs-string">'*'</span>, [channel.<span class="hljs-property">port1</span>]);
    <span class="hljs-comment">// å°† port2 å‘é€ç»™ iframe2</span>
    frame2.<span class="hljs-title function_">postMessage</span>(<span class="hljs-string">'init'</span>, <span class="hljs-string">'*'</span>, [channel.<span class="hljs-property">port2</span>]);
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'çˆ¶é¡µé¢ï¼šä¸“çº¿å·²å»ºç«‹ï¼Œç«¯å£å·²åˆ†å‘ã€‚'</span>);
  }
};
<span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'frame1'</span>).<span class="hljs-property">onload</span> = onLoad;
<span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'frame2'</span>).<span class="hljs-property">onload</span> = onLoad;
</code></pre>
<p>æ­¥éª¤2ï¼šå­é¡µé¢æ¥æ”¶port</p>
<pre><code class="hljs language-js" lang="js">
<span class="hljs-keyword">let</span> port;
<span class="hljs-comment">// 1. æ¥å£ç«¯å£</span>
<span class="hljs-variable language_">window</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'message'</span>, <span class="hljs-function">(<span class="hljs-params">event</span>) =&gt;</span> {
  <span class="hljs-comment">// ç¡®è®¤æ˜¯çˆ¶é¡µé¢å‘æ¥çš„åˆå§‹åŒ–æ¶ˆæ¯ï¼Œå¹¶æ¥æ”¶ç«¯å£</span>
  <span class="hljs-keyword">if</span> (event.<span class="hljs-property">data</span> === <span class="hljs-string">'init'</span>) {
    port = event.<span class="hljs-property">ports</span>[<span class="hljs-number">0</span>];
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'iframe1ï¼šå·²æ¥æ”¶ port1ï¼Œå‡†å¤‡å‘é€æ¶ˆæ¯ã€‚'</span>);
  }
});
<span class="hljs-comment">// 2. å‘é€æ¶ˆæ¯</span>
<span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'sendBtn'</span>).<span class="hljs-property">onclick</span> = <span class="hljs-function">() =&gt;</span> {
  <span class="hljs-keyword">if</span> (port) {
    <span class="hljs-keyword">const</span> message = <span class="hljs-string">`æ¥è‡ª iframe1 çš„é—®å€™ï¼Œæ—¶é—´ï¼š<span class="hljs-subst">${<span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>().toLocaleTimeString()}</span>`</span>;
    port.<span class="hljs-title function_">postMessage</span>(message);
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'iframe1ï¼šæ¶ˆæ¯å·²å‘é€ -&gt;'</span>, message);
  }
};
<span class="hljs-comment">// 3. ç›‘å¬ port æ¶ˆæ¯</span>
port.<span class="hljs-property">onmessage</span> = <span class="hljs-function">(<span class="hljs-params">e</span>) =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'é¡µé¢Bæ”¶åˆ°æ¶ˆæ¯ï¼š'</span>, e.<span class="hljs-property">data</span>);
};
</code></pre>
<p>å®é™…æ•ˆæœï¼š</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ec819d8e1557474595cb35b95692f93f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiA6K-65rua6Zuq55CD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765714713&amp;x-signature=9RRQm6Vc1QOJrnz2llHw63vTTwg%3D" alt="image.png" loading="lazy"/>
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8f5c6321a9ba40d1b7191f7fc57da9c9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiA6K-65rua6Zuq55CD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765714713&amp;x-signature=BX9y9jns2dwjr4oeO%2FMbgzkDv3c%3D" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-6">4. æ³¨æ„äº‹é¡¹</h2>
<ol>
<li>ç«¯å£ä¼ é€’å¿…é¡»ç”¨ transferList</li>
</ol>
<p>ä¼ é€’ç«¯å£æ—¶ï¼Œå¿…é¡»å°† port æ”¾åœ¨ <code>postMessage</code> çš„ç¬¬ä¸‰ä¸ªå‚æ•°ï¼ˆtransferListï¼‰ä¸­ï¼Œè€Œä¸æ˜¯ä½œä¸ºç¬¬ä¸€ä¸ªå‚æ•°ï¼ˆdataï¼‰ã€‚é”™è¯¯å†™æ³•ä¼šå¯¼è‡´ç«¯å£æ— æ³•æ­£å¸¸ç»‘å®šï¼Œé€šè®¯å¤±æ•ˆã€‚</p>
<ol start="2">
<li>é€šè®¯å®ŒæˆååŠæ—¶å…³é—­ç«¯å£</li>
</ol>
<p>ä¸éœ€è¦é€šè®¯æ—¶ï¼Œè°ƒç”¨ <code>port.close()</code> å…³é—­ç«¯å£ï¼Œé¿å…å†…å­˜æ³„æ¼ã€‚</p>
<h2 data-id="heading-7">5. æ€»ç»“</h2>
<p>æœ€åæ€»ç»“ä¸€ä¸‹ï¼š<code>MessageChannel</code> é€šè¿‡åˆ›å»ºä¸€ä¸ªä¸“å±çš„åŒå‘é€šé“ï¼Œè§£å†³äº†ç‚¹å¯¹ç‚¹é€šä¿¡çš„éœ€æ±‚ï¼Œå”¯ä¸€ä¸è¶³çš„æ˜¯æ— è®ºæ˜¯çˆ¶å­è¿˜æ˜¯å…„å¼Ÿé€šè®¯éƒ½æ˜¯éœ€è¦ä½¿ç”¨<code>postMessage</code>è¿›è¡Œä¼ é€’ç«¯å£ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Dify è‡ªå»ºéƒ¨ç½²å®Œå…¨æŒ‡å—ï¼šä»ä¸Šæ‰‹åˆ°æ”¾å¼ƒåˆ°çœŸé¦™]]></title>    <link>https://juejin.cn/post/7580394927977545747</link>    <guid>https://juejin.cn/post/7580394927977545747</guid>    <pubDate>2025-12-07T06:34:07.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7580394927977545747" data-draft-id="7580389111920476223" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Dify è‡ªå»ºéƒ¨ç½²å®Œå…¨æŒ‡å—ï¼šä»ä¸Šæ‰‹åˆ°æ”¾å¼ƒåˆ°çœŸé¦™"/> <meta itemprop="keywords" content="äººå·¥æ™ºèƒ½"/> <meta itemprop="datePublished" content="2025-12-07T06:34:07.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="lomocode"/> <meta itemprop="url" content="https://juejin.cn/user/2103792315926697"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Dify è‡ªå»ºéƒ¨ç½²å®Œå…¨æŒ‡å—ï¼šä»ä¸Šæ‰‹åˆ°æ”¾å¼ƒåˆ°çœŸé¦™
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2103792315926697/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    lomocode
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-07T06:34:07.000Z" title="Sun Dec 07 2025 06:34:07 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-07
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»10åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/74f727f9968d4428880f3c21dce64c10~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgbG9tb2NvZGU=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765694046&amp;x-signature=hFc0JgyH0UO9B3jSJpHDOsGF62A%3D" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-0">æ•…äº‹çš„å¼€å§‹ï¼šå°±æƒ³è¦ä¸ªå¬è¯çš„ AI åº”ç”¨å¹³å°</h2>
<p>å‡ ä¸ªæœˆå‰ï¼Œè€æ¿çªç„¶æ‰¾åˆ°æˆ‘ï¼š"é‚£ä¸ªè°å•Šï¼Œå’±ä»¬ä¹Ÿå¾—æä¸ª AI åº”ç”¨å¹³å°ï¼Œè¦èƒ½æ¥å…¥å„ç§æ¨¡å‹ï¼Œæ•°æ®å¿…é¡»åœ¨è‡ªå·±æ‰‹é‡Œï¼Œæœ€å¥½ä¸‹å‘¨å°±èƒ½ç”¨ä¸Šã€‚"</p>
<p>æˆ‘å¿ƒæƒ³ï¼Œè¿™ä¸æ˜¯ Coze å—ï¼Ÿæ‰“å¼€æµè§ˆå™¨å‡†å¤‡æ³¨å†Œè´¦å·ï¼Œçªç„¶æƒ³èµ·ä¸Šæ¬¡æ•°æ®åˆè§„ä¼šè®®ä¸Šæ³•åŠ¡éƒ¨é‚£å¼ ä¸¥è‚ƒçš„è„¸..."æ‰€æœ‰å®¢æˆ·æ•°æ®ä¸å¾—ä¸Šä¼ è‡³ç¬¬ä¸‰æ–¹å¹³å°"ã€‚</p>
<p>å¥½å§ï¼ŒCoze passã€‚</p>
<p>æ¥ä¸‹æ¥çš„ä¸€å‘¨ï¼Œæˆ‘åƒä¸ª AI åº”ç”¨å¹³å°è¯„æµ‹åšä¸»ï¼ŒæŠŠå¸‚é¢ä¸Šèƒ½æ‰¾åˆ°çš„éƒ½è¯•äº†ä¸ªéï¼š</p>
<p><strong>Cozeï¼ˆå­—èŠ‚è·³åŠ¨ï¼‰</strong> â€”â€” "å“‡ï¼Œè¿™ UI çœŸé¦™ï¼æ’ä»¶çœŸå¤šï¼" â†’ "ç­‰ç­‰ï¼Œæ•°æ®è¦ä¸Šä¼ ï¼Ÿå‘Šè¾ã€‚"</p>
<p><strong>FastGPT</strong> â€”â€” "çŸ¥è¯†åº“åŠŸèƒ½ä¸é”™" â†’ "å·¥ä½œæµæ€ä¹ˆè¿™ä¹ˆç®€é™‹ï¼Ÿ"</p>
<p><strong>LangFlow</strong> â€”â€” "èŠ‚ç‚¹æ‹–æ‹½å¾ˆé…·" â†’ "ä¸ºå•¥æ€»æ˜¯è«åå…¶å¦™æŠ¥é”™ï¼Ÿ"</p>
<p>æœ€åï¼Œçœ‹åˆ°äº† <strong>Dify</strong>ã€‚</p>





























<table><thead><tr><th>ç‰¹æ€§</th><th>çŠ¶æ€</th></tr></thead><tbody><tr><td>å¼€æºï¼Ÿ</td><td>æ˜¯</td></tr><tr><td>ç§æœ‰åŒ–ï¼Ÿ</td><td>æ˜¯</td></tr><tr><td>æ”¯æŒå„ç§æ¨¡å‹ï¼Ÿ</td><td>æ˜¯</td></tr><tr><td>å·¥ä½œæµå¼ºå¤§ï¼Ÿ</td><td>æ˜¯</td></tr><tr><td>Star æ•° 45k+ï¼Ÿ</td><td>æ˜¯</td></tr></tbody></table>
<p>"å°±æ˜¯ä½ äº†ï¼"æˆ‘ä¿¡å¿ƒæ»¡æ»¡åœ°å¯¹è€æ¿è¯´ï¼š"ç»™æˆ‘ä¸¤å¤©æ—¶é—´ï¼Œä¿è¯æå®šï¼"</p>
<p>ç„¶åï¼Œæˆ‘ç”¨äº†æ•´æ•´ä¸¤å‘¨...</p>
<p>è¿™ç¯‡æ–‡ç« ï¼Œå°±æ˜¯è¿™ä¸¤å‘¨è¡€æ³ªå²çš„å®Œæ•´è®°å½•ã€‚å¦‚æœä½ ä¹Ÿå‡†å¤‡è‡ªå»º Difyï¼Œå»ºè®®å…ˆæ³¡æ¯èŒ¶ï¼Œå› ä¸ºè¿™è¶Ÿæ—…ç¨‹ï¼Œæœ‰ç‚¹é•¿ã€‚</p>
<hr/>
<h2 data-id="heading-1">ç¬¬ä¸€å¤©ï¼šçœ‹ç€æ–‡æ¡£ä¿¡å¿ƒæ»¡æ»¡</h2>
<p>æ‹¿åˆ°ä»»åŠ¡åçš„ç¬¬ä¸€ä»¶äº‹ï¼Œå½“ç„¶æ˜¯çœ‹å®˜æ–¹æ–‡æ¡£ã€‚Dify çš„æ–‡æ¡£å†™å¾—è¿˜æŒºè¯¦ç»†ï¼Œç”šè‡³è´´å¿ƒåœ°æä¾›äº† docker-compose.yamlã€‚</p>
<p>æˆ‘è„‘æµ·é‡Œå·²ç»è§„åˆ’å¥½äº†æ•´ä¸ªæ¶æ„ï¼š</p>
<pre><code class="hljs language-mermaid" lang="mermaid">graph TB
    subgraph "ç†æƒ³ä¸­çš„æ¶æ„"
        User[ç”¨æˆ·] --&gt;|HTTPS| Nginx[Nginxåå‘ä»£ç†]
        Nginx --&gt; Web[Difyå‰ç«¯]
        Nginx --&gt; API[Dify API]
        API --&gt; DB[(PostgreSQL)]
        API --&gt; Cache[(Redis)]
        API --&gt; Models[æ¨¡å‹æœåŠ¡]

        Models --&gt; OpenAI[OpenAI]
        Models --&gt; DeepSeek[DeepSeek]
        Models --&gt; Local[è‡ªå»ºæ¨¡å‹]
    end

    style User fill:#e1f5fe
    style Models fill:#fff3e0
    style DB fill:#f3e5f5
</code></pre>
<p>"Docker Compose ä¸€æŠŠæ¢­ï¼Œä¸¤å°æ—¶æå®šï¼"æˆ‘ç”šè‡³å·²ç»å¼€å§‹æƒ³è±¡è€æ¿èµè®¸çš„çœ¼ç¥äº†ã€‚</p>
<p>ç„¶åæˆ‘ clone äº†ä»£ç ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">git <span class="hljs-built_in">clone</span> https://github.com/langgenius/dify.git
<span class="hljs-built_in">cd</span> dify
docker-compose up -d
</code></pre>
<p>5åˆ†é’Ÿåï¼Œæˆ‘çš„å±å¹•ä¸Šæ»¡æ˜¯çº¢è‰²çš„æŠ¥é”™ä¿¡æ¯...</p>
<hr/>
<h2 data-id="heading-2">ç¬¬äºŒå¤©åˆ°ç¬¬äº”å¤©ï¼šPostgreSQLï¼Œä½ åˆ°åº•è¦æˆ‘æ€æ ·ï¼Ÿ</h2>
<h3 data-id="heading-3">Day 2ï¼šæ•°æ®åº“å¯åŠ¨å¤±è´¥çš„æ—©æ™¨</h3>
<p>æ—©ä¸Š8ç‚¹ï¼Œæ³¡å¥½äº†ä¸€æ¯ä¸­å¹´ç”·äººä¸“å±çš„å¤§è¡¥èŒ¶ï¼Œå‡†å¤‡è§£å†³æ˜¨å¤©çš„æŠ¥é”™ã€‚çœ‹äº†ä¸‹æ—¥å¿—ï¼š</p>
<pre><code class="hljs language-csharp" lang="csharp">FATAL: role <span class="hljs-string">"postgres"</span> does <span class="hljs-keyword">not</span> exist
db <span class="hljs-keyword">init</span> failed, retrying...
db <span class="hljs-keyword">init</span> failed, retrying...
db <span class="hljs-keyword">init</span> failed, retrying...
</code></pre>
<p>"postgres è§’è‰²ä¸å­˜åœ¨ï¼Ÿ"æˆ‘æŒ äº†æŒ å¤´ï¼Œè¿™ä¸æ˜¯ PostgreSQL çš„é»˜è®¤è¶…çº§ç”¨æˆ·å—ï¼Ÿ</p>
<p>æ¥ä¸‹æ¥çš„4ä¸ªå°æ—¶ï¼Œæˆ‘å°è¯•äº†ï¼š</p>
<ul>
<li>æ”¹ç¯å¢ƒå˜é‡ âœ—</li>
<li>æ”¹å¯†ç  âœ—</li>
<li>æ”¹ç”¨æˆ·å âœ—</li>
<li>æ”¹ç«¯å£ âœ—</li>
<li>æ”¹äººç”Ÿ âœ—ï¼ˆå¼€ç©ç¬‘çš„ï¼‰</li>
</ul>
<p>ä¸­åˆåƒé¥­çš„æ—¶å€™ï¼Œçªç„¶çµå…‰ä¸€é—ªï¼š"ä¸ä¼šæ˜¯ä¹‹å‰çš„å®¹å™¨æ®‹ç•™æ•°æ®å§ï¼Ÿ"</p>
<p>æœç„¶ï¼<code>docker volume ls</code> ä¸€çœ‹ï¼Œä¸€å † dify ç›¸å…³çš„ volumes èººåœ¨é‚£é‡Œã€‚åŸæ¥ Docker çš„ Volume æ˜¯æŒä¹…åŒ–çš„ï¼Œå³ä½¿å®¹å™¨åˆ äº†ï¼Œæ•°æ®è¿˜åœ¨ã€‚è€Œ PostgreSQL æœ‰ä¸ªç‰¹æ€§ï¼šå¦‚æœæ•°æ®ç›®å½•éç©ºï¼Œå°±ä¸ä¼šé‡æ–°åˆå§‹åŒ–ã€‚</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># ç»ˆæå¤§æ‹›</span>
docker-compose down -v  <span class="hljs-comment"># è¿ volume ä¸€èµ·åˆ </span>
docker volume prune -f  <span class="hljs-comment"># å†è¡¥ä¸€åˆ€</span>
<span class="hljs-built_in">rm</span> -rf ./volumes/db/*   <span class="hljs-comment"># ç‰©ç†åˆ é™¤ï¼Œä»¥é˜²ä¸‡ä¸€</span>
</code></pre>
<p>å†æ¬¡å¯åŠ¨ï¼Œç»ˆäºçœ‹åˆ°äº†æœŸå¾…å·²ä¹…çš„ï¼š</p>
<pre><code class="hljs language-css" lang="css">PostgreSQL Database directory appears <span class="hljs-selector-tag">to</span> <span class="hljs-attribute">contain</span> <span class="hljs-selector-tag">a</span> database
db_1 | PostgreSQL init process complete; ready for start up.
</code></pre>
<p>é‚£ä¸€åˆ»ï¼Œæˆ‘å·®ç‚¹çƒ­æ³ªç›ˆçœ¶ã€‚</p>
<h3 data-id="heading-4">Day 3ï¼š77 å¼ è¡¨çš„çµå¼‚äº‹ä»¶</h3>
<p>æ•°æ®åº“èµ·æ¥äº†ï¼Œå¿ƒæƒ…å¤§å¥½ã€‚æ‰“å¼€ pgAdmin è¿ä¸Šå»çœ‹çœ‹ï¼Œå‡†å¤‡æ¬£èµä¸€ä¸‹ç©ºè¡è¡çš„æ•°æ®åº“ã€‚</p>
<p>ç»“æœ...77 å¼ è¡¨æ•´æ•´é½é½åœ°æ‘†åœ¨é‚£é‡Œã€‚</p>
<p>"æˆ‘è¿˜æ²¡åˆå§‹åŒ–å‘¢ï¼Œå“ªæ¥çš„è¡¨ï¼Ÿ" æˆ‘å¼€å§‹æ€€ç–‘æ˜¯ä¸æ˜¯æ’é¬¼äº†ã€‚</p>
<p>ä»”ç»†ä¸€çœ‹è¡¨åï¼š<code>migrations</code>ã€<code>users</code>ã€<code>apps</code>...è¿™ä¸æ˜¯ Dify çš„è¡¨å—ï¼Ÿå¯æ˜¯æˆ‘æ˜æ˜åˆšåˆ é™¤äº†æ‰€æœ‰æ•°æ®å•Šï¼Ÿ</p>
<p>èŠ±äº†ä¸€ä¸‹åˆæ’æŸ¥ï¼Œç»ˆäºå‘ç°çœŸç›¸ã€‚åŸæ¥æˆ‘åœ¨è°ƒè¯•è¿‡ç¨‹ä¸­ï¼Œå¤šæ¬¡ä½¿ç”¨ <code>git restore docker-compose.yaml</code> è¿˜åŸé…ç½®æ–‡ä»¶ï¼Œæ¯æ¬¡éƒ½ä¼šç”Ÿæˆä¸åŒçš„ volume åç§°ã€‚è€Œ PostgreSQL æ¯æ¬¡éƒ½ä¼šæ‰¾åˆ°æŸä¸ªæ—§çš„ volume å¹¶åŠ è½½ã€‚</p>
<p>è¿™å°±åƒæ˜¯ï¼Œä½ ä»¥ä¸ºè‡ªå·±ä½è¿›äº†æ–°æˆ¿å­ï¼Œç»“æœå‘ç°ä¸Šä¸€ä»»ç§Ÿå®¢çš„å®¶å…·éƒ½è¿˜åœ¨ã€‚</p>
<p>æ•™è®­ï¼š<strong>ä¸åªæ˜¯è¦åˆ  volumeï¼Œè¿˜è¦ç¡®ä¿ volume åç§°ä¸€è‡´ï¼Œæˆ–è€…å¹²è„†ç”¨ç»å¯¹è·¯å¾„æŒ‚è½½ã€‚</strong></p>
<h3 data-id="heading-5">Day 4ï¼šå‰ç«¯ç™½å±çš„ä¸‹åˆèŒ¶æ—¶å…‰</h3>
<p>æ•°æ®åº“æå®šäº†ï¼ŒæœåŠ¡ä¹Ÿéƒ½èµ·æ¥äº†ã€‚ä¸‹åˆ3ç‚¹ï¼Œæ³¡äº†æ¯èŒ¶ï¼Œå‡†å¤‡æ¬£èµè‡ªå·±çš„åŠ³åŠ¨æˆæœã€‚</p>
<p>æ‰“å¼€æµè§ˆå™¨ï¼Œè¾“å…¥ <code>http://localhost:3000</code></p>
<p>ç™½å±ã€‚</p>
<p>F12 æ‰“å¼€æ§åˆ¶å°ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-variable constant_">GET</span> <span class="hljs-attr">http</span>:<span class="hljs-comment">//localhost:3000/static/js/main.chunk.js 404</span>
<span class="hljs-variable constant_">GET</span> <span class="hljs-attr">http</span>:<span class="hljs-comment">//localhost:3000/static/css/main.css 404</span>
<span class="hljs-title class_">Uncaught</span> <span class="hljs-title class_">ReferenceError</span>: <span class="hljs-title class_">React</span> is not defined
</code></pre>
<p>"é™æ€èµ„æº 404ï¼Ÿ" æˆ‘è¿›åˆ°å®¹å™¨é‡Œä¸€çœ‹ï¼Œæ–‡ä»¶æ˜æ˜éƒ½åœ¨ <code>/app/web/dist</code> ç›®å½•ä¸‹ã€‚</p>
<p>åˆæ˜¯ä¸¤ä¸ªå°æ—¶çš„æ’æŸ¥ï¼Œå‘ç°æ˜¯ Nginx é…ç½®çš„é—®é¢˜ã€‚Dify çš„å‰ç«¯å®¹å™¨å·²ç»è‡ªå¸¦äº†ä¸€ä¸ª Node æœåŠ¡å™¨ï¼Œä¸éœ€è¦ Nginx ç›´æ¥ä»£ç†é™æ€æ–‡ä»¶ï¼Œè€Œæ˜¯è¦ä»£ç†åˆ°è¿™ä¸ª Node æœåŠ¡å™¨ã€‚</p>
<p>æ­£ç¡®çš„é…ç½®åº”è¯¥æ˜¯ï¼š</p>
<pre><code class="hljs language-nginx" lang="nginx">location / {
    proxy_pass http://web:3000;  # æ³¨æ„æ˜¯ 3000 ç«¯å£ï¼Œä¸æ˜¯ 80
    proxy_http_version 1.1;
    proxy_set_header Upgrade $http_upgrade;
    proxy_set_header Connection "upgrade";
}
</code></pre>
<p>æ”¹å®Œé…ç½®ï¼Œ<code>nginx -s reload</code>ï¼Œé¡µé¢ç»ˆäºå‡ºæ¥äº†ï¼</p>
<p>é‚£ä¸ªç†Ÿæ‚‰çš„ Dify Logo å‡ºç°åœ¨å±å¹•ä¸Šæ—¶ï¼Œæˆ‘æ„Ÿè§‰å°±åƒè§åˆ°äº†è€æœ‹å‹ã€‚</p>
<h3 data-id="heading-6">Day 5ï¼šDeepSeekï¼Œä½ ä¸æŒ‰å¥—è·¯å‡ºç‰Œå•Š</h3>
<p>åŸºç¡€ç¯å¢ƒæå®šï¼Œå¼€å§‹æ¥å…¥æ¨¡å‹ã€‚OpenAI çš„æ¥å…¥å¾ˆé¡ºåˆ©ï¼Œæ¯•ç«Ÿæ˜¯è¡Œä¸šæ ‡å‡†ã€‚ä½†åˆ°äº† DeepSeek...</p>
<p>åœ¨ Dify åå°å¡«å…¥ï¼š</p>
<ul>
<li>API Base: <code>https://api.deepseek.com/v1</code></li>
<li>API Key: <code>sk-xxxx</code></li>
</ul>
<p>æµ‹è¯•è¿æ¥ï¼Œè½¬äº†åŠå¤©ï¼Œè¶…æ—¶ã€‚</p>
<p>"ä¸åº”è¯¥å•Šï¼Œæˆ‘åœ¨æœ¬åœ°ç”¨ curl æµ‹è¯•æ˜¯æ­£å¸¸çš„ã€‚"</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># æœ¬åœ°æµ‹è¯• OK</span>
curl https://api.deepseek.com/v1/chat/completions \
  -H <span class="hljs-string">"Authorization: Bearer sk-xxx"</span> \
  -H <span class="hljs-string">"Content-Type: application/json"</span> \
  -d <span class="hljs-string">'{"model": "deepseek-chat", "messages": [{"role": "user", "content": "Hi"}]}'</span>
</code></pre>
<p>è¿›åˆ° Dify API å®¹å™¨é‡Œå†æµ‹è¯•ï¼Œä¹Ÿ OKã€‚ä½†ä» Dify ç•Œé¢å°±æ˜¯ä¸è¡Œã€‚</p>
<p>æŠ“åŒ…ï¼Œçœ‹æ—¥å¿—ï¼Œç¿»æºç ...æ™šä¸Š11ç‚¹ï¼Œç»ˆäºå‘ç°é—®é¢˜ï¼šDeepSeek çš„ API åœ¨å¤„ç† HTTP/2 è¯·æ±‚æ—¶æœ‰äº›ç‰¹æ®Šï¼Œè€Œ Dify ä½¿ç”¨çš„ Python requests åº“åœ¨æŸäº›æƒ…å†µä¸‹ä¼šå¼ºåˆ¶ä½¿ç”¨ HTTP/2ã€‚</p>
<p>è§£å†³æ–¹æ¡ˆå¾ˆé­”å¹»ï¼šç”¨ Nginx åšä¸ªä¸­è½¬ï¼Œå¼ºåˆ¶é™çº§åˆ° HTTP/1.1ã€‚</p>
<pre><code class="hljs language-nginx" lang="nginx"># deepseek ä¸“ç”¨è½¬å‘
location /deepseek-proxy/ {
    proxy_pass https://api.deepseek.com/;
    proxy_http_version 1.1;  # å…³é”®æ˜¯è¿™è¡Œ
    proxy_ssl_server_name on;
    proxy_set_header Host api.deepseek.com;
    proxy_set_header Authorization $http_authorization;
}
</code></pre>
<p>ç„¶ååœ¨ Dify é‡Œå¡« <code>http://nginx/deepseek-proxy</code> ä½œä¸º API Baseã€‚</p>
<p>è™½ç„¶è§£å†³äº†ï¼Œä½†æ€»æ„Ÿè§‰åƒæ˜¯ç”¨åˆ›å¯è´´ä¿®è¡¥è½¯ä»¶ bug...</p>
<hr/>
<h2 data-id="heading-7">ç¬¬å…­å¤©ï¼šSGLangï¼Œä¸€ä¸ªç©ºæ ¼å¼•å‘çš„è¡€æ¡ˆ</h2>
<p>è‡ªå»ºæ¨¡å‹ä¹Ÿè¦æ¥è¿›æ¥ã€‚æˆ‘ä»¬ç”¨çš„æ˜¯ SGLangï¼Œä¸€ä¸ªé«˜æ€§èƒ½çš„æ¨ç†æ¡†æ¶ã€‚éƒ¨ç½²å¾ˆé¡ºåˆ©ï¼ŒAPI ä¹Ÿé€šäº†ï¼Œä½†å¼€å¯æµå¼è¾“å‡ºåï¼ŒDify åˆå¼€å§‹æŠ¥é”™ï¼š</p>
<pre><code class="hljs language-lua" lang="lua">Invalid chunk <span class="hljs-built_in">format</span>: expecting <span class="hljs-string">'data:'</span> prefix
</code></pre>
<p>"data: å‰ç¼€ï¼Ÿæ˜æ˜æœ‰å•Šï¼" æˆ‘ç›¯ç€è¿”å›çš„æ•°æ®çœ‹äº†åŠå¤©ã€‚</p>
<p>ç”¨ Postman æµ‹è¯• SGLang çš„æµå¼è¾“å‡ºï¼š</p>
<pre><code class="hljs language-css" lang="css">data:{"choices":[{"delta":{"<span class="hljs-attribute">content</span>":<span class="hljs-string">"Hello"</span>}}]}
</code></pre>
<p>ç”¨ Postman æµ‹è¯• OpenAI çš„æµå¼è¾“å‡ºï¼š</p>
<pre><code class="hljs language-css" lang="css">data: {"choices": [{"delta": {"<span class="hljs-attribute">content</span>": <span class="hljs-string">"Hello"</span>}}]}
</code></pre>
<p>ä½ å‘ç°åŒºåˆ«äº†å—ï¼Ÿæˆ‘ç›¯äº† 10 åˆ†é’Ÿæ‰å‘ç°ï¼š<strong>SGLang åœ¨ <code>data:</code> åé¢å°‘äº†ä¸€ä¸ªç©ºæ ¼ï¼</strong></p>
<p>å°±è¿™ä¹ˆä¸€ä¸ªç©ºæ ¼ï¼Œè®©æˆ‘è°ƒè¯•äº†æ•´æ•´ä¸€ä¸ªæ™šä¸Šã€‚</p>
<p>æœ€åå†™äº†ä¸ªä¸­é—´ä»¶ä¸“é—¨åŠ ç©ºæ ¼ï¼š</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">fix_sse_format</span>(<span class="hljs-params">original_stream</span>):
    <span class="hljs-keyword">async</span> <span class="hljs-keyword">for</span> chunk <span class="hljs-keyword">in</span> original_stream:
        <span class="hljs-keyword">if</span> chunk.startswith(<span class="hljs-string">b'data:'</span>) <span class="hljs-keyword">and</span> <span class="hljs-keyword">not</span> chunk.startswith(<span class="hljs-string">b'data: '</span>):
            chunk = <span class="hljs-string">b'data: '</span> + chunk[<span class="hljs-number">5</span>:]  <span class="hljs-comment"># åŠ ä¸ªç©ºæ ¼</span>
        <span class="hljs-keyword">yield</span> chunk + <span class="hljs-string">b'\n\n'</span>
</code></pre>
<p>å½“è¿™ä¸ª fix ç”Ÿæ•ˆçš„æ—¶å€™ï¼Œæˆ‘çš„å¿ƒæƒ…å¾ˆå¤æ‚ã€‚ä¸€æ–¹é¢ç»ˆäºè§£å†³äº†é—®é¢˜ï¼Œå¦ä¸€æ–¹é¢è§‰å¾—"ç¨‹åºå‘˜çš„äººç”Ÿå°±æ˜¯åœ¨å¤„ç†å„ç§ç©ºæ ¼ã€åˆ†å·ã€æ‹¬å·"...</p>
<hr/>
<h2 data-id="heading-8">ç¬¬ä¸ƒå¤©åˆ°ç¬¬åå¤©ï¼šä»"èƒ½è·‘"åˆ°"èƒ½ç”¨"</h2>
<p>åŸºç¡€ç¯å¢ƒæ­å¥½äº†ï¼Œæ¨¡å‹ä¹Ÿæ¥é€šäº†ï¼Œä½†è¿™åªæ˜¯"èƒ½è·‘"ï¼Œç¦»"èƒ½ç”¨"è¿˜æœ‰è·ç¦»ã€‚</p>
<h3 data-id="heading-9">æ€§èƒ½ä¼˜åŒ–ï¼šä¸ºä»€ä¹ˆè¿™ä¹ˆæ…¢ï¼Ÿ</h3>
<p>ç¬¬ä¸€ä¸ªç”¨æˆ·åé¦ˆæ¥äº†ï¼š"ä¸ºä»€ä¹ˆç¬¬ä¸€æ¬¡å¯¹è¯è¦ç­‰ 5 ç§’é’Ÿï¼Ÿ"</p>
<p>æˆ‘æµ‹äº†ä¸€ä¸‹ï¼Œç¡®å®æ…¢ï¼š</p>
<ul>
<li>å†·å¯åŠ¨ï¼š3-5 ç§’</li>
<li>çŸ¥è¯†åº“æ£€ç´¢ï¼š10+ ç§’</li>
<li>å¹¶å‘ 20 äººå°±å¼€å§‹å¡</li>
</ul>
<p>å¼€å§‹ä¼˜åŒ–ä¹‹æ—…ï¼š</p>
<p><strong>1. æ¨¡å‹è¿æ¥é¢„çƒ­</strong></p>
<p>åŸæ¥æ¯æ¬¡ç”¨æˆ·ç¬¬ä¸€æ¬¡å¯¹è¯ï¼ŒDify æ‰ä¼šå»å»ºç«‹æ¨¡å‹è¿æ¥ã€‚æ”¹æˆå¯åŠ¨æ—¶é¢„åŠ è½½ï¼š</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># å¯åŠ¨æ—¶å°±æŠŠå¸¸ç”¨æ¨¡å‹è¿æ¥å»ºå¥½</span>
PRELOAD_MODELS = [<span class="hljs-string">'gpt-4'</span>, <span class="hljs-string">'deepseek-chat'</span>, <span class="hljs-string">'local-llama'</span>]
<span class="hljs-keyword">for</span> model <span class="hljs-keyword">in</span> PRELOAD_MODELS:
    <span class="hljs-keyword">try</span>:
        test_connection(model)
        logger.info(<span class="hljs-string">f"Model <span class="hljs-subst">{model}</span> preloaded"</span>)
    <span class="hljs-keyword">except</span>:
        logger.error(<span class="hljs-string">f"Failed to preload <span class="hljs-subst">{model}</span>"</span>)
</code></pre>
<p><strong>2. æ•°æ®åº“è¿æ¥æ± </strong></p>
<p>é»˜è®¤è¿æ¥æ± å¤ªå°äº†ï¼Œé«˜å¹¶å‘ç›´æ¥çˆ†ï¼š</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">environment:</span>
  <span class="hljs-bullet">-</span> <span class="hljs-string">SQLALCHEMY_POOL_SIZE=20</span>  <span class="hljs-comment"># åŸæ¥æ˜¯ 5</span>
  <span class="hljs-bullet">-</span> <span class="hljs-string">SQLALCHEMY_MAX_OVERFLOW=40</span>  <span class="hljs-comment"># åŸæ¥æ˜¯ 10</span>
</code></pre>
<p><strong>3. å‘é‡æ£€ç´¢ä¼˜åŒ–</strong></p>
<p>çŸ¥è¯†åº“ç”¨çš„æ˜¯å‘é‡æ•°æ®åº“ï¼Œé»˜è®¤æ˜¯æš´åŠ›æœç´¢ã€‚æ”¹æˆ HNSW ç´¢å¼•åï¼Œæ£€ç´¢é€Ÿåº¦æå‡ 10 å€ï¼š</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">CREATE</span> INDEX idx_embeddings <span class="hljs-keyword">ON</span> documents
<span class="hljs-keyword">USING</span> hnsw (embedding vector_cosine_ops)
<span class="hljs-keyword">WITH</span> (m <span class="hljs-operator">=</span> <span class="hljs-number">16</span>, ef_construction <span class="hljs-operator">=</span> <span class="hljs-number">64</span>);
</code></pre>
<p>ä¼˜åŒ–åçš„æ•ˆæœï¼š</p>






























<table><thead><tr><th>æŒ‡æ ‡</th><th>ä¼˜åŒ–å‰</th><th>ä¼˜åŒ–å</th></tr></thead><tbody><tr><td>å†·å¯åŠ¨</td><td>3.2s</td><td>0.8s</td></tr><tr><td>çŸ¥è¯†åº“æ£€ç´¢</td><td>12s</td><td>1.5s</td></tr><tr><td>å¹¶å‘æ”¯æŒ</td><td>20</td><td>200</td></tr><tr><td>å†…å­˜å ç”¨</td><td>8GB</td><td>3GB</td></tr></tbody></table>
<h3 data-id="heading-10">æ—¥å¿—ï¼Œæˆ‘çš„æ—¥å¿—å»å“ªäº†ï¼Ÿ</h3>
<p>å¤šå®¹å™¨ç¯å¢ƒæœ€å¤´ç–¼çš„å°±æ˜¯æŸ¥æ—¥å¿—ã€‚å‡ºé—®é¢˜äº†ï¼Œè¦è¿›å¥½å‡ ä¸ªå®¹å™¨æŒ¨ä¸ªçœ‹ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">docker logs dify-api
docker logs dify-web
docker logs dify-worker
docker logs nginx
</code></pre>
<p>æäº†ä¸ª ELK Stackï¼Œä½†å¤ªé‡äº†ã€‚æœ€åé€‰äº† Grafana Lokiï¼Œè½»é‡çº§æ­£åˆé€‚ï¼š</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">services:</span>
  <span class="hljs-attr">loki:</span>
    <span class="hljs-attr">image:</span> <span class="hljs-string">grafana/loki:latest</span>
    <span class="hljs-attr">volumes:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">./loki-config.yaml:/etc/loki/config.yaml</span>
    <span class="hljs-attr">command:</span> <span class="hljs-string">-config.file=/etc/loki/config.yaml</span>

  <span class="hljs-attr">promtail:</span>
    <span class="hljs-attr">image:</span> <span class="hljs-string">grafana/promtail:latest</span>
    <span class="hljs-attr">volumes:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">/var/lib/docker/containers:/var/lib/docker/containers:ro</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">./promtail-config.yaml:/etc/promtail/config.yaml</span>
    <span class="hljs-attr">command:</span> <span class="hljs-string">-config.file=/etc/promtail/config.yaml</span>
</code></pre>
<p>ç°åœ¨æ‰€æœ‰æ—¥å¿—éƒ½èƒ½åœ¨ Grafana é‡Œç»Ÿä¸€æŸ¥è¯¢äº†ï¼Œçˆ½ï¼</p>
<hr/>
<h2 data-id="heading-11">ç¬¬åä¸€å¤©ï¼šä¸Šçº¿å‰çš„æœ€åå‡†å¤‡</h2>
<h3 data-id="heading-12">HTTPSï¼Œä¸€å®šè¦æœ‰ HTTPS</h3>
<p>æµ‹è¯•ç¯å¢ƒç”¨ HTTP æ²¡é—®é¢˜ï¼Œä½†ç”Ÿäº§ç¯å¢ƒå¿…é¡»ä¸Š HTTPSã€‚ä¸ç„¶ï¼š</p>
<ul>
<li>WebSocket è¿ä¸ä¸Š</li>
<li>æµè§ˆå™¨è­¦å‘Šä¸å®‰å…¨</li>
<li>SSE æµå¼è¾“å‡ºå„ç§é—®é¢˜</li>
</ul>
<p>ç”¨ Let's Encrypt å…è´¹è¯ä¹¦ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">certbot certonly --webroot -w /var/www/html -d your-domain.com
</code></pre>
<p>Nginx é…ç½®ï¼š</p>
<pre><code class="hljs language-nginx" lang="nginx">server {
    listen 443 ssl http2;
    ssl_certificate /etc/letsencrypt/live/your-domain/fullchain.pem;
    ssl_certificate_key /etc/letsencrypt/live/your-domain/privkey.pem;

    # SSL ä¼˜åŒ–
    ssl_protocols TLSv1.2 TLSv1.3;
    ssl_ciphers HIGH:!aNULL:!MD5;
}
</code></pre>
<h3 data-id="heading-13">å¤‡ä»½ï¼Œæ°¸è¿œä¸è¦å¿˜è®°å¤‡ä»½</h3>
<p>å†™äº†ä¸ªå®šæ—¶å¤‡ä»½è„šæœ¬ï¼š</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-meta">#!/bin/bash</span>
<span class="hljs-comment"># backup.sh</span>

BACKUP_DIR=<span class="hljs-string">"/backup/dify/<span class="hljs-subst">$(date +%Y%m%d)</span>"</span>
<span class="hljs-built_in">mkdir</span> -p <span class="hljs-variable">$BACKUP_DIR</span>

<span class="hljs-comment"># å¤‡ä»½æ•°æ®åº“</span>
docker <span class="hljs-built_in">exec</span> postgres pg_dump -U postgres dify &gt; <span class="hljs-variable">$BACKUP_DIR</span>/db.sql

<span class="hljs-comment"># å¤‡ä»½é…ç½®æ–‡ä»¶</span>
<span class="hljs-built_in">cp</span> -r ./docker ./volumes <span class="hljs-variable">$BACKUP_DIR</span>/

<span class="hljs-comment"># å¤‡ä»½ä¸Šä¼ çš„æ–‡ä»¶</span>
docker <span class="hljs-built_in">cp</span> dify-api:/app/storage <span class="hljs-variable">$BACKUP_DIR</span>/storage

<span class="hljs-comment"># ä¿ç•™æœ€è¿‘ 7 å¤©çš„å¤‡ä»½</span>
find /backup/dify -<span class="hljs-built_in">type</span> d -mtime +7 -<span class="hljs-built_in">exec</span> <span class="hljs-built_in">rm</span> -rf {} +
</code></pre>
<p>åŠ åˆ° crontabï¼Œæ¯å¤©å‡Œæ™¨ 3 ç‚¹è‡ªåŠ¨å¤‡ä»½ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">0 3 * * * /path/to/backup.sh
</code></pre>
<hr/>
<h2 data-id="heading-14">ç¬¬åå››å¤©ï¼šç»ˆäºï¼ŒçœŸé¦™äº†</h2>
<p>ä¸¤å‘¨è¿‡å»äº†ï¼ŒDify ç»ˆäºç¨³å®šè¿è¡Œèµ·æ¥ã€‚çœ‹ç€ç›‘æ§é¢æ¿ä¸Šå¹³ç¨³çš„æ›²çº¿ï¼Œæˆ‘é•¿èˆ’ä¸€å£æ°”ã€‚</p>
<p>ç°åœ¨çš„æ¶æ„å›¾å˜æˆäº†è¿™æ ·ï¼š</p>
<pre><code class="hljs language-mermaid" lang="mermaid">graph TB
    subgraph "ç”Ÿäº§ç¯å¢ƒæ¶æ„"
        Users[ç”¨æˆ·] --&gt;|HTTPS| LB[è´Ÿè½½å‡è¡¡]
        LB --&gt; Nginx1[Nginx 1]
        LB --&gt; Nginx2[Nginx 2]

        Nginx1 --&gt; Web[Dify Web]
        Nginx1 --&gt; API[Dify API]
        Nginx2 --&gt; Web
        Nginx2 --&gt; API

        API --&gt; PG[(PostgreSQL&lt;br/&gt;ä¸»ä»å¤åˆ¶)]
        API --&gt; Redis[(Redis&lt;br/&gt;å“¨å…µæ¨¡å¼)]
        API --&gt; S3[å¯¹è±¡å­˜å‚¨]

        API --&gt; Models[æ¨¡å‹æœåŠ¡]
        Models --&gt; OpenAI
        Models --&gt; DeepSeek
        Models --&gt; SGLang[è‡ªå»º SGLang]

        Grafana[ç›‘æ§] --&gt; Prometheus
        Grafana --&gt; Loki

        style Users fill:#e1f5fe
        style Models fill:#fff3e0
        style PG fill:#f3e5f5
        style Grafana fill:#e8f5e9
    end
</code></pre>
<p>å›å¤´çœ‹è¿™ä¸¤å‘¨çš„ç»å†ï¼š</p>
<p><strong>è¸©è¿‡çš„å‘ï¼š</strong></p>
<ul>
<li>PostgreSQL åˆå§‹åŒ–é—®é¢˜</li>
<li>Docker Volume çš„å‘</li>
<li>é™æ€èµ„æº 404</li>
<li>DeepSeek HTTP/2 ä¸å…¼å®¹</li>
<li>SGLang æµå¼è¾“å‡ºæ ¼å¼</li>
<li>æ€§èƒ½ä¼˜åŒ–</li>
<li>æ—¥å¿—æ”¶é›†</li>
<li>HTTPS é…ç½®</li>
</ul>
<p><strong>æ”¶è·çš„ç»éªŒï¼š</strong></p>
<ol>
<li><strong>æ°¸è¿œå…ˆçœ‹æ—¥å¿—</strong> - 90% çš„é—®é¢˜éƒ½èƒ½ä»æ—¥å¿—é‡Œæ‰¾åˆ°ç­”æ¡ˆ</li>
<li><strong>Volume è¦è°¨æ…</strong> - Docker Volume æ˜¯æŒä¹…åŒ–çš„ï¼Œåˆ å®¹å™¨ä¸ä¼šåˆ æ•°æ®</li>
<li><strong>HTTP åè®®ç»†èŠ‚å¾ˆé‡è¦</strong> - ä¸€ä¸ªç©ºæ ¼ã€ä¸€ä¸ªç‰ˆæœ¬å·éƒ½å¯èƒ½å¯¼è‡´é—®é¢˜</li>
<li><strong>ç›‘æ§è¦å…ˆè¡Œ</strong> - æ²¡æœ‰ç›‘æ§å°±åƒé—­ç€çœ¼ç›å¼€è½¦</li>
<li><strong>å¤‡ä»½æ˜¯æ•‘å‘½ç¨»è‰</strong> - æ°¸è¿œä¸è¦ç›¸ä¿¡"ä¸ä¼šå‡ºé—®é¢˜"</li>
</ol>
<hr/>
<h2 data-id="heading-15">å†™åœ¨æœ€åï¼šåˆ°åº•å€¼ä¸å€¼ï¼Ÿ</h2>
<p>å¦‚æœä½ é—®æˆ‘ï¼ŒèŠ±ä¸¤å‘¨æ—¶é—´éƒ¨ç½² Dify å€¼ä¸å€¼ï¼Ÿ</p>
<p>æˆ‘çš„ç­”æ¡ˆæ˜¯ï¼š<strong>å€¼ï¼Œä¸è¿‡ä¹Ÿå¾—çœ‹æƒ…å†µã€‚</strong></p>
<p><strong>å¦‚æœï¼š</strong></p>
<ul>
<li>å®Œå…¨æŒæ§æ•°æ®</li>
<li>çµæ´»æ¥å…¥å„ç§æ¨¡å‹</li>
<li>æ·±åº¦å®šåˆ¶åŠŸèƒ½</li>
<li>æ— é™åˆ¶çš„ API è°ƒç”¨</li>
<li>å¯é•¿æœŸæ¼”è¿›çš„å¹³å°</li>
</ul>
<p>é‚£ Dify è‡ªå»ºç»å¯¹æ˜¯æ­£ç¡®é€‰æ‹©ã€‚</p>
<p><strong>ä½†å¦‚æœï¼š</strong></p>
<ul>
<li>åªæ˜¯æƒ³å¿«é€Ÿä½“éªŒ AI åº”ç”¨</li>
<li>å›¢é˜Ÿæ²¡æœ‰è¿ç»´èƒ½åŠ›</li>
<li>å¯¹æ•°æ®å®‰å…¨æ²¡æœ‰å¼ºè¦æ±‚</li>
<li>ä¸éœ€è¦å®šåˆ¶åŒ–åŠŸèƒ½</li>
</ul>
<p>é‚£è¿˜æ˜¯ç”¨ SaaS ç‰ˆæœ¬å§ï¼ŒçœŸçš„èƒ½çœå¾ˆå¤šäº‹ã€‚</p>
<p>æœ€åï¼Œå¦‚æœä½ çœŸçš„è¦è‡ªå»º Difyï¼Œè¿™ä»½é¿å‘æŒ‡å—å¸Œæœ›èƒ½å¸®åˆ°ä½ ï¼š</p>
<h2 data-id="heading-16">å¿«é€Ÿé¿å‘æ¸…å•</h2>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 1. å½»åº•æ¸…ç†ç¯å¢ƒ</span>
docker-compose down -v
docker volume prune -f
<span class="hljs-built_in">rm</span> -rf ./volumes/*

<span class="hljs-comment"># 2. æ£€æŸ¥ç«¯å£å ç”¨</span>
netstat -tulpn | grep -E <span class="hljs-string">'5432|6379|3000|5001'</span>

<span class="hljs-comment"># 3. æ­£ç¡®çš„å¯åŠ¨é¡ºåº</span>
docker-compose up -d db redis
<span class="hljs-built_in">sleep</span> 30  <span class="hljs-comment"># ç­‰å¾…æ•°æ®åº“åˆå§‹åŒ–</span>
docker-compose up -d

<span class="hljs-comment"># 4. éªŒè¯æœåŠ¡çŠ¶æ€</span>
curl http://localhost:5001/health
curl http://localhost:3000

<span class="hljs-comment"># 5. æŸ¥çœ‹æ—¥å¿—</span>
docker-compose logs -f

<span class="hljs-comment"># 6. è¿›å®¹å™¨è°ƒè¯•</span>
docker <span class="hljs-built_in">exec</span> -it dify-api bash
docker <span class="hljs-built_in">exec</span> -it dify-db psql -U postgres -d dify
</code></pre>
<h2 data-id="heading-17">å®Œæ•´éƒ¨ç½²æ¨¡æ¿</h2>
<p>æˆ‘æŠŠæœ€ç»ˆç¨³å®šè¿è¡Œçš„é…ç½®æ•´ç†æˆäº†æ¨¡æ¿ï¼Œéœ€è¦çš„æœ‹å‹å¯ä»¥ç›´æ¥ç”¨ï¼š</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-comment"># docker-compose.yaml</span>
<span class="hljs-attr">version:</span> <span class="hljs-string">'3.8'</span>

<span class="hljs-attr">services:</span>
  <span class="hljs-attr">nginx:</span>
    <span class="hljs-attr">image:</span> <span class="hljs-string">nginx:alpine</span>
    <span class="hljs-attr">volumes:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">./nginx.conf:/etc/nginx/nginx.conf</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">./certs:/etc/nginx/certs</span>
    <span class="hljs-attr">ports:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">"80:80"</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">"443:443"</span>
    <span class="hljs-attr">depends_on:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">web</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">api</span>
    <span class="hljs-attr">restart:</span> <span class="hljs-string">always</span>

  <span class="hljs-attr">db:</span>
    <span class="hljs-attr">image:</span> <span class="hljs-string">postgres:15-alpine</span>
    <span class="hljs-attr">environment:</span>
      <span class="hljs-attr">POSTGRES_USER:</span> <span class="hljs-string">postgres</span>
      <span class="hljs-attr">POSTGRES_PASSWORD:</span> <span class="hljs-string">difyai123456</span>
      <span class="hljs-attr">POSTGRES_DB:</span> <span class="hljs-string">dify</span>
    <span class="hljs-attr">volumes:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">./volumes/db:/var/lib/postgresql/data</span>
    <span class="hljs-attr">healthcheck:</span>
      <span class="hljs-attr">test:</span> [<span class="hljs-string">"CMD-SHELL"</span>, <span class="hljs-string">"pg_isready -U postgres"</span>]
      <span class="hljs-attr">interval:</span> <span class="hljs-string">10s</span>
      <span class="hljs-attr">timeout:</span> <span class="hljs-string">5s</span>
      <span class="hljs-attr">retries:</span> <span class="hljs-number">5</span>
    <span class="hljs-attr">restart:</span> <span class="hljs-string">always</span>

  <span class="hljs-attr">redis:</span>
    <span class="hljs-attr">image:</span> <span class="hljs-string">redis:7-alpine</span>
    <span class="hljs-attr">volumes:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">./volumes/redis:/data</span>
    <span class="hljs-attr">command:</span> <span class="hljs-string">redis-server</span> <span class="hljs-string">--appendonly</span> <span class="hljs-literal">yes</span>
    <span class="hljs-attr">restart:</span> <span class="hljs-string">always</span>

  <span class="hljs-attr">web:</span>
    <span class="hljs-attr">image:</span> <span class="hljs-string">langgenius/dify-web:1.10.0</span>
    <span class="hljs-attr">environment:</span>
      <span class="hljs-attr">API_URL:</span> <span class="hljs-string">https://your-domain.com/api</span>
    <span class="hljs-attr">depends_on:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">api</span>
    <span class="hljs-attr">restart:</span> <span class="hljs-string">always</span>

  <span class="hljs-attr">api:</span>
    <span class="hljs-attr">image:</span> <span class="hljs-string">langgenius/dify-api:1.10.0</span>
    <span class="hljs-attr">environment:</span>
      <span class="hljs-comment"># æ•°æ®åº“é…ç½®</span>
      <span class="hljs-attr">DB_HOST:</span> <span class="hljs-string">db</span>
      <span class="hljs-attr">DB_PORT:</span> <span class="hljs-number">5432</span>
      <span class="hljs-attr">DB_USERNAME:</span> <span class="hljs-string">postgres</span>
      <span class="hljs-attr">DB_PASSWORD:</span> <span class="hljs-string">difyai123456</span>
      <span class="hljs-attr">DB_DATABASE:</span> <span class="hljs-string">dify</span>

      <span class="hljs-comment"># Redis é…ç½®</span>
      <span class="hljs-attr">REDIS_HOST:</span> <span class="hljs-string">redis</span>
      <span class="hljs-attr">REDIS_PORT:</span> <span class="hljs-number">6379</span>

      <span class="hljs-comment"># æ€§èƒ½ä¼˜åŒ–</span>
      <span class="hljs-attr">SQLALCHEMY_POOL_SIZE:</span> <span class="hljs-number">20</span>
      <span class="hljs-attr">SQLALCHEMY_MAX_OVERFLOW:</span> <span class="hljs-number">40</span>

      <span class="hljs-comment"># å…¶ä»–é…ç½®</span>
      <span class="hljs-attr">SECRET_KEY:</span> <span class="hljs-string">your-secret-key-change-this</span>
      <span class="hljs-attr">STORAGE_TYPE:</span> <span class="hljs-string">local</span>
    <span class="hljs-attr">depends_on:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">db</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">redis</span>
    <span class="hljs-attr">volumes:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">./volumes/storage:/app/storage</span>
    <span class="hljs-attr">restart:</span> <span class="hljs-string">always</span>
</code></pre>
<hr/>
<p>éƒ¨ç½² Dify çš„è¿™ä¸¤å‘¨ï¼Œä»ä¸Šæ‰‹åˆ°æ”¾å¼ƒï¼Œå†åˆ°çœŸé¦™ï¼Œç»å†äº†ä¸€ä¸ªå®Œæ•´çš„å¿ƒè·¯å†ç¨‹ã€‚</p>
<p>ç°åœ¨å›æƒ³èµ·æ¥ï¼Œé‚£äº›æ·±å¤œè°ƒè¯•çš„æ—¶å…‰ã€é‚£äº›å› ä¸ºä¸€ä¸ªç©ºæ ¼æŠ“ç‹‚çš„ç¬é—´ã€é‚£äº›ç»ˆäºè·‘é€šåçš„å–œæ‚¦ï¼Œéƒ½æˆäº†å®è´µçš„ç»éªŒã€‚</p>
<p>æŠ€æœ¯çš„è·¯ä¸Šï¼Œè¸©å‘æ˜¯å¸¸æ€ï¼Œä½†æ¯ä¸ªå‘éƒ½æ˜¯æˆé•¿çš„æœºä¼šã€‚</p>
<p>å¸Œæœ›è¿™ç¯‡æ–‡ç« èƒ½è®©ä½ å°‘è¸©ä¸€äº›å‘ï¼Œæ—©ç‚¹ä½“éªŒåˆ° Dify çš„"çœŸé¦™"ã€‚</p>
<p>å¦‚æœä½ åœ¨éƒ¨ç½²è¿‡ç¨‹ä¸­é‡åˆ°é—®é¢˜ï¼Œæ¬¢è¿äº¤æµã€‚æ¯•ç«Ÿï¼Œè¸©å‘çš„äººå¤šäº†ï¼Œå‘å°±å˜æˆäº†è·¯ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Golangå¹¶å‘å®æˆ˜ï¼šé«˜æ•ˆå¯¹æ¥å¤©è¿œAPIå®ç°æµ·é‡ç”¨æˆ·ç”»åƒæ„å»º]]></title>    <link>https://juejin.cn/post/7581097111896211510</link>    <guid>https://juejin.cn/post/7581097111896211510</guid>    <pubDate>2025-12-08T10:12:11.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581097111896211510" data-draft-id="7581312433529421867" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Golangå¹¶å‘å®æˆ˜ï¼šé«˜æ•ˆå¯¹æ¥å¤©è¿œAPIå®ç°æµ·é‡ç”¨æˆ·ç”»åƒæ„å»º"/> <meta itemprop="keywords" content="API,å¤§æ•°æ®"/> <meta itemprop="datePublished" content="2025-12-08T10:12:11.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å¤©è¿œæ•°ç§‘"/> <meta itemprop="url" content="https://juejin.cn/user/3511153810487162"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Golangå¹¶å‘å®æˆ˜ï¼šé«˜æ•ˆå¯¹æ¥å¤©è¿œAPIå®ç°æµ·é‡ç”¨æˆ·ç”»åƒæ„å»º
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3511153810487162/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å¤©è¿œæ•°ç§‘
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-08T10:12:11.000Z" title="Mon Dec 08 2025 10:12:11 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»8åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">ä¸€ã€é«˜æ€§èƒ½é£æ§ç½‘å…³çš„æ•°æ®åŸºçŸ³</h2>
<p>åœ¨æ„å»ºäº’è”ç½‘å°é¢ä¿¡è´·ã€æ”¯ä»˜åæ¬ºè¯ˆç³»ç»Ÿä»¥åŠå¤§è§„æ¨¡å³æ—¶å¾ä¿¡ç­‰é«˜æ€§èƒ½é‡‘èç§‘æŠ€åº”ç”¨æ—¶ï¼Œç³»ç»Ÿçš„ååé‡ï¼ˆThroughputï¼‰å’Œä½å»¶è¿Ÿï¼ˆLow Latencyï¼‰æ˜¯æ ¸å¿ƒæŒ‡æ ‡ã€‚ä¼ ç»Ÿçš„å•ä½“åº”ç”¨éš¾ä»¥åº”å¯¹æµ·é‡å¹¶å‘è¯·æ±‚ï¼Œè€ŒåŸºäºå¾®æœåŠ¡çš„æ¶æ„åˆ™éœ€è¦å¼ºæœ‰åŠ›çš„æ•°æ®æ”¯æ’‘æ¥åšå‡ºæ¯«ç§’çº§çš„é£é™©å†³ç­–ã€‚</p>
<p>"æ¶ˆè´¹äº¤æ˜“ç‰¹å¾"æ¥å£ï¼Œæä¾›äº†æ ‡å‡†åŒ–çš„HTTPæœåŠ¡ï¼Œèƒ½å¤Ÿè¿”å›åŒ…å«ç”¨æˆ·æ¶ˆè´¹èƒ½åŠ›ã€èµ„é‡‘ç¨³å®šæ€§åŠè¡Œä¸šåå¥½åœ¨å†…çš„160+ä¸ªç‰¹å¾æ ‡ç­¾ã€‚å¯¹äºè¿½æ±‚æè‡´æ€§èƒ½çš„Goå¼€å‘è€…è€Œè¨€ï¼Œå¦‚ä½•åˆ©ç”¨ Goroutine å¹¶å‘ä¼˜åŠ¿é«˜æ•ˆå¯¹æ¥æ­¤ APIï¼Œå¹¶å¤„ç† AES-128 åŠ å¯†æ•°æ®ï¼Œæ˜¯æ„å»ºä¸‹ä¸€ä»£é£æ§ç½‘å…³çš„å…³é”®ã€‚æœ¬æ–‡å°†æ·±å…¥è§£æå¦‚ä½•ä½¿ç”¨ Go è¯­è¨€å®ç° APIçš„é«˜æ€§èƒ½æ¥å…¥ï¼ŒåŠ©åŠ›ä¼ä¸šåœ¨æ¯«ç§’ä¹‹é—´å®Œæˆç²¾å‡†çš„ç”¨æˆ·ä»·å€¼è¯„ä¼°ã€‚</p>
<h2 data-id="heading-1">äºŒã€APIæ¥å£è°ƒç”¨ä»£ç æµç¨‹ï¼ˆGoè¯­è¨€ç‰ˆï¼‰</h2>
<p>Go è¯­è¨€æ ‡å‡†åº“ä¸­çš„ <code>net/http</code> å’Œ <code>crypto</code> åŒ…æä¾›äº†å¼ºå¤§çš„ç½‘ç»œå’ŒåŠ å¯†æ”¯æŒã€‚å¯¹æ¥APIçš„æ ¸å¿ƒæŒ‘æˆ˜åœ¨äºæ­£ç¡®å®ç° AES-128-CBC æ¨¡å¼çš„åŠ è§£å¯†ä»¥åŠ PKCS7 å¡«å……é€»è¾‘ã€‚</p>
<h3 data-id="heading-2">1. æ¥å£é…ç½®å‚æ•°</h3>
<ul>
<li><strong>æ¥å£åœ°å€</strong>ï¼š<code>https://api.tianyuanapi.com/api/v1/JRZQ1E7B</code></li>
<li><strong>è¯·æ±‚æ–¹å¼</strong>ï¼šPOST</li>
<li><strong>é‰´æƒå¤´</strong>ï¼š<code>Access-Id</code></li>
<li><strong>åŠ å¯†è§„èŒƒ</strong>ï¼šAES-128 CBCæ¨¡å¼ï¼Œ16å­—èŠ‚éšæœºIVï¼ŒBase64ç¼–ç ä¼ è¾“ã€‚</li>
</ul>
<h3 data-id="heading-3">2. cURL è°ƒç”¨éªŒè¯</h3>
<p>åœ¨ç¼–å†™ Go ä»£ç å‰ï¼Œç¡®ä¿æ‚¨çš„ç¯å¢ƒå¯ä»¥è¿é€š API ç½‘å…³ï¼š</p>
<p>Bash</p>
<pre><code class="hljs language-json" lang="json">curl -X POST <span class="hljs-string">"&lt;https://api.tianyuanapi.com/api/v1/JRZQ1E7B?t=1720000000&gt;"</span> \
     -H <span class="hljs-string">"Content-Type: application/json"</span> \
     -H <span class="hljs-string">"Access-Id: YOUR_ACCESS_ID"</span> \
     -d '<span class="hljs-punctuation">{</span><span class="hljs-attr">"data"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"BASE64_ENCRYPTED_PAYLOAD"</span><span class="hljs-punctuation">}</span>'
</code></pre>
<h3 data-id="heading-4">3. Go å®Œæ•´æ¥å…¥ç¤ºä¾‹</h3>
<p>ä»¥ä¸‹ä»£ç å±•ç¤ºäº†åŒ…å«ç»“æ„ä½“å®šä¹‰ã€PKCS7 å¡«å……å¤„ç†åŠ HTTP è¯·æ±‚çš„å®Œæ•´æµç¨‹ã€‚</p>
<p>Go</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">package</span> main

<span class="hljs-keyword">import</span> (
	<span class="hljs-string">"bytes"</span>
	<span class="hljs-string">"crypto/aes"</span>
	<span class="hljs-string">"crypto/cipher"</span>
	<span class="hljs-string">"crypto/rand"</span>
	<span class="hljs-string">"encoding/base64"</span>
	<span class="hljs-string">"encoding/json"</span>
	<span class="hljs-string">"fmt"</span>
	<span class="hljs-string">"io"</span>
	<span class="hljs-string">"net/http"</span>
	<span class="hljs-string">"time"</span>
)

<span class="hljs-comment">// Config é…ç½®ä¿¡æ¯</span>
<span class="hljs-keyword">const</span> (
	ApiURL    = <span class="hljs-string">"&lt;https://api.tianyuanapi.com/api/v1/JRZQ1E7B&gt;"</span>
	AccessID  = <span class="hljs-string">"YOUR_ACCESS_ID"</span>
	SecretKey = <span class="hljs-string">"YOUR_16_BYTE_KEY"</span> <span class="hljs-comment">// å¿…é¡»æ˜¯16å­—èŠ‚çš„16è¿›åˆ¶å­—ç¬¦ä¸²è½¬æ¢åçš„bytes</span>
)

<span class="hljs-comment">// RequestPayload åŸå§‹è¯·æ±‚å‚æ•°</span>
<span class="hljs-keyword">type</span> RequestPayload <span class="hljs-keyword">struct</span> {
	Name       <span class="hljs-type">string</span> <span class="hljs-string">`json:"name"`</span>
	IdCard     <span class="hljs-type">string</span> <span class="hljs-string">`json:"id_card"`</span>
	MobileNo   <span class="hljs-type">string</span> <span class="hljs-string">`json:"mobile_no"`</span>
	Authorized <span class="hljs-type">string</span> <span class="hljs-string">`json:"authorized"`</span> <span class="hljs-comment">// 0:å¦ï¼Œ1:æ˜¯</span>
}

<span class="hljs-comment">// APIResponse APIé€šç”¨å“åº”ç»“æ„</span>
<span class="hljs-keyword">type</span> APIResponse <span class="hljs-keyword">struct</span> {
	Code          <span class="hljs-keyword">interface</span>{} <span class="hljs-string">`json:"code"`</span> <span class="hljs-comment">// å¯èƒ½æ˜¯intæˆ–stringï¼Œå»ºè®®interface{}å…¼å®¹</span>
	Message       <span class="hljs-type">string</span>      <span class="hljs-string">`json:"message"`</span>
	TransactionID <span class="hljs-type">string</span>      <span class="hljs-string">`json:"transaction_id"`</span>
	Data          <span class="hljs-type">string</span>      <span class="hljs-string">`json:"data"`</span> <span class="hljs-comment">// åŠ å¯†å“åº”æ•°æ®</span>
}

<span class="hljs-comment">// TianyuanClient å®¢æˆ·ç«¯ç»“æ„ä½“</span>
<span class="hljs-keyword">type</span> TianyuanClient <span class="hljs-keyword">struct</span> {
	Client *http.Client
	Key    []<span class="hljs-type">byte</span>
}

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">NewClient</span><span class="hljs-params">(key <span class="hljs-type">string</span>)</span></span> *TianyuanClient {
	<span class="hljs-keyword">return</span> &amp;TianyuanClient{
		Client: &amp;http.Client{Timeout: <span class="hljs-number">5</span> * time.Second},
		Key:    []<span class="hljs-type">byte</span>(key), <span class="hljs-comment">// å®é™…ä½¿ç”¨éœ€hex decode</span>
	}
}

<span class="hljs-comment">// PKCS7Padding è¡¥ç </span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">PKCS7Padding</span><span class="hljs-params">(ciphertext []<span class="hljs-type">byte</span>, blockSize <span class="hljs-type">int</span>)</span></span> []<span class="hljs-type">byte</span> {
	padding := blockSize - <span class="hljs-built_in">len</span>(ciphertext)%blockSize
	padtext := bytes.Repeat([]<span class="hljs-type">byte</span>{<span class="hljs-type">byte</span>(padding)}, padding)
	<span class="hljs-keyword">return</span> <span class="hljs-built_in">append</span>(ciphertext, padtext...)
}

<span class="hljs-comment">// PKCS7UnPadding å»ç </span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">PKCS7UnPadding</span><span class="hljs-params">(origData []<span class="hljs-type">byte</span>)</span></span> []<span class="hljs-type">byte</span> {
	length := <span class="hljs-built_in">len</span>(origData)
	unpadding := <span class="hljs-type">int</span>(origData[length<span class="hljs-number">-1</span>])
	<span class="hljs-keyword">return</span> origData[:(length - unpadding)]
}

<span class="hljs-comment">// Encrypt AES-128-CBC åŠ å¯†</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(c *TianyuanClient)</span></span> Encrypt(text <span class="hljs-type">string</span>) (<span class="hljs-type">string</span>, <span class="hljs-type">error</span>) {
	block, err := aes.NewCipher(c.Key)
	<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
		<span class="hljs-keyword">return</span> <span class="hljs-string">""</span>, err
	}
	blockSize := block.BlockSize()
	originData := PKCS7Padding([]<span class="hljs-type">byte</span>(text), blockSize)
	
	<span class="hljs-comment">// éšæœºIV</span>
	iv := <span class="hljs-built_in">make</span>([]<span class="hljs-type">byte</span>, blockSize)
	<span class="hljs-keyword">if</span> _, err := io.ReadFull(rand.Reader, iv); err != <span class="hljs-literal">nil</span> {
		<span class="hljs-keyword">return</span> <span class="hljs-string">""</span>, err
	}

	blockMode := cipher.NewCBCEncrypter(block, iv)
	crypted := <span class="hljs-built_in">make</span>([]<span class="hljs-type">byte</span>, <span class="hljs-built_in">len</span>(originData))
	blockMode.CryptBlocks(crypted, originData)

	<span class="hljs-comment">// æ‹¼æ¥ IV + å¯†æ–‡</span>
	combined := <span class="hljs-built_in">append</span>(iv, crypted...)
	<span class="hljs-keyword">return</span> base64.StdEncoding.EncodeToString(combined), <span class="hljs-literal">nil</span>
}

<span class="hljs-comment">// Decrypt AES-128-CBC è§£å¯†</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(c *TianyuanClient)</span></span> Decrypt(cryptoText <span class="hljs-type">string</span>) (<span class="hljs-type">string</span>, <span class="hljs-type">error</span>) {
	decoded, err := base64.StdEncoding.DecodeString(cryptoText)
	<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
		<span class="hljs-keyword">return</span> <span class="hljs-string">""</span>, err
	}

	<span class="hljs-comment">// æå– IV (å‰16å­—èŠ‚)</span>
	<span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(decoded) &lt; <span class="hljs-number">16</span> {
		<span class="hljs-keyword">return</span> <span class="hljs-string">""</span>, fmt.Errorf(<span class="hljs-string">"ciphertext too short"</span>)
	}
	iv := decoded[:<span class="hljs-number">16</span>]
	ciphertext := decoded[<span class="hljs-number">16</span>:]

	block, err := aes.NewCipher(c.Key)
	<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
		<span class="hljs-keyword">return</span> <span class="hljs-string">""</span>, err
	}

	blockMode := cipher.NewCBCDecrypter(block, iv)
	origData := <span class="hljs-built_in">make</span>([]<span class="hljs-type">byte</span>, <span class="hljs-built_in">len</span>(ciphertext))
	blockMode.CryptBlocks(origData, ciphertext)

	origData = PKCS7UnPadding(origData)
	<span class="hljs-keyword">return</span> <span class="hljs-type">string</span>(origData), <span class="hljs-literal">nil</span>
}

<span class="hljs-comment">// CallAPI å‘èµ·è¯·æ±‚</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(c *TianyuanClient)</span></span> CallAPI(payload RequestPayload) (<span class="hljs-keyword">map</span>[<span class="hljs-type">string</span>]<span class="hljs-keyword">interface</span>{}, <span class="hljs-type">error</span>) {
	jsonBytes, _ := json.Marshal(payload)
	encryptedData, err := c.Encrypt(<span class="hljs-type">string</span>(jsonBytes))
	<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
		<span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>, err
	}

	reqBody := <span class="hljs-keyword">map</span>[<span class="hljs-type">string</span>]<span class="hljs-type">string</span>{<span class="hljs-string">"data"</span>: encryptedData}
	reqBytes, _ := json.Marshal(reqBody)

	url := fmt.Sprintf(<span class="hljs-string">"%s?t=%d"</span>, ApiURL, time.Now().UnixMilli())
	req, _ := http.NewRequest(<span class="hljs-string">"POST"</span>, url, bytes.NewBuffer(reqBytes))
	req.Header.Set(<span class="hljs-string">"Content-Type"</span>, <span class="hljs-string">"application/json"</span>)
	req.Header.Set(<span class="hljs-string">"Access-Id"</span>, AccessID)

	resp, err := c.Client.Do(req)
	<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
		<span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>, err
	}
	<span class="hljs-keyword">defer</span> resp.Body.Close()

	<span class="hljs-keyword">var</span> apiResp APIResponse
	<span class="hljs-keyword">if</span> err := json.NewDecoder(resp.Body).Decode(&amp;apiResp); err != <span class="hljs-literal">nil</span> {
		<span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>, err
	}

    <span class="hljs-comment">// å¤„ç† code å¯èƒ½æ˜¯ int æˆ– string çš„æƒ…å†µ</span>
	codeVal := fmt.Sprintf(<span class="hljs-string">"%v"</span>, apiResp.Code)
	<span class="hljs-keyword">if</span> codeVal == <span class="hljs-string">"0"</span> {
		decryptedJSON, err := c.Decrypt(apiResp.Data)
		<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
			<span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>, err
		}
		<span class="hljs-keyword">var</span> result <span class="hljs-keyword">map</span>[<span class="hljs-type">string</span>]<span class="hljs-keyword">interface</span>{}
		json.Unmarshal([]<span class="hljs-type">byte</span>(decryptedJSON), &amp;result)
		<span class="hljs-keyword">return</span> result, <span class="hljs-literal">nil</span>
	}
	<span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>, fmt.Errorf(<span class="hljs-string">"API Error: %s"</span>, apiResp.Message)
}

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
	<span class="hljs-comment">// æ³¨æ„ï¼šKeyå¿…é¡»æ˜¯16å­—èŠ‚ã€‚å®é™…å¼€å‘ä¸­è¯·å¤„ç†å¯†é’¥ç®¡ç†</span>
	client := NewClient(<span class="hljs-string">"1234567890123456"</span>) 
	
	res, err := client.CallAPI(RequestPayload{
		Name:       <span class="hljs-string">"å¼ ä¸‰"</span>,
		IdCard:     <span class="hljs-string">"110101199001011234"</span>,
		MobileNo:   <span class="hljs-string">"13800138000"</span>,
		Authorized: <span class="hljs-string">"1"</span>,
	})

	<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
		fmt.Printf(<span class="hljs-string">"Error: %v\n"</span>, err)
	} <span class="hljs-keyword">else</span> {
		fmt.Printf(<span class="hljs-string">"æ¶ˆè´¹èƒ½åŠ›è¯„åˆ†(tap028): %v\n"</span>, res[<span class="hljs-string">"tap028"</span>])
		fmt.Printf(<span class="hljs-string">"ç”¨æˆ·æ ‡ç­¾(tap029): %v\n"</span>, res[<span class="hljs-string">"tap029"</span>])
	}
}
</code></pre>
<h2 data-id="heading-5">ä¸‰ã€æ ¸å¿ƒæ•°æ®ç»“æ„è§£æ</h2>
<p>åœ¨ Go è¯­è¨€ä¸­ï¼Œåˆ©ç”¨ <code>struct</code> æ ‡ç­¾ï¼ˆStruct Tagsï¼‰å¯ä»¥éå¸¸æ–¹ä¾¿åœ°å¤„ç† APIè¿”å›çš„ JSON æ•°æ®ã€‚ä¸ºäº†ä¾¿äºå¾®æœåŠ¡é—´çš„æ•°æ®ä¼ é€’ï¼ˆä¾‹å¦‚é€šè¿‡ gRPC æˆ– Protocol Buffersï¼‰ï¼Œå»ºè®®å®šä¹‰æ˜ç¡®çš„ç»“æ„ä½“æ¥æ‰¿è½½è§£å¯†åçš„æ•°æ®ã€‚</p>
<p>APIè¿”å›çš„æ•°æ®ç»“æ„æ‰å¹³ä¸”ä¸°å¯Œï¼ŒåŒ…å«åŸºç¡€ä¿¡æ¯ã€äº¤æ˜“ç»Ÿè®¡ã€è¡Œä¸šç»´åº¦ç­‰æ¨¡å—ï¼š</p>
<p>Go</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-comment">// UserTransactionProfile ç”¨æˆ·äº¤æ˜“ç‰¹å¾ç”»åƒ</span>
<span class="hljs-keyword">type</span> UserTransactionProfile <span class="hljs-keyword">struct</span> {
    Tap028 <span class="hljs-type">string</span> <span class="hljs-string">`json:"tap028"`</span> <span class="hljs-comment">// æ¶ˆè´¹èƒ½åŠ›è¯„åˆ†</span>
    Tap001 <span class="hljs-type">string</span> <span class="hljs-string">`json:"tap001"`</span> <span class="hljs-comment">// å¸¸ç”¨å¡æ•°é‡åŒºé—´</span>
    Tap013 <span class="hljs-type">string</span> <span class="hljs-string">`json:"tap013"`</span> <span class="hljs-comment">// å†å²äº¤æ˜“æ€»é‡‘é¢åŒºé—´</span>
    Tap005 <span class="hljs-type">string</span> <span class="hljs-string">`json:"tap005"`</span> <span class="hljs-comment">// æœ€è¿‘ä¸€æ¬¡ä¸€çº§è¡Œä¸š</span>
    <span class="hljs-comment">// ... å…¶ä»–160+ä¸ªå­—æ®µ</span>
}
</code></pre>
<h2 data-id="heading-6">å››ã€å­—æ®µè¯¦è§£ï¼ˆå¾®æœåŠ¡æ¶æ„å…³æ³¨ç‚¹ï¼‰</h2>
<p>Go æœåŠ¡é€šå¸¸ä½œä¸ºé«˜æ€§èƒ½ç½‘å…³æˆ–è®¡ç®—èŠ‚ç‚¹ï¼Œä»¥ä¸‹å­—æ®µå¯¹äºæ„å»º<strong>è‡ªåŠ¨åŒ–è§„åˆ™å¼•æ“</strong>è‡³å…³é‡è¦ã€‚</p>















































<table><thead><tr><th><strong>å­—æ®µç¼–ç </strong></th><th><strong>å­—æ®µå«ä¹‰</strong></th><th><strong>ç±»å‹/æ˜ å°„è¯´æ˜</strong></th><th><strong>ä¸šåŠ¡å†³ç­–é€»è¾‘ç¤ºä¾‹</strong></th></tr></thead><tbody><tr><td><strong>tap028</strong></td><td><strong>æ¶ˆè´¹èƒ½åŠ›è¯„åˆ†</strong></td><td>200-900åˆ†</td><td>è‹¥ <code>score &lt; 400</code>ï¼Œè‡ªåŠ¨è·¯ç”±è‡³å°é¢äº§å“çº¿ï¼›è‹¥ <code>score &gt; 700</code>ï¼Œè·¯ç”±è‡³VIPäººå·¥æœåŠ¡ã€‚</td></tr><tr><td><strong>tap013</strong></td><td>å†å²äº¤æ˜“æ€»é‡‘é¢</td><td>åŒºé—´æ˜ å°„ (1-6)</td><td>æ˜ å°„å€¼ <code>6</code> ä»£è¡¨æ€»é¢ <code>[128000, Inf)</code>ï¼Œå¯ä½œä¸ºé«˜ä»·å€¼ç”¨æˆ·çš„ç¡¬æ€§é—¨æ§›ã€‚</td></tr><tr><td><strong>tap027</strong></td><td>äº’é‡‘å¹³å°äº¤æ˜“é‡‘é¢</td><td>åŒºé—´æ˜ å°„ (1-4)</td><td>è‹¥è¯¥å€¼å¤§äº <code>2</code> (å³ &gt;10000å…ƒ)ï¼Œé£æ§ç³»ç»Ÿåº”å¢åŠ â€œå¤šå¤´å€Ÿè´·â€æƒé‡çš„è®¡ç®—ã€‚</td></tr><tr><td><strong>tap098</strong></td><td>è¿‘6ä¸ªæœˆå€Ÿè®°å¡äº¤æ˜“é¢</td><td>åŒºé—´æ˜ å°„</td><td>å¯¹æ¯” <code>tap099</code> (è´·è®°å¡é‡‘é¢)ï¼Œåˆ†æç”¨æˆ·çš„å‚¨è“„/è´Ÿå€ºæ¯”ã€‚</td></tr><tr><td><strong>tap143</strong></td><td>é‡‘èç±»å¤§é¢äº¤æ˜“ç¬”æ•°</td><td>åŒºé—´æ˜ å°„ (1-13)</td><td>é’ˆå¯¹é‡‘é¢&gt;10000çš„äº¤æ˜“ï¼Œé¢‘æ¬¡è¿‡é«˜å¯èƒ½æ„å‘³ç€èµ„é‡‘å‘¨è½¬é¢‘ç¹ï¼Œéœ€ç»“åˆåæ´—é’±è§„åˆ™ã€‚</td></tr><tr><td><strong>tap003</strong></td><td>æœ€è¿‘æˆåŠŸäº¤æ˜“æ—¶é—´</td><td>Date (yyyy-MM-dd)</td><td>è®¡ç®— <code>Now - tap003</code>ï¼Œè‹¥è¶…è¿‡180å¤©ï¼Œè§†ä¸ºâ€œæ²‰ç¡æˆ·â€ï¼Œæ¿€æ´»ç­–ç•¥éœ€è°ƒæ•´ã€‚</td></tr></tbody></table>
<h2 data-id="heading-7">äº”ã€åº”ç”¨ä»·å€¼åˆ†æ</h2>
<p>å€ŸåŠ© Go è¯­è¨€çš„é«˜å¹¶å‘ç‰¹æ€§ï¼Œé›†æˆ APIå¯æ˜¾è‘—æå‡ä»¥ä¸‹åœºæ™¯çš„å¤„ç†æ•ˆç‡ï¼š</p>
<h3 data-id="heading-8">1. é«˜å¹¶å‘æ‰¹é‡ç­›æŸ¥ (Batch Screening)</h3>
<p>åœ¨å­˜é‡å®¢æˆ·ï¼ˆå¦‚åƒä¸‡çº§ï¼‰çš„å®šæœŸå¤æŸ¥ä¸­ï¼Œåˆ©ç”¨ Go çš„ <code>Goroutines</code> å’Œ <code>Channels</code>ï¼Œå¯ä»¥è½»æ¾å®ç°æ¯ç§’æ•°åƒæ¬¡å¹¶å‘è°ƒç”¨ã€‚</p>
<ul>
<li><strong>åœºæ™¯</strong>ï¼šæ¯æœˆ1å·å¯¹å…¨é‡æŒå¡ç”¨æˆ·è¿›è¡Œé¢åº¦è¯„ä¼°ã€‚</li>
<li><strong>å®ç°</strong>ï¼šå¯åŠ¨ 100 ä¸ª Worker Goroutineï¼Œå¹¶å‘è°ƒç”¨ API è·å– <code>tap028</code> å’Œ <code>tap013</code>ï¼Œæ¸…æ´—åå­˜å…¥æ•°ä»“ï¼Œè¿‡ç¨‹ä»…éœ€æ•°å°æ—¶è€Œéæ•°å¤©ã€‚</li>
</ul>
<h3 data-id="heading-9">2. å®æ—¶æ”¯ä»˜è·¯ç”± (Smart Routing)</h3>
<p>åœ¨èšåˆæ”¯ä»˜ç½‘å…³ä¸­ï¼Œæ ¹æ® APIè¿”å›çš„ <code>tap015</code>ï¼ˆæ”¯ä»˜æˆåŠŸç‡ï¼‰å’Œ <code>tap004</code>ï¼ˆæœ€è¿‘äº¤æ˜“é‡‘é¢ï¼‰ç‰¹å¾ï¼ŒåŠ¨æ€é€‰æ‹©æœ€ä¼˜æ”¯ä»˜é€šé“ã€‚</p>
<ul>
<li><strong>é€»è¾‘</strong>ï¼šå¦‚æœç”¨æˆ·å†å²æ”¯ä»˜æˆåŠŸç‡æé«˜ï¼ˆ<code>tap015</code> æ¥è¿‘ 1.0ï¼‰ï¼Œåˆ™è·¯ç”±è‡³æˆåŠŸç‡é«˜ä½†è´¹ç‡ç¨ä½çš„é€šé“ï¼›åä¹‹åˆ™è·¯ç”±è‡³å®¹é”™æ€§æ›´å¼ºçš„é€šé“ã€‚</li>
</ul>
<h3 data-id="heading-10">3. å¾®æœåŠ¡é£æ§ä¸­å° (Risk Microservice)</h3>
<p>å°† <strong>API</strong> çš„è°ƒç”¨å°è£…ä¸ºä¸€ä¸ªç‹¬ç«‹çš„ gRPC å¾®æœåŠ¡ã€‚å…¶ä»–ä¸šåŠ¡çº¿ï¼ˆæ³¨å†Œã€å€Ÿæ¬¾ã€æç°ï¼‰åªéœ€ä¼ å…¥ <code>mobile</code> å’Œ <code>id_card</code>ï¼Œè¯¥æœåŠ¡å³å¯è‡ªåŠ¨å®ŒæˆåŠ å¯†ã€è¯·æ±‚ã€è§£å¯†ã€è§£æï¼Œå¹¶è¿”å›æ ‡å‡†åŒ–çš„ <code>RiskScore</code> ç»“æ„ä½“ï¼Œå®ç°ä¼ä¸šçº§çš„èƒ½åŠ›å¤ç”¨ã€‚</p>
<h2 data-id="heading-11">å…­ã€æ€»ç»“</h2>
<p>å¯¹äºè¿½æ±‚å·¥ç¨‹æ•ˆç‡ä¸è¿è¡Œæ€§èƒ½çš„å›¢é˜Ÿï¼Œé€‰æ‹© Go è¯­è¨€å¯¹æ¥ <strong>æ¶ˆè´¹äº¤æ˜“ç‰¹å¾API</strong> æ˜¯ä¸€ä¸ªæ˜æ™ºçš„å†³å®šã€‚é€šè¿‡æ ‡å‡†åŒ–çš„ AES åŠ å¯†æµç¨‹å’Œç»“æ„åŒ–çš„æ•°æ®è§£æï¼Œå¼€å‘è€…å¯ä»¥å¿«é€Ÿæ„å»ºå‡ºç¨³å®šå¯é çš„æ•°æ®ç®¡é“ã€‚</p>
<p><strong>API</strong> æä¾›çš„é«˜ç»´åº¦ç‰¹å¾æ•°æ®ï¼Œç»“åˆ Go è¯­è¨€åœ¨é«˜å¹¶å‘åœºæ™¯ä¸‹çš„ç»Ÿæ²»åŠ›ï¼Œå°†ä¸ºä¼ä¸šæ„å»ºå®æ—¶ã€æ™ºèƒ½ã€é«˜ååçš„é‡‘èé£æ§ç³»ç»Ÿæä¾›å¼ºæœ‰åŠ›çš„æŠ€æœ¯ä¿éšœã€‚å»ºè®®å¼€å‘è€…åœ¨ç”Ÿäº§ç¯å¢ƒä¸­å¼•å…¥ç†”æ–­ï¼ˆCircuit Breakerï¼‰æœºåˆ¶ï¼Œä»¥ç¡®ä¿åœ¨å¤–éƒ¨ç½‘ç»œæ³¢åŠ¨æ—¶ç³»ç»Ÿçš„ç¨³å®šæ€§ã€‚</p>
<h2 data-id="heading-12">ä¸ƒã€æ•°æ®åˆè§„ä¸éšç§å®‰å…¨å£°æ˜</h2>
<p>æ— è®ºæ˜¯ä½¿ç”¨ Pythonã€Javaã€PHP è¿˜æ˜¯ Go è¯­è¨€æ¥å…¥ <strong>å¤©è¿œAPI</strong>ï¼ŒæŠ€æœ¯å®ç°ä»…ä»…æ˜¯æ•°æ®èµ‹èƒ½ä¸šåŠ¡çš„èµ·ç‚¹ã€‚åœ¨åˆ©ç”¨ <strong>ä¿¡è´·è¡Œä¸ºæ•°æ®æ´å¯Ÿ</strong> ç­‰æ¶‰åŠä¸ªäººä¿¡ç”¨çš„é«˜æ•æ„Ÿåº¦æ¥å£è¿›è¡Œé£æ§å†³ç­–æ—¶ï¼Œ<strong>æ•°æ®åˆè§„ä¸éšç§ä¿æŠ¤</strong> å§‹ç»ˆæ˜¯ä¼ä¸šä¸å¯é€¾è¶Šçš„çº¢çº¿ã€‚</p>
<p>å¤©è¿œæ•°æ®ä¸¥æ ¼éµå¾ªã€Šä¸ªäººä¿¡æ¯ä¿æŠ¤æ³•ã€‹åŠç›¸å…³æ³•å¾‹æ³•è§„ï¼Œè¦æ±‚å¼€å‘è€…åœ¨è°ƒç”¨æ¥å£æ—¶å¿…é¡»ç¡®ä¿å·²è·å¾—ç”¨æˆ·çš„<strong>æ˜ç¡®æˆæƒ</strong>ï¼ˆå³è¯·æ±‚å‚æ•°ä¸­ <code>authorized</code> å¿…é¡»ä¸º <code>1</code>ï¼Œä¸”ä¿ç•™çœŸå®çš„æˆæƒå‡­è¯ï¼‰ã€‚æˆ‘ä»¬å¼ºçƒˆå»ºè®®ä¼ä¸šåœ¨æ•°æ®é‡‡é›†ã€ä¼ è¾“ï¼ˆå…¨ç¨‹åŠ å¯†ï¼‰åŠå­˜å‚¨çš„å…¨ç”Ÿå‘½å‘¨æœŸä¸­å»ºç«‹ä¸¥æ ¼çš„éšç§ä¿æŠ¤æœºåˆ¶ã€‚è¿™ä¸ä»…æ˜¯æ»¡è¶³ç›‘ç®¡åˆè§„çš„åŸºæœ¬è¦æ±‚ï¼Œæ›´æ˜¯æ„å»ºç”¨æˆ·ä¿¡ä»»ã€ä¿éšœä¼ä¸šä¸šåŠ¡é•¿æœŸç¨³å¥å‘å±•çš„åŸºçŸ³ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Paimonæºç è§£è¯» -- Compaction-2.KeyValueFileWriterFactory]]></title>    <link>https://juejin.cn/post/7581306080434339891</link>    <guid>https://juejin.cn/post/7581306080434339891</guid>    <pubDate>2025-12-08T10:29:14.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581306080434339891" data-draft-id="7580971667037650970" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Paimonæºç è§£è¯» -- Compaction-2.KeyValueFileWriterFactory"/> <meta itemprop="keywords" content="åç«¯,å¤§æ•°æ®,Flink"/> <meta itemprop="datePublished" content="2025-12-08T10:29:14.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="expect7g"/> <meta itemprop="url" content="https://juejin.cn/user/3514471387235735"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Paimonæºç è§£è¯» -- Compaction-2.KeyValueFileWriterFactory
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3514471387235735/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    expect7g
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-08T10:29:14.000Z" title="Mon Dec 08 2025 10:29:14 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»11åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">å‰è¨€</h2>
<p>ä¸Šç¯‡æ–‡ç« <a href="https://juejin.cn/post/7577609608828239898" target="_blank" title="https://juejin.cn/post/7577609608828239898">Paimonæºç è§£è¯» -- Compaction-1.MergeTreeCompactTask</a>è§£æäº†Paimon-Compactioné˜¶æ®µçš„å¤§æ¦‚æµç¨‹ï¼Œè€Œæœ€åå‘ç°ï¼ŒçœŸæ­£å»å°†æ–‡ä»¶é‡‡ç”¨ç‰¹ç‚¹ç®—æ³•åˆå¹¶çš„ç±»æ˜¯<code>KeyValueFileWriterFactoryä¸­createRollingMergeTreeFileWriter()å’ŒcreateRollingChangelogFileWriter()</code>åˆ›å»ºçš„---<code>RollingFileWriter</code></p>
<h2 data-id="heading-1">ä¸€.KeyValueFileWriterFactoryä¸­çš„ä¸¤ä¸ªæ ¸å¿ƒè°ƒç”¨æ–¹æ³•</h2>
<h3 data-id="heading-2">1.<code>createRollingMergeTreeFileWriter()</code>å’Œ<code>createRollingChangelogFileWriter()</code></h3>
<h4 data-id="heading-3">(1) ä¿©æ–¹æ³•ä»£ç </h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> RollingFileWriter&lt;KeyValue, DataFileMeta&gt; <span class="hljs-title function_">createRollingMergeTreeFileWriter</span><span class="hljs-params">(
    <span class="hljs-type">int</span> level, FileSource fileSource)</span> {
<span class="hljs-comment">// åˆ›å»ºRollingFileWriterï¼Œåç»­ç”±å…¶è¿›è¡Œå†™å…¥åˆå¹¶æ“ä½œ</span>
<span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RollingFileWriter</span>&lt;&gt;(
        () -&gt;
                createDataFileWriter(
                        formatContext.pathFactory(level).newPath(),
                        level, 
                        fileSource), <span class="hljs-comment">// åˆ›å»ºSingleFileWriterå†™å…¥å™¨ï¼Œè¿™é‡Œçš„å‚æ•°æ˜¯æ‡’åŠ è½½SupplieråŒ…è£…çš„</span>
        suggestedFileSize <span class="hljs-comment">// è¿™é‡ŒsuggestedFileSizeå…¶å®å°±æ˜¯é…ç½®çš„target-file-sizeå¤§å°</span>
    );
}

<span class="hljs-keyword">public</span> RollingFileWriter&lt;KeyValue, DataFileMeta&gt; <span class="hljs-title function_">createRollingChangelogFileWriter</span><span class="hljs-params">(<span class="hljs-type">int</span> level)</span> {
<span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RollingFileWriter</span>&lt;&gt;(
        () -&gt;
                createDataFileWriter(
                        formatContext.pathFactory(level).newChangelogPath(), <span class="hljs-comment">// å’Œä¸Šé¢çš„createRollingMergeTreeFileWriter()çš„å‚æ•°ä¸åŒ</span>
                        level,
                        FileSource.APPEND),
        suggestedFileSize);
}
</code></pre>
<h4 data-id="heading-4">(2) è°ƒç”¨çš„<code>createDataFileWriter()</code></h4>
<p>ä½œç”¨ï¼šå¼€å¯ç˜¦æ¨¡å¼(<code>é…ç½®'data-file.thin-mode'ç»‘å®šï¼Œé»˜è®¤æ˜¯false</code>)ï¼Œé‡‡ç”¨<code>KeyValueThinDataFileWriterImpl</code>ï¼›å¦åˆ™ï¼Œéƒ½æ˜¯æ™®é€šæ¨¡å¼ï¼Œé‡‡ç”¨<code>KeyValueDataFileWriterImpl</code></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">private</span> KeyValueDataFileWriter <span class="hljs-title function_">createDataFileWriter</span><span class="hljs-params">(
    Path path, <span class="hljs-type">int</span> level, FileSource fileSource)</span> {
<span class="hljs-keyword">return</span> formatContext.thinModeEnabled() <span class="hljs-comment">// æ˜¯å¦å¼€å¯ç˜¦æ¨¡å¼ï¼Œé€šè¿‡é…ç½®'data-file.thin-mode'ç»‘å®šï¼Œé»˜è®¤æ˜¯false</span>
        ? <span class="hljs-keyword">new</span> <span class="hljs-title class_">KeyValueThinDataFileWriterImpl</span>( <span class="hljs-comment">// ç˜¦æ¨¡å¼ï¼šä»…å­˜å‚¨å¢é‡å˜æ›´æ›´æ•°æ®</span>
                fileIO,
                formatContext.writerFactory(level),
                path,
                <span class="hljs-keyword">new</span> <span class="hljs-title class_">KeyValueThinSerializer</span>(keyType, valueType)::toRow,
                keyType,
                valueType,
                formatContext.extractor(level),
                schemaId,
                level,
                formatContext.compression(level),
                options,
                fileSource,
                fileIndexOptions)
        : <span class="hljs-keyword">new</span> <span class="hljs-title class_">KeyValueDataFileWriterImpl</span>( <span class="hljs-comment">// æ™®é€šæ¨¡å¼ï¼šå­˜å‚¨å®Œæ•´æ•°æ®ï¼Œå…¨é‡å†™å…¥/è¦†ç›–</span>
                fileIO,
                formatContext.writerFactory(level),
                path,
                <span class="hljs-keyword">new</span> <span class="hljs-title class_">KeyValueSerializer</span>(keyType, valueType)::toRow,
                keyType,
                valueType,
                formatContext.extractor(level),
                schemaId,
                level,
                formatContext.compression(level),
                options,
                fileSource,
                fileIndexOptions);
}
</code></pre>
<h3 data-id="heading-5">2.æ¶‰åŠçš„<code>SingleFileWriter</code>ç±»</h3>
<p>æ•´ä½“çš„æƒ…å†µå¦‚ä¸‹
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/078bf93c8f3a426991b19d1402e878f2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgZXhwZWN0N2c=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765794554&amp;x-signature=w64knDxjlrrVQlKIoaoUZA%2FzlJc%3D" alt="image.png" loading="lazy"/></p>
<h4 data-id="heading-6">(1) <code>SingleFileWriterç±»</code> -- æ ¸å¿ƒ1</h4>
<h5 data-id="heading-7">&lt;1&gt; å±æ€§å’Œæ„é€ å‡½æ•°</h5>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">Logger</span> <span class="hljs-variable">LOG</span> <span class="hljs-operator">=</span> LoggerFactory.getLogger(SingleFileWriter.class);

<span class="hljs-keyword">protected</span> <span class="hljs-keyword">final</span> FileIO fileIO; <span class="hljs-comment">// æŠ½è±¡æ–‡ä»¶IOæ¥å£</span>
<span class="hljs-keyword">protected</span> <span class="hljs-keyword">final</span> Path path; <span class="hljs-comment">// è·¯å¾„</span>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Function&lt;T, InternalRow&gt; converter; <span class="hljs-comment">// ç±»å‹è½¬æ¢å™¨ï¼Œå°†åŸå§‹kvè®°å½•è½¬ä¸ºPaimonå†…éƒ¨è¡Œçš„InternalRowç±»å‹</span>

<span class="hljs-keyword">private</span> FormatWriter writer; <span class="hljs-comment">// å†™å…¥å™¨</span>
<span class="hljs-keyword">private</span> PositionOutputStream out; <span class="hljs-comment">// æ–‡ä»¶è¾“å‡ºæµ</span>

<span class="hljs-keyword">private</span> <span class="hljs-type">long</span> recordCount; <span class="hljs-comment">// å†™å…¥çš„è®°å½•æ•°</span>
<span class="hljs-keyword">protected</span> <span class="hljs-type">boolean</span> closed; <span class="hljs-comment">// æ˜¯å¦å…³é—­å†™å…¥å™¨</span>

<span class="hljs-keyword">public</span> <span class="hljs-title function_">SingleFileWriter</span><span class="hljs-params">(
        FileIO fileIO,
        FormatWriterFactory factory,
        Path path,
        Function&lt;T, InternalRow&gt; converter,
        String compression,
        <span class="hljs-type">boolean</span> asyncWrite)</span> {
    <span class="hljs-built_in">this</span>.fileIO = fileIO;
    <span class="hljs-built_in">this</span>.path = path;
    <span class="hljs-built_in">this</span>.converter = converter;

    <span class="hljs-keyword">try</span> {
        <span class="hljs-comment">// 1.åˆ›å»ºæ–‡ä»¶è¾“å‡ºæµï¼Œå¼‚æ­¥æˆ–è€…åŒæ­¥</span>
        out = fileIO.newOutputStream(path, <span class="hljs-literal">false</span>); <span class="hljs-comment">// falseè¯´æ˜ä¸æ˜¯overwriteè¦†ç›–æ“ä½œï¼Œè€Œæ˜¯intoæ“ä½œ</span>
        <span class="hljs-keyword">if</span> (asyncWrite) {
            out = <span class="hljs-keyword">new</span> <span class="hljs-title class_">AsyncPositionOutputStream</span>(out);
        }
        <span class="hljs-comment">// æ­¥éª¤2ï¼šåˆ›å»ºå…·ä½“æ ¼å¼çš„å†™å…¥å™¨ï¼ˆå¦‚ParquetWriterï¼‰</span>
        writer = factory.create(out, compression);
    } <span class="hljs-keyword">catch</span> (IOException e) {
        LOG.warn(
                <span class="hljs-string">"Failed to open the bulk writer, closing the output stream and throw the error."</span>,
                e);
        <span class="hljs-keyword">if</span> (out != <span class="hljs-literal">null</span>) {
            abort();
        }
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UncheckedIOException</span>(e);
    }
    <span class="hljs-comment">// 3.åˆå§‹åŒ–è®°å½•æ•°å’Œclosed</span>
    <span class="hljs-built_in">this</span>.recordCount = <span class="hljs-number">0</span>;
    <span class="hljs-built_in">this</span>.closed = <span class="hljs-literal">false</span>;
}
</code></pre>
<h5 data-id="heading-8">&lt;2&gt; <code>write()å’ŒwriteBundle()</code></h5>
<p>å†™å…¥çš„æ ¸å¿ƒé€»è¾‘å¦‚ä¸‹</p>
<ol>
<li>å°†recordè½¬ä¸ºPaimonå†…éƒ¨è¡Œç±»å‹<code>InternalRow</code></li>
<li>è°ƒç”¨å†™å…¥å™¨å»å°†è½¬åçš„æ•°æ®å†™å…¥</li>
<li>è®°å½•å†™å…¥æ•°æ®é‡</li>
<li>æµå¼è¿”å›è½¬æ¢åçš„æ•°æ®ä¾›å­ç±»ç»Ÿè®¡æ”¶é›†ï¼›æ‰¹å¼ä»€ä¹ˆä¹Ÿä¸è¿”å›</li>
</ol>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// æµå¼å†™å…¥</span>
<span class="hljs-meta">@Override</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">write</span><span class="hljs-params">(T record)</span> <span class="hljs-keyword">throws</span> IOException {
    <span class="hljs-comment">// è°ƒwriteImplå»å†™å…¥æ•°æ®</span>
    writeImpl(record);
}

<span class="hljs-comment">// æ‰¹é‡å†™å…¥</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">writeBundle</span><span class="hljs-params">(BundleRecords bundle)</span> <span class="hljs-keyword">throws</span> IOException {
    <span class="hljs-keyword">if</span> (closed) {
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(<span class="hljs-string">"Writer has already closed!"</span>);
    }

    <span class="hljs-keyword">try</span> {
        <span class="hljs-comment">// CASE-1: å†™å…¥å™¨ instanceof BundleFormatWriter</span>
        <span class="hljs-keyword">if</span> (writer <span class="hljs-keyword">instanceof</span> BundleFormatWriter) {
            ((BundleFormatWriter) writer).writeBundle(bundle); <span class="hljs-comment">// è°ƒæ‰¹é‡å†™å…¥å™¨çš„writeBundle()æ–¹æ³•å»å†™å…¥</span>
        } 
        <span class="hljs-comment">// CASE-2: å†™å…¥å™¨ä¸æ˜¯BundleFormatWriterå®ç°ç±»</span>
        <span class="hljs-keyword">else</span> {
            <span class="hljs-comment">// éå†æ‰¹ï¼Œè¿›è¡Œä¸€æ¡ä¸€æ¡write</span>
            <span class="hljs-keyword">for</span> (InternalRow row : bundle) {
                writer.addElement(row);
            }
        }
        <span class="hljs-comment">// è®°å½•æ‰¹é‡å†™å…¥æ•°æ®</span>
        recordCount += bundle.rowCount();
    } <span class="hljs-keyword">catch</span> (Throwable e) {
        LOG.warn(<span class="hljs-string">"Exception occurs when writing file "</span> + path + <span class="hljs-string">". Cleaning up."</span>, e);
        abort();
        <span class="hljs-keyword">throw</span> e;
    }
}

<span class="hljs-comment">// æ ¸å¿ƒå†™å…¥é€»è¾‘</span>
<span class="hljs-keyword">protected</span> InternalRow <span class="hljs-title function_">writeImpl</span><span class="hljs-params">(T record)</span> <span class="hljs-keyword">throws</span> IOException {
    <span class="hljs-keyword">if</span> (closed) {
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(<span class="hljs-string">"Writer has already closed!"</span>);
    }

    <span class="hljs-keyword">try</span> {
        <span class="hljs-comment">// 1.å°†recordè½¬ä¸ºPaimonå†…éƒ¨è¡Œç±»å‹InternalRow</span>
        <span class="hljs-type">InternalRow</span> <span class="hljs-variable">rowData</span> <span class="hljs-operator">=</span> converter.apply(record);
        <span class="hljs-comment">// 2.è°ƒç”¨å†™å…¥å™¨ï¼ˆå¦‚ParquetWriterï¼‰å»å°†rowDataå†™å…¥</span>
        writer.addElement(rowData);
        <span class="hljs-comment">// 3.å†™å…¥è®°å½•æ•°++</span>
        recordCount++;
        <span class="hljs-comment">// 4.è¿”å›è½¬æ¢åçš„è¡Œæ•°æ®ï¼ˆä¾›å­ç±»ç»Ÿè®¡æ”¶é›†ä½¿ç”¨ï¼‰</span>
        <span class="hljs-keyword">return</span> rowData;
    } <span class="hljs-keyword">catch</span> (Throwable e) {
        LOG.warn(<span class="hljs-string">"Exception occurs when writing file "</span> + path + <span class="hljs-string">". Cleaning up."</span>, e);
        abort();
        <span class="hljs-keyword">throw</span> e;
    }
}
</code></pre>
<h5 data-id="heading-9">&lt;3&gt; <code>recordCount()å’ŒreachTargetSize()</code></h5>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// è¿”å›å·²è®°å½•çš„å†™å…¥æ€»æ•°</span>
<span class="hljs-meta">@Override</span>
<span class="hljs-keyword">public</span> <span class="hljs-type">long</span> <span class="hljs-title function_">recordCount</span><span class="hljs-params">()</span> {
    <span class="hljs-keyword">return</span> recordCount;
}

<span class="hljs-comment">// æ–‡ä»¶æ»šåŠ¨çš„æ ‡è®°ï¼Œåç»­ç”±RollingFileWriterå»è°ƒç”¨</span>
<span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">reachTargetSize</span><span class="hljs-params">(<span class="hljs-type">boolean</span> suggestedCheck, <span class="hljs-type">long</span> targetSize)</span> <span class="hljs-keyword">throws</span> IOException {
    <span class="hljs-comment">// æ£€æŸ¥å·²å†™å…¥çš„æ–‡ä»¶æ˜¯å¦è¾¾åˆ°äº†ç›®æ ‡æ–‡ä»¶å¤§å°target-file-size</span>
    <span class="hljs-keyword">return</span> writer.reachTargetSize(suggestedCheck, targetSize);
}
</code></pre>
<h5 data-id="heading-10">&lt;4&gt; <code>abort()</code></h5>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// ä¸­æ­¢å†™å…¥ï¼Œå¹¶æ¸…ç†èµ„æºå’Œæ–‡ä»¶</span>
<span class="hljs-meta">@Override</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">abort</span><span class="hljs-params">()</span> {
    <span class="hljs-comment">// å…³é—­å†™å…¥å™¨</span>
    <span class="hljs-keyword">if</span> (writer != <span class="hljs-literal">null</span>) {
        IOUtils.closeQuietly(writer);
        writer = <span class="hljs-literal">null</span>;
    }
    <span class="hljs-comment">// å…³é—­è¾“å‡ºæµ</span>
    <span class="hljs-keyword">if</span> (out != <span class="hljs-literal">null</span>) {
        IOUtils.closeQuietly(out);
        out = <span class="hljs-literal">null</span>;
    }
    <span class="hljs-comment">// åˆ é™¤è¯¥pathè·¯å¾„ä¸‹å†™å…¥çš„æ–‡ä»¶</span>
    fileIO.deleteQuietly(path);
}
</code></pre>
<h4 data-id="heading-11">(2) <code>StatsCollectingSingleFileWriterç±»</code></h4>
<h5 data-id="heading-12">&lt;1&gt; å±æ€§å’Œæ„é€ å‡½æ•°</h5>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Nullable</span> <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> SimpleStatsExtractor simpleStatsExtractor; <span class="hljs-comment">// æ‰¹é‡å†™å…¥åœºæ™¯ä¸‹ï¼Œä»æ–‡ä»¶ä¸­æå–çš„å­—æ®µç»Ÿè®¡ä¿¡æ¯</span>
<span class="hljs-meta">@Nullable</span> <span class="hljs-keyword">private</span> <span class="hljs-type">SimpleStatsCollector</span> <span class="hljs-variable">simpleStatsCollector</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>; <span class="hljs-comment">// æµå¼å†™å…¥åœºæ™¯ä¸‹ï¼Œå®æ—¶æ”¶é›†çš„å­—æ®µç»Ÿè®¡ä¿¡æ¯</span>
<span class="hljs-meta">@Nullable</span> <span class="hljs-keyword">private</span> SimpleColStats[] noneStats = <span class="hljs-literal">null</span>; <span class="hljs-comment">// ç¦ç”¨ç»Ÿè®¡æ—¶çš„é»˜è®¤å€¼ï¼Œæ•°ç»„ä¸­æ¯ä¸ªå…ƒç´ éƒ½æ˜¯SimpleColStats.NONE</span>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">boolean</span> isStatsDisabled; <span class="hljs-comment">// æ˜¯å¦ç¦ç”¨ç»Ÿè®¡æ”¶é›†ï¼Œè‹¥æ‰€æœ‰å­—æ®µçš„ç»Ÿè®¡æ”¶é›†å™¨éƒ½æ˜¯NoneSimpleColStatsCollectorï¼Œåˆ™ä¸º true</span>

<span class="hljs-keyword">public</span> <span class="hljs-title function_">StatsCollectingSingleFileWriter</span><span class="hljs-params">(
        FileIO fileIO,
        FormatWriterFactory factory,
        Path path,
        Function&lt;T, InternalRow&gt; converter,
        RowType writeSchema,
        <span class="hljs-meta">@Nullable</span> SimpleStatsExtractor simpleStatsExtractor,
        String compression,
        SimpleColStatsCollector.Factory[] statsCollectors,
        <span class="hljs-type">boolean</span> asyncWrite)</span> {
    <span class="hljs-comment">// 1.è°ƒç”¨çˆ¶ç±»SingleFileWriterçš„æ„é€ å‡½æ•°</span>
    <span class="hljs-built_in">super</span>(fileIO, factory, path, converter, compression, asyncWrite);
    <span class="hljs-comment">// 2.åˆå§‹åŒ–</span>
    <span class="hljs-built_in">this</span>.simpleStatsExtractor = simpleStatsExtractor;
    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.simpleStatsExtractor == <span class="hljs-literal">null</span>) {
        <span class="hljs-built_in">this</span>.simpleStatsCollector = <span class="hljs-keyword">new</span> <span class="hljs-title class_">SimpleStatsCollector</span>(writeSchema, statsCollectors);
    }
    Preconditions.checkArgument(
            statsCollectors.length == writeSchema.getFieldCount(),
            <span class="hljs-string">"The stats collector is not aligned to write schema."</span>);
    <span class="hljs-built_in">this</span>.isStatsDisabled =
            Arrays.stream(SimpleColStatsCollector.create(statsCollectors))
                    .allMatch(p -&gt; p <span class="hljs-keyword">instanceof</span> NoneSimpleColStatsCollector);
    <span class="hljs-keyword">if</span> (isStatsDisabled) {
        <span class="hljs-built_in">this</span>.noneStats =
                IntStream.range(<span class="hljs-number">0</span>, statsCollectors.length)
                        .mapToObj(i -&gt; SimpleColStats.NONE)
                        .toArray(SimpleColStats[]::<span class="hljs-keyword">new</span>);
    }
}
</code></pre>
<h5 data-id="heading-13">&lt;2&gt; <code>write()</code>å’Œ<code>writeBundle()</code></h5>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Override</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">write</span><span class="hljs-params">(T record)</span> <span class="hljs-keyword">throws</span> IOException {
    <span class="hljs-comment">// æ­¥1.è°ƒç”¨çˆ¶ç±»SingleFileWriter.writeImpl()ï¼Œå°†è®°å½•åºåˆ—åŒ–å¹¶å†™å…¥æ–‡ä»¶ä¸­ï¼Œè¿”å›åºåˆ—åŒ–åçš„InternalRow</span>
    <span class="hljs-type">InternalRow</span> <span class="hljs-variable">rowData</span> <span class="hljs-operator">=</span> writeImpl(record);
    <span class="hljs-comment">// æ­¥2.è‹¥å¼€å¯å®æ—¶ç»Ÿè®¡ï¼Œåˆ™è°ƒç”¨SimpleStatsCollector.collect()æ”¶é›†å½“å‰è®°å½•çš„å­—æ®µç»Ÿè®¡</span>
    <span class="hljs-keyword">if</span> (simpleStatsCollector != <span class="hljs-literal">null</span> &amp;&amp; !simpleStatsCollector.isDisabled()) {
        simpleStatsCollector.collect(rowData);
    }
}

<span class="hljs-meta">@Override</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">writeBundle</span><span class="hljs-params">(BundleRecords bundle)</span> <span class="hljs-keyword">throws</span> IOException {
    Preconditions.checkState(
            simpleStatsExtractor != <span class="hljs-literal">null</span>,
            <span class="hljs-string">"Can't write bundle without simpleStatsExtractor, we may lose all the statistical information"</span>);
    <span class="hljs-comment">// è°ƒç”¨çˆ¶ç±»SingleFileWriteræ‰¹é‡å†™å…¥é€»è¾‘ï¼ˆä¸å®æ—¶æ”¶é›†ç»Ÿè®¡ï¼Œåç»­ä»æ–‡ä»¶æå–ï¼‰</span>
    <span class="hljs-built_in">super</span>.writeBundle(bundle);
}
</code></pre>
<h5 data-id="heading-14">&lt;3&gt; <code>fieldStats()</code></h5>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// æå–æœ€ç»ˆçš„å­—æ®µç»Ÿè®¡ä¿¡æ¯</span>
<span class="hljs-keyword">public</span> SimpleColStats[] fieldStats() <span class="hljs-keyword">throws</span> IOException {
    Preconditions.checkState(closed, <span class="hljs-string">"Cannot access metric unless the writer is closed."</span>);
    <span class="hljs-comment">// CASE-1: æ‰¹é‡å†™å…¥åœºæ™¯ï¼Œä»æ–‡ä»¶ä¸­æå–</span>
    <span class="hljs-keyword">if</span> (simpleStatsExtractor != <span class="hljs-literal">null</span>) {
        <span class="hljs-keyword">if</span> (isStatsDisabled) {
            <span class="hljs-keyword">return</span> noneStats;
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-keyword">return</span> simpleStatsExtractor.extract(fileIO, path);
        }
    }
    <span class="hljs-comment">// CASE-2: å•æ¡å†™å…¥åœºæ™¯ï¼Œä»SimpleStatsCollectorå®æ—¶æ”¶é›†å™¨ä¸­æå–</span>
    <span class="hljs-keyword">else</span> {
        <span class="hljs-keyword">return</span> simpleStatsCollector.extract();
    }
}
</code></pre>
<h4 data-id="heading-15">(3) <code>KeyValueDataFileWriterç±»</code> -- æ ¸å¿ƒ2</h4>
<h5 data-id="heading-16">&lt;1&gt; ç›¸å…³å±æ€§</h5>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">Logger</span> <span class="hljs-variable">LOG</span> <span class="hljs-operator">=</span> LoggerFactory.getLogger(KeyValueDataFileWriter.class);  
<span class="hljs-comment">// å…¬å…±çŠ¶æ€å±æ€§  </span>
<span class="hljs-keyword">protected</span> <span class="hljs-keyword">final</span> RowType keyType;  
<span class="hljs-keyword">protected</span> <span class="hljs-keyword">final</span> RowType valueType;  
<span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">long</span> schemaId; <span class="hljs-comment">// Schemaç‰ˆæœ¬ID  </span>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> level; <span class="hljs-comment">// æ–‡ä»¶æ‰€å±levelå±‚çº§  </span>
  
<span class="hljs-comment">// ç»Ÿè®¡ä¿¡æ¯ç›¸å…³  </span>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> SimpleStatsConverter keyStatsConverter; <span class="hljs-comment">// Keyç»Ÿè®¡ä¿¡æ¯è½¬æ¢å™¨ï¼ˆå°† SimpleColStats è½¬ä¸ºäºŒè¿›åˆ¶å­˜å‚¨çš„ SimpleStatsï¼‰  </span>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> SimpleStatsConverter valueStatsConverter; <span class="hljs-comment">// Valueç»Ÿè®¡ä¿¡æ¯è½¬æ¢å™¨ï¼ˆå°† SimpleColStats è½¬ä¸ºäºŒè¿›åˆ¶å­˜å‚¨çš„ SimpleStatsï¼‰  </span>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> InternalRowSerializer keySerializer;  
<span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> FileSource fileSource;  
<span class="hljs-meta">@Nullable</span> <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> DataFileIndexWriter dataFileIndexWriter; <span class="hljs-comment">// æ–‡ä»¶ç´¢å¼•å†™å…¥å™¨ï¼ˆç”Ÿæˆå¸ƒéš†è¿‡æ»¤å™¨ / åŒºé—´ç´¢å¼•ï¼Œä¼˜åŒ–æŸ¥è¯¢æ€§èƒ½ï¼‰  </span>
  
<span class="hljs-comment">// ç”¨äºæŸ¥è¯¢æ—¶ï¼Œå¿«é€Ÿè¿‡æ»¤  </span>
<span class="hljs-keyword">private</span> <span class="hljs-type">BinaryRow</span> <span class="hljs-variable">minKey</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>; <span class="hljs-comment">// å†™å…¥æ–‡ä»¶çš„æœ€å°ä¸»é”®  </span>
<span class="hljs-keyword">private</span> <span class="hljs-type">InternalRow</span> <span class="hljs-variable">maxKey</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>; <span class="hljs-comment">// å†™å…¥æ–‡ä»¶çš„æœ€å¤§ä¸»  </span>
<span class="hljs-keyword">private</span> <span class="hljs-type">long</span> <span class="hljs-variable">minSeqNumber</span> <span class="hljs-operator">=</span> Long.MAX_VALUE; <span class="hljs-comment">// å†™å…¥æ–‡ä»¶æœ€å°sequenceNumber  </span>
<span class="hljs-keyword">private</span> <span class="hljs-type">long</span> <span class="hljs-variable">maxSeqNumber</span> <span class="hljs-operator">=</span> Long.MIN_VALUE; <span class="hljs-comment">// å†™å…¥æ–‡ä»¶æœ€å¤§sequenceNumber  </span>
<span class="hljs-keyword">private</span> <span class="hljs-type">long</span> <span class="hljs-variable">deleteRecordCount</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; <span class="hljs-comment">// å†™å…¥æ–‡ä»¶åˆ é™¤è®°å½•æ•°</span>
</code></pre>
<h5 data-id="heading-17">&lt;2&gt; æ„é€ å‡½æ•°</h5>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-title function_">KeyValueDataFileWriter</span><span class="hljs-params">(
        FileIO fileIO,
        FormatWriterFactory factory,
        Path path,
        Function&lt;KeyValue, InternalRow&gt; converter,
        RowType keyType,
        RowType valueType,
        RowType writeRowType,
        <span class="hljs-meta">@Nullable</span> SimpleStatsExtractor simpleStatsExtractor,
        <span class="hljs-type">long</span> schemaId,
        <span class="hljs-type">int</span> level,
        String compression,
        CoreOptions options,
        FileSource fileSource,
        FileIndexOptions fileIndexOptions)</span> {
    <span class="hljs-comment">// 1.è°ƒç”¨çˆ¶ç±»StatsCollectingSingleFileWriterçš„æ„é€ å‡½æ•°</span>
    <span class="hljs-built_in">super</span>(
            fileIO,
            factory,
            path,
            converter,
            writeRowType,
            simpleStatsExtractor,
            compression,
            StatsCollectorFactories.createStatsFactories(
                    options, writeRowType.getFieldNames(), keyType.getFieldNames()),
            options.asyncFileWrite());
    <span class="hljs-comment">// 2.åˆå§‹åŒ–å…¬å…±çŠ¶æ€å±æ€§</span>
    <span class="hljs-built_in">this</span>.keyType = keyType;
    <span class="hljs-built_in">this</span>.valueType = valueType;
    <span class="hljs-built_in">this</span>.schemaId = schemaId;
    <span class="hljs-built_in">this</span>.level = level;
    <span class="hljs-comment">// 3.åˆå§‹åŒ–ç»Ÿè®¡ä¿¡æ¯ç›¸å…³å±æ€§</span>
    <span class="hljs-built_in">this</span>.keyStatsConverter = <span class="hljs-keyword">new</span> <span class="hljs-title class_">SimpleStatsConverter</span>(keyType);
    <span class="hljs-built_in">this</span>.valueStatsConverter = <span class="hljs-keyword">new</span> <span class="hljs-title class_">SimpleStatsConverter</span>(valueType, options.statsDenseStore());
    <span class="hljs-built_in">this</span>.keySerializer = <span class="hljs-keyword">new</span> <span class="hljs-title class_">InternalRowSerializer</span>(keyType);
    <span class="hljs-built_in">this</span>.fileSource = fileSource;
    <span class="hljs-built_in">this</span>.dataFileIndexWriter =
            DataFileIndexWriter.create(
                    fileIO, dataFileToFileIndexPath(path), valueType, fileIndexOptions);
}
</code></pre>
<h5 data-id="heading-18">&lt;3&gt; <code>write()</code></h5>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Override</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">write</span><span class="hljs-params">(KeyValue kv)</span> <span class="hljs-keyword">throws</span> IOException {
    <span class="hljs-comment">// æ­¥éª¤1.è°ƒçˆ¶ç±»StatsCollectingSingleFileWriter.write()ï¼Œå°†kvæ•°æ®åºåˆ—åŒ–å†™å…¥Data Fileä¸­</span>
    <span class="hljs-built_in">super</span>.write(kv);
    <span class="hljs-comment">// æ­¥éª¤2ï¼šå†™å…¥æ–‡ä»¶ç´¢å¼•ï¼ˆå¦‚å¸ƒéš†è¿‡æ»¤å™¨ï¼Œä¼˜åŒ–ç‚¹æŸ¥æ€§èƒ½ï¼‰</span>
    <span class="hljs-keyword">if</span> (dataFileIndexWriter != <span class="hljs-literal">null</span>) {
        dataFileIndexWriter.write(kv.value());
    }
    <span class="hljs-comment">// æ­¥éª¤3ï¼šæ›´æ–°min/max keyï¼ˆè¦æ±‚å†™å…¥è®°å½•å·²æ’åºï¼Œå¦åˆ™minKeyä»…å–ç¬¬ä¸€æ¡ï¼ŒmaxKeyå–æœ€åä¸€æ¡ï¼‰</span>
    updateMinKey(kv);
    updateMaxKey(kv);
    <span class="hljs-comment">// æ­¥éª¤4ï¼šæ›´æ–°æœ€å°/æœ€å¤§åºåˆ—å·ï¼ˆå¤„ç†ä¹±åºæ›´æ–°ï¼‰</span>
    updateMinSeqNumber(kv);
    updateMaxSeqNumber(kv);
    <span class="hljs-comment">// æ­¥éª¤5ï¼šç»Ÿè®¡åˆ é™¤è®°å½•æ•°ï¼ˆRetractç±»å‹ä¸ºåˆ é™¤ï¼‰</span>
    <span class="hljs-keyword">if</span> (kv.valueKind().isRetract()) {
        deleteRecordCount++;
    }

    <span class="hljs-keyword">if</span> (LOG.isDebugEnabled()) {
        LOG.debug(<span class="hljs-string">"Write to Path "</span> + path + <span class="hljs-string">" key value "</span> + kv.toString(keyType, valueType));
    }
}

<span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">updateMinKey</span><span class="hljs-params">(KeyValue kv)</span> {
    <span class="hljs-keyword">if</span> (minKey == <span class="hljs-literal">null</span>) {
        minKey = keySerializer.toBinaryRow(kv.key()).copy();
    }
}

<span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">updateMaxKey</span><span class="hljs-params">(KeyValue kv)</span> {
    maxKey = kv.key();
}

<span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">updateMinSeqNumber</span><span class="hljs-params">(KeyValue kv)</span> {
    minSeqNumber = Math.min(minSeqNumber, kv.sequenceNumber());
}

<span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">updateMaxSeqNumber</span><span class="hljs-params">(KeyValue kv)</span> {
    maxSeqNumber = Math.max(maxSeqNumber, kv.sequenceNumber());
}
</code></pre>
<h5 data-id="heading-19">&lt;4&gt; <code>result()</code></h5>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// ç”Ÿæˆæ–‡ä»¶å…ƒæ•°æ®</span>
<span class="hljs-meta">@Override</span>
<span class="hljs-meta">@Nullable</span>
<span class="hljs-keyword">public</span> DataFileMeta <span class="hljs-title function_">result</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> IOException {
    <span class="hljs-keyword">if</span> (recordCount() == <span class="hljs-number">0</span>) {
        <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
    }
    <span class="hljs-comment">// 1.è°ƒç”¨å­ç±»å®ç°çš„fetchKeyValueStatsï¼Œè·å–keyå’Œvalueçš„å…¨éƒ¨ç»Ÿè®¡ä¿¡æ¯</span>
    Pair&lt;SimpleColStats[], SimpleColStats[]&gt; keyValueStats = fetchKeyValueStats(fieldStats());
    <span class="hljs-comment">// 2.å°†keyå’Œvalueçš„ç»Ÿè®¡ä¿¡æ¯è½¬æ¢æˆäºŒè¿›åˆ¶å­˜å‚¨çš„SimpleStats</span>
    <span class="hljs-type">SimpleStats</span> <span class="hljs-variable">keyStats</span> <span class="hljs-operator">=</span> keyStatsConverter.toBinaryAllMode(keyValueStats.getKey());
    Pair&lt;List&lt;String&gt;, SimpleStats&gt; valueStatsPair =
            valueStatsConverter.toBinary(keyValueStats.getValue());
    <span class="hljs-comment">// 3.ç”Ÿæˆæ–‡ä»¶ç´¢å¼•ç»“æ„</span>
    DataFileIndexWriter.<span class="hljs-type">FileIndexResult</span> <span class="hljs-variable">indexResult</span> <span class="hljs-operator">=</span>
            dataFileIndexWriter == <span class="hljs-literal">null</span>
                    ? DataFileIndexWriter.EMPTY_RESULT
                    : dataFileIndexWriter.result();
    <span class="hljs-comment">// 4.æ„é€ DataFileMetaå…ƒæ•°æ®ä¿¡æ¯</span>
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">DataFileMeta</span>(
            path.getName(),
            fileIO.getFileSize(path),
            recordCount(),
            minKey,
            keySerializer.toBinaryRow(maxKey).copy(),
            keyStats,
            valueStatsPair.getValue(),
            minSeqNumber,
            maxSeqNumber,
            schemaId,
            level,
            indexResult.independentIndexFile() == <span class="hljs-literal">null</span>
                    ? Collections.emptyList()
                    : Collections.singletonList(indexResult.independentIndexFile()),
            deleteRecordCount,
            indexResult.embeddedIndexBytes(),
            fileSource,
            valueStatsPair.getKey(),
            <span class="hljs-literal">null</span>);
}
</code></pre>
<h4 data-id="heading-20">(4) <code>KeyValueThinDataFileWriterImplç±»</code> -- ç˜¦æ¨¡å¼DFå†™å…¥å™¨</h4>
<p>é‡‡ç”¨ç˜¦æ¨¡å¼(<code>é…ç½®'data-file.thin-mode'ç»‘å®šï¼Œé»˜è®¤æ˜¯false</code>)ï¼ŒData FileåªåŒ…å«<code>_SEQUENCE_NUMBER_å’Œ_ROW_KIND_å’Œvalueå­—æ®µ</code>ï¼Œä¸å­˜å‚¨keyå­—æ®µ</p>
<h5 data-id="heading-21">&lt;1&gt; æ„é€ å‡½æ•°</h5>
<p>æ­¥éª¤å¦‚ä¸‹ï¼š</p>
<ol>
<li>çˆ¶ç±»æ„é€ è°ƒç”¨</li>
<li>æ„å»ºæ‰€æœ‰å­—æ®µID-&gt;å­—æ®µç´¢å¼•çš„æ˜ å°„ï¼Œæ”¾å…¥idToIndexsçš„Mapä¸­ï¼Œç»“æ„ä¸ºï¼š<code>[å­—æ®µ1-&gt;ç´¢å¼•3, å­—æ®µ2-&gt;ç´¢å¼•7, ...]</code></li>
<li>è·å–keyå­—æ®µç´¢å¼•åœ¨idToIndexä¸­å¯¹åº”çš„å­—æ®µç´¢å¼•ï¼Œæ”¾å…¥keyStatMappingæ•°ç»„ä¸­ï¼Œç»“æ„ä¸ºï¼š<code>[keyå­—æ®µ1:ç´¢å¼•1, keyå­—æ®µ2:ç´¢å¼•3, ...]</code></li>
</ol>
<blockquote>
<p><strong>æ³¨æ„</strong>ï¼šä¸»é”®å­—æ®µID = ä¸»é”®keyçš„æ˜ å°„ID - SpecialFields.KEY_FIELD_ID_STARTï¼Œå…¶å®å°±æ˜¯ä¸»é”®keyçš„æ˜ å°„ID - Integer.MAX_VALUE / 2ï¼Œwhyï¼Ÿå› ä¸ºåº•å±‚Keyçš„æ˜ å°„idä¸ºID = 1073741823 + (field-id)ï¼Œå› æ­¤ï¼Œéœ€è¦å‡å»1073741823(ä¹Ÿå°±æ˜¯Integer.MAX_VALUE / 2)</p>
</blockquote>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-title function_">KeyValueThinDataFileWriterImpl</span><span class="hljs-params">(
    FileIO fileIO,
    FormatWriterFactory factory,
    Path path,
    Function&lt;KeyValue, InternalRow&gt; converter,
    RowType keyType,
    RowType valueType,
    <span class="hljs-meta">@Nullable</span> SimpleStatsExtractor simpleStatsExtractor,
    <span class="hljs-type">long</span> schemaId,
    <span class="hljs-type">int</span> level,
    String compression,
    CoreOptions options,
    FileSource fileSource,
    FileIndexOptions fileIndexOptions)</span> {
        <span class="hljs-built_in">super</span>(
                fileIO,
                factory,
                path,
                converter,
                keyType,
                valueType,
                KeyValue.schema(RowType.of(), valueType), <span class="hljs-comment">// ä¸ä¼ å…¥keyçš„schemaï¼Œåªä¼ å…¥valueçš„schema</span>
                simpleStatsExtractor,
                schemaId,
                level,
                compression,
                options,
                fileSource,
                fileIndexOptions); <span class="hljs-comment">// çˆ¶ç±»æ„é€ è°ƒç”¨</span>
        <span class="hljs-comment">// æ­¥1.æ„å»ºæ‰€æœ‰å­—æ®µID-&gt;å­—æ®µç´¢å¼•çš„æ˜ å°„ï¼Œæ”¾å…¥idToIndex</span>
        Map&lt;Integer, Integer&gt; idToIndex = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;(valueType.getFieldCount());
        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; valueType.getFieldCount(); i++) {
            idToIndex.put(valueType.getFields().get(i).id(), i);
        }
        <span class="hljs-comment">// æ­¥2.è·å–keyå­—æ®µç´¢å¼•åœ¨idToIndexä¸­å¯¹åº”çš„å­—æ®µç´¢å¼•ï¼Œæ”¾å…¥keyStatMappingæ•°ç»„ä¸­</span>
        <span class="hljs-built_in">this</span>.keyStatMapping = <span class="hljs-keyword">new</span> <span class="hljs-title class_">int</span>[keyType.getFieldCount()];
        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; keyType.getFieldCount(); i++) {
            keyStatMapping[i] =
                    idToIndex.get(
                            <span class="hljs-comment">// æ³¨æ„ï¼šä¸»é”®å­—æ®µID = ä¸»é”®keyçš„æ˜ å°„ID - SpecialFields.KEY_FIELD_ID_STARTï¼Œå…¶å®å°±æ˜¯ä¸»é”®keyçš„æ˜ å°„ID - Integer.MAX_VALUE / 2ï¼Œwhyï¼Ÿ</span>
                            <span class="hljs-comment">// å› ä¸ºåº•å±‚Keyçš„æ˜ å°„idä¸ºID = 1073741823 + (field-id)ï¼Œå› æ­¤éœ€è¦å‡å»1073741823(ä¹Ÿå°±æ˜¯Integer.MAX_VALUE / 2)</span>
                            keyType.getFields().get(i).id() - SpecialFields.KEY_FIELD_ID_START);
        }
}
</code></pre>
<h5 data-id="heading-22">&lt;2&gt; <code>fetchKeyValueStats()</code> -- æå–keyå’Œvalueçš„ç»Ÿè®¡ä¿¡æ¯</h5>
<p>ç˜¦æ¨¡å¼ä¸‹rowStatsç»“æ„ï¼š<code>[0:_SEQUENCE_NUMBER_, 1:_ROW_KIND_, 2:valueå­—æ®µ1, 3:valueå­—æ®µ2, ...]</code></p>
<p>å› æ­¤ï¼Œæ•°ç»„éœ€è¦ä»ç¬¬3ä¸ªä½ç½®å¼€å§‹æˆªæ–­ï¼Œæœ€åçš„ç»“æ„ï¼š<code>[0:valueå­—æ®µ1, 1:valueå­—æ®µ2, ...]</code>
ç„¶åæ ¹æ®æ„é€ å‡½æ•°è·å–çš„<code>keyStatMapping</code>ä¸­å­˜å‚¨çš„keyå­—æ®µå¯¹åº”çš„ç´¢å¼•ä½ç½®ï¼Œå»è·å–keyçš„å€¼ï¼Œå½¢æˆkeyStatsï¼Œæœ€ååŒ…è£…æˆ<code>Pair.of(keyStats, valFieldStats)</code>è¿”å›</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">/**
 * è·å–keyå’Œvalueçš„ç»Ÿè®¡ä¿¡æ¯
 * <span class="hljs-doctag">@param</span> rowStats
 * <span class="hljs-doctag">@return</span>
 */</span>
<span class="hljs-meta">@Override</span>
Pair&lt;SimpleColStats[], SimpleColStats[]&gt; fetchKeyValueStats(SimpleColStats[] rowStats) {
    <span class="hljs-type">int</span> <span class="hljs-variable">numKeyFields</span> <span class="hljs-operator">=</span> keyType.getFieldCount();

    <span class="hljs-comment">// æ­¥éª¤1ï¼šæˆªå–valueå­—æ®µçš„ç»Ÿè®¡ä¿¡æ¯ï¼ˆè·³è¿‡å‰2ä¸ªï¼š_SEQUENCE_NUMBER_ã€_ROW_KIND_ï¼‰</span>
    <span class="hljs-comment">// ç˜¦æ¨¡å¼ä¸‹rowStatsç»“æ„ï¼š[0:_SEQUENCE_NUMBER_, 1:_ROW_KIND_, 2:valueå­—æ®µ1, 3:valueå­—æ®µ2, ...]</span>
    SimpleColStats[] valFieldStats = Arrays.copyOfRange(rowStats, <span class="hljs-number">2</span>, rowStats.length);
    <span class="hljs-comment">// æœ€åvalFieldStatsçš„ç»“æ„ï¼š[0:valueå­—æ®µ1, 1:valueå­—æ®µ2, ...]</span>

    <span class="hljs-comment">// æ­¥éª¤2ï¼šä»valueç»Ÿè®¡ä¸­æ˜ å°„å‡ºkeyç»Ÿè®¡ï¼ˆæ ¸å¿ƒï¼šä½¿ç”¨keyStatMappingï¼‰</span>
    SimpleColStats[] keyStats = <span class="hljs-keyword">new</span> <span class="hljs-title class_">SimpleColStats</span>[numKeyFields];
    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; keyStatMapping.length; i++) {
        <span class="hljs-comment">// keyStatMapping[i]æ˜¯æ„é€ å‡½æ•°é˜¶æ®µæ„é€ å¥½çš„keyå­—æ®µå¯¹åº”çš„ç´¢å¼•ä½ç½®ï¼Œä»valFieldStatsä¸­å–å¯¹åº”ç»Ÿè®¡</span>
        <span class="hljs-comment">// æ¯”å¦‚keyStatMappingä¸­å­˜çš„ç´¢å¼•æ˜¯[1,3,4,2]ï¼Œé‚£ä¹ˆå°±å»valFieldStatsæ•°æ®ä¸­ï¼Œå–[1,3,4,2]è¿™å‡ ä¸ªä½ç½®çš„å€¼ï¼Œç„¶ååˆæˆkeyStats</span>
        keyStats[i] = valFieldStats[keyStatMapping[i]];
    }

    <span class="hljs-keyword">return</span> Pair.of(keyStats, valFieldStats); <span class="hljs-comment">// è¿”å›keyç»Ÿè®¡å’Œvalueç»Ÿè®¡ï¼Œå¯¹äºç˜¦æ¨¡å¼æ¥è¯´ï¼Œå…¨éƒ¨éƒ½æ˜¯valueï¼Œå› æ­¤valFieldStatsåŸå°ä¸åŠ¨ï¼Œä¸éœ€è¦æŠŠkeyçš„ç§»é™¤</span>
}
</code></pre>
<h4 data-id="heading-23">(5) <code>KeyValueDataFileWriterImplç±»</code> -- æ™®é€šæ¨¡å¼DFå†™å…¥å™¨</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">KeyValueDataFileWriterImpl</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">KeyValueDataFileWriter</span> {

<span class="hljs-keyword">public</span> <span class="hljs-title function_">KeyValueDataFileWriterImpl</span><span class="hljs-params">(
        FileIO fileIO,
        FormatWriterFactory factory,
        Path path,
        Function&lt;KeyValue, InternalRow&gt; converter,
        RowType keyType,
        RowType valueType,
        <span class="hljs-meta">@Nullable</span> SimpleStatsExtractor simpleStatsExtractor,
        <span class="hljs-type">long</span> schemaId,
        <span class="hljs-type">int</span> level,
        String compression,
        CoreOptions options,
        FileSource fileSource,
        FileIndexOptions fileIndexOptions)</span> {
    <span class="hljs-built_in">super</span>(
            fileIO,
            factory,
            path,
            converter,
            keyType,
            valueType,
            KeyValue.schema(keyType, valueType), <span class="hljs-comment">// ä¼ å…¥å®Œæ•´çš„schema(key+value)</span>
            simpleStatsExtractor,
            schemaId,
            level,
            compression,
            options,
            fileSource,
            fileIndexOptions);
}

<span class="hljs-meta">@Override</span>
Pair&lt;SimpleColStats[], SimpleColStats[]&gt; fetchKeyValueStats(SimpleColStats[] rowStats) {
    <span class="hljs-comment">// æ­¥éª¤1ï¼šè·å–ä¸»é”®å­—æ®µæ•°é‡</span>
    <span class="hljs-type">int</span> <span class="hljs-variable">numKeyFields</span> <span class="hljs-operator">=</span> keyType.getFieldCount();
    <span class="hljs-comment">// æ­¥éª¤2ï¼šæ‹†åˆ†ç»Ÿè®¡ä¿¡æ¯å¹¶è¿”å›</span>
    <span class="hljs-keyword">return</span> Pair.of(
            <span class="hljs-comment">// ä¸»é”®ç»Ÿè®¡ï¼šæˆªå–rowStatså‰numKeyFieldsä¸ªï¼ˆ0 ~ numKeyFields-1ï¼‰</span>
            Arrays.copyOfRange(rowStats, <span class="hljs-number">0</span>, numKeyFields),
            <span class="hljs-comment">// å€¼ç»Ÿè®¡ï¼šè·³è¿‡ä¸»é”®+2ä¸ªç³»ç»Ÿå­—æ®µï¼ˆ_SEQUENCE_NUMBER_ã€_ROW_KIND_ï¼‰ï¼Œæˆªå–å‰©ä½™éƒ¨åˆ†</span>
            Arrays.copyOfRange(rowStats, numKeyFields + <span class="hljs-number">2</span>, rowStats.length ));
}
</code></pre>
<h2 data-id="heading-24">äºŒ.æ€»ç»“</h2>
<ol>
<li>æ•°æ®å†™å…¥æµç¨‹ï¼š ç±»<code>SingleFileWriter</code>çš„<code>write()</code>å®ç°çš„
<ol>
<li>å°†recordæ•°æ®è½¬ä¸ºPaimonå†…éƒ¨è¯†åˆ«çš„è¡Œç±»å‹<code>InternalRow</code></li>
<li>è°ƒç”¨å†™å…¥å™¨(å¦‚<code>ParquetWriter</code>)å°†è½¬åŒ–åçš„æ•°æ®å†™å…¥</li>
<li>è®°å½•å†™å…¥æ•°</li>
<li>æµå¼å†™å…¥ï¼Œè¿”å›<code>InternalRow</code>çš„æ•°æ®ï¼›æ‰¹å¼å†™å…¥ï¼Œä¸è¿”å›è¿™äº›</li>
</ol>
<blockquote>
<p><strong>æ‰¹é‡å†™å…¥æ³¨æ„</strong>ï¼š</p>
<ol>
<li>è‹¥å†™å…¥å™¨ä¸æ˜¯æ‰¹é‡å†™å…¥å™¨ï¼Œåˆ™éå†æ‰¹ï¼Œå»ä¸€ä¸ªä¸€ä¸ªå†™å…¥</li>
<li>è‹¥å†™å…¥å™¨æ˜¯æ‰¹é‡å†™å…¥å™¨ï¼Œåˆ™ç›´æ¥è°ƒå…¶<code>writeBundle()</code>å»æ‰¹é‡å†™å…¥</li>
</ol>
</blockquote>
<ol start="5">
<li>å­ç±»<code>KeyValueDataFileWriter</code>ä¼šç»§ç»­è®°å½•å†™å…¥çš„æ–‡ä»¶ç´¢å¼•ã€æ›´æ–°minå’Œmaxçš„ä¸»é”®ã€æ›´æ–°minå’Œmaxçš„sequnceNumberã€ç»Ÿè®¡å›æ’¤æ•°</li>
</ol>
</li>
<li>ç”Ÿæˆ<code>DataFileMeta</code>ï¼šç±»<code>KeyValueDataFileWriter</code>åŠå…¶å­ç±»å®ç°çš„
<ol>
<li>è°ƒç”¨å­ç±»å®ç°çš„<code>fetchKeyValueStats()</code>:è·å–Keyå’ŒValueçš„ç»Ÿè®¡ä¿¡æ¯</li>
<li>å°†Keyå’ŒValueçš„ç»Ÿè®¡ä¿¡æ¯è½¬ä¸ºäºŒè¿›åˆ¶å­˜å‚¨<code>SimpleStats</code></li>
<li>ç”Ÿæˆæ–‡ä»¶ç´¢å¼•ç»“æ„</li>
<li>æ„é€ <code>DataFileMeta</code>å…ƒæ•°æ®ä¿¡æ¯</li>
</ol>
</li>
<li>ç˜¦æ¨¡å¼è¡¥å……ï¼š<code>é…ç½®'data-file.thin-mode'ç»‘å®šï¼Œé»˜è®¤æ˜¯false</code>ï¼Œè¯¥æ¨¡å¼ä¸‹Data FileåªåŒ…å«<code>_SEQUENCE_NUMBER_å’Œ_ROW_KIND_å’Œvalueå­—æ®µ</code>ï¼Œä¸å­˜å‚¨keyå­—æ®µ
<ul>
<li>æ„é€ å‡½æ•°é˜¶æ®µï¼š
<ol>
<li>è°ƒçˆ¶ç±»æ„é€ å‡½æ•°</li>
<li>æ„å»ºæ‰€æœ‰å­—æ®µçš„IDå’Œç´¢å¼•æ˜ å°„mapï¼Œæ”¾å…¥<strong>idToIndexs</strong>ä¸­ï¼Œç»“æ„ä¸º:<code>[å­—æ®µ1-&gt;ç´¢å¼•2, å­—æ®µ2-&gt;ç´¢å¼•1, å­—æ®µ3-&gt;ç´¢å¼•3, ...]</code></li>
<li>è·å–Keyå­—æ®µç´¢å¼•ï¼Œæ”¾å…¥æ•°ç»„<strong>keyStatMapping</strong>ä¸­ï¼Œç»“æ„ä¸º:<code>[keyå­—æ®µ1:ç´¢å¼•1, keyå­—æ®µ2:ç´¢å¼•3, ...]</code></li>
</ol>
</li>
<li><code>fetchKeyValueStats()</code>:ç˜¦æ¨¡å¼ä¸‹rowStatsç»“æ„ä¸º:<code>[0:_SEQUENCE_NUMBER_, 1:_ROW_KIND_, 2:valueå­—æ®µ1, 3:valueå­—æ®µ2, ...]</code>
<ol>
<li>å°†rowStatsä»ç¬¬ä¸‰ä¸ªä½ç½®å¼€å§‹é˜¶æ®µï¼Œæœ€ç»ˆç»“æ„ä¸º:<code>[0:valueå­—æ®µ1, 1:valueå­—æ®µ2, ...]</code></li>
<li>æ ¹æ®<strong>keyStatMapping</strong>ä¸­å­˜å‚¨çš„keyå­—æ®µå¯¹åº”çš„ç´¢å¼•ä½ç½®ï¼Œå»è·å–keyçš„å€¼ç»™keyStats</li>
<li>æœ€ååŒ…è£…æˆ<code>Pair.of(keyStats, valFieldStats)</code>è¿”å›</li>
</ol>
</li>
</ul>
</li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ä¼˜é›…çš„Reactè¡¨å•çŠ¶æ€ç®¡ç†]]></title>    <link>https://juejin.cn/post/7581117416811348011</link>    <guid>https://juejin.cn/post/7581117416811348011</guid>    <pubDate>2025-12-08T10:15:58.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581117416811348011" data-draft-id="7581097111896227894" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ä¼˜é›…çš„Reactè¡¨å•çŠ¶æ€ç®¡ç†"/> <meta itemprop="keywords" content="å‰ç«¯"/> <meta itemprop="datePublished" content="2025-12-08T10:15:58.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="dorisrv"/> <meta itemprop="url" content="https://juejin.cn/user/1522178380270712"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ä¼˜é›…çš„Reactè¡¨å•çŠ¶æ€ç®¡ç†
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1522178380270712/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    dorisrv
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-08T10:15:58.000Z" title="Mon Dec 08 2025 10:15:58 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»4åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">ä¼˜é›…çš„Reactè¡¨å•çŠ¶æ€ç®¡ç†</h2>
<p>ğŸŒ¸ ä½ æ˜¯å¦è¿˜åœ¨ä¸ºReactè¡¨å•ä¸­çš„é‡å¤çŠ¶æ€ç®¡ç†ä»£ç æ„Ÿåˆ°å›°æ‰°ï¼Ÿä»Šå¤©æˆ‘ä»¬å°±æ¥å­¦ä¹ å¦‚ä½•ç”¨è‡ªå®šä¹‰Hookæ¥ä¼˜é›…åœ°è§£å†³è¿™ä¸ªé—®é¢˜ï½</p>
<h3 data-id="heading-1">ä¼ ç»Ÿè¡¨å•ç®¡ç†çš„ç—›ç‚¹</h3>
<p>åœ¨Reactä¸­ï¼Œæˆ‘ä»¬é€šå¸¸è¿™æ ·ç®¡ç†è¡¨å•ï¼š</p>
<pre><code class="hljs language-jsx" lang="jsx"><span class="hljs-keyword">import</span> <span class="hljs-title class_">React</span>, { useState } <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>;

<span class="hljs-keyword">function</span> <span class="hljs-title function_">LoginForm</span>(<span class="hljs-params"/>) {
  <span class="hljs-comment">// æ¯ä¸ªå­—æ®µéƒ½éœ€è¦å•ç‹¬çš„state</span>
  <span class="hljs-keyword">const</span> [username, setUsername] = <span class="hljs-title function_">useState</span>(<span class="hljs-string">''</span>);
  <span class="hljs-keyword">const</span> [password, setPassword] = <span class="hljs-title function_">useState</span>(<span class="hljs-string">''</span>);
  <span class="hljs-keyword">const</span> [email, setEmail] = <span class="hljs-title function_">useState</span>(<span class="hljs-string">''</span>);
  
  <span class="hljs-keyword">const</span> <span class="hljs-title function_">handleSubmit</span> = (<span class="hljs-params">e</span>) =&gt; {
    e.<span class="hljs-title function_">preventDefault</span>();
    <span class="hljs-comment">// å¤„ç†è¡¨å•æäº¤</span>
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>({ username, password, email });
  };

  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">form</span> <span class="hljs-attr">onSubmit</span>=<span class="hljs-string">{handleSubmit}</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">input</span>
        <span class="hljs-attr">type</span>=<span class="hljs-string">"text"</span>
        <span class="hljs-attr">value</span>=<span class="hljs-string">{username}</span>
        <span class="hljs-attr">onChange</span>=<span class="hljs-string">{(e)</span> =&gt;</span> setUsername(e.target.value)} // æ¯ä¸ªå­—æ®µéƒ½éœ€è¦å•ç‹¬çš„onChange
        placeholder="ç”¨æˆ·å"
      /&gt;
      <span class="hljs-tag">&lt;<span class="hljs-name">input</span>
        <span class="hljs-attr">type</span>=<span class="hljs-string">"password"</span>
        <span class="hljs-attr">value</span>=<span class="hljs-string">{password}</span>
        <span class="hljs-attr">onChange</span>=<span class="hljs-string">{(e)</span> =&gt;</span> setPassword(e.target.value)}
        placeholder="å¯†ç "
      /&gt;
      <span class="hljs-tag">&lt;<span class="hljs-name">input</span>
        <span class="hljs-attr">type</span>=<span class="hljs-string">"email"</span>
        <span class="hljs-attr">value</span>=<span class="hljs-string">{email}</span>
        <span class="hljs-attr">onChange</span>=<span class="hljs-string">{(e)</span> =&gt;</span> setEmail(e.target.value)}
        placeholder="é‚®ç®±"
      /&gt;
      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"submit"</span>&gt;</span>ç™»å½•<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span></span>
  );
}
</code></pre>
<p>å½“è¡¨å•å­—æ®µå¢å¤šæ—¶ï¼Œè¿™ç§å†™æ³•ä¼šå˜å¾—éå¸¸ç¹çï¼š</p>
<ul>
<li>æ¯ä¸ªå­—æ®µéƒ½éœ€è¦å•ç‹¬çš„stateå’Œsetter</li>
<li>æ¯ä¸ªinputéƒ½éœ€è¦é‡å¤çš„onChangeé€»è¾‘</li>
<li>è¡¨å•æ•°æ®åˆ†æ•£åœ¨å¤šä¸ªstateä¸­ï¼Œä¸æ–¹ä¾¿ç»Ÿä¸€å¤„ç†</li>
</ul>
<h3 data-id="heading-2">ä¼˜é›…æ–¹æ¡ˆï¼šè‡ªå®šä¹‰useForm Hook</h3>
<p>è®©æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªé€šç”¨çš„<code>useForm</code> Hookæ¥è§£å†³è¿™äº›é—®é¢˜ï¼š</p>
<pre><code class="hljs language-jsx" lang="jsx"><span class="hljs-keyword">import</span> { useState } <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>;

<span class="hljs-comment">/**
 * é€šç”¨è¡¨å•çŠ¶æ€ç®¡ç†Hook
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">Object</span>} <span class="hljs-variable">initialValues</span> - è¡¨å•åˆå§‹å€¼
 * <span class="hljs-doctag">@returns</span> {<span class="hljs-type">Object</span>} åŒ…å«è¡¨å•å€¼ã€onChangeå¤„ç†å‡½æ•°å’Œé‡ç½®å‡½æ•°
 */</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">useForm</span> = (<span class="hljs-params">initialValues</span>) =&gt; {
  <span class="hljs-comment">// ç”¨ä¸€ä¸ªå¯¹è±¡ç»Ÿä¸€ç®¡ç†æ‰€æœ‰è¡¨å•å­—æ®µ</span>
  <span class="hljs-keyword">const</span> [values, setValues] = <span class="hljs-title function_">useState</span>(initialValues);

  <span class="hljs-comment">// é€šç”¨çš„onChangeå¤„ç†å‡½æ•°</span>
  <span class="hljs-keyword">const</span> <span class="hljs-title function_">handleChange</span> = (<span class="hljs-params">e</span>) =&gt; {
    <span class="hljs-keyword">const</span> { name, value, type, checked } = e.<span class="hljs-property">target</span>;
    <span class="hljs-comment">// å¤„ç†å¤é€‰æ¡†ç­‰ç‰¹æ®Šç±»å‹</span>
    <span class="hljs-title function_">setValues</span>(<span class="hljs-function"><span class="hljs-params">prevValues</span> =&gt;</span> ({
      ...prevValues,
      [name]: type === <span class="hljs-string">'checkbox'</span> ? checked : value
    }));
  };

  <span class="hljs-comment">// é‡ç½®è¡¨å•åˆ°åˆå§‹çŠ¶æ€</span>
  <span class="hljs-keyword">const</span> <span class="hljs-title function_">resetForm</span> = (<span class="hljs-params"/>) =&gt; {
    <span class="hljs-title function_">setValues</span>(initialValues);
  };

  <span class="hljs-keyword">return</span> { values, handleChange, resetForm };
};

<span class="hljs-comment">// ä½¿ç”¨ç¤ºä¾‹</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">LoginForm</span>(<span class="hljs-params"/>) {
  <span class="hljs-comment">// ä¸€è¡Œä»£ç åˆå§‹åŒ–æ•´ä¸ªè¡¨å•</span>
  <span class="hljs-keyword">const</span> { values, handleChange, resetForm } = <span class="hljs-title function_">useForm</span>({
    <span class="hljs-attr">username</span>: <span class="hljs-string">''</span>,
    <span class="hljs-attr">password</span>: <span class="hljs-string">''</span>,
    <span class="hljs-attr">email</span>: <span class="hljs-string">''</span>
  });

  <span class="hljs-keyword">const</span> <span class="hljs-title function_">handleSubmit</span> = (<span class="hljs-params">e</span>) =&gt; {
    e.<span class="hljs-title function_">preventDefault</span>();
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'è¡¨å•æ•°æ®:'</span>, values);
    <span class="hljs-comment">// æäº¤åé‡ç½®è¡¨å•</span>
    <span class="hljs-title function_">resetForm</span>();
  };

  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">form</span> <span class="hljs-attr">onSubmit</span>=<span class="hljs-string">{handleSubmit}</span>&gt;</span>
      {/* æ‰€æœ‰inputå…±ç”¨ä¸€ä¸ªhandleChange */}
      <span class="hljs-tag">&lt;<span class="hljs-name">input</span>
        <span class="hljs-attr">type</span>=<span class="hljs-string">"text"</span>
        <span class="hljs-attr">name</span>=<span class="hljs-string">"username"</span> // <span class="hljs-attr">æ³¨æ„nameå±æ€§è¦å’Œåˆå§‹å€¼çš„keyå¯¹åº”</span>
        <span class="hljs-attr">value</span>=<span class="hljs-string">{values.username}</span>
        <span class="hljs-attr">onChange</span>=<span class="hljs-string">{handleChange}</span>
        <span class="hljs-attr">placeholder</span>=<span class="hljs-string">"ç”¨æˆ·å"</span>
      /&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">input</span>
        <span class="hljs-attr">type</span>=<span class="hljs-string">"password"</span>
        <span class="hljs-attr">name</span>=<span class="hljs-string">"password"</span>
        <span class="hljs-attr">value</span>=<span class="hljs-string">{values.password}</span>
        <span class="hljs-attr">onChange</span>=<span class="hljs-string">{handleChange}</span>
        <span class="hljs-attr">placeholder</span>=<span class="hljs-string">"å¯†ç "</span>
      /&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">input</span>
        <span class="hljs-attr">type</span>=<span class="hljs-string">"email"</span>
        <span class="hljs-attr">name</span>=<span class="hljs-string">"email"</span>
        <span class="hljs-attr">value</span>=<span class="hljs-string">{values.email}</span>
        <span class="hljs-attr">onChange</span>=<span class="hljs-string">{handleChange}</span>
        <span class="hljs-attr">placeholder</span>=<span class="hljs-string">"é‚®ç®±"</span>
      /&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"submit"</span>&gt;</span>ç™»å½•<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"button"</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{resetForm}</span>&gt;</span>é‡ç½®<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span></span>
  );
}
</code></pre>
<h3 data-id="heading-3">è¿›é˜¶ï¼šæ·»åŠ è¡¨å•éªŒè¯</h3>
<p>æˆ‘ä»¬å¯ä»¥è¿›ä¸€æ­¥å¢å¼ºè¿™ä¸ªHookï¼Œæ·»åŠ è¡¨å•éªŒè¯åŠŸèƒ½ï¼š</p>
<pre><code class="hljs language-jsx" lang="jsx"><span class="hljs-keyword">import</span> { useState, useEffect } <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>;

<span class="hljs-comment">/**
 * å¸¦éªŒè¯çš„è¡¨å•çŠ¶æ€ç®¡ç†Hook
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">Object</span>} <span class="hljs-variable">initialValues</span> - è¡¨å•åˆå§‹å€¼
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">Function</span>} <span class="hljs-variable">validate</span> - éªŒè¯å‡½æ•°ï¼Œè¿”å›é”™è¯¯ä¿¡æ¯å¯¹è±¡
 * <span class="hljs-doctag">@returns</span> {<span class="hljs-type">Object</span>} è¡¨å•æ§åˆ¶å¯¹è±¡
 */</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">useFormWithValidation</span> = (<span class="hljs-params">initialValues, validate</span>) =&gt; {
  <span class="hljs-keyword">const</span> [values, setValues] = <span class="hljs-title function_">useState</span>(initialValues);
  <span class="hljs-keyword">const</span> [errors, setErrors] = <span class="hljs-title function_">useState</span>({});
  <span class="hljs-keyword">const</span> [isSubmitting, setIsSubmitting] = <span class="hljs-title function_">useState</span>(<span class="hljs-literal">false</span>);

  <span class="hljs-comment">// å½“è¡¨å•å€¼å˜åŒ–æ—¶è‡ªåŠ¨éªŒè¯</span>
  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">if</span> (isSubmitting) {
      <span class="hljs-keyword">const</span> validationErrors = <span class="hljs-title function_">validate</span>(values);
      <span class="hljs-title function_">setErrors</span>(validationErrors);
      <span class="hljs-title function_">setIsSubmitting</span>(<span class="hljs-literal">false</span>);
    }
  }, [values, isSubmitting, validate]);

  <span class="hljs-keyword">const</span> <span class="hljs-title function_">handleChange</span> = (<span class="hljs-params">e</span>) =&gt; {
    <span class="hljs-keyword">const</span> { name, value, type, checked } = e.<span class="hljs-property">target</span>;
    <span class="hljs-title function_">setValues</span>(<span class="hljs-function"><span class="hljs-params">prevValues</span> =&gt;</span> ({
      ...prevValues,
      [name]: type === <span class="hljs-string">'checkbox'</span> ? checked : value
    }));
    <span class="hljs-comment">// æ¸…é™¤è¯¥å­—æ®µçš„é”™è¯¯ä¿¡æ¯</span>
    <span class="hljs-title function_">setErrors</span>(<span class="hljs-function"><span class="hljs-params">prevErrors</span> =&gt;</span> ({
      ...prevErrors,
      [name]: <span class="hljs-string">''</span>
    }));
  };

  <span class="hljs-keyword">const</span> <span class="hljs-title function_">handleSubmit</span> = (<span class="hljs-params">callback</span>) =&gt; <span class="hljs-function">(<span class="hljs-params">e</span>) =&gt;</span> {
    e.<span class="hljs-title function_">preventDefault</span>();
    <span class="hljs-keyword">const</span> validationErrors = <span class="hljs-title function_">validate</span>(values);
    <span class="hljs-title function_">setErrors</span>(validationErrors);
    <span class="hljs-title function_">setIsSubmitting</span>(<span class="hljs-literal">true</span>);
    
    <span class="hljs-comment">// å¦‚æœæ²¡æœ‰é”™è¯¯ï¼Œæ‰§è¡Œæäº¤å›è°ƒ</span>
    <span class="hljs-keyword">if</span> (<span class="hljs-title class_">Object</span>.<span class="hljs-title function_">keys</span>(validationErrors).<span class="hljs-property">length</span> === <span class="hljs-number">0</span>) {
      <span class="hljs-title function_">callback</span>(values);
    }
  };

  <span class="hljs-keyword">const</span> <span class="hljs-title function_">resetForm</span> = (<span class="hljs-params"/>) =&gt; {
    <span class="hljs-title function_">setValues</span>(initialValues);
    <span class="hljs-title function_">setErrors</span>({});
  };

  <span class="hljs-keyword">return</span> { values, errors, handleChange, handleSubmit, resetForm };
};

<span class="hljs-comment">// ä½¿ç”¨ç¤ºä¾‹</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">RegisterForm</span>(<span class="hljs-params"/>) {
  <span class="hljs-comment">// éªŒè¯å‡½æ•°</span>
  <span class="hljs-keyword">const</span> <span class="hljs-title function_">validate</span> = (<span class="hljs-params">values</span>) =&gt; {
    <span class="hljs-keyword">const</span> errors = {};
    
    <span class="hljs-keyword">if</span> (!values.<span class="hljs-property">username</span>.<span class="hljs-title function_">trim</span>()) {
      errors.<span class="hljs-property">username</span> = <span class="hljs-string">'ç”¨æˆ·åä¸èƒ½ä¸ºç©º'</span>;
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (values.<span class="hljs-property">username</span>.<span class="hljs-property">length</span> &lt; <span class="hljs-number">3</span>) {
      errors.<span class="hljs-property">username</span> = <span class="hljs-string">'ç”¨æˆ·åè‡³å°‘3ä¸ªå­—ç¬¦'</span>;
    }
    
    <span class="hljs-keyword">if</span> (!values.<span class="hljs-property">email</span>) {
      errors.<span class="hljs-property">email</span> = <span class="hljs-string">'é‚®ç®±ä¸èƒ½ä¸ºç©º'</span>;
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (!<span class="hljs-regexp">/^[^\s@]+@[^\s@]+\.[^\s@]+$/</span>.<span class="hljs-title function_">test</span>(values.<span class="hljs-property">email</span>)) {
      errors.<span class="hljs-property">email</span> = <span class="hljs-string">'è¯·è¾“å…¥æœ‰æ•ˆçš„é‚®ç®±åœ°å€'</span>;
    }
    
    <span class="hljs-keyword">if</span> (!values.<span class="hljs-property">password</span>) {
      errors.<span class="hljs-property">password</span> = <span class="hljs-string">'å¯†ç ä¸èƒ½ä¸ºç©º'</span>;
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (values.<span class="hljs-property">password</span>.<span class="hljs-property">length</span> &lt; <span class="hljs-number">6</span>) {
      errors.<span class="hljs-property">password</span> = <span class="hljs-string">'å¯†ç è‡³å°‘6ä¸ªå­—ç¬¦'</span>;
    }
    
    <span class="hljs-keyword">return</span> errors;
  };

  <span class="hljs-keyword">const</span> { values, errors, handleChange, handleSubmit, resetForm } = <span class="hljs-title function_">useFormWithValidation</span>(
    { <span class="hljs-attr">username</span>: <span class="hljs-string">''</span>, <span class="hljs-attr">email</span>: <span class="hljs-string">''</span>, <span class="hljs-attr">password</span>: <span class="hljs-string">''</span> },
    validate
  );

  <span class="hljs-keyword">const</span> <span class="hljs-title function_">onSubmit</span> = (<span class="hljs-params">formData</span>) =&gt; {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'æ³¨å†ŒæˆåŠŸ:'</span>, formData);
    <span class="hljs-title function_">resetForm</span>();
  };

  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">form</span> <span class="hljs-attr">onSubmit</span>=<span class="hljs-string">{handleSubmit(onSubmit)}</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">input</span>
          <span class="hljs-attr">type</span>=<span class="hljs-string">"text"</span>
          <span class="hljs-attr">name</span>=<span class="hljs-string">"username"</span>
          <span class="hljs-attr">value</span>=<span class="hljs-string">{values.username}</span>
          <span class="hljs-attr">onChange</span>=<span class="hljs-string">{handleChange}</span>
          <span class="hljs-attr">placeholder</span>=<span class="hljs-string">"ç”¨æˆ·å"</span>
        /&gt;</span>
        {errors.username &amp;&amp; <span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">style</span>=<span class="hljs-string">{{</span> <span class="hljs-attr">color:</span> '<span class="hljs-attr">red</span>' }}&gt;</span>{errors.username}<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>}
      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
      
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">input</span>
          <span class="hljs-attr">type</span>=<span class="hljs-string">"email"</span>
          <span class="hljs-attr">name</span>=<span class="hljs-string">"email"</span>
          <span class="hljs-attr">value</span>=<span class="hljs-string">{values.email}</span>
          <span class="hljs-attr">onChange</span>=<span class="hljs-string">{handleChange}</span>
          <span class="hljs-attr">placeholder</span>=<span class="hljs-string">"é‚®ç®±"</span>
        /&gt;</span>
        {errors.email &amp;&amp; <span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">style</span>=<span class="hljs-string">{{</span> <span class="hljs-attr">color:</span> '<span class="hljs-attr">red</span>' }}&gt;</span>{errors.email}<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>}
      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
      
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">input</span>
          <span class="hljs-attr">type</span>=<span class="hljs-string">"password"</span>
          <span class="hljs-attr">name</span>=<span class="hljs-string">"password"</span>
          <span class="hljs-attr">value</span>=<span class="hljs-string">{values.password}</span>
          <span class="hljs-attr">onChange</span>=<span class="hljs-string">{handleChange}</span>
          <span class="hljs-attr">placeholder</span>=<span class="hljs-string">"å¯†ç "</span>
        /&gt;</span>
        {errors.password &amp;&amp; <span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">style</span>=<span class="hljs-string">{{</span> <span class="hljs-attr">color:</span> '<span class="hljs-attr">red</span>' }}&gt;</span>{errors.password}<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>}
      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
      
      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"submit"</span>&gt;</span>æ³¨å†Œ<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span></span>
  );
}
</code></pre>
<h3 data-id="heading-4">æ ¸å¿ƒä¼˜åŠ¿</h3>
<ol>
<li><strong>ä»£ç å¤ç”¨</strong>ï¼šä¸€ä¸ªHookå¯ä»¥ç”¨äºé¡¹ç›®ä¸­çš„æ‰€æœ‰è¡¨å•ï¼Œå‡å°‘é‡å¤ä»£ç </li>
<li><strong>é›†ä¸­ç®¡ç†</strong>ï¼šæ‰€æœ‰è¡¨å•æ•°æ®é›†ä¸­åœ¨ä¸€ä¸ªå¯¹è±¡ä¸­ï¼Œä¾¿äºå¤„ç†å’Œæäº¤</li>
<li><strong>çµæ´»æ‰©å±•</strong>ï¼šå¯ä»¥æ ¹æ®éœ€è¦æ·»åŠ éªŒè¯ã€å¼‚æ­¥æäº¤ç­‰åŠŸèƒ½</li>
<li><strong>ç±»å‹å®‰å…¨</strong>ï¼šç»“åˆTypeScriptä½¿ç”¨æ—¶ï¼Œå¯ä»¥æä¾›å®Œæ•´çš„ç±»å‹æç¤º</li>
</ol>
<h3 data-id="heading-5">æœ€ä½³å®è·µ</h3>
<p>ğŸ’¡ ä½¿ç”¨æ—¶çš„å°å»ºè®®ï¼š</p>
<ol>
<li><strong>å‘½åè§„èŒƒ</strong>ï¼šç¡®ä¿inputçš„<code>name</code>å±æ€§ä¸åˆå§‹å€¼çš„keyå®Œå…¨å¯¹åº”</li>
<li><strong>å¤æ‚è¡¨å•</strong>ï¼šå¯¹äºéå¸¸å¤æ‚çš„è¡¨å•ï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨æˆç†Ÿçš„è¡¨å•åº“ï¼ˆå¦‚Formikã€React Hook Formï¼‰</li>
<li><strong>æ€§èƒ½ä¼˜åŒ–</strong>ï¼šå¯¹äºåŒ…å«å¤§é‡å­—æ®µçš„è¡¨å•ï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨<code>useReducer</code>æ›¿ä»£<code>useState</code>æ¥ä¼˜åŒ–æ€§èƒ½</li>
<li><strong>å¼‚æ­¥éªŒè¯</strong>ï¼šå¦‚æœéœ€è¦å¼‚æ­¥éªŒè¯ï¼ˆå¦‚æ£€æŸ¥ç”¨æˆ·åæ˜¯å¦å·²å­˜åœ¨ï¼‰ï¼Œå¯ä»¥åœ¨è‡ªå®šä¹‰Hookä¸­æ·»åŠ ç›¸åº”çš„å¤„ç†é€»è¾‘</li>
</ol>
<h3 data-id="heading-6">æ€»ç»“</h3>
<p>é€šè¿‡è‡ªå®šä¹‰Hookï¼Œæˆ‘ä»¬å¯ä»¥å°†è¡¨å•çŠ¶æ€ç®¡ç†çš„é€»è¾‘å°è£…èµ·æ¥ï¼Œä½¿ç»„ä»¶ä»£ç æ›´åŠ ç®€æ´ä¼˜é›…ã€‚è¿™ç§æ–¹å¼ä¸ä»…æé«˜äº†ä»£ç çš„å¤ç”¨æ€§å’Œå¯ç»´æŠ¤æ€§ï¼Œè¿˜è®©æˆ‘ä»¬èƒ½å¤Ÿæ›´å¥½åœ°ä¸“æ³¨äºä¸šåŠ¡é€»è¾‘çš„å®ç°ã€‚</p>
<p>ä¸‹æ¬¡é‡åˆ°è¡¨å•æ—¶ï¼Œä¸å¦¨è¯•è¯•è¿™ä¸ªæ–¹æ³•å§ï½ç›¸ä¿¡ä½ ä¼šçˆ±ä¸Šè¿™ç§ç®€æ´çš„è¡¨å•ç®¡ç†æ–¹å¼ï¼ğŸ˜‰</p>
<hr/>
<p>ğŸ«¶ ä»Šå¤©çš„å°æŠ€å·§å°±åˆ†äº«åˆ°è¿™é‡Œå•¦ï¼å¦‚æœä½ æœ‰æ›´å¥½çš„è¡¨å•ç®¡ç†æ–¹æ³•ï¼Œæ¬¢è¿åœ¨è¯„è®ºåŒºäº¤æµå“¦ï½</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ç»ˆäºä¸æ¼äº†-Androidå¼€å‘å†…å­˜æ³„æ¼è¯¦è§£]]></title>    <link>https://juejin.cn/post/7580606750290903091</link>    <guid>https://juejin.cn/post/7580606750290903091</guid>    <pubDate>2025-12-07T12:56:26.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7580606750290903091" data-draft-id="7580564126402609202" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ç»ˆäºä¸æ¼äº†-Androidå¼€å‘å†…å­˜æ³„æ¼è¯¦è§£"/> <meta itemprop="keywords" content="å‰ç«¯"/> <meta itemprop="datePublished" content="2025-12-07T12:56:26.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="é©¬å­”å¤šçš„ç‚¼é‡‘æœ¯å¸ˆ"/> <meta itemprop="url" content="https://juejin.cn/user/4469974689386972"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ç»ˆäºä¸æ¼äº†-Androidå¼€å‘å†…å­˜æ³„æ¼è¯¦è§£
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4469974689386972/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    é©¬å­”å¤šçš„ç‚¼é‡‘æœ¯å¸ˆ
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-07T12:56:26.000Z" title="Sun Dec 07 2025 12:56:26 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-07
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    4
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»9åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">ä¸€ã€ä»æœ¬è´¨çœ‹â€œå†…å­˜æ³„éœ²â€æ˜¯ä»€ä¹ˆ</h2>
<p><strong>å†…å­˜æ³„éœ²åœ¨ Java/Android ä¸­çš„å®šä¹‰</strong>ï¼šå¯¹è±¡ä¸å†è¢«ä¸šåŠ¡éœ€è¦ï¼Œä½†ä»ç„¶èƒ½è¢« GC æ ¹ï¼ˆGC rootsï¼‰é€šè¿‡ä¸€æ¡æˆ–å¤šæ¡å¼•ç”¨è·¯å¾„è®¿é—®åˆ°ï¼Œå¯¼è‡´åƒåœ¾å›æ”¶å™¨ä¸ä¼šå›æ”¶å®ƒï¼Œä»è€Œå ç”¨å†…å­˜å¹¶å¯èƒ½å¼•èµ· OOMã€‚<strong>åœ¨Androidä¸­</strong> ï¼Œå†…å­˜æ³„æ¼å¤§æ¦‚å°±åŒ…æ‹¬<strong>Javaå¯¹è±¡å±‚é¢çš„æ³„æ¼</strong>å’Œ<strong>Androidç³»ç»Ÿèµ„æºï¼ˆå¦‚Bitmapã€Cursorç­‰ï¼‰çš„æœªé‡Šæ”¾é—®é¢˜</strong>ã€‚å³ä¾¿ Java å¯¹è±¡è¢«å›æ”¶ï¼Œnative èµ„æºè‹¥æ²¡æœ‰æ˜¾å¼é‡Šæ”¾ä¹Ÿä¼šæ³„éœ²ã€‚</p>
<h2 data-id="heading-1">äºŒã€åº•å±‚åŸç†</h2>
<p>ä¸Šé¢è¯´äº†ï¼Œåœ¨ Android ä¸­å†…å­˜æ³„æ¼åˆ†ä¸ºã€ŒJVM å †å†…å­˜æ³„æ¼ã€å’Œã€Œç³»ç»Ÿèµ„æºæ³„æ¼ã€ä¸¤ç±»ï¼Œ <strong>JVM ç®¡ç†çš„å¯¹è±¡ç”± GC å›æ”¶ï¼Œè€Œ Android ç³»ç»Ÿèµ„æºåˆ™ç”±å¼€å‘è€…æ‰‹åŠ¨è°ƒç”¨ API é‡Šæ”¾</strong>ï¼Œç³»ç»Ÿä¸è‡ªåŠ¨å›æ”¶ã€‚</p>
<p>å…·ä½“æ¥è¯´ <strong>Java/Kotlin å®šä¹‰çš„å¯¹è±¡</strong>ï¼ˆå¦‚ <code>Activity</code>ã€<code>View</code>ã€<code>String</code>ã€é›†åˆç­‰ï¼‰ï¼Œéƒ½å­˜å‚¨åœ¨ JVM å †ä¸­ï¼Œå®Œå…¨ç”± GC ç®¡ç†ã€‚æ¯”å¦‚ <code>Activity</code> å®ä¾‹ã€<code>MaterialButton</code> å¯¹è±¡ã€<code>EventBus</code> è®¢é˜…è€…å¼•ç”¨ï¼Œè¿™äº›éƒ½æ˜¯ JVM å †å¯¹è±¡ï¼ŒGC ä¼šæ ¹æ® â€œå¯è¾¾æ€§â€ åˆ¤æ–­æ˜¯å¦å›æ”¶ï¼›</p>
<p><strong>Android ç³»ç»Ÿèµ„æº</strong>æ˜¯é€šè¿‡ Native å±‚è°ƒç”¨ Linux å†…æ ¸æ¥å£ç”³è¯·çš„ã€Œé JVM èµ„æºã€ï¼ŒGC æ—¢æ„ŸçŸ¥ä¸åˆ°ï¼Œä¹Ÿæ— æ³•å›æ”¶ï¼Œå¸¸è§æœ‰<strong>ç³»ç»ŸæœåŠ¡å¼•ç”¨</strong><code>ContentResolver.Cursor</code>ã€<code>MediaPlayer</code>ã€å¹¿æ’­æ¥æ”¶å™¨ï¼ˆ<code>BroadcastReceiver</code>ï¼‰ã€<code>NotificationManager</code> ï¼›<strong>å›¾å½¢èµ„æº</strong>ï¼šBitmapï¼ˆNative å±‚åƒç´ æ•°æ®ï¼‰ã€<code>Drawable</code>ã€<code>Canvas</code> ï¼›<code>SharedPreferences</code> çš„ <code>Editor</code>çš„å†…å­˜å—ç­‰ ï¼Œè¿™äº›éƒ½æ˜¯éœ€è¦æˆ‘ä»¬è‡ªè¡Œè°ƒ<code>api</code>æ‰‹åŠ¨å…³é—­çš„ã€‚</p>
<h3 data-id="heading-2">2.1.<strong>å¼•ç”¨ç±»å‹å†³å®šå›æ”¶</strong></h3>
<p>Javaä¸­æ˜¯é€šè¿‡å¯è¾¾æ€§åˆ†æåˆ¤å®šå¯¹è±¡æ˜¯å¦å­˜æ´»çš„ï¼Œå­¦ä¹ è¯¥ç®—æ³•éœ€è¦äº†è§£Javaä¸­çš„4ç§å¼•ç”¨ã€‚Javaä¸­å¼•ç”¨åˆ†ä¸ºå¼ºå¼•ç”¨ï¼ˆé»˜è®¤ï¼‰ã€è½¯å¼•ç”¨ã€å¼±å¼•ç”¨ã€è™šå¼•ç”¨ã€‚æˆ‘ä»¬ç”¨åˆ°çš„å¼•ç”¨åŸºæœ¬éƒ½æ˜¯å¼ºå¼•ç”¨ï¼Œå…¶ä»–ä¸‰ç§å‡ ä¹ä¸ä¼šå‡ºç°åœ¨æ—¥å¸¸å¼€å‘ä¸­ã€‚</p>
<ul>
<li>å¼ºå¼•ç”¨ï¼šå¼ºå¼•ç”¨æ˜¯åœ¨ç¨‹åºä»£ç ä¸­æ™®éå­˜åœ¨çš„ï¼Œä¾‹å¦‚<code>Person person = new Person()</code>ï¼Œ<strong>åªè¦å¼ºå¼•ç”¨è¿˜å­˜åœ¨ï¼Œåƒåœ¾æ”¶é›†å™¨æ°¸è¿œä¸ä¼šå›æ”¶è¢«å¼•ç”¨çš„å¯¹è±¡</strong>ã€‚</li>
<li>è½¯å¼•ç”¨ï¼šè½¯å¼•ç”¨æ˜¯ç”¨æ¥æè¿°ä¸€äº›è¿˜æœ‰ç”¨ä½†å¹¶éå¿…é¡»çš„å¯¹è±¡ï¼Œå¯¹äº<strong>è½¯å¼•ç”¨å…³è”çš„å¯¹è±¡ï¼Œåœ¨ç³»ç»Ÿå°†å‘ç”Ÿå†…å­˜æº¢å‡ºå¼‚å¸¸å‰ï¼Œå°†ä¼šæŠŠè¿™äº›å¯¹è±¡åˆ—å…¥å›æ”¶èŒƒå›´ä¹‹ä¸­è¿›è¡ŒäºŒæ¬¡å›æ”¶ï¼Œå¦‚æœè¯¥æ¬¡å›æ”¶è¿˜æ²¡æœ‰è¶³å¤Ÿçš„å†…å­˜ï¼Œæ‰ä¼šæŠ›å‡ºå†…å­˜æº¢å‡ºå¼‚å¸¸</strong>ã€‚Javaæä¾›äº†**<code>SoftReference</code>**å®ç°è½¯å¼•ç”¨ï¼Œæˆ‘ä»¬åœ¨å®‰å“å¼€å‘ä¸­å¯èƒ½ç”¨è¿‡Glideåº“å¤„ç†å›¾ç‰‡ï¼ŒGlideçš„åº•å±‚å°±ç”¨åˆ°äº†è½¯å¼•ç”¨ã€‚</li>
<li>å¼±å¼•ç”¨ï¼šå¼±å¼•ç”¨ä¹Ÿæ˜¯æè¿°éå¿…éœ€å¯¹è±¡ï¼Œä½†æ˜¯å®ƒçš„å¼ºåº¦æ¯”è½¯å¼•ç”¨æ›´å¼±ä¸€äº›ï¼Œ<strong>è¢«å¼±å¼•ç”¨å…³è”çš„å¯¹è±¡åªèƒ½ç”Ÿå­˜åˆ°ä¸‹ä¸€æ¬¡åƒåœ¾æ”¶é›†ä¹‹å‰</strong>ï¼Œå½“åƒåœ¾æ”¶é›†å™¨å·¥ä½œæ—¶ï¼Œæ— è®ºå½“å‰å†…å­˜æ˜¯å¦è¶³å¤Ÿï¼Œéƒ½ä¼šå›æ”¶æ‰åªè¢«å¼±å¼•ç”¨å…³è”çš„å¯¹è±¡ã€‚Javaæä¾›äº†**<code>WeakReference</code>**å®ç°å¼±å¼•ç”¨ï¼ŒAndroidæ¶ˆæ¯æœºåˆ¶ä¸­çš„<code>ThreadLocal</code>å°±ç”¨åˆ°äº†å¼±å¼•ç”¨ï¼Œ<code>ThreadLocal</code>çš„æ ¸å¿ƒåœ¨äºå…¶å†…éƒ¨ç±» <code>ThreadLocalMap</code>ã€‚è¿™ä¸ª Map ä½¿ç”¨ä¸€ä¸ªç‰¹æ®Šçš„ <code>Entry</code>ç±»æ¥å­˜å‚¨é”®å€¼å¯¹ï¼Œè€Œ <code>Entry</code>å°±ç»§æ‰¿è‡ª <code>WeakReference</code>ã€‚</li>
<li>è™šå¼•ç”¨ï¼šè™šå¼•ç”¨æ˜¯æœ€å¼±çš„ä¸€ç§å¼•ç”¨å…³ç³»ï¼Œä¸€ä¸ªå¯¹è±¡æ˜¯å¦æœ‰è™šå¼•ç”¨çš„å­˜åœ¨ï¼Œå®Œå…¨ä¸ä¼šå¯¹ç”Ÿå­˜æ—¶é—´æ„æˆå½±å“ã€‚<strong>ä¸ºä¸€ä¸ªå¯¹è±¡è®¾ç½®è™šå¼•ç”¨å…³è”çš„å”¯ä¸€ç›®çš„å°±æ˜¯åœ¨è¿™ä¸ªå¯¹è±¡è¢«æ”¶é›†å™¨å›æ”¶æ—¶æ”¶åˆ°ä¸€ä¸ªç³»ç»Ÿé€šçŸ¥</strong>ã€‚Javaæä¾›äº†<code>PhantomReference</code>å®ç°è™šå¼•ç”¨ã€‚</li>
</ul>
<h3 data-id="heading-3">2.2.<strong>GC roots</strong></h3>
<p>GC Rootsï¼ˆGC æ ¹èŠ‚ç‚¹ï¼‰æ˜¯ JVM åƒåœ¾å›æ”¶å™¨ï¼ˆGCï¼‰åˆ¤æ–­å¯¹è±¡æ˜¯å¦ã€Œå¯è¾¾ã€çš„<strong>æ ¸å¿ƒèµ·ç‚¹</strong>ã€<strong>ç»å¯¹å­˜æ´»èµ·ç‚¹</strong>â€”â€”GC ä¼šä»è¿™äº›æ ¹èŠ‚ç‚¹å‡ºå‘ï¼Œéå†æ‰€æœ‰å¯è¾¾çš„å¯¹è±¡å¼•ç”¨é“¾ã€‚</p>
<p>åœ¨Javaä¸­ï¼Œå¯ä½œä¸º<code>GC Roots</code>çš„å¯¹è±¡åŒ…æ‹¬ç³»ç»Ÿæ ˆã€é™æ€å˜é‡ã€<code>Classloader</code>ã€JNI å…¨å±€å¼•ç”¨ã€æ­£åœ¨è¿è¡Œçš„çº¿ç¨‹ç­‰ã€‚è¢«è¿™äº›æ ¹å¯è¾¾çš„å¯¹è±¡è¢«è§†ä¸ºâ€œæ´»ç€â€ã€‚</p>
<p>å½“ä¸€ä¸ªå¯¹è±¡åˆ°<code>GC Roots</code>æ²¡æœ‰ä»»ä½•å¼•ç”¨é“¾ç›¸è¿æ—¶ï¼Œè¯¥å¯¹è±¡å°±æ˜¯ä¸å¯ç”¨çš„ï¼Œæ­¤æ—¶å°±ä¼šè¢«åˆ¤å®šä¸ºå¯å›æ”¶çš„å¯¹è±¡ã€‚è¿™å°±æ˜¯<code>Java</code>é‡‡ç”¨çš„<strong>å¯è¾¾æ€§åˆ†æç®—æ³•ã€‚</strong></p>
<h3 data-id="heading-4">2.3.<strong>ç”Ÿå‘½å‘¨æœŸé”™é…</strong></h3>
<p>ç”Ÿå‘½å‘¨æœŸé”™é…æŒ‡çš„æ˜¯ä¸€ä¸ª<strong>ç”Ÿå‘½å‘¨æœŸé•¿çš„å¯¹è±¡</strong>ï¼ˆå¦‚å•ä¾‹ã€é™æ€å˜é‡ã€åå°çº¿ç¨‹ï¼‰ä¸å¿…è¦åœ°æŒæœ‰äº†ä¸€ä¸ª<strong>ç”Ÿå‘½å‘¨æœŸçŸ­çš„å¯¹è±¡</strong>ï¼ˆå¦‚Activityã€Fragmentï¼‰çš„å¼•ç”¨ï¼Œå¯¼è‡´åè€…åœ¨å…¶æœ¬è¯¥è¢«é”€æ¯æ—¶æ— æ³•è¢«åƒåœ¾å›æ”¶å™¨ï¼ˆGCï¼‰å›æ”¶ï¼Œä»è€ŒæŒç»­å ç”¨å†…å­˜ã€‚</p>
<h2 data-id="heading-5">ä¸‰ã€å¸¸è§æ³„éœ²æ¨¡å¼</h2>
<p>ä¸‹é¢åˆ†æåœ¨å®é™…å¼€å‘ä¸­æœ€å¸¸è§çš„å‡ ç§å†…å­˜æ³„æ¼æƒ…å†µ</p>
<ol start="0">
<li>
<p><strong>Activity/Context æ³„éœ²ï¼ˆæœ€å¸¸è§ï¼‰</strong></p>
<p>åœ¨ Android å¼€å‘ä¸­ï¼ŒActivity æˆ– Context è¢«æ— æ„ä¸­æŒæœ‰è€Œå¯¼è‡´æ— æ³•è¢«åƒåœ¾å›æ”¶å™¨ï¼ˆGCï¼‰å›æ”¶ï¼Œæ˜¯æœ€å¸¸è§çš„å†…å­˜æ³„æ¼é—®é¢˜ä¹‹ä¸€ã€‚è¿™é€šå¸¸æ˜¯å› ä¸ºä¸€ä¸ªç”Ÿå‘½å‘¨æœŸæ¯” Activity æ›´é•¿çš„å¯¹è±¡ï¼ŒæŒæœ‰äº†è¯¥ Activity çš„å¼•ç”¨ï¼Œä»è€Œé˜»ç¢äº†å…¶æ­£å¸¸é”€æ¯å’Œå›æ”¶ã€‚</p>
<p><strong>å•ä¾‹æ¨¡å¼å¯¼è‡´æ³„æ¼</strong>æ˜¯è¯¥æƒ…å†µä¸‹ç»å…¸çš„æ³„æ¼åœºæ™¯ï¼Œå•ä¾‹å¯¹è±¡é€šå¸¸éšåº”ç”¨è¿›ç¨‹ä¸€ç›´å­˜åœ¨ï¼Œå¦‚æœå®ƒé”™è¯¯åœ°æŒæœ‰äº†ä¸€ä¸ª Activity çš„ Contextï¼Œé‚£ä¹ˆè¿™ä¸ª Activity å³ä½¿è¢«å…³é—­ä¹Ÿæ— æ³•è¢«å›æ”¶ã€‚è¿™å°±æ˜¯å› ä¸ºActivity è¢« GC Roots å½¢æˆçš„å¼•ç”¨é“¾ â€œç»‘å®šâ€ï¼Œæ— æ³•è¢«æ ‡è®°ä¸ºå¯å›æ”¶ã€‚çœ‹ä¸‹é¢çš„ä»£ç </p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AppSettings</span> {
 Â  Â <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-type">AppSettings</span> <span class="hljs-variable">sInstance</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">AppSettings</span>();
 Â  Â <span class="hljs-keyword">private</span> Context mContext; 
 Â  Â 
 Â  Â <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setup</span><span class="hljs-params">(Context context)</span> {
 Â  Â  Â  Â <span class="hljs-built_in">this</span>.mContext = context; <span class="hljs-comment">// å¦‚æœä¼ å…¥çš„æ˜¯ Activity.thisï¼Œåˆ™å‘ç”Ÿæ³„æ¼</span>
 Â   }
}
</code></pre>
<p>å› æ­¤åœ¨å•ä¾‹æƒ…å†µä¸‹ï¼Œå°½é‡ä½¿ç”¨ç³»ç»Ÿçº§åˆ«çš„<code>context</code></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">setup</span>(<span class="hljs-params">Context context</span>) {
 Â  Â <span class="hljs-variable language_">this</span>.<span class="hljs-property">mContext</span> = context.<span class="hljs-title function_">getApplicationContext</span>(); <span class="hljs-comment">// æ­£ç¡®ï¼šä½¿ç”¨åº”ç”¨çº§åˆ«çš„ Context</span>
}
</code></pre>
</li>
<li>
<p><strong>åŒ¿åå†…éƒ¨ç±» / éé™æ€å†…éƒ¨ç±»</strong></p>
<p>éé™æ€å†…éƒ¨ç±»ä¼šéšå¼æŒæœ‰å¤–éƒ¨ç±»å¼•ç”¨ï¼ˆä¾‹å¦‚ <code>new Runnable(){}</code> æŒæœ‰å¤–éƒ¨ Activityï¼‰ï¼Œå¦‚æœ <code>Runnable</code> è¢«å»¶è¿Ÿæ‰§è¡Œæˆ–æ”¾åˆ°æŒä¹…å®¹å™¨é‡Œå°±ä¼šæ³„éœ²å¤–éƒ¨ <code>Activity</code>ã€‚<code>kotliln</code>è¯­è¨€ä¸­åœ¨ä¸€ä¸ªç±»å†…éƒ¨å†å£°æ˜ä¸€ä¸ªç±»ï¼Œè¿™ä¸ªå†…éƒ¨çš„ç±»å°±è¢«è®¾è®¡åœ°åŒºåˆ«äºJavaçš„å†…éƒ¨ç±»ï¼Œç§°ä¸ºåµŒå¥—ç±»ï¼Œä¸æŒæœ‰å¤–éƒ¨ç±»å¼•ç”¨ï¼Œç±»ä¼¼<code>Java</code>ä¸­çš„é™æ€å†…éƒ¨ç±»ï¼Œè¿™ç§è®¾è®¡åŸå› å¾ˆå¤§æ–¹é¢å°±æ˜¯ä¸ºäº†é¿å…å†…å­˜æ³„æ¼ã€‚</p>
<p>ä¸¾ä¾‹ä¸‹é¢çš„ä»£ç ã€‚å¦‚æœåœ¨Activityé”€æ¯å‰æ²¡æœ‰å¤„ç†å®Œé˜Ÿåˆ—ä¸­çš„æ¶ˆæ¯ï¼Œé‚£ä¹ˆå°±ä¼šé€ æˆå†…å­˜æ³„æ¼ã€‚å› ä¸º<code>Handler</code> åˆå§‹åŒ–æ—¶ä¼šé»˜è®¤å…³è”<strong>å½“å‰çº¿ç¨‹çš„ <code>Looper</code> å’Œ <code>MessageQueue</code></strong>ï¼ˆä¸»çº¿ç¨‹çš„ Looper éšåº”ç”¨è¿›ç¨‹ç”Ÿå‘½å‘¨æœŸå­˜åœ¨ï¼Œæ°¸ä¸é”€æ¯ï¼‰ï¼Œåªè¦ Handler çš„æ¶ˆæ¯é˜Ÿåˆ—ä¸­è¿˜æœ‰æœªå¤„ç†çš„æ¶ˆæ¯ï¼Œ<code>Message</code> ä¼šæŒæœ‰ <code>Handler</code> çš„å¼•ç”¨ï¼Œè€Œ Handler åˆæŒæœ‰ Activity çš„å¼•ç”¨ï¼Œå¯¼è‡´ Activity æ— æ³•å›æ”¶ ã€‚</p>
<pre><code class="hljs language-scala" lang="scala">public <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MainActivity</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Activity</span> </span>{
 Â  Â <span class="hljs-keyword">private</span> <span class="hljs-type">Handler</span> mHandler = <span class="hljs-keyword">new</span> <span class="hljs-type">Handler</span>() { <span class="hljs-comment">// åŒ¿åå†…éƒ¨ç±»ï¼Œéšå¼æŒæœ‰ Activity å¼•ç”¨</span>
 Â  Â  Â  Â <span class="hljs-meta">@Override</span>
 Â  Â  Â  Â public void handleMessage(<span class="hljs-type">Message</span> msg) {
 Â  Â  Â  Â  Â  Â <span class="hljs-comment">// ... å¤„ç†æ¶ˆæ¯</span>
 Â  Â  Â   }
 Â   };
}
</code></pre>
<p>é’ˆå¯¹è¿™ç§æƒ…å†µæˆ‘ä»¬éœ€è¦åœ¨onDestroyä¸­ç§»é™¤æ‰€æœ‰çš„æ¶ˆæ¯å’Œå›è°ƒã€‚</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-meta">@Override</span>
<span class="hljs-keyword">protected</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">onDestroy</span>(<span class="hljs-params"/>) {
 Â  Â <span class="hljs-variable language_">super</span>.<span class="hljs-title function_">onDestroy</span>();
 Â  Â mHandler.<span class="hljs-title function_">removeCallbacksAndMessages</span>(<span class="hljs-literal">null</span>); <span class="hljs-comment">// ç§»é™¤æ‰€æœ‰æ¶ˆæ¯å’Œå›è°ƒ</span>
}
</code></pre>
</li>
<li>
<p><strong>æœªæ³¨é”€çš„ç³»ç»Ÿå›è°ƒ</strong></p>
<p>è¿™ç§æƒ…å†µå’Œä¸Šé¢çš„åŒ¿åå†…éƒ¨ç±»ç±»ä¼¼ï¼Œä¾‹å¦‚ <code>BroadcastReceiver</code>ã€<code>ContentObserver</code>ã€<code>LocationListener</code>ã€<code>ViewTreeObserver</code> ç­‰æ²¡æœ‰åœ¨ <code>onDestroy</code>/<code>onStop</code> ä¸­ <code>unregister</code>ã€‚è¿™æ˜¯å› ä¸ºç³»ç»ŸæœåŠ¡ï¼ˆå¦‚ <code>SensorManager</code>ã€<code>LocationManager</code>ï¼‰æˆ–å…¨å±€ç»„ä»¶ï¼ˆå¦‚å¹¿æ’­ç®¡ç†å™¨ï¼‰é€šå¸¸å…·æœ‰ä¸åº”ç”¨ç¨‹åºè¿›ç¨‹ç›¸åŒçš„é•¿ç”Ÿå‘½å‘¨æœŸã€‚å½“æ‚¨åœ¨ Activity ä¸­æ³¨å†Œä¸€ä¸ªç›‘å¬å™¨æ—¶ï¼Œè¿™ä¸ªé•¿ç”Ÿå‘½å‘¨æœŸçš„æœåŠ¡ä¼šæŒæœ‰è¯¥ç›‘å¬å™¨çš„å¼•ç”¨ã€‚å¦‚æœè¿™ä¸ªç›‘å¬å™¨æ˜¯ Activity çš„éé™æ€å†…éƒ¨ç±»æˆ–åŒ¿åå†…éƒ¨ç±»ï¼Œå®ƒä¼šéšå¼æŒæœ‰å…¶å¤–éƒ¨ç±»ï¼ˆå³ Activityï¼‰çš„å¼ºå¼•ç”¨ã€‚</p>
</li>
</ol>
<h2 data-id="heading-6">å››ã€MVPæ¶æ„å†…å­˜æ³„æ¼å‰–æ</h2>
<p>æœ‰äº†å‰é¢çš„ç†è®ºåŸºç¡€ï¼Œæˆ‘ä»¬æ¥åˆ†æä¸€ä¸‹MVPæ¶æ„çš„å†…å­˜æ³„æ¼é—®é¢˜ã€‚</p>
<p>MVPæ¶æ„ä¸­Activity / Fragment æŒæœ‰ <code>Presenter</code>ï¼Œè€Œ<code>Presenter</code> æŒæœ‰ View æ¥å£ï¼ˆé€šå¸¸æ˜¯ Activityï¼‰ï¼Œä¹Ÿå°±æ˜¯<code>Activity â†’ Presenter â†’ Activity</code>å½¢æˆäº†å¼ºå¼•ç”¨ç¯ã€‚åªè¦å…¶ä¸­ä¸€ä¸ªåœ°æ–¹<strong>æ²¡æœ‰æ­£ç¡®æ–­å¼€</strong>ï¼Œ Activity å°±ç®—é€€å‡ºäº†ï¼ŒGC ä¹Ÿå›æ”¶ä¸äº† ï¼Œä¼šç›´æ¥å¯¼è‡´å†…å­˜æ³„æ¼ã€‚å› æ­¤MVPæ¶æ„å¤©ç”Ÿå®¹æ˜“å†…å­˜æ³„æ¼ã€‚æˆ‘ä»¬ä¸‹é¢å…·ä½“ä¸¾ä¸ªä¾‹å­ã€‚</p>
<p>è¿™æ˜¯På±‚ï¼Œé€šè¿‡æŒæœ‰çš„viewå¼•ç”¨å±•ç¤ºæ•°æ®ã€‚</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">class</span> <span class="hljs-title class_">MainPresenter</span>(<span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> view: MainContract.View) {
 Â  Â <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">loadData</span><span class="hljs-params">()</span></span> {
 Â  Â  Â  Â view.showLoading()
 Â   }
}
</code></pre>
<p>è€Œ<code>View</code>å±‚ï¼ˆ<code>MainActivity</code>ï¼‰é€šè¿‡<code>presenter = MainPresenter(this)</code>ä¹Ÿä¼šæŒæœ‰På±‚çš„å¼•ç”¨ã€‚</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">class</span> <span class="hljs-title class_">MainActivity</span> : <span class="hljs-type">AppCompatActivity</span>(), MainContract.View {
â€‹
 Â  Â <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> presenter = MainPresenter(<span class="hljs-keyword">this</span>)
â€‹
 Â  Â <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onDestroy</span><span class="hljs-params">()</span></span> {
 Â  Â  Â  Â <span class="hljs-keyword">super</span>.onDestroy()
 Â  Â  Â  Â <span class="hljs-comment">// æ²¡æœ‰ presenter.detachView()</span>
 Â   }
}
â€‹
</code></pre>
<p>åœ¨è¿™ç§æƒ…å†µä¸‹å½“Activityè¿˜å­˜åœ¨æ—¶ï¼Œ V å±‚è¢« P å±‚å¼ºå¼•ç”¨ï¼ŒP å±‚åˆè¢« V å±‚å¼ºå¼•ç”¨ ï¼Œå½¢æˆäº†å¼ºå¼•ç”¨ç¯ã€‚æˆ‘ä»¬ä¸Šé¢è®²äº†Javaçš„åƒåœ¾å›æ”¶ç”¨çš„æ˜¯<strong>å¯è¾¾æ€§åˆ†æç®—æ³•</strong>ï¼Œè¿™ç§ç®—æ³•å¯¹æ¯”å¼•ç”¨è®¡æ•°ç®—æ³•æ¥è¯´æ˜¯ä¸æ€•æˆç¯çš„ï¼Œä½†æ˜¯é—®é¢˜åœ¨äºï¼Œå¦‚æœPå±‚ä¸æŸä¸ªå­˜æ´»å¯¹è±¡å»ºç«‹äº†å…³ç³»ï¼ˆæ¯”å¦‚çº¿ç¨‹ï¼Œç›‘å¬å™¨ï¼Œæ¶ˆæ¯é˜Ÿåˆ—ç­‰ï¼‰ï¼Œè¿™æ—¶ä¾¿ä¸ä¼šè¢«æ¸…é™¤ï¼ŒPå±‚å’ŒVå±‚ä¾¿ä¼šè¾¾åˆ°æ°¸ç”Ÿï¼Œé€ æˆäº†å†…å­˜æ³„æ¼ã€‚</p>
<p>å› æ­¤MVPæ¶æ„ä¸€å®šè¦æ³¨æ„æ¶æ„çš„å†™æ³•è§„èŒƒ</p>
<p>Presenterå±‚ï¼š</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">abstract</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">BasePresenter</span>&lt;<span class="hljs-type">V</span>&gt; {
â€‹
 Â  Â <span class="hljs-keyword">protected</span> <span class="hljs-keyword">var</span> view: V? = <span class="hljs-literal">null</span>
â€‹
 Â  Â <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">attachView</span><span class="hljs-params">(v: <span class="hljs-type">V</span>)</span></span> {
 Â  Â  Â  Â view = v
 Â   }
â€‹
 Â  Â <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">detachView</span><span class="hljs-params">()</span></span> {
 Â  Â  Â  Â view = <span class="hljs-literal">null</span>
 Â  Â  Â  Â onCleared()
 Â   }
â€‹
 Â  Â <span class="hljs-keyword">open</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onCleared</span><span class="hljs-params">()</span></span> {}
}
â€‹
</code></pre>
<p>Activityå±‚ï¼š</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onCreate</span><span class="hljs-params">(...)</span></span> {
 Â  Â presenter.attachView(<span class="hljs-keyword">this</span>)
}
â€‹
<span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onDestroy</span><span class="hljs-params">()</span></span> {
 Â  Â presenter.detachView()
 Â  Â <span class="hljs-keyword">super</span>.onDestroy()
}
â€‹
</code></pre>
<h2 data-id="heading-7">äº”ã€å†…å­˜æ³„éœ²çš„å‘ç°</h2>
<p>å°½ç®¡ç†Ÿæ‚‰äº†å†…å­˜æ³„éœ²ï¼Œä½†åœ¨å¼€å‘è¿‡ç¨‹ä¸­æˆ‘ä»¬ä»ä¸å¯é¿å…åœ°ä¼šå¶å°”å¤§æ„é€ æˆå†…å­˜æ³„æ¼ï¼Œè¿™æ–¹é¢æœ‰ä¸€äº›å·¥å…·å¯ä»¥å¸®åŠ©æˆ‘ä»¬ç›‘æµ‹appçš„å†…å­˜é—®é¢˜ã€‚</p>
<p>1.<strong>Android Studioå†…ç½®çš„Memory Profiler</strong></p>
<p>è¿™æ˜¯æœ€æ ¸å¿ƒçš„å·¥å…·ã€‚å®ƒå¯ä»¥å®æ—¶æ˜¾ç¤ºåº”ç”¨çš„å†…å­˜ä½¿ç”¨é‡æ›²çº¿å›¾ï¼Œå¸®åŠ©ä½ è§‚å¯Ÿå†…å­˜çš„æ€»ä½“è¶‹åŠ¿ã€‚ä½ å¯ä»¥é€šè¿‡å®ƒ<strong>æ•è·å †è½¬å‚¨ (Heap Dump)</strong> ï¼Œè·å–æŸä¸ªæ—¶é—´ç‚¹å†…å­˜ä¸­æ‰€æœ‰å¯¹è±¡çš„å¿«ç…§ï¼Œä»è€Œåˆ†æå“ªäº›å¯¹è±¡å¯èƒ½è¢«ä¸å½“æŒæœ‰ ã€‚æ­¤å¤–ï¼Œå®ƒè¿˜èƒ½<strong>è®°å½•å†…å­˜åˆ†é…æƒ…å†µ</strong>ï¼Œè¿½è¸ªå¯¹è±¡æ˜¯åœ¨å“ªéƒ¨åˆ†ä»£ç ä¸­è¢«åˆ›å»ºçš„ï¼Œè¿™å¯¹äºå®šä½æ³„æ¼æºå¤´éå¸¸æœ‰å¸®åŠ© ï¼Œå¦‚å›¾ï¼Œå¯¹Memory Usageè¿›è¡Œåˆ†æï¼Œå¦‚ä¸‹ä¸¤å›¾ã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/17bd0c1e30654fb281d6f02f7bedacbb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6ams5a2U5aSa55qE54K86YeR5pyv5biI:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765717263&amp;x-signature=8i7p2YnkQZwFKlDikKsrvL8LOag%3D" alt="å±å¹•æˆªå›¾ 2025-12-07 202757.png" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/669de7ebda78410788b766638a691ea6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6ams5a2U5aSa55qE54K86YeR5pyv5biI:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765717263&amp;x-signature=24RZWwOtCdHY6uTDwSYspBNwmqI%3D" alt="å±å¹•æˆªå›¾ 2025-12-07 202827.png" loading="lazy"/></p>
<p>ä¸è¿‡æ³¨æ„ï¼ŒProfiler çš„ <code>Leaks</code> è®¡æ•°åªæ£€æµ‹ Activity/Fragment æ³„æ¼ï¼Œè€Œ App è¿˜å¯èƒ½å­˜åœ¨å…¶ä»–æ³„æ¼åœºæ™¯ï¼Œ<strong>æ™®é€šå¯¹è±¡æ³„æ¼</strong>ï¼šå¦‚å•ä¾‹æŒæœ‰å·¥å…·ç±»å¯¹è±¡ã€æœªæ¸…ç†çš„é›†åˆç¼“å­˜ï¼›<strong>ç³»ç»Ÿèµ„æºæ³„æ¼</strong>ï¼šå¦‚æœªå…³é—­çš„ Cursorã€æœªå›æ”¶çš„ Bitmapã€æœªæ³¨é”€çš„ç›‘å¬å™¨ï¼›<strong>çŸ­æœŸæ³„æ¼</strong>ï¼šå¦‚ Handler å»¶è¿Ÿæ¶ˆæ¯ç­‰</p>
<p><strong>2. è‡ªåŠ¨åŒ–æ£€æµ‹åº“ï¼šLeakCanary</strong></p>
<p>ä¸Šé¢ä»‹ç»çš„Profileræ¯•ç«Ÿæ˜¯ã€Œæ‰‹åŠ¨åˆ†æå·¥å…·ã€ï¼Œè€Œ <strong><code>LeakCanary</code> æ˜¯è‡ªåŠ¨æ£€æµ‹å†…å­˜æ³„æ¼çš„åº“</strong>ï¼Œå®ƒå¯ä»¥è‡ªåŠ¨åŒ–åœ°æ£€æµ‹å†…å­˜æ³„æ¼ï¼Œå¤§å¤§æå‡äº†å¼€å‘æ•ˆç‡ ã€‚åªéœ€åœ¨é¡¹ç›®çš„ <code>build.gradle</code>æ–‡ä»¶ä¸­æ·»åŠ ä¾èµ–ï¼Œ<code>LeakCanary</code> å°±ä¼šè‡ªåŠ¨åœ¨åº”ç”¨è¿è¡Œæ—¶ç›‘æ§ Activity å’Œ Fragment ç­‰å¯¹è±¡ã€‚å½“è¿™äº›å¯¹è±¡æœ¬åº”è¢«å›æ”¶å´ä¾ç„¶å­˜æ´»æ—¶ï¼Œ<code>LeakCanary</code> ä¼šè§¦å‘å †è½¬å‚¨ï¼Œåˆ†ææ³„æ¼è½¨è¿¹ï¼Œå¹¶é€šè¿‡é€šçŸ¥æ æ¸…æ™°åœ°å±•ç¤ºå‡ºæ¥ï¼Œç›´æ¥å®šä½åˆ°æ³„æ¼çš„å¼•ç”¨é“¾ã€‚</p>
<pre><code class="hljs language-arduino" lang="arduino">dependencies {
 Â  Â debugImplementation <span class="hljs-string">'com.squareup.leakcanary:leakcanary-android:2.10'</span>
}
</code></pre>
<p>ç¼–è¯‘å¹¶è¿è¡Œåº”ç”¨åï¼Œ<code>LeakCanary</code> ä¼šè‡ªåŠ¨åœ¨åå°å¯åŠ¨ã€‚å½“æ£€æµ‹åˆ°å†…å­˜æ³„æ¼æ—¶ï¼Œä¼šåœ¨é€šçŸ¥æ æ˜¾ç¤ºé€šçŸ¥ï¼Œç‚¹å‡»é€šçŸ¥å³å¯æŸ¥çœ‹è¯¦ç»†çš„æ³„æ¼åˆ†ææŠ¥å‘Šã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[æ·±å…¥å‰–æè¿›ç¨‹ã€çº¿ç¨‹ä¸è™šæ‹Ÿå†…å­˜]]></title>    <link>https://juejin.cn/post/7581312433529552939</link>    <guid>https://juejin.cn/post/7581312433529552939</guid>    <pubDate>2025-12-08T10:43:54.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581312433529552939" data-draft-id="7581097111896293430" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="æ·±å…¥å‰–æè¿›ç¨‹ã€çº¿ç¨‹ä¸è™šæ‹Ÿå†…å­˜"/> <meta itemprop="keywords" content="åç«¯"/> <meta itemprop="datePublished" content="2025-12-08T10:43:54.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ç äº‹æ¼«è°ˆ"/> <meta itemprop="url" content="https://juejin.cn/user/1972974802965230"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            æ·±å…¥å‰–æè¿›ç¨‹ã€çº¿ç¨‹ä¸è™šæ‹Ÿå†…å­˜
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1972974802965230/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ç äº‹æ¼«è°ˆ
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-08T10:43:54.000Z" title="Mon Dec 08 2025 10:43:54 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»12åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>åœ¨å¹¶å‘ç¼–ç¨‹çš„ä¸–ç•Œé‡Œï¼Œä¸€ä¸ªå¸¸è§çš„è¯¯åŒºæ˜¯è®¤ä¸º"å¤šçº¿ç¨‹æ€»æ˜¯æ›´å¿«"ã€‚ç„¶è€Œï¼Œå®é™…æƒ…å†µè¦å¤æ‚å¾—å¤šã€‚è®©æˆ‘ä»¬ä»ä¸€ä¸ªå…³é”®é—®é¢˜å¼€å§‹ï¼š<strong>å¤šçº¿ç¨‹åœ¨ä»€ä¹ˆæƒ…å†µä¸‹ä¼šæ¯”å•çº¿ç¨‹æ›´æ…¢ï¼Ÿ</strong></p>
<h3 data-id="heading-0">å¤šçº¿ç¨‹çš„æ€§èƒ½é™·é˜±</h3>
<ol>
<li>
<p><strong>çº¿ç¨‹åˆ›å»ºå’Œåˆ‡æ¢å¼€é”€</strong>ï¼šæ¯ä¸ªçº¿ç¨‹çš„åˆ›å»ºéœ€è¦åˆ†é…æ ˆç©ºé—´ï¼ˆé€šå¸¸8MBï¼‰ã€çº¿ç¨‹æ§åˆ¶å—(TCB)ç­‰èµ„æºã€‚ä¸Šä¸‹æ–‡åˆ‡æ¢æ›´æ˜¯æ˜‚è´µï¼Œéœ€è¦ä¿å­˜/æ¢å¤å¯„å­˜å™¨çŠ¶æ€ï¼ˆx86-64ä¸‹è‡³å°‘å‡ åä¸ªå¯„å­˜å™¨ï¼‰ã€æ›´æ–°çº¿ç¨‹è°ƒåº¦çŠ¶æ€ã€‚</p>
</li>
<li>
<p><strong>æ•°æ®ç«äº‰å’ŒåŒæ­¥æˆæœ¬</strong>ï¼šå½“å¤šä¸ªçº¿ç¨‹é¢‘ç¹è®¿é—®å…±äº«æ•°æ®æ—¶ï¼ŒåŒæ­¥åŸè¯­æˆä¸ºç“¶é¢ˆã€‚ä»¥è‡ªæ—‹é”ä¸ºä¾‹ï¼š</p>
</li>
</ol>
<pre><code class="hljs language-cpp" lang="cpp">std::atomic&lt;<span class="hljs-type">int</span>&gt; lock{<span class="hljs-number">0</span>};
<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">critical_section</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-keyword">while</span> (lock.<span class="hljs-built_in">exchange</span>(<span class="hljs-number">1</span>, std::memory_order_acquire)) {
        <span class="hljs-comment">// å¿™ç­‰å¾… - CPUå‘¨æœŸè¢«æµªè´¹</span>
        _mm_pause();  <span class="hljs-comment">// x86çš„PAUSEæŒ‡ä»¤ï¼Œå‡å°‘èƒ½è€—</span>
    }
    <span class="hljs-comment">// å®é™…å·¥ä½œ...</span>
    lock.<span class="hljs-built_in">store</span>(<span class="hljs-number">0</span>, std::memory_order_release);
}
</code></pre>
<ol start="3">
<li><strong>ç¼“å­˜ä¸€è‡´æ€§åè®®å¼€é”€</strong>ï¼šå¤šæ ¸CPUé€šè¿‡MESIåè®®ç»´æŠ¤ç¼“å­˜ä¸€è‡´æ€§ã€‚å½“å¤šä¸ªçº¿ç¨‹ä¿®æ”¹åŒä¸€ç¼“å­˜è¡Œï¼ˆé€šå¸¸æ˜¯64å­—èŠ‚ï¼‰çš„ä¸åŒéƒ¨åˆ†æ—¶ï¼Œä¼šäº§ç”Ÿ"è™šå‡å…±äº«"(False Sharing)ï¼š</li>
</ol>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-keyword">struct</span> <span class="hljs-title class_">alignas</span>(<span class="hljs-number">64</span>) PaddedCounter {  <span class="hljs-comment">// ç¼“å­˜è¡Œå¯¹é½</span>
    std::atomic&lt;<span class="hljs-type">int</span>&gt; count;
    <span class="hljs-type">char</span> padding[<span class="hljs-number">64</span> - <span class="hljs-built_in">sizeof</span>(<span class="hljs-type">int</span>)];  <span class="hljs-comment">// å¡«å……åˆ°å®Œæ•´ç¼“å­˜è¡Œ</span>
};
<span class="hljs-comment">// æ¯ä¸ªçº¿ç¨‹ä½¿ç”¨ç‹¬ç«‹çš„PaddedCounterï¼Œé¿å…ç¼“å­˜è¡Œä¹’ä¹“</span>
</code></pre>
<ol start="4">
<li><strong>TLBæŠ–åŠ¨é—®é¢˜</strong>ï¼šå½“çº¿ç¨‹æ•°è¶…è¿‡TLBå®¹é‡æ—¶ï¼Œé¢‘ç¹çš„åœ°å€ç©ºé—´åˆ‡æ¢ä¼šå¯¼è‡´TLBå¤±æ•ˆã€‚å‡è®¾ç³»ç»Ÿæœ‰64ä¸ªTLBæ¡ç›®ï¼Œè¿è¡Œ128ä¸ªçº¿ç¨‹ï¼Œæ¯ä¸ªçº¿ç¨‹å·¥ä½œé›†ä¸º10é¡µï¼Œé‚£ä¹ˆTLBç¼ºå¤±ç‡å°†éå¸¸é«˜ã€‚</li>
</ol>
<h2 data-id="heading-1">è¿›ç¨‹ä¸çº¿ç¨‹çš„æœ¬è´¨åŒºåˆ«</h2>
<h3 data-id="heading-2">è¿›ç¨‹ï¼šèµ„æºçš„å®¹å™¨</h3>
<p>è¿›ç¨‹æ˜¯æ“ä½œç³»ç»Ÿè¿›è¡Œèµ„æºåˆ†é…çš„åŸºæœ¬å•ä½ï¼Œå®ƒæä¾›äº†ä¸€ä¸ªæ‰§è¡Œç¯å¢ƒï¼ŒåŒ…æ‹¬ï¼š</p>
<ol>
<li><strong>ç‹¬ç«‹çš„åœ°å€ç©ºé—´</strong>ï¼šæ¯ä¸ªè¿›ç¨‹æœ‰è‡ªå·±çš„è™šæ‹Ÿåœ°å€ç©ºé—´ï¼Œé€šè¿‡é¡µè¡¨éš”ç¦»</li>
<li><strong>èµ„æºå¥æŸ„è¡¨</strong>ï¼šæ–‡ä»¶æè¿°ç¬¦ã€ä¿¡å·å¤„ç†ç¨‹åºã€ç”¨æˆ·æƒé™ç­‰</li>
<li><strong>æ‰§è¡Œä¸Šä¸‹æ–‡</strong>ï¼šç¨‹åºè®¡æ•°å™¨ã€æ ˆæŒ‡é’ˆã€å¯„å­˜å™¨é›†åˆ</li>
</ol>
<pre><code class="hljs language-c" lang="c"><span class="hljs-comment">// Linuxè¿›ç¨‹æè¿°ç¬¦ï¼ˆtask_structï¼‰å…³é”®éƒ¨åˆ†</span>
<span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">task_struct</span> {</span>
    <span class="hljs-type">pid_t</span> pid;                    <span class="hljs-comment">// è¿›ç¨‹ID</span>
    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">mm_struct</span> *<span class="hljs-title">mm</span>;</span>         <span class="hljs-comment">// å†…å­˜æè¿°ç¬¦ï¼ˆæ ¸å¿ƒï¼ï¼‰</span>
    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">files_struct</span> *<span class="hljs-title">files</span>;</span>   <span class="hljs-comment">// æ‰“å¼€æ–‡ä»¶è¡¨</span>
    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">signal_struct</span> *<span class="hljs-title">signal</span>;</span> <span class="hljs-comment">// ä¿¡å·å¤„ç†</span>
    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">list_head</span> <span class="hljs-title">thread_group</span>;</span><span class="hljs-comment">// æ‰€å±çº¿ç¨‹ç»„</span>
    <span class="hljs-comment">// ...</span>
};

<span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">mm_struct</span> {</span>
    <span class="hljs-type">pgd_t</span> *pgd;                  <span class="hljs-comment">// é¡µå…¨å±€ç›®å½•ï¼ˆé¡µè¡¨æ ¹ï¼‰</span>
    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">vm_area_struct</span> *<span class="hljs-title">mmap</span>;</span> <span class="hljs-comment">// è™šæ‹Ÿå†…å­˜åŒºåŸŸé“¾è¡¨</span>
    <span class="hljs-type">atomic_t</span> mm_users;           <span class="hljs-comment">// ä½¿ç”¨è¯¥åœ°å€ç©ºé—´çš„çº¿ç¨‹æ•°</span>
    <span class="hljs-type">atomic_t</span> mm_count;           <span class="hljs-comment">// å¼•ç”¨è®¡æ•°</span>
};
</code></pre>
<h3 data-id="heading-3">çº¿ç¨‹ï¼šæ‰§è¡Œçš„å•å…ƒ</h3>
<p>çº¿ç¨‹å…±äº«è¿›ç¨‹çš„æ‰€æœ‰èµ„æºï¼Œä½†æœ‰è‡ªå·±çš„æ‰§è¡Œä¸Šä¸‹æ–‡ï¼š</p>
<ol>
<li><strong>å…±äº«åœ°å€ç©ºé—´</strong>ï¼šæ‰€æœ‰çº¿ç¨‹çœ‹åˆ°ç›¸åŒçš„å†…å­˜æ˜ å°„</li>
<li><strong>ç‹¬ç«‹æ‰§è¡ŒçŠ¶æ€</strong>ï¼šæ¯ä¸ªçº¿ç¨‹æœ‰è‡ªå·±çš„æ ˆã€å¯„å­˜å™¨ã€ç¨‹åºè®¡æ•°å™¨</li>
<li><strong>å…±äº«èµ„æº</strong>ï¼šæ–‡ä»¶æè¿°ç¬¦ã€ä¿¡å·å¤„ç†ã€ç”¨æˆ·IDç­‰</li>
</ol>
<pre><code class="hljs language-c" lang="c"><span class="hljs-comment">// POSIXçº¿ç¨‹å±æ€§</span>
<span class="hljs-type">pthread_attr_t</span> attr;
pthread_attr_init(&amp;attr);
pthread_attr_setstacksize(&amp;attr, <span class="hljs-number">8</span>*<span class="hljs-number">1024</span>*<span class="hljs-number">1024</span>);  <span class="hljs-comment">// 8MBæ ˆ</span>
pthread_attr_setdetachstate(&amp;attr, PTHREAD_CREATE_JOINABLE);

<span class="hljs-comment">// åˆ›å»ºçº¿ç¨‹</span>
<span class="hljs-type">pthread_t</span> tid;
<span class="hljs-type">void</span>* <span class="hljs-title function_">thread_func</span><span class="hljs-params">(<span class="hljs-type">void</span>* arg)</span> {
    <span class="hljs-comment">// çº¿ç¨‹æœ¬åœ°å­˜å‚¨</span>
    <span class="hljs-type">static</span> __thread <span class="hljs-type">int</span> thread_local_var = <span class="hljs-number">0</span>;
    <span class="hljs-keyword">return</span> <span class="hljs-literal">NULL</span>;
}
pthread_create(&amp;tid, &amp;attr, thread_func, <span class="hljs-literal">NULL</span>);
</code></pre>
<h3 data-id="heading-4">å¤šçº¿ç¨‹ç›¸å¯¹äºå¤šè¿›ç¨‹çš„ä¼˜åŠ¿</h3>
<ol>
<li>
<p><strong>åˆ›å»ºå’Œåˆ‡æ¢å¼€é”€</strong>ï¼šçº¿ç¨‹åˆ›å»ºæ¯”è¿›ç¨‹åˆ›å»ºå¿«10-100å€</p>
<ul>
<li>è¿›ç¨‹åˆ›å»ºï¼šå¤åˆ¶é¡µè¡¨ã€æ–‡ä»¶æè¿°ç¬¦è¡¨ç­‰ï¼Œå¼€é”€çº¦100-1000Âµs</li>
<li>çº¿ç¨‹åˆ›å»ºï¼šå…±äº«åœ°å€ç©ºé—´ï¼Œä»…éœ€åˆ†é…æ ˆå’ŒTCBï¼Œå¼€é”€çº¦1-10Âµs</li>
</ul>
</li>
<li>
<p><strong>é€šä¿¡æ•ˆç‡</strong>ï¼šçº¿ç¨‹é—´å¯ç›´æ¥é€šè¿‡å…±äº«å†…å­˜é€šä¿¡ï¼Œæ— éœ€ç³»ç»Ÿè°ƒç”¨</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-comment">// è¿›ç¨‹é—´é€šä¿¡ï¼ˆéœ€è¦ç³»ç»Ÿè°ƒç”¨ï¼‰</span>
<span class="hljs-type">int</span> pipefd[<span class="hljs-number">2</span>];
<span class="hljs-built_in">pipe</span>(pipefd);  <span class="hljs-comment">// ç³»ç»Ÿè°ƒç”¨</span>
<span class="hljs-built_in">write</span>(pipefd[<span class="hljs-number">1</span>], data, size);  <span class="hljs-comment">// ç³»ç»Ÿè°ƒç”¨ + æ•°æ®å¤åˆ¶</span>

<span class="hljs-comment">// çº¿ç¨‹é—´é€šä¿¡ï¼ˆç›´æ¥å†…å­˜è®¿é—®ï¼‰</span>
shared_buffer[index++] = data;  <span class="hljs-comment">// æ— ç³»ç»Ÿè°ƒç”¨</span>
</code></pre>
</li>
<li>
<p><strong>å†…å­˜æ•ˆç‡</strong>ï¼šå…±äº«ä»£ç æ®µã€æ•°æ®æ®µï¼Œå‡å°‘å†…å­˜å†—ä½™</p>
</li>
</ol>
<h2 data-id="heading-5">è™šæ‹Ÿå†…å­˜ï¼šç°ä»£æ“ä½œç³»ç»Ÿçš„åŸºçŸ³</h2>
<h3 data-id="heading-6">è™šæ‹Ÿåœ°å€ vs ç‰©ç†åœ°å€</h3>
<h4 data-id="heading-7">åŸºæœ¬åŒºåˆ«</h4>



































<table><thead><tr><th>ç‰¹æ€§</th><th>è™šæ‹Ÿåœ°å€</th><th>ç‰©ç†åœ°å€</th></tr></thead><tbody><tr><td>å¯è§æ€§</td><td>è¿›ç¨‹å¯è§</td><td>ç¡¬ä»¶å¯è§</td></tr><tr><td>è¿ç»­æ€§</td><td>é€»è¾‘è¿ç»­</td><td>ç‰©ç†ä¸è¿ç»­</td></tr><tr><td>å¤§å°</td><td>ç”±æ¶æ„å†³å®š(48/57ä½)</td><td>ç”±RAMå¤§å°å†³å®š</td></tr><tr><td>è½¬æ¢</td><td>éœ€é€šè¿‡MMU</td><td>ç›´æ¥å¯»å€</td></tr><tr><td>ä¿æŠ¤</td><td>æœ‰æƒé™æ§åˆ¶</td><td>æ— ä¿æŠ¤</td></tr></tbody></table>
<h4 data-id="heading-8">åœ°å€è½¬æ¢ç»†èŠ‚</h4>
<pre><code class="hljs language-c" lang="c"><span class="hljs-comment">// x86-64å››çº§é¡µè¡¨è½¬æ¢è¿‡ç¨‹</span>
<span class="hljs-comment">// è™šæ‹Ÿåœ°å€ï¼š0x00007ffff7a0d000</span>
<span class="hljs-comment">// åˆ†è§£ä¸ºï¼š9ä½PML4ç´¢å¼• + 9ä½PDPTç´¢å¼• + 9ä½PDç´¢å¼• + 9ä½PTç´¢å¼• + 12ä½åç§»</span>

<span class="hljs-type">uint64_t</span> <span class="hljs-title function_">translate</span><span class="hljs-params">(<span class="hljs-type">uint64_t</span> va)</span> {
    <span class="hljs-type">uint64_t</span> pml4_idx = (va &gt;&gt; <span class="hljs-number">39</span>) &amp; <span class="hljs-number">0x1FF</span>;
    <span class="hljs-type">uint64_t</span> pdpt_idx = (va &gt;&gt; <span class="hljs-number">30</span>) &amp; <span class="hljs-number">0x1FF</span>;
    <span class="hljs-type">uint64_t</span> pd_idx   = (va &gt;&gt; <span class="hljs-number">21</span>) &amp; <span class="hljs-number">0x1FF</span>;
    <span class="hljs-type">uint64_t</span> pt_idx   = (va &gt;&gt; <span class="hljs-number">12</span>) &amp; <span class="hljs-number">0x1FF</span>;
    <span class="hljs-type">uint64_t</span> offset   = va &amp; <span class="hljs-number">0xFFF</span>;
    
    <span class="hljs-comment">// ä»CR3å¯„å­˜å™¨è·å–PML4åŸºå€</span>
    <span class="hljs-type">uint64_t</span> pml4_base = read_cr3();
    
    <span class="hljs-comment">// å„çº§é¡µè¡¨éå†ï¼ˆæ¯æ¬¡éƒ½æ˜¯å†…å­˜è®¿é—®ï¼ï¼‰</span>
    <span class="hljs-type">uint64_t</span> pml4e = *(<span class="hljs-type">uint64_t</span>*)(pml4_base + pml4_idx*<span class="hljs-number">8</span>);
    <span class="hljs-type">uint64_t</span> pdpt_base = pml4e &amp; ~<span class="hljs-number">0xFFF</span>;
    <span class="hljs-type">uint64_t</span> pdpte = *(<span class="hljs-type">uint64_t</span>*)(pdpt_base + pdpt_idx*<span class="hljs-number">8</span>);
    <span class="hljs-comment">// ... ç»§ç»­éå†</span>
    
    <span class="hljs-keyword">return</span> physical_address;
}
</code></pre>
<h3 data-id="heading-9">é¡µè¡¨ï¼šè™šæ‹Ÿå†…å­˜çš„æ ¸å¿ƒæ•°æ®ç»“æ„</h3>
<pre><code class="hljs language-c" lang="c"><span class="hljs-comment">// x86-64é¡µè¡¨é¡¹ç»“æ„</span>
<span class="hljs-keyword">typedef</span> <span class="hljs-class"><span class="hljs-keyword">union</span> {</span>
    <span class="hljs-class"><span class="hljs-keyword">struct</span> {</span>
        <span class="hljs-type">uint64_t</span> present    : <span class="hljs-number">1</span>;   <span class="hljs-comment">// é¡µæ˜¯å¦åœ¨å†…å­˜ä¸­</span>
        <span class="hljs-type">uint64_t</span> rw         : <span class="hljs-number">1</span>;   <span class="hljs-comment">// 0=åªè¯», 1=å¯å†™</span>
        <span class="hljs-type">uint64_t</span> user       : <span class="hljs-number">1</span>;   <span class="hljs-comment">// 0=å†…æ ¸, 1=ç”¨æˆ·</span>
        <span class="hljs-type">uint64_t</span> pwt        : <span class="hljs-number">1</span>;   <span class="hljs-comment">// å†™é€šæ¨¡å¼</span>
        <span class="hljs-type">uint64_t</span> pcd        : <span class="hljs-number">1</span>;   <span class="hljs-comment">// ç¼“å­˜ç¦ç”¨</span>
        <span class="hljs-type">uint64_t</span> accessed   : <span class="hljs-number">1</span>;   <span class="hljs-comment">// æ˜¯å¦è¢«è®¿é—®</span>
        <span class="hljs-type">uint64_t</span> dirty      : <span class="hljs-number">1</span>;   <span class="hljs-comment">// æ˜¯å¦è¢«ä¿®æ”¹</span>
        <span class="hljs-type">uint64_t</span> ps         : <span class="hljs-number">1</span>;   <span class="hljs-comment">// é¡µå¤§å° (0=4KB, 1=å¤§é¡µ)</span>
        <span class="hljs-type">uint64_t</span> global     : <span class="hljs-number">1</span>;   <span class="hljs-comment">// å…¨å±€é¡µ</span>
        <span class="hljs-type">uint64_t</span> avl        : <span class="hljs-number">3</span>;   <span class="hljs-comment">// å¯ç”¨ä½</span>
        <span class="hljs-type">uint64_t</span> address    : <span class="hljs-number">40</span>;  <span class="hljs-comment">// ç‰©ç†é¡µå¸§å·æˆ–ä¸‹ä¸€çº§é¡µè¡¨åœ°å€</span>
        <span class="hljs-type">uint64_t</span> avl2       : <span class="hljs-number">11</span>;  <span class="hljs-comment">// æ›´å¤šå¯ç”¨ä½</span>
        <span class="hljs-type">uint64_t</span> nx         : <span class="hljs-number">1</span>;   <span class="hljs-comment">// ä¸å¯æ‰§è¡Œä½</span>
    };
    <span class="hljs-type">uint64_t</span> raw;
} <span class="hljs-type">pte_t</span>;
</code></pre>
<h3 data-id="heading-10">TLBï¼šåœ°å€è½¬æ¢çš„åŠ é€Ÿå™¨</h3>
<h4 data-id="heading-11">TLBå·¥ä½œåŸç†</h4>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-comment">// TLBæŸ¥æ‰¾è¿‡ç¨‹ï¼ˆç¡¬ä»¶å®ç°ï¼‰</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">TLB</span> {
    <span class="hljs-keyword">struct</span> <span class="hljs-title class_">Entry</span> {
        <span class="hljs-type">uint64_t</span> tag;       <span class="hljs-comment">// è™šæ‹Ÿé¡µå·é«˜48-12ä½</span>
        <span class="hljs-type">uint64_t</span> ppn;       <span class="hljs-comment">// ç‰©ç†é¡µå¸§å·</span>
        <span class="hljs-type">uint8_t</span> asid;       <span class="hljs-comment">// åœ°å€ç©ºé—´ID</span>
        <span class="hljs-type">bool</span> valid, dirty, global;
    } entries[<span class="hljs-number">64</span>];          <span class="hljs-comment">// å…¸å‹L1 TLBå¤§å°</span>
    
    <span class="hljs-function">PhysicalAddress <span class="hljs-title">lookup</span><span class="hljs-params">(VirtualAddress va, <span class="hljs-type">uint8_t</span> current_asid)</span> </span>{
        <span class="hljs-type">uint64_t</span> tag = va &gt;&gt; <span class="hljs-number">12</span>;  <span class="hljs-comment">// å»æ‰é¡µå†…åç§»</span>
        
        <span class="hljs-comment">// å¹¶è¡Œæ¯”è¾ƒæ‰€æœ‰æ¡ç›®ï¼ˆç¡¬ä»¶å®ç°ï¼‰</span>
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">auto</span>&amp; entry : entries) {
            <span class="hljs-keyword">if</span> (entry.valid &amp;&amp; entry.tag == tag &amp;&amp; 
                (entry.global || entry.asid == current_asid)) {
                <span class="hljs-keyword">return</span> (entry.ppn &lt;&lt; <span class="hljs-number">12</span>) | (va &amp; <span class="hljs-number">0xFFF</span>);
            }
        }
        <span class="hljs-keyword">return</span> TLB_MISS;  <span class="hljs-comment">// è§¦å‘ç¡¬ä»¶é¡µè¡¨éå†</span>
    }
};
</code></pre>
<h4 data-id="heading-12">TLBä¸å¤šçº¿ç¨‹çš„å…³ç³»</h4>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># TLBæ€§èƒ½åˆ†æ</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">analyze_tlb_performance</span>(<span class="hljs-params">threads, pages_per_thread</span>):
    tlb_entries = <span class="hljs-number">64</span>  <span class="hljs-comment"># å‡è®¾TLBæœ‰64ä¸ªæ¡ç›®</span>
    total_pages = threads * pages_per_thread
    
    <span class="hljs-keyword">if</span> total_pages &lt;= tlb_entries:
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"TLBå‘½ä¸­ç‡é«˜: <span class="hljs-subst">{total_pages}</span>/<span class="hljs-subst">{tlb_entries}</span>é¡µ"</span>)
        <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span>
    <span class="hljs-keyword">else</span>:
        miss_rate = (total_pages - tlb_entries) / total_pages
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"TLBç¼ºå¤±ç‡é«˜: <span class="hljs-subst">{miss_rate:<span class="hljs-number">.1</span>%}</span>"</span>)
        <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span>

<span class="hljs-comment"># å¤šè¿›ç¨‹ vs å¤šçº¿ç¨‹çš„TLBå½±å“</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">"å¤šè¿›ç¨‹ï¼ˆ4ä¸ªè¿›ç¨‹ï¼Œæ¯ä¸ª10é¡µï¼‰:"</span>)
analyze_tlb_performance(<span class="hljs-number">4</span>, <span class="hljs-number">10</span>)  <span class="hljs-comment"># 40é¡µï¼ŒTLBå‘½ä¸­</span>

<span class="hljs-built_in">print</span>(<span class="hljs-string">"\nå¤šçº¿ç¨‹ï¼ˆ4ä¸ªçº¿ç¨‹ï¼Œå…±äº«10é¡µï¼‰:"</span>)
analyze_tlb_performance(<span class="hljs-number">1</span>, <span class="hljs-number">10</span>)  <span class="hljs-comment"># 10é¡µï¼ŒTLBå‘½ä¸­ç‡æ›´é«˜</span>
</code></pre>
<h3 data-id="heading-13">è™šæ‹Ÿå†…å­˜çš„é«˜çº§ç‰¹æ€§</h3>
<h4 data-id="heading-14">å†™æ—¶å¤åˆ¶ï¼ˆCopy-on-Writeï¼‰</h4>
<pre><code class="hljs language-c" lang="c"><span class="hljs-comment">// fork()çš„å®ç°æ ¸å¿ƒ</span>
<span class="hljs-type">pid_t</span> <span class="hljs-title function_">fork</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span> {
    <span class="hljs-comment">// 1. åˆ›å»ºå­è¿›ç¨‹task_struct</span>
    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">task_struct</span> *<span class="hljs-title">child</span> =</span> copy_process();
    
    <span class="hljs-comment">// 2. å¤åˆ¶çˆ¶è¿›ç¨‹åœ°å€ç©ºé—´</span>
    child-&gt;mm = copy_mm(current-&gt;mm);
    
    <span class="hljs-comment">// 3. è®¾ç½®æ‰€æœ‰é¡µè¡¨é¡¹ä¸ºåªè¯»</span>
    <span class="hljs-keyword">for</span> (each page table entry in child-&gt;mm) {
        pte = *pte_entry;
        pte.writable = <span class="hljs-number">0</span>;          <span class="hljs-comment">// æ¸…é™¤å†™æƒé™</span>
        pte.cow = <span class="hljs-number">1</span>;               <span class="hljs-comment">// æ ‡è®°ä¸ºCOWé¡µ</span>
        *pte_entry = pte;
    }
    
    <span class="hljs-comment">// 4. å½“ä»»ä¸€è¿›ç¨‹å°è¯•å†™å…¥æ—¶è§¦å‘é¡µé”™è¯¯</span>
    <span class="hljs-keyword">return</span> child-&gt;pid;
}

<span class="hljs-comment">// COWé¡µé”™è¯¯å¤„ç†</span>
<span class="hljs-type">void</span> <span class="hljs-title function_">handle_cow_fault</span><span class="hljs-params">(<span class="hljs-type">uint64_t</span> address)</span> {
    <span class="hljs-comment">// åˆ†é…æ–°ç‰©ç†é¡µ</span>
    page = alloc_page();
    
    <span class="hljs-comment">// å¤åˆ¶åŸé¡µå†…å®¹</span>
    <span class="hljs-built_in">memcpy</span>(page, old_physical_page, PAGE_SIZE);
    
    <span class="hljs-comment">// æ›´æ–°é¡µè¡¨é¡¹ï¼Œæ¢å¤å†™æƒé™</span>
    pte = get_pte(address);
    pte.address = page_physical_address;
    pte.writable = <span class="hljs-number">1</span>;
    pte.cow = <span class="hljs-number">0</span>;
    set_pte(address, pte);
    
    <span class="hljs-comment">// ç»§ç»­æ‰§è¡Œ</span>
}
</code></pre>
<h4 data-id="heading-15">å†…å­˜æ˜ å°„æ–‡ä»¶</h4>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-comment">// mmapç³»ç»Ÿè°ƒç”¨çš„å¨åŠ›</span>
<span class="hljs-function"><span class="hljs-type">void</span>* <span class="hljs-title">map_file</span><span class="hljs-params">(<span class="hljs-type">const</span> <span class="hljs-type">char</span>* filename, <span class="hljs-type">size_t</span> size)</span> </span>{
    <span class="hljs-type">int</span> fd = <span class="hljs-built_in">open</span>(filename, O_RDONLY);
    
    <span class="hljs-comment">// å°†æ–‡ä»¶æ˜ å°„åˆ°åœ°å€ç©ºé—´</span>
    <span class="hljs-type">void</span>* addr = <span class="hljs-built_in">mmap</span>(<span class="hljs-literal">NULL</span>, size, PROT_READ, 
                     MAP_PRIVATE | MAP_POPULATE, fd, <span class="hljs-number">0</span>);
    
    <span class="hljs-comment">// ç°åœ¨å¯ä»¥åƒè®¿é—®å†…å­˜ä¸€æ ·è®¿é—®æ–‡ä»¶</span>
    <span class="hljs-type">char</span> first_byte = *(<span class="hljs-type">char</span>*)addr;
    
    <span class="hljs-comment">// æ“ä½œç³»ç»Ÿè´Ÿè´£æŒ‰éœ€åŠ è½½æ–‡ä»¶å†…å®¹</span>
    <span class="hljs-keyword">return</span> addr;
}

<span class="hljs-comment">// åŒ¿åæ˜ å°„ï¼ˆç”¨äºå¤§å†…å­˜åˆ†é…ï¼‰</span>
<span class="hljs-function"><span class="hljs-type">void</span>* <span class="hljs-title">large_alloc</span><span class="hljs-params">(<span class="hljs-type">size_t</span> size)</span> </span>{
    <span class="hljs-comment">// åˆ†é…1GBè™šæ‹Ÿåœ°å€ç©ºé—´ï¼Œä½†ä¸ç«‹å³åˆ†é…ç‰©ç†å†…å­˜</span>
    <span class="hljs-type">void</span>* addr = <span class="hljs-built_in">mmap</span>(<span class="hljs-literal">NULL</span>, <span class="hljs-number">1</span>&lt;&lt;<span class="hljs-number">30</span>, PROT_READ|PROT_WRITE,
                     MAP_PRIVATE|MAP_ANONYMOUS, <span class="hljs-number">-1</span>, <span class="hljs-number">0</span>);
    
    <span class="hljs-comment">// åªæœ‰åœ¨å®é™…è®¿é—®æ—¶æ‰ä¼šåˆ†é…ç‰©ç†é¡µ</span>
    <span class="hljs-keyword">for</span> (<span class="hljs-type">size_t</span> i = <span class="hljs-number">0</span>; i &lt; size; i += <span class="hljs-number">4096</span>) {
        ((<span class="hljs-type">char</span>*)addr)[i] = <span class="hljs-number">0</span>;  <span class="hljs-comment">// è§¦å‘ç¼ºé¡µå¼‚å¸¸ï¼Œåˆ†é…ç‰©ç†é¡µ</span>
    }
    
    <span class="hljs-keyword">return</span> addr;
}
</code></pre>
<h2 data-id="heading-16">ç¨‹åºå¯åŠ¨æ—¶çš„å†…å­˜åˆ†é…ç»†èŠ‚</h2>
<h3 data-id="heading-17">ç¼–è¯‘å’Œé“¾æ¥é˜¶æ®µ</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># ç¼–è¯‘ä¸ºä½ç½®æ— å…³ä»£ç </span>
gcc -fPIC -c program.c -o program.o

<span class="hljs-comment"># æŸ¥çœ‹ç›®æ ‡æ–‡ä»¶ä¸­çš„åœ°å€ï¼ˆéƒ½æ˜¯ç›¸å¯¹çš„ï¼‰</span>
objdump -t program.o | <span class="hljs-built_in">head</span> -5
<span class="hljs-comment"># è¾“å‡ºï¼š</span>
<span class="hljs-comment"># 0000000000000000 g     F .text  0000000000000015 main</span>

<span class="hljs-comment"># é“¾æ¥æ—¶ç¡®å®šè™šæ‹Ÿåœ°å€å¸ƒå±€</span>
ld program.o -o program -T linkerscript.ld
<span class="hljs-comment"># linkerscript.ldæŒ‡å®šï¼š</span>
<span class="hljs-comment"># .text èµ·å§‹äº 0x400000</span>
<span class="hljs-comment"># .data èµ·å§‹äº 0x600000</span>
</code></pre>
<h3 data-id="heading-18">åŠ è½½æ‰§è¡Œé˜¶æ®µ</h3>
<pre><code class="hljs language-c" lang="c"><span class="hljs-comment">// execç³»ç»Ÿè°ƒç”¨çš„å…³é”®æ­¥éª¤</span>
<span class="hljs-type">int</span> <span class="hljs-title function_">execve</span><span class="hljs-params">(<span class="hljs-type">const</span> <span class="hljs-type">char</span> *filename, <span class="hljs-type">char</span> *<span class="hljs-type">const</span> argv[], <span class="hljs-type">char</span> *<span class="hljs-type">const</span> envp[])</span> {
    <span class="hljs-comment">// 1. åŠ è½½å¯æ‰§è¡Œæ–‡ä»¶å¤´éƒ¨</span>
    elf_header = load_elf_header(filename);
    
    <span class="hljs-comment">// 2. åˆ›å»ºæ–°çš„åœ°å€ç©ºé—´</span>
    mm = create_new_mm();
    
    <span class="hljs-comment">// 3. è®¾ç½®è™šæ‹Ÿå†…å­˜åŒºåŸŸï¼ˆVMAï¼‰</span>
    <span class="hljs-keyword">for</span> (each program segment in elf_header) {
        vma = add_vma(mm, segment.virtual_addr, segment.size,
                      segment.flags);  <span class="hljs-comment">// PROT_READç­‰</span>
        
        <span class="hljs-comment">// æ³¨æ„ï¼šæ­¤æ—¶åªè®°å½•äº†è™šæ‹Ÿåœ°å€èŒƒå›´ï¼Œæ²¡æœ‰åˆ†é…ç‰©ç†å†…å­˜ï¼</span>
        <span class="hljs-comment">// é¡µè¡¨é¡¹è¢«æ ‡è®°ä¸º"ä¸å­˜åœ¨"</span>
    }
    
    <span class="hljs-comment">// 4. è®¾ç½®æ ˆåŒºåŸŸ</span>
    setup_stack(mm, initial_stack_pointer);
    
    <span class="hljs-comment">// 5. è®¾ç½®argc, argv, envpåˆ°æ ˆä¸­</span>
    
    <span class="hljs-comment">// 6. è®¾ç½®ç¨‹åºè®¡æ•°å™¨ï¼Œå¼€å§‹æ‰§è¡Œ</span>
    start_thread(regs, entry_point);
    
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;  <span class="hljs-comment">// å¦‚æœæˆåŠŸï¼Œä¸ä¼šè¿”å›</span>
}
</code></pre>
<h3 data-id="heading-19">ç¬¬ä¸€æ¬¡å†…å­˜è®¿é—®çš„çœŸç›¸</h3>
<pre><code class="hljs language-assembly" lang="assembly"># ç¨‹åºçš„ç¬¬ä¸€æ¡æŒ‡ä»¤æ‰§è¡Œæ—¶
_start:
    mov rax, [rip + global_var]  # è®¿é—®å…¨å±€å˜é‡
    
# ä¼šå‘ç”Ÿï¼š
# 1. CPUå°†è™šæ‹Ÿåœ°å€å‘ç»™MMU
# 2. MMUæŸ¥TLB â†’ æœªå‘½ä¸­ï¼ˆç¬¬ä¸€æ¬¡è®¿é—®ï¼‰
# 3. MMUæŸ¥é¡µè¡¨ â†’ PTE.present = 0ï¼ˆé¡µä¸åœ¨å†…å­˜ï¼‰
# 4. è§¦å‘ç¼ºé¡µå¼‚å¸¸ï¼ˆPage Faultï¼Œä¸­æ–­14ï¼‰
# 5. å†…æ ¸ç¼ºé¡µå¤„ç†ç¨‹åºï¼š
#    - æ£€æŸ¥åœ°å€æ˜¯å¦åˆæ³•ï¼ˆåœ¨VMAä¸­ï¼‰
#    - åˆ†é…ç‰©ç†é¡µå¸§
#    - ä»ç£ç›˜åŠ è½½æ•°æ®ï¼ˆå¦‚æœæ˜¯æ–‡ä»¶æ˜ å°„ï¼‰
#    - æˆ–å¡«å……é›¶ï¼ˆå¦‚æœæ˜¯åŒ¿åæ˜ å°„ï¼‰
#    - è®¾ç½®PTEä¸ºpresent
# 6. è¿”å›ç”¨æˆ·æ€ï¼Œé‡æ–°æ‰§è¡ŒæŒ‡ä»¤
</code></pre>
<h2 data-id="heading-20">ç°ä»£å†…å­˜ç®¡ç†çš„ä¼˜åŒ–æŠ€æœ¯</h2>
<h3 data-id="heading-21">é€æ˜å¤§é¡µï¼ˆTransparent Huge Pagesï¼‰</h3>
<pre><code class="hljs language-c" lang="c"><span class="hljs-comment">// å†…æ ¸è‡ªåŠ¨å°†è¿ç»­çš„4KBé¡µåˆå¹¶ä¸º2MBå¤§é¡µ</span>
<span class="hljs-type">bool</span> <span class="hljs-title function_">try_thp</span><span class="hljs-params">(<span class="hljs-keyword">struct</span> vm_area_struct *vma, <span class="hljs-type">unsigned</span> <span class="hljs-type">long</span> address)</span> {
    <span class="hljs-comment">// æ£€æŸ¥æ˜¯å¦æ»¡è¶³å¤§é¡µæ¡ä»¶</span>
    <span class="hljs-keyword">if</span> (vma-&gt;vm_flags &amp; VM_NOHUGEPAGE)
        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
    
    <span class="hljs-comment">// æ£€æŸ¥æ˜¯å¦æœ‰è¿ç»­çš„512ä¸ª4KBé¡µ</span>
    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">512</span>; i++) {
        <span class="hljs-keyword">if</span> (!page_is_present(vma, address + i*<span class="hljs-number">4096</span>))
            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
        <span class="hljs-keyword">if</span> (!pages_have_same_permissions(...))
            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
    }
    
    <span class="hljs-comment">// æ›¿æ¢ä¸ºå•ä¸ª2MBé¡µè¡¨é¡¹</span>
    replace_4k_entries_with_2m_entry(vma, address);
    
    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
}

<span class="hljs-comment">// ä¼˜åŠ¿ï¼šå‡å°‘TLBå‹åŠ›ï¼Œæå‡æ€§èƒ½</span>
<span class="hljs-comment">// 2MBé¡µï¼šä¸€ä¸ªTLBæ¡ç›®è¦†ç›–2MBå†…å­˜</span>
<span class="hljs-comment">// 4KBé¡µï¼šéœ€è¦512ä¸ªTLBæ¡ç›®è¦†ç›–ç›¸åŒèŒƒå›´</span>
</code></pre>
<h3 data-id="heading-22">å†…å­˜å‹ç¼©ï¼ˆZswap/Zramï¼‰</h3>
<pre><code class="hljs language-c" lang="c"><span class="hljs-comment">// ä¼ ç»Ÿäº¤æ¢ vs å†…å­˜å‹ç¼©äº¤æ¢</span>
<span class="hljs-type">void</span> <span class="hljs-title function_">handle_memory_pressure</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span> {
    <span class="hljs-keyword">if</span> (zswap_enabled) {
        <span class="hljs-comment">// 1. é€‰æ‹©å€™é€‰é¡µè¿›è¡Œå‹ç¼©</span>
        page = select_page_to_evict();
        
        <span class="hljs-comment">// 2. å‹ç¼©é¡µé¢ï¼ˆä½¿ç”¨LZ4ç­‰ç®—æ³•ï¼‰</span>
        compressed_data = compress_page(page);
        
        <span class="hljs-comment">// 3. å­˜å‚¨åˆ°ZRAMï¼ˆå‹ç¼©å†…å­˜æ± ï¼‰</span>
        zram_store(compressed_data);
        
        <span class="hljs-comment">// 4. é‡Šæ”¾åŸç‰©ç†é¡µ</span>
        free_page(page);
        
        <span class="hljs-comment">// 5. æ ‡è®°é¡µè¡¨é¡¹ä¸º"å‹ç¼©å­˜å‚¨"</span>
        pte.present = <span class="hljs-number">0</span>;
        pte.swapped = <span class="hljs-number">1</span>;
        pte.zram_offset = offset;
    } <span class="hljs-keyword">else</span> {
        <span class="hljs-comment">// ä¼ ç»Ÿäº¤æ¢åˆ°ç£ç›˜ï¼ˆæ…¢ï¼ï¼‰</span>
        swap_out_to_disk(page);
    }
}
</code></pre>
<h3 data-id="heading-23">è¿›ç¨‹é—´å…±äº«å†…å­˜ä¼˜åŒ–</h3>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-comment">// å…±äº«å†…å­˜çš„é«˜æ•ˆä½¿ç”¨</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">SharedMemoryManager</span> {
<span class="hljs-keyword">private</span>:
    <span class="hljs-type">int</span> shm_fd;
    <span class="hljs-type">void</span>* shm_addr;
    
<span class="hljs-keyword">public</span>:
    <span class="hljs-built_in">SharedMemoryManager</span>(<span class="hljs-type">size_t</span> size) {
        <span class="hljs-comment">// åˆ›å»ºå…±äº«å†…å­˜å¯¹è±¡</span>
        shm_fd = <span class="hljs-built_in">shm_open</span>(<span class="hljs-string">"/my_shm"</span>, O_CREAT | O_RDWR, <span class="hljs-number">0666</span>);
        <span class="hljs-built_in">ftruncate</span>(shm_fd, size);
        
        <span class="hljs-comment">// æ˜ å°„åˆ°åœ°å€ç©ºé—´</span>
        shm_addr = <span class="hljs-built_in">mmap</span>(<span class="hljs-literal">NULL</span>, size, PROT_READ | PROT_WRITE,
                       MAP_SHARED, shm_fd, <span class="hljs-number">0</span>);
        
        <span class="hljs-comment">// ä½¿ç”¨å¤§é¡µä¼˜åŒ–</span>
        <span class="hljs-built_in">madvise</span>(shm_addr, size, MADV_HUGEPAGE);
    }
    
    <span class="hljs-comment">// è¿›ç¨‹é—´é«˜æ•ˆé€šä¿¡</span>
    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">send_data</span><span class="hljs-params">(<span class="hljs-type">const</span> <span class="hljs-type">void</span>* data, <span class="hljs-type">size_t</span> size)</span> </span>{
        <span class="hljs-comment">// ç›´æ¥å†…å­˜æ‹·è´ï¼Œæ— éœ€ç³»ç»Ÿè°ƒç”¨</span>
        <span class="hljs-built_in">memcpy</span>(shm_addr, data, size);
        
        <span class="hljs-comment">// ä½¿ç”¨å†…å­˜å±éšœç¡®ä¿å¯è§æ€§</span>
        std::<span class="hljs-built_in">atomic_thread_fence</span>(std::memory_order_release);
    }
};
</code></pre>
<h2 data-id="heading-24">æ€§èƒ½è°ƒä¼˜å®æˆ˜æŒ‡å—</h2>
<h3 data-id="heading-25">è¯Šæ–­å†…å­˜æ€§èƒ½é—®é¢˜</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 1. æŸ¥çœ‹è™šæ‹Ÿå†…å­˜ç»Ÿè®¡</span>
<span class="hljs-built_in">cat</span> /proc/meminfo
<span class="hljs-comment"># å…³æ³¨ï¼šAnonPages, PageTables, SwapCached, HugePages</span>

<span class="hljs-comment"># 2. ç›‘æ§ç¼ºé¡µå¼‚å¸¸</span>
perf <span class="hljs-built_in">stat</span> -e page-faults,dTLB-load-misses,iTLB-load-misses ./program

<span class="hljs-comment"># 3. åˆ†æå†…å­˜è®¿é—®æ¨¡å¼</span>
valgrind --tool=cachegrind ./program
<span class="hljs-comment"># è¾“å‡ºLLdï¼ˆæœ€åä¸€çº§æ•°æ®ç¼“å­˜ï¼‰ç¼ºå¤±ç‡</span>

<span class="hljs-comment"># 4. æŸ¥çœ‹TLBå‹åŠ›</span>
perf <span class="hljs-built_in">stat</span> -e dtlb_load_misses.stlb_hit,dtlb_load_misses.walk_active ./program
</code></pre>
<h3 data-id="heading-26">ä¼˜åŒ–çº¿ç¨‹æ•°çš„é€‰æ‹©</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># æœ€ä¼˜çº¿ç¨‹æ•°è®¡ç®—å…¬å¼</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">optimal_thread_count</span>(<span class="hljs-params">cpu_cores, task_type</span>):
    <span class="hljs-keyword">if</span> task_type == <span class="hljs-string">"cpu_bound"</span>:
        <span class="hljs-comment"># CPUå¯†é›†å‹ï¼šçº¿ç¨‹æ•° â‰ˆ æ ¸å¿ƒæ•°</span>
        <span class="hljs-keyword">return</span> cpu_cores
    <span class="hljs-keyword">elif</span> task_type == <span class="hljs-string">"io_bound"</span>:
        <span class="hljs-comment"># I/Oå¯†é›†å‹ï¼šå¯ä»¥æ›´å¤šçº¿ç¨‹</span>
        <span class="hljs-keyword">return</span> cpu_cores * <span class="hljs-number">2</span>  <span class="hljs-comment"># ç»éªŒå€¼</span>
    <span class="hljs-keyword">elif</span> task_type == <span class="hljs-string">"memory_bound"</span>:
        <span class="hljs-comment"># å†…å­˜å¯†é›†å‹ï¼šè€ƒè™‘å†…å­˜å¸¦å®½</span>
        memory_bandwidth = get_memory_bandwidth()
        per_thread_bandwidth = estimate_bandwidth_per_thread()
        <span class="hljs-keyword">return</span> <span class="hljs-built_in">min</span>(cpu_cores, memory_bandwidth / per_thread_bandwidth)

<span class="hljs-comment"># è€ƒè™‘è¶…çº¿ç¨‹çš„å½±å“</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">with_hyperthreading</span>(<span class="hljs-params">cpu_cores, has_ht</span>):
    physical_cores = cpu_cores // <span class="hljs-number">2</span> <span class="hljs-keyword">if</span> has_ht <span class="hljs-keyword">else</span> cpu_cores
    <span class="hljs-keyword">return</span> physical_cores
</code></pre>
<h3 data-id="heading-27">å†…å­˜è®¿é—®æ¨¡å¼ä¼˜åŒ–</h3>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-comment">// ä¼˜åŒ–å‰ï¼šéšæœºè®¿é—®æ¨¡å¼</span>
<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">process_random</span><span class="hljs-params">(<span class="hljs-type">int</span>* data, <span class="hljs-type">int</span>* indices, <span class="hljs-type">int</span> n)</span> </span>{
    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; n; i++) {
        data[indices[i]] *= <span class="hljs-number">2</span>;  <span class="hljs-comment">// éšæœºè®¿é—®ï¼Œç¼“å­˜ä¸å‹å¥½</span>
    }
}

<span class="hljs-comment">// ä¼˜åŒ–åï¼šé¡ºåºè®¿é—®æ¨¡å¼</span>
<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">process_sequential</span><span class="hljs-params">(<span class="hljs-type">int</span>* data, <span class="hljs-type">int</span> n)</span> </span>{
    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; n; i++) {
        data[i] *= <span class="hljs-number">2</span>;  <span class="hljs-comment">// é¡ºåºè®¿é—®ï¼Œç¼“å­˜å‹å¥½</span>
    }
}

<span class="hljs-comment">// ä½¿ç”¨é¢„å–ä¼˜åŒ–</span>
<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">process_with_prefetch</span><span class="hljs-params">(<span class="hljs-type">int</span>* data, <span class="hljs-type">int</span> n)</span> </span>{
    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; n; i += <span class="hljs-number">8</span>) {
        _mm_prefetch(&amp;data[i + <span class="hljs-number">64</span>], _MM_HINT_T0);  <span class="hljs-comment">// é¢„å–æœªæ¥æ•°æ®</span>
        <span class="hljs-comment">// å¤„ç†å½“å‰æ•°æ®å—</span>
        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> j = <span class="hljs-number">0</span>; j &lt; <span class="hljs-number">8</span>; j++) {
            data[i + j] *= <span class="hljs-number">2</span>;
        }
    }
}
</code></pre>
<h2 data-id="heading-28">ç»“è®º</h2>
<p>ç°ä»£è®¡ç®—ç³»ç»Ÿçš„æ€§èƒ½å¾ˆå¤§ç¨‹åº¦ä¸Šå–å†³äºå¯¹å†…å­˜å±‚æ¬¡ç»“æ„çš„ç†è§£å’Œç®¡ç†ï¼š</p>
<ol>
<li><strong>å¯„å­˜å™¨</strong>ï¼šæœ€å¿«ï¼Œä½†æ•°é‡æœ‰é™ï¼ˆ~1å‘¨æœŸï¼‰</li>
<li><strong>L1/L2/L3ç¼“å­˜</strong>ï¼šSRAMï¼Œå®¹é‡é€’å¢ï¼Œé€Ÿåº¦é€’å‡ï¼ˆ~1-30å‘¨æœŸï¼‰</li>
<li><strong>TLB</strong>ï¼šä¸“ç”¨çš„åœ°å€è½¬æ¢ç¼“å­˜ï¼ˆ~1-10å‘¨æœŸï¼‰</li>
<li><strong>ç‰©ç†å†…å­˜ï¼ˆDRAMï¼‰</strong>ï¼šä¸»å†…å­˜ï¼ˆ~50-200å‘¨æœŸï¼‰</li>
<li><strong>å­˜å‚¨è®¾å¤‡ï¼ˆSSD/HDDï¼‰</strong>ï¼šæ…¢é€Ÿåå¤‡å­˜å‚¨ï¼ˆ~10â´-10â¶å‘¨æœŸï¼‰</li>
</ol>
<p><strong>å…³é”®æ´å¯Ÿ</strong>ï¼š</p>
<ul>
<li>å¤šçº¿ç¨‹çš„ä¼˜åŠ¿åœ¨äºå…±äº«TLBå’Œç¼“å­˜ï¼Œå‡å°‘åœ°å€è½¬æ¢å¼€é”€</li>
<li>è™šæ‹Ÿå†…å­˜é€šè¿‡æŒ‰éœ€åˆ†é…ã€å†™æ—¶å¤åˆ¶ç­‰æœºåˆ¶å®ç°é«˜æ•ˆèµ„æºåˆ©ç”¨</li>
<li>ç†è§£è®¿é—®æ¨¡å¼ï¼ˆé¡ºåºvséšæœºï¼‰å¯¹æ€§èƒ½å½±å“å·¨å¤§</li>
<li>ä¼˜åŒ–åº”è¯¥åŸºäºå®é™…ç¡¬ä»¶ç‰¹æ€§ï¼ˆTLBå¤§å°ã€ç¼“å­˜è¡Œå¤§å°ç­‰ï¼‰</li>
</ul>
<p>æœ€ç»ˆï¼Œé«˜æ•ˆçš„ç³»ç»Ÿç¼–ç¨‹éœ€è¦æ·±å…¥ç†è§£è¿™äº›å±‚æ¬¡ä¹‹é—´çš„äº¤äº’ï¼Œä»¥åŠè¿›ç¨‹ã€çº¿ç¨‹å¦‚ä½•åœ¨è¿™äº›å±‚æ¬¡ä¸Šé«˜æ•ˆåœ°ååŒå·¥ä½œã€‚è™šæ‹Ÿå†…å­˜ä¸ä»…ä»…æ˜¯éš”ç¦»è¿›ç¨‹çš„å·¥å…·ï¼Œæ›´æ˜¯ç°ä»£æ“ä½œç³»ç»Ÿå®ç°é«˜æ•ˆã€å®‰å…¨ã€çµæ´»å†…å­˜ç®¡ç†çš„æ ¸å¿ƒæœºåˆ¶ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[uniapp ä¸‹æ‹‰åˆ·æ–°ç»ˆææ–¹æ¡ˆ]]></title>    <link>https://juejin.cn/post/7581312433529077803</link>    <guid>https://juejin.cn/post/7581312433529077803</guid>    <pubDate>2025-12-08T09:05:37.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581312433529077803" data-draft-id="7566096665724878883" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="uniapp ä¸‹æ‹‰åˆ·æ–°ç»ˆææ–¹æ¡ˆ"/> <meta itemprop="keywords" content="å‰ç«¯"/> <meta itemprop="datePublished" content="2025-12-08T09:05:37.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="åƒè‚‰çš„å°é£çŒª"/> <meta itemprop="url" content="https://juejin.cn/user/4195392103385911"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            uniapp ä¸‹æ‹‰åˆ·æ–°ç»ˆææ–¹æ¡ˆ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4195392103385911/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    åƒè‚‰çš„å°é£çŒª
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-08T09:05:37.000Z" title="Mon Dec 08 2025 09:05:37 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»1åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">z-paging</h2>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fext.dcloud.net.cn%2Fplugin%3Fid%3D3935" target="_blank" title="https://ext.dcloud.net.cn/plugin?id=3935" ref="nofollow noopener noreferrer">ã€z-pagingä¸‹æ‹‰åˆ·æ–°ã€ä¸Šæ‹‰åŠ è½½ã€‘é«˜æ€§èƒ½ï¼Œå…¨å¹³å°å…¼å®¹ã€‚æ”¯æŒè™šæ‹Ÿåˆ—è¡¨ï¼Œåˆ†é¡µå…¨è‡ªåŠ¨å¤„ç†</a></p>
<p>éå¸¸å¥½ç”¨ï¼Œ å¿…é¡»ç‚¹èµã€‚</p>
<p>uniapp å®˜æ–¹çš„ä¸‹æ‹‰åˆ·æ–°å¥½åƒæœ‰å¥½å¤šé—®é¢˜ï¼Œå…·ä½“æ˜¯ä»€ä¹ˆå¿˜è®°äº†ï¼Œåæ­£ç¥å‘æ— æ¯”ã€‚</p>
<p>z-paging æŒºå¥½ç”¨çš„ï¼Œ ä¸è¿‡å¥½åƒä¼šå’Œå±€éƒ¨çš„ <code>scroll-view</code> ç»„ä»¶å†²çªï¼Œç°è±¡å°±æ˜¯ä¸‹æ‹‰åˆ·æ–°ä¼šä¸€è·³ä¸€è·³çš„ï¼Œ ä¸çŸ¥é“æ€ä¹ˆè§£å†³ï¼Œ ä¸è¿‡é—®é¢˜ä¸æ˜¯å¾ˆå¤§ï¼Œ å°†å°±ç”¨å§ã€‚</p>
<h2 data-id="heading-1">ä¸‹æ‹‰åˆ·æ–°ä½¿ç”¨</h2>
<pre><code class="hljs language-vue" lang="vue">
&lt;ZPaging
    ref="pagingRef"
    :fixed="false"
    refresher-only
    @onRefresh="onRefresh"
    refresher-default-text="ä¸‹æ‹‰åˆ·æ–°"
    refresher-pulling-text="é‡Šæ”¾åˆ·æ–°"
    refresher-refreshing-text="åˆ·æ–°ä¸­..."
    refresher-complete-text="åˆ·æ–°å®Œæˆ"
    :refresher-title-style="{ fontSize: '14px' }"
&gt;
    &lt;view&gt;
            &lt;Total @onRefresh="onRefreshed"&gt;&lt;/Total&gt;
            &lt;City @onRefresh="onRefreshed"&gt;&lt;/City&gt;
            &lt;Brand @onRefresh="onRefreshed"&gt;&lt;/Brand&gt;
    &lt;/view&gt;
&lt;/ZPaging&gt;

// import ZPaging from "@/uni_modules/z-paging/components/z-paging/z-paging.vue";
</code></pre>
<p><em>æœ‰ä¸€ä¸ªé—®é¢˜åœ¨çº¿æ±‚åŠ©ï¼Œ å°±æ˜¯åœ¨åº•éƒ¨ä¼šå‡ºç°å¤§é¢ç§¯ç•™ç™½</em></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/076dae13ca904ac69b03efec1e856b53~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZCD6IKJ55qE5bCP6aOe54yq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765789536&amp;x-signature=Qx0NemoGunBBnz41ZY%2FYq2ll%2FOQ%3D" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-2">ai èŠå¤©ç»„ä»¶</h2>
<p>å¯¹è¯å†…å®¹å’Œè¾“å…¥æ¡†éƒ½å¯ä»¥è‡ªå®šä¹‰ã€‚éå¸¸æ–¹ä¾¿ã€‚å…·ä½“çš„å®˜æ–¹æœ‰<a href="https://link.juejin.cn?target=https%3A%2F%2Fz-paging.zxlee.cn%2Fmodule%2Fchat-record-mode.html" target="_blank" title="https://z-paging.zxlee.cn/module/chat-record-mode.html" ref="nofollow noopener noreferrer">ç¤ºä¾‹</a>ã€‚</p>
<pre><code class="hljs language-vue" lang="vue">
&lt;z-paging
      ref="pagingRef"
      :fixed="false"
      :refresher-enabled="false"
      :refresher-default-style="'none'"
      v-model="chatHistories"
      use-chat-record-mode
      :safe-area-inset-bottom="false"
      bottom-bg-color="#FBFAFA"
      :calcKeyboardHeight="calcKeyboardHeight"
    &gt;
      &lt;!-- forå¾ªç¯æ¸²æŸ“èŠå¤©è®°å½•åˆ—è¡¨ --&gt;
      &lt;view
        v-for="(chatItem, index) in chatHistories"
        :key="chatItem.id"
        style="position: relative"
      &gt;
        &lt;!-- style="transform: scaleY(-1)"å¿…é¡»å†™ï¼Œå¦åˆ™ä¼šå¯¼è‡´åˆ—è¡¨å€’ç½® --&gt;
        &lt;!-- æ³¨æ„ä¸è¦ç›´æ¥åœ¨chat-itemç»„ä»¶æ ‡ç­¾ä¸Šè®¾ç½®styleï¼Œå› ä¸ºåœ¨å¾®ä¿¡å°ç¨‹åºä¸­æ˜¯æ— æ•ˆçš„ï¼Œè¯·åŒ…ä¸€å±‚view --&gt;
        &lt;view style="transform: scaleY(-1)"&gt;
          &lt;!-- å¯¹è¯æ¶ˆæ¯ç»„ä»¶ --&gt;
          &lt;ChatItem :message="chatItem" @onSelectOption="handleSelectOption" /&gt;
        &lt;/view&gt;
      &lt;/view&gt;
      &lt;!-- åº•éƒ¨èŠå¤©è¾“å…¥æ¡† --&gt;
      &lt;template #bottom&gt;
        &lt;view class="chat-input-container"&gt;
          &lt;Question
            :status="networkStatus"
            :question="userMsg"
            @onSend="(params: any) =&gt; doSend(params.question)"
            @onCancel="handleCancel"
          /&gt;
        &lt;/view&gt;
      &lt;/template&gt;
    &lt;/z-paging&gt;
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Xcode 26 Navigator å¿«æ·é”®]]></title>    <link>https://juejin.cn/post/7581251003329806362</link>    <guid>https://juejin.cn/post/7581251003329806362</guid>    <pubDate>2025-12-08T09:11:46.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581251003329806362" data-draft-id="7581406561684373550" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Xcode 26 Navigator å¿«æ·é”®"/> <meta itemprop="keywords" content="Xcode"/> <meta itemprop="datePublished" content="2025-12-08T09:11:46.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="xiAo_Ju"/> <meta itemprop="url" content="https://juejin.cn/user/3966693681926029"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Xcode 26 Navigator å¿«æ·é”®
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3966693681926029/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    xiAo_Ju
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-08T09:11:46.000Z" title="Mon Dec 08 2025 09:11:46 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»1åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8a581891c67b458995789f09bf006e43~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgeGlBb19KdQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765789905&amp;x-signature=Wvm3R%2FQgYDPrYQeowLJCWYzVKzc%3D" alt="image.png" loading="lazy"/></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[MCP ç½‘å…³å®æˆ˜ï¼šåŸºäº Higress + Nacos çš„é›¶ä»£ç å·¥å…·æ‰©å±•æ–¹æ¡ˆ]]></title>    <link>https://juejin.cn/post/7581210455827021860</link>    <guid>https://juejin.cn/post/7581210455827021860</guid>    <pubDate>2025-12-08T09:15:17.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581210455827021860" data-draft-id="7581117416810954795" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="MCP ç½‘å…³å®æˆ˜ï¼šåŸºäº Higress + Nacos çš„é›¶ä»£ç å·¥å…·æ‰©å±•æ–¹æ¡ˆ"/> <meta itemprop="keywords" content="äº‘åŸç”Ÿ,MCP"/> <meta itemprop="datePublished" content="2025-12-08T09:15:17.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="é˜¿é‡Œäº‘äº‘åŸç”Ÿ"/> <meta itemprop="url" content="https://juejin.cn/user/3808363977648493"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            MCP ç½‘å…³å®æˆ˜ï¼šåŸºäº Higress + Nacos çš„é›¶ä»£ç å·¥å…·æ‰©å±•æ–¹æ¡ˆ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3808363977648493/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    é˜¿é‡Œäº‘äº‘åŸç”Ÿ
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-08T09:15:17.000Z" title="Mon Dec 08 2025 09:15:17 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»15åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>ä½œè€…ï¼šé™†èƒ¤ä»»</p>
<h2 data-id="heading-0">èƒŒæ™¯</h2>
<p>åœ¨ AI å¤§çˆ†å‘çš„æ—¶ä»£ï¼Œå·²ç»æœ‰éå¸¸å¤šçš„ AI åŠ©æ‰‹ï¼Œç»“åˆ RAG é€šè¿‡æ™ºèƒ½é—®ç­”å¸®åŠ©ç”¨æˆ·è§£ç­”é—®é¢˜ã€‚å•çº¯åœ°ä¾é æ™ºèƒ½é—®ç­”å¸®åŠ©å®¢æˆ·è‡ªåŠ©è§£ç­”æ˜¯è¿œè¿œä¸å¤Ÿçš„ï¼Œæˆ‘ä»¬éœ€è¦è®© AI åŠ©æ‰‹èƒ½å¤Ÿç›´æ¥è°ƒç”¨å·²æœ‰çš„ä¸°å¯Œæ¥å£ï¼Œæœç€æ›´å¼ºå¤§çš„æ™ºèƒ½ä½“æ¼”è¿›ã€‚æˆ‘ä»¬é€‰ç”¨å½“ä¸‹æœ€ä¸ºç«çƒ­ï¼Œä¸”å·²é€æ­¥æˆä¸ºæ ‡å‡†çš„ MCP ä½œä¸ºæ¨¡å‹å’Œæ¥å£ä¹‹é—´é€šä¿¡çš„ä¼ è¾“åè®®ã€‚å…³äº MCPï¼Œå·²æœ‰éå¸¸å¤šçš„ä»‹ç»æ–‡ç« ï¼Œæœ¬æ–‡ä¸å†èµ˜è¿°ã€‚</p>
<p>åœ¨ä¼ä¸šå¯¹å¤–æœåŠ¡çš„åœºæ™¯ä¸‹ï¼ŒMCP Server éœ€è¦è§£å†³ä»¥ä¸‹å‡ ä¸ªé—®é¢˜ï¼š</p>
<ol>
<li>åœ¨æœåŠ¡çš„å¤šå®ä¾‹é«˜å¯ç”¨åœºæ™¯ä¸‹ï¼Œä½¿ç”¨ SSE é€šä¿¡æ–¹å¼å¦‚ä½•ç»´æŠ¤ sessionï¼›</li>
<li>å¦‚ä½•åšåˆ°åŠ¨æ€æ›´æ–° MCP å·¥å…· Promptï¼Œåšåˆ°å¿«é€Ÿæ›´æ–°&amp;è°ƒè¯•&amp;éªŒè¯ï¼›</li>
<li>ç§Ÿæˆ·éš”ç¦»çš„äº‘æœåŠ¡åœºæ™¯ä¸‹å¦‚ä½•å¯¹ç”¨æˆ·çš„å·¥å…·è°ƒç”¨è¿›è¡Œé‰´æƒã€‚</li>
</ol>
<p>Higress å¯ä»¥å¾ˆå¥½åœ°è§£å†³ä¸Šé¢çš„é—®é¢˜ 1ï¼ŒåŒæ—¶è¿˜æœ‰å®Œå–„çš„è¿ç»´ç›‘æ§ä½“ç³»ï¼Œå¯è§†åŒ–æ˜“æ“ä½œçš„æ§åˆ¶å°ç•Œé¢ã€‚ä¸ºäº†è§£å†³é—®é¢˜ 2ï¼Œæˆ‘ä»¬å¼•å…¥äº† Nacos è´Ÿè´£æ³¨å†Œåç«¯æœåŠ¡ä»¥åŠç®¡ç†ç»´æŠ¤ MCP å·¥å…·çš„å…ƒæ•°æ®ç­‰ä¿¡æ¯ã€‚åœ¨æ•´ä¸ª MCP æœåŠ¡ä¸­ï¼ŒHigress æ‹…ä»» MCP Proxy çš„è§’è‰²ï¼ŒNacos æ‹…ä»» MCP Registry çš„è§’è‰²ã€‚å¯¹äºé—®é¢˜ 3 ç§Ÿæˆ·éš”ç¦»é—®é¢˜ï¼Œä¼šåœ¨ä¸‹é¢é‰´æƒç« èŠ‚ä¸­è¿›è¡Œè¯¦ç»†è¯´æ˜ã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0eba8180a02843ce87ac6f061198089e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6YeM5LqR5LqR5Y6f55Sf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765790117&amp;x-signature=8xZCfZ5StfBcfQ3vwZCzcM8RqwM%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<p>Higress å’Œ Nacos éƒ½æ˜¯äº‘åŸç”Ÿçš„åº”ç”¨ï¼Œåœ¨éƒ¨ç½²æ–¹é¢ï¼Œè‡ªç„¶é€‰æ‹©ä½¿ç”¨ K8s é›†ç¾¤è¿›è¡Œäº‘åŸç”Ÿéƒ¨ç½²ã€‚åŒæ—¶å¾ˆå¤šä¼ä¸šæœ‰è‡ªå·±çš„ä¸“å±ç”Ÿäº§ç½‘ç»œç¯å¢ƒï¼Œä¸€èˆ¬å’Œå¤–ç½‘ä¸é€šï¼Œå› æ­¤æœ¬æ–‡ä¼šå›´ç»•å¦‚ä½•åˆ©ç”¨ç¤¾åŒºç‰ˆæœ¬çš„ Higress å’Œ Nacosï¼ˆApache-2.0 å¼€æºåè®®ï¼‰è¿›è¡Œç§æœ‰åŒ–éƒ¨ç½²ã€‚å› ä¸ºå†…éƒ¨ç¯å¢ƒçš„é™åˆ¶ï¼Œæˆ‘ä»¬æ²¡æœ‰åŠæ³•ç›´æ¥é€šè¿‡ Helm æ“ä½œ K8s é›†ç¾¤è¿›è¡Œéƒ¨ç½²ï¼Œå› æ­¤æœ¬æ–‡ä¼šå›´ç»•å¦‚ä½•åŸºäº Higress å’Œ Nacos çš„ docker é•œåƒåœ¨ K8s é›†ç¾¤ä¸Šè¿›è¡Œåˆ†è§’è‰²éƒ¨ç½²ã€‚</p>
<p>é€šè¿‡è¿™å¥—è‡ªå»ºçš„ç½‘å…³æœåŠ¡ï¼Œä½¿ç”¨é…ç½®å³å¯å®ç°é›¶ä»£ç æ‰©å±• Toolï¼Œæ–°åº”ç”¨çš„æ³¨å†Œã€åº”ç”¨ä¸‹é¢å·¥å…·çš„æ‰©å±•ã€å·¥å…· prompt æ›´æ–°éªŒè¯éƒ½èƒ½é€šè¿‡æœåŠ¡é›†æˆçš„å¯è§†åŒ–æ§åˆ¶å°ï¼Œæ›´æ–°å‘å¸ƒé…ç½®å¿«é€Ÿå®Œæˆï¼Œ<strong>æ¥å…¥æ–¹å¼æå…¶ç®€å•ï¼æ›´æ–°éªŒè¯æå…¶å¿«é€Ÿï¼</strong> åŒæ—¶åˆ©ç”¨ Nacos çš„å‘½åç©ºé—´èƒ½åŠ›å¯ä»¥åšåˆ°æœåŠ¡å’Œå·¥å…·é›†çš„éš”ç¦»ï¼Œç»™ä¸åŒçš„ç”¨æˆ·æä¾›ä¸åŒçš„ MCP å·¥å…·é›†ã€‚</p>
<h2 data-id="heading-1">ç§æœ‰åŒ–éƒ¨ç½²</h2>
<h3 data-id="heading-2">Higress</h3>
<p>Higress æ”¯æŒä¸‰ç§éƒ¨ç½²æ–¹å¼ï¼šHelmã€docker compose å’ŒåŸºäº all-in-one çš„Â docker é•œåƒè¿›è¡Œéƒ¨ç½²ã€‚Higress å®˜æ–¹æ¨èä½¿ç”¨ Helm çš„æ–¹å¼è¿›è¡Œç”Ÿäº§ç¯å¢ƒçš„éƒ¨ç½²ï¼Œå°†ä¾èµ–çš„æ¨¡å—éƒ¨ç½²åœ¨ä¸åŒçš„ pod ä¸Šã€‚è€Œå› ä¸Šè¿°ç¯å¢ƒåŸå› ï¼Œè¿™é‡Œé€‰æ‹©ä½¿ç”¨ç¬¬ä¸‰ç§åŸºäº all-in-one çš„ dockerÂ é•œåƒÂ Dockerfile <strong>[</strong> <strong>1]</strong> è¿›è¡Œéƒ¨ç½²ï¼Œå°† Higress ä¾èµ–çš„ç»„ä»¶ä»¥è¿›ç¨‹çš„æ–¹å¼éƒ¨ç½²åœ¨åŒä¸€ pod ä¸Šé¢ï¼Œé€šè¿‡å¤šå‰¯æœ¬çš„æ–¹å¼å®ç°æœåŠ¡é«˜å¯ç”¨ï¼Œä¹Ÿå®ç°äº†å¯¹ K8s é›†ç¾¤ Ingress çš„æ— ä¾µå…¥å¼éƒ¨ç½²ã€‚</p>
<p>æˆ‘ä»¬å…ˆå°è¯•ç›´æ¥å¼•ç”¨ docker é•œåƒè¿›è¡Œéƒ¨ç½²æ—¶ï¼Œä¼šæŠ¥ WASM çš„æ’ä»¶é”™è¯¯ï¼ŒæŸ¥çœ‹æŠ¥é”™ä¿¡æ¯æ˜¯é€šè¿‡ oci åœ°å€å»ä¸‹è½½ WASM æ’ä»¶çš„æ—¶å€™å‡ºç°äº†é—®é¢˜ã€‚åŒæ—¶ Higress å®ç° MCP åŠŸèƒ½ä¹Ÿä¾èµ–äº† WASM æ’ä»¶ï¼Œè¿™æ˜¯ä¸€ä¸ªç»•ä¸å¼€çš„é—®é¢˜ã€‚ï»¿</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">FROM</span>Â higress<span class="hljs-operator">-</span>registry.cn<span class="hljs-operator">-</span>hangzhou.cr.aliyuncs.com<span class="hljs-operator">/</span>higress<span class="hljs-operator">/</span><span class="hljs-keyword">all</span><span class="hljs-operator">-</span><span class="hljs-keyword">in</span><span class="hljs-operator">-</span><span class="hljs-keyword">one</span>:latest
</code></pre>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1242b0ea9ed342978a58e041aad988b0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6YeM5LqR5LqR5Y6f55Sf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765790117&amp;x-signature=154nLMQJywrRr6GiHWBfSzhtve0%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<h4 data-id="heading-3">WASM æ’ä»¶ç‹¬ç«‹éƒ¨ç½²</h4>
<p>Higress çš„Â plugin-server <strong>[</strong> <strong>2]</strong> é¡¹ç›®å°±æ˜¯ä¸ºäº†â€œè§£å†³ç§æœ‰åŒ–éƒ¨ç½² Higress ç½‘å…³æ—¶æ‹‰å–æ’ä»¶çš„ç—›ç‚¹ï¼Œä¼˜åŒ–äº†æ’ä»¶çš„ä¸‹è½½ä¸ç®¡ç†æ•ˆç‡â€ï¼Œä½¿ Higress é€šè¿‡ http çš„æ–¹å¼å»ä¸‹è½½ç‹¬ç«‹éƒ¨ç½²çš„æ’ä»¶åº“ï¼Œè€Œä¸æ˜¯é€šè¿‡ oci å»è®¿é—®å¤–éƒ¨å…¬å¼€ä»“åº“ï¼Œé¿å…å› ç½‘ç»œé—®é¢˜å¯¼è‡´æ’ä»¶æ‹‰å–ä¸ä¸‹æ¥ã€‚è§£å†³è¿‡ç¨‹ä¸»è¦åˆ†ä¸ºä»¥ä¸‹ä¸‰ä¸ªæ­¥éª¤ï¼š</p>
<p><strong>1ï¼‰ç§æœ‰åŒ–éƒ¨ç½² plugin-server</strong></p>
<pre><code class="hljs language-bash" lang="bash">FROMÂ higress-registry.cn-hangzhou.cr.aliyuncs.com/higress/plugin-server:1.0.0
</code></pre>
<p><strong>2ï¼‰ä¸º plugin-server é›†ç¾¤ç”³è¯· K8s Serviceï¼ˆCluster IPï¼‰</strong></p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">v1</span>
<span class="hljs-attr">kind:</span> <span class="hljs-string">Service</span>
<span class="hljs-attr">metadata:</span>
Â  <span class="hljs-attr">name:</span> <span class="hljs-string">higress-plugin-server</span>
Â  <span class="hljs-attr">namespace:</span> <span class="hljs-string">higress-system</span>
Â  <span class="hljs-attr">labels:</span>
Â  Â  <span class="hljs-attr">app:</span> <span class="hljs-string">higress-plugin-server</span>
Â  Â  <span class="hljs-attr">higress:</span> <span class="hljs-string">higress-plugin-server</span>
<span class="hljs-attr">spec:</span>
Â  <span class="hljs-attr">type:</span> <span class="hljs-string">ClusterIP</span>
Â  <span class="hljs-attr">ports:</span>
Â  Â  <span class="hljs-bullet">-</span> <span class="hljs-attr">port:</span> <span class="hljs-number">80</span>
Â  Â  Â  <span class="hljs-attr">protocol:</span> <span class="hljs-string">TCP</span>
Â  Â  Â  <span class="hljs-attr">targetPort:</span> <span class="hljs-number">8080</span>
Â  <span class="hljs-attr">selector:</span>
Â  Â  <span class="hljs-attr">app:</span> <span class="hljs-string">higress-plugin-server</span>
Â  Â  <span class="hljs-attr">higress:</span> <span class="hljs-string">higress-plugin-server</span>
</code></pre>
<p>K8s é›†ç¾¤å†…ç½®çš„ DNS ä¸ºæ­¤åˆ›å»ºçš„åŸŸåè§£æè®°å½•çš„æ ¼å¼ä¸ºÂ <code>&lt;service-name&gt;.&lt;namespace&gt;.svc.cluster.local</code>ã€‚</p>
<p>åœ¨æ²¡æœ‰ K8s çš„åœºæ™¯ä¸‹ä¹Ÿå¯ä»¥ä¸º plugin-server é›†ç¾¤ç”³è¯·å†…ç½‘ VIP æˆ–è€… SLB åšå¥½æœåŠ¡å‘ç°å’Œè´Ÿè½½å‡è¡¡ã€‚</p>
<p><strong>3ï¼‰ä¿®æ”¹ Higress å†…ç½®æ’ä»¶ä¸‹è½½åœ°å€</strong></p>
<p>ä¾ç…§ github ä¸­çš„ç¤ºä¾‹ï¼Œåœ¨åŸºäº Higress é•œåƒçš„é¡¹ç›® Dockerfile ä¸­å£°æ˜æ’ä»¶çš„ä¸‹è½½åœ°å€ã€‚è¿™é‡Œæœ‰ä¸ªåœ°æ–¹éœ€è¦æ³¨æ„ä¸‹ï¼Œreadme ä¸­ç»™å‡ºçš„ç¤ºä¾‹æ˜¯ç¯å¢ƒå˜é‡çš„æ ¼å¼ã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/deef89984e3f456b86d4fa4f4bb6c730~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6YeM5LqR5LqR5Y6f55Sf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765790117&amp;x-signature=cmJOGZq62Q0t%2FpVqpZLrG%2F8hb4U%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<p>åœ¨ Dockerfile ä¸­å£°æ˜éœ€è¦è½¬ä¹‰ä¸€ä¸‹ï¼Œ${name}/${version}Â çš„å½¢å¼æ‰å¯ä»¥è¢«æ­£ç¡®è§£æã€‚</p>
<pre><code class="hljs language-bash" lang="bash">...
<span class="hljs-comment"># æ¨¡ç‰ˆ</span>
ENV HIGRESS_ADMIN_WASM_PLUGIN_CUSTOM_IMAGE_URL_PATTERN=http://[ç”³è¯·çš„k8s serviceåœ°å€]/plugins/\<span class="hljs-variable">${name}</span>/\<span class="hljs-variable">${version}</span>/plugin.wasm
<span class="hljs-comment"># mcp wasm æ’ä»¶ä¸‹è½½åœ°å€</span>
ENV MCP_SERVER_WASM_IMAGE_URL=http://[ç”³è¯·çš„k8s serviceåœ°å€]/plugins/mcp-server/1.0.0/plugin.wasm
...
</code></pre>
<p>é…ç½®å®Œç‹¬ç«‹çš„æ’ä»¶ HTTP ä¸‹è½½åœ°å€åé‡æ–°éƒ¨ç½²ï¼Œåœ¨æœåŠ¡å™¨ä¸Šå¯ä»¥çœ‹åˆ° 8080 ç«¯å£ä»¥åŠ 8443 ç«¯å£å¯ä»¥è¢«æ­£å¸¸ç›‘å¬ï¼Œè¯´æ˜ Higress å…·å¤‡ä»£ç†å’Œç½‘å…³åŠŸèƒ½çš„æ ¸å¿ƒæ•°æ®é¢ç»„ä»¶å·²ç»å¯ä»¥æ­£å¸¸æœåŠ¡äº†ã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/50a78e0794714d30956da299515be560~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6YeM5LqR5LqR5Y6f55Sf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765790117&amp;x-signature=nt%2FNejfjL2XbA%2FOkNvYBZRtHt5U%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<p>è§£å†³å®Œ WASM æ’ä»¶ä¸‹è½½é—®é¢˜ï¼ŒåŸºäº docker é•œåƒçš„ Higress æœåŠ¡å°±å¯ä»¥è¢«æˆåŠŸæ‹‰èµ·å¹¶è¿è¡Œäº†ã€‚åªä¸è¿‡åŸºäºè¿™ç§æ¨¡å¼éƒ¨ç½²çš„<strong>æ¯ä¸ª pod éƒ½æ˜¯ç‹¬ç«‹ã€å¯¹ç­‰ã€åŒ…å«å…¨éƒ¨ç»„ä»¶ã€åŠŸèƒ½å®Œæ•´çš„ Higress æœåŠ¡ï¼Œéœ€è¦é€šè¿‡å¤šå‰¯æœ¬çš„æ–¹å¼å®ç°é«˜å¯ç”¨ã€‚</strong></p>
<p>è¿™ç§éƒ¨ç½²æ¨¡å¼ä¸‹ï¼Œé€šè¿‡ Higress è‡ªèº«é›†æˆçš„æ§åˆ¶å°å»è¿ç»´æœåŠ¡&amp;æ›´æ”¹é…ç½®æ˜¯ä¸ç°å®çš„ï¼Œåªèƒ½æ“ä½œä¸€å°å®ä¾‹çš„é…ç½®å˜æ›´ï¼Œæ— æ³•è®©å®ä¾‹é—´è¿›è¡Œé…ç½®åŒæ­¥ã€‚å› æ­¤åœ¨è¿™ç§æ¨¡å¼ä¸‹çš„ç¼ºç‚¹æ˜¯ï¼Œåªèƒ½é€šè¿‡åœ¨é¡¹ç›®ä»£ç ä¸­ç»´æŠ¤é…ç½®æ–‡ä»¶ï¼Œéœ€è¦æ›´æ”¹æ—¶èµ°å‘å¸ƒæµç¨‹ï¼Œå°†é…ç½®å‘å¸ƒåˆ°æ¯å°å®ä¾‹ä¸Šé¢ã€‚ä¸è¿‡åœ¨æˆ‘ä»¬è¿™ä¸ªåœºæ™¯ä¸‹ï¼Œéœ€è¦å˜æ›´é…ç½®çš„æƒ…å†µä¸å¤šã€‚</p>
<h4 data-id="heading-4">ç²˜æ€§ä¼šè¯</h4>
<p>åœ¨ MCP SSE é€šä¿¡æ–¹å¼ä¸‹ï¼Œå¤©ç„¶éœ€è¦è§£å†³ç²˜æ€§ä¼šè¯çš„é—®é¢˜ï¼ŒHigress åŸºäº Redis å¸®æˆ‘ä»¬è§£å†³äº†è¿™ä¸ªé—®é¢˜ã€‚æå‰éƒ¨ç½²å¥½ Redis å®ä¾‹ä¹‹åï¼Œæ‰“å¼€ Higress çš„ MCP åŠŸèƒ½ï¼Œå¹¶å°† Redis é…ç½®æ›´æ–°è¿›å»ï¼Œé‡æ–°éƒ¨ç½²ä¸€ä¸‹å°±å¯ä»¥ä½¿ç”¨ MCP çš„åŠŸèƒ½äº†ã€‚</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-string">...</span>
<span class="hljs-attr">data:</span>
Â  <span class="hljs-attr">higress:</span> <span class="hljs-string">|-</span>
Â  Â  <span class="hljs-attr">mcpServer:</span>
Â  Â  Â Â <span class="hljs-string">enable:</span>Â <span class="hljs-literal">true</span>
Â  Â  Â  <span class="hljs-attr">sse_path_suffix:</span> <span class="hljs-string">/sse</span>
Â  Â  Â  <span class="hljs-attr">redis:</span>
Â  Â  Â  Â  <span class="hljs-attr">address:</span> <span class="hljs-string">xxx.redis.zhangbei.rds.aliyuncs.com:6379</span>
Â  Â  Â  Â  <span class="hljs-string">username:</span>Â <span class="hljs-string">""</span>
Â  Â  Â  Â  <span class="hljs-string">password:</span>Â <span class="hljs-string">"xxx"</span>
Â  Â  Â  Â  <span class="hljs-attr">db:</span> <span class="hljs-number">0</span>
<span class="hljs-string">...</span>
</code></pre>
<p>è¿™ä»½é…ç½®æ–‡ä»¶å¯ä»¥ç»´æŠ¤åœ¨è‡ªå·±çš„åŸºäº Higress é•œåƒçš„é¡¹ç›®ä¸­ï¼Œåœ¨éƒ¨ç½²çš„æ—¶å€™å°†é…ç½®æ–‡ä»¶ COPY åˆ°æŒ‡å®šç›®å½•ï¼ˆè¿™ç§éƒ¨ç½²æ¨¡å¼ä¸‹ï¼Œæ‰€æœ‰çš„é…ç½®æ–‡ä»¶éƒ½åº”è¯¥è¿™ä¹ˆåšï¼‰ã€‚</p>
<pre><code class="hljs language-bash" lang="bash">...
<span class="hljs-comment"># custom config</span>
COPY config/configmaps/higress-config.yaml /data/configmaps/higress-config.yaml
COPY config/mcpbridges/default.yaml /data/mcpbridges/default.yaml
COPY config/secrets/higress-console.yaml /data/secrets/higress-console.yaml
RUNÂ <span class="hljs-built_in">chmod</span>Â +x /data/configmaps/higress-config.yaml &amp;&amp; \
Â  Â Â <span class="hljs-built_in">chmod</span>Â +x /data/secrets/higress-console.yaml &amp;&amp; \
Â  Â Â <span class="hljs-built_in">chmod</span>Â +x /data/mcpbridges/*
...
</code></pre>
<p>å½“æ•´ä¸ª MCP ç½‘å…³æ­å»ºå®Œå¹¶ä½¿ç”¨çš„æ—¶å€™ï¼Œåœ¨ redis ä¸Šé€šè¿‡Â PSUBSCRIBE mcp-server-sse:*Â å‘½ä»¤å¯ä»¥çœ‹åˆ°å¦‚ä¸‹çš„è°ƒç”¨ä¿¡æ¯ã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3f181283db3440f4881d64258ccd6e0b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6YeM5LqR5LqR5Y6f55Sf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765790117&amp;x-signature=FYsl1PaSZ7kmRr1p50P%2Bq9Y3Lmo%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<h4 data-id="heading-5">è‡ªå®šä¹‰æ„å»ºé•œåƒ</h4>
<p>å®˜æ–¹æ„å»ºå‡ºæ¥çš„é•œåƒä¸€èˆ¬ä¼šè¦æ±‚ä½“ç§¯å°ï¼Œæ»¡è¶³æœ€å°è¿è¡Œè¦æ±‚ï¼Œæ‰€ä»¥å¾ˆå¤šåŠŸèƒ½å…¶å®å¹¶ä¸é›†æˆåœ¨ Higress çš„é•œåƒä¸­ã€‚å¦‚æœä½ çš„ä¼ä¸šæœ‰è‡ªå·±çº¦å®šçš„é€šç”¨é•œåƒï¼Œæˆ–è€…æ˜¯æƒ³åœ¨åŸæœ¬çš„åŸºç¡€ä¸Šé›†æˆä¸€äº›æ–°çš„åŠŸèƒ½ï¼Œå¦‚ä½¿ç”¨é˜¿é‡Œäº‘çš„ SLSã€äº‘ç›‘æ§ç­‰åŠŸèƒ½ï¼Œå°±éœ€è¦æ ¹æ® all-in-one é•œåƒçš„ Dockerfile å†…å®¹è¿›è¡Œè‡ªå®šä¹‰æ„å»ºã€‚è¿™é‡Œæœ‰ä¸ªæ³¨æ„çš„ç‚¹æ˜¯ï¼ŒHigress ä¸­çš„ envoy æ¨¡å—è¦æ±‚çš„ glibc æ˜¯ 2.18 åŠä»¥ä¸Šç‰ˆæœ¬ã€‚</p>
<p>å…¶å®åªéœ€è¦å°† Higress çš„ Dockerfile æ–‡ä»¶å†…å®¹ç§»æ¤è¿‡æ¥å°±è¡Œï¼Œç„¶å<strong>å†å£°æ˜ä¸‹ç‹¬ç«‹éƒ¨ç½²çš„ WASM æ’ä»¶ä¸‹è½½åœ°å€</strong>ï¼Œå°±èƒ½å®ç°åŸºäºæŒ‡å®šé•œåƒè¿›è¡Œ Higress è‡ªå®šä¹‰æ„å»ºæ‰“åŒ…éƒ¨ç½²äº†ã€‚</p>
<p>Higress æœåŠ¡æ­å»ºå¥½åï¼Œå°±å¯ä»¥èµ°å¯¹å¤–å…¬ç½‘è®¿é—®çš„æµç¨‹äº†ï¼šï¼ˆ1ï¼‰ä¸€ä¸ªæ˜¯ç»‘å®š 8001 ç«¯å£ï¼Œé€šè¿‡ Higress æ§åˆ¶å°è¿›è¡ŒæŸ¥çœ‹ç›¸å…³é…ç½®çš„åŸŸåï¼Œé™åˆ¶ä¸ºåªå…è®¸å†…ç½‘è®¿é—®ã€‚æ³¨ï¼šè¿™ç§æ¨¡å¼ä¸‹æ— æ³•é€šè¿‡æ§åˆ¶å°ç›´æ¥å»æ›´æ”¹é…ç½®ï¼›ï¼ˆ2ï¼‰å¦ä¸€ä¸ªæ˜¯ç»‘å®š 8080 ç«¯å£ï¼Œå¯¹å¤–æä¾› MCP ç½‘å…³æœåŠ¡çš„åŸŸåã€‚</p>
<p>å®Œæ•´çš„ Dockerfile å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">FROM [ä¼ä¸šå†…éƒ¨åŸºç¡€é•œåƒ]
<span class="hljs-comment"># ä¸‹é¢ä¸º Higress all-in-one dockerfileä¸­çš„å†…å®¹</span>
ARG HUB=higress-registry.cn-hangzhou.cr.aliyuncs.com/higress
...
<span class="hljs-comment"># æ¨¡ç‰ˆ</span>
ENV HIGRESS_ADMIN_WASM_PLUGIN_CUSTOM_IMAGE_URL_PATTERN=http://[ç”³è¯·çš„k8s serviceåœ°å€]/plugins/\<span class="hljs-variable">${name}</span>/\<span class="hljs-variable">${version}</span>/plugin.wasm
<span class="hljs-comment"># mcp wasm æ’ä»¶ä¸‹è½½åœ°å€</span>
ENV MCP_SERVER_WASM_IMAGE_URL=http://[ç”³è¯·çš„k8s serviceåœ°å€]/plugins/mcp-server/1.0.0/plugin.wasm
...
<span class="hljs-comment"># æ³¨æ„ dockerfile ä¸­ä¼šå» github ä¸‹è½½å¯¹åº”å¤„ç†å™¨æ¶æ„ä¸‹çš„ yq æ¨¡å—ï¼Œä¼ä¸šå†…ç½‘ç¯å¢ƒä¸‹å¯ä»¥æå‰ä¸‹è½½ä¸‹æ¥</span>
COPY ./yq_linux_[<span class="hljs-built_in">arch</span>] /usr/local/bin/yq
...
<span class="hljs-comment"># custom config</span>
COPY config/configmaps/higress-config.yaml /data/configmaps/higress-config.yaml
COPY config/mcpbridges/default.yaml /data/mcpbridges/default.yaml
COPY config/secrets/higress-console.yaml /data/secrets/higress-console.yaml
RUNÂ <span class="hljs-built_in">chmod</span>Â +x /data/configmaps/higress-config.yaml &amp;&amp; \
Â  Â Â <span class="hljs-built_in">chmod</span>Â +x /data/secrets/higress-console.yaml &amp;&amp; \
Â  Â Â <span class="hljs-built_in">chmod</span>Â +x /data/mcpbridges/*
...
</code></pre>
<h3 data-id="heading-6">Nacos</h3>
<p>Nacos çš„éƒ¨ç½²ç›¸å¯¹ç®€å•ï¼Œé™¤äº†é€šè¿‡ kubectl æˆ–è€… nacos-operator å·¥å…·ç›´æ¥æ“ä½œ K8s é›†ç¾¤éƒ¨ç½²å¤–ï¼Œè¿˜å¯ä»¥ç›´æ¥åŸºäº nacos-server çš„é•œåƒè¿›è¡Œéƒ¨ç½²Â Dockerfile <strong>[</strong> <strong>3]</strong> ã€‚å› ä¸Šæ–‡æåˆ°çš„å†…éƒ¨ç¯å¢ƒé—®é¢˜ï¼Œæˆ‘ä»¬è¿™é‡Œé€‰æ‹©åŸºäº nacos-server çš„é•œåƒï¼Œå°†æœåŠ¡éƒ¨ç½²äº K8s é›†ç¾¤ä¸Šé¢ã€‚</p>
<pre><code class="hljs language-bash" lang="bash">FROM nacos-registry.cn-hangzhou.cr.aliyuncs.com/nacos/nacos-server:latest
</code></pre>
<h4 data-id="heading-7">é›†ç¾¤æ¨¡å¼éƒ¨ç½²</h4>
<p>Nacos é›†ç¾¤æ¨¡å¼ä¸‹ä½¿ç”¨çš„ä¸€è‡´æ€§åè®®æ˜¯åŸºäº Raft å®ç°çš„ï¼Œå› æ­¤æœ€å°éœ€è¦éƒ¨ç½² 3 å°å®ä¾‹ã€‚</p>
<p>åœ¨å¼•ç”¨ nacos-server é•œåƒçš„ dockerfile ä¸­ï¼Œå£°æ˜ cluster çš„éƒ¨ç½²æ¨¡å¼ã€‚æˆ‘ä»¬æŸ¥çœ‹ nacos çš„å¯åŠ¨è„šæœ¬ï¼Œå‘ç°åœ¨ peer-finderï¼ˆæ’ä»¶ï¼‰ç›®å½•ä¸å­˜åœ¨çš„æƒ…å†µä¸‹ï¼Œå¦‚æœå®šä¹‰äº† <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>N</mi><mi>A</mi><mi>C</mi><mi>O</mi><msub><mi>S</mi><mi>S</mi></msub><mi>E</mi><mi>R</mi><mi>V</mi><mi>E</mi><mi>R</mi><mi>S</mi><mtext>å˜é‡ï¼Œä¼šå°†</mtext></mrow><annotation encoding="application/x-tex">NACOS_SERVERS å˜é‡ï¼Œä¼šå°† </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"/><span class="mord mathnormal" style="margin-right:0.10903em;">N</span><span class="mord mathnormal">A</span><span class="mord mathnormal" style="margin-right:0.02778em;">CO</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:-0.0576em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05764em;">S</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mord mathnormal" style="margin-right:0.00773em;">ER</span><span class="mord mathnormal" style="margin-right:0.22222em;">V</span><span class="mord mathnormal" style="margin-right:0.05764em;">ERS</span><span class="mord cjk_fallback">å˜é‡ï¼Œä¼šå°†</span></span></span></span></span>NACOS_SERVERS å˜é‡ä¸­çš„å€¼å†™å…¥ <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>C</mi><mi>L</mi><mi>U</mi><mi>S</mi><mi>T</mi><mi>E</mi><msub><mi>R</mi><mi>C</mi></msub><mi>O</mi><mi>N</mi><mi>F</mi><mtext>æ–‡ä»¶ä¸­ï¼Œ</mtext></mrow><annotation encoding="application/x-tex">CLUSTER_CONF æ–‡ä»¶ä¸­ï¼Œ</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"/><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="mord mathnormal" style="margin-right:0.10903em;">LU</span><span class="mord mathnormal" style="margin-right:0.05764em;">STE</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.00773em;">R</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:-0.0077em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.07153em;">C</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mord mathnormal" style="margin-right:0.13889em;">ONF</span><span class="mord cjk_fallback">æ–‡ä»¶ä¸­ï¼Œ</span></span></span></span></span>CLUSTER_CONF æ–‡ä»¶çš„é»˜è®¤è·¯å¾„æ˜¯ /home/nacos/conf/cluster.confï¼Œå…¶ä¸­å®šä¹‰çš„å°±æ˜¯ Nacos é›†ç¾¤çš„é™æ€æˆå‘˜åœ°å€åˆ—è¡¨ï¼Œå®ƒåœ¨é›†ç¾¤é¦–æ¬¡å¯åŠ¨æ—¶ä¼šè¢«è¯»å–ï¼Œç”¨äºå‘ŠçŸ¥æ¯ä¸ªèŠ‚ç‚¹â€œé‚»å±…â€åœ¨å“ªï¼Œä»è€Œè®©å®ƒä»¬èƒ½å¤Ÿäº’ç›¸å‘ç°ã€å»ºç«‹è¿æ¥ï¼Œå¹¶åˆå§‹åŒ– Raft ä¸€è‡´æ€§åè®®ã€‚</p>
<pre><code class="hljs language-bash" lang="bash">...
PLUGINS_DIR=<span class="hljs-string">"/home/nacos/plugins/peer-finder"</span>
<span class="hljs-keyword">function</span>Â <span class="hljs-function"><span class="hljs-title">print_servers</span></span>() {
Â  Â <span class="hljs-keyword">if</span>Â [[ ! -dÂ <span class="hljs-string">"<span class="hljs-variable">${PLUGINS_DIR}</span>"</span>Â ]];Â <span class="hljs-keyword">then</span>
Â  Â Â <span class="hljs-built_in">echo</span>Â <span class="hljs-string">""</span>Â &gt;<span class="hljs-string">"<span class="hljs-variable">$CLUSTER_CONF</span>"</span>
Â  Â Â <span class="hljs-keyword">for</span>Â serverÂ <span class="hljs-keyword">in</span>Â <span class="hljs-variable">${NACOS_SERVERS}</span>;Â <span class="hljs-keyword">do</span>
Â  Â  Â Â <span class="hljs-built_in">echo</span>Â <span class="hljs-string">"<span class="hljs-variable">$server</span>"</span>Â &gt;&gt;<span class="hljs-string">"<span class="hljs-variable">$CLUSTER_CONF</span>"</span>
Â  Â Â <span class="hljs-keyword">done</span>
Â Â <span class="hljs-keyword">else</span>
Â  Â  bashÂ <span class="hljs-variable">$PLUGINS_DIR</span>/plugin.sh
Â  Â Â <span class="hljs-built_in">sleep</span>Â 30
Â Â <span class="hljs-keyword">fi</span>
}
...
</code></pre>
<p>å› æ­¤æˆ‘ä»¬å¯ä»¥åœ¨ Dockerfile ä¸­ç»´æŠ¤å½“å‰é›†ç¾¤ä¸‹çš„ [å®ä¾‹ IP:ç«¯å£] åˆ—è¡¨ï¼Œä¾› Nacos é›†ç¾¤å¯åŠ¨æ—¶è¯»å–å¹¶åˆå§‹åŒ–ã€‚</p>
<pre><code class="hljs language-ini" lang="ini">...
ENV <span class="hljs-attr">MODE</span>=cluster
ENV <span class="hljs-attr">NACOS_AUTH_TOKEN</span>=xxx
ENV <span class="hljs-attr">NACOS_AUTH_IDENTITY_KEY</span>=xxx
ENV <span class="hljs-attr">NACOS_AUTH_IDENTITY_VALUE</span>=xxx
ENV <span class="hljs-attr">NACOS_SERVERS</span>=<span class="hljs-string">"10.0.0.1:8848 10.0.0.2:8848 10.0.0.3:8848"</span>
<span class="hljs-comment"># nacos ç”¨æˆ·åå¯†ç </span>
ENV <span class="hljs-attr">NACOS_USERNAME</span>=xxx
ENV <span class="hljs-attr">NACOS_PASSWORD</span>=xxx
...
</code></pre>
<h4 data-id="heading-8">å®ä¾‹é—´åŠ¨æ€å‘ç°</h4>
<p>ä¸Šé¢è¿™ç§å›ºå®š IP åˆ—è¡¨çš„æ–¹å¼<strong>ç¼ºç‚¹æ˜¯æ˜¾è€Œæ˜“è§çš„</strong>ã€‚å®ƒæ˜¯ä¸€ä¸ªé™æ€çš„é…ç½®ï¼Œå½“å‡ºç°é›†ç¾¤çš„æ‰©ç¼©å®¹æ—¶ï¼Œå®ä¾‹æ˜¯æ²¡æœ‰åŠæ³•è‡ªåŠ¨å»æ›´æ–°æˆå‘˜ IP åˆ—è¡¨çš„ï¼Œéœ€è¦æ‰‹åŠ¨ä¿®æ”¹å¹¶å‘å¸ƒï¼Œæ•´ä¸ªè¿‡ç¨‹éå¸¸ç¹çï¼Œä¸¥é‡æƒ…å†µä¸‹å¯èƒ½ä¼šå½±å“çº¿ä¸ŠæœåŠ¡çš„ç¨³å®šæ€§ï¼›ä¸”åœ¨äº‘åŸç”Ÿå®¹å™¨åŒ–èƒŒæ™¯ä¸‹ï¼ŒIP å¹¶ä¸æ˜¯å›ºå®šçš„ï¼Œéšæ—¶æœ‰å¯èƒ½ä¼šå› ä¸ºæ•…éšœè¿ç§»è€Œæ”¹å˜ IPï¼Œç»´æŠ¤é™æ€ IP åˆ—è¡¨ä¸äº‘åŸç”Ÿçš„ç†å¿µèƒŒé“è€Œé©°ã€‚çº¿ä¸Šç”Ÿäº§æ˜¯å®Œå…¨ä¸æ¨èè¿™ç§æ–¹å¼çš„ã€‚</p>
<p>å†å›åˆ°ä¸Šé¢ docker-startup.sh è„šæœ¬ï¼Œå¯ä»¥é€šè¿‡ peer-finder æ’ä»¶æ¥å®ç°é›†ç¾¤é—´å®ä¾‹çš„å‘ç°ï¼Œå–ä»£æ‰‹åŠ¨ç»´æŠ¤ cluster.conf æ–‡ä»¶ã€‚peer-finder æ’ä»¶è¿è¡Œä¾èµ–äº K8s é›†ç¾¤ Headless Service åŸŸåï¼Œä¼šå»æ‰§è¡Œç±»ä¼¼äº nslookup å‘½ä»¤æŸ¥æ‰¾ Service ä¸‹é¢çš„æ‰€æœ‰å¥åº· Pod çš„ IP åˆ—è¡¨ï¼Œç±»æ¯”äºæœåŠ¡å‘ç°çš„èƒ½åŠ› <strong>[</strong> <strong>4]</strong> ï¼Œè¿™æ ·å°±ä¸ç”¨å†æ‰‹åŠ¨å»ç»´æŠ¤å®ä¾‹ IP åˆ—è¡¨ã€‚</p>
<p>ä½†æ˜¯ peer-finder çš„è¿è¡Œä¾èµ–äº StatefulSet çš„å®ä¾‹éƒ¨ç½²æ¨¡å¼ï¼Œéœ€è¦æ¯ä¸ªå®ä¾‹æœ‰å›ºå®šçš„å®ä¾‹åã€‚å› ä¸ºæˆ‘ä»¬å†…éƒ¨ç¯å¢ƒçš„é™åˆ¶ï¼Œæˆ‘ä»¬ç°åœ¨éƒ¨ç½²çš„éƒ½æ˜¯æ— çŠ¶æ€çš„å®ä¾‹ï¼Œæ‰€ä»¥æ²¡æœ‰åŠæ³•é€šè¿‡ peer-finder æ¥åšè¿™ä¸ªäº‹æƒ…ã€‚ä½†æ˜¯æˆ‘ä»¬å¯ä»¥å‚ç…§ peer-finder è„šæœ¬çš„å®ç°æ€è·¯ï¼Œæ¥è‡ªå·±å†™ä¸€ä¸ªå¯åŠ¨è„šæœ¬ã€‚</p>
<p><strong>1ï¼‰é¦–å…ˆä¸º Nacos é›†ç¾¤ç”³è¯· Headless çš„ Serviceã€‚</strong></p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">v1</span>
<span class="hljs-attr">kind:</span> <span class="hljs-string">Service</span>
<span class="hljs-attr">metadata:</span>
Â  <span class="hljs-attr">name:</span> <span class="hljs-string">nacos-headless</span>
Â  <span class="hljs-attr">namespace:</span> <span class="hljs-string">mcp-nacos</span>
Â  <span class="hljs-attr">labels:</span>
Â  Â  <span class="hljs-attr">app:</span> <span class="hljs-string">mcp-nacos</span>
Â  Â  <span class="hljs-attr">nacos:</span> <span class="hljs-string">mcp-nacos</span>
<span class="hljs-attr">spec:</span>
Â  <span class="hljs-attr">clusterIP:</span> <span class="hljs-string">None</span>
Â  <span class="hljs-attr">ports:</span>
Â  <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">peer-finder-port</span>
Â  Â  <span class="hljs-attr">port:</span> <span class="hljs-number">8848</span>
Â  Â  <span class="hljs-attr">protocol:</span> <span class="hljs-string">TCP</span>
Â  Â  <span class="hljs-attr">targetPort:</span> <span class="hljs-number">8848</span>
Â  <span class="hljs-attr">selector:</span>
Â  Â  <span class="hljs-attr">app:</span> <span class="hljs-string">mcp-nacos</span>
Â  <span class="hljs-attr">sessionAffinity:</span> <span class="hljs-string">None</span>
Â  <span class="hljs-attr">type:</span> <span class="hljs-string">ClusterIP</span>
</code></pre>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3b26974cc4274b4695cdd2fb29d07a8a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6YeM5LqR5LqR5Y6f55Sf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765790117&amp;x-signature=085QUiISHnSTaM6%2FwuJEyrUl4Jc%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<p><strong>2ï¼‰è¿™é‡Œä¿®æ”¹ä¸‹ nacos-docker çš„å¯åŠ¨è„šæœ¬ï¼Œæä¾›ä¸€ä¸ªç®€å•çš„å®ç°ã€‚ï¼ˆä»…ä¾›å‚è€ƒï¼‰</strong></p>
<pre><code class="hljs language-bash" lang="bash">...
åŸdocker-startup.shå†…å®¹
...
<span class="hljs-comment"># æ–°å¢å†…å®¹</span>
<span class="hljs-comment"># æ³¨é‡Šæ‰ JAVAå¯åŠ¨å‘½ä»¤</span>
<span class="hljs-comment"># exec $JAVA ${JAVA_OPT}</span>
<span class="hljs-built_in">export</span>Â JAVA_OPTÂ <span class="hljs-comment"># export JAVA å¯åŠ¨å‚æ•°ï¼Œæ–¹é¢ä¸‹é¢è¯»å–</span>
HEADLESS_SERVICE_FQDN=<span class="hljs-string">"xxx.svc.cluster.local"</span>
CLUSTER_CONF_FILE=<span class="hljs-string">"/home/nacos/conf/cluster.conf"</span>
UPDATE_SCRIPT=<span class="hljs-string">"/home/nacos/bin/update-cluster.sh"</span>Â <span class="hljs-comment"># åŸå­æ›´æ–°è„šæœ¬</span>
NACOS_START_CMD=<span class="hljs-string">"<span class="hljs-variable">$JAVA</span>Â <span class="hljs-variable">$JAVA_OPT</span>"</span>
<span class="hljs-comment"># 1. åŠ¨æ€åˆ›å»º update-cluster.sh è„šæœ¬</span>
<span class="hljs-built_in">cat</span>Â &gt;Â <span class="hljs-variable">${UPDATE_SCRIPT}</span>Â &lt;&lt;Â <span class="hljs-string">'EOF'</span>
<span class="hljs-comment">#!/bin/bash</span>
<span class="hljs-built_in">set</span>Â -e
NACOS_PORT=<span class="hljs-variable">${NACOS_APPLICATION_PORT:-8848}</span>
CLUSTER_CONF_FILE=<span class="hljs-string">"/home/nacos/conf/cluster.conf"</span>
TMP_CONF_FILE=<span class="hljs-string">"/home/nacos/conf/cluster.conf.tmp"</span>
&gt;Â <span class="hljs-string">"<span class="hljs-variable">${TMP_CONF_FILE}</span>"</span>
<span class="hljs-comment"># ä»æ ‡å‡†è¾“å…¥è¯»å– nslookup çš„åŸå§‹è¾“å‡º</span>
awkÂ <span class="hljs-string">'
/^Name:/ { flag=1; next }
flag &amp;&amp; /^Address:/ { print $2; flag=0 }
'</span> |Â <span class="hljs-keyword">while</span>Â IFS=Â <span class="hljs-built_in">read</span>Â -r ip;Â <span class="hljs-keyword">do</span>
Â  Â Â <span class="hljs-keyword">if</span>Â [ -nÂ <span class="hljs-string">"<span class="hljs-variable">$ip</span>"</span>Â ];Â <span class="hljs-keyword">then</span>
Â  Â  Â Â <span class="hljs-built_in">echo</span>Â <span class="hljs-string">"<span class="hljs-variable">${ip}</span>:<span class="hljs-variable">${NACOS_PORT}</span>"</span>Â &gt;&gt;Â <span class="hljs-string">"<span class="hljs-variable">${TMP_CONF_FILE}</span>"</span>
Â  Â Â <span class="hljs-keyword">fi</span>
<span class="hljs-keyword">done</span>
<span class="hljs-comment"># æ’åºä»¥ç¡®ä¿æ–‡ä»¶å†…å®¹çš„ä¸€è‡´æ€§ï¼Œé¿å…ä¸å¿…è¦çš„æ›´æ–°</span>
<span class="hljs-built_in">sort</span>Â -oÂ <span class="hljs-string">"<span class="hljs-variable">${TMP_CONF_FILE}</span>"</span>Â <span class="hljs-string">"<span class="hljs-variable">${TMP_CONF_FILE}</span>"</span>
<span class="hljs-comment"># åªæœ‰åœ¨æ–°æ—§é…ç½®ä¸åŒæ—¶æ‰æ‰§è¡Œæ›´æ–°</span>
<span class="hljs-comment"># æ£€æŸ¥æ—§æ–‡ä»¶æ˜¯å¦å­˜åœ¨</span>
<span class="hljs-keyword">if</span>Â [ ! -fÂ <span class="hljs-string">"<span class="hljs-variable">${CLUSTER_CONF_FILE}</span>"</span>Â ] || ! cmp -sÂ <span class="hljs-string">"<span class="hljs-variable">${TMP_CONF_FILE}</span>"</span>Â <span class="hljs-string">"<span class="hljs-variable">${CLUSTER_CONF_FILE}</span>"</span>;Â <span class="hljs-keyword">then</span>
Â  Â Â <span class="hljs-built_in">echo</span>Â <span class="hljs-string">"[<span class="hljs-subst">$(date)</span>][update-script] Peer list changed. Updating config."</span>
Â  Â Â <span class="hljs-built_in">mv</span>Â <span class="hljs-string">"<span class="hljs-variable">${TMP_CONF_FILE}</span>"</span>Â <span class="hljs-string">"<span class="hljs-variable">${CLUSTER_CONF_FILE}</span>"</span>
Â  Â Â <span class="hljs-built_in">echo</span>Â <span class="hljs-string">"[<span class="hljs-subst">$(date)</span>][update-script] cluster.conf updated:"</span>
Â  Â Â <span class="hljs-built_in">cat</span>Â <span class="hljs-string">"<span class="hljs-variable">${CLUSTER_CONF_FILE}</span>"</span>
<span class="hljs-keyword">else</span>
Â  Â Â <span class="hljs-built_in">rm</span>Â <span class="hljs-string">"<span class="hljs-variable">${TMP_CONF_FILE}</span>"</span>
<span class="hljs-keyword">fi</span>
EOF
<span class="hljs-built_in">chmod</span>Â +xÂ <span class="hljs-variable">${UPDATE_SCRIPT}</span>
<span class="hljs-comment"># 2. å¯åŠ¨å‰çš„åˆå§‹åŒ–å¾ªç¯</span>
MAX_INIT_RETRIES=30
RETRY_COUNT=0
MIN_PEERS=3Â <span class="hljs-comment"># æœŸæœ›çš„é›†ç¾¤æœ€å°å‰¯æœ¬æ•°é‡</span>
<span class="hljs-built_in">echo</span>Â <span class="hljs-string">"[INFO] Initializing cluster config. Waiting for at leastÂ <span class="hljs-variable">${MIN_PEERS}</span>Â peers to be available..."</span>
<span class="hljs-keyword">while</span>Â <span class="hljs-literal">true</span>;Â <span class="hljs-keyword">do</span>
Â Â <span class="hljs-comment"># ç›´æ¥å°† nslookup çš„è¾“å‡ºé€šè¿‡ç®¡é“ä¼ ç»™æ›´æ–°è„šæœ¬</span>
Â  nslookupÂ <span class="hljs-string">"<span class="hljs-variable">${HEADLESS_SERVICE_FQDN}</span>"</span>Â |Â <span class="hljs-variable">${UPDATE_SCRIPT}</span>
Â Â <span class="hljs-comment"># æ£€æŸ¥ç”Ÿæˆçš„é…ç½®æ–‡ä»¶è¡Œæ•°</span>
Â  LINE_COUNT=$(<span class="hljs-built_in">wc</span>Â -l &lt;Â <span class="hljs-string">"<span class="hljs-variable">${CLUSTER_CONF_FILE}</span>"</span>)
Â Â <span class="hljs-keyword">if</span>Â [Â <span class="hljs-string">"<span class="hljs-variable">${LINE_COUNT}</span>"</span>Â -geÂ <span class="hljs-string">"<span class="hljs-variable">${MIN_PEERS}</span>"</span>Â ];Â <span class="hljs-keyword">then</span>
Â  Â Â <span class="hljs-built_in">echo</span>Â <span class="hljs-string">"[INFO] Initial cluster.conf is ready withÂ <span class="hljs-variable">${LINE_COUNT}</span>Â peers."</span>
Â  Â Â <span class="hljs-built_in">break</span>
Â Â <span class="hljs-keyword">fi</span>
Â  RETRY_COUNT=$((RETRY_COUNT+<span class="hljs-number">1</span>))
Â Â <span class="hljs-keyword">if</span>Â [Â <span class="hljs-string">"<span class="hljs-variable">${RETRY_COUNT}</span>"</span>Â -gtÂ <span class="hljs-string">"<span class="hljs-variable">${MAX_INIT_RETRIES}</span>"</span>Â ];Â <span class="hljs-keyword">then</span>
Â  Â Â <span class="hljs-built_in">echo</span>Â <span class="hljs-string">"[WARN] Could not findÂ <span class="hljs-variable">${MIN_PEERS}</span>Â peers afterÂ <span class="hljs-variable">${MAX_INIT_RETRIES}</span>Â retries. Starting withÂ <span class="hljs-variable">${LINE_COUNT}</span>Â peers found."</span>
Â  Â Â <span class="hljs-built_in">break</span>
Â Â <span class="hljs-keyword">fi</span>
Â Â <span class="hljs-built_in">echo</span>Â <span class="hljs-string">"[INFO] FoundÂ <span class="hljs-variable">${LINE_COUNT}</span>Â peers. Waiting for more... Retrying in 5 seconds."</span>
Â Â <span class="hljs-built_in">sleep</span>Â 5
<span class="hljs-keyword">done</span>
<span class="hljs-comment"># 3. åœ¨åå°å¯åŠ¨æˆ‘ä»¬è‡ªå·±çš„ç›‘æ§å¾ªç¯</span>
(
Â Â <span class="hljs-keyword">while</span>Â <span class="hljs-literal">true</span>;Â <span class="hljs-keyword">do</span>
Â  Â Â <span class="hljs-built_in">sleep</span>Â 15Â <span class="hljs-comment"># æ¯ 15 ç§’æ£€æŸ¥ä¸€æ¬¡</span>
Â  Â Â <span class="hljs-built_in">echo</span>Â <span class="hljs-string">"[<span class="hljs-subst">$(date)</span>][monitor] Checking for peer updates..."</span>
Â  Â  nslookupÂ <span class="hljs-string">"<span class="hljs-variable">${HEADLESS_SERVICE_FQDN}</span>"</span>Â |Â <span class="hljs-variable">${UPDATE_SCRIPT}</span>
Â Â <span class="hljs-keyword">done</span>
) &amp;
<span class="hljs-comment"># 4. å¯åŠ¨ Nacos ä¸»è¿›ç¨‹</span>
<span class="hljs-built_in">echo</span>Â <span class="hljs-string">"[INFO] Starting Nacos server..."</span>
<span class="hljs-built_in">exec</span>Â sh -cÂ <span class="hljs-string">"<span class="hljs-variable">${NACOS_START_CMD}</span>"</span>
</code></pre>
<p>è¿™æ ·æˆ‘ä»¬ cluster.conf æ–‡ä»¶ä¸­çš„æˆå‘˜ IP åˆ—è¡¨å°±å®ç°äº†è‡ªåŠ¨æ›´æ–°ã€‚</p>
<p>çº¿ä¸Šç”Ÿäº§ç¯å¢ƒè¿˜æ˜¯æ¨èä½¿ç”¨æœ‰çŠ¶æ€ StatefulSet çš„éƒ¨ç½²æ¨¡å¼ï¼Œå¹¶ç»“åˆ peer-finder çš„èƒ½åŠ›å®ç°å®ä¾‹é—´çš„äº’ç›¸å‘ç°ã€‚è€Œä¸æ˜¯ç”¨æ— çŠ¶æ€çš„å®ä¾‹ï¼Œè‡ªå·±å»å†™è„šæœ¬å®ç°ã€‚åç»­æˆ‘ä»¬ä¹Ÿä¼šå‡çº§åˆ° StatefulSet çš„æ¨¡å¼è¿›è¡Œéƒ¨ç½²ã€‚</p>
<h4 data-id="heading-9">é…ç½®å¤–ç½® Mysql</h4>
<p>åœ¨é›†ç¾¤éƒ¨ç½²æ¨¡å¼ä¸‹ï¼Œå°±æ— æ³•ä½¿ç”¨ Nacos å†…ç½®çš„ä¸æ”¯æŒæ•°æ®å…±äº«çš„ Derby æ•°æ®åº“ï¼Œéœ€è¦é…ç½®å¤–ç½®çš„ Mysql æ•°æ®åº“ã€‚æå‰éƒ¨ç½²å¥½ Mysql å®ä¾‹ä¹‹åï¼ŒæŒ‰ç…§ Nacos ä¸­çš„Â mysql-schema.sql <strong>[</strong> <strong>5]</strong> æ•°æ®åº“é…ç½®æ–‡ä»¶å°†è¡¨åˆå§‹åŒ–ï¼Œå†å°† mysql é…ç½®ä¿¡æ¯å†™å…¥ Dockerfile ä¸­å³å¯ã€‚</p>
<pre><code class="hljs language-ini" lang="ini">...
<span class="hljs-comment"># mysql config</span>
ENV <span class="hljs-attr">SPRING_DATASOURCE_PLATFORM</span>=mysql
ENV <span class="hljs-attr">MYSQL_DATABASE_NUM</span>=<span class="hljs-number">1</span>
ENV <span class="hljs-attr">MYSQL_SERVICE_HOST</span>=xxx.mysql.zhangbei.rds.aliyuncs.com
ENV <span class="hljs-attr">MYSQL_SERVICE_PORT</span>=<span class="hljs-number">3306</span>
ENV <span class="hljs-attr">MYSQL_SERVICE_DB_NAME</span>=nacos
ENV <span class="hljs-attr">MYSQL_SERVICE_USER</span>=xxx
ENV <span class="hljs-attr">MYSQL_SERVICE_PASSWORD</span>=xxx
...
</code></pre>
<p>åœ¨ä¸º Nacos åšæœåŠ¡æš´éœ²çš„æ—¶å€™ï¼Œåªéœ€è¦æš´éœ² Nacos æ§åˆ¶å°çš„ 8080 ç«¯å£ï¼Œä¸”é™åˆ¶ä¸ºåªå…è®¸å†…ç½‘è®¿é—®å³å¯ã€‚å› ä¸º Nacos åªæ˜¯å†…éƒ¨ä½œä¸ºç»´æŠ¤ç®¡ç† MCP å·¥å…·å…ƒæ•°æ®ä¿¡æ¯çš„ MCP Registry ä½¿ç”¨ï¼Œå¯¹ç”¨æˆ·ä¾§ä¸æ„ŸçŸ¥ï¼›ä¸” Higress å’Œ Nacos éƒ½éƒ¨ç½²åœ¨å†…ç½‘çš„ K8s é›†ç¾¤ä¸Šé¢ï¼Œå†…éƒ¨é€šä¿¡é€šè¿‡ K8s çš„ Service å³å¯ï¼Œæ— éœ€å°† Nacos çš„ 8848 ç«¯å£æš´éœ²ç»™å…¬ç½‘ã€‚</p>
<h4 data-id="heading-10">ç”³è¯· K8s Service ä¾› Higress ä½¿ç”¨</h4>
<p>æ³¨æ„ Higress æ‹‰å–/è®¢é˜… Nacos ä¸­çš„é…ç½®ä¼šé€šè¿‡ gRPC çš„æ–¹å¼è°ƒç”¨ï¼Œè¿™é‡Œçš„ Service éœ€è¦<strong>æš´éœ² 8848 å’Œ 9848 ä¸¤ä¸ªç«¯å£</strong>ç»™ Higress ä½¿ç”¨ã€‚</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">v1</span>
<span class="hljs-attr">kind:</span> <span class="hljs-string">Service</span>
<span class="hljs-attr">metadata:</span>
Â  <span class="hljs-attr">name:</span> <span class="hljs-string">pre-oss-mcp-nacos-endpoint</span>
Â  <span class="hljs-attr">namespace:</span> <span class="hljs-string">aso-oss-mcp-nacos</span>
Â  <span class="hljs-attr">labels:</span>
Â  Â  <span class="hljs-attr">app:</span> <span class="hljs-string">mcp-nacos</span>
Â  Â  <span class="hljs-attr">nacos:</span> <span class="hljs-string">mcp-nacos</span>
<span class="hljs-attr">spec:</span>
Â  <span class="hljs-attr">type:</span> <span class="hljs-string">ClusterIP</span>
Â  <span class="hljs-attr">ports:</span>
Â  <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">subscribe-port</span>
Â  Â  <span class="hljs-attr">port:</span> <span class="hljs-number">8848</span>
Â  Â  <span class="hljs-attr">protocol:</span> <span class="hljs-string">TCP</span>
Â  Â  <span class="hljs-attr">targetPort:</span> <span class="hljs-number">8848</span>
Â  <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">grpc-port</span>
Â  Â  <span class="hljs-attr">port:</span> <span class="hljs-number">9848</span>
Â  Â  <span class="hljs-attr">protocol:</span> <span class="hljs-string">TCP</span>
Â  Â  <span class="hljs-attr">targetPort:</span> <span class="hljs-number">9848</span>
Â  <span class="hljs-attr">selector:</span>
Â  Â  <span class="hljs-attr">app:</span> <span class="hljs-string">nacos</span>
</code></pre>
<p>åŒç†ï¼Œå¦‚æœæƒ³ä½¿ç”¨ä¼ä¸šå†…éƒ¨çš„é•œåƒï¼Œæˆ–è€…æ˜¯æƒ³åœ¨åŸæœ¬çš„åŸºç¡€ä¸Šå³æˆä¸€äº›æ–°çš„åŠŸèƒ½ï¼Œå¦‚ä½¿ç”¨é˜¿é‡Œäº‘çš„ SLSã€äº‘ç›‘æ§ç­‰åŠŸèƒ½ï¼Œä¹Ÿå¯æ ¹æ® Nacos çš„ Dockerfile è¿›è¡Œè‡ªå®šä¹‰æ„å»ºéƒ¨ç½²ã€‚</p>
<h2 data-id="heading-11">é‰´æƒ</h2>
<p>Higress è‡ªèº«æä¾›äº†ä¸°å¯Œçš„é‰´æƒ <strong>[6</strong> <strong>]</strong> èƒ½åŠ›ï¼Œå¦‚æœä½ çš„ä¼ä¸šæœ¬èº«å°±åŸºäº Higress æ­å»ºäº†è‡ªå·±çš„ç½‘å…³å¹¶ä½¿ç”¨äº† Higress æä¾›çš„é‰´æƒèƒ½åŠ›ï¼Œè¿™ç§åœºæ™¯ä¸‹ç›´æ¥å¤ç”¨åŸæ¥çš„æ–¹æ¡ˆå³å¯ã€‚</p>
<p>å¦ä¸€ç§åœºæ™¯ä¸‹ï¼Œä¼ä¸šä¸­ä¼šæœ‰å¤šä¸ªæœåŠ¡ Providerï¼Œæ¯ä¸ª Provider æœ‰ä¸åŒçš„é‰´æƒæ–¹å¼ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼ŒæŸä¸ªæœåŠ¡æä¾›è€…ä¼šé€šè¿‡æ‹¦æˆªå™¨å¯¹è¯·æ±‚ä¸­æºå¸¦çš„ç”¨æˆ· Cookie è¿›è¡Œ RAM é‰´æƒï¼›å¦ä¸€ä¸ªæœåŠ¡æä¾›è€…ä¼šé€šè¿‡ tengine lua è„šæœ¬å¯¹è¯·æ±‚è¿›è¡Œè‡ªå®šä¹‰é‰´æƒï¼›ä»¥åŠåç»­æ³¨å†Œçš„æœåŠ¡å¯èƒ½æœ‰å…¶ä»–çš„é‰´æƒæ–¹å¼ã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7acd4931beee4a66a5895d49856ed06f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6YeM5LqR5LqR5Y6f55Sf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765790117&amp;x-signature=EO%2F2UHvLGWugcoZNCiMt6LwWi0w%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<p>ä¸€æ–¹é¢ï¼Œæˆ‘ä»¬å¹¶ä¸å¸Œæœ›ä½¿ç”¨ Higress çš„é‰´æƒèƒ½åŠ›å»è¦†ç›–å…¨éƒ¨çš„é‰´æƒåœºæ™¯ï¼Œå¼€å‘ç»´æŠ¤æˆæœ¬è¿‡é«˜ï¼Œæˆ‘ä»¬ä¼˜å…ˆè€ƒè™‘ç›´æ¥å¤ç”¨æœåŠ¡æä¾›è€…å·²æœ‰çš„é‰´æƒèƒ½åŠ›ï¼›å¦ä¸€æ–¹é¢ï¼Œå¦‚æœé€šè¿‡ç½‘å…³å±‚é‰´æƒéœ€è¦å°† AK æˆ–è€…è®¤è¯ä¿¡æ¯å­˜æ”¾åœ¨ Higress æœåŠ¡ä¸Šï¼Œåœ¨å®‰å…¨å±‚é¢ä¹Ÿä¸æ˜¯ä¸€ä¸ªåˆé€‚çš„åšæ³•ã€‚</p>
<p>è¿™é‡Œæ¨èçš„åšæ³•æ˜¯ç›´æ¥åœ¨ MCP å·¥å…·è°ƒç”¨çš„æ—¶å€™ï¼Œå°†é‰´æƒä¿¡æ¯é€ä¼ ç»™æœåŠ¡æä¾›è€…ï¼Œè®©æœåŠ¡æä¾›è€…å®Œæˆé‰´æƒã€‚</p>
<h2 data-id="heading-12">MCP éªŒè¯</h2>
<p>æ ¹æ®æ–‡æ¡£ <strong>[</strong> <strong>7]</strong> ä¸­çš„æ“ä½œç¤ºä¾‹ï¼Œæˆ‘ä»¬å¯ä»¥ç®€å•åšä¸ªå…¨é“¾è·¯æµ‹è¯•éªŒè¯ã€‚ä¸»è¦åˆ†ä¸ºä»¥ä¸‹ä¸‰æ­¥ï¼š</p>
<p><strong>1ï¼‰åœ¨ Nacos ä¸­æ³¨å†ŒæœåŠ¡ï¼Œå¹¶é…ç½® MCP å·¥å…·çš„å…ƒæ•°æ®ä¿¡æ¯ï¼š</strong></p>
<p>åœ¨ public å‘½åç©ºé—´ä¸‹ï¼Œåˆ›å»ºæœåŠ¡ä¿¡æ¯ã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f3cce81e87f4424e99a857611e3a2859~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6YeM5LqR5LqR5Y6f55Sf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765790117&amp;x-signature=ik5zeW9J75vyrvBOPjfEZ2YPskM%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<p>åœ¨æœºå™¨ä¸Šå°†è‡ªå·±çš„æœåŠ¡ä½œä¸ºæ°¸ä¹…å®ä¾‹æ³¨å†Œè¿›å»ã€‚ï¼ˆè¿™é‡Œä¸ºäº†å¿«é€ŸéªŒè¯é»‘å±ç™»é™†æœºå™¨æ“ä½œï¼Œçº¿ä¸Šç”Ÿäº§ç¯å¢ƒè¿˜æ˜¯é¡»è¦ç™½å±æ“ä½œï¼‰</p>
<pre><code class="hljs language-ini" lang="ini">curlÂ -X POSTÂ 'http://127.0.0.1:8848/nacos/v1/ns/instance?<span class="hljs-attr">namespaceId</span>=[namespace]&amp;serviceName=[service_name]&amp;groupName=[group_name]&amp;ip=[æœåŠ¡åŸŸå]&amp;port=[æœåŠ¡ç«¯å£]&amp;ephemeral=<span class="hljs-literal">false</span><span class="hljs-string">'
</span></code></pre>
<p>æ³¨å†Œå®Œä¹‹åï¼Œå°±èƒ½åœ¨ Nacos æ§åˆ¶å°ä¸Šçœ‹åˆ°æ³¨å†Œçš„æœåŠ¡é…ç½®ä»¥åŠå¥åº·çŠ¶æ€ã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5be0472e03b74a07bbd388c7c1d92e98~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6YeM5LqR5LqR5Y6f55Sf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765790117&amp;x-signature=ca4dvfQPFxFBQAhkYhJF1gY%2FFeg%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<p>æ¥ç€åœ¨ Nacos æ§åˆ¶å°ä¸Šé…ç½® MCP å·¥å…·ï¼Œæ·»åŠ ä¸€ä¸ªç®€å•å·¥å…·ï¼Œå¯ä»¥é€‰æ‹©ä¸€ä¸ªæ— å‚æ•° GET æ¥å£ï¼Œå¹¶å‘å¸ƒã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9d0605c476a54633aa18f22b8a6c70ba~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6YeM5LqR5LqR5Y6f55Sf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765790117&amp;x-signature=ODOnOK10ad6NFyuev6hkAYQVwMI%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c08d19a2f86d40f6ac93ff1fbd120dab~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6YeM5LqR5LqR5Y6f55Sf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765790117&amp;x-signature=TnmN1a1FMqzBSUSBgIfMheVwAdE%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
Â Â <span class="hljs-attr">"requestTemplate"</span><span class="hljs-punctuation">:</span>Â <span class="hljs-punctuation">{</span>
Â  Â Â <span class="hljs-attr">"url"</span><span class="hljs-punctuation">:</span>Â <span class="hljs-string">"/xxx/list.json"</span><span class="hljs-punctuation">,</span>
Â  Â Â <span class="hljs-attr">"method"</span><span class="hljs-punctuation">:</span>Â <span class="hljs-string">"GET"</span><span class="hljs-punctuation">,</span>
Â  Â Â <span class="hljs-attr">"headers"</span><span class="hljs-punctuation">:</span>Â <span class="hljs-punctuation">[</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
Â  Â Â <span class="hljs-attr">"argsToUrlParam"</span><span class="hljs-punctuation">:</span>Â <span class="hljs-literal"><span class="hljs-keyword">true</span></span>
Â Â <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
Â Â <span class="hljs-attr">"responseTemplate"</span><span class="hljs-punctuation">:</span>Â <span class="hljs-punctuation">{</span>
Â  Â Â <span class="hljs-attr">"body"</span><span class="hljs-punctuation">:</span>Â <span class="hljs-string">"{{.}}"</span>
Â Â <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p><strong>2ï¼‰åœ¨ Higress ä¸­é…ç½® MCP Nacos çš„æœåŠ¡æ¥æºï¼š</strong></p>
<p>è¿™é‡Œä¸ºäº†å¿«é€Ÿæµ‹è¯•å…³é—­äº† Nacos çš„è®¤è¯ï¼Œçº¿ä¸Šç¯å¢ƒå»ºè®®å¼€å¯ Nacos çš„è®¤è¯ã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/31950e12263e4c80b2ac2b9391c6a910~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6YeM5LqR5LqR5Y6f55Sf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765790117&amp;x-signature=fdoePTv7xVPvSlxOqIUEjegEEV0%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<p><strong>3ï¼‰åœ¨ Cursor/Cherry Studio ä¸­é…ç½®å¯¹å¤–æš´éœ²çš„ Higress æœåŠ¡åœ°å€å’Œ uriï¼Œå³å¯ä½¿ç”¨ MCP å·¥å…·ï¼š</strong></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/eb0c06bc1fe04cb89931c0c337d67e1f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6YeM5LqR5LqR5Y6f55Sf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765790117&amp;x-signature=1HPKUFXuboEWfYgYUHR4ewk2xUw%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fc7470b810164f83b9b8ca7d89834aae~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6YeM5LqR5LqR5Y6f55Sf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765790117&amp;x-signature=rchVHa9y6735FluxCW2WeqU7MVg%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<h2 data-id="heading-13">è®¾è®¡å›¾</h2>
<h3 data-id="heading-14">å®¹ç¾æ¶æ„</h3>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e48188f92d884ebd9159719acf34ae38~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6YeM5LqR5LqR5Y6f55Sf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765790117&amp;x-signature=67W9t9detsxceS8jx39TR0TLcnY%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<p>è¿›å…¥æµè§ˆå™¨æŸ¥çœ‹åŸå›¾ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fimg.alicdn.com%2Fimgextra%2Fi2%2FO1CN0138v82b1L7vNY3RQdo_!!6000000001253-2-tps-6507-5451.png" target="_blank" title="https://img.alicdn.com/imgextra/i2/O1CN0138v82b1L7vNY3RQdo_!!6000000001253-2-tps-6507-5451.png" ref="nofollow noopener noreferrer">img.alicdn.com/imgextra/i2â€¦</a></p>
<p>åœ¨æ•´ä¸ª MCP ç½‘å…³ä¸­ï¼Œé€šè¿‡ uri æ¥è·¯ç”±ä¸åŒçš„ MCP å·¥å…·ï¼Œå®ç°å·¥å…·çš„éš”ç¦»ã€‚</p>
<h3 data-id="heading-15">é€»è¾‘æ¨¡å—å›¾</h3>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/58740208297546f9bb5f91a6f3fea541~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6YeM5LqR5LqR5Y6f55Sf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765790117&amp;x-signature=w%2B%2F8liRptkOr3GSLOcW3qzC8u7o%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<h3 data-id="heading-16">æ—¶åºå›¾</h3>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4c3feed715ef439ab853acdd4f56d7d7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6YeM5LqR5LqR5Y6f55Sf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765790117&amp;x-signature=7Bq0kGTU%2FKBtcEc5D0Ks%2BdrrOWA%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<p><strong>é™„å½•ï¼š</strong></p>
<p>[1] åŸºäº all-in-one çš„ docker é•œåƒ</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fhigress-group%2Fhigress-standalone%2Fblob%2Fmain%2Fall-in-one%2FDockerfile" target="_blank" title="https://github.com/higress-group/higress-standalone/blob/main/all-in-one/Dockerfile" ref="nofollow noopener noreferrer">github.com/higress-groâ€¦</a></p>
<p>[2] higress-plugin-server</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.cnkirito.moe%2Fhigress-plugin-server%2F" target="_blank" title="https://www.cnkirito.moe/higress-plugin-server/" ref="nofollow noopener noreferrer">www.cnkirito.moe/higress-pluâ€¦</a></p>
<p>[3] åŸºäº nacos-server çš„é•œåƒè¿›è¡Œéƒ¨ç½²</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fnacos-group%2Fnacos-docker%2Fblob%2Fmaster%2Fbuild%2FDockerfile" target="_blank" title="https://github.com/nacos-group/nacos-docker/blob/master/build/Dockerfile" ref="nofollow noopener noreferrer">github.com/nacos-groupâ€¦</a></p>
<p>[4] è„šæœ¬æºç </p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fkmodules%2Fpeer-finder%2Fblob%2Fmaster%2Fpeer-finder.go" target="_blank" title="https://github.com/kmodules/peer-finder/blob/master/peer-finder.go" ref="nofollow noopener noreferrer">github.com/kmodules/peâ€¦</a></p>
<p>[5] mysql-schema.sql</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Falibaba%2Fnacos%2Fblob%2Fdevelop%2Fdistribution%2Fconf%2Fmysql-schema.sql" target="_blank" title="https://github.com/alibaba/nacos/blob/develop/distribution/conf/mysql-schema.sql" ref="nofollow noopener noreferrer">github.com/alibaba/nacâ€¦</a></p>
<p>[6] Higress æä¾›ä¸°å¯Œé‰´æƒèƒ½åŠ›</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fhigress.cn%2Fdocs%2Flatest%2Fplugins%2Fauthentication%2Fbasic-auth%2F" target="_blank" title="https://higress.cn/docs/latest/plugins/authentication/basic-auth/" ref="nofollow noopener noreferrer">higress.cn/docs/latestâ€¦</a></p>
<p>[7]Â <a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%3F__biz%3DMzUzNzYxNjAzMg%3D%3D%26mid%3D2247575770%26idx%3D1%26sn%3Dca41d8dade57fcf378e1f7c5a5e0dca5%26scene%3D21%23wechat_redirect" target="_blank" title="https://mp.weixin.qq.com/s?__biz=MzUzNzYxNjAzMg==&amp;mid=2247575770&amp;idx=1&amp;sn=ca41d8dade57fcf378e1f7c5a5e0dca5&amp;scene=21#wechat_redirect" ref="nofollow noopener noreferrer">åŸºäº Nacos + Higress Â çš„ MCP å¼€å‘æ–°èŒƒå¼ï¼Œæ‰‹æŠŠæ‰‹æ•™ç¨‹æ¥äº†ï¼</a></p>
<p>[8]Â <a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%3F__biz%3DMzU0MzkyMTgzNg%3D%3D%26mid%3D2247486505%26idx%3D1%26sn%3Db61997531cce196d0b7fc46f79a003be%26scene%3D21%23wechat_redirect" target="_blank" title="https://mp.weixin.qq.com/s?__biz=MzU0MzkyMTgzNg==&amp;mid=2247486505&amp;idx=1&amp;sn=b61997531cce196d0b7fc46f79a003be&amp;scene=21#wechat_redirect" ref="nofollow noopener noreferrer">Nacos 3.0 æ­£å¼å‘å¸ƒï¼šMCP Registryã€å®‰å…¨é›¶ä¿¡ä»»ã€é“¾æ¥æ›´å¤šç”Ÿæ€</a></p>
<p>[9] ä¿®æ”¹å†…ç½®æ’ä»¶çš„é•œåƒåœ°å€</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fhigress.cn%2Fdocs%2Flatest%2Fops%2Fhow-tos%2Fbuiltin-plugin-url%2F" target="_blank" title="https://higress.cn/docs/latest/ops/how-tos/builtin-plugin-url/" ref="nofollow noopener noreferrer">higress.cn/docs/latestâ€¦</a></p>
<p>[10] Nacos é›†ç¾¤æ¨¡å¼</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fnacos.io%2Fdocs%2Flatest%2Fmanual%2Fadmin%2Fdeployment%2Fdeployment-cluster%2F" target="_blank" title="https://nacos.io/docs/latest/manual/admin/deployment/deployment-cluster/" ref="nofollow noopener noreferrer">nacos.io/docs/latestâ€¦</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[çº¿ä¸‹æ´»åŠ¨é€Ÿé€’ä¸¨AI åŸç”Ÿåº”ç”¨å¼€æºå¼€å‘è€…æ²™é¾™Â·æ­å·ç«™]]></title>    <link>https://juejin.cn/post/7581097545670869011</link>    <guid>https://juejin.cn/post/7581097545670869011</guid>    <pubDate>2025-12-08T09:23:54.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581097545670869011" data-draft-id="7581210455827038244" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="çº¿ä¸‹æ´»åŠ¨é€Ÿé€’ä¸¨AI åŸç”Ÿåº”ç”¨å¼€æºå¼€å‘è€…æ²™é¾™Â·æ­å·ç«™"/> <meta itemprop="keywords" content="äº‘åŸç”Ÿ"/> <meta itemprop="datePublished" content="2025-12-08T09:23:54.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="é˜¿é‡Œäº‘äº‘åŸç”Ÿ"/> <meta itemprop="url" content="https://juejin.cn/user/3808363977648493"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            çº¿ä¸‹æ´»åŠ¨é€Ÿé€’ä¸¨AI åŸç”Ÿåº”ç”¨å¼€æºå¼€å‘è€…æ²™é¾™Â·æ­å·ç«™
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3808363977648493/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    é˜¿é‡Œäº‘äº‘åŸç”Ÿ
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-08T09:23:54.000Z" title="Mon Dec 08 2025 09:23:54 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»1åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><ul>
<li>
<p><strong>æ—¶é—´ï¼š12 æœˆÂ 12Â æ—¥ï¼ˆå‘¨äº”ï¼‰13ï¼š30</strong></p>
</li>
<li>
<p><strong>åœ°ç‚¹ï¼šæ­å·é˜¿é‡Œå·´å·´äº‘è°·å›­åŒºÂ 2Â å·æ¥¼è®¿å®¢ä¸­å¿ƒÂ 225Â æ™¯é€¸ä¹¦é™¢</strong></p>
</li>
</ul>
<p>äº†è§£Â AIÂ åŸç”Ÿåº”ç”¨å¼€å‘çš„å‰æ²¿è¶‹åŠ¿å’Œæ ¸å¿ƒäº§å“æŠ€æœ¯ï¼Œå…¨é¢Â getÂ å…¸å‹åº”ç”¨åœºæ™¯åŠç¡¬æ ¸å®æˆ˜ç»éªŒã€‚</p>
<p>ç°åœºå®Œæˆå®æ“ï¼Œé¢å‘ä¸“å±è¯ä¹¦ï¼</p>
<p>å…è´¹æŠ¥åé“¾æ¥ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.aliyun.com%2Factivity%2Fmiddleware%2F2025-ai-hangzhou" target="_blank" title="https://www.aliyun.com/activity/middleware/2025-ai-hangzhou" ref="nofollow noopener noreferrer">www.aliyun.com/activity/miâ€¦</a></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/98f6b2dc601a4a7a9f6fa105f70cc5d3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6YeM5LqR5LqR5Y6f55Sf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765790633&amp;x-signature=aSIv13dpBUeny%2FePDCvOb%2Bsxb4A%3D" alt="image.png" loading="lazy"/></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[æ‰‹å†™ new æ“ä½œç¬¦å’Œ instanceofï¼šæ·±å…¥ç†è§£ JavaScript å¯¹è±¡åˆ›å»ºä¸åŸå‹é“¾æ£€æµ‹]]></title>    <link>https://juejin.cn/post/7581097111896080438</link>    <guid>https://juejin.cn/post/7581097111896080438</guid>    <pubDate>2025-12-08T09:26:45.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581097111896080438" data-draft-id="7581210455827087396" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="æ‰‹å†™ new æ“ä½œç¬¦å’Œ instanceofï¼šæ·±å…¥ç†è§£ JavaScript å¯¹è±¡åˆ›å»ºä¸åŸå‹é“¾æ£€æµ‹"/> <meta itemprop="keywords" content="å‰ç«¯,JavaScript,ECMAScript 6"/> <meta itemprop="datePublished" content="2025-12-08T09:26:45.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="1024è‚¥å®…"/> <meta itemprop="url" content="https://juejin.cn/user/588993964030574"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            æ‰‹å†™ new æ“ä½œç¬¦å’Œ instanceofï¼šæ·±å…¥ç†è§£ JavaScript å¯¹è±¡åˆ›å»ºä¸åŸå‹é“¾æ£€æµ‹
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/588993964030574/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    1024è‚¥å®…
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-08T09:26:45.000Z" title="Mon Dec 08 2025 09:26:45 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»8åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h4 data-id="heading-0">å¼•è¨€</h4>
<p>åœ¨JavaScriptä¸­ï¼Œ<code>new</code>æ“ä½œç¬¦å’Œ<code>instanceof</code>æ“ä½œç¬¦æ˜¯é¢å‘å¯¹è±¡ç¼–ç¨‹çš„æ ¸å¿ƒæ¦‚å¿µã€‚ç†è§£å®ƒä»¬çš„åº•å±‚åŸç†ä¸ä»…èƒ½å¸®åŠ©æˆ‘ä»¬æ›´å¥½åœ°ä½¿ç”¨JavaScriptï¼Œè¿˜èƒ½åœ¨é¢è¯•ä¸­å±•ç°å‡ºæ›´æ‰å®çš„åŸºç¡€çŸ¥è¯†ã€‚</p>
<p>ä½ æ˜¯å¦æ›¾å¥½å¥‡:</p>
<ul>
<li>å½“æˆ‘ä»¬ä½¿ç”¨<code>new</code>åˆ›å»ºå¯¹è±¡æ—¶ï¼ŒèƒŒååˆ°åº•å‘ç”Ÿäº†ä»€ä¹ˆ?</li>
<li><code>instanceof</code>æ˜¯å¦‚ä½•æ£€æµ‹å¯¹è±¡ç±»å‹çš„?</li>
<li>åŸå‹é“¾åœ¨å¯¹è±¡åˆ›å»ºå’Œç±»å‹æ£€æµ‹ä¸­æ‰®æ¼”äº†ä»€ä¹ˆè§’è‰²?</li>
</ul>
<p>é€šè¿‡æ‰‹å†™å®ç°è¿™ä¸¤ä¸ªæ“ä½œç¬¦, æˆ‘ä»¬å°†æ·±å…¥ç†è§£JavaScriptçš„å¯¹è±¡åˆ›å»ºæœºåˆ¶å’ŒåŸå‹é“¾æ£€æµ‹åŸç†ã€‚</p>
<h4 data-id="heading-1">ä¸€ã€newæ“ä½œç¬¦çš„æ·±å…¥ç†è§£</h4>
<h5 data-id="heading-2">1.1 newæ“ä½œç¬¦çš„ä½œç”¨</h5>
<p><code>new</code>æ“ä½œç¬¦ç”¨äºåˆ›å»ºä¸€ä¸ªç”¨æˆ·å®šä¹‰çš„å¯¹è±¡ç±»å‹çš„å®ä¾‹æˆ–å…·æœ‰æ„é€ å‡½æ•°çš„å†…ç½®å¯¹è±¡çš„å®ä¾‹ã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// åŸºæœ¬ç”¨æ³•</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">Person</span>(<span class="hljs-params">name, age</span>) {
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = name;
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">age</span> = age;
}

<span class="hljs-title class_">Person</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">sayHello</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params"/>) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`Hello, I'm <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.name}</span>, <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.age}</span> years old.`</span>);
};

<span class="hljs-keyword">const</span> person = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Person</span>(<span class="hljs-string">"Alice"</span>, <span class="hljs-number">25</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(person.<span class="hljs-property">name</span>); <span class="hljs-comment">// Alice</span>
person.<span class="hljs-title function_">sayHello</span>(); <span class="hljs-comment">// Hello, I'm Alice, 25 years old.</span>
</code></pre>
<h5 data-id="heading-3">1.2 newæ“ä½œç¬¦çš„æ‰§è¡Œè¿‡ç¨‹</h5>
<p>å½“æˆ‘ä»¬æ‰§è¡Œ<code>new Constructor(...args)</code>æ—¶, JavaScriptå¼•æ“ä¼šæ‰§è¡Œä»¥ä¸‹æ­¥éª¤:</p>
<ol>
<li><strong>åˆ›å»ºä¸€ä¸ªæ–°å¯¹è±¡:</strong> åˆ›å»ºä¸€ä¸ªç©ºçš„ç®€å•JavaScriptå¯¹è±¡(å³<code>{}</code>)</li>
<li><strong>è®¾ç½®åŸå‹é“¾:</strong> å°†æ–°å¯¹è±¡çš„<code>[[Prototype]]</code>(å³<code>__proto__</code>)æŒ‡å‘æ„é€ å‡½æ•°çš„<code>prototype</code>å±æ€§</li>
<li><strong>ç»‘å®šthiså€¼:</strong> å°†æ„é€ å‡½æ•°ä¸­çš„<code>this</code>ç»‘å®šåˆ°æ–°åˆ›å»ºçš„å¯¹è±¡</li>
<li><strong>æ‰§è¡Œæ„é€ å‡½æ•°:</strong> æ‰§è¡Œæ„é€ å‡½æ•°ä¸­çš„ä»£ç (ä¸ºæ–°å¯¹è±¡æ·»åŠ å±æ€§)</li>
<li><strong>è¿”å›ç»“æœ:</strong></li>
</ol>
<ul>
<li>å¦‚æœæ„é€ å‡½æ•°è¿”å›ä¸€ä¸ªå¯¹è±¡, åˆ™è¿”å›è¿™ä¸ªå¯¹è±¡</li>
<li>å¦åˆ™è¿”å›æ–°åˆ›å»ºçš„å¯¹è±¡</li>
</ul>
<h4 data-id="heading-4">äºŒã€æ‰‹å†™newæ“ä½œç¬¦</h4>
<h5 data-id="heading-5">2.1 åŸºç¡€å®ç°</h5>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">/**
 * æ‰‹å†™ new æ“ä½œç¬¦
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">Function</span>} Constructor æ„é€ å‡½æ•°
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">...any</span>} args æ„é€ å‡½æ•°å‚æ•°
 * <span class="hljs-doctag">@returns</span> {<span class="hljs-type">Object</span>} æ–°åˆ›å»ºçš„å¯¹è±¡
 */</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">myNew</span>(<span class="hljs-params">Constructor, ...args</span>) {
  <span class="hljs-comment">// 1. åˆ›å»ºä¸€ä¸ªæ–°å¯¹è±¡ï¼Œç»§æ‰¿æ„é€ å‡½æ•°çš„åŸå‹</span>
  <span class="hljs-keyword">const</span> obj = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">create</span>(<span class="hljs-title class_">Constructor</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>);

  <span class="hljs-comment">// 2. æ‰§è¡Œæ„é€ å‡½æ•°ï¼Œç»‘å®š this åˆ°æ–°å¯¹è±¡</span>
  <span class="hljs-keyword">const</span> result = <span class="hljs-title class_">Constructor</span>.<span class="hljs-title function_">apply</span>(obj, args);

  <span class="hljs-comment">// 3. å¦‚æœæ„é€ å‡½æ•°è¿”å›ä¸€ä¸ªå¯¹è±¡, åˆ™è¿”å›è¯¥å¯¹è±¡; å¦åˆ™è¿”å›æ–°å¯¹è±¡</span>
  <span class="hljs-keyword">return</span> result <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">Object</span> ? result : obj;
}

<span class="hljs-comment">// æµ‹è¯•åŸºç¡€åŠŸèƒ½</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">Person</span>(<span class="hljs-params">name, age</span>) {
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = name;
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">age</span> = age;
}

<span class="hljs-title class_">Person</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">introduce</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params"/>) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`Hi, I'm <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.name}</span>, <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.age}</span> years old.`</span>);
};

<span class="hljs-keyword">const</span> person1 = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Person</span>(<span class="hljs-string">"Alice"</span>, <span class="hljs-number">25</span>);
<span class="hljs-keyword">const</span> person2 = <span class="hljs-title function_">myNew</span>(<span class="hljs-title class_">Person</span>, <span class="hljs-string">"Bob"</span>, <span class="hljs-number">30</span>);

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(person1 <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">Person</span>); <span class="hljs-comment">// true</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(person2 <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">Person</span>); <span class="hljs-comment">// true</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(person2.<span class="hljs-property">name</span>); <span class="hljs-comment">// Bob</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(person2.<span class="hljs-property">age</span>); <span class="hljs-comment">// 30</span>
person2.<span class="hljs-title function_">introduce</span>(); <span class="hljs-comment">// Hi, I'm Bob, 30 years old.</span>

</code></pre>
<h5 data-id="heading-6">2.2 å®Œæ•´å®ç°(å¤„ç†è¾¹ç•Œæƒ…å†µ)</h5>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">/**
 * å®Œæ•´ç‰ˆ myNew å®ç°ï¼Œå¤„ç†å„ç§è¾¹ç•Œæƒ…å†µ
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">Function</span>} Constructor æ„é€ å‡½æ•°
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">...any</span>} args æ„é€ å‡½æ•°å‚æ•°
 * <span class="hljs-doctag">@returns</span> {<span class="hljs-type">Object</span>} æ–°åˆ›å»ºçš„å¯¹è±¡
 */</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">myNewComplete</span>(<span class="hljs-params">Constructor, ...args</span>) {
  <span class="hljs-comment">// å‚æ•°éªŒè¯</span>
  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> <span class="hljs-title class_">Constructor</span> !== <span class="hljs-string">"function"</span>) {
    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TypeError</span>(<span class="hljs-string">"Constructor must be a function."</span>);
  }

  <span class="hljs-comment">// 1. åˆ›å»ºä¸€ä¸ªæ–°å¯¹è±¡, ç»§æ‰¿æ„é€ å‡½æ•°çš„åŸå‹</span>
  <span class="hljs-comment">// ä½¿ç”¨ Object.create è€Œä¸æ˜¯ {}, ç¡®ä¿åŸå‹é“¾æ­£ç¡®</span>
  <span class="hljs-keyword">const</span> obj = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">create</span>(<span class="hljs-title class_">Constructor</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>);

  <span class="hljs-comment">// 2. æ‰§è¡Œæ„é€ å‡½æ•°, ç»‘å®š this åˆ°æ–°å¯¹è±¡</span>
  <span class="hljs-keyword">const</span> result = <span class="hljs-title class_">Constructor</span>.<span class="hljs-title function_">apply</span>(obj, args);

  <span class="hljs-comment">// 3. å¤„ç†è¿”å›å€¼</span>
  <span class="hljs-comment">// 3.1 å¦‚æœæ„é€ å‡½æ•°è¿”å›ä¸€ä¸ªå¯¹è±¡ï¼Œåˆ™è¿”å›è¯¥å¯¹è±¡</span>
  <span class="hljs-comment">// 3.2 å¦åˆ™è¿”å›æ–°åˆ›å»ºçš„å¯¹è±¡</span>
  <span class="hljs-keyword">const</span> isObject = result !== <span class="hljs-literal">null</span> &amp;&amp; <span class="hljs-keyword">typeof</span> result === <span class="hljs-string">"object"</span>;
  <span class="hljs-keyword">const</span> isFunction = <span class="hljs-keyword">typeof</span> result === <span class="hljs-string">"function"</span>;

  <span class="hljs-keyword">return</span> isObject || isFunction ? result : obj;
}
<span class="hljs-comment">// æµ‹è¯•å„ç§è¾¹ç•Œæƒ…å†µ</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"=== æµ‹è¯• myNewComplete ==="</span>);

<span class="hljs-comment">// æµ‹è¯•1: æ„é€ å‡½æ•°è¿”å›å¯¹è±¡</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">PersonWithReturnObject</span>(<span class="hljs-params">name</span>) {
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = name;
  <span class="hljs-keyword">return</span> { <span class="hljs-attr">custom</span>: <span class="hljs-string">"custom object"</span> };
}

<span class="hljs-keyword">const</span> test1 = <span class="hljs-title function_">myNewComplete</span>(<span class="hljs-title class_">PersonWithReturnObject</span>, <span class="hljs-string">"Alice"</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"æµ‹è¯•1 - æ„é€ å‡½æ•°è¿”å›å¯¹è±¡:"</span>, test1); <span class="hljs-comment">// { custom: 'custom object' }</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(
  <span class="hljs-string">"æµ‹è¯•1 - ä¸æ˜¯ Person å®ä¾‹:"</span>,
  !(test1 <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">PersonWithReturnObject</span>)
); <span class="hljs-comment">// true</span>

<span class="hljs-comment">// æµ‹è¯•2: æ„é€ å‡½æ•°è¿”å› null</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">PersonWithReturnNull</span>(<span class="hljs-params">name</span>) {
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = name;
  <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
}

<span class="hljs-keyword">const</span> test2 = <span class="hljs-title function_">myNewComplete</span>(<span class="hljs-title class_">PersonWithReturnNull</span>, <span class="hljs-string">"Bob"</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(
  <span class="hljs-string">"æµ‹è¯•2 - æ„é€ å‡½æ•°è¿”å› null:"</span>,
  test2 <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">PersonWithReturnNull</span>
); <span class="hljs-comment">// true</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"æµ‹è¯•2 - name å±æ€§:"</span>, test2.<span class="hljs-property">name</span>); <span class="hljs-comment">// Bob</span>

<span class="hljs-comment">// æµ‹è¯•3: æ„é€ å‡½æ•°è¿”å›å‡½æ•°</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">PersonWithReturnFunction</span>(<span class="hljs-params">name</span>) {
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = name;
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">function</span> (<span class="hljs-params"/>) {
    <span class="hljs-keyword">return</span> <span class="hljs-string">"I am a function"</span>;
  };
}

<span class="hljs-keyword">const</span> test3 = <span class="hljs-title function_">myNewComplete</span>(<span class="hljs-title class_">PersonWithReturnFunction</span>, <span class="hljs-string">"Charlie"</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"æµ‹è¯•3 - æ„é€ å‡½æ•°è¿”å›å‡½æ•°:"</span>, <span class="hljs-keyword">typeof</span> test3); <span class="hljs-comment">// function</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"æµ‹è¯•3 - å‡½æ•°è°ƒç”¨:"</span>, <span class="hljs-title function_">test3</span>()); <span class="hljs-comment">// I am a function</span>

<span class="hljs-comment">// æµ‹è¯•4: æ„é€ å‡½æ•°è¿”å›åŸºæœ¬ç±»å‹</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">PersonWithReturnPrimitive</span>(<span class="hljs-params">name</span>) {
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = name;
  <span class="hljs-keyword">return</span> <span class="hljs-number">42</span>;
}

<span class="hljs-keyword">const</span> test4 = <span class="hljs-title function_">myNewComplete</span>(<span class="hljs-title class_">PersonWithReturnPrimitive</span>, <span class="hljs-string">"David"</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(
  <span class="hljs-string">"æµ‹è¯•4 - æ„é€ å‡½æ•°è¿”å›åŸºæœ¬ç±»å‹:"</span>,
  test4 <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">PersonWithReturnPrimitive</span>
); <span class="hljs-comment">// true</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"æµ‹è¯•4 - name å±æ€§:"</span>, test4.<span class="hljs-property">name</span>); <span class="hljs-comment">// David</span>

<span class="hljs-comment">// æµ‹è¯•5: æ„é€ å‡½æ•°æ²¡æœ‰è¿”å›å€¼</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">PersonNoReturn</span>(<span class="hljs-params">name</span>) {
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = name;
}

<span class="hljs-keyword">const</span> test5 = <span class="hljs-title function_">myNewComplete</span>(<span class="hljs-title class_">PersonNoReturn</span>, <span class="hljs-string">"Eve"</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"æµ‹è¯•5 - æ„é€ å‡½æ•°æ²¡æœ‰è¿”å›å€¼:"</span>, test5 <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">PersonNoReturn</span>); <span class="hljs-comment">// true</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"æµ‹è¯•5 - name å±æ€§:"</span>, test5.<span class="hljs-property">name</span>); <span class="hljs-comment">// Eve</span>
</code></pre>
<h5 data-id="heading-7">2.3 å¤„ç†ES6ç±»çš„ç‰ˆæœ¬</h5>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">/**
 * å®Œæ•´ç‰ˆ myNew å®ç°ï¼Œå¤„ç†å„ç§è¾¹ç•Œæƒ…å†µï¼ˆåŒ…æ‹¬ ES6 ç±»ï¼‰
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">Function</span>} Constructor æ„é€ å‡½æ•°
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">...any</span>} args æ„é€ å‡½æ•°å‚æ•°
 * <span class="hljs-doctag">@returns</span> {<span class="hljs-type">Object</span>} æ–°åˆ›å»ºçš„å¯¹è±¡
 */</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">myNewComplete</span>(<span class="hljs-params">Constructor, ...args</span>) {
  <span class="hljs-comment">// å‚æ•°éªŒè¯</span>
  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> <span class="hljs-title class_">Constructor</span> !== <span class="hljs-string">"function"</span>) {
    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TypeError</span>(<span class="hljs-string">"Constructor must be a function."</span>);
  }

  <span class="hljs-comment">// æ˜¯å“Ÿå“¦é‚£ä¸ª Reflect.construct å¤„ç† ES6 ç±»å’Œæ™®é€šå‡½æ•°</span>
  <span class="hljs-keyword">const</span> instance = <span class="hljs-title class_">Reflect</span>.<span class="hljs-title function_">construct</span>(<span class="hljs-title class_">Constructor</span>, args, <span class="hljs-title class_">Constructor</span>);

  <span class="hljs-comment">// å¯¹äºæ™®é€šå‡½æ•°, å¤„ç†è¿”å›å€¼é€»è¾‘</span>
  <span class="hljs-comment">// åˆ¤æ–­æ˜¯å¦æ˜¯ ES6ç±»(ç®€å•åˆ¤æ–­æ–¹å¼)</span>
  <span class="hljs-keyword">const</span> isClass =
    <span class="hljs-keyword">typeof</span> <span class="hljs-title class_">Constructor</span> === <span class="hljs-string">"function"</span> &amp;&amp;
    (<span class="hljs-title class_">Constructor</span>.<span class="hljs-title function_">toString</span>().<span class="hljs-title function_">startsWith</span>(<span class="hljs-string">"class"</span>) ||
      <span class="hljs-title class_">Function</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">toString</span>.<span class="hljs-title function_">call</span>(<span class="hljs-title class_">Constructor</span>).<span class="hljs-title function_">startsWith</span>(<span class="hljs-string">"class"</span>));

  <span class="hljs-keyword">if</span> (!isClass) {
    <span class="hljs-comment">// æ£€æŸ¥æ„é€ å‡½æ•°æ˜¯å¦æ˜¾å¼è¿”å›äº†å¯¹è±¡/å‡½æ•°</span>
    <span class="hljs-keyword">const</span> isObject = instance !== <span class="hljs-literal">null</span> &amp;&amp; <span class="hljs-keyword">typeof</span> instance === <span class="hljs-string">"object"</span>;
    <span class="hljs-keyword">const</span> isFunction = <span class="hljs-keyword">typeof</span> instance === <span class="hljs-string">"function"</span>;

    <span class="hljs-comment">// å¦‚æœæ„é€ å‡½æ•°è¿”å›çš„ä¸æ˜¯ç»§æ‰¿è‡ªå…¶åŸå‹çš„å¯¹è±¡, è¯´æ˜æ˜¾å¼è¿”å›äº†å…¶ä»–å€¼</span>
    <span class="hljs-keyword">if</span> (!(instance <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">Constructor</span>)) {
      <span class="hljs-keyword">return</span> isObject || isFunction
        ? instance
        : <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">create</span>(<span class="hljs-title class_">Constructor</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>);
    }
  }

  <span class="hljs-keyword">return</span> instance;
}
</code></pre>
<h4 data-id="heading-8">2.4 æµ‹è¯•ç”¨ä¾‹</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"=== å®Œæ•´æµ‹è¯•ç”¨ä¾‹ ==="</span>);

<span class="hljs-comment">// æµ‹è¯•ç±»ç»§æ‰¿</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">Animal</span> {
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">name</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = name;
  }

  <span class="hljs-title function_">speak</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.name}</span> makes a noise.`</span>);
  }
}

<span class="hljs-keyword">class</span> <span class="hljs-title class_">Dog</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">Animal</span> {
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">name, breed</span>) {
    <span class="hljs-variable language_">super</span>(name);
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">breed</span> = breed;
  }

  <span class="hljs-title function_">speak</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.name}</span> (<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.breed}</span>) barks.`</span>);
  }
}

<span class="hljs-comment">// æµ‹è¯• ES6 ç±»</span>
<span class="hljs-keyword">const</span> dog1 = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Dog</span>(<span class="hljs-string">"Rex"</span>, <span class="hljs-string">"Labrador"</span>);
<span class="hljs-keyword">const</span> dog2 = <span class="hljs-title function_">myNewComplete</span>(<span class="hljs-title class_">Dog</span>, <span class="hljs-string">"Buddy"</span>, <span class="hljs-string">"Golden Retriever"</span>);

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"dog1 instanceof Dog:"</span>, dog1 <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">Dog</span>); <span class="hljs-comment">// true</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"dog2 instanceof Dog:"</span>, dog2 <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">Dog</span>); <span class="hljs-comment">// true</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"dog1 instanceof Animal:"</span>, dog1 <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">Animal</span>); <span class="hljs-comment">// true</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"dog2 instanceof Animal:"</span>, dog2 <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">Animal</span>); <span class="hljs-comment">// true</span>

dog1.<span class="hljs-title function_">speak</span>(); <span class="hljs-comment">// Rex (Labrador) barks.</span>
dog2.<span class="hljs-title function_">speak</span>(); <span class="hljs-comment">// Buddy (Golden Retriever) barks.</span>

<span class="hljs-comment">// æµ‹è¯•å†…ç½®æ„é€ å‡½æ•°</span>
<span class="hljs-keyword">const</span> date1 = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>(<span class="hljs-string">"2025-12-08"</span>);
<span class="hljs-keyword">const</span> date2 = <span class="hljs-title function_">myNewComplete</span>(<span class="hljs-title class_">Date</span>, <span class="hljs-string">"2025-12-08"</span>);

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"date1 instanceof Date:"</span>, date1 <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">Date</span>); <span class="hljs-comment">// true</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"date2 instanceof Date:"</span>, date2 <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">Date</span>); <span class="hljs-comment">// true</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"date1.toISOString():"</span>, date1.<span class="hljs-title function_">toISOString</span>()); <span class="hljs-comment">// 2025-12-08T00:00:00.000Z</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"date2.toISOString():"</span>, date2.<span class="hljs-title function_">toISOString</span>()); <span class="hljs-comment">// 2025-12-08T00:00:00.000Z</span>

<span class="hljs-comment">// æµ‹è¯•é”™è¯¯æƒ…å†µ</span>
<span class="hljs-keyword">try</span> {
  <span class="hljs-title function_">myNewComplete</span>(<span class="hljs-literal">null</span>);
} <span class="hljs-keyword">catch</span> (error) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"é”™è¯¯æµ‹è¯•1 - null:"</span>, error.<span class="hljs-property">message</span>); <span class="hljs-comment">// Constructor must be a function</span>
}

<span class="hljs-keyword">try</span> {
  <span class="hljs-title function_">myNewComplete</span>(<span class="hljs-number">42</span>);
} <span class="hljs-keyword">catch</span> (error) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"é”™è¯¯æµ‹è¯•2 - æ•°å­—:"</span>, error.<span class="hljs-property">message</span>); <span class="hljs-comment">// Constructor must be a function</span>
}

<span class="hljs-keyword">try</span> {
  <span class="hljs-title function_">myNewComplete</span>(<span class="hljs-string">"string"</span>);
} <span class="hljs-keyword">catch</span> (error) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"é”™è¯¯æµ‹è¯•3 - å­—ç¬¦ä¸²:"</span>, error.<span class="hljs-property">message</span>); <span class="hljs-comment">// Constructor must be a function</span>
}
</code></pre>
<h4 data-id="heading-9">ä¸‰ã€instanceofçš„æ·±å…¥ç†è§£</h4>
<h5 data-id="heading-10">3.1 instanceofæ“ä½œç¬¦çš„ä½œç”¨</h5>
<p><code>instanceof</code>æ“ä½œç¬¦ç”¨äºæ£€æµ‹æ„é€ å‡½æ•°çš„<code>prototype</code>å±æ€§æ˜¯å¦å‡ºç°åœ¨æŸä¸ªå®ä¾‹å¯¹è±¡çš„åŸå‹é“¾ä¸Šã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">Animal</span>(<span class="hljs-params"/>) {}
<span class="hljs-keyword">function</span> <span class="hljs-title function_">Dog</span>(<span class="hljs-params"/>) {}

<span class="hljs-title class_">Dog</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span> = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">create</span>(<span class="hljs-title class_">Animal</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>);
<span class="hljs-title class_">Dog</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">constructor</span> = <span class="hljs-title class_">Dog</span>;

<span class="hljs-keyword">const</span> dog = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Dog</span>();
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(dog <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">Dog</span>); <span class="hljs-comment">// true</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(dog <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">Animal</span>); <span class="hljs-comment">// true</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(dog <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">Object</span>); <span class="hljs-comment">// true</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(dog <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">Array</span>); <span class="hljs-comment">// false</span>
</code></pre>
<h5 data-id="heading-11">3.2 instanceofçš„å·¥ä½œåŸç†</h5>
<p><code>instanceof</code>æ“ä½œç¬¦çš„ç®—æ³•å¯ä»¥æè¿°ä¸º:</p>
<ol>
<li>è·å–å³ä¾§æ“ä½œæ•°çš„<code>prototype</code>å±æ€§</li>
<li>è·å–å·¦ä¾§æ“ä½œæ•°çš„<code>[[Prototype]]</code>é“¾(å³<code>__proto__</code>é“¾)</li>
<li>æ²¿ç€åŸå‹é“¾å‘ä¸ŠæŸ¥æ‰¾, å¦‚æœæ‰¾åˆ°ä¸å³ä¾§<code>prototype</code>ç›¸åŒçš„å¯¹è±¡, è¿”å›<code>true</code></li>
<li>å¦‚æœåˆ°è¾¾åŸå‹é“¾æœ«ç«¯(<code>null</code>)ä»æœªæ‰¾åˆ°, è¿”å›<code>false</code></li>
</ol>
<h4 data-id="heading-12">å››ã€æ‰‹å†™ instanceof æ“ä½œç¬¦</h4>
<h5 data-id="heading-13">4.1 åŸºç¡€å®ç°</h5>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">/**
 * æ‰‹å†™ instanceof æ“ä½œç¬¦
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">any</span>} instance éœ€è¦æ£€æµ‹çš„å¯¹è±¡
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">Function</span>} Constructor æ„é€ å‡½æ•°
 * <span class="hljs-doctag">@returns</span> {<span class="hljs-type">boolean</span>} æ£€æµ‹ç»“æœ
 */</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">myInstanceof</span>(<span class="hljs-params">instance, Constructor</span>) {
  <span class="hljs-comment">// åŸºæœ¬ç±»å‹ç›´æ¥è¿”å›false</span>
  <span class="hljs-keyword">if</span> (
    instance === <span class="hljs-literal">null</span> ||
    (<span class="hljs-keyword">typeof</span> instance !== <span class="hljs-string">"object"</span> &amp;&amp; <span class="hljs-keyword">typeof</span> instance !== <span class="hljs-string">"function"</span>)
  ) {
    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
  }

  <span class="hljs-comment">// è·å–æ„é€ å‡½æ•°çš„ prototype</span>
  <span class="hljs-keyword">const</span> prototype = <span class="hljs-title class_">Constructor</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>;

  <span class="hljs-comment">// è·å–å®ä¾‹çš„åŸå‹</span>
  <span class="hljs-keyword">let</span> proto = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">getPrototypeOf</span>(instance);

  <span class="hljs-comment">// æ²¿ç€åŸå‹é“¾å‘ä¸ŠæŸ¥æ‰¾</span>
  <span class="hljs-keyword">while</span> (proto !== <span class="hljs-literal">null</span>) {
    <span class="hljs-keyword">if</span> (proto === prototype) {
      <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
    }
    proto = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">getPrototypeOf</span>(proto);
  }

  <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
}

<span class="hljs-comment">// æµ‹è¯•åŸºç¡€åŠŸèƒ½</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">Animal</span>(<span class="hljs-params"/>) {}
<span class="hljs-keyword">function</span> <span class="hljs-title function_">Dog</span>(<span class="hljs-params"/>) {}
<span class="hljs-keyword">function</span> <span class="hljs-title function_">Cat</span>(<span class="hljs-params"/>) {}

<span class="hljs-title class_">Dog</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span> = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">create</span>(<span class="hljs-title class_">Animal</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>);
<span class="hljs-title class_">Dog</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">constructor</span> = <span class="hljs-title class_">Dog</span>;

<span class="hljs-keyword">const</span> dog = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Dog</span>();
<span class="hljs-keyword">const</span> cat = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Cat</span>();

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"=== æµ‹è¯• myInstanceof ==="</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"dog instanceof Dog:"</span>, <span class="hljs-title function_">myInstanceof</span>(dog, <span class="hljs-title class_">Dog</span>)); <span class="hljs-comment">// true</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"dog instanceof Animal:"</span>, <span class="hljs-title function_">myInstanceof</span>(dog, <span class="hljs-title class_">Animal</span>)); <span class="hljs-comment">// true</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"dog instanceof Object:"</span>, <span class="hljs-title function_">myInstanceof</span>(dog, <span class="hljs-title class_">Object</span>)); <span class="hljs-comment">// true</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"dog instanceof Cat:"</span>, <span class="hljs-title function_">myInstanceof</span>(dog, <span class="hljs-title class_">Cat</span>)); <span class="hljs-comment">// false</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"cat instanceof Dog:"</span>, <span class="hljs-title function_">myInstanceof</span>(cat, <span class="hljs-title class_">Dog</span>)); <span class="hljs-comment">// false</span>
</code></pre>
<h5 data-id="heading-14">4.2 å®Œæ•´å®ç°(å¤„ç†è¾¹ç•Œæƒ…å†µ)</h5>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">/**
 * å®Œæ•´ç‰ˆ myInstanceof å®ç°
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">any</span>} instance è¦æ£€æµ‹çš„å¯¹è±¡
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">Function</span>} Constructor æ„é€ å‡½æ•°
 * <span class="hljs-doctag">@returns</span> {<span class="hljs-type">boolean</span>} æ£€æµ‹ç»“æœ
 */</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">myInstanceofComplete</span>(<span class="hljs-params">instance, Constructor</span>) {
    <span class="hljs-comment">// å‚æ•°éªŒè¯</span>
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> <span class="hljs-title class_">Constructor</span> !== <span class="hljs-string">'function'</span>) {
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TypeError</span>(<span class="hljs-string">'Right-hand side of instanceof is not callable'</span>);
    }
    
    <span class="hljs-comment">// åŸºæœ¬ç±»å‹ç›´æ¥è¿”å› false</span>
    <span class="hljs-comment">// æ³¨æ„ï¼šnull å’Œ undefined è¿”å› false</span>
    <span class="hljs-keyword">if</span> (instance === <span class="hljs-literal">null</span> || instance === <span class="hljs-literal">undefined</span>) {
        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
    }
    
    <span class="hljs-comment">// å¯¹äºéå¯¹è±¡ç±»å‹ï¼Œé™¤äº† function å¤–éƒ½è¿”å› false</span>
    <span class="hljs-keyword">const</span> type = <span class="hljs-keyword">typeof</span> instance;
    <span class="hljs-keyword">if</span> (type !== <span class="hljs-string">'object'</span> &amp;&amp; type !== <span class="hljs-string">'function'</span>) {
        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
    }
    
    <span class="hljs-comment">// è·å–æ„é€ å‡½æ•°çš„ prototype</span>
    <span class="hljs-keyword">const</span> prototype = <span class="hljs-title class_">Constructor</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>;
    
    <span class="hljs-comment">// å¦‚æœæ„é€ å‡½æ•°çš„ prototype ä¸æ˜¯å¯¹è±¡ï¼ŒæŠ›å‡ºé”™è¯¯</span>
    <span class="hljs-keyword">if</span> (prototype === <span class="hljs-literal">null</span> || <span class="hljs-keyword">typeof</span> prototype !== <span class="hljs-string">'object'</span>) {
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TypeError</span>(<span class="hljs-string">'Function has non-object prototype in instanceof check'</span>);
    }
    
    <span class="hljs-comment">// è·å–å®ä¾‹çš„åŸå‹</span>
    <span class="hljs-keyword">let</span> proto = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">getPrototypeOf</span>(instance);
    
    <span class="hljs-comment">// æ²¿ç€åŸå‹é“¾å‘ä¸ŠæŸ¥æ‰¾</span>
    <span class="hljs-keyword">while</span> (proto !== <span class="hljs-literal">null</span>) {
        <span class="hljs-keyword">if</span> (proto === prototype) {
            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
        }
        proto = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">getPrototypeOf</span>(proto);
    }
    
    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
}

<span class="hljs-comment">// æµ‹è¯•å®Œæ•´åŠŸèƒ½</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'=== æµ‹è¯• myInstanceofComplete ==='</span>);

<span class="hljs-comment">// æµ‹è¯•1: åŸºæœ¬ç±»å‹</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'æµ‹è¯•1 - æ•°å­—:'</span>, <span class="hljs-title function_">myInstanceofComplete</span>(<span class="hljs-number">42</span>, <span class="hljs-title class_">Number</span>));         <span class="hljs-comment">// false</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'æµ‹è¯•1 - å­—ç¬¦ä¸²:'</span>, <span class="hljs-title function_">myInstanceofComplete</span>(<span class="hljs-string">'hello'</span>, <span class="hljs-title class_">String</span>));  <span class="hljs-comment">// false</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'æµ‹è¯•1 - å¸ƒå°”å€¼:'</span>, <span class="hljs-title function_">myInstanceofComplete</span>(<span class="hljs-literal">true</span>, <span class="hljs-title class_">Boolean</span>));    <span class="hljs-comment">// false</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'æµ‹è¯•1 - null:'</span>, <span class="hljs-title function_">myInstanceofComplete</span>(<span class="hljs-literal">null</span>, <span class="hljs-title class_">Object</span>));       <span class="hljs-comment">// false</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'æµ‹è¯•1 - undefined:'</span>, <span class="hljs-title function_">myInstanceofComplete</span>(<span class="hljs-literal">undefined</span>, <span class="hljs-title class_">Object</span>)); <span class="hljs-comment">// false</span>

<span class="hljs-comment">// æµ‹è¯•2: å¯¹è±¡ç±»å‹</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">Person</span>(<span class="hljs-params"/>) {}
<span class="hljs-keyword">const</span> person = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Person</span>();
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'æµ‹è¯•2 - å¯¹è±¡:'</span>, <span class="hljs-title function_">myInstanceofComplete</span>(person, <span class="hljs-title class_">Person</span>));     <span class="hljs-comment">// true</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'æµ‹è¯•2 - å¯¹è±¡ instanceof Object:'</span>, <span class="hljs-title function_">myInstanceofComplete</span>(person, <span class="hljs-title class_">Object</span>)); <span class="hljs-comment">// true</span>

<span class="hljs-comment">// æµ‹è¯•3: æ•°ç»„</span>
<span class="hljs-keyword">const</span> arr = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>];
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'æµ‹è¯•3 - æ•°ç»„:'</span>, <span class="hljs-title function_">myInstanceofComplete</span>(arr, <span class="hljs-title class_">Array</span>));         <span class="hljs-comment">// true</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'æµ‹è¯•3 - æ•°ç»„ instanceof Object:'</span>, <span class="hljs-title function_">myInstanceofComplete</span>(arr, <span class="hljs-title class_">Object</span>)); <span class="hljs-comment">// true</span>

<span class="hljs-comment">// æµ‹è¯•4: å‡½æ•°</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">testFunc</span>(<span class="hljs-params"/>) {}
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'æµ‹è¯•4 - å‡½æ•°:'</span>, <span class="hljs-title function_">myInstanceofComplete</span>(testFunc, <span class="hljs-title class_">Function</span>)); <span class="hljs-comment">// true</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'æµ‹è¯•4 - å‡½æ•° instanceof Object:'</span>, <span class="hljs-title function_">myInstanceofComplete</span>(testFunc, <span class="hljs-title class_">Object</span>)); <span class="hljs-comment">// true</span>

<span class="hljs-comment">// æµ‹è¯•5: å†…ç½®å¯¹è±¡</span>
<span class="hljs-keyword">const</span> date = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>();
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'æµ‹è¯•5 - Date:'</span>, <span class="hljs-title function_">myInstanceofComplete</span>(date, <span class="hljs-title class_">Date</span>));         <span class="hljs-comment">// true</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'æµ‹è¯•5 - Date instanceof Object:'</span>, <span class="hljs-title function_">myInstanceofComplete</span>(date, <span class="hljs-title class_">Object</span>)); <span class="hljs-comment">// true</span>

<span class="hljs-comment">// æµ‹è¯•6: åŸå‹é“¾ç»§æ‰¿</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">Animal</span>(<span class="hljs-params"/>) {}
<span class="hljs-keyword">function</span> <span class="hljs-title function_">Dog</span>(<span class="hljs-params"/>) {}
<span class="hljs-title class_">Dog</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span> = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">create</span>(<span class="hljs-title class_">Animal</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>);
<span class="hljs-title class_">Dog</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">constructor</span> = <span class="hljs-title class_">Dog</span>;

<span class="hljs-keyword">const</span> dog = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Dog</span>();
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'æµ‹è¯•6 - åŸå‹é“¾:'</span>, <span class="hljs-title function_">myInstanceofComplete</span>(dog, <span class="hljs-title class_">Dog</span>));         <span class="hljs-comment">// true</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'æµ‹è¯•6 - åŸå‹é“¾:'</span>, <span class="hljs-title function_">myInstanceofComplete</span>(dog, <span class="hljs-title class_">Animal</span>));      <span class="hljs-comment">// true</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'æµ‹è¯•6 - åŸå‹é“¾:'</span>, <span class="hljs-title function_">myInstanceofComplete</span>(dog, <span class="hljs-title class_">Object</span>));      <span class="hljs-comment">// true</span>

<span class="hljs-comment">// æµ‹è¯•7: é”™è¯¯æƒ…å†µ</span>
<span class="hljs-keyword">try</span> {
    <span class="hljs-title function_">myInstanceofComplete</span>({}, <span class="hljs-literal">null</span>);
} <span class="hljs-keyword">catch</span> (error) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'æµ‹è¯•7 - éå‡½æ•°:'</span>, error.<span class="hljs-property">message</span>); <span class="hljs-comment">// 'Right-hand side of instanceof is not callable'</span>
}

<span class="hljs-keyword">try</span> {
    <span class="hljs-title function_">myInstanceofComplete</span>({}, {<span class="hljs-attr">prototype</span>: <span class="hljs-literal">null</span>});
} <span class="hljs-keyword">catch</span> (error) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'æµ‹è¯•7 - éå‡½æ•°2:'</span>, error.<span class="hljs-property">message</span>); <span class="hljs-comment">// 'Right-hand side of instanceof is not callable'</span>
}
</code></pre>
<h5 data-id="heading-15">4.3 æµ‹è¯•ç”¨ä¾‹</h5>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'=== å®Œæ•´æµ‹è¯•ç”¨ä¾‹ ==='</span>);

<span class="hljs-comment">// å¤æ‚åŸå‹é“¾æµ‹è¯•</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">GrandParent</span>(<span class="hljs-params"/>) {}
<span class="hljs-keyword">function</span> <span class="hljs-title function_">Parent</span>(<span class="hljs-params"/>) {}
<span class="hljs-keyword">function</span> <span class="hljs-title function_">Child</span>(<span class="hljs-params"/>) {}

<span class="hljs-title class_">Parent</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span> = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">create</span>(<span class="hljs-title class_">GrandParent</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>);
<span class="hljs-title class_">Parent</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">constructor</span> = <span class="hljs-title class_">Parent</span>;

<span class="hljs-title class_">Child</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span> = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">create</span>(<span class="hljs-title class_">Parent</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>);
<span class="hljs-title class_">Child</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">constructor</span> = <span class="hljs-title class_">Child</span>;

<span class="hljs-keyword">const</span> child = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Child</span>();

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'åŸå‹é“¾æµ‹è¯• - child instanceof Child:'</span>, <span class="hljs-title function_">myInstanceofComplete</span>(child, <span class="hljs-title class_">Child</span>)); <span class="hljs-comment">// true</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'åŸå‹é“¾æµ‹è¯• - child instanceof Parent:'</span>, <span class="hljs-title function_">myInstanceofComplete</span>(child, <span class="hljs-title class_">Parent</span>)); <span class="hljs-comment">// true</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'åŸå‹é“¾æµ‹è¯• - child instanceof GrandParent:'</span>, <span class="hljs-title function_">myInstanceofComplete</span>(child, <span class="hljs-title class_">GrandParent</span>)); <span class="hljs-comment">// true</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'åŸå‹é“¾æµ‹è¯• - child instanceof Object:'</span>, <span class="hljs-title function_">myInstanceofComplete</span>(child, <span class="hljs-title class_">Object</span>)); <span class="hljs-comment">// true</span>

<span class="hljs-comment">// Symbol.hasInstance æµ‹è¯•</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">CustomClass</span> {
    <span class="hljs-keyword">static</span> [<span class="hljs-title class_">Symbol</span>.<span class="hljs-property">hasInstance</span>](instance) {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">typeof</span> instance === <span class="hljs-string">'object'</span> &amp;&amp; instance.<span class="hljs-property">isCustom</span> === <span class="hljs-literal">true</span>;
    }
}

<span class="hljs-keyword">const</span> customObj = { <span class="hljs-attr">isCustom</span>: <span class="hljs-literal">true</span> };
<span class="hljs-keyword">const</span> notCustomObj = { <span class="hljs-attr">isCustom</span>: <span class="hljs-literal">false</span> };

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'Symbol.hasInstance æµ‹è¯• - è‡ªå®šä¹‰å¯¹è±¡:'</span>, <span class="hljs-title function_">myInstanceofComplete</span>(customObj, <span class="hljs-title class_">CustomClass</span>)); <span class="hljs-comment">// true</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'Symbol.hasInstance æµ‹è¯• - éè‡ªå®šä¹‰å¯¹è±¡:'</span>, <span class="hljs-title function_">myInstanceofComplete</span>(notCustomObj, <span class="hljs-title class_">CustomClass</span>)); <span class="hljs-comment">// false</span>

<span class="hljs-comment">// è¾¹ç•Œæƒ…å†µï¼šObject.create(null)</span>
<span class="hljs-keyword">const</span> objWithoutProto = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">create</span>(<span class="hljs-literal">null</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'Object.create(null) æµ‹è¯•:'</span>, <span class="hljs-title function_">myInstanceofComplete</span>(objWithoutProto, <span class="hljs-title class_">Object</span>)); <span class="hljs-comment">// false</span>

<span class="hljs-comment">// è¾¹ç•Œæƒ…å†µï¼šä¿®æ”¹åŸå‹é“¾</span>
<span class="hljs-keyword">const</span> obj = {};
<span class="hljs-title class_">Object</span>.<span class="hljs-title function_">setPrototypeOf</span>(obj, <span class="hljs-title class_">Array</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'ä¿®æ”¹åŸå‹é“¾æµ‹è¯•:'</span>, <span class="hljs-title function_">myInstanceofComplete</span>(obj, <span class="hljs-title class_">Array</span>)); <span class="hljs-comment">// true</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'ä¿®æ”¹åŸå‹é“¾æµ‹è¯•:'</span>, <span class="hljs-title function_">myInstanceofComplete</span>(obj, <span class="hljs-title class_">Object</span>)); <span class="hljs-comment">// true</span>

<span class="hljs-comment">// è¾¹ç•Œæƒ…å†µï¼šå¾ªç¯å¼•ç”¨ï¼ˆåº”é¿å…è¿™ç§æƒ…å†µï¼‰</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">A</span>(<span class="hljs-params"/>) {}
<span class="hljs-keyword">function</span> <span class="hljs-title function_">B</span>(<span class="hljs-params"/>) {}

<span class="hljs-comment">// è®¾ç½®å¾ªç¯åŸå‹é“¾ï¼ˆä¸æ¨èï¼Œä»…ç”¨äºæµ‹è¯•ï¼‰</span>
<span class="hljs-keyword">const</span> a = <span class="hljs-keyword">new</span> <span class="hljs-title function_">A</span>();
<span class="hljs-keyword">const</span> b = <span class="hljs-keyword">new</span> <span class="hljs-title function_">B</span>();

<span class="hljs-comment">// æ³¨æ„ï¼šå®é™…ä¸­ä¸è¦è¿™æ ·åšï¼Œè¿™é‡Œåªæ˜¯ä¸ºäº†æµ‹è¯•</span>
<span class="hljs-title class_">Object</span>.<span class="hljs-title function_">setPrototypeOf</span>(A.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>, B.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>);
<span class="hljs-title class_">Object</span>.<span class="hljs-title function_">setPrototypeOf</span>(B.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>, A.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>);

<span class="hljs-keyword">try</span> {
    <span class="hljs-comment">// è¿™é‡Œå¯èƒ½ä¼šé™·å…¥æ— é™å¾ªç¯ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦æœ‰ä¿æŠ¤æœºåˆ¶</span>
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'å¾ªç¯å¼•ç”¨æµ‹è¯•:'</span>, <span class="hljs-title function_">myInstanceofComplete</span>(a, B));
} <span class="hljs-keyword">catch</span> (error) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'å¾ªç¯å¼•ç”¨æµ‹è¯• - æ•è·é”™è¯¯:'</span>, error.<span class="hljs-property">message</span>);
}
</code></pre>
<h4 data-id="heading-16">äº”ã€newå’Œinstanceofçš„ç»¼åˆåº”ç”¨</h4>
<h5 data-id="heading-17">5.1 å®ç°ä¸€ä¸ªç»§æ‰¿ç³»ç»Ÿ</h5>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// ä½¿ç”¨ new å’Œ instanceof å®ç°å®Œæ•´çš„ç»§æ‰¿ç³»ç»Ÿ</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">inherit</span>(<span class="hljs-params">Child, Parent</span>) {
  <span class="hljs-comment">// 1. åˆ›å»ºä¸­é—´æ„é€ å‡½æ•°ï¼Œé¿å…ç›´æ¥ä¿®æ”¹ Child.prototype</span>
  <span class="hljs-keyword">const</span> <span class="hljs-title class_">Temp</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params"/>) {};
  <span class="hljs-title class_">Temp</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span> = <span class="hljs-title class_">Parent</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>;

  <span class="hljs-comment">// 2. è®¾ç½® Child çš„åŸå‹ä¸º Parent çš„å®ä¾‹</span>
  <span class="hljs-title class_">Child</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Temp</span>();

  <span class="hljs-comment">// 3. ä¿®å¤ constructor æŒ‡å‘</span>
  <span class="hljs-title class_">Child</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">constructor</span> = <span class="hljs-title class_">Child</span>;

  <span class="hljs-comment">// 4. è®¾ç½® superClass å¼•ç”¨ï¼Œä¾¿äºè°ƒç”¨çˆ¶ç±»æ–¹æ³•</span>
  <span class="hljs-title class_">Child</span>.<span class="hljs-property">superClass</span> = <span class="hljs-title class_">Parent</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>;

  <span class="hljs-comment">// 5. å¦‚æœçˆ¶ç±»çš„åŸå‹æ˜¯ Objectï¼Œéœ€è¦é¢å¤–å¤„ç†</span>
  <span class="hljs-keyword">if</span> (<span class="hljs-title class_">Parent</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">constructor</span> === <span class="hljs-title class_">Object</span>) {
    <span class="hljs-title class_">Parent</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">constructor</span> = <span class="hljs-title class_">Parent</span>;
  }
}

<span class="hljs-comment">// æµ‹è¯•ç»§æ‰¿ç³»ç»Ÿ</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">Shape</span>(<span class="hljs-params">color</span>) {
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">color</span> = color;
}

<span class="hljs-title class_">Shape</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">getColor</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params"/>) {
  <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">color</span>;
};

<span class="hljs-title class_">Shape</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">getArea</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params"/>) {
  <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">"getArea() must be implemented by subclasses"</span>);
};

<span class="hljs-keyword">function</span> <span class="hljs-title function_">Circle</span>(<span class="hljs-params">color, radius</span>) {
  <span class="hljs-comment">// è°ƒç”¨çˆ¶ç±»æ„é€ å‡½æ•°</span>
  <span class="hljs-title class_">Shape</span>.<span class="hljs-title function_">call</span>(<span class="hljs-variable language_">this</span>, color);
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">radius</span> = radius;
}

<span class="hljs-comment">// ç»§æ‰¿ Shape</span>
<span class="hljs-title function_">inherit</span>(<span class="hljs-title class_">Circle</span>, <span class="hljs-title class_">Shape</span>);

<span class="hljs-comment">// æ·»åŠ å­ç±»æ–¹æ³•</span>
<span class="hljs-title class_">Circle</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">getArea</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params"/>) {
  <span class="hljs-keyword">return</span> <span class="hljs-title class_">Math</span>.<span class="hljs-property">PI</span> * <span class="hljs-variable language_">this</span>.<span class="hljs-property">radius</span> * <span class="hljs-variable language_">this</span>.<span class="hljs-property">radius</span>;
};

<span class="hljs-title class_">Circle</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">getCircumference</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params"/>) {
  <span class="hljs-keyword">return</span> <span class="hljs-number">2</span> * <span class="hljs-title class_">Math</span>.<span class="hljs-property">PI</span> * <span class="hljs-variable language_">this</span>.<span class="hljs-property">radius</span>;
};

<span class="hljs-comment">// æµ‹è¯•</span>
<span class="hljs-keyword">const</span> circle = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Circle</span>(<span class="hljs-string">"red"</span>, <span class="hljs-number">5</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"ç»§æ‰¿æµ‹è¯• - color:"</span>, circle.<span class="hljs-title function_">getColor</span>()); <span class="hljs-comment">// red</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"ç»§æ‰¿æµ‹è¯• - area:"</span>, circle.<span class="hljs-title function_">getArea</span>().<span class="hljs-title function_">toFixed</span>(<span class="hljs-number">2</span>)); <span class="hljs-comment">// 78.54</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"ç»§æ‰¿æµ‹è¯• - circumference:"</span>, circle.<span class="hljs-title function_">getCircumference</span>().<span class="hljs-title function_">toFixed</span>(<span class="hljs-number">2</span>)); <span class="hljs-comment">// 31.42</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"ç»§æ‰¿æµ‹è¯• - instanceof Circle:"</span>, circle <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">Circle</span>); <span class="hljs-comment">// true</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"ç»§æ‰¿æµ‹è¯• - instanceof Shape:"</span>, circle <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">Shape</span>); <span class="hljs-comment">// true</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"ç»§æ‰¿æµ‹è¯• - instanceof Object:"</span>, circle <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">Object</span>); <span class="hljs-comment">// true</span>
</code></pre>
<h5 data-id="heading-18">5.2 å®ç°å¤šæ€æ£€æµ‹</h5>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// ä½¿ç”¨ instanceof å®ç°å¤šæ€ç±»å‹æ£€æµ‹</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">Animal</span> {
    <span class="hljs-title function_">constructor</span>(<span class="hljs-params">name</span>) {
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = name;
    }
    
    <span class="hljs-title function_">speak</span>(<span class="hljs-params"/>) {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.name}</span> makes a noise.`</span>);
    }
}

<span class="hljs-keyword">class</span> <span class="hljs-title class_">Dog</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">Animal</span> {
    <span class="hljs-title function_">speak</span>(<span class="hljs-params"/>) {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.name}</span> barks.`</span>);
    }
}

<span class="hljs-keyword">class</span> <span class="hljs-title class_">Cat</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">Animal</span> {
    <span class="hljs-title function_">speak</span>(<span class="hljs-params"/>) {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.name}</span> meows.`</span>);
    }
}

<span class="hljs-keyword">class</span> <span class="hljs-title class_">Bird</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">Animal</span> {
    <span class="hljs-title function_">speak</span>(<span class="hljs-params"/>) {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.name}</span> chirps.`</span>);
    }
}

<span class="hljs-comment">// å¤šæ€å¤„ç†å™¨</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">AnimalHandler</span> {
    <span class="hljs-keyword">static</span> <span class="hljs-title function_">handle</span>(<span class="hljs-params">animal</span>) {
        <span class="hljs-keyword">if</span> (animal <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">Dog</span>) {
            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`Handling a dog named <span class="hljs-subst">${animal.name}</span>`</span>);
            animal.<span class="hljs-title function_">speak</span>();
            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'Taking the dog for a walk...'</span>);
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (animal <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">Cat</span>) {
            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`Handling a cat named <span class="hljs-subst">${animal.name}</span>`</span>);
            animal.<span class="hljs-title function_">speak</span>();
            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'Giving the cat some milk...'</span>);
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (animal <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">Bird</span>) {
            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`Handling a bird named <span class="hljs-subst">${animal.name}</span>`</span>);
            animal.<span class="hljs-title function_">speak</span>();
            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'Letting the bird fly...'</span>);
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (animal <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">Animal</span>) {
            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`Handling an unknown animal named <span class="hljs-subst">${animal.name}</span>`</span>);
            animal.<span class="hljs-title function_">speak</span>();
            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'Providing general care...'</span>);
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'Not an animal!'</span>);
        }
    }
}

<span class="hljs-comment">// æµ‹è¯•å¤šæ€</span>
<span class="hljs-keyword">const</span> animals = [
    <span class="hljs-keyword">new</span> <span class="hljs-title class_">Dog</span>(<span class="hljs-string">'Rex'</span>),
    <span class="hljs-keyword">new</span> <span class="hljs-title class_">Cat</span>(<span class="hljs-string">'Whiskers'</span>),
    <span class="hljs-keyword">new</span> <span class="hljs-title class_">Bird</span>(<span class="hljs-string">'Tweety'</span>),
    <span class="hljs-keyword">new</span> <span class="hljs-title class_">Animal</span>(<span class="hljs-string">'Generic'</span>),
    { <span class="hljs-attr">name</span>: <span class="hljs-string">'Not an animal'</span> }
];

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'=== å¤šæ€å¤„ç†æµ‹è¯• ==='</span>);
animals.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">animal</span> =&gt;</span> {
    <span class="hljs-title class_">AnimalHandler</span>.<span class="hljs-title function_">handle</span>(animal);
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'---'</span>);
});
</code></pre>
<h4 data-id="heading-19">å…­ã€å¸¸è§é¢è¯•é¢˜</h4>
<h5 data-id="heading-20">6.1 å®ç°Object.create()</h5>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">/**
 * æ‰‹å†™ Object.create()
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">Object</span>} proto æ–°åˆ›å»ºå¯¹è±¡çš„åŸå‹å¯¹è±¡
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">Object</span>} propertiesObject å¯é€‰ï¼ŒåŒ…å«å±æ€§æè¿°ç¬¦çš„å¯¹è±¡
 * <span class="hljs-doctag">@returns</span> {<span class="hljs-type">Object</span>} æ–°å¯¹è±¡
 */</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">myObjectCreate</span>(<span class="hljs-params">proto, propertiesObject</span>) {
    <span class="hljs-comment">// å‚æ•°éªŒè¯</span>
    <span class="hljs-keyword">if</span> (proto !== <span class="hljs-literal">null</span> &amp;&amp; <span class="hljs-keyword">typeof</span> proto !== <span class="hljs-string">'object'</span> &amp;&amp; <span class="hljs-keyword">typeof</span> proto !== <span class="hljs-string">'function'</span>) {
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TypeError</span>(<span class="hljs-string">'Object prototype may only be an Object or null'</span>);
    }
    
    <span class="hljs-comment">// åˆ›å»ºä¸€ä¸ªç©ºæ„é€ å‡½æ•°</span>
    <span class="hljs-keyword">function</span> <span class="hljs-title function_">Temp</span>(<span class="hljs-params"/>) {}
    
    <span class="hljs-comment">// è®¾ç½®æ„é€ å‡½æ•°çš„åŸå‹</span>
    <span class="hljs-title class_">Temp</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span> = proto;
    
    <span class="hljs-comment">// åˆ›å»ºæ–°å¯¹è±¡</span>
    <span class="hljs-keyword">const</span> obj = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Temp</span>();
    
    <span class="hljs-comment">// å¦‚æœ proto æ˜¯ nullï¼Œæ‰‹åŠ¨è®¾ç½®åŸå‹ä¸º null</span>
    <span class="hljs-keyword">if</span> (proto === <span class="hljs-literal">null</span>) {
        <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">setPrototypeOf</span>(obj, <span class="hljs-literal">null</span>);
    }
    
    <span class="hljs-comment">// å¤„ç†ç¬¬äºŒä¸ªå‚æ•°</span>
    <span class="hljs-keyword">if</span> (propertiesObject !== <span class="hljs-literal">undefined</span>) {
        <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">defineProperties</span>(obj, propertiesObject);
    }
    
    <span class="hljs-keyword">return</span> obj;
}

<span class="hljs-comment">// æµ‹è¯• myObjectCreate</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'=== æµ‹è¯• myObjectCreate ==='</span>);

<span class="hljs-comment">// æµ‹è¯•1: åŸºæœ¬åŠŸèƒ½</span>
<span class="hljs-keyword">const</span> proto = { <span class="hljs-attr">x</span>: <span class="hljs-number">10</span>, <span class="hljs-attr">y</span>: <span class="hljs-number">20</span> };
<span class="hljs-keyword">const</span> obj1 = <span class="hljs-title function_">myObjectCreate</span>(proto);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'æµ‹è¯•1 - åŸå‹é“¾:'</span>, <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">getPrototypeOf</span>(obj1) === proto); <span class="hljs-comment">// true</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'æµ‹è¯•1 - ç»§æ‰¿å±æ€§:'</span>, obj1.<span class="hljs-property">x</span>, obj1.<span class="hljs-property">y</span>); <span class="hljs-comment">// 10, 20</span>

<span class="hljs-comment">// æµ‹è¯•2: null åŸå‹</span>
<span class="hljs-keyword">const</span> obj2 = <span class="hljs-title function_">myObjectCreate</span>(<span class="hljs-literal">null</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'æµ‹è¯•2 - null åŸå‹:'</span>, <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">getPrototypeOf</span>(obj2)); <span class="hljs-comment">// null</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'æµ‹è¯•2 - æ²¡æœ‰ toString:'</span>, obj2.<span class="hljs-property">toString</span> === <span class="hljs-literal">undefined</span>); <span class="hljs-comment">// true</span>

<span class="hljs-comment">// æµ‹è¯•3: å±æ€§æè¿°ç¬¦</span>
<span class="hljs-keyword">const</span> obj3 = <span class="hljs-title function_">myObjectCreate</span>({}, {
    <span class="hljs-attr">value</span>: {
        <span class="hljs-attr">value</span>: <span class="hljs-number">42</span>,
        <span class="hljs-attr">writable</span>: <span class="hljs-literal">false</span>,
        <span class="hljs-attr">enumerable</span>: <span class="hljs-literal">true</span>,
        <span class="hljs-attr">configurable</span>: <span class="hljs-literal">true</span>
    }
});
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'æµ‹è¯•3 - å±æ€§æè¿°ç¬¦:'</span>, obj3.<span class="hljs-property">value</span>); <span class="hljs-comment">// 42</span>
obj3.<span class="hljs-property">value</span> = <span class="hljs-number">100</span>;
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'æµ‹è¯•3 - ä¸å¯å†™:'</span>, obj3.<span class="hljs-property">value</span>); <span class="hljs-comment">// 42 (ä¸å¯å†™)</span>

<span class="hljs-comment">// æµ‹è¯•4: ä¸åŸç”Ÿ Object.create æ¯”è¾ƒ</span>
<span class="hljs-keyword">const</span> nativeObj = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">create</span>(proto);
<span class="hljs-keyword">const</span> myObj = <span class="hljs-title function_">myObjectCreate</span>(proto);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'æµ‹è¯•4 - åŸç”Ÿ vs æ‰‹å†™:'</span>, 
    <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">getPrototypeOf</span>(nativeObj) === <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">getPrototypeOf</span>(myObj)); <span class="hljs-comment">// true</span>
</code></pre>
<h5 data-id="heading-21">6.2 å®ç°Object.getPrototypeOf()</h5>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">/**
 * æ‰‹å†™ Object.getPrototypeOf()
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">Object</span>} obj è¦è·å–åŸå‹çš„å¯¹è±¡
 * <span class="hljs-doctag">@returns</span> {<span class="hljs-type">Object | null</span>} å¯¹è±¡çš„åŸå‹
 */</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">myGetPrototypeOf</span>(<span class="hljs-params">obj</span>) {
  <span class="hljs-comment">// å‚æ•°éªŒè¯</span>
  <span class="hljs-keyword">if</span> (obj === <span class="hljs-literal">null</span> || obj === <span class="hljs-literal">undefined</span>) {
    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TypeError</span>(<span class="hljs-string">"Cannot convert undefined or null to object"</span>);
  }

  <span class="hljs-comment">// ä½¿ç”¨ __proto__ è®¿é—®å™¨(éæ ‡å‡†ï¼Œä½†å¹¿æ³›æ”¯æŒ)</span>
  <span class="hljs-comment">// æ³¨æ„: å®é™…ä¸­æ›´æ¨èä½¿ç”¨ Object.getPrototypeOf</span>
  <span class="hljs-keyword">if</span> (<span class="hljs-string">"__proto__"</span> <span class="hljs-keyword">in</span> obj) {
    <span class="hljs-keyword">return</span> obj.<span class="hljs-property">__proto__</span>;
  }

  <span class="hljs-comment">// å¯¹äºä¸æ”¯æŒ __proto__ çš„ç¯å¢ƒï¼Œä½¿ç”¨ Constructor å±æ€§</span>
  <span class="hljs-comment">// æ³¨æ„: è¿™ç§æ–¹æ³•ä¸å¯é ï¼Œå› ä¸º Constructor å¯èƒ½è¢«ä¿®æ”¹</span>
  <span class="hljs-keyword">if</span> (obj.<span class="hljs-property">constructor</span> &amp;&amp; obj.<span class="hljs-property">constructor</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>) {
    <span class="hljs-keyword">return</span> obj.<span class="hljs-property">constructor</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>;
  }

  <span class="hljs-comment">// å¯¹äºé€šè¿‡ Object.create(null) åˆ›å»ºçš„å¯¹è±¡</span>
  <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
}

<span class="hljs-comment">// æµ‹è¯• myGetPrototypeOf</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"=== æµ‹è¯• myGetPrototypeOf ==="</span>);

<span class="hljs-comment">// æµ‹è¯•1: æ™®é€šå¯¹è±¡</span>
<span class="hljs-keyword">const</span> obj1 = {};
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"æµ‹è¯•1 - æ™®é€šå¯¹è±¡:"</span>, <span class="hljs-title function_">myGetPrototypeOf</span>(obj1) === <span class="hljs-title class_">Object</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>); <span class="hljs-comment">// true</span>

<span class="hljs-comment">// æµ‹è¯•2: æ•°ç»„</span>
<span class="hljs-keyword">const</span> arr = [];
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"æµ‹è¯•2 - æ•°ç»„:"</span>, <span class="hljs-title function_">myGetPrototypeOf</span>(arr) === <span class="hljs-title class_">Array</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>); <span class="hljs-comment">// true</span>

<span class="hljs-comment">// æµ‹è¯•3: è‡ªå®šä¹‰å¯¹è±¡</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">Person</span>(<span class="hljs-params"/>) {}
<span class="hljs-keyword">const</span> person = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Person</span>();
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(
  <span class="hljs-string">"æµ‹è¯•3 - è‡ªå®šä¹‰å¯¹è±¡:"</span>,
  <span class="hljs-title function_">myGetPrototypeOf</span>(person) === <span class="hljs-title class_">Person</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>
); <span class="hljs-comment">// true</span>

<span class="hljs-comment">// æµ‹è¯•4: null åŸå‹</span>
<span class="hljs-keyword">const</span> nullProtoObj = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">create</span>(<span class="hljs-literal">null</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"æµ‹è¯•4 - null åŸå‹:"</span>, <span class="hljs-title function_">myGetPrototypeOf</span>(nullProtoObj)); <span class="hljs-comment">// null</span>

<span class="hljs-comment">// æµ‹è¯•5: é”™è¯¯æƒ…å†µ</span>
<span class="hljs-keyword">try</span> {
  <span class="hljs-title function_">myGetPrototypeOf</span>(<span class="hljs-literal">null</span>);
} <span class="hljs-keyword">catch</span> (error) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"æµ‹è¯•5 - null é”™è¯¯:"</span>, error.<span class="hljs-property">message</span>); <span class="hljs-comment">// Cannot convert undefined or null to object</span>
}
</code></pre>
<h5 data-id="heading-22">6.3 å®ç°å®Œæ•´çš„åŸå‹é“¾æ£€æµ‹å·¥å…·</h5>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">/**
 * åŸå‹é“¾æ£€æµ‹å·¥å…·ç±»
 */</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">PrototypeChainUtils</span> {
  <span class="hljs-comment">/**
   * è·å–å¯¹è±¡çš„å®Œæ•´åŸå‹é“¾
   * <span class="hljs-doctag">@param</span> {<span class="hljs-type">Object</span>} obj è¦æ£€æµ‹çš„å¯¹è±¡
   * <span class="hljs-doctag">@returns</span> {<span class="hljs-type">Array</span>} åŸå‹é“¾æ•°ç»„
   */</span>
  <span class="hljs-keyword">static</span> <span class="hljs-title function_">getPrototypeChain</span>(<span class="hljs-params">obj</span>) {
    <span class="hljs-keyword">if</span> (obj === <span class="hljs-literal">null</span> || obj === <span class="hljs-literal">undefined</span>) {
      <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TypeError</span>(<span class="hljs-string">"Cannot convert undefined or null to object"</span>);
    }

    <span class="hljs-keyword">const</span> chain = [];
    <span class="hljs-keyword">let</span> proto = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">getPrototypeOf</span>(obj);

    <span class="hljs-keyword">while</span> (proto !== <span class="hljs-literal">null</span>) {
      chain.<span class="hljs-title function_">push</span>(proto);
      proto = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">getPrototypeOf</span>(proto);
    }

    <span class="hljs-keyword">return</span> chain;
  }

  <span class="hljs-comment">/**
   * æ£€æŸ¥å¯¹è±¡æ˜¯å¦åœ¨åŸå‹é“¾ä¸Š
   * <span class="hljs-doctag">@param</span> {<span class="hljs-type">Object</span>} obj è¦æ£€æŸ¥çš„å¯¹è±¡
   * <span class="hljs-doctag">@param</span> {<span class="hljs-type">Object</span>} target ç›®æ ‡åŸå‹
   * <span class="hljs-doctag">@returns</span> {<span class="hljs-type">boolean</span>} æ˜¯å¦åœ¨åŸå‹é“¾ä¸Š
   */</span>
  <span class="hljs-keyword">static</span> <span class="hljs-title function_">isInPrototypeChain</span>(<span class="hljs-params">obj, target</span>) {
    <span class="hljs-keyword">if</span> (obj === <span class="hljs-literal">null</span> || obj === <span class="hljs-literal">undefined</span>) {
      <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
    }

    <span class="hljs-keyword">let</span> proto = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">getPrototypeOf</span>(obj);

    <span class="hljs-keyword">while</span> (proto !== <span class="hljs-literal">null</span>) {
      <span class="hljs-keyword">if</span> (proto === target) {
        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
      }
      proto = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">getPrototypeOf</span>(proto);
    }

    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
  }

  <span class="hljs-comment">/**
   * è·å–å¯¹è±¡åˆ°æŒ‡å®šåŸå‹çš„è·ç¦»
   * <span class="hljs-doctag">@param</span> {<span class="hljs-type">Object</span>} obj å¯¹è±¡
   * <span class="hljs-doctag">@param</span> {<span class="hljs-type">Object</span>} target ç›®æ ‡åŸå‹
   * <span class="hljs-doctag">@returns</span> {<span class="hljs-type">number</span>} è·ç¦»(-1 è¡¨ç¤ºä¸å†åŸå‹é“¾ä¸Š)
   */</span>
  <span class="hljs-keyword">static</span> <span class="hljs-title function_">getDistanceToPrototype</span>(<span class="hljs-params">obj, target</span>) {
    <span class="hljs-keyword">if</span> (obj === <span class="hljs-literal">null</span> || obj === <span class="hljs-literal">undefined</span>) {
      <span class="hljs-keyword">return</span> -<span class="hljs-number">1</span>;
    }

    <span class="hljs-keyword">let</span> distance = <span class="hljs-number">0</span>;
    <span class="hljs-keyword">let</span> proto = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">getPrototypeOf</span>(obj);

    <span class="hljs-keyword">while</span> (proto !== <span class="hljs-literal">null</span>) {
      <span class="hljs-keyword">if</span> (proto === target) {
        <span class="hljs-keyword">return</span> distance;
      }
      distance++;
      proto = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">getPrototypeOf</span>(proto);
    }

    <span class="hljs-keyword">return</span> -<span class="hljs-number">1</span>;
  }
}

<span class="hljs-comment">// æµ‹è¯•åŸå‹é“¾å·¥å…·</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"=== æµ‹è¯• PrototypeChainUtils ==="</span>);

<span class="hljs-keyword">function</span> <span class="hljs-title function_">A</span>(<span class="hljs-params"/>) {}
<span class="hljs-keyword">function</span> <span class="hljs-title function_">B</span>(<span class="hljs-params"/>) {}
<span class="hljs-keyword">function</span> <span class="hljs-title function_">C</span>(<span class="hljs-params"/>) {}

B.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span> = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">create</span>(A.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>);
B.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">constructor</span> = B;

C.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span> = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">create</span>(B.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>);
C.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">constructor</span> = C;

<span class="hljs-keyword">const</span> c = <span class="hljs-keyword">new</span> <span class="hljs-title function_">C</span>();

<span class="hljs-comment">// è·å–åŸå‹é“¾</span>
<span class="hljs-keyword">const</span> chain = <span class="hljs-title class_">PrototypeChainUtils</span>.<span class="hljs-title function_">getPrototypeChain</span>(c);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"åŸå‹é“¾:"</span>, chain);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"åŸå‹é“¾é•¿åº¦:"</span>, chain.<span class="hljs-property">length</span>); <span class="hljs-comment">// 4</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"åŒ…å« C.prototype:"</span>, chain[<span class="hljs-number">0</span>] === C.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>); <span class="hljs-comment">// true</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"åŒ…å« B.prototype:"</span>, chain[<span class="hljs-number">1</span>] === B.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>); <span class="hljs-comment">// true</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"åŒ…å« A.prototype:"</span>, chain[<span class="hljs-number">2</span>] === A.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>); <span class="hljs-comment">// true</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"åŒ…å« Object.prototype:"</span>, chain[<span class="hljs-number">3</span>] === <span class="hljs-title class_">Object</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>); <span class="hljs-comment">// true</span>

<span class="hljs-comment">// æ£€æŸ¥æ˜¯å¦åœ¨åŸå‹é“¾ä¸Š</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(
  <span class="hljs-string">"æ˜¯å¦åœ¨åŸå‹é“¾ä¸Š - C.prototype:"</span>,
  <span class="hljs-title class_">PrototypeChainUtils</span>.<span class="hljs-title function_">isInPrototypeChain</span>(c, C.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>)
); <span class="hljs-comment">// true</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(
  <span class="hljs-string">"æ˜¯å¦åœ¨åŸå‹é“¾ä¸Š - B.prototype:"</span>,
  <span class="hljs-title class_">PrototypeChainUtils</span>.<span class="hljs-title function_">isInPrototypeChain</span>(c, B.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>)
); <span class="hljs-comment">// true</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(
  <span class="hljs-string">"æ˜¯å¦åœ¨åŸå‹é“¾ä¸Š - A.prototype:"</span>,
  <span class="hljs-title class_">PrototypeChainUtils</span>.<span class="hljs-title function_">isInPrototypeChain</span>(c, A.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>)
); <span class="hljs-comment">// true</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(
  <span class="hljs-string">"æ˜¯å¦åœ¨åŸå‹é“¾ä¸Š - Object.prototype:"</span>,
  <span class="hljs-title class_">PrototypeChainUtils</span>.<span class="hljs-title function_">isInPrototypeChain</span>(c, <span class="hljs-title class_">Object</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>)
); <span class="hljs-comment">// true</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(
  <span class="hljs-string">"æ˜¯å¦åœ¨åŸå‹é“¾ä¸Š - ä¸å­˜åœ¨çš„åŸå‹:"</span>,
  <span class="hljs-title class_">PrototypeChainUtils</span>.<span class="hljs-title function_">isInPrototypeChain</span>(c, <span class="hljs-title class_">Array</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>)
); <span class="hljs-comment">// false</span>

<span class="hljs-comment">// è·å–è·ç¦»</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(
  <span class="hljs-string">"åˆ° C.prototype çš„è·ç¦»:"</span>,
  <span class="hljs-title class_">PrototypeChainUtils</span>.<span class="hljs-title function_">getDistanceToPrototype</span>(c, C.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>)
); <span class="hljs-comment">// 0</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(
  <span class="hljs-string">"åˆ° B.prototype çš„è·ç¦»:"</span>,
  <span class="hljs-title class_">PrototypeChainUtils</span>.<span class="hljs-title function_">getDistanceToPrototype</span>(c, B.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>)
); <span class="hljs-comment">// 1</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(
  <span class="hljs-string">"åˆ° A.prototype çš„è·ç¦»:"</span>,
  <span class="hljs-title class_">PrototypeChainUtils</span>.<span class="hljs-title function_">getDistanceToPrototype</span>(c, A.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>)
); <span class="hljs-comment">// 2</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(
  <span class="hljs-string">"åˆ° Object.prototype çš„è·ç¦»:"</span>,
  <span class="hljs-title class_">PrototypeChainUtils</span>.<span class="hljs-title function_">getDistanceToPrototype</span>(c, <span class="hljs-title class_">Object</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>)
); <span class="hljs-comment">// 3</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(
  <span class="hljs-string">"åˆ°ä¸å­˜åœ¨çš„åŸå‹çš„è·ç¦»:"</span>,
  <span class="hljs-title class_">PrototypeChainUtils</span>.<span class="hljs-title function_">getDistanceToPrototype</span>(c, <span class="hljs-title class_">Array</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>)
); <span class="hljs-comment">// -1</span>

</code></pre>
<h4 data-id="heading-23">ä¸ƒã€å®é™…åº”ç”¨åœºæ™¯</h4>
<h5 data-id="heading-24">7.1 å®ç°å·¥å‚æ¨¡å¼</h5>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// ä½¿ç”¨ new å’Œ instanceof å®ç°å·¥å‚æ¨¡å¼</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">VehicleFactory</span> {
    <span class="hljs-keyword">static</span> <span class="hljs-title function_">createVehicle</span>(<span class="hljs-params">type, options</span>) {
        <span class="hljs-keyword">switch</span> (type) {
            <span class="hljs-keyword">case</span> <span class="hljs-string">'car'</span>:
                <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Car</span>(options);
            <span class="hljs-keyword">case</span> <span class="hljs-string">'truck'</span>:
                <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Truck</span>(options);
            <span class="hljs-keyword">case</span> <span class="hljs-string">'motorcycle'</span>:
                <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Motorcycle</span>(options);
            <span class="hljs-attr">default</span>:
                <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">`Unknown vehicle type: <span class="hljs-subst">${type}</span>`</span>);
        }
    }
    
    <span class="hljs-keyword">static</span> <span class="hljs-title function_">validateVehicle</span>(<span class="hljs-params">vehicle</span>) {
        <span class="hljs-keyword">if</span> (!(vehicle <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">Vehicle</span>)) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TypeError</span>(<span class="hljs-string">'Invalid vehicle'</span>);
        }
        <span class="hljs-keyword">return</span> vehicle;
    }
}

<span class="hljs-keyword">class</span> <span class="hljs-title class_">Vehicle</span> {
    <span class="hljs-title function_">constructor</span>(<span class="hljs-params">make, model, year</span>) {
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">make</span> = make;
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">model</span> = model;
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">year</span> = year;
    }
    
    <span class="hljs-title function_">getInfo</span>(<span class="hljs-params"/>) {
        <span class="hljs-keyword">return</span> <span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.year}</span> <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.make}</span> <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.model}</span>`</span>;
    }
}

<span class="hljs-keyword">class</span> <span class="hljs-title class_">Car</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">Vehicle</span> {
    <span class="hljs-title function_">constructor</span>(<span class="hljs-params">options</span>) {
        <span class="hljs-variable language_">super</span>(options.<span class="hljs-property">make</span>, options.<span class="hljs-property">model</span>, options.<span class="hljs-property">year</span>);
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">doors</span> = options.<span class="hljs-property">doors</span> || <span class="hljs-number">4</span>;
    }
    
    <span class="hljs-title function_">getInfo</span>(<span class="hljs-params"/>) {
        <span class="hljs-keyword">return</span> <span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-variable language_">super</span>.getInfo()}</span> (<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.doors}</span> doors)`</span>;
    }
}

<span class="hljs-keyword">class</span> <span class="hljs-title class_">Truck</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">Vehicle</span> {
    <span class="hljs-title function_">constructor</span>(<span class="hljs-params">options</span>) {
        <span class="hljs-variable language_">super</span>(options.<span class="hljs-property">make</span>, options.<span class="hljs-property">model</span>, options.<span class="hljs-property">year</span>);
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">payload</span> = options.<span class="hljs-property">payload</span> || <span class="hljs-string">'1 ton'</span>;
    }
    
    <span class="hljs-title function_">getInfo</span>(<span class="hljs-params"/>) {
        <span class="hljs-keyword">return</span> <span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-variable language_">super</span>.getInfo()}</span> (<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.payload}</span> payload)`</span>;
    }
}

<span class="hljs-keyword">class</span> <span class="hljs-title class_">Motorcycle</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">Vehicle</span> {
    <span class="hljs-title function_">constructor</span>(<span class="hljs-params">options</span>) {
        <span class="hljs-variable language_">super</span>(options.<span class="hljs-property">make</span>, options.<span class="hljs-property">model</span>, options.<span class="hljs-property">year</span>);
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">type</span> = options.<span class="hljs-property">type</span> || <span class="hljs-string">'street'</span>;
    }
    
    <span class="hljs-title function_">getInfo</span>(<span class="hljs-params"/>) {
        <span class="hljs-keyword">return</span> <span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-variable language_">super</span>.getInfo()}</span> (<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.type}</span> motorcycle)`</span>;
    }
}

<span class="hljs-comment">// ä½¿ç”¨å·¥å‚æ¨¡å¼</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'=== å·¥å‚æ¨¡å¼æµ‹è¯• ==='</span>);

<span class="hljs-keyword">try</span> {
    <span class="hljs-keyword">const</span> car = <span class="hljs-title class_">VehicleFactory</span>.<span class="hljs-title function_">createVehicle</span>(<span class="hljs-string">'car'</span>, {
        <span class="hljs-attr">make</span>: <span class="hljs-string">'Toyota'</span>,
        <span class="hljs-attr">model</span>: <span class="hljs-string">'Camry'</span>,
        <span class="hljs-attr">year</span>: <span class="hljs-number">2022</span>,
        <span class="hljs-attr">doors</span>: <span class="hljs-number">4</span>
    });
    
    <span class="hljs-keyword">const</span> truck = <span class="hljs-title class_">VehicleFactory</span>.<span class="hljs-title function_">createVehicle</span>(<span class="hljs-string">'truck'</span>, {
        <span class="hljs-attr">make</span>: <span class="hljs-string">'Ford'</span>,
        <span class="hljs-attr">model</span>: <span class="hljs-string">'F-150'</span>,
        <span class="hljs-attr">year</span>: <span class="hljs-number">2021</span>,
        <span class="hljs-attr">payload</span>: <span class="hljs-string">'2 tons'</span>
    });
    
    <span class="hljs-keyword">const</span> motorcycle = <span class="hljs-title class_">VehicleFactory</span>.<span class="hljs-title function_">createVehicle</span>(<span class="hljs-string">'motorcycle'</span>, {
        <span class="hljs-attr">make</span>: <span class="hljs-string">'Harley-Davidson'</span>,
        <span class="hljs-attr">model</span>: <span class="hljs-string">'Sportster'</span>,
        <span class="hljs-attr">year</span>: <span class="hljs-number">2020</span>,
        <span class="hljs-attr">type</span>: <span class="hljs-string">'cruiser'</span>
    });
    
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'Car:'</span>, car.<span class="hljs-title function_">getInfo</span>());
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'Truck:'</span>, truck.<span class="hljs-title function_">getInfo</span>());
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'Motorcycle:'</span>, motorcycle.<span class="hljs-title function_">getInfo</span>());
    
    <span class="hljs-comment">// éªŒè¯</span>
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'Car instanceof Vehicle:'</span>, <span class="hljs-title class_">VehicleFactory</span>.<span class="hljs-title function_">validateVehicle</span>(car) <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">Vehicle</span>);
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'Car instanceof Car:'</span>, car <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">Car</span>);
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'Truck instanceof Vehicle:'</span>, truck <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">Vehicle</span>);
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'Motorcycle instanceof Vehicle:'</span>, motorcycle <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">Vehicle</span>);
    
    <span class="hljs-comment">// é”™è¯¯æµ‹è¯•</span>
    <span class="hljs-keyword">try</span> {
        <span class="hljs-title class_">VehicleFactory</span>.<span class="hljs-title function_">createVehicle</span>(<span class="hljs-string">'airplane'</span>, {});
    } <span class="hljs-keyword">catch</span> (error) {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'é”™è¯¯å¤„ç†:'</span>, error.<span class="hljs-property">message</span>);
    }
    
    <span class="hljs-keyword">try</span> {
        <span class="hljs-title class_">VehicleFactory</span>.<span class="hljs-title function_">validateVehicle</span>({});
    } <span class="hljs-keyword">catch</span> (error) {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'éªŒè¯é”™è¯¯:'</span>, error.<span class="hljs-property">message</span>);
    }
} <span class="hljs-keyword">catch</span> (error) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'å·¥å‚æ¨¡å¼é”™è¯¯:'</span>, error);
}
</code></pre>
<h5 data-id="heading-25">7.2 å®ç°æ’ä»¶ç³»ç»Ÿ</h5>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// ä½¿ç”¨åŸå‹é“¾å®ç°æ’ä»¶ç³»ç»Ÿ</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">PluginSystem</span> {
    <span class="hljs-title function_">constructor</span>(<span class="hljs-params"/>) {
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">plugins</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Map</span>();
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">hooks</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Map</span>();
    }
    
    <span class="hljs-comment">// æ³¨å†Œæ’ä»¶</span>
    <span class="hljs-title function_">register</span>(<span class="hljs-params">plugin</span>) {
        <span class="hljs-keyword">if</span> (!(plugin <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">Plugin</span>)) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TypeError</span>(<span class="hljs-string">'Plugin must be an instance of Plugin'</span>);
        }
        
        <span class="hljs-keyword">const</span> name = plugin.<span class="hljs-property">name</span>;
        
        <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">plugins</span>.<span class="hljs-title function_">has</span>(name)) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">`Plugin "<span class="hljs-subst">${name}</span>" is already registered`</span>);
        }
        
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">plugins</span>.<span class="hljs-title function_">set</span>(name, plugin);
        
        <span class="hljs-comment">// æ³¨å†Œé’©å­</span>
        <span class="hljs-keyword">if</span> (plugin.<span class="hljs-property">hooks</span>) {
            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> [hookName, handler] <span class="hljs-keyword">of</span> <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">entries</span>(plugin.<span class="hljs-property">hooks</span>)) {
                <span class="hljs-keyword">if</span> (!<span class="hljs-variable language_">this</span>.<span class="hljs-property">hooks</span>.<span class="hljs-title function_">has</span>(hookName)) {
                    <span class="hljs-variable language_">this</span>.<span class="hljs-property">hooks</span>.<span class="hljs-title function_">set</span>(hookName, []);
                }
                <span class="hljs-variable language_">this</span>.<span class="hljs-property">hooks</span>.<span class="hljs-title function_">get</span>(hookName).<span class="hljs-title function_">push</span>(handler);
            }
        }
        
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`Plugin "<span class="hljs-subst">${name}</span>" registered successfully`</span>);
    }
    
    <span class="hljs-comment">// è§¦å‘é’©å­</span>
    <span class="hljs-title function_">trigger</span>(<span class="hljs-params">hookName, ...args</span>) {
        <span class="hljs-keyword">if</span> (!<span class="hljs-variable language_">this</span>.<span class="hljs-property">hooks</span>.<span class="hljs-title function_">has</span>(hookName)) {
            <span class="hljs-keyword">return</span> [];
        }
        
        <span class="hljs-keyword">const</span> results = [];
        <span class="hljs-keyword">const</span> handlers = <span class="hljs-variable language_">this</span>.<span class="hljs-property">hooks</span>.<span class="hljs-title function_">get</span>(hookName);
        
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> handler <span class="hljs-keyword">of</span> handlers) {
            <span class="hljs-keyword">try</span> {
                <span class="hljs-keyword">const</span> result = <span class="hljs-title function_">handler</span>(...args);
                results.<span class="hljs-title function_">push</span>(result);
            } <span class="hljs-keyword">catch</span> (error) {
                <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`Error in hook "<span class="hljs-subst">${hookName}</span>":`</span>, error);
            }
        }
        
        <span class="hljs-keyword">return</span> results;
    }
    
    <span class="hljs-comment">// è·å–æ’ä»¶</span>
    <span class="hljs-title function_">getPlugin</span>(<span class="hljs-params">name</span>) {
        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">plugins</span>.<span class="hljs-title function_">get</span>(name);
    }
    
    <span class="hljs-comment">// æ£€æŸ¥æ’ä»¶æ˜¯å¦å·²æ³¨å†Œ</span>
    <span class="hljs-title function_">hasPlugin</span>(<span class="hljs-params">name</span>) {
        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">plugins</span>.<span class="hljs-title function_">has</span>(name);
    }
}

<span class="hljs-comment">// æ’ä»¶åŸºç±»</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">Plugin</span> {
    <span class="hljs-title function_">constructor</span>(<span class="hljs-params">name</span>) {
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">new</span>.<span class="hljs-property">target</span> === <span class="hljs-title class_">Plugin</span>) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TypeError</span>(<span class="hljs-string">'Cannot instantiate Plugin directly'</span>);
        }
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = name;
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">hooks</span> = {};
    }
    
    <span class="hljs-comment">// åˆå§‹åŒ–é’©å­</span>
    <span class="hljs-title function_">init</span>(<span class="hljs-params">system</span>) {
        <span class="hljs-comment">// ç”±å­ç±»å®ç°</span>
    }
}

<span class="hljs-comment">// ç¤ºä¾‹æ’ä»¶</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">LoggerPlugin</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">Plugin</span> {
    <span class="hljs-title function_">constructor</span>(<span class="hljs-params"/>) {
        <span class="hljs-variable language_">super</span>(<span class="hljs-string">'logger'</span>);
        
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">hooks</span> = {
            <span class="hljs-string">'beforeRequest'</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">beforeRequest</span>.<span class="hljs-title function_">bind</span>(<span class="hljs-variable language_">this</span>),
            <span class="hljs-string">'afterResponse'</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">afterResponse</span>.<span class="hljs-title function_">bind</span>(<span class="hljs-variable language_">this</span>),
            <span class="hljs-string">'onError'</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">onError</span>.<span class="hljs-title function_">bind</span>(<span class="hljs-variable language_">this</span>)
        };
    }
    
    <span class="hljs-title function_">beforeRequest</span>(<span class="hljs-params">request</span>) {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`[Logger] Request started: <span class="hljs-subst">${request.url}</span>`</span>);
        <span class="hljs-keyword">return</span> { <span class="hljs-attr">logged</span>: <span class="hljs-literal">true</span>, <span class="hljs-attr">timestamp</span>: <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>() };
    }
    
    <span class="hljs-title function_">afterResponse</span>(<span class="hljs-params">response</span>) {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`[Logger] Response received: <span class="hljs-subst">${response.status}</span>`</span>);
        <span class="hljs-keyword">return</span> { <span class="hljs-attr">logged</span>: <span class="hljs-literal">true</span>, <span class="hljs-attr">timestamp</span>: <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>() };
    }
    
    <span class="hljs-title function_">onError</span>(<span class="hljs-params">error</span>) {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`[Logger] Error: <span class="hljs-subst">${error.message}</span>`</span>);
        <span class="hljs-keyword">return</span> { <span class="hljs-attr">logged</span>: <span class="hljs-literal">true</span>, <span class="hljs-attr">timestamp</span>: <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>() };
    }
}

<span class="hljs-keyword">class</span> <span class="hljs-title class_">AnalyticsPlugin</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">Plugin</span> {
    <span class="hljs-title function_">constructor</span>(<span class="hljs-params"/>) {
        <span class="hljs-variable language_">super</span>(<span class="hljs-string">'analytics'</span>);
        
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">hooks</span> = {
            <span class="hljs-string">'afterResponse'</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">trackAnalytics</span>.<span class="hljs-title function_">bind</span>(<span class="hljs-variable language_">this</span>)
        };
        
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">requests</span> = [];
    }
    
    <span class="hljs-title function_">trackAnalytics</span>(<span class="hljs-params">response</span>) {
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">requests</span>.<span class="hljs-title function_">push</span>({
            <span class="hljs-attr">url</span>: response.<span class="hljs-property">url</span>,
            <span class="hljs-attr">status</span>: response.<span class="hljs-property">status</span>,
            <span class="hljs-attr">timestamp</span>: <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>()
        });
        
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`[Analytics] Tracked request to <span class="hljs-subst">${response.url}</span>`</span>);
        <span class="hljs-keyword">return</span> { <span class="hljs-attr">tracked</span>: <span class="hljs-literal">true</span>, <span class="hljs-attr">totalRequests</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">requests</span>.<span class="hljs-property">length</span> };
    }
    
    <span class="hljs-title function_">getStats</span>(<span class="hljs-params"/>) {
        <span class="hljs-keyword">return</span> {
            <span class="hljs-attr">totalRequests</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">requests</span>.<span class="hljs-property">length</span>,
            <span class="hljs-attr">successfulRequests</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">requests</span>.<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">r</span> =&gt;</span> r.<span class="hljs-property">status</span> === <span class="hljs-number">200</span>).<span class="hljs-property">length</span>,
            <span class="hljs-attr">failedRequests</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">requests</span>.<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">r</span> =&gt;</span> r.<span class="hljs-property">status</span> !== <span class="hljs-number">200</span>).<span class="hljs-property">length</span>
        };
    }
}

<span class="hljs-comment">// ä½¿ç”¨æ’ä»¶ç³»ç»Ÿ</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'=== æ’ä»¶ç³»ç»Ÿæµ‹è¯• ==='</span>);

<span class="hljs-keyword">const</span> pluginSystem = <span class="hljs-keyword">new</span> <span class="hljs-title class_">PluginSystem</span>();

<span class="hljs-keyword">try</span> {
    <span class="hljs-comment">// æ³¨å†Œæ’ä»¶</span>
    <span class="hljs-keyword">const</span> logger = <span class="hljs-keyword">new</span> <span class="hljs-title class_">LoggerPlugin</span>();
    <span class="hljs-keyword">const</span> analytics = <span class="hljs-keyword">new</span> <span class="hljs-title class_">AnalyticsPlugin</span>();
    
    pluginSystem.<span class="hljs-title function_">register</span>(logger);
    pluginSystem.<span class="hljs-title function_">register</span>(analytics);
    
    <span class="hljs-comment">// è§¦å‘é’©å­</span>
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'è§¦å‘ beforeRequest é’©å­:'</span>);
    <span class="hljs-keyword">const</span> beforeResults = pluginSystem.<span class="hljs-title function_">trigger</span>(<span class="hljs-string">'beforeRequest'</span>, { <span class="hljs-attr">url</span>: <span class="hljs-string">'/api/data'</span>, <span class="hljs-attr">method</span>: <span class="hljs-string">'GET'</span> });
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'Before request results:'</span>, beforeResults);
    
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'\nè§¦å‘ afterResponse é’©å­:'</span>);
    <span class="hljs-keyword">const</span> afterResults = pluginSystem.<span class="hljs-title function_">trigger</span>(<span class="hljs-string">'afterResponse'</span>, { <span class="hljs-attr">url</span>: <span class="hljs-string">'/api/data'</span>, <span class="hljs-attr">status</span>: <span class="hljs-number">200</span>, <span class="hljs-attr">data</span>: {} });
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'After response results:'</span>, afterResults);
    
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'\nè§¦å‘ onError é’©å­:'</span>);
    <span class="hljs-keyword">const</span> errorResults = pluginSystem.<span class="hljs-title function_">trigger</span>(<span class="hljs-string">'onError'</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">'Network error'</span>));
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'Error results:'</span>, errorResults);
    
    <span class="hljs-comment">// è·å–æ’ä»¶</span>
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'\næ’ä»¶æ£€æŸ¥:'</span>);
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'Has logger plugin:'</span>, pluginSystem.<span class="hljs-title function_">hasPlugin</span>(<span class="hljs-string">'logger'</span>));
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'Has analytics plugin:'</span>, pluginSystem.<span class="hljs-title function_">hasPlugin</span>(<span class="hljs-string">'analytics'</span>));
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'Has unknown plugin:'</span>, pluginSystem.<span class="hljs-title function_">hasPlugin</span>(<span class="hljs-string">'unknown'</span>));
    
    <span class="hljs-comment">// è·å–ç»Ÿè®¡ä¿¡æ¯</span>
    <span class="hljs-keyword">const</span> analyticsPlugin = pluginSystem.<span class="hljs-title function_">getPlugin</span>(<span class="hljs-string">'analytics'</span>);
    <span class="hljs-keyword">if</span> (analyticsPlugin <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">AnalyticsPlugin</span>) {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'\nAnalytics stats:'</span>, analyticsPlugin.<span class="hljs-title function_">getStats</span>());
    }
    
    <span class="hljs-comment">// é”™è¯¯æµ‹è¯•</span>
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'\né”™è¯¯æµ‹è¯•:'</span>);
    <span class="hljs-keyword">try</span> {
        pluginSystem.<span class="hljs-title function_">register</span>({}); <span class="hljs-comment">// ä¸æ˜¯ Plugin å®ä¾‹</span>
    } <span class="hljs-keyword">catch</span> (error) {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'æ³¨å†Œéæ’ä»¶é”™è¯¯:'</span>, error.<span class="hljs-property">message</span>);
    }
    
    <span class="hljs-keyword">try</span> {
        pluginSystem.<span class="hljs-title function_">register</span>(logger); <span class="hljs-comment">// é‡å¤æ³¨å†Œ</span>
    } <span class="hljs-keyword">catch</span> (error) {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'é‡å¤æ³¨å†Œé”™è¯¯:'</span>, error.<span class="hljs-property">message</span>);
    }
} <span class="hljs-keyword">catch</span> (error) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'æ’ä»¶ç³»ç»Ÿé”™è¯¯:'</span>, error);
}
</code></pre>
<h4 data-id="heading-26">å…«ã€æ€»ç»“ä¸æœ€ä½³å®è·µ</h4>
<h5 data-id="heading-27">81 æ ¸å¿ƒè¦ç‚¹æ€»ç»“</h5>
<ol>
<li><strong>newæ“ä½œç¬¦çš„æ‰§è¡Œæ­¥éª¤:</strong></li>
</ol>
<ul>
<li>åˆ›å»ºæ–°å¯¹è±¡</li>
<li>è®¾ç½®åŸå‹é“¾</li>
<li>ç»‘å®š this å€¼</li>
<li>æ‰§è¡Œæ„é€ å‡½æ•°</li>
<li>å¤„ç†è¿”å›å€¼</li>
</ul>
<ol start="2">
<li><strong>instanceofçš„å·¥ä½œåŸç†:</strong></li>
</ol>
<ul>
<li>æ²¿ç€åŸå‹é“¾å‘ä¸ŠæŸ¥æ‰¾</li>
<li>æ¯”è¾ƒæ„é€ å‡½æ•°çš„prototypeå±æ€§</li>
<li>æ”¯æŒSymbol.hasInstanceè‡ªå®šä¹‰æ£€æµ‹</li>
</ul>
<ol start="3">
<li><strong>åŸå‹é“¾çš„é‡è¦æ€§:</strong></li>
</ol>
<ul>
<li>æ˜¯å®ç°ç»§æ‰¿çš„åŸºç¡€</li>
<li>å½±å“ instanceof çš„æ£€æµ‹ç»“æœ</li>
<li>å†³å®šäº†å¯¹è±¡çš„å±æ€§å’Œæ–¹æ³•æŸ¥æ‰¾è·¯å¾„</li>
</ul>
<h5 data-id="heading-28">8.2 æ‰‹å†™å®ç°çš„å…³é”®ç‚¹</h5>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// new æ“ä½œç¬¦å®ç°çš„å…³é”®</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">myNew</span>(<span class="hljs-params">Constructor, ...args</span>) {
    <span class="hljs-comment">// 1. åˆ›å»ºå¯¹è±¡å¹¶è®¾ç½®åŸå‹</span>
    <span class="hljs-keyword">const</span> obj = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">create</span>(<span class="hljs-title class_">Constructor</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>);
    
    <span class="hljs-comment">// 2. æ‰§è¡Œæ„é€ å‡½æ•°</span>
    <span class="hljs-keyword">const</span> result = <span class="hljs-title class_">Constructor</span>.<span class="hljs-title function_">apply</span>(obj, args);
    
    <span class="hljs-comment">// 3. å¤„ç†è¿”å›å€¼</span>
    <span class="hljs-keyword">return</span> result <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">Object</span> ? result : obj;
}

<span class="hljs-comment">// instanceof æ“ä½œç¬¦å®ç°çš„å…³é”®</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">myInstanceof</span>(<span class="hljs-params">instance, Constructor</span>) {
    <span class="hljs-comment">// 1. åŸºæœ¬ç±»å‹ç›´æ¥è¿”å› false</span>
    <span class="hljs-keyword">if</span> (instance === <span class="hljs-literal">null</span> || <span class="hljs-keyword">typeof</span> instance !== <span class="hljs-string">'object'</span>) {
        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
    }
    
    <span class="hljs-comment">// 2. è·å–åŸå‹é“¾</span>
    <span class="hljs-keyword">let</span> proto = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">getPrototypeOf</span>(instance);
    <span class="hljs-keyword">const</span> prototype = <span class="hljs-title class_">Constructor</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>;
    
    <span class="hljs-comment">// 3. æ²¿ç€åŸå‹é“¾æŸ¥æ‰¾</span>
    <span class="hljs-keyword">while</span> (proto !== <span class="hljs-literal">null</span>) {
        <span class="hljs-keyword">if</span> (proto === prototype) {
            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
        }
        proto = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">getPrototypeOf</span>(proto);
    }
    
    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
}
</code></pre>
<h5 data-id="heading-29">8.3 æœ€ä½³å®è·µ</h5>
<ol>
<li><strong>ä½¿ç”¨newæ“ä½œç¬¦æ—¶:</strong></li>
</ol>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// å¥½çš„å®è·µ</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">Person</span>(<span class="hljs-params">name</span>) {
    <span class="hljs-keyword">if</span> (!(<span class="hljs-variable language_">this</span> <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">Person</span>)) {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Person</span>(name); <span class="hljs-comment">// é˜²æ­¢å¿˜è®°ä½¿ç”¨ new</span>
    }
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = name;
}

<span class="hljs-comment">// æˆ–è€…ä½¿ç”¨ ES6 class</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">Person</span> {
    <span class="hljs-title function_">constructor</span>(<span class="hljs-params">name</span>) {
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = name;
    }
}
</code></pre>
<ol start="2">
<li><strong>ä½¿ç”¨instanceofæ—¶:</strong></li>
</ol>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// å¥½çš„å®è·µ - æ£€æŸ¥ç±»å‹</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">process</span>(<span class="hljs-params">value</span>) {
    <span class="hljs-keyword">if</span> (value <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">Array</span>) {
        <span class="hljs-comment">// å¤„ç†æ•°ç»„</span>
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (value <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">Date</span>) {
        <span class="hljs-comment">// å¤„ç†æ—¥æœŸ</span>
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (value <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">RegExp</span>) {
        <span class="hljs-comment">// å¤„ç†æ­£åˆ™è¡¨è¾¾å¼</span>
    }
}

<span class="hljs-comment">// æ›´å¥½çš„å®è·µ - ä½¿ç”¨é¸­å­ç±»å‹</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">process</span>(<span class="hljs-params">value</span>) {
    <span class="hljs-keyword">if</span> (<span class="hljs-title class_">Array</span>.<span class="hljs-title function_">isArray</span>(value)) {
        <span class="hljs-comment">// å¤„ç†æ•°ç»„</span>
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (value <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">Date</span> || <span class="hljs-keyword">typeof</span> value.<span class="hljs-property">getMonth</span> === <span class="hljs-string">'function'</span>) {
        <span class="hljs-comment">// å¤„ç†æ—¥æœŸ</span>
    }
}
</code></pre>
<ol start="3">
<li><strong>é¿å…çš„é—®é¢˜:</strong></li>
</ol>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// é¿å…çš„é—®é¢˜1: ä¿®æ”¹å†…ç½®å¯¹è±¡çš„åŸå‹</span>
<span class="hljs-title class_">Array</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">customMethod</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {};
<span class="hljs-keyword">const</span> arr = [];
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(arr <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">Array</span>); <span class="hljs-comment">// true</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(arr.<span class="hljs-property">customMethod</span>); <span class="hljs-comment">// function</span>

<span class="hljs-comment">// é¿å…çš„é—®é¢˜2: è·¨æ¡†æ¶çš„ instanceof é—®é¢˜</span>
<span class="hljs-comment">// åœ¨ä¸åŒ iframe ä¸­åˆ›å»ºçš„æ•°ç»„ï¼Œinstanceof å¯èƒ½è¿”å› false</span>

<span class="hljs-comment">// é¿å…çš„é—®é¢˜3: constructor è¢«ä¿®æ”¹</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">Person</span>(<span class="hljs-params"/>) {}
<span class="hljs-keyword">const</span> person = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Person</span>();
person.<span class="hljs-property">constructor</span> = <span class="hljs-title class_">Object</span>;
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(person <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">Person</span>); <span class="hljs-comment">// true</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(person.<span class="hljs-property">constructor</span> === <span class="hljs-title class_">Person</span>); <span class="hljs-comment">// false</span>
</code></pre>
<h5 data-id="heading-30">8.4 æ€§èƒ½è€ƒè™‘</h5>
<ol>
<li><strong>newæ“ä½œç¬¦çš„æ€§èƒ½:</strong></li>
</ol>
<ul>
<li>åŸç”Ÿçš„<code>new</code>æ“ä½œç¬¦æ˜¯æœ€å¿«çš„</li>
<li>æ‰‹å†™å®ç°ä¼šæœ‰è½»å¾®æ€§èƒ½å¼€é”€</li>
<li>åœ¨æ€§èƒ½å…³é”®è·¯å¾„ä¸Šä½¿ç”¨åŸç”Ÿæ“ä½œ</li>
</ul>
<ol start="2">
<li><strong>instanceofçš„æ€§èƒ½:</strong></li>
</ol>
<ul>
<li>åŸå‹é“¾è¶Šé•¿ï¼Œæ£€æµ‹è¶Šæ…¢</li>
<li>å¯¹äºé¢‘ç¹çš„ç±»å‹æ£€æµ‹ï¼Œå¯ä»¥è€ƒè™‘ç¼“å­˜ç»“æœ</li>
<li>ä½¿ç”¨<code>typeof</code>æ£€æµ‹åŸºæœ¬ç±»å‹æ›´å¿«</li>
</ul>
<ol start="3">
<li><strong>ä¼˜åŒ–å»ºè®®:</strong></li>
</ol>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// ä¼˜åŒ–é¢‘ç¹çš„ç±»å‹æ£€æµ‹</span>
<span class="hljs-keyword">const</span> isArray = <span class="hljs-title class_">Array</span>.<span class="hljs-property">isArray</span>;

<span class="hljs-keyword">function</span> <span class="hljs-title function_">processItems</span>(<span class="hljs-params">items</span>) {
    <span class="hljs-keyword">if</span> (<span class="hljs-title function_">isArray</span>(items)) {
        <span class="hljs-comment">// å¤„ç†æ•°ç»„</span>
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; items.<span class="hljs-property">length</span>; i++) {
            <span class="hljs-comment">// ä½¿ç”¨ for å¾ªç¯è€Œä¸æ˜¯ forEach</span>
        }
    }
}
</code></pre>
<h4 data-id="heading-31">ç»“è¯­</h4>
<p>é€šè¿‡æ‰‹å†™<code>new</code>æ“ä½œç¬¦å’Œ<code>instanceof</code>æ“ä½œç¬¦ï¼Œæˆ‘ä»¬æ·±å…¥ç†è§£äº†JavaScriptçš„å¯¹è±¡åˆ›å»ºæœºåˆ¶å’Œç±»å‹æ£€æµ‹åŸç†ã€‚è¿™äº›çŸ¥è¯†ä¸ä»…æ˜¯é¢è¯•ä¸­çš„å¸¸è§è€ƒç‚¹ï¼Œæ›´æ˜¯ç¼–å†™é«˜è´¨é‡JavaScriptä»£ç çš„åŸºç¡€ã€‚</p>
<p>è®°ä½ä»¥ä¸‹è¦ç‚¹:</p>
<ul>
<li>âœ… new æ“ä½œç¬¦åˆ›å»ºå¯¹è±¡æ—¶ï¼Œä¼šè®¾ç½®åŸå‹é“¾å¹¶æ‰§è¡Œæ„é€ å‡½æ•°</li>
<li>âœ… instanceof é€šè¿‡æ£€æŸ¥åŸå‹é“¾æ¥åˆ¤æ–­å¯¹è±¡ç±»å‹</li>
<li>âœ… åŸå‹é“¾æ˜¯ JavaScript ç»§æ‰¿çš„åŸºç¡€</li>
<li>âœ… ç†è§£è¿™äº›åŸç†æœ‰åŠ©äºé¿å…å¸¸è§çš„é™·é˜±å’Œé”™è¯¯</li>
</ul>
<p><strong>å»¶ä¼¸é˜…è¯»:</strong></p>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fzh-CN%2Fdocs%2FWeb%2FJavaScript%2FReference%2FOperators%2Fnew" target="_blank" title="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Operators/new" ref="nofollow noopener noreferrer">MDN: new æ“ä½œç¬¦</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fzh-CN%2Fdocs%2FWeb%2FJavaScript%2FReference%2FOperators%2Finstanceof" target="_blank" title="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Operators/instanceof" ref="nofollow noopener noreferrer">MDN: instanceof æ“ä½œç¬¦</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fgetify%2FYou-Dont-Know-JS%2Fblob%2F1st-ed%2Fthis%252520%252526%252520object%252520prototypes%2Fch5.md" target="_blank" title="https://github.com/getify/You-Dont-Know-JS/blob/1st-ed/this%2520%2526%2520object%2520prototypes/ch5.md" ref="nofollow noopener noreferrer">JavaScript åŸå‹é“¾è¯¦è§£</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fzh-CN%2Fdocs%2FWeb%2FJavaScript%2FReference%2FClasses" target="_blank" title="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Classes" ref="nofollow noopener noreferrer">ES6 Class ä¸åŸå‹ç»§æ‰¿</a></li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[JuiceFS + MinIOï¼šAriste AI é‡åŒ–æŠ•èµ„é«˜æ€§èƒ½å­˜å‚¨å®è·µ]]></title>    <link>https://juejin.cn/post/7581041679190753315</link>    <guid>https://juejin.cn/post/7581041679190753315</guid>    <pubDate>2025-12-08T09:38:26.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581041679190753315" data-draft-id="7581279471745826850" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="JuiceFS + MinIOï¼šAriste AI é‡åŒ–æŠ•èµ„é«˜æ€§èƒ½å­˜å‚¨å®è·µ"/> <meta itemprop="keywords" content="åç«¯,è¿ç»´"/> <meta itemprop="datePublished" content="2025-12-08T09:38:26.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="JuiceFS"/> <meta itemprop="url" content="https://juejin.cn/user/2665636828032446"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            JuiceFS + MinIOï¼šAriste AI é‡åŒ–æŠ•èµ„é«˜æ€§èƒ½å­˜å‚¨å®è·µ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2665636828032446/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    JuiceFS
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-08T09:38:26.000Z" title="Mon Dec 08 2025 09:38:26 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»8åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>Ariste AI æ˜¯ä¸€å®¶ä¸“æ³¨äº AI é©±åŠ¨äº¤æ˜“çš„å…¬å¸ï¼Œä¸šåŠ¡æ¶µç›–è‡ªè¥äº¤æ˜“ã€èµ„äº§ç®¡ç†ã€é«˜é¢‘åšå¸‚ç­‰å¤šä¸ªé¢†åŸŸã€‚åœ¨é‡åŒ–äº¤æ˜“ç ”ç©¶ä¸­ï¼Œæ•°æ®çš„è¯»å–é€Ÿåº¦å’Œå­˜å‚¨æ•ˆç‡ï¼Œå¾€å¾€ç›´æ¥å†³å®šäº†ç ”ç©¶è¿­ä»£çš„é€Ÿåº¦ã€‚</p>
<p>Ariste AI å›¢é˜Ÿåœ¨æ„å»ºé‡åŒ–ç ”ç©¶åŸºç¡€è®¾æ–½çš„è¿‡ç¨‹ä¸­ï¼Œé¢å¯¹æ€»è§„æ¨¡è¶…è¿‡ 500TBï¼Œè¡Œæƒ…ä¸å› å­æ•°æ®ï¼Œç»å†äº†ä»æœ¬åœ°ç›˜åˆ°æœ€ç»ˆé€‰æ‹©åœ¨ MinIO å¯¹è±¡å­˜å‚¨ä¹‹ä¸Šå åŠ  JuiceFS æ–‡ä»¶ç³»ç»Ÿçš„å››ä¸ªé˜¶æ®µã€‚é€šè¿‡ç¼“å­˜æœºåˆ¶ä¸åˆ†å±‚æ¶æ„ï¼Œå›¢é˜Ÿå®ç°äº†é«˜é¢‘æ•°æ®çš„å¿«é€Ÿè®¿é—®ä¸é›†ä¸­ç®¡ç†ã€‚<strong>è¿™ä¸€å®è·µéªŒè¯äº†â€œç¼“å­˜åŠ é€Ÿã€å¼¹æ€§å¯¹è±¡å­˜å‚¨ä¸ POSIX å…¼å®¹â€ä¸‰ä½ä¸€ä½“æ–¹æ¡ˆåœ¨é‡åŒ–åœºæ™¯ä¸‹çš„å¯è¡Œæ€§</strong>ï¼Œå¸Œæœ›è¿™ä¸€ç»éªŒèƒ½ä¸ºåŒè¡Œæä¾›ä¸€äº›å‚è€ƒã€‚</p>
<h2 data-id="heading-0">01 é‡åŒ–æŠ•èµ„å­˜å‚¨æŒ‘æˆ˜ï¼šè§„æ¨¡ã€é€Ÿåº¦ä¸åä½œçš„å¹³è¡¡</h2>
<p>é‡åŒ–æŠ•èµ„æµç¨‹ä¾æ¬¡åŒ…æ‹¬æ•°æ®å±‚ã€å› å­ä¸ä¿¡å·å±‚ã€ç­–ç•¥ä¸ä»“ä½å±‚åŠæ‰§è¡Œä¸äº¤æ˜“å±‚ï¼Œæ„æˆä»æ•°æ®è·å–åˆ°äº¤æ˜“æ‰§è¡Œçš„å®Œæ•´é—­ç¯ã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e9766cde494b428596aa2620592817a8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSnVpY2VGUw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765791506&amp;x-signature=TShcTqagLXbZd4iTWJBZpmncPMw%3D" alt="" loading="lazy"/></p>
<p>åœ¨æ•´ä¸ªè¿‡ç¨‹ä¸­ï¼Œå­˜å‚¨ç³»ç»Ÿé¢ä¸´å¤šé‡æŒ‘æˆ˜ï¼Œä¸»è¦ä½“ç°åœ¨ä»¥ä¸‹å‡ ä¸ªæ–¹é¢ï¼š</p>
<ul>
<li><strong>æ•°æ®è§„æ¨¡ä¸å¢é€Ÿ</strong>ï¼šé‡åŒ–ç ”ç©¶æ‰€éœ€å¤„ç†çš„æ•°æ®æ€»é‡è¾ƒå¤§ï¼Œæ¶µç›–å†å²è¡Œæƒ…æ•°æ®ã€æ–°é—»æ•°æ®ä»¥åŠè‡ªè¡Œè®¡ç®—çš„å› å­æ•°æ®ç­‰ã€‚ç›®å‰ï¼Œè¿™äº›æ•°æ®çš„æ€»é‡å·²æ¥è¿‘ 500Tã€‚å¹¶ä¸”ï¼Œä¼ä¸šæ¯æ—¥æ–°å¢çš„è¡Œæƒ…æ•°æ®ä¹Ÿè¾¾æ•°ç™¾ GBã€‚è‹¥é‡‡ç”¨ä¼ ç»Ÿç£ç›˜è¿›è¡Œå­˜å‚¨ï¼Œæ˜¾ç„¶æ— æ³•æ»¡è¶³å¦‚æ­¤å·¨å¤§çš„æ•°æ®å­˜å‚¨éœ€æ±‚ã€‚</li>
<li><strong>é«˜é¢‘è®¿é—®ä¸ä½å»¶è¿Ÿè¦æ±‚</strong>ï¼šé«˜é¢‘çš„æ•°æ®è®¿é—®ä¾èµ–äºä½å»¶è¿Ÿçš„æ•°æ®è¯»å–ã€‚æ•°æ®è¯»å–çš„é€Ÿç‡ç›´æ¥å†³å®šäº†ç ”ç©¶æ•ˆç‡çš„é«˜ä½ã€‚è‹¥æ•°æ®è¯»å–é€Ÿåº¦è¾ƒå¿«ï¼Œç ”ç©¶è¿›ç¨‹ä¾¿èƒ½è¿…é€Ÿæ¨è¿›ï¼›åä¹‹ï¼Œåˆ™ä¼šå¯¼è‡´ç ”ç©¶æ•ˆç‡ä½ä¸‹ã€‚</li>
<li><strong>å¤šå›¢é˜Ÿå¹¶è¡Œä¸æ•°æ®æ²»ç†</strong>ï¼šåœ¨é‡åŒ–ç ”ç©¶è¿‡ç¨‹ä¸­ï¼Œé€šå¸¸ä¼šæœ‰å¤šä¸ªå›¢é˜ŸåŒæ—¶å¼€å±•ä¸åŒçš„å®éªŒã€‚ä¸ºç¡®ä¿å„å›¢é˜Ÿç ”ç©¶å·¥ä½œçš„ç‹¬ç«‹æ€§ä¸æ•°æ®å®‰å…¨æ€§ï¼Œéœ€è¦è¿›è¡Œå®‰å…¨çš„éš”ç¦»ï¼Œä»¥é¿å…æ•°æ®æ··æ·†ä¸æ³„éœ²ã€‚</li>
</ul>
<p>ä¸ºåº”å¯¹ä¸Šè¿°é‡åŒ–å…¨æµç¨‹å¯¹æ•°æ®å­˜å‚¨çš„éœ€æ±‚ï¼Œæ‰“é€ é¢å‘æœªæ¥çš„å­˜å‚¨ç³»ç»Ÿï¼Œ<strong>æˆ‘ä»¬çš„ç›®æ ‡æ˜¯å®ç°ï¼šé«˜æ€§èƒ½ã€æ˜“æ‰©å±•ä¸å¯æ²»ç†ï¼Œä¸‰è€…æœ‰æœºç»Ÿä¸€</strong>ï¼š</p>
<ul>
<li>é«˜æ€§èƒ½ï¼šå•èŠ‚ç‚¹è¯»å†™å¸¦å®½çªç ´ 500MB/sï¼Œè®¿é—®å»¶è¿Ÿä½äºæœ¬åœ°ç£ç›˜æ„ŸçŸ¥é˜ˆå€¼ï¼›</li>
<li>æ˜“æ‰©å±•ï¼šæ”¯æŒå­˜å‚¨ä¸è®¡ç®—èµ„æºæŒ‰éœ€æ°´å¹³æ‰©å®¹ï¼Œä¸šåŠ¡æ— éœ€æ”¹é€ å³å¯å®ç°å¹³æ»‘å¼¹æ€§ä¼¸ç¼©ï¼›</li>
<li>å¯æ²»ç†ï¼šæä¾›ç»†ç²’åº¦æƒé™æ§åˆ¶ã€æ“ä½œå®¡è®¡ä¸æ•°æ®ç”Ÿå‘½å‘¨æœŸç­–ç•¥çš„ä¸€ç«™å¼ç®¡ç†èƒ½åŠ›ã€‚</li>
</ul>
<h2 data-id="heading-1">02 å­˜å‚¨æ¶æ„çš„æ¼”è¿›</h2>
<h3 data-id="heading-2">é˜¶æ®µä¸€ï¼šæœ¬åœ°ç›˜æé€Ÿèµ·æ­¥</h3>
<p>åœ¨é¡¹ç›®åˆæœŸï¼Œæˆ‘ä»¬é‡‡ç”¨äº† Quantrabyte ç ”ç©¶æ¡†æ¶ï¼Œè¯¥æ¡†æ¶å†…ç½®äº† ETF æ¨¡å—ï¼Œå¯ç›´æ¥å°†æ•°æ®å­˜å‚¨åœ¨æœ¬åœ°ç£ç›˜ä¸Šï¼Œæ•°æ®è¯»å–é€Ÿåº¦è¾ƒå¿«ã€‚ç ”ç©¶å‘˜å¯æ ¹æ®è‡ªèº«éœ€æ±‚ï¼Œç›´æ¥è¿è¡Œæ‰€éœ€æ•°æ®ï¼Œè¿­ä»£è¿‡ç¨‹è¾ƒä¸ºè¿…é€Ÿã€‚ç„¶è€Œï¼Œè¿™ä¸€é˜¶æ®µä¹Ÿå­˜åœ¨ä¸€äº›é—®é¢˜ï¼š</p>
<ul>
<li>é‡å¤ä¸‹è½½é€ æˆèµ„æºæµªè´¹ï¼šå¤šä¸ªç ”ç©¶å‘˜è‹¥ä½¿ç”¨ç›¸åŒæ•°æ®ï¼Œä¼šè¿›è¡Œå¤šæ¬¡ä¸‹è½½ã€‚</li>
<li>å­˜å‚¨å®¹é‡ä¸è¶³ï¼šç ”ç©¶æœåŠ¡å™¨çš„å­˜å‚¨å®¹é‡æœ‰é™ï¼Œä»…çº¦ 15Tï¼Œéš¾ä»¥æ»¡è¶³æ—¥ç›Šå¢é•¿çš„æ•°æ®å­˜å‚¨éœ€æ±‚ã€‚</li>
<li>åä½œå›°éš¾ï¼šå½“éœ€è¦å¤ç”¨ä»–äººçš„ç ”ç©¶ç»“æœæ—¶ï¼Œæ“ä½œè¿‡ç¨‹ä¸å¤Ÿä¾¿æ·ã€‚</li>
</ul>
<h3 data-id="heading-3">é˜¶æ®µäºŒï¼šMinIO é›†ä¸­ç®¡ç†çš„åŒåˆƒå‰‘</h3>
<p>ä¸ºè§£å†³ç¬¬ä¸€é˜¶æ®µå­˜åœ¨çš„é—®é¢˜ï¼Œæˆ‘ä»¬å¼•å…¥äº† MinIO è¿›è¡Œé›†ä¸­ç®¡ç†ã€‚å°†æ‰€æœ‰å­˜å‚¨æ•°æ®é›†ä¸­åœ¨ MinIO ä¸Šï¼Œé€šè¿‡æ‹†åˆ†å‡ºçš„æ¨¡å—å°†æ•°æ®å…¨éƒ¨å­˜å…¥ã€‚åŒæ—¶ï¼Œå°†å…·ä½“å› å­æ•°æ®ä¹Ÿå­˜å…¥ MinIOï¼Œå®ç°å…¬å…±æ•°æ®çš„ç»Ÿä¸€ä¸‹è½½ã€‚å¹¶é€šè¿‡æƒé™éš”ç¦»ï¼Œå®ç°å¤šå›¢é˜Ÿæ•°æ®å…±äº«ï¼Œæå‡å­˜å‚¨ç©ºé—´åˆ©ç”¨ç‡ã€‚</p>
<p>ç„¶è€Œï¼Œè¿™ä¸€é˜¶æ®µä¹Ÿå‡ºç°äº†æ–°çš„ç“¶é¢ˆï¼š</p>
<ul>
<li>é«˜é¢‘éšæœºè¯»å»¶è¿Ÿå¤§ï¼šåœ¨è¿›è¡Œé«˜é¢‘æ•°æ® I/O æ“ä½œæ—¶å»¶è¿Ÿè¾ƒå¤§ï¼Œå½±å“æ•°æ®è¯»å–é€Ÿåº¦ã€‚</li>
<li>æ— ç¼“å­˜å¯¼è‡´è¯»å†™æ…¢ï¼šç”±äº MinIO ç¤¾åŒºç‰ˆæ— ç¼“å­˜åŠŸèƒ½ï¼Œè¯»å†™é«˜é¢‘å…¬å…±æ•°æ®æ—¶é€Ÿåº¦è¾ƒæ…¢ã€‚</li>
</ul>
<h3 data-id="heading-4">é˜¶æ®µä¸‰ï¼šJuiceFS å¼•å…¥ç¼“å­˜åŠ é€Ÿ</h3>
<p>ä¸ºè§£å†³ä¸Šè¿°ç“¶é¢ˆï¼Œç»å……åˆ†è°ƒç ”ï¼Œæˆ‘ä»¬æœ€ç»ˆå¼•å…¥ JuiceFS çš„ç¼“å­˜åŠ é€Ÿæ–¹æ¡ˆã€‚è¯¥æ–¹æ¡ˆé€šè¿‡å®¢æˆ·ç«¯æœ¬åœ° RAID5 å­˜å‚¨è¿›è¡ŒæŒ‚è½½ï¼Œå€ŸåŠ©é«˜æ•ˆçš„ç¼“å­˜æœºåˆ¶ï¼Œ<strong>æˆåŠŸå°†è¯»å†™æ€§èƒ½æå‡çº¦ä¸‰å€ï¼Œæ˜¾è‘—æ”¹å–„äº†é«˜é¢‘å…±äº«æ•°æ®çš„è®¿é—®ä½“éªŒ</strong>ã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/13e0899c549a417ca221b6ee99269d62~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSnVpY2VGUw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765791506&amp;x-signature=7kgwbZYF8ZzobKMcZH18m9JVGbw%3D" alt="" loading="lazy"/></p>
<p>éšç€ä¸šåŠ¡æ•°æ®é‡çªç ´ 300TBï¼Œæœ¬åœ°å­˜å‚¨çš„æ‰©å®¹ç“¶é¢ˆé€æ¸æ˜¾ç°ã€‚ç”±äºæ•°æ®å­˜å‚¨åœ¨æœ¬åœ°ï¼Œæ‰©å®¹éœ€é‡æ–°é…ç½®å­˜å‚¨è®¾å¤‡ï¼Œè€Œ RAID5 æ¶æ„ä¸‹æ‰©å®¹é€Ÿåº¦ç¼“æ…¢ä¸”é£é™©è¾ƒé«˜ï¼Œéš¾ä»¥æ»¡è¶³ä¸šåŠ¡æŒç»­å¢é•¿çš„éœ€æ±‚ã€‚</p>
<h3 data-id="heading-5">é˜¶æ®µå››ï¼šJuiceFS + MinIO é›†ç¾¤ç»ˆå±€æ¶æ„</h3>
<p>ä¸ºè§£å†³æ‰©å®¹éš¾é¢˜ï¼Œæˆ‘ä»¬æœ€ç»ˆé‡‡ç”¨äº†JuiceFS+MinIO é›†ç¾¤æ¶æ„ã€‚è¯¥æ–¹æ¡ˆå…·å¤‡ä»¥ä¸‹ä¼˜åŠ¿ï¼š</p>
<ul>
<li>æŒç»­é«˜æ€§èƒ½ï¼šJuiceFS æä¾›å……è¶³çš„ç¼“å­˜èƒ½åŠ›ï¼Œå……åˆ†æ»¡è¶³é«˜é¢‘æ•°æ®è®¿é—®åœºæ™¯çš„æ€§èƒ½éœ€æ±‚ï¼›</li>
<li>ä¾¿æ·é›†ç¾¤æ‰©å±•ï¼šåŸºäºé›†ç¾¤åŒ–æ–¹æ¡ˆï¼Œå¯å¿«é€Ÿå®ç°æ¨ªå‘æ‰©å®¹ï¼Œä»…éœ€æ·»åŠ åŒç±»å‹ç£ç›˜å³å¯çµæ´»æå‡å­˜å‚¨å®¹é‡ï¼Œå¤§å¹…å¢å¼ºç³»ç»Ÿæ‰©å±•æ€§ã€‚</li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/65805ffd8db9418db4459baa08c599c5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSnVpY2VGUw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765791506&amp;x-signature=c9is2ftDHq34Y%2BAuPREbNMvB%2FCg%3D" alt="" loading="lazy"/></p>
<p><strong>é€šè¿‡å››é˜¶æ®µæ¼”è¿›ï¼Œæˆ‘ä»¬éªŒè¯äº†ç¼“å­˜åŠ é€Ÿã€å¼¹æ€§å¯¹è±¡å­˜å‚¨ä¸ POSIX å…¼å®¹ä¸‰ä½ä¸€ä½“æ–¹æ¡ˆåœ¨é‡åŒ–åœºæ™¯çš„å¯è¡Œæ€§</strong>ã€‚æ­¤æ–¹æ¡ˆå¯ä¸ºåŒè¡Œä¸šæä¾›å¯å¤åˆ¶ã€å¯è½åœ°çš„æœ€ä½³å®è·µèŒƒæœ¬ï¼Œåœ¨æ€§èƒ½ã€æˆæœ¬ä¸æ²»ç†ä¹‹é—´å–å¾—äº†å“è¶Šå¹³è¡¡ã€‚</p>
<h2 data-id="heading-6">03 æ€§èƒ½ä¸æˆæœ¬æ”¶ç›Š</h2>
<p>é€šè¿‡é‡‡ç”¨ JuiceFS ä¸ MinIOç›¸ ç»“åˆçš„å­˜å‚¨æ¶æ„ï¼Œç³»ç»Ÿå¸¦å®½ä¸èµ„æºåˆ©ç”¨æ•ˆç‡å¾—åˆ°è´¨çš„é£è·ƒï¼Œç›®å‰å·²å®Œå…¨æ»¡è¶³ç ”ç©¶ä¸šåŠ¡å¯¹å­˜å‚¨æ€§èƒ½çš„éœ€æ±‚ã€‚å¼•å…¥ JuiceFS ç¼“å­˜å±‚åï¼Œ<strong>å›æµ‹ä»»åŠ¡æ‰§è¡Œæ•ˆç‡å¤§å¹…æé«˜ï¼Œ1 äº¿æ¡ Tick æ•°æ®å›æµ‹è€—æ—¶ç”±ä¹‹å‰çš„æ•°å°æ—¶é™è‡³æ•°ååˆ†é’Ÿ</strong>ã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/806ffdaa142543e18b01f00412955e07~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSnVpY2VGUw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765791506&amp;x-signature=kzcFFuF6w7dcWTbwzOtLsl7fkR0%3D" alt="" loading="lazy"/></p>
<p>åŒæ—¶ï¼ŒåŸºäºæˆ‘ä»¬å®Œæ•´çš„æ•°æ®ç”Ÿå‘½å‘¨æœŸåˆ†å±‚å­˜å‚¨ä½“ç³»ç­–ç•¥ï¼Œå®ç°å­˜å‚¨å•ä»·ç”±é«˜åˆ°ä½çš„å¹³æ»‘è¿‡æ¸¡ï¼Œæ•´ä½“å­˜å‚¨æˆæœ¬ä¸‹é™40% ä»¥ä¸Šã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5592715e44c94eadb18e7b2824695f12~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSnVpY2VGUw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765791506&amp;x-signature=fhx6hZI5XI6Xt151FznhirId7eM%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-7">04 è¿ç»´å®è·µä¸å±•æœ›</h2>
<h3 data-id="heading-8">å¤šç§Ÿæˆ·æ²»ç†</h3>
<p>åœ¨æ•°æ®éš”ç¦»ä¸æƒé™ç®¡ç†æ–¹é¢ï¼Œæˆ‘ä»¬å»ºç«‹äº†å®Œå–„çš„ç®¡ç†ä½“ç³»ï¼š</p>
<p>é€šè¿‡å‘½åç©ºé—´å®ç°é€»è¾‘éš”ç¦»ï¼Œé‡‡ç”¨ç±»ä¼¼ <code>/factor/A</code>ã€<code>/factor/B</code> çš„è·¯å¾„è§„åˆ’ï¼Œç¡®ä¿å„ä¸šåŠ¡æ•°æ®è¾¹ç•Œæ¸…æ™°ã€‚åœ¨æƒé™æ§åˆ¶å±‚é¢ï¼Œæ”¯æŒç”¨æˆ·ã€å›¢é˜Ÿã€é¡¹ç›®ä¸‰ä¸ªç»´åº¦çš„ç²¾ç»†åŒ–ç®¡ç†ï¼Œå¹¶ä¸ POSIX ACL æƒé™ä½“ç³»æ— ç¼å¯¹æ¥ã€‚åŒæ—¶å»ºç«‹å®Œæ•´çš„å®¡è®¡æ—¥å¿—ç³»ç»Ÿï¼Œå®ç°è®¿é—®è¡Œä¸ºçš„å®æ—¶è¿½è¸ªä¸å˜æ›´å†å²å›æº¯ï¼Œå…¨é¢æ»¡è¶³åˆè§„æ€§è¦æ±‚ã€‚</p>
<h3 data-id="heading-9">å¯è§‚æµ‹æ€§ä¸è‡ªåŠ¨åŒ–è¿ç»´</h3>
<p><strong>æˆ‘ä»¬å›´ç»•å››å¤§æ ¸å¿ƒæŒ‡æ ‡æ„å»ºäº†å®Œæ•´çš„ç›‘æ§ä½“ç³»ï¼šç¼“å­˜å‘½ä¸­ç‡ã€I/O ååé‡ã€I/O å»¶è¿Ÿä¸å†™å…¥é‡è¯•ç‡ï¼Œç³»ç»Ÿåœ¨æŒ‡æ ‡å¼‚å¸¸æ—¶å¯è‡ªåŠ¨è§¦å‘å‘Šè­¦</strong>ã€‚</p>
<p>åŸºäº Grafana å®ç°äº†è¿ç»´é—­ç¯ç®¡ç†ï¼ŒæŒç»­ç›‘æ§èŠ‚ç‚¹å¥åº·çŠ¶æ€ä¸å­˜å‚¨å®¹é‡ã€‚åœ¨æ¯æ¬¡æ‰©å®¹å‰ï¼Œä¼šé€šè¿‡æ¨¡æ‹Ÿå‹æµ‹éªŒè¯ç³»ç»Ÿæ‰¿è½½èƒ½åŠ›ï¼Œç¡®ä¿ä¸šåŠ¡æ— æ„ŸçŸ¥ã€‚æ•´ä½“è¿ç»´ä½“ç³»å®ç°äº†è‡ªåŠ¨åŒ–ã€å¯é¢„æµ‹ã€å¯å›æ»šçš„é«˜æ ‡å‡†è¿ç»´ç›®æ ‡ã€‚</p>
<h3 data-id="heading-10">å›æµ‹ç³»ç»Ÿä¸­çš„æ•°æ®æ›´æ–°è®¾è®¡</h3>
<p>æˆ‘ä»¬åœ¨å›æµ‹ç³»ç»Ÿè®¾è®¡ä¸­é‡‡ç”¨åŸºäº DAGï¼ˆDirected Acyclic Graphï¼Œæœ‰å‘æ— ç¯å›¾ï¼‰çš„æ¶æ„ï¼Œä»¥æå‡ç³»ç»Ÿçš„è®¡ç®—æ•ˆç‡ä¸å¯ç»´æŠ¤æ€§ã€‚<strong>è¯¥æ¡†æ¶ä»¥è®¡ç®—èŠ‚ç‚¹å’Œä¾èµ–å…³ç³»ä¸ºæ ¸å¿ƒï¼Œå°†æ•°æ®å¤„ç†ã€ç‰¹å¾è®¡ç®—ã€ä¿¡å·ç”Ÿæˆç­‰ç¯èŠ‚æŠ½è±¡ä¸ºèŠ‚ç‚¹ï¼Œå¹¶é€šè¿‡ä¾èµ–å›¾ç»Ÿä¸€ç®¡ç†</strong>ã€‚ç³»ç»Ÿå†…ç½®ç‰ˆæœ¬æ§åˆ¶æœºåˆ¶ï¼Œå½“æ•°æ®ç‰ˆæœ¬æ›´æ–°æ—¶ï¼Œå¯ä¾æ‰˜ä¾èµ–å›¾è‡ªåŠ¨è¯†åˆ«å—å½±å“çš„èŠ‚ç‚¹ï¼Œç²¾ç¡®å®šä½éœ€é‡ç®—éƒ¨åˆ†ï¼Œä»è€Œå®ç°é«˜æ•ˆçš„å¢é‡æ›´æ–°ä¸ç»“æœè¿½æº¯ã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/19116a3229954b53a3588d69f9d01090~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSnVpY2VGUw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765791506&amp;x-signature=X%2FRuoWwZTit9SA7gUItiC131pUA%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-11">æœªæ¥å±•æœ›</h2>
<p>åœ¨æœªæ¥è§„åˆ’ä¸­ï¼Œæˆ‘ä»¬å°†ä»ä»¥ä¸‹ä¸‰ä¸ªæ–¹å‘æŒç»­ä¼˜åŒ–å­˜å‚¨æ¶æ„ï¼š</p>
<ol>
<li>å…ƒæ•°æ®é«˜å¯ç”¨å‡çº§ï¼šè®¡åˆ’å°†å…ƒæ•°æ®å­˜å‚¨ä» Redis è¿ç§»è‡³ TiKV æˆ– PostgreSQLï¼Œä»¥æ„å»ºè·¨æœºæˆ¿é«˜å¯ç”¨æ¶æ„ï¼Œæ˜¾è‘—æå‡ç³»ç»Ÿå®¹ç¾ä¸å¿«é€Ÿæ¢å¤èƒ½åŠ›ã€‚</li>
<li>æ··åˆäº‘åˆ†å±‚å­˜å‚¨ï¼šé€šè¿‡å¯¹æ¥å…¬æœ‰äº‘ S3 ä¸ Glacier å­˜å‚¨æœåŠ¡ï¼Œæ„å»ºæ™ºèƒ½å†·çƒ­åˆ†å±‚ä½“ç³»ï¼Œåœ¨å®ç°å­˜å‚¨å®¹é‡æ— é™å¼¹æ€§çš„åŒæ—¶ï¼Œè¾¾æˆæˆæœ¬æœ€ä¼˜åŒ–ç›®æ ‡ã€‚</li>
<li>ç ”ç©¶æ•°æ®æ¹–ç»Ÿä¸€æ²»ç†ï¼šè®¡åˆ’æ„å»ºç»Ÿä¸€çš„ç ”ç©¶æ•°æ®æ¹–å¹³å°ï¼Œé›†æˆ Schema æ³¨å†Œã€è‡ªåŠ¨æ•°æ®æ¸…æ´—ä¸ç»Ÿä¸€ç›®å½•æ²»ç†ç­‰æ ¸å¿ƒæœåŠ¡ï¼Œå…¨é¢æå‡æ•°æ®èµ„äº§çš„å‘ç°ä¸ç®¡ç†æ•ˆç‡ã€‚</li>
</ol>
<p>æˆ‘ä»¬å¸Œæœ›æœ¬æ–‡ä¸­çš„ä¸€äº›å®è·µç»éªŒï¼Œèƒ½ä¸ºæ­£åœ¨é¢ä¸´ç±»ä¼¼é—®é¢˜çš„å¼€å‘è€…æä¾›å‚è€ƒï¼Œå¦‚æœæœ‰å…¶ä»–ç–‘é—®æ¬¢è¿åŠ å…¥Â <a href="https://link.juejin.cn?target=https%3A%2F%2Fjuicefs.com%2Fzh-cn%2F" target="_blank" title="https://juicefs.com/zh-cn/" ref="nofollow noopener noreferrer">JuiceFS ç¤¾åŒº</a>ä¸å¤§å®¶å…±åŒäº¤æµã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ä¸ºä»€ä¹ˆspringbootä¾èµ–ä¸å†™ç‰ˆæœ¬å·ï¼Ÿ]]></title>    <link>https://juejin.cn/post/7581041679190687779</link>    <guid>https://juejin.cn/post/7581041679190687779</guid>    <pubDate>2025-12-08T09:19:35.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581041679190687779" data-draft-id="7581292270960869386" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ä¸ºä»€ä¹ˆspringbootä¾èµ–ä¸å†™ç‰ˆæœ¬å·ï¼Ÿ"/> <meta itemprop="keywords" content="åç«¯"/> <meta itemprop="datePublished" content="2025-12-08T09:19:35.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="æˆ‘æ˜¯å¤©é¾™_ç»"/> <meta itemprop="url" content="https://juejin.cn/user/1831109918994644"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ä¸ºä»€ä¹ˆspringbootä¾èµ–ä¸å†™ç‰ˆæœ¬å·ï¼Ÿ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1831109918994644/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    æˆ‘æ˜¯å¤©é¾™_ç»
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-08T09:19:35.000Z" title="Mon Dec 08 2025 09:19:35 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»1åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#595959;font-size:15px;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(60,10,30,.04) 3%,transparent 0),linear-gradient(1turn,rgba(60,10,30,.04) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body p{color:#595959;font-size:15px;line-height:2;font-weight:400}.markdown-body p+p{margin-top:16px}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin:0;color:#135ce0}.markdown-body h1{position:relative;text-align:center;font-size:22px;margin:50px 0}.markdown-body h1:before{position:absolute;content:"";top:-10px;left:50%;width:32px;height:32px;transform:translateX(-50%);background-size:100% 100%;opacity:.36;background-repeat:no-repeat;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAABfVBMVEX///8Ad/8AgP8AgP8AgP8Aff8AgP8Af/8AgP8AVf8Af/8Af/8AgP8AgP8Af/8Afv8AAP8Afv8Afv8Aef8AgP8AdP8Afv8AgP8AgP8Acf8Ae/8AgP8Af/8AgP8Af/8Af/8AfP8Afv8AgP8Af/8Af/8Afv8Afv8AgP8Afv8AgP8Af/8Af/8AgP8AgP8Afv8AgP8Af/8AgP8AgP8AgP8Ae/8Afv8Af/8AgP8Af/8AgP8Af/8Af/8Aff8Af/8Abf8AgP8Af/8AgP8Af/8Af/8Afv8AgP8AgP8Afv8Afv8AgP8Af/8Aff8AgP8Afv8AgP8Aff8AgP8AfP8AgP8Ae/8AgP8Af/8AgP8AgP8AgP8Afv8AgP8AgP8AgP8Afv8AgP8AgP8AgP8AgP8AgP8Af/8AgP8Af/8Af/8Aev8Af/8AgP8Aff8Afv8AgP8AgP8AgP8Af/8AgP8Af/8Af/8AgP8Afv8AgP8AgP8AgP8AgP8Af/8AeP8Af/8Af/8Af//////rzEHnAAAAfXRSTlMAD7CCAivatxIDx5EMrP19AXdLEwgLR+6iCR/M0yLRzyFF7JupSXn8cw6v60Q0QeqzKtgeG237HMne850/6Qeq7QaZ+WdydHtj+OM3qENCMRYl1B3K2U7wnlWE/mhlirjkODa9FN/BF7/iNV/2kASNZpX1Wlf03C4stRGxgUPclqoAAAABYktHRACIBR1IAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH4gEaBzgZ4yeM3AAAAT9JREFUOMvNUldbwkAQvCAqsSBoABE7asSOBRUVVBQNNuy9996789+9cMFAMHnVebmdm+/bmdtbQv4dOFOW2UjPzgFyLfo6nweKfIMOBYWwFtmMPGz2Yj2pJI0JDq3udJW6VVbmKa9I192VQFV1ktXUAl5NB0cd4KpnORqsEO2ZIRpF9gJfE9Dckqq0KuZt7UAH5+8EPF3spjsRpCeQNO/tA/qDwIDA+OCQbBoKA8NOdjMySgcZGVM6jwcgRuUiSs0nlPFNSrEpJfU0jTLD6llqbvKxei7OzvkFNQohi0vAsj81+MoqsCaoPOQFgus/1LyxichW+hS2JWCHZ7VlF9jb187pIAYcHiViHAMnp5mTjJ8B5xeEXF4B1ze/fTh/C0h398DDI9HB07O8ci+vRBdvdGnfP4gBuM8vw7X/G3wDmFhFZEdxzjMAAAAldEVYdGRhdGU6Y3JlYXRlADIwMTgtMDEtMjZUMDc6NTY6MjUrMDE6MDA67pVWAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDE4LTAxLTI2VDA3OjU2OjI1KzAxOjAwS7Mt6gAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAAWdEVYdFRpdGxlAGp1ZWppbl9sb2dvIGNvcHlxapmKAAAAV3pUWHRSYXcgcHJvZmlsZSB0eXBlIGlwdGMAAHic4/IMCHFWKCjKT8vMSeVSAAMjCy5jCxMjE0uTFAMTIESANMNkAyOzVCDL2NTIxMzEHMQHy4BIoEouAOoXEXTyQjWVAAAAAElFTkSuQmCC)}.markdown-body h2{position:relative;font-size:20px;border-left:4px solid;padding:0 0 0 10px;margin:30px 0}.markdown-body h3{font-size:16px}.markdown-body ul{list-style:disc outside;margin-left:2em;margin-top:1em}.markdown-body li{line-height:2;color:#595959}.markdown-body img.loaded{margin:0 auto;display:block}.markdown-body blockquote{background:#fff9f9;margin:2em 0;padding:2px 20px;border-left:4px solid #b2aec5}.markdown-body blockquote p{color:#666;line-height:2}.markdown-body a{color:#036aca;border-bottom:1px solid rgba(3,106,202,.8);font-weight:400;text-decoration:none}.markdown-body em strong,.markdown-body strong{color:#036aca}.markdown-body hr{border-top:1px solid #135ce0}.markdown-body pre{overflow:auto}.markdown-body code,.markdown-body pre{overflow:auto;position:relative;line-height:1.75;font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body table{border-collapse:collapse;margin:1rem 0;overflow-x:auto}.markdown-body table td,.markdown-body table th{border:1px solid #dfe2e5;padding:.6em 1em}.markdown-body table tr{border-top:1px solid #dfe2e5}.markdown-body table tr:nth-child(2n){background-color:#f6f8fa}</style><style data-highlight="" data-highlight-key="a11y-dark">.hljs-comment,.hljs-quote{color:#d4d0ab}.hljs-deletion,.hljs-name,.hljs-regexp,.hljs-selector-class,.hljs-selector-id,.hljs-tag,.hljs-template-variable,.hljs-variable{color:#ffa07a}.hljs-built_in,.hljs-builtin-name,.hljs-link,.hljs-literal,.hljs-meta,.hljs-number,.hljs-params,.hljs-type{color:#f5ab35}.hljs-attribute{color:gold}.hljs-addition,.hljs-bullet,.hljs-string,.hljs-symbol{color:#abe338}.hljs-section,.hljs-title{color:#00e0e0}.hljs-keyword,.hljs-selector-tag{color:#dcc6e0}.markdown-body pre,.markdown-body pre&gt;code.hljs{background:#2b2b2b;color:#f8f8f2}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}@media screen and (-ms-high-contrast:active){.hljs-addition,.hljs-attribute,.hljs-built_in,.hljs-builtin-name,.hljs-bullet,.hljs-comment,.hljs-link,.hljs-literal,.hljs-meta,.hljs-number,.hljs-params,.hljs-quote,.hljs-string,.hljs-symbol,.hljs-type{color:highlight}.hljs-keyword,.hljs-selector-tag{font-weight:700}}</style><pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
</code></pre>
<p>æœ‰æ—¶å€™æˆ‘ä»¬çœ‹åˆ°<code>SpringBoot</code>é¡¹ç›®çš„ä¾èµ–ä¸å†™ç‰ˆæœ¬å·ï¼Œä¸ºä»€ä¹ˆè¿™æ ·å‘¢ï¼Ÿè¿™æ ·å¯ä»¥å—ï¼Ÿä¸ºä»€ä¹ˆä¸æŠ¥é”™ï¼Ÿ</p>
<p>ä¹Ÿå°±æ˜¯è¯´ä¸ºä»€ä¹ˆåœ¨æœ‰çš„springé¡¹ç›®ä¸­çš„mavené…ç½®ä¸­ï¼Œå†™ä¾èµ–<code>&lt;dependencies&gt;</code>æ—¶ï¼Œæœ‰çš„ä¸ç”¨å†™ç‰ˆæœ¬å·<code>&lt;version&gt;</code></p>
<p>ä¸ºä»€ä¹ˆåœ¨æœ‰çš„springé¡¹ç›®ä¸­çš„mavené…ç½®ä¸­ï¼Œå†™ä¾èµ–æ—¶ï¼Œæœ‰çš„ä¸ç”¨å†™ç‰ˆæœ¬å·</p>
<p>ä¸€ã€ç¬¬ä¸€ç§æƒ…å†µï¼š</p>
<pre><code class="hljs language-java" lang="java">&lt;dependencies&gt;
    &lt;dependency&gt;
        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
        &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;
    &lt;/dependency&gt;
&lt;/dependencies&gt;
</code></pre>
<p>å¦‚åŒä»¥ä¸Š</p>
<p>ä¸€èˆ¬å‡ºç°è¿™ç§æƒ…å†µï¼Œæ˜¯å› ä¸ºã€‚</p>
<ol>
<li>ç»§æ‰¿äº†spring-bootçš„é…ç½®,è¿™é‡Œå¼•å…¥spring-boot-starter-parentçš„å¥½å¤„æ˜¯åœ¨æ·»åŠ å¯åŠ¨å™¨æ—¶ä¸ç”¨ç”³æ˜ç‰ˆæœ¬å·ï¼</li>
</ol>
<pre><code class="hljs language-java" lang="java">&lt;parent&gt;
    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
    &lt;artifactId&gt;spring-boot-starter-parent&lt;/artifactId&gt;
    &lt;version&gt;<span class="hljs-number">1.3</span><span class="hljs-number">.3</span>.RELEASE&lt;/version&gt;
&lt;/parent&gt;
</code></pre>
<p><strong>å› ä¸ºæ·»åŠ äº†æ ‡ç­¾</strong></p>
<p>spring-boot-starter-parenthä¼šä¸ºæˆ‘ä»¬æä¾›å¸¸ç”¨jaråŒ…ç‰ˆæœ¬ï¼Œå…¶å®ä¸æ˜¯ä¸ç”¨æŒ‡å®šï¼Œæ˜¯äººå®¶ä¸ºæˆ‘ä»¬æŒ‡å®šå¥½äº†ã€‚</p>
<p>è‡ªå·±æŒ‡å®šç‰ˆæœ¬å·ä¹Ÿå¯ä»¥ï¼Œä¼šè¦†ç›–å®˜æ–¹ç‰ˆæœ¬ï¼Œè¿™æ—¶å¯ä»¥ç”¨mavenÂ helperæŸ¥çœ‹ä¸€ä¸‹æœ‰æ²¡æœ‰å†²çªå³å¯ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[å¦‚ä½•å®ç°ä¸€ä¸ªMCPæœåŠ¡å™¨]]></title>    <link>https://juejin.cn/post/7581306080434110515</link>    <guid>https://juejin.cn/post/7581306080434110515</guid>    <pubDate>2025-12-08T09:11:15.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581306080434110515" data-draft-id="7581297888807944242" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="å¦‚ä½•å®ç°ä¸€ä¸ªMCPæœåŠ¡å™¨"/> <meta itemprop="keywords" content="å‰ç«¯"/> <meta itemprop="datePublished" content="2025-12-08T09:11:15.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ç¬¦æ–¹æ˜Š"/> <meta itemprop="url" content="https://juejin.cn/user/2005988778191245"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            å¦‚ä½•å®ç°ä¸€ä¸ªMCPæœåŠ¡å™¨
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2005988778191245/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ç¬¦æ–¹æ˜Š
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-08T09:11:15.000Z" title="Mon Dec 08 2025 09:11:15 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»3åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">é¡¹ç›®ç»“æ„</h2>
<pre><code class="hljs language-bash" lang="bash">src/
â”œâ”€â”€ index.ts             <span class="hljs-comment"># å…¥å£æ–‡ä»¶</span>
â”œâ”€â”€ server.ts            <span class="hljs-comment"># æœåŠ¡å™¨å¯åŠ¨é€»è¾‘</span>
â”œâ”€â”€ common/              <span class="hljs-comment"># å…¬å…±æ¨¡å—</span>
â”‚   â””â”€â”€ index.ts         <span class="hljs-comment"># é…ç½®å’Œå·¥å…·å‡½æ•°</span>
â”œâ”€â”€ tools/               <span class="hljs-comment"># MCPå·¥å…·å®ç°</span>
â”‚   â”œâ”€â”€ index.ts         <span class="hljs-comment"># å·¥å…·æ³¨å†Œ</span>
â”‚   â””â”€â”€ manage/          <span class="hljs-comment"># ä¸šåŠ¡åŠŸèƒ½</span>
â”‚       â”œâ”€â”€ upload-rule.ts
â”‚       â””â”€â”€ download.ts
â””â”€â”€ utils/               <span class="hljs-comment"># å·¥å…·å‡½æ•°</span>
    â”œâ”€â”€ common.ts
    â”œâ”€â”€ uploadCommon.ts
    â””â”€â”€ workspaceScanner.ts
</code></pre>
<h2 data-id="heading-1">æ ¸å¿ƒä¾èµ–</h2>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"@modelcontextprotocol/sdk"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"^1.10.2"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"axios"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"^1.10.0"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"form-data"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"^4.0.4"</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h2 data-id="heading-2">1. é¡¹ç›®åˆå§‹åŒ–</h2>
<h3 data-id="heading-3">package.jsoné…ç½®</h3>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"@company/mcp-server-demo"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"module"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"main"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"./dist/index.js"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"bin"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"mcp-server-demo"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"./dist/index.js"</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h3 data-id="heading-4">tsconfig.jsoné…ç½®</h3>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"compilerOptions"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"target"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"esnext"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"module"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"esnext"</span><span class="hljs-punctuation">,</span> 
    <span class="hljs-attr">"moduleResolution"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"node"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"outDir"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"./dist"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"esModuleInterop"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h2 data-id="heading-5">2. å…¥å£æ–‡ä»¶å®ç°</h2>
<h3 data-id="heading-6">src/index.ts</h3>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-meta">#!/usr/bin/env node</span>

<span class="hljs-keyword">import</span> { <span class="hljs-title class_">Server</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"@modelcontextprotocol/sdk/server/index.js"</span>;
<span class="hljs-keyword">import</span> { startServer } <span class="hljs-keyword">from</span> <span class="hljs-string">"./server.js"</span>;
<span class="hljs-keyword">import</span> { registerBusinessTool } <span class="hljs-keyword">from</span> <span class="hljs-string">"./tools/index.js"</span>;

<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">main</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">const</span> server = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Server</span>({
        <span class="hljs-attr">name</span>: packageInfo.<span class="hljs-property">name</span>,
        <span class="hljs-attr">version</span>: packageInfo.<span class="hljs-property">version</span>,
    }, {
        <span class="hljs-attr">capabilities</span>: {
            <span class="hljs-attr">tools</span>: {
                <span class="hljs-attr">listChanged</span>: <span class="hljs-literal">true</span>,
            },
        },
    });

    <span class="hljs-comment">// æ³¨å†Œå·¥å…·</span>
    <span class="hljs-title function_">registerBusinessTool</span>(server);
    
    <span class="hljs-comment">// å¯åŠ¨æœåŠ¡</span>
    <span class="hljs-keyword">await</span> <span class="hljs-title function_">startServer</span>(server);
}

<span class="hljs-title function_">main</span>();
</code></pre>
<h2 data-id="heading-7">3. æœåŠ¡å™¨å¯åŠ¨é€»è¾‘</h2>
<h3 data-id="heading-8">src/server.ts</h3>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> { <span class="hljs-title class_">StdioServerTransport</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"@modelcontextprotocol/sdk/server/stdio.js"</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">Server</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"@modelcontextprotocol/sdk/server/index.js"</span>;

<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">startStdioMode</span>(<span class="hljs-params">server: Server</span>) {
    <span class="hljs-keyword">const</span> transport = <span class="hljs-keyword">new</span> <span class="hljs-title class_">StdioServerTransport</span>();
    <span class="hljs-keyword">await</span> server.<span class="hljs-title function_">connect</span>(transport);
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">startServer</span>(<span class="hljs-params">server: Server</span>) {
    <span class="hljs-keyword">try</span> {
        <span class="hljs-keyword">await</span> <span class="hljs-title function_">startStdioMode</span>(server);
    } <span class="hljs-keyword">catch</span> (error) {
        process.<span class="hljs-title function_">exit</span>(<span class="hljs-number">1</span>);
    }
}
</code></pre>
<h2 data-id="heading-9">4. å·¥å…·æ³¨å†Œä¸å®ç°</h2>
<h3 data-id="heading-10">src/tools/index.ts</h3>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> { <span class="hljs-title class_">Server</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"@modelcontextprotocol/sdk/server/index.js"</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">CallToolRequestSchema</span>, <span class="hljs-title class_">ListToolsRequestSchema</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"@modelcontextprotocol/sdk/types.js"</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">registerBusinessTool</span>(<span class="hljs-params">server: Server</span>) {
    <span class="hljs-comment">// æ³¨å†Œå·¥å…·åˆ—è¡¨</span>
    server.<span class="hljs-title function_">setRequestHandler</span>(<span class="hljs-title class_">ListToolsRequestSchema</span>, <span class="hljs-keyword">async</span> () =&gt; ({
        <span class="hljs-attr">tools</span>: [
            <span class="hljs-variable constant_">UPLOAD_RULE_TOOL</span>,
            <span class="hljs-variable constant_">DOWNLOAD_PROJECT_RULES_TOOL</span>,
        ],
    }));

    <span class="hljs-comment">// æ³¨å†Œå·¥å…·è°ƒç”¨å¤„ç†å™¨</span>
    server.<span class="hljs-title function_">setRequestHandler</span>(<span class="hljs-title class_">CallToolRequestSchema</span>, <span class="hljs-keyword">async</span> (<span class="hljs-attr">request</span>: <span class="hljs-built_in">any</span>) =&gt; {
        <span class="hljs-keyword">switch</span> (request.<span class="hljs-property">params</span>.<span class="hljs-property">name</span>) {
            <span class="hljs-keyword">case</span> <span class="hljs-string">"upload_rule"</span>:
                <span class="hljs-keyword">return</span> <span class="hljs-keyword">await</span> <span class="hljs-title function_">handleUploadRule</span>(request);
            <span class="hljs-keyword">case</span> <span class="hljs-string">"get_download_rules"</span>:
                <span class="hljs-keyword">return</span> <span class="hljs-keyword">await</span> <span class="hljs-title function_">handleDownloadRules</span>(request);
            <span class="hljs-attr">default</span>:
                <span class="hljs-keyword">return</span> {
                    <span class="hljs-attr">content</span>: [{ <span class="hljs-attr">type</span>: <span class="hljs-string">"text"</span>, <span class="hljs-attr">text</span>: <span class="hljs-string">`Unknown tool: <span class="hljs-subst">${request.params.name}</span>`</span> }],
                    <span class="hljs-attr">isError</span>: <span class="hljs-literal">true</span>
                };
        }
    });
}
</code></pre>
<h2 data-id="heading-11">5. å·¥å…·å®šä¹‰</h2>
<h3 data-id="heading-12">ä¸Šä¼ å·¥å…·å®šä¹‰</h3>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-variable constant_">UPLOAD_RULE_TOOL</span> = {
    <span class="hljs-attr">name</span>: <span class="hljs-string">'upload'</span>,
    <span class="hljs-attr">description</span>: <span class="hljs-string">'ä¸Šä¼ æ–‡ä»¶'</span>,
    <span class="hljs-attr">inputSchema</span>: {
        <span class="hljs-attr">type</span>: <span class="hljs-string">'object'</span>,
        <span class="hljs-attr">properties</span>: {
            <span class="hljs-attr">filePaths</span>: {
                <span class="hljs-attr">type</span>: <span class="hljs-string">'array'</span>,
                <span class="hljs-attr">items</span>: { <span class="hljs-attr">type</span>: <span class="hljs-string">'string'</span> },
                <span class="hljs-attr">description</span>: <span class="hljs-string">'è¦ä¸Šä¼ çš„æ–‡ä»¶è·¯å¾„åˆ—è¡¨(å¿…é¡»æ˜¯ç»å¯¹è·¯å¾„)'</span>
            },
            <span class="hljs-attr">teamSelection</span>: {
                <span class="hljs-attr">type</span>: <span class="hljs-string">'string'</span>,
                <span class="hljs-attr">description</span>: <span class="hljs-string">'å›¢é˜Ÿé€‰æ‹©ï¼Œå¦‚ï¼šfrontendã€backendã€testingç­‰'</span>
            },
            <span class="hljs-attr">ruleTypeName</span>: {
                <span class="hljs-attr">type</span>: <span class="hljs-string">'string'</span>,
                <span class="hljs-attr">enum</span>: [<span class="hljs-string">'requirement_rules'</span>, <span class="hljs-string">'project_rules'</span>, <span class="hljs-string">'common_rules'</span>],
                <span class="hljs-attr">description</span>: <span class="hljs-string">'è§„åˆ™ç±»å‹'</span>
            },
        },
        <span class="hljs-attr">required</span>: [<span class="hljs-string">'filePaths'</span>, <span class="hljs-string">'teamSelection'</span>, <span class="hljs-string">'ruleTypeName'</span>]
    }
};
</code></pre>
<h3 data-id="heading-13">ä¸‹è½½å·¥å…·å®šä¹‰</h3>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-variable constant_">DOWNLOAD_PROJECT_RULES_TOOL</span> = {
    <span class="hljs-attr">name</span>: <span class="hljs-string">"get_download_rules"</span>,
    <span class="hljs-attr">description</span>: <span class="hljs-string">'ä¸‹è½½æ–‡ä»¶'</span>,
    <span class="hljs-attr">inputSchema</span>: {
        <span class="hljs-attr">type</span>: <span class="hljs-string">"object"</span>,
        <span class="hljs-attr">properties</span>: {
            <span class="hljs-attr">projectNameList</span>: {
                <span class="hljs-attr">type</span>: <span class="hljs-string">"array"</span>,
                <span class="hljs-attr">description</span>: <span class="hljs-string">"é¡¹ç›®åé›†åˆ"</span>,
                <span class="hljs-attr">items</span>: { <span class="hljs-attr">type</span>: <span class="hljs-string">"string"</span> }
            },
            <span class="hljs-attr">workspaceProjectList</span>: {
                <span class="hljs-attr">type</span>: <span class="hljs-string">"array"</span>, 
                <span class="hljs-attr">description</span>: <span class="hljs-string">"å·¥ä½œåŒºé¡¹ç›®åé›†åˆ"</span>,
                <span class="hljs-attr">items</span>: { <span class="hljs-attr">type</span>: <span class="hljs-string">"string"</span> }
            }
        },
        <span class="hljs-attr">required</span>: [<span class="hljs-string">"projectNameList"</span>, <span class="hljs-string">"workspaceProjectList"</span>]
    },
};
</code></pre>
<h2 data-id="heading-14">6. ä¸šåŠ¡é€»è¾‘å®ç°</h2>
<h3 data-id="heading-15">ä¸Šä¼ åŠŸèƒ½æ ¸å¿ƒä»£ç </h3>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">export</span> <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">handleUploadRule</span>(<span class="hljs-params">request: <span class="hljs-built_in">any</span>, filePaths: <span class="hljs-built_in">string</span>[], teamSelection: <span class="hljs-built_in">string</span>, ruleTypeName: <span class="hljs-built_in">string</span></span>) {
    <span class="hljs-keyword">try</span> {
        <span class="hljs-comment">// 1. éªŒè¯æ–‡ä»¶è·¯å¾„</span>
        <span class="hljs-keyword">const</span> invalidPaths = filePaths.<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">path</span> =&gt;</span> !<span class="hljs-title function_">isAbsolute</span>(path));
        <span class="hljs-keyword">if</span> (invalidPaths.<span class="hljs-property">length</span> &gt; <span class="hljs-number">0</span>) {
            <span class="hljs-keyword">return</span> <span class="hljs-title function_">createErrorResponse</span>(<span class="hljs-string">"æ–‡ä»¶è·¯å¾„ä¸æ˜¯ç»å¯¹è·¯å¾„"</span>, invalidPaths.<span class="hljs-title function_">join</span>(<span class="hljs-string">', '</span>));
        }

        <span class="hljs-comment">// 2. è¯»å–æ–‡ä»¶å†…å®¹</span>
        <span class="hljs-keyword">const</span> formData = <span class="hljs-keyword">new</span> <span class="hljs-title class_">FormData</span>();
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> filePath <span class="hljs-keyword">of</span> filePaths) {
            <span class="hljs-keyword">const</span> content = <span class="hljs-keyword">await</span> <span class="hljs-title function_">readFile</span>(filePath, <span class="hljs-string">'utf-8'</span>);
            <span class="hljs-keyword">const</span> fileName = <span class="hljs-title function_">basename</span>(filePath);
            formData.<span class="hljs-title function_">append</span>(<span class="hljs-string">'file'</span>, <span class="hljs-title class_">Buffer</span>.<span class="hljs-title function_">from</span>(content), {
                <span class="hljs-attr">filename</span>: fileName,
                <span class="hljs-attr">contentType</span>: <span class="hljs-title function_">getMimeType</span>(<span class="hljs-title function_">extname</span>(filePath))
            });
        }

        <span class="hljs-comment">// 3. æ·»åŠ å…¶ä»–å‚æ•°</span>
        formData.<span class="hljs-title function_">append</span>(<span class="hljs-string">'team'</span>, teamId);
        formData.<span class="hljs-title function_">append</span>(<span class="hljs-string">'ruleTypeId'</span>, ruleTypeId);
        formData.<span class="hljs-title function_">append</span>(<span class="hljs-string">'creator'</span>, <span class="hljs-title function_">getCurrentUserEmail</span>());

        <span class="hljs-comment">// 4. å‘é€è¯·æ±‚</span>
        <span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> axios.<span class="hljs-title function_">post</span>(<span class="hljs-string">`<span class="hljs-subst">${baseUrl}</span>/api/rules/upload`</span>, formData, {
            <span class="hljs-attr">headers</span>: { <span class="hljs-string">'Content-Type'</span>: <span class="hljs-string">'multipart/form-data'</span> },
            <span class="hljs-attr">timeout</span>: <span class="hljs-number">30000</span>
        });

        <span class="hljs-keyword">return</span> {
            <span class="hljs-attr">content</span>: [{ <span class="hljs-attr">type</span>: <span class="hljs-string">"text"</span>, <span class="hljs-attr">text</span>: <span class="hljs-string">"ä¸Šä¼ æˆåŠŸï¼"</span> }],
            <span class="hljs-attr">isError</span>: <span class="hljs-literal">false</span>
        };
    } <span class="hljs-keyword">catch</span> (error) {
        <span class="hljs-keyword">return</span> <span class="hljs-title function_">createErrorResponse</span>(<span class="hljs-string">"ä¸Šä¼ å¤±è´¥"</span>, error.<span class="hljs-property">message</span>);
    }
}
</code></pre>
<h3 data-id="heading-16">ä¸‹è½½åŠŸèƒ½æ ¸å¿ƒä»£ç </h3>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">export</span> <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">handleDownloadRules</span>(<span class="hljs-params">request: <span class="hljs-built_in">any</span>, projectNameList: <span class="hljs-built_in">string</span>[], workspaceProjectList: <span class="hljs-built_in">string</span>[]</span>) {
    <span class="hljs-keyword">try</span> {
        <span class="hljs-comment">// 1. æ„å»ºè¯·æ±‚å‚æ•°</span>
        <span class="hljs-keyword">const</span> params = <span class="hljs-keyword">new</span> <span class="hljs-title class_">URLSearchParams</span>();
        projectNameList.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">name</span> =&gt;</span> params.<span class="hljs-title function_">append</span>(<span class="hljs-string">'projectNameList'</span>, name));

        <span class="hljs-comment">// 2. å‘èµ·ä¸‹è½½è¯·æ±‚</span>
        <span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(<span class="hljs-string">`<span class="hljs-subst">${baseUrl}</span>/api/rules/download?<span class="hljs-subst">${params}</span>`</span>);
        <span class="hljs-keyword">const</span> data = <span class="hljs-keyword">await</span> response.<span class="hljs-title function_">json</span>();

        <span class="hljs-comment">// 3. ä¿å­˜æ–‡ä»¶åˆ°æœ¬åœ°</span>
        <span class="hljs-keyword">const</span> <span class="hljs-attr">savedFiles</span>: <span class="hljs-built_in">string</span>[] = [];
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> fileInfo <span class="hljs-keyword">of</span> data.<span class="hljs-property">files</span>) {
            <span class="hljs-keyword">const</span> targetPath = <span class="hljs-keyword">await</span> <span class="hljs-title function_">determineFilePath</span>(fileInfo.<span class="hljs-property">filePath</span>, projectNameList);
            <span class="hljs-keyword">await</span> <span class="hljs-title function_">ensureDirectoryExists</span>(<span class="hljs-title function_">dirname</span>(targetPath));
            <span class="hljs-keyword">await</span> <span class="hljs-title function_">writeFile</span>(targetPath, fileInfo.<span class="hljs-property">content</span>, <span class="hljs-string">'utf-8'</span>);
            savedFiles.<span class="hljs-title function_">push</span>(targetPath);
        }

        <span class="hljs-keyword">return</span> {
            <span class="hljs-attr">content</span>: [{
                <span class="hljs-attr">type</span>: <span class="hljs-string">"text"</span>,
                <span class="hljs-attr">text</span>: <span class="hljs-string">`ä¸‹è½½å®Œæˆï¼ä¿å­˜äº† <span class="hljs-subst">${savedFiles.length}</span> ä¸ªæ–‡ä»¶`</span>
            }],
            <span class="hljs-attr">isError</span>: <span class="hljs-literal">false</span>
        };
    } <span class="hljs-keyword">catch</span> (error) {
        <span class="hljs-keyword">return</span> <span class="hljs-title function_">createErrorResponse</span>(<span class="hljs-string">"ä¸‹è½½å¤±è´¥"</span>, error.<span class="hljs-property">message</span>);
    }
}
</code></pre>
<h2 data-id="heading-17">7. å·¥å…·å‡½æ•°</h2>
<h3 data-id="heading-18">é”™è¯¯å¤„ç†</h3>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">createErrorResponse</span>(<span class="hljs-params">title: <span class="hljs-built_in">string</span>, message: <span class="hljs-built_in">string</span></span>) {
    <span class="hljs-keyword">return</span> {
        <span class="hljs-attr">content</span>: [{
            <span class="hljs-attr">type</span>: <span class="hljs-string">"text"</span>,
            <span class="hljs-attr">text</span>: <span class="hljs-string">`âŒ **<span class="hljs-subst">${title}</span>**\n\n<span class="hljs-subst">${message}</span>`</span>
        }],
        <span class="hljs-attr">isError</span>: <span class="hljs-literal">true</span>
    };
}
</code></pre>
<h3 data-id="heading-19">æ–‡ä»¶è·¯å¾„å¤„ç†</h3>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">export</span> <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">determineFilePath</span>(<span class="hljs-params">remotePath: <span class="hljs-built_in">string</span>, projectList: <span class="hljs-built_in">string</span>[]</span>): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">string</span>&gt; {
    <span class="hljs-keyword">const</span> hasCursorRules = remotePath.<span class="hljs-title function_">includes</span>(<span class="hljs-string">'.cursor/rules'</span>);
    
    <span class="hljs-keyword">if</span> (hasCursorRules) {
        <span class="hljs-comment">// ä¿å­˜åˆ° .cursor/rules ç›®å½•</span>
        <span class="hljs-keyword">const</span> projectName = <span class="hljs-title function_">extractProjectName</span>(remotePath);
        <span class="hljs-keyword">const</span> projectPath = <span class="hljs-keyword">await</span> <span class="hljs-title function_">findProjectPath</span>(projectName, projectList);
        <span class="hljs-keyword">return</span> <span class="hljs-title function_">join</span>(projectPath, <span class="hljs-string">'.cursor'</span>, <span class="hljs-string">'rules'</span>, <span class="hljs-title function_">getRelativePath</span>(remotePath));
    } <span class="hljs-keyword">else</span> {
        <span class="hljs-comment">// ä¿å­˜åˆ° ProjectRules ç›®å½•</span>
        <span class="hljs-keyword">const</span> parentDir = <span class="hljs-title function_">dirname</span>(process.<span class="hljs-title function_">cwd</span>());
        <span class="hljs-keyword">return</span> <span class="hljs-title function_">join</span>(parentDir, <span class="hljs-string">'ProjectRules'</span>, remotePath);
    }
}
</code></pre>
<h2 data-id="heading-20">8. æ„å»ºå’Œéƒ¨ç½²</h2>
<h3 data-id="heading-21">æ„å»ºè„šæœ¬</h3>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"scripts"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"build"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"tsc &amp;&amp; chmod 755 dist/index.js"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"dev"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"NODE_OPTIONS=\"--loader ts-node/esm\" node src/index.ts"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"start"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"node dist/index.js"</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h3 data-id="heading-22">postbuildå¤„ç†</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// scripts/postbuild.mjs</span>
<span class="hljs-keyword">import</span> { readFileSync, writeFileSync } <span class="hljs-keyword">from</span> <span class="hljs-string">'fs'</span>;

<span class="hljs-comment">// æ·»åŠ shebangåˆ°å…¥å£æ–‡ä»¶</span>
<span class="hljs-keyword">const</span> indexPath = <span class="hljs-string">'./dist/index.js'</span>;
<span class="hljs-keyword">let</span> content = <span class="hljs-title function_">readFileSync</span>(indexPath, <span class="hljs-string">'utf8'</span>);
<span class="hljs-keyword">if</span> (!content.<span class="hljs-title function_">startsWith</span>(<span class="hljs-string">'#!/usr/bin/env node'</span>)) {
    content = <span class="hljs-string">'#!/usr/bin/env node\n'</span> + content;
    <span class="hljs-title function_">writeFileSync</span>(indexPath, content);
}
</code></pre>
<h2 data-id="heading-23">9. å…³é”®å®ç°è¦ç‚¹</h2>
<h3 data-id="heading-24">MCPé€šä¿¡åè®®</h3>
<ul>
<li>ä½¿ç”¨stdioæ¨¡å¼è¿›è¡Œæ ‡å‡†è¾“å…¥è¾“å‡ºé€šä¿¡</li>
<li>æ”¯æŒå·¥å…·åˆ—è¡¨æŸ¥è¯¢å’Œå·¥å…·è°ƒç”¨</li>
<li>è¿”å›æ ‡å‡†åŒ–çš„å“åº”æ ¼å¼</li>
</ul>
<h3 data-id="heading-25">æ–‡ä»¶å¤„ç†ç­–ç•¥</h3>
<ul>
<li>æ”¯æŒå¤šæ–‡ä»¶æ‰¹é‡æ“ä½œ</li>
<li>æ™ºèƒ½è¯†åˆ«é¡¹ç›®ç»“æ„</li>
<li>è‡ªåŠ¨åˆ›å»ºç›®å½•ç»“æ„</li>
</ul>
<h3 data-id="heading-26">é”™è¯¯å¤„ç†æœºåˆ¶</h3>
<ul>
<li>ç»Ÿä¸€çš„é”™è¯¯å“åº”æ ¼å¼</li>
<li>è¯¦ç»†çš„é”™è¯¯ä¿¡æ¯æç¤º</li>
<li>ä¼˜é›…çš„å¼‚å¸¸å¤„ç†</li>
</ul>
<h3 data-id="heading-27">å·¥ä½œåŒºé›†æˆ</h3>
<ul>
<li>è‡ªåŠ¨æ£€æµ‹å·¥ä½œåŒºé¡¹ç›®</li>
<li>æ”¯æŒå•é¡¹ç›®å’Œå¤šé¡¹ç›®æ¨¡å¼</li>
<li>æ™ºèƒ½æ–‡ä»¶è·¯å¾„è§£æ</li>
</ul>
<h2 data-id="heading-28">10. æµ‹è¯•å’Œè°ƒè¯•</h2>
<h3 data-id="heading-29">æœ¬åœ°æµ‹è¯•</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># å¼€å‘æ¨¡å¼</span>
npm run dev

<span class="hljs-comment"># æ„å»ºæµ‹è¯•</span>
npm run build
npm start
</code></pre>
<h3 data-id="heading-30">MCPå®¢æˆ·ç«¯é›†æˆæµ‹è¯•</h3>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"mcpServers"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"rule-server"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"command"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"node"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"args"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"/path/to/dist/index.js"</span><span class="hljs-punctuation">]</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>é€šè¿‡ä»¥ä¸Šæ­¥éª¤ï¼Œå³å¯å®Œæˆä¸€ä¸ªåŠŸèƒ½å®Œæ•´çš„MCPæœåŠ¡å™¨å®ç°ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[æ„å»ºå¼‚æ­¥ä»»åŠ¡é˜Ÿåˆ—ï¼šé«˜æ•ˆæ‰¹é‡åŒ–è·å–æ·˜å®å…³é”®è¯æœç´¢ç»“æœçš„å®è·µ]]></title>    <link>https://juejin.cn/post/7581292270960951306</link>    <guid>https://juejin.cn/post/7581292270960951306</guid>    <pubDate>2025-12-08T09:30:52.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581292270960951306" data-draft-id="7581297888808009778" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="æ„å»ºå¼‚æ­¥ä»»åŠ¡é˜Ÿåˆ—ï¼šé«˜æ•ˆæ‰¹é‡åŒ–è·å–æ·˜å®å…³é”®è¯æœç´¢ç»“æœçš„å®è·µ"/> <meta itemprop="keywords" content="å‰ç«¯,API,æ•°æ®æŒ–æ˜"/> <meta itemprop="datePublished" content="2025-12-08T09:30:52.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ç”µå•†APIå¤§æ•°æ®æ¥å£å¼€å‘Cris"/> <meta itemprop="url" content="https://juejin.cn/user/3836609967955659"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            æ„å»ºå¼‚æ­¥ä»»åŠ¡é˜Ÿåˆ—ï¼šé«˜æ•ˆæ‰¹é‡åŒ–è·å–æ·˜å®å…³é”®è¯æœç´¢ç»“æœçš„å®è·µ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3836609967955659/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ç”µå•†APIå¤§æ•°æ®æ¥å£å¼€å‘Cris
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-08T09:30:52.000Z" title="Mon Dec 08 2025 09:30:52 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»7åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>â€‹</p>
<p>åœ¨ç”µå•†æ•°æ®åˆ†æã€ç«å“è°ƒç ”æˆ–å•†å“ç›‘æ§ç­‰åœºæ™¯ä¸­ï¼Œæ‰¹é‡è·å–æ·˜å®å…³é”®è¯æœç´¢ç»“æœæ˜¯é«˜é¢‘éœ€æ±‚ã€‚ä½†ä¼ ç»ŸåŒæ­¥è¯·æ±‚æ–¹å¼å­˜åœ¨æ•ˆç‡ä½ã€æ˜“é˜»å¡ã€å®¹é”™æ€§å·®ç­‰é—®é¢˜ â€”â€” å½“å…³é”®è¯æ•°é‡è¾¾åˆ°æ•°ç™¾ç”šè‡³æ•°åƒä¸ªæ—¶ï¼ŒåŒæ­¥è¯·æ±‚ä¼šå› ç½‘ç»œå»¶è¿Ÿã€æ¥å£é™æµç­‰å› ç´ å¯¼è‡´æ•´ä½“è€—æ—¶æˆå€å¢åŠ ï¼Œä¸”å•ä¸ªè¯·æ±‚å¤±è´¥å¯èƒ½ä¸­æ–­æ•´ä¸ªæµç¨‹ã€‚</p>
<p>æœ¬æ–‡å°†ç»“åˆ Python çš„å¼‚æ­¥ç¼–ç¨‹å’Œä»»åŠ¡é˜Ÿåˆ—æŠ€æœ¯ï¼Œæ„å»ºä¸€å¥—é«˜æ•ˆã€å¯æ‰©å±•çš„æ·˜å®å…³é”®è¯æœç´¢ç»“æœæ‰¹é‡è·å–ç³»ç»Ÿï¼Œè§£å†³åŒæ­¥æ–¹å¼çš„ç—›ç‚¹ï¼Œå®ç°é«˜å¹¶å‘ã€é«˜å¯ç”¨çš„æ‰¹é‡æ•°æ®é‡‡é›†ã€‚</p>
<h2 data-id="heading-0">ä¸€ã€æŠ€æœ¯é€‰å‹ä¸æ ¸å¿ƒæ€è·¯</h2>
<h3 data-id="heading-1">1. æ ¸å¿ƒæŠ€æœ¯æ ˆ</h3>
<ul>
<li><strong>å¼‚æ­¥æ¡†æ¶</strong>ï¼š<code>aiohttp</code>ï¼ˆå¼‚æ­¥ HTTP å®¢æˆ·ç«¯ï¼Œæ”¯æŒé«˜å¹¶å‘è¯·æ±‚ï¼‰</li>
<li><strong>ä»»åŠ¡é˜Ÿåˆ—</strong>ï¼š<code>asyncio.Queue</code>ï¼ˆè½»é‡çº§å¼‚æ­¥é˜Ÿåˆ—ï¼Œå®ç°ä»»åŠ¡è§£è€¦ä¸è°ƒåº¦ï¼‰</li>
<li><strong>æ•°æ®è§£æ</strong>ï¼š<code>parsel</code>ï¼ˆé«˜æ•ˆè§£æ HTML/JSONï¼Œæ›¿ä»£ BeautifulSoupï¼‰</li>
<li><strong>ååçˆ¬è¾…åŠ©</strong>ï¼š<code>fake-useragent</code>ï¼ˆç”Ÿæˆéšæœº User-Agentï¼‰ã€<code>asyncio.Semaphore</code>ï¼ˆæ§åˆ¶å¹¶å‘é‡ï¼Œé¿å…è§¦å‘é™æµï¼‰</li>
</ul>
<h3 data-id="heading-2">2. æ ¸å¿ƒæ€è·¯</h3>
<ol>
<li>æ„å»ºå¼‚æ­¥ä»»åŠ¡é˜Ÿåˆ—ï¼Œå°†å¾…æœç´¢çš„å…³é”®è¯æ‰¹é‡å…¥é˜Ÿï¼›</li>
<li>å¯åŠ¨å¤šä¸ªå¼‚æ­¥æ¶ˆè´¹è€…åç¨‹ï¼Œä»é˜Ÿåˆ—ä¸­å–å‡ºå…³é”®è¯å¹¶å‘èµ·å¼‚æ­¥ HTTP è¯·æ±‚ï¼›</li>
<li>å¯¹è¿”å›ç»“æœè¿›è¡Œè§£æï¼Œæå–å•†å“æ ¸å¿ƒä¿¡æ¯ï¼ˆæ ‡é¢˜ã€ä»·æ ¼ã€é”€é‡ã€åº—é“ºåç­‰ï¼‰ï¼›</li>
<li>ç»Ÿä¸€å¤„ç†å¼‚å¸¸ï¼ˆç½‘ç»œè¶…æ—¶ã€æ¥å£é™æµã€è§£æå¤±è´¥ç­‰ï¼‰ï¼Œä¿è¯é˜Ÿåˆ—æ¶ˆè´¹ä¸ä¸­æ–­ï¼›</li>
<li>å°†è§£æåçš„ç»“æœè½åœ°ï¼ˆæœ¬æ–‡ä»¥æœ¬åœ° JSON æ–‡ä»¶ä¸ºä¾‹ï¼Œå¯æ‰©å±•è‡³æ•°æ®åº“ï¼‰ã€‚</li>
</ol>
<h2 data-id="heading-3">äºŒã€å®Œæ•´å®ç°ä»£ç </h2>
<h3 data-id="heading-4">1. ç¯å¢ƒå‡†å¤‡</h3>
<p>é¦–å…ˆå®‰è£…ä¾èµ–åŒ…ï¼š</p>
<pre><code class="hljs">pip install aiohttp parsel fake-useragent python-dotenv
</code></pre>
<p><img src="" alt="" title="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨" loading="lazy"/></p>
<h3 data-id="heading-5">2. æ ¸å¿ƒä»£ç å®ç°</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> asyncio
<span class="hljs-keyword">import</span> json
<span class="hljs-keyword">import</span> time
<span class="hljs-keyword">from</span> typing <span class="hljs-keyword">import</span> <span class="hljs-type">List</span>, <span class="hljs-type">Dict</span>, <span class="hljs-type">Optional</span>
<span class="hljs-keyword">from</span> fake_useragent <span class="hljs-keyword">import</span> UserAgent
<span class="hljs-keyword">import</span> aiohttp
<span class="hljs-keyword">from</span> parsel <span class="hljs-keyword">import</span> Selector
<span class="hljs-keyword">from</span> dotenv <span class="hljs-keyword">import</span> load_dotenv
<span class="hljs-keyword">import</span> os

<span class="hljs-comment"># åŠ è½½ç¯å¢ƒå˜é‡ï¼ˆå¯é€‰ï¼Œç”¨äºé…ç½®æ•æ„Ÿä¿¡æ¯ï¼‰</span>
load_dotenv()

<span class="hljs-keyword">class</span> <span class="hljs-title class_">TaobaoSearchCrawler</span>:
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, concurrency: <span class="hljs-built_in">int</span> = <span class="hljs-number">10</span>, timeout: <span class="hljs-built_in">int</span> = <span class="hljs-number">30</span></span>):
        <span class="hljs-string">"""
        åˆå§‹åŒ–æ·˜å®æœç´¢çˆ¬è™«
        :param concurrency: æœ€å¤§å¹¶å‘æ•°ï¼ˆé¿å…è§¦å‘æ·˜å®é™æµï¼‰
        :param timeout: è¯·æ±‚è¶…æ—¶æ—¶é—´
        """</span>
        self.concurrency = concurrency
        self.timeout = timeout
        self.semaphore = asyncio.Semaphore(concurrency)  <span class="hljs-comment"># å¹¶å‘æ§åˆ¶ä¿¡å·é‡</span>
        self.user_agent = UserAgent()
        <span class="hljs-comment"># æ·˜å®æœç´¢æ¥å£ï¼ˆéœ€æ³¨æ„ï¼šæ·˜å®ç½‘é¡µç‰ˆå¯èƒ½æœ‰åçˆ¬ï¼Œå»ºè®®ä½¿ç”¨åˆè§„çš„å¼€æ”¾å¹³å°æ¥å£ï¼‰</span>
        self.search_url = <span class="hljs-string">"https://s.taobao.com/search?q={}&amp;imgfile=&amp;commend=all&amp;ssid=s5-e&amp;search_type=item&amp;sourceId=tb.index&amp;spm=a21bo.jianhua.201856-taobao-item.1&amp;ie=utf8&amp;initiative_id=tbindexz_20170306"</span>
        <span class="hljs-comment"># ç»“æœå­˜å‚¨åˆ—è¡¨</span>
        self.results: <span class="hljs-type">List</span>[<span class="hljs-type">Dict</span>] = []
        <span class="hljs-comment"># å¤±è´¥ä»»åŠ¡è®°å½•</span>
        self.failed_tasks: <span class="hljs-type">List</span>[<span class="hljs-type">Dict</span>] = []

    <span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">fetch_html</span>(<span class="hljs-params">self, session: aiohttp.ClientSession, keyword: <span class="hljs-built_in">str</span></span>) -&gt; <span class="hljs-type">Optional</span>[<span class="hljs-built_in">str</span>]:
        <span class="hljs-string">"""
        å¼‚æ­¥è·å–æœç´¢ç»“æœé¡µé¢HTML
        :param session: aiohttpä¼šè¯å¯¹è±¡
        :param keyword: æœç´¢å…³é”®è¯
        :return: é¡µé¢HTMLå­—ç¬¦ä¸²ï¼Œå¤±è´¥è¿”å›None
        """</span>
        headers = {
            <span class="hljs-string">"User-Agent"</span>: self.user_agent.random,
            <span class="hljs-string">"Referer"</span>: <span class="hljs-string">"https://www.taobao.com/"</span>,
            <span class="hljs-string">"Accept-Language"</span>: <span class="hljs-string">"zh-CN,zh;q=0.9"</span>,
            <span class="hljs-string">"Accept-Encoding"</span>: <span class="hljs-string">"gzip, deflate, br"</span>
        }
        url = self.search_url.<span class="hljs-built_in">format</span>(keyword)
        <span class="hljs-keyword">try</span>:
            <span class="hljs-keyword">async</span> <span class="hljs-keyword">with</span> self.semaphore:  <span class="hljs-comment"># æ§åˆ¶å¹¶å‘</span>
                <span class="hljs-keyword">async</span> <span class="hljs-keyword">with</span> session.get(
                    url=url,
                    headers=headers,
                    timeout=aiohttp.ClientTimeout(total=self.timeout),
                    <span class="hljs-comment"># å¯é€‰ï¼šæ·»åŠ ä»£ç†</span>
                    <span class="hljs-comment"># proxy=os.getenv("PROXY_URL")</span>
                ) <span class="hljs-keyword">as</span> response:
                    <span class="hljs-keyword">if</span> response.status == <span class="hljs-number">200</span>:
                        html = <span class="hljs-keyword">await</span> response.text()
                        <span class="hljs-keyword">return</span> html
                    <span class="hljs-keyword">else</span>:
                        self.failed_tasks.append({
                            <span class="hljs-string">"keyword"</span>: keyword,
                            <span class="hljs-string">"reason"</span>: <span class="hljs-string">f"HTTPçŠ¶æ€ç å¼‚å¸¸: <span class="hljs-subst">{response.status}</span>"</span>
                        })
                        <span class="hljs-keyword">return</span> <span class="hljs-literal">None</span>
        <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:
            self.failed_tasks.append({
                <span class="hljs-string">"keyword"</span>: keyword,
                <span class="hljs-string">"reason"</span>: <span class="hljs-string">f"è¯·æ±‚å¼‚å¸¸: <span class="hljs-subst">{<span class="hljs-built_in">str</span>(e)}</span>"</span>
            })
            <span class="hljs-keyword">return</span> <span class="hljs-literal">None</span>

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">parse_html</span>(<span class="hljs-params">self, html: <span class="hljs-built_in">str</span>, keyword: <span class="hljs-built_in">str</span></span>) -&gt; <span class="hljs-type">List</span>[<span class="hljs-type">Dict</span>]:
        <span class="hljs-string">"""
        è§£ææœç´¢ç»“æœHTMLï¼Œæå–å•†å“ä¿¡æ¯
        :param html: é¡µé¢HTML
        :param keyword: æœç´¢å…³é”®è¯
        :return: å•†å“ä¿¡æ¯åˆ—è¡¨
        """</span>
        selector = Selector(text=html)
        items = []
        <span class="hljs-comment"># æ·˜å®æœç´¢ç»“æœå•†å“èŠ‚ç‚¹ï¼ˆéœ€æ ¹æ®å®é™…é¡µé¢ç»“æ„è°ƒæ•´ï¼‰</span>
        product_nodes = selector.css(<span class="hljs-string">".item J_MouserOnverReq  "</span>)
        <span class="hljs-keyword">for</span> node <span class="hljs-keyword">in</span> product_nodes:
            <span class="hljs-keyword">try</span>:
                item = {
                    <span class="hljs-string">"keyword"</span>: keyword,
                    <span class="hljs-string">"title"</span>: node.css(<span class="hljs-string">".J_ClickStat::attr(title)"</span>).extract_first() <span class="hljs-keyword">or</span> <span class="hljs-string">""</span>,
                    <span class="hljs-string">"price"</span>: node.css(<span class="hljs-string">".price J_price::text"</span>).extract_first() <span class="hljs-keyword">or</span> <span class="hljs-string">""</span>,
                    <span class="hljs-string">"sales"</span>: node.css(<span class="hljs-string">".deal-cnt::text"</span>).extract_first() <span class="hljs-keyword">or</span> <span class="hljs-string">"0"</span>,
                    <span class="hljs-string">"shop_name"</span>: node.css(<span class="hljs-string">".shopname J_MouseververReq::text"</span>).extract_first() <span class="hljs-keyword">or</span> <span class="hljs-string">""</span>,
                    <span class="hljs-string">"item_url"</span>: node.css(<span class="hljs-string">".J_ClickStat::attr(href)"</span>).extract_first() <span class="hljs-keyword">or</span> <span class="hljs-string">""</span>,
                    <span class="hljs-string">"image_url"</span>: node.css(<span class="hljs-string">".J_ItemImg::attr(src)"</span>).extract_first() <span class="hljs-keyword">or</span> <span class="hljs-string">""</span>
                }
                <span class="hljs-comment"># æ¸…æ´—æ•°æ®</span>
                item[<span class="hljs-string">"title"</span>] = item[<span class="hljs-string">"title"</span>].strip()
                item[<span class="hljs-string">"price"</span>] = item[<span class="hljs-string">"price"</span>].strip().replace(<span class="hljs-string">"Â¥"</span>, <span class="hljs-string">""</span>)
                items.append(item)
            <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:
                <span class="hljs-keyword">continue</span>
        <span class="hljs-keyword">return</span> items

    <span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">consumer</span>(<span class="hljs-params">self, queue: asyncio.Queue, session: aiohttp.ClientSession</span>):
        <span class="hljs-string">"""
        é˜Ÿåˆ—æ¶ˆè´¹è€…ï¼šä»é˜Ÿåˆ—å–å…³é”®è¯ï¼Œæ‰§è¡Œè¯·æ±‚å’Œè§£æ
        :param queue: å¼‚æ­¥é˜Ÿåˆ—
        :param session: aiohttpä¼šè¯
        """</span>
        <span class="hljs-keyword">while</span> <span class="hljs-keyword">not</span> queue.empty():
            keyword = <span class="hljs-keyword">await</span> queue.get()
            html = <span class="hljs-keyword">await</span> self.fetch_html(session, keyword)
            <span class="hljs-keyword">if</span> html:
                items = self.parse_html(html, keyword)
                self.results.extend(items)
            queue.task_done()  <span class="hljs-comment"># æ ‡è®°ä»»åŠ¡å®Œæˆ</span>

    <span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">run</span>(<span class="hljs-params">self, keywords: <span class="hljs-type">List</span>[<span class="hljs-built_in">str</span>]</span>):
        <span class="hljs-string">"""
        å¯åŠ¨çˆ¬è™«ä¸»æµç¨‹
        :param keywords: å¾…æœç´¢å…³é”®è¯åˆ—è¡¨
        """</span>
        <span class="hljs-comment"># 1. åˆå§‹åŒ–ä»»åŠ¡é˜Ÿåˆ—</span>
        queue = asyncio.Queue()
        <span class="hljs-keyword">for</span> keyword <span class="hljs-keyword">in</span> keywords:
            <span class="hljs-keyword">await</span> queue.put(keyword)

        <span class="hljs-comment"># 2. åˆ›å»ºaiohttpä¼šè¯ï¼ˆå¤ç”¨è¿æ¥ï¼Œæå‡æ•ˆç‡ï¼‰</span>
        <span class="hljs-keyword">async</span> <span class="hljs-keyword">with</span> aiohttp.ClientSession() <span class="hljs-keyword">as</span> session:
            <span class="hljs-comment"># 3. åˆ›å»ºæ¶ˆè´¹è€…ä»»åŠ¡</span>
            tasks = [asyncio.create_task(self.consumer(queue, session)) <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(self.concurrency)]
            <span class="hljs-comment"># 4. ç­‰å¾…æ‰€æœ‰ä»»åŠ¡å®Œæˆ</span>
            <span class="hljs-keyword">await</span> queue.join()
            <span class="hljs-comment"># 5. å–æ¶ˆæœªå®Œæˆçš„ä»»åŠ¡ï¼ˆé˜²æ­¢å†…å­˜æ³„æ¼ï¼‰</span>
            <span class="hljs-keyword">for</span> task <span class="hljs-keyword">in</span> tasks:
                task.cancel()

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">save_results</span>(<span class="hljs-params">self, save_path: <span class="hljs-built_in">str</span> = <span class="hljs-string">"taobao_search_results.json"</span></span>):
        <span class="hljs-string">"""
        ä¿å­˜ç»“æœåˆ°JSONæ–‡ä»¶
        :param save_path: ä¿å­˜è·¯å¾„
        """</span>
        <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(save_path, <span class="hljs-string">"w"</span>, encoding=<span class="hljs-string">"utf-8"</span>) <span class="hljs-keyword">as</span> f:
            json.dump({
                <span class="hljs-string">"total_success"</span>: <span class="hljs-built_in">len</span>(self.results),
                <span class="hljs-string">"total_failed"</span>: <span class="hljs-built_in">len</span>(self.failed_tasks),
                <span class="hljs-string">"results"</span>: self.results,
                <span class="hljs-string">"failed_tasks"</span>: self.failed_tasks
            }, f, ensure_ascii=<span class="hljs-literal">False</span>, indent=<span class="hljs-number">4</span>)
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"ç»“æœå·²ä¿å­˜è‡³ <span class="hljs-subst">{save_path}</span>"</span>)
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"æˆåŠŸè§£æ <span class="hljs-subst">{<span class="hljs-built_in">len</span>(self.results)}</span> æ¡å•†å“æ•°æ®ï¼Œå¤±è´¥ <span class="hljs-subst">{<span class="hljs-built_in">len</span>(self.failed_tasks)}</span> ä¸ªå…³é”®è¯"</span>)

<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">"__main__"</span>:
    <span class="hljs-comment"># å¾…æœç´¢çš„å…³é”®è¯åˆ—è¡¨</span>
    KEYWORDS = [
        <span class="hljs-string">"Pythonç¼–ç¨‹"</span>,
        <span class="hljs-string">"å¼‚æ­¥ä»»åŠ¡é˜Ÿåˆ—"</span>,
        <span class="hljs-string">"æ·˜å®æ•°æ®åˆ†æ"</span>,
        <span class="hljs-string">"ç”µå•†çˆ¬è™«"</span>,
        <span class="hljs-string">"aiohttpå®æˆ˜"</span>
        <span class="hljs-comment"># å¯æ‰©å±•è‡³æ•°åƒä¸ªå…³é”®è¯</span>
    ]

    <span class="hljs-comment"># åˆå§‹åŒ–çˆ¬è™«</span>
    crawler = TaobaoSearchCrawler(concurrency=<span class="hljs-number">10</span>, timeout=<span class="hljs-number">30</span>)

    <span class="hljs-comment"># è®°å½•å¼€å§‹æ—¶é—´</span>
    start_time = time.time()

    <span class="hljs-comment"># è¿è¡Œå¼‚æ­¥çˆ¬è™«</span>
    asyncio.run(crawler.run(KEYWORDS))

    <span class="hljs-comment"># ä¿å­˜ç»“æœ</span>
    crawler.save_results()

    <span class="hljs-comment"># è¾“å‡ºè€—æ—¶</span>
    end_time = time.time()
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"æ€»è€—æ—¶: <span class="hljs-subst">{end_time - start_time:<span class="hljs-number">.2</span>f}</span> ç§’"</span>)
</code></pre>
<p><img src="" alt="" title="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨" loading="lazy"/></p>
<h2 data-id="heading-6">ä¸‰ã€å…³é”®æŠ€æœ¯è§£æ</h2>
<h3 data-id="heading-7">1. å¼‚æ­¥ä»»åŠ¡é˜Ÿåˆ—ï¼ˆasyncio.Queueï¼‰</h3>
<ul>
<li><strong>è§£è€¦ç”Ÿäº§ä¸æ¶ˆè´¹</strong>ï¼šå…³é”®è¯ä½œä¸ºä»»åŠ¡è¢« â€œç”Ÿäº§è€…â€ æ”¾å…¥é˜Ÿåˆ—ï¼Œâ€œæ¶ˆè´¹è€…â€ åç¨‹ä»é˜Ÿåˆ—å–ä»»åŠ¡æ‰§è¡Œï¼Œå®ç°ä»»åŠ¡è°ƒåº¦ä¸æ‰§è¡Œåˆ†ç¦»ï¼›</li>
<li><strong>é˜»å¡ä¸å”¤é†’</strong>ï¼šé˜Ÿåˆ—ç©ºæ—¶æ¶ˆè´¹è€…è‡ªåŠ¨é˜»å¡ï¼Œæ–°ä»»åŠ¡å…¥é˜Ÿæ—¶å”¤é†’ï¼Œé¿å…æ— æ•ˆè½®è¯¢ï¼›</li>
<li><strong>ä»»åŠ¡å®Œæˆç¡®è®¤</strong>ï¼š<code>queue.task_done()</code>Â æ ‡è®°ä»»åŠ¡å®Œæˆï¼Œ<code>queue.join()</code>Â ç­‰å¾…æ‰€æœ‰ä»»åŠ¡å®Œæˆï¼Œä¿è¯æµç¨‹å®Œæ•´æ€§ã€‚</li>
</ul>
<h3 data-id="heading-8">2. å¹¶å‘æ§åˆ¶ï¼ˆasyncio.Semaphoreï¼‰</h3>
<p>æ·˜å®å¯¹é«˜é¢‘è¯·æ±‚æœ‰é™æµæœºåˆ¶ï¼Œé€šè¿‡<code>Semaphore</code>é™åˆ¶æœ€å¤§å¹¶å‘æ•°ï¼ˆæœ¬æ–‡è®¾ä¸º 10ï¼‰ï¼Œé¿å…å› è¯·æ±‚è¿‡äºå¯†é›†è§¦å‘åçˆ¬æˆ– IP å°ç¦ã€‚</p>
<h3 data-id="heading-9">3. å¼‚æ­¥ HTTP è¯·æ±‚ï¼ˆaiohttpï¼‰</h3>
<ul>
<li><strong>è¿æ¥å¤ç”¨</strong>ï¼šé€šè¿‡<code>aiohttp.ClientSession</code>å¤ç”¨ TCP è¿æ¥ï¼Œå‡å°‘æ¡æ‰‹å¼€é”€ï¼›</li>
<li><strong>è¶…æ—¶æ§åˆ¶</strong>ï¼šè®¾ç½®<code>ClientTimeout</code>é¿å…å•ä¸ªè¯·æ±‚é˜»å¡æ•´ä¸ªæµç¨‹ï¼›</li>
<li><strong>å¼‚å¸¸æ•è·</strong>ï¼šå¯¹ç½‘ç»œè¶…æ—¶ã€çŠ¶æ€ç å¼‚å¸¸ç­‰æƒ…å†µå•ç‹¬å¤„ç†ï¼Œä¿è¯å•ä¸ªè¯·æ±‚å¤±è´¥ä¸å½±å“æ•´ä½“é˜Ÿåˆ—æ¶ˆè´¹ã€‚</li>
</ul>
<h3 data-id="heading-10">4. æ•°æ®è§£æï¼ˆparselï¼‰</h3>
<p><code>parsel</code>åŸºäº lxml å®ç°ï¼Œæ”¯æŒ XPath/CSS é€‰æ‹©å™¨ï¼Œè§£ææ•ˆç‡è¿œé«˜äº BeautifulSoupï¼Œä¸”è¯­æ³•æ›´ç®€æ´ã€‚éœ€æ³¨æ„ï¼šæ·˜å®é¡µé¢ç»“æ„å¯èƒ½åŠ¨æ€å˜åŒ–ï¼Œéœ€å®šæœŸè°ƒæ•´é€‰æ‹©å™¨è§„åˆ™ã€‚</p>
<h2 data-id="heading-11">å››ã€ä¼˜åŒ–ä¸æ‰©å±•å»ºè®®</h2>
<h3 data-id="heading-12">1. ååçˆ¬ä¼˜åŒ–</h3>
<ul>
<li><strong>ä»£ç†æ± é›†æˆ</strong>ï¼šæ·»åŠ åŠ¨æ€ä»£ç†æ± ï¼ˆå¦‚ä½¿ç”¨<code>aiohttp-socks</code>æ”¯æŒ SOCKS ä»£ç†ï¼‰ï¼Œé¿å…å• IP è¯·æ±‚è¿‡äºé¢‘ç¹ï¼›</li>
<li><strong>Cookie æŒä¹…åŒ–</strong>ï¼šç™»å½•æ·˜å®åæŒä¹…åŒ– Cookieï¼Œæå‡è¯·æ±‚æˆåŠŸç‡ï¼›</li>
<li><strong>è¯·æ±‚é—´éš”éšæœºåŒ–</strong>ï¼šåœ¨<code>fetch_html</code>ä¸­æ·»åŠ éšæœºå»¶è¿Ÿï¼ˆå¦‚ 0.5-2 ç§’ï¼‰ï¼Œæ¨¡æ‹Ÿäººå·¥æ“ä½œã€‚</li>
</ul>
<h3 data-id="heading-13">2. ä»»åŠ¡é˜Ÿåˆ—æ‰©å±•</h3>
<ul>
<li><strong>åˆ†å¸ƒå¼é˜Ÿåˆ—</strong>ï¼šè‹¥å…³é”®è¯æ•°é‡è¶… 10 ä¸‡çº§ï¼Œå¯æ›¿æ¢ä¸º<code>Celery + Redis</code>åˆ†å¸ƒå¼ä»»åŠ¡é˜Ÿåˆ—ï¼Œæ”¯æŒå¤šæœºå™¨åˆ†å¸ƒå¼æ¶ˆè´¹ï¼›</li>
<li><strong>ä»»åŠ¡é‡è¯•</strong>ï¼šå¯¹å¤±è´¥çš„ä»»åŠ¡ï¼ˆå¦‚<code>failed_tasks</code>ï¼‰å®ç°è‡ªåŠ¨é‡è¯•æœºåˆ¶ï¼Œæå‡æˆåŠŸç‡ã€‚</li>
</ul>
<h3 data-id="heading-14">3. æ•°æ®è½åœ°ä¼˜åŒ–</h3>
<ul>
<li><strong>æ‰¹é‡å…¥åº“</strong>ï¼šå°†è§£æåçš„å•†å“æ•°æ®æ‰¹é‡æ’å…¥ MySQL/Redis/MongoDBï¼Œé¿å…å•æ¡æ’å…¥çš„ IO å¼€é”€ï¼›</li>
<li><strong>å¢é‡æ›´æ–°</strong>ï¼šè®°å½•å·²çˆ¬å–çš„å…³é”®è¯å’Œå•†å“ï¼Œé¿å…é‡å¤é‡‡é›†ã€‚</li>
</ul>
<h3 data-id="heading-15">4. ç›‘æ§ä¸å‘Šè­¦</h3>
<ul>
<li>æ·»åŠ æ—¥å¿—æ¨¡å—ï¼ˆå¦‚<code>logging</code>ï¼‰è®°å½•è¯·æ±‚ / è§£ææ—¥å¿—ï¼›</li>
<li>ç›‘æ§å¤±è´¥ç‡ï¼Œå½“å¤±è´¥ç‡è¶…è¿‡é˜ˆå€¼æ—¶è§¦å‘é‚®ä»¶ / é’‰é’‰å‘Šè­¦ã€‚</li>
</ul>
<h2 data-id="heading-16">äº”ã€æ³¨æ„äº‹é¡¹</h2>
<ol>
<li><strong>åˆè§„æ€§</strong>ï¼šæ·˜å®æ•°æ®å—ã€Šç”µå­å•†åŠ¡æ³•ã€‹ä¿æŠ¤ï¼Œçˆ¬è™«éœ€éµå®ˆå¹³å°<code>robots.txt</code>åè®®ï¼Œä»…ç”¨äºåˆæ³•çš„æ•°æ®åˆ†æï¼Œç¦æ­¢å•†ç”¨æˆ–æ¶æ„é‡‡é›†ï¼›</li>
<li><strong>åçˆ¬åº”å¯¹</strong>ï¼šæ·˜å®ä¼šåŠ¨æ€æ›´æ–°åçˆ¬ç­–ç•¥ï¼ˆå¦‚éªŒè¯ç ã€JS åŠ å¯†ï¼‰ï¼Œæœ¬æ–‡ä»…æ¼”ç¤ºåŸºç¡€æ€è·¯ï¼Œç”Ÿäº§ç¯å¢ƒéœ€ç»“åˆå®é™…åçˆ¬æœºåˆ¶è°ƒæ•´ï¼›</li>
<li><strong>æ€§èƒ½æµ‹è¯•</strong>ï¼šå»ºè®®å…ˆé€šè¿‡å°‘é‡å…³é”®è¯æµ‹è¯•å¹¶å‘æ•°ï¼Œæ‰¾åˆ° â€œæ•ˆç‡ - ç¨³å®šæ€§â€ å¹³è¡¡ç‚¹ï¼ˆå¦‚ 10-20 å¹¶å‘è¾ƒåˆé€‚ï¼‰ã€‚</li>
</ol>
<h2 data-id="heading-17">å…­ã€æ€»ç»“</h2>
<p>æœ¬æ–‡é€šè¿‡å¼‚æ­¥ä»»åŠ¡é˜Ÿåˆ— + é«˜å¹¶å‘å¼‚æ­¥è¯·æ±‚çš„ç»„åˆï¼Œè§£å†³äº†ä¼ ç»ŸåŒæ­¥æ–¹å¼æ‰¹é‡è·å–æ·˜å®æœç´¢ç»“æœçš„æ•ˆç‡é—®é¢˜ã€‚æ ¸å¿ƒä¼˜åŠ¿åœ¨äºï¼š</p>
<ul>
<li><strong>é«˜å¹¶å‘</strong>ï¼šå¼‚æ­¥ IO å¤§å¹…æå‡è¯·æ±‚æ•ˆç‡ï¼Œæ•°åƒä¸ªå…³é”®è¯çš„é‡‡é›†è€—æ—¶ä»å°æ—¶çº§é™è‡³åˆ†é’Ÿçº§ï¼›</li>
<li><strong>é«˜å¯ç”¨</strong>ï¼šå¼‚å¸¸éš”ç¦»ã€å¹¶å‘æ§åˆ¶ä¿è¯æµç¨‹ä¸ä¸­æ–­ï¼Œå¤±è´¥ä»»åŠ¡å¯è¿½æº¯ï¼›</li>
<li><strong>æ˜“æ‰©å±•</strong>ï¼šé˜Ÿåˆ—æ¶æ„æ”¯æŒåˆ†å¸ƒå¼ã€é‡è¯•ã€ç›‘æ§ç­‰æ‰©å±•èƒ½åŠ›ï¼Œé€‚é…ä¸åŒè§„æ¨¡çš„é‡‡é›†éœ€æ±‚ã€‚</li>
</ul>
<p>è¯¥æ€è·¯ä¸ä»…é€‚ç”¨äºæ·˜å®æœç´¢ç»“æœé‡‡é›†ï¼Œä¹Ÿå¯è¿ç§»è‡³äº¬ä¸œã€æ‹¼å¤šå¤šç­‰ç”µå•†å¹³å°ï¼Œæˆ–å…¶ä»–éœ€è¦æ‰¹é‡å¼‚æ­¥è¯·æ±‚çš„åœºæ™¯ï¼ˆå¦‚ API æ‰¹é‡è°ƒç”¨ã€ç½‘é¡µæ‰¹é‡æŠ“å–ï¼‰ã€‚</p>
<p>â€‹</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ä½¿ç”¨ GitHub Actions ä¸ Docker å®ç° CaptchaVision API æŒç»­é›†æˆ]]></title>    <link>https://juejin.cn/post/7581292270961000458</link>    <guid>https://juejin.cn/post/7581292270961000458</guid>    <pubDate>2025-12-08T09:34:07.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581292270961000458" data-draft-id="7581406561684406318" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ä½¿ç”¨ GitHub Actions ä¸ Docker å®ç° CaptchaVision API æŒç»­é›†æˆ"/> <meta itemprop="keywords" content="Python"/> <meta itemprop="datePublished" content="2025-12-08T09:34:07.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="abining"/> <meta itemprop="url" content="https://juejin.cn/user/741495293092151"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ä½¿ç”¨ GitHub Actions ä¸ Docker å®ç° CaptchaVision API æŒç»­é›†æˆ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/741495293092151/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    abining
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-08T09:34:07.000Z" title="Mon Dec 08 2025 09:34:07 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    3
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»3åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">ä½¿ç”¨ GitHub Actions ä¸ Docker å®ç° CaptchaVision API æŒç»­é›†æˆ</h2>
<p>æœ¬æ–‡è¯¦ç»†è®²è§£å¦‚ä½•åˆ©ç”¨ <strong>GitHub Actions</strong> è‡ªåŠ¨åŒ–å·¥ä½œæµï¼Œé…åˆ <strong>Docker</strong> å®¹å™¨åŒ–æŠ€æœ¯ï¼Œå°†åŸºäº <strong>CaptchaVision</strong> é¡¹ç›®çš„ AI éªŒè¯ç è¯†åˆ«æœåŠ¡æŒç»­é›†æˆå¹¶æ¨é€åˆ° <strong>é˜¿é‡Œäº‘å®¹å™¨é•œåƒæœåŠ¡ï¼ˆACRï¼‰</strong> ã€‚</p>
<h3 data-id="heading-1">å‰è¨€</h3>
<p>æŒç»­é›†æˆï¼ˆCIï¼‰æ˜¯ç°ä»£è½¯ä»¶å¼€å‘çš„å…³é”®å®è·µã€‚é€šè¿‡ GitHub Actionsï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ä»£ç æ¨é€åˆ°ä»“åº“æ—¶ï¼Œè‡ªåŠ¨å®Œæˆ <strong>æ„å»ºé•œåƒã€ç™»å½•ä»“åº“ã€æ¨é€é•œåƒ</strong> ç­‰ç¹çæ­¥éª¤ã€‚</p>
<ul>
<li><strong>é¡¹ç›®åŸºç¡€ï¼š</strong> æœ¬æ–‡ä»¥ <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fabining%2FCaptchaVision" target="_blank" title="https://github.com/abining/CaptchaVision" ref="nofollow noopener noreferrer">github.com/abining/Capâ€¦</a> å¼€æºé¡¹ç›®ä¸ºä¾‹ï¼Œè¯¥é¡¹ç›®é€šå¸¸åŒ…å«ä¸€ä¸ªç”¨äº AI è¯†åˆ«å’Œå›¾åƒé¢„å¤„ç†çš„ Python æœåŠ¡ã€‚</li>
<li><strong>ç›®æ ‡å·¥ä½œæµï¼š</strong> æäº¤ä»£ç åˆ° <code>main</code> åˆ†æ”¯ â†’ GitHub Actions è‡ªåŠ¨æ„å»º Docker é•œåƒ â†’ é•œåƒæ¨é€è‡³é˜¿é‡Œäº‘ ACRã€‚</li>
</ul>
<h3 data-id="heading-2">ç¬¬ä¸€æ­¥ï¼šç¯å¢ƒä¸æœºå¯†ä¿¡æ¯é…ç½®</h3>
<p>ä¸ºäº†è®© GitHub Actions èƒ½å¤Ÿè‡ªåŠ¨ç™»å½•é˜¿é‡Œäº‘ ACR å¹¶ä½¿ç”¨æ‚¨çš„ä»“åº“ä¿¡æ¯ï¼Œæˆ‘ä»¬éœ€è¦åœ¨ GitHub ä¸­é…ç½®æœºå¯†ä¿¡æ¯ï¼ˆSecretsï¼‰ã€‚</p>
<h4 data-id="heading-3">1. å­˜å‚¨é˜¿é‡Œäº‘å‡­è¯å’Œä»“åº“ä¿¡æ¯</h4>
<p>æˆ‘ä»¬å°†æœºå¯†ä¿¡æ¯åˆ†ä¸ºä¸¤ç±»ï¼š</p>
<ul>
<li>
<p><strong>å­˜å‚¨åº“æœºå¯† (Repository Secrets)ï¼š</strong> é€‚ç”¨äºæ•´ä¸ªä»“åº“ã€‚</p>
<ul>
<li><code>REPO_NAME</code>: é•œåƒä»“åº“åç§°ï¼Œä¾‹å¦‚ <code>captcha_vision</code>ã€‚</li>
</ul>
</li>
<li>
<p><strong>ç¯å¢ƒæœºå¯† (Environment Secrets)ï¼š</strong> ä¸“ç”¨äºéƒ¨ç½²ç¯å¢ƒï¼Œå®‰å…¨æ€§æ›´é«˜ã€‚</p>
</li>
</ul>
<p>åœ¨ GitHub ä»“åº“ä¸­ï¼Œè¿›å…¥ <strong>Settings</strong> â†’ <strong>Security</strong> â†’ <strong>Secrets and variables</strong> â†’ <strong>Actions</strong>ã€‚</p>



































<table><thead><tr><th><strong>å¯†é’¥åç§°</strong></th><th><strong>ç±»å‹</strong></th><th><strong>å­˜å‚¨å€¼ç¤ºä¾‹</strong></th><th><strong>ç”¨é€”</strong></th></tr></thead><tbody><tr><td><code>ALI_DOCKER_HUB_REGISTRY</code></td><td>ç¯å¢ƒæœºå¯†</td><td><code>crpi-&lt;hashstring&gt;.cn-hangzhou.personal.cr.aliyuncs.com</code></td><td>é˜¿é‡Œäº‘ ACR åŒºåŸŸ Registry åœ°å€ã€‚</td></tr><tr><td><code>ALI_DOCKER_HUB_USN</code></td><td>ç¯å¢ƒæœºå¯†</td><td><code>æ‚¨çš„é˜¿é‡Œäº‘ç”¨æˆ·å</code></td><td>ç™»å½•é˜¿é‡Œäº‘ ACR çš„ç”¨æˆ·åã€‚</td></tr><tr><td><code>ALI_DOCKER_HUB_PWD</code></td><td>ç¯å¢ƒæœºå¯†</td><td><code>æ‚¨çš„é˜¿é‡Œäº‘å¯†ç æˆ–è®¿é—®ä»¤ç‰Œ</code></td><td>ç™»å½•é˜¿é‡Œäº‘ ACR çš„å¯†ç /ä»¤ç‰Œã€‚</td></tr><tr><td><code>REPO_NAME</code></td><td>å­˜å‚¨åº“æœºå¯†</td><td><code>captcha_vision</code></td><td>ç”¨äºæ„å»º <code>tags</code> çš„é•œåƒä»“åº“åç§°ã€‚</td></tr></tbody></table>
<blockquote>
<p><strong>âš ï¸ æ³¨æ„ï¼š</strong> æ‚¨çš„æœºå¯†ä¿¡æ¯ï¼ˆå¦‚ <code>ALI_DOCKER_HUB_PWD</code> å’Œ <code>ALI_DOCKER_HUB_USN</code>ï¼‰è¢«å…³è”åˆ°åä¸º <code>ALI_DOCKER_HUB_REGISTRY</code> çš„<strong>ç¯å¢ƒ</strong>ã€‚å› æ­¤ï¼Œåœ¨ YAML ä¸­æˆ‘ä»¬å¿…é¡»æŒ‡å®š <code>environment: ALI_DOCKER_HUB_REGISTRY</code> æ‰èƒ½è§£é”è¿™äº›æœºå¯†ã€‚</p>
</blockquote>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f5c31136473c489e84bccf6b29953082~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgYWJpbmluZw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765792272&amp;x-signature=xx3joACqlbUs0mc3PUEIkzJwjO4%3D" alt="image.png" loading="lazy"/></p>
<h4 data-id="heading-4">2. åˆ›å»ºé˜¿é‡Œäº‘é•œåƒä»“åº“</h4>
<p>åœ¨é˜¿é‡Œäº‘æ§åˆ¶å°<a href="https://link.juejin.cn?target=https%3A%2F%2Fcr.console.aliyun.com%2Fcn-hangzhou%2Finstance%2Frepositories" target="_blank" title="https://cr.console.aliyun.com/cn-hangzhou/instance/repositories" ref="nofollow noopener noreferrer">cr.console.aliyun.com/cn-hangzhouâ€¦</a> è¿›è¡Œä»¥ä¸‹æ“ä½œï¼š</p>
<ul>
<li>è®¿é—® <strong>å®¹å™¨é•œåƒæœåŠ¡</strong> (Container Registry)ã€‚</li>
<li>è¿›å…¥ <strong>å®ä¾‹/ä»“åº“ç®¡ç†</strong>ï¼Œåˆ›å»ºæ–°çš„é•œåƒä»“åº“ï¼ˆä¾‹å¦‚ï¼Œå‘½åä¸º <code>chouvelgis/captchavision</code>ï¼‰ã€‚</li>
<li>å°†ä»£ç æºè®¾ç½®ä¸º<strong>æ‰‹åŠ¨ä¸Šä¼ </strong>ï¼Œå¹¶è®°å½•æ‚¨çš„ <strong>Registry åœ°å€</strong>ã€‚</li>
</ul>
<h3 data-id="heading-5">ğŸ’» ç¬¬äºŒæ­¥ï¼šç¼–å†™ GitHub Actions å·¥ä½œæµæ–‡ä»¶</h3>
<p>åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹åˆ›å»º <code>.github/workflows/deploy.yml</code> æ–‡ä»¶ã€‚ä»¥ä¸‹æ˜¯æ‚¨çš„éƒ¨ç½²è„šæœ¬ï¼Œå®ƒå°†å®ç°è‡ªåŠ¨æ„å»ºã€ç™»å½•ã€æ¨é€çš„å®Œæ•´ CI è¿‡ç¨‹ã€‚</p>
<pre><code class="hljs language-YAML" lang="YAML"><span class="hljs-comment"># å·¥ä½œæµç¨‹åç§°</span>
<span class="hljs-attr">name:</span> <span class="hljs-string">Docker</span> <span class="hljs-string">éƒ¨ç½²</span> <span class="hljs-string">CaptchaVision</span> <span class="hljs-string">API</span>

<span class="hljs-comment"># è§¦å‘æ¡ä»¶ï¼šå½“ä»£ç æ¨é€åˆ° main åˆ†æ”¯æ—¶è§¦å‘å·¥ä½œæµ</span>
<span class="hljs-attr">on:</span>
  <span class="hljs-attr">push:</span>
    <span class="hljs-attr">branches:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">main</span>

<span class="hljs-comment"># å·¥ä½œæµç¨‹ä½œä¸š</span>
<span class="hljs-attr">jobs:</span>
  <span class="hljs-attr">deploy:</span>
    <span class="hljs-attr">runs-on:</span> <span class="hljs-string">ubuntu-latest</span>
    <span class="hljs-comment"># å…³é”®æ­¥éª¤ï¼šæŒ‡å®šç¯å¢ƒï¼Œä»¥è§£é”ç¯å¢ƒæœºå¯†ï¼ˆALI_DOCKER_HUB_USN/PWDï¼‰</span>
    <span class="hljs-attr">environment:</span> <span class="hljs-string">ALI_DOCKER_HUB_REGISTRY</span>
    
    <span class="hljs-attr">steps:</span>
      <span class="hljs-comment"># 1. è¿å‡ºä»£ç </span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">è¿å‡ºä»£ç </span>
        <span class="hljs-attr">uses:</span> <span class="hljs-string">actions/checkout@v4</span>

      <span class="hljs-comment"># 2. è®¾ç½® Docker Buildx (ç”¨äºé«˜æ•ˆæ„å»ºå’Œç¼“å­˜)</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">è®¾ç½®</span> <span class="hljs-string">Docker</span> <span class="hljs-string">Buildx</span>
        <span class="hljs-attr">uses:</span> <span class="hljs-string">docker/setup-buildx-action@v3</span>

      <span class="hljs-comment"># 3. ç™»å½•åˆ°é˜¿é‡Œäº‘å®¹å™¨é•œåƒæœåŠ¡ (ä½¿ç”¨ç¯å¢ƒæœºå¯†)</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">ç™»å½•åˆ°é˜¿é‡Œäº‘å®¹å™¨é•œåƒæœåŠ¡</span>
        <span class="hljs-attr">uses:</span> <span class="hljs-string">docker/login-action@v3</span>
        <span class="hljs-attr">with:</span>
          <span class="hljs-attr">registry:</span> <span class="hljs-string">${{</span> <span class="hljs-string">secrets.ALI_DOCKER_HUB_REGISTRY</span> <span class="hljs-string">}}</span>
          <span class="hljs-attr">username:</span> <span class="hljs-string">${{</span> <span class="hljs-string">secrets.ALI_DOCKER_HUB_USN</span> <span class="hljs-string">}}</span>
          <span class="hljs-attr">password:</span> <span class="hljs-string">${{</span> <span class="hljs-string">secrets.ALI_DOCKER_HUB_PWD</span> <span class="hljs-string">}}</span>

      <span class="hljs-comment"># 4.æ„å»ºå¹¶æ¨é€ Docker é•œåƒ</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">æ„å»ºå¹¶æ¨é€</span> <span class="hljs-string">Docker</span> <span class="hljs-string">é•œåƒ</span>
        <span class="hljs-attr">uses:</span> <span class="hljs-string">docker/build-push-action@v5</span>
        <span class="hljs-attr">with:</span>
          <span class="hljs-attr">context:</span> <span class="hljs-string">.</span>
          <span class="hljs-attr">push:</span> <span class="hljs-literal">true</span>
          <span class="hljs-attr">tags:</span> <span class="hljs-string">|
            ${{ secrets.ALI_DOCKER_HUB_REGISTRY }}/chouvelgis/${{ secrets.REPO_NAME }}:latest
            ${{ secrets.ALI_DOCKER_HUB_REGISTRY }}/chouvelgis/${{ secrets.REPO_NAME }}:${{ github.sha }}
            ${{ secrets.ALI_DOCKER_HUB_REGISTRY }}/chouvelgis/${{ secrets.REPO_NAME }}:v${{ github.run_number }}
</span>          <span class="hljs-attr">cache-from:</span> <span class="hljs-string">type=gha</span> <span class="hljs-comment"># ä» GHA ç¼“å­˜ä¸­æ‹‰å–å†å²æ„å»ºå±‚</span>
          <span class="hljs-attr">cache-to:</span> <span class="hljs-string">type=gha,mode=max</span> <span class="hljs-comment"># æ¨é€æ–°çš„æ„å»ºå±‚åˆ° GHA ç¼“å­˜</span>

      <span class="hljs-comment"># 5. éƒ¨ç½²å®Œæˆé€šçŸ¥</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">éƒ¨ç½²å®Œæˆ</span>
        <span class="hljs-attr">run:</span> <span class="hljs-string">echo</span> <span class="hljs-string">"Docker éƒ¨ç½²å®Œæˆï¼Œé•œåƒå·²æ¨é€åˆ° Aliyun ACRï¼"</span>
</code></pre>
<h3 data-id="heading-6">ğŸ“ˆ ç¬¬ä¸‰æ­¥ï¼šæŸ¥çœ‹å·¥ä½œæµæ—¥å¿—ä¸åç»­éƒ¨ç½²</h3>
<h4 data-id="heading-7">1. æŸ¥çœ‹å·¥ä½œæµæ—¥å¿—</h4>
<p>ä»£ç æäº¤åˆ° <code>main</code> åˆ†æ”¯åï¼š</p>
<ol>
<li>è¿›å…¥ GitHub ä»“åº“çš„ <strong>Actions</strong> èœå•ã€‚</li>
<li>æ‰¾åˆ°åä¸º <code>Docker éƒ¨ç½² CaptchaVision API</code> çš„å·¥ä½œæµã€‚</li>
<li>ç‚¹å‡»æŸ¥çœ‹æ—¥å¿—ï¼Œæ‰€æœ‰æ­¥éª¤ï¼ˆå¦‚â€œç™»å½•åˆ°é˜¿é‡Œäº‘å®¹å™¨é•œåƒæœåŠ¡â€ã€â€œæ„å»ºå¹¶æ¨é€ Docker é•œåƒâ€ï¼‰éƒ½åº”æ˜¾ç¤ºç»¿è‰²å‹¾é€‰ï¼ˆâœ…ï¼‰ã€‚</li>
</ol>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/17e414ed09334169b3a07b9a4da725c8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgYWJpbmluZw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765792272&amp;x-signature=zM%2F5nmXmJlTgCgyKo3n8iGXgznk%3D" alt="image.png" loading="lazy"/></p>
<h4 data-id="heading-8">2. éƒ¨ç½²åˆ°æœåŠ¡å™¨ï¼ˆCD)</h4>
<p>ä¸€æ—¦é•œåƒæ¨é€æˆåŠŸï¼Œæ‚¨çš„ CI ä»»åŠ¡å°±å®Œæˆäº†ã€‚æ¥ä¸‹æ¥çš„ CDï¼ˆæŒç»­éƒ¨ç½²ï¼‰éœ€è¦åœ¨æ‚¨çš„ç›®æ ‡æœåŠ¡å™¨ä¸Šæ‰§è¡Œã€‚</p>
<p>åœ¨æœåŠ¡å™¨ç»ˆç«¯ï¼Œä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ‹‰å–å¹¶å¯åŠ¨æœ€æ–°çš„å®¹å™¨ï¼š</p>
<p>ç›´æ¥å»<a href="https://link.juejin.cn?target=https%3A%2F%2Fcr.console.aliyun.com%2Fcn-hangzhou%2Finstance%2Frepositories" target="_blank" title="https://cr.console.aliyun.com/cn-hangzhou/instance/repositories" ref="nofollow noopener noreferrer">cr.console.aliyun.com/cn-hangzhouâ€¦</a> æ§åˆ¶å°ï¼Œæ‰¾åˆ°å¯¹åº”é•œåƒä»“åº“ï¼ŒæŸ¥çœ‹ç›¸å…³æ–‡æ¡£å³å¯æ‹‰å–é•œåƒã€‚å¦‚æœä½¿ç”¨é˜¿é‡Œäº‘çš„ECSï¼Œå¯ä»¥ä½¿ç”¨é•œåƒä»“åº“å†…ç½‘åœ°å€ï¼ŒåŠ å¿«é€Ÿåº¦ã€‚</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># å‡è®¾æ‚¨å·²ç™»å½•é˜¿é‡Œäº‘ ACR</span>

<span class="hljs-comment"># åœæ­¢å¹¶ç§»é™¤æ—§å®¹å™¨ (å¦‚æœå­˜åœ¨)</span>
docker stop captchavision-api
docker <span class="hljs-built_in">rm</span> captchavision-api

<span class="hljs-comment"># æ‹‰å–æœ€æ–°çš„é•œåƒ (ä½¿ç”¨ latest æ ‡ç­¾)</span>
docker pull <span class="hljs-variable">${{ secrets.ALI_DOCKER_HUB_REGISTRY }</span>}/chouvelgis/<span class="hljs-variable">${{ secrets.REPO_NAME }</span>}:latest

<span class="hljs-comment"># å¯åŠ¨å®¹å™¨ (æ³¨æ„ï¼šå¦‚æœåº”ç”¨éœ€è¦ API Keyï¼Œè¯·åœ¨è¿è¡Œæ—¶æ³¨å…¥ -e å‚æ•°)</span>
docker run -d \
  -p 8011:8011 \
  --name=captchavision-api \
  -e GEMINI_API_KEY=<span class="hljs-string">"æ‚¨çš„Gemini API Key"</span> \
  <span class="hljs-variable">${{ secrets.ALI_DOCKER_HUB_REGISTRY }</span>}/chouvelgis/<span class="hljs-variable">${{ secrets.REPO_NAME }</span>}:latest
</code></pre>
<h2 data-id="heading-9">æ€»ç»“</h2>
<p>é€šè¿‡è¿™ä¸€å¥—æµç¨‹ï¼Œæ‚¨å®ç°äº†ä»ä»£ç æäº¤åˆ°é•œåƒæ¨é€çš„å®Œå…¨è‡ªåŠ¨åŒ–ï¼Œæå¤§åœ°æé«˜äº†å¼€å‘æ•ˆç‡å’Œéƒ¨ç½²ä¸€è‡´æ€§ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[.NET ä¸­çš„å¼‚æ­¥ç¼–ç¨‹ï¼šæå‡åº”ç”¨æ€§èƒ½ä¸å“åº”èƒ½åŠ›]]></title>    <link>https://juejin.cn/post/7581312433529110571</link>    <guid>https://juejin.cn/post/7581312433529110571</guid>    <pubDate>2025-12-08T09:08:35.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581312433529110571" data-draft-id="7581312433529094187" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content=".NET ä¸­çš„å¼‚æ­¥ç¼–ç¨‹ï¼šæå‡åº”ç”¨æ€§èƒ½ä¸å“åº”èƒ½åŠ›"/> <meta itemprop="keywords" content="åç«¯"/> <meta itemprop="datePublished" content="2025-12-08T09:08:35.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="æ·¡å®š__009"/> <meta itemprop="url" content="https://juejin.cn/user/2999123453676765"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            .NET ä¸­çš„å¼‚æ­¥ç¼–ç¨‹ï¼šæå‡åº”ç”¨æ€§èƒ½ä¸å“åº”èƒ½åŠ›
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2999123453676765/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    æ·¡å®š__009
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-08T09:08:35.000Z" title="Mon Dec 08 2025 09:08:35 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»4åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">.NET ä¸­çš„å¼‚æ­¥ç¼–ç¨‹ï¼šæå‡åº”ç”¨æ€§èƒ½ä¸å“åº”èƒ½åŠ›</h2>
<p>åœ¨ç°ä»£åº”ç”¨ç¨‹åºä¸­ï¼Œæ€§èƒ½å’Œå“åº”èƒ½åŠ›æ˜¯è¡¡é‡è´¨é‡çš„å…³é”®æŒ‡æ ‡ä¹‹ä¸€ã€‚åœ¨ <code>.NET</code> ä¸­ï¼Œå¼‚æ­¥ç¼–ç¨‹æ˜¯ä¸€ç§å¸¸è§ä¸”æœ‰æ•ˆçš„æå‡åº”ç”¨æ€§èƒ½å’Œå“åº”èƒ½åŠ›çš„æ–¹å¼ã€‚é€šè¿‡å¼‚æ­¥ç¼–ç¨‹ï¼Œå¯ä»¥ç¡®ä¿åº”ç”¨åœ¨å¤„ç†è€—æ—¶æ“ä½œæ—¶ä¸ä¼šé˜»å¡ä¸»çº¿ç¨‹ï¼Œä»è€Œæé«˜ç”¨æˆ·ä½“éªŒã€‚</p>
<h3 data-id="heading-1">å¼‚æ­¥ç¼–ç¨‹çš„æ¦‚å¿µ</h3>
<p>å¼‚æ­¥ç¼–ç¨‹æ„å‘³ç€åœ¨æ‰§è¡ŒæŸä¸ªæ“ä½œæ—¶ï¼Œç¨‹åºä¸ä¼šç­‰å¾…æ“ä½œå®Œæˆåå†ç»§ç»­æ‰§è¡Œï¼Œè€Œæ˜¯å¯ä»¥ç»§ç»­æ‰§è¡Œå…¶ä»–ä»»åŠ¡ï¼Œç­‰åˆ°æ“ä½œå®Œæˆæ—¶å†è¿”å›ç»“æœã€‚é€šå¸¸ï¼Œè¿™ç±»æ“ä½œä¼šæ¶‰åŠåˆ°è€—æ—¶çš„ I/O æ“ä½œï¼Œå¦‚æ•°æ®åº“æŸ¥è¯¢ã€æ–‡ä»¶è¯»å†™æˆ–ç½‘ç»œè¯·æ±‚ç­‰ã€‚</p>
<p>åœ¨ .NET ä¸­ï¼Œå¼‚æ­¥ç¼–ç¨‹é€šå¸¸é€šè¿‡ <code>async</code> å’Œ <code>await</code> å…³é”®å­—æ¥å®ç°ã€‚è¿™ä¸¤è€…ç»“åˆä½¿ç”¨ï¼Œå¯ä»¥ä½¿ä»£ç çœ‹èµ·æ¥åƒæ˜¯åŒæ­¥çš„ï¼ŒåŒæ—¶ä¿æŒå¼‚æ­¥æ‰§è¡Œçš„æ•ˆæœã€‚</p>
<h3 data-id="heading-2"><code>async</code> å’Œ <code>await</code> å…³é”®å­—</h3>
<h4 data-id="heading-3"><code>async</code> å…³é”®å­—</h4>
<p><code>async</code> å…³é”®å­—ç”¨äºæ ‡è®°ä¸€ä¸ªæ–¹æ³•ä¸ºå¼‚æ­¥æ–¹æ³•ã€‚å®ƒå‘Šè¯‰ç¼–è¯‘å™¨ï¼Œè¿™ä¸ªæ–¹æ³•ä¸­å°†åŒ…å«å¼‚æ­¥æ“ä½œï¼Œå¹¶ä¸”æ–¹æ³•ä¼šè¿”å›ä¸€ä¸ª <code>Task</code> æˆ– <code>Task&lt;T&gt;</code> å¯¹è±¡ã€‚å¼‚æ­¥æ–¹æ³•ä¸ä¼šç«‹å³æ‰§è¡Œï¼Œè€Œæ˜¯è¿”å›ä¸€ä¸ªè¡¨ç¤ºæ“ä½œçŠ¶æ€çš„ <code>Task</code>ã€‚</p>
<h4 data-id="heading-4"><code>await</code> å…³é”®å­—</h4>
<p><code>await</code> å…³é”®å­—ç”¨äºåœ¨å¼‚æ­¥æ–¹æ³•ä¸­ç­‰å¾…ä¸€ä¸ªä»»åŠ¡çš„å®Œæˆã€‚å½“ <code>await</code> å…³é”®å­—è°ƒç”¨æ—¶ï¼Œå®ƒä¼šæš‚åœæ–¹æ³•çš„æ‰§è¡Œï¼Œç›´åˆ°ä»»åŠ¡å®Œæˆã€‚è¿™æ—¶ï¼Œå½“å‰çº¿ç¨‹å¯ä»¥ç»§ç»­æ‰§è¡Œå…¶ä»–ä»»åŠ¡ï¼Œé¿å…äº†é˜»å¡ã€‚</p>
<h4 data-id="heading-5">ç¤ºä¾‹ä»£ç </h4>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">async</span> Task&lt;<span class="hljs-built_in">string</span>&gt; <span class="hljs-title">GetDataFromWebAsync</span>(<span class="hljs-params"><span class="hljs-built_in">string</span> url</span>)</span>
{
    <span class="hljs-keyword">using</span> (<span class="hljs-keyword">var</span> client = <span class="hljs-keyword">new</span> HttpClient())
    {
        <span class="hljs-built_in">string</span> result = <span class="hljs-keyword">await</span> client.GetStringAsync(url);
        <span class="hljs-keyword">return</span> result;
    }
}
</code></pre>
<p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œ<code>GetDataFromWebAsync</code> æ–¹æ³•æ˜¯ä¸€ä¸ªå¼‚æ­¥æ–¹æ³•ï¼Œå®ƒé€šè¿‡ <code>HttpClient</code> ä»æŒ‡å®šçš„ URL è·å–æ•°æ®ã€‚<code>await</code> ä¼šè®©ç¨‹åºåœ¨ <code>GetStringAsync</code> å®Œæˆä¹‹å‰ç»§ç»­æ‰§è¡Œå…¶ä»–ä»»åŠ¡ï¼Œè€Œä¸ä¼šé˜»å¡çº¿ç¨‹ã€‚</p>
<h3 data-id="heading-6">å¼‚æ­¥ç¼–ç¨‹çš„ä¼˜åŠ¿</h3>
<h4 data-id="heading-7">1. æé«˜åº”ç”¨ç¨‹åºå“åº”æ€§</h4>
<p>å¼‚æ­¥ç¼–ç¨‹èƒ½å¤Ÿæ˜¾è‘—æé«˜åº”ç”¨ç¨‹åºçš„å“åº”æ€§ã€‚ä¾‹å¦‚ï¼Œåœ¨ UI åº”ç”¨ä¸­ï¼Œå½“ä¸»çº¿ç¨‹åœ¨è¿›è¡Œé•¿æ—¶é—´çš„æ“ä½œï¼ˆå¦‚æ•°æ®åº“æŸ¥è¯¢æˆ–æ–‡ä»¶ä¸‹è½½ï¼‰æ—¶ï¼Œç•Œé¢ä¼šè¢«å†»ç»“ï¼Œè€Œä½¿ç”¨å¼‚æ­¥ç¼–ç¨‹åï¼Œç•Œé¢å¯ä»¥ç»§ç»­å“åº”ç”¨æˆ·çš„è¾“å…¥ï¼Œé¿å…äº†åº”ç”¨â€œå‡æ­»â€çš„æƒ…å†µã€‚</p>
<h4 data-id="heading-8">2. ä¼˜åŒ–ç³»ç»Ÿèµ„æºåˆ©ç”¨</h4>
<p>åœ¨æ²¡æœ‰å¼‚æ­¥çš„æƒ…å†µä¸‹ï¼Œçº¿ç¨‹åœ¨ç­‰å¾…æ“ä½œå®Œæˆæ—¶ä¼šè¢«é˜»å¡ï¼Œæµªè´¹äº†å¤§é‡çš„ç³»ç»Ÿèµ„æºã€‚ä½¿ç”¨å¼‚æ­¥ç¼–ç¨‹ï¼Œæ“ä½œåœ¨ç­‰å¾…æ—¶ä¸ä¼šå ç”¨çº¿ç¨‹ï¼Œç³»ç»Ÿå¯ä»¥æ›´é«˜æ•ˆåœ°åˆ©ç”¨èµ„æºï¼Œå¤„ç†æ›´å¤šçš„è¯·æ±‚ã€‚</p>
<h4 data-id="heading-9">3. å¢å¼ºå¯æ‰©å±•æ€§</h4>
<p>å¯¹äº Web åº”ç”¨å’ŒæœåŠ¡ï¼Œå¼‚æ­¥ç¼–ç¨‹èƒ½å¤Ÿåœ¨ä¸å¢åŠ é¢å¤–ç¡¬ä»¶èµ„æºçš„æƒ…å†µä¸‹å¤„ç†æ›´å¤šçš„å¹¶å‘è¯·æ±‚ã€‚è¿™æ˜¯å› ä¸ºå¼‚æ­¥æ“ä½œèƒ½å¤Ÿé«˜æ•ˆåœ°ä½¿ç”¨çº¿ç¨‹æ± ï¼Œé¿å…äº†ä¼ ç»Ÿçš„åŒæ­¥ç¼–ç¨‹ä¸­å› çº¿ç¨‹æ± èµ„æºé™åˆ¶è€Œäº§ç”Ÿçš„ç“¶é¢ˆã€‚</p>
<h3 data-id="heading-10">å¼‚æ­¥ç¼–ç¨‹çš„æ³¨æ„äº‹é¡¹</h3>
<h4 data-id="heading-11">1. å¼‚å¸¸å¤„ç†</h4>
<p>å¼‚æ­¥æ–¹æ³•ä¸­çš„å¼‚å¸¸éœ€è¦ç‰¹åˆ«å¤„ç†ã€‚å½“å¼‚æ­¥æ–¹æ³•æŠ›å‡ºå¼‚å¸¸æ—¶ï¼Œå®ƒä»¬ä¸ä¼šåƒåŒæ­¥æ–¹æ³•é‚£æ ·ç›´æ¥æŠ›å‡ºï¼Œè€Œæ˜¯åŒ…è£…åœ¨ <code>Task</code> å¯¹è±¡ä¸­ã€‚å› æ­¤ï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨ <code>try-catch</code> æ¥å¤„ç†å¼‚æ­¥æ–¹æ³•ä¸­çš„å¼‚å¸¸ã€‚</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">async</span> Task&lt;<span class="hljs-built_in">string</span>&gt; <span class="hljs-title">GetDataFromWebAsync</span>(<span class="hljs-params"><span class="hljs-built_in">string</span> url</span>)</span>
{
    <span class="hljs-keyword">try</span>
    {
        <span class="hljs-keyword">using</span> (<span class="hljs-keyword">var</span> client = <span class="hljs-keyword">new</span> HttpClient())
        {
            <span class="hljs-built_in">string</span> result = <span class="hljs-keyword">await</span> client.GetStringAsync(url);
            <span class="hljs-keyword">return</span> result;
        }
    }
    <span class="hljs-keyword">catch</span> (Exception ex)
    {
        <span class="hljs-comment">// å¤„ç†å¼‚å¸¸</span>
        <span class="hljs-keyword">return</span> <span class="hljs-string">$"Error: <span class="hljs-subst">{ex.Message}</span>"</span>;
    }
}
</code></pre>
<h4 data-id="heading-12">2. ä¸è¦åœ¨ <code>async</code> æ–¹æ³•ä¸­ä½¿ç”¨ <code>Result</code> æˆ– <code>Wait()</code></h4>
<p>åœ¨å¼‚æ­¥æ–¹æ³•ä¸­ï¼Œé¿å…ä½¿ç”¨ <code>Task.Result</code> æˆ– <code>Task.Wait()</code> æ¥ç­‰å¾…å¼‚æ­¥ä»»åŠ¡å®Œæˆï¼Œå› ä¸ºè¿™ä¼šå¯¼è‡´æ­»é”ã€‚ä½¿ç”¨ <code>await</code> æ˜¯æ­£ç¡®çš„æ–¹å¼ï¼Œå®ƒä¸ä¼šé˜»å¡å½“å‰çº¿ç¨‹ã€‚</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-comment">// é”™è¯¯ç¤ºä¾‹</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-built_in">string</span> <span class="hljs-title">GetData</span>(<span class="hljs-params"><span class="hljs-built_in">string</span> url</span>)</span>
{
    <span class="hljs-keyword">var</span> result = GetDataFromWebAsync(url).Result;  <span class="hljs-comment">// è¿™æ ·ä¼šé˜»å¡çº¿ç¨‹ï¼Œå¯èƒ½å¯¼è‡´æ­»é”</span>
    <span class="hljs-keyword">return</span> result;
}
</code></pre>
<h4 data-id="heading-13">3. å¼‚æ­¥ä¸å¹¶å‘</h4>
<p>è™½ç„¶å¼‚æ­¥èƒ½å¤Ÿæå‡åº”ç”¨æ€§èƒ½ï¼Œä½†å®ƒå¹¶ä¸ç­‰åŒäºå¹¶è¡Œå¤„ç†ã€‚å¦‚æœéœ€è¦çœŸæ­£çš„å¹¶å‘å¤„ç†ï¼ˆæ¯”å¦‚å¤šæ ¸å¤„ç†å™¨ä¸Šçš„ä»»åŠ¡å¹¶è¡Œæ‰§è¡Œï¼‰ï¼Œå¯ä»¥ç»“åˆå¼‚æ­¥ä¸å¹¶è¡Œç¼–ç¨‹ï¼ˆå¦‚ <code>Task.WhenAll</code>ï¼‰æ¥å®ç°ã€‚</p>
<h3 data-id="heading-14">æ€»ç»“</h3>
<p>å¼‚æ­¥ç¼–ç¨‹æ˜¯æå‡ <code>.NET</code> åº”ç”¨ç¨‹åºæ€§èƒ½å’Œå“åº”èƒ½åŠ›çš„é‡è¦æ‰‹æ®µã€‚é€šè¿‡åˆç†ä½¿ç”¨ <code>async</code> å’Œ <code>await</code>ï¼Œå¼€å‘è€…å¯ä»¥åœ¨ä¿è¯ä»£ç æ¸…æ™°æ˜“æ‡‚çš„åŒæ—¶ï¼Œé¿å…çº¿ç¨‹é˜»å¡ï¼Œæé«˜èµ„æºåˆ©ç”¨ç‡å’Œå¹¶å‘å¤„ç†èƒ½åŠ›ã€‚åœ¨å®é™…å¼€å‘ä¸­ï¼Œå¼€å‘è€…åº”æ³¨æ„æ­£ç¡®çš„å¼‚å¸¸å¤„ç†å’Œé¿å…é˜»å¡çº¿ç¨‹çš„åšæ³•ï¼Œä»¥å®ç°æ›´é«˜æ•ˆã€æ›´ç¨³å®šçš„åº”ç”¨ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ä¸€æ–‡è¯¦è§£ Taro / å°ç¨‹åº IntersectionObserver å‚æ•°]]></title>    <link>https://juejin.cn/post/7581073928717090850</link>    <guid>https://juejin.cn/post/7581073928717090850</guid>    <pubDate>2025-12-08T09:33:13.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581073928717090850" data-draft-id="7581041679190605859" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ä¸€æ–‡è¯¦è§£ Taro / å°ç¨‹åº IntersectionObserver å‚æ•°"/> <meta itemprop="keywords" content="å‰ç«¯"/> <meta itemprop="datePublished" content="2025-12-08T09:33:13.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="æ¸…å¦_"/> <meta itemprop="url" content="https://juejin.cn/user/2555702335768637"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ä¸€æ–‡è¯¦è§£ Taro / å°ç¨‹åº IntersectionObserver å‚æ•°
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2555702335768637/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    æ¸…å¦_
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-08T09:33:13.000Z" title="Mon Dec 08 2025 09:33:13 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    19
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»2åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>åªè¦ç†è§£â€œ<strong>ä¸¤ä¸ªçŸ©å½¢çš„é‡å åŒºåŸŸ</strong>â€è¿™ä»¶äº‹ï¼Œ<code>IntersectionObserver</code> å®Œå…¨ä¸éš¾</p>
<p>IntersectionObserver çš„æœ¬è´¨æ˜¯è§‚å¯Ÿ <strong>ä¸¤ä¸ªåŒºåŸŸæ˜¯å¦ç›¸äº¤</strong>ï¼Œå½“ç›¸äº¤åŒºåŸŸäº§ç”Ÿæˆ–å˜åŒ–æ—¶ï¼Œå°±ä¼šè§¦å‘å›è°ƒ</p>
<h3 data-id="heading-0">relativeTo(string selector, Object margins) å‚æ•°è§£æ</h3>
<p>å®˜æ–¹è§£é‡Šï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fdevelopers.weixin.qq.com%2Fminiprogram%2Fdev%2Fapi%2Fwxml%2FIntersectionObserver.relativeTo.html" target="_blank" title="https://developers.weixin.qq.com/miniprogram/dev/api/wxml/IntersectionObserver.relativeTo.html" ref="nofollow noopener noreferrer">developers.weixin.qq.com/miniprogramâ€¦</a></p>
<p>å‚æ•°ä¸­çš„ margins è§£é‡Šä¸æ˜¯å¾ˆè¯¦ç»†ï¼Œä¸ªäººç†è§£å›¾ç¤ºå¦‚ä¸‹ï¼š</p>
<p><strong>æ­£å€¼ä¸ºå‘å¤–æ‰©å¼ è¾¹ç•Œï¼Œè´Ÿå€¼ä¸ºå‘å†…æ”¶ç¼©è¾¹ç•Œã€‚</strong></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/44183122871144eea653f726867b5c6d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5riF5aaNXw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765793062&amp;x-signature=lBwfNox3ymxVmU2%2FjeKrWL%2B%2FrQA%3D" alt="æ”¶ç¼©.png" loading="lazy"/></p>
<p>è°ƒç”¨æ–¹å¼ç¤ºä¾‹ï¼š</p>
<pre><code class="hljs language-css" lang="css">observer<span class="hljs-selector-class">.relativeToViewport</span>({
  <span class="hljs-attribute">top</span>: -<span class="hljs-number">50</span>,
  bottom: <span class="hljs-number">100</span>,
});
</code></pre>
<h3 data-id="heading-1">observe(string targetSelector, function callback) ä¸­çš„å›è°ƒå‡½æ•°å‚æ•°è§£æ</h3>
<p>å®˜æ–¹è§£é‡Šï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fdevelopers.weixin.qq.com%2Fminiprogram%2Fdev%2Fapi%2Fwxml%2FIntersectionObserver.observe.html" target="_blank" title="https://developers.weixin.qq.com/miniprogram/dev/api/wxml/IntersectionObserver.observe.html" ref="nofollow noopener noreferrer">developers.weixin.qq.com/miniprogramâ€¦</a></p>
<p>function callback ä¸­çš„ <code>intersectionRect</code>ã€<code>boundingClientRect</code>ã€<code>relativeRect</code> å‚æ•°è§£é‡Šï¼š</p>





















<table><thead><tr><th>åŒºåŸŸ</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><strong>ç›®æ ‡åŒºåŸŸ</strong> <code>boundingClientRect</code></td><td>ä½ è¦è§‚å¯Ÿçš„å…ƒç´ çš„ä½ç½®ä¸å¤§å°</td></tr><tr><td><strong>å‚ç…§åŒºåŸŸ</strong> <code>relativeRect</code></td><td>é€šå¸¸æ˜¯è§†å£ï¼ˆå±å¹•å¯è§éƒ¨åˆ†ï¼‰ï¼Œä¹Ÿå¯ä»¥æ˜¯è‡ªå®šä¹‰å®¹å™¨</td></tr><tr><td><strong>ç›¸äº¤åŒºåŸŸ</strong> <code>intersectionRect</code></td><td>ç›®æ ‡åŒºåŸŸä¸å‚ç…§åŒºåŸŸçš„<strong>é‡å éƒ¨åˆ†</strong></td></tr></tbody></table>
<p>æ¯ä¸ª rect ä¸­çš„top/bottom/left/right å‚æ•°è§£é‡Šï¼š</p>
<p>é¦–å…ˆç†è§£è¿™ä»£è¡¨ä¸€ä¸ªåæ ‡ï¼Œåæ ‡ç³»çŸ¥è¯†ï¼ˆç†è§£ top/bottom å¾ˆå…³é”®ï¼‰ï¼Œä»¥å±å¹•å·¦ä¸Šè§’ä¸ºåŸç‚¹ï¼Œx å‘å³é€’å¢ï¼Œy å‘ä¸‹é€’å¢</p>
<p>ä¸ªäººç†è§£å¦‚å›¾æ‰€ç¤ºï¼š</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5c870d1b90f943f582d9b37950c2b7d1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5riF5aaNXw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765793062&amp;x-signature=kp5khtIG00cs%2FEK80VeJs%2BFkVn8%3D" alt="image.png" loading="lazy"/></p>
<p><strong>æ˜“æ··æ·†é‡ç‚¹ï¼šmargins çš„ top â‰  å›è°ƒé‡Œçš„ top</strong></p>























<table><thead><tr><th>åç§°</th><th>å‡ºç°ä½ç½®</th><th>è¡¨ç¤ºçš„å«ä¹‰</th><th>ç®€å•ç†è§£</th></tr></thead><tbody><tr><td><strong>margins ä¸­çš„ top/bottom/left/right</strong></td><td><code>.relativeToViewport({ ... })</code></td><td>å‚ç…§åŒºåŸŸè¾¹ç•Œçš„æ‰©å¼ æˆ–ç¼©å°</td><td>æ‰©å¤§/ç¼©å°è§‚å¯ŸèŒƒå›´</td></tr><tr><td><strong>å›è°ƒä¸­çš„ top/bottom/left/right</strong></td><td><code>observe(..., callback(res))</code></td><td>æŸä¸ªçŸ©å½¢ç›¸å¯¹å±å¹•çš„åæ ‡ä½ç½®</td><td>å½“å‰å…ƒç´ åœ¨å“ªé‡Œ</td></tr></tbody></table>
<p>åœ¨å¯è§†åŒ–åŒºåŸŸä¸­ï¼ˆä¹Ÿå°±æ˜¯ç¬¬ä¸€è±¡é™æ­£è±¡é™ï¼‰</p>
<blockquote>
<p>bottom = top + height</p>
<p>right = left + width</p>
</blockquote>
<p>ç¤ºä¾‹è§£æï¼š</p>

















<table><thead><tr><th>è¿”å›å€¼</th><th>å«ä¹‰</th></tr></thead><tbody><tr><td><code>top: -20</code></td><td>å…ƒç´ é¡¶éƒ¨åœ¨å±å¹•ä¸Šè¾¹ç¼˜ <strong>ä¸Šæ–¹ 20px</strong>ï¼ˆä¸å¯è§éƒ¨åˆ†ï¼‰</td></tr><tr><td><code>bottom: -20</code></td><td>å…ƒç´ åº•éƒ¨åœ¨å±å¹•ä¸Šè¾¹ç¼˜ <strong>ä¸‹æ–¹ 20px</strong></td></tr></tbody></table>
<h2 data-id="heading-2">thresholdsï¼ˆé˜ˆå€¼ï¼‰æ˜¯ä»€ä¹ˆï¼Ÿ</h2>
<p>è®¾ç½®è§‚å¯Ÿè§¦å‘è§„åˆ™ï¼š</p>
<pre><code class="hljs language-scss" lang="scss">new <span class="hljs-built_in">IntersectionObserver</span>(callback, {
  thresholds: [<span class="hljs-number">0</span>, <span class="hljs-number">0.5</span>, <span class="hljs-number">1</span>]
})
</code></pre>





















<table><thead><tr><th>threshold</th><th>æ„å‘³</th></tr></thead><tbody><tr><td><code>0</code></td><td><strong>åˆšç›¸äº¤/ç¦»å¼€</strong> è§¦å‘</td></tr><tr><td><code>0.5</code></td><td><strong>è‡³å°‘ä¸€åŠ</strong>åœ¨å‚ç…§åŒºåŸŸæ‰è§¦å‘</td></tr><tr><td><code>1</code></td><td><strong>å®Œå…¨è¿›å…¥</strong>å‚ç…§åŒºåŸŸæ‰è§¦å‘</td></tr></tbody></table>
<p>thresholds è¶Šé«˜ï¼Œéœ€è¦æ›´â€œæ·±å…¥â€è¿›å…¥å‚ç…§åŒºåŸŸæ‰ç®—è§¦å‘ã€‚</p>
<p>ä¹Ÿå¯ä»¥æ ¹æ®å¾®ä¿¡å°ç¨‹åºæ–‡æ¡£ <a href="https://link.juejin.cn?target=https%3A%2F%2Fdevelopers.weixin.qq.com%2Fminiprogram%2Fdev%2Fapi%2Fwxml%2Fwx.createIntersectionObserver.html" target="_blank" title="https://developers.weixin.qq.com/miniprogram/dev/api/wxml/wx.createIntersectionObserver.html" ref="nofollow noopener noreferrer">developers.weixin.qq.com/miniprogramâ€¦</a> ä¸‹è½½demoè‡ªå·±ä¿®æ”¹å‚æ•°æ‰“å°resï¼Œå°±å¯ä»¥æ›´ç”ŸåŠ¨çš„ä½“ä¼šã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[æ±‚æ±‚ä½ ï¼Œåˆ«åœ¨ Swift åç¨‹å¼€å¤´å†™ guard let self = self äº†ï¼]]></title>    <link>https://juejin.cn/post/7581099904325337114</link>    <guid>https://juejin.cn/post/7581099904325337114</guid>    <pubDate>2025-12-08T09:07:45.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581099904325337114" data-draft-id="7581406561684340782" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="æ±‚æ±‚ä½ ï¼Œåˆ«åœ¨ Swift åç¨‹å¼€å¤´å†™ guard let self = self äº†ï¼"/> <meta itemprop="keywords" content="å‰ç«¯"/> <meta itemprop="datePublished" content="2025-12-08T09:07:45.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="StarkCoder"/> <meta itemprop="url" content="https://juejin.cn/user/207173399875662"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            æ±‚æ±‚ä½ ï¼Œåˆ«åœ¨ Swift åç¨‹å¼€å¤´å†™ guard let self = self äº†ï¼
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/207173399875662/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    StarkCoder
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-08T09:07:45.000Z" title="Mon Dec 08 2025 09:07:45 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»3åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>åˆ«è®© <code>guard let self = self</code> é”æ­»ä½ çš„æ§åˆ¶å™¨ï¼šSwift åç¨‹å†…å­˜â€œç»‘æ¶â€å¤§æ­ç§˜ ğŸš€</p>
<h3 data-id="heading-0">01. ä¸€ä¸ªâ€œçµå¼‚â€çš„ <code>deinit</code></h3>
<p>ä½ æ˜¯å¦é‡åˆ°è¿‡è¿™ç§åœºæ™¯ï¼šåœ¨ ViewController é‡Œçš„ <code>Task</code> å¯åŠ¨äº†ä¸€ä¸ªé•¿è¾¾ 10 ç§’çš„å›¾ç‰‡ä¸Šä¼ ä»»åŠ¡ã€‚ç”¨æˆ·è§‰å¾—å¤ªæ…¢ï¼Œç‚¹å‡»â€œè¿”å›â€é€€å‡ºäº†é¡µé¢ã€‚æŒ‰ç…§ ARC çš„é€»è¾‘ï¼ŒVC åº”è¯¥ç«‹å³é”€æ¯ã€‚</p>
<p>ä½†æ§åˆ¶å°å´ä¸€ç‰‡å¯‚é™ã€‚ç›´åˆ° 10 ç§’åä¸Šä¼ å®Œæˆï¼Œé‚£ä¸ª <code>deinit</code> æ‰åƒâ€œè¯ˆå°¸â€ä¸€æ ·è¹¦å‡ºæ¥ã€‚</p>
<p><strong>çœŸç›¸æ˜¯ï¼šä½ çš„ ViewController è¢«â€œç»‘æ¶â€äº†ï¼Œè€Œç»‘åŒªæ­£æ˜¯ä½ äº²æ‰‹å†™çš„ <code>guard let self = self</code>ã€‚</strong></p>
<hr/>
<h3 data-id="heading-1">02. ç¡¬æ ¸æ‹†è§£ï¼šTask åˆ°åº•åœ¨å †é‡Œåšäº†ä»€ä¹ˆï¼Ÿ</h3>
<p>è¦ç†è§£è¿™ä¸ªç°è±¡ï¼Œæˆ‘ä»¬å¾—èŠèŠ Swift åç¨‹çš„åº•å±‚å­˜å‚¨æœºåˆ¶ï¼š<strong>å¼‚æ­¥å¸§ï¼ˆAsync Frameï¼‰</strong> ã€‚</p>
<h4 data-id="heading-2">ä¼ ç»Ÿçš„æ ˆï¼ˆStackï¼‰</h4>
<p>æ™®é€šå‡½æ•°æ‰§è¡Œæ—¶ï¼Œå˜é‡å­˜åœ¨<strong>æ ˆ</strong>ä¸Šã€‚å‡½æ•°è·‘å®Œï¼Œæ ˆå¸§å¼¹å‡ºï¼Œå˜é‡é”€æ¯ã€‚</p>
<h4 data-id="heading-3">åç¨‹çš„å †ï¼ˆHeapï¼‰</h4>
<p><code>Task</code> æ˜¯ä¸ºäº† <code>await</code> è®¾è®¡çš„ã€‚<code>await</code> çš„æœ¬è´¨æ˜¯ <strong>â€œæŒ‚èµ·ï¼ˆSuspensionï¼‰â€</strong> ã€‚</p>
<ul>
<li><strong>æŒ‚èµ·ç¬é—´</strong>ï¼šå½“ä»£ç è¿è¡Œåˆ° <code>await</code>ï¼Œå½“å‰çº¿ç¨‹ä¼šè¢«é‡Šæ”¾å»å¹²åˆ«çš„äº‹ã€‚ä¸ºäº†ä¿è¯ <code>await</code> å›æ¥åä»£ç èƒ½æ¥ç€è·‘ï¼ŒSwift å¿…é¡»æŠŠå½“å‰å‡½æ•°çš„æ‰€æœ‰çŠ¶æ€ï¼ˆåŒ…æ‹¬ä½ çš„å¼ºå¼•ç”¨ <code>self</code>ï¼‰<strong>ä»æ ˆä¸Šæ‹·è´åˆ°å †ï¼ˆHeapï¼‰ä¸Š</strong>ã€‚</li>
</ul>
<p><strong>ç»“è®ºï¼š</strong> åªè¦è¿™ä¸ª <code>Task</code> æ²¡è¿è¡Œåˆ°æœ€åé‚£ä¸ªå¤§æ‹¬å· <code>}</code>ï¼Œå †ä¸Šçš„ç©ºé—´å°±ä¸ä¼šé”€æ¯ã€‚ä½ æå‰ <code>guard</code> å‡ºæ¥çš„å¼ºå¼•ç”¨ <code>self</code> å°±åƒä¸€æŠŠé”ï¼ŒæŠŠ VC æ­»æ­»é”åœ¨å †é‡Œã€‚</p>
<hr/>
<h3 data-id="heading-4">03. åˆ«åšâ€œæš´åŠ›è§£åŒ…â€çš„æ¬è¿å·¥ ğŸ§±</h3>
<p>å¾ˆå¤šå¼€å‘è€…ä¹ æƒ¯åœ¨ <code>Task</code> å¼€å¤´å°±â€œæš´åŠ›è§£åŒ…â€ï¼š</p>
<p>Swift</p>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-comment">// âŒ é”™è¯¯ç¤ºèŒƒï¼šVC å°†è¢«é”æ­»ç›´åˆ°ä»»åŠ¡ç»“æŸ</span>
<span class="hljs-type">Task</span> { [<span class="hljs-keyword">weak</span> <span class="hljs-keyword">self</span>] <span class="hljs-keyword">in</span>
    <span class="hljs-keyword">guard</span> <span class="hljs-keyword">let</span> <span class="hljs-keyword">self</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">self</span> <span class="hljs-keyword">else</span> { <span class="hljs-keyword">return</span> } <span class="hljs-comment">// 1. è¿™é‡Œå¼ºè¡Œâ€œå¼±è½¬å¼ºâ€</span>
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"â³ ä¸Šä¼ ä¸­..."</span>)
    <span class="hljs-keyword">let</span> url <span class="hljs-operator">=</span> <span class="hljs-keyword">await</span> logic.uploadImage() <span class="hljs-comment">// 2. åç¨‹æŒ‚èµ·ï¼Œå¼ºå¼•ç”¨ self å­˜å…¥å †ä¸­</span>
    <span class="hljs-keyword">self</span>.show(url)
}
</code></pre>
<p>æ­¤æ—¶çš„å¼•ç”¨é“¾ï¼š</p>
<p>Task (å †å†…å­˜) â” å±€éƒ¨å˜é‡ self (å¼ºå¼•ç”¨) â” ViewController</p>
<p>å³ä¾¿ç”¨æˆ·å…³äº†é¡µé¢ï¼Œ<code>Task</code> ä¸ç»“æŸï¼Œ<code>VC</code> å°±é‡Šæ”¾ä¸äº†ã€‚è¿™å°±æ˜¯ <strong>â€œå†…å­˜å»¶è¿Ÿé‡Šæ”¾â€</strong> ã€‚</p>
<hr/>
<h3 data-id="heading-5">04. æ»¡åˆ†èŒƒæœ¬ï¼šåç½®è§£åŒ…æ³• ğŸ’¡</h3>
<p>æˆ‘ä»¬è¦åšçš„å…¶å®å¾ˆç®€å•ï¼š<strong>è®©ä»»åŠ¡å…ˆè·‘ï¼Œäººè‹¥è¿˜åœ¨ï¼Œå†å¹²æ´»ã€‚</strong></p>
<p>Swift</p>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-comment">// âœ… å·¥ä¸šçº§å®‰å…¨æ¨¡ç‰ˆ</span>
<span class="hljs-type">Task</span> { [<span class="hljs-keyword">weak</span> <span class="hljs-keyword">self</span>] <span class="hljs-keyword">in</span>
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"â³ ä»»åŠ¡å‘èµ·ï¼Œæ­¤æ—¶ VC è‡ªç”±äº†"</span>)
    
    <span class="hljs-comment">// å…³é”®ï¼šä¸æå‰ guardï¼Œç›´æ¥ await å‘èµ·å¼‚æ­¥</span>
    <span class="hljs-keyword">let</span> url <span class="hljs-operator">=</span> <span class="hljs-keyword">await</span> <span class="hljs-keyword">self</span><span class="hljs-operator">?</span>.logic.uploadImage() 
    
    <span class="hljs-comment">// ä»»åŠ¡å›æ¥äº†ï¼Œæ­¤æ—¶å†çœ‹â€œäººè¿˜åœ¨ä¸åœ¨â€</span>
    <span class="hljs-keyword">guard</span> <span class="hljs-keyword">let</span> <span class="hljs-keyword">self</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">self</span> <span class="hljs-keyword">else</span> { 
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"ğŸ›‘ é¡µé¢å·²å…³ï¼Œé€»è¾‘ä¼˜é›…é€€å‡º"</span>)
        <span class="hljs-keyword">return</span> 
    }
    
    <span class="hljs-keyword">self</span>.show(url) <span class="hljs-comment">// åªæœ‰åœ¨è¿™é‡Œï¼Œæ‰äº§ç”Ÿç¬æ—¶çš„å¼ºå¼•ç”¨</span>
}
</code></pre>
<ul>
<li><strong>æ”¶ç›Š</strong>ï¼šç”¨æˆ·å…³æ‰é¡µé¢ï¼ŒVC å¼•ç”¨è®¡æ•°æ¸…é›¶ï¼Œç«‹åˆ»æ‰§è¡Œ <code>deinit</code>ã€‚</li>
</ul>
<hr/>
<h3 data-id="heading-6">05. è¿›é˜¶å¤§å¸ˆï¼šä¸ä»…çœå†…å­˜ï¼Œè¿˜è¦çœæµé‡ ğŸ“¡</h3>
<p>æ—¢ç„¶è§‚ä¼—ç¦»åœºäº†ï¼Œæˆå°ç¡®å®ä¸è¯¥æ¼”äº†ã€‚å¯¹äºè€—æ—¶æé•¿çš„ä»»åŠ¡ï¼Œæˆ‘ä»¬åº”è¯¥åœ¨ <code>deinit</code> æ—¶ä¸»åŠ¨å–æ¶ˆã€‚</p>
<p>Swift</p>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-keyword">class</span> <span class="hljs-title class_">MasterVC</span>: <span class="hljs-title class_">UIViewController</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> loadTask: <span class="hljs-type">Task</span>&lt;<span class="hljs-type">Void</span>, <span class="hljs-type">Never</span>&gt;?

    <span class="hljs-keyword">func</span> <span class="hljs-title function_">start</span>() {
        loadTask<span class="hljs-operator">?</span>.cancel()
        loadTask <span class="hljs-operator">=</span> <span class="hljs-type">Task</span> { [<span class="hljs-keyword">weak</span> <span class="hljs-keyword">self</span>] <span class="hljs-keyword">in</span>
            <span class="hljs-keyword">let</span> res <span class="hljs-operator">=</span> <span class="hljs-keyword">await</span> logic.longTimeRequest()
            <span class="hljs-keyword">guard</span> <span class="hljs-keyword">let</span> <span class="hljs-keyword">self</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">self</span>, <span class="hljs-operator">!</span><span class="hljs-type">Task</span>.isCancelled <span class="hljs-keyword">else</span> { <span class="hljs-keyword">return</span> }
            <span class="hljs-keyword">self</span>.done(res)
        }
    }

    <span class="hljs-keyword">deinit</span> {
        loadTask<span class="hljs-operator">?</span>.cancel() <span class="hljs-comment">// é¡µé¢å…³ï¼Œç½‘ç»œåœï¼Œæµé‡çœ</span>
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"âœ… å®Œç¾é‡Šæ”¾ï¼"</span>)
    }
}
</code></pre>
<hr/>
<h3 data-id="heading-7">æ€»ç»“ï¼šæˆ‘çš„é¿å‘åº§å³é“­</h3>
<ol>
<li><strong>æŒ‚èµ·å‰ï¼ˆawaitï¼‰åˆ«è§£åŒ…</strong>ï¼šåˆ«åœ¨ç½‘ç»œå›æ¥å‰ï¼Œç”¨ <code>guard</code> æŠŠ VC é”æ­»ã€‚</li>
<li><strong>æŒ‚èµ·æ—¶ç”¨å¯é€‰é“¾</strong>ï¼š<code>self?.logic.request()</code> æ‰æ˜¯çœŸæ­£çš„å¼±å¼•ç”¨ã€‚</li>
<li><strong>å›æ¥åå†æ£€æŸ¥</strong>ï¼šä»»åŠ¡ç»“æŸæ—¶ï¼Œç¡®è®¤ VC è¿˜åœ¨ï¼Œå†åˆ·æ–° UIã€‚</li>
</ol>
<p><strong>è®°ä½ï¼šViewController æ˜¯â€œæ¶ˆè€—å“â€ï¼Œåˆ«è®©å®ƒæˆä¸ºä½ å†…å­˜é‡Œçš„â€œä¼ å®¶å®â€ã€‚</strong></p>
<hr/>
<p>å¸Œæœ›è¿™ç¯‡æ–‡ç« èƒ½å¸®ä½ ç†æ¸… Swift åç¨‹çš„å¼•ç”¨è°œå›¢ï¼å¦‚æœä½ ä¹Ÿæ›¾è¢« <code>deinit</code> å»¶è¿Ÿå›°æ‰°è¿‡ï¼Œæ¬¢è¿åœ¨è¯„è®ºåŒºåˆ†äº«ä½ çš„ç»å†ã€‚ğŸ‘‡</p>
<p><strong>ä¸‹ä¸€æ­¥å»ºè®®ï¼š</strong> ä½ å¯ä»¥å»æ£€æŸ¥ä¸€ä¸‹é¡¹ç›®ä¸­é‚£äº›å¤„ç†å¤§å›¾ä¸Šä¼ æˆ–å¤æ‚è®¡ç®—çš„ <code>Task</code>ï¼ŒæŠŠ <code>guard</code> åç§»ï¼Œä½ ä¼šå‘ç° App çš„å“åº”é€Ÿåº¦å’Œå†…å­˜è¡¨ç°ä¼šæœ‰è´¨çš„é£è·ƒã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[RAG (æ£€ç´¢å¢å¼ºç”Ÿæˆ) æ·±åº¦å®æˆ˜çŸ¥è¯†åº“]]></title>    <link>https://juejin.cn/post/7581099904325320730</link>    <guid>https://juejin.cn/post/7581099904325320730</guid>    <pubDate>2025-12-08T09:06:36.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581099904325320730" data-draft-id="7581292270960820234" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="RAG (æ£€ç´¢å¢å¼ºç”Ÿæˆ) æ·±åº¦å®æˆ˜çŸ¥è¯†åº“"/> <meta itemprop="keywords" content="AIGC"/> <meta itemprop="datePublished" content="2025-12-08T09:06:36.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="æ¸…æ°´å¯ºå°å’Œå°š"/> <meta itemprop="url" content="https://juejin.cn/user/2823201588787645"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            RAG (æ£€ç´¢å¢å¼ºç”Ÿæˆ) æ·±åº¦å®æˆ˜çŸ¥è¯†åº“
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2823201588787645/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    æ¸…æ°´å¯ºå°å’Œå°š
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-08T09:06:36.000Z" title="Mon Dec 08 2025 09:06:36 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»5åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p><strong>æ ¸å¿ƒå®šä¹‰</strong>ï¼šRAG (Retrieval-Augmented Generation) æ˜¯ä¸€ç§è®©å¤§æ¨¡å‹æ‹¥æœ‰â€œå¤–æŒ‚å¤§è„‘â€çš„æŠ€æœ¯æ¶æ„ã€‚</p>
<p><strong>å¿ƒæ™ºæ¨¡å‹</strong>ï¼š<strong>å¼€å·è€ƒè¯•</strong>ã€‚</p>
<ul>
<li><strong>ä¼ ç»Ÿ LLM</strong> = é—­å·è€ƒè¯•ï¼ˆé è®­ç»ƒæ—¶çš„å†…éšè®°å¿†ï¼ŒçŸ¥è¯†æ˜“è¿‡æœŸï¼Œæ˜“äº§ç”Ÿå¹»è§‰ï¼‰ã€‚</li>
<li><strong>RAG</strong> = å…ˆç¿»ä¹¦ï¼ˆæ£€ç´¢ï¼‰ï¼Œå†å›ç­”ï¼ˆç”Ÿæˆï¼‰ã€‚</li>
</ul>
</blockquote>
<hr/>
<h2 data-id="heading-0">ä¸€ã€ æ ¸å¿ƒæ¶æ„å…¨æ™¯ (The Architecture)</h2>
<p>RAG ç³»ç»Ÿç”±ä¸¤æ¡æ ¸å¿ƒæ•°æ®æµç»„æˆï¼š</p>
<p><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>R</mi><mi>A</mi><mi>G</mi><mo>=</mo><mtext>ç¦»çº¿æ•°æ®é“¾è·¯Â (ç´¢å¼•)</mtext><mo>+</mo><mtext>åœ¨çº¿æœåŠ¡é“¾è·¯Â (æ£€ç´¢ä¸ç”Ÿæˆ)</mtext></mrow><annotation encoding="application/x-tex">RAG = \text{ç¦»çº¿æ•°æ®é“¾è·¯ (ç´¢å¼•)} + \text{åœ¨çº¿æœåŠ¡é“¾è·¯ (æ£€ç´¢ä¸ç”Ÿæˆ)}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"/><span class="mord mathnormal" style="margin-right:0.00773em;">R</span><span class="mord mathnormal">A</span><span class="mord mathnormal">G</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord text"><span class="mord cjk_fallback">ç¦»çº¿æ•°æ®é“¾è·¯</span><span class="mord">Â (</span><span class="mord cjk_fallback">ç´¢å¼•</span><span class="mord">)</span></span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord text"><span class="mord cjk_fallback">åœ¨çº¿æœåŠ¡é“¾è·¯</span><span class="mord">Â (</span><span class="mord cjk_fallback">æ£€ç´¢ä¸ç”Ÿæˆ</span><span class="mord">)</span></span></span></span></span></span></p>
<h3 data-id="heading-1">1. ç¦»çº¿é“¾è·¯ (Offline Pipeline)</h3>
<p><strong>ç›®æ ‡</strong>ï¼šå°†éç»“æ„åŒ–æ–‡æ¡£ï¼ˆPDFï¼‰è½¬åŒ–ä¸ºé«˜è´¨é‡çš„ã€æœºå™¨å¯è¯»çš„å‘é‡ç´¢å¼•ã€‚</p>
<ul>
<li><strong>åŠ¨ä½œ</strong>ï¼šæå– (Extract) <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>â†’</mo></mrow><annotation encoding="application/x-tex">\rightarrow</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.3669em;"/><span class="mrel">â†’</span></span></span></span></span> æ¸…æ´— (Clean) <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>â†’</mo></mrow><annotation encoding="application/x-tex">\rightarrow</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.3669em;"/><span class="mrel">â†’</span></span></span></span></span> åˆ‡åˆ† (Chunk) <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>â†’</mo></mrow><annotation encoding="application/x-tex">\rightarrow</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.3669em;"/><span class="mrel">â†’</span></span></span></span></span> å‘é‡åŒ– (Embed) <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>â†’</mo></mrow><annotation encoding="application/x-tex">\rightarrow</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.3669em;"/><span class="mrel">â†’</span></span></span></span></span> å­˜å‚¨ (Store)ã€‚</li>
</ul>
<h3 data-id="heading-2">2. åœ¨çº¿é“¾è·¯ (Online Pipeline)</h3>
<p><strong>ç›®æ ‡</strong>ï¼šç†è§£ç”¨æˆ·é—®é¢˜ï¼Œç²¾å‡†å¬å›çŸ¥è¯†ï¼Œç”Ÿæˆå¯é ç­”æ¡ˆã€‚</p>
<ul>
<li><strong>åŠ¨ä½œ</strong>ï¼šQuery ç†è§£ <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>â†’</mo></mrow><annotation encoding="application/x-tex">\rightarrow</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.3669em;"/><span class="mrel">â†’</span></span></span></span></span> è·¯ç”±/æ£€ç´¢ (Retrieve) <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>â†’</mo></mrow><annotation encoding="application/x-tex">\rightarrow</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.3669em;"/><span class="mrel">â†’</span></span></span></span></span> é‡æ’åº (Rerank) <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>â†’</mo></mrow><annotation encoding="application/x-tex">\rightarrow</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.3669em;"/><span class="mrel">â†’</span></span></span></span></span> ç”Ÿæˆ (Generate)ã€‚</li>
</ul>
<hr/>
<h2 data-id="heading-3">äºŒã€ å…³é”®æ¦‚å¿µè¾¨æ (Key Concepts)</h2>


















































<table><thead><tr><th align="left">æ¦‚å¿µ</th><th align="left">åˆ«å/è§£é‡Š</th><th align="left">ä½œç”¨ä¸æ¯”å–»</th></tr></thead><tbody><tr><td align="left"><strong>Embedding</strong></td><td align="left">å‘é‡åŒ–</td><td align="left">æŠŠæ–‡å­—å˜æˆæ•°å­—æ•°ç»„ï¼ˆåæ ‡ï¼‰ï¼Œæ˜¯è®¡ç®—æœºç†è§£è¯­ä¹‰çš„åŸºç¡€ã€‚</td></tr><tr><td align="left"><strong>Dense Vector</strong></td><td align="left">ç¨ å¯†å‘é‡</td><td align="left"><strong>æ‡‚è¯­ä¹‰</strong>ã€‚é€‚åˆæ¨¡ç³Šæœç´¢ï¼ˆå¦‚â€œå¦‚ä½•è®©è½¦åœä¸‹â€åŒ¹é…â€œæ‘©æ“¦åŠ›â€ï¼‰ã€‚</td></tr><tr><td align="left"><strong>Sparse Vector</strong></td><td align="left">ç¨€ç–å‘é‡/å…³é”®è¯</td><td align="left"><strong>æ‡‚ç¬¦å·</strong>ã€‚é€‚åˆç²¾ç¡®åŒ¹é…ï¼ˆå¦‚ "<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>F</mi><mo>=</mo><mi>m</mi><mi>a</mi></mrow><annotation encoding="application/x-tex">F=ma</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"/><span class="mord mathnormal" style="margin-right:0.13889em;">F</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.4306em;"/><span class="mord mathnormal">ma</span></span></span></span></span>", "ç‰›é¡¿"ï¼‰ã€‚</td></tr><tr><td align="left"><strong>Bi-Encoder</strong></td><td align="left">åŒå¡”æ¨¡å‹ (å¦‚ bge-m3)</td><td align="left"><strong>æµ·é€‰</strong>ã€‚çœ‹å›¾ä¸çœ‹äººï¼Œé€Ÿåº¦å¿«ï¼Œç”¨äºåˆæ¬¡æ£€ç´¢ (Retrieval)ã€‚</td></tr><tr><td align="left"><strong>Cross-Encoder</strong></td><td align="left">äº¤å‰æ¨¡å‹ (å¦‚ bge-reranker)</td><td align="left"><strong>ç²¾é€‰</strong>ã€‚é¢å¯¹é¢é¢è¯•ï¼Œç²¾åº¦æé«˜ä½†æ…¢ï¼Œç”¨äºé‡æ’åº (Rerank)ã€‚</td></tr><tr><td align="left"><strong>LlamaIndex</strong></td><td align="left">æ¡†æ¶ (Framework)</td><td align="left"><strong>åŒ…å·¥å¤´/éª¨æ¶</strong>ã€‚è´Ÿè´£æµç¨‹è°ƒåº¦ï¼Œä¸ç”Ÿäº§å‘é‡ã€‚</td></tr><tr><td align="left"><strong>Chunking</strong></td><td align="left">åˆ‡ç‰‡</td><td align="left"><strong>åˆ‡ä¹¦</strong>ã€‚æŠŠé•¿æ–‡ç« åˆ‡æˆå°å—ï¼Œä¾¿äºæ£€ç´¢ã€‚</td></tr><tr><td align="left"><strong>Small-to-Big</strong></td><td align="left">çˆ¶å­ç´¢å¼•</td><td align="left"><strong>ç´¢å¼•å°å—ï¼Œè¿”å›å¤§å—</strong>ã€‚æ—¢èƒ½ç²¾å‡†å®šä½ï¼Œåˆèƒ½æä¾›å®Œæ•´ä¸Šä¸‹æ–‡ã€‚</td></tr></tbody></table>
<hr/>
<h2 data-id="heading-4">ä¸‰ã€ è¯¦ç»†æµç¨‹ä¸æŠ€æœ¯é€‰å‹ (Step-by-Step)</h2>
<h3 data-id="heading-5">é˜¶æ®µ 1ï¼šç¦»çº¿æ•°æ®å‡†å¤‡ (Data Preparation)</h3>
<p>é’ˆå¯¹ <strong>PDF ç‰©ç†æ•™æ</strong> çš„ç‰¹åŒ–æ–¹æ¡ˆï¼š</p>
<h4 data-id="heading-6">1. æ•°æ®æå– (Extraction)</h4>
<ul>
<li><strong>æŒ‘æˆ˜</strong>ï¼šPDF ä¹±ç ã€å…¬å¼ä¸¢å¤±ã€å›¾ç‰‡ä¸¢å¤±ã€‚</li>
<li><strong>æŠ€æœ¯æ ˆ</strong>ï¼š<strong>Magic-PDF (MinerU)</strong> (é¦–é€‰) æˆ– PyMuPDFã€‚</li>
<li><strong>æ ¸å¿ƒåŠ¨ä½œ</strong>ï¼š
<ul>
<li><strong>å…¬å¼è¿˜åŸ</strong>ï¼šå¿…é¡»å°†æ•°å­¦å…¬å¼è¯†åˆ«ä¸º LaTeX æ ¼å¼ (<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>E</mi><mo>=</mo><mi>m</mi><msup><mi>c</mi><mn>2</mn></msup></mrow><annotation encoding="application/x-tex">E=mc^2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"/><span class="mord mathnormal" style="margin-right:0.05764em;">E</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.8141em;"/><span class="mord mathnormal">m</span><span class="mord"><span class="mord mathnormal">c</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span></span></span>)ã€‚</li>
<li><strong>å»å™ª</strong>ï¼šå‰”é™¤é¡µçœ‰ã€é¡µè„šã€é¡µç ï¼ˆé¿å…æ£€ç´¢åˆ°â€œç¬¬12é¡µâ€è¿™ç§æ— æ•ˆä¿¡æ¯ï¼‰ã€‚</li>
<li><strong>ç‰ˆé¢åˆ†æ</strong>ï¼šåŒºåˆ†æ­£æ–‡ã€ä¾§è¾¹æ ã€è¡¨æ ¼ã€‚</li>
</ul>
</li>
</ul>
<h4 data-id="heading-7">2. å¤šæ¨¡æ€å¢å¼º (Enhancement)</h4>
<ul>
<li><strong>æŒ‘æˆ˜</strong>ï¼šç‰©ç†æ•™æåŒ…å«å¤§é‡å—åŠ›åˆ†æå›¾ã€ç”µè·¯å›¾ã€‚</li>
<li><strong>ç­–ç•¥</strong>ï¼š
<ul>
<li><strong>åˆ†ç±»</strong>ï¼šåŒºåˆ†â€œæ ¸å¿ƒå›¾è¡¨â€ï¼ˆType Aï¼Œéœ€è¯¦è¿°ï¼‰å’Œâ€œè£…é¥°é…å›¾â€ï¼ˆType Bï¼Œç•¥è¿‡ï¼‰ã€‚</li>
<li><strong>VLM æè¿°</strong>ï¼šä½¿ç”¨ <strong>Qwen-VL</strong> æˆ– <strong>GPT-4o</strong> ç”Ÿæˆè¯¦ç»† Captionã€‚
<ul>
<li><em>Prompt</em>: "è¯¦ç»†æè¿°ç”µè·¯è¿æ¥æ–¹å¼ã€å—åŠ›æ–¹å‘..."</li>
</ul>
</li>
<li><strong>é”šç‚¹ç»‘å®š</strong>ï¼šå°†å›¾ç‰‡ Caption + AI æè¿° + åŸæ–‡æ®µè½å¼ºç»‘å®šä¸ºä¸€ä¸ª Chunkã€‚</li>
</ul>
</li>
</ul>
<h4 data-id="heading-8">3. åˆ‡åˆ†ç­–ç•¥ (Chunking)</h4>
<ul>
<li><strong>ç­–ç•¥</strong>ï¼š<strong>Structure-Aware (ç»“æ„åŒ–åˆ‡åˆ†)</strong>ã€‚ä¼˜å…ˆæŒ‰ Markdown æ ‡é¢˜åˆ‡åˆ†ã€‚</li>
<li><strong>Small-to-Big (çˆ¶å­ç´¢å¼•)</strong>ï¼š
<ul>
<li><em>Child Chunk (200å­—)</em>ï¼šç”¨äºè®¡ç®—å‘é‡ï¼Œè¯­ä¹‰èšç„¦ï¼Œæ£€ç´¢æ›´å‡†ã€‚</li>
<li><em>Parent Chunk (1000å­—)</em>ï¼šåŒ…å«å®Œæ•´çš„æ¨å¯¼ä¸Šä¸‹æ–‡ï¼Œé€ç»™ LLM é˜…è¯»ã€‚</li>
</ul>
</li>
</ul>
<h4 data-id="heading-9">4. å‘é‡åŒ–ä¸ç´¢å¼• (Indexing)</h4>
<ul>
<li><strong>æŠ€æœ¯æ ˆ</strong>ï¼š<strong>BAAI/bge-m3</strong>ã€‚</li>
<li><strong>ä¼˜åŒ–æŠ€å·§</strong>ï¼š
<ul>
<li><strong>æ··åˆè¡¨å¾</strong>ï¼šåŒæ—¶å­˜å‚¨ Dense + Sparse å‘é‡ï¼ˆç‰©ç†ç¬¦å·æå…¶é‡è¦ï¼‰ã€‚</li>
<li><strong>å…¬å¼è‡ªç„¶è¯­è¨€åŒ–</strong>ï¼šå°† LaTeX ç¿»è¯‘ä¸ºä¸­æ–‡æ‹¼æ¥åˆ°æ–‡æœ¬åï¼ˆå¦‚ <code>$v=at$</code> -&gt; "é€Ÿåº¦æ—¶é—´å…¬å¼"ï¼‰ã€‚</li>
<li><strong>å‡è®¾æ€§é—®é¢˜ (Reverse HyDE)</strong>ï¼šé¢„ç”Ÿæˆâ€œè¿™ä¸ªç‰‡æ®µèƒ½å›ç­”ä»€ä¹ˆé—®é¢˜â€å¹¶å­˜å…¥ç´¢å¼•ã€‚</li>
</ul>
</li>
</ul>
<hr/>
<h3 data-id="heading-10">é˜¶æ®µ 2ï¼šåœ¨çº¿æ£€ç´¢ä¸ç”Ÿæˆ (Online Serving)</h3>
<h4 data-id="heading-11">1. Query ç†è§£ (Query Understanding)</h4>
<ul>
<li><strong>ç›®æ ‡</strong>ï¼šè®©ç³»ç»Ÿå¬æ‡‚â€œäººè¯â€ã€‚</li>
<li><strong>æŠ€æœ¯æ‰‹æ®µ</strong>ï¼š
<ul>
<li><strong>Step-back Prompting (ç‰©ç†å¿…æ€æŠ€)</strong>ï¼šå…ˆé—®å®è§‚åŸç†ï¼ˆâ€œç‰›é¡¿å®šå¾‹æ˜¯ä»€ä¹ˆâ€ï¼‰ï¼Œå†é—®å…·ä½“é¢˜ç›®ã€‚</li>
<li><strong>Query Rewrite</strong>ï¼šå°†å£è¯­â€œæ»‘å—é‚£ä¸ªé¢˜â€æ”¹å†™ä¸ºâ€œæ–œé¢æ»‘å—å—åŠ›åˆ†æâ€ã€‚</li>
<li><strong>HyDE</strong>ï¼šé’ˆå¯¹æ¦‚å¿µæ€§é—®é¢˜ï¼Œå…ˆç”Ÿæˆâ€œå¹»è§‰ç­”æ¡ˆâ€å»æ£€ç´¢ã€‚</li>
</ul>
</li>
</ul>
<h4 data-id="heading-12">2. æ··åˆæ£€ç´¢ (Hybrid Retrieval)</h4>
<ul>
<li><strong>åŠ¨ä½œ</strong>ï¼š<code>Vector DB.search()</code></li>
<li><strong>ç­–ç•¥</strong>ï¼š
<ul>
<li><strong>è¯­ä¹‰ (Dense)</strong>ï¼šæ‰¾åŸç†ã€‚</li>
<li><strong>å…³é”®è¯ (Sparse)</strong>ï¼šæ‰¾å…¬å¼ç¬¦å·ã€ä¸“æœ‰åè¯ã€‚</li>
<li><strong>å…ƒæ•°æ®è¿‡æ»¤</strong>ï¼š<code>filter="grade=='å¿…ä¿®ä¸€'"</code>ã€‚</li>
</ul>
</li>
<li><strong>æ³¨æ„</strong>ï¼šè¿™ä¸€æ­¥åªåšæ•°å­¦è®¡ç®—ï¼Œ<strong>ä¸è°ƒç”¨</strong> GPT-4ã€‚</li>
</ul>
<h4 data-id="heading-13">3. é‡æ’åº (Reranking) â€”â€” <strong>å…³é”®æåˆ†ç‚¹</strong></h4>
<ul>
<li><strong>æŠ€æœ¯æ ˆ</strong>ï¼š<strong>BAAI/bge-reranker-v2-m3</strong>ã€‚</li>
<li><strong>åŠ¨ä½œ</strong>ï¼š
<ol>
<li>æ£€ç´¢å¬å› Top 50ã€‚</li>
<li>Reranker æ¨¡å‹é€ä¸€ç²¾è¯»æ‰“åˆ†ã€‚</li>
<li>å‰”é™¤é€»è¾‘ä¸é€šçš„å¹²æ‰°é¡¹ï¼ˆå¦‚ä»…ä»…åŒ…å«å…³é”®è¯ä½†å†…å®¹æ— å…³çš„ä¹ é¢˜èƒŒæ™¯ï¼‰ï¼Œé€‰å‡º Top 5ã€‚</li>
</ol>
</li>
</ul>
<h4 data-id="heading-14">4. ç”Ÿæˆ (Generation)</h4>
<ul>
<li><strong>æŠ€æœ¯æ ˆ</strong>ï¼š<strong>GPT-4o</strong> / <strong>DeepSeek</strong>ã€‚</li>
<li><strong>Prompt ä¼˜åŒ–</strong>ï¼š
<ul>
<li><strong>CoT (æ€ç»´é“¾)</strong>ï¼šå¼ºåˆ¶è¦æ±‚â€œå…ˆåˆ—å…¬å¼ -&gt; å†ä»£å…¥æ•°æ® -&gt; æœ€åè®¡ç®—â€ã€‚</li>
<li><strong>Lost in the Middle</strong>ï¼šæ ¸å¿ƒå…¬å¼ç‰‡æ®µæ”¾ Prompt å¼€å¤´æˆ–ç»“å°¾ã€‚</li>
<li><strong>å¼•ç”¨æ ‡æ³¨</strong>ï¼šè¦æ±‚è¾“å‡º <code>(æ¥æºï¼šå¿…ä¿®ä¸€ P32)</code>ã€‚</li>
</ul>
</li>
</ul>
<hr/>
<h2 data-id="heading-15">å››ã€ ç‰©ç†æ•™æ RAG å®æˆ˜ CheckList</h2>
<p>åœ¨åŠ¨æ‰‹å†™ä»£ç å‰ï¼Œè¯·æ£€æŸ¥ä»¥ä¸‹è¦ç‚¹ï¼š</p>
<ul class="contains-task-list">
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> <strong>PDF è§£æå™¨é€‰å¯¹äº†å—ï¼Ÿ</strong> (èƒ½å¦è¯†åˆ« LaTeX å…¬å¼ï¼Ÿ)</li>
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> <strong>Chunking æ˜¯å¦æ–­ç« å–ä¹‰ï¼Ÿ</strong> (è¡¨æ ¼å’Œè§£é‡Šåˆ†å¼€äº†å—ï¼Ÿå»ºè®®ç”¨ Small-to-Big)</li>
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> <strong>æœ‰æ²¡æœ‰åšæ··åˆæ£€ç´¢ï¼Ÿ</strong> (æœ <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>F</mi><mo>=</mo><mi>m</mi><mi>a</mi></mrow><annotation encoding="application/x-tex">F=ma</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"/><span class="mord mathnormal" style="margin-right:0.13889em;">F</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.4306em;"/><span class="mord mathnormal">ma</span></span></span></span></span> èƒ½æœåˆ°å—ï¼Ÿéœ€è¦ Sparse å‘é‡)</li>
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> <strong>æœ‰æ²¡æœ‰åŠ  Rerankï¼Ÿ</strong> (è¿™æ˜¯ä» 60 åˆ†åˆ° 90 åˆ†çš„å…³é”®æ­¥éª¤)</li>
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> <strong>åœ¨çº¿é“¾è·¯æ˜¯å¦ç†è§£äº† Queryï¼Ÿ</strong> (ç”¨æˆ·é—®å¾—æ¨¡ç³Šæ—¶æ˜¯å¦æœ‰æ”¹å†™æœºåˆ¶ï¼Ÿ)</li>
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> <strong>å‘é‡åº“æ˜¯å¦å­˜äº†å…ƒæ•°æ®ï¼Ÿ</strong> (ç« èŠ‚ã€å¹´çº§ã€å›¾ç‰‡ç±»å‹)</li>
</ul>
<hr/>
<h2 data-id="heading-16">äº”ã€ æ¨èæŠ€æœ¯æ ˆæ¸…å• (Tech Stack)</h2>








































<table><thead><tr><th align="left">æ¨¡å—</th><th align="left">æ¨èå·¥å…·</th><th align="left">ä½œç”¨ä¸ç†ç”±</th></tr></thead><tbody><tr><td align="left"><strong>Orchestration</strong></td><td align="left"><strong>LlamaIndex</strong></td><td align="left">ä¸“ä¸º RAG è®¾è®¡ï¼Œæ¥å£ä¸°å¯Œ (NodeParser, Retriever)ã€‚</td></tr><tr><td align="left"><strong>ETL / PDF</strong></td><td align="left"><strong>Magic-PDF (MinerU)</strong></td><td align="left">ä¸­æ–‡ã€å…¬å¼æ”¯æŒæœ€å¥½çš„å¼€æºå·¥å…·ã€‚</td></tr><tr><td align="left"><strong>Embedding</strong></td><td align="left"><strong>BAAI/bge-m3</strong></td><td align="left">æ”¯æŒé•¿æ–‡æœ¬ã€å¤šè¯­è¨€ã€æ··åˆæ£€ç´¢ (Dense+Sparse)ã€‚</td></tr><tr><td align="left"><strong>Rerank</strong></td><td align="left"><strong>BAAI/bge-reranker</strong></td><td align="left">ä¸­æ–‡è¯­ä¹‰ç†è§£å¼ºï¼Œè¿‡æ»¤å™ªå£°èƒ½åŠ›å¼ºã€‚</td></tr><tr><td align="left"><strong>Vector DB</strong></td><td align="left"><strong>Milvus</strong> / <strong>Elasticsearch</strong></td><td align="left">ç”Ÿäº§çº§æ ‡å‡†ï¼Œæ”¯æŒæ··åˆæ£€ç´¢ã€‚</td></tr><tr><td align="left"><strong>LLM</strong></td><td align="left"><strong>OpenAI (GPT-4o)</strong></td><td align="left">é€»è¾‘æ¨ç†å¼ºï¼Œç‰©ç†é¢˜è§£é¢˜èƒ½åŠ›æœ€ä½³ã€‚</td></tr></tbody></table>
<hr/>
<h2 data-id="heading-17">å…­ã€ æ€»ç»“è¯­</h2>
<p>åš RAG å°±åƒåšèœï¼Œæ•°æ®è´¨é‡æ˜¯æ ¸å¿ƒï¼š</p>
<ul>
<li><strong>Magic-PDF</strong> æ˜¯<strong>å‡€æ°´å™¨</strong>ï¼Œç¡®ä¿æ°´æºå¹²å‡€ã€‚</li>
<li><strong>BGE-M3</strong> æ˜¯<strong>é‡‡è´­å‘˜</strong>ï¼Œä¹°åˆ°å¯¹çš„é£Ÿæã€‚</li>
<li><strong>Rerank</strong> æ˜¯<strong>è´¨æ£€å‘˜</strong>ï¼ŒæŠŠçƒ‚å¶å­æŒ‘å‡ºå»ã€‚</li>
<li><strong>LLM</strong> æ˜¯<strong>å¤§å¨</strong>ï¼Œæœ€åæ ¹æ®é£Ÿæç‚’å‡ºä¸€ç›˜å¥½èœã€‚</li>
</ul>
<p><strong>åˆ‡è®°ï¼šGarbage In, Garbage Out (åƒåœ¾è¿›ï¼Œåƒåœ¾å‡º)ã€‚ç¦»çº¿æ•°æ®å¤„ç†çš„è´¨é‡å†³å®šäº†ä½ ç³»ç»Ÿçš„ä¸Šé™ã€‚</strong></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[é…ç½® NeoVim çš„ä»£ç æŠ˜å ]]></title>    <link>https://juejin.cn/post/7581297888807829554</link>    <guid>https://juejin.cn/post/7581297888807829554</guid>    <pubDate>2025-12-08T09:04:49.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581297888807829554" data-draft-id="7581306080434061363" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="é…ç½® NeoVim çš„ä»£ç æŠ˜å "/> <meta itemprop="keywords" content="åç«¯"/> <meta itemprop="datePublished" content="2025-12-08T09:04:49.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="acethanlic"/> <meta itemprop="url" content="https://juejin.cn/user/3940246036953176"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            é…ç½® NeoVim çš„ä»£ç æŠ˜å 
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3940246036953176/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    acethanlic
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-08T09:04:49.000Z" title="Mon Dec 08 2025 09:04:49 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    5
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»2åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>é…ç½® NeoVim çš„ä»£ç æŠ˜å ï¼Œæœ€ç°ä»£åŒ–ä¸”æ¨èçš„æ–¹å¼æ˜¯ä½¿ç”¨ <strong>Tree-sitter</strong> é©±åŠ¨çš„ <strong>è¡¨è¾¾å¼æŠ˜å </strong> (<code>foldmethod='expr'</code>)ã€‚è¿™èƒ½æä¾›æœ€å‡†ç¡®çš„è¯­è¨€æ„ŸçŸ¥å‹æŠ˜å ï¼ˆä¾‹å¦‚ï¼Œæ ¹æ®å‡½æ•°ä½“ã€ç±»æˆ–ä»£ç å—è‡ªåŠ¨æŠ˜å ï¼‰ã€‚</p>
<p>ä¸¤æ­¥é…ç½®ï¼š</p>
<ol>
<li><strong>æ·»åŠ  <code>nvim-treesitter</code> æ’ä»¶</strong>ï¼šå®ƒæ˜¯å®ç°å‡†ç¡®æŠ˜å çš„åŸºç¡€ã€‚</li>
<li><strong>è®¾ç½®æŠ˜å é€‰é¡¹</strong>ï¼šåœ¨ <code>options.lua</code> ä¸­å¼€å¯å¹¶æŒ‡å®šæŠ˜å æ–¹æ³•ã€‚</li>
</ol>
<hr/>
<h2 data-id="heading-0">æ­¥éª¤ä¸€ï¼šåœ¨ <code>lua/plugins/init.lua</code> ä¸­æ·»åŠ  Tree-sitter</h2>
<p>è¦å°† <code>nvim-treesitter</code> æ’ä»¶æ·»åŠ åˆ°ä½ çš„ <code>lazy.nvim</code> åˆ—è¡¨ä¸­ï¼Œå¹¶é…ç½®å®ƒå¯ç”¨æŠ˜å åŠŸèƒ½ã€‚</p>
<p>è¯·åœ¨ <code>lua/plugins/init.lua</code> æ–‡ä»¶çš„æ’ä»¶åˆ—è¡¨ï¼ˆ<code>require("lazy").setup({ ... })</code> å†…éƒ¨ï¼‰ä¸­ï¼Œæ·»åŠ ä»¥ä¸‹ä»£ç å—ï¼š</p>
<pre><code class="hljs language-lua" lang="lua"><span class="hljs-comment">-- ... (å…¶ä»–æ’ä»¶ï¼Œä¾‹å¦‚ plenary.nvim å’Œ catppuccin æ’ä»¶ä¹‹é—´)</span>

<span class="hljs-comment">-- Tree-sitterï¼šæä¾›å…ˆè¿›çš„è¯­æ³•è§£æï¼Œæ˜¯å®ç°ç²¾ç¡®æŠ˜å çš„åŸºç¡€</span>
{
    <span class="hljs-string">"git@github.com:nvim-treesitter/nvim-treesitter.git"</span>,
    build = <span class="hljs-string">":TSUpdate"</span>, <span class="hljs-comment">-- é¦–æ¬¡å®‰è£…åè¿è¡Œæ­¤å‘½ä»¤æ¥ä¸‹è½½è§£æå™¨</span>
    name = <span class="hljs-string">"treesitter"</span>,
    event = <span class="hljs-string">"BufReadPost"</span>,
    <span class="hljs-built_in">config</span> = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>
        <span class="hljs-built_in">require</span>(<span class="hljs-string">"nvim-treesitter.configs"</span>).setup({
            <span class="hljs-comment">-- ç¡®ä¿å®‰è£…å¸¸ç”¨è¯­è¨€çš„è§£æå™¨</span>
            ensure_installed = { 
                <span class="hljs-string">"c"</span>, <span class="hljs-string">"lua"</span>, <span class="hljs-string">"vim"</span>, <span class="hljs-string">"vimdoc"</span>, <span class="hljs-string">"javascript"</span>, <span class="hljs-string">"typescript"</span>, 
                <span class="hljs-string">"html"</span>, <span class="hljs-string">"css"</span>, <span class="hljs-string">"json"</span>, <span class="hljs-string">"bash"</span>, <span class="hljs-string">"python"</span> 
            }, 
            
            highlight = { enable = <span class="hljs-literal">true</span> }, <span class="hljs-comment">-- å¯ç”¨é«˜äº®ï¼ˆæ¨èï¼‰</span>
            indent = { enable = <span class="hljs-literal">true</span> },    <span class="hljs-comment">-- å¯ç”¨æ™ºèƒ½ç¼©è¿›ï¼ˆæ¨èï¼‰</span>
            folding = { enable = <span class="hljs-literal">true</span> },   <span class="hljs-comment">-- **å¯ç”¨æŠ˜å **</span>
        })
    <span class="hljs-keyword">end</span>,
},

<span class="hljs-comment">-- ...</span>
</code></pre>
<h2 data-id="heading-1">æ­¥éª¤äºŒï¼šåœ¨ <code>lua/core/options.lua</code> ä¸­é…ç½®æŠ˜å é€‰é¡¹</h2>
<p>åœ¨ä½ çš„ <code>lua/core/options.lua</code> æ–‡ä»¶ä¸­ï¼Œæ·»åŠ ä»¥ä¸‹é…ç½®æ¥å¯ç”¨å¹¶æŒ‡å®šä½¿ç”¨ Tree-sitter æä¾›çš„æŠ˜å è¡¨è¾¾å¼ã€‚</p>
<p>åœ¨æ–‡ä»¶æœ«å°¾æˆ–ä¸“é—¨çš„é…ç½®åŒºåŸŸæ·»åŠ ä»¥ä¸‹å‡ è¡Œï¼š</p>
<pre><code class="hljs language-lua" lang="lua"><span class="hljs-comment">-- lua/core/options.lua</span>

<span class="hljs-comment">-- ... (å…¶ä»–é…ç½®ï¼Œå¦‚ opt.timeoutlen = 300)</span>

<span class="hljs-comment">-- == æŠ˜å é…ç½® (Folding) ==</span>
opt.foldenable = <span class="hljs-literal">true</span>                  <span class="hljs-comment">-- å¯ç”¨æŠ˜å åŠŸèƒ½</span>
opt.foldmethod = <span class="hljs-string">"expr"</span>                <span class="hljs-comment">-- ä½¿ç”¨è¡¨è¾¾å¼è¿›è¡ŒæŠ˜å </span>
opt.foldexpr = <span class="hljs-string">"nvim_treesitter#foldexpr()"</span> <span class="hljs-comment">-- æŒ‡å®šæŠ˜å è¡¨è¾¾å¼ä¸º Tree-sitter å‡½æ•°</span>
opt.foldlevel = <span class="hljs-number">99</span>                     <span class="hljs-comment">-- é»˜è®¤æ‰“å¼€æ‰€æœ‰æŠ˜å ï¼ˆæ¨èï¼šæ–‡ä»¶æ‰“å¼€æ—¶å…¨éƒ¨å±•å¼€ï¼‰</span>
opt.foldcolumn = <span class="hljs-string">"1"</span>                   <span class="hljs-comment">-- åœ¨å·¦ä¾§æ˜¾ç¤ºä¸€åˆ—æ¥è¡¨ç¤ºæŠ˜å ï¼ˆå¯é€‰ï¼Œè®¾ä¸º"0"åˆ™ä¸æ˜¾ç¤ºï¼‰</span>
</code></pre>
<hr/>
<h2 data-id="heading-2">âœ… å®Œæˆä¸ä½¿ç”¨</h2>
<p>å®Œæˆä¸Šè¿°é…ç½®åï¼Œé‡æ–°å¯åŠ¨ NeoVimã€‚ä½ å°±å¯ä»¥ä½¿ç”¨æ ‡å‡†çš„ Vim æŠ˜å å‘½ä»¤æ¥æ“ä½œä»£ç å—äº†ï¼š</p>
<ul>
<li><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="bold">z</mi><mi mathvariant="bold">a</mi></mrow><annotation encoding="application/x-tex">\mathbf{za}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4444em;"/><span class="mord"><span class="mord mathbf">za</span></span></span></span></span></span>ï¼šåˆ‡æ¢ï¼ˆæ‰“å¼€/å…³é—­ï¼‰å…‰æ ‡ä¸‹çš„æŠ˜å ã€‚</li>
<li><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="bold">z</mi><mi mathvariant="bold">M</mi></mrow><annotation encoding="application/x-tex">\mathbf{zM}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6861em;"/><span class="mord"><span class="mord mathbf">zM</span></span></span></span></span></span>ï¼šå…³é—­æ–‡ä»¶ä¸­æ‰€æœ‰æŠ˜å ã€‚</li>
<li><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="bold">z</mi><mi mathvariant="bold">R</mi></mrow><annotation encoding="application/x-tex">\mathbf{zR}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6861em;"/><span class="mord"><span class="mord mathbf">zR</span></span></span></span></span></span>ï¼šæ‰“å¼€æ–‡ä»¶ä¸­æ‰€æœ‰æŠ˜å ã€‚</li>
<li><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="bold">z</mi><mi mathvariant="bold">i</mi></mrow><annotation encoding="application/x-tex">\mathbf{zi}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"/><span class="mord"><span class="mord mathbf">zi</span></span></span></span></span></span>ï¼šåˆ‡æ¢æŠ˜å åŠŸèƒ½ (<code>'foldenable'</code>) çš„å¯ç”¨/ç¦ç”¨çŠ¶æ€ã€‚</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ğŸš€ä½¿ç”¨ TRAE SOLO CODE 3.0 çš„å›½å†…ç‰ˆå’Œå›½é™…ç‰ˆå¼€å‘ã€Œæé†’åŠ©æ‰‹ã€è°·æ­Œæ’ä»¶å¼€å‘çš„å®è·µğŸ§£]]></title>    <link>https://juejin.cn/post/7581117416811118635</link>    <guid>https://juejin.cn/post/7581117416811118635</guid>    <pubDate>2025-12-08T09:04:07.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581117416811118635" data-draft-id="7581081334851469353" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ğŸš€ä½¿ç”¨ TRAE SOLO CODE 3.0 çš„å›½å†…ç‰ˆå’Œå›½é™…ç‰ˆå¼€å‘ã€Œæé†’åŠ©æ‰‹ã€è°·æ­Œæ’ä»¶å¼€å‘çš„å®è·µğŸ§£"/> <meta itemprop="keywords" content="Trae"/> <meta itemprop="datePublished" content="2025-12-08T09:04:07.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å›´å·¾å“¥è§å°˜"/> <meta itemprop="url" content="https://juejin.cn/user/1222312659548446"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ğŸš€ä½¿ç”¨ TRAE SOLO CODE 3.0 çš„å›½å†…ç‰ˆå’Œå›½é™…ç‰ˆå¼€å‘ã€Œæé†’åŠ©æ‰‹ã€è°·æ­Œæ’ä»¶å¼€å‘çš„å®è·µğŸ§£
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1222312659548446/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å›´å·¾å“¥è§å°˜
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-08T09:04:07.000Z" title="Mon Dec 08 2025 09:04:07 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»7åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">ğŸš€ä½¿ç”¨ TRAE SOLO CODE 3.0 çš„å›½å†…ç‰ˆå’Œå›½é™…ç‰ˆå¼€å‘ã€Œæé†’åŠ©æ‰‹ã€è°·æ­Œæ’ä»¶å¼€å‘çš„å®è·µğŸ§£</h2>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1e5b51d5b856475a9b006c6aec5785ec~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Zu05be-5ZOl6JCn5bCY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765789787&amp;x-signature=Zm9Xw13qPSr0Ke30YhJ7kCOJJGk%3D" alt="3db936421da241b9a4741be8038d9d3dpreview.jpeg~tplv-a9rns2rl98-image_pre_watermark_1_6b.png" loading="lazy"/></p>
<h3 data-id="heading-1">æ‘˜è¦</h3>
<p>æœ¬æ–‡ä¸»è¦è®°å½•æˆ‘è‡ªå·±åœ¨ 2025 å¹´ 12 æœˆ 8 æ—¥ä½¿ç”¨ <strong>TRAE SOLO CODE 3.0</strong> çš„å›½é™…ç‰ˆå’Œå›½å†…ç‰ˆï¼Œå¼€å‘ä¸€æ¬¾è°·æ­Œæµè§ˆå™¨â€œæé†’åŠ©æ‰‹â€æ’ä»¶çš„å®æ“è¿‡ç¨‹ã€‚å¼€å‘æµç¨‹éµå¾ªè¿­ä»£ä¼˜åŒ–çš„åŸåˆ™ï¼Œç€é‡æ¢è®¨äº†ä»åˆå§‹æ¨¡ç³Šéœ€æ±‚åˆ°åŠŸèƒ½æ˜ç¡®å®šä¹‰çš„è½¬åŒ–è¿‡ç¨‹ã€‚</p>
<p>æˆ‘å‘ç°ï¼Œç°åœ¨çš„ TRAE æå¤§åœ°åŠ å¿«äº†æ’ä»¶åˆ¶ä½œé€Ÿåº¦ï¼Œä½†<strong>æ˜ç¡®çš„åŠŸèƒ½æè¿°</strong>ï¼ˆå¦‚å¢åŠ å€’è®¡æ—¶ã€å¼¹çª—ç­‰ï¼‰æ˜¯ç¡®ä¿ç”Ÿæˆæ•ˆæœå’Œè´¨é‡çš„å…³é”®ã€‚</p>
<p>æ–‡ä¸­åŒæ—¶æˆ‘åˆ†äº«äº†ä½¿ç”¨è‡ªç ”æ™ºèƒ½å›¾æ ‡å·¥å…·ï¼ˆSmart ICONï¼‰è¿›è¡Œå›¾æ ‡ä¼˜åŒ–çš„ç»éªŒï¼Œå¹¶æ€»ç»“äº†æå‡å¼€å‘æ•ˆç‡çš„å®è·µå»ºè®®ï¼Œæ—¨åœ¨ä¸ºåˆå­¦è€…è¿ˆå…¥ä¸‹ä¸€ä»£è¶…çº§å·¥ç¨‹å¸ˆçš„é—¨æ§›æä¾›å‚è€ƒã€‚</p>
<p><strong>å…³é”®è¯ï¼š</strong> TRAE 3.0, è°·æ­Œæ’ä»¶, æé†’åŠ©æ‰‹, æ’ä»¶å¼€å‘, æ•æ·è¿­ä»£</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/77b72ea984c6431c99e0cfb35c3bfa6c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Zu05be-5ZOl6JCn5bCY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765789787&amp;x-signature=wdr4TCU7Guk3QMUZYsRgzdm4wBU%3D" alt="æˆªå±2025-12-08 16.23.45.png" loading="lazy"/></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.bilibili.com%2Fvideo%2FBV1K42CBmEXU%2F%3Fspm_id_from%3D333.1387.homepage.video_card.click" target="_blank" title="https://www.bilibili.com/video/BV1K42CBmEXU/?spm_id_from=333.1387.homepage.video_card.click" ref="nofollow noopener noreferrer">è§†é¢‘æ“ä½œï¼šTRAE SOLO CODE 3.0 å›½é™…ç‰ˆå’Œå›½å†…ç‰ˆå¼€å‘ã€Œæé†’åŠ©æ‰‹ã€è°·æ­Œæ’ä»¶å®å½•ğŸ§£#TRAE 3.0 SOLOå‡ºé“ å¹¶ @trae #SOLOå·²å°±ä½ #TRAE</a></p>
<hr/>
<h3 data-id="heading-2">1. å¼•è¨€</h3>
<p>éšç€äººå·¥æ™ºèƒ½è¾…åŠ©ç¼–ç¨‹å·¥å…·çš„å¿«é€Ÿå‘å±•ï¼Œå¼€å‘æµç¨‹çš„æ•ˆç‡å’Œé—¨æ§›æ­£åœ¨è¢«é‡å¡‘ã€‚æœ¬æ¬¡å®è·µé€‰æ‹©åœ¨ 2025 å¹´ 12 æœˆ 8 æ—¥ï¼Œåˆ©ç”¨ **TRAE 3.0ï¼ˆåŒ…æ‹¬å›½é™…ç‰ˆå’Œå›½å†…ç‰ˆï¼‰**çš„å¼ºå¤§èƒ½åŠ›ï¼Œè¿›è¡Œè°·æ­Œæé†’æ’ä»¶çš„å¼€å‘ã€‚</p>
<p>æ—¨åœ¨é€šè¿‡å®é™…æ“ä½œï¼Œå±•ç¤ºå¦‚ä½•åˆ©ç”¨æœ€æ–°çš„ AI ä»£ç ç”Ÿæˆå·¥å…·ï¼Œå°†ä¸€ä¸ªæ¨¡ç³Šçš„æ¦‚å¿µè½¬åŒ–ä¸ºä¸€ä¸ªå…·å¤‡åŸºæœ¬åŠŸèƒ½çš„å®ç”¨æ’ä»¶ï¼Œå¹¶æç‚¼å‡ºåœ¨ AI è¾…åŠ©å¼€å‘è¿‡ç¨‹ä¸­çš„å…³é”®ç»éªŒå’Œä¼˜åŒ–è·¯å¾„ã€‚</p>
<hr/>
<h3 data-id="heading-3">2. ç ”ç©¶æ–¹æ³•ä¸å¼€å‘æ­¥éª¤</h3>
<p>ä¸ºäº†æ›´å¥½åœ°åŒºåˆ†å’Œå±•ç¤ºå¼€å‘è¿‡ç¨‹ä¸­çš„å·®å¼‚ï¼Œæœ¬æ¬¡å®è·µä¸­å°† <strong>å›½å†…ç‰ˆ</strong> ç•Œå®šä¸ºä½¿ç”¨ç™½è‰²ä¸»é¢˜ï¼Œ<strong>å›½é™…ç‰ˆ</strong> ç•Œå®šä¸ºä½¿ç”¨é»‘è‰²ä¸»é¢˜è¿›è¡Œæè¿°ã€‚å¼€å‘è¿‡ç¨‹ä¸¥æ ¼æŒ‰ç…§è¿­ä»£å’Œä¼˜åŒ–çš„æµç¨‹è¿›è¡Œã€‚</p>
<h4 data-id="heading-4">2.1 åˆå§‹é˜¶æ®µï¼šéœ€æ±‚å®šä¹‰ä¸æç¤ºè¯è®¾ç½®</h4>
<p><strong>æ‰§è¡Œæ­¥éª¤ 1ï¼šåˆæ­¥éœ€æ±‚è¾“å…¥</strong></p>
<p>åœ¨å¼€å‘åˆæœŸï¼Œæˆ‘è‡ªå·±çš„éœ€æ±‚å®šä¹‰å¹¶ä¸æ¸…æ™°ã€‚æœ€åˆçš„æç¤ºè¯è®¾ç½®ç›¸å¯¹ç¬¼ç»Ÿï¼Œä»…æŒ‡å‡ºéœ€è¦åˆ¶ä½œä¸€ä¸ªæé†’æ’ä»¶ï¼Œå¹¶è¦æ±‚å¢åŠ ä¸€äº›â€œæœ‰è¶£å¥½ç©çš„åŠŸèƒ½â€ã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d061e486a6d04aadb80a3856d1bf058a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Zu05be-5ZOl6JCn5bCY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765789787&amp;x-signature=o6UCREPaq8v6sy%2Fr1aZDii2%2BHJA%3D" alt="æˆªå±2025-12-08 17.05.35.png" loading="lazy"/></p>
<ul>
<li><strong>æç¤ºè¯ï¼ˆPromptï¼‰ï¼š</strong> â€œåˆ¶ä½œä¸€ä¸ªè°·æ­Œæé†’æ’ä»¶ï¼Œå¢åŠ ä¸€äº›æœ‰è¶£å¥½ç©çš„åŠŸèƒ½â€ã€‚</li>
</ul>
<p><strong>ä¸ªäººè§è§£ï¼ˆè¸©å‘æŒ‡å—ï¼‰ï¼š</strong> åˆæœŸçš„æ¨¡ç³Šå®šä½æ˜¯å¼€å‘ä¸­çš„å¸¸è§â€œé™·é˜±â€ã€‚ç»éªŒè¡¨æ˜ï¼Œä»…ä»…å®šä¸€ä¸ªæ–¹å‘ï¼ˆä¾‹å¦‚â€œæˆ‘è¦åšä¸€ä¸ªæé†’æ’ä»¶â€ï¼‰æ˜¯è¿œè¿œä¸å¤Ÿçš„ã€‚åœ¨ AI è¾…åŠ©å¼€å‘ä¸­ï¼Œ<strong>å¯¹åŠŸèƒ½ï¼ˆFunctionalityï¼‰çš„æ¸…æ™°æè¿°</strong>æ˜¯å†³å®šæœ€ç»ˆæ•ˆæœè´¨é‡çš„åŸºç¡€ã€‚</p>
<h4 data-id="heading-5">2.2 æ ¸å¿ƒåŠŸèƒ½ä¸ç•Œé¢è®¾è®¡è¿­ä»£</h4>
<p><strong>æ‰§è¡Œæ­¥éª¤ 2ï¼šå¿«é€Ÿè®¾è®¡ä¸åŠŸèƒ½è°ƒæ•´</strong></p>
<p>TRAE 3.0 èƒ½å¤Ÿéå¸¸å¿«é€Ÿåœ°å®Œæˆåˆå§‹è®¾è®¡ã€‚åœ¨åˆå§‹è®¾è®¡å®Œæˆåï¼Œéœ€è¦è¿›è¡Œå¤§é‡çš„ä»»åŠ¡ä¿®æ”¹ï¼Œä¸»è¦é›†ä¸­åœ¨åŠŸèƒ½è°ƒæ•´å’Œç”¨æˆ·ç•Œé¢ï¼ˆUIï¼‰ä¼˜åŒ–ã€‚</p>
<ul>
<li><strong>åŠŸèƒ½è°ƒæ•´ï¼š</strong> åˆ é™¤äº† TRAE é»˜è®¤è®¾ç½®ä¸­å…³äºâ€œè‡ªå®šä¹‰å®Œæˆæé†’â€çš„å¤šä½™è®¾ç½®ã€‚</li>
<li><strong>UI ä¼˜åŒ–ï¼š</strong> åˆå§‹ UI å‘ˆç°ç´«è‰²ï¼Œä¸ºäº†è¿½æ±‚æ›´å¥½çš„è§†è§‰æ•ˆæœï¼Œéšåè¿›è¡Œäº†ç¾åŒ–ä¼˜åŒ–è®¾ç½®ã€‚</li>
</ul>
<p><strong>ç»éªŒåˆ†äº«ï¼š</strong> åœ¨ AI å¿«é€Ÿç”Ÿæˆä»£ç å’Œè®¾è®¡åï¼Œ<strong>äººå·¥å®¡æ ¸å’Œåˆ é™¤å†—ä½™ä»£ç /åŠŸèƒ½</strong>ï¼ˆå¦‚æœ¬ä¾‹ä¸­å»é™¤çš„è‡ªå®šä¹‰å®Œæˆæé†’è®¾ç½®ï¼‰æ˜¯éå¸¸å¿…è¦çš„ï¼Œè¿™æœ‰åŠ©äºä¿æŒä»£ç çš„ç®€æ´æ€§å’Œç¨‹åºçš„æ•ˆç‡ã€‚</p>
<h4 data-id="heading-6">2.3 å›¾æ ‡è®¾è®¡ä¸å¤–éƒ¨å·¥å…·é›†æˆ</h4>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/54b2de58dd9041f3bb4d8a42723916b5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Zu05be-5ZOl6JCn5bCY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765789787&amp;x-signature=yGituJvKF%2FiH0FU%2FJrFxEgfm02c%3D" alt="æˆªå±2025-12-08 16.23.03.png" loading="lazy"/></p>
<p><strong>æ‰§è¡Œæ­¥éª¤ 3ï¼šå›¾æ ‡ç”Ÿæˆä¸æ›¿æ¢</strong></p>
<p>æ’ä»¶çš„å›¾æ ‡è®¾è®¡æ˜¯ç”¨æˆ·ç•Œé¢çš„é‡è¦ç»„æˆéƒ¨åˆ†ã€‚æœ¬æ¬¡å®è·µä¸­ï¼Œä½¿ç”¨äº†è±†åŒ…çš„ç”Ÿå›¾å®Œæˆå›¾æ ‡åˆ¶ä½œï¼Œå¹¶é€šè¿‡è‡ªç ”çš„ <strong>Smart Icon Converter</strong>ï¼ˆè°·æ­Œæ™ºèƒ½å›¾æ ‡æ’ä»¶å·¥å…·ï¼‰æ¥é«˜æ•ˆç”Ÿæˆæ‰€éœ€çš„å›¾æ ‡æ–‡ä»¶ï¼ˆå¦‚ 16x16, 32x32, 48x48, 128x128ï¼‰ã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b1d0b08a331a4a17bfa1fc963ea551d1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Zu05be-5ZOl6JCn5bCY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765789787&amp;x-signature=i2abW3artUL3Y9zNcstw8ZiAF5k%3D" alt="æˆªå±2025-12-08 16.47.55.png" loading="lazy"/></p>
<ul>
<li><strong>å·¥å…·åº”ç”¨ï¼š</strong> ä½¿ç”¨ # Smart Icon Converter ä¸Šä¼ å›¾ç‰‡åï¼Œå·¥å…·ä¼šè‡ªåŠ¨å®Œæˆä¸åŒå°ºå¯¸å›¾æ ‡çš„è½¬æ¢å’Œç”Ÿæˆã€‚</li>
<li><strong>ç»“æœï¼š</strong> ä¸ºäº†å®Œæˆå¯¹æ¯”çš„åŒºåˆ†ï¼Œå›½é™…ç‰ˆæ²¡æœ‰è¿›è¡Œå›¾æ ‡ä¿®æ”¹ï¼Œå› æ­¤ä¿ç•™äº†é»˜è®¤å›¾æ ‡ï¼Œè€Œå›½å†…ç‰ˆåˆ™åº”ç”¨äº†æ–°çš„å›¾æ ‡è®¾è®¡ã€‚</li>
</ul>
<p><strong>ç»éªŒæ€»ç»“ï¼š</strong> å¯¹äºé‡å¤æ€§é«˜ã€æ ¼å¼è¦æ±‚ä¸¥æ ¼çš„ä»»åŠ¡ï¼ˆå¦‚ç”Ÿæˆå¤šå°ºå¯¸å›¾æ ‡ï¼‰ï¼Œä½¿ç”¨è‡ªå®šä¹‰æˆ–å¤–éƒ¨çš„æ™ºèƒ½å·¥å…·èƒ½å¤Ÿå¤§å¹…æå‡æ•ˆç‡ã€‚å°†æ­¤ç±»å·¥å…·çº³å…¥å¼€å‘æµç¨‹ï¼Œå¯ä»¥æœ€å¤§åŒ– AI è¾…åŠ©å¼€å‘çš„æ•ˆç‡ã€‚</p>
<h4 data-id="heading-7">2.4 åŠŸèƒ½æ·±åŒ–ä¸æ–‡æ¡£åˆ›å»º</h4>
<p><strong>æ‰§è¡Œæ­¥éª¤ 4ï¼šåŠŸèƒ½æ˜ç¡®ä¸å¼€å‘æ–‡æ¡£ç”Ÿæˆ</strong></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f166af2d956d45b38206c645152521b3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Zu05be-5ZOl6JCn5bCY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765789787&amp;x-signature=zKZ3sUhKesfB2RmhAyCiqWSn5UA%3D" alt="æˆªå±2025-12-08 16.23.28.png" loading="lazy"/></p>
<p>åœ¨åç»­è¿­ä»£ä¸­ï¼ŒåŠŸèƒ½è¢«æ˜ç¡®ç»†åŒ–ï¼ŒåŒ…æ‹¬å¢åŠ å€’è®¡æ—¶åŠŸèƒ½ å’Œä¼˜åŒ–ç¾è§‚åº¦ã€‚éšåï¼Œåˆ©ç”¨ TRAE å›½å†…ç‰ˆçš„åŠŸèƒ½ï¼Œé‡æ–°åˆ›å»ºäº†è¯¦ç»†çš„å¼€å‘æ–‡æ¡£ã€‚</p>
<ul>
<li><strong>åŠŸèƒ½ç»†åŒ–ï¼š</strong> æ˜ç¡®å¢åŠ äº†å€’è®¡æ—¶ï¼ˆCountdownï¼‰å’Œå¼¹çª—ï¼ˆPop-up windowï¼‰åŠŸèƒ½ã€‚</li>
<li><strong>æ–‡æ¡£åˆ›å»ºï¼š</strong> åˆ©ç”¨å›½å†…ç‰ˆèƒ½åŠ›ç”Ÿæˆå¼€å‘æ–‡æ¡£ï¼Œè¿›ä¸€æ­¥æŒ‡å¯¼åç»­å¼€å‘ã€‚</li>
</ul>
<p><strong>å¯ç¤ºï¼š</strong> å½“æˆ‘ä»¬åœ¨åˆ¶ä½œä»»ä½•äº§å“æ—¶ï¼Œéƒ½éœ€è¦æ€è€ƒæ¸…æ¥šå…¶å…·ä½“çš„åŠŸèƒ½ç‚¹ã€‚ä¾‹å¦‚ï¼Œå¦‚æœè¦åšæé†’æ’ä»¶ï¼Œæ˜ç¡®æŒ‡å®šâ€œå¢åŠ å€’è®¡æ—¶â€å’Œâ€œå¢åŠ å¼¹çª—â€ç­‰å…·ä½“åŠŸèƒ½ï¼Œèƒ½å¤Ÿè®© TRAE äº§å‡ºæ›´ç¬¦åˆé¢„æœŸçš„ç»“æœã€‚</p>
<h4 data-id="heading-8">2.5 æœ€ç»ˆåŠŸèƒ½å®ç°ä¸æµ‹è¯•</h4>
<p><strong>æ‰§è¡Œæ­¥éª¤ 5ï¼šåŸºç¡€åŠŸèƒ½å®ç°ä¸æµ‹è¯•</strong></p>
<h2 data-id="heading-9">å›½é™…ç‰ˆæ•ˆæœï¼š</h2>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/05be220bfc6a4c469d8aef8ecdabec85~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Zu05be-5ZOl6JCn5bCY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765789787&amp;x-signature=BdJu%2B%2FDB0VuuyPZMDp7wpPRVqbw%3D" alt="æˆªå±2025-12-08 16.22.20.png" loading="lazy"/></p>
<h3 data-id="heading-10">ä½¿ç”¨æ€»ç»“åçš„æç¤ºè¯ï¼š</h3>
<pre><code class="hljs language-markdown" lang="markdown">ç®€å•æé†’æ’ä»¶æ˜¯ä¸€æ¬¾åŸºäºChromeæµè§ˆå™¨çš„æ‰©å±•å·¥å…·ï¼Œæ—¨åœ¨å¸®åŠ©ç”¨æˆ·åœ¨é•¿æ—¶é—´å·¥ä½œæˆ–å­¦ä¹ æ—¶ä¿æŒå¥åº·çš„ç”Ÿæ´»ä¹ æƒ¯ã€‚æ’ä»¶ä¼šæŒ‰ç…§è®¾å®šçš„æ—¶é—´é—´éš”è‡ªåŠ¨æé†’ç”¨æˆ·å–æ°´ã€ä¼‘æ¯æˆ–è¿›è¡Œé€‚å½“çš„é”»ç‚¼ã€‚

<span class="hljs-section">### 1.1 åŠŸèƒ½ç‰¹ç‚¹</span>

<span class="hljs-bullet">-</span> â° <span class="hljs-strong">**å®šæ—¶æé†’**</span> ï¼šé»˜è®¤æ¯25åˆ†é’Ÿè‡ªåŠ¨æé†’ï¼Œæ”¯æŒè‡ªå®šä¹‰æé†’æ—¶é—´ï¼ˆ1-60åˆ†é’Ÿï¼‰

<span class="hljs-bullet">-</span> ğŸ’§ <span class="hljs-strong">**å¤šç§æé†’ç±»å‹**</span> ï¼šéšæœºå‘é€å–æ°´ã€ä¼‘æ¯ã€é”»ç‚¼ä¸‰ç§ç±»å‹çš„æé†’

<span class="hljs-bullet">-</span> ğŸ“Š <span class="hljs-strong">**å®æ—¶å€’è®¡æ—¶**</span> ï¼šåœ¨æ’ä»¶å¼¹çª—ä¸­æ˜¾ç¤ºè·ç¦»ä¸‹æ¬¡æé†’çš„å‰©ä½™æ—¶é—´

<span class="hljs-bullet">-</span> ğŸ–¥ï¸ <span class="hljs-strong">**åŒé‡æé†’æœºåˆ¶**</span> ï¼šç³»ç»Ÿé€šçŸ¥ + è‡ªå®šä¹‰å¼¹çª—ï¼Œç¡®ä¿ç”¨æˆ·ä¸ä¼šé”™è¿‡æé†’

<span class="hljs-bullet">-</span> ğŸ’¾ <span class="hljs-strong">**è®¾ç½®æŒä¹…åŒ–**</span> ï¼šè‡ªåŠ¨ä¿å­˜ç”¨æˆ·è®¾ç½®ï¼Œä¸‹æ¬¡å¯åŠ¨æ—¶æ¢å¤

<span class="hljs-bullet">-</span> ğŸ¨ <span class="hljs-strong">**ç®€æ´ç¾è§‚**</span> ï¼šç°ä»£åŒ–çš„UIè®¾è®¡ï¼Œæ“ä½œç®€å•ç›´è§‚
</code></pre>
<h2 data-id="heading-11">å›½å†…ç‰ˆæ•ˆæœï¼š</h2>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/dd6694af4da84f8c939fbb81afb55274~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Zu05be-5ZOl6JCn5bCY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765789787&amp;x-signature=irahfjWS3LDizDm%2BrZRQb6GnadI%3D" alt="æˆªå±2025-12-08 16.24.16.png" loading="lazy"/></p>
<h3 data-id="heading-12">ä½¿ç”¨æœ€åˆçš„æç¤ºè¯ï¼š</h3>
<pre><code class="hljs">åˆ¶ä½œä¸€ä¸ªè°·æ­Œçš„æé†’æ’ä»¶ï¼Œå¢åŠ ä¸€äº›æœ‰è¶£å¥½ç©çš„åŠŸèƒ½
</code></pre>
<p>åœ¨æœ€ç»ˆé˜¶æ®µï¼Œé€šè¿‡å›½å†…ç‰ˆå®ç°äº†åŸºæœ¬çš„æé†’åŠŸèƒ½ï¼Œå³åœ¨è®¾å®šçš„æ—¶é—´èŠ‚ç‚¹å¼¹å‡ºæé†’ï¼ˆè¿™ä¸ªå¼¹çª—æé†’æ²¡æœ‰å¾—åˆ°å®ç°ï¼‰ã€‚åœ¨è‡ªå®šä¹‰è®¾ç½®ä¸€åˆ†é’Ÿæé†’æ—¶ï¼Œå‡ºç°äº†è½»å¾®çš„â€œå°ç¿»è½¦â€ç°è±¡ï¼Œä½†åŸºç¡€åŠŸèƒ½é€»è¾‘å·²å®ç°ã€‚</p>
<ul>
<li><strong>å®ç°æ•ˆæœï¼š</strong> è¾¾åˆ°æ—¶é—´èŠ‚ç‚¹æ—¶ï¼Œå¼¹çª—å®ç°æé†’åŠŸèƒ½ã€‚</li>
<li><strong>å¾…ä¼˜åŒ–ç©ºé—´ï¼š</strong> ä»å­˜åœ¨è¿›ä¸€æ­¥ä¼˜åŒ–çš„ç©ºé—´å’Œè°ƒæ•´çš„å¯èƒ½æ€§ã€‚</li>
</ul>
<hr/>
<h3 data-id="heading-13">3. ç»“æœä¸è®¨è®º</h3>
<p>æœ¬æ¬¡å®è·µè¯æ˜ï¼Œåˆ©ç”¨ TRAE SOLO 3.0 ä¸ç®¡æ˜¯å›½é™…ç‰ˆè¿˜æ˜¯å›½å†…ç‰ˆï¼Œè¿›è¡Œæ’ä»¶å¼€å‘çš„æ—¶å€™ï¼Œéƒ½å…·æœ‰æé«˜çš„é€Ÿåº¦ä¼˜åŠ¿ã€‚å¼€å‘é€Ÿåº¦å¿«æ˜¯å½“å‰ AI è¾…åŠ©å¼€å‘çš„ä¸€å¤§ç‰¹ç‚¹ã€‚</p>
<h4 data-id="heading-14">3.1 æ ¸å¿ƒç»éªŒæ€»ç»“ï¼šæˆåŠŸçš„å…³é”®å› ç´ </h4>
<p>æˆåŠŸçš„ AI è¾…åŠ©å¼€å‘é«˜åº¦ä¾èµ–äº<strong>å‰æœŸæ¸…æ™°çš„éœ€æ±‚å®šä¹‰</strong>ã€‚</p>
<ol>
<li><strong>å®šä¹‰æ˜ç¡®æ€§ï¼ˆWhat to doï¼‰ï¼š</strong> é¦–å…ˆå¿…é¡»æ¸…æ™°å®šä¹‰â€œè¦åšä»€ä¹ˆâ€ã€‚</li>
<li><strong>åŠŸèƒ½æ˜ç¡®æ€§ï¼ˆFeaturesï¼‰ï¼š</strong> å…¶æ¬¡éœ€è¦æ€è€ƒâ€œåšè¿™ä¸ªä¸œè¥¿æœ‰å“ªäº›åŠŸèƒ½â€ã€‚å®šä¹‰çš„å†…å®¹å’ŒåŠŸèƒ½è¶Šæ¸…æ¥šï¼ŒTRAE äº§å‡ºçš„æ•ˆæœç›¸å¯¹æ¥è¯´å°±è¶Šå¥½ã€‚</li>
</ol>
<h4 data-id="heading-15">3.2 æˆä¸ºä¸‹ä¸€ä»£è¶…çº§å·¥ç¨‹å¸ˆçš„è·¯å¾„</h4>
<p>é€šè¿‡ç®€å•æ–¹å¼å¼€å§‹æ’ä»¶åˆ¶ä½œï¼Œæ˜¯è¿ˆå…¥â€œä¸‹ä¸€ä»£è¶…çº§å·¥ç¨‹å¸ˆâ€é—¨æ§›çš„æœ‰æ•ˆé€”å¾„ã€‚ä¸€æ—¦æŒæ¡äº†æ’ä»¶å¼€å‘çš„æµç¨‹å’Œæ–¹æ³•ï¼Œåç»­çš„ç½‘é¡µå¼€å‘ã€å°ç¨‹åºå¼€å‘ä»¥åŠç§»åŠ¨ç«¯å¼€å‘ç­‰ä»»åŠ¡éƒ½å°†å˜å¾—ç›¸å¯¹ç®€å•ã€‚</p>
<h3 data-id="heading-16">4. ç»“è®º</h3>
<p>TRAE SOLO CODE 3.0 ä¸ºè°·æ­Œæ’ä»¶çš„å¼€å‘æä¾›äº†å¿«é€Ÿä¸”é«˜æ•ˆçš„å·¥å…·ã€‚æœ¬æ¬¡â€œæé†’åŠ©æ‰‹â€çš„å¼€å‘å®å½•å¼ºè°ƒäº†åœ¨ AI è¾…åŠ©ç¼–ç¨‹æ—¶ä»£ï¼Œäººç±»å·¥ç¨‹å¸ˆçš„ä»·å€¼åœ¨äº<strong>é«˜è´¨é‡çš„åˆå§‹æç¤ºè¯å’Œæ¸…æ™°çš„åŠŸèƒ½è§„åˆ’</strong>ã€‚é€šè¿‡ä¸æ–­è¿­ä»£ä¼˜åŒ–åŠŸèƒ½å’Œç•Œé¢ï¼Œå³ä½¿æ˜¯æ–°å¼€å‘äººå‘˜ä¹Ÿå¯ä»¥è¿…é€Ÿå®ç°å¤æ‚çš„åŠŸèƒ½ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Javaæšä¸¾ï¼ˆEnumï¼‰ï¼šå®šä¹‰å›ºå®šå€¼çš„"ç±»å‹å®‰å…¨"åˆ©å™¨]]></title>    <link>https://juejin.cn/post/7581210455826939940</link>    <guid>https://juejin.cn/post/7581210455826939940</guid>    <pubDate>2025-12-08T08:59:24.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581210455826939940" data-draft-id="7581210455826907172" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Javaæšä¸¾ï¼ˆEnumï¼‰ï¼šå®šä¹‰å›ºå®šå€¼çš„&quot;ç±»å‹å®‰å…¨&quot;åˆ©å™¨"/> <meta itemprop="keywords" content="Java"/> <meta itemprop="datePublished" content="2025-12-08T08:59:24.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="åƒè¥¿çº¢æŸ¿é•¿å¤§çš„ç•ªèŒ„"/> <meta itemprop="url" content="https://juejin.cn/user/3097787706900985"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Javaæšä¸¾ï¼ˆEnumï¼‰ï¼šå®šä¹‰å›ºå®šå€¼çš„"ç±»å‹å®‰å…¨"åˆ©å™¨
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3097787706900985/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    åƒè¥¿çº¢æŸ¿é•¿å¤§çš„ç•ªèŒ„
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-08T08:59:24.000Z" title="Mon Dec 08 2025 08:59:24 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    4
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»13åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252b3a}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px;color:#5e7ce0}.markdown-body h1{font-size:24px;margin-bottom:5px;margin-top:80px;position:relative;text-align:center}.markdown-body h2{font-size:20px;padding-bottom:12px;border-bottom:1px solid #dfe1e6}.markdown-body h3{font-size:18px;padding-bottom:0}.markdown-body h4{font-size:16px;margin-top:30px}.markdown-body h5{font-size:14px;margin-top:20px}.markdown-body h6{font-size:14px;margin-top:5px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #dfe1e6;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#ffeeed;color:#c73636;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#252b3a;background:#f8f8f8}.markdown-body a{position:relative;text-decoration:none;color:#5e7ce0;padding-right:18px;padding-bottom:4px}.markdown-body a[href^=http]:after{position:absolute;display:inline-block;width:16px;height:16px;margin-left:2px;margin-top:6px;content:"";background:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAIRlWElmTU0AKgAAAAgABQESAAMAAAABAAEAAAEaAAUAAAABAAAASgEbAAUAAAABAAAAUgEoAAMAAAABAAIAAIdpAAQAAAABAAAAWgAAAAAAAABIAAAAAQAAAEgAAAABAAOgAQADAAAAAQABAACgAgAEAAAAAQAAACCgAwAEAAAAAQAAACAAAAAAX7wP8AAAAAlwSFlzAAALEwAACxMBAJqcGAAAAVlpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IlhNUCBDb3JlIDYuMC4wIj4KICAgPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4KICAgICAgPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIKICAgICAgICAgICAgeG1sbnM6dGlmZj0iaHR0cDovL25zLmFkb2JlLmNvbS90aWZmLzEuMC8iPgogICAgICAgICA8dGlmZjpPcmllbnRhdGlvbj4xPC90aWZmOk9yaWVudGF0aW9uPgogICAgICA8L3JkZjpEZXNjcmlwdGlvbj4KICAgPC9yZGY6UkRGPgo8L3g6eG1wbWV0YT4KGV7hBwAABWVJREFUWAnlVktsVFUY/s85997pC9BOTKxRWnEKsXWlxjWJj0RWJjrFAAXjAlewYWOkgauACVu7a2IiNUEyExM3yoZE3Wmi7qgPJthJBDE6JUNpO3Mf5/j95/bOTOcBlBgXejJ37rn/Of/7O/9/iP7vQ/zTAcjnC4ry+a5ii1OkiYTpuvjvEc0Gp51uivP+ZW+QBuSW4QjW5rptAa1Ey0uOGKOxwPetVyafN6p/52/PkNBbjdAhGaGEpMRjLZTryB8+9MUSYSGNRIcBvm8kBAY9tHYlHz78nTs392xIkwv9FA3Oe33bdoX1ZZKOS0bH0CXI6RugYLW6BwIu5gskkQ4sEG0wYF25PjBzbZfSYY6kDLUmWMt7FR7Lw3xYUkaTdjxHfTPnPwav0iEGYADVa9XIRIEyxrAA0jIQxgFL22gYwF7A8/DAzNVdksJvJaTEUZ2kYnZWziN5s1ADPHneEIXByotYuMSrf9JEbbsuv7VcvbaKML8plXtQR0EdIYDqWEmtOgAomZFH8EjWSnek2ulmtljljttHbmaIHCCCHzd9MjwfsmscBeZH9Jyd10nMvz92UQrtCBKvMF06mQy0SiEdRMEGg8mN0YjAlgoDDkPrMI5qJKSkKKydpbB2CZjJkhIBvOBw2CGQgii85bpx//dMqFRKam5uvH7w+K97oe+Cl0HO68uIBH0qyEzpOMwIbZIcFq0I+9cwoElizCjk2KFI1y7Nnx614W1db58fOXIlMzs7Xn/jeDmvBV2Q0mXjGf554O/m4LZHp2N8r61WPMvLZWLdiC4GMAk5BjeeB5lhv39l6+BIbu3m760hXMDKBD08XBKzR8fr04nygnIypOOAJUx/fHrsi0Mnys+vVK+V4VUohaiyPCo2Q9DFALvF/ikw8WS4QvVZALS5ksw47/7R8ejgTPk1UFqU6/3zp8bOM7B/kdu/fkguPGU5JibW+F0sTjWOUw8DklRrg4BiLGeBqbaRLxjlT4no0InFV402RcftJz41cH/f/JnHP3kZaaF6VX/liwist9vYG5+NU9Cg3MNkt/+lU5wS8fTxq3mc7ILjDlAE4CJpe89BOWPiIjBhi9O6PI4G1jsc6RGB3lZwmS76k8H0zOKTkFboG8jS2krFKCX2fvTeaPHIBwAkMHHgncURnL3nuCSnxSopdIzN5th0BIonJ0Lf9yUA9iMkzdRWl3BixOusfDcwQVcS4UKIFwYfGPnM8wY/DyP9NFMXaTE5BU39tGkDgGZz+fJJG0oYcSaOafLcqdECY4LzfSObSzyUOgxqtyisr8SSNOOAkubWoh3TTaeA2YtFEXPnm5x81/j+6MI6JqyS25WSNU6hbCMKHG84marJbdR+vwakRhQLRuQpbzHRLjmpmijI+OmWCtq+LzWtnX5v30gHSsqmWne74DtiACi2+Wz0iXbuLt9D2cDyoPEkWOiyp5XUIwLMi/wJY1FbH5B9ONtdC1KrsD/Q0MCQAS0wccILORDW25amAeOtooAj/KQxfzF17uwTSQ1v3dJ7jnLINwdZYRDa4tPU0sHVXFo/vxFF5BqFqxRfOmgPCk4ft2NgKTCy2Y47JIEg+MIhjYsLy5I25qUYTQlCjMRHsr/UwdYwIK33UO1J5fFNB9XNO6akcywJofVmXQDP2wfrSPcI2xG5BSs3I+IosHr4EtvO1TDAu16xHQq5+ykMblfRXLbhEoFIdDTBdhldvzl+3CMg60ZktI2vNzLW6IIp0waLklot9L63yzuUp8dJd7bglPFe3hIXstBEP58/s6Ocyr4rH2+866ZNbriTzA0RSOWCwakMl1QJgculxPt8Z7O5GLdtW6bvU8R/nO1vb+hMExVAVtEAAAAASUVORK5CYII=");background-size:100%}.markdown-body a:active,.markdown-body a:hover{border-bottom:2px solid #5e7ce0}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #5e7ce0;border-spacing:0}.markdown-body thead{color:#fff;text-align:left}.markdown-body thead tr{background:#5e7ce0}.markdown-body thead th{border-bottom:1px solid #dfe1e6}.markdown-body tr{background-color:#fff}.markdown-body tr:nth-child(2n){background-color:#f2f5fc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#252b3a;padding:1px 23px;margin:22px 0;border-left:4px solid #5e7ce0;background-color:#f2f5fc}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{padding-left:10px;margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol li::marker,.markdown-body ul li::marker{color:#5e7ce0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body ul li::marker{content:"â€¢";color:#5e7ce0}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}.markdown-body input[type=checkbox]:before{display:inline-block;width:16px;height:16px;content:"";background:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEIAAABCCAYAAADjVADoAAAK2GlDQ1BJQ0MgUHJvZmlsZQAASImVlwdUU9kWhs+96Y0WiHRC70gngJTQQxGkg6iEJJBQYkgIKmJnUMGxoCKCZcSKKFhGQMaCWLANAopdJ8igoD4HC6Ki5t3AI8zMW++99fZaJ+dbO/vss/e55671XwAoYWyRKBdWAyBPWCCODQ2gJ6ek0nHPAQRgQAI2wIHNkYiYMTGRALHJ+a/28S4Sjdhte0Wuf///v5oGlyfhAAClIZzBlXDyEG5DxkuOSFwAAOoI4jddUCBScBfCmmKkQIR/V3DWBH9ScMY4o8njMfGxgQjTAcCT2WxxFgBkO8RPL+RkIXnIih4chVyBEOFihH05fDYX4TMI2+XlzVfwIMJWSLwIAApyOoCR8aecWX/Jn6HMz2ZnKXmir3HDBwkkolz2ov/zaP635eVKJ/ewQAaZLw6LVeyHnN/9nPkRShZmzIyeZAF3oiYF86VhCZPMkQSmTjKXHRShXJs7M3KSMwUhLGWeAlb8JPMkwXGTLJ4fq9wrUxzInGS2eHxfIsIyaU6C0s/nsZT5i/jxSZNcKEicOcmSnLiIqZhApV8sjVXWzxOGBkztG6LsPU/yp34FLOXaAn58mLJ39lT9PCFzKqckWVkblxcUPBWToIwXFQQo9xLlxijjebmhSr+kME65tgC5nFNrY5RnmM0Oj5lkIABRgA04dNVJAqCAt7BA0UjgfNEisSCLX0BnIm8bj84Schzs6M6Ozs4AKN7dievwnjb+TkK061O+NYjHr10ul5+e8oUi9/i4KfJYbk35LCsAUNUD4Op+jlRcOOFDK34wyNNTBZpABxgCU2AF7IEzcAfewB8Eg3AQDeJBCpiL1MoHeUAMFoBisAKUgnKwEWwF1WA32AsOgaPgBGgGZ8AFcAXcAF2gFzwCMjAAXoFh8BGMQRCEgygQFdKBjCBzyBZyhhiQLxQMRUKxUAqUDmVBQkgKFUOroHKoAqqG9kB10HHoNHQBugZ1Qw+gPmgIegd9gVEwGdaEDWALeDrMgJlwBBwPz4Gz4Hy4CC6B18NVcC18BG6CL8A34F5YBr+CR1AARULRUMYoexQDFYiKRqWiMlFi1FJUGaoSVYtqQLWiOlC3UTLUa9RnNBZNRdPR9mhvdBg6Ac1B56OXotehq9GH0E3oS+jb6D70MPo7hoLRx9hivDAsTDImC7MAU4qpxBzAnMJcxvRiBjAfsVgsDWuJ9cCGYVOw2djF2HXYndhGbBu2G9uPHcHhcDo4W5wPLhrHxhXgSnHbcUdw53E9uAHcJzwJb4R3xofgU/FC/Ep8Jf4w/hy+B/8CP0ZQI5gTvAjRBC5hEWEDYR+hlXCLMEAYI6oTLYk+xHhiNnEFsYrYQLxMfEx8TyKRTEiepFkkAWk5qYp0jHSV1Ef6TNYg25ADyWlkKXk9+SC5jfyA/J5CoVhQ/CmplALKekod5SLlKeWTClXFQYWlwlVZplKj0qTSo/JGlaBqrspUnatapFqpelL1luprNYKahVqgGlttqVqN2mm1e2oj6lR1J/Vo9Tz1deqH1a+pD2rgNCw0gjW4GiUaezUuavRTUVRTaiCVQ11F3Ue9TB3QxGpaarI0szXLNY9qdmoOa2louWolai3UqtE6qyWjoWgWNBYtl7aBdoJ2l/ZlmsE05jTetLXTGqb1TBvV1tP21+Zpl2k3avdqf9Gh6wTr5Ohs0mnWeaKL1rXRnaW7QHeX7mXd13qaet56HL0yvRN6D/VhfRv9WP3F+nv1b+qPGBgahBqIDLYbXDR4bUgz9DfMNtxieM5wyIhq5GskMNpidN7oJV2LzqTn0qvol+jDxvrGYcZS4z3GncZjJpYmCSYrTRpNnpgSTRmmmaZbTNtNh82MzKLMis3qzR6aE8wZ5nzzbeYd5qMWlhZJFqstmi0GLbUtWZZFlvWWj60oVn5W+Va1VnessdYM6xzrndZdNrCNmw3fpsbmli1s624rsN1p222HsfO0E9rV2t2zJ9sz7Qvt6+37HGgOkQ4rHZod3kw3m546fdP0junfHd0ccx33OT5y0nAKd1rp1Or0ztnGmeNc43zHheIS4rLMpcXlrautK891l+t9N6pblNtqt3a3b+4e7mL3BvchDzOPdI8dHvcYmowYxjrGVU+MZ4DnMs8znp+93L0KvE54/eFt753jfdh7cIblDN6MfTP6fUx82D57fGS+dN903598ZX7Gfmy/Wr9n/qb+XP8D/i+Y1sxs5hHmmwDHAHHAqYDRQK/AJYFtQaig0KCyoM5gjeCE4OrgpyEmIVkh9SHDoW6hi0PbwjBhEWGbwu6xDFgcVh1rONwjfEn4pQhyRFxEdcSzSJtIcWRrFBwVHrU56vFM85nCmc3RIJoVvTn6SYxlTH7ML7Ows2Jm1cx6HusUWxzbEUeNmxd3OO5jfED8hvhHCVYJ0oT2RNXEtMS6xNGkoKSKJFny9OQlyTdSdFMEKS2puNTE1AOpI7ODZ2+dPZDmllaadneO5ZyFc67N1Z2bO/fsPNV57Hkn0zHpSemH07+yo9m17JEMVsaOjGFOIGcb5xXXn7uFO8Tz4VXwXmT6ZFZkDmb5ZG3OGuL78Sv5rwWBgmrB2+yw7N3ZoznROQdz5LlJuY15+Lz0vNNCDWGO8NJ8w/kL53eLbEWlIlm+V/7W/GFxhPiABJLMkbQUaCIi6abUSvqDtK/Qt7Cm8NOCxAUnF6ovFC68uchm0dpFL4pCivYvRi/mLG4vNi5eUdy3hLlkz1JoacbS9mWmy0qWDSwPXX5oBXFFzopfVzqurFj5YVXSqtYSg5LlJf0/hP5QX6pSKi69t9p79e416DWCNZ1rXdZuX/u9jFt2vdyxvLL86zrOuus/Ov1Y9aN8feb6zg3uG3ZtxG4Ubry7yW/ToQr1iqKK/s1Rm5u20LeUbfmwdd7Wa5Wulbu3EbdJt8mqIqtatptt37j9azW/urcmoKZxh/6OtTtGd3J39uzy39Ww22B3+e4vPwl+ur8ndE9TrUVt5V7s3sK9z/cl7uvYz9hfd0D3QPmBbweFB2WHYg9dqvOoqzusf3hDPVwvrR86knak62jQ0ZYG+4Y9jbTG8mPgmPTYy+Ppx++eiDjRfpJxsuFn8593nKKeKmuCmhY1DTfzm2UtKS3dp8NPt7d6t576xeGXg2eMz9Sc1Tq74RzxXMk5+fmi8yNtorbXF7Iu9LfPa390MfninUuzLnVejrh89UrIlYsdzI7zV32unrnmde30dcb15hvuN5puut089avbr6c63Tubbnncauny7GrtntF9rsev58LtoNtX7rDu3Oid2dt9N+Hu/Xtp92T3ufcHH+Q+ePuw8OHYo+WPMY/Lnqg9qXyq/7T2N+vfGmXusrN9QX03n8U9e9TP6X/1u+T3rwMlzynPK18YvagbdB48MxQy1PVy9suBV6JXY69L/6H+jx1vrN78/If/HzeHk4cH3orfyt+te6/z/uAH1w/tIzEjTz/mfRwbLfuk8+nQZ8bnji9JX16MLfiK+1r1zfpb6/eI74/leXK5iC1mj0sBFDLgzEwA3h1EtHEKAFRElxNnT2jrcYMmvgfGCfwnntDf4+YOQAMyKWQR0x+Akwo5i8wqyKyQRPH+AHZxUY5/mSTTxXkiFxlRlphPcvl7AwBwrQB8E8vlYzvl8m/7kGIfANCWP6HpFYZFtHyD3vJRg6LbPe3g7zah9//U499noKjAFfx9/ieoZhkWVvYkwwAAAGxlWElmTU0AKgAAAAgABAEaAAUAAAABAAAAPgEbAAUAAAABAAAARgEoAAMAAAABAAIAAIdpAAQAAAABAAAATgAAAAAAAACQAAAAAQAAAJAAAAABAAKgAgAEAAAAAQAAAEKgAwAEAAAAAQAAAEIAAAAAgodoEQAAAAlwSFlzAAAWJQAAFiUBSVIk8AAAAhRJREFUeAHtnLEuBFEUhs9cu7JCskEhIrZAgYZGoREPwBuIygOoPITKA6jEG/AAolFoaFCgICIKZBNiY8Pyz5rNOWe9wNz5T7N3Z2eT/b/7zZlpziat3xKWBDJoEyh5EDd3DTk5r8vV7Yc8vzbl6zvfwvSERIYHyzI90SeLc1WZrFV85PR9oi+N/YMnOT6t/3tiLAeXFqqytjrSFacDYmfvQS6u37tOiPHA7FS/bK6PmWhpj4AJRYGA9MiKzLpK6An+cqiNVmRleUhArrec6PNzt/5sttLgh0cvcvfY6Px+ZNY9I6Ax6gKErY1xmZ8ZyD0E5MJGIgsyIZsunT3g7qALJuTdAp0nWyMTsunS2QNukbpwOcRaPpvOHvxzQow2ZBvrs+nsfLL8o0QQBJFdMO1XGkEjaIQlQCMsD/YIGkEjLAEaYXmwR9AIGmEJ0AjLgz2CRtAIS4BGWB7sETSCRlgCNMLyYI+gETTCEqARlgd7BI2gEZYAjbA82CNoBI2wBGiE5cEeQSNohCVAIywP9ggaQSMsARphebBH0AgaYQnQCMsjYC5SF2agYi2fTWcPGA7VFfO0n8+mswdMyOrCNJwnpz/P6xqZkE2Xzh4w8qcLI4Hbu/dydvkWBRAAQBZk0uOOyKyzp5PARRiF1puNtR+NTh+oMCvtJ+D8F2N6j6x+PrwzG46gRTDDm5BtsAGBg0X924Qfj7i23p7HNgQAAAAASUVORK5CYII=");background-size:100%;position:relative;right:2px;top:-5px}.markdown-body input[type=checkbox]:checked:before{background:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEIAAABCCAYAAADjVADoAAAK2GlDQ1BJQ0MgUHJvZmlsZQAASImVlwdUU9kWhs+96Y0WiHRC70gngJTQQxGkg6iEJJBQYkgIKmJnUMGxoCKCZcSKKFhGQMaCWLANAopdJ8igoD4HC6Ki5t3AI8zMW++99fZaJ+dbO/vss/e55671XwAoYWyRKBdWAyBPWCCODQ2gJ6ek0nHPAQRgQAI2wIHNkYiYMTGRALHJ+a/28S4Sjdhte0Wuf///v5oGlyfhAAClIZzBlXDyEG5DxkuOSFwAAOoI4jddUCBScBfCmmKkQIR/V3DWBH9ScMY4o8njMfGxgQjTAcCT2WxxFgBkO8RPL+RkIXnIih4chVyBEOFihH05fDYX4TMI2+XlzVfwIMJWSLwIAApyOoCR8aecWX/Jn6HMz2ZnKXmir3HDBwkkolz2ov/zaP635eVKJ/ewQAaZLw6LVeyHnN/9nPkRShZmzIyeZAF3oiYF86VhCZPMkQSmTjKXHRShXJs7M3KSMwUhLGWeAlb8JPMkwXGTLJ4fq9wrUxzInGS2eHxfIsIyaU6C0s/nsZT5i/jxSZNcKEicOcmSnLiIqZhApV8sjVXWzxOGBkztG6LsPU/yp34FLOXaAn58mLJ39lT9PCFzKqckWVkblxcUPBWToIwXFQQo9xLlxijjebmhSr+kME65tgC5nFNrY5RnmM0Oj5lkIABRgA04dNVJAqCAt7BA0UjgfNEisSCLX0BnIm8bj84Schzs6M6Ozs4AKN7dievwnjb+TkK061O+NYjHr10ul5+e8oUi9/i4KfJYbk35LCsAUNUD4Op+jlRcOOFDK34wyNNTBZpABxgCU2AF7IEzcAfewB8Eg3AQDeJBCpiL1MoHeUAMFoBisAKUgnKwEWwF1WA32AsOgaPgBGgGZ8AFcAXcAF2gFzwCMjAAXoFh8BGMQRCEgygQFdKBjCBzyBZyhhiQLxQMRUKxUAqUDmVBQkgKFUOroHKoAqqG9kB10HHoNHQBugZ1Qw+gPmgIegd9gVEwGdaEDWALeDrMgJlwBBwPz4Gz4Hy4CC6B18NVcC18BG6CL8A34F5YBr+CR1AARULRUMYoexQDFYiKRqWiMlFi1FJUGaoSVYtqQLWiOlC3UTLUa9RnNBZNRdPR9mhvdBg6Ac1B56OXotehq9GH0E3oS+jb6D70MPo7hoLRx9hivDAsTDImC7MAU4qpxBzAnMJcxvRiBjAfsVgsDWuJ9cCGYVOw2djF2HXYndhGbBu2G9uPHcHhcDo4W5wPLhrHxhXgSnHbcUdw53E9uAHcJzwJb4R3xofgU/FC/Ep8Jf4w/hy+B/8CP0ZQI5gTvAjRBC5hEWEDYR+hlXCLMEAYI6oTLYk+xHhiNnEFsYrYQLxMfEx8TyKRTEiepFkkAWk5qYp0jHSV1Ef6TNYg25ADyWlkKXk9+SC5jfyA/J5CoVhQ/CmplALKekod5SLlKeWTClXFQYWlwlVZplKj0qTSo/JGlaBqrspUnatapFqpelL1luprNYKahVqgGlttqVqN2mm1e2oj6lR1J/Vo9Tz1deqH1a+pD2rgNCw0gjW4GiUaezUuavRTUVRTaiCVQ11F3Ue9TB3QxGpaarI0szXLNY9qdmoOa2louWolai3UqtE6qyWjoWgWNBYtl7aBdoJ2l/ZlmsE05jTetLXTGqb1TBvV1tP21+Zpl2k3avdqf9Gh6wTr5Ohs0mnWeaKL1rXRnaW7QHeX7mXd13qaet56HL0yvRN6D/VhfRv9WP3F+nv1b+qPGBgahBqIDLYbXDR4bUgz9DfMNtxieM5wyIhq5GskMNpidN7oJV2LzqTn0qvol+jDxvrGYcZS4z3GncZjJpYmCSYrTRpNnpgSTRmmmaZbTNtNh82MzKLMis3qzR6aE8wZ5nzzbeYd5qMWlhZJFqstmi0GLbUtWZZFlvWWj60oVn5W+Va1VnessdYM6xzrndZdNrCNmw3fpsbmli1s624rsN1p222HsfO0E9rV2t2zJ9sz7Qvt6+37HGgOkQ4rHZod3kw3m546fdP0junfHd0ccx33OT5y0nAKd1rp1Or0ztnGmeNc43zHheIS4rLMpcXlrautK891l+t9N6pblNtqt3a3b+4e7mL3BvchDzOPdI8dHvcYmowYxjrGVU+MZ4DnMs8znp+93L0KvE54/eFt753jfdh7cIblDN6MfTP6fUx82D57fGS+dN903598ZX7Gfmy/Wr9n/qb+XP8D/i+Y1sxs5hHmmwDHAHHAqYDRQK/AJYFtQaig0KCyoM5gjeCE4OrgpyEmIVkh9SHDoW6hi0PbwjBhEWGbwu6xDFgcVh1rONwjfEn4pQhyRFxEdcSzSJtIcWRrFBwVHrU56vFM85nCmc3RIJoVvTn6SYxlTH7ML7Ows2Jm1cx6HusUWxzbEUeNmxd3OO5jfED8hvhHCVYJ0oT2RNXEtMS6xNGkoKSKJFny9OQlyTdSdFMEKS2puNTE1AOpI7ODZ2+dPZDmllaadneO5ZyFc67N1Z2bO/fsPNV57Hkn0zHpSemH07+yo9m17JEMVsaOjGFOIGcb5xXXn7uFO8Tz4VXwXmT6ZFZkDmb5ZG3OGuL78Sv5rwWBgmrB2+yw7N3ZoznROQdz5LlJuY15+Lz0vNNCDWGO8NJ8w/kL53eLbEWlIlm+V/7W/GFxhPiABJLMkbQUaCIi6abUSvqDtK/Qt7Cm8NOCxAUnF6ovFC68uchm0dpFL4pCivYvRi/mLG4vNi5eUdy3hLlkz1JoacbS9mWmy0qWDSwPXX5oBXFFzopfVzqurFj5YVXSqtYSg5LlJf0/hP5QX6pSKi69t9p79e416DWCNZ1rXdZuX/u9jFt2vdyxvLL86zrOuus/Ov1Y9aN8feb6zg3uG3ZtxG4Ubry7yW/ToQr1iqKK/s1Rm5u20LeUbfmwdd7Wa5Wulbu3EbdJt8mqIqtatptt37j9azW/urcmoKZxh/6OtTtGd3J39uzy39Ww22B3+e4vPwl+ur8ndE9TrUVt5V7s3sK9z/cl7uvYz9hfd0D3QPmBbweFB2WHYg9dqvOoqzusf3hDPVwvrR86knak62jQ0ZYG+4Y9jbTG8mPgmPTYy+Ppx++eiDjRfpJxsuFn8593nKKeKmuCmhY1DTfzm2UtKS3dp8NPt7d6t576xeGXg2eMz9Sc1Tq74RzxXMk5+fmi8yNtorbXF7Iu9LfPa390MfninUuzLnVejrh89UrIlYsdzI7zV32unrnmde30dcb15hvuN5puut089avbr6c63Tubbnncauny7GrtntF9rsev58LtoNtX7rDu3Oid2dt9N+Hu/Xtp92T3ufcHH+Q+ePuw8OHYo+WPMY/Lnqg9qXyq/7T2N+vfGmXusrN9QX03n8U9e9TP6X/1u+T3rwMlzynPK18YvagbdB48MxQy1PVy9suBV6JXY69L/6H+jx1vrN78/If/HzeHk4cH3orfyt+te6/z/uAH1w/tIzEjTz/mfRwbLfuk8+nQZ8bnji9JX16MLfiK+1r1zfpb6/eI74/leXK5iC1mj0sBFDLgzEwA3h1EtHEKAFRElxNnT2jrcYMmvgfGCfwnntDf4+YOQAMyKWQR0x+Akwo5i8wqyKyQRPH+AHZxUY5/mSTTxXkiFxlRlphPcvl7AwBwrQB8E8vlYzvl8m/7kGIfANCWP6HpFYZFtHyD3vJRg6LbPe3g7zah9//U499noKjAFfx9/ieoZhkWVvYkwwAAAGxlWElmTU0AKgAAAAgABAEaAAUAAAABAAAAPgEbAAUAAAABAAAARgEoAAMAAAABAAIAAIdpAAQAAAABAAAATgAAAAAAAACQAAAAAQAAAJAAAAABAAKgAgAEAAAAAQAAAEKgAwAEAAAAAQAAAEIAAAAAgodoEQAAAAlwSFlzAAAWJQAAFiUBSVIk8AAABMtJREFUeAHtXM2KFDEQzrQKruIu4mEXRFlUVLz4A4K7B99AcO8io0/gwQfxDVzFuwu+gQf34EG8iOAPKAh6EFlBFMSf/qa2uqszlVR6ZtYxM5PDJNVVSer78nU6KrHzpyxuVlwx44AY2O0T8eb9D7f5fMu9fPvdff7y0/36nbdgdhUdd+jgHnf62JxbObvgjh/d60Pu2R35ajx49Mk9frqlBk7Kw8sXF9y1K4t9cCoi7tz/4F68/tYXMIkPzpzY725dP9yA1tsjoIRpIQHogRWYZSmwJ4Reh06nI2Nd7rYEA8zAzqXAxhgq/pc1d9vHKbEX+Dr4JbzypJDc/YxXYi/wifRLeOXpU5q7n/FK7EXsnBBeeRoqd7/EHj1ZhleeiMjdz8pArRKR+0pb+UsCuK0SkftKW/kzeFmrRHCAxWzufsaJOkqExWzufpOI8EpP1jnCJCK80pN1jjCJ4ICwMigidz/jRD3bI7bZUInIfaWt/KUSuK0SEd4jqFvufgYva5UIDrCYzd3POFFHifhfV/7k8lwPw7D5mUSEV3r854ju2pK7ffOIWzk/X+Go803Lr+ooGqoiwkyP9xzRXVt0q9sE3CgJYTLqfNPyE/irpkoEe2um6ck4bSiBSeD8JBl41jY/Hgd1lIiaaeoyLlsjgUGAjEH3DB4DtUpEW2Z3Mj5GAgA8efbVvXpX/200nln5IMYvKhHDrvylcwdc9+pSNdeg46WQsP7wo2s7fpWYaPT926fw9ZiVk4BpywYJkGuvlJs4EuWS0p/HTyHh3kbzH2najM85cR0lgpPiYMtukFB26m1u5Ua+vkFkWP3Zn0KCJDg1Px6f42Wtvhrhdyz8ncanrFKCmGH1wrwDMCrh/uxPIUFTAvdHbeVPsc1fVRE+c7Ud/k6fWt7XHFlYqcqQ5wTRvWpiY4wrIZwfDUL+akDRUBXB/jCzFCH9SHCzTDRUmsro7z+cEvrHwxOZn2ZTL/pVFcEBtRLoiWXfxQ5ehvoHHx4vpIwUEuJKSMvPz5/zQq0qwmIy5m+rjBQSwnsCQYnlgwjfT72av6oifOba2qnKcOXeGVIP0rT3BALTNr8mBWSpRHAgmJSTtLGhDHwj+A9GPCbX2DNiBSRoShg0H8zl5y/njxIhJ0WntralDJmIbO+UEvz85Zwt9wj7HIDB5Ttp7RkyGbRDSqC49vOjX50P9aexmr+qInzmajvtO13H02SpyrCVMNj8dT7/4BwByDXzRIC0LWXEldA/njVfip9GpV9VERxQM0lPhrVDyrCVMJr5/fwZJ+qWewR1lSuNJ21sXxnjVgIhck5VhM/cqG1WBpIAMX4Z9Xz+eP58sFUiOBArLQcZpQ0CNCXt1HzA5OfPOFGrrwYHyKTwbNJsxolaJUJbKeo0mu/4uMeXBHBbJSK88qP5jo97fAYva5UIDgivHEXk7mecqKNEhFeOhsjdbxKR+0pb+UsCuK0qIveVtvJn8LJWieAAi9nc/YwTdZQIi9nc/SYR4ZWenSO2yZvgcwTuRYZKWBnUI3e/xF7gcmio5L4HWPlL7AVuyPol95W28me8EnuBa8J+sZjM3c94JfYCd6VxTXjaCjDLe+K9cwTuSuOa8LQUYPXvh1d3w0HC7JK8kMK0/rcJfwHkVMYgi4xhOgAAAABJRU5ErkJggg==");background-size:100%}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="a11y-light">.hljs-comment,.hljs-quote{color:#696969}.hljs-deletion,.hljs-name,.hljs-regexp,.hljs-selector-class,.hljs-selector-id,.hljs-tag,.hljs-template-variable,.hljs-variable{color:#d91e18}.hljs-attribute,.hljs-built_in,.hljs-builtin-name,.hljs-link,.hljs-literal,.hljs-meta,.hljs-number,.hljs-params,.hljs-type{color:#aa5d00}.hljs-addition,.hljs-bullet,.hljs-string,.hljs-symbol{color:green}.hljs-section,.hljs-title{color:#007faa}.hljs-keyword,.hljs-selector-tag{color:#7928a1}.markdown-body pre,.markdown-body pre&gt;code.hljs{background:#fefefe;color:#545454}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}@media screen and (-ms-high-contrast:active){.hljs-addition,.hljs-attribute,.hljs-built_in,.hljs-builtin-name,.hljs-bullet,.hljs-comment,.hljs-link,.hljs-literal,.hljs-meta,.hljs-number,.hljs-params,.hljs-quote,.hljs-string,.hljs-symbol,.hljs-type{color:highlight}.hljs-keyword,.hljs-selector-tag{font-weight:700}}</style><h2 data-id="heading-0">å¼•è¨€ï¼šä¸ºä»€ä¹ˆéœ€è¦æšä¸¾ï¼Ÿ</h2>
<p>æƒ³è±¡ä¸€ä¸‹ï¼Œä½ è¦è¡¨ç¤ºä¸€å‘¨çš„ä¸ƒå¤©ï¼š</p>
<ul>
<li>ç”¨æ•°å­—ï¼Ÿ<code>1=å‘¨ä¸€ï¼Œ2=å‘¨äºŒ...</code>Â â†’ å®¹æ˜“è®°é”™ï¼Œä¸ç›´è§‚</li>
<li>ç”¨å­—ç¬¦ä¸²ï¼Ÿ<code>"Monday"</code>Â â†’ æ‹¼å†™å¯èƒ½å‡ºé”™ï¼Œæ¯”è¾ƒéº»çƒ¦</li>
<li>ç”¨å¸¸é‡ï¼Ÿ<code>int MONDAY = 1;</code>Â â†’ å¤šä¸ªæ–‡ä»¶éœ€è¦é‡å¤å®šä¹‰</li>
</ul>
<p>è¿™æ—¶å€™ï¼Œ<strong>æšä¸¾</strong>ï¼ˆEnumï¼‰å°±æ´¾ä¸Šç”¨åœºäº†ï¼æšä¸¾å¯ä»¥è®©æˆ‘ä»¬å®šä¹‰ä¸€ç»„å‘½åçš„å¸¸é‡ï¼Œè®©ä»£ç æ›´åŠ æ¸…æ™°ã€å®‰å…¨ã€‚</p>
<h2 data-id="heading-1">ä¸€ã€ä»€ä¹ˆæ˜¯æšä¸¾ï¼Ÿ</h2>
<p><strong>æšä¸¾</strong>æ˜¯ä¸€ç§ç‰¹æ®Šçš„ç±»ï¼Œå®ƒè¡¨ç¤ºä¸€ç»„å›ºå®šçš„å¸¸é‡ã€‚å°±åƒé€‰æ‹©é¢˜çš„é€‰é¡¹ï¼š</p>
<ul>
<li>æ˜ŸæœŸå‡ ï¼šå‘¨ä¸€ã€å‘¨äºŒã€å‘¨ä¸‰...</li>
<li>å­£èŠ‚ï¼šæ˜¥ã€å¤ã€ç§‹ã€å†¬</li>
<li>é¢œè‰²ï¼šçº¢ã€ç»¿ã€è“ã€é»„</li>
<li>è®¢å•çŠ¶æ€ï¼šå¾…æ”¯ä»˜ã€å·²æ”¯ä»˜ã€å·²å‘è´§ã€å·²å®Œæˆ</li>
</ul>
<p>æšä¸¾è®©è¿™äº›é€‰é¡¹æˆä¸º<strong>ç±»å‹å®‰å…¨</strong>çš„ï¼Œç¼–è¯‘å™¨ä¼šæ£€æŸ¥ä½ æ˜¯å¦ä½¿ç”¨äº†æœ‰æ•ˆçš„å€¼ã€‚</p>
<h2 data-id="heading-2">äºŒã€æšä¸¾çš„åŸºæœ¬ä½¿ç”¨</h2>
<h3 data-id="heading-3">2.1 æœ€ç®€å•çš„æšä¸¾</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">BasicEnum</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        System.out.println(<span class="hljs-string">"=== åŸºæœ¬æšä¸¾ä½¿ç”¨ ==="</span>);
        
        <span class="hljs-comment">// å®šä¹‰å’Œä½¿ç”¨æšä¸¾</span>
        <span class="hljs-type">Day</span> <span class="hljs-variable">today</span> <span class="hljs-operator">=</span> Day.MONDAY;
        System.out.println(<span class="hljs-string">"ä»Šå¤©æ˜¯: "</span> + today);
        
        <span class="hljs-comment">// æ¯”è¾ƒæšä¸¾</span>
        <span class="hljs-type">Day</span> <span class="hljs-variable">meetingDay</span> <span class="hljs-operator">=</span> Day.WEDNESDAY;
        <span class="hljs-keyword">if</span> (today == meetingDay) {
            System.out.println(<span class="hljs-string">"ä»Šå¤©è¦å¼€ä¼šï¼"</span>);
        } <span class="hljs-keyword">else</span> {
            System.out.println(<span class="hljs-string">"ä»Šå¤©ä¸å¼€ä¼š"</span>);
        }
        
        <span class="hljs-comment">// ä½¿ç”¨switchè¯­å¥</span>
        System.out.println(<span class="hljs-string">"\n=== æ ¹æ®æ˜ŸæœŸå®‰æ’æ´»åŠ¨ ==="</span>);
        <span class="hljs-keyword">switch</span> (today) {
            <span class="hljs-keyword">case</span> MONDAY:
                System.out.println(<span class="hljs-string">"å‘¨ä¸€ï¼šå¼€å§‹æ–°çš„ä¸€å‘¨"</span>);
                <span class="hljs-keyword">break</span>;
            <span class="hljs-keyword">case</span> TUESDAY:
                System.out.println(<span class="hljs-string">"å‘¨äºŒï¼šåŠªåŠ›å·¥ä½œ"</span>);
                <span class="hljs-keyword">break</span>;
            <span class="hljs-keyword">case</span> WEDNESDAY:
                System.out.println(<span class="hljs-string">"å‘¨ä¸‰ï¼šä¸€å‘¨è¿‡åŠ"</span>);
                <span class="hljs-keyword">break</span>;
            <span class="hljs-keyword">case</span> THURSDAY:
                System.out.println(<span class="hljs-string">"å‘¨å››ï¼šæœŸå¾…å‘¨æœ«"</span>);
                <span class="hljs-keyword">break</span>;
            <span class="hljs-keyword">case</span> FRIDAY:
                System.out.println(<span class="hljs-string">"å‘¨äº”ï¼šç»ˆäºå‘¨äº”äº†"</span>);
                <span class="hljs-keyword">break</span>;
            <span class="hljs-keyword">case</span> SATURDAY:
            <span class="hljs-keyword">case</span> SUNDAY:
                System.out.println(<span class="hljs-string">"å‘¨æœ«ï¼šå¥½å¥½ä¼‘æ¯"</span>);
                <span class="hljs-keyword">break</span>;
        }
        
        <span class="hljs-comment">// éå†æ‰€æœ‰æšä¸¾å€¼</span>
        System.out.println(<span class="hljs-string">"\n=== ä¸€å‘¨ä¸ƒå¤© ==="</span>);
        <span class="hljs-keyword">for</span> (Day day : Day.values()) {
            System.out.println(day);
        }
        
        <span class="hljs-comment">// è·å–æšä¸¾çš„åºå·å’Œåç§°</span>
        System.out.println(<span class="hljs-string">"\n=== æšä¸¾è¯¦ç»†ä¿¡æ¯ ==="</span>);
        System.out.println(today.name());      <span class="hljs-comment">// åç§°ï¼šMONDAY</span>
        System.out.println(today.ordinal());   <span class="hljs-comment">// åºå·ï¼š0ï¼ˆä»0å¼€å§‹ï¼‰</span>
        
        <span class="hljs-comment">// æ ¹æ®åç§°è·å–æšä¸¾</span>
        <span class="hljs-type">Day</span> <span class="hljs-variable">dayFromString</span> <span class="hljs-operator">=</span> Day.valueOf(<span class="hljs-string">"FRIDAY"</span>);
        System.out.println(<span class="hljs-string">"ä»å­—ç¬¦ä¸²è·å–: "</span> + dayFromString);
    }
}

<span class="hljs-comment">// å®šä¹‰æ˜ŸæœŸæšä¸¾</span>
<span class="hljs-keyword">enum</span> <span class="hljs-title class_">Day</span> {
    MONDAY, TUESDAY, WEDNESDAY, THURSDAY, FRIDAY, SATURDAY, SUNDAY
}
</code></pre>
<p><strong>è¿è¡Œç»“æœï¼š</strong></p>
<pre><code class="hljs language-java" lang="java">=== åŸºæœ¬æšä¸¾ä½¿ç”¨ ===
ä»Šå¤©æ˜¯: MONDAY
ä»Šå¤©ä¸å¼€ä¼š

=== æ ¹æ®æ˜ŸæœŸå®‰æ’æ´»åŠ¨ ===
å‘¨ä¸€ï¼šå¼€å§‹æ–°çš„ä¸€å‘¨

=== ä¸€å‘¨ä¸ƒå¤© ===
MONDAY
TUESDAY
WEDNESDAY
THURSDAY
FRIDAY
SATURDAY
SUNDAY

=== æšä¸¾è¯¦ç»†ä¿¡æ¯ ===
MONDAY
<span class="hljs-number">0</span>
ä»å­—ç¬¦ä¸²è·å–: FRIDAY
</code></pre>
<h3 data-id="heading-4">2.2 æ›´å¤šæšä¸¾ç¤ºä¾‹</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MoreEnums</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        System.out.println(<span class="hljs-string">"=== æ›´å¤šæšä¸¾ç¤ºä¾‹ ==="</span>);
        
        <span class="hljs-comment">// é¢œè‰²æšä¸¾</span>
        <span class="hljs-type">Color</span> <span class="hljs-variable">favoriteColor</span> <span class="hljs-operator">=</span> Color.BLUE;
        System.out.println(<span class="hljs-string">"æˆ‘æœ€å–œæ¬¢çš„é¢œè‰²: "</span> + favoriteColor);
        
        <span class="hljs-comment">// å­£èŠ‚æšä¸¾</span>
        <span class="hljs-type">Season</span> <span class="hljs-variable">currentSeason</span> <span class="hljs-operator">=</span> Season.SUMMER;
        System.out.println(<span class="hljs-string">"å½“å‰å­£èŠ‚: "</span> + currentSeason);
        
        <span class="hljs-comment">// æ–¹å‘æšä¸¾</span>
        <span class="hljs-type">Direction</span> <span class="hljs-variable">direction</span> <span class="hljs-operator">=</span> Direction.EAST;
        System.out.println(<span class="hljs-string">"æ–¹å‘: "</span> + direction);
        
        <span class="hljs-comment">// éå†æšä¸¾</span>
        System.out.println(<span class="hljs-string">"\n=== æ‰€æœ‰é¢œè‰² ==="</span>);
        <span class="hljs-keyword">for</span> (Color color : Color.values()) {
            System.out.println(color);
        }
        
        <span class="hljs-comment">// æšä¸¾æ¯”è¾ƒ</span>
        System.out.println(<span class="hljs-string">"\n=== æšä¸¾æ¯”è¾ƒ ==="</span>);
        <span class="hljs-type">Color</span> <span class="hljs-variable">color1</span> <span class="hljs-operator">=</span> Color.RED;
        <span class="hljs-type">Color</span> <span class="hljs-variable">color2</span> <span class="hljs-operator">=</span> Color.RED;
        <span class="hljs-type">Color</span> <span class="hljs-variable">color3</span> <span class="hljs-operator">=</span> Color.BLUE;
        
        System.out.println(<span class="hljs-string">"color1 == color2: "</span> + (color1 == color2));  <span class="hljs-comment">// true</span>
        System.out.println(<span class="hljs-string">"color1.equals(color2): "</span> + color1.equals(color2));  <span class="hljs-comment">// true</span>
        System.out.println(<span class="hljs-string">"color1 == color3: "</span> + (color1 == color3));  <span class="hljs-comment">// false</span>
        
        <span class="hljs-comment">// ä½¿ç”¨switch</span>
        System.out.println(<span class="hljs-string">"\n=== æ ¹æ®é¢œè‰²æ‰§è¡Œæ“ä½œ ==="</span>);
        <span class="hljs-keyword">switch</span> (favoriteColor) {
            <span class="hljs-keyword">case</span> RED:
                System.out.println(<span class="hljs-string">"çƒ­æƒ…çš„é¢œè‰²"</span>);
                <span class="hljs-keyword">break</span>;
            <span class="hljs-keyword">case</span> GREEN:
                System.out.println(<span class="hljs-string">"è‡ªç„¶çš„é¢œè‰²"</span>);
                <span class="hljs-keyword">break</span>;
            <span class="hljs-keyword">case</span> BLUE:
                System.out.println(<span class="hljs-string">"å†·é™çš„é¢œè‰²"</span>);
                <span class="hljs-keyword">break</span>;
            <span class="hljs-keyword">case</span> YELLOW:
                System.out.println(<span class="hljs-string">"æ˜äº®çš„é¢œè‰²"</span>);
                <span class="hljs-keyword">break</span>;
        }
    }
}

<span class="hljs-comment">// é¢œè‰²æšä¸¾</span>
<span class="hljs-keyword">enum</span> <span class="hljs-title class_">Color</span> {
    RED, GREEN, BLUE, YELLOW, BLACK, WHITE
}

<span class="hljs-comment">// å­£èŠ‚æšä¸¾</span>
<span class="hljs-keyword">enum</span> <span class="hljs-title class_">Season</span> {
    SPRING, SUMMER, AUTUMN, WINTER
}

<span class="hljs-comment">// æ–¹å‘æšä¸¾</span>
<span class="hljs-keyword">enum</span> <span class="hljs-title class_">Direction</span> {
    NORTH, EAST, SOUTH, WEST
}
</code></pre>
<h2 data-id="heading-5">ä¸‰ã€é«˜çº§æšä¸¾ï¼šå¸¦å±æ€§çš„æšä¸¾</h2>
<h3 data-id="heading-6">3.1 æšä¸¾å¯ä»¥æœ‰è‡ªå·±çš„å±æ€§å’Œæ–¹æ³•</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AdvancedEnum</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        System.out.println(<span class="hljs-string">"=== é«˜çº§æšä¸¾ï¼šå¸¦å±æ€§çš„æšä¸¾ ==="</span>);
        
        <span class="hljs-comment">// ä½¿ç”¨å¸¦å±æ€§çš„æšä¸¾</span>
        <span class="hljs-type">Planet</span> <span class="hljs-variable">earth</span> <span class="hljs-operator">=</span> Planet.EARTH;
        System.out.println(<span class="hljs-string">"åœ°çƒçš„è´¨é‡: "</span> + earth.getMass() + <span class="hljs-string">" kg"</span>);
        System.out.println(<span class="hljs-string">"åœ°çƒçš„åŠå¾„: "</span> + earth.getRadius() + <span class="hljs-string">" m"</span>);
        System.out.println(<span class="hljs-string">"åœ°çƒçš„è¡¨é¢é‡åŠ›: "</span> + earth.surfaceGravity() + <span class="hljs-string">" m/sÂ²"</span>);
        
        <span class="hljs-comment">// è®¡ç®—åœ¨ä¸åŒè¡Œæ˜Ÿä¸Šçš„é‡é‡</span>
        <span class="hljs-type">double</span> <span class="hljs-variable">earthWeight</span> <span class="hljs-operator">=</span> <span class="hljs-number">75.0</span>; <span class="hljs-comment">// 75kg</span>
        <span class="hljs-type">double</span> <span class="hljs-variable">marsWeight</span> <span class="hljs-operator">=</span> earthWeight * Planet.MARS.surfaceGravity() / Planet.EARTH.surfaceGravity();
        System.out.println(<span class="hljs-string">"75kgåœ¨åœ°çƒä¸Šï¼Œåœ¨ç«æ˜Ÿä¸Šæ˜¯: "</span> + marsWeight + <span class="hljs-string">" kg"</span>);
        
        <span class="hljs-comment">// æ˜¾ç¤ºæ‰€æœ‰è¡Œæ˜Ÿä¿¡æ¯</span>
        System.out.println(<span class="hljs-string">"\n=== å¤ªé˜³ç³»è¡Œæ˜Ÿ ==="</span>);
        <span class="hljs-keyword">for</span> (Planet planet : Planet.values()) {
            System.out.printf(<span class="hljs-string">"%-10s: è´¨é‡=%e kg, åŠå¾„=%,.0f m\n"</span>,
                            planet, planet.getMass(), planet.getRadius());
        }
        
        <span class="hljs-comment">// æµ‹è¯•HTTPçŠ¶æ€ç æšä¸¾</span>
        System.out.println(<span class="hljs-string">"\n=== HTTPçŠ¶æ€ç  ==="</span>);
        <span class="hljs-type">HttpStatus</span> <span class="hljs-variable">success</span> <span class="hljs-operator">=</span> HttpStatus.OK;
        System.out.println(success.getCode() + <span class="hljs-string">" - "</span> + success.getMessage());
        
        <span class="hljs-type">HttpStatus</span> <span class="hljs-variable">notFound</span> <span class="hljs-operator">=</span> HttpStatus.NOT_FOUND;
        System.out.println(notFound.getCode() + <span class="hljs-string">" - "</span> + notFound.getMessage());
        System.out.println(<span class="hljs-string">"æ˜¯å®¢æˆ·ç«¯é”™è¯¯å—ï¼Ÿ"</span> + notFound.isClientError());
        
        <span class="hljs-comment">// æµ‹è¯•è®¢å•çŠ¶æ€</span>
        System.out.println(<span class="hljs-string">"\n=== è®¢å•çŠ¶æ€ ==="</span>);
        <span class="hljs-type">OrderStatus</span> <span class="hljs-variable">status</span> <span class="hljs-operator">=</span> OrderStatus.PROCESSING;
        System.out.println(<span class="hljs-string">"å½“å‰çŠ¶æ€: "</span> + status);
        System.out.println(<span class="hljs-string">"æè¿°: "</span> + status.getDescription());
        System.out.println(<span class="hljs-string">"æ˜¯å¦å¯ä»¥å–æ¶ˆï¼Ÿ"</span> + status.canCancel());
        
        <span class="hljs-comment">// å°è¯•è½¬æ¢çŠ¶æ€</span>
        <span class="hljs-type">OrderStatus</span> <span class="hljs-variable">nextStatus</span> <span class="hljs-operator">=</span> status.next();
        <span class="hljs-keyword">if</span> (nextStatus != <span class="hljs-literal">null</span>) {
            System.out.println(<span class="hljs-string">"ä¸‹ä¸€ä¸ªçŠ¶æ€: "</span> + nextStatus);
        }
    }
}

<span class="hljs-comment">// è¡Œæ˜Ÿæšä¸¾ - å¸¦æœ‰è´¨é‡å’ŒåŠå¾„</span>
<span class="hljs-keyword">enum</span> <span class="hljs-title class_">Planet</span> {
    <span class="hljs-comment">// æšä¸¾å€¼è°ƒç”¨æ„é€ æ–¹æ³•</span>
    MERCURY(<span class="hljs-number">3.303e+23</span>, <span class="hljs-number">2.4397e6</span>),
    VENUS(<span class="hljs-number">4.869e+24</span>, <span class="hljs-number">6.0518e6</span>),
    EARTH(<span class="hljs-number">5.976e+24</span>, <span class="hljs-number">6.37814e6</span>),
    MARS(<span class="hljs-number">6.421e+23</span>, <span class="hljs-number">3.3972e6</span>),
    JUPITER(<span class="hljs-number">1.9e+27</span>, <span class="hljs-number">7.1492e7</span>),
    SATURN(<span class="hljs-number">5.688e+26</span>, <span class="hljs-number">6.0268e7</span>),
    URANUS(<span class="hljs-number">8.686e+25</span>, <span class="hljs-number">2.5559e7</span>),
    NEPTUNE(<span class="hljs-number">1.024e+26</span>, <span class="hljs-number">2.4746e7</span>);
    
    <span class="hljs-comment">// æšä¸¾çš„å±æ€§</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">double</span> mass;   <span class="hljs-comment">// è´¨é‡ï¼ˆåƒå…‹ï¼‰</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">double</span> radius; <span class="hljs-comment">// åŠå¾„ï¼ˆç±³ï¼‰</span>
    
    <span class="hljs-comment">// ä¸‡æœ‰å¼•åŠ›å¸¸æ•°</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">double</span> <span class="hljs-variable">G</span> <span class="hljs-operator">=</span> <span class="hljs-number">6.67300E-11</span>;
    
    <span class="hljs-comment">// æšä¸¾çš„æ„é€ æ–¹æ³•ï¼ˆå¿…é¡»æ˜¯privateï¼Œå¯ä»¥çœç•¥ä¸å†™ï¼‰</span>
    <span class="hljs-keyword">private</span> <span class="hljs-title function_">Planet</span><span class="hljs-params">(<span class="hljs-type">double</span> mass, <span class="hljs-type">double</span> radius)</span> {
        <span class="hljs-built_in">this</span>.mass = mass;
        <span class="hljs-built_in">this</span>.radius = radius;
    }
    
    <span class="hljs-comment">// Getteræ–¹æ³•</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">double</span> <span class="hljs-title function_">getMass</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> mass;
    }
    
    <span class="hljs-keyword">public</span> <span class="hljs-type">double</span> <span class="hljs-title function_">getRadius</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> radius;
    }
    
    <span class="hljs-comment">// è®¡ç®—æ–¹æ³•ï¼šè¡¨é¢é‡åŠ›</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">double</span> <span class="hljs-title function_">surfaceGravity</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> G * mass / (radius * radius);
    }
    
    <span class="hljs-comment">// è®¡ç®—æ–¹æ³•ï¼šè®¡ç®—é‡é‡</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">double</span> <span class="hljs-title function_">surfaceWeight</span><span class="hljs-params">(<span class="hljs-type">double</span> otherMass)</span> {
        <span class="hljs-keyword">return</span> otherMass * surfaceGravity();
    }
}

<span class="hljs-comment">// HTTPçŠ¶æ€ç æšä¸¾</span>
<span class="hljs-keyword">enum</span> <span class="hljs-title class_">HttpStatus</span> {
    <span class="hljs-comment">// 1xx: ä¿¡æ¯å“åº”</span>
    CONTINUE(<span class="hljs-number">100</span>, <span class="hljs-string">"Continue"</span>),
    SWITCHING_PROTOCOLS(<span class="hljs-number">101</span>, <span class="hljs-string">"Switching Protocols"</span>),
    
    <span class="hljs-comment">// 2xx: æˆåŠŸ</span>
    OK(<span class="hljs-number">200</span>, <span class="hljs-string">"OK"</span>),
    CREATED(<span class="hljs-number">201</span>, <span class="hljs-string">"Created"</span>),
    ACCEPTED(<span class="hljs-number">202</span>, <span class="hljs-string">"Accepted"</span>),
    
    <span class="hljs-comment">// 3xx: é‡å®šå‘</span>
    MOVED_PERMANENTLY(<span class="hljs-number">301</span>, <span class="hljs-string">"Moved Permanently"</span>),
    FOUND(<span class="hljs-number">302</span>, <span class="hljs-string">"Found"</span>),
    
    <span class="hljs-comment">// 4xx: å®¢æˆ·ç«¯é”™è¯¯</span>
    BAD_REQUEST(<span class="hljs-number">400</span>, <span class="hljs-string">"Bad Request"</span>),
    UNAUTHORIZED(<span class="hljs-number">401</span>, <span class="hljs-string">"Unauthorized"</span>),
    FORBIDDEN(<span class="hljs-number">403</span>, <span class="hljs-string">"Forbidden"</span>),
    NOT_FOUND(<span class="hljs-number">404</span>, <span class="hljs-string">"Not Found"</span>),
    
    <span class="hljs-comment">// 5xx: æœåŠ¡å™¨é”™è¯¯</span>
    INTERNAL_SERVER_ERROR(<span class="hljs-number">500</span>, <span class="hljs-string">"Internal Server Error"</span>),
    BAD_GATEWAY(<span class="hljs-number">502</span>, <span class="hljs-string">"Bad Gateway"</span>),
    SERVICE_UNAVAILABLE(<span class="hljs-number">503</span>, <span class="hljs-string">"Service Unavailable"</span>);
    
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> code;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> String message;
    
    HttpStatus(<span class="hljs-type">int</span> code, String message) {
        <span class="hljs-built_in">this</span>.code = code;
        <span class="hljs-built_in">this</span>.message = message;
    }
    
    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getCode</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> code;
    }
    
    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getMessage</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> message;
    }
    
    <span class="hljs-comment">// åˆ¤æ–­æ˜¯å¦æ˜¯ä¿¡æ¯å“åº”</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">isInformational</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> code &gt;= <span class="hljs-number">100</span> &amp;&amp; code &lt; <span class="hljs-number">200</span>;
    }
    
    <span class="hljs-comment">// åˆ¤æ–­æ˜¯å¦æ˜¯æˆåŠŸå“åº”</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">isSuccess</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> code &gt;= <span class="hljs-number">200</span> &amp;&amp; code &lt; <span class="hljs-number">300</span>;
    }
    
    <span class="hljs-comment">// åˆ¤æ–­æ˜¯å¦æ˜¯é‡å®šå‘</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">isRedirection</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> code &gt;= <span class="hljs-number">300</span> &amp;&amp; code &lt; <span class="hljs-number">400</span>;
    }
    
    <span class="hljs-comment">// åˆ¤æ–­æ˜¯å¦æ˜¯å®¢æˆ·ç«¯é”™è¯¯</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">isClientError</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> code &gt;= <span class="hljs-number">400</span> &amp;&amp; code &lt; <span class="hljs-number">500</span>;
    }
    
    <span class="hljs-comment">// åˆ¤æ–­æ˜¯å¦æ˜¯æœåŠ¡å™¨é”™è¯¯</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">isServerError</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> code &gt;= <span class="hljs-number">500</span> &amp;&amp; code &lt; <span class="hljs-number">600</span>;
    }
    
    <span class="hljs-comment">// æ ¹æ®çŠ¶æ€ç è·å–æšä¸¾</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> HttpStatus <span class="hljs-title function_">fromCode</span><span class="hljs-params">(<span class="hljs-type">int</span> code)</span> {
        <span class="hljs-keyword">for</span> (HttpStatus status : values()) {
            <span class="hljs-keyword">if</span> (status.code == code) {
                <span class="hljs-keyword">return</span> status;
            }
        }
        <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
    }
}

<span class="hljs-comment">// è®¢å•çŠ¶æ€æšä¸¾</span>
<span class="hljs-keyword">enum</span> <span class="hljs-title class_">OrderStatus</span> {
    PENDING(<span class="hljs-string">"å¾…æ”¯ä»˜"</span>, <span class="hljs-literal">true</span>) {
        <span class="hljs-meta">@Override</span>
        <span class="hljs-keyword">public</span> OrderStatus <span class="hljs-title function_">next</span><span class="hljs-params">()</span> {
            <span class="hljs-keyword">return</span> PAID;
        }
    },
    PAID(<span class="hljs-string">"å·²æ”¯ä»˜"</span>, <span class="hljs-literal">false</span>) {
        <span class="hljs-meta">@Override</span>
        <span class="hljs-keyword">public</span> OrderStatus <span class="hljs-title function_">next</span><span class="hljs-params">()</span> {
            <span class="hljs-keyword">return</span> PROCESSING;
        }
    },
    PROCESSING(<span class="hljs-string">"å¤„ç†ä¸­"</span>, <span class="hljs-literal">false</span>) {
        <span class="hljs-meta">@Override</span>
        <span class="hljs-keyword">public</span> OrderStatus <span class="hljs-title function_">next</span><span class="hljs-params">()</span> {
            <span class="hljs-keyword">return</span> SHIPPED;
        }
    },
    SHIPPED(<span class="hljs-string">"å·²å‘è´§"</span>, <span class="hljs-literal">false</span>) {
        <span class="hljs-meta">@Override</span>
        <span class="hljs-keyword">public</span> OrderStatus <span class="hljs-title function_">next</span><span class="hljs-params">()</span> {
            <span class="hljs-keyword">return</span> DELIVERED;
        }
    },
    DELIVERED(<span class="hljs-string">"å·²é€è¾¾"</span>, <span class="hljs-literal">false</span>) {
        <span class="hljs-meta">@Override</span>
        <span class="hljs-keyword">public</span> OrderStatus <span class="hljs-title function_">next</span><span class="hljs-params">()</span> {
            <span class="hljs-keyword">return</span> COMPLETED;
        }
    },
    COMPLETED(<span class="hljs-string">"å·²å®Œæˆ"</span>, <span class="hljs-literal">false</span>) {
        <span class="hljs-meta">@Override</span>
        <span class="hljs-keyword">public</span> OrderStatus <span class="hljs-title function_">next</span><span class="hljs-params">()</span> {
            <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>; <span class="hljs-comment">// æ²¡æœ‰ä¸‹ä¸€ä¸ªçŠ¶æ€</span>
        }
    },
    CANCELLED(<span class="hljs-string">"å·²å–æ¶ˆ"</span>, <span class="hljs-literal">false</span>) {
        <span class="hljs-meta">@Override</span>
        <span class="hljs-keyword">public</span> OrderStatus <span class="hljs-title function_">next</span><span class="hljs-params">()</span> {
            <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>; <span class="hljs-comment">// å·²å–æ¶ˆæ²¡æœ‰ä¸‹ä¸€ä¸ªçŠ¶æ€</span>
        }
    };
    
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> String description;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">boolean</span> canCancel;
    
    OrderStatus(String description, <span class="hljs-type">boolean</span> canCancel) {
        <span class="hljs-built_in">this</span>.description = description;
        <span class="hljs-built_in">this</span>.canCancel = canCancel;
    }
    
    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getDescription</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> description;
    }
    
    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">canCancel</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> canCancel;
    }
    
    <span class="hljs-comment">// æŠ½è±¡æ–¹æ³•ï¼šæ¯ä¸ªæšä¸¾å€¼å®ç°è‡ªå·±çš„ä¸‹ä¸€ä¸ªçŠ¶æ€</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> OrderStatus <span class="hljs-title function_">next</span><span class="hljs-params">()</span>;
}
</code></pre>
<h2 data-id="heading-7">å››ã€æšä¸¾å®ç°æ¥å£</h2>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">EnumWithInterface</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        System.out.println(<span class="hljs-string">"=== æšä¸¾å®ç°æ¥å£ ==="</span>);
        
        <span class="hljs-comment">// ä½¿ç”¨è®¡ç®—æ“ä½œæšä¸¾</span>
        <span class="hljs-type">Operation</span> <span class="hljs-variable">add</span> <span class="hljs-operator">=</span> Operation.PLUS;
        <span class="hljs-type">Operation</span> <span class="hljs-variable">subtract</span> <span class="hljs-operator">=</span> Operation.MINUS;
        
        System.out.println(<span class="hljs-string">"5 + 3 = "</span> + add.calculate(<span class="hljs-number">5</span>, <span class="hljs-number">3</span>));
        System.out.println(<span class="hljs-string">"5 - 3 = "</span> + subtract.calculate(<span class="hljs-number">5</span>, <span class="hljs-number">3</span>));
        System.out.println(<span class="hljs-string">"5 * 3 = "</span> + Operation.TIMES.calculate(<span class="hljs-number">5</span>, <span class="hljs-number">3</span>));
        System.out.println(<span class="hljs-string">"6 / 3 = "</span> + Operation.DIVIDE.calculate(<span class="hljs-number">6</span>, <span class="hljs-number">3</span>));
        
        <span class="hljs-comment">// ä½¿ç”¨æ”¯ä»˜æ–¹å¼æšä¸¾</span>
        System.out.println(<span class="hljs-string">"\n=== æ”¯ä»˜æ–¹å¼ ==="</span>);
        <span class="hljs-type">PaymentMethod</span> <span class="hljs-variable">alipay</span> <span class="hljs-operator">=</span> PaymentMethod.ALIPAY;
        <span class="hljs-type">PaymentMethod</span> <span class="hljs-variable">wechat</span> <span class="hljs-operator">=</span> PaymentMethod.WECHAT_PAY;
        
        alipay.pay(<span class="hljs-number">100.0</span>);
        wechat.pay(<span class="hljs-number">200.0</span>);
        
        System.out.println(<span class="hljs-string">"\n=== æ‰€æœ‰æ”¯ä»˜æ–¹å¼ ==="</span>);
        <span class="hljs-keyword">for</span> (PaymentMethod method : PaymentMethod.values()) {
            System.out.println(method.getName() + <span class="hljs-string">" - "</span> + method.getDescription());
        }
        
        <span class="hljs-comment">// ä½¿ç”¨æ—¥å¿—çº§åˆ«æšä¸¾</span>
        System.out.println(<span class="hljs-string">"\n=== æ—¥å¿—ç³»ç»Ÿ ==="</span>);
        <span class="hljs-type">LogLevel</span> <span class="hljs-variable">error</span> <span class="hljs-operator">=</span> LogLevel.ERROR;
        <span class="hljs-type">LogLevel</span> <span class="hljs-variable">info</span> <span class="hljs-operator">=</span> LogLevel.INFO;
        
        error.log(<span class="hljs-string">"æ•°æ®åº“è¿æ¥å¤±è´¥"</span>);
        info.log(<span class="hljs-string">"ç¨‹åºå¯åŠ¨æˆåŠŸ"</span>);
        
        <span class="hljs-comment">// æ ¹æ®æ—¥å¿—çº§åˆ«è·å–é¢œè‰²</span>
        System.out.println(<span class="hljs-string">"\n=== æ—¥å¿—çº§åˆ«é¢œè‰² ==="</span>);
        System.out.println(<span class="hljs-string">"ERRORçº§åˆ«é¢œè‰²: "</span> + error.getColor());
        System.out.println(<span class="hljs-string">"INFOçº§åˆ«é¢œè‰²: "</span> + info.getColor());
    }
}

<span class="hljs-comment">// è®¡ç®—æ¥å£</span>
<span class="hljs-keyword">interface</span> <span class="hljs-title class_">Calculator</span> {
    <span class="hljs-type">double</span> <span class="hljs-title function_">calculate</span><span class="hljs-params">(<span class="hljs-type">double</span> a, <span class="hljs-type">double</span> b)</span>;
}

<span class="hljs-comment">// è®¡ç®—æ“ä½œæšä¸¾å®ç°æ¥å£</span>
<span class="hljs-keyword">enum</span> <span class="hljs-title class_">Operation</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Calculator</span> {
    PLUS(<span class="hljs-string">"+"</span>) {
        <span class="hljs-meta">@Override</span>
        <span class="hljs-keyword">public</span> <span class="hljs-type">double</span> <span class="hljs-title function_">calculate</span><span class="hljs-params">(<span class="hljs-type">double</span> a, <span class="hljs-type">double</span> b)</span> {
            <span class="hljs-keyword">return</span> a + b;
        }
    },
    MINUS(<span class="hljs-string">"-"</span>) {
        <span class="hljs-meta">@Override</span>
        <span class="hljs-keyword">public</span> <span class="hljs-type">double</span> <span class="hljs-title function_">calculate</span><span class="hljs-params">(<span class="hljs-type">double</span> a, <span class="hljs-type">double</span> b)</span> {
            <span class="hljs-keyword">return</span> a - b;
        }
    },
    TIMES(<span class="hljs-string">"*"</span>) {
        <span class="hljs-meta">@Override</span>
        <span class="hljs-keyword">public</span> <span class="hljs-type">double</span> <span class="hljs-title function_">calculate</span><span class="hljs-params">(<span class="hljs-type">double</span> a, <span class="hljs-type">double</span> b)</span> {
            <span class="hljs-keyword">return</span> a * b;
        }
    },
    DIVIDE(<span class="hljs-string">"/"</span>) {
        <span class="hljs-meta">@Override</span>
        <span class="hljs-keyword">public</span> <span class="hljs-type">double</span> <span class="hljs-title function_">calculate</span><span class="hljs-params">(<span class="hljs-type">double</span> a, <span class="hljs-type">double</span> b)</span> {
            <span class="hljs-keyword">if</span> (b == <span class="hljs-number">0</span>) {
                <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArithmeticException</span>(<span class="hljs-string">"é™¤æ•°ä¸èƒ½ä¸º0"</span>);
            }
            <span class="hljs-keyword">return</span> a / b;
        }
    };
    
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> String symbol;
    
    Operation(String symbol) {
        <span class="hljs-built_in">this</span>.symbol = symbol;
    }
    
    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getSymbol</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> symbol;
    }
    
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">toString</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> symbol;
    }
}

<span class="hljs-comment">// æ”¯ä»˜æ–¹å¼æšä¸¾å®ç°æ¥å£</span>
<span class="hljs-keyword">enum</span> <span class="hljs-title class_">PaymentMethod</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Payment</span> {
    ALIPAY(<span class="hljs-string">"æ”¯ä»˜å®"</span>, <span class="hljs-string">"æ‰«ç æ”¯ä»˜ï¼Œæ–¹ä¾¿å¿«æ·"</span>) {
        <span class="hljs-meta">@Override</span>
        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">pay</span><span class="hljs-params">(<span class="hljs-type">double</span> amount)</span> {
            System.out.println(<span class="hljs-string">"ä½¿ç”¨æ”¯ä»˜å®æ”¯ä»˜: "</span> + amount + <span class="hljs-string">"å…ƒ"</span>);
            System.out.println(<span class="hljs-string">"è·³è½¬åˆ°æ”¯ä»˜å®é¡µé¢..."</span>);
            System.out.println(<span class="hljs-string">"æ”¯ä»˜æˆåŠŸï¼"</span>);
        }
    },
    WECHAT_PAY(<span class="hljs-string">"å¾®ä¿¡æ”¯ä»˜"</span>, <span class="hljs-string">"ç¤¾äº¤æ”¯ä»˜ï¼Œçº¢åŒ…åŠŸèƒ½"</span>) {
        <span class="hljs-meta">@Override</span>
        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">pay</span><span class="hljs-params">(<span class="hljs-type">double</span> amount)</span> {
            System.out.println(<span class="hljs-string">"ä½¿ç”¨å¾®ä¿¡æ”¯ä»˜: "</span> + amount + <span class="hljs-string">"å…ƒ"</span>);
            System.out.println(<span class="hljs-string">"æ‰“å¼€å¾®ä¿¡æ‰«ä¸€æ‰«..."</span>);
            System.out.println(<span class="hljs-string">"æ”¯ä»˜æˆåŠŸï¼"</span>);
        }
    },
    CREDIT_CARD(<span class="hljs-string">"ä¿¡ç”¨å¡"</span>, <span class="hljs-string">"ä¿¡ç”¨æ¶ˆè´¹ï¼Œåˆ†æœŸä»˜æ¬¾"</span>) {
        <span class="hljs-meta">@Override</span>
        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">pay</span><span class="hljs-params">(<span class="hljs-type">double</span> amount)</span> {
            System.out.println(<span class="hljs-string">"ä½¿ç”¨ä¿¡ç”¨å¡æ”¯ä»˜: "</span> + amount + <span class="hljs-string">"å…ƒ"</span>);
            System.out.println(<span class="hljs-string">"è¯·è¾“å…¥å¡å·å’Œå¯†ç ..."</span>);
            System.out.println(<span class="hljs-string">"æ”¯ä»˜æˆåŠŸï¼"</span>);
        }
    },
    BANK_TRANSFER(<span class="hljs-string">"é“¶è¡Œè½¬è´¦"</span>, <span class="hljs-string">"å¤§é¢æ”¯ä»˜ï¼Œå®‰å…¨å¯é "</span>) {
        <span class="hljs-meta">@Override</span>
        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">pay</span><span class="hljs-params">(<span class="hljs-type">double</span> amount)</span> {
            System.out.println(<span class="hljs-string">"ä½¿ç”¨é“¶è¡Œè½¬è´¦: "</span> + amount + <span class="hljs-string">"å…ƒ"</span>);
            System.out.println(<span class="hljs-string">"è¯·å‰å¾€é“¶è¡Œæˆ–ä½¿ç”¨ç½‘é“¶..."</span>);
            System.out.println(<span class="hljs-string">"è½¬è´¦æˆåŠŸï¼"</span>);
        }
    };
    
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> String name;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> String description;
    
    PaymentMethod(String name, String description) {
        <span class="hljs-built_in">this</span>.name = name;
        <span class="hljs-built_in">this</span>.description = description;
    }
    
    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getName</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> name;
    }
    
    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getDescription</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> description;
    }
}

<span class="hljs-comment">// æ”¯ä»˜æ¥å£</span>
<span class="hljs-keyword">interface</span> <span class="hljs-title class_">Payment</span> {
    <span class="hljs-keyword">void</span> <span class="hljs-title function_">pay</span><span class="hljs-params">(<span class="hljs-type">double</span> amount)</span>;
    String <span class="hljs-title function_">getName</span><span class="hljs-params">()</span>;
    String <span class="hljs-title function_">getDescription</span><span class="hljs-params">()</span>;
}

<span class="hljs-comment">// æ—¥å¿—çº§åˆ«æšä¸¾</span>
<span class="hljs-keyword">enum</span> <span class="hljs-title class_">LogLevel</span> {
    ERROR(<span class="hljs-number">40</span>, <span class="hljs-string">"é”™è¯¯"</span>, <span class="hljs-string">"\u001B[31m"</span>) {  <span class="hljs-comment">// çº¢è‰²</span>
        <span class="hljs-meta">@Override</span>
        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">log</span><span class="hljs-params">(String message)</span> {
            System.err.println(getColor() + <span class="hljs-string">"[ERROR] "</span> + message + <span class="hljs-string">"\u001B[0m"</span>);
        }
    },
    WARN(<span class="hljs-number">30</span>, <span class="hljs-string">"è­¦å‘Š"</span>, <span class="hljs-string">"\u001B[33m"</span>) {   <span class="hljs-comment">// é»„è‰²</span>
        <span class="hljs-meta">@Override</span>
        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">log</span><span class="hljs-params">(String message)</span> {
            System.out.println(getColor() + <span class="hljs-string">"[WARN]  "</span> + message + <span class="hljs-string">"\u001B[0m"</span>);
        }
    },
    INFO(<span class="hljs-number">20</span>, <span class="hljs-string">"ä¿¡æ¯"</span>, <span class="hljs-string">"\u001B[32m"</span>) {   <span class="hljs-comment">// ç»¿è‰²</span>
        <span class="hljs-meta">@Override</span>
        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">log</span><span class="hljs-params">(String message)</span> {
            System.out.println(getColor() + <span class="hljs-string">"[INFO]  "</span> + message + <span class="hljs-string">"\u001B[0m"</span>);
        }
    },
    DEBUG(<span class="hljs-number">10</span>, <span class="hljs-string">"è°ƒè¯•"</span>, <span class="hljs-string">"\u001B[36m"</span>) {  <span class="hljs-comment">// é’è‰²</span>
        <span class="hljs-meta">@Override</span>
        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">log</span><span class="hljs-params">(String message)</span> {
            System.out.println(getColor() + <span class="hljs-string">"[DEBUG] "</span> + message + <span class="hljs-string">"\u001B[0m"</span>);
        }
    };
    
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> level;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> String description;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> String color;
    
    LogLevel(<span class="hljs-type">int</span> level, String description, String color) {
        <span class="hljs-built_in">this</span>.level = level;
        <span class="hljs-built_in">this</span>.description = description;
        <span class="hljs-built_in">this</span>.color = color;
    }
    
    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getLevel</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> level;
    }
    
    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getDescription</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> description;
    }
    
    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getColor</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> color;
    }
    
    <span class="hljs-comment">// æŠ½è±¡æ–¹æ³•ï¼šæ¯ä¸ªæ—¥å¿—çº§åˆ«æœ‰è‡ªå·±çš„æ—¥å¿—æ–¹æ³•</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">log</span><span class="hljs-params">(String message)</span>;
    
    <span class="hljs-comment">// åˆ¤æ–­æ˜¯å¦åº”è¯¥è®°å½•</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">shouldLog</span><span class="hljs-params">(LogLevel threshold)</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>.level &gt;= threshold.level;
    }
}
</code></pre>
<h2 data-id="heading-8">äº”ã€å•ä¾‹æ¨¡å¼ä¸æšä¸¾</h2>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SingletonEnum</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        System.out.println(<span class="hljs-string">"=== æšä¸¾å®ç°å•ä¾‹æ¨¡å¼ ==="</span>);
        
        <span class="hljs-comment">// è·å–å•ä¾‹å®ä¾‹</span>
        <span class="hljs-type">DatabaseConnection</span> <span class="hljs-variable">connection1</span> <span class="hljs-operator">=</span> DatabaseConnection.INSTANCE;
        <span class="hljs-type">DatabaseConnection</span> <span class="hljs-variable">connection2</span> <span class="hljs-operator">=</span> DatabaseConnection.INSTANCE;
        
        <span class="hljs-comment">// æµ‹è¯•æ˜¯å¦æ˜¯åŒä¸€ä¸ªå®ä¾‹</span>
        System.out.println(<span class="hljs-string">"connection1 == connection2: "</span> + (connection1 == connection2));
        System.out.println(<span class="hljs-string">"connection1.equals(connection2): "</span> + connection1.equals(connection2));
        
        <span class="hljs-comment">// ä½¿ç”¨å•ä¾‹</span>
        connection1.connect();
        connection1.query(<span class="hljs-string">"SELECT * FROM users"</span>);
        connection1.disconnect();
        
        <span class="hljs-comment">// é…ç½®æ–‡ä»¶å•ä¾‹</span>
        System.out.println(<span class="hljs-string">"\n=== é…ç½®ç®¡ç†å™¨ ==="</span>);
        <span class="hljs-type">ConfigManager</span> <span class="hljs-variable">config1</span> <span class="hljs-operator">=</span> ConfigManager.INSTANCE;
        <span class="hljs-type">ConfigManager</span> <span class="hljs-variable">config2</span> <span class="hljs-operator">=</span> ConfigManager.INSTANCE;
        
        System.out.println(<span class="hljs-string">"config1 == config2: "</span> + (config1 == config2));
        
        config1.set(<span class="hljs-string">"app.name"</span>, <span class="hljs-string">"MyApp"</span>);
        config1.set(<span class="hljs-string">"app.version"</span>, <span class="hljs-string">"1.0.0"</span>);
        
        System.out.println(<span class="hljs-string">"app.name: "</span> + config2.get(<span class="hljs-string">"app.name"</span>));
        System.out.println(<span class="hljs-string">"app.version: "</span> + config2.get(<span class="hljs-string">"app.version"</span>));
        
        <span class="hljs-comment">// çº¿ç¨‹æ± å•ä¾‹</span>
        System.out.println(<span class="hljs-string">"\n=== çº¿ç¨‹æ± ç®¡ç†å™¨ ==="</span>);
        <span class="hljs-type">ThreadPoolManager</span> <span class="hljs-variable">pool</span> <span class="hljs-operator">=</span> ThreadPoolManager.INSTANCE;
        
        pool.execute(() -&gt; System.out.println(<span class="hljs-string">"ä»»åŠ¡1æ‰§è¡Œä¸­..."</span>));
        pool.execute(() -&gt; System.out.println(<span class="hljs-string">"ä»»åŠ¡2æ‰§è¡Œä¸­..."</span>));
        
        pool.shutdown();
    }
}

<span class="hljs-comment">// ä½¿ç”¨æšä¸¾å®ç°å•ä¾‹æ¨¡å¼ - çº¿ç¨‹å®‰å…¨ï¼Œé˜²æ­¢åå°„æ”»å‡»</span>
<span class="hljs-keyword">enum</span> <span class="hljs-title class_">DatabaseConnection</span> {
    INSTANCE;  <span class="hljs-comment">// å•ä¾‹å®ä¾‹</span>
    
    <span class="hljs-keyword">private</span> <span class="hljs-type">boolean</span> <span class="hljs-variable">isConnected</span> <span class="hljs-operator">=</span> <span class="hljs-literal">false</span>;
    
    <span class="hljs-comment">// ç§æœ‰æ„é€ æ–¹æ³•ï¼ˆæšä¸¾çš„æ„é€ æ–¹æ³•æœ¬æ¥å°±æ˜¯ç§æœ‰çš„ï¼‰</span>
    DatabaseConnection() {
        System.out.println(<span class="hljs-string">"æ•°æ®åº“è¿æ¥å®ä¾‹åˆ›å»º"</span>);
        <span class="hljs-comment">// åˆå§‹åŒ–è¿æ¥</span>
    }
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">connect</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">if</span> (!isConnected) {
            System.out.println(<span class="hljs-string">"è¿æ¥åˆ°æ•°æ®åº“..."</span>);
            isConnected = <span class="hljs-literal">true</span>;
        } <span class="hljs-keyword">else</span> {
            System.out.println(<span class="hljs-string">"å·²ç»è¿æ¥åˆ°æ•°æ®åº“"</span>);
        }
    }
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">disconnect</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">if</span> (isConnected) {
            System.out.println(<span class="hljs-string">"æ–­å¼€æ•°æ®åº“è¿æ¥"</span>);
            isConnected = <span class="hljs-literal">false</span>;
        } <span class="hljs-keyword">else</span> {
            System.out.println(<span class="hljs-string">"å·²ç»æ–­å¼€æ•°æ®åº“è¿æ¥"</span>);
        }
    }
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">query</span><span class="hljs-params">(String sql)</span> {
        <span class="hljs-keyword">if</span> (isConnected) {
            System.out.println(<span class="hljs-string">"æ‰§è¡ŒæŸ¥è¯¢: "</span> + sql);
        } <span class="hljs-keyword">else</span> {
            System.out.println(<span class="hljs-string">"è¯·å…ˆè¿æ¥åˆ°æ•°æ®åº“"</span>);
        }
    }
}

<span class="hljs-comment">// é…ç½®ç®¡ç†å™¨å•ä¾‹</span>
<span class="hljs-keyword">enum</span> <span class="hljs-title class_">ConfigManager</span> {
    INSTANCE;
    
    <span class="hljs-keyword">private</span> java.util.Map&lt;String, String&gt; config = <span class="hljs-keyword">new</span> <span class="hljs-title class_">java</span>.util.HashMap&lt;&gt;();
    
    ConfigManager() {
        <span class="hljs-comment">// åŠ è½½é»˜è®¤é…ç½®</span>
        config.put(<span class="hljs-string">"database.url"</span>, <span class="hljs-string">"jdbc:mysql://localhost:3306/mydb"</span>);
        config.put(<span class="hljs-string">"database.username"</span>, <span class="hljs-string">"root"</span>);
        config.put(<span class="hljs-string">"database.password"</span>, <span class="hljs-string">"password"</span>);
    }
    
    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">get</span><span class="hljs-params">(String key)</span> {
        <span class="hljs-keyword">return</span> config.get(key);
    }
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">set</span><span class="hljs-params">(String key, String value)</span> {
        config.put(key, value);
    }
    
    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">contains</span><span class="hljs-params">(String key)</span> {
        <span class="hljs-keyword">return</span> config.containsKey(key);
    }
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">remove</span><span class="hljs-params">(String key)</span> {
        config.remove(key);
    }
}

<span class="hljs-comment">// çº¿ç¨‹æ± ç®¡ç†å™¨å•ä¾‹</span>
<span class="hljs-keyword">enum</span> <span class="hljs-title class_">ThreadPoolManager</span> {
    INSTANCE;
    
    <span class="hljs-keyword">private</span> java.util.concurrent.ExecutorService executor;
    
    ThreadPoolManager() {
        <span class="hljs-comment">// åˆ›å»ºå›ºå®šå¤§å°çš„çº¿ç¨‹æ± </span>
        executor = java.util.concurrent.Executors.newFixedThreadPool(<span class="hljs-number">5</span>);
        System.out.println(<span class="hljs-string">"çº¿ç¨‹æ± åˆ›å»ºå®Œæˆ"</span>);
    }
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">execute</span><span class="hljs-params">(Runnable task)</span> {
        executor.execute(task);
    }
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">shutdown</span><span class="hljs-params">()</span> {
        executor.shutdown();
        System.out.println(<span class="hljs-string">"çº¿ç¨‹æ± å…³é—­"</span>);
    }
    
    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">isShutdown</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> executor.isShutdown();
    }
}
</code></pre>
<h2 data-id="heading-9">å…­ã€æšä¸¾åœ¨å®é™…é¡¹ç›®ä¸­çš„åº”ç”¨</h2>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> java.util.*;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">EnumInRealWorld</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        System.out.println(<span class="hljs-string">"=== æšä¸¾åœ¨å®é™…é¡¹ç›®ä¸­çš„åº”ç”¨ ==="</span>);
        
        <span class="hljs-comment">// ç”¨æˆ·æƒé™ç³»ç»Ÿ</span>
        System.out.println(<span class="hljs-string">"\n=== ç”¨æˆ·æƒé™ç³»ç»Ÿ ==="</span>);
        <span class="hljs-type">User</span> <span class="hljs-variable">user</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">User</span>(<span class="hljs-string">"å¼ ä¸‰"</span>, UserRole.ADMIN);
        user.displayPermissions();
        
        <span class="hljs-comment">// æ£€æŸ¥æƒé™</span>
        System.out.println(<span class="hljs-string">"\n=== æ£€æŸ¥æƒé™ ==="</span>);
        System.out.println(<span class="hljs-string">"å¯ä»¥ç®¡ç†ç”¨æˆ·å—ï¼Ÿ"</span> + user.canManageUsers());
        System.out.println(<span class="hljs-string">"å¯ä»¥åˆ é™¤æ•°æ®å—ï¼Ÿ"</span> + user.canDeleteData());
        
        <span class="hljs-comment">// åˆ›å»ºä¸åŒè§’è‰²çš„ç”¨æˆ·</span>
        <span class="hljs-type">User</span> <span class="hljs-variable">regularUser</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">User</span>(<span class="hljs-string">"æå››"</span>, UserRole.USER);
        <span class="hljs-type">User</span> <span class="hljs-variable">guest</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">User</span>(<span class="hljs-string">"ç‹äº”"</span>, UserRole.GUEST);
        
        regularUser.displayPermissions();
        guest.displayPermissions();
        
        <span class="hljs-comment">// è®¢å•ç³»ç»Ÿ</span>
        System.out.println(<span class="hljs-string">"\n=== è®¢å•ç³»ç»Ÿ ==="</span>);
        <span class="hljs-type">Order</span> <span class="hljs-variable">order</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Order</span>(<span class="hljs-string">"ORD001"</span>, <span class="hljs-number">299.99</span>);
        order.processOrder();
        
        <span class="hljs-comment">// æ¨¡æ‹Ÿè®¢å•çŠ¶æ€å˜åŒ–</span>
        order.setStatus(OrderStatus2.PAID);
        order.processOrder();
        
        order.setStatus(OrderStatus2.SHIPPED);
        order.processOrder();
        
        order.setStatus(OrderStatus2.DELIVERED);
        order.processOrder();
        
        <span class="hljs-comment">// å°è¯•å–æ¶ˆå·²å‘è´§çš„è®¢å•</span>
        <span class="hljs-type">boolean</span> <span class="hljs-variable">cancelled</span> <span class="hljs-operator">=</span> order.cancel();
        System.out.println(<span class="hljs-string">"å–æ¶ˆè®¢å•æˆåŠŸï¼Ÿ"</span> + cancelled);
        
        <span class="hljs-comment">// ä»»åŠ¡è°ƒåº¦ç³»ç»Ÿ</span>
        System.out.println(<span class="hljs-string">"\n=== ä»»åŠ¡è°ƒåº¦ç³»ç»Ÿ ==="</span>);
        <span class="hljs-type">TaskScheduler</span> <span class="hljs-variable">scheduler</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TaskScheduler</span>();
        
        <span class="hljs-type">Task</span> <span class="hljs-variable">task1</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Task</span>(<span class="hljs-string">"å¤‡ä»½æ•°æ®åº“"</span>, TaskPriority.HIGH);
        <span class="hljs-type">Task</span> <span class="hljs-variable">task2</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Task</span>(<span class="hljs-string">"å‘é€é‚®ä»¶"</span>, TaskPriority.MEDIUM);
        <span class="hljs-type">Task</span> <span class="hljs-variable">task3</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Task</span>(<span class="hljs-string">"æ¸…ç†æ—¥å¿—"</span>, TaskPriority.LOW);
        
        scheduler.addTask(task1);
        scheduler.addTask(task2);
        scheduler.addTask(task3);
        
        scheduler.executeTasks();
        
        <span class="hljs-comment">// æ˜¾ç¤ºæ‰€æœ‰ä»»åŠ¡</span>
        System.out.println(<span class="hljs-string">"\n=== æ‰€æœ‰ä»»åŠ¡ ==="</span>);
        scheduler.displayAllTasks();
    }
}

<span class="hljs-comment">// ç”¨æˆ·è§’è‰²æšä¸¾</span>
<span class="hljs-keyword">enum</span> <span class="hljs-title class_">UserRole</span> {
    ADMIN(<span class="hljs-string">"ç®¡ç†å‘˜"</span>, <span class="hljs-number">100</span>) {
        <span class="hljs-meta">@Override</span>
        <span class="hljs-keyword">public</span> List&lt;String&gt; <span class="hljs-title function_">getPermissions</span><span class="hljs-params">()</span> {
            <span class="hljs-keyword">return</span> Arrays.asList(<span class="hljs-string">"READ"</span>, <span class="hljs-string">"WRITE"</span>, <span class="hljs-string">"DELETE"</span>, <span class="hljs-string">"MANAGE_USERS"</span>, <span class="hljs-string">"CONFIGURE_SYSTEM"</span>);
        }
    },
    USER(<span class="hljs-string">"æ™®é€šç”¨æˆ·"</span>, <span class="hljs-number">50</span>) {
        <span class="hljs-meta">@Override</span>
        <span class="hljs-keyword">public</span> List&lt;String&gt; <span class="hljs-title function_">getPermissions</span><span class="hljs-params">()</span> {
            <span class="hljs-keyword">return</span> Arrays.asList(<span class="hljs-string">"READ"</span>, <span class="hljs-string">"WRITE"</span>);
        }
    },
    GUEST(<span class="hljs-string">"è®¿å®¢"</span>, <span class="hljs-number">10</span>) {
        <span class="hljs-meta">@Override</span>
        <span class="hljs-keyword">public</span> List&lt;String&gt; <span class="hljs-title function_">getPermissions</span><span class="hljs-params">()</span> {
            <span class="hljs-keyword">return</span> Arrays.asList(<span class="hljs-string">"READ"</span>);
        }
    };
    
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> String displayName;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> accessLevel;
    
    UserRole(String displayName, <span class="hljs-type">int</span> accessLevel) {
        <span class="hljs-built_in">this</span>.displayName = displayName;
        <span class="hljs-built_in">this</span>.accessLevel = accessLevel;
    }
    
    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getDisplayName</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> displayName;
    }
    
    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getAccessLevel</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> accessLevel;
    }
    
    <span class="hljs-comment">// æŠ½è±¡æ–¹æ³•ï¼šæ¯ä¸ªè§’è‰²æœ‰è‡ªå·±çš„æƒé™åˆ—è¡¨</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> List&lt;String&gt; <span class="hljs-title function_">getPermissions</span><span class="hljs-params">()</span>;
    
    <span class="hljs-comment">// æ£€æŸ¥å…·ä½“æƒé™</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">hasPermission</span><span class="hljs-params">(String permission)</span> {
        <span class="hljs-keyword">return</span> getPermissions().contains(permission);
    }
    
    <span class="hljs-comment">// å¸¸ç”¨æƒé™æ£€æŸ¥æ–¹æ³•</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">canRead</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> hasPermission(<span class="hljs-string">"READ"</span>);
    }
    
    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">canWrite</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> hasPermission(<span class="hljs-string">"WRITE"</span>);
    }
    
    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">canDelete</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> hasPermission(<span class="hljs-string">"DELETE"</span>);
    }
    
    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">canManageUsers</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> hasPermission(<span class="hljs-string">"MANAGE_USERS"</span>);
    }
}

<span class="hljs-comment">// ç”¨æˆ·ç±»</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">User</span> {
    <span class="hljs-keyword">private</span> String username;
    <span class="hljs-keyword">private</span> UserRole role;
    
    <span class="hljs-keyword">public</span> <span class="hljs-title function_">User</span><span class="hljs-params">(String username, UserRole role)</span> {
        <span class="hljs-built_in">this</span>.username = username;
        <span class="hljs-built_in">this</span>.role = role;
    }
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">displayPermissions</span><span class="hljs-params">()</span> {
        System.out.println(username + <span class="hljs-string">" ("</span> + role.getDisplayName() + <span class="hljs-string">") çš„æƒé™ï¼š"</span>);
        <span class="hljs-keyword">for</span> (String permission : role.getPermissions()) {
            System.out.println(<span class="hljs-string">"  - "</span> + permission);
        }
    }
    
    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">canManageUsers</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> role.canManageUsers();
    }
    
    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">canDeleteData</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> role.canDelete();
    }
    
    <span class="hljs-comment">// Getterå’ŒSetter</span>
    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getUsername</span><span class="hljs-params">()</span> { <span class="hljs-keyword">return</span> username; }
    <span class="hljs-keyword">public</span> UserRole <span class="hljs-title function_">getRole</span><span class="hljs-params">()</span> { <span class="hljs-keyword">return</span> role; }
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setRole</span><span class="hljs-params">(UserRole role)</span> { <span class="hljs-built_in">this</span>.role = role; }
}

<span class="hljs-comment">// è®¢å•çŠ¶æ€æšä¸¾ï¼ˆå¦ä¸€ç§å®ç°æ–¹å¼ï¼‰</span>
<span class="hljs-keyword">enum</span> <span class="hljs-title class_">OrderStatus2</span> {
    PENDING {
        <span class="hljs-meta">@Override</span>
        <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">canCancel</span><span class="hljs-params">()</span> { <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>; }
        <span class="hljs-meta">@Override</span>
        <span class="hljs-keyword">public</span> OrderStatus2 <span class="hljs-title function_">next</span><span class="hljs-params">()</span> { <span class="hljs-keyword">return</span> PAID; }
    },
    PAID {
        <span class="hljs-meta">@Override</span>
        <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">canCancel</span><span class="hljs-params">()</span> { <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>; }
        <span class="hljs-meta">@Override</span>
        <span class="hljs-keyword">public</span> OrderStatus2 <span class="hljs-title function_">next</span><span class="hljs-params">()</span> { <span class="hljs-keyword">return</span> PROCESSING; }
    },
    PROCESSING {
        <span class="hljs-meta">@Override</span>
        <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">canCancel</span><span class="hljs-params">()</span> { <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>; }
        <span class="hljs-meta">@Override</span>
        <span class="hljs-keyword">public</span> OrderStatus2 <span class="hljs-title function_">next</span><span class="hljs-params">()</span> { <span class="hljs-keyword">return</span> SHIPPED; }
    },
    SHIPPED {
        <span class="hljs-meta">@Override</span>
        <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">canCancel</span><span class="hljs-params">()</span> { <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>; }
        <span class="hljs-meta">@Override</span>
        <span class="hljs-keyword">public</span> OrderStatus2 <span class="hljs-title function_">next</span><span class="hljs-params">()</span> { <span class="hljs-keyword">return</span> DELIVERED; }
    },
    DELIVERED {
        <span class="hljs-meta">@Override</span>
        <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">canCancel</span><span class="hljs-params">()</span> { <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>; }
        <span class="hljs-meta">@Override</span>
        <span class="hljs-keyword">public</span> OrderStatus2 <span class="hljs-title function_">next</span><span class="hljs-params">()</span> { <span class="hljs-keyword">return</span> COMPLETED; }
    },
    COMPLETED {
        <span class="hljs-meta">@Override</span>
        <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">canCancel</span><span class="hljs-params">()</span> { <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>; }
        <span class="hljs-meta">@Override</span>
        <span class="hljs-keyword">public</span> OrderStatus2 <span class="hljs-title function_">next</span><span class="hljs-params">()</span> { <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>; }
    },
    CANCELLED {
        <span class="hljs-meta">@Override</span>
        <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">canCancel</span><span class="hljs-params">()</span> { <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>; }
        <span class="hljs-meta">@Override</span>
        <span class="hljs-keyword">public</span> OrderStatus2 <span class="hljs-title function_">next</span><span class="hljs-params">()</span> { <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>; }
    };
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">canCancel</span><span class="hljs-params">()</span>;
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> OrderStatus2 <span class="hljs-title function_">next</span><span class="hljs-params">()</span>;
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> OrderStatus2 <span class="hljs-title function_">fromString</span><span class="hljs-params">(String status)</span> {
        <span class="hljs-keyword">try</span> {
            <span class="hljs-keyword">return</span> valueOf(status.toUpperCase());
        } <span class="hljs-keyword">catch</span> (IllegalArgumentException e) {
            <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
        }
    }
}

<span class="hljs-comment">// è®¢å•ç±»</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">Order</span> {
    <span class="hljs-keyword">private</span> String orderId;
    <span class="hljs-keyword">private</span> <span class="hljs-type">double</span> amount;
    <span class="hljs-keyword">private</span> OrderStatus2 status;
    
    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Order</span><span class="hljs-params">(String orderId, <span class="hljs-type">double</span> amount)</span> {
        <span class="hljs-built_in">this</span>.orderId = orderId;
        <span class="hljs-built_in">this</span>.amount = amount;
        <span class="hljs-built_in">this</span>.status = OrderStatus2.PENDING;
    }
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">processOrder</span><span class="hljs-params">()</span> {
        System.out.println(<span class="hljs-string">"\nå¤„ç†è®¢å•: "</span> + orderId);
        System.out.println(<span class="hljs-string">"å½“å‰çŠ¶æ€: "</span> + status);
        System.out.println(<span class="hljs-string">"é‡‘é¢: "</span> + amount);
        
        <span class="hljs-keyword">switch</span> (status) {
            <span class="hljs-keyword">case</span> PENDING:
                System.out.println(<span class="hljs-string">"ç­‰å¾…æ”¯ä»˜..."</span>);
                <span class="hljs-keyword">break</span>;
            <span class="hljs-keyword">case</span> PAID:
                System.out.println(<span class="hljs-string">"è®¢å•å·²æ”¯ä»˜ï¼Œå‡†å¤‡å¤„ç†..."</span>);
                <span class="hljs-keyword">break</span>;
            <span class="hljs-keyword">case</span> PROCESSING:
                System.out.println(<span class="hljs-string">"è®¢å•å¤„ç†ä¸­..."</span>);
                <span class="hljs-keyword">break</span>;
            <span class="hljs-keyword">case</span> SHIPPED:
                System.out.println(<span class="hljs-string">"è®¢å•å·²å‘è´§..."</span>);
                <span class="hljs-keyword">break</span>;
            <span class="hljs-keyword">case</span> DELIVERED:
                System.out.println(<span class="hljs-string">"è®¢å•å·²é€è¾¾..."</span>);
                <span class="hljs-keyword">break</span>;
            <span class="hljs-keyword">case</span> COMPLETED:
                System.out.println(<span class="hljs-string">"è®¢å•å·²å®Œæˆ..."</span>);
                <span class="hljs-keyword">break</span>;
            <span class="hljs-keyword">case</span> CANCELLED:
                System.out.println(<span class="hljs-string">"è®¢å•å·²å–æ¶ˆ..."</span>);
                <span class="hljs-keyword">break</span>;
        }
        
        <span class="hljs-comment">// è‡ªåŠ¨æ¨è¿›åˆ°ä¸‹ä¸€ä¸ªçŠ¶æ€ï¼ˆå¦‚æœå¯èƒ½ï¼‰</span>
        <span class="hljs-keyword">if</span> (status.next() != <span class="hljs-literal">null</span>) {
            System.out.println(<span class="hljs-string">"è‡ªåŠ¨æ¨è¿›åˆ°ä¸‹ä¸€ä¸ªçŠ¶æ€..."</span>);
            status = status.next();
        }
    }
    
    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">cancel</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">if</span> (status.canCancel()) {
            status = OrderStatus2.CANCELLED;
            System.out.println(<span class="hljs-string">"è®¢å• "</span> + orderId + <span class="hljs-string">" å·²å–æ¶ˆ"</span>);
            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
        } <span class="hljs-keyword">else</span> {
            System.out.println(<span class="hljs-string">"è®¢å• "</span> + orderId + <span class="hljs-string">" å½“å‰çŠ¶æ€ä¸èƒ½å–æ¶ˆ"</span>);
            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
        }
    }
    
    <span class="hljs-comment">// Getterå’ŒSetter</span>
    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getOrderId</span><span class="hljs-params">()</span> { <span class="hljs-keyword">return</span> orderId; }
    <span class="hljs-keyword">public</span> <span class="hljs-type">double</span> <span class="hljs-title function_">getAmount</span><span class="hljs-params">()</span> { <span class="hljs-keyword">return</span> amount; }
    <span class="hljs-keyword">public</span> OrderStatus2 <span class="hljs-title function_">getStatus</span><span class="hljs-params">()</span> { <span class="hljs-keyword">return</span> status; }
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setStatus</span><span class="hljs-params">(OrderStatus2 status)</span> { <span class="hljs-built_in">this</span>.status = status; }
}

<span class="hljs-comment">// ä»»åŠ¡ä¼˜å…ˆçº§æšä¸¾</span>
<span class="hljs-keyword">enum</span> <span class="hljs-title class_">TaskPriority</span> {
    HIGH(<span class="hljs-number">1</span>, <span class="hljs-string">"é«˜"</span>, <span class="hljs-string">"\u001B[31m"</span>) {  <span class="hljs-comment">// çº¢è‰²</span>
        <span class="hljs-meta">@Override</span>
        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">execute</span><span class="hljs-params">()</span> {
            System.out.println(getColor() + <span class="hljs-string">"ç«‹å³æ‰§è¡Œé«˜ä¼˜å…ˆçº§ä»»åŠ¡"</span> + <span class="hljs-string">"\u001B[0m"</span>);
        }
    },
    MEDIUM(<span class="hljs-number">2</span>, <span class="hljs-string">"ä¸­"</span>, <span class="hljs-string">"\u001B[33m"</span>) {  <span class="hljs-comment">// é»„è‰²</span>
        <span class="hljs-meta">@Override</span>
        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">execute</span><span class="hljs-params">()</span> {
            System.out.println(getColor() + <span class="hljs-string">"å®‰æ’æ‰§è¡Œä¸­ä¼˜å…ˆçº§ä»»åŠ¡"</span> + <span class="hljs-string">"\u001B[0m"</span>);
        }
    },
    LOW(<span class="hljs-number">3</span>, <span class="hljs-string">"ä½"</span>, <span class="hljs-string">"\u001B[32m"</span>) {    <span class="hljs-comment">// ç»¿è‰²</span>
        <span class="hljs-meta">@Override</span>
        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">execute</span><span class="hljs-params">()</span> {
            System.out.println(getColor() + <span class="hljs-string">"ç©ºé—²æ—¶æ‰§è¡Œä½ä¼˜å…ˆçº§ä»»åŠ¡"</span> + <span class="hljs-string">"\u001B[0m"</span>);
        }
    };
    
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> level;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> String description;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> String color;
    
    TaskPriority(<span class="hljs-type">int</span> level, String description, String color) {
        <span class="hljs-built_in">this</span>.level = level;
        <span class="hljs-built_in">this</span>.description = description;
        <span class="hljs-built_in">this</span>.color = color;
    }
    
    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getLevel</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> level;
    }
    
    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getDescription</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> description;
    }
    
    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getColor</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> color;
    }
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">execute</span><span class="hljs-params">()</span>;
    
    <span class="hljs-comment">// æ¯”è¾ƒä¼˜å…ˆçº§</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">isHigherThan</span><span class="hljs-params">(TaskPriority other)</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>.level &lt; other.level;
    }
    
    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">isLowerThan</span><span class="hljs-params">(TaskPriority other)</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>.level &gt; other.level;
    }
}

<span class="hljs-comment">// ä»»åŠ¡ç±»</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">Task</span> {
    <span class="hljs-keyword">private</span> String name;
    <span class="hljs-keyword">private</span> TaskPriority priority;
    <span class="hljs-keyword">private</span> <span class="hljs-type">boolean</span> completed;
    
    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Task</span><span class="hljs-params">(String name, TaskPriority priority)</span> {
        <span class="hljs-built_in">this</span>.name = name;
        <span class="hljs-built_in">this</span>.priority = priority;
        <span class="hljs-built_in">this</span>.completed = <span class="hljs-literal">false</span>;
    }
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">execute</span><span class="hljs-params">()</span> {
        System.out.println(<span class="hljs-string">"æ‰§è¡Œä»»åŠ¡: "</span> + name);
        priority.execute();
        completed = <span class="hljs-literal">true</span>;
    }
    
    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getName</span><span class="hljs-params">()</span> { <span class="hljs-keyword">return</span> name; }
    <span class="hljs-keyword">public</span> TaskPriority <span class="hljs-title function_">getPriority</span><span class="hljs-params">()</span> { <span class="hljs-keyword">return</span> priority; }
    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">isCompleted</span><span class="hljs-params">()</span> { <span class="hljs-keyword">return</span> completed; }
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setPriority</span><span class="hljs-params">(TaskPriority priority)</span> { <span class="hljs-built_in">this</span>.priority = priority; }
}

<span class="hljs-comment">// ä»»åŠ¡è°ƒåº¦å™¨</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">TaskScheduler</span> {
    <span class="hljs-keyword">private</span> List&lt;Task&gt; tasks = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">addTask</span><span class="hljs-params">(Task task)</span> {
        tasks.add(task);
    }
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">executeTasks</span><span class="hljs-params">()</span> {
        <span class="hljs-comment">// æŒ‰ä¼˜å…ˆçº§æ’åºï¼ˆé«˜ä¼˜å…ˆçº§å…ˆæ‰§è¡Œï¼‰</span>
        tasks.sort(Comparator.comparingInt(t -&gt; t.getPriority().getLevel()));
        
        System.out.println(<span class="hljs-string">"å¼€å§‹æ‰§è¡Œä»»åŠ¡ï¼ˆæŒ‰ä¼˜å…ˆçº§æ’åºï¼‰:"</span>);
        <span class="hljs-keyword">for</span> (Task task : tasks) {
            <span class="hljs-keyword">if</span> (!task.isCompleted()) {
                task.execute();
            }
        }
    }
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">displayAllTasks</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">for</span> (Task task : tasks) {
            System.out.println(task.getName() + <span class="hljs-string">" - ä¼˜å…ˆçº§: "</span> + 
                             task.getPriority().getDescription() + 
                             <span class="hljs-string">" - å®Œæˆ: "</span> + (task.isCompleted() ? <span class="hljs-string">"æ˜¯"</span> : <span class="hljs-string">"å¦"</span>));
        }
    }
}
</code></pre>
<h2 data-id="heading-10">ä¸ƒã€æ€»ç»“</h2>
<h3 data-id="heading-11">7.1 æšä¸¾çš„ä¼˜åŠ¿</h3>
<ol>
<li><strong>ç±»å‹å®‰å…¨</strong>ï¼šç¼–è¯‘å™¨æ£€æŸ¥æšä¸¾å€¼æ˜¯å¦æœ‰æ•ˆ</li>
<li><strong>ä»£ç æ¸…æ™°</strong>ï¼šä½¿ç”¨æœ‰æ„ä¹‰çš„åç§°è€Œä¸æ˜¯é­”æ³•æ•°å­—</li>
<li><strong>æ˜“äºç»´æŠ¤</strong>ï¼šæ·»åŠ æ–°æšä¸¾å€¼ä¸ä¼šç ´åç°æœ‰ä»£ç </li>
<li><strong>çº¿ç¨‹å®‰å…¨</strong>ï¼šæšä¸¾å®ä¾‹æ˜¯çº¿ç¨‹å®‰å…¨çš„</li>
<li><strong>å•ä¾‹æ”¯æŒ</strong>ï¼šå¤©ç„¶æ”¯æŒå•ä¾‹æ¨¡å¼</li>
</ol>
<h3 data-id="heading-12">7.2 æšä¸¾çš„å¸¸è§ç”¨é€”</h3>
<ol>
<li><strong>çŠ¶æ€è¡¨ç¤º</strong>ï¼šè®¢å•çŠ¶æ€ã€ä»»åŠ¡çŠ¶æ€ã€ç”¨æˆ·çŠ¶æ€</li>
<li><strong>é…ç½®é€‰é¡¹</strong>ï¼šé¢œè‰²ã€å¤§å°ã€ç±»å‹</li>
<li><strong>é”™è¯¯ç </strong>ï¼šHTTPçŠ¶æ€ç ã€ä¸šåŠ¡é”™è¯¯ç </li>
<li><strong>æƒé™è§’è‰²</strong>ï¼šç”¨æˆ·è§’è‰²ã€è®¿é—®çº§åˆ«</li>
<li><strong>ç­–ç•¥æ¨¡å¼</strong>ï¼šä¸åŒçš„ç®—æ³•ç­–ç•¥</li>
</ol>
<h3 data-id="heading-13">7.3 æšä¸¾ vs å¸¸é‡</h3>



































<table><thead><tr><th>ç‰¹æ€§</th><th>æšä¸¾</th><th>å¸¸é‡ç±»</th></tr></thead><tbody><tr><td><strong>ç±»å‹å®‰å…¨</strong></td><td>âœ“ ç¼–è¯‘å™¨æ£€æŸ¥</td><td>âœ— åªæ˜¯æ•´æ•°æˆ–å­—ç¬¦ä¸²</td></tr><tr><td><strong>å‘½åç©ºé—´</strong></td><td>âœ“ æœ‰è‡ªå·±çš„å‘½åç©ºé—´</td><td>âœ— å…¨å±€å‘½åç©ºé—´</td></tr><tr><td><strong>æ–¹æ³•</strong></td><td>âœ“ å¯ä»¥æœ‰æ–¹æ³•å’Œå±æ€§</td><td>âœ— åªæ˜¯å€¼</td></tr><tr><td><strong>è¿­ä»£</strong></td><td>âœ“ å¯ä»¥éå†æ‰€æœ‰å€¼</td><td>âœ— éœ€è¦æ‰‹åŠ¨ç»´æŠ¤åˆ—è¡¨</td></tr><tr><td><strong>åºåˆ—åŒ–</strong></td><td>âœ“ å†…ç½®åºåˆ—åŒ–æ”¯æŒ</td><td>âœ— éœ€è¦æ‰‹åŠ¨å¤„ç†</td></tr></tbody></table>
<h3 data-id="heading-14">7.4 æšä¸¾çš„æœ€ä½³å®è·µ</h3>
<ol>
<li><strong>ä½¿ç”¨æœ‰æ„ä¹‰çš„åç§°</strong>ï¼š<code>RED</code>Â è€Œä¸æ˜¯Â <code>COLOR_1</code></li>
<li><strong>æ·»åŠ æè¿°ä¿¡æ¯</strong>ï¼šé€šè¿‡å±æ€§æˆ–æ–¹æ³•æä¾›æ›´å¤šä¿¡æ¯</li>
<li><strong>è€ƒè™‘ä½¿ç”¨æ¥å£</strong>ï¼šæšä¸¾å¯ä»¥å®ç°æ¥å£ï¼Œå¢åŠ çµæ´»æ€§</li>
<li><strong>é¿å…è¿‡åº¦ä½¿ç”¨</strong>ï¼šåªåœ¨å€¼å›ºå®šä¸”æœ‰é™æ—¶ä½¿ç”¨æšä¸¾</li>
<li><strong>ä½¿ç”¨valueOfæ—¶è¦å°å¿ƒ</strong>ï¼šå¯èƒ½æŠ›å‡º<code>IllegalArgumentException</code></li>
</ol>
<h3 data-id="heading-15">7.5 å¿«é€Ÿè®°å¿†å£è¯€</h3>
<ol>
<li><strong>æšä¸¾å®šä¹‰æœ‰é™å€¼</strong>Â â†’ åƒé€‰æ‹©é¢˜çš„é€‰é¡¹</li>
<li><strong>ç±»å‹å®‰å…¨ç¼–è¯‘å™¨æŸ¥</strong>Â â†’ æ¯”å¸¸é‡æ›´å®‰å…¨</li>
<li><strong>å±æ€§æ–¹æ³•éƒ½å¯ä»¥æœ‰</strong>Â â†’ ä¸åªæ˜¯ç®€å•å€¼</li>
<li><strong>å•ä¾‹æ¨¡å¼å¤©ç„¶æˆ</strong>Â â†’ çº¿ç¨‹å®‰å…¨å•ä¾‹</li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[React useState è§£è¯»]]></title>    <link>https://juejin.cn/post/7581297888808108082</link>    <guid>https://juejin.cn/post/7581297888808108082</guid>    <pubDate>2025-12-08T09:46:59.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581297888808108082" data-draft-id="7580940585692823590" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="React useState è§£è¯»"/> <meta itemprop="keywords" content="å‰ç«¯"/> <meta itemprop="datePublished" content="2025-12-08T09:46:59.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="äºŒäºŒå››ä¸€"/> <meta itemprop="url" content="https://juejin.cn/user/2975738274777080"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            React useState è§£è¯»
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2975738274777080/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    äºŒäºŒå››ä¸€
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-08T09:46:59.000Z" title="Mon Dec 08 2025 09:46:59 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»2åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252b3a}.markdown-body ::selection{color:#fff;background-color:#ed7373}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-bottom:.6em;margin-top:1.5em;padding-bottom:4px;color:#ed7373}.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px;padding-bottom:12px;border-bottom:1px solid #dfe1e6}.markdown-body h3{font-size:18px}.markdown-body h4{font-size:16px}.markdown-body h5,.markdown-body h6{font-size:14px}.markdown-body p{line-height:inherit;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border-top:1px solid #dfe1e6;margin:33px 0}.markdown-body code{word-break:break-word;overflow-x:auto;background-color:rgba(239,198,221,.2666666667);color:#7b164f;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace;border-radius:2px}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre:before{content:"";display:block;height:30px;width:100%;margin-bottom:-7px;background:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAAAdCAYAAABcz8ldAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAhgSURBVGhD7Zp7bBTHHcdn33t7vvOdzy+ITVKDU0xIKG2ABCPTRCCaUiEVKWoqRJuASAhCitRCVKSoalFUKZBiSmmFRRJKRUnUtIpo+aNqGgwoOCmuFUIRzxjwE4zte+97drYzztji8HPvtkit/PnH+n1397Tz+83vN/PbMZhmmmmm+d+BoX8n5diihcGqgFQf5vk6BMAskWUlw3GyFnIvtqWSf91w7mKC3npfOLX7wYeiIa6BBWCOLLFRF2NB0JvIOP/80YG+k2ev6S699b/OzOfKBW5l5KsgyC4DCFQDnpEAdE1goc/dlNPc/Up7P711UiYNSMuyxeUzZPnHgGHWh5XADEkSAcdiN+AnEXIBhBComgFU0/xQR+jnj51sOUMf9Z0NKyL8S9+JPBEN8zuCMrsqGOA5QWAAyzLAxe53HBeYFgJp1c5Cx33nyIfpV3e+22/Sx32nev/sMCgVnmM4bjOniAtZWQAsz315EfsGQQc4hgWcjHkCmOj1rheuNn95cXwmDMiVp5etC/D8m5FwUWVQUYYGPh6mZYFUOgsGVa1pXvOZzVT2jRuH54RM230jEuI3RcIiL4l4UkxAJmuD/riVsqD7ct2m9nep7BtVTbVfZ0uE/UIk+CQflAHDjf8+Lg6MldYATGpH3c/Ul7p3dWXppVGM6eElJSHmnQWPbSlRlN1lJcUBjqNRnwJZVQO3B5P/uq5rK1d90pakckFcaKp5UJHY92JR8YlwkUDVySEZfGfQdO7E7Z8s2HL9TSoXTPXRud9nA8IBqSwcZgWeqpPj6BYw7yTbXBN9q2v9lQEq5zBmWA8vWLCptCi4tzwW8RQMQlFQATPLSh6vCSh/plJBkMyQBHZfWYnkKRgEktEVpTJXERN2Xzo4ex2VC6K6qXYpF5b3ypVRT8EgcAERSJXRbwCBOTFzXblM5RxGBaRt+ZPYA+LO0mgxz5K1Ig+UgAzKIuGnz39z6S+olDeaibaXRsU1RUFvgx+GwTWgPCaDgMw2XXpr9gwq50XV0bkxJiYeEiNF5cwE5XsiOEkAUkXkUW51SSOVchjl8WKef604XFSRbzCGCYeCoESStv/p8QU1VPIM3knNDynctnBRfsEYhgSlNCIGgQv2UCkvGIHZgteMh1nBW9W4F16RAM6yDVV7amZTaYQcr59cuuhhWRTWBvAMLxQGeyFSHOLnh0MvUskz5RF+fbRYDEy0mZgqQYUHOLhr//b6rGoqeaLqQG0pw3PrBbyA+4EQUkRmhvgqNUfICUipKK4OKUqIJVPKB0jpEhjmWWp64jdbKmVZZNYogcJm493gsifOqhDyeh9GYR/FM7sW+DA5CKR0MSK3tvKZkpwB5gRE4tjFEr7RL0iWBGV51vHFCyupNGWWPqLgnoer9mtyEGSJAzwLllDTGzyznDjRN/CwOFkoFb4bm0eVIXICgpvdGoEvrF7fC89zfLkkeV5HbOhWiTwTpKYvCAJLGshRdXtKMKAWlyxq+MPQLk1h66g5RE5ABJYNFrqY3wvJklJRUKg5ZWLFXIA86yek2uDOPkBNb3CM5Pf7DL2QyIrUGiLH+xC5Bmmm/ARnHUhC6PnzxWDK0RH5HuIjZGy27erU9AZ0dTIWXyG+NpBBrSFySxZw220IqeUPFoS6jVAPNadM7yDsgNB1qOkLuAziMYIb1PQGA75wIaKGPyAb+9oF16g5RE5ALIQ+tSyLWoWDEAK6aXW3JlK9VJoyx1oyvVkNdvo5KXXDAVkdnaKmNwx0xjH98w3JNmTCm+Bc9hKVhsgJSI9pvp9Vdd++jmq6AXB2/HHrhcs5aTkVDv0DFzoHvKdq/mQsKX/4t7KJLDpOJW+IbAvMGoMkxfwAWZB8DT7W1diTE+WcgKz6pK1bs6z3daPwmJDsSKt6ZsCyjlLJMz0DsDGZ8SdlDROBjOb8YeWOjptU8kTXusuaazu7oJrfEnQvdkpVcUn6PTVHyAkIIW7br/Unklni0EJIZ1WgGsauZR+fvUglz6zY0dGfVp09ybRNlfwgi3k8YSbvJJ29VMoLt9v6rZVQL7hOYUubndHJGclBtzn1byqNMCogi09/2nFb01/oj+f/5TyjauBOKtPcZ1r7qZQ3f2lRfxZPWi2anp8TSDAGExZMa2jr8u03L1M5L7q3Xc+iAeuHRl/ScvPcjSLDBnZS/cjtNHd2v3171Ewbs9N5q7Pn4otVMx3btBsCsoRbk1FxG5dMVgMDqfTpXl1/tuFMa5zKefPROdX59qLQBwLnNog8Wy1OcjB1N+QEsW/QsFNZuO35Xb1v98QLX4/Sx+O3wqujrQ6013ABUWI8+AaqBjAH01+ghL22+5X2PirnMG7r+esbnae/V1neauvGSoHjigTcVU7UGFm2DeK4ttxKpQ+mLPvl+o/PjnkAkw9HTqSMmVHhyAMx9iFcSh/BHTfLceO/C8mKjApBf9zszGhoY92m9sN+BGOY9AeD7eGniv8OTaOB4dgyTsQd9wS+IQu4lciYdkI7CLrNH3Rvbb9FL41i0tbzVP2iWJkobpN5fmM4IJfJskTP1Bk8A9HQmbpmGDBrWqdVCN/Yd7PjxKGOXn+bmbto3feVVcVB9qehIL8EJy8nChwgr0O2xxBnhGU5eP2CfYbl/m4gBRsbtneMORP9oGpjpcCsiKzHHfdOPiQ/wMniyFEu2dbiTQCAeN/vavC466BGYLttXc9fmXBXMGlAhiHHur+sq6uPiUI9z7CVHMPwBnLSuuN8FuC48/Oaz1ylt94XfrW5ouyprwWfYRkwNyCyYYjwkBHows1fa+tV/fzGxlv39b9gqvfPmQ+i/HK8KlcBjhHwfl8HEHyOd1JnuzZd66S3TTPNNNP8/wDAfwDG7G0m9LKBpwAAAABJRU5ErkJggg==") 10px 10px no-repeat;background-size:40px;background-color:#fdf8f8}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#252b3a;background:#fdf8f8}.markdown-body a{position:relative;text-decoration:underline;text-decoration-color:#ffd4d4;color:#ed7373;padding-right:18px;padding-bottom:4px}.markdown-body a[href^=http]:after{position:absolute;display:inline-block;width:16px;height:16px;margin-left:2px;margin-top:6px;content:"";background:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMgAAADICAYAAACtWK6eAAAAAXNSR0IArs4c6QAAD1lJREFUeF7tnV122zgShQHJG5gT9/OkV2J7JR3voI/U707eI5/eQeyVRFlJa56nc2YDFjkHEulWHP3g5xZYAK5eku6QYOFWfSwUAJLW8EcFqMBJBSy1oQJU4LQCBITRQQXOKEBAGB5UgIAwBqhAnALMIHG68axGFCAgjTia3YxTgIDE6cazGlGAgDTiaHYzTgECEqcbz2pEAQLSiKPZzTgFCEicbjyrEQUISCOOZjfjFCAgcbrxrEYUICCNOJrdjFOAgMTpxrMaUYCANOJodjNOAQISpxvPakQBAtKIo9nNOAUISJxuPKsRBQhII45GdfN/v//+/l9//rlBtae9HQKi3UOZ7ft7sfhgjfm3sfa9u3RvzHtrjPv77r8PfpvemB0o1v3Z95tuNvt29fKyqQkgApI5ADVebgeFtTfGmA8I+3pj1rbv17Ouey4dFgKCiIgC2/i+WDwYax0QbzMDtDcjLC67/PL58xraeIbGCEgGkTVd4vty+QWVKUL75WCZb7f3JWUVAhLq5UKPHzLGRyXmP822208lgEJAlESMlBlDfeGyhsafelAIiMawAdjkpmO38/kXa8wtoDnRJvq+v79+fHwSvUhk4wQkUjjNp/33jz9uZ33/VbONP9nW9x/fPT5+0mYzAdHmkUR7lNUaob1RN+QiIKEuVHz838vl1xKGVOck1DbTRUAUB7yvaSXVG5592sy22zsNs1wExNNjWg+rEI5XqWfb7a9TQ0JAtEa+h101wzF0f/JMQkA8AlHjIQ3AMco+KSQERGP0X7CpITj2Skw4BUxACgOkOThG/0wECQEpCJBm4Rh81Fl7l3tHMAEpBJCJ4Hjq+/7bvOt229THGSVny8vV1W6b/Kzrbnprb088VAVXN/fMFgGBuxDfYE443L4oB0TM9OqwxcVtjJR7xiTzUIuA4OMZ2mI2OICBN+wgfpACJWcWISDQcMY2lgMOt7XjerW6w1q+b03sqUUgzJf6TUAuKTTRv+eAI8f0qdSwK1cWISATAXDusjngyDkj5PrTzedu+z2uNsmURQiIMkBqg2OUVwKSHFmEgCgCpFY4xCDJkEUIiBJAaodjlBlZuEtOMIz2EhAFgLQCxxtIIG9YkR5mEZCJAWkNjldIlsu/EEW79AsfCMiEgLQKx8EaCSKLPL1bre6l3EhApJS90G7LcKCziOQwi4BMAAjh+GGlPTmLSK7pEJDMgBCOfwRHvb9Lsg4hIBkBIRw/i/0dUawLrocQkEyAEI7jQoPeNi9WqBOQDIAQjtMig16uTUAyxLHIJQjHeVkRdYjkijoziAgW+0YJx2VxEYAYYzbvVqtfL18t/AgCEq6Z1xmEw0um3U2km8/dqnrS791qJRLLIo0m9bSCkwmHvxNBgDCD+Es+7ZGEI0x/DrHC9Cr6aMIR7j7ELBaL9HDds59BOOIkB33wh9O8cfLnOYtwxOsM+egPV9LjHSB9JuFIU/j7ctmntSD7cmvOYiV6B3IHPGOD5E7VxK4nnw4q0A03Kya7QqYBwpGmK6j+MFJrIK53zCCRPgZtsjt59Zozh+s0aP3DNSW2BkJAIuFATE2eu3TtcLi+w24wggU6AYkABDVuPnXpFuAAZg8jrReHWAGQIB177LLSzg7oqtih4Dcsig6vmEECw0CyKG8BDic3VEPh4RUBCQAENePSaubY1R2LxYOxNvklDa8aEpCACBY+FLKgdcTGZjLHYvHBWuu+PoX6iQ+vmEE8XQW/8w3XJRyeDjhymOTi4OHlWKRf8JFUYU444uGQXvsgIAG+kcgesXAM6y83/fAhGtv36242+5b708i+8kmtF+XKHhxiTZA9YuDwCLSn2Xb7KebLtL7BHnqch82hTY7HZ6k9xotxiHXGTejsEQXHcvnVGnPrEU2b2XZ7pwESQTjEFwbf6kxAzgGCeOvf2H7ElGQMoDmHH8ekk4RD8snBU2FAQE4oAy7Og594S7p+BIweGeriIZJw5CzMWaRfdDV0UStqzByTPX7oVt9/nHXdc64hV41wsEjPMLyKqTucWZAtGZkyiTAc2esOZpBMs1cpY2bIW89dP4UhkYZj6pqKNcgRWFBb2lO+fAQDxBiTYse5e4k0HMaY4NrNY/QcdAgBOSJX8vjf3biNWV+vVndB3jg4GPZA0b5N+BSwNByp+sXqzmleD+UQgMTWHqN5AgEIg0TAtrdemTxzjAYxgxzLIMul23X6wYOlU4dEzVy9bQw5zNq1DahHpOGYuuZgBvGI+uQZJEAgOjOHWsjB+t7DbK9DUgIQkVnPGZmadb0ECDyIGeR4Bkl6mRnS0WhIYsf2LcLhQoOACACCfk8T+Dnu4BetJa3qe9yxkTcUj8sFHUJAjgPiPugSO6yB1B9vzUJCEppFBLPHprP2Xut2fWaQE/eSxOJYBJDR1ETbXnscUosk12THdVYPBwE5AUhiQIgCAswk3tO+As/ji2oUNIa6cDCHWOBp3tDhS4wzUZD4ZhEkIDn0idH01DkEBAyIaw5dpB9zHqgu8FqQgw3rEncXIAPft60qAXF32JRt3qnBJ7X36a1TUwPX926O2Pbiey3fwM11XBWADGsFv5n9o6m72SfnkJ2Iff98/fj4FCJo6mpxrmnLVJCdJj4wp+pRKhxVFOmeBXXwSw2S7s6glXQfqJPs3N0/+nufG0jCdbyGcT59neKYYjNIxKfPvGdtnCM8wTvpM587M8LhgOGPVwDHTAz4wofQQaqNIgGJgGOvX8CdPXVYEXKtFOcm2+k5zHI2hmx7yTXMTNHO59ziAEne9uAJCeChqaCM5eOsY8cA7PSqQw6vPWSt13rvjV1PnbXPmlfHQ7QuChBEMIQUjAnj7uCMFeI09GxW7N1+54+uuxkmRf4z77p1yuxhigZS5xYDCAKOUUTfdQrELFGOoVZqvRQLiFRQamq3CECQcPhObY5OSs4iATNFsYGRamMNxXSsdpfOUw8IGg4nSMgdE5JFhCEhIJfCPP7fVQOCmKE5Ik3wRrnUABxtkLpTJ9vnOXERH2blnqkWECE4ot42gsoiodnLN6wAmwm91kJ87anpOJWAABa/Tvso8m6ZfJf+xyLo9G/ytPduCqr/+O7x8VNNgY3qizpAROEwJnh4NQodskh20TnAgITUaEB7Lva9sANUAZI6XXlB++Q7N3KohdqKgrApZNKisPhONlcNIMJwBM1cnVMVEZDIWgShGwrW5GhU2IAKQBBOPqct+g4JqUcAwxpI/ZHpAS+Fse9l0qSARG869Ora/iA0HK7NmJ2tP5kMAASUzaLrsgA3FHvopICUljkOvZwKCQJcRCYL2ZtWbJQnGD4ZICXDMeo93MHdO3yD36Hlux/slG8hs1ec4r2IziSAgIYGJzuHuDtfVG44IGr6FzG8An1gNKdWvppqOi47ILA73wkVp3B4ICTJY37gDSbZFk3BLGFLVkBQsy6nhJgCjtEWn5oEMd6HagjIZBJBqanNbIBAHXtEwSnhODRn2EP2MPy/sTaBPWWHrN20aKYJiLe2ZANEcguJVkenvp/rrbOQcEz13XHNMByzLQsgktlDKxzoQADWHXvTOLzyclEWQMB3vteOtQKHxNZ/bi/x4kP+AzpS2YNw+Dn46FHMHt7iiWcQiexBOLz9e+xATu0GyCcKiMSaB+EI8O6xQ5k9ggQUBQSxV+iwN4QjyLfMHslyCX7EE157NHLnkyjIxziRemkEIA7VNiGWQcDTkk28VEAUjgI/XqOBGjFAgMV5E0WlJBxcFIxHTQQQ5PCqhbpDGo7ZdntX2ztz40M+7EwRQICzV9VnD2E4RJ6oDAuxso8WAQRVf9S+2isNB4vydDhlAFku+3TT4t9hBbi2eBPScBhjmpjYkHaUXkAqntaVhgPx3Il04JXSPhwQVIFe6/CKcJSCxt5OrYBUWZwTjrLgEAEEMYNV4xCBcJQHhwggoECoqsAEaXIywmq8oWjBCT7EgkzxVlSgEw4toR5nBwGJ083rLMLhJZPqg/CALJdfjDHubYPxvwoyCOGId7+mM+GAgAKj6BoEpAFrDgWkqASk5KKTcCiIaqAJcEBanuYlHMDIVNIUHJBWV9IJh5KIBpsBB8TZB/gssSlpJyrhAEelouakAPkr5psZb3QpolAnHIqiWcAUEUBQj9tq37BIOAQiUlmTMoAsFh+stW49JO2neD2EcKS5tpSzRQBBzGSNAmrMIoSjlPBOt1MEkKFQR9Qh6t5CTjjSg66kFiQBSd9yMiqpZKhFOEoKbYytYoAgh1muq1MPtQgHJuBKa0UMEOgwa6/qZqr3OxGO0sIaZ68sIIvFg7H2I87c/JBAnm85I0DJ+86AflXblCggAlkkayZBreec8j7hUMvFq2HygOCzyM54ya0obj/Zdj7/Yo25lXIh4ZBSFtuuOCBCWWQPiTHr+XZ7j3zvrHS9Mdp9vVrdYV3J1iQUyAOIUBY5EORptt1+SgFlAMN933z8trmE3juoCYeItCKNZgFEMoscquKCz/b9etZ1zz6wDFDcmP1QShQMZg6R+BVvNBsgw7qIWzwUD8RBtU1vzMb93Q5/DkH63u5tyGXH63CQmUM8nuEXyAbILovID7XgAiEa5LAKoeI0bWQFpEVICMc0gY26anZActUjKIFS2iEcKerpOHcSQIbn1r/mrgNySk44cqotd61JAHHdqRkSwiEXsLlbngwQ19EJZrbE9SUc4hJnvcCkgFQHiZLnVrJGUOUXmxyQUV/pjYHSfmzhc9XSGmpsXw0gBU8Bbzpr73/5/Hmt0cG0KU0BVYAcQOLeDp91pTtGRtYbMaqVdY46QMa6xPb9g+R282Q3sd5IlrCEBlQCMgqndJariDc+lhB8JdioGpDXAn7/IjrxregXHJa8pb6EgKCNPypQBCATg0IwGqamKEB+GHp13U1v7a3Q1vWnvu+/XT8+PjUcG+z6/lGJ8n+uVhmK+nHmK2QGzD0zsnZAzLtu7fOgVfmKsQe+ClQByLHOur1eL1dXO1Bs170C089mm6uXl92DVITBN0zaPa5aQNp1KXuOVICAINVkW9UpQECqcyk7hFSAgCDVZFvVKUBAqnMpO4RUgIAg1WRb1SlAQKpzKTuEVICAINVkW9UpQECqcyk7hFSAgCDVZFvVKUBAqnMpO4RUgIAg1WRb1SlAQKpzKTuEVICAINVkW9UpQECqcyk7hFSAgCDVZFvVKUBAqnMpO4RUgIAg1WRb1SlAQKpzKTuEVICAINVkW9UpQECqcyk7hFTg//8JNVC78ovQAAAAAElFTkSuQmCC");background-size:100%}.markdown-body a:active,.markdown-body a:hover{opacity:.66}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #ed7373;border-spacing:0}.markdown-body thead{color:#fff;text-align:left}.markdown-body thead tr{background:#ed7373}.markdown-body thead th{border-bottom:1px solid #dfe1e6}.markdown-body tr{background-color:#fff}.markdown-body tr:nth-child(2n){background-color:#fdf2f2}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#252b3a;padding:1px 23px;margin:22px 0;border-left:4px solid #ed7373;background-color:#fdf2f2}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{padding-left:10px;margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol li::marker,.markdown-body ul li::marker{color:#ed7373}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}.markdown-body input[type=checkbox]{appearance:none;-webkit-appearance:none;-moz-appearance:none;outline:none;width:16px;height:16px;border-radius:2px;background-color:transparent;box-shadow:inset 0 0 0 1px rgba(28,31,35,.3490196078);vertical-align:middle;margin:0;transform:translateY(-2px)}.markdown-body input[type=checkbox]:checked{background-color:#ed7373;background-image:url("data:image/svg+xml;base64,PHN2ZyB2aWV3Qm94PSIwIDAgMjQgMjQiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgd2lkdGg9IjFlbSIgaGVpZ2h0PSIxZW0iIGFyaWEtaGlkZGVuPSJ0cnVlIj48cGF0aCBmaWxsLXJ1bGU9ImV2ZW5vZGQiIGNsaXAtcnVsZT0iZXZlbm9kZCIgZD0iTTE3LjQxMSA3LjMwOGExLjUgMS41IDAgMDEuMjggMi4xMDNsLTYuNSA4LjVhMS41IDEuNSAwIDAxLTIuMzc1LjAxbC0zLjUtNC41YTEuNSAxLjUgMCAxMTIuMzY4LTEuODQybDIuMzA2IDIuOTY1IDUuMzE4LTYuOTU1YTEuNSAxLjUgMCAwMTIuMTAzLS4yOHoiIGZpbGw9IiNmZmYiLz48L3N2Zz4=");box-shadow:inset 0 0 0 1px #ed7373}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="atom-one-dark">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#abb2bf;background:#282c34}.hljs-comment,.hljs-quote{color:#5c6370;font-style:italic}.hljs-doctag,.hljs-formula,.hljs-keyword{color:#c678dd}.hljs-deletion,.hljs-name,.hljs-section,.hljs-selector-tag,.hljs-subst{color:#e06c75}.hljs-literal{color:#56b6c2}.hljs-addition,.hljs-attribute,.hljs-meta-string,.hljs-regexp,.hljs-string{color:#98c379}.hljs-built_in,.hljs-class .hljs-title{color:#e6c07b}.hljs-attr,.hljs-number,.hljs-selector-attr,.hljs-selector-class,.hljs-selector-pseudo,.hljs-template-variable,.hljs-type,.hljs-variable{color:#d19a66}.hljs-bullet,.hljs-link,.hljs-meta,.hljs-selector-id,.hljs-symbol,.hljs-title{color:#61aeee}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}.hljs-link{text-decoration:underline}</style><h2 data-id="heading-0">ğŸ§  01ï½œuseState æœ¬è´¨ï¼šReact ç»™ä½ åˆ†é…â€œçŠ¶æ€æ§½ä½â€</h2>
<p>useState ä¼šåœ¨å½“å‰ç»„ä»¶çš„ Fiber ä¸Šåˆ†é…ä¸€ä¸ª Hook èŠ‚ç‚¹ï¼Œç”¨æ¥å­˜å‚¨çŠ¶æ€å’Œæ›´æ–°é˜Ÿåˆ—ã€‚æ¯æ¬¡æ¸²æŸ“ä¸­ï¼ŒReact æŒ‰å›ºå®šé¡ºåºè¯»å–è¿™äº›èŠ‚ç‚¹ï¼Œå› æ­¤ä½ æ€»èƒ½æ‹¿åˆ°æ­£ç¡®çš„æœ€æ–° stateã€‚</p>
<p>æ ¸å¿ƒå…³é”®ç‚¹å¦‚ä¸‹ğŸ‘‡</p>
<h3 data-id="heading-1">1. å‡½æ•°ç»„ä»¶æ¯æ¬¡æ¸²æŸ“éƒ½æ˜¯â€œé‡æ–°æ‰§è¡Œâ€</h3>
<p>ç»„ä»¶é‡Œå†™çš„ï¼š</p>
<pre><code class="hljs language-scss" lang="scss">const <span class="hljs-selector-attr">[count, setCount]</span> = <span class="hljs-built_in">useState</span>(<span class="hljs-number">0</span>);
</code></pre>
<p>æ¯æ¬¡æ¸²æŸ“éƒ½ä¼šæ‰§è¡Œä¸€æ¬¡ã€‚ä½† <strong>state ä¸å­˜æ”¾åœ¨å‡½æ•°é‡Œ</strong>ï¼Œè€Œå­˜åœ¨ Fiber ç»“æ„é‡Œã€‚</p>
<h3 data-id="heading-2">2. æ¯ä¸ªç»„ä»¶ Fiber éƒ½ç»´æŠ¤ä¸€ä¸ª hooks é“¾è¡¨</h3>
<p>å¯ä»¥æƒ³è±¡æˆè¿™æ ·ï¼š</p>
<pre><code class="hljs language-scss" lang="scss">Fiber
 â””â”€ memoizedState
       â”œâ”€ HookNode1  (å¯¹åº”ç¬¬ä¸€ä¸ª useState)
       â”œâ”€ HookNode2  (å¯¹åº”ç¬¬äºŒä¸ª useState)
       â””â”€ ...
</code></pre>
<p>React æ¯æ¬¡è°ƒç”¨ Hook æ—¶ï¼Œä¼šæ²¿ç€é“¾è¡¨èµ°ä¸€ä¸ªèŠ‚ç‚¹ã€‚</p>
<h3 data-id="heading-3">3. setState åªæ˜¯æŠŠæ›´æ–°â€œå…¥é˜Ÿâ€</h3>
<p>æ¯ä¸ª HookNode éƒ½æœ‰ä¸ª update queueï¼š</p>
<pre><code class="hljs language-arduino" lang="arduino">queue: [update1, update2, ...]
</code></pre>
<p>ä¸‹ä¸€æ¬¡æ¸²æŸ“å‰ï¼ŒReact ä¼šæŠŠè¿™äº›æ›´æ–°ä¾æ¬¡åº”ç”¨ï¼Œç„¶åå†è¿”å›æœ€æ–°å€¼ã€‚</p>
<h3 data-id="heading-4">4. ä¸èƒ½åœ¨æ¡ä»¶ä¸­ä½¿ç”¨hook</h3>
<p>å› ä¸ºæ¯æ¬¡æ¸²æŸ“ React éƒ½æ˜¯æŒ‰é¡ºåºâ€œèµ°é“¾è¡¨â€ï¼š</p>
<p>ç¬¬ä¸€æ¬¡ï¼š</p>
<pre><code class="hljs language-css" lang="css">useState <span class="hljs-selector-tag">A</span> â†’ èŠ‚ç‚¹<span class="hljs-number">1</span>
useState <span class="hljs-selector-tag">B</span> â†’ èŠ‚ç‚¹<span class="hljs-number">2</span>
</code></pre>
<p>ç¬¬äºŒæ¬¡å¦‚æœä½ å†™äº†æ¡ä»¶åˆ†æ”¯å¯¼è‡´ B ä¸æ‰§è¡Œï¼š</p>
<pre><code class="hljs language-css" lang="css">useState <span class="hljs-selector-tag">A</span> â†’ èŠ‚ç‚¹<span class="hljs-number">1</span>
</code></pre>
<p>React å°±ä¼šæŠŠèŠ‚ç‚¹2 çš„çŠ¶æ€é”™è¯»ä¸ºèŠ‚ç‚¹1ï¼ŒçŠ¶æ€ç›´æ¥ä¹±å¥—ã€‚</p>
<blockquote>
<p><strong>Hook é¡ºåºå¿…é¡»å›ºå®šæ‰èƒ½ä¿è¯å–åˆ°æ­£ç¡®çš„ stateã€‚</strong></p>
</blockquote>
<h2 data-id="heading-5">ğŸ” 02ï½œuseState çš„å‚æ•°ä¸è¿”å›å€¼ï¼ˆTypeScript æ€ç»´ï¼‰</h2>
<pre><code class="hljs language-php" lang="php"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">useState</span>&lt;<span class="hljs-title">S</span>&gt;(<span class="hljs-params">
  initialState: S | (<span class="hljs-params">(<span class="hljs-params"/>) =&gt; S</span>)
</span>): [<span class="hljs-title">S</span>, (<span class="hljs-params">update: S | (<span class="hljs-params">(<span class="hljs-params">prev: S</span>) =&gt; S</span>)</span>) =&gt;</span> <span class="hljs-keyword">void</span>]
</code></pre>
<ul>
<li>initialState æ”¯æŒæ‡’åˆå§‹åŒ–å‡½æ•°ï¼ˆåªåœ¨é¦–æ¬¡æ‰§è¡Œï¼‰</li>
<li>setState æ”¯æŒä¸¤ç§æ›´æ–°æ–¹å¼ï¼šç›´æ¥å€¼ã€æ›´æ–°å‡½æ•°</li>
</ul>
<p>â‘  ç›´æ¥å€¼</p>
<pre><code class="hljs language-scss" lang="scss">const <span class="hljs-selector-attr">[count, setCount]</span> = <span class="hljs-built_in">useState</span>(<span class="hljs-number">0</span>);
</code></pre>
<ul>
<li>ç±»å‹æ˜¯ä½ ä¼ å…¥çš„å€¼ç±»å‹ï¼Œæ¯”å¦‚ <code>0</code> â†’ numberï¼Œ<code>"abc"</code> â†’ stringã€‚</li>
<li>æ¯æ¬¡ç»„ä»¶é‡æ–°æ¸²æŸ“æ—¶ï¼Œè¿™ä¸ªå€¼ä¸ä¼šå†è¢«è®¡ç®—ä¸€æ¬¡ã€‚</li>
<li>å¦‚æœåˆå§‹å€¼è®¡ç®—å¼€é”€å¤§ï¼Œæ¯æ¬¡æ¸²æŸ“ç›´æ¥å†™è®¡ç®—å¼å¯èƒ½æ€§èƒ½ä¸ä½³ã€‚</li>
</ul>
<p>â‘¡ æ‡’åˆå§‹åŒ–å‡½æ•°ï¼ˆlazy initializerï¼‰</p>
<pre><code class="hljs language-scss" lang="scss">const <span class="hljs-selector-attr">[data, setData]</span> = <span class="hljs-built_in">useState</span>(() =&gt; <span class="hljs-built_in">expensiveComputation</span>());
</code></pre>
<ul>
<li>å‡½æ•°åªåœ¨ç¬¬ä¸€æ¬¡æ¸²æŸ“è°ƒç”¨ï¼Œè¿”å›å€¼ä½œä¸ºåˆå§‹ stateã€‚</li>
<li>å¥½å¤„ï¼šå»¶è¿Ÿè®¡ç®—å¼€é”€ï¼Œé¿å…æ¯æ¬¡æ¸²æŸ“éƒ½æ‰§è¡Œå¤æ‚é€»è¾‘ã€‚</li>
</ul>
<h2 data-id="heading-6">ğŸ§© 03ï½œstate çš„ç‰¹ç‚¹</h2>
<p><strong>è‡ªåŠ¨æ‰¹å¤„ç†</strong></p>
<p>React ä¼šè‡ªåŠ¨æ‰¹å¤„ç†ï¼ˆbatchï¼‰ï¼Œå¤šä¸ª setState â†’ åªæ¸²æŸ“ä¸€æ¬¡ï¼ˆè§†ç‰ˆæœ¬å’Œç¯å¢ƒè€Œå®šï¼‰</p>
<p><strong>æ›¿æ¢éåˆå¹¶</strong></p>
<p>useState æ˜¯â€œæ›¿æ¢â€ï¼Œä¸åƒ class setState é‚£æ ·â€œåˆå¹¶â€</p>
<p>å¯¹è±¡å¿…é¡»æ‰‹åŠ¨å±•å¼€ï¼š</p>
<pre><code class="hljs language-ini" lang="ini">setForm(<span class="hljs-attr">prev</span> =&gt; ({ ...prev, name: <span class="hljs-string">'xx'</span> }))<span class="hljs-comment">;</span>
</code></pre>
<p><strong>å‡½æ•°å¼æ›´æ–°å¯ä»¥é¿å…è¯»åˆ°æ—§å€¼</strong></p>
<pre><code class="hljs language-ini" lang="ini">setCount(<span class="hljs-attr">c</span> =&gt; c + <span class="hljs-number">1</span>)<span class="hljs-comment">;</span>
</code></pre>
<h2 data-id="heading-7">ğŸ“¦ 04ï½œmini-hooks</h2>
<pre><code class="hljs language-ini" lang="ini">let <span class="hljs-attr">currentFiber</span> = null<span class="hljs-comment">;</span>

// æ¸²æŸ“å…¥å£
function render(component) {
  <span class="hljs-attr">currentFiber</span> = component.fiber<span class="hljs-comment">;</span>
  <span class="hljs-attr">currentFiber.hookIndex</span> = <span class="hljs-number">0</span><span class="hljs-comment">;</span>

  if (!currentFiber.hooks) {
    <span class="hljs-attr">currentFiber.hooks</span> = []<span class="hljs-comment">;</span>
    <span class="hljs-attr">currentFiber.isMount</span> = <span class="hljs-literal">true</span><span class="hljs-comment">;</span>
  } else {
    <span class="hljs-attr">currentFiber.isMount</span> = <span class="hljs-literal">false</span><span class="hljs-comment">;</span>
  }

  const <span class="hljs-attr">result</span> = component()<span class="hljs-comment">;</span>
  console.log("Rendered:", result)<span class="hljs-comment">;</span>
  return result<span class="hljs-comment">;</span>
}

// åˆ›å»ºç»„ä»¶ï¼ˆå¸¦ fiberï¼‰
function createComponent(fn) {
  <span class="hljs-attr">fn.fiber</span> = { hooks: null, hookIndex: <span class="hljs-number">0</span> }<span class="hljs-comment">;</span>
  return fn<span class="hljs-comment">;</span>
}

function useState(initialState) {
  const <span class="hljs-attr">fiber</span> = currentFiber<span class="hljs-comment">;</span>
  const <span class="hljs-attr">hookIndex</span> = fiber.hookIndex++<span class="hljs-comment">;</span>

  if (fiber.isMount) {
    const <span class="hljs-attr">hook</span> = {
      memoizedState:
        typeof <span class="hljs-attr">initialState</span> === <span class="hljs-string">"function"</span> ? initialState() : initialState,
      queue: <span class="hljs-section">[]</span>,
    }<span class="hljs-comment">;</span>
    fiber.hooks.push(hook)<span class="hljs-comment">;</span>
  }

  const <span class="hljs-attr">hook</span> = fiber.hooks[hookIndex]<span class="hljs-comment">;</span>

  hook.queue.forEach((update) =&gt; {
    const <span class="hljs-attr">prev</span> = hook.memoizedState<span class="hljs-comment">;</span>
    <span class="hljs-attr">hook.memoizedState</span> =
      typeof <span class="hljs-attr">update</span> === <span class="hljs-string">"function"</span> ? update(prev) : update<span class="hljs-comment">;</span>
  })<span class="hljs-comment">;</span>

  <span class="hljs-attr">hook.queue</span> = []<span class="hljs-comment">;</span>

  const <span class="hljs-attr">setState</span> = (action) =&gt; {
    hook.queue.push(action)<span class="hljs-comment">;</span>
    rerender()<span class="hljs-comment">;</span>
  }<span class="hljs-comment">;</span>

  return <span class="hljs-section">[hook.memoizedState, setState]</span><span class="hljs-comment">;</span>
}

// è°ƒåº¦å™¨
let <span class="hljs-attr">rerenderScheduled</span> = <span class="hljs-literal">false</span><span class="hljs-comment">;</span>
function rerender() {
  if (!rerenderScheduled) {
    <span class="hljs-attr">rerenderScheduled</span> = <span class="hljs-literal">true</span><span class="hljs-comment">;</span>
    setTimeout(() =&gt; {
      <span class="hljs-attr">rerenderScheduled</span> = <span class="hljs-literal">false</span><span class="hljs-comment">;</span>
      render(App)<span class="hljs-comment">;</span>
    }, 0)<span class="hljs-comment">;</span>
  }
}

const <span class="hljs-attr">App</span> = createComponent(function App() {
  const <span class="hljs-section">[count, setCount]</span> = useState(0)<span class="hljs-comment">;</span>
  const <span class="hljs-section">[text, setText]</span> = useState("hello")<span class="hljs-comment">;</span>

  return {
    count,
    text,
    inc: () =&gt; setCount((c) =&gt; c + 1),
    changeText: () =&gt; setText((t) =&gt; t + "!"),
  }<span class="hljs-comment">;</span>
})<span class="hljs-comment">;</span>

// é¦–æ¬¡æ¸²æŸ“
const <span class="hljs-attr">app</span> = render(App)<span class="hljs-comment">;</span>

// è°ƒç”¨æ›´æ–°
app.inc()<span class="hljs-comment">;</span>
app.inc()<span class="hljs-comment">;</span>
app.changeText()<span class="hljs-comment">;</span>
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[è§‚æµ‹äº‘å‘Šè­¦å¯¹æ¥åä¸º WeLink æœ€ä½³å®è·µ]]></title>    <link>https://juejin.cn/post/7581299982670528546</link>    <guid>https://juejin.cn/post/7581299982670528546</guid>    <pubDate>2025-12-08T09:48:37.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581299982670528546" data-draft-id="7581270148046094376" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="è§‚æµ‹äº‘å‘Šè­¦å¯¹æ¥åä¸º WeLink æœ€ä½³å®è·µ"/> <meta itemprop="keywords" content="ç›‘æ§"/> <meta itemprop="datePublished" content="2025-12-08T09:48:37.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å¯è§‚æµ‹æ€§ç”¨è§‚æµ‹äº‘"/> <meta itemprop="url" content="https://juejin.cn/user/2392958212523102"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            è§‚æµ‹äº‘å‘Šè­¦å¯¹æ¥åä¸º WeLink æœ€ä½³å®è·µ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2392958212523102/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å¯è§‚æµ‹æ€§ç”¨è§‚æµ‹äº‘
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-08T09:48:37.000Z" title="Mon Dec 08 2025 09:48:37 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»2åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>åä¸ºäº‘ WeLink æ˜¯åä¸ºæ¨å‡ºçš„å…¨åœºæ™¯æ•°å­—åŒ–ååŒåŠå…¬å¹³å°ï¼Œæ—¨åœ¨å¸®åŠ©ä¼ä¸šå®ç°é«˜æ•ˆã€å®‰å…¨çš„åœ¨çº¿åä½œã€‚è§‚æµ‹äº‘åˆ™æ˜¯ä¸“ä¸º IT å·¥ç¨‹å¸ˆæ‰“é€ çš„å…¨é“¾è·¯å¯è§‚æµ‹æ€§å¹³å°ï¼Œå…·å¤‡å®Œå–„çš„å¼‚å¸¸ç›‘æµ‹ä½“ç³»ï¼Œèƒ½å¤Ÿå¯¹åŸºç¡€è®¾æ–½ã€åº”ç”¨ç¨‹åºåŠæ—¥å¿—ç­‰å„ç±»æ•°æ®è¿›è¡Œå®æ—¶ç›‘æ§ï¼Œå¹¶åœ¨å‘ç°å¼‚å¸¸æ—¶è‡ªåŠ¨è§¦å‘å‘Šè­¦ã€‚æœ¬æ–‡ä¸»è¦ä»‹ç»å¦‚ä½•å°†è§‚æµ‹äº‘çš„å‘Šè­¦ä¿¡æ¯æ¨é€è‡³ WeLink çš„å®ç°æ–¹å¼ã€‚</p>
<h2 data-id="heading-0">å‰ç½®æ¡ä»¶</h2>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fauth.guance.com%2Flogin%2Fpwd" target="_blank" title="https://auth.guance.com/login/pwd" ref="nofollow noopener noreferrer">è§‚æµ‹äº‘ SaaS</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ffunc.guance.com%2Fdoc%2Fmaintenance-guide-requirement%2F" target="_blank" title="https://func.guance.com/doc/maintenance-guide-requirement/" ref="nofollow noopener noreferrer">å®‰è£… Func</a></li>
</ul>
<h2 data-id="heading-1">é…ç½® Webhook æœºå™¨äºº</h2>
<p>ç‚¹å‡»ç¾¤å³ä¸Šè§’çš„é½¿è½®å›¾è¡¨ï¼Œå¼¹å‡ºè®¨è®ºç»„ï¼Œåœ¨â€œè®¨è®ºç»„ç®¡ç†â€ä¸‹é¢ç‚¹å‡»â€œç¾¤åŠ©æ‰‹â€ã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2f776128c3ad43ffb34976ed5202d694~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y-v6KeC5rWL5oCn55So6KeC5rWL5LqR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765792117&amp;x-signature=emANM9FA5vd%2BJj3wJMqTC%2BJ%2F6S4%3D" alt="" loading="lazy"/></p>
<p>ç‚¹å‡»â€œæ·»åŠ ç¾¤åŠ©æ‰‹â€ï¼Œå†ç‚¹å‡»â€œåˆ›å»ºâ€ã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/05d08bc7503a4bf6a1831e1ab9c68d05~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y-v6KeC5rWL5oCn55So6KeC5rWL5LqR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765792117&amp;x-signature=nC52nSvPzrvEkGTa0WZ6SkKfElg%3D" alt="" loading="lazy"/></p>
<p>ç‚¹å‡»â€œå»åˆ›å»ºâ€ã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d1b55fa5a1d3498e832e86046ff157fd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y-v6KeC5rWL5oCn55So6KeC5rWL5LqR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765792117&amp;x-signature=ig4F%2BgVq6EvXJvKgV9%2Bv5TJ1nos%3D" alt="" loading="lazy"/></p>
<p>è¾“å…¥åç§°åï¼Œç‚¹å‡»â€œæ·»åŠ â€ã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8f388654145e430b98e60392396d4307~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y-v6KeC5rWL5oCn55So6KeC5rWL5LqR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765792117&amp;x-signature=bdfdw%2Fi2mzy6mONGKCQkTte%2FQDU%3D" alt="" loading="lazy"/></p>
<p>ä¿å­˜ Webhook åï¼Œç‚¹å‡»â€œä¿å­˜ã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f0d5e02da4f34140b4f8761bac5d7410~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y-v6KeC5rWL5oCn55So6KeC5rWL5LqR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765792117&amp;x-signature=noAA0sQKvSHha1ag%2BuiybOxSmlg%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-2">é…ç½® Func</h2>
<h3 data-id="heading-3">ç¼–å†™è„šæœ¬</h3>
<p>ç™»å½• Funcï¼Œç‚¹å‡»â€œå¼€å‘â€-&gt;â€œè„šæœ¬åº“â€-&gt;â€œæ–°å»ºè„šæœ¬é›†â€ï¼Œè¾“å…¥ â€œwebhookâ€ï¼Œé¼ æ ‡ç§»åˆ° webhook ä¸Šï¼Œç‚¹å‡»â€œæ–°å»ºè„šæœ¬â€ï¼Œè¾“å…¥â€œwelink_prodâ€ï¼Œç¼–è¾‘è„šæœ¬ï¼Œè¾“å…¥å¦‚ä¸‹å†…å®¹ï¼Œæœ€åç‚¹å‡»â€œå‘å¸ƒâ€ã€‚</p>
<pre><code class="hljs language-ini" lang="ini">import requests
import json
import time
import uuid

@DFF.API('è‡ªå®šä¹‰å‘é€ weLink')
def send_welink(**kwargs):
    <span class="hljs-attr">token</span> = _DFF_HTTP_REQUEST.get(<span class="hljs-string">'query'</span>).get(<span class="hljs-string">'token'</span>)
    <span class="hljs-attr">title</span> = kwargs.get(<span class="hljs-string">'df_title'</span>,<span class="hljs-string">'äº‹ä»¶å‘Šè­¦'</span>)
    <span class="hljs-attr">messageJson</span> = [kwargs.get(<span class="hljs-string">'df_message'</span>,<span class="hljs-string">'å‘Šè­¦'</span>)]
    <span class="hljs-attr">status</span> = kwargs.get(<span class="hljs-string">'df_status'</span>,<span class="hljs-string">'info'</span>)
    <span class="hljs-attr">msgStr</span> = messageJson[<span class="hljs-number">0</span>]
    <span class="hljs-attr">url</span> = kwargs.get(<span class="hljs-string">'df_event_link'</span>)
    <span class="hljs-attr">jumpHtml</span> = url
    <span class="hljs-attr">webhook_url</span> = <span class="hljs-string">"https://open.welink.huaweicloud.com/api/werobot/v1/webhook/send"</span>
    <span class="hljs-attr">params</span> = {
        "token": token,
        "channel": "standard"
    }
    <span class="hljs-comment"># è¯·æ±‚å¤´ï¼ˆHeadersï¼‰</span>
    <span class="hljs-attr">headers</span> = {
        "Content-Type": "application/json",  <span class="hljs-comment"># å¿…é¡»æŒ‡å®š JSON æ ¼å¼</span>
        "Accept": "application/json"
    }

    <span class="hljs-comment"># è¯·æ±‚ä½“ï¼ˆBodyï¼‰ï¼Œå‘é€çš„æ¶ˆæ¯å†…å®¹</span>
    <span class="hljs-attr">payload</span> = {
        "messageType": "text",
        "content": {
            "text": msgStr + "\n\n" + jumpHtml  <span class="hljs-comment"># æ¶ˆæ¯å†…å®¹</span>
        },
        "timeStamp": int(time.time() * 1000),   <span class="hljs-comment"># æ¯«ç§’æ—¶é—´æˆ³</span>
        "uuid": uuid.uuid4().hex                <span class="hljs-comment"># 32 ä½åå…­è¿›åˆ¶å­—ç¬¦ä¸²</span>
    }    

    <span class="hljs-comment"># å‘é€ POST è¯·æ±‚</span>
    <span class="hljs-attr">response</span> = requests.post(
        webhook_url,
        <span class="hljs-attr">params</span>=params,  <span class="hljs-comment"># URL å‚æ•°ï¼ˆtoken å’Œ channelï¼‰</span>
        <span class="hljs-attr">headers</span>=headers,
        <span class="hljs-attr">data</span>=json.dumps(payload)  <span class="hljs-comment"># å°†å­—å…¸è½¬ä¸º JSON å­—ç¬¦ä¸²</span>
    )
    <span class="hljs-comment"># æ‰“å°å“åº”</span>
    print("Status Code:", response.status_code)
    print("Response:", response.json())
</code></pre>
<p>é…ç½®æˆªå›¾</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c39f9190f3b2438394ce89678dc39068~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y-v6KeC5rWL5oCn55So6KeC5rWL5LqR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765792117&amp;x-signature=%2FWu1e15%2F9lZBGQqhw1wZwbBPQgM%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-4">é…ç½®å‡½æ•°</h3>
<p>ä¾æ¬¡è¿›å…¥ Func ç•Œé¢çš„â€œç®¡ç†â€-&gt;â€œå‡½æ•° APIâ€ï¼Œç‚¹å‡»â€œæ–°å»ºâ€ï¼Œè¿è¡Œå‡½æ•°é€‰æ‹©ä¸Šæ­¥ç¼–å†™çš„è„šæœ¬ï¼Œç‚¹å‡»â€œä¿å­˜â€ã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ab0d6aafbe524b5a8c1e8bee4744cd93~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y-v6KeC5rWL5oCn55So6KeC5rWL5LqR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765792117&amp;x-signature=K%2BmYp%2FME76bN3old%2BuZN9Gna%2BtA%3D" alt="" loading="lazy"/></p>
<p>åœ¨å‡½æ•° API ç•Œé¢ï¼Œåˆšåˆ›å»ºçš„å‡½æ•°è¡Œåé¢æœ‰ä¸ªâ€œç¤ºä¾‹â€ï¼Œç‚¹å‡»åï¼Œå¤åˆ¶â€œPOSTç®€åŒ–å½¢å¼(JSON)â€é‡Œé¢çš„ urlã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6ec074be267143fc95fd157ec7da7c13~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y-v6KeC5rWL5oCn55So6KeC5rWL5LqR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765792117&amp;x-signature=Th3zpJYHDq%2FmgMq%2B8CczieuUf%2Bc%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-5">åˆ›å»ºç›‘æ§å™¨</h2>
<h3 data-id="heading-6">æ–°å»ºé€šçŸ¥å¯¹è±¡</h3>
<p>ç™»å½•è§‚æµ‹äº‘ï¼Œè¿›å…¥â€œç›‘æ§â€-&gt;â€œé€šçŸ¥å¯¹è±¡ç®¡ç†â€-&gt;â€œæ–°å»ºé€šçŸ¥å¯¹è±¡â€ï¼Œé€‰æ‹©â€œwebhookâ€ï¼ŒWebhookåœ°å€ä¸­ç²˜è´´ä¸Šæ­¥å¤åˆ¶çš„ urlï¼Œæœ€åç‚¹å‡»â€œç¡®è®¤â€ã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b19b8e1eb8904505ab0f101c0c80a225~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y-v6KeC5rWL5oCn55So6KeC5rWL5LqR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765792117&amp;x-signature=jfGe6qzYfy4X89EWBEh1iacUaPg%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-7">æ–°å»ºå‘Šè­¦ç­–ç•¥ç®¡ç†</h3>
<p>è¿›å…¥â€œç›‘æ§â€-&gt;â€œå‘Šè­¦ç­–ç•¥ç®¡ç†â€-&gt;â€œæ–°å»ºå‘Šè­¦ç­–ç•¥â€ï¼Œé€šçŸ¥é…ç½®ä¸­æŒ‰ä¸‹å›¾é…ç½®ï¼Œæœ€åç‚¹å‡»â€œä¿å­˜â€ã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2e2c5768262a487cb0e4a905f270906e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y-v6KeC5rWL5oCn55So6KeC5rWL5LqR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765792117&amp;x-signature=rRwW31n19am%2BYR46z5OT3802NM0%3D" alt="" loading="lazy"/></p>
<p>è¿›å…¥â€œç›‘æ§â€-&gt;â€œç›‘æ§å™¨â€-&gt;â€œä»æ¨¡ç‰ˆæ–°å»ºâ€ï¼Œé€‰æ‹©ä¸€ä¸ªç›‘æ§å™¨ï¼Œåœ¨å‘Šè­¦é…ç½®ä¸­é€‰æ‹©ä¸Šæ­¥åˆ›å»ºçš„å‘Šè­¦ç­–ç•¥ã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7107fb1de86c410dbee4a635f92fbb4d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y-v6KeC5rWL5oCn55So6KeC5rWL5LqR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765792117&amp;x-signature=6SjNop8Y7QAxCczsFXl7U%2B4g7HY%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-8">æ•ˆæœå±•ç¤º</h2>
<p>å½“ç›‘æ§å™¨è¾¾åˆ°è§¦å‘æ¡ä»¶åï¼ŒWeLink æ”¶åˆ°å‘Šè­¦ã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b7efcac5660f44448ba3677fe7601a82~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y-v6KeC5rWL5oCn55So6KeC5rWL5LqR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765792117&amp;x-signature=Gzzt%2BurYbQ6tGDv2Da8dw3jN8Zk%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-9">æ€»ç»“</h2>
<p>è§‚æµ‹äº‘å€ŸåŠ© Func åŠŸèƒ½ï¼Œèƒ½å¤Ÿå°†å‘Šè­¦ä¿¡æ¯å®æ—¶æ¨é€è‡³ WeLinkï¼Œå¸®åŠ©ç”¨æˆ·ç¬¬ä¸€æ—¶é—´æŒæ¡ç³»ç»Ÿè¿è¡ŒçŠ¶æ€ã€‚è¯¥åŠŸèƒ½æœ‰æ•ˆé¿å…äº†å› ç³»ç»Ÿæ•…éšœæœªèƒ½åŠæ—¶å‘ç°è€Œå¯èƒ½å¼•å‘çš„æ›´å¤§æŸå¤±ï¼Œè¿›ä¸€æ­¥æå‡äº†è¿ç»´æ•ˆç‡ä¸ç³»ç»Ÿå¯é æ€§ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[iOSåº”ç”¨å®Œæ•´ä¸Šæ¶App Storeæ­¥éª¤ä¸æ³¨æ„äº‹é¡¹è¯¦è§£]]></title>    <link>https://juejin.cn/post/7581406561684586542</link>    <guid>https://juejin.cn/post/7581406561684586542</guid>    <pubDate>2025-12-08T10:01:45.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581406561684586542" data-draft-id="7581306080434274355" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="iOSåº”ç”¨å®Œæ•´ä¸Šæ¶App Storeæ­¥éª¤ä¸æ³¨æ„äº‹é¡¹è¯¦è§£"/> <meta itemprop="keywords" content="åç«¯"/> <meta itemprop="datePublished" content="2025-12-08T10:01:45.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="bcbnb"/> <meta itemprop="url" content="https://juejin.cn/user/895474073078377"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            iOSåº”ç”¨å®Œæ•´ä¸Šæ¶App Storeæ­¥éª¤ä¸æ³¨æ„äº‹é¡¹è¯¦è§£
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/895474073078377/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    bcbnb
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-08T10:01:45.000Z" title="Mon Dec 08 2025 10:01:45 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»4åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>app store ä¸Šæ¶æµç¨‹</p>
<h3 data-id="heading-0">1. app ä¸Šæ¶è‹¹æœå•†åº—è¦æ±‚</h3>
<p>è‹¹æœå¼€å‘è€…è´¦å·èµ„è´¨ç”³è¯·åœ°å€ï¼š <a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.apple.com%2Fcn%2F" target="_blank" title="https://developer.apple.com/cn/" ref="nofollow noopener noreferrer">Apple Developer (ç®€ä½“ä¸­æ–‡)</a></p>
<p>å¤§å®¶éƒ½çŸ¥é“IOSæ˜¯appleå…¬å¸çš„å†…éƒ¨ç”Ÿæ€ï¼Œæ‰€æœ‰çš„APPåªè¦æƒ³åœ¨è‹¹æœæ‰‹æœºä¸Šå®‰è£…ï¼ˆéè¶Šç‹±ï¼‰å°±å¿…é¡»åŠ å…¥åˆ°è‹¹æœçš„å¼€å‘è€…ç”Ÿæ€ä¹‹ä¸­ã€‚</p>
<p>ç¬¬ä¸€ï¼Œå¿…é¡»æ³¨å†Œä¸€ä¸ªè‹¹æœå¼€å‘è€…è´¦å·ã€‚æ¯å¹´ç»™äºˆè‹¹æœå…¬å¸99ç¾é‡‘ï¼Œäººæ°‘å¸å›ºå®š688å…ƒ/å¹´çš„å¹´è´¹ã€‚</p>
<p>è‹¹æœå¼€å‘è€…è´¦å·åˆ†ä¸ºå‡ ä¸ªç±»åˆ«ï¼Œè¯¦æƒ…å¯ä»¥æ ¹æ®è‡ªå·±ä¸»ä½“çŠ¶æ€è¿›è¡Œé€‰æ‹©ç”³è¯·ã€‚</p>
<p>åŒºåˆ«è¯¦æƒ…ï¼š <a href="https://link.juejin.cn?target=http%3A%2F%2Fwww.applebyme.store%2Farticle%2Fshow%2F1241" target="_blank" title="http://www.applebyme.store/article/show/1241" ref="nofollow noopener noreferrer">è‹¹æœå¼€å‘è€…å’Œä¸ªäººå…¬å¸ä¼ä¸šè€…è´¦å·çš„åŒºåˆ«ï¼Ÿ - AppleByMe-ä¸“ä¸šä»£ä¸Šæ¶è‹¹æœå¸‚åœºæœåŠ¡ç³»ç»Ÿ</a></p>
<p>ä¸€ã€ä¸¾ä¾‹ç”³è¯·ä¼ä¸šå¼€å‘è€…è´¦å·çš„å‡†å¤‡æ¡ä»¶(ä»¥ä¼ä¸šè´¦å·ä¸ºä¾‹)ï¼š</p>
<p>1ã€ç”³è¯·ä¸€ä¸ªä¼ä¸šä½¿ç”¨çš„è‹¹æœè´¦å·</p>
<p>2ã€ç”³è¯·é‚“ç™½æ°ç¼–ç ï¼ˆä¸ªäººå¼€å‘è€…ä¸éœ€è¦ï¼Œä¼ä¸šæˆ–å…¬å¸å¼€å‘è€…éœ€è¦ï¼‰</p>
<p>3ã€è‹¹æœæ‰‹æœº</p>
<p>4ã€æ³•äººä¿¡æ¯</p>
<p>5ã€è¥ä¸šæ‰§ç…§</p>
<p>6ã€ä¼ä¸šå…¬ç« </p>
<p>7ã€ç½‘ç«™åœ°å€</p>
<h3 data-id="heading-1">2. <strong>æœ‰äº†å¼€å‘è€…è´¦å·ï¼Œå°±æ˜¯ä½¿ç”¨è´¦å·åˆ¶ä½œç›¸å…³çš„è‹¹æœå¼€å‘è€…è¯ä¹¦æ‰“åŒ…</strong></h3>
<p>è¯ä¹¦åˆ¶ä½œåœ°å€ï¼š <a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.apple.com%2Fcn%2F" target="_blank" title="https://developer.apple.com/cn/" ref="nofollow noopener noreferrer">Apple Developer (ç®€ä½“ä¸­æ–‡)</a></p>
<p>å¦‚ä½•åˆ¶ä½œè¯ä¹¦ï¼š <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.appuploader.net%2Ftutorial%2Fzh%2F4%2F4.html" target="_blank" title="https://www.appuploader.net/tutorial/zh/4/4.html" ref="nofollow noopener noreferrer">æœ€æ–°è‹¹æœAppleiOSå¼€å‘è¯ä¹¦ç”³è¯·åˆ›å»ºAppè¯¦ç»†å›¾æ–‡æµç¨‹_è‹¹æœå¼€å‘è€…è¯ä¹¦</a></p>
<p>å¼€å‘è€…å¯ä»¥ä½¿ç”¨AppUploaderç­‰å·¥å…·æ¥ç®€åŒ–iOSè¯ä¹¦ç”³è¯·æµç¨‹ï¼Œæ— éœ€é’¥åŒ™ä¸²åŠ©æ‰‹ï¼Œæ”¯æŒåœ¨Windowsã€Linuxæˆ–Macç³»ç»Ÿä¸­ç›´æ¥åˆ›å»ºå’Œç®¡ç†è¯ä¹¦ï¼Œæé«˜å›¢é˜Ÿåä½œæ•ˆç‡ã€‚</p>
<h3 data-id="heading-2">3. <strong>APPä½¿ç”¨äº†è‹¹æœè¯ä¹¦æ‰“åŒ…ä¹‹åï¼Œå°±æ˜¯ä¸Šä¼ åˆ°appstoreå¸‚åœºäº†</strong></h3>
<p>appstoreä¸Šæ¶åœ°å€ï¼š <a href="https://link.juejin.cn?target=https%3A%2F%2Fappstoreconnect.apple.com%2F" title="https://appstoreconnect.apple.com/" target="_blank" ref="nofollow noopener noreferrer">appstoreconnect.apple.com/</a></p>
<p>åœ¨ä¸Šæ¶å¹³å°ï¼Œå‡†ç¡®çš„è¾“å…¥è‡ªå·±APPçš„ä¸€äº›å¸¸è§„ä¿¡æ¯ï¼Œæ¯”å¦‚APPä»‹ç»ï¼ŒAPPåœ¨å¸‚åœºå±•ç¤ºæˆªå›¾ï¼ŒAPPçš„å†…éƒ¨æµ‹è¯•è´¦å·å’Œå¯†ç ï¼ŒAPPçš„éšç§æ¡æ¬¾ç­‰ï¼</p>
<p>ä¸Šä¼ IPAæ–‡ä»¶æ—¶ï¼Œå¯ä»¥å€ŸåŠ©AppUploaderå·¥å…·ï¼Œå®ƒæ”¯æŒåœ¨éMacç”µè„‘ä¸Šç›´æ¥ä¸Šä¼ åˆ°App Store Connectï¼Œæ¯”Application Loaderæ›´é«˜æ•ˆï¼Œä¸”ä¸æºå¸¦è®¾å¤‡ä¿¡æ¯ï¼Œç®€åŒ–ä¸Šæ¶æ­¥éª¤ã€‚</p>
<h3 data-id="heading-3">4. <strong>ä¸Šä¼ ä¹‹åï¼Œæäº¤å¸‚åœºå®¡æ ¸ï¼Œè‹¹æœå…¬å¸ä¸€èˆ¬1-3å·¥ä½œæ—¥å³å¯å®Œæˆå¯¹APPçš„å®¡æ ¸ï¼Œå¦‚æœé¡ºåˆ©é€šè¿‡ï¼Œä¼šåœ¨24å°æ—¶ä¹‹å†…åœ¨appstoreå¸‚åœºé‡Œé¢å¯ä»¥æœç´¢ä¸‹è½½ã€‚</strong></h3>
<p>ä¸€äº›å¸¸è§„çš„appstoreæ³¨æ„äº‹é¡¹ï¼š</p>
<p>ä¸èƒ½æœ‰äº§å“ä¸‹è½½ï¼ˆéiOSï¼Œä»¥åŠä¼ä¸šå‘å¸ƒåœ°å€ï¼‰çš„é“¾æ¥åŠäºŒç»´ç ã€‚</p>
<p>ä¸èƒ½å¸¦æœ‰å‡çº§çš„æŒ‰é’®ä»¥åŠæç¤ºã€‚</p>
<p>åœ¨appæäº¤å¹³å°å¡«ä¸Šè¯¥ç½‘ç«™çš„æµ‹è¯•å¸å·ã€‚</p>
<p>é¡µé¢è¦ä¿æŒç®€æ´ç¾è§‚ã€‚</p>
<p>ç½‘ç«™ä¸èƒ½å‡ºç°æµ‹è¯•é¡µé¢ã€Betaç­‰å­—æ®µ</p>
<h3 data-id="heading-4">æ³¨æ„äº‹é¡¹</h3>
<p>1.åº”ç”¨åç§°[å’ŒAPPæ¡Œé¢æ˜¾ç¤ºåç§°ä¸€è‡´]</p>
<p>2.åº”ç”¨æè¿°[æè¿°å±•ç°åœ¨Appstoreä¸Šï¼Œå°½é‡å¤šå†™ç‚¹ï¼Œæœ€ä½30å­—+]</p>
<p>3.å…³é”®å­—ï¼ˆSEOç”¨ï¼‰[appstoreå¸‚åœºä¸Šæœç´¢çš„ç›¸å…³å…³é”®è¯ï¼Œå•ä¸ªæœ€å¤š10ä¸ªå­—]</p>
<p>4.æ”¯æŒçš„ç½‘é¡µ [å®˜ç½‘ç½‘ç«™]</p>
<p>5.è¥é”€ç½‘å€(å¯ä¸å¡«)</p>
<p>6.ç‰ˆæƒï¼šæ‹¥æœ‰æ‚¨çš„ App ä¸“æœ‰æƒçš„äººå‘˜æˆ–å®ä½“çš„åç§°ï¼Œå‰é¢æ˜¯è·å¾—æƒåˆ©çš„å¹´ä»½ã€‚è¯·å‹¿æä¾›ç½‘å€ (URL)ã€‚</p>
<p>7.demoè´¦å· [æ¼”ç¤ºå¸å·å’Œå¯†ç ï¼Œæ¼”ç¤ºæœ€å¥½æ˜¯æ–°å»ºçš„ç©ºç™½å¸å·]</p>
<p>8.logoå›¾æ ‡ï¼Œ1024X1024 JPGæ ¼å¼ å¿…é¡»ä¸APP logoä¸€è‡´ã€‚å»ºè®®æ— åœ†è§’(ç°åœ¨å·²ç»ä¸éœ€è¦äº†ï¼Œä¸Šä¼ åŒ…ä¹‹åä¼šè‡ªåŠ¨è¯†åˆ«)</p>
<p>9.APPå†…å®¹æˆªå›¾</p>
<p>å¤‡æ³¨ï¼š ä¸Šæ¶appstoreéœ€è¦å‡†å¤‡çš„å›¾ç‰‡ææ–™ ï¼ˆå…¨éƒ¨ä¸ºJPGï¼‰ å¿…é¡»æ˜¯åº”ç”¨æˆªå›¾ï¼Œä¸å¾—æ˜¯å¯åŠ¨é¡µ</p>
<p>3-5å¼ å†…å®¹æˆªå›¾å°ºå¯¸æ˜¯1242x2208å’Œ1242*2688ï¼Œæ­¤æˆªå›¾æ˜¯åœ¨appstoreä¸Šå±•ç¤ºç»™ç”¨æˆ·çœ‹çš„ï¼Œæ‰€ä»¥åŠ²é‡æŠŠæ‚¨APPä¼˜è´¨çš„é¡µé¢ç»™æˆªæ¥ã€‚</p>
<p>10.Appå®¡æ ¸ä¿¡æ¯ï¼šè”ç³»äººã€ç”µè¯ã€ç”µå­é‚®ç®±ã€è”ç³»äººåœ°å€ã€è”ç³»äººèŒåŠ¡ã€éšç§æ”¿ç­–ç½‘å€ (URL)</p>
<p>11.ä»·æ ¼ï¼šå…è´¹æˆ–è€…æ”¶è´¹</p>
<p>12.é”€å”®èŒƒå›´ï¼šå›½å®¶æˆ–åœ°åŒº</p>
<p>13.Appåˆ†å‘æ–¹å¼ï¼šå¦‚æœæ˜¯å…è´¹çš„â€œåœ¨Appleæ ¡å›­æ•™åŠ¡ç®¡ç†ä¸­æä¾›æ‰¹é‡è´­ä¹°ä¼˜æƒ ä»·æ ¼â€è¿™ä¸ªéœ€è¦å–æ¶ˆå‹¾é€‰</p>
<p>14.æ˜¯å¦ä»æ­¤Appä¸­æ‰‹æœºæ•°æ®</p>
<p>15.å†…å®¹ç‰ˆæƒï¼šå¦‚æœæ‚¨çš„ App åŒ…å«ã€æ˜¾ç¤ºæˆ–ä¼šè®¿é—®ä»»ä½•ç¬¬ä¸‰æ–¹å†…å®¹ï¼Œæ‚¨å¿…é¡»æ‹¥æœ‰ç›¸åº”å†…å®¹çš„ç‰ˆæƒï¼Œæˆ–è€…è·å‡†å¯ä½¿ç”¨ç›¸åº”å†…å®¹ã€‚</p>
<p>16.å¹´é¾„åˆ†çº§</p>
<p>17.ä¸»è¦è¯­è¨€</p>
<p>18.ç±»åˆ«</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item>  </channel></rss>