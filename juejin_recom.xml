<?xml version="1.0" encoding="UTF-8"?><rss version="2.0">  <channel>      <title>æ˜é‡‘æ–‡ç« æ¨è</title>      <link>https://juejin.cn/recommended?sort=newest</link>      <description>ä¸€ä¸ªå¸®åŠ©å¼€å‘è€…æˆé•¿çš„ç¤¾åŒº</description>      <generator>python juejin_recom.py @Pi20</generator>      <item>    <title><![CDATA[vueé¡¹ç›®ç´¢å¼•æäº¤-URLé™åˆ¶]]></title>    <link>https://juejin.cn/post/7579164768063668251</link>    <guid>https://juejin.cn/post/7579164768063668251</guid>    <pubDate>2025-12-03T03:39:09.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7579164768063668251" data-draft-id="7579192114828230683" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="vueé¡¹ç›®ç´¢å¼•æäº¤-URLé™åˆ¶"/> <meta itemprop="keywords" content="SEO"/> <meta itemprop="datePublished" content="2025-12-03T03:39:09.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="é–æºå“‹ç¬¨å°å­©"/> <meta itemprop="url" content="https://juejin.cn/user/2172290708044151"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            vueé¡¹ç›®ç´¢å¼•æäº¤-URLé™åˆ¶
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2172290708044151/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    é–æºå“‹ç¬¨å°å­©
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-03T03:39:09.000Z" title="Wed Dec 03 2025 03:39:09 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-03
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    5
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»6åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">ä¸€ã€SEO ç´¢å¼•æäº¤çš„æ ¸å¿ƒ URL é™åˆ¶ï¼ˆç™¾åº¦ / Google é€šç”¨è§„åˆ™ï¼‰</h2>
<p>æ— è®ºå“ªç§ç½‘ç«™ç±»å‹ï¼Œæäº¤ URL åˆ°æœç´¢å¼•æ“ï¼ˆç™¾åº¦èµ„æºå¹³å°ã€Google Search Consoleï¼‰éœ€éµå®ˆä»¥ä¸‹æ ¸å¿ƒé™åˆ¶ï¼Œè¿è§„ä¼šå¯¼è‡´<strong>ç´¢å¼•å¤±è´¥ã€æ”¶å½•å»¶è¿Ÿç”šè‡³ç«™ç‚¹æƒ©ç½š</strong>ï¼š</p>
<h3 data-id="heading-1">1. æ ¼å¼ä¸åè®®é™åˆ¶</h3>
<ul>
<li>âœ… å¿…é¡»æ˜¯<strong>ç»å¯¹ URL</strong>ï¼ˆå®Œæ•´åŒ…å«åè®® + åŸŸå + è·¯å¾„ï¼‰ï¼Œç¤ºä¾‹ï¼š<code>https://www.example.com/about</code>ï¼ˆæ­£ç¡®ï¼‰ï¼Œ<code>/about</code>ï¼ˆé”™è¯¯ï¼Œç›¸å¯¹è·¯å¾„ä¸æ”¯æŒï¼‰</li>
<li>âœ… åè®®ä¸€è‡´æ€§ï¼šæäº¤çš„ URL åè®®ï¼ˆHTTP/HTTPSï¼‰éœ€ä¸ç«™ç‚¹å®é™…ä½¿ç”¨çš„åè®®ä¸€è‡´ï¼Œæ··åˆæäº¤ä¼šå¯¼è‡´ç´¢å¼•æ··ä¹±</li>
<li>âŒ ç¦æ­¢å«ç‰¹æ®Šå­—ç¬¦ï¼šURL ä¸­ä¸èƒ½æœ‰ç©ºæ ¼ã€ä¸­æ–‡å…¨è§’ç¬¦å·ã€éæ³•ç¼–ç å­—ç¬¦ï¼ˆå¦‚<code>%00</code>ï¼‰ï¼Œéœ€ URL ç¼–ç ï¼ˆä¸­æ–‡è½¬<code>%E5%BC%80</code>ç­‰ï¼‰</li>
<li>âŒ ç¦æ­¢é”šç‚¹ï¼ˆ#ï¼‰ï¼š<code>https://www.example.com/#/about</code>Â ä¸­<code>#</code>åçš„å†…å®¹ä¸ä¼šè¢«æœç´¢å¼•æ“è§£æï¼Œæäº¤åä»…æ”¶å½•<code>https://www.example.com/</code>ï¼Œé”šç‚¹éƒ¨åˆ†å¤±æ•ˆ</li>
</ul>
<h3 data-id="heading-2">2. æ•°é‡ä¸é¢‘ç‡é™åˆ¶</h3>























<table><thead><tr><th>å¹³å°</th><th>å•æ¡æäº¤é™åˆ¶</th><th>æ‰¹é‡æäº¤é™åˆ¶ï¼ˆsitemapï¼‰</th><th>æäº¤é¢‘ç‡é™åˆ¶</th></tr></thead><tbody><tr><td>ç™¾åº¦èµ„æºå¹³å°</td><td>å•æ—¥å•ç«™â‰¤100 æ¡ï¼ˆæ‰‹åŠ¨æäº¤ï¼‰</td><td>å• sitemapâ‰¤5 ä¸‡æ¡ URLï¼Œâ‰¤10MB</td><td>åŒ URL é‡å¤æäº¤é—´éš”â‰¥24 å°æ—¶ï¼Œé¿å…é¢‘ç¹æäº¤</td></tr><tr><td>Google Search Console</td><td>æ— æ˜ç¡®å•æ¡ä¸Šé™</td><td>å• sitemapâ‰¤5 ä¸‡æ¡ URLï¼Œâ‰¤10MB</td><td>å»ºè®®æ¯å‘¨æ›´æ–° sitemapï¼Œé¿å…å•æ—¥å¤šæ¬¡æäº¤</td></tr></tbody></table>
<ul>
<li>âŒ ç¦æ­¢æ‰¹é‡æäº¤æ— å…³ URLï¼šå¦‚éæœ¬ç«™ URLã€æ­»é“¾ã€è·³è½¬é“¾æ¥ï¼Œä¼šè¢«åˆ¤å®šä¸º â€œåƒåœ¾æäº¤â€ï¼Œå½±å“ç«™ç‚¹ä¿¡ä»»åº¦</li>
</ul>
<h3 data-id="heading-3">3. å†…å®¹ä¸å¯è®¿é—®æ€§é™åˆ¶</h3>
<ul>
<li>âœ… å¿…é¡»æ˜¯<strong>å¯ç›´æ¥è®¿é—®çš„æœ‰æ•ˆé¡µé¢</strong>ï¼šè¿”å›çŠ¶æ€ç  200ï¼ˆæ­£å¸¸ï¼‰ï¼Œä¸èƒ½æ˜¯ 404ï¼ˆä¸å­˜åœ¨ï¼‰ã€403ï¼ˆç¦æ­¢è®¿é—®ï¼‰ã€301/302ï¼ˆè·³è½¬ï¼‰ã€5xxï¼ˆæœåŠ¡å™¨é”™è¯¯ï¼‰</li>
<li>âŒ ç¦æ­¢æäº¤ â€œæ¡¥é¡µ / åƒåœ¾é¡µâ€ï¼šå†…å®¹é‡å¤ã€æ— å®è´¨ä»·å€¼ã€ä»…ä¸º SEO å †ç Œå…³é”®è¯çš„é¡µé¢</li>
<li>âŒ ç¦æ­¢æäº¤éœ€ç™»å½• / æƒé™éªŒè¯çš„é¡µé¢ï¼šæœç´¢å¼•æ“çˆ¬è™«æ— æ³•è·å–å†…å®¹ï¼Œæäº¤åä¹Ÿä¸ä¼šç´¢å¼•</li>
<li>âœ… é¡µé¢éœ€ç¬¦åˆ â€œå¯æŠ“å–â€ï¼šrobots.txt æœªç¦æ­¢çˆ¬è™«ï¼ˆå¦‚<code>Disallow: /</code>ä¼šå¯¼è‡´å…¨ç«™æ— æ³•æŠ“å–ï¼‰ï¼Œæ—  IP å°ç¦ã€CDN æ‹¦æˆªçˆ¬è™«ç­‰é™åˆ¶</li>
</ul>
<h3 data-id="heading-4">4. åŠ¨æ€ URL é™åˆ¶</h3>
<ul>
<li>ä¸å»ºè®®æäº¤å«è¿‡å¤šå‚æ•°çš„ URLï¼ˆå¦‚<code>https://www.example.com/list?id=123&amp;page=2&amp;sort=time</code>ï¼‰ï¼Œæ˜“è¢«åˆ¤å®šä¸º â€œé‡å¤å†…å®¹â€</li>
<li>è‹¥å¿…é¡»æäº¤åŠ¨æ€ URLï¼Œéœ€æ§åˆ¶å‚æ•°æ•°é‡ï¼ˆâ‰¤3 ä¸ªï¼‰ï¼Œå¹¶é€šè¿‡<code>canonical</code>æ ‡ç­¾æŒ‡å®šä¸» URLï¼Œé¿å…ç´¢å¼•æ··ä¹±</li>
</ul>
<h2 data-id="heading-5">äºŒã€Vue è·¯ç”±å½¢å¼èƒ½å¦æäº¤ï¼Ÿåˆ†æ¨¡å¼è¯¦è§£</h2>
<p>Vue çš„è·¯ç”±æ¨¡å¼ï¼ˆ<code>hash</code>/<code>history</code>ï¼‰ç›´æ¥å½±å“ URL å¯ç´¢å¼•æ€§ï¼Œæ ¸å¿ƒç»“è®ºï¼š<strong>history æ¨¡å¼å¯æ­£å¸¸æäº¤ï¼Œhash æ¨¡å¼éœ€ç‰¹æ®Šå¤„ç†ï¼Œå¦åˆ™æ— æ³•è¢«ç´¢å¼•</strong>ã€‚</p>
<h3 data-id="heading-6">1. Vue hash æ¨¡å¼ï¼ˆé»˜è®¤æ¨¡å¼ï¼ŒURL å« #ï¼‰</h3>
<h4 data-id="heading-7">é—®é¢˜æœ¬è´¨ï¼š</h4>
<p>hash æ¨¡å¼çš„ URL ç»“æ„ä¸ºÂ <code>https://www.example.com/#/about</code>ï¼Œå…¶ä¸­<code>#</code>æ˜¯å‰ç«¯é”šç‚¹æ ‡è¯†ï¼Œ<strong>æœç´¢å¼•æ“çˆ¬è™«ä¸ä¼šè§£æ<code>#</code>åçš„è·¯å¾„</strong>ï¼Œåªä¼šæŠ“å–<code>https://www.example.com/</code>ï¼ˆé¦–é¡µï¼‰ï¼Œæäº¤<code>#</code>åçš„ URLï¼ˆå¦‚<code>https://www.example.com/#/about</code>ï¼‰ä¼šè¢«è§†ä¸º â€œé¦–é¡µé‡å¤æäº¤â€ï¼Œå­è·¯ç”±é¡µé¢æ— æ³•å•ç‹¬ç´¢å¼•ã€‚</p>
<h4 data-id="heading-8">èƒ½å¦æäº¤ï¼Ÿ</h4>
<ul>
<li>âŒ ç›´æ¥æäº¤<code>#</code>åçš„ URL æ— æ•ˆï¼ˆå¦‚<code>https://www.example.com/#/about</code>ï¼‰ï¼Œæœç´¢å¼•æ“ä¸ä¼šè¯†åˆ«å­è·¯ç”±</li>
<li>âœ… è‹¥æ— æ³•åˆ‡æ¢ history æ¨¡å¼ï¼Œéœ€é€šè¿‡ã€Œé¢„æ¸²æŸ“ï¼ˆPrerenderï¼‰ã€æˆ–ã€ŒSSRï¼ˆæœåŠ¡ç«¯æ¸²æŸ“ï¼‰ã€å¤„ç†ï¼Œå°† hash è·¯ç”±è½¬ä¸ºé™æ€ URL åæäº¤</li>
</ul>
<h4 data-id="heading-9">è§£å†³æ–¹æ¡ˆï¼ˆhash æ¨¡å¼é€‚é… SEOï¼‰ï¼š</h4>
<ul>
<li>
<p>æ–¹æ¡ˆ 1ï¼šä½¿ç”¨<code>prerender-spa-plugin</code>é¢„æ¸²æŸ“å¯¹æ ¸å¿ƒé¡µé¢ï¼ˆå¦‚ /aboutã€/productï¼‰é¢„æ¸²æŸ“ä¸ºé™æ€ HTML æ–‡ä»¶ï¼Œç”Ÿæˆä¸å«<code>#</code>çš„ URLï¼ˆ<code>https://www.example.com/about</code>ï¼‰ï¼Œå†æäº¤é™æ€ URL</p>
</li>
<li>
<p>æ–¹æ¡ˆ 2ï¼šå¼€å¯ç™¾åº¦ â€œhash è·¯ç”±æ”¶å½•â€ åŠŸèƒ½ï¼ˆä»…ç™¾åº¦æ”¯æŒï¼‰åœ¨ç™¾åº¦èµ„æºå¹³å°â†’ç«™ç‚¹è®¾ç½®â†’æŠ“å–è®¾ç½®ä¸­ï¼Œå¼€å¯ â€œæ”¯æŒ hash è·¯ç”±æ”¶å½•â€ï¼Œçˆ¬è™«ä¼šå°è¯•è§£æ<code>#!</code>ï¼ˆæ³¨æ„æ˜¯<code>#!</code>è€Œé<code>#</code>ï¼‰åçš„è·¯å¾„ï¼Œéœ€ä¿®æ”¹ Vue è·¯ç”±é…ç½®ï¼š</p>
<p>javascript</p>
<p>è¿è¡Œ</p>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-type">const</span> router = <span class="hljs-keyword">new</span> <span class="hljs-built_in">VueRouter</span>({
  mode: <span class="hljs-string">'hash'</span>,
  hash: <span class="hljs-string">'#!'</span>, <span class="hljs-comment">// å°†é»˜è®¤#æ”¹ä¸º#!ï¼Œé€‚é…ç™¾åº¦hashæ”¶å½•è§„åˆ™</span>
  routes: [...]
})
</code></pre>
<p>æäº¤ URL æ ¼å¼ï¼š<code>https://www.example.com/#!/about</code>ï¼ˆç™¾åº¦ä¼šè§£æä¸º<code>/about</code>è·¯å¾„ï¼‰</p>
</li>
</ul>
<h3 data-id="heading-10">2. Vue history æ¨¡å¼ï¼ˆURL æ—  #ï¼Œæ¨èï¼‰</h3>
<h4 data-id="heading-11">ä¼˜åŠ¿ï¼š</h4>
<p>URL ç»“æ„ä¸ä¼ ç»Ÿç½‘ç«™ä¸€è‡´ï¼ˆå¦‚<code>https://www.example.com/about</code>ï¼‰ï¼Œæ— <code>#</code>ç¬¦å·ï¼Œæœç´¢å¼•æ“å¯ç›´æ¥è§£æè·¯å¾„ï¼Œ<strong>æ”¯æŒæ­£å¸¸ç´¢å¼•æäº¤</strong>ï¼Œæ˜¯ Vue é¡¹ç›® SEO çš„é¦–é€‰æ¨¡å¼ã€‚</p>
<h4 data-id="heading-12">å…³é”®å‰æï¼šæœåŠ¡ç«¯é…ç½®ï¼ˆå¦åˆ™ç´¢å¼•å¤±è´¥ï¼‰</h4>
<p>history æ¨¡å¼ä¾èµ– HTML5Â <code>pushState</code>Â APIï¼Œè‹¥æœåŠ¡ç«¯æœªé…ç½® â€œfallbackâ€ï¼Œç›´æ¥è®¿é—®å­è·¯ç”±ï¼ˆå¦‚<code>https://www.example.com/about</code>ï¼‰ä¼šè¿”å› 404ï¼Œå¯¼è‡´çˆ¬è™«æ— æ³•æŠ“å–ï¼Œæäº¤åç´¢å¼•å¤±è´¥ã€‚</p>
<h4 data-id="heading-13">æœåŠ¡ç«¯é…ç½®ç¤ºä¾‹ï¼ˆæ ¸å¿ƒï¼‰ï¼š</h4>
<ul>
<li>
<p><strong>Nginx é…ç½®</strong>ï¼ˆæœ€å¸¸ç”¨ï¼‰ï¼š</p>
<p>nginx</p>
<pre><code class="hljs language-bash" lang="bash">server {
  listen 443 ssl;
  server_name www.example.com;
  root /usr/share/nginx/html; <span class="hljs-comment"># Vueæ‰“åŒ…åçš„distç›®å½•</span>
  index index.html;

  <span class="hljs-comment"># æ ¸å¿ƒï¼šæ‰€æœ‰è·¯ç”±è¯·æ±‚ fallback åˆ°index.html</span>
  location / {
    try_files <span class="hljs-variable">$uri</span> <span class="hljs-variable">$uri</span>/ /index.html;
  }
}
</code></pre>
</li>
<li>
<p><strong>Apache é…ç½®</strong>ï¼šåœ¨é¡¹ç›®æ ¹ç›®å½•åˆ›å»º<code>.htaccess</code>æ–‡ä»¶ï¼š</p>
<p>apache</p>
<pre><code class="hljs language-ruby" lang="ruby">&lt;<span class="hljs-title class_">IfModule</span> mod_rewrite.c&gt;
  <span class="hljs-title class_">RewriteEngine</span> <span class="hljs-title class_">On</span>
  <span class="hljs-title class_">RewriteBase</span> /
  <span class="hljs-title class_">RewriteRule</span> ^index.html<span class="hljs-variable">$ </span>- [L]
  <span class="hljs-title class_">RewriteCond</span> <span class="hljs-string">%{REQUEST_FILENAME}</span> !-f
  <span class="hljs-title class_">RewriteCond</span> <span class="hljs-string">%{REQUEST_FILENAME}</span> !-d
  <span class="hljs-title class_">RewriteRule</span> . /index.html [L]
&lt;<span class="hljs-regexp">/IfModule&gt;
</span></code></pre>
</li>
<li>
<p><strong>Vercel éƒ¨ç½²</strong>ï¼ˆå‰ç«¯æ‰˜ç®¡å¹³å°ï¼‰ï¼šåœ¨<code>vercel.json</code>ä¸­é…ç½®ï¼š</p>
<p>json</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"rewrites"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">{</span> <span class="hljs-attr">"source"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"/(.*)"</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"destination"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"/index.html"</span> <span class="hljs-punctuation">}</span><span class="hljs-punctuation">]</span>
<span class="hljs-punctuation">}</span>
</code></pre>
</li>
</ul>
<h4 data-id="heading-14">æäº¤æ–¹å¼ï¼š</h4>
<p>ç›´æ¥æäº¤ä¸å«<code>#</code>çš„æ ‡å‡† URLï¼ˆå¦‚<code>https://www.example.com/about</code>ï¼‰ï¼Œæ”¯æŒæ‰‹åŠ¨æäº¤ã€sitemap æ‰¹é‡æäº¤ï¼Œæœç´¢å¼•æ“å¯æ­£å¸¸æŠ“å–è·¯ç”±å¯¹åº”çš„é¡µé¢å†…å®¹ã€‚</p>
<h3 data-id="heading-15">3. Vue è·¯ç”±æäº¤çš„é¢å¤–ä¼˜åŒ–ï¼ˆæå‡ç´¢å¼•æ•ˆç‡ï¼‰</h3>
<ul>
<li>
<p>ğŸ”§ ç”Ÿæˆé™æ€ sitemapï¼šä½¿ç”¨<code>vue-sitemap</code>æˆ–<code>nuxt-sitemap</code>ï¼ˆNuxt.js é¡¹ç›®ï¼‰è‡ªåŠ¨ç”Ÿæˆ sitemap.xmlï¼ŒåŒ…å«æ‰€æœ‰è·¯ç”± URLï¼Œæ‰¹é‡æäº¤æ›´é«˜æ•ˆ</p>
</li>
<li>
<p>ğŸ”§ åŠ¨æ€æ¸²æŸ“ï¼ˆNuxt.js/Next.jsï¼‰ï¼šè‹¥é¡¹ç›®å¤æ‚ï¼ˆå¦‚å¤§é‡åŠ¨æ€æ•°æ®ï¼‰ï¼Œæ¨èä½¿ç”¨ SSRï¼ˆæœåŠ¡ç«¯æ¸²æŸ“ï¼‰æˆ– SSGï¼ˆé™æ€ç«™ç‚¹ç”Ÿæˆï¼‰ï¼Œç›´æ¥ç”Ÿæˆå¯è¢«çˆ¬è™«æŠ“å–çš„é™æ€ HTMLï¼Œç´¢å¼•é€Ÿåº¦æ¯” SPAï¼ˆå•é¡µåº”ç”¨ï¼‰å¿« 50%+</p>
</li>
<li>
<p>ğŸ”§ æ·»åŠ <code>canonical</code>æ ‡ç­¾ï¼šé¿å…è·¯ç”±å‚æ•°å¯¼è‡´çš„é‡å¤ç´¢å¼•ï¼Œç¤ºä¾‹ï¼š</p>
<p>vue</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">"canonical"</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"https://www.example.com/about"</span> /&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>
</code></pre>
</li>
<li>
<p>ğŸ”§ éªŒè¯è·¯ç”±å¯è®¿é—®æ€§ï¼šæäº¤å‰ç”¨ â€œç™¾åº¦æŠ“å–è¯Šæ–­â€ æˆ– â€œGoogle URL Inspection Toolâ€ æµ‹è¯• URLï¼Œç¡®ä¿è¿”å› 200 ä¸”å†…å®¹å¯æ­£å¸¸æŠ“å–</p>
</li>
</ul>
<h2 data-id="heading-16">ä¸‰ã€å¸¸è§é—®é¢˜é¿å‘æŒ‡å—</h2>
<ol>
<li>âŒ ç›´æ¥æäº¤ Vue hash æ¨¡å¼çš„<code>#</code>å URLï¼šå¦‚<code>https://www.example.com/#/about</code>ï¼Œæœç´¢å¼•æ“ä»…æ”¶å½•é¦–é¡µï¼Œå­è·¯ç”±æ— æ³•ç´¢å¼•</li>
<li>âŒ history æ¨¡å¼æœªé…ç½®æœåŠ¡ç«¯ fallbackï¼šè®¿é—®å­è·¯ç”±è¿”å› 404ï¼Œæäº¤åç´¢å¼•å¤±è´¥</li>
<li>âŒ æäº¤ç›¸å¯¹è·¯å¾„æˆ–åè®®ä¸ä¸€è‡´çš„ URLï¼šå¦‚<code>/about</code>ï¼ˆç›¸å¯¹è·¯å¾„ï¼‰ã€<code>http://www.example.com/about</code>ï¼ˆç«™ç‚¹å®é™…ç”¨ HTTPSï¼‰ï¼Œç›´æ¥è¢«æœç´¢å¼•æ“æ‹’ç»</li>
<li>âŒ é¢‘ç¹é‡å¤æäº¤åŒä¸€ URLï¼šå•æ—¥å¤šæ¬¡æäº¤ä¼šè§¦å‘é¢‘ç‡é™åˆ¶ï¼Œå»ºè®®é€šè¿‡ sitemap å®šæœŸæ›´æ–°ï¼ˆæ¯å‘¨ 1 æ¬¡ï¼‰</li>
<li>âŒ æäº¤éœ€ç™»å½•æ‰èƒ½è®¿é—®çš„è·¯ç”±ï¼šå¦‚<code>https://www.example.com/user/center</code>ï¼Œçˆ¬è™«æ— æ³•è·å–å†…å®¹ï¼Œç´¢å¼•å¤±è´¥</li>
</ol>
<h2 data-id="heading-17">å››ã€æ€»ç»“</h2>
<h3 data-id="heading-18">1. URL æäº¤æ ¸å¿ƒé™åˆ¶ recapï¼š</h3>
<ul>
<li>æ ¼å¼ï¼šç»å¯¹ URLã€åè®®ä¸€è‡´ã€æ— ç‰¹æ®Šå­—ç¬¦ / é”šç‚¹</li>
<li>æ•°é‡ï¼šç™¾åº¦å•æ—¥â‰¤100 æ¡ï¼ˆæ‰‹åŠ¨ï¼‰ï¼Œsitemapâ‰¤5 ä¸‡æ¡</li>
<li>å¯è®¿é—®æ€§ï¼šçŠ¶æ€ç  200ã€æ— çˆ¬è™«é™åˆ¶ã€å†…å®¹æœ‰æ•ˆ</li>
<li>åŠ¨æ€ URLï¼šæ§åˆ¶å‚æ•°æ•°é‡ï¼Œç”¨<code>canonical</code>æŒ‡å®šä¸» URL</li>
</ul>
<h3 data-id="heading-19">2. Vue è·¯ç”±é€‚é…ç»“è®ºï¼š</h3>




















<table><thead><tr><th>Vue è·¯ç”±æ¨¡å¼</th><th>èƒ½å¦ç›´æ¥æäº¤</th><th>å…³é”®æ“ä½œ</th></tr></thead><tbody><tr><td>hash æ¨¡å¼ï¼ˆé»˜è®¤ï¼‰</td><td>âŒ ä¸èƒ½</td><td>æ–¹æ¡ˆ 1ï¼šåˆ‡æ¢ä¸º history æ¨¡å¼ + æœåŠ¡ç«¯ fallbackï¼›æ–¹æ¡ˆ 2ï¼šå¼€å¯ç™¾åº¦ hash æ”¶å½• + ä¿®æ”¹<code>#</code>ä¸º<code>#!</code></td></tr><tr><td>history æ¨¡å¼</td><td>âœ… å¯ä»¥</td><td>æœåŠ¡ç«¯é…ç½® fallbackï¼ˆNginx/Apache ç­‰ï¼‰ï¼Œæäº¤æ ‡å‡† URL</td></tr></tbody></table>
<h3 data-id="heading-20">3. æœ€ä¼˜å®è·µï¼š</h3>
<p>Vue é¡¹ç›®ä¼˜å…ˆä½¿ç”¨ã€Œhistory æ¨¡å¼ + æœåŠ¡ç«¯ fallback + é™æ€ sitemap æäº¤ã€ï¼Œé…åˆé¢„æ¸²æŸ“ / SSR æå‡æŠ“å–æ•ˆç‡ï¼Œæäº¤å‰ç”¨æŠ“å–è¯Šæ–­å·¥å…·éªŒè¯ï¼Œç¡®ä¿ URL ç¬¦åˆæœç´¢å¼•æ“è§„åˆ™ï¼Œæ‰èƒ½å¿«é€Ÿè¢«ç´¢å¼•ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[å…ˆæŠŠ Rollup ææ˜ç™½ï¼Œå†å»å­¦ Viteï¼]]></title>    <link>https://juejin.cn/post/7579165599042600975</link>    <guid>https://juejin.cn/post/7579165599042600975</guid>    <pubDate>2025-12-03T03:42:57.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7579165599042600975" data-draft-id="7579169543232389120" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="å…ˆæŠŠ Rollup ææ˜ç™½ï¼Œå†å»å­¦ Viteï¼"/> <meta itemprop="keywords" content="å‰ç«¯,JavaScript,é¢è¯•"/> <meta itemprop="datePublished" content="2025-12-03T03:42:57.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ç§€ç§€ä¸åªä¼šå‰ç«¯"/> <meta itemprop="url" content="https://juejin.cn/user/1410009035452887"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            å…ˆæŠŠ Rollup ææ˜ç™½ï¼Œå†å»å­¦ Viteï¼
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1410009035452887/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ç§€ç§€ä¸åªä¼šå‰ç«¯
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-03T03:42:57.000Z" title="Wed Dec 03 2025 03:42:57 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-03
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    5
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»9åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">æ¦‚å¿µ</h2>
<ul>
<li>â€‹**Rollup æ˜¯ä¸€ä¸ª ES æ¨¡å—æ‰“åŒ…å™¨ï¼ˆbundlerï¼‰**â€‹ï¼Œæ“…é•¿æŠŠå¤šä¸ª ESModule æ‰“åŒ…æˆä¸€ä¸ªæˆ–å¤šä¸ª bundleï¼Œç›®æ ‡å¸¸æ˜¯åº“ï¼ˆlibraryï¼‰æˆ–å‰ç«¯åº”ç”¨çš„ç”Ÿäº§æ„å»ºã€‚</li>
</ul>
<blockquote>
<p>æ ¸å¿ƒç†å¿µæ˜¯ â€‹<strong>åŸºäº ES Module çš„é™æ€åˆ†æ</strong>â€‹ï¼šRollup èƒ½æ›´ç²¾å‡†åš tree-shakingï¼ˆåˆ é™¤æœªä½¿ç”¨å¯¼å‡ºï¼‰ï¼Œäº§å‡ºçš„ bundle æ›´å°ã€æ›´â€œçº¯å‡€â€ã€‚</p>
<p>Rollup çš„æ‰“åŒ…ç»“æœæ›´é€‚åˆåšåº“å‘å¸ƒï¼ˆè¾“å‡º ESM/CJS/UMDï¼‰ï¼Œä½†åœ¨å‰ç«¯åº”ç”¨ä¸Šï¼ˆå°¤å…¶é…åˆ pluginï¼‰ä¹Ÿéå¸¸å¼ºå¤§ï¼ˆvite æ‰“åŒ…å™¨ï¼‰ã€‚</p>
</blockquote>
<h3 data-id="heading-1">Rollup ä¸å…¶å®ƒ bundler çš„å®šä½å¯¹æ¯”</h3>
<ul>
<li>â€‹<strong>Webpack</strong>â€‹ï¼šåŠŸèƒ½é½å…¨ã€æ’ä»¶ç”Ÿæ€ä¸°å¯Œã€é¢å‘åº”ç”¨ï¼ˆå¤æ‚çš„ code-splittingã€loader ï¼‰ã€‚</li>
<li>â€‹<strong>Rollup</strong>â€‹ï¼šæ›´æ³¨é‡é™æ€ ESM åˆ†æå’Œç”Ÿæˆæ›´å°çš„åº“åŒ…ï¼Œtree-shaking æ›´ç²¾å‡†ã€‚ç”¨äºåº“å¼€å‘æˆ–ä½œä¸ºç”Ÿäº§æ‰“åŒ…ï¼ˆå¦‚ Vite çš„ rollup é˜¶æ®µï¼‰ã€‚</li>
<li>â€‹<strong>esbuild / swc</strong>â€‹ï¼šè¶…å¿«çš„ç¼–è¯‘/è½¬è¯‘å·¥å…·ï¼Œä½†æ‰“åŒ…èƒ½åŠ›ã€æ’ä»¶ç”Ÿæ€ä¸å¦‚ Rollup å…¨é¢ï¼ˆå¯ç»“åˆä½¿ç”¨ï¼šesbuild åšè½¬è¯‘ï¼ŒRollup åšæ‰“åŒ…/ä¼˜åŒ– =&gt; viteï¼‰ã€‚</li>
</ul>
<h2 data-id="heading-2">Rollup å·¥ä½œæµç¨‹</h2>
<ol>
<li>â€‹**è¾“å…¥ï¼ˆentryï¼‰**â€‹ï¼šæŒ‡å®šå…¥å£æ–‡ä»¶ã€‚</li>
<li>â€‹<strong>è§£æä¾èµ–</strong>â€‹ï¼šåŸºäº ES Module é™æ€åˆ†æ <code>import</code>/<code>export</code>ï¼Œå¹¶é€šè¿‡æ’ä»¶è§£æ node_modulesï¼ˆ<code>@rollup/plugin-node-resolve</code>ï¼‰ã€ CommonJSï¼ˆ<code>@rollup/plugin-commonjs</code>ï¼‰ç­‰ã€‚</li>
<li>â€‹<strong>è½¬æ¢</strong>â€‹ï¼šæ’ä»¶å¯å¯¹æ¨¡å—åšè½¬æ¢ï¼ˆTS -&gt; JSã€JSX -&gt; JSã€æ›¿æ¢ç¯å¢ƒå˜é‡ç­‰ï¼‰ã€‚</li>
<li>â€‹<strong>åˆå¹¶ä¸é™æ€åˆ†æ</strong>â€‹ï¼šRollup æ„å»ºæ¨¡å—å›¾ï¼Œå†³å®šå“ªäº›å¯¼å‡ºè¢«å¼•ç”¨ï¼ˆç”¨äº Tree-shakingï¼‰ã€‚</li>
<li>â€‹<strong>ç”Ÿæˆ chunks / assets</strong>â€‹ï¼šæŒ‰é…ç½®è¾“å‡º JS chunkã€CSS / images ç­‰é™æ€èµ„äº§ã€‚</li>
<li>â€‹<strong>å‹ç¼© / äº§å‡º sourcemap</strong>â€‹ï¼šå¯ç”¨ terser ç­‰åšæœ€ç»ˆå‹ç¼©ã€‚</li>
</ol>
<h2 data-id="heading-3">å¸¸ç”¨æ ¸å¿ƒé…ç½®é¡¹ï¼ˆrollup.config.jsï¼‰</h2>
<pre><code class="hljs language-JavaScript" lang="JavaScript"><span class="hljs-keyword">import</span> resolve <span class="hljs-keyword">from</span> <span class="hljs-string">'@rollup/plugin-node-resolve'</span>;
<span class="hljs-keyword">import</span> commonjs <span class="hljs-keyword">from</span> <span class="hljs-string">'@rollup/plugin-commonjs'</span>;
<span class="hljs-keyword">import</span> json <span class="hljs-keyword">from</span> <span class="hljs-string">'@rollup/plugin-json'</span>;
<span class="hljs-keyword">import</span> { terser } <span class="hljs-keyword">from</span> <span class="hljs-string">'rollup-plugin-terser'</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {
  <span class="hljs-attr">input</span>: <span class="hljs-string">'src/index.js'</span>,        <span class="hljs-comment">// å…¥å£</span>
  <span class="hljs-attr">external</span>: [<span class="hljs-string">'react'</span>],         <span class="hljs-comment">// ä¸æ‰“åŒ…çš„å¤–éƒ¨ä¾èµ–ï¼ˆåº“é€šå¸¸ä¼šæ ‡è®° peerDependenciesï¼‰</span>
  <span class="hljs-attr">plugins</span>: [
    <span class="hljs-title function_">resolve</span>(),                 <span class="hljs-comment">// è§£æ node_modules ä¸­çš„åŒ…</span>
    <span class="hljs-title function_">commonjs</span>(),                <span class="hljs-comment">// è½¬æ¢ CommonJS -&gt; ESM</span>
    <span class="hljs-comment">// å…¶ä»–æ’ä»¶ï¼šbabel/typescript/esbuild/postcss ç­‰</span>
    <span class="hljs-title function_">terser</span>(),                  <span class="hljs-comment">// å‹ç¼©ï¼ˆåªåœ¨ prodï¼‰</span>
  ],
  <span class="hljs-attr">output</span>: [
    {
      <span class="hljs-attr">file</span>: <span class="hljs-string">'dist/index.esm.js'</span>,
      <span class="hljs-attr">format</span>: <span class="hljs-string">'es'</span>,            <span class="hljs-comment">// ESM</span>
      <span class="hljs-attr">sourcemap</span>: <span class="hljs-literal">true</span>,
    },
    {
      <span class="hljs-attr">file</span>: <span class="hljs-string">'dist/index.cjs.js'</span>,
      <span class="hljs-attr">format</span>: <span class="hljs-string">'cjs'</span>,           <span class="hljs-comment">// CommonJS</span>
      <span class="hljs-attr">sourcemap</span>: <span class="hljs-literal">true</span>,
    }
  ]
};
</code></pre>
<h3 data-id="heading-4">è¾“å‡ºæ ¼å¼ï¼ˆoutput.formatï¼‰è¯´æ˜</h3>
<ul>
<li><code>es</code> / <code>esm</code>ï¼šES Moduleï¼Œç°ä»£æ‰“åŒ…å™¨æˆ– Nodeï¼ˆ&gt;=æ”¯æŒ ESMï¼‰ä½¿ç”¨ã€‚æ¨èç”¨äºåº“çš„æ¨¡å—åŒ–è¾“å‡ºã€‚</li>
<li><code>cjs</code>ï¼šCommonJSï¼Œç”¨äº Node æˆ–è€å¼æ‰“åŒ…æ¶ˆè´¹è€…ã€‚</li>
<li><code>umd</code>ï¼šé€šç”¨æ¨¡å—å®šä¹‰ï¼ˆUMDï¼‰ï¼Œé€‚åˆç›´æ¥åœ¨æµè§ˆå™¨é€šè¿‡ <code>&lt;script&gt;</code> ä½¿ç”¨ï¼ˆé€šå¸¸éœ€è¦ <code>name</code> + <code>globals</code>ï¼‰ã€‚</li>
<li><code>iife</code>ï¼šç«‹å³è°ƒç”¨å‡½æ•°è¡¨è¾¾å¼ï¼Œå•æ–‡ä»¶æµè§ˆå™¨è„šæœ¬ï¼ˆä¸ä¾èµ–æ¨¡å—åŠ è½½å™¨ï¼‰ã€‚</li>
<li><code>amd</code> / <code>system</code>ï¼šå¾ˆå°‘ç”¨ï¼Œåˆ†åˆ«ä¸º AMD å’Œ SystemJS æ ¼å¼ã€‚</li>
</ul>
<p>å¦‚æœåšåº“ï¼Œä¸€èˆ¬è¾“å‡º <code>es</code> + <code>cjs</code>ï¼ˆå¹¶å¯é¢å¤–è¾“å‡º <code>umd</code> åšæµè§ˆå™¨å…¼å®¹ï¼‰ã€‚</p>
<h3 data-id="heading-5">external ä¸ globals</h3>
<ul>
<li><code>external</code>ï¼šå‘Šè¯‰ Rollup å“ªäº›æ¨¡å—åº”è§†ä¸ºå¤–éƒ¨ä¾èµ–ï¼Œä¸ä¼šè¢«æ‰“åŒ…è¿› bundleï¼ˆé€šå¸¸å¯¹ library å¾ˆé‡è¦ï¼‰ã€‚ä¾‹ï¼š<code>external: ['react', 'react-dom']</code>ã€‚</li>
<li><code>output.globals</code>ï¼šå½“ output.format ä¸º <code>umd</code>/<code>iife</code> æ—¶ï¼Œéœ€è¦æŒ‡å®šå¤–éƒ¨åŒ…åœ¨æµè§ˆå™¨ä¸‹çš„å…¨å±€å˜é‡åï¼Œä¾‹å¦‚ <code>{ react: 'React' }</code>ã€‚</li>
</ul>
<h3 data-id="heading-6">Tree-shakingï¼ˆæ‘‡æ ‘ä¼˜åŒ–ï¼‰</h3>
<ul>
<li>Rollup åŸºäº ESM çš„é™æ€ç»“æ„åˆ¤æ–­å“ªäº›å¯¼å‡ºå¯åˆ ï¼›ç›¸æ¯”åŸºäº AST çš„åå¤„ç†å·¥å…·ï¼ŒRollup çš„ç²¾åº¦å¾ˆé«˜ã€‚</li>
<li>é‡è¦é…ç½®ï¼š
<ul>
<li><code>treeshake: true | { moduleSideEffects: boolean | string[], propertyReadSideEffects: boolean }</code></li>
<li><code>moduleSideEffects</code> å¯¹åº” package.json çš„ <code>sideEffects</code> å­—æ®µï¼šæ­£ç¡®å£°æ˜èƒ½è®© Rollup æ›´æ¿€è¿›åœ°ç§»é™¤æ— ç”¨æ¨¡å—ã€‚</li>
</ul>
</li>
<li>â€‹<strong>å»ºè®®</strong>â€‹ï¼šåœ¨ <code>package.json</code> ä¸­ç»´æŠ¤ <code>sideEffects</code>ï¼Œå¯¹äºä¸ä¼šäº§ç”Ÿå‰¯ä½œç”¨çš„æ–‡ä»¶æˆ–åŒ…æ ‡æ³¨ä¸º falseï¼ˆæˆ–åˆ—å‡ºé‚£äº›æœ‰å‰¯ä½œç”¨çš„æ–‡ä»¶ï¼‰ã€‚</li>
</ul>
<h3 data-id="heading-7">Code-Splittingï¼ˆä»£ç åˆ†å‰²ï¼‰</h3>
<ul>
<li>Rollup æ”¯æŒå¤šå…¥å£å’ŒåŠ¨æ€ <code>import()</code> ä»¥ç”Ÿæˆå¤šä¸ª chunkã€‚</li>
<li>å¸¸ç”¨é…ç½®ï¼š
<ul>
<li><code>input</code> å¯ä»¥æ˜¯æ•°ç»„æˆ–å¯¹è±¡ï¼š<code>input: { main: 'src/main.js', admin: 'src/admin.js' }</code>ï¼Œä¼šç”Ÿæˆå¤šä¸ªå…¥å£ chunkã€‚</li>
<li><code>output.manualChunks</code>ï¼šæ‰‹åŠ¨æ§åˆ¶ chunk åˆ’åˆ†ï¼ˆæŠŠå¤§å‹ä¾èµ–æ‹†å‡º vendor chunk ç­‰ï¼‰ã€‚</li>
</ul>
</li>
</ul>
<p>ç¤ºä¾‹ <code>manualChunks</code>ï¼š</p>
<pre><code class="hljs language-JavaScript" lang="JavaScript"><span class="hljs-attr">output</span>: {
  <span class="hljs-attr">dir</span>: <span class="hljs-string">'dist'</span>,
  <span class="hljs-attr">format</span>: <span class="hljs-string">'esm'</span>,
  <span class="hljs-title function_">manualChunks</span>(<span class="hljs-params">id</span>) {
    <span class="hljs-keyword">if</span> (id.<span class="hljs-title function_">includes</span>(<span class="hljs-string">'node_modules'</span>)) {
      <span class="hljs-keyword">return</span> <span class="hljs-string">'vendor'</span>;
    }
  }
}
</code></pre>
<h2 data-id="heading-8">æ’ä»¶ç”Ÿæ€ï¼ˆå¸¸ç”¨æ’ä»¶ï¼‰</h2>
<p>åŸºæœ¬è§£æ/è½¬æ¢ï¼š</p>
<ul>
<li><code>@rollup/plugin-node-resolve</code>ï¼šè§£æ node_modulesï¼Œæ”¯æŒ <code>browser</code>, <code>extensions</code> ç­‰é€‰é¡¹ã€‚</li>
<li><code>@rollup/plugin-commonjs</code>ï¼šæŠŠ CommonJS æ¨¡å—è½¬ä¸º ESMï¼ˆä¸€å®šè¦æ”¾åœ¨ resolve ä¹‹åï¼‰ã€‚</li>
<li><code>@rollup/plugin-json</code>ï¼šå…è®¸ <code>import data from './data.json'</code>ã€‚</li>
</ul>
<p>ç¼–è¯‘/è½¬è¯‘ï¼š</p>
<ul>
<li><code>@rollup/plugin-babel</code>ï¼šBabel è½¬è¯‘ï¼ˆé…åˆ preset-envï¼‰ã€‚</li>
<li><code>@rollup/plugin-typescript</code>ï¼šå®˜æ–¹çš„ TS æ”¯æŒï¼ˆä½†å¸¸ç”¨ <code>rollup-plugin-typescript2</code>ï¼Œå› ä¸ºæ›´æˆç†Ÿå¹¶æ”¯æŒ declaration è¾“å‡ºï¼‰ã€‚</li>
<li><code>rollup-plugin-esbuild</code> / <code>@rollup/plugin-esbuild</code>ï¼šä½¿ç”¨ esbuild åšè¶…å¿«è½¬è¯‘/TS -&gt; JSï¼ˆæ¨èç”¨äºæé«˜æ„å»ºé€Ÿåº¦ï¼‰ã€‚</li>
</ul>
<p>å…¶ä»–å¸¸ç”¨ï¼š</p>
<ul>
<li><code>rollup-plugin-terser</code>ï¼šå‹ç¼© JSã€‚</li>
<li><code>@rollup/plugin-replace</code>ï¼šæ›¿æ¢å˜é‡ï¼ˆä¾‹å¦‚ <code>process.env.NODE_ENV</code>ï¼‰ã€‚</li>
<li><code>@rollup/plugin-alias</code>ï¼šè·¯å¾„åˆ«åã€‚</li>
<li><code>rollup-plugin-postcss</code>ï¼šå¤„ç† CSSï¼ˆæ”¯æŒ CSS Modulesã€extractï¼‰ã€‚</li>
<li><code>rollup-plugin-url</code>ï¼šæŠŠå°å›¾ç‰‡/å­—ä½“è½¬ base64ï¼Œæˆ–å¤åˆ¶ä¸º assetsã€‚</li>
<li><code>rollup-plugin-visualizer</code>ï¼šç”Ÿæˆ bundle å¯è§†åŒ–æŠ¥å‘Šï¼ˆhelpfulï¼‰ã€‚</li>
<li><code>rollup-plugin-serve</code> / <code>rollup-plugin-livereload</code>ï¼šå¼€å‘æ—¶çš„æœ¬åœ°æœåŠ¡ï¼ˆè½»é‡ï¼‰ã€‚</li>
</ul>
<p>â€‹<strong>è¿™æ ·æ’åºæ›´å¥½ç†è§£</strong>â€‹ï¼šé€šå¸¸ä¸º <code>replace</code> â†’ <code>alias</code> â†’ <code>resolve</code> â†’ <code>commonjs</code> â†’ <code>esbuild/babel/ts</code> â†’ <code>postcss</code> â†’ <code>terser</code>ã€‚</p>
<blockquote>
<p>å°¤å…¶ <code>resolve</code> è¦åœ¨ <code>commonjs</code> ä¹‹å‰ï¼Œ<code>commonjs</code> éœ€è¦è½¬æ¢è§£æåˆ°çš„åŒ…ã€‚</p>
</blockquote>
<h2 data-id="heading-9">Vite å…´èµ·</h2>
<p>Vite æŠŠã€Œå¼€å‘æ—¶â€‹<strong>ä¸æ‰“åŒ…</strong>â€‹ã€ç›´æ¥åˆ©ç”¨æµè§ˆå™¨åŸç”Ÿ ESM + ç”¨ esbuild åšä¾èµ–é¢„å¤„ç†ã€å’Œã€Œç”Ÿäº§æ„å»ºä½¿ç”¨ Rollup åšé«˜è´¨é‡æ‰“åŒ…ã€ç»“åˆèµ·æ¥ï¼Œæ—¢å®ç°äº†æå¿«çš„ <code>dev</code> å¯åŠ¨ä¸ HMRï¼Œåˆä¿ç•™äº† Rollup çš„ç”Ÿäº§æ‰“åŒ…èƒ½åŠ›ä¸æ’ä»¶ç”Ÿæ€ã€‚(<a href="https://link.juejin.cn?target=https%3A%2F%2Fvite.dev%2Fguide%2Fwhy%3Futm_source%3Dchatgpt.com" target="_blank" title="https://vite.dev/guide/why?utm_source=chatgpt.com" ref="nofollow noopener noreferrer">vitejs</a>)</p>
<ol>
<li><strong>å¼€å‘æ¨¡å¼ï¼ˆdev serverï¼‰æ˜¯â€œæŒ‰æ¨¡å—æœåŠ¡â€</strong>
<ol>
<li>Vite åœ¨ dev æ¨¡å¼ä¸‹â€‹**ä¸æŠŠåº”ç”¨æ‰“åŒ…æˆä¸€ä¸ªå¤§åŒ…ï¼ˆå¯¹æ¯” webpackï¼‰**â€‹ï¼Œè€Œæ˜¯æŠŠæ¯ä¸ªæºç æ–‡ä»¶æŒ‰ ESM æ¨¡å—åŸæ ·é€šè¿‡å¼€å‘æœåŠ¡å™¨ç›´æ¥å‘ç»™æµè§ˆå™¨ï¼Œæµè§ˆå™¨è´Ÿè´£æ¨¡å—è§£æã€æŒ‰éœ€åŠ è½½ã€‚è¿™æ ·å†·å¯åŠ¨æ— éœ€é¢„æ„å»ºæ•´ä¸ªé¡¹ç›®ï¼Œæå¤§ç¼©çŸ­å¯åŠ¨æ—¶é—´å¹¶ä¿æŒ HMR å¿«é€Ÿã€‚</li>
</ol>
</li>
<li><strong>ä¾èµ–é¢„æ‰“åŒ…ï¼ˆDependency pre-bundlingï¼‰ç”¨ esbuild</strong>
<ol>
<li>ç¬¬ä¸€æ¬¡å¯åŠ¨æ—¶ï¼ŒVite ä¼šç”¨ <strong>esbuild</strong> å°† <code>node_modules</code> ä¸­çš„ä¾èµ–é¢„æ‰“åŒ…ä¸ºèƒ½è¢«æµè§ˆå™¨é«˜æ•ˆåŠ è½½çš„ ESM æ ¼å¼ï¼ˆæ”¾åˆ° <code>.vite/deps</code> ç›®å½•ï¼‰ï¼Œè§£å†³äº† CommonJSã€åŒ…å†…éƒ¨ä¸èƒ½ç›´æ¥ä»¥åŸå§‹å½¢å¼æŒ‰åŸç”Ÿ ESM åŠ è½½çš„é—®é¢˜ï¼ŒåŒæ—¶æå‡åŠ è½½/è§£æé€Ÿåº¦ã€‚è¯¥æ­¥éª¤åªæ˜¯ dev-only ä¼˜åŒ–ã€‚</li>
</ol>
</li>
<li><strong>HMRï¼ˆHot Module Replacementï¼‰åŸºäºåŸç”Ÿ ESM + websocket</strong>
<ol>
<li>Vite åˆ©ç”¨æµè§ˆå™¨çš„ ESM å•æ¨¡å—çƒ­æ›¿æ¢èƒ½åŠ›ï¼Œåªæ›¿æ¢å®é™…å˜æ›´çš„æ¨¡å—å¹¶å¹¿æ’­æ›´æ–°ï¼Œé¿å…å…¨é¡µåˆ·æ–°ï¼›æ¡†æ¶å±‚ï¼ˆæ¯”å¦‚ React/Vueï¼‰ä¼šå¤„ç†å±€éƒ¨çŠ¶æ€çš„ä¿æŒã€‚Vite æä¾› <code>import.meta.hot</code> API ä¾›æ¡†æ¶æˆ–ç”¨æˆ·æ§åˆ¶ HMR è¡Œä¸ºã€‚</li>
</ol>
</li>
<li><strong>ç”Ÿäº§æ„å»ºä½¿ç”¨ Rollup</strong>
<ol>
<li>ä¸Šé¢è¯´çš„éƒ½æ˜¯å¼€å‘ç¯å¢ƒï¼ŒVite çš„ <code>build</code> é˜¶æ®µä½¿ç”¨ Rollup ä½œä¸ºæ‰“åŒ…å™¨ï¼ˆåˆ©ç”¨ Rollup ç²¾å‡†çš„ tree-shakingã€code-splittingã€å’Œæ’ä»¶èƒ½åŠ›ï¼‰ï¼Œå¹¶ç»“åˆ esbuild åšå¿«é€Ÿçš„è½¬è¯‘/å‹ç¼©é€‰é¡¹ï¼ˆæˆ–é€šè¿‡ terser ç­‰ <a href="https://link.juejin.cn?target=https%3A%2F%2Fcn.vite.dev%2Fconfig%2Fbuild-options%23build-minify%25EF%25BC%2589%25E3%2580%2582" target="_blank" title="https://cn.vite.dev/config/build-options#build-minify%EF%BC%89%E3%80%82" ref="nofollow noopener noreferrer">cn.vite.dev/config/builâ€¦</a></li>
</ol>
</li>
<li><strong>æ’ä»¶ç³»ç»ŸåŸºäº Rollup æ’ä»¶æ¥å£æ‰©å±•</strong>
<ol>
<li>Vite çš„æ’ä»¶æ¥å£æ˜¯ Rollup æ’ä»¶çš„è¶…é›†ï¼Œå¾ˆå¤š Rollup æ’ä»¶å¯ä»¥å¤ç”¨ï¼Œä½†ä¸æ˜¯æ‰€æœ‰ Hook åœ¨ devï¼ˆæ—  bundlingï¼‰åœºæ™¯ä¸‹éƒ½é€‚ç”¨ï¼Œæ‰€ä»¥å­˜åœ¨å…¼å®¹æ€§è€ƒè™‘ï¼ˆæœ‰ <code>enforce: 'pre'|'post'</code> æ¥è°ƒæ•´è°ƒç”¨é¡ºåºï¼Œæ’ä»¶ä½œè€…ä¸€èˆ¬è€ƒè™‘ï¼Œå¤§å¤šæ•°æ— éœ€æˆ‘ä»¬å¼€å‘è€…è€ƒè™‘ï¼‰ã€‚</li>
</ol>
</li>
</ol>
<h3 data-id="heading-10">Vite æ ¸å¿ƒé…ç½®ï¼ˆvite.config.tsï¼‰</h3>
<pre><code class="hljs language-JavaScript" lang="JavaScript"><span class="hljs-keyword">import</span> { defineConfig } <span class="hljs-keyword">from</span> <span class="hljs-string">'vite'</span>;
<span class="hljs-keyword">import</span> vue <span class="hljs-keyword">from</span> <span class="hljs-string">'@vitejs/plugin-vue'</span>;
<span class="hljs-keyword">import</span> vueJsx <span class="hljs-keyword">from</span> <span class="hljs-string">'@vitejs/plugin-vue-jsx'</span>;
<span class="hljs-keyword">import</span> path <span class="hljs-keyword">from</span> <span class="hljs-string">'path'</span>;
<span class="hljs-keyword">import</span> <span class="hljs-title class_">AutoImport</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'unplugin-auto-import/vite'</span>;
<span class="hljs-keyword">import</span> <span class="hljs-title class_">Components</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'unplugin-vue-components/vite'</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">ElementPlusResolver</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'unplugin-vue-components/resolvers'</span>;
<span class="hljs-keyword">import</span> viteCompression <span class="hljs-keyword">from</span> <span class="hljs-string">'vite-plugin-compression'</span>
<span class="hljs-keyword">import</span> { createSvgIconsPlugin } <span class="hljs-keyword">from</span> <span class="hljs-string">'vite-plugin-svg-icons'</span>;
<span class="hljs-keyword">import</span> viteSvgLoader <span class="hljs-keyword">from</span> <span class="hljs-string">'vite-svg-loader'</span>;
<span class="hljs-keyword">import</span> legacy <span class="hljs-keyword">from</span> <span class="hljs-string">'@vitejs/plugin-legacy'</span>;
<span class="hljs-keyword">import</span> { visualizer } <span class="hljs-keyword">from</span> <span class="hljs-string">'rollup-plugin-visualizer'</span>;

<span class="hljs-comment">// å¯ä»¥ä¼ é€’ä¸€ä¸ªå‡½æ•°(éœ€è¦é¢å¤–å‚æ•°çš„æƒ…å†µä¸‹)ï¼Œä¹Ÿå¯ä»¥ç›´æ¥ä¼ é€’ä¸€ä¸ªå¯¹è±¡</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title function_">defineConfig</span>(<span class="hljs-function">(<span class="hljs-params">{ command, mode }</span>) =&gt;</span> {
  <span class="hljs-keyword">const</span> isDev = command === <span class="hljs-string">'serve'</span>;
  <span class="hljs-keyword">const</span> isProd = command === <span class="hljs-string">'build'</span>;

  <span class="hljs-keyword">return</span> {
    <span class="hljs-attr">root</span>: process.<span class="hljs-title function_">cwd</span>(),
    <span class="hljs-attr">base</span>: <span class="hljs-string">'/'</span>, <span class="hljs-comment">// å‘å¸ƒæ—¶æ ¹æ®éœ€æ±‚æ”¹ä¸º CDN åœ°å€æˆ–ç›¸å¯¹è·¯å¾„</span>
    <span class="hljs-attr">resolve</span>: {
      <span class="hljs-attr">alias</span>: {
        <span class="hljs-string">'@'</span>: path.<span class="hljs-title function_">resolve</span>(__dirname, <span class="hljs-string">'src'</span>),
        <span class="hljs-string">'~'</span>: path.<span class="hljs-title function_">resolve</span>(__dirname, <span class="hljs-string">'src'</span>),
      },
      <span class="hljs-attr">extensions</span>: [<span class="hljs-string">'.mjs'</span>, <span class="hljs-string">'.js'</span>, <span class="hljs-string">'.ts'</span>, <span class="hljs-string">'.jsx'</span>, <span class="hljs-string">'.tsx'</span>, <span class="hljs-string">'.json'</span>, <span class="hljs-string">'.vue'</span>],
    },

    <span class="hljs-attr">plugins</span>: [ <span class="hljs-comment">// æ§åˆ¶é¢„æ‰“åŒ…å“ªäº›ä¾èµ–ï¼ˆæœ‰é—®é¢˜çš„ CJS åŒ…éœ€è¦æ‰‹åŠ¨ include/excludeï¼‰</span>
      <span class="hljs-comment">// Vue3 SFC æ”¯æŒ</span>
      <span class="hljs-title function_">vue</span>(),

      <span class="hljs-comment">// Vue3 JSX æ”¯æŒ</span>
      <span class="hljs-title function_">vueJsx</span>(),

      <span class="hljs-comment">// SVG æ–‡ä»¶ç›´æ¥å½“ Vue ç»„ä»¶ä½¿ç”¨ï¼ˆé€‚åˆå°å›¾æ ‡ï¼‰</span>
      <span class="hljs-title function_">viteSvgLoader</span>(),

      <span class="hljs-comment">// svg-spriteï¼ˆæŒ‰éœ€åˆå¹¶ svgï¼Œé€‚åˆå›¾æ ‡åº“ï¼‰</span>
      <span class="hljs-title function_">createSvgIconsPlugin</span>({
        <span class="hljs-comment">// åˆ¶å®šéœ€è¦ç¼“å­˜çš„å›¾æ ‡æ–‡ä»¶å¤¹</span>
        <span class="hljs-attr">iconDirs</span>: [path.<span class="hljs-title function_">resolve</span>(process.<span class="hljs-title function_">cwd</span>(), <span class="hljs-string">'src/icons'</span>)],
        <span class="hljs-attr">symbolId</span>: <span class="hljs-string">'icon-[dir]-[name]'</span>,
        <span class="hljs-attr">svgoOptions</span>: isProd, <span class="hljs-comment">// ç”Ÿäº§æ—¶è¿›è¡Œ svgo ä¼˜åŒ–</span>
      }),
      
      <span class="hljs-comment">// å‹ç¼©</span>
      <span class="hljs-title function_">viteCompression</span>({
        <span class="hljs-attr">algorithm</span>: <span class="hljs-string">'gzip'</span>,
        <span class="hljs-attr">ext</span>: <span class="hljs-string">'.gz'</span>,
        <span class="hljs-attr">threshold</span>: <span class="hljs-number">10240</span> <span class="hljs-comment">// 10kB ä»¥ä¸Šæ‰å‹ç¼©</span>
      }),
      <span class="hljs-title function_">viteCompression</span>({
        <span class="hljs-attr">algorithm</span>: <span class="hljs-string">'brotliCompress'</span>,
        <span class="hljs-attr">ext</span>: <span class="hljs-string">'.br'</span>,
        <span class="hljs-attr">threshold</span>: <span class="hljs-number">10240</span>
      })

      <span class="hljs-comment">// è‡ªåŠ¨æŒ‰éœ€å¯¼å…¥ Vue Composition API / Vue Router / Pinia ç­‰</span>
      <span class="hljs-title class_">AutoImport</span>({
        <span class="hljs-attr">imports</span>: [
          <span class="hljs-string">'vue'</span>,
          <span class="hljs-string">'vue-router'</span>,
          <span class="hljs-string">'pinia'</span>,
          {
            <span class="hljs-comment">// ä½ å¯ä»¥åœ¨è¿™é‡Œè‡ªå·±æ·»åŠ åŒ…çš„è‡ªåŠ¨å¯¼å…¥</span>
            <span class="hljs-attr">axios</span>: [
              [<span class="hljs-string">'default'</span>, <span class="hljs-string">'axios'</span>]
            ]
          }
        ],
        <span class="hljs-attr">dts</span>: <span class="hljs-string">'src/auto-imports.d.ts'</span>,
        <span class="hljs-attr">eslintrc</span>: {
          <span class="hljs-attr">enabled</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// ç”Ÿæˆ .eslintrc-auto-import.jsonï¼ˆå¯é€‰ï¼‰</span>
          <span class="hljs-attr">filepath</span>: <span class="hljs-string">'./.eslintrc-auto-import.json'</span>,
          <span class="hljs-attr">globalsPropValue</span>: <span class="hljs-literal">true</span>
        }
      }),

      <span class="hljs-comment">// è‡ªåŠ¨æ³¨å†Œç»„ä»¶ï¼ˆæŒ‰éœ€åŠ è½½ UI ç»„ä»¶åº“ï¼Œä¾‹å¦‚ Element Plusï¼‰</span>
      <span class="hljs-title class_">Components</span>({
        <span class="hljs-attr">dirs</span>: [<span class="hljs-string">'src/components'</span>],
        <span class="hljs-attr">extensions</span>: [<span class="hljs-string">'vue'</span>, <span class="hljs-string">'md'</span>],
        <span class="hljs-attr">dts</span>: <span class="hljs-string">'src/components.d.ts'</span>,
        <span class="hljs-attr">resolvers</span>: [
          <span class="hljs-comment">// ä¾‹ï¼šElement Plus è‡ªåŠ¨æŒ‰éœ€å¼•å…¥</span>
          <span class="hljs-title class_">ElementPlusResolver</span>()
        ]
      }),

      <span class="hljs-comment">// legacy æ”¯æŒï¼ˆå¦‚æœéœ€è¦æ”¯æŒæ—§æµè§ˆå™¨ï¼‰</span>
      <span class="hljs-title function_">legacy</span>({
        <span class="hljs-attr">targets</span>: [<span class="hljs-string">'defaults'</span>, <span class="hljs-string">'not IE 11'</span>] <span class="hljs-comment">// æ ¹æ®é¡¹ç›®å…¼å®¹æ€§è°ƒæ•´</span>
      }),

      <span class="hljs-comment">// åœ¨ç”Ÿäº§æ„å»ºæ—¶ç”Ÿæˆ bundle åˆ†ææŠ¥å‘Šï¼ˆå¯é€‰ï¼‰</span>
      isProd &amp;&amp; <span class="hljs-title function_">visualizer</span>({
        <span class="hljs-attr">filename</span>: <span class="hljs-string">'./dist/stats.html'</span>,
        <span class="hljs-attr">open</span>: <span class="hljs-literal">false</span>,
        <span class="hljs-attr">gzipSize</span>: <span class="hljs-literal">true</span>
      })
    ].<span class="hljs-title function_">filter</span>(<span class="hljs-title class_">Boolean</span>),

    <span class="hljs-comment">// å¼€å‘æœåŠ¡å™¨é…ç½®</span>
    <span class="hljs-attr">server</span>: {
      <span class="hljs-attr">host</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// å¤–ç½‘å¯è®¿é—®ï¼ˆå®¹å™¨/VM å¼€å‘æ—¶æœ‰ç”¨ï¼‰</span>
      <span class="hljs-attr">port</span>: <span class="hljs-number">5173</span>,
      <span class="hljs-attr">open</span>: <span class="hljs-literal">false</span>,
      <span class="hljs-attr">strictPort</span>: <span class="hljs-literal">false</span>,
      <span class="hljs-attr">hmr</span>: {
        <span class="hljs-attr">overlay</span>: <span class="hljs-literal">true</span>
      },
      <span class="hljs-attr">proxy</span>: {
        <span class="hljs-comment">// ç¤ºä¾‹ï¼šå¼€å‘ä»£ç†è½¬å‘ /api åˆ°åç«¯</span>
        <span class="hljs-string">'/api'</span>: {
          <span class="hljs-attr">target</span>: <span class="hljs-string">'http://127.0.0.1:7001'</span>,
          <span class="hljs-attr">changeOrigin</span>: <span class="hljs-literal">true</span>,
          <span class="hljs-attr">rewrite</span>: <span class="hljs-function">(<span class="hljs-params">p</span>) =&gt;</span> p.<span class="hljs-title function_">replace</span>(<span class="hljs-regexp">/^\/api/</span>, <span class="hljs-string">''</span>),
          <span class="hljs-attr">secure</span>: <span class="hljs-literal">false</span>,
          <span class="hljs-attr">ws</span>: <span class="hljs-literal">true</span>
        }
      },
      <span class="hljs-attr">fs</span>: {
        <span class="hljs-comment">// å¦‚æœæ˜¯ monorepoï¼Œéœ€è¦å…è®¸è®¿é—®å·¥ä½œåŒºå¤–çš„æ–‡ä»¶å¤¹</span>
        <span class="hljs-attr">allow</span>: [path.<span class="hljs-title function_">resolve</span>(__dirname, <span class="hljs-string">'.'</span>)],
      }
    },

    <span class="hljs-comment">// ä¾èµ–é¢„æ„å»ºï¼Œæ§åˆ¶é¢„æ‰“åŒ…å“ªäº›ä¾èµ–ï¼ˆæœ‰é—®é¢˜çš„ CJS åŒ…éœ€è¦æ‰‹åŠ¨ include/excludeï¼‰</span>
    <span class="hljs-attr">optimizeDeps</span>: {
      <span class="hljs-comment">// ç”Ÿäº§é¢„æ„å»ºä¼šä½¿ç”¨ esbuildï¼ŒæŠŠ node_modules ä¸­çš„åŒ…è½¬ä¸º ESMï¼Œæé«˜ dev æ€§èƒ½</span>
      <span class="hljs-attr">include</span>: [
        <span class="hljs-string">'vue'</span>,
        <span class="hljs-string">'vue-router'</span>,
        <span class="hljs-string">'pinia'</span>,
        <span class="hljs-string">'axios'</span>,
        <span class="hljs-string">'lodash-es'</span>
      ],
      <span class="hljs-comment">// å¦‚æœæŸäº›åŒ…æœ‰é—®é¢˜ï¼Œå¯æ’é™¤ï¼Œå¼ºåˆ¶è®© Rollup åœ¨ build æ—¶å¤„ç†</span>
      <span class="hljs-attr">exclude</span>: [
        <span class="hljs-comment">// 'some-cjs-only-package'</span>
      ],
      <span class="hljs-attr">esbuildOptions</span>: {
        <span class="hljs-comment">// å¦‚æœä½ éœ€è¦æ³¨å…¥ polyfill æˆ– target</span>
        <span class="hljs-attr">target</span>: <span class="hljs-string">'es2018'</span>,
      }
    },

    <span class="hljs-comment">// å…¨å±€å®šä¹‰ã€æ„å»ºé€‰é¡¹</span>
    <span class="hljs-attr">define</span>: {
      <span class="hljs-attr">__APP_VERSION__</span>: <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(process.<span class="hljs-property">env</span>.<span class="hljs-property">npm_package_version</span>),
      <span class="hljs-string">'process.env'</span>: {}
    },

    <span class="hljs-comment">// CSS ç›¸å…³é…ç½®ï¼ˆé¢„å¤„ç†å™¨ã€æ¨¡å—åŒ–ç­‰ï¼‰</span>
    <span class="hljs-attr">css</span>: {
      <span class="hljs-attr">preprocessorOptions</span>: {
        <span class="hljs-attr">scss</span>: {
          <span class="hljs-attr">additionalData</span>: <span class="hljs-string">`@import "@/styles/variables.scss";`</span>
        }
      },
      <span class="hljs-attr">modules</span>: {
        <span class="hljs-comment">// CSS Modules å‘½åè§„åˆ™</span>
        <span class="hljs-attr">generateScopedName</span>: isProd ? <span class="hljs-string">'[hash:base64:8]'</span> : <span class="hljs-string">'[name]__[local]__[hash:base64:5]'</span>
      },
      <span class="hljs-attr">postcss</span>: {
        <span class="hljs-comment">// å¯é…ç½® autoprefixer / postcss-preset-env ç­‰</span>
      }
    },

    <span class="hljs-comment">// æ„å»ºï¼ˆç”Ÿäº§ï¼‰ç›¸å…³ï¼Œåº•å±‚ä½¿ç”¨ Rollup</span>
    <span class="hljs-attr">build</span>: {
      <span class="hljs-attr">target</span>: <span class="hljs-string">'es2018'</span>,
      <span class="hljs-attr">outDir</span>: <span class="hljs-string">'dist'</span>,
      <span class="hljs-attr">assetsDir</span>: <span class="hljs-string">'assets'</span>,
      <span class="hljs-attr">sourcemap</span>: <span class="hljs-literal">false</span>,
      <span class="hljs-attr">minify</span>: <span class="hljs-string">'esbuild'</span>, <span class="hljs-comment">// esbuild(é»˜è®¤å€¼) æ›´å¿«ï¼›å¦‚æœæƒ³å‹ç¼©å¾—æ›´å°å¯æ”¹ä¸º 'terser'</span>
      <span class="hljs-attr">cssCodeSplit</span>: <span class="hljs-literal">true</span>,
      <span class="hljs-attr">rollupOptions</span>: {
        <span class="hljs-comment">// external å¯ç”¨äºåº“æ¨¡å¼ï¼Œåº”ç”¨ä¸€èˆ¬ä¸ç”¨ external</span>
        <span class="hljs-comment">// external: ['vue'],</span>
        <span class="hljs-attr">output</span>: {
          <span class="hljs-comment">// æ‰‹åŠ¨åˆ†åŒ…ï¼šæŠŠ node_modules å…¨éƒ¨ç®—ä½œ vendor</span>
          <span class="hljs-title function_">manualChunks</span>(<span class="hljs-params">id</span>) {
            <span class="hljs-keyword">if</span> (id.<span class="hljs-title function_">includes</span>(<span class="hljs-string">'node_modules'</span>)) {
              <span class="hljs-comment">// å¯ä»¥æŒ‰ lib åæ‹†åˆ† vendorï¼ˆä¾‹å¦‚ element-plus å•ç‹¬ chunkï¼‰</span>
              <span class="hljs-keyword">if</span> (id.<span class="hljs-title function_">includes</span>(<span class="hljs-string">'element-plus'</span>)) <span class="hljs-keyword">return</span> <span class="hljs-string">'vendor_elementplus'</span>;
              <span class="hljs-keyword">if</span> (id.<span class="hljs-title function_">includes</span>(<span class="hljs-string">'vue'</span>)) <span class="hljs-keyword">return</span> <span class="hljs-string">'vendor_vue'</span>;
              <span class="hljs-keyword">return</span> <span class="hljs-string">'vendor'</span>;
            }
          },
          <span class="hljs-attr">entryFileNames</span>: <span class="hljs-string">'assets/js/[name]-[hash].js'</span>,
          <span class="hljs-attr">chunkFileNames</span>: <span class="hljs-string">'assets/js/chunks/[name]-[hash].js'</span>,
          <span class="hljs-attr">assetFileNames</span>: <span class="hljs-function">(<span class="hljs-params">assetInfo</span>) =&gt;</span> {
              <span class="hljs-comment">// å›¾ç‰‡æ–‡ä»¶</span>
              <span class="hljs-keyword">if</span> (<span class="hljs-regexp">/\.(png|jpe?g|svg|gif|tiff|bmp|ico|webp)$/i</span>.<span class="hljs-title function_">test</span>(assetInfo.<span class="hljs-property">names</span>[<span class="hljs-number">0</span>] || <span class="hljs-string">''</span>)) {
                <span class="hljs-keyword">return</span> <span class="hljs-string">`assets/images/[name]-[hash][extname]`</span>
              }
    
              <span class="hljs-comment">// å­—ä½“æ–‡ä»¶</span>
              <span class="hljs-keyword">if</span> (<span class="hljs-regexp">/\.(woff2?|eot|ttf|otf)$/i</span>.<span class="hljs-title function_">test</span>(assetInfo.<span class="hljs-property">names</span>[<span class="hljs-number">0</span>] || <span class="hljs-string">''</span>)) {
                <span class="hljs-keyword">return</span> <span class="hljs-string">`assets/fonts/[name]-[hash][extname]`</span>
              }
    
              <span class="hljs-comment">// CSS æ–‡ä»¶</span>
              <span class="hljs-keyword">if</span> (<span class="hljs-regexp">/\.css$/i</span>.<span class="hljs-title function_">test</span>(assetInfo.<span class="hljs-property">names</span>[<span class="hljs-number">0</span>] || <span class="hljs-string">''</span>)) {
                <span class="hljs-keyword">return</span> <span class="hljs-string">`assets/css/[name]-[hash][extname]`</span>
              }
    
              <span class="hljs-comment">// å…¶ä»–èµ„æºæ–‡ä»¶</span>
              <span class="hljs-keyword">return</span> <span class="hljs-string">`assets/[name]-[hash][extname]`</span>
          },
        }
      },
      <span class="hljs-comment">// ç”Ÿäº§æ„å»ºçš„å¹¶è¡Œåº¦æ§åˆ¶ã€chunk å¤§å°é™åˆ¶ç­‰</span>
      <span class="hljs-attr">brotliSize</span>: <span class="hljs-literal">true</span>,
      <span class="hljs-comment">// chunkSizeWarningLimit: 1500,</span>
    },

    <span class="hljs-comment">// SSR / library ç­‰é«˜çº§æ¨¡å¼å¯ä»¥åœ¨è¿™é‡Œé…ç½®</span>
    <span class="hljs-comment">// ssr: { noExternal: ['some-esm-only-package'] },</span>

    <span class="hljs-comment">// æµ‹è¯•ï¼ˆå¦‚æœä½¿ç”¨ vitestï¼‰</span>
    <span class="hljs-attr">test</span>: {
      <span class="hljs-attr">globals</span>: <span class="hljs-literal">true</span>,
      <span class="hljs-attr">environment</span>: <span class="hljs-string">'jsdom'</span>
    }
  };
});
<span class="hljs-string">``</span><span class="hljs-string">`t resolve from '@rollup/plugin-node-resolve';
import commonjs from '@rollup/plugin-commonjs';
import json from '@rollup/plugin-json';
import { terser } from 'rollup-plugin-terser';

export default {
  input: 'src/index.js',        // å…¥å£
  external: ['react'],         // ä¸æ‰“åŒ…çš„å¤–éƒ¨ä¾èµ–ï¼ˆåº“é€šå¸¸ä¼šæ ‡è®° peerDependenciesï¼‰
  plugins: [
    resolve(),                 // è§£æ node_modules ä¸­çš„åŒ…
    commonjs(),                // è½¬æ¢ CommonJS -&gt; ESM
    Other plugins: babel/typescript/esbuild/postcss, etc.
terser(),t resolve from '@rollup/plugin-node-resolve';
import commonjs from '@rollup/plugin-commonjs';
import json from '@rollup/plugin-json';
import { terser } from 'rollup-plugin-terser';

export default {
  input: 'src/index.js',        // å…¥å£
  external: ['react'],         // ä¸æ‰“åŒ…çš„å¤–éƒ¨ä¾èµ–ï¼ˆåº“é€šå¸¸ä¼šæ ‡è®° peerDependenciesï¼‰
  plugins: [
    resolve(),                 // è§£æ node_modules ä¸­çš„åŒ…
    commonjs(),                // è½¬æ¢ CommonJS -&gt; ESM
    Other plugins: babel/typescript/esbuild/postcss, etc.

import commonjs from '@rollup/plugin-commonjs';
import json from '@rollup/plugin-json';
import { terser } from 'rollup-plugin-terser';

export default {
  input: 'src/index.js',        // å…¥å£
  external: ['react'],         // ä¸æ‰“åŒ…çš„å¤–éƒ¨ä¾èµ–ï¼ˆåº“é€šå¸¸ä¼šæ ‡è®° peerDependenciesï¼‰
  plugins: [
    resolve(),                 // è§£æ node_modules ä¸­çš„åŒ…
    commonjs(),                // è½¬æ¢ CommonJS -&gt; ESM
    Other plugins: babel/typescript/esbuild/postcss, etc.
terser(),
</span></code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[github star åŸºç¡€IO æ–‡ä»¶åœ¨å†…æ ¸ä¸­æ˜¯æ€ä¹ˆè¢«ç®¡ç†çš„ é‡å®šå‘çš„å«ä¹‰ åœ¨è‡ªå®šä¹‰shellä¸­åŠ å…¥é‡å®šå‘]]></title>    <link>https://juejin.cn/post/7579213860571054134</link>    <guid>https://juejin.cn/post/7579213860571054134</guid>    <pubDate>2025-12-03T04:02:55.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7579213860571054134" data-draft-id="7579213860570955830" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="github star åŸºç¡€IO æ–‡ä»¶åœ¨å†…æ ¸ä¸­æ˜¯æ€ä¹ˆè¢«ç®¡ç†çš„ é‡å®šå‘çš„å«ä¹‰ åœ¨è‡ªå®šä¹‰shellä¸­åŠ å…¥é‡å®šå‘"/> <meta itemprop="keywords" content="å‰ç«¯"/> <meta itemprop="datePublished" content="2025-12-03T04:02:55.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å¼€æºä¹‹çœ¼"/> <meta itemprop="url" content="https://juejin.cn/user/55438993800919"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            github star åŸºç¡€IO æ–‡ä»¶åœ¨å†…æ ¸ä¸­æ˜¯æ€ä¹ˆè¢«ç®¡ç†çš„ é‡å®šå‘çš„å«ä¹‰ åœ¨è‡ªå®šä¹‰shellä¸­åŠ å…¥é‡å®šå‘
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/55438993800919/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å¼€æºä¹‹çœ¼
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-03T04:02:55.000Z" title="Wed Dec 03 2025 04:02:55 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-03
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»8åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h3 data-id="heading-0">æ¬¢è¿è®¿é—®æˆ‘çš„ä¸ªäººgithub é¡¹ç›®ä¸ªäººä¸»é¡µ <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FAndyBulushen" title="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FAndyBulushen" target="_blank">github.com/AndyBulusheâ€¦</a> ï¼Œ é‡Œé¢AI å·¥å…·å…¨å…è´¹ã€‚ç¨‹åºå‘˜çš„ç»ä½³å¥½å¸®æ‰‹</h3>
<h3 data-id="heading-1">Taimili è‰¾ç±³è‰ ( ä¸€æ¬¾ä¸“ä¸šçš„ GitHub star ç®¡ç†å’Œgithub åŠ æ˜Ÿæ¶¨æ˜Ÿå·¥å…·taimili.com )</h3>
<p>è‰¾ç±³è‰ æ˜¯ä¸€æ¬¾ä¼˜é›…ä¾¿æ·çš„Â GitHub star ç®¡ç†å’Œgithub åŠ æ˜Ÿæ¶¨æ˜Ÿå·¥å…·ï¼ŒåŸºäº PHP &amp; javascript æ„å»ºï¼Œ èƒ½å¯¹github å¾— star fork follow watch ç®¡ç†å’Œæå‡ï¼Œæœ€é€‚åˆgithub çš„æ·±åº¦ç”¨æˆ·</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7402a775b7a9426b97c818428b54aaaa~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5byA5rqQ5LmL55y8:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765339375&amp;x-signature=aUQYy6OaC613pAIoGMdZVGLAJXc%3D" alt="123455.png" loading="lazy"/></p>
<p>è¦ç†è§£æ–‡ä»¶é‡å®šå‘ï¼Œé¦–å…ˆéœ€è¦æŒæ¡Â <strong>å†…æ ¸ç®¡ç†æ–‡ä»¶çš„åº•å±‚æ¨¡å‹</strong>ï¼Œé‡å®šå‘çš„æœ¬è´¨æ­£æ˜¯åŸºäºè¿™ä¸ªæ¨¡å‹çš„_fd æŒ‡å‘ä¿®æ”¹_ã€‚ä¸‹é¢åˆ†ä¸‰éƒ¨åˆ†é€æ­¥æ‹†è§£ï¼Œæœ€åç»™å‡ºè‡ªå®šä¹‰ Shell ä¸­é‡å®šå‘çš„å®ç°ä»£ç ã€‚</p>
<h2 data-id="heading-2">ä¸€ã€æ–‡ä»¶åœ¨å†…æ ¸ä¸­çš„ç®¡ç†æ¨¡å‹ï¼ˆæ ¸å¿ƒï¼‰</h2>
<p>å†…æ ¸é€šè¿‡Â <strong>ä¸‰å¤§æ ¸å¿ƒç»“æ„</strong>Â ç®¡ç†æ‰€æœ‰æ‰“å¼€çš„æ–‡ä»¶ï¼Œç¡®ä¿è¿›ç¨‹ä¸æ–‡ä»¶çš„è§£è€¦å’Œé«˜æ•ˆå¤ç”¨ï¼Œè¿™æ˜¯ IO æ“ä½œå’Œé‡å®šå‘çš„åŸºç¡€ã€‚</p>
<h3 data-id="heading-3">1. ä¸‰å¤§æ ¸å¿ƒç»“æ„</h3>
<h4 data-id="heading-4">ï¼ˆ1ï¼‰è¿›ç¨‹çº§ï¼šæ–‡ä»¶æè¿°ç¬¦è¡¨ï¼ˆfd tableï¼‰</h4>
<ul>
<li>
<p>æ¯ä¸ªè¿›ç¨‹éƒ½æœ‰ç‹¬ç«‹çš„ã€Œæ–‡ä»¶æè¿°ç¬¦è¡¨ã€ï¼Œæ˜¯è¿›ç¨‹è§†è§’çš„ã€Œæ–‡ä»¶ç´¢å¼•ã€ã€‚</p>
</li>
<li>
<p>è¡¨é¡¹å†…å®¹ï¼šå­˜å‚¨æŒ‡å‘ã€Œæ‰“å¼€æ–‡ä»¶è¡¨ã€çš„æŒ‡é’ˆï¼Œä»¥åŠå°‘é‡è¿›ç¨‹ç§æœ‰æ ‡å¿—ï¼ˆå¦‚ FD_CLOEXECï¼‰ã€‚</p>
</li>
<li>
<p>å…³é”®ç‰¹æ€§ï¼š</p>
<ul>
<li>
<p>æ–‡ä»¶æè¿°ç¬¦ï¼ˆfdï¼‰æ˜¯è¡¨çš„ç´¢å¼•ï¼Œæ˜¯ä¸€ä¸ªéè´Ÿæ•´æ•°ï¼ˆ<code>0ã€1ã€2ã€3...</code>ï¼‰ã€‚</p>
</li>
<li>
<p>ç³»ç»Ÿé»˜è®¤åˆ†é… 3 ä¸ªæ ‡å‡† fdï¼š</p>
<ul>
<li><code>fd=0</code>ï¼šæ ‡å‡†è¾“å…¥ï¼ˆstdinï¼Œé»˜è®¤æŒ‡å‘ç»ˆç«¯ï¼‰</li>
<li><code>fd=1</code>ï¼šæ ‡å‡†è¾“å‡ºï¼ˆstdoutï¼Œé»˜è®¤æŒ‡å‘ç»ˆç«¯ï¼‰</li>
<li><code>fd=2</code>ï¼šæ ‡å‡†é”™è¯¯ï¼ˆstderrï¼Œé»˜è®¤æŒ‡å‘ç»ˆç«¯ï¼‰</li>
</ul>
</li>
<li>
<p>fd åˆ†é…è§„åˆ™ï¼šä¼˜å…ˆä½¿ç”¨ã€Œæœ€å°çš„æœªä½¿ç”¨ fdã€ã€‚</p>
</li>
</ul>
</li>
</ul>
<h4 data-id="heading-5">ï¼ˆ2ï¼‰å†…æ ¸çº§ï¼šæ‰“å¼€æ–‡ä»¶è¡¨ï¼ˆopen file tableï¼‰</h4>
<ul>
<li>
<p>å†…æ ¸ç»´æŠ¤å…¨å±€çš„ã€Œæ‰“å¼€æ–‡ä»¶è¡¨ã€ï¼Œæ¯ä¸ªè¡¨é¡¹å¯¹åº”ä¸€ä¸ªã€Œæ–‡ä»¶æ‰“å¼€å®ä¾‹ã€ï¼ˆå³ä½¿åŒä¸€ä¸ªæ–‡ä»¶è¢«å¤šæ¬¡æ‰“å¼€ï¼Œä¹Ÿä¼šåˆ›å»ºå¤šä¸ªè¡¨é¡¹ï¼‰ã€‚</p>
</li>
<li>
<p>è¡¨é¡¹å†…å®¹ï¼ˆæ ¸å¿ƒï¼‰ï¼š</p>
<ul>
<li>æŒ‡å‘ã€Œinode è¡¨ã€çš„æŒ‡é’ˆï¼ˆå…³è”å®é™…æ–‡ä»¶ï¼‰ï¼›</li>
<li>æ–‡ä»¶åç§»é‡ï¼ˆoffsetï¼Œä¸‹æ¬¡è¯»å†™çš„ä½ç½®ï¼Œå¦‚<code>lseek</code>ä¿®æ”¹çš„å°±æ˜¯è¿™ä¸ªå€¼ï¼‰ï¼›</li>
<li>æ‰“å¼€æ¨¡å¼ï¼ˆflagsï¼Œå¦‚ O_RDONLYã€O_WRONLYã€O_APPENDï¼‰ï¼›</li>
<li>å¼•ç”¨è®¡æ•°ï¼ˆrefcountï¼Œå¤šå°‘ä¸ª fd æŒ‡å‘è¿™ä¸ªè¡¨é¡¹ï¼‰ã€‚</li>
</ul>
</li>
</ul>
<h4 data-id="heading-6">ï¼ˆ3ï¼‰æ–‡ä»¶ç³»ç»Ÿçº§ï¼šç´¢å¼•èŠ‚ç‚¹è¡¨ï¼ˆinode tableï¼‰</h4>
<ul>
<li>
<p>å­˜å‚¨æ–‡ä»¶çš„ã€Œå…ƒæ•°æ®ã€ï¼ˆä¸æ–‡ä»¶å†…å®¹æ— å…³çš„å±æ€§ï¼‰ï¼Œæ¯ä¸ªæ–‡ä»¶å¯¹åº”å”¯ä¸€ inodeï¼ˆå³ä½¿æ–‡ä»¶åè¢«ä¿®æ”¹ï¼Œinode ä¸å˜ï¼‰ã€‚</p>
</li>
<li>
<p>è¡¨é¡¹å†…å®¹ï¼š</p>
<ul>
<li>æ–‡ä»¶ç±»å‹ï¼ˆæ™®é€šæ–‡ä»¶ã€ç›®å½•ã€è®¾å¤‡æ–‡ä»¶ç­‰ï¼‰ï¼›</li>
<li>æƒé™ï¼ˆr/w/xï¼‰ã€æ‰€æœ‰è€…ã€å¤§å°ã€åˆ›å»º / ä¿®æ”¹æ—¶é—´ï¼›</li>
<li>æ•°æ®å—æŒ‡é’ˆï¼ˆæŒ‡å‘ç£ç›˜ä¸Šå­˜å‚¨æ–‡ä»¶å†…å®¹çš„ç‰©ç†å—ï¼‰ã€‚</li>
</ul>
</li>
</ul>
<h3 data-id="heading-7">2. ä¸‰è€…çš„å…³è”å…³ç³»ï¼ˆå…³é”®ç¤ºä¾‹ï¼‰</h3>
<p>å½“è¿›ç¨‹æ‰§è¡ŒÂ <code>open("test.txt", O_RDONLY)</code>Â æ—¶ï¼Œå†…æ ¸çš„æ‰§è¡Œæµç¨‹ï¼š</p>
<ol>
<li>æŸ¥æ‰¾æ–‡ä»¶ç³»ç»Ÿï¼Œæ‰¾åˆ°<code>test.txt</code>å¯¹åº”çš„ã€Œinodeã€ï¼›</li>
<li>å†…æ ¸åˆ›å»ºä¸€ä¸ªã€Œæ‰“å¼€æ–‡ä»¶è¡¨é¡¹ã€ï¼ŒæŒ‡å‘è¯¥ inodeï¼Œè®¾ç½®åç§»é‡ = 0ã€æ¨¡å¼ = O_RDONLYï¼›</li>
<li>åœ¨è¿›ç¨‹çš„ã€Œfd è¡¨ã€ä¸­ï¼Œåˆ†é…ä¸€ä¸ªæœ€å°æœªä½¿ç”¨çš„ fdï¼ˆå¦‚<code>3</code>ï¼‰ï¼Œè®©å…¶æŒ‡å‘æ–°åˆ›å»ºçš„ã€Œæ‰“å¼€æ–‡ä»¶è¡¨é¡¹ã€ï¼›</li>
<li>è¿”å› fd=3 ç»™è¿›ç¨‹ï¼Œè¿›ç¨‹åç»­é€šè¿‡<code>read(3, ...)</code>æ“ä½œæ–‡ä»¶ã€‚</li>
</ol>
<p><strong>æ ¸å¿ƒç»“è®º</strong>ï¼šè¿›ç¨‹æ“ä½œæ–‡ä»¶çš„æœ¬è´¨æ˜¯ã€Œé€šè¿‡ fd ç´¢å¼•ï¼Œé—´æ¥æ“ä½œå†…æ ¸çš„æ‰“å¼€æ–‡ä»¶è¡¨é¡¹å’Œ inodeã€â€”â€” è¿™æ˜¯é‡å®šå‘çš„åº•å±‚åŸºç¡€ã€‚</p>
<h2 data-id="heading-8">äºŒã€é‡å®šå‘çš„å«ä¹‰ä¸åº•å±‚åŸç†</h2>
<h3 data-id="heading-9">1. é‡å®šå‘çš„æœ¬è´¨</h3>
<p><strong>ä¿®æ”¹è¿›ç¨‹ fd è¡¨ä¸­æŸä¸ª fd çš„æŒ‡å‘</strong>ï¼Œè®©åŸæœ¬æŒ‡å‘ç»ˆç«¯ï¼ˆæˆ–å…¶ä»–æ–‡ä»¶ï¼‰çš„ fdï¼Œè½¬è€ŒæŒ‡å‘ç›®æ ‡æ–‡ä»¶ã€‚</p>
<p>ä¾‹å¦‚ï¼š<code>ls &gt; result.txt</code>Â çš„æœ¬è´¨æ˜¯ã€ŒæŠŠ fd=1ï¼ˆstdoutï¼‰çš„æŒ‡å‘ï¼Œä»ã€Œç»ˆç«¯çš„æ‰“å¼€æ–‡ä»¶è¡¨é¡¹ã€æ”¹æˆã€Œresult.txt çš„æ‰“å¼€æ–‡ä»¶è¡¨é¡¹ã€ã€ã€‚</p>
<h3 data-id="heading-10">2. å¸¸è§é‡å®šå‘ç¬¦å·åŠå«ä¹‰</h3>



































<table><thead><tr><th>ç¬¦å·</th><th>å«ä¹‰</th><th>åº•å±‚æ“ä½œï¼ˆä¿®æ”¹ fd æŒ‡å‘ï¼‰</th></tr></thead><tbody><tr><td><code>cmd &gt; file</code></td><td>æ ‡å‡†è¾“å‡ºé‡å®šå‘ï¼ˆè¦†ç›–æ–‡ä»¶ï¼‰</td><td>å…³é—­ fd=1 â†’ æ‰“å¼€ file â†’ fd=1 æŒ‡å‘ file</td></tr><tr><td><code>cmd &gt;&gt; file</code></td><td>æ ‡å‡†è¾“å‡ºé‡å®šå‘ï¼ˆè¿½åŠ æ–‡ä»¶ï¼‰</td><td>å…³é—­ fd=1 â†’ æ‰“å¼€ fileï¼ˆO_APPENDï¼‰â†’ fd=1 æŒ‡å‘ file</td></tr><tr><td><code>cmd &lt; file</code></td><td>æ ‡å‡†è¾“å…¥é‡å®šå‘ï¼ˆä»æ–‡ä»¶è¯»ï¼Œè€Œéç»ˆç«¯ï¼‰</td><td>å…³é—­ fd=0 â†’ æ‰“å¼€ file â†’ fd=0 æŒ‡å‘ file</td></tr><tr><td><code>cmd 2&gt; file</code></td><td>æ ‡å‡†é”™è¯¯é‡å®šå‘ï¼ˆè¦†ç›–ï¼‰</td><td>å…³é—­ fd=2 â†’ æ‰“å¼€ file â†’ fd=2 æŒ‡å‘ file</td></tr><tr><td><code>cmd 2&gt;&amp;1</code></td><td>æ ‡å‡†é”™è¯¯åˆå¹¶åˆ°æ ‡å‡†è¾“å‡º</td><td>fd=2 æŒ‡å‘ fd=1 å½“å‰æŒ‡å‘çš„æ‰“å¼€æ–‡ä»¶è¡¨é¡¹</td></tr></tbody></table>
<h3 data-id="heading-11">3. é‡å®šå‘çš„åº•å±‚æ‰§è¡Œæµç¨‹ï¼ˆä»¥<code>ls &gt; result.txt</code>ä¸ºä¾‹ï¼‰</h3>
<ol>
<li>Shell è§£æå‘½ä»¤æ—¶ï¼Œè¯†åˆ«åˆ°<code>&gt;</code>é‡å®šå‘ç¬¦å·ï¼›</li>
<li>Shell åˆ›å»ºå­è¿›ç¨‹ï¼ˆforkï¼‰ï¼Œåœ¨å­è¿›ç¨‹ä¸­æ‰§è¡Œä»¥ä¸‹æ“ä½œï¼ša. è°ƒç”¨<code>open("result.txt", O_WRONLY | O_CREAT | O_TRUNC, 0644)</code>ï¼šæ‰“å¼€ï¼ˆæˆ–åˆ›å»ºï¼‰æ–‡ä»¶ï¼Œå¾—åˆ° fd=3ï¼ˆå‡è®¾ï¼‰ï¼›b. è°ƒç”¨<code>dup2(3, 1)</code>ï¼šå°† fd=3 çš„æŒ‡å‘ã€Œå¤åˆ¶ã€ç»™ fd=1ï¼Œæ­¤æ—¶ fd=1 ä¸å†æŒ‡å‘ç»ˆç«¯ï¼Œè½¬è€ŒæŒ‡å‘ result.txtï¼›c. è°ƒç”¨<code>close(3)</code>ï¼šå…³é—­ fd=3ï¼ˆå·²é€šè¿‡ dup2 å®Œæˆé‡å®šå‘ï¼Œfd=3 æ— ç”¨ï¼‰ï¼›d. è°ƒç”¨<code>execvp("ls", ["ls", NULL])</code>ï¼šæ‰§è¡Œ ls å‘½ä»¤ï¼Œls çš„ stdoutï¼ˆfd=1ï¼‰è¾“å‡ºä¼šå†™å…¥ result.txtã€‚</li>
</ol>
<h2 data-id="heading-12">ä¸‰ã€è‡ªå®šä¹‰ Shell ä¸­å®ç°é‡å®šå‘ï¼ˆC è¯­è¨€ç¤ºä¾‹ï¼‰</h2>
<p>è‡ªå®šä¹‰ Shell çš„æ ¸å¿ƒæµç¨‹æ˜¯ã€Œè¯»å‘½ä»¤â†’è§£æå‘½ä»¤â†’æ‰§è¡Œå‘½ä»¤ã€ï¼Œé‡å®šå‘çš„å®ç°éœ€è¦åœ¨ã€Œè§£æã€å’Œã€Œæ‰§è¡Œã€é˜¶æ®µæ·»åŠ é€»è¾‘ã€‚</p>
<h3 data-id="heading-13">1. å…³é”®ç³»ç»Ÿè°ƒç”¨</h3>
<ul>
<li><code>open()</code>ï¼šæ‰“å¼€ / åˆ›å»ºç›®æ ‡æ–‡ä»¶ï¼Œè·å–æ–‡ä»¶æè¿°ç¬¦ï¼›</li>
<li><code>dup2(oldfd, newfd)</code>ï¼šå°† oldfd çš„æŒ‡å‘å¤åˆ¶ç»™ newfdï¼ˆæ ¸å¿ƒé‡å®šå‘å‡½æ•°ï¼‰ï¼›</li>
<li><code>close()</code>ï¼šå…³é—­æ— ç”¨çš„æ–‡ä»¶æè¿°ç¬¦ï¼›</li>
<li><code>fork()</code>ï¼šåˆ›å»ºå­è¿›ç¨‹ï¼ˆé‡å®šå‘å¿…é¡»åœ¨å­è¿›ç¨‹ä¸­æ‰§è¡Œï¼Œé¿å…å½±å“çˆ¶ Shellï¼‰ï¼›</li>
<li><code>execvp()</code>ï¼šæ‰§è¡Œç›®æ ‡å‘½ä»¤ï¼ˆæ›¿æ¢å­è¿›ç¨‹æ˜ åƒï¼‰ã€‚</li>
</ul>
<h3 data-id="heading-14">2. å®Œæ•´å®ç°ä»£ç ï¼ˆæ”¯æŒ<code>&gt;ã€&gt;&gt;ã€&lt;</code>é‡å®šå‘ï¼‰</h3>
<p>c</p>
<p>è¿è¡Œ</p>
<pre><code class="hljs language-c" lang="c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdlib.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;string.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;unistd.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;sys/wait.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;fcntl.h&gt;</span></span>

<span class="hljs-meta">#<span class="hljs-keyword">define</span> MAX_CMD_LEN 1024</span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> MAX_ARG_LEN 64</span>

<span class="hljs-comment">// è§£æå‘½ä»¤è¡Œï¼šåˆ†ç¦»å‘½ä»¤å‚æ•°ã€é‡å®šå‘ç¬¦å·å’Œç›®æ ‡æ–‡ä»¶</span>
<span class="hljs-type">void</span> <span class="hljs-title function_">parse_cmd</span><span class="hljs-params">(<span class="hljs-type">char</span> *cmd, <span class="hljs-type">char</span> **args, <span class="hljs-type">char</span> **infile, <span class="hljs-type">char</span> **outfile, <span class="hljs-type">int</span> *append)</span> {
    <span class="hljs-type">int</span> i = <span class="hljs-number">0</span>;
    *infile = <span class="hljs-literal">NULL</span>;  <span class="hljs-comment">// è¾“å…¥é‡å®šå‘æ–‡ä»¶</span>
    *outfile = <span class="hljs-literal">NULL</span>; <span class="hljs-comment">// è¾“å‡ºé‡å®šå‘æ–‡ä»¶</span>
    *append = <span class="hljs-number">0</span>;     <span class="hljs-comment">// æ˜¯å¦è¿½åŠ ï¼ˆ&gt;&gt;ï¼‰</span>

    <span class="hljs-comment">// åˆ†å‰²å‘½ä»¤è¡Œï¼ˆæŒ‰ç©ºæ ¼åˆ†å‰²ï¼‰</span>
    <span class="hljs-type">char</span> *token = strtok(cmd, <span class="hljs-string">" "</span>);
    <span class="hljs-keyword">while</span> (token != <span class="hljs-literal">NULL</span>) {
        <span class="hljs-keyword">if</span> (<span class="hljs-built_in">strcmp</span>(token, <span class="hljs-string">"&lt;"</span>) == <span class="hljs-number">0</span>) {
            <span class="hljs-comment">// è¾“å…¥é‡å®šå‘ï¼šä¸‹ä¸€ä¸ªtokenæ˜¯è¾“å…¥æ–‡ä»¶</span>
            *infile = strtok(<span class="hljs-literal">NULL</span>, <span class="hljs-string">" "</span>);
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-built_in">strcmp</span>(token, <span class="hljs-string">"&gt;"</span>) == <span class="hljs-number">0</span>) {
            <span class="hljs-comment">// è¾“å‡ºé‡å®šå‘ï¼ˆè¦†ç›–ï¼‰ï¼šä¸‹ä¸€ä¸ªtokenæ˜¯è¾“å‡ºæ–‡ä»¶</span>
            *outfile = strtok(<span class="hljs-literal">NULL</span>, <span class="hljs-string">" "</span>);
            *append = <span class="hljs-number">0</span>;
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-built_in">strcmp</span>(token, <span class="hljs-string">"&gt;&gt;"</span>) == <span class="hljs-number">0</span>) {
            <span class="hljs-comment">// è¾“å‡ºé‡å®šå‘ï¼ˆè¿½åŠ ï¼‰ï¼šä¸‹ä¸€ä¸ªtokenæ˜¯è¾“å‡ºæ–‡ä»¶</span>
            *outfile = strtok(<span class="hljs-literal">NULL</span>, <span class="hljs-string">" "</span>);
            *append = <span class="hljs-number">1</span>;
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-comment">// æ™®é€šå‘½ä»¤å‚æ•°</span>
            args[i++] = token;
        }
        token = strtok(<span class="hljs-literal">NULL</span>, <span class="hljs-string">" "</span>);
    }
    args[i] = <span class="hljs-literal">NULL</span>; <span class="hljs-comment">// execvpè¦æ±‚å‚æ•°åˆ—è¡¨ä»¥NULLç»“å°¾</span>
}

<span class="hljs-comment">// æ‰§è¡Œå‘½ä»¤ï¼ˆåŒ…å«é‡å®šå‘é€»è¾‘ï¼‰</span>
<span class="hljs-type">void</span> <span class="hljs-title function_">execute_cmd</span><span class="hljs-params">(<span class="hljs-type">char</span> **args, <span class="hljs-type">char</span> *infile, <span class="hljs-type">char</span> *outfile, <span class="hljs-type">int</span> append)</span> {
    <span class="hljs-type">pid_t</span> pid = fork();
    <span class="hljs-keyword">if</span> (pid == <span class="hljs-number">-1</span>) {
        perror(<span class="hljs-string">"fork error"</span>);
        <span class="hljs-built_in">exit</span>(EXIT_FAILURE);
    }

    <span class="hljs-keyword">if</span> (pid == <span class="hljs-number">0</span>) { <span class="hljs-comment">// å­è¿›ç¨‹ï¼šæ‰§è¡Œé‡å®šå‘å’Œå‘½ä»¤</span>
        <span class="hljs-comment">// 1. å¤„ç†è¾“å…¥é‡å®šå‘ï¼ˆ&lt;ï¼‰</span>
        <span class="hljs-keyword">if</span> (infile != <span class="hljs-literal">NULL</span>) {
            <span class="hljs-type">int</span> fd = open(infile, O_RDONLY);
            <span class="hljs-keyword">if</span> (fd == <span class="hljs-number">-1</span>) {
                perror(<span class="hljs-string">"open infile error"</span>);
                <span class="hljs-built_in">exit</span>(EXIT_FAILURE);
            }
            <span class="hljs-comment">// å°†fdå¤åˆ¶ç»™fd=0ï¼ˆstdinï¼‰ï¼Œå…³é—­åŸfd</span>
            <span class="hljs-keyword">if</span> (dup2(fd, STDIN_FILENO) == <span class="hljs-number">-1</span>) {
                perror(<span class="hljs-string">"dup2 infile error"</span>);
                <span class="hljs-built_in">exit</span>(EXIT_FAILURE);
            }
            close(fd);
        }

        <span class="hljs-comment">// 2. å¤„ç†è¾“å‡ºé‡å®šå‘ï¼ˆ&gt; æˆ– &gt;&gt;ï¼‰</span>
        <span class="hljs-keyword">if</span> (outfile != <span class="hljs-literal">NULL</span>) {
            <span class="hljs-type">int</span> flags = O_WRONLY | O_CREAT;
            flags |= append ? O_APPEND : O_TRUNC; <span class="hljs-comment">// è¿½åŠ /è¦†ç›–</span>
            <span class="hljs-type">int</span> fd = open(outfile, flags, <span class="hljs-number">0644</span>); <span class="hljs-comment">// æƒé™ï¼šrw-r--r--</span>
            <span class="hljs-keyword">if</span> (fd == <span class="hljs-number">-1</span>) {
                perror(<span class="hljs-string">"open outfile error"</span>);
                <span class="hljs-built_in">exit</span>(EXIT_FAILURE);
            }
            <span class="hljs-comment">// å°†fdå¤åˆ¶ç»™fd=1ï¼ˆstdoutï¼‰ï¼Œå…³é—­åŸfd</span>
            <span class="hljs-keyword">if</span> (dup2(fd, STDOUT_FILENO) == <span class="hljs-number">-1</span>) {
                perror(<span class="hljs-string">"dup2 outfile error"</span>);
                <span class="hljs-built_in">exit</span>(EXIT_FAILURE);
            }
            close(fd);
        }

        <span class="hljs-comment">// 3. æ‰§è¡Œç›®æ ‡å‘½ä»¤ï¼ˆæ›¿æ¢å­è¿›ç¨‹æ˜ åƒï¼‰</span>
        execvp(args[<span class="hljs-number">0</span>], args);
        perror(<span class="hljs-string">"execvp error"</span>); <span class="hljs-comment">// è‹¥execvpè¿”å›ï¼Œè¯´æ˜æ‰§è¡Œå¤±è´¥</span>
        <span class="hljs-built_in">exit</span>(EXIT_FAILURE);
    } <span class="hljs-keyword">else</span> { <span class="hljs-comment">// çˆ¶è¿›ç¨‹ï¼šç­‰å¾…å­è¿›ç¨‹ç»“æŸ</span>
        waitpid(pid, <span class="hljs-literal">NULL</span>, <span class="hljs-number">0</span>);
    }
}

<span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span> {
    <span class="hljs-type">char</span> cmd[MAX_CMD_LEN];
    <span class="hljs-type">char</span> *args[MAX_ARG_LEN];
    <span class="hljs-type">char</span> *infile, *outfile;
    <span class="hljs-type">int</span> append;

    <span class="hljs-built_in">printf</span>(<span class="hljs-string">"=== Custom Shell (support &gt; &gt;&gt; &lt;) ===\n"</span>);
    <span class="hljs-keyword">while</span> (<span class="hljs-number">1</span>) {
        <span class="hljs-built_in">printf</span>(<span class="hljs-string">"shell&gt; "</span>);
        <span class="hljs-comment">// è¯»å–å‘½ä»¤è¡Œï¼ˆå¿½ç•¥ç©ºè¾“å…¥ï¼‰</span>
        <span class="hljs-keyword">if</span> (fgets(cmd, MAX_CMD_LEN, <span class="hljs-built_in">stdin</span>) == <span class="hljs-literal">NULL</span>) {
            <span class="hljs-keyword">break</span>;
        }
        <span class="hljs-comment">// å»é™¤æ¢è¡Œç¬¦ï¼ˆfgetsä¼šè¯»å–æ¢è¡Œï¼‰</span>
        cmd[<span class="hljs-built_in">strcspn</span>(cmd, <span class="hljs-string">"\n"</span>)] = <span class="hljs-string">'\0'</span>;
        <span class="hljs-keyword">if</span> (<span class="hljs-built_in">strcmp</span>(cmd, <span class="hljs-string">"exit"</span>) == <span class="hljs-number">0</span>) { <span class="hljs-comment">// é€€å‡ºå‘½ä»¤</span>
            <span class="hljs-keyword">break</span>;
        }

        <span class="hljs-comment">// è§£æå‘½ä»¤</span>
        parse_cmd(cmd, args, &amp;infile, &amp;outfile, &amp;append);
        <span class="hljs-comment">// æ‰§è¡Œå‘½ä»¤ï¼ˆå«é‡å®šå‘ï¼‰</span>
        execute_cmd(args, infile, outfile, append);
    }

    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}
</code></pre>
<h3 data-id="heading-15">3. ä»£ç è¯´æ˜ä¸æµ‹è¯•</h3>
<h4 data-id="heading-16">ï¼ˆ1ï¼‰æ ¸å¿ƒé€»è¾‘</h4>
<ul>
<li><strong>è§£æé˜¶æ®µ</strong>ï¼š<code>parse_cmd</code>Â å‡½æ•°åˆ†ç¦»å‘½ä»¤å‚æ•°ã€é‡å®šå‘ç¬¦å·å’Œç›®æ ‡æ–‡ä»¶ï¼ˆå¦‚<code>ls &gt;&gt; log.txt</code>Â è§£æä¸º args=[ls], outfile=log.txt, append=1ï¼‰ï¼›</li>
<li><strong>æ‰§è¡Œé˜¶æ®µ</strong>ï¼šå­è¿›ç¨‹ä¸­å…ˆå¤„ç†é‡å®šå‘ï¼ˆä¿®æ”¹ fd=0/1 çš„æŒ‡å‘ï¼‰ï¼Œå†æ‰§è¡Œ<code>execvp</code>ï¼ˆå‘½ä»¤æ‰§è¡Œæ—¶ä¼šä½¿ç”¨ä¿®æ”¹åçš„ fdï¼‰ï¼›</li>
<li><strong>çˆ¶è¿›ç¨‹</strong>ï¼šä»…ç­‰å¾…å­è¿›ç¨‹ï¼Œä¸å‚ä¸é‡å®šå‘ï¼ˆé¿å…å½±å“ Shell è‡ªèº«çš„ fd æŒ‡å‘ï¼‰ã€‚</li>
</ul>
<h4 data-id="heading-17">ï¼ˆ2ï¼‰ç¼–è¯‘ä¸æµ‹è¯•</h4>
<p>bash</p>
<p>è¿è¡Œ</p>
<pre><code class="hljs language-shell" lang="shell"><span class="hljs-meta prompt_"># </span><span class="bash">ç¼–è¯‘</span>
gcc shell_redirect.c -o myshell
<span class="hljs-meta prompt_"># </span><span class="bash">è¿è¡Œè‡ªå®šä¹‰Shell</span>
./myshell
<span class="hljs-meta prompt_">
# </span><span class="bash">æµ‹è¯•ç”¨ä¾‹</span>
<span class="hljs-meta prompt_">shell&gt; </span><span class="bash"><span class="hljs-built_in">ls</span> &gt; result.txt  <span class="hljs-comment"># æ ‡å‡†è¾“å‡ºé‡å®šå‘åˆ°result.txtï¼ˆè¦†ç›–ï¼‰</span></span>
<span class="hljs-meta prompt_">shell&gt; </span><span class="bash"><span class="hljs-built_in">cat</span> result.txt    <span class="hljs-comment"># æŸ¥çœ‹ç»“æœ</span></span>
<span class="hljs-meta prompt_">shell&gt; </span><span class="bash"><span class="hljs-built_in">echo</span> <span class="hljs-string">"hello"</span> &gt;&gt; result.txt  <span class="hljs-comment"># è¿½åŠ åˆ°result.txt</span></span>
<span class="hljs-meta prompt_">shell&gt; </span><span class="bash"><span class="hljs-built_in">cat</span> &lt; result.txt  <span class="hljs-comment"># æ ‡å‡†è¾“å…¥é‡å®šå‘ï¼ˆä»result.txtè¯»ï¼‰</span></span>
<span class="hljs-meta prompt_">shell&gt; </span><span class="bash"><span class="hljs-built_in">exit</span></span>
</code></pre>
<h3 data-id="heading-18">4. æ‰©å±•ï¼šæ”¯æŒ<code>2&gt;ã€2&gt;&amp;1</code>ï¼ˆæ ‡å‡†é”™è¯¯é‡å®šå‘ï¼‰</h3>
<p>åªéœ€åœ¨<code>parse_cmd</code>ä¸­æ·»åŠ å¯¹<code>2&gt;</code>å’Œ<code>2&gt;&amp;1</code>çš„è§£æï¼Œåœ¨<code>execute_cmd</code>ä¸­å¤„ç† fd=2ï¼ˆstderrï¼‰ï¼š</p>
<p>c</p>
<p>è¿è¡Œ</p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-comment">// è§£æé˜¶æ®µæ·»åŠ ï¼š</span>
else if (strcmp(token, "<span class="hljs-number">2</span>&gt;") == <span class="hljs-number">0</span>) {
    *errfile = <span class="hljs-built_in">strtok</span>(NULL, " "); <span class="hljs-comment">// æ–°å¢errfileå˜é‡</span>
} else if (strcmp(token, "<span class="hljs-number">2</span>&gt;&amp;<span class="hljs-number">1</span>") == <span class="hljs-number">0</span>) {
    *err_to_out = <span class="hljs-number">1</span>; <span class="hljs-comment">// æ–°å¢err_to_outæ ‡å¿—ï¼ˆstderråˆå¹¶åˆ°stdoutï¼‰</span>
}

<span class="hljs-comment">// æ‰§è¡Œé˜¶æ®µæ·»åŠ ï¼š</span>
if (errfile != NULL) {
    int fd = <span class="hljs-built_in">open</span>(errfile, O_WRONLY | O_CREAT | O_TRUNC, <span class="hljs-number">0644</span>);
    <span class="hljs-built_in">dup2</span>(fd, STDERR_FILENO); <span class="hljs-comment">// fd=2æŒ‡å‘errfile</span>
    <span class="hljs-built_in">close</span>(fd);
} else if (err_to_out) {
    <span class="hljs-built_in">dup2</span>(STDOUT_FILENO, STDERR_FILENO); <span class="hljs-comment">// fd=2æŒ‡å‘fd=1çš„ç›®æ ‡</span>
}
</code></pre>
<h2 data-id="heading-19">æ€»ç»“</h2>
<ol>
<li><strong>å†…æ ¸æ–‡ä»¶ç®¡ç†</strong>ï¼šé€šè¿‡ã€Œfd è¡¨â†’æ‰“å¼€æ–‡ä»¶è¡¨â†’inode è¡¨ã€çš„ä¸‰å±‚æ¨¡å‹ï¼Œå®ç°è¿›ç¨‹ä¸æ–‡ä»¶çš„è§£è€¦ï¼›</li>
<li><strong>é‡å®šå‘æœ¬è´¨</strong>ï¼šä¿®æ”¹ fdï¼ˆ0/1/2ï¼‰çš„æŒ‡å‘ï¼Œè®© IO æ“ä½œçš„ç›®æ ‡ä»ç»ˆç«¯å˜ä¸ºæ–‡ä»¶ï¼›</li>
<li><strong>Shell å®ç°é‡å®šå‘</strong>ï¼šå­è¿›ç¨‹ä¸­é€šè¿‡<code>open+dup2+close</code>ä¿®æ”¹ fd æŒ‡å‘ï¼Œå†æ‰§è¡Œå‘½ä»¤ï¼Œä¸å½±å“çˆ¶ Shellã€‚</li>
</ol>
<p>æŒæ¡è¿™ä¸ªé€»è¾‘åï¼Œä¸ä»…èƒ½ç†è§£é‡å®šå‘ï¼Œè¿˜èƒ½å»¶ä¼¸åˆ°ç®¡é“ï¼ˆ<code>|</code>ï¼‰ã€åå°è¿è¡Œç­‰ Shell æ ¸å¿ƒåŠŸèƒ½çš„å®ç°åŸç†ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[PromiseResolveThenableJobTask çš„åœ¨Promiseä¸­çš„ä½¿ç”¨]]></title>    <link>https://juejin.cn/post/7579229538791358470</link>    <guid>https://juejin.cn/post/7579229538791358470</guid>    <pubDate>2025-12-03T05:10:18.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7579229538791358470" data-draft-id="7579256547797844009" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="PromiseResolveThenableJobTask çš„åœ¨Promiseä¸­çš„ä½¿ç”¨"/> <meta itemprop="keywords" content="Promise,JavaScript"/> <meta itemprop="datePublished" content="2025-12-03T05:10:18.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ä¹‹æ’å›"/> <meta itemprop="url" content="https://juejin.cn/user/2261046026312318"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            PromiseResolveThenableJobTask çš„åœ¨Promiseä¸­çš„ä½¿ç”¨
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2261046026312318/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ä¹‹æ’å›
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-03T05:10:18.000Z" title="Wed Dec 03 2025 05:10:18 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-03
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    3
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»2åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#595959;font-size:15px;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(60,10,30,.04) 3%,transparent 0),linear-gradient(1turn,rgba(60,10,30,.04) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body p{color:#595959;font-size:15px;line-height:2;font-weight:400}.markdown-body p+p{margin-top:16px}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin:0;color:#135ce0}.markdown-body h1{position:relative;text-align:center;font-size:22px;margin:50px 0}.markdown-body h1:before{position:absolute;content:"";top:-10px;left:50%;width:32px;height:32px;transform:translateX(-50%);background-size:100% 100%;opacity:.36;background-repeat:no-repeat;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAABfVBMVEX///8Ad/8AgP8AgP8AgP8Aff8AgP8Af/8AgP8AVf8Af/8Af/8AgP8AgP8Af/8Afv8AAP8Afv8Afv8Aef8AgP8AdP8Afv8AgP8AgP8Acf8Ae/8AgP8Af/8AgP8Af/8Af/8AfP8Afv8AgP8Af/8Af/8Afv8Afv8AgP8Afv8AgP8Af/8Af/8AgP8AgP8Afv8AgP8Af/8AgP8AgP8AgP8Ae/8Afv8Af/8AgP8Af/8AgP8Af/8Af/8Aff8Af/8Abf8AgP8Af/8AgP8Af/8Af/8Afv8AgP8AgP8Afv8Afv8AgP8Af/8Aff8AgP8Afv8AgP8Aff8AgP8AfP8AgP8Ae/8AgP8Af/8AgP8AgP8AgP8Afv8AgP8AgP8AgP8Afv8AgP8AgP8AgP8AgP8AgP8Af/8AgP8Af/8Af/8Aev8Af/8AgP8Aff8Afv8AgP8AgP8AgP8Af/8AgP8Af/8Af/8AgP8Afv8AgP8AgP8AgP8AgP8Af/8AeP8Af/8Af/8Af//////rzEHnAAAAfXRSTlMAD7CCAivatxIDx5EMrP19AXdLEwgLR+6iCR/M0yLRzyFF7JupSXn8cw6v60Q0QeqzKtgeG237HMne850/6Qeq7QaZ+WdydHtj+OM3qENCMRYl1B3K2U7wnlWE/mhlirjkODa9FN/BF7/iNV/2kASNZpX1Wlf03C4stRGxgUPclqoAAAABYktHRACIBR1IAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH4gEaBzgZ4yeM3AAAAT9JREFUOMvNUldbwkAQvCAqsSBoABE7asSOBRUVVBQNNuy9996789+9cMFAMHnVebmdm+/bmdtbQv4dOFOW2UjPzgFyLfo6nweKfIMOBYWwFtmMPGz2Yj2pJI0JDq3udJW6VVbmKa9I192VQFV1ktXUAl5NB0cd4KpnORqsEO2ZIRpF9gJfE9Dckqq0KuZt7UAH5+8EPF3spjsRpCeQNO/tA/qDwIDA+OCQbBoKA8NOdjMySgcZGVM6jwcgRuUiSs0nlPFNSrEpJfU0jTLD6llqbvKxei7OzvkFNQohi0vAsj81+MoqsCaoPOQFgus/1LyxichW+hS2JWCHZ7VlF9jb187pIAYcHiViHAMnp5mTjJ8B5xeEXF4B1ze/fTh/C0h398DDI9HB07O8ci+vRBdvdGnfP4gBuM8vw7X/G3wDmFhFZEdxzjMAAAAldEVYdGRhdGU6Y3JlYXRlADIwMTgtMDEtMjZUMDc6NTY6MjUrMDE6MDA67pVWAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDE4LTAxLTI2VDA3OjU2OjI1KzAxOjAwS7Mt6gAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAAWdEVYdFRpdGxlAGp1ZWppbl9sb2dvIGNvcHlxapmKAAAAV3pUWHRSYXcgcHJvZmlsZSB0eXBlIGlwdGMAAHic4/IMCHFWKCjKT8vMSeVSAAMjCy5jCxMjE0uTFAMTIESANMNkAyOzVCDL2NTIxMzEHMQHy4BIoEouAOoXEXTyQjWVAAAAAElFTkSuQmCC)}.markdown-body h2{position:relative;font-size:20px;border-left:4px solid;padding:0 0 0 10px;margin:30px 0}.markdown-body h3{font-size:16px}.markdown-body ul{list-style:disc outside;margin-left:2em;margin-top:1em}.markdown-body li{line-height:2;color:#595959}.markdown-body img.loaded{margin:0 auto;display:block}.markdown-body blockquote{background:#fff9f9;margin:2em 0;padding:2px 20px;border-left:4px solid #b2aec5}.markdown-body blockquote p{color:#666;line-height:2}.markdown-body a{color:#036aca;border-bottom:1px solid rgba(3,106,202,.8);font-weight:400;text-decoration:none}.markdown-body em strong,.markdown-body strong{color:#036aca}.markdown-body hr{border-top:1px solid #135ce0}.markdown-body pre{overflow:auto}.markdown-body code,.markdown-body pre{overflow:auto;position:relative;line-height:1.75;font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body table{border-collapse:collapse;margin:1rem 0;overflow-x:auto}.markdown-body table td,.markdown-body table th{border:1px solid #dfe2e5;padding:.6em 1em}.markdown-body table tr{border-top:1px solid #dfe2e5}.markdown-body table tr:nth-child(2n){background-color:#f6f8fa}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">é—®é¢˜ï¼š</h2>
<p>æœ€è¿‘çœ‹åˆ°ä¸€ä¸ªæœ‰æ„æ€çš„é¢è¯•é¢˜ï¼š</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">resolve</span>()
  .<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-number">0</span>);
    <span class="hljs-keyword">return</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">resolve</span>(<span class="hljs-number">4</span>);
  })
  .<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">res</span>) =&gt;</span> {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(res);
  });

<span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">resolve</span>()
  .<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-number">1</span>);
  })
  .<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-number">2</span>);
  })
  .<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-number">3</span>);
  })
  .<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-number">5</span>);
  });
</code></pre>
<h2 data-id="heading-1">ç»“è®ºï¼š</h2>
<p>æœ€ç»ˆ console è¾“å‡ºé¡ºåºï¼š 0, 1, 2, 3, 4, 5</p>
<h2 data-id="heading-2">åŸå› è§£é‡Š</h2>
<p><strong>é‡ç‚¹</strong>ï¼šPromiseçš„å¤„ç† ä¸ å¾®ä»»åŠ¡é˜Ÿåˆ—ï¼š</p>
<p><strong>è§£ææ­¥éª¤æ‹†è§£ï¼š</strong></p>
<ol>
<li>è„šæœ¬åŒæ­¥é˜¶æ®µï¼š</li>
</ol>
<ul>
<li>ä¸¤ä¸ª Promise.resolve() éƒ½æ˜¯å·²è§£å†³çš„ï¼ŒåŒæ­¥åœ°æ³¨å†Œå„è‡ªçš„ç¬¬ä¸€ä¸ª .then çš„ reactionã€‚å®ƒä»¬ä¼šåˆ†åˆ«åˆ›å»ºâ€œè¿”å›çš„ promiseâ€ï¼ˆè®°ä¸º A_returnã€B_returnï¼‰ï¼Œå¹¶æŠŠå¯¹åº”çš„ <code>PromiseFulfillReactionJobTask</code>ï¼ˆæ‰§è¡Œç¬¬ä¸€ä¸ª then çš„å›è°ƒï¼‰æŒ‰æ³¨å†Œé¡ºåºæ¨å…¥å¾®ä»»åŠ¡é˜Ÿåˆ—ã€‚
<ul>
<li>åˆå§‹ <em>å¾®ä»»åŠ¡é˜Ÿåˆ—</em>ï¼ˆFIFOï¼‰ï¼š <strong>[A (ç¬¬ä¸€ä¸ªé“¾çš„ç¬¬1ä¸ª then å›è°ƒ), B (ç¬¬äºŒä¸ªé“¾çš„ç¬¬1ä¸ª then å›è°ƒ)]</strong></li>
</ul>
</li>
</ul>
<ol start="2">
<li>
<p>æ‰§è¡Œå¾®ä»»åŠ¡ï¼ˆæŒ‰é˜Ÿåˆ—ï¼‰ï¼š</p>
<ol>
<li>
<p>è¿è¡Œ Aï¼š</p>
<ul>
<li>æ‰§è¡Œå›è°ƒï¼Œæ‰“å° <strong>0</strong>ã€‚</li>
<li>å›è°ƒè¿”å› <code>Promise.resolve(4)</code> â€”&gt; ä¸€ä¸ª <code>thenableï¼ˆJSPromiseï¼‰</code>ã€‚</li>
<li>ä¸ºæŠŠ A_return ä¸è¯¥ <code>thenable</code> å…³è”ï¼ŒV8 åˆ›å»ºå¹¶å…¥é˜Ÿä¸€ä¸ª <code>PromiseResolveThenableJobTask</code>ï¼ˆè§ <a href="https://link.juejin.cn?target=https%3A%2F%2Fchromium.googlesource.com%2Fv8%2Fv8.git%2F%2B%2Frefs%2Fheads%2F9.0-lkgr%2Fsrc%2Fobjects%2Fpromise.tq" target="_blank" title="https://chromium.googlesource.com/v8/v8.git/+/refs/heads/9.0-lkgr/src/objects/promise.tq" ref="nofollow noopener noreferrer">src/objects/promise.tq</a>ï¼š<code>PromiseResolveThenableJobTask</code> æ˜¯ Microtaskï¼Œæºå¸¦ <code>promise_to_resolve</code>ã€<code>thenable</code>ã€<code>then</code> ç­‰å­—æ®µï¼‰ï¼Œç”¨äºåœ¨ç¨åè°ƒç”¨ <code>thenable.then(resolve, reject)</code>ã€‚</li>
<li>æ­¤æ—¶ï¼Œ<em>å¾®ä»»åŠ¡é˜Ÿåˆ—</em>ï¼š <strong>[B, PRJ]ï¼ˆPRJ = PromiseResolveThenableJobTaskï¼‰</strong></li>
</ul>
</li>
<li>
<p>è¿è¡Œ Bï¼š</p>
</li>
</ol>
<ul>
<li>æ‰“å° <strong>1</strong>ï¼Œè¿”å› <code>undefined</code>ï¼Œå¯¼è‡´ B_return è¢« fulfill å¹¶æŠŠ B_return.then(...)ï¼ˆå³åç»­çš„ handler2ï¼‰å¯¹åº”çš„ reaction å…¥é˜Ÿã€‚
<ul>
<li>æ­¤æ—¶ï¼Œ<em>å¾®ä»»åŠ¡é˜Ÿåˆ—</em>ï¼š<strong>[PRJ, B2]</strong></li>
</ul>
</li>
</ul>
<ol start="3">
<li>è¿è¡Œ PRJï¼ˆ<code>PromiseResolveThenableJobTask</code>ï¼‰ï¼š</li>
</ol>
<ul>
<li>
<p>å®ƒä¼šæ‰§è¡Œ <code>thenable.then(resolve, reject)</code>ã€‚å› ä¸º <code>thenable</code> æ˜¯å·²è§£å†³çš„ <code>Promise.resolve(4)</code>ï¼Œè°ƒç”¨ then ä¼šæŠŠä¸€ä¸ªå°†è°ƒç”¨ <code>resolve(4)</code> çš„ reaction å…¥é˜Ÿï¼ˆè®°ä¸º TJï¼‰ã€‚</p>
</li>
<li>
<p><strong>PRJ æœ¬èº«ä¸ç›´æ¥è°ƒç”¨ resolve(4)ï¼Œåªæ‰§è¡Œ then çš„è°ƒç”¨æ¥æŠŠ thenable çš„ reaction å®‰æ’ä¸ºå¾®ä»»åŠ¡ã€‚</strong></p>
</li>
<li>
<p>æ­¤æ—¶ï¼Œ<em>å¾®ä»»åŠ¡é˜Ÿåˆ—</em>ï¼š<strong>[B2, TJ]</strong></p>
</li>
</ul>
<ol start="4">
<li>è¿è¡Œ B2ï¼ˆç¬¬äºŒé“¾çš„ç¬¬äºŒä¸ª thenï¼‰ï¼š</li>
</ol>
<ul>
<li>
<p>æ‰“å° <strong>2</strong>ï¼Œè¿”å› <code>undefined</code>ï¼Œæ³¨å†Œå¹¶å…¥é˜Ÿ B3ï¼ˆä¸‹ä¸€ then çš„ reactionï¼‰ã€‚</p>
</li>
<li>
<p>æ­¤æ—¶ï¼Œ<em>å¾®ä»»åŠ¡é˜Ÿåˆ—</em>ï¼š<strong>[TJ, B3]</strong></p>
</li>
</ul>
<ol start="5">
<li>è¿è¡Œ TJï¼ˆthenable çš„ååº”ï¼Œæ‰§è¡Œ resolve(4)ï¼‰ï¼š</li>
</ol>
<ul>
<li>
<p>resolve(4) æ»¡è¶³äº† A_returnï¼ŒæŠŠ A_return çš„åç»­ reactionï¼ˆå³ A çš„ç¬¬äºŒä¸ª thenï¼Œä¹Ÿå°±æ˜¯æ‰“å° res çš„å›è°ƒ A2ï¼‰å…¥é˜Ÿã€‚</p>
</li>
<li>
<p>æ­¤æ—¶ï¼Œ<em>å¾®ä»»åŠ¡é˜Ÿåˆ—</em>ï¼š<strong>[B3, A2]</strong></p>
</li>
</ul>
<ol start="6">
<li>
<p>è¿è¡Œ B3ï¼š</p>
</li>
</ol>
<ul>
<li>
<p>æ‰“å° <strong>3</strong>ï¼Œå…¥é˜Ÿ B4ï¼ˆæœ€åä¸€ä¸ª then çš„ reactionï¼‰ã€‚</p>
</li>
<li>
<p>æ­¤æ—¶ï¼Œ<em>å¾®ä»»åŠ¡é˜Ÿåˆ—</em>ï¼š<strong>[A2, B4]</strong></p>
</li>
</ul>
<ol start="7">
<li>è¿è¡Œ A2ï¼šæ‰“å° <strong>4</strong></li>
<li>è¿è¡Œ B4ï¼šæ‰“å° <strong>5</strong></li>
</ol>
</li>
</ol>
<h2 data-id="heading-3">è¦ç‚¹æ€»ç»“ï¼š</h2>
<ul>
<li>å½“ <code>then</code> å›è°ƒè¿”å›ä¸€ä¸ª <code>thenable</code>ï¼ˆè¿™é‡Œæ˜¯ <code>Promise.resolve(4)</code>ï¼‰æ—¶ï¼Œè§„èŒƒè¦æ±‚é€šè¿‡ä¸€ä¸ª <code>PromiseResolveThenableJobï¼ˆå¾®ä»»åŠ¡ï¼‰</code>å»â€œå–å¾— then å¹¶è°ƒç”¨å®ƒâ€ï¼Œå› æ­¤ä¼šç”Ÿæˆä¸€ä¸ªä¸“é—¨çš„å¾®ä»»åŠ¡ï¼ˆPRJï¼‰æ¥è°ƒç”¨ thenã€‚è¯¥ PRJ ä¼šæ’åœ¨å½“æ—¶é˜Ÿåˆ—çš„å°¾éƒ¨ã€‚</li>
<li><code>thenable.then(resolve, reject)</code> æœ¬èº«å†äº§ç”Ÿä¸€ä¸ªå¾®ä»»åŠ¡ï¼ˆTJï¼‰æ¥çœŸæ­£è°ƒç”¨ <code>resolve(4)</code>ã€‚å› æ­¤ A_return çš„ fulfillï¼ˆA2ï¼‰è¦ç­‰åˆ° TJ æ‰§è¡Œåæ‰ä¼šè¢«å…¥é˜Ÿå¹¶æœ€ç»ˆè¿è¡Œã€‚</li>
<li>å› ä¸ºå¤šä¸ªå¾®ä»»åŠ¡åœ¨è¿è¡ŒæœŸé—´ä¼šç»§ç»­å…¥é˜Ÿï¼ˆå¹¶ä¿æŒ FIFOï¼‰ï¼Œæ‰€ä»¥ç¬¬äºŒæ¡ promise é“¾çš„ä¸­é—´ thenï¼ˆæ‰“å° 2ã€3ï¼‰ä¼šåœ¨ A_return çš„æœ€ç»ˆ reactionï¼ˆæ‰“å° 4ï¼‰ä¹‹å‰è¢«è°ƒåº¦å¹¶æ‰“å°ã€‚</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[zustand ä»åŸç†åˆ°å®è·µ - åŸç†ç¯‡(2)]]></title>    <link>https://juejin.cn/post/7579167622106218496</link>    <guid>https://juejin.cn/post/7579167622106218496</guid>    <pubDate>2025-12-03T03:34:56.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7579167622106218496" data-draft-id="7579168400988667939" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="zustand ä»åŸç†åˆ°å®è·µ - åŸç†ç¯‡(2)"/> <meta itemprop="keywords" content="å‰ç«¯,React.js"/> <meta itemprop="datePublished" content="2025-12-03T03:34:56.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="é²¨å”"/> <meta itemprop="url" content="https://juejin.cn/user/413072101215944"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            zustand ä»åŸç†åˆ°å®è·µ - åŸç†ç¯‡(2)
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/413072101215944/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    é²¨å”
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-03T03:34:56.000Z" title="Wed Dec 03 2025 03:34:56 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-03
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    4
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»18åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h3 data-id="heading-0">å®ç°åŸç†</h3>
<p>åœ¨ä¸Šç¯‡<a href="https://juejin.cn/post/7579165599042273295" target="_blank" title="https://juejin.cn/post/7579165599042273295">ã€Šzustand ä»åŸç†åˆ°å®è·µ - åŸç†ç¯‡(1)ã€‹</a>ä¸­ï¼Œæˆ‘çš„é˜è¿°è¿˜æ˜¯æ¯”è¾ƒç¬¼ç»Ÿçš„ï¼Œä¸‹é¢è¿›è¡Œæ›´åŠ ç»†è‡´å’Œå…·ä½“çš„åŸç†å‰–æã€‚</p>
<h4 data-id="heading-1">vanilla å±‚</h4>
<p>vanilla å±‚æ˜¯ zustand çš„æ ¸å¿ƒä»£ç ï¼Œå®ƒä¸ä¾èµ–ä»»ä½•çš„è§†å›¾å±‚æ¡†æ¶ã€‚vanilla å±‚çš„ä»£ç ä¸»è¦åŒ…æ‹¬äº† store å®ä¾‹çš„åˆ›å»ºã€çŠ¶æ€æ›´æ–°ã€è®¢é˜…è€…ç®¡ç†ç­‰åŠŸèƒ½ã€‚ç®€å•æ¥è¯´ï¼Œå®ƒå°±å®ç°äº†ä¸€ä¸ªæ ¸å¿ƒ APIï¼š<code>createStore</code>ã€‚æˆ‘ä»¬æ‹¨å¼€è¿·é›¾çœ‹çœŸç« ã€‚ç›´æ¥çœ‹ zustand åœ¨è¿è¡Œæ—¶çš„ js æºç ï¼š</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-meta">'use strict'</span>

<span class="hljs-keyword">const</span> <span class="hljs-title function_">createStoreImpl</span> = (<span class="hljs-params">createState</span>) =&gt; {
  <span class="hljs-keyword">let</span> state
  <span class="hljs-keyword">const</span> listeners = <span class="hljs-comment">/* @__PURE__ */</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Set</span>()
  <span class="hljs-keyword">const</span> <span class="hljs-title function_">setState</span> = (<span class="hljs-params">partial, replace</span>) =&gt; {
    <span class="hljs-keyword">const</span> nextState = <span class="hljs-keyword">typeof</span> partial === <span class="hljs-string">'function'</span> ? <span class="hljs-title function_">partial</span>(state) : partial
    <span class="hljs-keyword">if</span> (!<span class="hljs-title class_">Object</span>.<span class="hljs-title function_">is</span>(nextState, state)) {
      <span class="hljs-keyword">const</span> previousState = state
      state = (
        replace != <span class="hljs-literal">null</span>
          ? replace
          : <span class="hljs-keyword">typeof</span> nextState !== <span class="hljs-string">'object'</span> || nextState === <span class="hljs-literal">null</span>
      )
        ? nextState
        : <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">assign</span>({}, state, nextState)
      listeners.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">listener</span>) =&gt;</span> <span class="hljs-title function_">listener</span>(state, previousState))
    }
  }
  <span class="hljs-keyword">const</span> <span class="hljs-title function_">getState</span> = (<span class="hljs-params"/>) =&gt; state
  <span class="hljs-keyword">const</span> <span class="hljs-title function_">getInitialState</span> = (<span class="hljs-params"/>) =&gt; initialState
  <span class="hljs-keyword">const</span> <span class="hljs-title function_">subscribe</span> = (<span class="hljs-params">listener</span>) =&gt; {
    listeners.<span class="hljs-title function_">add</span>(listener)
    <span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> listeners.<span class="hljs-title function_">delete</span>(listener)
  }
  <span class="hljs-keyword">const</span> api = { setState, getState, getInitialState, subscribe }
  <span class="hljs-keyword">const</span> initialState = (state = <span class="hljs-title function_">createState</span>(setState, getState, api))
  <span class="hljs-keyword">return</span> api
}
<span class="hljs-keyword">const</span> <span class="hljs-title function_">createStore</span> = (<span class="hljs-params">createState</span>) =&gt;
  createState ? <span class="hljs-title function_">createStoreImpl</span>(createState) : createStoreImpl

<span class="hljs-built_in">exports</span>.<span class="hljs-property">createStore</span> = createStore
</code></pre>
<p>ç†Ÿæ‚‰ redux æºç çš„äººä¸€çœ¼å°±èƒ½æ„Ÿå—åˆ°ä¸€ç§ç†Ÿæ‚‰çš„æ„Ÿè§‰ã€‚å¯¹ï¼Œè¿™é‡Œé¢çš„æºç åŸºæœ¬ä¸Šå°±æ˜¯é‡‡ç”¨äº† redux createStore çš„æºç æ¡†æ¶ï¼Œåªæ˜¯åšäº†ä¸€äº›ç®€åŒ–ã€‚æ„Ÿå…´è¶£çš„å¯ä»¥ç¿»çœ‹æˆ‘ 5 å¹´å‰å†™çš„<a href="https://juejin.cn/post/6844904023179411464" target="_blank" title="https://juejin.cn/post/6844904023179411464">reduxæºç è§£æ</a>ã€‚</p>
<p>æ ¸å¿ƒåŸç†å°±æ˜¯åˆ©ç”¨äº† javascriptã€Œé—­åŒ…ã€çš„è¯­è¨€ç‰¹æ€§æ¥å®ç°äº† store å®ä¾‹çš„åˆ›å»ºã€‚è¢«é—­åŒ…çš„å˜é‡æ— éå°±æ˜¯ä¸¤ä¸ªï¼š</p>
<ul>
<li>state - æ ‘å½¢ç»“æ„çš„çŠ¶æ€</li>
<li>listeners - è®¢é˜…è€…é›†åˆï¼ˆSetï¼‰</li>
</ul>
<p>å¯¹è¿™ä¸¤ä¸ªå˜é‡è¿›è¡Œæœ€ç»ˆå®ç°äº† store å®ä¾‹çš„å››ä¸ª APIï¼š</p>
<ul>
<li>setState()</li>
<li>getState()</li>
<li>getInitialState()</li>
<li>subscribe()</li>
</ul>
<p>ä¹Ÿè®¸ç”¨é—­åŒ…çš„æ–¹å¼æ¥å®ç° store å®ä¾‹çš„åˆ›å»ºï¼Œä»ç†è§£çš„è§’åº¦æ¥çœ‹ä¸é‚£ä¹ˆç›´è§‚ã€‚é‚£ä¹ˆï¼Œæˆ‘ä»¬å®Œå…¨å¯ä»¥ç”¨é¢å‘å¯¹è±¡çš„æ–¹å¼æ¥å®ç° store å®ä¾‹çš„åˆ›å»ºã€‚ä¸‹é¢å°±æ˜¯æˆ‘å®ç°çš„ä¸€ç‰ˆï¼š</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// é¢å‘å¯¹è±¡ç‰ˆ Storeï¼ˆçº¯ JSï¼‰</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">Store</span> {
  #state
  #listeners = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Set</span>()

  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">createState</span>) {
    <span class="hljs-keyword">const</span> api = {
      <span class="hljs-attr">setState</span>: <span class="hljs-variable language_">this</span>.#setState.<span class="hljs-title function_">bind</span>(<span class="hljs-variable language_">this</span>),
      <span class="hljs-attr">getState</span>: <span class="hljs-variable language_">this</span>.#getState.<span class="hljs-title function_">bind</span>(<span class="hljs-variable language_">this</span>),
      <span class="hljs-attr">getInitialState</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">createState</span>(api.<span class="hljs-property">setState</span>, api.<span class="hljs-property">getState</span>, api),
      <span class="hljs-attr">subscribe</span>: <span class="hljs-variable language_">this</span>.#subscribe.<span class="hljs-title function_">bind</span>(<span class="hljs-variable language_">this</span>),
    }
    <span class="hljs-variable language_">this</span>.#state = api.<span class="hljs-title function_">getInitialState</span>()
  }

  #<span class="hljs-title function_">setState</span>(<span class="hljs-params">partial, replace</span>) {
    <span class="hljs-keyword">const</span> next = <span class="hljs-keyword">typeof</span> partial === <span class="hljs-string">'function'</span> ? <span class="hljs-title function_">partial</span>(<span class="hljs-variable language_">this</span>.#state) : partial
    <span class="hljs-keyword">if</span> (!<span class="hljs-title class_">Object</span>.<span class="hljs-title function_">is</span>(next, <span class="hljs-variable language_">this</span>.#state)) {
      <span class="hljs-keyword">const</span> prev = <span class="hljs-variable language_">this</span>.#state
      <span class="hljs-variable language_">this</span>.#state =
        (replace ?? (<span class="hljs-keyword">typeof</span> next !== <span class="hljs-string">'object'</span> || next === <span class="hljs-literal">null</span>))
          ? next
          : <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">assign</span>({}, <span class="hljs-variable language_">this</span>.#state, next)
      <span class="hljs-variable language_">this</span>.#listeners.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">l</span>) =&gt;</span> <span class="hljs-title function_">l</span>(<span class="hljs-variable language_">this</span>.#state, prev))
    }
  }

  #<span class="hljs-title function_">getState</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.#state
  }

  #<span class="hljs-title function_">subscribe</span>(<span class="hljs-params">listener</span>) {
    <span class="hljs-variable language_">this</span>.#listeners.<span class="hljs-title function_">add</span>(listener)
    <span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> <span class="hljs-variable language_">this</span>.#listeners.<span class="hljs-title function_">delete</span>(listener)
  }

  <span class="hljs-comment">// å¯¹å¤–æš´éœ²ä¸æºç ç›¸åŒçš„ API</span>
  getState = <span class="hljs-variable language_">this</span>.#getState
  setState = <span class="hljs-variable language_">this</span>.#setState
  subscribe = <span class="hljs-variable language_">this</span>.#subscribe
  getInitialState = <span class="hljs-function">() =&gt;</span> <span class="hljs-variable language_">this</span>.#state
}

<span class="hljs-comment">// å·¥å‚å‡½æ•°ï¼Œä¿æŒåŒæ„</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">createStoreImpl</span>(<span class="hljs-params">createState</span>) {
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Store</span>(createState)
}
</code></pre>
<p>çœ‹åˆ°äº†æ²¡ï¼Œé¢å‘å¯¹è±¡çš„ <code>createStore</code> API ä¼šæ›´åŠ ç›´è§‚ã€‚ zustand çš„ <code>createStore</code> å‡½æ•°çš„å®ç°æ— éå°±æ˜¯å®ç°äº†å››ä¸ªå¯¹å¤–æš´éœ²çš„æ–¹æ³•ï¼š</p>
<ul>
<li>setState() - æ›´æ–°çŠ¶æ€ï¼Œå¹¶é€šçŸ¥æ‰€æœ‰çš„è®¢é˜…è€…</li>
<li>getState() - è·å–å½“å‰æœ€æ–°çš„çŠ¶æ€</li>
<li>getInitialState() - è·å–åˆå§‹çŠ¶æ€</li>
<li>subscribe() - è®¢é˜…çŠ¶æ€å˜åŒ–</li>
</ul>
<p>ç†Ÿæ‚‰ js è®¾è®¡æ¨¡å¼çš„äººä¸€çœ‹çœ‹åˆ°äº†ï¼Œzustand çš„ <code>createStore</code> å‡½æ•°çš„å®ç°é‡‡ç”¨äº†ç»å…¸çš„ã€Œå‘å¸ƒ-è®¢é˜…ã€æ¨¡å¼ã€‚å…·ä½“æ¥è¯´ï¼š</p>
<ol>
<li>é¦–å…ˆæœ‰ä¸€ä¸ª <code>listeners</code> æ•°ç»„ï¼Œç”¨æ¥å­˜å‚¨æ‰€æœ‰çš„è®¢é˜…è€…ã€‚</li>
<li>å½“è°ƒç”¨ <code>subscribe</code> æ–¹æ³•çš„æ—¶å€™ï¼Œå°±ä¼šæŠŠå½“å‰çš„è®¢é˜…è€… push åˆ° <code>listeners</code> æ•°ç»„ä¸­ã€‚</li>
<li>å½“è°ƒç”¨ <code>setState</code> æ–¹æ³•çš„æ—¶å€™ï¼Œå°±ä¼šéå† <code>listeners</code> æ•°ç»„ï¼Œç”¨å½“å‰æœ€æ–°çš„ state å’Œæ—§çš„ state ä½œä¸ºå‚æ•°è°ƒç”¨æ‰€æœ‰çš„è®¢é˜…è€…ã€‚</li>
</ol>
<h4 data-id="heading-2">å°ç»“</h4>
<p>vanilla å±‚çš„æ ¸å¿ƒä»£ç å°±æ˜¯ä¸€ä¸ª <code>createStore()</code> å‡½æ•°å®ç°ï¼Œå®ƒä¸€è§ˆæ— é—ï¼Œååˆ†ç²¾ç®€ã€‚ä½†æ˜¯éº»é›€è™½å°ï¼Œäº”è„ä¿±å…¨ã€‚å®ƒåˆ©ç”¨äº†ã€Œé—­åŒ…ã€çš„è¯­è¨€ç‰¹æ€§å’Œã€Œå‘å¸ƒ-è®¢é˜…ã€æ¨¡å¼å®ç°äº† store å®ä¾‹çš„å››ä¸ªæ ¸å¿ƒ APIï¼šsetStateã€getStateã€getInitialStateã€subscribeã€‚</p>
<p>é€šå¸¸æƒ…å†µä¸‹ï¼Œ<code>createStore()</code> å¹¶ä¸æ˜¯ä¸ºç”¨æˆ·ä»£ç ä¸ºå‡†å¤‡çš„ï¼Œå®ƒçš„æ¶ˆè´¹è€…ä¸»è¦æ˜¯ react binding å±‚çš„ <code>create</code> å‡½æ•°ã€‚è€Œè¿™ä¸ª<code>create</code> å‡½æ•°æ‰æ˜¯ç”¨æˆ·ä»£ç  <code>import { create } from 'zustand';</code> è¯­å¥é‡Œé¢çš„é‚£ä¸ª<code>create</code> å‡½æ•°ã€‚</p>
<p>å¦å¤–è¦æçš„ä¸€ç‚¹æ˜¯ï¼Œæˆ‘ä»¬è¦æ”¾ç‚¹æ³¨æ„åŠ›åˆ° <code>getState()</code> å’Œ <code>subscribe()</code> èº«ä¸Šï¼Œå› ä¸ºå®ƒä»¬æ˜¯è¡”æ¥ vanilla å±‚å’Œ react binding å±‚çš„æ¡¥æ¢ã€‚è‡³äºåŸç†ï¼Œæˆ‘ä»¬æ¥ä¸‹å¾€ä¸‹çœ‹ã€‚</p>
<h4 data-id="heading-3">react binding å±‚</h4>
<p>è€æ ·å­ï¼Œæˆ‘ä»¬ç›´æ¥çœ‹ zustand ç¼–è¯‘åçš„è¿è¡Œæ—¶ js æºç ï¼š</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-meta">'use strict'</span>

<span class="hljs-keyword">var</span> <span class="hljs-title class_">React</span> = <span class="hljs-built_in">require</span>(<span class="hljs-string">'react'</span>)
<span class="hljs-keyword">var</span> vanilla = <span class="hljs-built_in">require</span>(<span class="hljs-string">'zustand/vanilla'</span>)

<span class="hljs-keyword">const</span> <span class="hljs-title function_">identity</span> = (<span class="hljs-params">arg</span>) =&gt; arg
<span class="hljs-keyword">function</span> <span class="hljs-title function_">useStore</span>(<span class="hljs-params">api, selector = identity</span>) {
  <span class="hljs-keyword">const</span> slice = <span class="hljs-title class_">React</span>.<span class="hljs-title function_">useSyncExternalStore</span>(
    api.<span class="hljs-property">subscribe</span>,
    <span class="hljs-title class_">React</span>.<span class="hljs-title function_">useCallback</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">selector</span>(api.<span class="hljs-title function_">getState</span>()), [api, selector]),
    <span class="hljs-title class_">React</span>.<span class="hljs-title function_">useCallback</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">selector</span>(api.<span class="hljs-title function_">getInitialState</span>()), [api, selector]),
  )
  <span class="hljs-title class_">React</span>.<span class="hljs-title function_">useDebugValue</span>(slice)
  <span class="hljs-keyword">return</span> slice
}
<span class="hljs-keyword">const</span> <span class="hljs-title function_">createImpl</span> = (<span class="hljs-params">createState</span>) =&gt; {
  <span class="hljs-keyword">const</span> api = vanilla.<span class="hljs-title function_">createStore</span>(createState)
  <span class="hljs-keyword">const</span> <span class="hljs-title function_">useBoundStore</span> = (<span class="hljs-params">selector</span>) =&gt; <span class="hljs-title function_">useStore</span>(api, selector)
  <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">assign</span>(useBoundStore, api)
  <span class="hljs-keyword">return</span> useBoundStore
}
<span class="hljs-keyword">const</span> <span class="hljs-title function_">create</span> = (<span class="hljs-params">createState</span>) =&gt;
  createState ? <span class="hljs-title function_">createImpl</span>(createState) : createImpl

<span class="hljs-built_in">exports</span>.<span class="hljs-property">create</span> = create
<span class="hljs-built_in">exports</span>.<span class="hljs-property">useStore</span> = useStore
</code></pre>
<p>ä»ä¸Šé¢çš„ä»£ç ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°æ—¥å¸¸ç”¨æ¥åˆ›å»º store å®ä¾‹çš„ <code>create</code> å‡½æ•°ï¼Œå®ƒçš„å®ç°å°±æ˜¯è°ƒç”¨äº† <code>createImpl</code> å‡½æ•°ã€‚è€Œåœ¨ <code>createImpl</code> å‡½æ•°ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°å®ƒè°ƒç”¨äº† <code>vanilla.createStore</code> å‡½æ•°ï¼Œæ¥åˆ›å»ºäº†ä¸€ä¸ª store å®ä¾‹ã€‚è¿™é‡Œæ‰€è°“çš„ <code>api</code> å˜é‡å°±æ˜¯æˆ‘å£ä¸­çš„ã€Œstore å®ä¾‹ã€ã€‚</p>
<p>æœ€åï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œæˆ‘ä»¬åœ¨ react ç»„ä»¶ä¸­è°ƒç”¨ <code>useStore</code> å‡½æ•°å°±æ˜¯<code>createImpl</code> å‡½æ•°è¿”å›çš„ <code>useBoundStore</code> å‡½æ•°ã€‚</p>
<p>åœ¨ä¸Šé¢çš„ç« èŠ‚ä¸­ï¼Œæˆ‘ä»¬åå¤æåˆ° zustand å¯ä»¥åœ¨é react ç¯å¢ƒä¸­å»è§¦å‘ react ç»„ä»¶çš„æ›´æ–°ã€‚ç§˜è¯€æœ‰äºŒ:</p>
<ul>
<li>ç§˜è¯€ä¹‹ä¸€å°±æ˜¯è¿™è¡Œä»£ç ï¼š <code>Object.assign(useBoundStore, api);</code>ã€‚å€ŸåŠ©ã€Œ<strong>å‡½æ•°å³å¯¹è±¡</strong>ã€çš„è¯­è¨€ç‰¹æ€§ï¼Œzustand æŠŠ store å®ä¾‹çš„æ‰€æœ‰ API éƒ½æŒ‚è½½åˆ°äº† <code>useBoundStore</code> å‡½æ•°ï¼Œå‘å¤–æš´éœ²å‡ºå»äº†ã€‚è¿™æ ·ï¼Œæˆ‘ä»¬åœ¨é react ç¯å¢ƒä¸­é€šè¿‡è°ƒç”¨ <code>useBoundStore.setState()</code> å‡½æ•°æ¥è§¦å‘ react ç»„ä»¶çš„æ›´æ–°ã€‚</li>
</ul>
<blockquote>
<p>ä¸è¿‡å®è¯è¯´å›æ¥ï¼Œ<code>useBoundStore.setState()</code> çš„è¿™ç§ä½¿ç”¨æ–¹å¼ï¼ˆåŒ…æ‹¬æˆ‘åœ¨å†…ï¼‰å¾ˆå¤šäººéƒ½ä¸å¤ªä¹ æƒ¯ã€‚å› ä¸ºåœ¨ react å¼€å‘è€…çš„å¿ƒæ™ºæ¨¡å‹ä¸­ï¼Œ<code>useBoundStore</code> æ˜¯ä¸€ä¸ª hook å‡½æ•°ã€‚ä½ ç°åœ¨åˆè®©æˆ‘æŠŠå®ƒå½“å¯¹è±¡ï¼Œè€Œä¸”è¿˜ç”¨åœ¨é react ç»„ä»¶çš„ç¯å¢ƒä¸­ï¼Œè¿™å¤šå°‘æ˜¯ã€Œè¿åã€äº† hook çš„ä½¿ç”¨è§„åˆ™ã€‚</p>
</blockquote>
<p>ä¸Šé¢æåˆ°äº†ç§˜è¯€ä¹‹ä¸€ï¼Œé‚£ç§˜è¯€ä¹‹äºŒæ˜¯ä»€ä¹ˆï¼Ÿç§˜è¯€ä¹‹äºŒå°±è—åœ¨äº† <code>useStore</code> å‡½æ•°ä¸­ã€‚</p>
<ul>
<li>ç§˜è¯€ä¹‹äºŒåœ¨ <code>useStore</code> å‡½æ•°ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°å®ƒæœ¬è´¨ä¸Šå°±æ˜¯è°ƒç”¨äº† <code>React.useSyncExternalStore</code> hook å‡½æ•°ã€‚<strong>ç§˜è¯€ä¹‹äºŒå°±æ˜¯ zustand å¾ˆæ•é”åœ°å‘ç°äº† <code>useSyncExternalStore</code> èƒ½å¤Ÿæ”¯æŒå¯¹å¤–éƒ¨æ•°æ®æºçš„å“åº”çš„ç‰¹æ€§ã€‚</strong> äºæ˜¯ä¹ï¼Œzustand é€šè¿‡è°ƒç”¨ <code>useSyncExternalStore</code> å‡½æ•°ï¼ŒæŠŠ store å®åŠ›çš„ <code>subscribe</code> æ–¹æ³•å’Œ <code>getState</code> æ–¹æ³•é¡ºåˆ©åœ°æŠŠä¼ è¿›å»ï¼Œå‹¾ä½äº† react çš„å†…æ ¸ã€‚</li>
</ul>
<p>è‡³æ­¤ï¼Œzustand å’Œ react æˆåŠŸåœ°ç»‘å®šåœ¨ä¸€å—äº†ã€‚</p>
<h5 data-id="heading-4">zustand è·Ÿ react çš„æ¡¥æ¥åŸç†</h5>
<p>æ¢å¥è¯æ¥é—®ï¼Œé‚£ä¹ˆå°±æ˜¯ï¼šâ€œ<code>useSyncExternalStore</code> è¿™ä¸ª hook æ˜¯å¦‚ä½•å®ç°å¯¹å¤–éƒ¨æ•°æ®æºçš„å“åº”å‘¢ï¼Ÿâ€ã€‚å…¶å®ç¿»çœ‹å®˜ç½‘çš„<a href="https://link.juejin.cn?target=https%3A%2F%2Freact.dev%2Freference%2Freact%2FuseSyncExternalStore" target="_blank" title="https://react.dev/reference/react/useSyncExternalStore" ref="nofollow noopener noreferrer">useSyncExternalStore çš„ API æ–‡æ¡£</a>ï¼Œå°±ä¼šå‘ç°ï¼Œ<code>useSyncExternalStore</code> è¿™ä¸ª hook å‡½æ•°çš„ç¬¬ä¸€ä¸ªå‚æ•°å°±æ˜¯ <code>subscribe</code>(è®¢é˜…å‡½æ•°)ï¼Œç¬¬äºŒä¸ªå‚æ•°å°±æ˜¯ <code>getSnapshot</code>(è·å–çŠ¶æ€å¿«ç…§å‡½æ•°)ã€‚è€Œ zustand æ­£æ˜¯åˆ©ç”¨äº†è¿™ä¸¤ä¸ªå‚æ•°ï¼ŒæŠŠ store å®ä¾‹çš„ <code>subscribe</code> æ–¹æ³•å’Œ <code>getState</code> æ–¹æ³•ä¼ é€’ç»™äº† react çš„å†…æ ¸ã€‚ç„¶åï¼Œreact å†…æ ¸åœ¨ç»„ä»¶åˆå§‹æŒ‚è½½ï¼ˆmountï¼‰çš„æ—¶å€™å»åˆ©ç”¨ <code>subscribe</code> æ–¹æ³•å¾€ zustand çš„è®¢é˜…è€…æ•°ç»„ä¸­æ·»åŠ äº†ä¸€ä¸ªæ–°çš„è®¢é˜…è€…ï¼ˆlistenerï¼‰ã€‚æœ€åï¼Œåœ¨ç”¨æˆ·è°ƒç”¨ zustand store å®ä¾‹çš„ <code>setState()</code> æ–¹æ³•çš„æ—¶å€™ï¼Œzustand å†…éƒ¨ä¼šå…ˆæ¯”è¾ƒ store çš„æ–°æ—§ state å€¼ï¼Œå¦‚æœæ˜¯å‘ç”Ÿäº†å˜åŒ–ï¼Œå®ƒå°±é€šçŸ¥ reactã€‚react å†æ¬¡è°ƒç”¨ zustand store å®ä¾‹çš„ <code>getState</code> æ–¹æ³•æ¥è·å–æœ€æ–°çš„çŠ¶æ€å¿«ç…§ï¼Œå¯¹æ¯”æ–°æ—§å¿«ç…§ã€‚å¦‚æœæ–°æ—§çŠ¶æ€å¿«ç…§çš„å€¼ä¸ä¸€æ ·ï¼Œé‚£ä¹ˆ react å°±ä¼šæŠŠå½“å‰çš„ç»„ä»¶æ ‡è®°ä¸ºã€Œéœ€è¦æ›´æ–°çš„ã€ï¼Œå¹¶æ¥ç€è§¦å‘ä¸€æ¬¡ç»„ä»¶æ›´æ–°çš„è°ƒåº¦è¯·æ±‚ã€‚</p>
<h4 data-id="heading-5">ä¸‰æ–¹é€šè®¯æ¡†æ¶ï¼ˆç”¨æˆ·ä»£ç ï¼Œ zustandï¼Œ reactï¼‰</h4>
<p>ä»¥ä¸Šçš„æ¡¥æ¥åŸç†è®²å¾—æ¯”è¾ƒç¬¼ç»Ÿï¼Œä¸‹é¢æˆ‘ä»ä¸‰æ–¹é€šè®¯çš„è§†è§’ï¼Œæ¥è¿›ä¸€æ­¥é˜è¿°ä¸€ä¸‹è¿™é‡Œé¢çš„åŸç†ã€‚æˆ‘ä¼šç»™å‡ºæ—¶åºå›¾ï¼Œç„¶åç»“åˆç¼–è¯‘åçš„æºç æ¥é€æ­¥è®²è§£ã€‚</p>
<p>ç†Ÿæ‚‰ react åŸç†çš„äººéƒ½çŸ¥é“ï¼Œreact å†…éƒ¨å®ç°æ˜¯æŠŠåº”ç”¨åˆ’åˆ†äº†ä¸¤ä¸ªé˜¶æ®µçš„ï¼š<strong>mount é˜¶æ®µå’Œ update é˜¶æ®µ</strong>ã€‚ä¸€ä¸ª react åº”ç”¨çš„ç”Ÿå‘½å‘¨æœŸé¦–å…ˆç»å† mount é˜¶æ®µï¼Œç„¶åå†ç»å† update é˜¶æ®µã€‚</p>
<h5 data-id="heading-6">mount é˜¶æ®µ</h5>
<p>é¦–å…ˆï¼Œæˆ‘ä»¬çœ‹çœ‹ mount é˜¶æ®µï¼Œè¿™ä¸‰æ–¹æ˜¯æ€ä¹ˆé€šè®¯çš„ï¼š</p>
<pre><code class="hljs language-mermaid" lang="mermaid">sequenceDiagram
    participant ç”¨æˆ·ä»£ç 
    participant zustand
    participant react

    ç”¨æˆ·ä»£ç -&gt;&gt;zustand: è°ƒç”¨ create() API
    zustand-&gt;&gt;zustand: 1. è°ƒç”¨ createStore() æ¥åˆ›å»º store å®ä¾‹
    zustand-&gt;&gt;zustand: 2. åˆ›å»º useBoundStore å‡½æ•°å®ä¾‹&lt;br/&gt;å¹¶å°† store å®ä¾‹ï¼ŒuseStore å‡½æ•°å®ä¾‹å’Œ selectoré—­åŒ…å…¶ä¸­
    zustand--&gt;&gt;ç”¨æˆ·ä»£ç : è¿”å› useBoundStore()
    ç”¨æˆ·ä»£ç -&gt;&gt;ç”¨æˆ·ä»£ç : è°ƒç”¨ useBoundStore() API
    ç”¨æˆ·ä»£ç -&gt;&gt;zustand: è°ƒç”¨ useStore() API
    zustand-&gt;&gt;react: è°ƒç”¨ useSyncExternalStore() API

    react-&gt;&gt;react: 1. è°ƒç”¨ getState(), æŠŠé¦–æ¬¡çš„ snapshot ä¿å­˜åœ¨ fiber
    react-&gt;&gt;react: 2. åˆ›å»ºæ–°çš„ listener
react-&gt;&gt;react: 3. ç»„ä»¶æŒ‚è½½åï¼Œæ‰§è¡Œ subscribe(listener)
    react-&gt;&gt;zustand: å®ç°å¯¹ zustand store çš„è®¢é˜…
</code></pre>
<p>ä¸Šé¢è®²åˆ°äº†ï¼Œç”¨æˆ·ä¾§è°ƒç”¨çš„ create() å‡½æ•°ï¼Œå®é™…ä¸Šè°ƒç”¨çš„æ˜¯ react binding å±‚çš„ createImpl() å‡½æ•°ã€‚</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-meta">'use strict'</span>

<span class="hljs-keyword">var</span> <span class="hljs-title class_">React</span> = <span class="hljs-built_in">require</span>(<span class="hljs-string">'react'</span>)
<span class="hljs-keyword">var</span> vanilla = <span class="hljs-built_in">require</span>(<span class="hljs-string">'zustand/vanilla'</span>)

<span class="hljs-keyword">const</span> <span class="hljs-title function_">identity</span> = (<span class="hljs-params">arg</span>) =&gt; arg
<span class="hljs-keyword">function</span> <span class="hljs-title function_">useStore</span>(<span class="hljs-params">api, selector = identity</span>) {
  <span class="hljs-keyword">const</span> slice = <span class="hljs-title class_">React</span>.<span class="hljs-title function_">useSyncExternalStore</span>(
    api.<span class="hljs-property">subscribe</span>,
    <span class="hljs-title class_">React</span>.<span class="hljs-title function_">useCallback</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">selector</span>(api.<span class="hljs-title function_">getState</span>()), [api, selector]),
    <span class="hljs-title class_">React</span>.<span class="hljs-title function_">useCallback</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">selector</span>(api.<span class="hljs-title function_">getInitialState</span>()), [api, selector]),
  )
  <span class="hljs-title class_">React</span>.<span class="hljs-title function_">useDebugValue</span>(slice)
  <span class="hljs-keyword">return</span> slice
}
<span class="hljs-keyword">const</span> <span class="hljs-title function_">createImpl</span> = (<span class="hljs-params">createState</span>) =&gt; {
  <span class="hljs-keyword">const</span> api = vanilla.<span class="hljs-title function_">createStore</span>(createState)
  <span class="hljs-keyword">const</span> <span class="hljs-title function_">useBoundStore</span> = (<span class="hljs-params">selector</span>) =&gt; <span class="hljs-title function_">useStore</span>(api, selector)
  <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">assign</span>(useBoundStore, api)
  <span class="hljs-keyword">return</span> useBoundStore
}
<span class="hljs-keyword">const</span> <span class="hljs-title function_">create</span> = (<span class="hljs-params">createState</span>) =&gt;
  createState ? <span class="hljs-title function_">createImpl</span>(createState) : createImpl

<span class="hljs-built_in">exports</span>.<span class="hljs-property">create</span> = create
<span class="hljs-built_in">exports</span>.<span class="hljs-property">useStore</span> = useStore
</code></pre>
<p>ç®€å•æ¥è¯´ï¼ŒcreateImpl() å‡½æ•°å°±å¹²äº†ä¸‰ä»¶äº‹ï¼š</p>
<ol>
<li>è°ƒç”¨ <code>vanilla.createStore()</code> æ¥åˆ›å»º store å®ä¾‹</li>
<li>åˆ›å»º <code>useBoundStore</code> å‡½æ•°å®ä¾‹ï¼Œå¹¶å°† store å®ä¾‹ï¼Œ<code>useStore</code> å‡½æ•°å®ä¾‹å’Œ <code>selector</code> é—­åŒ…å…¶ä¸­</li>
<li>è¿”å› <code>useBoundStore</code> å‡½æ•°å®ä¾‹</li>
</ol>
<p>åœ¨è¿™ä¸ªèŠ‚ç‚¹ä¸Šï¼Œç”¨æˆ·ä»£ç éƒ½æ˜¯è·Ÿ zustand å†…æ ¸åœ¨æ‰“äº¤é“ã€‚å½“ç”¨æˆ·åœ¨ç»„ä»¶å†…éƒ¨å»è°ƒç”¨ useBoundStore() å‡½æ•°æ—¶ï¼Œæµç¨‹å°±å¯ä»¥è¿›å…¥åˆ° react å†…éƒ¨äº†ã€‚å› ä¸º useBoundStore() å‡½æ•°å†…éƒ¨ï¼Œå°±æ˜¯è°ƒç”¨äº† useStore() å‡½æ•°ã€‚è€Œ useStore() å‡½æ•°å†…éƒ¨ï¼Œå°±æ˜¯è°ƒç”¨äº† React.useSyncExternalStore() å‡½æ•°ã€‚æ‰€ä»¥ï¼Œæˆ‘ä»¬çš„ç›®å…‰å¯ä»¥èšç„¦åˆ°ä¸‹é¢çš„å‡ è¡Œä»£ç ä¸Šï¼š</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">function</span> <span class="hljs-title function_">useStore</span>(<span class="hljs-params">api, selector = identity</span>) {
  <span class="hljs-keyword">const</span> slice = <span class="hljs-title class_">React</span>.<span class="hljs-title function_">useSyncExternalStore</span>(
    api.<span class="hljs-property">subscribe</span>,
    <span class="hljs-title class_">React</span>.<span class="hljs-title function_">useCallback</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">selector</span>(api.<span class="hljs-title function_">getState</span>()), [api, selector]),
    <span class="hljs-title class_">React</span>.<span class="hljs-title function_">useCallback</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">selector</span>(api.<span class="hljs-title function_">getInitialState</span>()), [api, selector]),
  )
  <span class="hljs-comment">// ......</span>
  <span class="hljs-keyword">return</span> slice
}
</code></pre>
<p>åˆ°è¿™é‡Œï¼Œæˆ‘ä»¬å°±å¯ä»¥çœ‹åˆ°ï¼Œzustand store å®ä¾‹çš„ <code>subscribe</code> æ–¹æ³•å’Œ <code>getState</code> æ–¹æ³•è¢«ä¼ é€’ç»™äº† react çš„å†…æ ¸ã€‚é‚£ react å†…æ ¸æ˜¯å¦‚ä½•æ¶ˆè´¹è¿™ä¸¤ä¸ª API çš„å‘¢ï¼Ÿå¾€ä¸‹æ·±æŒ–ï¼Œæˆ‘ä»¬å°±æ¥åˆ°äº† <code>useSyncExternalStore</code> è¿™ä¸ª hook çš„å†…éƒ¨å®ç°äº†ã€‚æ­£å¦‚æˆ‘ä¹‹å‰çš„æ–‡ç« <a href="https://juejin.cn/post/6876659994448625671" target="_blank" title="https://juejin.cn/post/6876659994448625671">ã€reactã€‘react hookè¿è¡ŒåŸç†è§£æ</a> é‡Œé¢æåˆ°çš„ï¼Œhook å‡½æ•°ä¹Ÿæ˜¯æœ‰ mount å’Œ update é˜¶æ®µçš„ã€‚ä¸åŒçš„é˜¶æ®µï¼Œå¼€å‘è€…æ‰€æ¶ˆè´¹çš„ hook å‡½æ•°æ˜¯æŒ‡å‘ä¸åŒçš„å®ç°ã€‚å›å½’åˆ° <code>useSyncExternalStore</code>è¿™é‡Œï¼Œå½“å‰æˆ‘ä»¬åœ¨èŠåº”ç”¨çš„ mount é˜¶æ®µï¼Œæ‰€ä»¥ï¼Œæˆ‘ä»¬å°±å¾—çœ‹æºç é‡Œé¢çš„ <code>mountSyncExternalStore</code> å‡½æ•°å®ç°ã€‚ä¸‹é¢ï¼Œæˆ‘æŠŠè·Ÿæœ¬æ¬¡ç ”ç©¶ä¸»é¢˜ç›¸å…³çš„ä»£ç ç›´æ¥æ‘†å‡ºæ¥ï¼š</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">function</span> <span class="hljs-title function_">mountSyncExternalStore</span>(<span class="hljs-params">subscribe, getSnapshot, getServerSnapshot</span>) {
  <span class="hljs-keyword">var</span> fiber = currentlyRenderingFiber$1
  <span class="hljs-keyword">var</span> hook = <span class="hljs-title function_">mountWorkInProgressHook</span>()
  <span class="hljs-keyword">var</span> nextSnapshot
  <span class="hljs-keyword">var</span> isHydrating = <span class="hljs-title function_">getIsHydrating</span>()

  <span class="hljs-keyword">if</span> (isHydrating) {
    <span class="hljs-comment">// hydration çš„ç›¸å…³é€»è¾‘ä»£ç å¿½ç•¥</span>
    <span class="hljs-comment">// ......</span>
  } <span class="hljs-keyword">else</span> {
    nextSnapshot = <span class="hljs-title function_">getSnapshot</span>()

    <span class="hljs-comment">// æ²¡æœ‰åŠæ—¶ç¼“å­˜ getSnapshot() çš„è¿”å›å€¼ç›¸å…³è­¦å‘Šä»£ç è·³è¿‡</span>
    <span class="hljs-comment">// ......</span>

    <span class="hljs-comment">// å› ä¸ºæ¸²æŸ“æ˜¯å¯ä¸­æ–­çš„ï¼Œæ‰€ä»¥åœ¨ commit ä¹‹å‰è¦è¿›è¡Œä¸€è‡´æ€§æ£€æŸ¥</span>
    <span class="hljs-comment">// ç›¸å…³ä»£ç è·³è¿‡</span>
  }

  <span class="hljs-comment">// Read the current snapshot from the store on every render. This breaks the</span>
  <span class="hljs-comment">// normal rules of React, and only works because store updates are</span>
  <span class="hljs-comment">// always synchronous.</span>
  hook.<span class="hljs-property">memoizedState</span> = nextSnapshot
  <span class="hljs-keyword">var</span> inst = {
    <span class="hljs-attr">value</span>: nextSnapshot,
    <span class="hljs-attr">getSnapshot</span>: getSnapshot,
  }
  hook.<span class="hljs-property">queue</span> = inst

  <span class="hljs-comment">// Schedule an effect to subscribe to the store.</span>
  <span class="hljs-title function_">mountEffect</span>(subscribeToStore.<span class="hljs-title function_">bind</span>(<span class="hljs-literal">null</span>, fiber, inst, subscribe), [subscribe])

  <span class="hljs-comment">// å…¥é˜Ÿä¸€ä¸ª effect å¯¹è±¡ç”¨äºåœ¨æ¯ä¸€æ¬¡ç»„ä»¶ render ä¹‹åå»åš `inst` å­—æ®µå€¼çš„æ›´æ–°</span>
  <span class="hljs-comment">// è¿™é‡Œçš„ä»£ç ä¹Ÿå¯ä»¥ä¸çœ‹</span>
  <span class="hljs-comment">// Schedule an effect to update the mutable instance fields. We will update</span>
  <span class="hljs-comment">// this whenever subscribe, getSnapshot, or value changes. Because there's no</span>
  <span class="hljs-comment">// clean-up function, and we track the deps correctly, we can call pushEffect</span>
  <span class="hljs-comment">// directly, without storing any additional state. For the same reason, we</span>
  <span class="hljs-comment">// don't need to set a static flag, either.</span>
  <span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> We can move this to the passive phase once we add a pre-commit</span>
  <span class="hljs-comment">// consistency check. See the next comment.</span>
  <span class="hljs-comment">// fiber.flags |= Passive</span>
  <span class="hljs-comment">// pushEffect(</span>
  <span class="hljs-comment">//   HasEffect | Passive$1,</span>
  <span class="hljs-comment">//   updateStoreInstance.bind(null, fiber, inst, nextSnapshot, getSnapshot),</span>
  <span class="hljs-comment">//   undefined,</span>
  <span class="hljs-comment">//   null,</span>
  <span class="hljs-comment">// )</span>
  <span class="hljs-keyword">return</span> nextSnapshot
}
</code></pre>
<p>ä¸Šé¢çš„æºç ä¸­ï¼Œæˆ‘å·²ç»æŠŠè·Ÿæœ¬æ¬¡ç ”ç©¶ä¸»é¢˜ä¸ç›¸å…³çš„ä»£ç å·²ç»ç§»é™¤æˆ–è€…æ³¨é‡Šæ‰äº†ã€‚ä»ä¸Šé¢çš„ä»£ç æˆ‘ä»¬å¯ä»¥çœ‹å‡ºï¼Œæˆ‘ä»¬ä¸€è·¯é€ä¼ è¿›æ¥çš„ zustand store å®ä¾‹çš„<code>subscribe</code> æ–¹æ³•å’Œ <code>getState</code> æ–¹æ³•ï¼Œæœ€ç»ˆéƒ½è¢«ä¼ é€’ç»™äº† <code>subscribeToStore</code> è¿™ä¸ªå‡½æ•°ã€‚è€Œ <code>subscribeToStore</code> å‡½æ•°å°±æ˜¯å®ç°è®¢é˜…åŠŸèƒ½çš„å…³é”®ï¼š</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">function</span> <span class="hljs-title function_">subscribeToStore</span>(<span class="hljs-params">fiber, inst, subscribe</span>) {
  <span class="hljs-keyword">var</span> handleStoreChange = <span class="hljs-keyword">function</span> (<span class="hljs-params"/>) {
    <span class="hljs-comment">// The store changed. Check if the snapshot changed since the last time we</span>
    <span class="hljs-comment">// read from the store.</span>
    <span class="hljs-keyword">if</span> (<span class="hljs-title function_">checkIfSnapshotChanged</span>(inst)) {
      <span class="hljs-comment">// Force a re-render.</span>
      <span class="hljs-title function_">forceStoreRerender</span>(fiber)
    }
  } <span class="hljs-comment">// Subscribe to the store and return a clean-up function.</span>

  <span class="hljs-comment">// è¿™é‡Œçš„ `subscribe` å°±æ˜¯ zustand store å®ä¾‹çš„ `subscribe` æ–¹æ³•</span>
  <span class="hljs-comment">// è¿™é‡Œç”¨äº†ã€Œæ§åˆ¶åè½¬ã€çš„è®¾è®¡æ¨¡å¼</span>
  <span class="hljs-keyword">return</span> <span class="hljs-title function_">subscribe</span>(handleStoreChange)
}
</code></pre>
<p><code>subscribeToStore</code> å‡½æ•°ä¸»è¦æ˜¯å¹²äº†ä¸¤ä»¶äº‹ï¼š</p>
<ol>
<li>åˆ›å»ºä¸€ä¸ªæ–°çš„ listener - <code>handleStoreChange</code> å‡½æ•°ï¼›</li>
<li>è°ƒç”¨ store å®ä¾‹çš„ <code>subscribe</code> æ–¹æ³•å®ç°å¯¹ zustand store å®ä¾‹çš„ç›‘å¬ï¼›</li>
</ol>
<p>é‚£ä»€ä¹ˆæ—¶å€™å»è®¢é˜… zustand store å®ä¾‹å‘¢ï¼Ÿæˆ‘ä»¬å¯ä»¥ä» <code>mountEffect(subscribeToStore.bind(null, fiber, inst, subscribe), [subscribe])</code> è¿™è¡Œä»£ç å¯ä»¥çœ‹å‡ºã€‚Againï¼Œå› ä¸ºå½“å‰æ˜¯åº”ç”¨çš„ mount é˜¶æ®µï¼Œæ‰€ä»¥ï¼Œ<code>mountEffect</code> å‡½æ•°å°±æ˜¯ mount é˜¶æ®µçš„ <code>useEffect</code> å‡½æ•°ã€‚æ‰€ä»¥ç­”æ¡ˆå°±æ˜¯ï¼š<strong>å½“ç»„ä»¶ mount æ—¶ï¼Œ<code>subscribeToStore</code> å‡½æ•°å°±ä¼šè¢«è°ƒç”¨ï¼Œä»è€Œå®ç°å¯¹ zustand store å®ä¾‹çš„ç›‘å¬</strong>ã€‚</p>
<p>æ­£å¦‚ä¸Šé¢æ—¶åºå›¾æ‰€è¡¨æ˜çš„é‚£æ ·ï¼Œé™¤äº†è¿™ä¸ªç»‘å®šçš„åŠ¨ä½œå¤–ï¼Œ<code>useSyncExternalStore</code> åœ¨ mount é˜¶æ®µè¿˜åšäº†å¦å¤–ä¸€ä»¶å°äº‹ã€‚é‚£å°±æ˜¯è°ƒç”¨äº† <code>getSnapshot()</code> æ–¹æ³•ï¼Œå¾—åˆ°ä¸€ä¸ªåˆå§‹çš„ snapshot å€¼ï¼Œå­˜å‚¨åœ¨äº† <code>useSyncExternalStore</code> æ‰€å¯¹åº”çš„ hook å¯¹è±¡ä¸Šã€‚é‚£ä¹ˆåœ¨ä¸‹ä¸€æ¬¡æ¯”è¾ƒçš„æ—¶å€™ï¼Œè¿™ä¸ª snapshot å€¼å°±æ˜¯ prevSnapshot äº†ã€‚</p>
<h5 data-id="heading-7">update é˜¶æ®µ</h5>
<pre><code class="hljs language-mermaid" lang="mermaid">sequenceDiagram
    participant ç”¨æˆ·ä»£ç 
    participant zustand
    participant react

    ç”¨æˆ·ä»£ç -&gt;&gt;zustand: è°ƒç”¨ setState() API
    zustand-&gt;&gt;zustand: è®¡ç®—æœ€æ–°çš„ state å€¼
    zustand-&gt;&gt;zustand: æ–°æ—§ state å€¼æ˜¯å¦å‘ç”Ÿå˜åŒ–?
    alt æ˜¯
        zustand-&gt;&gt;zustand: é€šçŸ¥æ‰€æœ‰çš„è®¢é˜…è€…
        zustand-&gt;&gt;react: å¯¹æ¯”æ–°æ—§ snapshotï¼Œåˆ¤æ–­ snapshot æ˜¯å¦å·²ç»å‘ç”Ÿå˜åŒ–?
        alt æ˜¯
            react-&gt;&gt;react: å¼ºåˆ¶è§¦å‘ä¸€ä¸ª rerender
            react-&gt;&gt;react: è¿›å…¥ render é˜¶æ®µ
            react-&gt;&gt;react: è°ƒç”¨ useSyncExternalStore()ï¼Œé—´æ¥è°ƒç”¨ getSnapshot() è·å–æœ€æ–°çŠ¶æ€å¿«ç…§
            react-&gt;&gt;react: å¯¹æ¯”æ–°æ—§ snapshotï¼Œåˆ¤æ–­ snapshot æ˜¯å¦å·²ç»å‘ç”Ÿå˜åŒ–?
            alt æ˜¯
                react-&gt;&gt;react: æŠŠæœ€æ–°çš„ snapshot ä¿å­˜åœ¨ fiber ä¸Š
                react-&gt;&gt;react: å°†ç¡®è®¤æ›´æ–°æ ‡è®°æ›´æ–°ä¸º true (didReceiveUpdate = true)
            end
        end
    end
</code></pre>
<p>å½“ç”¨æˆ·é—´æ¥ï¼ˆè°ƒç”¨ zustand store å®ä¾‹çš„ action æ–¹æ³•æœ€ç»ˆè¿˜æ˜¯è°ƒç”¨ <code>setState</code> æ–¹æ³•ï¼‰æˆ–è€…ç›´æ¥è°ƒç”¨ zustand store å®ä¾‹çš„ <code>setState</code> æ–¹æ³•æ—¶ï¼Œzustand ä¼šè®¡ç®—å‡ºæœ€æ–°çš„ stateï¼Œç„¶åæ‹¿æœ€æ–° state è·Ÿä¹‹å‰çš„ state è¿›è¡Œå¯¹æ¯”ã€‚å¦‚æœå‘ç°æœ‰å˜åŒ–ï¼Œå°±ä¼šé€šçŸ¥æ‰€æœ‰çš„è®¢é˜…è€…ï¼Œé€šçŸ¥è®¢é˜…è€…çŠ¶æ€å·²ç»å‘ç”Ÿäº†å˜åŒ–ã€‚è¿™ä¸ªè¿‡ç¨‹æ˜¯å‘ç”Ÿåœ¨zustand store å®ä¾‹çš„ <code>setState</code> æ–¹æ³•é‡Œé¢çš„ã€‚ä»¥ä¸‹ä»£ç ä¸ºè¯ï¼š</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-meta">'use strict'</span>

<span class="hljs-keyword">const</span> <span class="hljs-title function_">createStoreImpl</span> = (<span class="hljs-params">createState</span>) =&gt; {
  <span class="hljs-keyword">let</span> state
  <span class="hljs-keyword">const</span> listeners = <span class="hljs-comment">/* @__PURE__ */</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Set</span>()
  <span class="hljs-keyword">const</span> <span class="hljs-title function_">setState</span> = (<span class="hljs-params">partial, replace</span>) =&gt; {
    <span class="hljs-keyword">const</span> nextState = <span class="hljs-keyword">typeof</span> partial === <span class="hljs-string">'function'</span> ? <span class="hljs-title function_">partial</span>(state) : partial
    <span class="hljs-keyword">if</span> (!<span class="hljs-title class_">Object</span>.<span class="hljs-title function_">is</span>(nextState, state)) {
      <span class="hljs-keyword">const</span> previousState = state
      state = (
        replace != <span class="hljs-literal">null</span>
          ? replace
          : <span class="hljs-keyword">typeof</span> nextState !== <span class="hljs-string">'object'</span> || nextState === <span class="hljs-literal">null</span>
      )
        ? nextState
        : <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">assign</span>({}, state, nextState)
      listeners.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">listener</span>) =&gt;</span> <span class="hljs-title function_">listener</span>(state, previousState))
    }
  }

  <span class="hljs-comment">//.....</span>
  <span class="hljs-keyword">return</span> api
}
</code></pre>
<p>å¯ä»¥çœ‹å‡ºå¦å¤–ä¸€ä¸ªç»†èŠ‚ï¼Œzustand æ˜¯é‡‡ç”¨åŸç”Ÿçš„ <code>Object.is</code> æ–¹æ³•æ¥æ¯”è¾ƒæ–°æ—§ state æ˜¯å¦å‘ç”Ÿäº†å˜åŒ–çš„ã€‚å¯¹äºè¿™ç‚¹ï¼Œæˆ‘ä»¬å¾—åˆ°çš„å¯ç¤ºæ˜¯ï¼š <strong>å¯¹äºå¼•ç”¨ç±»å‹çš„ stateï¼Œæˆ‘ä»¬è°ƒç”¨ <code>setState</code> æ–¹æ³•æ—¶ï¼Œåº”è¯¥é¿å…ç›´æ¥ä¿®æ”¹å®ƒçš„å±æ€§ï¼Œè€Œæ˜¯åº”è¯¥åˆ›å»ºä¸€ä¸ªæ–°çš„å¯¹è±¡</strong>ï¼ˆè¿™ä¸ªå¯ç¤ºå¯¹äºç†Ÿæ‚‰ react åŸç†çš„äººæ¥è¯´æ˜¯å¾ˆå¸ç©ºè§æƒ¯äº†ï¼‰ã€‚è¿™æ ·å¯ä»¥ç¡®ä¿ zustand èƒ½å¤Ÿæ­£ç¡®åœ°æ£€æµ‹åˆ° state çš„å˜åŒ–ã€‚å…³äºå€¼å˜åŒ–çš„æ£€æµ‹ç®—æ³•ï¼Œzustand è·Ÿ react å†…éƒ¨å®ç°æ˜¯ä¸€è‡´çš„ã€‚</p>
<p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ° <code>setState</code> æ–¹æ³•å®ç°çš„æœ€åä¸€è¡Œçš„ä»£ç ï¼š<code>listeners.forEach((listener) =&gt; listener(state, previousState))</code>ã€‚zustand ä¸€æ—¦è§‰å¾— store å®ä¾‹çš„ state å‘ç”Ÿäº†å˜åŒ–ï¼Œå°±ä¼šé€šçŸ¥æ‰€æœ‰çš„è®¢é˜…è€…ï¼Œ<strong>è€Œè¿™é‡Œé¢å½“ç„¶åŒ…æ‹¬ react åœ¨ mount é˜¶æ®µæ³¨å†Œçš„è®¢é˜…è€…ï¼ˆhandleStoreChangeï¼‰</strong>ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">subscribeToStore</span>(<span class="hljs-params">fiber, inst, subscribe</span>) {
  <span class="hljs-keyword">var</span> handleStoreChange = <span class="hljs-keyword">function</span> (<span class="hljs-params"/>) {
    <span class="hljs-comment">// The store changed. Check if the snapshot changed since the last time we</span>
    <span class="hljs-comment">// read from the store.</span>
    <span class="hljs-keyword">if</span> (<span class="hljs-title function_">checkIfSnapshotChanged</span>(inst)) {
      <span class="hljs-comment">// Force a re-render.</span>
      <span class="hljs-title function_">forceStoreRerender</span>(fiber)
    }
  } <span class="hljs-comment">// Subscribe to the store and return a clean-up function.</span>

  <span class="hljs-keyword">return</span> <span class="hljs-title function_">subscribe</span>(handleStoreChange)
}
</code></pre>
<p>react è¢«é€šçŸ¥åï¼Œå®ƒå¹¶ä¸ä¼šé©¬ä¸Šå°±è§¦å‘ä¸€ä¸ªæ›´æ–°è¯·æ±‚ã€‚è€Œæ˜¯å†è¿›è¡Œä¸€æ¬¡æ–°æ—§ state å€¼çš„æ¯”è¾ƒï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">checkIfSnapshotChanged</span>(<span class="hljs-params">inst</span>) {
  <span class="hljs-keyword">var</span> latestGetSnapshot = inst.<span class="hljs-property">getSnapshot</span>
  <span class="hljs-keyword">var</span> prevValue = inst.<span class="hljs-property">value</span>

  <span class="hljs-keyword">try</span> {
    <span class="hljs-keyword">var</span> nextValue = <span class="hljs-title function_">latestGetSnapshot</span>()
    <span class="hljs-keyword">return</span> !<span class="hljs-title function_">objectIs</span>(prevValue, nextValue)
  } <span class="hljs-keyword">catch</span> (error) {
    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>
  }
}
</code></pre>
<p>æ‰€è°“çš„ <code>latestGetSnapshot</code> æ˜¯ react è¿™è¾¹è€ƒè™‘äº†ä¸åŒçš„ rerender å‘¨æœŸï¼Œä¼ ç»™äº† <code>useSyncExternalStore</code> çš„ <code>getSnapshot</code> æ–¹æ³•å¼•ç”¨å‘ç”Ÿäº†å˜åŒ–ã€‚è€Œåœ¨å®é™… zustand ä¾§ï¼Œå®ƒä¼ å…¥çš„å¼•å…¥æ˜¯ä¸å˜çš„ã€‚æ‰€ä»¥ï¼Œè¿™é‡Œæˆ‘ä»¬å¯ä»¥ç›´æ¥ç†è§£å°±æ˜¯ zustand store å®ä¾‹çš„ <code>getState</code> æ–¹æ³•ã€‚</p>
<p>æ¥ä¸‹æ¥çš„é€»è¾‘å°±æ˜¯å¾ˆæ˜æ˜¾äº†ã€‚åˆ¤æ–­ä¹‹å‰ï¼Œç«‹åˆ»è°ƒç”¨ä¸€æ¬¡ <code>getState</code> æ–¹æ³•å»è·å–æœ€æ–°çš„ state å€¼ã€‚åˆ¤æ–­æ–°æ—§ state æ˜¯å¦å‘ç”Ÿäº†å˜åŒ–çš„æ£€æµ‹ç®—æ³•ä¾æ—§æ˜¯ <code>Object.is</code> æ–¹æ³•ã€‚å¦‚æœåˆ¤æ–­å€¼å·²ç»å‘ç”Ÿäº†å˜åŒ–ï¼Œåˆ™è§¦å‘ä¸€ä¸ªç»„ä»¶æ›´æ–°è¯·æ±‚ã€‚</p>
<blockquote>
<p>è¿™é‡Œæˆ‘ä»¬å¯ä»¥å¾—åˆ°ä¸€ä¸ªæ·±åˆ»çš„è®¤çŸ¥ï¼Œé‚£å°±æ˜¯ï¼šzustand åœ¨åˆ¤æ–­å€¼æ˜¯å¦å‘ç”Ÿå˜åŒ–æ‰€é‡‡ç”¨çš„ç®—æ³•æ–¹é¢æ˜¯å¯¹é½äº† react å†…éƒ¨å®ç°çš„ï¼Œä¹Ÿå°±æ˜¯éƒ½æ˜¯ <code>Object.is</code> æ–¹æ³•ã€‚å…³äºè¿™ä¸€ç‚¹ï¼Œä¸ç†Ÿæ‚‰çš„åŒå­¦å¯ä»¥ç¿»çœ‹æˆ‘çš„<a href="https://juejin.cn/post/7230989445729189943" target="_blank" title="https://juejin.cn/post/7230989445729189943">è§¦æ‘¸ react çš„å‘½é—¨ - å€¼çš„ç›¸ç­‰æ€§æ¯”è¾ƒï¼ˆä¸Šç¯‡ï¼‰</a>å’Œ<a href="https://juejin.cn/post/7460002800464052262" target="_blank" title="https://juejin.cn/post/7460002800464052262">è§¦æ‘¸ react çš„å‘½é—¨ - å€¼çš„ç›¸ç­‰æ€§æ¯”è¾ƒï¼ˆä¸‹ç¯‡ï¼‰</a>ã€‚</p>
</blockquote>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">forceStoreRerender</span>(<span class="hljs-params">fiber</span>) {
  <span class="hljs-keyword">var</span> root = <span class="hljs-title function_">enqueueConcurrentRenderForLane</span>(fiber, <span class="hljs-title class_">SyncLane</span>)

  <span class="hljs-keyword">if</span> (root !== <span class="hljs-literal">null</span>) {
    <span class="hljs-title function_">scheduleUpdateOnFiber</span>(root, fiber, <span class="hljs-title class_">SyncLane</span>, <span class="hljs-title class_">NoTimestamp</span>)
  }
}
</code></pre>
<p>æœ€åï¼Œæˆ‘ä»¬ç®€åœ°å±•å¼€è¯´è¯´ react core è¿™è¾¹æ˜¯å¦‚ä½•å‘ scheduler å‘èµ·ä¸€ä¸ªæ›´æ–°è¯·æ±‚çš„ã€‚æ­¥éª¤æœ‰äºŒï¼š</p>
<ol>
<li>é¦–å…ˆï¼Œå…ˆå‘æ›´æ–°é˜Ÿåˆ—ä¸­æ·»åŠ ä¸€ç»„åŒæ­¥ä¼˜å…ˆçº§çš„æ›´æ–°è¯·æ±‚ metaï¼ˆåŒ…å«å››è¦ç´ ï¼šfiberï¼Œupdate å¯¹è±¡ï¼Œ laneï¼Œ hook queueï¼‰ï¼›</li>
<li>ç„¶åï¼Œæ­£å¼å‘ scheduler å±‚å‘èµ·ä¸€ä¸ªæ›´æ–°è¯·æ±‚ã€‚è¿™é‡Œç¨å¾®å±•å¼€æ¥è®²ä¸€ä¸‹ã€‚react core è¿™è¾¹ä¼šæŠŠä¸€ä¸ªç»„ä»¶æ›´æ–°è¯·æ±‚åŒ…è£…ä¸ºä¸€ä¸ª taskã€‚åŒæ­¥ä¼˜å…ˆçº§çš„æ›´æ–°è¯·æ±‚ä¼šä½¿ç”¨ <code>performSyncWorkOnRoot(rootFiber)</code>åŒ…è£…ä¸ºä¸€ä¸ªåŒæ­¥ taskï¼Œå¼‚æ­¥ä¼˜å…ˆçº§çš„æ›´æ–°è¯·æ±‚ä¼šä½¿ç”¨ <code>performConcurrentWorkOnRoot(rootFiber)</code>åŒ…è£…ä¸ºä¸€ä¸ªåŒå¼‚æ­¥ taskã€‚æœ€åé€šè¿‡è°ƒç”¨ scheduler çš„è°ƒåº¦å‡½æ•°æ¥æŠŠç»„ä»¶æ›´æ–°è¿™ä¸ªä»»åŠ¡äº¤ç»™ schedulerï¼Œ è®©å®ƒå†³å®šåœ¨ä½•æ—¶å»çœŸæ­£è¿›å…¥æ•´ä¸ªç»„ä»¶æ›´æ–°æµç¨‹ï¼ˆrender + commitï¼‰ã€‚</li>
</ol>
<p>æ¥ä¸‹æ¥ï¼Œåœ¨ render é˜¶æ®µï¼Œ<code>useSyncExternalStore</code> ä¼šè¢«å†æ¬¡è°ƒç”¨ã€‚react core è¿™è¾¹è¿˜ä¼šè°ƒç”¨ä¸€æ¬¡ <code>getSnapshot</code> æ–¹æ³•ï¼ˆä¹Ÿå°±æ˜¯ zustand store å®ä¾‹çš„ <code>getState</code> æ–¹æ³•ï¼‰ã€‚ç„¶åï¼Œè¿˜æ˜¯ä¼šæ¯”è¾ƒæ–°æ—§ snapshot çš„å€¼æ˜¯å¦å‘ç”Ÿäº†å˜åŒ–ï¼Œå¦‚æœå‘ç°æœ‰å˜åŒ–ï¼Œå°±ä¸»è¦åšä¸‰ä»¶äº‹ï¼š</p>
<ol>
<li>æ›´æ–°å­˜æ”¾åœ¨ fiber ä¸Šçš„ prevSnapshot å€¼ï¼›</li>
<li>å°†å½“å‰ç»„ä»¶ markup ä¸ºçœŸæ­£éœ€æ±‚æ›´æ–°çš„ï¼ˆä¸»è¦æ˜¯ä¸ºäº†æ€§èƒ½ä¼˜åŒ–çš„ç›®çš„ï¼‰ã€‚</li>
<li>è¿”å›å½“å‰æœ€æ–°çš„ snapshot å€¼ã€‚</li>
</ol>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">updateSyncExternalStore</span>(<span class="hljs-params">subscribe, getSnapshot, getServerSnapshot</span>) {
  <span class="hljs-keyword">var</span> fiber = currentlyRenderingFiber$1
  <span class="hljs-keyword">var</span> hook = <span class="hljs-title function_">updateWorkInProgressHook</span>() <span class="hljs-comment">// Read the current snapshot from the store on every render. This breaks the</span>
  <span class="hljs-comment">// normal rules of React, and only works because store updates are</span>
  <span class="hljs-comment">// always synchronous.</span>

  <span class="hljs-keyword">var</span> nextSnapshot = <span class="hljs-title function_">getSnapshot</span>()

  <span class="hljs-comment">// ......</span>

  <span class="hljs-keyword">var</span> prevSnapshot = hook.<span class="hljs-property">memoizedState</span>
  <span class="hljs-keyword">var</span> snapshotChanged = !<span class="hljs-title function_">objectIs</span>(prevSnapshot, nextSnapshot)

  <span class="hljs-keyword">if</span> (snapshotChanged) {
    hook.<span class="hljs-property">memoizedState</span> = nextSnapshot
    <span class="hljs-title function_">markWorkInProgressReceivedUpdate</span>()
  }

  <span class="hljs-comment">// .......</span>

  <span class="hljs-keyword">return</span> nextSnapshot
}
</code></pre>
<h5 data-id="heading-8">å°ç»“</h5>
<p>ä¸Šé¢æˆ‘ä»¬é€šè¿‡äº†ä¸¤ä¸ªé˜¶æ®µï¼ˆmount é˜¶æ®µå’Œ update é˜¶æ®µï¼‰æ¥å‰–æäº† zustand è·Ÿ react cored çš„æ¡¥æ¥åŸç† ï¼ˆä¾èµ–åŸç”Ÿ API <code>useSyncExternalStore</code> å¯¹è®¢é˜…å¤–éƒ¨æ•°æ®æºçš„æ”¯æŒï¼‰ï¼Œå¹¶ä½¿ç”¨æ—¶åºå›¾æ¥å±•ç¤ºäº†ä¸‰ä¸ªå‚ä¸æ–¹ï¼ˆç”¨æˆ·ä»£ç ï¼Œ zustandï¼Œ react coreï¼‰çš„äº¤äº’æµç¨‹ã€‚è¿™ä¸ªåŸç†å…¶å®å¯ä»¥ç”¨ä¸‰å¥è¯æ€»ç»“ä¸ºï¼š</p>
<ol>
<li>zustand store å®ä¾‹åˆ›å»º - å½“ç”¨æˆ·è°ƒç”¨ <code>create</code> æ–¹æ³•æ—¶å€™ï¼Œzustand ä¼šåˆ›å»ºä¸€ä¸ª store å®ä¾‹ï¼Œå¹¶ä½¿ç”¨ <code>useBoundStore</code> å‡½æ•°å®ä¾‹å°†å…¶é—­åŒ…ä¿å­˜åœ¨å†…å­˜ä¸­ï¼›</li>
<li>mount é˜¶æ®µ - react core åˆ©ç”¨ <code>useSyncExternalStore</code> å®ç°äº†å¯¹ zustand store å®ä¾‹çš„è®¢é˜…ã€‚å½“ store å®ä¾‹çš„çŠ¶æ€å‘ç”Ÿå˜åŒ–æ—¶ï¼Œzustand ä¼šé€šçŸ¥ react core ä¹‹å‰è®¢é˜…æ‰€æ³¨å†Œçš„ listenerã€‚react å†…éƒ¨ä¼šå†åˆ¤æ–­ä¸€æ¬¡æ–°æ—§å€¼æ˜¯å¦å‘ç”Ÿå˜åŒ–ã€‚å¦‚æœå‘ç°æœ‰å˜åŒ–ï¼Œå°±ä¼šå¾€ scheduler å±‚å‘èµ·ä¸€ä¸ªæ›´æ–°è¯·æ±‚ã€‚</li>
<li>update é˜¶æ®µ - react core è¿˜ä¼šè°ƒç”¨ <code>getSnapshot</code> æ–¹æ³•ï¼ˆä¹Ÿå°±æ˜¯ zustand store å®ä¾‹çš„ <code>getState</code> æ–¹æ³•ï¼‰ã€‚ç„¶åï¼Œè¿˜æ˜¯ä¼šæ¯”è¾ƒæ–°æ—§ snapshot çš„å€¼æ˜¯å¦å‘ç”Ÿäº†å˜åŒ–ã€‚å¦‚æœå‘ç°æœ‰å˜åŒ–ï¼Œå°±ä¼šæ›´æ–° hook å¯¹è±¡çš„ memorized å€¼ï¼Œæœ€åè¿”å›ç»™ç”¨æˆ·ä»£ç ã€‚</li>
</ol>
<p>å‰å‰ååï¼Œæ€»å…±åšäº†ä¸‰æ¬¡çš„ã€Œå€¼çš„æ¯”è¾ƒã€ï¼šzustand è°ƒç”¨ä¸€æ¬¡ <code>getState</code> æ–¹æ³•ï¼Œ react core è¿™è¾¹è°ƒç”¨äº†ä¸¤æ¬¡ <code>getState</code> æ–¹æ³•æ¥è¿›è¡Œæ–°æ—§ snapshot å€¼çš„æ¯”è¾ƒã€‚è¿™ä¸‰æ¬¡çš„å€¼çš„æ¯”è¾ƒç®—æ³•éƒ½æ˜¯ç”¨ <code>Object.is</code> æ–¹æ³•ã€‚å¦‚æ­¤çœ‹æ¥ï¼Œæ•´ä¸ªæµç¨‹ä¸­å†³å®šæ˜¯å¦è¦ã€Œå˜ã€çš„ç®—æ³•æ˜¯ä¿æŒä¸€è‡´çš„ã€‚</p>
<h4 data-id="heading-9">æŒ‰éœ€æ¸²æŸ“</h4>
<p>æ­£å¦‚å‰é¢çš„ã€Œç‰¹ç‚¹ã€æ‰€è¯´ï¼Œzustand æ˜¯å®ç°äº†ã€ŒæŒ‰éœ€ rerenderã€äº†ã€‚å½“ç„¶ï¼Œå‰ææ˜¯ä½ ä¹Ÿè¦åœ¨è°ƒç”¨ <code>useBoundStore</code> å‡½æ•°æ—¶ï¼Œä¼ å…¥ä¸€ä¸ª selector å‡½æ•°æ‰è¡Œã€‚</p>
<p>é‚£ä¸ºä»€ä¹ˆè¦æƒ³å®ç°æŒ‰éœ€ rerender å°±å¿…é¡»è¦ä¼ é€’ä¸€ä¸ª selector å‡½æ•°å‘¢ï¼Ÿå› ä¸ºå‡è®¾ä½ ä¸ä¼ é€’çš„è¯ï¼Œ zustand é»˜è®¤ä¼šé‡‡ç”¨ <code>(state) =&gt; state</code> è¿™ä¸ª selector å‡½æ•°ã€‚è€Œ zustand é‡Œé¢çš„å®ç°æ˜ç¡®æ˜¯æŒ‡å‡ºï¼Œä½ è¦æƒ³è®© zustand store é€šçŸ¥æ‰€æœ‰çš„è®¢é˜…è€…ï¼Œä½ è°ƒç”¨ <code>setState</code> æ–¹æ³•æ—¶ï¼Œå¿…é¡»è¦ä¼ é€’ä¸€ä¸ªã€Œæ–°ã€çš„ state å€¼ã€‚</p>
<p><strong>é‡ç‚¹æ¥äº†ï¼Œè¿™ä¸ªã€Œæ–°ã€æ˜¯ä½“ç°åœ¨ã€Œå¼•ç”¨ã€æ˜¯æ–°çš„</strong>ï¼ˆå½“ç„¶ï¼Œ è¿™ä¸ªç»“è®ºæ˜¯å»ºç«‹åœ¨ç»å¤§éƒ¨åˆ† zustand store çš„ state éƒ½æ˜¯ä¸€ä¸ªå¼•ç”¨ç±»å‹çš„å¤åˆå¯¹è±¡ï¼‰ã€‚ ä½è¯ä»¥ä¸Šç»“è®ºçš„ä»£ç åœ¨ï¼š</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">const</span> <span class="hljs-title function_">createStoreImpl</span> = (<span class="hljs-params">createState</span>) =&gt; {
  <span class="hljs-keyword">let</span> state
  <span class="hljs-keyword">const</span> listeners = <span class="hljs-comment">/* @__PURE__ */</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Set</span>()
  <span class="hljs-keyword">const</span> <span class="hljs-title function_">setState</span> = (<span class="hljs-params">partial, replace</span>) =&gt; {
    <span class="hljs-keyword">const</span> nextState = <span class="hljs-keyword">typeof</span> partial === <span class="hljs-string">'function'</span> ? <span class="hljs-title function_">partial</span>(state) : partial
    <span class="hljs-keyword">if</span> (!<span class="hljs-title class_">Object</span>.<span class="hljs-title function_">is</span>(nextState, state)) {
      <span class="hljs-keyword">const</span> previousState = state
      state = (
        replace != <span class="hljs-literal">null</span>
          ? replace
          : <span class="hljs-keyword">typeof</span> nextState !== <span class="hljs-string">'object'</span> || nextState === <span class="hljs-literal">null</span>
      )
        ? nextState
        : <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">assign</span>({}, state, nextState)
      listeners.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">listener</span>) =&gt;</span> <span class="hljs-title function_">listener</span>(state, previousState))
    }
  }
  <span class="hljs-comment">// ......</span>
  <span class="hljs-keyword">return</span> api
}
</code></pre>
<p>ä»ä¸Šé¢çš„ä»£ç æˆ‘ä»¬å¯ä»¥çœ‹å‡ºï¼Œåªæœ‰åœ¨ä½ è°ƒç”¨ <code>setState</code> æ–¹æ³•æ—¶ï¼Œä¼ é€’çš„æ˜¯ä¸€ä¸ªæ–°å¼•ç”¨ï¼Œzustand æ‰ä¼šå»æ›´æ–° store çš„ state å€¼ã€‚è€Œæ— è®ºä½ æŒ‡å®šçš„æ˜¯å¦æ˜¯ replace æ¨¡å¼ï¼Œæœ€ç»ˆï¼Œzustand store å®ä¾‹çš„ state å€¼ï¼Œéƒ½æ˜¯ä¸€ä¸ªæ–°çš„å¼•ç”¨ã€‚</p>
<p>é‚£è¿™å°±æ„å‘³ç€ä»€ä¹ˆå‘¢ï¼Ÿä¸å¦¨å…ˆåš¼ä¸€åš¼ä¸‹é¢çš„è¿™æ®µä»£ç ï¼š</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">function</span> <span class="hljs-title function_">useStore</span>(<span class="hljs-params">api, selector = identity</span>) {
  <span class="hljs-keyword">const</span> slice = <span class="hljs-title class_">React</span>.<span class="hljs-title function_">useSyncExternalStore</span>(
    api.<span class="hljs-property">subscribe</span>,
    <span class="hljs-title class_">React</span>.<span class="hljs-title function_">useCallback</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">selector</span>(api.<span class="hljs-title function_">getState</span>()), [api, selector]),
    <span class="hljs-title class_">React</span>.<span class="hljs-title function_">useCallback</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">selector</span>(api.<span class="hljs-title function_">getInitialState</span>()), [api, selector]),
  )
  <span class="hljs-comment">// ......</span>
  <span class="hljs-keyword">return</span> slice
}
</code></pre>
<p>ä»ä¸Šé¢çš„å‰–ææˆ‘ä»¬çŸ¥é“ï¼Œ<code>() =&gt; selector(api.getState())</code> å°±æ˜¯ zustand æäº¤ç»™ react core çš„ <code>getSnapshot</code> æ–¹æ³•ã€‚å½“ zustand store é€šçŸ¥æ‰€æœ‰çš„è®¢é˜…è€…æ—¶ï¼Œå°±ä¼šè°ƒç”¨è¿™ä¸ª <code>getSnapshot</code> æ–¹æ³•æ¥è·å–æœ€æ–°çš„ state å€¼ã€‚å¦‚æœæˆ‘ä»¬ä¸ä¼ å…¥ selector å‡½æ•°ï¼Œé‚£ä¹ˆåœ¨ react core åœ¨è®¡ç®—æœ€æ–° snapshot å€¼çš„æ—¶å€™å°±æ˜¯ç›¸å½“äºæ‹¿åˆ°çš„æ˜¯ zustand store å®ä¾‹çš„è®¡ç®—å‡ºæ¥çš„æœ€æ–° state å€¼ï¼š</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">const</span> <span class="hljs-title function_">selector</span> = (<span class="hljs-params">arg</span>) =&gt; arg
<span class="hljs-keyword">const</span> nextSnapshot = <span class="hljs-title function_">selector</span>(api.<span class="hljs-title function_">getState</span>()) = api.<span class="hljs-title function_">getState</span>()
</code></pre>
<p>å› ä¸ºæ­¤æ—¶è°ƒç”¨ <code>api.getState()</code> å¿…å®šæ˜¯æ‹¿åˆ°ä¸€ä¸ª zustand æ–°è®¡ç®—å‡ºæ¥çš„ state å€¼ã€‚æ ¹æ® <code>useSyncExternalStore</code> çš„å®ç°ï¼Œreact core å°±ä¼šä¸ºå½“å‰çš„ç»„ä»¶å‘èµ·ä¸€æ¬¡å¼ºåˆ¶ render çš„è¯·æ±‚ã€‚</p>
<p>å›åˆ°ä¸Šé¢çš„é—®é¢˜ï¼šâ€œé‚£è¿™å°±æ„å‘³ç€ä»€ä¹ˆå‘¢ï¼Ÿâ€ã€‚è¿™æ„å‘³ç€åªè¦ä½ æœ‰ä¸€ä¸ª <code>useBoundStore</code> å‡½æ•°åœ¨è°ƒç”¨çš„æ—¶å€™æ²¡æœ‰ä¼ å…¥ selectorï¼Œé‚£ä¹ˆåœ¨ä»»æ„ä¸€ä¸ªåœ°æ–¹çš„ä»»æ„ä¸€ä¸ª <code>setState()</code> çš„è°ƒç”¨éƒ½ä¼šå¯¼è‡´è¿™ä¸ªç»„ä»¶ä¼šå‘ç”Ÿé‡æ¸²æŸ“ï¼Œè€Œä¸ç®¡ä½ åœ¨å½“å‰ç»„ä»¶æ‰€æ¶ˆè´¹çš„ state å€¼æ˜¯å¦æœ‰å‘ç”Ÿå˜åŒ–ã€‚æ¯”å¦‚ä¸‹é¢çš„å†™æ³•ä¸­çš„ <code>&lt;ComponentB /&gt;</code>å°±ä¼šå¯¼è‡´ä¸å¿…è¦çš„é‡æ¸²æŸ“ï¼š</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// å®šä¹‰ä¸€ä¸ª Zustand store</span>
<span class="hljs-keyword">import</span> { create } <span class="hljs-keyword">from</span> <span class="hljs-string">'zustand'</span>

<span class="hljs-keyword">const</span> useStore = <span class="hljs-title function_">create</span>(<span class="hljs-function">(<span class="hljs-params">set</span>) =&gt;</span> ({
  <span class="hljs-attr">count</span>: <span class="hljs-number">0</span>,
  <span class="hljs-attr">name</span>: <span class="hljs-string">'Alice'</span>,
  <span class="hljs-attr">increment</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">set</span>(<span class="hljs-function">(<span class="hljs-params">state</span>) =&gt;</span> ({ <span class="hljs-attr">count</span>: state.<span class="hljs-property">count</span> + <span class="hljs-number">1</span> })),
  <span class="hljs-attr">setName</span>: <span class="hljs-function">(<span class="hljs-params">name</span>) =&gt;</span> <span class="hljs-title function_">set</span>({ name }),
}))

<span class="hljs-comment">// ç»„ä»¶ Aï¼šåªå…³å¿ƒ count</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">ComponentA</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> count = <span class="hljs-title function_">useStore</span>(<span class="hljs-function">(<span class="hljs-params">state</span>) =&gt;</span> state.<span class="hljs-property">count</span>) <span class="hljs-comment">// ä½¿ç”¨ selectorï¼Œåªè®¢é˜… count</span>
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'ComponentA rendered'</span>)
  <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>Count: {count}<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
}

<span class="hljs-comment">// ç»„ä»¶ Bï¼šæ²¡æœ‰ä½¿ç”¨ selectorï¼Œç›´æ¥è·å–æ•´ä¸ª state</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">ComponentB</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> state = <span class="hljs-title function_">useStore</span>() <span class="hljs-comment">// æ²¡æœ‰ä½¿ç”¨ selectorï¼Œè·å–æ•´ä¸ª state</span>
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'ComponentB rendered'</span>)
  <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>Name: {state.name}<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
}

<span class="hljs-comment">// çˆ¶ç»„ä»¶ï¼šåŒ…å«ä¸¤ä¸ªå­ç»„ä»¶</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">App</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">ComponentA</span> /&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">ComponentB</span> /&gt;</span>
    <span class="hljs-tag">&lt;/&gt;</span></span>
  )
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title class_">App</span>
</code></pre>
<ul>
<li>ComponentA ä½¿ç”¨äº† selectorï¼Œåªè®¢é˜…äº† count å­—æ®µã€‚å½“ count å‘ç”Ÿå˜åŒ–æ—¶ï¼ŒComponentA ä¼šé‡æ–°æ¸²æŸ“ï¼›å½“ name å‘ç”Ÿå˜åŒ–æ—¶ï¼ŒComponentA ä¸ä¼šé‡æ–°æ¸²æŸ“ã€‚</li>
<li>ComponentB æ²¡æœ‰ä½¿ç”¨ selectorï¼Œç›´æ¥è·å–äº†æ•´ä¸ª stateã€‚é‚£ä¹ˆå½“æˆ‘è°ƒç”¨ <code>setState</code> æ–¹æ³•å»æ›´æ–° count çš„æ—¶å€™ï¼ŒComponentB ä¼šé‡æ–°æ¸²æŸ“ã€‚è€Œè¿™æ­£æ˜¯ä¸å¿…è¦çš„æ¸²æŸ“ - å› ä¸ºæˆ‘ç»„ä»¶å†…éƒ¨æ ¹æœ¬å°±æ²¡æœ‰ä½¿ç”¨åˆ° count è¿™ä¸ªå­—æ®µã€‚</li>
</ul>
<p><strong>é€šè¿‡ selector å‡½æ•°ï¼Œæˆ‘ä»¬å‘ŠçŸ¥äº† react core å¯¹æ¯”æ–°æ—§ snapshot å€¼çš„æ—¶å€™æ˜¯ä» state è¿™é¢—æ ‘ä¸Šæ‘˜ä¸‹å“ªä¸ªåˆ†æ”¯çš„å€¼æ¥åšæ¯”è¾ƒã€‚åªæœ‰å½“è¿™ä¸ªåˆ†æ”¯çš„å€¼å‘ç”Ÿäº†æ”¹å˜ï¼Œreact core æ‰èƒ½å°†å½“å‰ç»„ä»¶æ ‡è®°ä¸ºéœ€è¦ rerenderã€‚è¿™å°±æ˜¯ zustand + react å€ŸåŠ© selector å‡½æ•°å®ç°æŒ‰éœ€ rerender çš„åŸç†ã€‚</strong></p>
<h2 data-id="heading-10">æ€»ç»“</h2>
<p>ä½œä¸ºç®€åŒ–ç‰ˆçš„ redux æˆ–è€…æ˜¯è¯´ redux çš„ç»§ä»»è€…ï¼Œzustand å…·æœ‰ä»¥ä¸‹ä¸‰ä¸ªç‰¹ç‚¹ï¼š</p>
<ul>
<li>çµæ´»</li>
<li>ç®€å•</li>
<li>é«˜æ€§èƒ½</li>
</ul>
<p>å› æ­¤ï¼Œzustand æ˜¯ä¸€ä¸ªéå¸¸ä¼˜ç§€çš„çŠ¶æ€ç®¡ç†åº“ï¼Œç‰¹åˆ«é€‚åˆä¸­å°å‹è§„æ¨¡çš„å‰ç«¯é¡¹ç›®ã€‚</p>
<p>åœ¨æºç å±‚é¢ï¼Œzustand é‡‡ç”¨å¹³å°æ— å…³çš„æºç å®ç°æ¶æ„ï¼ŒåŒ…æ‹¬äº†ä¸¤å±‚ï¼š</p>
<ul>
<li>vanilla å±‚ï¼›</li>
<li>react binding å±‚</li>
</ul>
<p>vanilla å±‚ä¸»è¦æ˜¯åˆ©ç”¨ã€Œé—­åŒ…ã€å’Œã€Œå‘å¸ƒè®¢é˜…ã€æ¨¡å¼æ¥å®ç°äº† zustand store å®ä¾‹çš„åˆ›å»ºï¼ŒçŠ¶æ€æ›´æ–°ï¼Œå’Œé€šçŸ¥æ‰€æœ‰çš„è®¢é˜…è€…ã€‚è¿™é‡Œçš„ä»£ç è·Ÿ redux core çš„æ ¸å¿ƒæ€æƒ³æ˜¯ä¸€æ¨¡ä¸€æ ·çš„ã€‚</p>
<p>åœ¨ react binding å±‚ä¸»è¦æ˜¯å€ŸåŠ© react åŸç”Ÿ API <code>useSyncExternalStore</code> æ¥ä¸¤å°† zustand core å’Œ react core æ¡¥æ¥åˆ°ä¸€å—ã€‚</p>
<p>å¦‚æ­¤ä¸€æ ·ï¼Œä½¿ç”¨ zustand ä½œä¸ºçŠ¶æ€ç®¡ç†ç±»åº“ï¼Œè¦æƒ³è§¦å‘ä¸€ä¸ªç»„ä»¶é‡æ¸²æŸ“ï¼Œå¿…é¡»è¦è¿‡ä¸¤ä¸ªå…³å¡ï¼š</p>
<ul>
<li>è°ƒç”¨ <code>setState(newState)</code> æ—¶å€™ä¼ å…¥çš„ newState å€¼å¿…é¡»æ˜¯ä¸€ä¸ªæ–°å¼•ç”¨æˆ–è€…<code>setState(ï¼ˆprevStateï¼‰=&gt; newState)</code>æƒ…å†µä¸‹<code>ï¼ˆprevStateï¼‰=&gt; newState</code> è¿”å›çš„å¿…é¡»æ˜¯ä¸€ä¸ªæ–°å¼•ç”¨ã€‚</li>
<li>å½“ zustand é€šçŸ¥æ‰€æœ‰çš„ listener çš„æ—¶å€™ï¼Œreact core è¿˜ä¼šè¿›è¡Œä¸€æ¬¡çš„æ–°æ—§ snapshot çš„æ¯”è¾ƒã€‚åªæœ‰æ–°æ—§ snapshot ä¸åŒï¼Œæ‰ä¼šè§¦å‘ç»„ä»¶çš„é‡æ¸²æŸ“ã€‚</li>
</ul>
<p>æœ€åï¼Œæˆ‘ä»¬å‰–æäº† zustand å®ç°æŒ‰éœ€ rerender çš„åŸç†ã€‚æœ¬è´¨ä¸Šå°±æ˜¯åœ¨ä¸Šé¢çš„ç¬¬äºŒä¸ªå…³å¡ä¸­ï¼Œæˆ‘ä»¬é€šè¿‡æŒ‡å®šä¸€ä¸ª selector å‡½æ•° æ¥å‘ŠçŸ¥ react core åº”è¯¥ä» state è¿™æ ‘ä¸Šæ‘˜ä¸‹å“ªä¸ªåˆ†æ”¯çš„å€¼æ¥åšæ–°æ—§å€¼çš„æ¯”è¾ƒã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[GLSurfaceViewåŸç†æ·±åº¦å‰–æï¼šä»OpenGL ESåˆ°Androidå±å¹•çš„æ¸²æŸ“ä¹‹æ—…]]></title>    <link>https://juejin.cn/post/7579168400989093923</link>    <guid>https://juejin.cn/post/7579168400989093923</guid>    <pubDate>2025-12-03T03:43:13.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7579168400989093923" data-draft-id="7579165599042437135" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="GLSurfaceViewåŸç†æ·±åº¦å‰–æï¼šä»OpenGL ESåˆ°Androidå±å¹•çš„æ¸²æŸ“ä¹‹æ—…"/> <meta itemprop="keywords" content="OpenGL"/> <meta itemprop="datePublished" content="2025-12-03T03:43:13.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="èŠ‚èŠ‚è™«"/> <meta itemprop="url" content="https://juejin.cn/user/1706083975700750"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            GLSurfaceViewåŸç†æ·±åº¦å‰–æï¼šä»OpenGL ESåˆ°Androidå±å¹•çš„æ¸²æŸ“ä¹‹æ—…
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1706083975700750/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    èŠ‚èŠ‚è™«
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-03T03:43:13.000Z" title="Wed Dec 03 2025 03:43:13 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-03
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»8åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">ä¸€ã€èƒŒæ™¯ï¼šä¸ºä½•éœ€è¦GLSurfaceViewï¼Ÿ</h2>
<p>åœ¨åº”ç”¨å¼€å‘ä¸­ï¼Œå›¾å½¢ç»˜åˆ¶é€šå¸¸é€šè¿‡å„ç§<code>é«˜çº§API</code>å¦‚Android Canvasçš„<code>drawXXX</code>æ–¹æ³•å®Œæˆã€‚ä½†è¿™äº›æ¥å£é€šå¸¸ç»è¿‡äº†å±‚å±‚å°è£…ï¼Œåº•å±‚å¤æ‚çš„å›¾å½¢åº“è°ƒç”¨å¯¹å¼€å‘è€…é€æ˜ï¼Œæˆ‘ä»¬ä¸çŸ¥é“Canvasä»å“ªæ¥ï¼Œä¹Ÿä¸çŸ¥é“ç»˜åˆ¶æ–¹æ³•åˆ°åº•åšäº†å•¥ã€‚</p>
<p>æœ‰æ²¡æœ‰åŠæ³•å¯ä»¥çª¥æ¢appåº•å±‚è°ƒç”¨å›¾å½¢åº“æ¥å£å‘¢ï¼Ÿâ€”â€”ç­”æ¡ˆå°±æ˜¯<code>GLSurfaceView</code>ã€‚</p>
<p>GLSurfaceViewè™½ç„¶ç»§æ‰¿è‡ªSurfaceViewï¼Œä½†ä¸¤è€…å´æœ‰æœ¬è´¨åŒºåˆ«ï¼š</p>
<ul>
<li>
<p><strong>SurfaceViewï¼š</strong> é€šè¿‡Canvasé«˜çº§æ¥å£ç»˜åˆ¶ï¼Œç»å†HWUIæ”¶é›†æŒ‡ä»¤â†’Skiaå›¾å½¢åº“è½¬æ¢â†’OpenGL/Vulkanåº•å±‚è°ƒç”¨çš„å¤æ‚æµç¨‹</p>
</li>
<li>
<p><strong>GLSurfaceViewï¼š</strong> æä¾›ç›´æ¥çš„OpenGLåŸå§‹ç»˜åˆ¶æŒ‡ä»¤è°ƒç”¨ï¼Œè®©å¼€å‘è€…èƒ½å¤Ÿç›´æ¥æ“æ§åº•å±‚å›¾å½¢æ¸²æŸ“</p>
</li>
</ul>
<p>æœ¬æ–‡å°†æ·±å…¥åˆ†æGLSurfaceViewå¦‚ä½•æ¶èµ·åº”ç”¨å±‚ä¸OpenGL ESä¹‹é—´çš„æ¡¥æ¢ã€‚</p>
<h2 data-id="heading-1">äºŒã€GLSurfaceViewåŸºç¡€ä½¿ç”¨</h2>
<p>åœ¨æ·±å…¥ä¹‹å‰å…ˆçœ‹ä¸€ä¸‹GLSurfaceViewä½¿ç”¨çš„ç®€å•ä¾‹å­ï¼ŒGLSurfaceViewä½œä¸ºä¸€ä¸ªæ™®é€šçš„Viewå¯ä»¥åµŒå…¥åˆ°Androidçš„Viewæ ‘ä¸Šï¼Œé€šè¿‡setRendereræ¥å£è®¾ç½®ä¸€ä¸ªRendererå¯¹è±¡ï¼ŒRendereræ¥å£æœ‰3ä¸ªæ–¹æ³•ï¼š<code>onSurfaceCratedã€onSurfaceChangedã€onDrawFrameï¼Œ</code>åå­—å¾ˆæ¸…æ™°ï¼Œåˆ†åˆ«è¡¨ç¤ºï¼š<code>Surfaceåˆå§‹åŒ–å®Œæˆã€Surfaceå¤§å°æ”¹å˜ã€ç»˜åˆ¶ä¸€å¸§</code>ï¼Œæ‰€ä»¥åœ¨åº”ç”¨ç«¯è°ƒç”¨å°±æ˜¯é€šè¿‡åœ¨onDrawFrameé‡Œç›´æ¥è°ƒç”¨GLE20æä¾›çš„ç»˜åˆ¶æ–¹æ³•è¿›è¡Œç»˜åˆ¶ã€‚</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// GLSurfaceViewä½¿ç”¨çš„ç®€å•ä¾‹å­</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">GLSurfaceViewDemo</span> : Activity() {
Â Â Â Â override fun <span class="hljs-title function_">onCreate</span><span class="hljs-params">(savedInstanceState: Bundle?)</span> {
Â Â Â Â Â Â Â Â <span class="hljs-built_in">super</span>.onCreate(savedInstanceState)
Â Â Â Â Â Â Â Â <span class="hljs-type">val</span> <span class="hljs-variable">glSurfaceView</span> <span class="hljs-operator">=</span> GLSurfaceView(<span class="hljs-built_in">this</span>)

Â Â Â Â Â Â Â Â <span class="hljs-comment">// å…³é”®é…ç½®</span>
Â Â Â Â Â Â Â Â glSurfaceView.setEGLContextClientVersion(<span class="hljs-number">2</span>)Â Â <span class="hljs-comment">// ä½¿ç”¨OpenGL ES 2.0</span>
Â Â Â Â Â Â Â Â glSurfaceView.renderMode = GLSurfaceView.RENDERMODE_WHEN_DIRTYÂ Â <span class="hljs-comment">// æŒ‰éœ€æ¸²æŸ“</span>
Â Â Â Â Â Â Â Â glSurfaceView.setRenderer(object : GLSurfaceView.Renderer {
Â Â Â Â Â Â Â Â Â Â Â Â override fun <span class="hljs-title function_">onSurfaceCreated</span><span class="hljs-params">(gl: GL10?, config: EGLConfig?)</span> {
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <span class="hljs-comment">// è®¾ç½®æ¸…å±é¢œè‰²ä¸ºé»‘è‰²</span>
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â GLES20.glClearColor(<span class="hljs-number">0.0f</span>, <span class="hljs-number">0.0f</span>, <span class="hljs-number">0.0f</span>, <span class="hljs-number">1.0f</span>)
Â Â Â Â Â Â Â Â Â Â Â Â }

Â Â Â Â Â Â Â Â Â Â Â Â override fun <span class="hljs-title function_">onSurfaceChanged</span><span class="hljs-params">(gl: GL10?, width: Int, height: Int)</span> {
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <span class="hljs-comment">// è®¾ç½®è§†å£å¤§å°</span>
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â GLES20.glViewport(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, width, height)
Â Â Â Â Â Â Â Â Â Â Â Â }

Â Â Â Â Â Â Â Â Â Â Â Â override fun <span class="hljs-title function_">onDrawFrame</span><span class="hljs-params">(gl: GL10?)</span> {
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <span class="hljs-comment">// æ‰§è¡Œæ¸…å±æ“ä½œ</span>
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â GLES20.glClear(GLES20.GL_COLOR_BUFFER_BIT)
Â Â  Â Â Â  Â Â Â  Â Â  Â Â â€¦  
Â Â  Â Â Â  Â Â Â  Â Â  Â  <span class="hljs-comment">// å…¶ä»–GLç»˜åˆ¶æ–¹æ³•  </span>
Â Â Â Â Â Â Â Â Â Â Â Â }
Â Â Â Â Â Â Â Â })
Â Â Â Â Â Â Â Â setContentView(glSurfaceView)
Â Â Â Â }
}
</code></pre>
<p><strong>æ ¸å¿ƒç–‘é—®ï¼š</strong> ä¸ºä½•GLES20çš„é™æ€æ–¹æ³•è°ƒç”¨èƒ½å¤Ÿç›´æ¥ç»˜åˆ¶åˆ°Viewä¸Šï¼Ÿç­”æ¡ˆéšè—åœ¨GLSurfaceViewçš„å†…éƒ¨å®ç°ä¸­ã€‚</p>
<h2 data-id="heading-2">ä¸‰ã€OpenGL ESæ¸²æŸ“åŸºç¡€ï¼šä»åº”ç”¨åˆ°å±å¹•çš„8ä¸ªå…³é”®æ­¥éª¤</h2>
<p>åœ¨æ·±å…¥GLSurfaceViewæºç å‰ï¼Œå…ˆäº†è§£æ ‡å‡†çš„OpenGL ESåº”ç”¨æ¸²æŸ“æµç¨‹ã€‚</p>
<p>åŒæ—¶æˆ‘ä»¬è¿˜éœ€è¦å›é¡¾ä¸€ä¸ªåè¯ï¼š<code>å¥æŸ„</code>ï¼ŒæŒæ¡è¿™ä¸ªåè¯çš„å«ä¹‰å¯¹åé¢å†…å®¹çš„ç†è§£æœ‰å¾ˆå¤§çš„å¸®åŠ©ã€‚å¥æŸ„ä¸€èˆ¬è¡¨ç¤ºä¸€ä¸ªç³»ç»Ÿèµ„æºè¿”å›ç»™äº†ç”¨æˆ·ç«¯ï¼Œä½†ç”¨æˆ·ç«¯åªèƒ½è·å–å…¶æ ‡è¯†(ä¸€èˆ¬ä¸ºä¸€ä¸ªæ•´å½¢å˜é‡)ï¼Œä½†æ˜¯æ¯åŠæ³•è·å–å…¶ç±»å‹ï¼Œä¹Ÿä¸èƒ½è®¿é—®å†…éƒ¨å±æ€§ï¼Œæ¯”å¦‚Cé‡Œçš„FILE*ã€Javaé‡Œçš„File Descriptorç­‰éƒ½æ˜¯å¥æŸ„ã€‚OpenGL è¿™ç§æ·±åº¦å’Œç³»ç»Ÿæ‰“äº¤é“çš„äº¤äº’ä¼šå¤šæ¬¡ä½¿ç”¨å¥æŸ„çš„æ¦‚å¿µã€‚</p>
<p>ä»åº”ç”¨å‘èµ·ç»˜åˆ¶åˆ°ç”»é¢æ˜¾ç¤ºåˆ°å±å¹•ï¼Œéœ€è¦ç»å†ä¸‹é¢<code>8</code>ä¸ªå…³é”®æ­¥éª¤ï¼š</p>
<pre><code class="hljs language-c" lang="c"><span class="hljs-comment">// 1. è·å–æ˜¾ç¤ºè®¾å¤‡å¥æŸ„</span>
EGLDisplay display = eglGetDisplay(EGL_DEFAULT_DISPLAY)

<span class="hljs-comment">// 2. åˆå§‹åŒ–æ˜¾ç¤ºè¿æ¥Â Â </span>
eglInitialize(display, nullptr, nullptr)

<span class="hljs-comment">// 3. é€‰æ‹©é…ç½®ï¼ˆé¢œè‰²ã€æ·±åº¦ç­‰å‚æ•°ï¼‰</span>
eglChooseConfig(display, attributes, &amp;config, <span class="hljs-number">1</span>, &amp;num_config)

<span class="hljs-comment">// 4. åˆ›å»ºæ¸²æŸ“ä¸Šä¸‹æ–‡ï¼ˆåˆ†é…èµ„æºï¼Œç»´æŠ¤çŠ¶æ€æœºï¼‰</span>
EGLContext context = eglCreateContext(display, config, nullptr, attrs)

<span class="hljs-comment">// 5. åˆ›å»ºç»˜åˆ¶è¡¨é¢ï¼ˆè¿æ¥åŸç”Ÿçª—å£ç³»ç»Ÿï¼‰</span>
EGLSurface surface = eglCreateWindowSurface(display, config, window, nullptr)

<span class="hljs-comment">// 6. ç»‘å®šä¸Šä¸‹æ–‡åˆ°å½“å‰çº¿ç¨‹</span>
eglMakeCurrent(display, surface, surface, context)

<span class="hljs-comment">// 7. æ‰§è¡ŒOpenGLç»˜åˆ¶å‘½ä»¤</span>
glClear(GL_COLOR_BUFFER_BIT)
glDrawArrays(...)
<span class="hljs-comment">// åƒç´ æ•°æ®å†™å…¥åç¼“å†²åŒºï¼ˆBack Bufferï¼‰</span>
 
<span class="hljs-comment">// 8. äº¤æ¢ç¼“å†²åŒºï¼Œæ˜¾ç¤ºåˆ°å±å¹•</span>
eglSwapBuffers(display, surface)
</code></pre>
<p>è¿™<code>8ä¸ªæ­¥éª¤æ„æˆäº†ä»»ä½•OpenGL ESåº”ç”¨çš„åŸºç¡€æ¡†æ¶</code>ï¼ŒGLSurfaceViewæ­£æ˜¯åœ¨Javaå±‚å®ç°äº†è¿™ä¸€æµç¨‹ã€‚</p>
<h2 data-id="heading-3">å››ã€GLSurfaceViewæºç æ·±åº¦è§£æ</h2>
<h4 data-id="heading-4">4.1 åˆå§‹åŒ–å…¥å£ï¼šsetRendereræ–¹æ³•</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setRenderer</span><span class="hljs-params">(Renderer renderer)</span> {
Â Â Â Â checkRenderThreadState()Â Â <span class="hljs-comment">// ç¡®ä¿åªè®¾ç½®ä¸€æ¬¡</span>

Â Â Â Â <span class="hljs-comment">// åˆå§‹åŒ–é»˜è®¤é…ç½®å·¥å‚</span>
Â Â Â Â <span class="hljs-keyword">if</span> (mEGLConfigChooser == <span class="hljs-literal">null</span>) {
Â Â Â Â Â Â Â Â mEGLConfigChooser = <span class="hljs-keyword">new</span> <span class="hljs-title class_">SimpleEGLConfigChooser</span>(<span class="hljs-literal">true</span>)
Â Â Â Â }

Â Â Â Â <span class="hljs-keyword">if</span> (mEGLContextFactory == <span class="hljs-literal">null</span>) {
Â Â Â Â Â Â Â Â mEGLContextFactory = <span class="hljs-keyword">new</span> <span class="hljs-title class_">DefaultContextFactory</span>()
Â Â Â Â }

Â Â Â Â <span class="hljs-keyword">if</span> (mEGLWindowSurfaceFactory == <span class="hljs-literal">null</span>) {
Â Â Â Â Â Â Â Â mEGLWindowSurfaceFactory = <span class="hljs-keyword">new</span> <span class="hljs-title class_">DefaultWindowSurfaceFactory</span>()
Â Â Â Â }
Â Â Â 
Â Â Â Â mRenderer = <span class="hljs-type">renderer</span>
Â Â Â Â <span class="hljs-variable">mGLThread</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">GLThread</span>(mThisWeakRef)Â Â <span class="hljs-comment">// åˆ›å»ºä¸“å±æ¸²æŸ“çº¿ç¨‹</span>
Â Â Â Â mGLThread.start()
}
</code></pre>
<p>è¿™é‡Œåˆ›å»ºäº†ä¸‰ä¸ªæ ¸å¿ƒå·¥å‚å¯¹è±¡ï¼Œåˆ†åˆ«è´Ÿè´£EGLé…ç½®é€‰æ‹©ã€ä¸Šä¸‹æ–‡åˆ›å»ºå’Œè¡¨é¢ç®¡ç†ã€‚</p>
<h4 data-id="heading-5">4.2 GLThreadï¼šæ¸²æŸ“çº¿ç¨‹çš„æ ¸å¿ƒå¼•æ“</h4>
<p>GLThreadçš„<code>guardedRun()</code>æ–¹æ³•æ˜¯æ•´ä¸ªæ¸²æŸ“æµç¨‹çš„è°ƒåº¦ä¸­å¿ƒï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">guardedRun</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> InterruptedException {
Â Â Â Â mEglHelper = <span class="hljs-keyword">new</span> <span class="hljs-title class_">EglHelper</span>(mGLSurfaceViewWeakRef);
Â Â Â Â mHaveEglContext = <span class="hljs-literal">false</span>;
Â Â Â Â mHaveEglSurface = <span class="hljs-literal">false</span>;
Â Â Â Â mWantRenderNotification = <span class="hljs-literal">false</span>;


Â Â Â Â <span class="hljs-keyword">try</span> {
Â Â Â Â Â Â Â Â ...
Â Â Â Â Â Â Â Â <span class="hljs-keyword">while</span> (<span class="hljs-literal">true</span>) { <span class="hljs-comment">// æ¸²æŸ“å¾ªç¯</span>
Â Â Â Â Â Â Â Â Â Â Â Â <span class="hljs-keyword">synchronized</span> (sGLThreadManager) {
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <span class="hljs-keyword">while</span> (<span class="hljs-literal">true</span>) { <span class="hljs-comment">// æ§åˆ¶å¾ªç¯</span>
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â ...
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <span class="hljs-keyword">if</span> (readyToDraw()) { <span class="hljs-comment">// å‡†å¤‡ç»˜åˆ¶</span>
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â ...
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <span class="hljs-comment">//åˆ›å»ºEGLContextä¸Šä¸‹æ–‡</span>
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â mEglHelper.start();
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â ...
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â }
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â ...Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â 
Â Â  Â Â Â  Â Â Â  Â Â Â  Â }
Â  Â  Â  Â  Â  Â  Â  Â  ...
Â  Â  Â  Â  Â  Â  Â  Â  <span class="hljs-comment">//åˆ›å»ºEGLSurfaceï¼ŒæŠŠViewçš„Surfaceå°è£…æˆEGLSurfaceç»™OpenGLç»˜åˆ¶</span>
Â  Â  Â  Â  Â  Â  Â  Â  <span class="hljs-keyword">if</span> (mEglHelper.createSurface()) {
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â ...
Â  Â  Â  Â  Â  Â  Â  Â  }

Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <span class="hljs-comment">// åœ¨è¿™ä¹‹åï¼Œå½“å‰çº¿ç¨‹ä¾¿å¯ä»¥æ‰§è¡Œç»˜åˆ¶æ“ä½œäº†</span>

Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â ...

Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <span class="hljs-comment">//è·å–GLå¯¹è±¡ï¼ŒåŒ…è£…OpenGL APIç¯å¢ƒï¼Œè¿™é‡Œä½¿ç”¨GL10</span>
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â gl = (GL10) mEglHelper.createGL();
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â ...

Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <span class="hljs-comment">//å›è°ƒå¤–éƒ¨Rendererå¯¹è±¡çš„`onSurfaceCreated()`æ–¹æ³•</span>
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <span class="hljs-type">GLSurfaceView</span> <span class="hljs-variable">view</span> <span class="hljs-operator">=</span> mGLSurfaceViewWeakRef.get();
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â view.mRenderer.onSurfaceCreated(gl, mEglHelper.mEglConfig);
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â ...

Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <span class="hljs-keyword">if</span> (sizeChanged) {
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â ...
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <span class="hljs-comment">//å›è°ƒå¤–éƒ¨Rendererå¯¹è±¡çš„`onSurfaceChanged()`æ–¹æ³•</span>
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â view.mRenderer.onSurfaceChanged(gl, w, h);
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â ...
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â }
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â ...
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <span class="hljs-comment">//å›è°ƒå¤–éƒ¨Rendererå¯¹è±¡çš„`onDrawFrame()`æ–¹æ³•</span>
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â view.mRenderer.onDrawFrame(gl);
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â ...

Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <span class="hljs-comment">//Egläº¤äº’å†…å­˜ï¼Œopenglä½¿ç”¨çš„åŒå†…å­˜ç¼“å†²ï¼Œä¸€ä¸ªè¿›è¡Œæ˜¾ç¤ºï¼Œå¦ä¸€ä¸ªåˆ™åå°è¿›è¡Œç»˜åˆ¶ï¼Œç»˜åˆ¶OKåï¼Œäº¤äº’å†…å­˜è¿›è¡Œæ˜¾ç¤º</span>
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <span class="hljs-type">int</span> <span class="hljs-variable">swapError</span> <span class="hljs-operator">=</span> mEglHelper.swap();
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â ...
Â Â Â Â Â Â Â Â }
Â Â Â Â } <span class="hljs-keyword">finally</span> {
Â Â  Â Â Â  Â <span class="hljs-keyword">synchronized</span> (sGLThreadManager) {
Â Â  Â Â Â  Â Â Â  Â stopEglSurfaceLocked();
Â Â  Â Â Â  Â Â Â  Â stopEglContextLocked();
Â Â  Â Â Â  Â }
Â Â Â }
}


<span class="hljs-comment">// æ˜¯å¦å¯ä»¥ç»˜åˆ¶å†…å®¹äº†</span>
<span class="hljs-keyword">private</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">readyToDraw</span><span class="hljs-params">()</span> {
Â Â Â Â <span class="hljs-keyword">return</span> (!mPaused)Â Â <span class="hljs-comment">// æ²¡æœ‰æš‚åœ</span>
Â Â Â Â Â Â Â Â Â Â Â Â &amp;&amp; mHasSurfaceÂ Â <span class="hljs-comment">// Surfaceæ˜¯å¦å·²ç»åˆ›å»º(æ³¨æ„Surfaceå’ŒEGLSurfaceæ˜¯ä¸ä¸€æ ·çš„)</span>
Â Â Â Â Â Â Â Â Â Â Â Â &amp;&amp; (!mSurfaceIsBad) <span class="hljs-comment">// EGLSurfaceæ˜¯å¦å¯ç”¨</span>
Â Â Â Â Â Â Â Â Â Â Â Â &amp;&amp; (mWidth &gt; <span class="hljs-number">0</span>)Â Â <span class="hljs-comment">// Surfaceçš„å¤§å°</span>
Â Â Â Â Â Â Â Â Â Â Â Â &amp;&amp; (mHeight &gt; <span class="hljs-number">0</span>)
Â Â Â Â Â Â Â Â Â Â Â Â &amp;&amp; (mRequestRender || (mRenderMode == RENDERMODE_CONTINUOUSLY)Â Â <span class="hljs-comment">// æ‰‹åŠ¨åˆ·æ–°æˆ–è€…è‡ªåŠ¨åˆ·æ–°</span>
Â Â Â Â );
}
</code></pre>
<p>guardedRunæ–¹æ³•æ¯”è¾ƒå¤æ‚ï¼Œå†…éƒ¨å¯åŠ¨ä¸¤ä¸ªå¾ªç¯ï¼Œå¤–å¾ªç¯æ˜¯æ¸²æŸ“å¾ªç¯ï¼Œæ¯ä¸ªå¾ªç¯éƒ½ä¼šç»˜åˆ¶ä¸€å¸§ï¼Œ å†…éƒ¨å¾ªç¯çŠ¶æ€æ£€æŸ¥å„ç§çŠ¶æ€ã€‚ä»readyToDraw()æ–¹æ³•å¼€å§‹çœ‹ï¼Œè¿™ä¸ªæ–¹æ³•è¡¨ç¤ºå½“å‰å‡†å¤‡å¥½ å¯ä»¥å¼€å§‹ç»˜åˆ¶äº†ã€‚readToDraw()æ£€æŸ¥å½“å‰æ˜¯å¦å¯ä»¥è¿›è¡Œç»˜åˆ¶ï¼Œå¦‚æœå¯ä»¥è¿›è¡Œç»˜åˆ¶ï¼Œåˆ™å¼€å§‹OpenGLä¸Šä¸‹æ–‡çš„åˆå§‹åŒ–ã€‚</p>
<p><strong>EglHelper.start()</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">start</span><span class="hljs-params">()</span> {
Â  Â  ...  
Â Â Â Â mEgl = (EGL10) EGLContext.getEGL()Â Â <span class="hljs-comment">// è·å–EGLå®ä¾‹</span>
Â  Â  ...

Â Â Â Â <span class="hljs-comment">// æ­¥éª¤1ï¼šè·å–æ˜¾ç¤ºè®¾å¤‡</span>
Â Â Â Â mEglDisplay = mEgl.eglGetDisplay(EGL10.EGL_DEFAULT_DISPLAY)
Â Â Â Â  ...

Â Â Â Â <span class="hljs-comment">// æ­¥éª¤2ï¼šåˆå§‹åŒ–æ˜¾ç¤ºè¿æ¥</span>
Â Â Â Â mEgl.eglInitialize(mEglDisplay, version)
Â Â Â Â  ...

Â Â Â Â <span class="hljs-comment">// æ­¥éª¤3ï¼šé€‰æ‹©é…ç½®</span>
Â Â Â Â mEglConfig = view.mEGLConfigChooser.chooseConfig(mEgl, mEglDisplay)
Â Â Â Â  ...

Â Â Â Â <span class="hljs-comment">// æ­¥éª¤4ï¼šåˆ›å»ºæ¸²æŸ“ä¸Šä¸‹æ–‡</span>
Â Â Â Â mEglContext = view.mEGLContextFactory.createContext(mEgl, mEglDisplay, mEglConfig)
}
</code></pre>
<p>è¿™é‡Œçš„æ­¥éª¤å°±å’Œå‰é¢ä»‹ç»çš„appä½¿ç”¨OpenGLçš„å‰æ­¥ä¸€æ ·ï¼Œå…ˆè·å–æ˜¾ç¤ºè®¾å¤‡çš„<code>å¥æŸ„</code>ï¼Œç„¶å<code>åˆå§‹åŒ–</code>ã€æ¥ç€è¿›è¡Œ<code>é…ç½®</code>ï¼Œæœ€ååˆ›å»º<code>GLç¯å¢ƒ</code>ã€‚</p>
<p>åˆ°è¿™é‡ŒGLä¸Šä¸‹æ–‡å°±åˆ›å»ºå¥½äº†ï¼Œ ä¸‹ä¸€æ­¥å°±æ˜¯åˆ›å»ºEGLSurfaceï¼Œ è¿™é‡Œå…ˆé‡ç‚¹ä»‹ç»ä¸‹EGLSurfaceå’ŒAndroidç³»ç»Ÿé‡Œçš„Surfaceçš„åŒºåˆ«ï¼Œé¦–å…ˆå®ƒä»¬éƒ½æ˜¯ç»˜åˆ¶è¡¨é¢çš„æ„æ€ï¼Œä¹Ÿå°±æ˜¯ç»˜åˆ¶ç›®æ ‡ï¼Œå†…éƒ¨éƒ½åŒ…å«äº†BufferQueueç”¨æ¥ä¿å­˜ç»˜åˆ¶çš„ç»“æœã€‚Surfaceæ˜¯Androidè‡ªèº«çš„æ¦‚å¿µï¼ŒEGLSurfaceæ˜¯OpenGLçš„æ¦‚å¿µï¼Œæ˜¯å¤¸å¹³å°çš„å’Œå¹³å°æ— å…³ï¼Œæ‰€ä»¥åœ¨Androidç³»ç»Ÿä¸Šæƒ³è¦é€šè¿‡OpenGLç»˜åˆ¶å†…å®¹çš„è¯ï¼Œè¦å°†åŸç”Ÿçª—å£ï¼ˆå¦‚ Android çš„ ANativeWindowï¼‰åŒ…è£…æˆ EGL Surfaceï¼Œä½œä¸º OpenGL çš„æ¸²æŸ“ç›®æ ‡ï¼Œè¿æ¥ OpenGL å’Œå¹³å°çª—å£ç³»ç»Ÿã€‚é€šä¿—ç‚¹çš„ç†è§£å°±æ˜¯OpenGLå†…éƒ¨ä¼šåˆ›å»ºä¸€ä¸ªEGLSurfaceï¼Œä½†æ˜¯FrameBuffer SurfaceViewå·²ç»æœ‰äº†ï¼Œæ‰€ä»¥éœ€è¦å°†SurfaceViewé‡ŒSurfaceçš„FrameBufferè®¾ç½®ç»™EGLSurfaceï¼Œ ç”¨æ¥ä½œä¸ºOpenGLçš„ç»˜åˆ¶ç›®æ ‡ã€‚</p>
<p><strong>Surfaceåˆ›å»ºä¸ç»‘å®šï¼šEglHelper.createSurface()</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">createSurface</span><span class="hljs-params">()</span> {
Â Â Â Â <span class="hljs-comment">// æ­¥éª¤5ï¼šåˆ›å»ºEGLSurfaceï¼ˆåŒ…è£…Androidçš„Surfaceï¼‰</span>
Â Â Â Â mEglSurface = view.mEGLWindowSurfaceFactory.createWindowSurface(
Â Â Â Â Â Â Â Â mEgl, mEglDisplay, mEglConfig, view.getHolder())

Â Â Â Â 
Â Â Â Â <span class="hljs-comment">// æ­¥éª¤6ï¼šç»‘å®šåˆ°å½“å‰çº¿ç¨‹</span>
Â Â Â Â <span class="hljs-keyword">return</span> mEgl.eglMakeCurrent(mEglDisplay, mEglSurface, mEglSurface, mEglContext)
}
</code></pre>
<p>æ¥ä¸‹æ¥mEgl.eglMakeCurrentå°†EGLSurfaceå’ŒEGLContextç»‘å®šåˆ°å½“å‰çº¿ç¨‹ï¼Œç”¨æ¥åœ¨å½“å‰çº¿ç¨‹åšç»˜åˆ¶ï¼Œ è¿™æ­¥åœ¨å†…éƒ¨ä¼šæŠŠContextå’ŒSurfaceè®¾ç½®åˆ°ThreadLocalStorageï¼Œ è¿™æ ·åœ¨åé¢çš„OpenGLç»˜åˆ¶å‘½ä»¤å°±ä¸éœ€è¦æ¯æ¬¡éƒ½ä¼ å…¥contextå‚æ•°äº†ã€‚</p>
<p>è¿™ä¸€æ­¥æ‰§è¡Œå®Œåï¼Œå‰é¢ä»‹ç»appä½¿ç”¨OpenGLæ¸²æŸ“<code>8</code>æ­¥çš„å‰<code>å…­</code>æ­¥å°±åšå®Œäº†ï¼Œå‰©ä¸‹çš„å°±æ˜¯ç»˜åˆ¶å’Œç¼“å­˜äº¤æ¢ã€‚</p>
<p><strong>å›è°ƒRendererä¸šåŠ¡ç»˜åˆ¶å†…å®¹</strong></p>
<p>æ¥ä¸‹æ¥å°±æ˜¯è°ƒç”¨äº†å¤–éƒ¨è®¾ç½®çš„Rendererä¸‰ä¸ªæ¥å£ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">//å›è°ƒå¤–éƒ¨Rendererå¯¹è±¡çš„`onSurfaceCreated()`æ–¹æ³•</span>
<span class="hljs-type">GLSurfaceView</span> <span class="hljs-variable">view</span> <span class="hljs-operator">=</span> mGLSurfaceViewWeakRef.get();
view.mRenderer.onSurfaceCreated(gl, mEglHelper.mEglConfig);
...
<span class="hljs-keyword">if</span> (sizeChanged) {
Â Â Â Â ...
Â Â Â Â <span class="hljs-comment">//å›è°ƒå¤–éƒ¨Rendererå¯¹è±¡çš„`onSurfaceChanged()`æ–¹æ³•</span>
Â Â Â Â view.mRenderer.onSurfaceChanged(gl, w, h);
Â Â Â Â ...
}
...

<span class="hljs-comment">//å›è°ƒå¤–éƒ¨Rendererå¯¹è±¡çš„`onDrawFrame()`æ–¹æ³•</span>
view.mRenderer.onDrawFrame(gl);
</code></pre>
<p>è¿™æ—¶ç”¨æˆ·ä¸€èˆ¬å°±åœ¨onDrawFrame()é‡Œè°ƒç”¨OpenGLçš„ç»˜åˆ¶ï¼Œæ–¹æ³•æ‰§è¡Œå®Œä¹‹åç»˜åˆ¶æ•°æ®åˆ°äº†Surfaceé‡ŒBufferQueueé‡Œåç«¯ï¼Œæ¥ç€è°ƒç”¨<code>mEglHelper.swap()</code>æŠŠæ•°æ®æ˜¾ç¤ºç»™å‰ç«¯ã€‚</p>
<p><strong>ç¼“å†²åŒºäº¤æ¢ï¼šEglHelper.swap()</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">swap</span><span class="hljs-params">()</span> {
Â Â Â Â <span class="hljs-comment">// æ­¥éª¤8ï¼šäº¤æ¢å‰åç¼“å†²åŒº</span>
Â Â Â Â <span class="hljs-keyword">if</span> (!mEgl.eglSwapBuffers(mEglDisplay, mEglSurface)) {
Â Â Â Â Â Â Â Â <span class="hljs-keyword">return</span> mEgl.eglGetError()
Â Â Â Â }
Â Â Â Â <span class="hljs-keyword">return</span> EGL10.EGL_SUCCESS
}
</code></pre>
<p>mEglHelper.swap()çš„ä»£ç  SurfaceViewä½¿ç”¨åŒå†…å­˜ç¼“å†²æœºåˆ¶ï¼Œå†…éƒ¨æœ‰ä¸¤ä¸ªFrambufferï¼Œä¸€ä¸ªè¿›è¡Œå‰å°æ˜¾ç¤ºï¼Œå¦ä¸€ä¸ªåˆ™åå°è¿›è¡Œç»˜åˆ¶ï¼Œç»˜åˆ¶OKåï¼Œäº¤äº’å†…å­˜è¿›è¡Œæ˜¾ç¤ºã€‚eglSwapBuffersçš„ç›®çš„æ˜¯æ¸²æŸ“å¥½çš„FrameBufferå’Œå‰å°çš„Framebufferäº¤äº’åæ˜¾ç¤ºå‡ºæ¥</p>
<h4 data-id="heading-6">4.3 ç”Ÿå‘½å‘¨æœŸç®¡ç†ï¼šæš‚åœä¸æ¢å¤æœºåˆ¶</h4>
<ul>
<li>
<p>æš‚åœå®ç°</p>
</li>
</ul>
<pre><code class="hljs language-java" lang="java">mRequestPaused = <span class="hljs-literal">true</span>
sGLThreadManager.notifyAll()Â Â <span class="hljs-comment">// å”¤é†’ç­‰å¾…çš„æ¸²æŸ“çº¿ç¨‹</span>
</code></pre>
<p>åœ¨æ¸²æŸ“å¾ªç¯ä¸­æ£€æµ‹åˆ°çŠ¶æ€å˜åŒ–ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">if</span> (mPaused != mRequestPaused) {
Â Â Â Â pausing = <span class="hljs-type">mRequestPaused</span>
Â Â Â Â <span class="hljs-variable">mPaused</span> <span class="hljs-operator">=</span> mRequestPaused

Â Â Â Â <span class="hljs-title function_">if</span> <span class="hljs-params">(pausing)</span> {
Â Â Â Â Â Â Â Â <span class="hljs-comment">// é‡Šæ”¾EGLSurfaceå’ŒEGLContextï¼ˆå¯é€‰ï¼‰</span>
Â Â Â Â Â Â Â Â stopEglSurfaceLocked()
Â Â Â Â Â Â Â Â <span class="hljs-keyword">if</span> (!preserveEglContextOnPause) {
Â Â Â Â Â Â Â Â Â Â Â Â stopEglContextLocked()
Â Â Â Â Â Â Â Â }
Â Â Â Â }
}
</code></pre>
<p>æš‚åœåï¼Œ<code>readyToDraw()</code>è¿”å›falseï¼Œæ¸²æŸ“çº¿ç¨‹åœ¨å†…éƒ¨å¾ªç¯ä¸­ç­‰å¾…ã€‚</p>
<p>*æ¢å¤å®ç°</p>
<p>onResume()å°†çŠ¶æ€é‡ç½®ï¼š</p>
<pre><code class="hljs language-java" lang="java">mRequestPaused = <span class="hljs-type">false</span>
<span class="hljs-variable">mRequestRender</span> <span class="hljs-operator">=</span> <span class="hljs-literal">true</span>
sGLThreadManager.notifyAll()
</code></pre>
<p>æ¸²æŸ“çº¿ç¨‹æ£€æµ‹åˆ°çŠ¶æ€å˜åŒ–åé‡æ–°åˆå§‹åŒ–EGLç¯å¢ƒå¹¶ç»§ç»­æ¸²æŸ“å¾ªç¯ã€‚</p>
<h4 data-id="heading-7">4.4 çº¿ç¨‹é€€å‡ºæœºåˆ¶</h4>
<p>GLThreadé€šè¿‡mShouldExitæ ‡å¿—æ§åˆ¶é€€å‡ºï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">requestExitAndWait</span><span class="hljs-params">()</span> {
Â Â Â Â <span class="hljs-keyword">synchronized</span>(sGLThreadManager) {
Â Â Â Â Â Â Â Â mShouldExit = <span class="hljs-literal">true</span>
Â Â Â Â Â Â Â Â sGLThreadManager.notifyAll()
Â Â Â Â Â Â Â Â <span class="hljs-keyword">while</span> (!mExited) {
Â Â Â Â Â Â Â Â Â Â Â Â sGLThreadManager.wait()Â Â <span class="hljs-comment">// ç­‰å¾…çº¿ç¨‹å®Œå…¨é€€å‡º</span>
Â Â Â Â Â Â Â Â }
Â Â Â Â }
}
</code></pre>
<p>é€€å‡ºè§¦å‘ç‚¹åœ¨onDetachedFromWindow()ä¸­è°ƒç”¨ï¼Œç¡®ä¿åœ¨Viewè„±ç¦»çª—å£æ—¶å®‰å…¨åœæ­¢æ¸²æŸ“çº¿ç¨‹ã€‚</p>
<h2 data-id="heading-8">äº”ã€æ ¸å¿ƒåŸç†æ€»ç»“</h2>
<ol>
<li>
<p>çº¿ç¨‹åˆ†ç¦»ï¼šGLSurfaceViewåˆ›å»ºä¸“ç”¨æ¸²æŸ“çº¿ç¨‹ï¼Œé¿å…UIçº¿ç¨‹é˜»å¡</p>
</li>
<li>
<p>EGLæ¡¥æ¢ä½œç”¨ï¼šé€šè¿‡EGLè¿æ¥OpenGL ES APIä¸AndroidåŸç”Ÿçª—å£ç³»ç»Ÿ</p>
</li>
<li>
<p>åŒç¼“å†²æœºåˆ¶ï¼šå‰ç¼“å†²åŒºæ˜¾ç¤ºï¼Œåç¼“å†²åŒºæ¸²æŸ“ï¼Œé€šè¿‡äº¤æ¢å®ç°æµç•…æ˜¾ç¤º</p>
</li>
<li>
<p>çŠ¶æ€æœºç®¡ç†ï¼šå®Œå–„çš„æš‚åœ/æ¢å¤/é€€å‡ºç”Ÿå‘½å‘¨æœŸç®¡ç†</p>
</li>
<li>
<p>Surfaceå°è£…ï¼šå°†Android SurfaceåŒ…è£…ä¸ºEGLSurfaceï¼Œå®ç°å¹³å°æ— å…³çš„OpenGLæ¸²æŸ“</p>
</li>
</ol>
<p>GLSurfaceViewçš„æœ¬è´¨æ˜¯åœ¨Javaå±‚å®Œæ•´å®ç°äº†OpenGL ESçš„æ ‡å‡†æ¸²æŸ“æµç¨‹ï¼Œä¸ºAndroidåº”ç”¨æä¾›äº†ç›´æ¥è°ƒç”¨åº•å±‚å›¾å½¢åº“çš„èƒ½åŠ›ã€‚é€šè¿‡ç†è§£å…¶å†…éƒ¨æœºåˆ¶ï¼Œå¼€å‘è€…èƒ½å¤Ÿæ›´å¥½åœ°ä¼˜åŒ–æ¸²æŸ“æ€§èƒ½ï¼Œå¤„ç†å¤æ‚çš„å›¾å½¢éœ€æ±‚ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[å‘Šåˆ« XML ANRï¼ŸCompose çš„æ€§èƒ½é™·é˜±ä¸é‡ç»„ä¼˜åŒ–å®æˆ˜æŒ‡å—]]></title>    <link>https://juejin.cn/post/7579186764046041129</link>    <guid>https://juejin.cn/post/7579186764046041129</guid>    <pubDate>2025-12-03T04:18:17.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7579186764046041129" data-draft-id="7579179625461776426" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="å‘Šåˆ« XML ANRï¼ŸCompose çš„æ€§èƒ½é™·é˜±ä¸é‡ç»„ä¼˜åŒ–å®æˆ˜æŒ‡å—"/> <meta itemprop="keywords" content="Android"/> <meta itemprop="datePublished" content="2025-12-03T04:18:17.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ç”¨æˆ·4165967369355"/> <meta itemprop="url" content="https://juejin.cn/user/1146150492576877"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            å‘Šåˆ« XML ANRï¼ŸCompose çš„æ€§èƒ½é™·é˜±ä¸é‡ç»„ä¼˜åŒ–å®æˆ˜æŒ‡å—
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1146150492576877/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ç”¨æˆ·4165967369355
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-03T04:18:17.000Z" title="Wed Dec 03 2025 04:18:17 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-03
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    4
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»5åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p><strong>è§‚ç‚¹å…±é¸£ï¼š</strong> æœ‰äººè¯´ ANR ä¸ä¼šæ¶ˆå¤±ï¼Œåªä¼šè½¬ç§»ã€‚åœ¨ä» Android View è¿ç§»åˆ° Jetpack Compose çš„è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬æ·±åˆ‡åœ°ä½“ä¼šåˆ°äº†è¿™å¥è¯çš„å“²å­¦æ„ä¹‰ã€‚</p>
</blockquote>
<p>ä¼ ç»Ÿçš„ XML å¸ƒå±€è§£æå¸¦æ¥çš„æ€§èƒ½é—®é¢˜ï¼Œå¾€å¾€æ˜¯ Android å¼€å‘è€…å¤´ç—›çš„æ ¹æºã€‚Compose æˆåŠŸè§£å†³äº†æ—§ç—›ï¼Œå´å¸¦æ¥äº†æ–°çš„æŒ‘æˆ˜â€”â€”<strong>ä¸å¿…è¦çš„é‡ç»„ï¼ˆRecompositionï¼‰</strong> ã€‚æœ¬æ–‡å°†æ·±å…¥åˆ†æ Compose çš„æ€§èƒ½æ¨¡å‹ï¼Œå¹¶æä¾›ä¸€å¥—å®Œæ•´çš„å·¥å…·å’Œæ–¹æ³•ï¼Œæ•™ä½ å¦‚ä½•ç›‘æµ‹ã€æ’æŸ¥å’Œè§£å†³é‡ç»„å¼•å‘çš„æ€§èƒ½é—®é¢˜ã€‚</p>
<hr/>
<h2 data-id="heading-0">ä¸€ã€æ—§ç—›ï¼šä¸ºä»€ä¹ˆ XML å¸ƒå±€ä¼šå¸¦æ¥ ANR å’Œå¡é¡¿ï¼Ÿ</h2>
<p>åœ¨ä¼ ç»Ÿçš„ View ä½“ç³»ä¸­ï¼Œå¤æ‚çš„ XML å¸ƒå±€åœ¨ä¸»çº¿ç¨‹ä¸Šåˆå§‹åŒ–æ—¶ï¼Œä¸»è¦æœ‰ä¸‰ä¸ªæ€§èƒ½æ€æ‰‹ï¼š</p>
<ol>
<li><strong>ç£ç›˜ IO ä¸åå°„ (Reflection)ï¼š</strong> åŠ è½½ XML æ–‡ä»¶æ¶‰åŠç£ç›˜è¯»å–ï¼Œå¹¶ä¸”éœ€è¦é€šè¿‡ Java åå°„æœºåˆ¶å®ä¾‹åŒ–æ‰€æœ‰ View ç±»ï¼ˆå¦‚ <code>TextView</code>ã€<code>Button</code> ç­‰ï¼‰ã€‚è¿™æ˜¯ä¸€ä¸ªæ˜‚è´µçš„åˆå§‹åŒ–è¿‡ç¨‹ã€‚</li>
<li><strong>æ·±åº¦åµŒå¥—çš„æŒ‡æ•°çº§æ¶ˆè€— (Double Taxation)ï¼š</strong> View ä½“ç³»ä¸­ï¼Œçˆ¶ View ç»å¸¸éœ€è¦å¤šæ¬¡æµ‹é‡å¸¦æƒé‡æˆ–å¤æ‚çº¦æŸçš„å­ Viewã€‚å±‚çº§è¶Šæ·±ï¼Œæµ‹é‡æ¬¡æ•°å‘ˆæŒ‡æ•°çº§å¢é•¿ï¼Œæœ€ç»ˆå¯¼è‡´ä¸»çº¿ç¨‹é˜»å¡ã€‚</li>
</ol>
<p><strong>æ€»ç»“ï¼š</strong> XML çš„æ€§èƒ½å¼€é”€å‘ç”Ÿåœ¨**â€œåˆå§‹åŒ–â€**ï¼Œæ ¸å¿ƒç“¶é¢ˆåœ¨äº <strong>IOã€åå°„å’ŒæŒ‡æ•°çº§æµ‹é‡</strong>ã€‚</p>
<h2 data-id="heading-1">äºŒã€æ–°æ¨¡å‹ï¼šCompose çš„æ¶æ„ä¼˜åŠ¿ä¸æ€§èƒ½è½¬ç§»</h2>
<p>Compose è§£å†³äº† View ä½“ç³»çš„æ—§é—®é¢˜ï¼š</p>
<ul>
<li><strong>å‘Šåˆ« IO ä¸åå°„ï¼š</strong> Compose æ˜¯çº¯ Kotlin ä»£ç ï¼Œé€šè¿‡å‡½æ•°ç›´æ¥åˆ›å»º UI èŠ‚ç‚¹ï¼Œæ²¡æœ‰ XML è§£æçš„è´Ÿæ‹…ã€‚</li>
<li><strong>çº¿æ€§æ€§èƒ½ï¼š</strong> Compose éµå¾ª <strong>å•æ¬¡æµ‹é‡è§„åˆ™ (Single Pass Measurement)</strong> ã€‚æ— è®ºä½ çš„ UI åµŒå¥—å¤šæ·±ï¼Œæ¯ä¸ªèŠ‚ç‚¹åªä¼šè¢«æµ‹é‡ä¸€æ¬¡ã€‚å¤æ‚çš„å±‚çº§æ·±åº¦ä¸å†æ˜¯æ€§èƒ½çš„å¤´å·æ€æ‰‹ï¼Œæ€§èƒ½æŸè€—åªä¼šéšèŠ‚ç‚¹æ•°é‡å‘ˆ <strong>çº¿æ€§ (<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>O</mi><mo stretchy="false">(</mo><mi>N</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">O(N)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord mathnormal" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.10903em;">N</span><span class="mclose">)</span></span></span></span></span>)</strong> å¢é•¿ã€‚</li>
</ul>
<p>ä½†æ˜¯ï¼ŒANR æˆ–å¡é¡¿çš„é£é™©å¹¶æ²¡æœ‰æ¶ˆå¤±ï¼Œè€Œæ˜¯è½¬ç§»åˆ°äº† <strong>â€œé‡ç»„ï¼ˆRecompositionï¼‰â€</strong> ã€‚å¦‚æœä½ çš„ Composable å‡½æ•°å› ä¸ºä»£ç é€»è¾‘æˆ–ä¸ç¨³å®šçš„å‚æ•°è¢«é¢‘ç¹é‡å¤æ‰§è¡Œï¼Œå®ƒå°†å¤§é‡æ¶ˆè€— CPUï¼Œé˜»å¡ä¸»çº¿ç¨‹ï¼Œå¯¼è‡´å¡é¡¿ã€‚</p>
<hr/>
<h2 data-id="heading-2">ä¸‰ã€æ ¸å¿ƒç—›ç‚¹ï¼šç›‘æµ‹ä¸ä¼˜åŒ– Compose é‡ç»„</h2>
<p>é‡ç»„æ˜¯ Compose æ›´æ–° UI çš„æ ¸å¿ƒæœºåˆ¶ã€‚ä¼˜åŒ–çš„ç›®æ ‡æ˜¯ï¼š<strong>åªè®©éœ€è¦æ›´æ–°çš„ Composable é‡ç»„ï¼Œå¹¶è·³è¿‡ï¼ˆSkipï¼‰å…¶ä»– Composable çš„æ‰§è¡Œã€‚</strong></p>
<h3 data-id="heading-3">1. ç›‘æµ‹ï¼šå¦‚ä½•å‘ç°ä¸å¿…è¦çš„é‡ç»„ï¼Ÿ</h3>
<p>æˆ‘ä»¬ä¸»è¦ä¾é å¯è§†åŒ–å·¥å…·æ¥å®šä½é—®é¢˜åŒºåŸŸã€‚</p>
<h4 data-id="heading-4">â‘  Android Studio Layout Inspector (å¸ƒå±€æ£€æŸ¥å™¨)</h4>
<p>è¿™æ˜¯æœ€å®˜æ–¹ã€æœ€ç›´è§‚çš„å·¥å…·ã€‚</p>
<ul>
<li>
<p><strong>æ“ä½œæ–¹æ³•ï¼š</strong> è¿è¡Œ Appï¼Œæ‰“å¼€ <code>Tools</code> -&gt; <code>Layout Inspector</code>ã€‚</p>
</li>
<li>
<p><strong>å…³é”®è®¾ç½®ï¼š</strong> å‹¾é€‰ <strong><code>Show Recomposition Counts</code></strong> å’Œ <strong><code>Highlight Recompositions</code></strong>ã€‚</p>
</li>
<li>
<p><strong>è¯Šæ–­ä¾æ®ï¼š</strong></p>
<ul>
<li><strong>è®¡æ•°ï¼š</strong> è§‚å¯Ÿ Composable æ—è¾¹çš„æ•°å­—ï¼ˆ<code>é‡ç»„æ¬¡æ•° / è·³è¿‡æ¬¡æ•°</code>ï¼‰ã€‚å¦‚æœåœ¨ç”¨æˆ·æ²¡æœ‰è¿›è¡Œä»»ä½•æ“ä½œï¼Œæˆ–è€…çŠ¶æ€æ²¡æœ‰æ”¹å˜æ—¶ï¼Œ<strong>é‡ç»„æ¬¡æ•°</strong>ä¾ç„¶æŒç»­å¢é•¿ï¼Œåˆ™å­˜åœ¨é—®é¢˜ã€‚</li>
<li><strong>é«˜äº®ï¼š</strong> å‘ç”Ÿé‡ç»„çš„åŒºåŸŸä¼šé—ªçƒé¢œè‰²ï¼ˆé€šå¸¸æ˜¯è“ç»¿æ¸å˜ï¼‰ã€‚è§‚å¯Ÿé—ªçƒåŒºåŸŸæ˜¯å¦è¶…å‡ºé¢„æœŸã€‚</li>
</ul>
</li>
</ul>
<h4 data-id="heading-5">â‘¡ ç¬¬ä¸‰æ–¹åº“ï¼šRebugger (é€‚åˆè¿½è¸ªåŸå› )</h4>
<p>å¦‚æœä½ å‘ç°æŸä¸ª Composable é‡ç»„äº†ï¼Œä½†ä¸çŸ¥é“æ˜¯å“ªä¸ªå‚æ•°å˜äº†ï¼ŒRebugger å¯ä»¥æ‰“å° Logcat æ—¥å¿—ï¼š</p>
<p>Kotlin</p>
<pre><code class="hljs language-less" lang="less"><span class="hljs-comment">// è¿½è¸ªå¯¼è‡´é‡ç»„çš„å˜é‡</span>
<span class="hljs-selector-tag">Rebugger</span>(
    trackMap = <span class="hljs-built_in">mapOf</span>(
        <span class="hljs-string">"uiState"</span> to uiState,
        <span class="hljs-string">"userList"</span> to userList
    ),
)
<span class="hljs-comment">// Logcat ä¼šå‘Šè¯‰ä½ ï¼šå“ªä¸ªå‚æ•°ä»ä»€ä¹ˆå€¼å˜åˆ°äº†ä»€ä¹ˆå€¼ã€‚</span>
</code></pre>
<h3 data-id="heading-6">2. æ’æŸ¥ï¼šæ‰¾å‡ºé‡ç»„çš„æ ¹æœ¬åŸå› â€”â€”å‚æ•°ä¸ç¨³å®š</h3>
<p>é‡ç»„çš„æ ¹æœ¬åŸå› ï¼Œåœ¨äº Compose ç¼–è¯‘å™¨æ— æ³•ç¡®å®šä½ çš„ Composable å‡½æ•°å‚æ•°æ˜¯å¦<strong>ç¨³å®š (Stable)</strong> ã€‚</p>
<h4 data-id="heading-7">å¯ç”¨ Compose Compiler Metrics (ç¼–è¯‘å™¨æŒ‡æ ‡)</h4>
<p>è¿™æ˜¯æœ€ä¸“ä¸šçš„è¯Šæ–­æ–¹å¼ï¼Œèƒ½è®©ä½ çœ‹åˆ°ç¼–è¯‘å™¨å¯¹ä½ æ‰€æœ‰ç±»çš„åˆ¤å®šç»“æœã€‚</p>
<p>åœ¨æ¨¡å—çš„ <code>build.gradle</code> ä¸­é…ç½®ï¼ˆä»¥ Kotlin 2.0+ ä¸ºä¾‹ï¼‰ï¼š</p>
<p>Kotlin</p>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-comment">// module/build.gradle.kts</span>
kotlin {
    <span class="hljs-comment">// ... å…¶ä»–é…ç½®</span>
    compilerOptions {
        freeCompilerArgs.<span class="hljs-built_in">addAll</span>(
            <span class="hljs-string">"-P"</span>, <span class="hljs-string">"plugin:androidx.compose.compiler.plugins.kotlin:reportsDestination="</span> + project.buildDir.absolutePath + <span class="hljs-string">"/compose_metrics"</span>,
            <span class="hljs-string">"-P"</span>, <span class="hljs-string">"plugin:androidx.compose.compiler.plugins.kotlin:metricsDestination="</span> + project.buildDir.absolutePath + <span class="hljs-string">"/compose_metrics"</span>
        )
    }
}
</code></pre>
<p>ç¼–è¯‘ï¼ˆ<code>./gradlew assembleRelease</code>ï¼‰åï¼Œæ£€æŸ¥ <code>build/compose_metrics</code> ç›®å½•ä¸‹çš„æŠ¥å‘Šï¼š</p>
<ul>
<li><strong><code>*-classes.txt</code></strong>: æŸ¥æ‰¾è¢«æ ‡è®°ä¸º <code>Unstable</code> çš„ç±»ã€‚</li>
<li><strong><code>*-composables.txt</code></strong>: æŸ¥æ‰¾è¢«æ ‡è®°ä¸º <code>not skippable</code>ï¼ˆä¸å¯è·³è¿‡ï¼‰çš„ Composable å‡½æ•°ã€‚</li>
</ul>
<p><strong>ã€æ ¸å¿ƒè§„åˆ™ã€‘</strong> åªè¦ Composable å‡½æ•°çš„ä»»ä½•ä¸€ä¸ªå‚æ•°ç±»å‹æ˜¯ <code>Unstable</code> çš„ï¼Œè¯¥å‡½æ•°å°±æ— æ³•è¢«ç¼–è¯‘å™¨æ ‡è®°ä¸º <code>skippable</code>ã€‚</p>
<h3 data-id="heading-8">3. è§£å†³ï¼šä¼˜åŒ–ä¸æ¶ˆé™¤ä¸å¿…è¦çš„é‡ç»„</h3>
<p>é’ˆå¯¹æ’æŸ¥ç»“æœï¼Œæˆ‘ä»¬æœ‰é’ˆå¯¹æ€§çš„è§£å†³æ–¹æ¡ˆï¼š</p>



































<table><thead><tr><th><strong>æ€§èƒ½é—®é¢˜</strong></th><th><strong>ç—‡çŠ¶ / åŸå› </strong></th><th><strong>è§£å†³æ–¹æ¡ˆ</strong></th><th><strong>ä¼˜åŠ¿</strong></th></tr></thead><tbody><tr><td><strong>å‚æ•°ä¸ç¨³å®š</strong></td><td>ä½¿ç”¨äº†æ ‡å‡† <code>List</code>/<code>Set</code>/<code>Map</code> æˆ–å«æœ‰ <code>var</code> å±æ€§çš„ç±»ã€‚</td><td><strong>1. ä½¿ç”¨ <code>@Stable</code>/<code>@Immutable</code> æ³¨è§£</strong> (å‘ŠçŸ¥ç¼–è¯‘å™¨ç±»æ˜¯ç¨³å®šçš„) <strong>2. ä½¿ç”¨ <code>kotlinx.collections.immutable</code></strong> (å¦‚ <code>ImmutableList</code>)</td><td>ç¡®ä¿ Compose ä»…åœ¨åˆ—è¡¨å¼•ç”¨æ”¹å˜æ—¶é‡ç»„ï¼Œè€Œä¸æ˜¯æ¯æ¬¡åˆ›å»ºæ–°åˆ—è¡¨æ—¶ã€‚</td></tr><tr><td><strong>é«˜é¢‘çŠ¶æ€è¯»å–</strong></td><td>åœ¨ Composable å‡½æ•°ä½“ä¸­ç›´æ¥è¯»å–é«˜é¢‘å˜åŒ–çš„ State (å¦‚ <code>scrollState.value</code>)ã€‚</td><td><strong>å»¶è¿Ÿè¯»å–çŠ¶æ€ (Defer Reads)ï¼š</strong> å°† State è¯»å–æ¨è¿Ÿåˆ° Layout æˆ– Draw é˜¶æ®µã€‚</td><td>é¿å… Composable å‡½æ•°æœ¬èº«åœ¨æ¯ä¸€å¸§é‡ç»„ã€‚</td></tr><tr><td><strong>å†—ä½™è®¡ç®—</strong></td><td>å¤šä¸ªé«˜é¢‘çŠ¶æ€å˜åŠ¨ï¼Œä½†æœ€ç»ˆ UI åªéœ€è¦åœ¨ç‰¹å®šæ¡ä»¶ä¸‹æ›´æ–°ã€‚</td><td><strong>ä½¿ç”¨ <code>derivedStateOf</code></strong></td><td>ä»…åœ¨è®¡ç®—ç»“æœ<strong>çœŸæ­£æ”¹å˜</strong>æ—¶è§¦å‘é‡ç»„ï¼Œè¿‡æ»¤æ‰ä¸­é—´å˜åŒ–è¿‡ç¨‹ã€‚</td></tr><tr><td><strong>åˆ—è¡¨é‡ç»„é—®é¢˜</strong></td><td><code>LazyColumn</code> æˆ– <code>Column</code> åˆ—è¡¨é¡¹æ’å…¥/åˆ é™¤æ—¶ï¼Œæ•´ä¸ªåˆ—è¡¨é‡ç»„ã€‚</td><td><strong>åœ¨ <code>items</code> ä¸­æŒ‡å®š <code>key</code></strong> (å¦‚ <code>key = { it.id }</code>)</td><td>å¸®åŠ© Compose å‡†ç¡®è¯†åˆ«åˆ—è¡¨é¡¹ï¼Œæé«˜ diff ç®—æ³•æ•ˆç‡ã€‚</td></tr></tbody></table>
<h4 data-id="heading-9">å®ä¾‹ï¼šå»¶è¿Ÿè¯»å–çŠ¶æ€</h4>
<p><strong>âŒ é”™è¯¯ç¤ºä¾‹ (å¯¼è‡´ä¸å¿…è¦çš„é‡ç»„):</strong></p>
<p>Kotlin</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-meta">@Composable</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">BadOffset</span><span class="hljs-params">(scrollState: <span class="hljs-type">ScrollState</span>)</span></span> {
    <span class="hljs-comment">// æ¯æ¬¡æ»‘åŠ¨éƒ½ä¼šé‡ç»„æ­¤å‡½æ•°åŠå…¶ä¸‹æ¸¸</span>
    <span class="hljs-keyword">val</span> offset = scrollState.value.dp 
    Box(Modifier.offset(offset)) 
}
</code></pre>
<p><strong>âœ… ä¼˜åŒ–ç¤ºä¾‹ (ä»… Layout é˜¶æ®µæ‰§è¡Œï¼Œä¸è§¦å‘ Composition é‡ç»„):</strong></p>
<p>Kotlin</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-meta">@Composable</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">GoodOffset</span><span class="hljs-params">(scrollState: <span class="hljs-type">ScrollState</span>)</span></span> {
    Box(
        Modifier.offset { 
            <span class="hljs-comment">// è¿™é‡Œçš„ lambda åªåœ¨å¸ƒå±€é˜¶æ®µæ‰§è¡Œï¼Œä¸ä¼šè§¦å‘å‡½æ•°æœ¬èº«é‡ç»„</span>
            IntOffset(x = scrollState.value.roundToInt(), y = <span class="hljs-number">0</span>) 
        }
    )
}
</code></pre>
<hr/>
<h2 data-id="heading-10">ç»“è®ºä¸å±•æœ›</h2>
<p>ANR çš„æœ¬è´¨æ˜¯ä¸»çº¿ç¨‹é•¿æ—¶é—´é˜»å¡ã€‚æ— è®ºä½ æ˜¯ä½¿ç”¨ XML è¿˜æ˜¯ Composeï¼Œå¦‚æœå°†ç¹é‡çš„è®¡ç®—é€»è¾‘ï¼ˆå¦‚å¤æ‚çš„æ’åºã€æ•°æ®è¿‡æ»¤ï¼‰æ”¾åœ¨ä¸»çº¿ç¨‹ä¸­ï¼ŒANR æ°¸è¿œå­˜åœ¨ã€‚</p>
<ul>
<li><strong>XML æ€§èƒ½ç“¶é¢ˆ</strong>ï¼šåå°„ã€IOã€å¸ƒå±€æµ‹é‡ã€‚</li>
<li><strong>Compose æ€§èƒ½ç“¶é¢ˆ</strong>ï¼šå‡½æ•°æ‰§è¡Œã€é‡ç»„è®¡ç®—ã€‚</li>
</ul>
<p>æ‹¥æŠ± Compose æ„å‘³ç€æˆ‘ä»¬è§£å†³äº†æ—§çš„å¸ƒå±€æµ‹é‡é—®é¢˜ï¼Œä½†éœ€è¦æ›´å¼ºçš„<strong>çŠ¶æ€ç®¡ç†çºªå¾‹</strong>æ¥æ§åˆ¶é‡ç»„çš„èŒƒå›´å’Œé¢‘ç‡ã€‚å–„ç”¨ Layout Inspector å’Œ Compiler Metricsï¼Œä½ å°†èƒ½æ„å»ºå‡ºæ¯” View ä½“ç³»æ›´æµç•…ã€æ€§èƒ½æ›´å¯é¢„æµ‹çš„ç°ä»£åŒ– Android åº”ç”¨ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ç‹¬ç«‹å¼€å‘è€…äº²æµ‹ï¼šMLXæ¡†æ¶è®©æˆ‘çš„Appç§’å˜AIåŸç”Ÿï¼15å¹´iOSè€å…µçš„2025æ–°æ„Ÿæ‚Ÿ]]></title>    <link>https://juejin.cn/post/7579154364960473107</link>    <guid>https://juejin.cn/post/7579154364960473107</guid>    <pubDate>2025-12-03T03:16:29.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7579154364960473107" data-draft-id="7579130291622740010" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ç‹¬ç«‹å¼€å‘è€…äº²æµ‹ï¼šMLXæ¡†æ¶è®©æˆ‘çš„Appç§’å˜AIåŸç”Ÿï¼15å¹´iOSè€å…µçš„2025æ–°æ„Ÿæ‚Ÿ"/> <meta itemprop="keywords" content="å‰ç«¯,iOS"/> <meta itemprop="datePublished" content="2025-12-03T03:16:29.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="JZXStudio"/> <meta itemprop="url" content="https://juejin.cn/user/3871828097898218"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ç‹¬ç«‹å¼€å‘è€…äº²æµ‹ï¼šMLXæ¡†æ¶è®©æˆ‘çš„Appç§’å˜AIåŸç”Ÿï¼15å¹´iOSè€å…µçš„2025æ–°æ„Ÿæ‚Ÿ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3871828097898218/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    JZXStudio
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-03T03:16:29.000Z" title="Wed Dec 03 2025 03:16:29 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-03
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    3
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»3åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#595959;font-size:15px;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(60,10,30,.04) 3%,transparent 0),linear-gradient(1turn,rgba(60,10,30,.04) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body p{color:#595959;font-size:15px;line-height:2;font-weight:400}.markdown-body p+p{margin-top:16px}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin:0;color:#135ce0}.markdown-body h1{position:relative;text-align:center;font-size:22px;margin:50px 0}.markdown-body h1:before{position:absolute;content:"";top:-10px;left:50%;width:32px;height:32px;transform:translateX(-50%);background-size:100% 100%;opacity:.36;background-repeat:no-repeat;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAABfVBMVEX///8Ad/8AgP8AgP8AgP8Aff8AgP8Af/8AgP8AVf8Af/8Af/8AgP8AgP8Af/8Afv8AAP8Afv8Afv8Aef8AgP8AdP8Afv8AgP8AgP8Acf8Ae/8AgP8Af/8AgP8Af/8Af/8AfP8Afv8AgP8Af/8Af/8Afv8Afv8AgP8Afv8AgP8Af/8Af/8AgP8AgP8Afv8AgP8Af/8AgP8AgP8AgP8Ae/8Afv8Af/8AgP8Af/8AgP8Af/8Af/8Aff8Af/8Abf8AgP8Af/8AgP8Af/8Af/8Afv8AgP8AgP8Afv8Afv8AgP8Af/8Aff8AgP8Afv8AgP8Aff8AgP8AfP8AgP8Ae/8AgP8Af/8AgP8AgP8AgP8Afv8AgP8AgP8AgP8Afv8AgP8AgP8AgP8AgP8AgP8Af/8AgP8Af/8Af/8Aev8Af/8AgP8Aff8Afv8AgP8AgP8AgP8Af/8AgP8Af/8Af/8AgP8Afv8AgP8AgP8AgP8AgP8Af/8AeP8Af/8Af/8Af//////rzEHnAAAAfXRSTlMAD7CCAivatxIDx5EMrP19AXdLEwgLR+6iCR/M0yLRzyFF7JupSXn8cw6v60Q0QeqzKtgeG237HMne850/6Qeq7QaZ+WdydHtj+OM3qENCMRYl1B3K2U7wnlWE/mhlirjkODa9FN/BF7/iNV/2kASNZpX1Wlf03C4stRGxgUPclqoAAAABYktHRACIBR1IAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH4gEaBzgZ4yeM3AAAAT9JREFUOMvNUldbwkAQvCAqsSBoABE7asSOBRUVVBQNNuy9996789+9cMFAMHnVebmdm+/bmdtbQv4dOFOW2UjPzgFyLfo6nweKfIMOBYWwFtmMPGz2Yj2pJI0JDq3udJW6VVbmKa9I192VQFV1ktXUAl5NB0cd4KpnORqsEO2ZIRpF9gJfE9Dckqq0KuZt7UAH5+8EPF3spjsRpCeQNO/tA/qDwIDA+OCQbBoKA8NOdjMySgcZGVM6jwcgRuUiSs0nlPFNSrEpJfU0jTLD6llqbvKxei7OzvkFNQohi0vAsj81+MoqsCaoPOQFgus/1LyxichW+hS2JWCHZ7VlF9jb187pIAYcHiViHAMnp5mTjJ8B5xeEXF4B1ze/fTh/C0h398DDI9HB07O8ci+vRBdvdGnfP4gBuM8vw7X/G3wDmFhFZEdxzjMAAAAldEVYdGRhdGU6Y3JlYXRlADIwMTgtMDEtMjZUMDc6NTY6MjUrMDE6MDA67pVWAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDE4LTAxLTI2VDA3OjU2OjI1KzAxOjAwS7Mt6gAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAAWdEVYdFRpdGxlAGp1ZWppbl9sb2dvIGNvcHlxapmKAAAAV3pUWHRSYXcgcHJvZmlsZSB0eXBlIGlwdGMAAHic4/IMCHFWKCjKT8vMSeVSAAMjCy5jCxMjE0uTFAMTIESANMNkAyOzVCDL2NTIxMzEHMQHy4BIoEouAOoXEXTyQjWVAAAAAElFTkSuQmCC)}.markdown-body h2{position:relative;font-size:20px;border-left:4px solid;padding:0 0 0 10px;margin:30px 0}.markdown-body h3{font-size:16px}.markdown-body ul{list-style:disc outside;margin-left:2em;margin-top:1em}.markdown-body li{line-height:2;color:#595959}.markdown-body img.loaded{margin:0 auto;display:block}.markdown-body blockquote{background:#fff9f9;margin:2em 0;padding:2px 20px;border-left:4px solid #b2aec5}.markdown-body blockquote p{color:#666;line-height:2}.markdown-body a{color:#036aca;border-bottom:1px solid rgba(3,106,202,.8);font-weight:400;text-decoration:none}.markdown-body em strong,.markdown-body strong{color:#036aca}.markdown-body hr{border-top:1px solid #135ce0}.markdown-body pre{overflow:auto}.markdown-body code,.markdown-body pre{overflow:auto;position:relative;line-height:1.75;font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body table{border-collapse:collapse;margin:1rem 0;overflow-x:auto}.markdown-body table td,.markdown-body table th{border:1px solid #dfe2e5;padding:.6em 1em}.markdown-body table tr{border-top:1px solid #dfe2e5}.markdown-body table tr:nth-child(2n){background-color:#f6f8fa}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>å¤§å®¶å¥½ï¼Œæˆ‘æ˜¯Kå“¥ï¼Œä¸€ä¸ªå†™äº†15å¹´iOSä»£ç çš„ç‹¬ç«‹å¼€å‘è€…ã€‚ä»Objective-Cæ—¶ä»£ä¸€è·¯å†™åˆ°Swiftï¼Œè§è¯è¿‡App Storeçš„é»„é‡‘åå¹´ï¼Œä¹Ÿç†¬è¿‡å†…å·æœ€ç‹ çš„é‚£å‡ å¹´ã€‚ä½†2025å¹´ï¼Œæˆ‘ç¬¬ä¸€æ¬¡æ„Ÿå—åˆ°â€”â€”<strong>AIçœŸçš„ä¸æ˜¯å™±å¤´ï¼Œè€Œæ˜¯æ¯ä¸ªiOSå¼€å‘è€…éƒ½èƒ½äº²æ‰‹æŒæ§çš„ç”Ÿäº§åŠ›é©å‘½</strong>ã€‚</p>
<p>è¿™ä¸€åˆ‡ï¼Œéƒ½æºäºè‹¹æœåœ¨WWDC25æ­£å¼åŠ›æ¨çš„ <strong>MLXæ¡†æ¶</strong>ã€‚</p>
<hr/>
<h2 data-id="heading-0">ğŸš€ ä»¥å‰åšAIåŠŸèƒ½ï¼Ÿéš¾å¦‚ç™»å¤©</h2>
<p>è¿‡å»æƒ³åœ¨Appé‡ŒåŠ ä¸ªæ™ºèƒ½æ¨èã€å›¾åƒç”Ÿæˆæˆ–è¯­éŸ³ç†è§£ï¼Œè¦ä¹ˆè°ƒç”¨ç¬¬ä¸‰æ–¹APIï¼ˆè´µ+æ…¢+éšç§é£é™©ï¼‰ï¼Œè¦ä¹ˆè‡ªå·±å•ƒPyTorchï¼ˆiOSç«¯éƒ¨ç½²ï¼Ÿåˆ«æƒ³äº†ï¼‰ã€‚ä½œä¸ºç‹¬ç«‹å¼€å‘è€…ï¼Œæ—¢æ²¡ç®—åŠ›ä¹Ÿæ²¡å›¢é˜Ÿï¼ŒAIåŠŸèƒ½åŸºæœ¬æ˜¯â€œçœ‹çœ‹å°±å¥½â€ã€‚</p>
<p>ä½†MLXå½»åº•æ”¹å˜äº†æ¸¸æˆè§„åˆ™ã€‚</p>
<hr/>
<h2 data-id="heading-1">ğŸ”¥ MLXåˆ°åº•å¼ºåœ¨å“ªï¼Ÿäº²æµ‹ä¸‰å¤§é¢ è¦†ç‚¹</h2>
<h3 data-id="heading-2">âœ… 1. <strong>æœ¬åœ°è·‘å¤§æ¨¡å‹ï¼Œä¸è”ç½‘ä¹Ÿèƒ½AIåŸç”Ÿ</strong></h3>
<p>MLXä¸“ä¸ºApple Siliconä¼˜åŒ–ï¼ŒM1/M2/M3èŠ¯ç‰‡ç›´æ¥ç¡¬ä»¶åŠ é€Ÿã€‚æˆ‘åœ¨Mac mini M2ä¸Šè·‘7Bå‚æ•°çš„æ–‡æœ¬ç”Ÿæˆæ¨¡å‹ï¼Œå“åº”é€Ÿåº¦æ¯”æŸäº›äº‘APIè¿˜å¿«ï¼ç”¨æˆ·æ•°æ®å…¨ç¨‹ç•™åœ¨è®¾å¤‡ç«¯ï¼Œ<strong>éšç§åˆè§„ä¸å†æ˜¯éš¾é¢˜</strong>â€”â€”è¿™åœ¨æ¬§ç›ŸDSAå’Œå›½å†…ä¸ªä¿æ³•æ—¶ä»£å¤ªé‡è¦äº†ã€‚</p>
<h3 data-id="heading-3">âœ… 2. <strong>Swift + PythonåŒæ”¯æŒï¼Œè€iOSäººæ— ç¼ä¸Šæ‰‹</strong></h3>
<p>ä½œä¸ºSwiftæ­»å¿ ç²‰ï¼Œæˆ‘æœ¬æ‹…å¿ƒè¦é‡å­¦Pythonç”Ÿæ€ã€‚ç»“æœMLXåŒæ—¶æä¾›Swiftå’ŒPython APIï¼æˆ‘ç”¨Swiftç›´æ¥è°ƒç”¨é¢„è®­ç»ƒæ¨¡å‹ï¼Œå‡ è¡Œä»£ç å°±ç»™æˆ‘çš„ç¬”è®°AppåŠ ä¸Šäº†â€œæ™ºèƒ½æ‘˜è¦â€å’Œâ€œçµæ„Ÿæ‰©å†™â€åŠŸèƒ½ã€‚<strong>ä¸ç”¨æ”¹æ¶æ„ï¼Œä¸ä¾èµ–åç«¯ï¼Œä¸‰å¤©ä¸Šçº¿AIæ¨¡å—</strong>â€”â€”çœŸÂ·ç§’å˜AIåŸç”Ÿã€‚</p>
<h3 data-id="heading-4">âœ… 3. <strong>ä¸ä»…èƒ½æ¨ç†ï¼Œè¿˜èƒ½æœ¬åœ°å¾®è°ƒï¼</strong></h3>
<p>æœ€éœ‡æ’¼çš„æ˜¯ï¼šMLXæ”¯æŒåœ¨Macä¸Šç›´æ¥<strong>è®­ç»ƒå’Œå¾®è°ƒæ¨¡å‹</strong>ã€‚æˆ‘ç”¨è‡ªå·±ç§¯ç´¯çš„ç”¨æˆ·è¡Œä¸ºæ•°æ®ï¼ˆè„±æ•åï¼‰å¾®è°ƒäº†ä¸€ä¸ªå°æ¨¡å‹ï¼Œä¸ªæ€§åŒ–æ¨èå‡†ç¡®ç‡æå‡40%ã€‚ä»¥å‰è¿™å¾—ç§ŸGPUé›†ç¾¤ï¼Œç°åœ¨ä¸€å°Macæå®šï¼Œæˆæœ¬è¶‹è¿‘äºé›¶ã€‚</p>
<hr/>
<h2 data-id="heading-5">ğŸ’¡ ç»™åŒè¡Œçš„3æ¡å®æˆ˜å»ºè®®</h2>
<ol>
<li><strong>åˆ«ç­‰â€œå®Œç¾æ¨¡å‹â€</strong>ï¼šä»å°åœºæ™¯åˆ‡å…¥ï¼Œæ¯”å¦‚â€œå›¾ç‰‡è‡ªåŠ¨æ‰“æ ‡ç­¾â€ã€â€œè¾“å…¥è¡¥å…¨â€ã€â€œè¯­éŸ³è½¬å¾…åŠäº‹é¡¹â€ï¼Œç”¨æˆ·æ„ŸçŸ¥å¼ºï¼Œå¼€å‘é‡å°ã€‚</li>
<li><strong>å–„ç”¨Lazy Computation</strong>ï¼šMLXçš„å»¶è¿Ÿè®¡ç®—ç‰¹æ€§å¯å¤§å¹…å‡å°‘å†…å­˜å ç”¨ï¼Œè¿™å¯¹iPhoneå†…å­˜æ•æ„Ÿåœºæ™¯è‡³å…³é‡è¦ã€‚</li>
<li><strong>å…³æ³¨å¤šæ¨¡æ€èåˆ</strong>ï¼š2025å¹´è¶‹åŠ¿æ˜¯â€œæ–‡æœ¬+å›¾åƒ+éŸ³é¢‘â€è”åŠ¨ã€‚æ¯”å¦‚ç”¨æˆ·æ‹å¼ å›¾ï¼ŒAppè‡ªåŠ¨ç”Ÿæˆå›¾æ–‡ç¬”è®°â€”â€”MLXå…¨æ”¯æŒï¼</li>
</ol>
<hr/>
<h2 data-id="heading-6">ğŸŒŸ å†™åœ¨æœ€åï¼šè¿™æ˜¯å±äºç‹¬ç«‹å¼€å‘è€…çš„é»„é‡‘æ—¶ä»£</h2>
<p>æ›¾å‡ ä½•æ—¶ï¼Œæˆ‘ä»¬è§‰å¾—AIæ˜¯å¤§å‚çš„æ¸¸æˆã€‚ä½†MLXçš„å‡ºç°ï¼ŒæŠŠé¡¶çº§AIèƒ½åŠ›äº¤åˆ°äº†æ¯ä¸€ä¸ªMacç”¨æˆ·æ‰‹ä¸­â€”â€”è€Œä½ æˆ‘ï¼Œæ­£æ˜¯æœ€æ‡‚å¦‚ä½•æŠŠå®ƒå˜æˆå¥½äº§å“çš„é‚£ç¾¤äººã€‚</p>
<p><strong>15å¹´iOSå¼€å‘æ•™ä¼šæˆ‘ï¼šå·¥å…·ä¼šå˜ï¼Œå¹³å°ä¼šå˜ï¼Œä½†â€œè§£å†³ç”¨æˆ·çœŸå®é—®é¢˜â€çš„åˆå¿ƒä¸å˜ã€‚è€Œä»Šå¤©ï¼ŒMLXç»™äº†æˆ‘ä»¬å‰æ‰€æœªæœ‰çš„æ æ†ã€‚</strong></p>
<p>å¦‚æœä½ ä¹Ÿåœ¨åšç‹¬ç«‹Appï¼Œåˆ«çŠ¹è±«â€”â€”å»Apple Developerå®˜ç½‘ä¸‹è½½MLXï¼Œè·‘é€šç¬¬ä¸€ä¸ªDemoã€‚ä½ ä¼šå‘ç°ï¼ŒAIåŸç”Ÿï¼ŒçœŸçš„åªå·®ä¸€è¡Œimportã€‚</p>
<hr/>
<p>#iOSå¼€å‘ #AIåŸç”Ÿåº”ç”¨ #MLXæ¡†æ¶ #ç‹¬ç«‹å¼€å‘è€… #AppleSilicon #WWDC25 #ç¨‹åºå‘˜æ—¥å¸¸ #AIåˆ›ä¸š #Swiftå¼€å‘ #2025æŠ€æœ¯è¶‹åŠ¿</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[æ¢ç´¢äº‘åŸç”Ÿæ–°åŸºçŸ³ï¼šopenEuler 22.03 LTS SP3 æ·±åº¦è¯„æµ‹ä¸äº‘åŸç”Ÿå®è·µï¼]]></title>    <link>https://juejin.cn/post/7579164768063733787</link>    <guid>https://juejin.cn/post/7579164768063733787</guid>    <pubDate>2025-12-03T03:52:39.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7579164768063733787" data-draft-id="7579192114828279835" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="æ¢ç´¢äº‘åŸç”Ÿæ–°åŸºçŸ³ï¼šopenEuler 22.03 LTS SP3 æ·±åº¦è¯„æµ‹ä¸äº‘åŸç”Ÿå®è·µï¼"/> <meta itemprop="keywords" content="OpenAI"/> <meta itemprop="datePublished" content="2025-12-03T03:52:39.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="bugèŒ"/> <meta itemprop="url" content="https://juejin.cn/user/695333581765240"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            æ¢ç´¢äº‘åŸç”Ÿæ–°åŸºçŸ³ï¼šopenEuler 22.03 LTS SP3 æ·±åº¦è¯„æµ‹ä¸äº‘åŸç”Ÿå®è·µï¼
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/695333581765240/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    bugèŒ
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-03T03:52:39.000Z" title="Wed Dec 03 2025 03:52:39 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-03
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»13åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="a11y-dark">.hljs-comment,.hljs-quote{color:#d4d0ab}.hljs-deletion,.hljs-name,.hljs-regexp,.hljs-selector-class,.hljs-selector-id,.hljs-tag,.hljs-template-variable,.hljs-variable{color:#ffa07a}.hljs-built_in,.hljs-builtin-name,.hljs-link,.hljs-literal,.hljs-meta,.hljs-number,.hljs-params,.hljs-type{color:#f5ab35}.hljs-attribute{color:gold}.hljs-addition,.hljs-bullet,.hljs-string,.hljs-symbol{color:#abe338}.hljs-section,.hljs-title{color:#00e0e0}.hljs-keyword,.hljs-selector-tag{color:#dcc6e0}.markdown-body pre,.markdown-body pre&gt;code.hljs{background:#2b2b2b;color:#f8f8f2}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}@media screen and (-ms-high-contrast:active){.hljs-addition,.hljs-attribute,.hljs-built_in,.hljs-builtin-name,.hljs-bullet,.hljs-comment,.hljs-link,.hljs-literal,.hljs-meta,.hljs-number,.hljs-params,.hljs-quote,.hljs-string,.hljs-symbol,.hljs-type{color:highlight}.hljs-keyword,.hljs-selector-tag{font-weight:700}}</style><h2 data-id="heading-0">å¼•è¨€ï¼šäº‘å¸†æµæµ·ï¼ŒåŸºçŸ³ä¸ºå…ˆ</h2>
<p>åœ¨æ•°å­—åŒ–æµªæ½®å¸­å·å…¨çƒçš„ä»Šå¤©ï¼Œäº‘åŸç”Ÿï¼ˆCloud Nativeï¼‰æ—©å·²ä¸æ˜¯ä¸€ä¸ªé¥è¿œçš„æŠ€æœ¯æ¦‚å¿µï¼Œå®ƒå·²ç»æˆä¸ºé©±åŠ¨ç°ä»£åº”ç”¨æ¶æ„æ¼”è¿›çš„æ ¸å¿ƒå¼•æ“ã€‚ä»å¾®æœåŠ¡ã€å®¹å™¨åŒ–åˆ°æŒç»­é›†æˆ/æŒç»­äº¤ä»˜ï¼ˆCI/CDï¼‰ï¼Œäº‘åŸç”ŸæŠ€æœ¯æ ˆæ­£åœ¨é‡å¡‘ç€è½¯ä»¶çš„å¼€å‘ã€éƒ¨ç½²ä¸è¿ç»´æ¨¡å¼ã€‚ç„¶è€Œï¼Œâ€œä¸‡ä¸ˆé«˜æ¥¼å¹³åœ°èµ·â€ï¼Œä¸€ä¸ªç¨³å®šã€é«˜æ•ˆã€å®‰å…¨çš„æ“ä½œç³»ç»Ÿï¼Œæ­£æ˜¯æ”¯æ’‘è¿™æ ‹äº‘åŸç”Ÿâ€œæ‘©å¤©å¤§æ¥¼â€çš„åšå®åŸºçŸ³ã€‚</p>
<p>openEulerï¼Œä½œä¸ºä¸€æ¬¾é¢å‘æ•°å­—åŸºç¡€è®¾æ–½çš„å¼€æºæ“ä½œç³»ç»Ÿï¼Œä»è¯ç”Ÿä¹‹æ—¥èµ·å°±å°†ç›®å…‰æŠ•å‘äº†æœåŠ¡å™¨ã€äº‘è®¡ç®—ã€è¾¹ç¼˜è®¡ç®—ç­‰æ ¸å¿ƒåœºæ™¯ã€‚å®ƒä¸ä»…ä»…æ˜¯ä¸€ä¸ªLinuxå‘è¡Œç‰ˆï¼Œæ›´æ˜¯ä¸€ä¸ªå¼€æ”¾ã€å¤šå…ƒã€å…±å»ºå…±äº«çš„ç”Ÿæ€å¹³å°ã€‚æ€€ç€å¯¹è‡ªä¸»åˆ›æ–°æŠ€æœ¯åŸºåº§çš„å¥½å¥‡ä¸æœŸå¾…ï¼Œæˆ‘å‚åŠ äº†æœ¬æ¬¡ openEuler è¯„æµ‹å¾æ–‡æ´»åŠ¨ï¼Œé€‰æ‹©äº†æˆ‘æœ€ç†Ÿæ‚‰çš„äº‘åŸç”Ÿé¢†åŸŸï¼Œå¸Œæœ›é€šè¿‡ä¸€æ¬¡ä»é›¶åˆ°ä¸€çš„æ·±åº¦å®è·µï¼Œå»æŒ–æ˜ openEuler åœ¨è¿™ä¸ªæ—¶ä»£æµªæ½®ä¸‹çš„çœŸæ­£ä»·å€¼ã€‚</p>
<p>æœ¬æ¬¡è¯„æµ‹ï¼Œæˆ‘é€‰ç”¨çš„æ˜¯ <strong>openEuler 22.03 LTS SP3</strong> ç‰ˆæœ¬ï¼Œè¿™æ˜¯ä¸€ä¸ªé•¿æœŸæ”¯æŒç‰ˆï¼Œå¯¹äºä¼ä¸šçº§ç”Ÿäº§ç¯å¢ƒè‡³å…³é‡è¦ã€‚æˆ‘å°†ä»ç³»ç»Ÿåˆä½“éªŒã€äº‘åŸç”Ÿæ ¸å¿ƒç»„ä»¶æ”¯æŒã€ä¸€ä¸ªå®Œæ•´å¾®æœåŠ¡åº”ç”¨çš„éƒ¨ç½²å®æˆ˜ï¼Œä»¥åŠç³»ç»Ÿæ€§èƒ½ä¸å®‰å…¨è€ƒé‡ç­‰å¤šä¸ªç»´åº¦ï¼Œåˆ†äº«æˆ‘çš„è¯„æµ‹å¿ƒå¾—ä¸æ€è€ƒã€‚å¸Œæœ›è¿™ç¯‡æ–‡ç« ï¼Œèƒ½ä¸ºåŒæ ·å…³æ³¨ openEuler å’Œäº‘åŸç”ŸæŠ€æœ¯çš„å¼€å‘è€…æœ‹å‹ä»¬ï¼Œæä¾›ä¸€ä»½æœ‰ä»·å€¼çš„å‚è€ƒã€‚</p>
<h2 data-id="heading-1">ä¸€ã€åˆè¯† Eulerï¼šä¸€æ¬¡é¡ºæ»‘å¦‚ä¸çš„å®‰è£…ä¸åˆä½“éªŒ</h2>
<p>ä¸€æ®µæ—…ç¨‹çš„å¼€å§‹ï¼Œå§‹äºè¶³ä¸‹ã€‚å¯¹äºä¸€ä¸ªæ“ä½œç³»ç»Ÿè€Œè¨€ï¼Œå®‰è£…è¿‡ç¨‹å°±æ˜¯å®ƒç»™æˆ‘çš„â€œç¬¬ä¸€å°è±¡â€ã€‚æˆ‘ä» openEuler å®˜æ–¹ç¤¾åŒºä¸‹è½½äº† <code>openEuler-22.03-LTS-SP3-x86_64-dvd.iso</code> é•œåƒï¼Œå¹¶å‡†å¤‡äº†ä¸€å°è™šæ‹Ÿæœºè¿›è¡Œå®‰è£…ã€‚<a href="https://link.juejin.cn?target=https%3A%2F%2Fmirror.sjtu.edu.cn%2Fopeneuler%2FopenEuler-22.03-LTS-SP3%2FISO%2Fx86_64%2FopenEuler-22.03-LTS-SP3-x86_64-dvd.iso" target="_blank" title="https://mirror.sjtu.edu.cn/openeuler/openEuler-22.03-LTS-SP3/ISO/x86_64/openEuler-22.03-LTS-SP3-x86_64-dvd.iso" ref="nofollow noopener noreferrer">isoä¸‹è½½åœ°å€</a>ï¼Œæ„Ÿå…´è¶£çš„æœ‹å‹èµ¶ç´§æŒ‰ç…§ä½“éªŒä¸€æ³¢ã€‚
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/73e4023e66b74c6da4012b7c323e93a9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgYnVn6I-M:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765338769&amp;x-signature=2YXG2R47Pkralw7GH0XiqjN5yh0%3D" alt="" loading="lazy"/></p>
<p>æ•´ä¸ªå®‰è£…è¿‡ç¨‹é‡‡ç”¨äº†ç”¨æˆ·å‹å¥½çš„å›¾å½¢åŒ–ç•Œé¢ï¼ˆAnacondaï¼‰ï¼Œå¯¹äºæœ‰CentOSæˆ–RHELå®‰è£…ç»éªŒçš„å¼€å‘è€…æ¥è¯´å‡ ä¹æ˜¯é›¶é—¨æ§›ã€‚åˆ†åŒºè®¾ç½®ã€è½¯ä»¶é€‰æ‹©ã€ç½‘ç»œé…ç½®ç­‰å…³é”®æ­¥éª¤éƒ½æ¸…æ™°æ˜äº†ã€‚åœ¨â€œè½¯ä»¶é€‰æ‹©â€ç¯èŠ‚ï¼Œæˆ‘ç‰¹æ„ç•™æ„äº†ä¸€ä¸‹ï¼Œç³»ç»Ÿé¢„è®¾äº†â€œæœåŠ¡å™¨â€ã€â€œæœ€å°åŒ–å®‰è£…â€ã€â€œè™šæ‹ŸåŒ–ä¸»æœºâ€ç­‰å¤šç§ç¯å¢ƒæ¨¡æ¿ï¼Œä½“ç°äº†å…¶é¢å‘ä¸åŒåœºæ™¯çš„ä¸“ä¸šæ€§ã€‚æˆ‘é€‰æ‹©äº†å¸¦æœ‰å›¾å½¢åŒ–ç•Œé¢çš„æœåŠ¡å™¨æ¨¡å¼ï¼Œä»¥ä¾¿åç»­æ›´æ–¹ä¾¿åœ°è¿›è¡Œæˆªå›¾å’Œæ¼”ç¤ºã€‚</p>
<p>å¦‚ä¸‹æ˜¯ç›¸å…³å®‰è£…æ­¥éª¤ï¼š</p>
<p>ç¬¬ä¸€æ­¥ï¼šInstall openEuler 22.03-LTS-SP3</p>
<p>æŒ‰é”®ç›˜çš„ä¸Šé”®ï¼Œé€‰æ‹©åˆ°ç¬¬ä¸€ä¸ªï¼ŒInstall openEuler 22.03-LTS-SP3ï¼ŒæŒ‰å›è½¦é”®ã€‚</p>
<ul>
<li>å®‰è£… openEuler 22.03-LTS-SP3</li>
<li>æµ‹è¯•æ­¤åª’ä»‹å¹¶å®‰è£… openEuler 22.03-LTS-SP3</li>
<li>æ•…éšœè¯Šæ–­</li>
</ul>
<p>å…·ä½“æ“ä½œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/40d404f0b34543939150537ffe158c3c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgYnVn6I-M:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765338769&amp;x-signature=cWqPGMUjKSXgLE2uM7UEiiyeNWk%3D" alt="" loading="lazy"/>
ç¬¬äºŒæ­¥ï¼šå®‰è£…è¯­è¨€é€‰æ‹©ä¸­æ–‡</p>
<p>å…·ä½“æ“ä½œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6357a30f4acb41feb2a2975985b6b734~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgYnVn6I-M:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765338769&amp;x-signature=3dY06OteO4NlkCtxc7V%2B%2BBCTJDE%3D" alt="" loading="lazy"/></p>
<p>ç¬¬ä¸‰æ­¥ï¼šé€‰æ‹©å®‰è£…ç›®æ ‡ä½ç½®</p>
<p>Automatic è‡ªåŠ¨åˆ†åŒºï¼ŒCustom è‡ªå®šä¹‰åˆ†åŒºï¼Œé€‰æ‹©è‡ªå®šä¹‰åˆ†åŒº</p>
<p>å…·ä½“æ“ä½œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b742a6180e2e4d2abd007b29ae7841d1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgYnVn6I-M:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765338769&amp;x-signature=l7rIdVH7g7pS1jwCYlXE9OyLdxo%3D" alt="" loading="lazy"/></p>
<p>ç¬¬å››æ­¥ï¼šLVM è‡ªåŠ¨åˆ›å»ºåˆ†åŒº</p>
<p>é€‰æ‹©LVM è‡ªåŠ¨åˆ›å»ºåˆ†åŒºï¼Œç”Ÿäº§ç¯å¢ƒæ¨èä½¿ç”¨LVMç£ç›˜åˆ†åŒºæ¨¡å¼</p>
<p>å…·ä½“æ“ä½œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/912b3a80870d4f698ca818d18a43fcd2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgYnVn6I-M:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765338769&amp;x-signature=JywmfG4qz2Mk8B5zNp5MlOZEnsY%3D" alt="" loading="lazy"/></p>
<p>ç¬¬äº”æ­¥ï¼šé€‰æ‹©ç³»ç»Ÿå®‰è£…ç±»å‹</p>
<p>openEuler ç³»ç»Ÿå®‰è£…åˆ†ä¸ºä¸‰ç§ç±»å‹Minimal Installã€Serverã€Virtualization Host ï¼Œä½¿ç”¨ Minimal Install å®‰è£…ï¼Œé€‰æ‹©å®‰è£…"Development Tools" ç»„å·¥å…·åŒ…</p>
<p>å…·ä½“æ“ä½œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3cce3bbc8016408fb6b2f8c463e50106~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgYnVn6I-M:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765338769&amp;x-signature=voF36uSYN5BRD%2B8AfwO6mkW0idw%3D" alt="" loading="lazy"/></p>
<p>ç¬¬å…­æ­¥ï¼šé€‰æ‹©æ—¶é—´å’Œæ—¥æœŸ</p>
<p>å…·ä½“æ“ä½œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3126c31241f9482b8b50270f7c82af4b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgYnVn6I-M:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765338769&amp;x-signature=vFt2KheJ7aslpi8BhbTGzuX%2F9cM%3D" alt="" loading="lazy"/></p>
<p>ç¬¬ä¸ƒæ­¥ï¼šé€‰æ‹©è¯­è¨€</p>
<p>å…·ä½“æ“ä½œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/14fdd7c06d9b4f3585858b21896f9e1c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgYnVn6I-M:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765338769&amp;x-signature=S4BATAhg6iMT9VAnPpKuUwKhc94%3D" alt="" loading="lazy"/></p>
<p>ç¬¬å…«æ­¥ï¼šè®¾ç½®è´¦æˆ·ä¿¡æ¯</p>
<p>é»˜è®¤æ²¡æœ‰å¯ç”¨rootè´¦æˆ·ï¼Œé€‰æ‹©"å¯åŠ¨rootè´¦æˆ·(E)"è®¾ç½®å¯†ç </p>
<p>å…·ä½“æ“ä½œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/47837edda4ed437289664a16ff1f7783~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgYnVn6I-M:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765338769&amp;x-signature=IOuQrBkXOtEU6HTW7EQ%2Bj5p4mc0%3D" alt="" loading="lazy"/></p>
<p>åˆ›å»ºopeneulerè´¦æˆ·ï¼ˆå¯é€‰ï¼‰</p>
<p>å…·ä½“æ“ä½œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a2c87efd7d564b808119463aaa0c9ec2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgYnVn6I-M:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765338769&amp;x-signature=dWIFRMCQSgzXLwIga%2FBmqfuyHOM%3D" alt="" loading="lazy"/></p>
<p>ç¬¬ä¹æ­¥ï¼šå®‰è£…ä¿¡æ¯æ‘˜è¦</p>
<p>é”®ç›˜ã€å®‰è£…æºã€è¯­è¨€ã€æ—¶é—´ç­‰é»˜è®¤å³å¯ï¼Œç½‘ç»œå’Œä¸»æœºåå¯åœ¨ç³»ç»Ÿéƒ¨ç½²å®Œæˆè®¾ç½®</p>
<p>å…·ä½“æ“ä½œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/94cfa98d8d8b4bbebd753c7a28c31b04~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgYnVn6I-M:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765338769&amp;x-signature=Uq0PDruEP91IejPzsCauekqkSJI%3D" alt="" loading="lazy"/></p>
<p>ç¬¬åæ­¥ï¼šå®‰è£…å®Œæˆ reboot é‡å¯ç³»ç»Ÿ</p>
<p>å…·ä½“æ“ä½œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1940a3d1661a4f349a9d40c802c6b003~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgYnVn6I-M:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765338769&amp;x-signature=XXk85AKzqL0%2FPv0E%2FRhz7XHjmXs%3D" alt="" loading="lazy"/></p>
<p>è¾“å…¥rootè´¦æˆ·å¯†ç ç™»å½•ç³»ç»Ÿ</p>
<p>å…·ä½“æ“ä½œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/72e4410797594b159a6e6cffdd281f9b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgYnVn6I-M:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765338769&amp;x-signature=qrNlpzjW8NQxu%2BvD4pJsYXr%2F8bA%3D" alt="" loading="lazy"/></p>
<p>ç¬¬åä¸€æ­¥ï¼šç³»ç»Ÿç½‘ç»œé…ç½®ï¼šæŸ¥çœ‹ç½‘ç»œ</p>
<p>æŸ¥è¯¢ç›¸å…³å‘½ä»¤å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-json" lang="json">ip add show æˆ– ip <span class="hljs-number">-4</span> a
</code></pre>
<p>ç¬¬åäºŒæ­¥ï¼šè®¾ç½®ä¸»æœºå</p>
<pre><code class="hljs language-json" lang="json">ostnamectl  set-hostname  openeuler02
bash
</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/aea2b419bae34f748128673626fc4918~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgYnVn6I-M:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765338769&amp;x-signature=tVDidVvRQ9XS11cVDE5fv5iggB0%3D" alt="" loading="lazy"/></p>
<p>æŸ¥çœ‹å†…æ ¸ç‰ˆæœ¬ï¼š</p>
<pre><code class="hljs language-json" lang="json">cat /etc/os-release
</code></pre>
<p>æ‰§è¡Œå‘½ä»¤å…·ä½“è¿”å›æˆªå›¾å±•ç¤ºå¦‚ä¸‹ï¼š</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/55264fac031d418a993d10aff1b57b1e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgYnVn6I-M:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765338769&amp;x-signature=c8SgZ8MUicNoxt1DT6m%2FPbhzPnM%3D" alt="" loading="lazy"/>
...</p>
<p>å¤§çº¦15åˆ†é’Ÿåï¼Œç³»ç»Ÿå®‰è£…é¡ºåˆ©å®Œæˆã€‚é‡å¯è¿›å…¥ç³»ç»Ÿï¼Œç®€æ´çš„GNOMEæ¡Œé¢ç¯å¢ƒæ˜ å…¥çœ¼å¸˜ã€‚æ‰“å¼€ç»ˆç«¯ï¼Œæ•²ä¸‹ç†Ÿæ‚‰çš„ <code>uname -a</code> å’Œ <code>cat /etc/os-release</code>ï¼Œç¡®è®¤äº†å†…æ ¸ç‰ˆæœ¬å’Œç³»ç»Ÿä¿¡æ¯ï¼Œä¸€åˆ‡éƒ½æ˜¾å¾—é‚£ä¹ˆäº²åˆ‡è€Œåˆå´­æ–°ã€‚</p>
<pre><code class="hljs language-bash" lang="bash">[user@openeuler ~]$ <span class="hljs-built_in">uname</span> -a
Linux openeuler 5.10.0-153.12.0.57.oe2203.x86_64 <span class="hljs-comment">#1 SMP Sat Dec 30 13:30:36 CST 2023 x86_64 x86_64 x86_64 GNU/Linux</span>

[user@openeuler ~]$ <span class="hljs-built_in">cat</span> /etc/os-release
NAME=<span class="hljs-string">"openEuler"</span>
VERSION=<span class="hljs-string">"22.03ï¼ˆLTS-SP3ï¼‰"</span>
ID=<span class="hljs-string">"openEuler"</span>
VERSION_ID=<span class="hljs-string">"22.03"</span>
PRETTY_NAME=<span class="hljs-string">"openEuler 22.03ï¼ˆLTS-SP3ï¼‰"</span>
ANSI_COLOR=<span class="hljs-string">"0;31"</span>
</code></pre>
<p>å¦‚ä¸‹åˆ†åˆ«ä¸ºå¦‚ä¸Šæ‰§è¡Œå‘½ä»¤æ—¶æ‰€è¿”å›çš„æˆªå›¾ï¼š</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/10fc0f64a1c749f4b289135d7a5fa372~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgYnVn6I-M:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765338769&amp;x-signature=fKacWDOG5gCCfUcmb6SkVkHbEHk%3D" alt="" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f38a7d102e584bf8a0a6bf42b14b2c05~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgYnVn6I-M:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765338769&amp;x-signature=z5LXSriXgWKKQvoeYNtpPh2Mujc%3D" alt="" loading="lazy"/></p>
<p>åˆä½“éªŒç»™æˆ‘çš„æ„Ÿè§‰æ˜¯ï¼š<strong>ç¨³å®šã€æµç•…ã€æ ‡å‡†åŒ–</strong>ã€‚å®ƒæ²¡æœ‰åè€Œä¸å®çš„åŠŸèƒ½ï¼Œæ¯ä¸€æ­¥æ“ä½œéƒ½é€éœ²å‡ºä½œä¸ºä¸€æ¬¾æœåŠ¡å™¨æ“ä½œç³»ç»Ÿçš„ä¸¥è°¨ä¸åŠ¡å®ã€‚è¿™è®©æˆ‘å¯¹å®ƒåœ¨äº‘åŸç”Ÿåœºæ™¯ä¸‹çš„è¡¨ç°æ›´åŠ æœŸå¾…ã€‚</p>
<h2 data-id="heading-2">äºŒã€åŒæ“é©±åŠ¨ï¼šæ¢ç´¢ openEuler çš„å®¹å™¨åŒ–æ ¸å¿ƒèƒ½åŠ›</h2>
<p>å®¹å™¨æŠ€æœ¯æ˜¯äº‘åŸç”Ÿçš„åŸºçŸ³ã€‚åœ¨ openEuler ç”Ÿæ€ä¸­ï¼Œé™¤äº†ä¸šç•Œäº‹å®æ ‡å‡† Docker ä¹‹å¤–ï¼Œè¿˜æœ‰ä¸€ä¸ªâ€œäº²å„¿å­â€â€”â€” <strong>iSula</strong>ã€‚iSula æ˜¯ä¸€ä¸ªç”± openEuler ç¤¾åŒºä¸»å¯¼å¼€å‘çš„è½»é‡çº§å®¹å™¨å¼•æ“ï¼Œå®ƒçš„è®¾è®¡ç›®æ ‡æ˜¯æ›´è½»ã€æ›´å¿«ã€æ›´æ˜“ç”¨ã€‚è¿™æ¬¡è¯„æµ‹ï¼Œæˆ‘å†³å®šå¯¹è¿™ä¸¤å¤§å¼•æ“éƒ½è¿›è¡Œä¸€ç•ªæ¢ç´¢ã€‚</p>
<h3 data-id="heading-3">1. è½»é‡çº§å‹‡å£«ï¼šiSula å®¹å™¨å¼•æ“ä½“éªŒ</h3>
<p>openEuler é»˜è®¤çš„è½¯ä»¶æºä¸­å°±å·²ç»åŒ…å«äº† iSulaã€‚å®‰è£…è¿‡ç¨‹éå¸¸ç®€å•ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">sudo dnf install isula
</code></pre>
<p>å®‰è£…å®Œæˆåï¼Œå¯åŠ¨å¹¶è®¾ç½®ä¸ºå¼€æœºè‡ªå¯ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">sudo systemctl start isulad
sudo systemctl <span class="hljs-built_in">enable</span> isulad
</code></pre>
<p>é€šè¿‡ <code>isula info</code> å‘½ä»¤ï¼Œå¯ä»¥æŸ¥çœ‹åˆ° iSula çš„è¯¦ç»†ä¿¡æ¯ï¼ŒåŒ…æ‹¬å­˜å‚¨é©±åŠ¨ã€Cgroupç‰ˆæœ¬ç­‰ï¼Œä¸€åˆ‡æ­£å¸¸ã€‚</p>
<p>æ¥ä¸‹æ¥ï¼Œå°è¯•ç‰›åˆ€ï¼Œæ‹‰å–ä¸€ä¸ª openEuler å®˜æ–¹é•œåƒå¹¶è¿è¡Œä¸€ä¸ªå®¹å™¨ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">sudo isula pull openeuler/openeuler:22.03-lts-sp3
sudo isula run -it openeuler/openeuler:22.03-lts-sp3 /bin/bash
</code></pre>
<p>å‘½ä»¤çš„å“åº”é€Ÿåº¦éå¸¸å¿«ï¼Œå‡ ä¹æ˜¯ç¬é—´å°±è¿›å…¥äº†å®¹å™¨çš„äº¤äº’å¼ç¯å¢ƒã€‚è¿™è®©æˆ‘åˆ‡èº«æ„Ÿå—åˆ°äº† iSula æ‰€å®£ä¼ çš„â€œè½»é‡åŒ–â€ä¼˜åŠ¿ã€‚å®ƒçš„å‘½ä»¤è¡Œå·¥å…·ä¸ Docker é«˜åº¦å…¼å®¹ï¼Œå¯¹äºç†Ÿæ‚‰ Docker çš„ç”¨æˆ·æ¥è¯´ï¼Œå­¦ä¹ æˆæœ¬æä½ã€‚</p>
<h3 data-id="heading-4">2. ç”Ÿæ€å…¼å®¹ï¼šæ— ç¼é›†æˆ Docker</h3>
<p>å°½ç®¡ iSula è¡¨ç°å‡ºè‰²ï¼Œä½†åœ¨åºå¤§çš„äº‘åŸç”Ÿç”Ÿæ€ä¸­ï¼ŒDocker çš„ä¸»å¯¼åœ°ä½ä¾ç„¶æ— æ³•æ’¼åŠ¨ã€‚ä¸€ä¸ªä¼˜ç§€çš„æ“ä½œç³»ç»Ÿï¼Œå¿…é¡»å…·å¤‡è‰¯å¥½çš„ç”Ÿæ€å…¼å®¹æ€§ã€‚è®©æˆ‘ä»¬çœ‹çœ‹åœ¨ openEuler ä¸Šå®‰è£…å’Œä½¿ç”¨ Docker çš„ä½“éªŒå¦‚ä½•ã€‚</p>
<p>åŒæ ·ï¼Œä½¿ç”¨ <code>dnf</code> åŒ…ç®¡ç†å™¨è¿›è¡Œå®‰è£…ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">sudo dnf install docker-engine
</code></pre>
<p>å¯åŠ¨ Docker æœåŠ¡ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">sudo systemctl start docker
sudo systemctl <span class="hljs-built_in">enable</span> docker
</code></pre>
<p>ä¸ºäº†æ–¹ä¾¿åç»­æ“ä½œï¼Œæˆ‘å°†å½“å‰ç”¨æˆ·åŠ å…¥äº† <code>docker</code> ç”¨æˆ·ç»„ï¼Œé¿å…æ¯æ¬¡éƒ½è¾“å…¥ <code>sudo</code>ã€‚</p>
<pre><code class="hljs language-bash" lang="bash">sudo usermod -aG docker $(<span class="hljs-built_in">whoami</span>)
<span class="hljs-comment"># é‡æ–°ç™»å½•ä»¥ç”Ÿæ•ˆ</span>
</code></pre>
<p>æ‰§è¡Œç»å…¸çš„ <code>docker run hello-world</code>ï¼Œç†Ÿæ‚‰çš„â€œHello from Docker!â€ä¿¡æ¯å‡ºç°åœ¨å±å¹•ä¸Šï¼Œå®£å‘Š Docker åœ¨ openEuler ä¸Šçš„å®Œç¾è¿è¡Œã€‚</p>
<p>è¿™æ¬¡åŒå¼•æ“çš„ä½“éªŒè®©æˆ‘æ„Ÿåˆ°éå¸¸æ”¾å¿ƒã€‚openEuler ä¸ä»…åœ¨åŠªåŠ›æ„å»ºè‡ªå·±çš„æ ¸å¿ƒæŠ€æœ¯ï¼ˆiSulaï¼‰ï¼Œä¹Ÿå®Œå…¨æ‹¥æŠ±äº†ä¸»æµçš„å¼€æºç”Ÿæ€ï¼ˆDockerï¼‰ï¼Œä¸ºå¼€å‘è€…å’Œä¼ä¸šæä¾›äº†çµæ´»çš„é€‰æ‹©ã€‚è¿™ç§â€œåŒæ“é©±åŠ¨â€çš„æ¨¡å¼ï¼Œæ— ç–‘æ˜¯å…¶åœ¨äº‘åŸç”Ÿé¢†åŸŸç«äº‰çš„ä¸€å¤§ä¼˜åŠ¿ã€‚</p>
<h2 data-id="heading-5">ä¸‰ã€å®æˆ˜æ¼”ç»ƒï¼šéƒ¨ç½²ä¸€ä¸ªåŸºäº Python çš„å¾®æœåŠ¡åº”ç”¨</h2>
<p>ç†è®ºåƒéï¼Œä¸å¦‚å®æˆ˜ä¸€ç•ªã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘å°†æ¨¡æ‹Ÿä¸€ä¸ªçœŸå®çš„å¼€å‘åœºæ™¯ï¼šåœ¨ openEuler ä¸Šï¼Œä½¿ç”¨ Docker Compose éƒ¨ç½²ä¸€ä¸ªç”± <strong>Flask Web åº”ç”¨</strong> å’Œ <strong>Redis æ•°æ®åº“</strong> ç»„æˆçš„ç®€å•å¾®æœåŠ¡ã€‚</p>
<p>è¿™ä¸ªåº”ç”¨çš„åŠŸèƒ½å¾ˆç®€å•ï¼šä¸€ä¸ªè®¿é—®è®¡æ•°å™¨ã€‚æ¯æ¬¡è®¿é—®ç½‘é¡µï¼Œè®¡æ•°å™¨åŠ ä¸€ï¼Œæ•°æ®æŒä¹…åŒ–åœ¨ Redis ä¸­ã€‚</p>
<h3 data-id="heading-6">æ­¥éª¤ä¸€ï¼šå‡†å¤‡åº”ç”¨ä»£ç å’Œ Dockerfile</h3>
<p>é¦–å…ˆï¼Œæˆ‘åˆ›å»ºäº†ä¸€ä¸ªé¡¹ç›®ç›®å½• <code>flask-redis-app</code>ï¼Œå¹¶åœ¨å…¶ä¸­ç¼–å†™äº† Python åº”ç”¨ <code>app.py</code>ï¼š</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># app.py</span>
<span class="hljs-keyword">from</span> flask <span class="hljs-keyword">import</span> Flask
<span class="hljs-keyword">from</span> redis <span class="hljs-keyword">import</span> Redis
<span class="hljs-keyword">import</span> os

app = Flask(__name__)
<span class="hljs-comment"># ä»ç¯å¢ƒå˜é‡è·å– Redis ä¸»æœºåï¼Œå®ç°æœåŠ¡è§£è€¦</span>
redis = Redis(host=os.environ.get(<span class="hljs-string">'REDIS_HOST'</span>, <span class="hljs-string">'redis'</span>), port=<span class="hljs-number">6379</span>)

<span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">'/'</span></span>)</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">hello</span>():
    count = redis.incr(<span class="hljs-string">'hits'</span>)
    <span class="hljs-keyword">return</span> <span class="hljs-string">f'Hello from openEuler! This page has been viewed <span class="hljs-subst">{count}</span> times.\n'</span>

<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">"__main__"</span>:
    app.run(host=<span class="hljs-string">"0.0.0.0"</span>, port=<span class="hljs-number">5000</span>, debug=<span class="hljs-literal">True</span>)
</code></pre>
<p>ç„¶åï¼Œä¸ºè¿™ä¸ª Flask åº”ç”¨ç¼–å†™ <code>Dockerfile</code>ï¼Œç”¨äºå°†å…¶æ‰“åŒ…æˆä¸€ä¸ªå®¹å™¨é•œåƒï¼š</p>
<pre><code class="hljs language-dockerfile" lang="dockerfile"># Dockerfile
FROM python:3.9-slim

WORKDIR /app

COPY requirements.txt .
RUN pip install --no-cache-dir -r requirements.txt

COPY . .

ENV REDIS_HOST=redis

CMD ["python", "app.py"]
</code></pre>
<p>å…¶ä¸­ <code>requirements.txt</code> æ–‡ä»¶å†…å®¹ä¸ºï¼š</p>
<pre><code class="hljs language-json" lang="json">Flask
redis
</code></pre>
<h3 data-id="heading-7">æ­¥éª¤äºŒï¼šæ„å»º Web åº”ç”¨é•œåƒ</h3>
<p>åœ¨ <code>flask-redis-app</code> ç›®å½•ä¸‹ï¼Œæˆ‘ä½¿ç”¨ Docker æ‰§è¡Œäº†æ„å»ºå‘½ä»¤ã€‚openEuler ç³»ç»Ÿè¡¨ç°å¾—éå¸¸ç¨³å®šï¼Œç½‘ç»œä¸‹è½½ä¾èµ–åŒ…çš„é€Ÿåº¦ä¹Ÿå¾ˆå¿«ã€‚</p>
<pre><code class="hljs language-bash" lang="bash">docker build -t flask-redis-counter .
</code></pre>
<p>æ„å»ºæˆåŠŸåï¼Œé€šè¿‡ <code>docker images</code> å‘½ä»¤å¯ä»¥çœ‹åˆ°æˆ‘ä»¬æ–°é²œå‡ºç‚‰çš„ <code>flask-redis-counter</code> é•œåƒã€‚</p>
<h3 data-id="heading-8">æ­¥éª¤ä¸‰ï¼šä½¿ç”¨ Docker Compose ç¼–æ’æœåŠ¡</h3>
<p>å•ä¸ªå®¹å™¨ä¸è¶³ä»¥ç§°ä¸ºâ€œå¾®æœåŠ¡â€ã€‚ä¸ºäº†åŒæ—¶ç®¡ç† Web åº”ç”¨å’Œ Redis æ•°æ®åº“è¿™ä¸¤ä¸ªæœåŠ¡ï¼Œæˆ‘å¼•å…¥äº† Docker Composeã€‚</p>
<p>åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹åˆ›å»º <code>docker-compose.yml</code> æ–‡ä»¶ï¼š</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-comment"># docker-compose.yml</span>
<span class="hljs-attr">version:</span> <span class="hljs-string">'3.8'</span>

<span class="hljs-attr">services:</span>
  <span class="hljs-attr">web:</span>
    <span class="hljs-attr">build:</span> <span class="hljs-string">.</span>
    <span class="hljs-attr">image:</span> <span class="hljs-string">flask-redis-counter</span>
    <span class="hljs-attr">ports:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">"5000:5000"</span>
    <span class="hljs-attr">environment:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">REDIS_HOST=redis</span>
    <span class="hljs-attr">depends_on:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">redis</span>

  <span class="hljs-attr">redis:</span>
    <span class="hljs-attr">image:</span> <span class="hljs-string">"redis:alpine"</span>
</code></pre>
<p>è¿™ä¸ªç¼–æ’æ–‡ä»¶å®šä¹‰äº† <code>web</code> å’Œ <code>redis</code> ä¸¤ä¸ªæœåŠ¡ã€‚<code>web</code> æœåŠ¡é€šè¿‡ <code>build: .</code> æŒ‡ä»¤ä½¿ç”¨å½“å‰ç›®å½•çš„ Dockerfile æ„å»ºï¼Œå¹¶å°†å®¹å™¨çš„5000ç«¯å£æ˜ å°„åˆ°ä¸»æœºçš„5000ç«¯å£ã€‚<code>redis</code> æœåŠ¡åˆ™ç›´æ¥ä½¿ç”¨å®˜æ–¹çš„è½»é‡çº§ <code>redis:alpine</code> é•œåƒã€‚<code>depends_on</code> ç¡®ä¿äº† <code>redis</code> æœåŠ¡ä¼šå…ˆäº <code>web</code> æœåŠ¡å¯åŠ¨ã€‚</p>
<h3 data-id="heading-9">æ­¥éª¤å››ï¼šå¯åŠ¨å¹¶éªŒè¯åº”ç”¨</h3>
<p>ä¸‡äº‹ä¿±å¤‡ï¼Œåªæ¬ ä¸œé£ã€‚åœ¨é¡¹ç›®ç›®å½•ä¸‹ï¼Œæ‰§è¡Œ <code>docker-compose up</code> å‘½ä»¤ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">docker-compose up -d
</code></pre>
<p><code>-d</code> å‚æ•°è®©æœåŠ¡åœ¨åå°è¿è¡Œã€‚å¾ˆå¿«ï¼Œä¸¤ä¸ªå®¹å™¨éƒ½æˆåŠŸå¯åŠ¨ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ <code>docker-compose ps</code> æˆ– <code>docker ps</code> æŸ¥çœ‹å®¹å™¨çŠ¶æ€ã€‚</p>
<p>æœ€åï¼Œè¿›è¡Œæ¿€åŠ¨äººå¿ƒçš„éªŒè¯ç¯èŠ‚ã€‚æˆ‘æ‰“å¼€äº† openEuler è‡ªå¸¦çš„ Firefox æµè§ˆå™¨ï¼Œè®¿é—® <code>http://127.0.0.1:5000</code>ã€‚é¡µé¢æˆåŠŸæ˜¾ç¤ºï¼</p>
<blockquote>
<p>Hello from openEuler! This page has been viewed 1 times.</p>
</blockquote>
<p>åˆ·æ–°é¡µé¢ï¼Œæ•°å­—ä¸æ–­å¢åŠ ï¼Œè¯æ˜ Flask åº”ç”¨ä¸ Redis ä¹‹é—´çš„é€šä¿¡å®Œå…¨æ­£å¸¸ï¼Œæ•°æ®ä¹Ÿå¾—åˆ°äº†æŒä¹…åŒ–ã€‚æˆ‘ä¹Ÿä½¿ç”¨äº† <code>curl</code> å‘½ä»¤ä»ç»ˆç«¯è¿›è¡Œäº†éªŒè¯ï¼ŒåŒæ ·å¾—åˆ°äº†æ­£ç¡®çš„ç»“æœã€‚</p>
<p>è¿™ä¸ªå®æˆ˜æ¡ˆä¾‹è™½ç„¶ç®€å•ï¼Œä½†å®ƒå®Œæ•´åœ°è¦†ç›–äº†äº‘åŸç”Ÿåº”ç”¨å¼€å‘ä¸éƒ¨ç½²çš„æ ¸å¿ƒæµç¨‹ï¼š<strong>ä»£ç å¼€å‘ -&gt; é•œåƒæ„å»º -&gt; æœåŠ¡ç¼–æ’ -&gt; éƒ¨ç½²è¿è¡Œ</strong>ã€‚åœ¨æ•´ä¸ªè¿‡ç¨‹ä¸­ï¼ŒopenEuler æä¾›äº†ç¨³å®šå¯é çš„è¿è¡Œç¯å¢ƒï¼Œæ— è®ºæ˜¯ Docker çš„å…¼å®¹æ€§ã€ç½‘ç»œåŠŸèƒ½ï¼Œè¿˜æ˜¯ç³»ç»Ÿè‡ªèº«çš„æ€§èƒ½ï¼Œéƒ½è¡¨ç°å¾—æ— å¯æŒ‘å‰”ã€‚å®ƒå°±åƒä¸€ä¸ªæ²‰é»˜è€Œå¼ºå¤§çš„ä¼™ä¼´ï¼Œä¸ºä¸Šå±‚çš„åº”ç”¨åˆ›æ–°æä¾›äº†åšå®çš„æ”¯æ’‘ã€‚</p>
<h2 data-id="heading-10">å››ã€æ·±åº¦è€ƒé‡ï¼šæ€§èƒ½ã€å®‰å…¨ä¸ç”Ÿæ€</h2>
<p>ä¸€ä¸ªä¼˜ç§€çš„æœåŠ¡å™¨æ“ä½œç³»ç»Ÿï¼Œé™¤äº†èƒ½è·‘é€šåº”ç”¨ï¼Œæ›´è¦åœ¨æ€§èƒ½ã€å®‰å…¨å’Œç”Ÿæ€è¿™äº›â€œå†…åŠŸâ€ä¸Šè§çœŸç« ã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e58bb54a68064c148a4f2fea23339a94~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgYnVn6I-M:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765338769&amp;x-signature=mEM3rMMSFF8%2BsZXSuN59hICqhHI%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-11">1. æ€§èƒ½è§‚å¯Ÿ</h3>
<p>åœ¨è¿è¡Œä¸Šè¿°å¾®æœåŠ¡åº”ç”¨æ—¶ï¼Œæˆ‘é€šè¿‡ <code>top</code> å’Œ <code>free -m</code> ç­‰å·¥å…·å¯¹ç³»ç»Ÿèµ„æºå ç”¨è¿›è¡Œäº†æŒç»­è§‚å¯Ÿã€‚åœ¨ç©ºè½½çŠ¶æ€ä¸‹ï¼ŒopenEuler 22.03 LTS SP3ï¼ˆå¸¦æœ‰GNOMEæ¡Œé¢ï¼‰çš„å†…å­˜å ç”¨ç¨³å®šåœ¨1.2Gå·¦å³ï¼Œå¯¹äºä¸€ä¸ªåŠŸèƒ½å®Œå–„çš„ç°ä»£æœåŠ¡å™¨ç³»ç»Ÿæ¥è¯´ï¼Œè¿™ä¸ªè¡¨ç°ç›¸å½“ä¸é”™ã€‚å½“å®¹å™¨åº”ç”¨è¿è¡Œåï¼ŒCPUå’Œå†…å­˜çš„å¢é‡æ¶ˆè€—ä¹Ÿå¤„åœ¨ä¸€ä¸ªéå¸¸åˆç†çš„èŒƒå›´ï¼Œç³»ç»Ÿå“åº”ä¾æ—§è¿…é€Ÿï¼Œæ²¡æœ‰ä¸æ¯«å¡é¡¿ã€‚</p>
<p>è¿™èƒŒåï¼Œå¾—ç›Šäº openEuler åœ¨å†…æ ¸å±‚é¢çš„æ·±åº¦ä¼˜åŒ–ã€‚ä¾‹å¦‚ï¼Œå®ƒé’ˆå¯¹å¤šç§ä½“ç³»ç»“æ„ï¼ˆå¦‚x86ã€ARMï¼‰è¿›è¡Œäº†æ€§èƒ½è°ƒä¼˜ï¼Œå¹¶å¼•å…¥äº†å¦‚ <strong>multi-generational LRU</strong> ç­‰å…ˆè¿›çš„å†…å­˜ç®¡ç†æœºåˆ¶ï¼Œè¿™äº›ä¼˜åŒ–åœ¨äº‘åŸç”Ÿè¿™ç§é«˜å¯†åº¦ã€é«˜å¹¶å‘çš„åœºæ™¯ä¸‹ï¼Œèƒ½å¤Ÿå¸¦æ¥å®å®åœ¨åœ¨çš„æ€§èƒ½æå‡ã€‚</p>
<h3 data-id="heading-12">2. å®‰å…¨ä¿éšœ</h3>
<p>å®‰å…¨æ˜¯äº‘åŸç”Ÿç¯å¢ƒçš„ç”Ÿå‘½çº¿ã€‚openEuler åœ¨è¿™æ–¹é¢æ„å»ºäº†ç«‹ä½“çš„é˜²å¾¡ä½“ç³»ã€‚æˆ‘æ³¨æ„åˆ°ç³»ç»Ÿé»˜è®¤å¼€å¯äº† SELinuxï¼Œè¿™æ˜¯Linuxç³»ç»Ÿæœ€å¼ºå¤§çš„å¼ºåˆ¶è®¿é—®æ§åˆ¶æœºåˆ¶ä¹‹ä¸€ã€‚å¯¹äºå®¹å™¨ç¯å¢ƒè€Œè¨€ï¼Œè¿™æ„å‘³ç€å³ä½¿å®¹å™¨å†…åº”ç”¨è¢«æ”»ç ´ï¼ŒSELinux ä¹Ÿèƒ½æœ‰æ•ˆé™åˆ¶å…¶å¯¹å®¿ä¸»æœºèµ„æºçš„è®¿é—®ï¼Œé˜²æ­¢â€œé€ƒé€¸â€äº‹ä»¶çš„å‘ç”Ÿã€‚</p>
<p>æ­¤å¤–ï¼ŒopenEuler ç¤¾åŒºè¿˜å­µåŒ–äº† <strong>SecMaster</strong> è¿™æ ·çš„å®‰å…¨ç®¡ç†æ¡†æ¶ï¼Œå®ƒèƒ½å¤Ÿæä¾›ç»Ÿä¸€çš„æ¼æ´ç®¡ç†ã€å…¥ä¾µæ£€æµ‹ã€å®‰å…¨å®¡è®¡ç­‰èƒ½åŠ›ã€‚è™½ç„¶åœ¨æœ¬æ¬¡è¯„æµ‹ä¸­æœªèƒ½æ·±åº¦ä½“éªŒ SecMasterï¼Œä½†å®ƒçš„å­˜åœ¨æœ¬èº«å°±å±•ç¤ºäº† openEuler å¯¹ç³»ç»Ÿå®‰å…¨çš„ç³»ç»Ÿæ€§æ€è€ƒå’Œå¸ƒå±€ï¼Œä¸ºä¼ä¸šç”¨æˆ·æä¾›äº†â€œå¼€ç®±å³ç”¨â€çš„å®‰å…¨æ„Ÿã€‚</p>
<h3 data-id="heading-13">3. ç”Ÿæ€ä¸ç¤¾åŒº</h3>
<p>ä¸€ä¸ªæ“ä½œç³»ç»Ÿçš„ç”Ÿå‘½åŠ›ï¼Œæœ€ç»ˆå–å†³äºå…¶ç”Ÿæ€çš„ç¹è£ç¨‹åº¦ã€‚æˆ‘éšæ‰‹ä½¿ç”¨ <code>dnf search</code> å°è¯•æœç´¢äº†ä¸€äº›å¸¸ç”¨çš„å¼€å‘å·¥å…·å’Œè½¯ä»¶ï¼Œå¦‚ <code>nginx</code>, <code>postgresql</code>, <code>git</code>, <code>java-11-openjdk</code> ç­‰ï¼Œæ— ä¸€ä¾‹å¤–éƒ½èƒ½åœ¨å®˜æ–¹æºä¸­æ‰¾åˆ°ã€‚è¿™è¯´æ˜ openEuler çš„è½¯ä»¶ç”Ÿæ€å·²ç»ç›¸å½“æˆç†Ÿï¼Œèƒ½å¤Ÿæ»¡è¶³ç»å¤§å¤šæ•°å¼€å‘å’Œè¿ç»´åœºæ™¯çš„éœ€æ±‚ã€‚</p>
<p>æ›´è®©æˆ‘å°è±¡æ·±åˆ»çš„æ˜¯ openEuler çš„ç¤¾åŒºæ²»ç†æ¨¡å¼ã€‚å®ƒé€šè¿‡ <strong>SIGï¼ˆSpecial Interest Groupï¼Œç‰¹åˆ«å…´è¶£å°ç»„ï¼‰</strong> çš„æ–¹å¼ï¼Œæ±‡èšäº†æ¥è‡ªå…¨çƒçš„å¼€å‘è€…ã€é«˜æ ¡å’Œä¼ä¸šï¼Œå›´ç»•å†…æ ¸ã€è™šæ‹ŸåŒ–ã€äº‘åŸç”Ÿã€æ¡Œé¢ç­‰ä¸åŒæŠ€æœ¯æ–¹å‘è¿›è¡Œè´¡çŒ®ã€‚è¿™ç§å¼€æ”¾ã€é€æ˜çš„ç¤¾åŒºè¿ä½œæ¨¡å¼ï¼Œæ˜¯ openEuler èƒ½å¤ŸæŒç»­åˆ›æ–°ã€å¿«é€Ÿæ¼”è¿›çš„æºåŠ¨åŠ›ã€‚å®ƒçš„æ–‡æ¡£åº“ä¹Ÿç›¸å½“å®Œå–„ï¼Œæ— è®ºæ˜¯æ–°æ‰‹å…¥é—¨è¿˜æ˜¯ä¸“å®¶æ·±å…¥ï¼Œéƒ½èƒ½æ‰¾åˆ°æ¸…æ™°çš„æŒ‡å¼•ã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/69a2c308731b4a27b2a3a7f9962f58a7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgYnVn6I-M:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765338769&amp;x-signature=Id59chcf98n0Ns%2FDptzqGUGlCfc%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-14">æ€»ç»“ä¸å±•æœ›</h2>
<p>ç»è¿‡è¿™æ¬¡ä»å®‰è£…åˆ°å®æˆ˜éƒ¨ç½²çš„æ·±åº¦è¯„æµ‹ï¼ŒopenEuler ç»™æˆ‘ç•™ä¸‹äº†æä¸ºæ·±åˆ»å’Œæ­£é¢çš„å°è±¡ã€‚å®ƒä¸å†æ˜¯ä¸€ä¸ªâ€œè¿½éšè€…â€ï¼Œè€Œæ˜¯ä¸€ä¸ªåœ¨äº‘åŸç”Ÿæ—¶ä»£æ‹¥æœ‰è‡ªå·±ç‹¬ç‰¹æ€è€ƒå’Œæ ¸å¿ƒèƒ½åŠ›çš„â€œé¢†è·‘è€…â€ã€‚</p>
<ul>
<li><strong>åšå¦‚ç£çŸ³çš„ç¨³å®šæ€§</strong>ï¼šä½œä¸ºä¸€æ¬¾LTSç‰ˆæœ¬ï¼Œå®ƒåœ¨æ•´ä¸ªè¯„æµ‹è¿‡ç¨‹ä¸­è¡¨ç°å‡ºäº†å“è¶Šçš„ç¨³å®šæ€§ï¼Œæ— æ„§äºå…¶â€œæ•°å­—åŸºç¡€è®¾æ–½æ“ä½œç³»ç»Ÿâ€çš„å®šä½ã€‚</li>
<li><strong>çµæ´»å¼ºå¤§çš„äº‘åŸç”Ÿèƒ½åŠ›</strong>ï¼šåŒæ—¶æ”¯æŒ iSula å’Œ Dockerï¼Œä¸ºç”¨æˆ·æä¾›äº†çµæ´»é€‰æ‹©ï¼Œå¹¶å®Œç¾å…¼å®¹ä¸»æµäº‘åŸç”Ÿå·¥å…·é“¾ï¼Œä¸Šæ‰‹å³ç”¨ã€‚</li>
<li><strong>å†…åŠŸæ·±åšçš„æ€§èƒ½ä¸å®‰å…¨</strong>ï¼šåœ¨å†…æ ¸å±‚é¢çš„æŒç»­ä¼˜åŒ–å’Œç³»ç»Ÿæ€§çš„å®‰å…¨è®¾è®¡ï¼Œä½¿å…¶åœ¨é«˜è´Ÿè½½å’Œé«˜å®‰å…¨è¦æ±‚çš„ç”Ÿäº§ç¯å¢ƒä¸­å€¼å¾—ä¿¡èµ–ã€‚</li>
<li><strong>å¼€æ”¾ç¹è£çš„ç”Ÿæ€ç¤¾åŒº</strong>ï¼šæˆç†Ÿçš„è½¯ä»¶ä»“åº“å’Œå……æ»¡æ´»åŠ›çš„ç¤¾åŒºï¼Œæ˜¯å…¶æœªæ¥å‘å±•çš„æœ€å¤§ä¿éšœã€‚</li>
</ul>
<p>å½“ç„¶ï¼Œé‡‘æ— è¶³èµ¤ï¼Œä»»ä½•ç³»ç»Ÿéƒ½æœ‰æŒç»­è¿›æ­¥çš„ç©ºé—´ã€‚ä¾‹å¦‚ï¼Œå¯¹äºæ–°æ‰‹è€Œè¨€ï¼ŒiSula çš„ç”Ÿæ€å·¥å…·å’Œæ–‡æ¡£ä¸°å¯Œåº¦ç›¸è¾ƒäº Docker è¿˜æœ‰æå‡ç©ºé—´ï¼›å›¾å½¢åŒ–ç•Œé¢ä¸‹çš„ä¸€äº›äº¤äº’ç»†èŠ‚ä¹Ÿå¯ä»¥è¿›ä¸€æ­¥æ‰“ç£¨ã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7bb958fe762243f1880e480a3d57d1e8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgYnVn6I-M:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765338769&amp;x-signature=NTcu0vkoAkRye79Hsby5HECxG2A%3D" alt="" loading="lazy"/></p>
<p>æ€»è€Œè¨€ä¹‹ï¼Œè¿™æ¬¡è¯„æµ‹è®©æˆ‘çœŸåˆ‡åœ°æ„Ÿå—åˆ°ï¼ŒopenEuler å·²ç»ä¸ºæ‰¿è½½å¤æ‚çš„äº‘åŸç”Ÿåº”ç”¨åšå¥½äº†å……åˆ†çš„å‡†å¤‡ã€‚å®ƒä¸ä»…æ˜¯ä¸€æ¬¾å¯ä»¥â€œç”¨â€çš„æ“ä½œç³»ç»Ÿï¼Œæ›´æ˜¯ä¸€æ¬¾å€¼å¾—ä¿¡èµ–å’Œæ‰˜ä»˜çš„â€œå¥½ç”¨â€çš„æ“ä½œç³»ç»Ÿã€‚æˆ‘ç”±è¡·åœ°ä¸ºè‡ªä¸»åˆ›æ–°å¼€æºæŠ€æœ¯èƒ½è¾¾åˆ°å¦‚æ­¤é«˜åº¦è€Œæ„Ÿåˆ°è‡ªè±ªï¼Œå¹¶å¼ºçƒˆæ¨èå„ä½å¼€å‘è€…å’ŒæŠ€æœ¯çˆ±å¥½è€…ä»¬ï¼Œäº²æ‰‹å»ä½“éªŒä¸€ç•ª openEuler çš„é­…åŠ›ã€‚</p>
<p>æˆ‘ç›¸ä¿¡ï¼Œåœ¨å¼€æºå…±å»ºçš„åŠ›é‡ä¸‹ï¼ŒopenEuler è¿™å—äº‘åŸç”ŸåŸºçŸ³ï¼Œå¿…å°†æ”¯æ’‘èµ·æ›´å¤šã€æ›´å®ä¼Ÿçš„æ•°å­—åŒ–åº”ç”¨å¤§å¦ã€‚æ—…ç¨‹æœªæ­¢ï¼Œæ¢ç´¢ä¸æ¯ï¼ŒæœŸå¾…ä¸ openEuler åœ¨æœªæ¥çš„æŠ€æœ¯æµªæ½®ä¸­å†æ¬¡ç›¸é‡ï¼</p>
<blockquote>
<p>å£°æ˜ï¼šå¦‚ä¸Šéƒ¨é—¨å†…å®¹åŠé…å›¾æ¥æºå…¬å¼€äº’è”ç½‘ï¼Œè‹¥æœ‰ä¾µæƒï¼Œè¯·è”ç³»åˆ é™¤ã€‚</p>
</blockquote>
<p>-End-</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Milvus åˆ†è¯å™¨å­¦ä¹ ç¬”è®°]]></title>    <link>https://juejin.cn/post/7579179741824598042</link>    <guid>https://juejin.cn/post/7579179741824598042</guid>    <pubDate>2025-12-03T05:15:28.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7579179741824598042" data-draft-id="7579179741824483354" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Milvus åˆ†è¯å™¨å­¦ä¹ ç¬”è®°"/> <meta itemprop="keywords" content="LangChain"/> <meta itemprop="datePublished" content="2025-12-03T05:15:28.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å¤©æ˜Ÿçƒ›"/> <meta itemprop="url" content="https://juejin.cn/user/1099167359051949"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Milvus åˆ†è¯å™¨å­¦ä¹ ç¬”è®°
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1099167359051949/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å¤©æ˜Ÿçƒ›
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-03T05:15:28.000Z" title="Wed Dec 03 2025 05:15:28 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-03
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»2åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>æ–‡ç« æ˜¯å…³äº å­¦ä¹ ç å³°æ¶æ„AIè¯¾çš„å­¦ä¹ ç¬”è®°</p>
<h2 data-id="heading-0">1. åˆ†è¯å™¨æ˜¯ä»€ä¹ˆï¼Ÿ</h2>
<p>åˆ†è¯å™¨ï¼ˆTokenizerï¼‰æ˜¯ç”¨æ¥æŠŠä¸€æ®µæ–‡æœ¬æ‹†åˆ†æˆ"è¯è¯­"æˆ–"å…³é”®è¯"çš„å·¥å…·ã€‚</p>
<h2 data-id="heading-1">2. ## å¸¸è§åˆ†è¯å™¨ç±»å‹</h2>
<ul>
<li><strong>Standardï¼ˆæ ‡å‡†åˆ†è¯ï¼‰</strong> ï¼šé€‚åˆè‹±æ–‡ã€æ•°å­—ã€æ ‡ç‚¹åˆ†éš”çš„æ–‡æœ¬ã€‚</li>
<li><strong>Whitespaceï¼ˆç©ºæ ¼åˆ†è¯ï¼‰</strong> ï¼šåªæŒ‰ç©ºæ ¼åˆ‡åˆ†ï¼Œé€‚åˆè‹±æ–‡ã€ä»£ç ç­‰ã€‚</li>
<li><strong>Chineseï¼ˆä¸­æ–‡åˆ†è¯ï¼‰</strong> ï¼šé€‚åˆä¸­æ–‡å¥å­ï¼Œèƒ½æ™ºèƒ½è¯†åˆ«è¯è¯­è¾¹ç•Œã€‚</li>
<li><strong>Simpleï¼ˆç®€å•åˆ†è¯ï¼‰</strong> ï¼šæŒ‰å­—æ¯ã€æ•°å­—ç­‰ç®€å•è§„åˆ™åˆ‡åˆ†ã€‚</li>
</ul>
<h2 data-id="heading-2">3. åˆ†åŒºé”®</h2>
<p>åˆ†åŒºé”®ç”¨æ¥å°†å¤§é‡æ•°æ®åˆ†æ•£å­˜å‚¨åœ¨ä¸åŒçš„æœåŠ¡å™¨ä¸Šã€‚
æ¯”å¦‚æˆ‘ä»¬ç­é‡Œæƒ³æŠŠåŒå­¦ä»¬è¿›è¡Œåˆ†ç»„ï¼Œåˆ†ç»„çš„ä¾æ®æ˜¯åŒå­¦ä»¬çš„å§“æ°ï¼Œé‚£ä¹ˆå§“æ°å°±æ˜¯åˆ†åŒºé”®</p>
<p>æ‰‹å†™ä¸€ä¸ªç®€å•çš„ä¸­æ–‡åˆ†è¯å™¨</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> collections <span class="hljs-keyword">import</span> defaultdict

<span class="hljs-comment"># import typing</span>
<span class="hljs-keyword">import</span> jieba

<span class="hljs-comment"># å®šä¹‰ç¤ºä¾‹æ–‡æ¡£æ•°æ®ï¼Œæ¯ä¸ªæ–‡æ¡£åŒ…å«â€œidâ€ã€â€œåˆ†åŒºé”®â€ã€â€œå†…å®¹â€</span>
documents = [
    {<span class="hljs-string">"id"</span>: <span class="hljs-number">1</span>, <span class="hljs-string">"partition_key"</span>: <span class="hljs-string">"å¼ "</span>, <span class="hljs-string">"content"</span>: <span class="hljs-string">"å¼ ä¸‰å–œæ¬¢ç¼–ç¨‹å’Œç”µè„‘æ¸¸æˆ"</span>},
    {<span class="hljs-string">"id"</span>: <span class="hljs-number">2</span>, <span class="hljs-string">"partition_key"</span>: <span class="hljs-string">"æ"</span>, <span class="hljs-string">"content"</span>: <span class="hljs-string">"æå››çƒ­çˆ±è®¡ç®—æœºç§‘å­¦"</span>},
    {<span class="hljs-string">"id"</span>: <span class="hljs-number">3</span>, <span class="hljs-string">"partition_key"</span>: <span class="hljs-string">"ç‹"</span>, <span class="hljs-string">"content"</span>: <span class="hljs-string">"ç‹äº”å–œæ¬¢é˜…è¯»æŠ€æœ¯ä¹¦ç±"</span>},
    {<span class="hljs-string">"id"</span>: <span class="hljs-number">4</span>, <span class="hljs-string">"partition_key"</span>: <span class="hljs-string">"å¼ "</span>, <span class="hljs-string">"content"</span>: <span class="hljs-string">"å¼ æ°é’Ÿçˆ±ç¬”è®°æœ¬ç”µè„‘"</span>},
]

<span class="hljs-comment"># å®šä¹‰åŒä¹‰è¯æ˜ å°„ï¼Œâ€œé”®â€ä¸ºä»£è¡¨è¯ï¼Œâ€œå€¼â€ä¸ºåŒä¹‰è¯é›†åˆï¼ˆç”¨äºæ‰©å±•åŒ¹é…ï¼‰</span>
synonym_map = {
    <span class="hljs-string">"ç”µè„‘"</span>: {<span class="hljs-string">"ç”µè„‘"</span>, <span class="hljs-string">"è®¡ç®—æœº"</span>, <span class="hljs-string">"PC"</span>},
    <span class="hljs-string">"ç¼–ç¨‹"</span>: {<span class="hljs-string">"ç¼–ç¨‹"</span>, <span class="hljs-string">"ç¨‹åºè®¾è®¡"</span>},
}


<span class="hljs-keyword">def</span> <span class="hljs-title function_">simple_tokenize</span>(<span class="hljs-params">text: <span class="hljs-built_in">str</span></span>):
    <span class="hljs-comment"># è¯´æ˜: å¯¹æ–‡æœ¬è¿›è¡Œç®€å•åˆ†è¯ï¼ˆç©ºæ ¼åˆ†éš”ï¼‰</span>
    <span class="hljs-keyword">return</span> [token <span class="hljs-keyword">for</span> token <span class="hljs-keyword">in</span> jieba.lcut_for_search(text) <span class="hljs-keyword">if</span> token.strip()]


<span class="hljs-comment"># æ ¹æ®â€œåˆ†åŒºé”®â€å¯¹æ–‡æ¡£è¿›è¡Œèšåˆï¼Œè¿”å›åˆ†åŒºå­—å…¸</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">build_partitions</span>(<span class="hljs-params">documents</span>):
    partitions = defaultdict(<span class="hljs-built_in">list</span>)
    <span class="hljs-keyword">for</span> doc <span class="hljs-keyword">in</span> documents:
        partitions[doc[<span class="hljs-string">"partition_key"</span>]].append(doc)
    <span class="hljs-keyword">return</span> partitions


<span class="hljs-keyword">def</span> <span class="hljs-title function_">match_query</span>(<span class="hljs-params">partitions, keyword: <span class="hljs-built_in">str</span>, use_synonym=<span class="hljs-literal">True</span></span>):
    results = []
    <span class="hljs-comment"># å…³é”®è¯é›†åˆ</span>
    tokens_to_match = {keyword}
    <span class="hljs-keyword">if</span> use_synonym <span class="hljs-keyword">and</span> keyword <span class="hljs-keyword">in</span> synonym_map:
        tokens_to_match = synonym_map[keyword]

    <span class="hljs-comment"># éå†æ‰€æœ‰åˆ†åŒº, æŸ¥æ‰¾è¿”å›åŒ…å«å…³é”®è¯çš„åˆ†åŒº</span>

    <span class="hljs-keyword">for</span> partition_key, docs <span class="hljs-keyword">in</span> partitions.items():
        <span class="hljs-keyword">for</span> doc <span class="hljs-keyword">in</span> docs:
            <span class="hljs-comment"># å¯¹ content è¿›è¡Œåˆ†è¯</span>
            tokens = simple_tokenize(doc[<span class="hljs-string">"content"</span>])
            <span class="hljs-comment"># åˆ¤æ–­äº¤é›†</span>
            <span class="hljs-keyword">if</span> tokens_to_match.intersection(tokens):
                results.append((partition_key, doc[<span class="hljs-string">"id"</span>], doc[<span class="hljs-string">"content"</span>]))
    <span class="hljs-keyword">return</span> results


<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">"__main__"</span>:
    <span class="hljs-comment"># åˆ†åŒºå­˜å‚¨</span>
    partitions = build_partitions(documents)
    <span class="hljs-comment"># ä¸¥æ ¼åŒ¹é…</span>
    <span class="hljs-comment"># hits = match_query(partitions, keyword="ç”µè„‘", use_synonym=False)</span>
    <span class="hljs-comment"># print("ä»…åŒ¹é…â€œç”µè„‘â€çš„ç»“æœï¼š")</span>
    <span class="hljs-comment"># for row in hits:</span>
    <span class="hljs-comment">#     print(row)</span>
    <span class="hljs-comment"># ç¤ºä¾‹2ï¼šå¯ç”¨åŒä¹‰è¯åŒ¹é…ï¼ˆâ€œç”µè„‘â€â‰ˆâ€œè®¡ç®—æœºâ€ï¼‰</span>
    hits_with_synonym = match_query(partitions, keyword=<span class="hljs-string">"ç”µè„‘"</span>, use_synonym=<span class="hljs-literal">True</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"å¯ç”¨åŒä¹‰è¯åŒ¹é…ï¼ˆâ€œç”µè„‘â€â‰ˆâ€œè®¡ç®—æœºâ€ï¼‰çš„ç»“æœï¼š"</span>)
    <span class="hljs-keyword">for</span> row <span class="hljs-keyword">in</span> hits_with_synonym:
        <span class="hljs-built_in">print</span>(row)

<span class="hljs-string">"""
 å¯ç”¨åŒä¹‰è¯åŒ¹é…ï¼ˆâ€œç”µè„‘â€â‰ˆâ€œè®¡ç®—æœºâ€ï¼‰çš„ç»“æœï¼š
('å¼ ', 1, 'å¼ ä¸‰å–œæ¬¢ç¼–ç¨‹å’Œç”µè„‘æ¸¸æˆ')
('å¼ ', 4, 'å¼ æ°é’Ÿçˆ±ç¬”è®°æœ¬ç”µè„‘')
('æ', 2, 'æå››çƒ­çˆ±è®¡ç®—æœºç§‘å­¦')
"""</span>

</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[[Ai Agent] 10 MCPåŸºç¡€ï¼šæ‰“ç ´å­¤å²›ï¼Œè®©MCPè¿æ¥ä¸‡ç‰©]]></title>    <link>https://juejin.cn/post/7579165599042764815</link>    <guid>https://juejin.cn/post/7579165599042764815</guid>    <pubDate>2025-12-03T04:58:27.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7579165599042764815" data-draft-id="7579169543232552960" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="[Ai Agent] 10 MCPåŸºç¡€ï¼šæ‰“ç ´å­¤å²›ï¼Œè®©MCPè¿æ¥ä¸‡ç‰©"/> <meta itemprop="keywords" content="LangChain,MCP"/> <meta itemprop="datePublished" content="2025-12-03T04:58:27.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å†ä¼šå‘€"/> <meta itemprop="url" content="https://juejin.cn/user/446878782598644"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            [Ai Agent] 10 MCPåŸºç¡€ï¼šæ‰“ç ´å­¤å²›ï¼Œè®©MCPè¿æ¥ä¸‡ç‰©
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/446878782598644/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å†ä¼šå‘€
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-03T04:58:27.000Z" title="Wed Dec 03 2025 04:58:27 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-03
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»30åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>åšå®¢é…å¥—ä»£ç å‘å¸ƒäº<a href="https://link.juejin.cn?target=https%3A%2F%2Fso.csdn.net%2Fso%2Fsearch%3Fq%3Dgithub%26spm%3D1001.2101.3001.7020" title="https://so.csdn.net/so/search?q=github&amp;spm=1001.2101.3001.7020" target="_blank" ref="nofollow noopener noreferrer">github</a>ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FAnnyfee%2Fagent-craft" title="https://github.com/Annyfee/agent-craft" target="_blank" ref="nofollow noopener noreferrer">10 MCP åŸºç¡€</a></p>
<p><strong>æœ¬ç³»åˆ—æ‰€æœ‰åšå®¢å‡é…å¥—Gihubå¼€æºä»£ç ï¼Œå¼€ç®±å³ç”¨ï¼Œä»…éœ€é…ç½®API_KEYã€‚</strong></p>
<p>å¦‚æœè¯¥Agentæ•™å­¦ç³»åˆ—å¸®åˆ°äº†ä½ ï¼Œ<strong>æ¬¢è¿ç»™æˆ‘ä¸ªStarâ­</strong>ï¼</p>
<p><strong>çŸ¥è¯†ç‚¹</strong>ï¼š<strong>Stdioä¼ è¾“ | Streamingè¾“å‡ºÂ | Adapteré€‚é…å™¨ | AsyncExitStack | JSON-RPC | MCPåè®®</strong></p>
<hr/>
<h2 data-id="heading-0">åºç« ï¼šä»â€œé€ è½®å­â€åˆ°â€œæ’USBâ€</h2>
<p>åœ¨07ç¯‡ä¸­ï¼Œä¸ºäº†è®©AgentæŸ¥å¤©æ°”ï¼Œæˆ‘ä»¬ä¸å¾—ä¸<strong>æ‰‹å†™</strong>äº†ä¸€ä¸ª get_weather å‡½æ•°ã€‚</p>
<p>ä½†å¦‚æœæˆ‘æƒ³ç”¨é«˜å¾·åœ°å›¾æŸ¥è·¯çº¿ï¼Œç”¨Githubç®¡ç†ä»£ç ï¼Œç”¨é£ä¹¦å‘æ¶ˆæ¯ï¼Œéš¾é“æˆ‘è¦æŠŠè¿™äº›æ‰€æœ‰æœåŠ¡çš„APIæ–‡æ¡£å…¨éƒ¨è¯»ä¸€éå—ï¼Œç„¶åæ‰‹å†™å‡ ç™¾ä¸ª @tool å—ï¼Ÿ</p>
<p>å½“ç„¶ä¸ï¼Œè¿™å°±æ˜¯ <strong>å·¥å…·å­¤å²›</strong> é—®é¢˜ã€‚</p>
<p>Model Context Protocol (MCP) çš„å‡ºç°ï¼Œå°±æ˜¯ä¸ºäº†æ‰“ç ´è¿™ä¸ªå­¤å²›ã€‚å®ƒå°±åƒAIæ—¶ä»£çš„USBåè®®ï¼š</p>
<ul>
<li><strong>MCP Serverï¼ˆæœåŠ¡å™¨ï¼‰</strong> ï¼šå°±æ˜¯â€œå¤–è®¾â€ï¼ˆå¦‚é«˜å¾·åœ°å›¾ï¼Œ12306ï¼‰ã€‚å¼€å‘è€…å†™å¥½ä¸€æ¬¡ï¼Œå…¨ä¸–ç•Œçš„Agentéƒ½èƒ½ç”¨ã€‚</li>
<li><strong>MCP Clinetï¼ˆå®¢æˆ·ç«¯ï¼‰</strong> ï¼šå°±æ˜¯â€œç”µè„‘â€ï¼ˆä½ çš„Agentï¼‰ã€‚ä½ ä¸éœ€è¦å†™é©±åŠ¨ï¼Œåªè¦æ’ä¸ŠUSBï¼ˆå»ºç«‹è¿æ¥ï¼‰ï¼ŒAgentå°±èƒ½ç›´æ¥ä½¿ç”¨è®¾å¤‡çš„æ‰€æœ‰åŠŸèƒ½ã€‚</li>
</ul>
<p>æœ¬ç« ç›®æ ‡ï¼šæˆ‘ä»¬ä¸å†™Serverï¼ˆè¿™æ˜¯ä¸‹ä¸€ç« çš„äº‹ï¼‰ï¼Œæˆ‘ä»¬å…ˆå­¦ä¹ å¦‚ä½•<strong>åšä¸€ä¸ªé€šç”¨çš„ Clinet</strong>ã€‚æˆ‘ä»¬å°†å…ˆç”¨ CherryStudio ä½“éªŒâ€œå³æ’å³ç”¨â€çš„å¿«æ„Ÿï¼Œç„¶å<strong>ç¼–å†™ç”Ÿäº§çº§çš„ Python å®¢æˆ·ç«¯</strong>ï¼Œå»è¿æ¥<strong>çœŸå®çš„</strong>é«˜å¾·åœ°å›¾æœåŠ¡ã€‚</p>
<h2 data-id="heading-1">ä¸€ã€å¼€ç®±å³ç”¨ï¼šCherryStudio åˆä½“éªŒï¼ˆGUIï¼‰</h2>
<p>åœ¨å†™ä»£ç å‰ï¼Œæˆ‘ä»¬å…ˆç”¨ <strong>GUI å·¥å…·</strong>ç›´è§‚æ„Ÿå—ä¸€ä¸‹ MCP çš„å¨åŠ›ã€‚CherryStudioæ˜¯ç›®å‰å¯¹ MCP æ”¯æŒæœ€å¥½çš„å®¢æˆ·ç«¯ä¹‹ä¸€ã€‚</p>
<h3 data-id="heading-2">1. è·å–api_key</h3>
<p>è¿™é‡Œæˆ‘ä»¬é€‰æ‹©é«˜å¾·åœ°å›¾æ¥ä½œä¸ºæˆ‘ä»¬çš„mcpè·å–æ–¹å¼ï¼š</p>
<p>è¿›å…¥Â <a href="https://link.juejin.cn?target=https%3A%2F%2Flbs.amap.com%2F" title="https://lbs.amap.com/" target="_blank" ref="nofollow noopener noreferrer">lbs.amap.com/</a>Â ï¼Œæ³¨å†Œå¹¶ç™»å½•ã€‚</p>
<p>åœ¨æ–‡æ¡£ä¸æ”¯æŒé‡Œï¼Œè¿›å…¥MCP Serverï¼š</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5e62497abb834189a0313ae1e998332d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YaN5Lya5ZGA:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765342707&amp;x-signature=IyPY7PKLUg4Qx6bVfpgtvcyKi%2FA%3D" alt="" loading="lazy"/></p>
<p>åœ¨å¦‚ä¸‹ç•Œé¢ä¸­ï¼Œæ ¹æ®å®˜æ–¹æµç¨‹å®Œæ•´åšå®Œï¼š</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/53b8d250e52941b08ac93f79acbd675a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YaN5Lya5ZGA:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765342707&amp;x-signature=CGbb5XmgTuw%2BrumulGUzgeo8Suc%3D" alt="" loading="lazy"/></p>
<p>ï¼ˆè®¤è¯è¿™é‡Œé€‰ä¸ªäººå¼€å‘è€…ï¼‰</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/28672c71abbc4f589fa701718b1124a9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YaN5Lya5ZGA:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765342707&amp;x-signature=oE33%2BmHgJn34vjsRaoGpido2dGw%3D" alt="" loading="lazy"/></p>
<p>å¦‚å›¾ï¼ŒkeyæˆåŠŸåˆ›å»ºã€‚ä¿å­˜å¥½è¿™ä¸ªkeyï¼Œä¹‹åä¼šç”¨å¾—åˆ°ã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f8c345dec8d044bab096d2761fb28cf3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YaN5Lya5ZGA:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765342707&amp;x-signature=I6fFBL53fdgcHzCuQNdHv7FGPj4%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-3">2. ä¸‹è½½ä¸å®‰è£…</h3>
<p>ç‚¹å¼€Â <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.cherry-ai.com%2F" title="https://www.cherry-ai.com/" target="_blank" ref="nofollow noopener noreferrer">www.cherry-ai.com/</a>Â ï¼Œ<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1ca377cf217a4eb3b6345af73b4d1fc3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YaN5Lya5ZGA:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765342707&amp;x-signature=07ogEOyMlgqWl2DKqNqSbWjwEzA%3D" alt="" loading="lazy"/></p>
<p>ä¸‹è½½è¯¥æ–‡ä»¶å¹¶å®‰è£…å¥½ã€‚</p>
<h3 data-id="heading-4">3. é…ç½®MCP</h3>
<p>ä¸‹è½½å¥½åï¼Œç‚¹å‡»å³ä¸Šè§’è®¾ç½®ï¼š</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/52c0092a13c54357b56e6a36eddd20fd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YaN5Lya5ZGA:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765342707&amp;x-signature=%2BDTlZvAkaHKeInq%2BnkMNykm7RB0%3D" alt="" loading="lazy"/></p>
<p>ç‚¹å‡»MCPè¿›åˆ°è¿™é‡Œï¼Œå†ç‚¹å‡»æ·»åŠ -å¿«é€Ÿåˆ›å»ºï¼š</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2efaf3050a774ceab6d5c8e35658fe4b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YaN5Lya5ZGA:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765342707&amp;x-signature=u%2F1kgLz2ZbsGW1olmSdYzUcw6VQ%3D" alt="" loading="lazy"/></p>
<p>åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬æ ¹æ®é«˜å¾·åœ°å›¾æä¾›çš„æ„å»ºæ–¹å¼æ¥å†™ï¼š</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/90ec0479f9b2437183fb91a58a7a9335~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YaN5Lya5ZGA:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765342707&amp;x-signature=sncyUOJV8zvhGufinf5SxYqQhe8%3D" alt="" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6d1cce0b0750457bbfeaf49c6e77a2fe~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YaN5Lya5ZGA:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765342707&amp;x-signature=Fzd2ov6YNgdeSj%2B2uyVxoCEe5uY%3D" alt="" loading="lazy"/></p>
<p>å®Œæˆåä¿å­˜å¹¶ç‚¹å‡»ï¼Œæ­¤æ—¶ä»£è¡¨MCPé“¾æ¥æˆåŠŸã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a910f649bd5a4ea0b519f0e1fbf49e82~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YaN5Lya5ZGA:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765342707&amp;x-signature=XljVJ7FjtJrH9%2FxDj%2B0STyFfsT0%3D" alt="" loading="lazy"/></p>
<p>æ³¨æ„ï¼šä½¿ç”¨å‰è¯·ç¡®ä¿ç¼–è¾‘æ—è¾¹çš„âš ï¸å·²å˜æˆâœ…ï¸ï¼Œå¦‚æœä¸ï¼Œå®‰è£…ä¸‹åˆ—ç¯å¢ƒï¼š</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9f2c7bf9dee349daacc15234f247baf2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YaN5Lya5ZGA:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765342707&amp;x-signature=aKTutkNxqhigdP07dx1F%2BV1ZGik%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-5">4. æµ‹è¯•è¿è¡Œ</h3>
<p>æ‰“å¼€MCPæœåŠ¡ï¼š</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/79c61c0aea2d4951a4311f41f456ec10~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YaN5Lya5ZGA:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765342707&amp;x-signature=eG65jf0rtzfg0Y25T1WomDD1IWk%3D" alt="" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7637a70628b84b69bcc11eeb11f0c4bf~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YaN5Lya5ZGA:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765342707&amp;x-signature=37paU2gisErXaTm0PvtDe0%2BJsNc%3D" alt="" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1dc0a0a1462e48c7bf9568e56452fd85~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YaN5Lya5ZGA:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765342707&amp;x-signature=yXBIsLHVmau23XEu0dS58MUd42s%3D" alt="" loading="lazy"/></p>
<p>ç‚¹å¼€æ¥ï¼Œèƒ½ç¡®å®šå®ƒçš„ç¡®è°ƒç”¨äº†MCPæœåŠ¡ã€‚</p>
<p>çœ‹ï¼šè¿™å°±æ˜¯MCPã€‚å·¥å…·ä¸åœ¨æœ¬åœ°ï¼Œç”šè‡³ä¸æ˜¯æˆ‘ä»¬å†™çš„ï¼Œä½†Agentå´èƒ½ç›´æ¥è°ƒç”¨ã€‚ç°åœ¨ï¼Œæˆ‘ä»¬è¦ç”¨<strong>Python ä»£ç </strong>æ¥å®ç°è¿™ä¸ªç¥å¥‡çš„è¿‡ç¨‹ã€‚</p>
<h2 data-id="heading-6">äºŒã€å·¥ç¨‹åœ°åŸºï¼šç¯å¢ƒä¸åè®®</h2>
<p>åœ¨åŠ¨æ‰‹å†™ä»£ç å‰ï¼Œå…ˆå˜æ¸… MCP çš„è¿è¡Œåº•åº§ï¼š</p>
<ul>
<li>å¦‚ä½•å¯åŠ¨ä»»æ„è¯­è¨€çš„å·¥å…·ï¼Ÿâ€”â€” <strong>å¼•å…¥ uv / npxï¼ˆä¸´æ—¶æ‰§è¡Œï¼‰</strong></li>
<li>å¦‚ä½•é«˜æ•ˆé€šä¿¡ï¼Ÿ â€”â€” <strong>é€‰æ‹©Stdioï¼ˆæœ¬åœ°ï¼‰æˆ– HTTPï¼ˆè¿œç¨‹ï¼‰</strong></li>
<li>å¦‚ä½•é¿å…å¡æ­»æˆ–èµ„æºæ³„éœ²ï¼Ÿ â€”â€” <strong>å…¨é“¾è·¯å¼‚æ­¥ + AsyncExitStack</strong></li>
</ul>
<p>è¿™äº›éœ€æ±‚çš„ç­”æ¡ˆï¼Œæ„æˆäº†æˆ‘ä»¬æ¥ä¸‹æ¥è¦è®¨è®ºçš„å·¥ç¨‹åŸºç¡€ã€‚</p>
<h3 data-id="heading-7">1. å¼•å…¥uv/npxï¼šä¸´æ—¶æ‰§è¡Œçš„å¦™ç”¨</h3>
<p>åœ¨ MCP ä¸–ç•Œé‡Œï¼Œæˆ‘ä»¬éšæ—¶ä¼šè°ƒç”¨å¤§é‡å·¥å…·å‡½æ•°ï¼Œä½†æ¯ä¸ªå·¥å…·å¯èƒ½ä¾èµ–ä¸åŒçš„ç¯å¢ƒï¼š</p>
<ul>
<li>A å‡½æ•°å¯èƒ½è¦æ±‚ Python 3.9</li>
<li>B å‡½æ•°å¯èƒ½è¦æ±‚ Python 3.12</li>
<li>C å‡½æ•°ç”šè‡³å¯èƒ½æ˜¯ Node.js ç¼–å†™</li>
</ul>
<p>å¦‚æœä»æ²¿ç”¨ pip installÂ æˆ–å…¨å±€å®‰è£… npm çš„æ€è·¯ï¼Œè¿™ä¼šå¯¼è‡´ <strong>ä¾èµ–å†²çªã€ç¯å¢ƒæ±¡æŸ“ã€ç»´æŠ¤å™©æ¢¦</strong>ã€‚å› æ­¤ï¼ŒMCP å®˜æ–¹æ˜ç¡®å»ºè®®ï¼š</p>
<blockquote>
<p><strong>MCP å·¥å…·ä¸è¦å®‰è£…ï¼Œè€Œè¦ä¸´æ—¶è¿è¡Œã€‚</strong></p>
</blockquote>
<p><strong>uvx + npx ï¼šåŒå¼•æ“ä¸´æ—¶æ‰§è¡Œä½“ç³»</strong></p>
<p>MCPæ˜¯â€œå¤šè¯­è¨€ç”Ÿæ€ + å­è¿›ç¨‹åè®®â€çš„ç»„åˆã€‚ä½ è°ƒç”¨çš„å·¥å…·å¯èƒ½æ¥è‡ª Pythonï¼Œä¹Ÿå¯èƒ½æ¥è‡ª Node.jsã€‚</p>
<p>æ‰€ä»¥æˆ‘ä»¬éœ€è¦ä¸¤ä¸ªâ€œä¸´æ—¶æ‰§è¡Œå¼•æ“â€ï¼š</p>























<table><thead><tr><th>å·¥å…·</th><th>è¯­è¨€ç”Ÿæ€</th><th>åŠŸèƒ½</th><th>æ˜¯å¦ç¯å¢ƒéš”ç¦»</th></tr></thead><tbody><tr><td>npx</td><td>Node.js</td><td>ä¸´æ—¶è¿è¡Œ npm å‘å¸ƒçš„MCP Server</td><td>âœ…ï¸</td></tr><tr><td>uvx</td><td>Python</td><td>ä¸´æ—¶è¿è¡Œ PyPI å‘å¸ƒçš„MCP Server</td><td>âœ…ï¸</td></tr></tbody></table>
<blockquote>
<p><strong>å®ƒä»¬æ˜¯å¹¶åˆ—å…³ç³»ï¼Œåˆ†åˆ«è´Ÿè´£ Node ä¸ Python å·¥å…·ï¼Œå‡ ä¹è¦†ç›– MCP ç”Ÿæ€ä¸­çš„å¤§éƒ¨åˆ†æœåŠ¡ç«¯å·¥å…·ã€‚</strong></p>
</blockquote>
<p>uvä¸ux</p>
<ul>
<li><strong>uv</strong>ï¼šRust å¼€å‘çš„è¶…é«˜é€Ÿ Python åŒ…å·¥å…·ï¼Œæ¯” pip å¿« 10â€“100 å€</li>
<li><strong>uvx</strong>ï¼šuv çš„â€œæµåª’ä½“æ’­æ”¾å™¨â€ï¼Œä¸“é—¨ç”¨äºä¸´æ—¶æ‰§è¡Œ Python å·¥å…·</li>
</ul>
<p>å·¥ä½œåŸç†ï¼š</p>
<ul>
<li><strong>1. è‡ªåŠ¨åˆ›å»ºéš”ç¦»ç¯å¢ƒ</strong></li>
<li><strong>2. æŒ‰éœ€ä¸‹è½½å·¥å…·åŒ…</strong></li>
<li><strong>3. æ‰§è¡Œå·¥å…·</strong></li>
<li><strong>4. é€€å‡ºæ—¶è‡ªåŠ¨æ¸…ç†ç¯å¢ƒï¼ˆæˆ–ç¼“å­˜ä»¥ä¾¿å¤ç”¨ï¼‰</strong></li>
</ul>
<p>ç‰¹æ€§ï¼š</p>
<ul>
<li><strong>å³ç”¨å³èµ°</strong>ï¼šå·¥å…·ç¯å¢ƒä¸´æ—¶ç”Ÿæˆï¼Œç”¨å®Œå³ç„šã€‚</li>
<li><strong>æ— æ±¡æŸ“</strong>ï¼šä¸ä¼šå½±å“ä½ å½“å‰çš„é¡¹ç›®ç¯å¢ƒã€‚</li>
<li><strong>è·¨è¯­è¨€</strong>ï¼šPython Agent å¯æ— ç¼è°ƒç”¨ Node.js å·¥å…·ï¼ˆé€šè¿‡ npxï¼‰ï¼Œpythonå·¥å…·åˆ™ç”± uvx å¯åŠ¨ã€‚</li>
<li><strong>æµåª’ä½“åŒ–</strong>ï¼šæŒ‰éœ€æ‹‰å–ï¼Œä¸´æ—¶ç¼“å­˜ï¼Œç¯å¢ƒå½¼æ­¤éš”ç¦»ã€‚</li>
</ul>
<p>Â å°è´´å£«ï¼šuv æ˜¯åº•å±‚å·¥å…·ï¼Œé€Ÿåº¦è¶…å¿«ï¼›uvx æ‰æ˜¯ä¸“é—¨ç”¨äºä¸´æ—¶æ‰§è¡Œ PyPI å·¥å…·çš„å¯æ‰§è¡Œå‘½ä»¤ã€‚</p>
<blockquote>
<p><strong>npx + uvx = MCPçš„ä¸´æ—¶æ‰§è¡ŒåŒæ ¸ã€‚</strong></p>
<p>å¯¹äºMCPå°ç™½è€Œè¨€ï¼Œä½ æ— éœ€ç®¡ç†å·¥å…·ä¾èµ–ï¼Œä¹Ÿæ— éœ€å…³å¿ƒç‰ˆæœ¬å†²çªï¼Œåªéœ€å¯åŠ¨Agentï¼Œå°±èƒ½åƒè°ƒç”¨æœ¬åœ°å‡½æ•°ä¸€æ ·ä½¿ç”¨å„ç§æœåŠ¡ç«¯å·¥å…·ã€‚</p>
</blockquote>
<h3 data-id="heading-8">2. é€‰æ‹© Stdioï¼šæœ¬åœ°é€šä¿¡çš„é»„é‡‘æ ‡å‡†ï¼ˆTransport å±‚çš„æ ¸å¿ƒå®ç°ï¼‰</h3>
<p>åœ¨MCPä¸­ï¼Œå®¢æˆ·ç«¯ä¸å·¥å…·æœåŠ¡å™¨ä¹‹é—´çš„é€šä¿¡é€šé“è¢«ç»Ÿç§°ä¸ºÂ <strong>Transport</strong>ï¼ˆä¼ è¾“å±‚ï¼‰â€”â€” å®ƒå®šä¹‰äº†</p>
<p><strong>â€œæ•°æ®é€šè¿‡ä»€ä¹ˆç®¡é“ä¼ è¾“â€ã€‚</strong></p>
<p>æ— è®ºå·¥å…·æ˜¯æ˜¯ç”¨pythonã€Node.js è¿˜æ˜¯å…¶ä»–è¯­è¨€ç¼–å†™ï¼ŒMCPéƒ½é€šè¿‡ Transport å®ç°è·¨è¯­è¨€äº¤äº’ã€‚</p>
<p>è™½ç„¶åè®®æ”¯æŒå¤šç§Transportï¼ˆå¦‚Stdioã€Streamable HTTPç­‰ï¼‰ï¼Œä½†<strong>åœ¨æœ¬åœ°åœºæ™¯ä¸‹ï¼ŒStdioæ˜¯å”¯ä¸€åˆç†ä¸”è¢«å¹¿æ³›é‡‡ç”¨çš„é€‰æ‹©ã€‚</strong></p>
<h3 data-id="heading-9">Stdioæ˜¯ä»€ä¹ˆï¼Ÿ</h3>
<p><strong>Stdio = Standard Input / Standard Output ï¼ˆæ ‡å‡†è¾“å‡º/æ ‡å‡†è¾“å‡ºï¼‰</strong> ï¼Œæœ¬è´¨ä¸Šå°±æ˜¯ çˆ¶å­è¿›ç¨‹ä¹‹é—´çš„åŒ¿åç®¡ç†é€šä¿¡ã€‚</p>
<p>å½“ä½ è¿è¡Œä¸€ä¸ªMCP å·¥å…·ï¼ˆä¾‹å¦‚Node.js çš„é«˜å¾·åœ°å›¾æœåŠ¡æ—¶ï¼‰ï¼Œç³»ç»Ÿä¼šï¼š</p>
<p><strong>1. å¯åŠ¨ä¸€ä¸ªå­è¿›ç¨‹ï¼ˆè¿è¡Œå·¥å…·ï¼‰</strong></p>
<p><strong>2. å»ºç«‹ä¸¤æ¡åŒ¿åç®¡é“ï¼š</strong></p>
<ul>
<li>çˆ¶è¿›ç¨‹ -&gt; å­è¿›ç¨‹ï¼šé€šè¿‡ stdin å‘é€è¯·æ±‚</li>
<li>å­è¿›ç¨‹ -&gt; çˆ¶è¿›ç¨‹ï¼šé€šè¿‡ stdout è¿”å›ç»“æœ</li>
</ul>
<p>å…³é”®ç‚¹ï¼š</p>
<ul>
<li><strong>ä¸èµ°TCP/IPï¼Œä¸å ç”¨ç«¯å£ï¼›</strong></li>
<li><strong>å¤–ç½‘æ— æ³•è®¿é—®ï¼Œå¤©ç„¶å®‰å…¨ï¼›</strong></li>
<li><strong>çˆ¶è¿›ç¨‹é€€å‡ºï¼Œå­è¿›ç¨‹è‡ªåŠ¨ç»“æŸï¼›</strong></li>
</ul>
<p><strong>åœ¨MCPåœºæ™¯ä¸‹ï¼ŒStdio å°±æ˜¯æœ€ç›´æ¥ã€æœ€å¿«æ·çš„æœ¬åœ°è¿›ç¨‹é€šä¿¡æ–¹å¼ï¼Œå®Œå…¨åœ¨å†…å­˜é‡Œå®Œæˆæ•°æ®ä¼ è¾“ã€‚</strong></p>
<hr/>
<h3 data-id="heading-10">MCPæœ¬åœ°ä¸ºä»€ä¹ˆä¸€å®šè¦ç”¨ Stdioï¼Ÿ</h3>
<p>å®ƒæœ‰ä¸‰ä¸ªå¤©ç„¶ä¼˜åŠ¿ï¼š</p>
<p><strong>1. æ— éœ€ç½‘ç»œï¼Œä¸éœ€è¦ç›‘å¬ç«¯å£</strong></p>
<p><strong>2. é›¶é…ç½®ï¼Œæ— éœ€æƒé™ï¼Œéƒ¨ç½²æˆæœ¬è¿‘ä¹0</strong></p>
<p><strong>3. å»¶è¿Ÿæœ€å°ï¼Œå¼€é”€æœ€ä½ï¼Œåè®®å®ç°ä¹Ÿæœ€ç®€å•ã€‚</strong></p>
<p>å®ƒä¹Ÿæ˜¯MCP serverçš„é»˜è®¤é€šä¿¡æ–¹å¼ã€‚å¦‚æœåªå¸Œæœ›æœ¬åœ°ä½¿ç”¨ï¼Œä¸€ä¸ªstdio serverå°±å·²ç»â€œå®Œç¾å¤Ÿç”¨â€ã€‚</p>
<p>ä½†ä½ åº”è¯¥å¾ˆæ˜æ˜¾èƒ½å‘ç°ä¸€ä¸ªå°é—®é¢˜ï¼š<strong>æˆ‘ä»¬ä¸€ç›´åœ¨å¼ºè°ƒæœ¬åœ°</strong>ã€‚</p>
<p>å¦‚æœä¸æ˜¯æœ¬åœ°å‘¢ï¼Ÿè¿™å°±å¿…é¡»å¼•å…¥<strong>Streamable HTTP</strong>äº†ï¼Œè¿™ä¼šæ˜¯æˆ‘ä»¬ä¸‹ç« çš„é‡ç‚¹æ•™å­¦éƒ¨åˆ†ï¼Œæœ¬ç« æš‚ä¸åšè¿‡å¤šè®²è§£ã€‚</p>
<p>è¿™é‡Œæ”¾ä¸€ä¸‹MCP æ‰€æ”¯æŒçš„ä¸‰ç§ä¼ è¾“ï¼ˆTransportï¼‰æ–¹å¼æ¯”å¯¹ï¼š</p>





































<table><thead><tr><th>æ¨¡å¼</th><th>æœºåˆ¶</th><th>å»¶è¿Ÿ</th><th>å®‰å…¨æ€§</th><th>é€‚ç”¨åœºæ™¯</th><th>å¤‡æ³¨</th></tr></thead><tbody><tr><td><strong>Stdio</strong>**ï¼ˆæœ¬ç« é‡ç‚¹ï¼‰**</td><td>çˆ¶å­è¿›ç¨‹ + åŒ¿åç®¡é“</td><td>~0.01ms</td><td>â­â­â­â­â­</td><td>æœ¬åœ°å¼€å‘ã€æ¡Œé¢åº”ç”¨</td><td>å†…å­˜æ‹·è´ç›´è¾¾ï¼Œçˆ¶å­è¿›ç¨‹å…±ç”Ÿï¼Œé›¶ç«¯å£å ç”¨</td></tr><tr><td>SSE</td><td>HTTP å•å‘æµ</td><td>~10â€“100ms</td><td>â­â­</td><td>ç®€å•è¿œç¨‹è°ƒç”¨ <strong>ï¼ˆå·²æ·˜æ±°ï¼‰</strong></td><td>å•å‘æµï¼Œå¿…é¡» HTTPSï¼Œæ•ˆç‡ä½ï¼Œç¨³å®šæ€§å·®</td></tr><tr><td><strong>Streamable HTTPï¼ˆä¸‹ç« é‡ç‚¹ï¼‰</strong></td><td>å…¨åŒå·¥ JSON-RPC over HTTP/2</td><td>~1â€“10ms</td><td>â­â­â­â­</td><td>äº‘éƒ¨ç½²ã€å›¢é˜Ÿå…±äº«</td><td>è·¨æœºå™¨é€šä¿¡ï¼Œé€‚åˆç”Ÿäº§ç¯å¢ƒï¼Œä¸é€‚åˆä¸´æ—¶æœ¬åœ°è°ƒç”¨</td></tr></tbody></table>
<p>SSEåœ¨MCPä¸­ä½¿ç”¨å·²é€æ­¥æ·˜æ±°ï¼Œåªæœ‰ä¸€äº›æ—©æœŸMCPé¡¹ç›®å¯èƒ½è¿˜åœ¨ç”¨ï¼Œä¸ç”¨è¿‡å¤šäº†è§£å®ƒã€‚</p>
<h3 data-id="heading-11">3. JSON-RPCï¼šMCPçš„é€šç”¨è¯­</h3>
<p>Stdio æä¾›äº†æ•°æ®ç®¡é“ï¼Œæ•°æ®ç®¡é“é‡Œå½“ç„¶å¾—æœ‰<strong>æ•°æ®åè®®</strong>â€”â€”å°±æ˜¯JSON-RPC 2.0ã€‚</p>
<p>ä¸ºä»€ä¹ˆé€‰JSON-RPC?</p>
<ul>
<li>ç®€å•ï¼šçº¯æ–‡æœ¬ JSONï¼Œå¯è¯»æ€§å¥½ï¼Œè°ƒè¯•æ–¹ä¾¿ï¼›</li>
<li>æ ‡å‡†ï¼šæœ‰æ˜ç¡®è§„èŒƒï¼Œå„è¯­è¨€éƒ½æœ‰æˆç†Ÿåº“ï¼›</li>
<li>åŒå‘ï¼šæ”¯æŒ è¯·æ±‚/å“åº” ä¸ é€šçŸ¥ï¼›</li>
</ul>
<p>å¸¦IDï¼šæ¯ä¸ªè¯·æ±‚æœ‰å”¯ä¸€idï¼Œå®¢æˆ·ç«¯å¯åŒ¹é…å“åº”ï¼Œæ”¯æŒå¹¶å‘è°ƒç”¨ã€‚</p>
<p>ä¸€ä¸ªå…¸å‹ MCP å·¥å…·è°ƒç”¨æ¶ˆæ¯é•¿ä»€ä¹ˆæ ·ï¼Ÿ</p>
<pre><code class="hljs language-arduino" lang="arduino"># å®¢æˆ·ç«¯ -- <span class="hljs-built_in">Server</span> ï¼ˆé€šè¿‡Stdinï¼‰
{
  <span class="hljs-string">"jsonrpc"</span>: <span class="hljs-string">"2.0"</span>,
  <span class="hljs-string">"id"</span>: <span class="hljs-string">"1"</span>,
  <span class="hljs-string">"method"</span>: <span class="hljs-string">"call_tool"</span>,
  <span class="hljs-string">"params"</span>: {
    <span class="hljs-string">"name"</span>: <span class="hljs-string">"search_poi"</span>,
    <span class="hljs-string">"arguments"</span>: {<span class="hljs-string">"keyword"</span>: <span class="hljs-string">"åŒ—äº¬è¥¿ç«™"</span>}
  }
}
</code></pre>

<pre><code class="hljs language-arduino" lang="arduino"># <span class="hljs-built_in">Server</span> â†’ å®¢æˆ·ç«¯ï¼ˆé€šè¿‡ stdoutï¼‰
{
  <span class="hljs-string">"jsonrpc"</span>: <span class="hljs-string">"2.0"</span>,
  <span class="hljs-string">"id"</span>: <span class="hljs-string">"1"</span>,
  <span class="hljs-string">"result"</span>: {
    <span class="hljs-string">"content"</span>: [{<span class="hljs-string">"type"</span>: <span class="hljs-string">"text"</span>, <span class="hljs-string">"text"</span>: <span class="hljs-string">"åç§°ï¼šåŒ—äº¬è¥¿ç«™..."</span>}]
  }
}
</code></pre>
<blockquote>
<p><strong>ğŸ’¡æ³¨ï¼šMCP åœ¨ JSON-RPC åŸºç¡€ä¸Šæ‰©å±•äº† <code>content</code> å­—æ®µï¼ˆæ”¯æŒæ–‡æœ¬ã€å›¾åƒã€åµŒå…¥ç­‰ï¼‰ï¼Œä½†åº•å±‚ä»æ˜¯æ ‡å‡† JSON-RPCã€‚</strong></p>
</blockquote>
<p>MCP SDKåšäº†ä»€ä¹ˆï¼Ÿ</p>
<ul>
<li>è‡ªåŠ¨åºåˆ—åŒ–/ååºåˆ—åŒ– JSON-RPC æ¶ˆæ¯ï¼›</li>
<li>ç®¡ç† id ç”Ÿæˆä¸åŒ¹é…ï¼›</li>
<li>å°†åº•å±‚å­—èŠ‚æµï¼ˆstdin/stdoutï¼‰æŠ½è±¡æˆ call_tool(name,args) é«˜çº§æ¥å£ã€‚</li>
</ul>
<p>æ‰€ä»¥ä½ ä¸éœ€è¦æ‰‹å†™ JSONï¼Œä½†å¿…é¡»çŸ¥é“ â€”â€” MCPçš„å¯¹è¯æœ¬è´¨æ˜¯ï¼š</p>
<p><strong>é€šè¿‡Stdinç®¡é“ä¼ è¾“JSON-RPCæ ¼å¼çš„æ¶ˆæ¯ã€‚</strong></p>
<hr/>
<h3 data-id="heading-12">4. ä½¿ç”¨Async/Awaitï¼šå¼‚æ­¥æ˜¯MCPçš„ç”Ÿå‘½çº¿</h3>
<p>MCPå·¥å…·è°ƒç”¨æ˜¯ <strong>I/Oå¯†é›†å‹</strong>ï¼ˆç­‰å¾…å­è¿›ç¨‹ã€ç½‘ç»œå“åº”ï¼‰ã€‚</p>
<p>ç”¨åŒæ­¥ï¼šä¸»çº¿ç¨‹ä¼šé˜»å¡ç­‰å¾…Aå·¥å…·è¿”å›ç»“æœåï¼Œå†å»è¯·æ±‚Bå·¥å…·ï¼Œå†å»Cå·¥å…·...æ€»è€—æ—¶=å„ä¸ªå·¥å…·è€—æ—¶çš„æ€»å’Œï¼Œç”¨æˆ·ä½“éªŒæ˜¯ç¾éš¾æ€§çš„ã€‚</p>
<p>ç”¨å¼‚æ­¥â€”â€”</p>
<ul>
<li>éé˜»å¡ï¼šå‘å‡ºè¯·æ±‚åç«‹å³é‡Šæ”¾æ§åˆ¶æƒï¼›</li>
<li>é«˜å¹¶å‘ï¼šå•çº¿ç¨‹å¯ç®¡ç†æ•°ç™¾ä¸ªå·¥å…·è°ƒç”¨ï¼›</li>
<li>ä½“éªŒæµç•…ï¼šLLMå¯è¾¹ç”ŸæˆTokenè¾¹ç­‰å¾…ç»“æœã€‚</li>
</ul>
<blockquote>
<p>ğŸ“Œ <strong>MCP SDK åŸºäº asyncio</strong>ï¼Œæ‰€æœ‰æ–¹æ³•å‡ä¸º async ã€‚<strong>ä¸ç”¨åç¨‹ï¼Œå¯¸æ­¥éš¾è¡Œ</strong>ã€‚</p>
</blockquote>
<h3 data-id="heading-13">5. å¦‚ä½•é˜²æ­¢èµ„æºæ³„éœ²ï¼šAsyncExitStackçš„å¨åŠ›</h3>
<p>æœ¬åœ°è¿è¡Œ MCP serverï¼ˆå¦‚npx/uvxï¼‰ï¼Œå…¶å®å°±æ˜¯ï¼š</p>
<ul>
<li>å®¢æˆ·ç«¯ = çˆ¶è¿›ç¨‹</li>
<li>MCP server ï¼ˆpyè„šæœ¬ã€npxç­‰ï¼‰= å­è¿›ç¨‹</li>
</ul>
<p>å¦‚æœå®¢æˆ·ç«¯å› ä¸ºå¼‚å¸¸é€€å‡ºï¼ˆæŠ›é”™ï¼Œè¢«å–æ¶ˆï¼Œctrl+cï¼‰ï¼Œ</p>
<p>å­è¿›ç¨‹ä¸ä¼šè‡ªåŠ¨é€€å‡ºï¼Œä¼šå˜æˆåƒµå°¸è¿›ç¨‹ï¼ŒæŒç»­å ç”¨èµ„æºã€‚</p>
<p>è§£å†³æ–¹æ³•â€”â€”AsyncExitStackï¼š</p>
<p><strong>AsyncExitStackæ˜¯ç®¡ç†å¼‚æ­¥èµ„æºçš„ä¿é™©ç®±ï¼š</strong></p>
<ul>
<li>å…è®¸ä½ æŠŠæ‰€æœ‰éœ€è¦æ¸…ç†çš„èµ„æºï¼ˆå­è¿›ç¨‹ã€ç®¡é“ã€ä¼šè¯ï¼‰æ³¨å†Œè¿›å»ï¼›</li>
<li>åœ¨é€€å‡ºæ—¶æŒ‰é€†åºè‡ªåŠ¨æ¸…ç†ï¼›</li>
<li>æ— è®ºæ­£å¸¸ç»“æŸè¿˜æ˜¯å´©æºƒé€€å‡ºï¼Œéƒ½ä¿è¯æ¸…ç†æ‰§è¡Œã€‚</li>
</ul>
<p>ç®€è€Œè¨€ä¹‹ï¼š</p>
<p><strong>å®ƒç¡®ä¿MCP serveræ°¸è¿œä¸ä¼šè¢«é—ç•™åœ¨åå°ï¼Œæ˜¯ç”Ÿäº§çº§MCP å®¢æˆ·ç«¯å¿…å¤‡çš„å®‰å…¨æœºåˆ¶ã€‚</strong></p>
<hr/>
<p>å¦‚ä¸Šï¼Œæˆ‘ä»¬å°†å·¥ç¨‹åœ°åŸºå…¨éƒ¨è¡¥å®Œåï¼ŒMCPçš„é€»è¾‘é“¾è¶‹äºå®Œæ•´ï¼š</p>



































<table><thead><tr><th>é—®é¢˜</th><th>è§£æ³•</th><th>æŠ€æœ¯ç»„ä»¶</th></tr></thead><tbody><tr><td><strong>å¦‚ä½•å¯åŠ¨ä»»æ„è¯­è¨€å·¥å…·ï¼Ÿ</strong></td><td><strong>ä¸´æ—¶æ‰§è¡Œ</strong></td><td><strong>npx / uvx</strong></td></tr><tr><td><strong>å¦‚ä½•å»ºç«‹æœ¬åœ°é€šä¿¡é€šé“ï¼Ÿ</strong></td><td><strong>è¿›ç¨‹ç®¡é“</strong></td><td><strong>Stdio</strong></td></tr><tr><td><strong>åŒæ–¹ç”¨ä»€ä¹ˆè¯­è¨€å¯¹è¯ï¼Ÿ</strong></td><td><strong>ç»“æ„åŒ–åè®®</strong></td><td><strong>JSON-RPC 2.0</strong></td></tr><tr><td><strong>å¦‚ä½•é«˜æ•ˆä¸å¡æ­»ï¼Ÿ</strong></td><td><strong>éé˜»å¡ I/O</strong></td><td><strong>Async/Await AsyncExitStack</strong></td></tr><tr><td><strong>å¦‚ä½•é¿å…åƒµå°¸è¿›ç¨‹ï¼Ÿ</strong></td><td><strong>èµ„æºç®¡å®¶</strong></td><td><strong>AsyncExitStack</strong></td></tr></tbody></table>
<p>ç°åœ¨ï¼Œäº”å—æ‹¼å›¾å·²ç»é›†é½ï¼š<strong>å¯åŠ¨ + é€šé“ + åè®® + å¼‚æ­¥ + å®‰å…¨</strong>ï¼Œ</p>
<p>å¯ä»¥å¼€å§‹çœŸæ­£å°è¯•è°ƒç”¨ä¸€ä¸ªMCPæœåŠ¡å™¨äº†ã€‚</p>
<h2 data-id="heading-14">ä¸‰ã€æ„å»ºæœ€å°å¯è¿è¡ŒMCPå®¢æˆ·ç«¯</h2>
<p><strong>ç›®æ ‡ï¼šç”¨æœ€å°‘çš„ä»£ç ï¼Œæ‰“é€špythonä¸MCPçš„è¿æ¥å¹¶è·å–æ•°æ®ï¼Œä¸è€ƒè™‘å¤ç”¨ï¼Œä¸è€ƒè™‘æ€§èƒ½ã€‚</strong></p>
<p>è¿™é‡Œæˆ‘ä»¬åˆ†ä¸ºä¸¤ä¸ªä»£ç æ–‡ä»¶ï¼š</p>
<p><strong>simple_client.py</strong> â€”â€” è´Ÿè´£åˆå§‹åŒ–clientï¼Œä¾›main_simple.pyæ–‡ä»¶å¼•ç”¨</p>
<p><strong>main_simple.py</strong> â€”â€” è´Ÿè´£çœŸæ­£è¿è¡ŒMCPï¼Œå¯¼å…¥simple_clientæ¥åˆå§‹åŒ–</p>
<p>ï¼ˆæ³¨ï¼šéœ€æå‰ä¸‹è½½å®‰è£…node.jså¹¶é…ç½®ç¯å¢ƒå˜é‡ï¼Œä¸ç„¶æ­¤å¤„æ— æ³•ä½¿ç”¨npxï¼‰</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># simple_client.py</span>
<span class="hljs-keyword">from</span> mcp <span class="hljs-keyword">import</span> ClientSession,StdioServerParameters
<span class="hljs-keyword">from</span> mcp.client.stdio <span class="hljs-keyword">import</span> stdio_client

<span class="hljs-keyword">class</span> <span class="hljs-title class_">SimpleClient</span>:
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self,command:<span class="hljs-built_in">str</span>,args:<span class="hljs-built_in">list</span>[<span class="hljs-built_in">str</span>],env:<span class="hljs-built_in">dict</span>=<span class="hljs-literal">None</span></span>):
        <span class="hljs-comment"># æŒ‡å®šè¦å¯åŠ¨çš„å·¥å…·å’Œå‚æ•°</span>
        self.params = StdioServerParameters(command=command,args=args,env=env)

    <span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">run_once</span>(<span class="hljs-params">self,tool_name:<span class="hljs-built_in">str</span>,tool_args:<span class="hljs-built_in">dict</span></span>):
        <span class="hljs-comment"># è¯­æ³•ç³–: async with è‡ªåŠ¨å¸®æˆ‘ä»¬ æ‰“å¼€è¿æ¥ -&gt; è¿è¡Œ -&gt; å…³é—­è¿æ¥</span>
        <span class="hljs-keyword">async</span> <span class="hljs-keyword">with</span> stdio_client(self.params) <span class="hljs-keyword">as</span> (read,write):
            <span class="hljs-comment"># å»ºç«‹çˆ¶å­è¿›ç¨‹ç®¡é“ï¼ˆstdin/stdoutï¼‰</span>
            <span class="hljs-keyword">async</span> <span class="hljs-keyword">with</span> ClientSession(read,write) <span class="hljs-keyword">as</span> session:
            <span class="hljs-comment"># ç”¨JSON-RPCä¸å·¥å…·å¯¹è¯</span>
                <span class="hljs-keyword">await</span> session.initialize()

                <span class="hljs-comment"># ç›´æ¥è°ƒç”¨å·¥å…·</span>
                result = <span class="hljs-keyword">await</span> session.call_tool(tool_name,tool_args)
                <span class="hljs-keyword">return</span> result.content[<span class="hljs-number">0</span>].text
</code></pre>
<hr/>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># main_simple.py</span>
import asyncio
import os
from m10_mcp_basics.simple_client import SimpleClient
from config import AMAP_MAPS_API_KEY

<span class="hljs-comment"># å¤åˆ¶å½“å‰pyè¿›ç¨‹çš„ç¯å¢ƒå˜é‡,å¹¶åœ¨å¤åˆ¶çš„ç¯å¢ƒå˜é‡é‡Œæ–°å¢ä¸€æ¡ï¼Œç¡®ä¿å®‰å…¨å¯æ§</span>
<span class="hljs-attr">env_vars</span> = os.environ.copy()
env_vars<span class="hljs-section">["AMAP_MAPS_API_KEY"]</span> = AMAP_MAPS_API_KEY

async def main():
    print('ğŸ”¥ æ­£åœ¨è¿›è¡Œå•æ¬¡è°ƒç”¨...')
    <span class="hljs-attr">client</span> = SimpleClient(
        <span class="hljs-attr">command</span>=<span class="hljs-string">"npx"</span>,
        <span class="hljs-attr">args</span>=[<span class="hljs-string">"-y"</span>,<span class="hljs-string">"@amap/amap-maps-mcp-server"</span>,AMAP_MAPS_API_KEY],
        <span class="hljs-attr">env</span>=env_vars
    )

    <span class="hljs-comment"># è¿™ä¸€æ­¥ä¼šç»å†:å¯åŠ¨è¿›ç¨‹ - æ¡æ‰‹ - è°ƒç”¨ - æ€è¿›ç¨‹</span>
    <span class="hljs-attr">result</span> = await client.run_once(<span class="hljs-string">"maps_text_search"</span>, {<span class="hljs-string">"keywords"</span>: <span class="hljs-string">"åŒ—äº¬å¤§å­¦"</span>})
    print(f'âœ…ï¸ ç»“æœ:{result<span class="hljs-section">[:300]</span>}')


if <span class="hljs-attr">__name__</span> == <span class="hljs-string">"__main__"</span>:
    asyncio.run(main())
</code></pre>
<p>ä½ å¯èƒ½ä¼šé—®ï¼šcommandå’Œargsé‡Œçš„è¿™äº›å‚æ•°ï¼Œæˆ‘ä»¬æ€ä¹ˆçŸ¥é“é‡Œé¢æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ</p>
<p>åˆ«æ€¥ï¼Œå¸¦ä½ å†å›åˆ°é«˜å¾·çš„MCPå®˜ç½‘æ‹ä¸€éï¼Œè¿™æ—¶ä½ å°±è·ŸP1æ—¶ä¸ä¸€æ ·ï¼ŒçŸ¥é“æ€ä¹ˆç†è§£äº†ï¼š</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Flbs.amap.com%2Fapi%2Fmcp-server%2Fgettingstarted" title="https://lbs.amap.com/api/mcp-server/gettingstarted" target="_blank" ref="nofollow noopener noreferrer">é«˜å¾·åœ°å›¾MCP</a></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3a1e11de0cfb493ba6983b605fbb5a93~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YaN5Lya5ZGA:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765342707&amp;x-signature=Q4KTpnfukIxlpTQiqAB9TFmA6e8%3D" alt="" loading="lazy"/></p>
<p>å­¦ä¹ åï¼Œæˆ‘ä»¬çŸ¥é“sseå‡ ä¹ä¸ç”¨ï¼Œstreamable HTTPæ¯”è¾ƒå¤æ‚ï¼Œä¸‹ç¯‡æ–‡ç« å†å­¦ï¼Œè€Œè¿™é‡Œçš„Node.js I/Oå…¶å®å°±æ˜¯stdioçš„ä¸€ç§èŒƒå¼ï¼Œæ‰€ä»¥æˆ‘ä»¬è¦çœ‹node.js I/Oçš„å®ç°æ–¹æ³•ï¼š</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4bac1346952a46ae9488f6e2cf22f85c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YaN5Lya5ZGA:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765342707&amp;x-signature=d%2BHai4z%2BvUDOl25pa%2FNOY%2Fv5bjg%3D" alt="" loading="lazy"/></p>
<p>å¾ˆæ˜æ˜¾ï¼Œå®ƒè¿™é‡Œå®šä¹‰äº†ä¸‰ä¸ªæˆ‘ä»¬éœ€è¦é‡ç‚¹å…³æ³¨çš„å¯¹è±¡ï¼š</p>
<p>commandâ€”â€”å®‰è£…å‘½ä»¤ï¼›argsâ€”â€”å‚æ•°ï¼ˆæŒ‡ä»¤ä¸åŒ…åï¼‰ï¼›envâ€”â€”ç¯å¢ƒå˜é‡åã€‚</p>
<p>å›çœ‹ä¹‹å‰ä»£ç main_simple.pyï¼Œä½ ä¼šå‘ç°æˆ‘ä»¬é‡ç‚¹æ”¹çš„å°±æ˜¯è¿™äº›åœ°æ–¹ã€‚</p>
<p>æµ‹è¯•è¿è¡Œï¼š</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8091068025904240b36a91b02c55d1ee~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YaN5Lya5ZGA:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765342707&amp;x-signature=Z%2FaQ9q1JiLaUWw2ZsQwY01%2Bn1RE%3D" alt="" loading="lazy"/></p>
<p>æ²¡æœ‰é—®é¢˜ï¼ŒæˆåŠŸè¾“å‡ºã€‚</p>
<p>è‡³æ­¤æˆ‘ä»¬ç»ˆäºèƒ½æˆåŠŸè°ƒç”¨MCPæœåŠ¡äº†ï¼Œä½†æœ‰æ²¡æœ‰æ„Ÿè§‰è¿™ä¸ªMCPæœåŠ¡æœ‰ç‚¹å¤ªç®€äº†ï¼Ÿ</p>
<p>ç›®å‰çš„MCPæœåŠ¡åªèƒ½å¸®æˆ‘ä»¬ç¡®å®šèƒ½è¿æ¥ï¼Œä½†å®Œå…¨æ— æ³•çœŸæ­£ä½¿ç”¨ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªçœŸæ­£<strong>åŠŸèƒ½æ›´é«˜çº§ï¼Œå°è£…æ›´å¥½ï¼ŒçœŸæ­£å¯å¤ç”¨</strong>çš„MCPåˆå§‹åŒ–å®¢æˆ·ç«¯ã€‚</p>
<h2 data-id="heading-15"><strong>å››ã€å‡çº§ç‰ˆMCPå®¢æˆ·ç«¯ï¼šæ„å»ºç”Ÿäº§çº§ MCP æ¥å…¥èƒ½åŠ›</strong></h2>
<h3 data-id="heading-16">1.Â ä»æœ€å°å®ç°åˆ°ç”Ÿäº§çº§ï¼šä¸ºä»€ä¹ˆéœ€è¦é‡æ„ï¼Ÿ</h3>
<p>å›é¡¾æˆ‘ä»¬æœ€åˆçš„ <strong>MCP æœ€å°å®ç°ï¼ˆsimple_main.pyï¼‰</strong> ï¼Œå®ƒå­˜åœ¨ä»¥ä¸‹å…³é”®ç¼ºé™·ï¼š</p>
<ul>
<li>âŒï¸ å·¥å…·åå’Œå‚æ•°ç¡¬ç¼–ç ï¼Œæ— æ³•åŠ¨æ€é€‚é…ï¼›</li>
<li>âŒï¸ æœªé›†æˆ LLMï¼Œæ— æ³•å®ç°è‡ªä¸»å†³ç­–ï¼›</li>
<li>âŒï¸ æ— å·¥å…·å‘ç°æœºåˆ¶ï¼Œæ‰©å±•æ€§ä¸ºé›¶ï¼›</li>
<li>âŒï¸ äº¤äº’æ–¹å¼åŸå§‹ï¼Œæ— æµå¼åé¦ˆï¼›</li>
<li>âŒï¸ MCP è¿”å›çš„æ•°æ®æœªè¢« LangChain ç†è§£ï¼Œæ— æ³•ç”¨äº Agentã€‚</li>
</ul>
<p>è¿™å¯¼è‡´å®ƒ<strong>ä»…èƒ½ç”¨äºæµ‹è¯•ï¼Œæ— æ³•æŠ•å…¥å®é™…ä½¿ç”¨</strong>ã€‚</p>
<h3 data-id="heading-17"><strong>2. æˆ‘ä»¬æœŸæœ›çš„ MCP è¿è¡Œæµç¨‹</strong></h3>
<p>ä¸€ä¸ªçœŸæ­£å¯ç”¨çš„ MCP é›†æˆåº”æ»¡è¶³å¦‚ä¸‹çº¿æ€§æµç¨‹ï¼š</p>
<blockquote>
<p><strong>ç”¨æˆ·æé—® â†’ LLM åˆ†æ â†’ è‡ªåŠ¨å‘ç°å¯ç”¨å·¥å…· â†’ è°ƒç”¨ MCP å·¥å…· â†’ è·å–ç»“æœ â†’ æ•´åˆå›ç­” â†’ è¿”å›ç”¨æˆ·</strong></p>
</blockquote>
<p>ä¸ºæ­¤ï¼Œæˆ‘ä»¬å¿…é¡»è§£å†³ä»¥ä¸‹æ ¸å¿ƒé—®é¢˜ï¼š</p>





























<table><thead><tr><th>éœ€æ±‚</th><th>è§£å†³æ–¹æ¡ˆ</th></tr></thead><tbody><tr><td><strong>LLM èƒ½è·å–æŸä¸ª MCP çš„æ‰€æœ‰å·¥å…·</strong></td><td>å®ç° <strong>list_tools()</strong> å¹¶è¿”å›ç»“æ„åŒ–å…ƒæ•°æ®</td></tr><tr><td><strong>æ”¯æŒå¤šä¸ª MCP æœåŠ¡æ‰¹é‡æ¥å…¥</strong></td><td>è®¾è®¡<strong>å¯å¤ç”¨ã€å¯ç»„åˆ</strong>çš„å®¢æˆ·ç«¯æ¶æ„</td></tr><tr><td><strong>è¿æ¥å¿…é¡»å¥å£®å¯é </strong></td><td>ä½¿ç”¨ <strong>AsyncExitStack</strong>Â ç®¡ç†å­è¿›ç¨‹ç”Ÿå‘½å‘¨æœŸ</td></tr><tr><td><strong>MCP æ•°æ®éœ€è¢« LangGraph ç†è§£</strong></td><td>æ„å»º<strong>åè®®è½¬æ¢å±‚</strong>ï¼ˆBridgeï¼‰ï¼Œç”Ÿæˆ StructuredTool</td></tr><tr><td><strong>è°ƒç”¨å¿…é¡»ç¬¦åˆ MCP åè®®è§„èŒƒ</strong></td><td>ä¸¥æ ¼éµå¾ª <strong>JSON-RPC + inputSchema</strong> æ ¼å¼</td></tr></tbody></table>
<p>ä¸ºè¾¾æˆä¸Šè¿°ç›®æ ‡ï¼Œæˆ‘ä»¬å°†ç³»ç»Ÿæ‹†åˆ†ä¸º<strong>ä¸‰ä¸ªé«˜åº¦è§£è€¦çš„æ¨¡å—</strong>ï¼š</p>
<ul>
<li><strong>mcp_client.py</strong>ï¼šåº•å±‚é€šä¿¡å®¢æˆ·ç«¯ï¼ˆåªç®¡è¿æ¥ä¸è°ƒç”¨ï¼‰</li>
<li><strong>mcp_bridge.py</strong>ï¼šåè®®é€‚é…ä¸­é—´ä»¶ï¼ˆMCP â†” LangChainï¼‰</li>
<li><strong>mcp_main.py</strong>ï¼šä¸šåŠ¡è¿è¡Œå…¥å£ï¼ˆAgent é€»è¾‘ + ç”¨æˆ·äº¤äº’ï¼‰</li>
</ul>
<p>æœ¬ç« é‡ç‚¹è®²è§£å‰ä¸¤ä¸ªæ¨¡å—ã€‚</p>
<h3 data-id="heading-18">3. mcp_client.pyï¼šæ‰“é€ å¯å¤ç”¨çš„å¼‚æ­¥ MCP å®¢æˆ·ç«¯</h3>
<h3 data-id="heading-19">ç›®æ ‡</h3>
<p>å®ç°ä¸€ä¸ª<strong>é€šç”¨ã€å¥å£®ã€å¯åµŒå…¥ä»»æ„ Python åº”ç”¨</strong>ï¼ˆå¦‚ FastAPIã€Djangoã€LangGraphï¼‰çš„ MCP å®¢æˆ·ç«¯ï¼Œä»…å…³æ³¨ <strong>stdio é€šä¿¡ä¸åè®®äº¤äº’</strong>ã€‚</p>
<h3 data-id="heading-20">æ ¸å¿ƒç‰¹æ€§</h3>
<ul>
<li>å¼‚æ­¥é•¿è¿æ¥ï¼ˆä¸€æ¬¡è¿æ¥ï¼Œå¤šæ¬¡è°ƒç”¨ï¼‰</li>
<li>è‡ªåŠ¨èµ„æºæ¸…ç†ï¼ˆé˜²åƒµå°¸è¿›ç¨‹ï¼‰</li>
<li>LLM å‹å¥½è¾“å‡ºï¼ˆçº¯å­—å…¸æ ¼å¼ï¼‰</li>
<li>é˜²å¾¡æ€§ç¼–ç¨‹ï¼ˆå¤„ç†ç©ºè¿”å›ã€å¼‚å¸¸ç­‰ï¼‰</li>
</ul>
<h4 data-id="heading-21">3.1 <strong>init</strong>ï¼šåˆå§‹åŒ–é…ç½®</h4>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">MCPClient</span>:
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self,command:<span class="hljs-built_in">str</span>,args:<span class="hljs-built_in">list</span>[<span class="hljs-built_in">str</span>],env:<span class="hljs-built_in">dict</span>=<span class="hljs-literal">None</span></span>):
        <span class="hljs-comment"># MCPå¯åŠ¨æ–¹å¼(npx/uvx/python -m xxx)</span>
        self.params = StdioServerParameters(command=command,args=args,env=env)
        <span class="hljs-comment"># å·¥ç¨‹æ ¸å¿ƒ:èµ„æºæ ˆ</span>
        self.exit_stack = AsyncExitStack()
        <span class="hljs-comment"># è¿æ¥ä¼šè¯(é•¿è¿æ¥)</span>
        self.session:<span class="hljs-type">Optional</span>[ClientSession]=<span class="hljs-literal">None</span>
</code></pre>
<ul>
<li>self.params ï¼šå°è£…å¦‚ä½•å¯åŠ¨ MCP æœåŠ¡ï¼ˆå¦‚ npx @amap/...ï¼‰ã€‚</li>
<li>self.exit_stackï¼šå¼‚æ­¥èµ„æºæ ˆï¼Œç»Ÿä¸€ç®¡ç†å­è¿›ç¨‹ã€ç®¡é“ï¼ˆtransportï¼‰ã€ä¼šè¯ï¼ˆsessionï¼‰çš„ç”Ÿå‘½å‘¨æœŸã€‚</li>
<li>self.sessionï¼šJSON-RPC ä¼šè¯å¯¹è±¡ï¼Œå»¶è¿Ÿåˆå§‹åŒ–ã€‚</li>
</ul>
<blockquote>
<p><strong>âœ…ï¸ è®¾è®¡ç†å¿µï¼šåˆ›å»ºå³é…ç½®ï¼Œè¿æ¥æ‰å¯åŠ¨ã€‚</strong></p>
</blockquote>
<h4 data-id="heading-22">3.2 connect() â€”â€” å»ºç«‹é•¿è¿æ¥</h4>
<pre><code class="hljs language-python" lang="python">    <span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">connect</span>(<span class="hljs-params">self</span>):
        <span class="hljs-string">"""å»ºç«‹MCPé•¿è¿æ¥ï¼ˆä¸€æ¬¡è¿æ¥ï¼Œå¤šæ¬¡è°ƒç”¨ï¼‰"""</span>
        <span class="hljs-keyword">if</span> self.session:
            <span class="hljs-keyword">return</span> <span class="hljs-comment"># å·²è¿æ¥æ— éœ€é‡å¤</span>

        <span class="hljs-comment"># è¿›å…¥transportï¼ˆè¯»/å†™ç®¡é“ï¼‰</span>
        transport = <span class="hljs-keyword">await</span> self.exit_stack.enter_async_context(
            stdio_client(self.params)
        )
        <span class="hljs-comment"># åˆ›å»ºJSON-RPCå¯¹è¯</span>
        self.session = <span class="hljs-keyword">await</span> self.exit_stack.enter_async_context(
            ClientSession(transport[<span class="hljs-number">0</span>],transport[<span class="hljs-number">1</span>])
        )
        <span class="hljs-comment"># ç­‰å¾…MCPæœåŠ¡å™¨è¿”å›å·¥å…·æ¸…å•</span>
        <span class="hljs-keyword">await</span> self.session.initialize()
</code></pre>
<ul>
<li>
<p>é˜²é‡å…¥ï¼šå¦‚æœå·²è¿æ¥ï¼Œç›´æ¥è¿”å›ï¼›</p>
</li>
<li>
<p>å¯åŠ¨å­è¿›ç¨‹ + è·å–ç®¡é“ï¼š</p>
<ul>
<li>stdio_client(self.params) å¯åŠ¨å­è¿›ç¨‹ï¼ˆå¦‚npx/uvxï¼‰ï¼›</li>
<li>è¿”å›ï¼ˆread_stream,write_streamï¼‰ï¼Œå³stdoutå’Œstdinçš„å¼‚æ­¥æµï¼Œç”¨äºè¯»å–æœåŠ¡è¾“å‡º/å‘æœåŠ¡å‘é€è¾“å…¥ï¼›</li>
<li>enter_async_context å°†å…¶åŠ å…¥ exit_stackï¼Œç¡®ä¿é€€å‡ºæ—¶è‡ªåŠ¨å…³é—­ã€‚</li>
</ul>
</li>
<li>
<p>åˆ›å»ºJSON-RPCå¯¹è¯ï¼š</p>
<ul>
<li>ClientSession(read,write) å°è£…è¯»å†™æµä¸º JSON-RPCå®¢æˆ·ç«¯ï¼›</li>
<li>åŒæ ·åŠ å…¥ exit_stack ç®¡ç†ã€‚</li>
</ul>
</li>
<li>
<p>æ¡æ‰‹åˆå§‹åŒ–ï¼š</p>
<ul>
<li>await self.session.initialize() å‘é€ initialize è¯·æ±‚ï¼Œå®Œæˆåè®®æ¡æ‰‹ï¼Œå¹¶è·å–æœåŠ¡èƒ½åŠ›ï¼ˆå¦‚å·¥å…·åˆ—è¡¨ç¼“å­˜ï¼‰ã€‚</li>
</ul>
</li>
</ul>
<p>è¿™é‡Œçš„è¿æ¥å¯ä»¥å¯¹æ¯”æˆ‘ä»¬ä¹‹å‰æœ€å°MVPçš„clientï¼š</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/43f4bd378e4b4be2a1770dada05eadbc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YaN5Lya5ZGA:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765342707&amp;x-signature=3HNQkm3FriZmhICnsjWwV7e%2F34o%3D" alt="" loading="lazy"/>
ä¹‹å‰æˆ‘ä»¬ç”¨äº†å¤šä¸ª <strong>async with xÂ as y</strong> åµŒå¥—ï¼Œ</p>
<p>å¦‚ä»Šæˆ‘ä»¬åªéœ€æ¢æˆ <strong>y = await self.exit_stack.enter_async_context(x)</strong> å°±èƒ½è¾¾åˆ°ç±»ä¼¼ç”šè‡³æ›´å¥½çš„åŠŸæ•ˆï¼Œè¿™å°±æ˜¯AsyncExitStack çš„å¼ºå¤§ä¹‹å¤„ã€‚</p>
<blockquote>
<p><strong>âœ…ï¸ é•¿è¿æ¥æ¨¡å¼ï¼šè¿æ¥ä¸€æ¬¡ï¼Œåç»­å¯å¤šæ¬¡è°ƒç”¨å†…éƒ¨å‡½æ•°ã€‚</strong></p>
</blockquote>
<h4 data-id="heading-23">3.3 list_tools() â€”â€” æŸ¥è¯¢å¯ç”¨å·¥å…·</h4>
<pre><code class="hljs language-python" lang="python">    <span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">list_tools</span>(<span class="hljs-params">self</span>):
        <span class="hljs-string">"""æŸ¥è¯¢å·¥å…·åˆ—è¡¨ï¼Œä¸ºLLMå»ºç«‹ä¸Šä¸‹æ–‡ç”¨"""</span>
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> self.session:
            <span class="hljs-keyword">raise</span> RuntimeError(<span class="hljs-string">"æœªè¿æ¥ï¼Œè¯·å…ˆ connect()"</span>)

        result = <span class="hljs-keyword">await</span> self.session.list_tools()

        <span class="hljs-comment"># è½¬ä¸ºçº¯å­—å…¸,LLMèƒ½è¯»</span>
        <span class="hljs-keyword">return</span>[
            {
                <span class="hljs-string">"name"</span>:tool.name,
                <span class="hljs-string">"description"</span>:tool.description,
                <span class="hljs-string">"input_schema"</span>:tool.inputSchema
            }
            <span class="hljs-keyword">for</span> tool <span class="hljs-keyword">in</span> result.tools
        ]
</code></pre>
<ul>
<li>
<p>å…ˆæ£€æŸ¥æ˜¯å¦å·²è¿æ¥ï¼›</p>
</li>
<li>
<p>è°ƒç”¨session.list_tools è·å– ListToolsResult å¯¹è±¡ï¼›</p>
</li>
<li>
<p>å…³é”®è½¬æ¢ï¼šå°†æ¯ä¸ª Tool å¯¹è±¡ï¼ˆPydantic æ¨¡å‹ï¼‰è½¬ä¸ºçº¯pyå­—å…¸ã€‚</p>
<ul>
<li>å› ä¸º LLM æˆ–ä¸Šå±‚æ¶æ„ï¼ˆå¦‚ LangChainï¼‰é€šå¸¸éœ€è¦å¯æ¥å—çš„Â JSON æ•°æ®ç±»å‹ï¼›</li>
<li>tool.inputSchema æ˜¯åŸå§‹JSON Schema (dict)ï¼Œå¯ç›´æ¥ä¼ é€’ã€‚</li>
</ul>
</li>
</ul>
<blockquote>
<p><strong>âœ…ï¸ è¾“å‡ºæ ¼å¼å®Œå…¨å…¼å®¹ LLM ä¸Šä¸‹æ–‡æ³¨å…¥éœ€æ±‚ã€‚</strong></p>
</blockquote>
<h4 data-id="heading-24">3.4 call_tool() â€”â€” è°ƒç”¨å…·ä½“å·¥å…·</h4>
<pre><code class="hljs language-python" lang="python">    <span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">call_tool</span>(<span class="hljs-params">self,name:<span class="hljs-built_in">str</span>,args:<span class="hljs-built_in">dict</span></span>):
        <span class="hljs-string">"""è°ƒç”¨å·¥å…·ï¼ˆå·¥ç¨‹åŒ–ï¼šåŠ ä¸Šé˜²å¾¡æ€§å¤„ç†ï¼‰"""</span>
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> self.session:
            <span class="hljs-keyword">raise</span> RuntimeError(<span class="hljs-string">"æœªè¿æ¥ï¼Œè¯·å…ˆconnect()"</span>)

        result = <span class="hljs-keyword">await</span> self.session.call_tool(name,args)

        <span class="hljs-comment"># æœ‰äº›å·¥å…·å¯èƒ½æ‰§è¡ŒæˆåŠŸä½†æ— æ–‡æœ¬è¿”å›</span>
        <span class="hljs-keyword">if</span> <span class="hljs-built_in">hasattr</span>(result,<span class="hljs-string">"content"</span>) <span class="hljs-keyword">and</span> result.content:
            <span class="hljs-keyword">return</span> result.content[<span class="hljs-number">0</span>].text

        <span class="hljs-keyword">return</span> <span class="hljs-string">"å·¥å…·æ‰§è¡ŒæˆåŠŸï¼Œä½†æ— æ–‡æœ¬è¿”å›"</span>
</code></pre>
<ul>
<li>
<p>è°ƒç”¨ self.session.call_tool(name,args)ï¼Œå‘é€ç¬¦åˆMCPåè®®çš„ call_tool è¯·æ±‚ã€‚</p>
</li>
<li>
<p>é˜²å¾¡æ€§å¤„ç†ï¼š</p>
<ul>
<li>å¹¶éæ‰€æœ‰å·¥å…·éƒ½è¿”å›contentï¼Œæœ‰äº›åªè¿”å› structured data</li>
<li>å¦‚æœæœ‰ content ä¸”éç©ºï¼Œå–ç¬¬ä¸€ä¸ªæ–‡æœ¬å—ï¼ˆresult.content[0].textï¼‰</li>
<li>å¦åˆ™è¿”å›æç¤º</li>
</ul>
</li>
</ul>
<h4 data-id="heading-25">3.5 cleanup() â€”â€” æ¸…ç†èµ„æº</h4>
<pre><code class="hljs language-python" lang="python">    <span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">cleanup</span>(<span class="hljs-params">self</span>):
        <span class="hljs-string">"""å…³é—­MCPæœåŠ¡ã€ä¼šè¯å’Œtransport"""</span>
        <span class="hljs-keyword">if</span> self.session:
            <span class="hljs-keyword">await</span> self.exit_stack.aclose()
            self.session = <span class="hljs-literal">None</span>
</code></pre>
<ul>
<li>
<p>è‡ªåŠ¨æŒ‰å…ˆè¿›å…ˆå‡ºé¡ºåºå…³é—­æ‰€æœ‰æ³¨å†Œçš„èµ„æºï¼›</p>
<ul>
<li>ClientSessionï¼šå‘é€ shutdownï¼Œå…³é—­ RPC;</li>
<li>stdio_clientï¼šå…³é—­ stdin/stdout ç®¡é“ï¼Œç»ˆæ­¢å­è¿›ç¨‹</li>
</ul>
</li>
<li>
<p>é‡ç½® self.session = None ï¼Œé¿å…é‡å¤å¤„ç†</p>
</li>
</ul>
<blockquote>
<p><strong>âœ…ï¸ è¿™æ˜¯ä¼˜é›…å…³é—­çš„å…³é”®ï¼Œé˜²æ­¢å­è¿›ç¨‹å˜æˆâ€œåƒµå°¸è¿›ç¨‹â€ã€‚</strong></p>
</blockquote>
<p>è‡³æ­¤ï¼ŒMCPClient æˆä¸ºä¸€ä¸ªç”Ÿäº§å°±ç»ªçš„<strong>é€šä¿¡åŸºåº§</strong>ã€‚</p>
<h3 data-id="heading-26">4. mcp_bridge.pyï¼šæ„å»º MCP ä¸ LangChain çš„ç²˜åˆå±‚</h3>
<p>ç›®æ ‡ï¼šå°†ä»»æ„ MCP æœåŠ¡<strong>æ— ç¼è½¬æ¢ä¸º LangChain å¯ç”¨çš„ StructuredToolÂ åˆ—è¡¨</strong>ï¼Œä½¿ LLM èƒ½åƒè°ƒç”¨æœ¬åœ°å‡½æ•°ä¸€æ ·è°ƒç”¨è¿œç¨‹ MCP å·¥å…·ã€‚</p>
<p>æ ¸å¿ƒæŒ‘æˆ˜</p>
<ul>
<li>MCP ä½¿ç”¨ JSON Schema æè¿°å‚æ•°ï¼›</li>
<li>LangChain ä½¿ç”¨ Pydantic æ¨¡å‹æ ¡éªŒå‚æ•°ï¼›</li>
<li>äºŒè€…éœ€é€šè¿‡Â <strong>åŠ¨æ€æ¨¡å‹ç”Ÿæˆ</strong>Â å®ç°æ¡¥æ¥ã€‚</li>
</ul>
<h4 data-id="heading-27">4.1 ç±»å®šä¹‰ä¸ä¸Šä¸‹æ–‡ç®¡ç†</h4>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">LangChainMCPAdapter</span>:
    <span class="hljs-string">"""
    MCPé€‚é…å™¨ï¼šå°†MCPå®¢æˆ·ç«¯æ— ç¼è½¬æ¢ä¸ºLangChainå¯ç”¨çš„å·¥å…·é›†ã€‚
    å®ç°äº†ä¸Šä¸‹æ–‡ç®¡ç†å™¨åè®®ï¼Œ
    """</span>
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self,mcp_client:MCPClient</span>):
        self.client = mcp_client

    <span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">__aenter__</span>(<span class="hljs-params">self</span>):
        <span class="hljs-string">"""è¿›å…¥ä¸Šä¸‹æ–‡ï¼Œè‡ªåŠ¨å»ºç«‹è¿æ¥"""</span>
        <span class="hljs-keyword">await</span> self.client.connect()
        <span class="hljs-keyword">return</span> self

    <span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">__aexit__</span>(<span class="hljs-params">self,exc_type,exc_value,exc_tb</span>):
        <span class="hljs-string">"""é€€å‡ºä¸Šä¸‹æ–‡ï¼Œè‡ªåŠ¨æ¸…ç†èµ„æº"""</span>
        <span class="hljs-keyword">await</span> self.client.cleanup()
</code></pre>
<ul>
<li>
<p>å°è£… MCPClientï¼Œæä¾› async with æ”¯æŒï¼ˆå…¶å®è´¨å°±æ˜¯ç”¨__aenter__/__aexit__ç®¡ç†ç”Ÿå‘½å‘¨æœŸï¼‰</p>
<ul>
<li><strong>aenter</strong> ï¼šè¿›å…¥ async with å—è‡ªåŠ¨è°ƒç”¨ client.session()ï¼Œå»ºç«‹MCPé•¿è¿æ¥ã€‚</li>
<li><strong>aeixt</strong>ï¼šé€€å‡ºæ—¶è‡ªåŠ¨è°ƒç”¨ client.cleanup()ï¼Œå…³é—­å­è¿›ç¨‹å’Œç®¡é“ã€‚</li>
</ul>
</li>
<li>
<p>return selfï¼šæŒ‡çš„æ˜¯å½“å‰ LangChainMCPAdapter å®ä¾‹ï¼š</p>
<ul>
<li>async with adapter as a ä¼šè°ƒç”¨ adapter.<strong>aenter()</strong>ï¼Œå…¶è¿”å›å€¼èµ‹ç»™aã€‚</li>
<li>æ‰€ä»¥__aenter__é‡Œå¿…é¡»è¦ return selfï¼Œå¦åˆ™aä¸æ˜¯é€‚é…å™¨å®ä¾‹ï¼Œåç»­æ–¹æ³•è°ƒç”¨ä¼šå‡ºé”™ã€‚</li>
</ul>
</li>
</ul>
<h4 data-id="heading-28">4.2Â æ ¸å¿ƒæ–¹æ³•ï¼š_schema_to_pydanticï¼ˆJSON Schema -&gt; Pydantic æ¨¡å‹ï¼‰</h4>
<p>è¿™é‡Œæ˜¯æˆ‘ä»¬æ„å»º mcp_bridge çš„æ ¸å¿ƒéƒ¨åˆ†ï¼Œå®ƒä½œä¸ºè½¬æ¢å™¨æå…¶é‡è¦ã€‚</p>
<h4 data-id="heading-29">ä¸ºä»€ä¹ˆéœ€è¦Schemaï¼šMCPå·¥å…·çš„è¯´æ˜ä¹¦</h4>
<p>MCPå·¥å…·æœ¬èº«æœ‰å„ç§è¾“å…¥å‚æ•°ï¼Œä½† LLM å¹¶ä¸çŸ¥é“æ¯ä¸ªå·¥å…·éœ€è¦çš„<strong>æ¯ä¸ªå‚æ•°ç±»å‹</strong>å’Œ<strong>å¿…å¡«ä¿¡æ¯</strong>ã€‚å¦‚æœè®© LLM éšæ„ç”Ÿæˆï¼Œç»“æœå¯èƒ½å‡ºé”™æˆ–æ ¹æœ¬ç”¨ä¸äº†ã€‚</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># ç¤ºä¾‹ MCP Schema</span>
{
  <span class="hljs-string">"type"</span>: <span class="hljs-string">"object"</span>,
  <span class="hljs-string">"properties"</span>: {
    <span class="hljs-string">"city"</span>: { <span class="hljs-string">"type"</span>: <span class="hljs-string">"string"</span>, <span class="hljs-string">"description"</span>: <span class="hljs-string">"åŸå¸‚åç§°"</span> },
    <span class="hljs-string">"keyword"</span>: { <span class="hljs-string">"type"</span>: <span class="hljs-string">"string"</span>, <span class="hljs-string">"description"</span>: <span class="hljs-string">"æœç´¢å…³é”®å­—"</span> },
    <span class="hljs-string">"radius"</span>: { <span class="hljs-string">"type"</span>: <span class="hljs-string">"number"</span>, <span class="hljs-string">"description"</span>: <span class="hljs-string">"æœç´¢åŠå¾„ï¼ˆç±³ï¼‰"</span> }
  },
  <span class="hljs-string">"required"</span>: [<span class="hljs-string">"city"</span>, <span class="hljs-string">"keyword"</span>]
}
</code></pre>
<p>å¦‚ä¸Šï¼Œå®ƒå‘Šè¯‰æˆ‘ä»¬ï¼š</p>
<ul>
<li>city å’Œ keyword å¿…é¡»ä¼ å…¥ï¼›</li>
<li>ç±»å‹åˆ†åˆ«æ˜¯ string / string / numberï¼›</li>
<li>æ¯ä¸ªå­—æ®µçš„æ„ä¹‰ï¼ˆdescriptionï¼‰</li>
</ul>
<p><strong>æœ‰äº†Schemaï¼Œllmæ‰èƒ½çœŸæ­£ç¨³å®šä¸”æ­£ç¡®åœ°è°ƒç”¨MCPå·¥å…·ï¼Œè€Œä¸æ˜¯å‡­è¿æ°”çä¼ å‚æ•°ã€‚</strong></p>
<hr/>
<h4 data-id="heading-30"><strong>ä½¿ç”¨Pydanticï¼šæ‰§è¡Œè§„èŒƒçš„pythonæ¨¡å‹</strong></h4>
<p>æ­¤å¤„æˆ‘ä»¬æŠŠPydanticä½œä¸ºæ¡¥æ¢ï¼š</p>
<p><strong>Schema æ˜¯æè¿°è§„èŒƒï¼ŒPydantic æ˜¯æ‰§è¡Œè§„èŒƒçš„ Python æ¨¡å‹ã€‚</strong></p>
<p>ä½œç”¨ï¼š</p>
<ul>
<li>ç±»å‹æ ¡éªŒï¼šç¡®ä¿LLMç”Ÿæˆçš„å‚æ•°ç±»å‹å‡†ç¡®ï¼›</li>
<li>å¿…å¡«æ£€æµ‹ï¼šé˜²æ­¢é—æ¼å¿…å¡«å­—æ®µ</li>
<li>è‡ªåŠ¨ç”Ÿæˆå­—æ®µè¯´æ˜ï¼šä¾›LLMå‚è€ƒ</li>
<li>æ— ç¼æ³¨å…¥ LangChainï¼šStructuredTool å¯ä»¥ç›´æ¥ä½¿ç”¨ Pydantic æ¨¡å‹</li>
</ul>
<p>æ‰€ä»¥<strong>pydanticçš„å®è´¨ï¼Œå°±æ˜¯æŠŠMCPçš„ JSON Schema è½åœ°åˆ° Pythonç±»å‹ä¸–ç•Œï¼Œè®©LLMå¯ä»¥ç›´æ¥æŒ‰ç…§è§„åˆ™ç”Ÿæˆå‚æ•°</strong>ã€‚</p>
<p>å®é™…ä»£ç æ„å»ºå¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-meta">    @staticmethod</span>
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">_schema_to_pydantic</span>(<span class="hljs-params">name:<span class="hljs-built_in">str</span>,schema:<span class="hljs-type">Dict</span>[<span class="hljs-built_in">str</span>,<span class="hljs-type">Any</span>]</span>):
        <span class="hljs-string">"""
        å°†MCPçš„JSON SchemaåŠ¨æ€è½¬æ¢ä¸ºPydanticæ¨¡å‹
        è¿™æ˜¯è®©LLMç†è§£å‚æ•°è¦æ±‚çš„å…³é”®
        """</span>
        <span class="hljs-comment"># æ‰€æœ‰å‚æ•°å®šä¹‰</span>
        properties = schema.get(<span class="hljs-string">"properties"</span>,{}) <span class="hljs-comment"># å…è®¸ä¸ºç©º</span>
        <span class="hljs-comment"># å¿…éœ€å­—æ®µ</span>
        required = schema.get(<span class="hljs-string">"required"</span>,[]) <span class="hljs-comment"># å…è®¸ä¸ºç©º</span>
        <span class="hljs-comment"># åˆå§‹ç©ºå­—å…¸</span>
        fields = {}
        <span class="hljs-comment"># ç±»å‹æ˜ å°„è¡¨ï¼šå°†JSONç±»å‹æ˜ å°„ä¸ºPythonç±»å‹</span>
        type_map = {
            <span class="hljs-string">"string"</span>:<span class="hljs-built_in">str</span>,
            <span class="hljs-string">"integer"</span>:<span class="hljs-built_in">int</span>,
            <span class="hljs-string">"number"</span>:<span class="hljs-built_in">float</span>,
            <span class="hljs-string">"boolean"</span>:<span class="hljs-built_in">bool</span>,
            <span class="hljs-string">"array"</span>:<span class="hljs-built_in">list</span>,
            <span class="hljs-string">"object"</span>:<span class="hljs-built_in">dict</span>
        }

        <span class="hljs-keyword">for</span> field_name,field_info <span class="hljs-keyword">in</span> properties.items():
            <span class="hljs-comment"># 1.è·å–å­—æ®µç±»å‹</span>
            json_type = field_info.get(<span class="hljs-string">"type"</span>,<span class="hljs-string">"string"</span>)
            python_type = type_map.get(json_type,<span class="hljs-type">Any</span>)
            <span class="hljs-comment"># 2.è·å–æè¿°</span>
            description = field_info.get(<span class="hljs-string">"description"</span>,<span class="hljs-string">""</span>)
            <span class="hljs-comment"># 3.æ˜¯å¦ä¸ºå¿…éœ€é¡¹</span>
            <span class="hljs-comment"># å¦‚æœæ˜¯å¿…å¡«ï¼Œé»˜è®¤å€¼ä¸º ... (Ellipsis): å¦åˆ™ä¸ºNone</span>
            <span class="hljs-keyword">if</span> field_name <span class="hljs-keyword">in</span> required:
                default_value = ...
            <span class="hljs-keyword">else</span>:
                default_value = <span class="hljs-literal">None</span>

            <span class="hljs-comment"># 4.æ„å»ºPydanticå­—æ®µå®šä¹‰</span>
            fields[field_name] = (python_type,Field(default=default_value,description=description))

        <span class="hljs-comment"># åŠ¨æ€åˆ›å»ºä¸€ä¸ªPydanticæ¨¡å‹ç±»</span>
        <span class="hljs-keyword">return</span> create_model(<span class="hljs-string">f"<span class="hljs-subst">{name}</span>Schema"</span>,**fields)
</code></pre>
<p>å½’çº³ä¸Šè¿°æ­¥éª¤ï¼š</p>
<ul>
<li>
<p>ï¼ˆ1ï¼‰æå–schemaç»“æ„ï¼šproperties å’Œ requiredï¼Œå…¼å®¹ç©º schema</p>
</li>
<li>
<p>ï¼ˆ2ï¼‰ç±»å‹æ˜ å°„ï¼šå°†JSON Schema ç±»å‹è½¬æ¢ä¸º Python ç±»å‹</p>
</li>
<li>
<p>ï¼ˆ3ï¼‰æ„å»ºå­—æ®µå­—å…¸ï¼šfield_name:(python_type,Field(...))</p>
<ul>
<li>å¿…å¡«å­—æ®µç”¨ ... è¡¨ç¤º</li>
<li>å¯é€‰å­—æ®µç”¨ None</li>
</ul>
</li>
<li>
<p>ï¼ˆ4ï¼‰åŠ¨æ€åˆ›å»º Pydantic æ¨¡å‹å¹¶è¿”å›ï¼šreturn create_model(f"{name}Schema",**fields)</p>
</li>
</ul>
<blockquote>
<p><strong>âœ…ï¸ è¿™æ˜¯mcp_bridgeçš„æ ¸å¿ƒæŠ€æœ¯ï¼šè®© LLM çŸ¥é“è°ƒç”¨è¿™ä¸ªå·¥å…·éœ€è¦å“ªäº›å‚æ•°ã€‚</strong></p>
</blockquote>
<h4 data-id="heading-31"><strong>4.3Â æ ¸å¿ƒæ–¹æ³•ï¼šget_tools() â€”â€” ç”ŸæˆLangChain å·¥å…·åˆ—è¡¨</strong></h4>
<p>è¯¥æ–¹æ³•æ ¸å¿ƒä½œç”¨æ˜¯ï¼šè·å–MCPåŸç¥å·¥å…·åˆ—è¡¨ï¼Œå¹¶è½¬æ¢ä¸º LangChain å¯ç›´æ¥ä½¿ç”¨çš„å·¥å…·ï¼ˆStructuredToolï¼‰ï¼Œå¯ç›´æ¥å–‚ç»™ bind_toolsã€‚</p>
<pre><code class="hljs language-python" lang="python">    <span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">get_tools</span>(<span class="hljs-params">self</span>):
        <span class="hljs-string">"""
        æ ¸å¿ƒæ–¹æ³•ï¼šè·å–å¹¶è½¬æ¢å·¥å…·
        è¿”å›çš„æ˜¯æ ‡å‡†çš„LangChain Toolåˆ—è¡¨ï¼Œå¯ä»¥ç›´æ¥å–‚ç»™bind_tools
        """</span>
        <span class="hljs-comment"># ä»MCP Server è·å–åŸå§‹å·¥å…·åˆ—è¡¨</span>
        mcp_tools = <span class="hljs-keyword">await</span> self.client.list_tools()
        langchain_tools = []

        <span class="hljs-keyword">for</span> tool_info <span class="hljs-keyword">in</span> mcp_tools:
            <span class="hljs-comment"># 1.åŠ¨æ€ç”Ÿæˆå‚æ•°æ¨¡å‹ -- è¦å¤„ç†schemaä¸ºç©ºçš„æƒ…å†µ</span>
            <span class="hljs-comment"># inputSchemaä¸€èˆ¬ä¼šæ”¾å¥½MCPå„ç§å·¥å…·/å‚æ•°çš„ä»‹ç»</span>
            raw_schema = tool_info.get(<span class="hljs-string">"input_schema"</span>,{})
            args_model = self._schema_to_pydantic(tool_info[<span class="hljs-string">"name"</span>],raw_schema)
            <span class="hljs-comment"># 2.å®šä¹‰æ‰§è¡Œå‡½æ•°</span>
            <span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">_dynamic_tool_func</span>(<span class="hljs-params">tool_name=tool_info[<span class="hljs-string">"name"</span>],**kwargs</span>):
                <span class="hljs-keyword">return</span> <span class="hljs-keyword">await</span> self.client.call_tool(tool_name,kwargs)

            <span class="hljs-comment"># 3.åŒ…è£…æˆllmå¯è°ƒç”¨çš„å·¥å…·(æ³¨å…¥args_schema)</span>
            tool = StructuredTool.from_function(
                coroutine=_dynamic_tool_func,
                name=tool_info[<span class="hljs-string">"name"</span>],
                description=tool_info[<span class="hljs-string">"description"</span>],
                args_schema=args_model <span class="hljs-comment"># æŠŠè¯´æ˜ä¹¦ä¼ ç»™ LangChain</span>
            )
            langchain_tools.append(tool)
        <span class="hljs-keyword">return</span> langchain_tools
</code></pre>
<p>å½’çº³ä¸Šè¿°æ­¥éª¤ï¼š</p>
<ul>
<li>
<p>ï¼ˆ1ï¼‰è·å–åŸå§‹MCPå·¥å…·åˆ—è¡¨</p>
<ul>
<li>è°ƒç”¨self.client.list_tools() è·å–åŸå§‹å·¥å…·ä¿¡æ¯ï¼ŒåŒ…æ‹¬åç§°ã€æè¿°ã€è¾“å…¥å‚æ•°schemaã€‚</li>
</ul>
</li>
<li>
<p>ï¼ˆ2ï¼‰éå†å¹¶è½¬æ¢ schema ä¸º Pydantic æ¨¡å‹</p>
<ul>
<li>æ¯ä¸ªå·¥å…·çš„ input_schema è½¬ä¸º Pydantic æ¨¡å‹ï¼Œç¡®ä¿LLMè°ƒç”¨æ—¶å‚æ•°ç±»å‹æ­£ç¡®ï¼Œå¿…å¡«å­—æ®µå®Œæ•´ã€‚</li>
</ul>
</li>
<li>
<p>ï¼ˆ3ï¼‰åŠ¨æ€åˆ›å»ºå·¥å…·æ‰§è¡Œå‡½æ•°</p>
<ul>
<li>ä½¿ç”¨é—­åŒ… tool_name=tool_info["name"]é¿å…å¾ªç¯å˜é‡ç»‘å®šé—®é¢˜ï¼Œå‡½æ•°å†…éƒ¨å®é™…è°ƒç”¨self.call_tool å®ŒæˆMCPè°ƒç”¨ã€‚</li>
</ul>
</li>
<li>
<p>ï¼ˆ4ï¼‰åŒ…è£…ä¸ºLangChain StructuredTool</p>
<ul>
<li>æ³¨å…¥ args_schema åï¼Œè®©LangChainçŸ¥é“ï¼š</li>
<li>å“ªäº›å‚æ•°å¯ç”¨ï¼›</li>
<li>å“ªäº›å¿…å¡«ï¼›</li>
<li>æ¯ä¸ªå‚æ•°ç±»å‹å’Œæè¿°ã€‚</li>
</ul>
</li>
<li>
<p>ï¼ˆ5ï¼‰æ”¶é›†å·¥å…·å¹¶è¿”å›</p>
</li>
</ul>
<p>æ‰€æœ‰å·¥å…·æ”¶é›†åœ¨ langchain_tools å¹¶è¿”å›ï¼Œç›´æ¥ç”¨äº bind_tools æ³¨å…¥LLMã€‚</p>
<hr/>
<h3 data-id="heading-32"><strong>5.Â å°ç»“ï¼šåˆ†å±‚æ¶æ„çš„ä»·å€¼</strong></h3>

























<table><thead><tr><th>æ¨¡å—</th><th>èŒè´£</th><th>ä¼˜åŠ¿</th></tr></thead><tbody><tr><td><strong>mcp_client.py``</strong></td><td>åº•å±‚é€šä¿¡</td><td>å¯ç‹¬ç«‹æµ‹è¯•ã€å¯è¢« FastAPI/Django å¤ç”¨</td></tr><tr><td><strong>mcp_briedge.py``</strong></td><td>åè®®è½¬æ¢</td><td>è§£è€¦ MCP ä¸ LangChainï¼Œæ”¯æŒä»»æ„ MCP æœåŠ¡</td></tr><tr><td><strong>mcp_main.pyï¼ˆä¸‹æ–‡ï¼‰</strong></td><td>ä¸šåŠ¡é€»è¾‘</td><td>ä¸“æ³¨ Agent ç¼–æ’ï¼Œæ— éœ€å…³å¿ƒ MCP ç»†èŠ‚</td></tr></tbody></table>
<blockquote>
<p>ğŸ”§ <strong>è¿™ç§â€œé€šä¿¡å±‚ + é€‚é…å±‚ + ä¸šåŠ¡å±‚â€çš„ä¸‰æ®µå¼æ¶æ„ï¼Œæ˜¯æ„å»ºå¯ç»´æŠ¤ã€å¯æ‰©å±• AI ç³»ç»Ÿçš„æœ€ä½³å®è·µã€‚</strong></p>
</blockquote>
<p>é€šè¿‡è¿™ä¸¤ä»½æ–‡ä»¶ï¼Œæˆ‘ä»¬ä¸ä»…è§£å†³äº†æœ€å°å®ç°çš„æ‰€æœ‰ç—›ç‚¹ï¼Œè¿˜ä¸ºæœªæ¥æ¥å…¥<strong>å¤©æ°”ã€æ•°æ®åº“ã€ä¼ä¸šå†…éƒ¨ç³»ç»Ÿç­‰ä»»æ„ MCP æœåŠ¡</strong>æ‰“ä¸‹äº†åšå®åŸºç¡€ã€‚</p>
<p>æ¥ä¸‹æ¥ï¼Œåªéœ€åœ¨ <strong>mcp_main.py</strong>Â ä¸­ç»„åˆè¿™äº›èƒ½åŠ›ï¼Œå³å¯æ„å»ºä¸€ä¸ª<strong>çœŸæ­£æ™ºèƒ½ã€å¯äº¤äº’ã€ç”Ÿäº§å¯ç”¨çš„ MCP Agent</strong>ã€‚</p>
<h2 data-id="heading-33"><strong>äº”ã€æµå¼è¾“å‡ºï¼šæ‹’ç»â€œå“‘å·´â€Agentï¼Œå¼€å¯å…¨é“¾è·¯è§‚æµ‹</strong></h2>
<p>åœ¨ä¸Šä¸€ç« ä¸­ï¼Œæˆ‘ä»¬æ„å»ºäº†åšå®çš„ MCP å®¢æˆ·ç«¯åº•åº§ã€‚ä½†åœ¨æ­£å¼ç»„è£… Agent å‰ï¼Œæˆ‘ä»¬å¿…é¡»è§£å†³ä¸€ä¸ªè‡³å…³é‡è¦çš„é—®é¢˜ï¼š<strong>æ²‰é»˜</strong>ã€‚</p>
<p>æ™®é€šçš„ LLM èŠå¤©æˆ–è®¸åªéœ€ç­‰å¾…1ç§’å°±èƒ½çœ‹è§ç¬¬ä¸€ä¸ªå­—ï¼Œä½†åœ¨MCP Agentçš„ä¸–ç•Œé‡Œï¼Œæµç¨‹æ˜¯è¿™æ ·çš„ï¼šå¯åŠ¨å­è¿›ç¨‹ -&gt; æ¡æ‰‹ -&gt; LLMæ€è€ƒ -&gt; å‘é€å·¥å…·è°ƒç”¨ -&gt; é«˜å¾·APIå“åº” -&gt; LLMæ€»ç»“</p>
<p>è¿™ä¸€å¥—ä¸‹æ¥ï¼Œå¯èƒ½éœ€è¦3-10ç§’ï¼Œå¦‚æœä½ ç”¨ä¼ ç»Ÿçš„æ¨¡å¼ï¼Œå®Œå…¨è¾“å‡ºï¼Œç”¨æˆ·å°†é¢å¯¹ä¸€ä¸ªé•¿è¾¾10ç§’çš„ç©ºç™½å…‰æ ‡ï¼Œä½“éªŒæå·®ã€‚</p>
<p>æ‰€ä»¥æˆ‘ä»¬å¿…é¡»è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œç”¨<strong>æµå¼</strong>æ¥å¤„ç†ã€‚</p>
<h3 data-id="heading-34">1. æœ€å°å¯å®ç°æµå¼</h3>
<p>å…¶å®æ—©åœ¨05ç¯‡æˆ‘ä»¬å°±å·²æ¥è§¦è¿‡æµå¼ï¼Œåªä¸è¿‡é‚£ä¼šçš„æµå¼è¿˜åªæ˜¯æœ€å°å®ç°ï¼š</p>
<pre><code class="hljs language-ini" lang="ini">from langchain_openai import ChatOpenAI
from langchain_core.callbacks.streaming_stdout import StreamingStdOutCallbackHandler

<span class="hljs-attr">llm</span> = ChatOpenAI(
    <span class="hljs-attr">model</span>=<span class="hljs-string">"deepseek-chat"</span>,
    <span class="hljs-attr">streaming</span>=<span class="hljs-literal">True</span>,  <span class="hljs-comment"># å¼€å¯æµå¼</span>
    <span class="hljs-attr">callbacks</span>=[StreamingStdOutCallbackHandler()] <span class="hljs-comment"># æ³¨å†Œå›è°ƒï¼Œè‡ªåŠ¨æ‰“å°</span>
)
</code></pre>
<p>å®ƒçš„å®ç°æå…¶ç®€å•ï¼Œstreaming=Trueä¸ä¸€ä¸ªå›è°ƒå‡½æ•°å³å¯ï¼šLLMæ¯åå‡ºä¸€ä¸ªå­—å°±è§¦å‘å›è°ƒå¹¶æ‰“å°ã€‚</p>
<p>ä½†åœ¨Agentåœºæ™¯ä¸‹ï¼Œå®ƒæ˜¯<strong>çå­</strong>ã€‚</p>
<p>å½“ Agent å†³å®šè°ƒç”¨å·¥å…·æ—¶ï¼ŒLLMä¼šåœæ­¢ç”Ÿæˆæ–‡æœ¬ï¼Œè½¬è€Œç”ŸæˆJSONæŒ‡ä»¤ã€‚æ­¤æ—¶è¿™ä¸ªå›è°ƒå‡½æ•°å°±ä¼šæ²‰é»˜ï¼Œåªæœ‰å·¥å…·æŸ¥å®ŒLLMå†æ¬¡è¯´è¯å±å¹•æ‰ä¼šåŠ¨ã€‚</p>
<p>å¯¹äºMCPè¿™ç§é‡I/Oçš„åœºæ™¯ï¼Œè¿™ç§<strong>é—´æ­‡å¤±èª</strong>ç»å¯¹ä¸å¯å®¹è®¸ã€‚</p>
<h3 data-id="heading-35">2. å…¨é“¾è·¯äº‹ä»¶æµå¼</h3>
<p>ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬éœ€è¦å‡çº§åˆ° <strong>LangGraph çš„äº‹ä»¶é©±åŠ¨æµå¼</strong>ï¼ˆastream_eventsï¼‰ã€‚</p>
<p>è¿™ä¸ä»…ä»…æ˜¯æ‰“å°å­—ï¼Œè€Œæ˜¯ä¸€ä¸ª<strong>åˆ†å±‚çš„äº‹ä»¶æ€»æ ˆ</strong>ã€‚å®ƒæŠŠ Agent è¿è¡Œè¿‡ç¨‹ä¸­çš„<strong>æ¯ä¸ªåŠ¨ä½œéƒ½çœ‹åšæ˜¯ä¸€ä¸ªäº‹ä»¶</strong>ï¼Œè®©æˆ‘ä»¬æ‹¥æœ‰äº†ä¸Šå¸è§†è§’ã€‚</p>
<h3 data-id="heading-36">çº¿æ€§è¿è¡Œæ€è·¯ï¼šAgentåˆ°åº•åœ¨å¹²ä»€ä¹ˆï¼Ÿ</h3>
<p>é€šè¿‡å®Œæ•´æµå¼ï¼Œæˆ‘ä»¬å¯ä»¥æ•è· Agent æ€è€ƒçš„å®Œæ•´æ—¶é—´è½´ï¼š</p>
<p><strong>1. Thinkingï¼ˆæ€è€ƒé˜¶æ®µï¼‰</strong></p>
<p>äº‹ä»¶ï¼š<strong>on_chat_model_stream</strong></p>
<p>è¡¨ç°ï¼šLLMæ­£åœ¨æ‰“å­—ï¼Œç”Ÿæˆé’ˆå¯¹ç”¨æˆ·çš„å›å¤ï¼Œæˆ–è€…åœ¨ç”ŸæˆJSONã€‚</p>
<hr/>
<ol start="2">
<li>Actingï¼ˆè¡ŒåŠ¨é˜¶æ®µ - MCPåœ¨æ­¤ï¼‰</li>
</ol>
<p>äº‹ä»¶ï¼š<strong>on_tool_start ğŸ”¨</strong></p>
<p>è¡¨ç°ï¼šAgentå†³å®šè°ƒç”¨å·¥å…·ã€‚</p>
<hr/>
<p><strong>3. Observingï¼ˆè§‚å¯Ÿé˜¶æ®µï¼‰</strong></p>
<p>äº‹ä»¶ï¼š<strong>on_tool_end âœ…ï¸</strong></p>
<p>è¡¨ç°ï¼šå·¥å…·æ‰§è¡Œå®Œæ¯•ï¼Œæ•°æ®è¿”å›ã€‚</p>
<hr/>
<p><strong>4. Respondingï¼ˆå“åº”é˜¶æ®µï¼‰</strong></p>
<p>äº‹ä»¶ï¼š<strong>on_chat_model_stream</strong></p>
<p>è¡¨ç°ï¼šLLMæ ¹æ®æŸ¥åˆ°çš„æ•°æ®ï¼Œæ•´ç†æˆæœ€ç»ˆç­”æ¡ˆåç»™ç”¨æˆ·ã€‚</p>
<hr/>
<p>é’ˆå¯¹è¿™å››ä¸ªé˜¶æ®µï¼Œæˆ‘ä»¬å¯ä»¥è‡ªä¸»é€‰æ‹©æƒ³è¦åœ¨æ§åˆ¶å°è¾“å‡ºçš„æ•°æ®ï¼Œè®©ç”¨æˆ·å¯ä»¥åˆ‡å®çš„æ„Ÿå—åˆ°ç°åœ¨Agentæ­£åœ¨å¹²ä»€ä¹ˆï¼Œè€Œä¸æ˜¯åªèƒ½åŸåœ°çŒœæµ‹ã€‚</p>
<h3 data-id="heading-37">3. ä»£ç å®æˆ˜ï¼šæ„å»ºé€šç”¨æµå¼è§‚æµ‹å™¨</h3>
<p>ä¸ºäº†è®©P6çš„ä¸»ç¨‹åºä¿æŒæ•´æ´ï¼Œæˆ‘ä»¬æŠŠè¿™å¥—å¤æ‚çš„ç›‘å¬é€»è¾‘å°è£…æˆä¸€ä¸ªç‹¬ç«‹çš„æ¨¡å— <strong>agent_stream.py</strong>ã€‚</p>
<p>è¿™ä¸ªæ–‡ä»¶<strong>å¯ä»¥è¢«ä»»ä½• LangGraph é¡¹ç›®ç›´æ¥å¥—ç”¨</strong>ï¼Œå®Œå…¨ä¸ä¾èµ– MCPã€‚</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># agent_stream.py</span>
<span class="hljs-keyword">import</span> asyncio
<span class="hljs-keyword">from</span> langchain_core.messages <span class="hljs-keyword">import</span> HumanMessage

<span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">run_agent_with_streaming</span>(<span class="hljs-params">app,query:<span class="hljs-built_in">str</span></span>):
    <span class="hljs-string">"""
    é€šç”¨æµå¼è¿è¡Œå™¨ï¼Œè´Ÿè´£å°† LangGraph çš„è¿è¡Œè¿‡ç¨‹å¯è§†åŒ–è¾“å‡ºåˆ°æ§åˆ¶å°

    :param app: ç¼–è¯‘å¥½çš„ LangGraph åº”ç”¨ (workflow.compile())
    :param query: ç”¨æˆ·è¾“å…¥çš„é—®é¢˜
    """</span>
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f'\nç”¨æˆ·:<span class="hljs-subst">{query}</span>\n'</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"ğŸ¤– AI:"</span>,end=<span class="hljs-string">""</span>,flush=<span class="hljs-literal">True</span>)

    <span class="hljs-comment"># æ„é€ è¾“å…¥æ¶ˆæ¯</span>
    inputs = {<span class="hljs-string">"messages"</span>:[HumanMessage(content=query)]}

    <span class="hljs-comment"># æ ¸å¿ƒ:ç›‘å¬v2ç‰ˆæœ¬çš„äº‹ä»¶æµ(ç›¸æ¯”v1æ›´å…¨é¢)</span>
    <span class="hljs-keyword">async</span> <span class="hljs-keyword">for</span> event <span class="hljs-keyword">in</span> app.astream_events(inputs,version=<span class="hljs-string">"v2"</span>):
        kind = event[<span class="hljs-string">"event"</span>]

        <span class="hljs-comment"># 1.ç›‘å¬LLMçš„æµå¼åå­—(å˜´åœ¨åŠ¨)</span>
        <span class="hljs-keyword">if</span> kind == <span class="hljs-string">"on_chat_model_stream"</span>:
            chunk = event[<span class="hljs-string">"data"</span>][<span class="hljs-string">"chunk"</span>]
            <span class="hljs-comment"># è¿‡æ»¤æ‰ç©ºçš„chunk(æœ‰æ—¶å·¥å…·è°ƒç”¨ä¼šäº§ç”Ÿç©ºå†…å®¹)</span>
            <span class="hljs-keyword">if</span> chunk.content:
                <span class="hljs-built_in">print</span>(chunk.content,end=<span class="hljs-string">""</span>,flush=<span class="hljs-literal">True</span>)

        <span class="hljs-comment"># 2.ç›‘å¬å·¥å…·å¼€å§‹è°ƒç”¨(æ‰‹åœ¨åŠ¨)</span>
        <span class="hljs-keyword">elif</span> kind == <span class="hljs-string">"on_tool_start"</span>:
            tool_name = event[<span class="hljs-string">"name"</span>]
            <span class="hljs-comment"># ä¸æ‰“å°å†…éƒ¨åŒ…è£…ï¼Œåªæ‰“å°è‡ªå®šä¹‰çš„å·¥å…·</span>
            <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> tool_name.startswith(<span class="hljs-string">"_"</span>):
                <span class="hljs-built_in">print</span>(<span class="hljs-string">f"\n\nğŸ”¨ æ­£åœ¨è°ƒç”¨å·¥å…·: <span class="hljs-subst">{tool_name}</span> ..."</span>)

        <span class="hljs-comment"># 3.ç›‘å¬å·¥å…·è°ƒç”¨ç»“æŸ(æ‹¿åˆ°ç»“æœ)</span>
        <span class="hljs-keyword">elif</span> kind == <span class="hljs-string">"on_tool_end"</span>:
            tool_name = event[<span class="hljs-string">"name"</span>]
            <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> tool_name.startswith(<span class="hljs-string">"_"</span>):
                <span class="hljs-built_in">print</span>(<span class="hljs-string">f"âœ… è°ƒç”¨å®Œæˆï¼Œç»§ç»­æ€è€ƒ...\n"</span>)
                <span class="hljs-built_in">print</span>(<span class="hljs-string">"ğŸ¤– AI: "</span>, end=<span class="hljs-string">""</span>, flush=<span class="hljs-literal">True</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"\n\nğŸ˜Š è¾“å‡ºç»“æŸ!"</span>)
</code></pre>
<p>å…³é”®è§£æï¼š</p>
<ol>
<li>
<p><strong>version="v2"</strong> ï¼šLangGraphçš„æµå¼APIæ›´è¿­éå¸¸å¿«ã€‚v2ç›®å‰æ˜¯æ›´æ¨èçš„äº‹ä»¶æµï¼Œè¿”å›äº‹ä»¶ç±»å‹ä¸ç‰¹æ€§æ›´ä¸ºå…¨é¢å¯æ§ã€‚</p>
</li>
<li>
<p><strong>flush=True</strong>ï¼špyçš„printé»˜è®¤æœ‰ç¼“å­˜ã€‚å¦‚æœä¸åŠ è¿™ä¸ªï¼Œå­—å¯èƒ½ä¼šä¸€å¨ä¸€å¨è€Œä¸æ˜¯ä¸€ä¸ªä¸€ä¸ªè¹¦å‡ºæ¥ã€‚</p>
</li>
<li>
<p><strong>äº‹ä»¶è¿‡æ»¤</strong>ï¼š</p>
</li>
</ol>
<ul>
<li>if/elif ... ï¼šapp.astream_events()ä¼šäº§ç”Ÿå„ç§äº‹ä»¶ï¼Œä½†æˆ‘ä»¬åªå…³å¿ƒæœ€é‡è¦çš„å‡ ä¸ªæ¯”å¦‚è°ƒç”¨å·¥å…·ä¸llmè¯´è¯ã€‚</li>
<li>if not tool_name.startwith("_")ï¼šLangGraphåœ¨å†…éƒ¨å¯èƒ½ä¼šè°ƒç”¨ä¸€äº›åŒ…è£…å™¨å·¥å…·ï¼Œå¦‚å†…éƒ¨å®ç°ç”¨_wrapã€_internalç­‰ï¼Œè¿™äº›å†…éƒ¨å·¥å…·æˆ‘ä»¬è‚¯å®šä¸å¸Œæœ›çœ‹åˆ°ã€‚</li>
</ul>
<p>æœ‰äº†è¿™ä¸ªå®Œæ•´æµå¼åï¼Œæ­¤æ—¶æˆ‘ä»¬çš„AgentçœŸæ­£æœ‰äº†<strong>è¿‡ç¨‹å¯è§æ€§</strong>ï¼Œè¿™æ˜¯AgentåŒºåˆ«äºä¼ ç»ŸChatæœ€å¤§çš„é­…åŠ›ï¼ŒåŒæ—¶ä¹Ÿæ˜¯ MCP å®¢æˆ·ç«¯å¿…éœ€çš„èƒ½åŠ›ã€‚</p>
<p>ä¸‹ä¸€ç« ï¼Œæˆ‘ä»¬å°†æ­£å¼æŠŠæ‰€æœ‰ç»„ä»¶å°è£…ä¸º<strong>å®Œæ•´é€šç”¨MCP Agent</strong>ã€‚</p>
<hr/>
<h2 data-id="heading-38">å…­ã€ç»ˆæå°è£…ï¼šæ„å»ºé€šç”¨MCP Agent</h2>
<p>å†ç»å‰é¢äº”ä¸ªç« èŠ‚çš„é“ºå«ï¼Œæˆ‘ä»¬ç»ˆäºæ¥åˆ°äº†æœ€åçš„ç»„è£…æ—¶åˆ»ã€‚</p>
<p>åœ¨æ­¤ä¹‹å‰ï¼Œæˆ‘ä»¬å·²ç»æ‰“é€ äº†ä¸‰ä¸ªæ ¸å¿ƒâ€œé›¶éƒ¨ä»¶â€ï¼š</p>
<ol>
<li><strong>åº•åº§ï¼ˆMCP æ¥å£å±‚ / å·¥å…·é€‚é…å±‚ï¼‰</strong><br/>
P4ï¼š<strong>mcp_client.py</strong>Â ã€<strong>mcp_bridge.py</strong>Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  å®ƒä»¬è´Ÿè´£ä¸ MCP æœåŠ¡å»ºç«‹å¼‚æ­¥è¿æ¥ï¼Œå¹¶å°† MCP å·¥å…·é€‚é…ä¸º LangChain å¯è°ƒç”¨çš„å½¢å¼ã€‚æ¯”å–»æ¥è¯´ï¼Œå®ƒæ˜¯ Agent çš„â€œ<strong>æ‰¿è½½å¹³å°</strong>â€ï¼Œä¿è¯æ‰€æœ‰å¤–éƒ¨å·¥å…·èƒ½å¤Ÿå¹³æ»‘æ¥å…¥ã€‚</li>
<li><strong>å¤©çœ¼ï¼ˆå…¨é“¾è·¯æµå¼è§‚æµ‹å™¨ / äº‹ä»¶æµç›‘å¬å™¨ï¼‰</strong><br/>
P5ï¼š <strong>agent_stream.py</strong><code> Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â </code>å®ƒç›‘å¬ LangGraph çš„äº‹ä»¶æµï¼Œå®ç°å…¨é“¾è·¯å¯è§†åŒ–è¾“å‡ºï¼Œè®©ç”¨æˆ·å¯ä»¥çœ‹åˆ° LLM çš„æ€è€ƒå’Œå·¥å…·è°ƒç”¨è¿‡ç¨‹ã€‚å½¢è±¡åœ°è¯´ï¼Œå®ƒå°±åƒ Agent çš„â€œ<strong>çœ¼ç›</strong>â€ï¼Œè®©æœ¬æ¥é»‘ç›’çš„å†³ç­–è¿‡ç¨‹é€æ˜å¯è§ã€‚</li>
<li><strong>å¤§è„‘ï¼ˆå³å°†ç»„è£…çš„æ ¸å¿ƒé€»è¾‘ï¼‰</strong><br/>
è¿™å°±æ˜¯æˆ‘ä»¬å³å°†ç¼–å†™çš„ <strong>mcp_main.py</strong>ã€‚å®ƒè´Ÿè´£æŠŠåº•åº§ä¸å¤©çœ¼ç»“åˆèµ·æ¥ï¼Œæ„å»ºä¸€ä¸ª<strong>ç”Ÿäº§çº§ã€å¯çƒ­æ’æ‹”ã€å…·å¤‡æµå¼åé¦ˆçš„é€šç”¨ Agent</strong>ã€‚ç»è¿‡ä¹‹å‰çš„è§£è€¦ä¸å°è£…ï¼Œæ­¤æ—¶çš„æ ¸å¿ƒé€»è¾‘å°†ä¼šéå¸¸æ¸…çˆ½ã€‚</li>
</ol>
<h3 data-id="heading-39">1. æ¶æ„æ€»è§ˆï¼šé«˜å†…èšï¼Œä½è€¦åˆ</h3>
<p>åœ¨å¼€å§‹å†™ä»£ç å‰ï¼Œæˆ‘ä»¬å…ˆçœ‹ä¸€çœ¼æœ€ç»ˆçš„å·¥ç¨‹ç»“æ„ã€‚è¿™ä¸ä»…æ˜¯ä¸€ä¸ª Demoï¼Œè€Œæ˜¯ä¸€ä¸ªæ ‡å‡†çš„ Python å·¥ç¨‹èŒƒå¼ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">m10_mcp_basics/
â”œâ”€â”€ mcp_client.py       <span class="hljs-comment"># (åº•å±‚) è´Ÿè´£ socket é€šä¿¡ä¸åè®®è§£æ</span>
â”œâ”€â”€ mcp_bridge.py       <span class="hljs-comment"># (é€‚é…å±‚) è´Ÿè´£å°† Schema è½¬ä¸º Pydantic æ¨¡å‹</span>
â”œâ”€â”€ agent_stream.py     <span class="hljs-comment"># (äº¤äº’å±‚) è´Ÿè´£æ§åˆ¶å°æµå¼è¾“å‡º</span>
â”œâ”€â”€ config.py           <span class="hljs-comment"># (é…ç½®å±‚) API Key ç®¡ç†</span>
â””â”€â”€ mcp_main.py         <span class="hljs-comment"># (ä¸šåŠ¡å±‚) æœ¬ç« ä¸»è§’ï¼Œè´Ÿè´£ç»„è£…ä¸è¿è¡Œ</span>
</code></pre>
<ul>
<li>å¦‚æœä½ æƒ³æ¢å…¶ä»–çš„ MCP å·¥å…·ï¼ˆå¦‚ SQLiteï¼‰ï¼Œåªæ”¹ <strong>é…ç½®å±‚</strong>ã€‚</li>
<li>å¦‚æœä½ æƒ³æŠŠæ§åˆ¶å°è¾“å‡ºæ¢æˆ Web ç•Œé¢ï¼Œåªæ”¹ <strong>äº¤äº’å±‚</strong>ã€‚</li>
<li>å¦‚æœä½ æƒ³æ›´æ”¹Â LangGraph çš„å›¾é€»è¾‘ï¼Œåªæ”¹ <strong>ä¸šåŠ¡å±‚</strong>ã€‚</li>
</ul>
<p>å„å¸å…¶èŒï¼Œäº’ä¸å¹²æ‰°ã€‚</p>
<h3 data-id="heading-40">2. ä»£ç å®ç°ï¼šç§¯æœ¨å¼æ‹¼è£…</h3>
<p>æ–°å»ºmcp_main.pyï¼Œæˆ‘ä»¬å°†åˆ†ä¸ºä¸‰ä¸ªæ­¥éª¤æ¥å®Œæˆå®‰è£…ã€‚</p>
<h4 data-id="heading-41">2.1 ç¬¬ä¸€æ­¥ï¼šåˆå§‹åŒ–é…ç½®</h4>
<p>Agent çš„è¡Œä¸ºç”±æ ¸å¿ƒé€»è¾‘æ§åˆ¶ï¼Œä½†å®ƒå¯ä»¥<strong>é€šè¿‡é…ç½®åˆ—è¡¨çµæ´»åŠ è½½å¤–éƒ¨æœåŠ¡æˆ–å·¥å…·</strong>ã€‚æˆ‘ä»¬éœ€è¦å®šä¹‰ä¸€ä¸ªé…ç½®åˆ—è¡¨ï¼Œè®© Agent çŸ¥é“åº”è¯¥è¿æ¥å“ªäº›æœåŠ¡ï¼Œä»¥åŠå¦‚ä½•è°ƒç”¨è¿™äº›æœåŠ¡ã€‚</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> os
<span class="hljs-keyword">import</span> sys
<span class="hljs-keyword">from</span> contextlib <span class="hljs-keyword">import</span> AsyncExitStack
<span class="hljs-keyword">import</span> asyncio

<span class="hljs-keyword">from</span> langchain_openai <span class="hljs-keyword">import</span> ChatOpenAI
<span class="hljs-keyword">from</span> langchain_core.messages <span class="hljs-keyword">import</span> HumanMessage,SystemMessage
<span class="hljs-keyword">from</span> langgraph.graph <span class="hljs-keyword">import</span> StateGraph,MessagesState,START,END
<span class="hljs-keyword">from</span> langgraph.prebuilt <span class="hljs-keyword">import</span> ToolNode

<span class="hljs-keyword">from</span> config <span class="hljs-keyword">import</span> OPENAI_API_KEY,AMAP_MAPS_API_KEY
<span class="hljs-keyword">from</span> m10_mcp_basics.agent_stream <span class="hljs-keyword">import</span> run_agent_with_streaming
<span class="hljs-keyword">from</span> m10_mcp_basics.mcp_client <span class="hljs-keyword">import</span> MCPClient
<span class="hljs-keyword">from</span> m10_mcp_basics.mcp_bridge <span class="hljs-keyword">import</span> LangChainMCPAdapter


<span class="hljs-comment"># ===ç¯å¢ƒé…ç½®===</span>
<span class="hljs-comment"># ç¯å¢ƒå…¼å®¹</span>
COMMAND = <span class="hljs-string">"npx.cmd"</span> <span class="hljs-keyword">if</span> sys.platform == <span class="hljs-string">"win32"</span> <span class="hljs-keyword">else</span> <span class="hljs-string">"npx"</span>
<span class="hljs-comment"># å¤åˆ¶å½“å‰pyè¿›ç¨‹çš„ç¯å¢ƒå˜é‡,å¹¶åœ¨å¤åˆ¶çš„ç¯å¢ƒå˜é‡é‡Œæ–°å¢ä¸€æ¡ï¼Œç¡®ä¿å®‰å…¨å¯æ§</span>
env_vars = os.environ.copy()
env_vars[<span class="hljs-string">"AMAP_MAPS_API_KEY"</span>] = AMAP_MAPS_API_KEY

MCP_SERVER_CONFIGS = [
    {
        <span class="hljs-string">"name"</span>:<span class="hljs-string">"é«˜å¾·åœ°å›¾"</span>, <span class="hljs-comment"># æ‰“å°ä½¿ç”¨äº†ä»€ä¹ˆMCPï¼Œå¯ç§»é™¤</span>
        <span class="hljs-string">"command"</span>:COMMAND,
        <span class="hljs-string">"args"</span>:[<span class="hljs-string">"-y"</span>, <span class="hljs-string">"@amap/amap-maps-mcp-server"</span>],
        <span class="hljs-string">"env"</span>:env_vars
    }
    <span class="hljs-comment"># {...}  ä¹‹åMCPå·¥å…·å¯éšéœ€æ±‚æ‰©å±•å¢åŠ </span>
]
</code></pre>
<h4 data-id="heading-42">2.2 ç¬¬äºŒæ­¥ï¼šæ„å»ºå¤§è„‘ï¼ˆGraphï¼‰</h4>
<p>è¿™é‡Œçš„é€»è¾‘éå¸¸çº¯ç²¹ã€‚build_graph å‡½æ•°æ ¹æœ¬ä¸çŸ¥é“ï¼ˆä¹Ÿä¸å…³å¿ƒï¼‰å·¥å…·æ˜¯ä»MCPæ¥çš„è¿˜æ˜¯æœ¬åœ°å†™çš„ã€‚å®ƒåªæ¥æ”¶ä¸€ä¸ª <strong>available_tools åˆ—è¡¨</strong>ï¼Œç„¶åæŠŠå®ƒä»¬ç»‘å®šåˆ° llm ä¸Šã€‚</p>
<p>åŒæ—¶å·¥å…·æ³¨å…¥ä¸å¦åªæ˜¯å¯é€‰é¡¹ï¼Œæ— å·¥å…·ä¹Ÿå¯è·‘åŠ¨ã€‚</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># ===æ„å»ºå›¾é€»è¾‘===</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">build_graph</span>(<span class="hljs-params">available_tools</span>):
    <span class="hljs-string">"""
    è¿™ä¸ªå‡½æ•°åªè®¤toolsåˆ—è¡¨ï¼Œä¸å…³å¿ƒtoolsçš„æ¥æº
    """</span>
    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> available_tools:
        <span class="hljs-built_in">print</span>(<span class="hljs-string">'âš ï¸ å½“å‰æ²¡æœ‰æ³¨å…¥ä»»ä½•å·¥å…·ï¼ŒAgentå°†ä»…é LLMå›ç­”ã€‚'</span>)
    llm = ChatOpenAI(
        model=<span class="hljs-string">"deepseek-chat"</span>,
        api_key=OPENAI_API_KEY,
        base_url=<span class="hljs-string">"https://api.deepseek.com"</span>,
        streaming=<span class="hljs-literal">True</span>
    )
    <span class="hljs-comment"># å¦‚æœæ²¡å·¥å…·ï¼Œbind_tools ä¼šè¢«å¿½ç•¥æˆ–å¤„ç†ï¼ŒLangGraphåŒæ ·èƒ½æ­£å¸¸è·‘çº¯å¯¹è¯</span>
    llm_with_tools = llm.bind_tools(available_tools) <span class="hljs-keyword">if</span> available_tools <span class="hljs-keyword">else</span> llm


    sys_prompt = <span class="hljs-string">"""
    ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„åœ°ç†ä½ç½®æœåŠ¡åŠ©æ‰‹ã€‚
    1. å½“ç”¨æˆ·æŸ¥è¯¢æ¨¡ç³Šåœ°ç‚¹ï¼ˆå¦‚"è¥¿ç«™"ï¼‰æ—¶ï¼Œä¼šä¼˜å…ˆä½¿ç”¨ç›¸å…³å·¥å…·è·å–å…·ä½“ç»çº¬åº¦æˆ–æ ‡å‡†åç§°ã€‚
    2. å¦‚æœç”¨æˆ·æŸ¥è¯¢"é™„è¿‘"çš„åº—é“ºï¼Œè¯·å…ˆç¡®å®šä¸­å¿ƒç‚¹çš„åæ ‡æˆ–å…·ä½“ä½ç½®ï¼Œå†è¿›è¡Œæœç´¢ã€‚
    3. è°ƒç”¨å·¥å…·æ—¶ï¼Œå‚æ•°è¦å°½å¯èƒ½ç²¾ç¡®ã€‚
    """</span>

    <span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">agent_node</span>(<span class="hljs-params">state:MessagesState</span>):
        messages = [SystemMessage(content=sys_prompt)] + state[<span class="hljs-string">"messages"</span>]
        <span class="hljs-comment"># ainvoke:å¼‚æ­¥è°ƒç”¨ç‰ˆçš„invoke</span>
        <span class="hljs-keyword">return</span> {<span class="hljs-string">"messages"</span>:[<span class="hljs-keyword">await</span> llm_with_tools.ainvoke(messages)]}

    workflow = StateGraph(MessagesState)
    workflow.add_node(<span class="hljs-string">"agent"</span>,agent_node)

    <span class="hljs-comment"># åŠ¨æ€é€»è¾‘ï¼šå¦‚æœæœ‰å·¥å…·æ‰åŠ å·¥å…·èŠ‚ç‚¹ï¼Œå¦åˆ™å°±æ˜¯çº¯å¯¹è¯</span>
    <span class="hljs-keyword">if</span> available_tools:
        tool_node = ToolNode(available_tools)
        workflow.add_node(<span class="hljs-string">"tools"</span>,tool_node)

        <span class="hljs-keyword">def</span> <span class="hljs-title function_">should_continue</span>(<span class="hljs-params">state:MessagesState</span>):
            last_msg = state[<span class="hljs-string">"messages"</span>][-<span class="hljs-number">1</span>]
            <span class="hljs-keyword">if</span> <span class="hljs-built_in">hasattr</span>(last_msg,<span class="hljs-string">"tool_calls"</span>) <span class="hljs-keyword">and</span> last_msg.tool_calls:
                <span class="hljs-keyword">return</span> <span class="hljs-string">"tools"</span>
            <span class="hljs-keyword">return</span> END

        workflow.add_edge(START,<span class="hljs-string">"agent"</span>)
        workflow.add_conditional_edges(<span class="hljs-string">"agent"</span>,should_continue,{<span class="hljs-string">"tools"</span>:<span class="hljs-string">"tools"</span>,END:END})
        workflow.add_edge(<span class="hljs-string">"tools"</span>,<span class="hljs-string">"agent"</span>)
    <span class="hljs-keyword">else</span>:
        workflow.add_edge(START,<span class="hljs-string">"agent"</span>)
        workflow.add_edge(<span class="hljs-string">"agent"</span>,END)

    <span class="hljs-keyword">return</span> workflow.<span class="hljs-built_in">compile</span>()
</code></pre>
<h4 data-id="heading-43">2.3 ç¬¬ä¸‰æ­¥ï¼šç”Ÿå‘½å‘¨æœŸç®¡ç†ä¸å¯åŠ¨</h4>
<p>è¿™æ˜¯æ•´ä¸ªç¨‹åºçš„<strong>å‘åŠ¨æœº</strong>ã€‚æˆ‘ä»¬ä½¿ç”¨ <strong>AsyncExitStack æ¥ç»Ÿä¸€ç®¡ç†æ‰€æœ‰çš„ MCP è¿æ¥çš„ç”Ÿå‘½å‘¨æœŸ</strong>ã€‚</p>
<p>æ³¨æ„çœ‹ load_mcp_tools å‡½æ•°ï¼Œå®ƒåˆ©ç”¨ <strong>stack.enter_async_context</strong> å®ç°äº†<strong>æ‰å¹³åŒ–çš„å¤šè¿æ¥ç®¡ç†</strong>ï¼š</p>
<p>æ— è®ºä½ é…ç½®äº†å¤šå°‘ä¸ªMCPæœåŠ¡ï¼Œä»£ç éƒ½<strong>ä¸éœ€è¦å¦‚ async with çš„åµŒå¥—ç¼©è¿›</strong>ã€‚</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># ===MCPå·¥å…·æ‰¹é‡åˆå§‹åŒ–===</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">load_mcp_tools</span>(<span class="hljs-params">stack:AsyncExitStack,configs:<span class="hljs-built_in">list</span></span>):
    <span class="hljs-string">"""
    è´Ÿè´£éå†é…ç½®ï¼Œæ‰¹é‡å»ºç«‹è¿æ¥ï¼Œæ”¶é›†æ‰€æœ‰å·¥å…·ã€‚
    ä½¿ç”¨stackå°†è¿æ¥ç”Ÿå‘½å‘¨æœŸæ‰˜ç®¡ç»™ä¸Šå±‚
    """</span>
    all_tools = []
    <span class="hljs-keyword">for</span> conf <span class="hljs-keyword">in</span> configs:
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f'ğŸ”Œ æ­£åœ¨è¿æ¥:<span class="hljs-subst">{conf[<span class="hljs-string">"name"</span>]}</span>...'</span>)
        <span class="hljs-comment"># åˆå§‹åŒ– Client</span>
        client = MCPClient(
            command=conf[<span class="hljs-string">"command"</span>],
            args=conf[<span class="hljs-string">"args"</span>],
            env=conf.get(<span class="hljs-string">"env"</span>) <span class="hljs-comment"># å¯é€‰å‚æ•°</span>
        )
        <span class="hljs-comment"># ğŸ”¥:enter_async_context æ›¿ä»£äº†async with ç¼©è¿›</span>
        <span class="hljs-comment"># è¿™æ ·æ— è®ºæœ‰å¤šå°‘ä¸ªMCPï¼Œä»£ç å±‚çº§éƒ½ä¸ä¼šå˜æ·±</span>
        adapter = <span class="hljs-keyword">await</span> stack.enter_async_context(LangChainMCPAdapter(client))
        <span class="hljs-comment"># æ‰¹é‡è·å–ä¸€ä¸ªMCPä¸‹çš„æ‰€æœ‰å·¥å…·</span>
        tools = <span class="hljs-keyword">await</span> adapter.get_tools()
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f'    âœ…ï¸ è·å–å·¥å…·<span class="hljs-subst">{[t.name <span class="hljs-keyword">for</span> t <span class="hljs-keyword">in</span> tools]}</span>'</span>)
        all_tools.extend(tools)

    <span class="hljs-keyword">return</span> all_tools

<span class="hljs-comment"># ===ä¸»ç¨‹åº===</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">main</span>():
    <span class="hljs-comment"># ä½¿ç”¨ExitStackç»Ÿä¸€ç®¡ç†æ‰€æœ‰èµ„æºçš„å…³é—­</span>
    <span class="hljs-keyword">async</span> <span class="hljs-keyword">with</span> AsyncExitStack() <span class="hljs-keyword">as</span> stack:
        <span class="hljs-comment"># A.æ’ä»¶(MCP)æ³¨å…¥é˜¶æ®µ -- å…è®¸ä¸ºç©º</span>
        dynamic_tools = <span class="hljs-keyword">await</span> load_mcp_tools(stack,MCP_SERVER_CONFIGS)
        <span class="hljs-comment"># B.å›¾æ„å»ºé˜¶æ®µ</span>
        app = build_graph(available_tools=dynamic_tools)
        <span class="hljs-comment"># C.è¿è¡Œé˜¶æ®µ(æµå¼)</span>
        query = <span class="hljs-string">"å¸®æˆ‘æŸ¥ä¸€ä¸‹æ­å·è¥¿æ¹–é™„è¿‘çš„é…’åº—"</span>
        <span class="hljs-keyword">await</span> run_agent_with_streaming(app,query)


<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">'__main__'</span>:
    asyncio.run(main())
</code></pre>
<h3 data-id="heading-44">3. è¿è¡Œæ•ˆæœ</h3>
<p>å½“ä½ è¿è¡Œ mcp_main.pyæ—¶ï¼Œä½ ä¼šçœ‹è§æ§åˆ¶å°è¾“å‡ºäº†æˆ‘ä»¬é¢„æƒ³çš„å®Œç¾äº¤äº’ï¼š</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4f55452d21c34e71b3d24ca63f6cf942~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YaN5Lya5ZGA:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765342707&amp;x-signature=rBDtrsRD2fQSpV2rkW1XGRYQD0c%3D" alt="" loading="lazy"/></p>
<p>è¿è¡ŒæˆåŠŸã€‚</p>
<hr/>
<h2 data-id="heading-45">æ€»ç»“ã€</h2>
<p>è‡³æ­¤ï¼Œæˆ‘ä»¬çš„ MCP å®¢æˆ·ç«¯åŸºç¡€ç¯‡æ­£å¼å®Œç»“ï¼Œè®©æˆ‘ä»¬å›é¡¾ä¸€ä¸‹è¿™æ®µæ—…ç¨‹ï¼š</p>
<p><strong>P1ï¼šç”¨GUIé¦–æ¬¡è¿é€šä¸€ä¸ªMCPæœåŠ¡å™¨</strong></p>
<p><strong>P2ï¼šè®²æ˜äº”å¤§å·¥ç¨‹åœ°åŸº</strong></p>
<p><strong>P3ï¼šå®ŒæˆMCPè¿é€šçš„æœ€å°å®ç°</strong></p>
<p><strong>P4ï¼šæ„å»ºClientä¸Bridgeï¼Œå®ç°åº•å±‚é“¾æ¥ä¸ Schema çš„è‡ªåŠ¨è½¬æ¢</strong></p>
<p><strong>P5ï¼šå¼•å…¥å…¨é“¾è·¯æµå¼ï¼Œè§£å†³äº† IO å»¶è¿Ÿå¸¦æ¥çš„ä½“éªŒé—®é¢˜</strong></p>
<p><strong>P6ï¼šå°†æ‰€æœ‰ç»„ä»¶ç»„è£…æˆäº†ä¸€ä¸ªé€šç”¨çš„ Agent æ¶æ„ã€‚</strong></p>
<p>ç°åœ¨ï¼Œä½ æ‰‹ä¸­ä¸ä»…ä»…æ˜¯ä¸€æ®µä»£ç ï¼Œè€Œæ˜¯<strong>ä¸€ä¸ªMCPé©±åŠ¨çš„Agentæ¡†æ¶</strong>ï¼Œé€šè¿‡ä¿®æ”¹ MCP_SERVER_CONFIGS ï¼Œä½ å¯ä»¥è®©Agentæ— ç¼æ¥å…¥æ•°æ®åº“ã€æ–‡ä»¶ç³»ç»Ÿã€åœ°å›¾æœåŠ¡ç­‰ï¼Œè½»æ¾æ‰©å±•ä½ çš„ Agent èƒ½åŠ›ã€‚</p>
<hr/>
<p><strong>é¢„å‘Š</strong>ï¼š11 ç¯‡ ã€Š<strong>MCP è¿›é˜¶ç¯‡</strong>ã€‹</p>
<p>Stdio è™½å¥½ï¼Œä½†åªèƒ½<strong>æœ¬åœ°å•æœº</strong>è¿è¡Œã€‚å¦‚æœæˆ‘æƒ³æ„å»ºä¸€ä¸ªç»™<strong>å…¨å›¢é˜Ÿä½¿ç”¨</strong>çš„å…±äº«å·¥å…·åº“ï¼Œæˆ–è€…æˆ‘çš„Agent<strong>éƒ¨ç½²åœ¨Vercel</strong>è¿™ç§æ— çŠ¶æ€äº‘ç¯å¢ƒâ€”â€”ä¹Ÿå°±æ˜¯æ¯æ¬¡è¯·æ±‚éƒ½æ˜¯å…¨æ–°å®ä¾‹ï¼Œæ— æ³•å¯åŠ¨å­è¿›ç¨‹â€”â€”å°±ä¼šé‡åˆ°é—®é¢˜ã€‚</p>
<p>ä¸‹ä¸€ç¯‡æˆ‘ä»¬å°†ä»â€œä½¿ç”¨è€…â€å‡çº§ä¸ºâ€œå¼€å‘è€…â€ï¼Œ<strong>å­¦ä¹ å¦‚ä½•æ„å»ºæ”¯æŒStreamable HTTPçš„ä¼ä¸šçº§ MCP Server</strong>ï¼Œå®ç°è·¨æœºå™¨ã€è·¨å›¢é˜Ÿçš„é€šç”¨ Agentã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[openEuleræ€§èƒ½æµ‹è¯•ï¼šå®‰å…¨ç‰¹æ€§æ·±åº¦è§£è¯»ä¸å®æ“æŒ‡å—]]></title>    <link>https://juejin.cn/post/7579256547797991465</link>    <guid>https://juejin.cn/post/7579256547797991465</guid>    <pubDate>2025-12-03T04:59:02.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7579256547797991465" data-draft-id="7579179625461907498" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="openEuleræ€§èƒ½æµ‹è¯•ï¼šå®‰å…¨ç‰¹æ€§æ·±åº¦è§£è¯»ä¸å®æ“æŒ‡å—"/> <meta itemprop="keywords" content="ç¨‹åºå‘˜"/> <meta itemprop="datePublished" content="2025-12-03T04:59:02.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="xcLeigh"/> <meta itemprop="url" content="https://juejin.cn/user/1775071503323875"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            openEuleræ€§èƒ½æµ‹è¯•ï¼šå®‰å…¨ç‰¹æ€§æ·±åº¦è§£è¯»ä¸å®æ“æŒ‡å—
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1775071503323875/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    xcLeigh
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-03T04:59:02.000Z" title="Wed Dec 03 2025 04:59:02 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-03
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»10åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>æœ¬æ–‡å›´ç»• openEuler æ“ä½œç³»ç»Ÿ â€œç³»ç»ŸåŸºçº¿ + è®¿é—®æ§åˆ¶ + æ¼æ´æ›´æ–° + æ—¥å¿—å®¡è®¡ + å®¹å™¨å®‰å…¨â€ äº”å¤§æ ¸å¿ƒå®‰å…¨ç»´åº¦ï¼Œå±•å¼€æ·±åº¦è§£è¯»ä¸å®æ“æŒ‡å¯¼ã€‚å…ˆä»‹ç»å…¶å®‰å…¨èƒ½åŠ›æ€»è§ˆï¼Œæ¶µç›–å†…æ ¸åŠ å›ºã€æƒé™ç®¡æ§ã€ä¾›åº”é“¾å®‰å…¨åŠäº‘åŸç”Ÿæ”¯æŒç­‰ä¼˜åŠ¿ï¼Œå†è¯¦ç»†ç»™å‡ºç¯å¢ƒç¡®è®¤çš„å®æ“ä»£ç ä¸è§£é‡Šï¼Œåç»­ä¾æ¬¡æä¾›ç³»ç»ŸåŸºçº¿é…ç½®ã€è®¿é—®æ§åˆ¶ã€æ¼æ´æ›´æ–°ã€æ—¥å¿—å®¡è®¡åŠå®¹å™¨å®‰å…¨çš„å…·ä½“æ‰§è¡Œå‘½ä»¤ã€ä»£ç è¯¦è§£å’Œæ“ä½œç›®çš„ï¼Œæ‰€æœ‰æ­¥éª¤å‡å¼ºè°ƒå¯å¤ç°æ€§ä¸æˆªå›¾è¦æ±‚ã€‚æ•´ä½“å†…å®¹èšç„¦å®ç”¨æ€§ï¼Œä¸ºç”¨æˆ·æä¾›ä»åŸºç¡€é…ç½®åˆ°è¿›é˜¶é˜²æŠ¤çš„å…¨æµç¨‹å®‰å…¨æ–¹æ¡ˆï¼ŒåŠ©åŠ›å¿«é€Ÿè½åœ° openEuler ç³»ç»Ÿå®‰å…¨é˜²æŠ¤æªæ–½ã€‚</p>
</blockquote>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e52f14b0e5eb423593f73d5307bcae53~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgeGNMZWlnaA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765342741&amp;x-signature=8RlY4cbMJQgsB0%2BCUXVT1uyfbWE%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-0">ä¸€ã€openEuler å®‰å…¨èƒ½åŠ›æ€»è§ˆ</h2>
<p>openEuler ä½œä¸ºå¼€æºæ“ä½œç³»ç»Ÿï¼Œå…¶å®‰å…¨èƒ½åŠ›è¦†ç›–ä»å†…æ ¸åˆ°äº‘åŸç”Ÿçš„å…¨åœºæ™¯ï¼Œæ ¸å¿ƒä¼˜åŠ¿é›†ä¸­åœ¨äº”å¤§æ–¹å‘ï¼Œä¸ºç³»ç»Ÿæä¾›å…¨é“¾è·¯å®‰å…¨é˜²æŠ¤ã€‚</p>
<h3 data-id="heading-1">1. å†…æ ¸/ç³»ç»ŸåŠ å›º</h3>
<ul>
<li>æŒç»­è¿½è¸ªå¹¶ä¿®å¤å…¬å¼€æ¼æ´ï¼ˆCVEï¼‰ï¼Œä¿éšœå†…æ ¸åº•å±‚å®‰å…¨ã€‚</li>
<li>é›†æˆ SELinux å¼ºåˆ¶è®¿é—®æ§åˆ¶æœºåˆ¶ï¼Œé€šè¿‡ç»†ç²’åº¦å®‰å…¨ç­–ç•¥é™åˆ¶è¿›ç¨‹æƒé™ï¼ŒæŠµå¾¡è¶Šæƒæ”»å‡»ã€‚</li>
</ul>
<h3 data-id="heading-2">2. è®¿é—®æ§åˆ¶ä¸æœ€å°æƒé™</h3>
<ul>
<li>ç»“åˆ SELinuxã€sudo åˆ†æƒç®¡ç†ã€æ–‡ä»¶ç³»ç»Ÿæƒé™ï¼ˆrwxï¼‰åŠç½‘ç»œç­–ç•¥ï¼Œæ„å»ºå¤šå±‚çº§è®¿é—®æ§åˆ¶ä½“ç³»ã€‚</li>
<li>éµå¾ªâ€œæœ€å°æƒé™åŸåˆ™â€ï¼Œä»…ä¸ºç”¨æˆ·å’Œè¿›ç¨‹åˆ†é…å¿…è¦æƒé™ï¼Œé™ä½æƒé™æ»¥ç”¨é£é™©ã€‚</li>
</ul>
<h3 data-id="heading-3">3. ä¾›åº”é“¾ä¸ç”Ÿæ€å®‰å…¨</h3>
<ul>
<li>å®˜æ–¹è½¯ä»¶æºä¸¥æ ¼ç®¡ç†ï¼Œæ‰€æœ‰è½¯ä»¶åŒ…æä¾›ç­¾åæ ¡éªŒæœºåˆ¶ï¼Œé˜²æ­¢æ¶æ„ç¯¡æ”¹ã€‚</li>
<li>æä¾›åŠæ—¶çš„ç³»ç»Ÿæ›´æ–°é€šé“ï¼Œç¡®ä¿å®‰å…¨è¡¥ä¸ã€åŠŸèƒ½ä¼˜åŒ–å¿«é€Ÿè½åœ°ã€‚</li>
</ul>
<h3 data-id="heading-4">4. äº‘åŸç”Ÿå®‰å…¨</h3>
<ul>
<li>åŸç”Ÿæ”¯æŒ iSuladã€containerd ç­‰ä¸»æµå®¹å™¨è¿è¡Œæ—¶ã€‚</li>
<li>ä¾æ‰˜å†…æ ¸çº§éš”ç¦»èƒ½åŠ›ï¼Œå¯¹å®¹å™¨èµ„æºã€ç½‘ç»œã€æ–‡ä»¶ç³»ç»Ÿè¿›è¡Œä¸¥æ ¼é™åˆ¶ï¼Œä¿éšœå®¹å™¨é—´å®‰å…¨éš”ç¦»ã€‚</li>
</ul>
<p>å‚è€ƒæ¥æºï¼šopenEuler å®˜ç½‘ï¼ˆ<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.openeuler.org%2F%25EF%25BC%2589%25E3%2580%2581openEuler" target="_blank" title="https://www.openeuler.org/%EF%BC%89%E3%80%81openEuler" ref="nofollow noopener noreferrer">www.openeuler.org/ï¼‰ã€openEuler</a> å®˜æ–¹æ–‡æ¡£ï¼ˆ<a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.openeuler.openatom.cn%2Fzh%2F%25EF%25BC%2589" target="_blank" title="https://docs.openeuler.openatom.cn/zh/%EF%BC%89" ref="nofollow noopener noreferrer">docs.openeuler.openatom.cn/zh/ï¼‰</a></p>
<hr/>
<h2 data-id="heading-5">äºŒã€ç¯å¢ƒç¡®è®¤ï¼ˆå®æ“æ­¥éª¤+ä»£ç è¯¦è§£ï¼‰</h2>
<p>åœ¨è¿›è¡Œå®‰å…¨é…ç½®å‰ï¼Œéœ€å…ˆç¡®è®¤å½“å‰ç³»ç»Ÿç¯å¢ƒï¼Œç¡®ä¿æ“ä½œä¸ç³»ç»Ÿç‰ˆæœ¬åŒ¹é…ï¼Œä»¥ä¸‹ä¸ºå®Œæ•´å®æ“æµç¨‹åŠä»£ç è§£é‡Šã€‚</p>
<h3 data-id="heading-6">1. æŸ¥çœ‹ç³»ç»Ÿç‰ˆæœ¬ä¿¡æ¯</h3>
<h4 data-id="heading-7">æ‰§è¡Œä»£ç </h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">cat</span> /etc/os-release
</code></pre>
<h4 data-id="heading-8">ä»£ç è§£é‡Š</h4>
<ul>
<li><code>cat</code> æ˜¯ Linux ç³»ç»Ÿä¸­ç”¨äºè¯»å–æ–‡ä»¶å†…å®¹çš„åŸºç¡€å‘½ä»¤ã€‚</li>
<li><code>/etc/os-release</code> æ˜¯ç³»ç»Ÿè‡ªå¸¦çš„ç‰ˆæœ¬ä¿¡æ¯é…ç½®æ–‡ä»¶ï¼ŒåŒ…å«æ“ä½œç³»ç»Ÿåç§°ã€ç‰ˆæœ¬å·ã€ID ç­‰æ ¸å¿ƒä¿¡æ¯ã€‚</li>
</ul>
<h4 data-id="heading-9">é¢„æœŸè¾“å‡ºä¸è¯´æ˜</h4>
<p>è¾“å‡ºå°†åŒ…å« <code>NAME="openEuler"</code>ã€<code>VERSION="xxx"</code>ï¼ˆå…·ä½“ç‰ˆæœ¬å·ï¼‰ç­‰å­—æ®µï¼Œç¡®è®¤å½“å‰ç³»ç»Ÿä¸º openEuler ç³»ç»Ÿï¼Œé¿å…å› æ“ä½œç³»ç»Ÿä¸åŒ¹é…å¯¼è‡´åç»­æ“ä½œå¤±è´¥ã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e1c70bf6a43445279f30df3cb78daebf~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgeGNMZWlnaA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765342741&amp;x-signature=vIFy3CcNal2WJgboZM1vYaQu05U%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-10">2. æŸ¥çœ‹å†…æ ¸ç‰ˆæœ¬ä¿¡æ¯</h3>
<h4 data-id="heading-11">æ‰§è¡Œä»£ç </h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">uname</span> -a
</code></pre>
<h4 data-id="heading-12">ä»£ç è§£é‡Š</h4>
<ul>
<li><code>uname</code> å‘½ä»¤ç”¨äºæŸ¥è¯¢ç³»ç»Ÿå†…æ ¸ç›¸å…³ä¿¡æ¯ã€‚</li>
<li>å‚æ•° <code>-a</code> è¡¨ç¤ºâ€œæ˜¾ç¤ºæ‰€æœ‰ä¿¡æ¯â€ï¼ŒåŒ…æ‹¬å†…æ ¸ç‰ˆæœ¬ã€ä¸»æœºåã€ç¡¬ä»¶æ¶æ„ã€ç¼–è¯‘æ—¶é—´ç­‰ã€‚</li>
</ul>
<h4 data-id="heading-13">é¢„æœŸè¾“å‡ºä¸è¯´æ˜</h4>
<p>è¾“å‡ºä¸­ä¼šæ˜ç¡®æ˜¾ç¤ºå†…æ ¸ç‰ˆæœ¬å·ï¼ˆå¦‚ <code>5.10.0-xxx.openeuler20.03.x86_64</code>ï¼‰ï¼Œå†…æ ¸ç‰ˆæœ¬ç›´æ¥å½±å“éƒ¨åˆ†å®‰å…¨ç‰¹æ€§çš„æ”¯æŒæƒ…å†µï¼ˆå¦‚ SELinux é«˜çº§åŠŸèƒ½ã€å®¹å™¨éš”ç¦»èƒ½åŠ›ï¼‰ã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/45efa8286eb04ea4b29245d8ecfdaae5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgeGNMZWlnaA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765342741&amp;x-signature=ugC6AheWMvjIHXVQ8Jqb1ntjihM%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-14">3. æŸ¥çœ‹ SELinux è¿è¡ŒçŠ¶æ€</h3>
<h4 data-id="heading-15">æ‰§è¡Œä»£ç </h4>
<pre><code class="hljs language-arduino" lang="arduino">sestatus || <span class="hljs-literal">true</span>
</code></pre>
<h4 data-id="heading-16">ä»£ç è§£é‡Š</h4>
<ul>
<li><code>sestatus</code> æ˜¯ä¸“é—¨ç”¨äºæŸ¥è¯¢ SELinux çŠ¶æ€çš„å‘½ä»¤ï¼Œè¾“å‡ºåŒ…æ‹¬ SELinux æ˜¯å¦å¯ç”¨ã€è¿è¡Œæ¨¡å¼ï¼ˆ enforcing/permissive/disabled ï¼‰ç­‰ã€‚</li>
<li><code>|| true</code> è¡¨ç¤ºè‹¥ <code>sestatus</code> å‘½ä»¤æ‰§è¡Œå¤±è´¥ï¼ˆå¦‚ç³»ç»Ÿæœªå®‰è£… SELinux ç›¸å…³ç»„ä»¶ï¼‰ï¼Œåˆ™è¿”å›â€œtrueâ€ï¼Œé¿å…ç»ˆç«¯æ˜¾ç¤ºæŠ¥é”™ä¿¡æ¯ï¼Œä¿è¯å‘½ä»¤æ‰§è¡Œæµç¨‹ä¸ä¸­æ–­ã€‚</li>
</ul>
<h4 data-id="heading-17">é¢„æœŸè¾“å‡ºä¸è¯´æ˜</h4>
<ul>
<li>è‹¥è¾“å‡º <code>SELinux status: enabled</code>ï¼Œè¯´æ˜ SELinux å·²å¯ç”¨ï¼Œå¯ç›´æ¥è¿›è¡Œåç»­ç­–ç•¥é…ç½®ã€‚</li>
<li>è‹¥è¾“å‡º <code>SELinux status: disabled</code>ï¼Œè¯´æ˜ SELinux æœªå¯ç”¨ï¼Œéœ€å…ˆå®Œæˆå¯ç”¨é…ç½®å†æ¨è¿›ã€‚</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1d98d52ff9db41a6aa713c86644d9283~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgeGNMZWlnaA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765342741&amp;x-signature=jFIdhxwkwxcfqqO%2FBh2eaHXyIFs%3D" alt="" loading="lazy"/></p>
<hr/>
<h2 data-id="heading-18">ä¸‰ã€ç³»ç»ŸåŸºçº¿å®‰å…¨é…ç½®ï¼ˆå®æ“+è¯¦è§£ï¼‰</h2>
<p>ç³»ç»ŸåŸºçº¿æ˜¯å®‰å…¨é˜²æŠ¤çš„åŸºç¡€ï¼Œé€šè¿‡é…ç½®æ–‡ä»¶ä¼˜åŒ–ã€æœåŠ¡ç®¡ç†ç­‰æ“ä½œï¼Œå‡å°‘é»˜è®¤å®‰å…¨éšæ‚£ã€‚</p>
<h3 data-id="heading-19">1. ç¦ç”¨æ— ç”¨ç³»ç»ŸæœåŠ¡</h3>
<h4 data-id="heading-20">æ‰§è¡Œä»£ç </h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># æŸ¥çœ‹å½“å‰è¿è¡Œçš„ç³»ç»ŸæœåŠ¡</span>
systemctl list-unit-files --<span class="hljs-built_in">type</span>=service --state=enabled
<span class="hljs-comment"># ç¦ç”¨æ— ç”¨æœåŠ¡ï¼ˆä»¥ avahi-daemon ä¸ºä¾‹ï¼Œæ ¹æ®å®é™…æƒ…å†µè°ƒæ•´ï¼‰</span>
systemctl <span class="hljs-built_in">disable</span> --now avahi-daemon
</code></pre>
<h4 data-id="heading-21">ä»£ç è§£é‡Š</h4>
<ul>
<li><code>systemctl list-unit-files</code> ç”¨äºåˆ—å‡ºç³»ç»Ÿæ‰€æœ‰æœåŠ¡é…ç½®æ–‡ä»¶ï¼Œ<code>--type=service</code> é™å®šä»…æ˜¾ç¤ºæœåŠ¡ç±»æ–‡ä»¶ï¼Œ<code>--state=enabled</code> ä»…ç­›é€‰å·²å¯ç”¨çš„æœåŠ¡ã€‚</li>
<li><code>systemctl disable --now</code> è¡¨ç¤ºâ€œç«‹å³ç¦ç”¨å¹¶åœæ­¢æœåŠ¡â€ï¼Œ<code>disable</code> æ˜¯æ°¸ä¹…ç¦ç”¨ï¼ˆå¼€æœºä¸è‡ªåŠ¨å¯åŠ¨ï¼‰ï¼Œ<code>--now</code> æ˜¯ç«‹å³åœæ­¢å½“å‰è¿è¡Œçš„æœåŠ¡ã€‚</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bc2bbeb339764d849cbe662307fae37a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgeGNMZWlnaA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765342741&amp;x-signature=ch9zS0RdikT1n2IpGnmcSPHOtVU%3D" alt="" loading="lazy"/></p>
<h4 data-id="heading-22">æ“ä½œç›®çš„</h4>
<p>ç¦ç”¨æ‰“å°æœºæœåŠ¡ã€æ–‡ä»¶å…±äº«æœåŠ¡ç­‰éå¿…éœ€æœåŠ¡ï¼Œå‡å°‘ç³»ç»Ÿæš´éœ²é¢ï¼Œé™ä½è¢«æ”»å‡»é£é™©ã€‚</p>
<h3 data-id="heading-23">2. ä¼˜åŒ–æ–‡ä»¶ç³»ç»Ÿæƒé™</h3>
<h4 data-id="heading-24">æ‰§è¡Œä»£ç </h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># é™åˆ¶ /etc ç›®å½•æƒé™ï¼ˆä»… root å¯ä¿®æ”¹ï¼‰</span>
<span class="hljs-built_in">chmod</span> -R 755 /etc
<span class="hljs-comment"># ç¦æ­¢æ™®é€šç”¨æˆ·æŸ¥çœ‹ /etc/shadowï¼ˆå¯†ç æ–‡ä»¶ï¼‰</span>
<span class="hljs-built_in">chmod</span> 000 /etc/shadow
</code></pre>
<h4 data-id="heading-25">ä»£ç è§£é‡Š</h4>
<ul>
<li><code>chmod -R 755 /etc</code> ä¸­ï¼Œ<code>-R</code> è¡¨ç¤ºé€’å½’åº”ç”¨æƒé™ï¼ˆåŒ…æ‹¬å­ç›®å½•å’Œæ–‡ä»¶ï¼‰ï¼Œ<code>755</code> è¡¨ç¤ºæ‰€æœ‰è€…ï¼ˆrootï¼‰æœ‰è¯»/å†™/æ‰§è¡Œæƒé™ï¼Œå…¶ä»–ç”¨æˆ·ä»…æœ‰è¯»/æ‰§è¡Œæƒé™ã€‚</li>
<li><code>chmod 000 /etc/shadow</code> è¡¨ç¤ºæ‰€æœ‰ç”¨æˆ·å‡æ— è¯»/å†™/æ‰§è¡Œæƒé™ï¼Œ<code>/etc/shadow</code> å­˜å‚¨ç”¨æˆ·åŠ å¯†å¯†ç ï¼Œä¸¥æ ¼é™åˆ¶è®¿é—®å¯é˜²æ­¢å¯†ç æ³„éœ²ã€‚</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5fcf41a6594b41b997e9a45402b4335d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgeGNMZWlnaA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765342741&amp;x-signature=qhGiF3%2BiyXxR09LN5ZfLerhbxyw%3D" alt="" loading="lazy"/></p>
<hr/>
<h2 data-id="heading-26">å››ã€è®¿é—®æ§åˆ¶é…ç½®ï¼ˆå®æ“+è¯¦è§£ï¼‰</h2>
<p>åŸºäºæœ€å°æƒé™åŸåˆ™ï¼Œé€šè¿‡ sudo åˆ†æƒã€æ–‡ä»¶æƒé™éš”ç¦»ç­‰æ–¹å¼ï¼Œç®¡æ§ç”¨æˆ·è®¿é—®è¡Œä¸ºã€‚</p>
<h3 data-id="heading-27">1. é…ç½® sudo åˆ†æƒï¼ˆé™åˆ¶æ™®é€šç”¨æˆ·æƒé™ï¼‰</h3>
<h4 data-id="heading-28">æ‰§è¡Œä»£ç </h4>
<pre><code class="hljs language-ruby" lang="ruby"><span class="hljs-comment"># ç¼–è¾‘ sudo é…ç½®æ–‡ä»¶</span>
visudo
<span class="hljs-comment"># åœ¨æ–‡ä»¶ä¸­æ·»åŠ å¦‚ä¸‹é…ç½®ï¼ˆæ›¿æ¢ username ä¸ºå®é™…æ™®é€šç”¨æˆ·åï¼‰</span>
username <span class="hljs-variable constant_">ALL</span>=(<span class="hljs-variable constant_">ALL</span>) <span class="hljs-variable constant_">NOPASSWD</span>: <span class="hljs-regexp">/usr/bin</span><span class="hljs-regexp">/systemctl restart nginx, /usr</span><span class="hljs-regexp">/bin/ls</span>
</code></pre>
<h4 data-id="heading-29">ä»£ç è§£é‡Š</h4>
<ul>
<li><code>visudo</code> æ˜¯ç¼–è¾‘ sudo é…ç½®æ–‡ä»¶ï¼ˆ/etc/sudoersï¼‰çš„ä¸“ç”¨å‘½ä»¤ï¼Œä¼šè‡ªåŠ¨æ ¡éªŒè¯­æ³•ï¼Œé¿å…é…ç½®é”™è¯¯å¯¼è‡´ sudo å¤±æ•ˆã€‚</li>
<li>é…ç½®é¡¹ <code>username ALL=(ALL) NOPASSWD: å‘½ä»¤1, å‘½ä»¤2</code> è¡¨ç¤ºï¼šæ™®é€šç”¨æˆ· username å¯åœ¨æ‰€æœ‰ä¸»æœºä¸Šï¼Œä»¥æ‰€æœ‰ç”¨æˆ·èº«ä»½æ‰§è¡ŒæŒ‡å®šå‘½ä»¤ï¼Œä¸”æ— éœ€è¾“å…¥å¯†ç ã€‚</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5258bb7a66fb4718ae31cd85d8f4b57c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgeGNMZWlnaA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765342741&amp;x-signature=MbRPqMDI1yWCSyoQKGUxhZOsAvw%3D" alt="" loading="lazy"/></p>
<h4 data-id="heading-30">æ“ä½œç›®çš„</h4>
<p>é¿å…æ™®é€šç”¨æˆ·è·å–å®Œæ•´ root æƒé™ï¼Œä»…å¼€æ”¾å¿…è¦æ“ä½œæƒé™ï¼Œé™ä½è¯¯æ“ä½œæˆ–æ¶æ„æ“ä½œçš„å½±å“ã€‚</p>
<h3 data-id="heading-31">2. é…ç½®æ–‡ä»¶ç‰¹æ®Šæƒé™ï¼ˆé˜²æ­¢è¶Šæƒè®¿é—®ï¼‰</h3>
<h4 data-id="heading-32">æ‰§è¡Œä»£ç </h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># ä¸ºæ•æ„Ÿæ–‡ä»¶æ·»åŠ  immutable æƒé™ï¼ˆä»… root å¯ä¿®æ”¹ï¼‰</span>
chattr +i /etc/passwd
chattr +i /etc/group
</code></pre>
<h4 data-id="heading-33">ä»£ç è§£é‡Š</h4>
<ul>
<li><code>chattr</code> ç”¨äºä¿®æ”¹æ–‡ä»¶çš„æ‰©å±•å±æ€§ï¼Œ<code>+i</code> è¡¨ç¤ºæ·»åŠ â€œä¸å¯ä¿®æ”¹â€å±æ€§ã€‚</li>
<li><code>/etc/passwd</code>ï¼ˆç”¨æˆ·è´¦æˆ·æ–‡ä»¶ï¼‰å’Œ <code>/etc/group</code>ï¼ˆç”¨æˆ·ç»„æ–‡ä»¶ï¼‰æ·»åŠ è¯¥å±æ€§åï¼Œå³ä½¿æ˜¯ root ç”¨æˆ·ï¼Œä¹Ÿéœ€å…ˆç§»é™¤ <code>i</code> å±æ€§æ‰èƒ½ä¿®æ”¹ï¼Œé˜²æ­¢æ–‡ä»¶è¢«æ¶æ„ç¯¡æ”¹ã€‚</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fb77f6403dcd4b78813e6abf49b4ee20~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgeGNMZWlnaA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765342741&amp;x-signature=iH2d6ubdu4f76%2BfqBCkHzSZnNTI%3D" alt="" loading="lazy"/></p>
<hr/>
<h2 data-id="heading-34">äº”ã€æ¼æ´æ›´æ–°é…ç½®ï¼ˆå®æ“+è¯¦è§£ï¼‰</h2>
<p>åŠæ—¶æ›´æ–°ç³»ç»Ÿè¡¥ä¸å’Œè½¯ä»¶åŒ…ï¼Œä¿®å¤å·²çŸ¥å®‰å…¨æ¼æ´ï¼Œæ˜¯å®‰å…¨é˜²æŠ¤çš„å…³é”®ç¯èŠ‚ã€‚</p>
<h3 data-id="heading-35">1. é…ç½®å®˜æ–¹è½¯ä»¶æºï¼ˆç¡®ä¿æ›´æ–°æºå®‰å…¨ï¼‰</h3>
<h4 data-id="heading-36">æ‰§è¡Œä»£ç </h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># å¤‡ä»½åŸæœ‰æºé…ç½®æ–‡ä»¶</span>
<span class="hljs-built_in">cp</span> /etc/yum.repos.d/openEuler.repo /etc/yum.repos.d/openEuler.repo.bak
<span class="hljs-comment"># ç¼–è¾‘æºé…ç½®æ–‡ä»¶ï¼ˆä½¿ç”¨å®˜æ–¹æºï¼‰</span>
vi /etc/yum.repos.d/openEuler.repo
</code></pre>
<h4 data-id="heading-37">ä»£ç è§£é‡Š</h4>
<ul>
<li><code>cp</code> å‘½ä»¤ç”¨äºå¤‡ä»½åŸæœ‰æºé…ç½®ï¼Œé¿å…é…ç½®é”™è¯¯åæ— æ³•æ¢å¤ã€‚</li>
<li><code>vi</code> æ˜¯ Linux è‡ªå¸¦çš„æ–‡æœ¬ç¼–è¾‘å™¨ï¼Œç”¨äºä¿®æ”¹æºé…ç½®æ–‡ä»¶ï¼Œç¡®ä¿ä»…ä½¿ç”¨ openEuler å®˜æ–¹æºï¼Œé¿å…ç¬¬ä¸‰æ–¹æºå¸¦æ¥çš„å®‰å…¨é£é™©ã€‚</li>
</ul>
<h4 data-id="heading-38">é…ç½®æ–‡ä»¶æ ¸å¿ƒå†…å®¹</h4>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-section">[openEuler-os]</span>
<span class="hljs-attr">name</span>=openEuler OS
<span class="hljs-attr">baseurl</span>=https://repo.openeuler.org/openEuler-<span class="hljs-number">22.03</span>-LTS/OS/<span class="hljs-variable">$basearch</span>/
<span class="hljs-attr">enabled</span>=<span class="hljs-number">1</span>
<span class="hljs-attr">gpgcheck</span>=<span class="hljs-number">1</span>
<span class="hljs-attr">gpgkey</span>=https://repo.openeuler.org/openEuler-<span class="hljs-number">22.03</span>-LTS/OS/<span class="hljs-variable">$basearch</span>/RPM-GPG-KEY-openEuler
</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9b68ee08e1204111b4b5271cec3141b2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgeGNMZWlnaA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765342741&amp;x-signature=7FS0oQzXtlIMF4jSC3DDhQVwxdA%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-39">2. ä¸€é”®æ›´æ–°ç³»ç»Ÿæ¼æ´è¡¥ä¸</h3>
<h4 data-id="heading-40">æ‰§è¡Œä»£ç </h4>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># æ¸…ç† yum ç¼“å­˜</span>
yum clean <span class="hljs-built_in">all</span>
<span class="hljs-comment"># ç”Ÿæˆç¼“å­˜å¹¶æ›´æ–°æ‰€æœ‰è½¯ä»¶åŒ…</span>
yum makecache &amp;&amp; yum update -y
</code></pre>
<h4 data-id="heading-41">ä»£ç è§£é‡Š</h4>
<ul>
<li><code>yum clean all</code> æ¸…ç†æœ¬åœ°ç¼“å­˜çš„è½¯ä»¶åŒ…ä¿¡æ¯ï¼Œé¿å…æ—§ç¼“å­˜å¯¼è‡´æ›´æ–°å¤±è´¥ã€‚</li>
<li><code>yum makecache</code> é‡æ–°ç”Ÿæˆè½¯ä»¶åŒ…ç¼“å­˜ï¼Œæé«˜æ›´æ–°é€Ÿåº¦ï¼›<code>yum update -y</code> è‡ªåŠ¨æ›´æ–°æ‰€æœ‰å¯æ›´æ–°çš„è½¯ä»¶åŒ…ï¼ˆåŒ…æ‹¬å†…æ ¸è¡¥ä¸ã€å®‰å…¨ä¿®å¤åŒ…ï¼‰ï¼Œ<code>-y</code> è¡¨ç¤ºè‡ªåŠ¨ç¡®è®¤æ‰€æœ‰æ“ä½œï¼Œæ— éœ€æ‰‹åŠ¨è¾“å…¥â€œyâ€ã€‚</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/eb20f38107a74151b8a8ffa4d9864436~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgeGNMZWlnaA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765342741&amp;x-signature=l4x03Cd%2B%2FKE16EzfO%2BwNF0veC3Q%3D" alt="" loading="lazy"/></p>
<hr/>
<h2 data-id="heading-42">å…­ã€æ—¥å¿—å®¡è®¡é…ç½®ï¼ˆå®æ“+è¯¦è§£ï¼‰</h2>
<p>é€šè¿‡é…ç½®æ—¥å¿—æ”¶é›†ã€å­˜å‚¨å’Œåˆ†æï¼Œå®ç°å®‰å…¨äº‹ä»¶å¯è¿½æº¯ï¼Œä¾¿äºåŠæ—¶å‘ç°å¼‚å¸¸è¡Œä¸ºã€‚</p>
<h3 data-id="heading-43">1. é…ç½® rsyslog æ—¥å¿—æœåŠ¡ï¼ˆæ”¶é›†ç³»ç»Ÿæ—¥å¿—ï¼‰</h3>
<h4 data-id="heading-44">æ‰§è¡Œä»£ç </h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># å¯ç”¨å¹¶å¯åŠ¨ rsyslog æœåŠ¡</span>
systemctl <span class="hljs-built_in">enable</span> --now rsyslog
<span class="hljs-comment"># ç¼–è¾‘æ—¥å¿—é…ç½®æ–‡ä»¶ï¼ŒæŒ‡å®šæ—¥å¿—å­˜å‚¨è·¯å¾„</span>
vi /etc/rsyslog.conf
</code></pre>
<h4 data-id="heading-45">ä»£ç è§£é‡Š</h4>
<ul>
<li><code>rsyslog</code> æ˜¯ Linux ç³»ç»Ÿé»˜è®¤çš„æ—¥å¿—æ”¶é›†æœåŠ¡ï¼Œæ”¯æŒå°†ç³»ç»Ÿæ—¥å¿—ã€åº”ç”¨æ—¥å¿—ç»Ÿä¸€æ”¶é›†å­˜å‚¨ã€‚</li>
<li>ç¼–è¾‘ <code>/etc/rsyslog.conf</code> å¯è‡ªå®šä¹‰æ—¥å¿—å­˜å‚¨è§„åˆ™ï¼Œä¾‹å¦‚å°†å®‰å…¨ç›¸å…³æ—¥å¿—ï¼ˆauth.logï¼‰å•ç‹¬å­˜å‚¨åˆ°æŒ‡å®šç›®å½•ã€‚</li>
</ul>
<h4 data-id="heading-46">å…³é”®é…ç½®ç¤ºä¾‹ï¼ˆæ·»åŠ åˆ°é…ç½®æ–‡ä»¶æœ«å°¾ï¼‰</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># å®‰å…¨æ—¥å¿—å•ç‹¬å­˜å‚¨</span>
auth.* /var/log/security.log
<span class="hljs-comment"># æ—¥å¿—è½®è½¬ï¼ˆé¿å…æ—¥å¿—æ–‡ä»¶è¿‡å¤§ï¼‰</span>
<span class="hljs-variable">$ModLoad</span> imrotate
<span class="hljs-variable">$RotateConfigFile</span> /etc/rsyslog.d/rotate.conf
</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/becbe99572d44201a9311e63e0014d0c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgeGNMZWlnaA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765342741&amp;x-signature=6uw5aXXCp3m2LiWs%2FUPCXSb7Kj8%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-47">2. é…ç½®æ—¥å¿—è½®è½¬ï¼ˆç®¡ç†æ—¥å¿—æ–‡ä»¶å¤§å°ï¼‰</h3>
<h4 data-id="heading-48">æ‰§è¡Œä»£ç </h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># ç¼–è¾‘æ—¥å¿—è½®è½¬é…ç½®æ–‡ä»¶</span>
vi /etc/logrotate.d/rsyslog
</code></pre>
<h4 data-id="heading-49">ä»£ç è§£é‡Š</h4>
<ul>
<li><code>logrotate</code> ç”¨äºè‡ªåŠ¨åˆ‡å‰²ã€å‹ç¼©æ—¥å¿—æ–‡ä»¶ï¼Œé˜²æ­¢å•ä¸ªæ—¥å¿—æ–‡ä»¶è¿‡å¤§å ç”¨ç£ç›˜ç©ºé—´ã€‚</li>
<li><code>/etc/logrotate.d/rsyslog</code> æ˜¯ rsyslog æœåŠ¡çš„æ—¥å¿—è½®è½¬é…ç½®æ–‡ä»¶ï¼Œå¯è®¾ç½®è½®è½¬å‘¨æœŸã€ä¿ç•™å¤©æ•°ã€å‹ç¼©æ–¹å¼ç­‰ã€‚</li>
</ul>
<h4 data-id="heading-50">å…³é”®é…ç½®ç¤ºä¾‹</h4>
<pre><code class="hljs language-bash" lang="bash">/var/log/security.log {
    daily        <span class="hljs-comment"># æ¯æ—¥è½®è½¬ä¸€æ¬¡</span>
    rotate 7     <span class="hljs-comment"># ä¿ç•™ 7 å¤©çš„æ—¥å¿—</span>
    compress     <span class="hljs-comment"># å‹ç¼©æ—§æ—¥å¿—</span>
    missingok    <span class="hljs-comment"># æ—¥å¿—æ–‡ä»¶ä¸å­˜åœ¨æ—¶ä¸æŠ¥é”™</span>
}
</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c32f47696c92421b95e3d09751983efa~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgeGNMZWlnaA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765342741&amp;x-signature=Gv6C00NRP5qSMynZyVPNlm4JtcI%3D" alt="" loading="lazy"/></p>
<hr/>
<h2 data-id="heading-51">ä¸ƒã€å®¹å™¨å®‰å…¨é…ç½®ï¼ˆå®æ“+è¯¦è§£ï¼‰</h2>
<p>é’ˆå¯¹äº‘åŸç”Ÿåœºæ™¯ï¼Œé€šè¿‡å®¹å™¨è¿è¡Œæ—¶é…ç½®ã€èµ„æºé™åˆ¶ç­‰ï¼Œä¿éšœå®¹å™¨éƒ¨ç½²å®‰å…¨ã€‚</p>
<h3 data-id="heading-52">1. å®‰è£…å¹¶é…ç½® iSulad å®¹å™¨è¿è¡Œæ—¶</h3>
<h4 data-id="heading-53">æ‰§è¡Œä»£ç </h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># å®‰è£… iSulad</span>
yum install -y iSulad
<span class="hljs-comment"># å¯åŠ¨å¹¶è®¾ç½®å¼€æœºè‡ªå¯</span>
systemctl <span class="hljs-built_in">enable</span> --now isulad
<span class="hljs-comment"># é…ç½®å®¹å™¨é•œåƒæºï¼ˆä½¿ç”¨å®˜æ–¹æºï¼‰</span>
vi /etc/isulad/daemon.json
</code></pre>
<h4 data-id="heading-54">ä»£ç è§£é‡Š</h4>
<ul>
<li><code>yum install -y iSulad</code> ä»å®˜æ–¹æºå®‰è£… iSulad å®¹å™¨è¿è¡Œæ—¶ï¼Œ<code>-y</code> è‡ªåŠ¨ç¡®è®¤å®‰è£…ã€‚</li>
<li><code>systemctl enable --now isulad</code> å¯åŠ¨æœåŠ¡å¹¶è®¾ç½®å¼€æœºè‡ªå¯ï¼Œç¡®ä¿å®¹å™¨æœåŠ¡æŒç»­å¯ç”¨ã€‚</li>
<li><code>/etc/isulad/daemon.json</code> æ˜¯ iSulad çš„æ ¸å¿ƒé…ç½®æ–‡ä»¶ï¼Œå¯é…ç½®é•œåƒæºã€å®¹å™¨ç½‘ç»œã€èµ„æºé™åˆ¶ç­‰ã€‚</li>
</ul>
<h4 data-id="heading-55">å…³é”®é…ç½®ç¤ºä¾‹ï¼ˆé•œåƒæºé…ç½®ï¼‰</h4>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"registry-mirrors"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"https://repo.openeuler.org/dockerhub/"</span><span class="hljs-punctuation">]</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/54c68c426a7a4b9fb16757106916048a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgeGNMZWlnaA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765342741&amp;x-signature=5K5lWl%2FOYL8zwvqa1EnKnlacIjo%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-56">2. å®¹å™¨èµ„æºé™åˆ¶ä¸å®‰å…¨éš”ç¦»</h3>
<h4 data-id="heading-57">æ‰§è¡Œä»£ç </h4>
<pre><code class="hljs language-scss" lang="scss"># è¿è¡Œå®¹å™¨æ—¶é™åˆ¶ CPU å’Œå†…å­˜ï¼ˆä»¥ nginx é•œåƒä¸ºä¾‹ï¼‰
isula run -d <span class="hljs-attr">--name</span> nginx-safe <span class="hljs-attr">--cpus</span> <span class="hljs-number">0.5</span> <span class="hljs-attr">--memory</span> <span class="hljs-number">512</span>m <span class="hljs-attr">--security-opt</span> seccomp=default<span class="hljs-selector-class">.json</span> nginx
</code></pre>
<h4 data-id="heading-58">ä»£ç è§£é‡Š</h4>
<ul>
<li><code>--cpus 0.5</code> é™åˆ¶å®¹å™¨æœ€å¤šä½¿ç”¨ 0.5 ä¸ª CPU æ ¸å¿ƒï¼Œé¿å…å®¹å™¨å ç”¨è¿‡å¤šèµ„æºå¯¼è‡´ç³»ç»Ÿå´©æºƒã€‚</li>
<li><code>--memory 512m</code> é™åˆ¶å®¹å™¨æœ€å¤§ä½¿ç”¨å†…å­˜ä¸º 512MBï¼Œé˜²æ­¢å†…å­˜æ³„æ¼å¼•å‘çš„å®‰å…¨é—®é¢˜ã€‚</li>
<li><code>--security-opt seccomp=default.json</code> å¯ç”¨ seccomp å®‰å…¨æœºåˆ¶ï¼Œé™åˆ¶å®¹å™¨å¯è°ƒç”¨çš„ç³»ç»Ÿè°ƒç”¨ï¼Œå‡å°‘å®¹å™¨é€ƒé€¸é£é™©ã€‚</li>
</ul>
<hr/>
<h2 data-id="heading-59">å…«ã€æ€»ç»“</h2>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/85ada052412649bc86e6f234eb069b30~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgeGNMZWlnaA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765342741&amp;x-signature=%2F%2Fgfg8%2Fnj0xq%2FLmF8rivA3gK3Q8%3D" alt="" loading="lazy"/></p>
<p>openEuler å ªç§°å¼€æºæ“ä½œç³»ç»Ÿé¢†åŸŸçš„å®‰å…¨æ ‡æ†ğŸŒŸï¼å®ƒä»¥å†…æ ¸åŠ å›ºä¸ºæ ¹åŸºğŸ›¡ï¸ï¼Œé›†æˆ SELinux ç­‰ç¡¬æ ¸é˜²æŠ¤ï¼Œä»åº•å±‚ç­‘ç‰¢å®‰å…¨é˜²çº¿ï¼›å¤šå±‚çº§è®¿é—®æ§åˆ¶ä½“ç³»ç»†è‡´å…¥å¾®ğŸ”ï¼Œæœ€å°æƒé™åŸåˆ™è´¯ç©¿å§‹ç»ˆï¼Œç²¾å‡†è§„é¿æƒé™æ»¥ç”¨é£é™©ï¼›å®˜æ–¹è½¯ä»¶æºç­¾åæ ¡éªŒ+å¿«é€Ÿæ¼æ´æ›´æ–°åŒç®¡é½ä¸‹ğŸš€ï¼Œè®©ä¾›åº”é“¾å®‰å…¨æ— æ‡ˆå¯å‡»ï¼›äº‘åŸç”Ÿåœºæ™¯ä¸‹çš„å®¹å™¨éš”ç¦»ä¸èµ„æºç®¡æ§èƒ½åŠ›äº®çœ¼âœ¨ï¼Œå®Œç¾é€‚é…ç°ä»£éƒ¨ç½²éœ€æ±‚ï¼›å†åŠ ä¸Šå®Œå–„çš„æ—¥å¿—å®¡è®¡æœºåˆ¶ğŸ“Šï¼Œå®ç°å®‰å…¨äº‹ä»¶å¯è¿½æº¯ã€å¯æ’æŸ¥ã€‚ä½œä¸ºè‡ªä¸»å¼€æºç”Ÿæ€çš„æ ¸å¿ƒåŠ›é‡ğŸŒï¼ŒopenEuler æ—¢å…¼é¡¾äº†å…¨åœºæ™¯å®‰å…¨é˜²æŠ¤çš„ä¸“ä¸šæ€§ï¼Œåˆæä¾›äº†ç®€å•æ˜“æ“ä½œçš„å®æ“æ–¹æ¡ˆï¼Œè®©ä¼ä¸šå’Œå¼€å‘è€…èƒ½è½»æ¾è½åœ°å®‰å…¨é…ç½®ï¼Œæ— ç–‘æ˜¯æ•°å­—åŒ–æ—¶ä»£å€¼å¾—ä¿¡èµ–çš„æ“ä½œç³»ç»Ÿä¼˜é€‰ğŸ‘ï¼</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Mapæ˜ å°„]]></title>    <link>https://juejin.cn/post/7579179741824286746</link>    <guid>https://juejin.cn/post/7579179741824286746</guid>    <pubDate>2025-12-03T03:36:42.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7579179741824286746" data-draft-id="7579142750408605722" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content=" Mapæ˜ å°„"/> <meta itemprop="keywords" content="Scala"/> <meta itemprop="datePublished" content="2025-12-03T03:36:42.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Dddd"/> <meta itemprop="url" content="https://juejin.cn/user/740432946661152"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
             Mapæ˜ å°„
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/740432946661152/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Dddd
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-03T03:36:42.000Z" title="Wed Dec 03 2025 03:36:42 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-03
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    11
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»1åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">ï¼ˆä¸€ï¼‰Mapçš„å®šä¹‰å’Œåˆ›å»º</h2>
<p><strong>Map åˆ›å»ºæ ¼å¼ï¼š</strong></p>
<p>1.ä¸å¯å˜ Mapï¼šval mapName: Map[KeyType, ValueType] = Map(key1 -&gt; value1, key2 -&gt; value2,...)</p>
<p>2.å¯å˜ Mapï¼ˆéœ€å¯¼å…¥scala.collection.mutable.Mapï¼‰ï¼šval mapName:</p>
<p>mutable.Map[KeyType, ValueType] = mutable.Map(key1 -&gt; value2,...)</p>
<pre><code class="hljs language-scala" lang="scala"><span class="hljs-keyword">package</span> map
<span class="hljs-comment">/**
 * Map: æ˜ å°„
 * é”®å€¼å¯¹ï¼Œé”®ä¸èƒ½æœ‰ç›¸åŒçš„ï¼
 * (key, value)
 *
 * è±« -&gt; æ¹–åŒ—çœ
 * æ¹˜ -&gt; æ¹–å—çœ
 * èµ£ -&gt; æ±Ÿè¥¿çœ
 *
 * 01 -&gt; xxx
 * 02 -&gt; yyy
 */</span>
<span class="hljs-class"><span class="hljs-keyword">object</span> <span class="hljs-title">map01</span> </span>{
  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">main</span></span>(args: <span class="hljs-type">Array</span>[<span class="hljs-type">String</span>]): <span class="hljs-type">Unit</span> = {
    <span class="hljs-keyword">val</span> map1 = <span class="hljs-type">Map</span>(<span class="hljs-string">"alice"</span> -&gt; <span class="hljs-number">90</span>, (<span class="hljs-string">"bob"</span> -&gt; <span class="hljs-number">80</span>), (<span class="hljs-string">"bob"</span> -&gt; <span class="hljs-number">100</span>))
    <span class="hljs-comment">// bobè¿™ä¸ªé”®æœ‰é‡å¤ï¼Œåªä¿ç•™ä¸€ä¸ª</span>
    println(map1)
  }
}
</code></pre>
<h2 data-id="heading-1">ï¼ˆäºŒï¼‰Map çš„å¸¸ç”¨æ–¹æ³•</h2>
<pre><code class="hljs language-scala" lang="scala"><span class="hljs-keyword">package</span> map
<span class="hljs-class"><span class="hljs-keyword">object</span> <span class="hljs-title">map01</span> </span>{
  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">main</span></span>(args: <span class="hljs-type">Array</span>[<span class="hljs-type">String</span>]): <span class="hljs-type">Unit</span> = {
    <span class="hljs-keyword">val</span> map1 = scala.collection.mutable.<span class="hljs-type">Map</span>((<span class="hljs-string">"alice"</span> -&gt; <span class="hljs-number">90</span>), (<span class="hljs-string">"bob"</span> -&gt; <span class="hljs-number">80</span>), (<span class="hljs-string">"bob"</span> -&gt; <span class="hljs-number">100</span>))
    <span class="hljs-comment">// bobè¿™ä¸ªé”®æœ‰é‡å¤ï¼Œåªä¿ç•™ä¸€ä¸ª</span>
    println(map1)
    <span class="hljs-comment">// 1 æ·»åŠ </span>
    map1 += (<span class="hljs-string">"judy"</span> -&gt; <span class="hljs-number">90</span>)
    <span class="hljs-comment">// 2 åˆ é™¤</span>
    map1 -= <span class="hljs-string">"bob"</span>
    <span class="hljs-comment">// 3 æŸ¥è¯¢å…ƒç´ </span>
    <span class="hljs-keyword">val</span> key = <span class="hljs-string">"alice"</span>
    <span class="hljs-keyword">val</span> ret = map1.get(key)
    <span class="hljs-keyword">if</span> (ret.isDefined) {
      println(<span class="hljs-string">s"<span class="hljs-subst">${key}</span> å¯¹åº”çš„å€¼æ˜¯ï¼š<span class="hljs-subst">${ret.get}</span>"</span>)
    } <span class="hljs-keyword">else</span> {
      println(<span class="hljs-string">s"<span class="hljs-subst">${key}</span> ä¸å­˜åœ¨"</span>)
    }
    println(ret)
    <span class="hljs-comment">// 4. for å¾ªç¯è¾“å‡ºæ‰€æœ‰</span>
    <span class="hljs-keyword">for</span> ((a, b) &lt;- map1) {
      println(<span class="hljs-string">s"<span class="hljs-subst">${a}</span>, <span class="hljs-subst">${b}</span>"</span>)
    }
    map1.foreach {
      <span class="hljs-keyword">case</span> (key, value) =&gt; {
        println(<span class="hljs-string">s"<span class="hljs-subst">${key}</span>, <span class="hljs-subst">${value}</span>"</span>)
      }
    }
  }
}
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[26.<Set>ç”¨æ³• and <Map>ç”¨æ³•]]></title>    <link>https://juejin.cn/post/7579130291622936618</link>    <guid>https://juejin.cn/post/7579130291622936618</guid>    <pubDate>2025-12-03T03:39:38.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7579130291622936618" data-draft-id="7579066828180013092" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="26.&lt;Set&gt;ç”¨æ³• and &lt;Map&gt;ç”¨æ³•"/> <meta itemprop="keywords" content="Scala"/> <meta itemprop="datePublished" content="2025-12-03T03:39:38.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å“ˆåŸºä¼Š"/> <meta itemprop="url" content="https://juejin.cn/user/1215421940773178"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            26.&lt;Set&gt;ç”¨æ³• and &lt;Map&gt;ç”¨æ³•
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1215421940773178/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å“ˆåŸºä¼Š
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-03T03:39:38.000Z" title="Wed Dec 03 2025 03:39:38 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-03
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»2åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h4 data-id="heading-0">Set</h4>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-code">    é›†åˆã€‚è¡¨ç¤ºæ²¡æœ‰é‡å¤å…ƒç´ çš„é›†åˆï¼Œç‰¹ç‚¹æ˜¯ï¼šå”¯ä¸€ï¼Œæ— åºã€‚
</span></code></pre>
<h6 data-id="heading-1">å¦‚æœæ”¾åœ¨setä¸­çš„å…ƒç´ æœ‰é‡å¤çš„ï¼Œå®ƒä¼šè‡ªåŠ¨å»é‡ï¼šåªä¿ç•™ä¸€ä¸ª</h6>
<pre><code class="hljs language-Scala" lang="Scala"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">main</span></span>(args: <span class="hljs-type">Array</span>[<span class="hljs-type">String</span>]): <span class="hljs-type">Unit</span> = {
  <span class="hljs-keyword">val</span> set1  = <span class="hljs-type">Set</span>(<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>,<span class="hljs-number">1</span>,<span class="hljs-number">1</span>,<span class="hljs-number">1</span>,<span class="hljs-number">1</span>,<span class="hljs-number">1</span>,<span class="hljs-number">1</span>)

  println(set1)
}                   ç»“æœï¼š<span class="hljs-type">Set</span>(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>)
</code></pre>
<h5 data-id="heading-2">ç†è§£  å¯å˜å’Œä¸å¯å˜</h5>
<pre><code class="hljs language-arduino" lang="arduino">    å¯å˜ï¼ˆ<span class="hljs-keyword">mutable</span>ï¼‰:å¯ä»¥ç›´æ¥æ“ä½œè¿™ä¸ªå®¹å™¨ä¸­çš„æ•°æ®ï¼Œä¾‹å¦‚ï¼šæ·»åŠ ã€‚
    ä¸å¯å˜ï¼ˆimmutableï¼‰ï¼šä¸èƒ½ä¿®æ”¹å®¹å™¨ä¸­çš„æ•°æ®ã€‚
    é»˜è®¤æƒ…å†µä¸‹ï¼Œä½¿ç”¨çš„Setæ˜¯ä¸å¯å˜çš„ã€‚
</code></pre>
<pre><code class="hljs language-Scala" lang="Scala"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">main</span></span>(args: <span class="hljs-type">Array</span>[<span class="hljs-type">String</span>]): <span class="hljs-type">Unit</span> = {
    <span class="hljs-keyword">val</span> set1  = scala.collection.immutable.<span class="hljs-type">Set</span>(<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>,<span class="hljs-number">1</span>,<span class="hljs-number">1</span>,<span class="hljs-number">1</span>,<span class="hljs-number">1</span>)
    <span class="hljs-keyword">val</span> set2 = scala.collection.mutable.<span class="hljs-type">Set</span>(<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>)
<span class="hljs-comment">// å¯å˜çš„Setå¯ä»¥ç›´æ¥ä¿®æ”¹å®ƒè‡ªå·±</span>
    set2 += <span class="hljs-number">20</span>
<span class="hljs-comment">// ä¸å¯å˜çš„setä¸èƒ½ç›´æ¥ä¿®æ”¹å®ƒè‡ªå·±</span>
<span class="hljs-comment">//    set1 += 2</span>
    println(set2)
  }
</code></pre>
<h5 data-id="heading-3">æ·»åŠ ï¼Œåˆ é™¤ï¼Œåˆ¤æ–­ï¼Œåˆå¹¶ï¼Œäº¤é›†ï¼Œå·®é›†</h5>
<pre><code class="hljs language-Scala" lang="Scala">  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">main</span></span>(args: <span class="hljs-type">Array</span>[<span class="hljs-type">String</span>]): <span class="hljs-type">Unit</span> = {
<span class="hljs-comment">//    å¯å˜Set</span>
    <span class="hljs-keyword">val</span> set1 = scala.collection.mutable.<span class="hljs-type">Set</span>(<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>)
<span class="hljs-comment">//    1.æ·»åŠ </span>
    set1 += <span class="hljs-number">1</span>
    set1 += <span class="hljs-number">4</span>
<span class="hljs-comment">//    2.åˆ é™¤</span>
    set1 -= <span class="hljs-number">2</span>
<span class="hljs-comment">//    3.åˆ¤æ–­ä¸€ä¸ªå…ƒç´ æ˜¯å¦å­˜åœ¨</span>
    <span class="hljs-keyword">val</span> value = <span class="hljs-number">3</span>
    <span class="hljs-keyword">if</span> (set1.contains(value)){
      println(<span class="hljs-string">s"<span class="hljs-subst">${value}</span>å­˜åœ¨"</span>)
    } <span class="hljs-keyword">else</span> {
      println(<span class="hljs-string">s"<span class="hljs-subst">${value}</span>ä¸å­˜åœ¨"</span>)
    }
<span class="hljs-comment">//    4.åˆå¹¶å¦ä¸€ä¸ªSet</span>
    <span class="hljs-keyword">val</span> set2 = scala.collection.mutable.<span class="hljs-type">Set</span>(<span class="hljs-string">"è¯­æ–‡"</span>)
    <span class="hljs-keyword">val</span> set3 = scala.collection.mutable.<span class="hljs-type">Set</span>(<span class="hljs-string">"æ•°å­¦"</span>,<span class="hljs-string">"è‹±è¯­"</span>)
    set2 ++= set3
    println(set2)
<span class="hljs-comment">//    5.äº¤é›†</span>
    <span class="hljs-keyword">val</span> set4 = scala.collection.mutable.<span class="hljs-type">Set</span>(<span class="hljs-string">"å”±æ­Œ"</span>,<span class="hljs-string">"è·³èˆ"</span>)
    <span class="hljs-keyword">val</span> set5 = scala.collection.mutable.<span class="hljs-type">Set</span>(<span class="hljs-string">"æ‰“æ¸¸æˆ"</span>,<span class="hljs-string">"æ‰“çƒ"</span>,<span class="hljs-string">"è·³èˆ"</span>)

    <span class="hljs-keyword">val</span> set6 = set4.intersect(set5)
    println(set6)
<span class="hljs-comment">//    5.å·®é›†</span>
    <span class="hljs-keyword">val</span> set7 = scala.collection.mutable.<span class="hljs-type">Set</span>(<span class="hljs-string">"å”±æ­Œ"</span>,<span class="hljs-string">"è·³èˆ"</span>)
    <span class="hljs-keyword">val</span> set8 = scala.collection.mutable.<span class="hljs-type">Set</span>(<span class="hljs-string">"æ‰“æ¸¸æˆ"</span>,<span class="hljs-string">"æ‰“çƒ"</span>,<span class="hljs-string">"è·³èˆ"</span>)

    <span class="hljs-keyword">val</span> set9 = set7.diff(set8)

    println(set9)
  }
</code></pre>
<h3 data-id="heading-4">Mapæ˜ å°„</h3>
<h5 data-id="heading-5">//Map ï¼šæ˜ å°„</h5>
<pre><code class="hljs language-arduino" lang="arduino">    <span class="hljs-comment">//        é”®å€¼å¯¹,é”®ä¸èƒ½æœ‰ç›¸åŒçš„ï¼</span>
    <span class="hljs-comment">//        (key,value)</span>
</code></pre>
<pre><code class="hljs language-Scala" lang="Scala">  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">main</span></span>(args: <span class="hljs-type">Array</span>[<span class="hljs-type">String</span>]): <span class="hljs-type">Unit</span> = {
    <span class="hljs-keyword">val</span> map1 = <span class="hljs-type">Map</span>((<span class="hljs-string">"alice"</span> -&gt; <span class="hljs-number">90</span>),(<span class="hljs-string">"bob"</span> -&gt; <span class="hljs-number">80</span>),(<span class="hljs-string">"bob"</span> -&gt; <span class="hljs-number">100</span>))
<span class="hljs-comment">//    bobè¿™ä¸ªé”®æœ‰é‡å¤ï¼Œåªä¿ç•™ä¸€ä¸ª</span>
    println(map1)
  }
</code></pre>
<h5 data-id="heading-6">æ·»åŠ ï¼Œåˆ é™¤ï¼ŒæŸ¥è¯¢ï¼Œå¾ªç¯è¾“å‡ºæ‰€æœ‰</h5>
<pre><code class="hljs language-Scala" lang="Scala">  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">main</span></span>(args: <span class="hljs-type">Array</span>[<span class="hljs-type">String</span>]): <span class="hljs-type">Unit</span> = {
    <span class="hljs-keyword">val</span> map1 = scala.collection.mutable.<span class="hljs-type">Map</span>((<span class="hljs-string">"alice"</span> -&gt; <span class="hljs-number">90</span>),(<span class="hljs-string">"bob"</span> -&gt; <span class="hljs-number">80</span>),(<span class="hljs-string">"bob"</span> -&gt; <span class="hljs-number">100</span>))
<span class="hljs-comment">//    bobè¿™ä¸ªé”®æœ‰é‡å¤ï¼Œåªä¿ç•™ä¸€ä¸ª</span>
<span class="hljs-comment">//    1.æ·»åŠ </span>
    map1 +=(<span class="hljs-string">"juddy"</span> -&gt; <span class="hljs-number">90</span>)
<span class="hljs-comment">//    2.åˆ é™¤</span>
    map1 -= <span class="hljs-string">"bob"</span>
<span class="hljs-comment">//    3.æŸ¥è¯¢å…ƒç´ </span>
    <span class="hljs-keyword">val</span> key = <span class="hljs-string">"alice111"</span>
    <span class="hljs-keyword">val</span> ret = map1.get(key)
    <span class="hljs-keyword">if</span> (ret.isDefined){
      println(<span class="hljs-string">s"<span class="hljs-subst">${key}</span>å¯¹äºçš„å€¼æ˜¯ï¼š<span class="hljs-subst">${ret.get}</span>"</span>)
    } <span class="hljs-keyword">else</span> {
      println(<span class="hljs-string">s"<span class="hljs-subst">${key}</span>ä¸å­˜åœ¨"</span>)
    }
<span class="hljs-comment">//    4.for å¾ªç¯è¾“å‡ºæ‰€æœ‰</span>
    <span class="hljs-keyword">for</span> ((a,b) &lt;- map1){
      println(<span class="hljs-string">s"<span class="hljs-subst">${a}</span>,<span class="hljs-subst">${b}</span>"</span>)
    }

    map1.foreach({
      <span class="hljs-keyword">case</span> (key,value) =&gt; {
        println(<span class="hljs-string">s"<span class="hljs-subst">${key}</span>,<span class="hljs-subst">${value}</span>"</span>)
      }
    })
  }
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[openEuler äº‘åŸç”Ÿè¿›é˜¶ï¼šK3s è½»é‡çº§ Kubernetes é›†ç¾¤å®æˆ˜]]></title>    <link>https://juejin.cn/post/7579176524131352627</link>    <guid>https://juejin.cn/post/7579176524131352627</guid>    <pubDate>2025-12-03T04:30:43.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7579176524131352627" data-draft-id="7579176524131336243" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="openEuler äº‘åŸç”Ÿè¿›é˜¶ï¼šK3s è½»é‡çº§ Kubernetes é›†ç¾¤å®æˆ˜"/> <meta itemprop="keywords" content="æ“ä½œç³»ç»Ÿ,æœåŠ¡å™¨"/> <meta itemprop="datePublished" content="2025-12-03T04:30:43.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Nturmoils"/> <meta itemprop="url" content="https://juejin.cn/user/1722263248317024"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            openEuler äº‘åŸç”Ÿè¿›é˜¶ï¼šK3s è½»é‡çº§ Kubernetes é›†ç¾¤å®æˆ˜
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1722263248317024/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Nturmoils
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-03T04:30:43.000Z" title="Wed Dec 03 2025 04:30:43 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-03
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»12åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">ä¸€ã€openEuler 22.03 LTS-SP1ï¼šä¸ºäº‘åŸç”Ÿè€Œç”Ÿ</h2>
<h3 data-id="heading-1">1.1 ä¸ºä»€ä¹ˆé€‰æ‹© openEuler 22.03 LTS-SP1</h3>
<p>å‰é¢ä¸¤ç¯‡æ–‡ç« ï¼Œæˆ‘åˆ†åˆ«ç”¨ openEuler éƒ¨ç½²äº† WordPress å’Œ Nextcloudï¼Œå¯¹è¿™ä¸ªç³»ç»Ÿæœ‰äº†ä¸å°‘è®¤è¯†ã€‚è¿™æ¬¡è¦ä¸Š K3s äº†ï¼Œå¿ƒé‡Œå…¶å®æœ‰ç‚¹æ‰“é¼“â€”â€”Kubernetes å¯¹ç³»ç»Ÿçš„è¦æ±‚å¯ä¸ä½ï¼ŒopenEuler èƒ½ä¸èƒ½æ‰›å¾—ä½ï¼Ÿ</p>
<p>æŠ±ç€è¿™ä¸ªç–‘é—®ï¼Œæˆ‘å»ç¿»äº†ä¸‹ openEuler 22.03 LTS-SP1 çš„å®˜æ–¹æ–‡æ¡£ï¼Œç»“æœå‘ç°è¿™ä¸ªç‰ˆæœ¬åœ¨äº‘åŸç”Ÿæ–¹é¢çš„èƒ½åŠ›ï¼ŒçœŸçš„è¶…å‡ºäº†æˆ‘çš„é¢„æœŸã€‚</p>
<h3 data-id="heading-2">1.2 openEuler 22.03 LTS-SP1 çš„æ ¸å¿ƒç‰¹æ€§</h3>
<p>è¿™ä¸ªç‰ˆæœ¬æ˜¯ openEuler ç¤¾åŒºåœ¨ 2023 å¹´å‘å¸ƒçš„é•¿æœŸæ”¯æŒç‰ˆæœ¬ï¼Œä¸»æ‰“çš„å°±æ˜¯ç¨³å®šå’Œé«˜æ•ˆã€‚æˆ‘æŒ‘å‡ ä¸ªå’Œäº‘åŸç”Ÿç›¸å…³çš„é‡ç‚¹è¯´ä¸€ä¸‹ï¼š</p>
<ol>
<li><strong>Linux 5.10 LTS å†…æ ¸</strong></li>
</ol>
<p>è¿™ä¸ªå†…æ ¸ç‰ˆæœ¬ä¸æ˜¯éšä¾¿é€‰çš„ã€‚5.10 æ˜¯ Linux çš„é•¿æœŸæ”¯æŒç‰ˆæœ¬ï¼Œé›†æˆäº†å¤§é‡é’ˆå¯¹å®¹å™¨å’Œè™šæ‹ŸåŒ–çš„ä¼˜åŒ–ï¼š</p>
<ul>
<li>cgroup v2 æ”¯æŒå®Œå–„ï¼Œèµ„æºéš”ç¦»æ›´ç²¾å‡†</li>
<li>namespace æœºåˆ¶ä¼˜åŒ–ï¼Œå®¹å™¨å¯åŠ¨æ›´å¿«</li>
<li>å†…å­˜ç®¡ç†æ”¹è¿›ï¼Œé€‚åˆé«˜å¯†åº¦å®¹å™¨éƒ¨ç½²</li>
</ul>
<p>æˆ‘ä¹‹å‰ç”¨çš„æ—¶å€™å°±æ„Ÿè§‰ Docker å®¹å™¨èµ·å¾—ç‰¹åˆ«å¿«ï¼Œç°åœ¨æƒ³æƒ³åº”è¯¥å°±æ˜¯å†…æ ¸çš„åŠŸåŠ³ã€‚</p>
<ol>
<li><strong>NestOS å®¹å™¨æ“ä½œç³»ç»Ÿ</strong></li>
</ol>
<p>è¿™ä¸ªæ˜¯ openEuler 22.03 ä¸“é—¨ä¸ºäº‘åŸç”Ÿåœºæ™¯è®¾è®¡çš„ç‰¹æ€§ã€‚å®ƒé‡‡ç”¨äº†åŒæ ¹æ–‡ä»¶ç³»ç»Ÿå’ŒåŸå­åŒ–æ›´æ–°ï¼š</p>
<ul>
<li>rpm-ostree æ”¯æŒï¼šç³»ç»Ÿæ›´æ–°åƒ Git ä¸€æ ·ï¼Œå¯ä»¥å›æ»š</li>
<li>ignition é…ç½®ï¼šå®¹å™¨åŒ–ç¯å¢ƒçš„è‡ªåŠ¨é…ç½®</li>
<li>ä¸å®¹å™¨ç¼–æ’æŠ€æœ¯æ·±åº¦é›†æˆ</li>
</ul>
<p>è™½ç„¶æˆ‘è¿™æ¬¡æ²¡ç”¨ NestOSï¼Œä½†çŸ¥é“ openEuler æœ‰è¿™ä¸ªä¸œè¥¿ï¼Œå¿ƒé‡Œå°±è¸å®å¤šäº†â€”â€”è¯´æ˜ä»–ä»¬æ˜¯çœŸçš„åœ¨é’ˆå¯¹å®¹å™¨åœºæ™¯åšä¼˜åŒ–ã€‚</p>
<ol>
<li><strong>HybridSched è™šæ‹ŸåŒ–æ··åˆè°ƒåº¦</strong></li>
</ol>
<p>è¿™ä¸ªç‰¹æ€§æŒºå‰å®³çš„ï¼Œå¯ä»¥æ ¹æ®ä¸šåŠ¡çš„ä¼˜å…ˆçº§è¿›è¡Œæ™ºèƒ½è°ƒåº¦ï¼š</p>
<ul>
<li>CPU å¹²æ‰°æ§åˆ¶ï¼šæ”¯æŒå¾®ç§’çº§æŠ¢å </li>
<li>ç¼“å­˜å’Œå†…å­˜å¸¦å®½æ§åˆ¶ï¼šé«˜ä¼˜å…ˆçº§ä¸šåŠ¡ä¸ä¼šè¢«ä½ä¼˜å…ˆçº§æ‹–ç´¯</li>
<li>åŠŸè€—æ§åˆ¶ï¼šåœ¨ä¿è¯æ€§èƒ½çš„åŒæ—¶é™ä½èƒ½è€—</li>
</ul>
<p>å¯¹äºè·‘ K8s è¿™ç§å¤šå®¹å™¨æ··åˆéƒ¨ç½²çš„åœºæ™¯ï¼Œè¿™ä¸ªç‰¹æ€§åº”è¯¥å¾ˆæœ‰ç”¨ã€‚</p>
<ol>
<li><strong>ç¡¬ä»¶å…¼å®¹æ€§å¼º</strong></li>
</ol>
<p>æ”¯æŒ x86 å’Œ ARM æ¶æ„ï¼Œæˆ‘è¿™å° x86 æœåŠ¡å™¨ç”¨èµ·æ¥æ²¡å•¥é—®é¢˜ã€‚è€Œä¸”å®˜æ–¹æ–‡æ¡£é‡Œè¯´ï¼Œå¯¹é²²é¹èŠ¯ç‰‡æœ‰ä¸“é—¨çš„ä¼˜åŒ–ã€‚</p>
<h3 data-id="heading-3">1.3 ä» Docker åˆ° K8s çš„æ€è€ƒ</h3>
<p>å‰ä¸¤ç¯‡æ–‡ç« ï¼Œæˆ‘ç”¨ Docker å’Œ Docker Compose éƒ¨ç½²äº†ä¸¤ä¸ªåº”ç”¨ã€‚è¿™ä¸¤ä¸ªå·¥å…·ç¡®å®å¥½ç”¨ï¼Œä½†æœ‰ä¸ªé—®é¢˜ï¼šéƒ½æ˜¯å•æœºæ–¹æ¡ˆã€‚</p>
<p>å¦‚æœæˆ‘æƒ³ï¼š</p>
<ul>
<li>åŒæ—¶è¿è¡Œåå‡ ä¸ªå®¹å™¨åº”ç”¨ï¼Œæ€ä¹ˆç»Ÿä¸€ç®¡ç†ï¼Ÿ</li>
<li>æŸä¸ªå®¹å™¨æŒ‚äº†ï¼Œèƒ½ä¸èƒ½è‡ªåŠ¨é‡å¯ï¼Ÿ</li>
<li>èƒ½ä¸èƒ½æ ¹æ®è´Ÿè½½è‡ªåŠ¨æ‰©å®¹ï¼Ÿ</li>
<li>å¤šå°æœåŠ¡å™¨ä¹‹é—´æ€ä¹ˆååŒå·¥ä½œï¼Ÿ</li>
</ul>
<p>è¿™äº›éœ€æ±‚ï¼ŒDocker Compose å°±æä¸å®šäº†ã€‚å¾—ä¸Š Kubernetesã€‚</p>
<p>ä½†æ ‡å‡†çš„ K8s å¤ªé‡äº†ï¼š</p>
<ul>
<li>å®‰è£…å¤æ‚ï¼Œç»„ä»¶ä¸€å¤§å †</li>
<li>èµ„æºå ç”¨å¤§ï¼Œå°æœåŠ¡å™¨è·‘ä¸åŠ¨</li>
<li>å­¦ä¹ æ›²çº¿é™¡å³­ï¼Œä¸Šæ‰‹å›°éš¾</li>
</ul>
<p>æ‰€ä»¥æˆ‘é€‰äº† K3sã€‚å®ƒæ˜¯ Rancher æçš„è½»é‡çº§ K8sï¼š</p>
<ul>
<li>äºŒè¿›åˆ¶æ–‡ä»¶åªæœ‰ 70MBï¼ˆæ ‡å‡† K8s å‡ ä¸ª GBï¼‰</li>
<li>å•èŠ‚ç‚¹å°±èƒ½è·‘å®Œæ•´é›†ç¾¤</li>
<li>å®Œå…¨å…¼å®¹æ ‡å‡† K8s API</li>
<li>å®‰è£…ç®€å•ï¼Œä¸€æ¡å‘½ä»¤æå®š</li>
</ul>
<p>æœ€å…³é”®çš„æ˜¯ï¼Œæˆ‘æƒ³éªŒè¯ä¸€ä¸‹ openEuler åœ¨å®¹å™¨ç¼–æ’åœºæ™¯ä¸‹çš„è¡¨ç°ã€‚</p>
<h2 data-id="heading-4">äºŒã€K3s éƒ¨ç½²å®æˆ˜</h2>
<h3 data-id="heading-5">2.1 æœåŠ¡å™¨ç¯å¢ƒ</h3>
<p>è¿˜æ˜¯é‚£å°æœåŠ¡å™¨ï¼Œé…ç½®æ²¡å˜ï¼š</p>
<ul>
<li><strong>CPU</strong>ï¼š16æ ¸ Intel Xeon Gold 6138 @ 2.00GHz</li>
<li><strong>å†…å­˜</strong>ï¼š16GB</li>
<li><strong>å­˜å‚¨</strong>ï¼š40GB SSD</li>
<li><strong>æ“ä½œç³»ç»Ÿ</strong>ï¼šopenEuler 22.03 (LTS-SP1)</li>
<li><strong>å†…æ ¸ç‰ˆæœ¬</strong>ï¼š5.10.0-136.12.0.86.oe2203sp1.x86_64</li>
</ul>
<p>è¿™å°æœåŠ¡å™¨ä¸Šå·²ç»è·‘ç€ WordPress å’Œ Nextcloud ä¸¤ä¸ª Docker åº”ç”¨äº†ã€‚K3s é»˜è®¤ç”¨ containerdï¼Œå’Œ Docker ä¸å†²çªï¼Œå¯ä»¥å…±å­˜ã€‚</p>
<h3 data-id="heading-6">2.2 å®‰è£… K3sï¼šç¬¬ä¸€æ¬¡è¸©å‘</h3>
<p>ä¸€å¼€å§‹æˆ‘æŒ‰ç…§å®˜æ–¹æ–‡æ¡£ï¼Œç›´æ¥æ‰§è¡Œï¼š</p>
<pre><code class="hljs language-arduino" lang="arduino">curl -sfL https:<span class="hljs-comment">//get.k3s.io | sh -</span>
</code></pre>
<p>ç»“æœæŠ¥é”™äº†ï¼š</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/18ddebd6aa7344eabb96cbd6b93e2826~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTnR1cm1vaWxz:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765341043&amp;x-signature=x81cAZXhW%2Fpo0yfb6qClJdSaf44%3D" alt="K3så®‰è£…æŠ¥é”™" loading="lazy"/></p>
<p>é”™è¯¯ä¿¡æ¯å¾ˆæ˜ç¡®ï¼š</p>
<pre><code class="hljs language-vbnet" lang="vbnet"><span class="hljs-symbol">Error:</span> cannot install the best candidate <span class="hljs-keyword">for</span> the job
- <span class="hljs-literal">nothing</span> provides container-selinux &gt;= <span class="hljs-number">3</span>:<span class="hljs-number">2.191</span>.<span class="hljs-number">0</span>-<span class="hljs-number">1</span> needed <span class="hljs-keyword">by</span> k3s-selinux-<span class="hljs-number">1.6</span>-<span class="hljs-number">1</span>.el9.noarch
</code></pre>
<p>é—®é¢˜å‡ºåœ¨ SELinux ä¸Šã€‚K3s éœ€è¦ <code>container-selinux &gt;= 3:2.191.0-1</code>ï¼Œä½† openEuler 22.03 LTS-SP1 çš„è½¯ä»¶ä»“åº“é‡Œåªæœ‰æ›´è€çš„ç‰ˆæœ¬ã€‚</p>
<p>è¿™ä¸ªå‘å…¶å®æŒºå¸¸è§çš„ã€‚ä¸åŒå‘è¡Œç‰ˆçš„è½¯ä»¶åŒ…ç‰ˆæœ¬ä¸ä¸€æ ·ï¼Œç›´æ¥è£…å®¹æ˜“é‡åˆ°ä¾èµ–é—®é¢˜ã€‚</p>
<h3 data-id="heading-7">2.3 è§£å†³æ–¹æ¡ˆï¼šè·³è¿‡ SELinux</h3>
<p>å¯¹äºå­¦ä¹ å’Œæµ‹è¯•ç¯å¢ƒï¼Œå¯ä»¥è·³è¿‡ SELinux æ”¯æŒã€‚ä¿®æ”¹å®‰è£…å‘½ä»¤ï¼š</p>
<p>curl -sfL <a href="https://link.juejin.cn?target=https%3A%2F%2Fget.k3s.io" target="_blank" title="https://get.k3s.io" ref="nofollow noopener noreferrer">get.k3s.io</a> | INSTALL_K3S_SKIP_SELINUX_RPM=true sh -</p>
<p>è¿™æ¬¡å°±é¡ºåˆ©äº†ï¼š</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7d6006e5e7574f87ab54691f6bd0d4f4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTnR1cm1vaWxz:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765341043&amp;x-signature=Hg5cDgQ5x%2FWRCNqqhi3ElxHYu%2BY%3D" alt="K3så®‰è£…æˆåŠŸ" loading="lazy"/></p>
<p>å®‰è£…è¿‡ç¨‹å¾ˆå¿«ï¼Œå¤§æ¦‚ 1 åˆ†é’Ÿå°±å®Œæˆäº†ã€‚å¯ä»¥çœ‹åˆ°ï¼š</p>
<ul>
<li>ä¸‹è½½äº† K3s v1.33.5+k3s1 ç‰ˆæœ¬</li>
<li>åˆ›å»ºäº† kubectlã€crictl ç­‰å‘½ä»¤çš„è½¯é“¾æ¥</li>
<li>åˆ›å»ºäº† systemd æœåŠ¡æ–‡ä»¶</li>
<li>è‡ªåŠ¨å¯åŠ¨äº† k3s æœåŠ¡</li>
</ul>
<p>è¿™ä¸ªè¿‡ç¨‹æ¯”è£…æ ‡å‡† K8s ç®€å•å¤ªå¤šäº†ã€‚æ ‡å‡† K8s è¦è£… kubeadmã€kubeletã€kubectlï¼Œè¿˜è¦é…ç½®å®¹å™¨è¿è¡Œæ—¶ã€ç½‘ç»œæ’ä»¶ï¼ŒæŠ˜è…¾åŠå¤©ã€‚K3s ä¸€æ¡å‘½ä»¤å…¨æå®šã€‚</p>
<h3 data-id="heading-8">2.4 éªŒè¯å®‰è£…</h3>
<p>å…ˆçœ‹çœ‹æœåŠ¡çŠ¶æ€ï¼š</p>
<p>sudo systemctl status k3s</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8a8f5c83515f4c2c8df3399a7808f39f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTnR1cm1vaWxz:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765341043&amp;x-signature=PNZCEh5yoWNaTYiFQOdSqd6T1%2FM%3D" alt="K3sæœåŠ¡çŠ¶æ€" loading="lazy"/></p>
<p>æœåŠ¡æ˜¯ active (running)ï¼Œçœ‹èµ·æ¥æ²¡é—®é¢˜ã€‚å¯ä»¥çœ‹åˆ° K3s æ˜¯ä»¥ systemd æœåŠ¡çš„å½¢å¼è¿è¡Œçš„ï¼Œå¼€æœºä¼šè‡ªåŠ¨å¯åŠ¨ã€‚</p>
<h2 data-id="heading-9">ä¸‰ã€é…ç½® kubectl</h2>
<h3 data-id="heading-10">3.1 é…ç½® kubeconfig</h3>
<p>K3s å®‰è£…å®Œä¼šè‡ªåŠ¨åˆ›å»º kubeconfig æ–‡ä»¶ï¼Œä½†é»˜è®¤è·¯å¾„éœ€è¦ root æƒé™ã€‚ä¸ºäº†æ–¹ä¾¿ä½¿ç”¨ï¼ŒæŠŠå®ƒå¤åˆ¶åˆ°ç”¨æˆ·ç›®å½•ï¼š</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># åˆ›å»º .kube ç›®å½•</span>
sudo <span class="hljs-built_in">mkdir</span> -p ~/.kube
â€‹
<span class="hljs-comment"># å¤åˆ¶é…ç½®æ–‡ä»¶</span>
sudo <span class="hljs-built_in">cp</span> /etc/rancher/k3s/k3s.yaml ~/.kube/config
â€‹
<span class="hljs-comment"># ä¿®æ”¹æƒé™</span>
sudo <span class="hljs-built_in">chown</span> <span class="hljs-variable">$USER</span>:<span class="hljs-variable">$USER</span> ~/.kube/config
</code></pre>
<h3 data-id="heading-11">3.2 éªŒè¯é›†ç¾¤çŠ¶æ€</h3>
<p>é…ç½®å¥½åï¼Œç”¨ kubectl çœ‹çœ‹é›†ç¾¤çŠ¶æ€ï¼š</p>
<pre><code class="hljs language-arduino" lang="arduino">kubectl version
kubectl get nodes
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d6da69dba2f6495fb7ec6f5a17540484~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTnR1cm1vaWxz:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765341043&amp;x-signature=dhPW5iyE00YegXHj3br8I%2FNLGgk%3D" alt="kubectlé…ç½®å’ŒèŠ‚ç‚¹çŠ¶æ€" loading="lazy"/></p>
<p>è¾“å‡ºæ˜¾ç¤ºï¼š</p>
<ul>
<li>Client ç‰ˆæœ¬ï¼šv1.33.5+k3s1</li>
<li>Server ç‰ˆæœ¬ï¼šv1.33.5+k3s1</li>
<li>èŠ‚ç‚¹çŠ¶æ€ï¼šReady</li>
</ul>
<p>èŠ‚ç‚¹åç§°æ˜¯ <code>ser563963324474</code>ï¼ˆæˆ‘çš„æœåŠ¡å™¨ä¸»æœºåï¼‰ï¼Œè§’è‰²æ˜¯ <code>control-plane,master</code>ã€‚è¿™è¯´æ˜è¿™æ˜¯ä¸€ä¸ªå•èŠ‚ç‚¹é›†ç¾¤ï¼Œæ—¢æ˜¯æ§åˆ¶å¹³é¢ï¼Œä¹Ÿæ˜¯å·¥ä½œèŠ‚ç‚¹ã€‚</p>
<h3 data-id="heading-12">3.3 æŸ¥çœ‹ç³»ç»Ÿç»„ä»¶</h3>
<p>K8s é›†ç¾¤å¯åŠ¨åï¼Œä¼šåœ¨ <code>kube-system</code> å‘½åç©ºé—´è¿è¡Œä¸€äº›ç³»ç»Ÿç»„ä»¶ã€‚çœ‹çœ‹éƒ½æœ‰å•¥ï¼š</p>
<p>kubectl get pods -A</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a179cb8486144c53ada1a905e9c6ffac~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTnR1cm1vaWxz:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765341043&amp;x-signature=QZWXhSJM6%2FhN9%2FS86KmvTdDUd9M%3D" alt="ç³»ç»ŸPodsè¿è¡ŒçŠ¶æ€" loading="lazy"/></p>
<p>å¯ä»¥çœ‹åˆ°è¿™äº›ç»„ä»¶éƒ½åœ¨è¿è¡Œï¼š</p>
<ul>
<li><strong>coredns</strong>ï¼šDNS æœåŠ¡ï¼Œè´Ÿè´£é›†ç¾¤å†…çš„åŸŸåè§£æ</li>
<li><strong>metrics-server</strong>ï¼šèµ„æºç›‘æ§ï¼Œæä¾› <code>kubectl top</code> å‘½ä»¤çš„æ•°æ®</li>
<li><strong>local-path-provisioner</strong>ï¼šæœ¬åœ°å­˜å‚¨ï¼Œä¸º Pod æä¾›æŒä¹…åŒ–å­˜å‚¨</li>
<li><strong>traefik</strong>ï¼šIngress æ§åˆ¶å™¨ï¼Œè´Ÿè´£å¤–éƒ¨æµé‡è·¯ç”±</li>
<li><strong>svclb-traefik</strong>ï¼šTraefik çš„è´Ÿè½½å‡è¡¡å™¨</li>
</ul>
<p>è¿™äº›éƒ½æ˜¯ K3s å†…ç½®çš„ã€‚æ ‡å‡† K8s éœ€è¦è‡ªå·±è£…ï¼ŒK3s ç›´æ¥ç»™ä½ é…å¥½äº†ï¼Œçœäº†ä¸å°‘äº‹ã€‚</p>
<p>å†ç”¨ <code>kubectl describe node</code> çœ‹çœ‹èŠ‚ç‚¹çš„è¯¦ç»†ä¿¡æ¯ï¼Œå¯ä»¥çœ‹åˆ°å¾ˆå¤š K8s çš„æ ‡ç­¾å’Œæ³¨è§£ï¼Œå†…éƒ¨ IP æ˜¯ <code>10.1.226.3</code>ï¼ŒK3s è¿˜é…ç½®äº† flannel ç½‘ç»œæ’ä»¶ï¼ˆvxlan æ¨¡å¼ï¼‰ã€‚</p>
<h2 data-id="heading-13">å››ã€éƒ¨ç½²ç¬¬ä¸€ä¸ªåº”ç”¨</h2>
<h3 data-id="heading-14">4.1 åˆ›å»º Deployment</h3>
<p>ç†è®ºè®²å®Œäº†ï¼Œæ¥ç‚¹å®é™…çš„ã€‚éƒ¨ç½²ä¸€ä¸ª Nginx æµ‹è¯•ä¸€ä¸‹ï¼š</p>
<p>kubectl create deployment nginx-test --image=nginx:alpine</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/55dca412d4fb4ec1a30ab9bdae5e1e4f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTnR1cm1vaWxz:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765341043&amp;x-signature=sT5G1bzNWuYY7U6iHCAcs6fPiSQ%3D" alt="åˆ›å»ºDeployment" loading="lazy"/></p>
<p>å‘½ä»¤æ‰§è¡Œåï¼ŒK8s ä¼šï¼š</p>
<ol>
<li>åˆ›å»ºä¸€ä¸ª Deployment å¯¹è±¡</li>
<li>Deployment åˆ›å»ºä¸€ä¸ª ReplicaSet</li>
<li>ReplicaSet åˆ›å»ºä¸€ä¸ª Pod</li>
<li>Pod é‡Œè¿è¡Œ nginx:alpine å®¹å™¨</li>
</ol>
<p>ç­‰å‡ ç§’é’Ÿï¼ŒPod å°±ä» <code>ContainerCreating</code> å˜æˆ <code>Running</code> äº†ã€‚ç”¨ <code>kubectl get deployments</code> å’Œ <code>kubectl get pods</code> å¯ä»¥çœ‹åˆ°ï¼š</p>
<ul>
<li>Deployment çŠ¶æ€æ˜¯ 1/1ï¼ˆæœŸæœ›1ä¸ªï¼Œå®é™…1ä¸ªï¼‰</li>
<li>Pod çŠ¶æ€æ˜¯ Running</li>
</ul>
<p>è¿™ä¸ªè¿‡ç¨‹æ¯” Docker æ…¢ä¸€ç‚¹ï¼Œå› ä¸ºå¤šäº†ä¸€å±‚ç¼–æ’ã€‚ä½†å¥½å¤„æ˜¯ï¼Œå¦‚æœè¿™ä¸ª Pod æŒ‚äº†ï¼ŒK8s ä¼šè‡ªåŠ¨é‡å¯ï¼›å¦‚æœéœ€è¦å¤šä¸ªå‰¯æœ¬ï¼Œæ”¹ä¸ªæ•°å­—å°±è¡Œã€‚</p>
<h3 data-id="heading-15">4.2 æš´éœ²æœåŠ¡</h3>
<p>Pod åˆ›å»ºå¥½äº†ï¼Œä½†å¤–éƒ¨è¿˜è®¿é—®ä¸äº†ã€‚éœ€è¦åˆ›å»ºä¸€ä¸ª Serviceï¼š</p>
<p>kubectl expose deployment nginx-test --port=80 --type=NodePort</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c1019ea4151543f5a23120f308274c64~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTnR1cm1vaWxz:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765341043&amp;x-signature=G%2BzSdywN9TWWqVY7tJyAZPIWPXo%3D" alt="æš´éœ²Service" loading="lazy"/></p>
<p>Service åˆ›å»ºæˆåŠŸåï¼Œå¯ä»¥çœ‹åˆ°ï¼š</p>
<ul>
<li>ç±»å‹æ˜¯ NodePort</li>
<li>å†…éƒ¨ IP æ˜¯ <code>10.43.240.192</code></li>
<li>ç«¯å£æ˜ å°„æ˜¯ <code>80:32245/TCP</code></li>
</ul>
<p>è¿™é‡Œçš„ <code>32245</code> æ˜¯ K8s è‡ªåŠ¨åˆ†é…çš„ NodePortï¼ˆèŒƒå›´æ˜¯ 30000-32767ï¼‰ã€‚åªè¦è®¿é—®æœåŠ¡å™¨çš„ <code>&lt;IP&gt;:80</code> å°±èƒ½è®¿é—®åˆ° Nginx äº†ã€‚</p>
<h3 data-id="heading-16">4.3 è®¿é—®æµ‹è¯•</h3>
<p>åœ¨æµè§ˆå™¨é‡Œè®¿é—® <code>http://&lt;æœåŠ¡å™¨IP&gt;:80</code>ï¼š</p>
<p>æˆåŠŸäº†ï¼çœ‹åˆ°äº† Nginx çš„æ¬¢è¿é¡µé¢ã€‚è¿™è¯´æ˜æ•´ä¸ªé“¾è·¯éƒ½é€šäº†ï¼š</p>
<ul>
<li>æµè§ˆå™¨ â†’ æœåŠ¡å™¨ IP:32245</li>
<li>NodePort Service â†’ ClusterIP 10.43.240.192:80</li>
<li>ClusterIP â†’ Pod IP 10.42.0.9:80</li>
<li>Pod â†’ nginx å®¹å™¨</li>
</ul>
<p>K8s çš„ç½‘ç»œæ¨¡å‹ç¡®å®å¤æ‚ï¼Œä½†ä¹Ÿå¾ˆå¼ºå¤§ã€‚</p>
<h3 data-id="heading-17">4.4 æŸ¥çœ‹ Pod è¯¦æƒ…</h3>
<p>ç”¨ <code>kubectl describe pod</code> çœ‹çœ‹ Pod çš„è¯¦ç»†ä¿¡æ¯ï¼š</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9042f75f614f48e795a463987534087c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTnR1cm1vaWxz:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765341043&amp;x-signature=9gRjqhTS6nM64jO6xKyzyVufilg%3D" alt="Podè¯¦ç»†ä¿¡æ¯" loading="lazy"/></p>
<p>å¯ä»¥çœ‹åˆ°ï¼š</p>
<ul>
<li>Pod åç§°ï¼šnginx-test-69fbd4bd85-lnmbj</li>
<li>å‘½åç©ºé—´ï¼šdefault</li>
<li>èŠ‚ç‚¹ï¼šser563963324474</li>
<li>Pod IPï¼š10.42.0.9</li>
<li>å®¹å™¨ IDï¼šcontainerd://a0714eb5e9db62ed...</li>
<li>é•œåƒï¼šnginx:alpine</li>
<li>é•œåƒ IDï¼šdocker.io/library/nginx@sha256:b3c656d55d7ad751...</li>
<li>çŠ¶æ€ï¼šRunning</li>
</ul>
<p>Events éƒ¨åˆ†ï¼ˆè™½ç„¶æˆªå›¾æˆªä¸å®Œï¼‰ä¼šæ˜¾ç¤º Pod çš„å¯åŠ¨è¿‡ç¨‹ï¼Œæ¯”å¦‚è°ƒåº¦åˆ°å“ªä¸ªèŠ‚ç‚¹ã€æ‹‰å–é•œåƒã€å¯åŠ¨å®¹å™¨ç­‰ã€‚è¿™å¯¹æ’æŸ¥é—®é¢˜å¾ˆæœ‰ç”¨ã€‚</p>
<h2 data-id="heading-18">äº”ã€K3s on openEuler çš„æ€§èƒ½è¡¨ç°</h2>
<h3 data-id="heading-19">5.1 èµ„æºå ç”¨åˆ†æ</h3>
<p>éƒ¨ç½²å®Œåº”ç”¨ï¼Œæœ€å…³å¿ƒçš„å°±æ˜¯èµ„æºå ç”¨ã€‚çœ‹çœ‹ K3s åƒäº†å¤šå°‘å†…å­˜ï¼š</p>
<pre><code class="hljs language-css" lang="css">ps aux | grep k3s | head -<span class="hljs-number">5</span>
kubectl <span class="hljs-attribute">top</span> pods -<span class="hljs-selector-tag">A</span>
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ec1e1fe1aeef4637b08e6c3691777a82~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTnR1cm1vaWxz:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765341043&amp;x-signature=on5yscOiU%2FfdVTSfC1ApR5ZQFxI%3D" alt="èµ„æºå ç”¨æƒ…å†µ" loading="lazy"/></p>
<p>ä»æˆªå›¾å¯ä»¥çœ‹åˆ°ï¼š</p>
<p><strong>K3s ä¸»è¿›ç¨‹</strong>ï¼š</p>
<ul>
<li>CPUï¼š97.9%ï¼ˆè¿™ä¸ªæ˜¯å¯åŠ¨æ—¶çš„ç¬æ—¶å€¼ï¼Œå®é™…è¿è¡Œæ—¶å¾ˆä½ï¼‰</li>
<li>å†…å­˜ï¼š603MBï¼ˆçº¦ 590MBï¼‰</li>
</ul>
<p><strong>å„ Pod çš„èµ„æºå ç”¨</strong>ï¼š</p>
<ul>
<li>nginx-testï¼šCPU 0mï¼Œå†…å­˜ 10MB</li>
<li>corednsï¼šCPU 5mï¼Œå†…å­˜ 18MB</li>
<li>local-path-provisionerï¼šCPU 1mï¼Œå†…å­˜ 12MB</li>
<li>metrics-serverï¼šCPU 6mï¼Œå†…å­˜ 22MB</li>
<li>traefikï¼šCPU 1mï¼Œå†…å­˜ 44MB</li>
</ul>
<p>åŠ èµ·æ¥ï¼Œæ•´ä¸ª K3s é›†ç¾¤ï¼ˆåŒ…æ‹¬æ‰€æœ‰ç³»ç»Ÿç»„ä»¶ï¼‰å¤§æ¦‚å ç”¨ 700MB å†…å­˜å·¦å³ã€‚</p>
<p>å¯¹æ¯”ä¸€ä¸‹æ ‡å‡† K8sï¼Œæ§åˆ¶å¹³é¢ç»„ä»¶ï¼ˆapiserverã€controller-managerã€schedulerã€etcdï¼‰å°±è¦åƒæ‰ 1.5GB+ã€‚K3s çš„èµ„æºå ç”¨ç¡®å®ä½å¾ˆå¤šã€‚</p>
<p>æˆ‘è¿™å° 16GB å†…å­˜çš„æœåŠ¡å™¨ï¼Œè·‘ K3s + å‡ ä¸ªåº”ç”¨å®Œå…¨æ²¡å‹åŠ›ã€‚</p>
<h3 data-id="heading-20">5.2 openEuler çš„ä¼˜åŠ¿ä½“ç°</h3>
<p>ç”¨äº†å‡ ä¸ªå°æ—¶ K3sï¼Œæˆ‘å¯¹ openEuler åœ¨äº‘åŸç”Ÿåœºæ™¯çš„è¡¨ç°æœ‰äº†æ›´æ·±çš„æ„Ÿå—ã€‚</p>
<ol>
<li><strong>ç¨³å®šæ€§ä¸€æµ</strong></li>
</ol>
<p>ä»å®‰è£…åˆ°éƒ¨ç½²åº”ç”¨ï¼Œæ•´ä¸ªè¿‡ç¨‹æ²¡æœ‰ä»»ä½•æŠ¥é”™ï¼ˆé™¤äº†ä¸€å¼€å§‹çš„ SELinux ä¾èµ–ï¼Œé‚£ä¸ªä¸ç®—ç³»ç»Ÿçš„é—®é¢˜ï¼‰ã€‚Pod å¯åŠ¨å¾ˆå¿«ï¼Œæ²¡æœ‰å‡ºç°è¿‡ Pending æˆ– CrashLoopBackOff çš„æƒ…å†µã€‚</p>
<p>K3s çš„ä¸»è¿›ç¨‹è¿è¡Œäº†å‡ ä¸ªå°æ—¶ï¼Œå†…å­˜å ç”¨ä¸€ç›´å¾ˆç¨³å®šï¼Œæ²¡æœ‰å‡ºç°å†…å­˜æ³„æ¼æˆ– CPU é£™é«˜çš„æƒ…å†µã€‚</p>
<ol>
<li><strong>å†…æ ¸è°ƒåº¦ä¼˜åŒ–</strong></li>
</ol>
<p>5.10 å†…æ ¸åœ¨å®¹å™¨åœºæ™¯ä¸‹çš„è¡¨ç°ç¡®å®ä¸é”™ã€‚Pod çš„å¯åŠ¨é€Ÿåº¦å¾ˆå¿«ï¼Œä» <code>ContainerCreating</code> åˆ° <code>Running</code> åªéœ€è¦å‡ ç§’é’Ÿã€‚</p>
<p>æˆ‘ä¹‹å‰åœ¨ CentOS 7ï¼ˆ3.10 å†…æ ¸ï¼‰ä¸Šè¯•è¿‡ K8sï¼ŒPod å¯åŠ¨æ˜æ˜¾è¦æ…¢ä¸€äº›ã€‚openEuler çš„ 5.10 å†…æ ¸ï¼Œåº”è¯¥æ˜¯åšäº†ä¸å°‘é’ˆå¯¹ cgroup å’Œ namespace çš„ä¼˜åŒ–ã€‚</p>
<ol>
<li><strong>èµ„æºç®¡ç†æ•ˆç‡é«˜</strong></li>
</ol>
<p>ç³»ç»Ÿæœ¬èº«å ç”¨çš„èµ„æºå¾ˆå°‘ã€‚æˆ‘ç”¨ <code>free -h</code> çœ‹äº†ä¸‹ï¼Œæ•´ä¸ªç³»ç»Ÿï¼ˆåŒ…æ‹¬ K3sã€WordPressã€Nextcloudï¼‰åªç”¨äº† 4GB å·¦å³å†…å­˜ï¼Œè¿˜æœ‰ 12GB å¯ç”¨ã€‚</p>
<p>è¿™è¯´æ˜ openEuler åœ¨èµ„æºè°ƒåº¦ä¸Šç¡®å®æœ‰ä¼˜åŠ¿ã€‚åŒæ ·çš„ç¡¬ä»¶ï¼Œèƒ½è·‘æ›´å¤šçš„å®¹å™¨ã€‚</p>
<ol>
<li><strong>å®¹å™¨ç”Ÿæ€å®Œå–„</strong></li>
</ol>
<p>K3s ç”¨çš„æ˜¯ containerd ä½œä¸ºå®¹å™¨è¿è¡Œæ—¶ï¼Œå’Œ openEuler çš„é›†æˆæ²¡æœ‰ä»»ä½•é—®é¢˜ã€‚é•œåƒæ‹‰å–ã€å®¹å™¨å¯åŠ¨ã€ç½‘ç»œé…ç½®ï¼Œéƒ½å¾ˆæµç•…ã€‚</p>
<p>è€Œä¸” openEuler çš„è½¯ä»¶ä»“åº“é‡Œï¼ŒDockerã€containerdã€runc è¿™äº›å®¹å™¨ç›¸å…³çš„åŒ…éƒ½æœ‰ï¼Œç‰ˆæœ¬ä¹Ÿæ¯”è¾ƒæ–°ã€‚ä¸ç”¨æ‹…å¿ƒå…¼å®¹æ€§é—®é¢˜ã€‚</p>
<h3 data-id="heading-21">5.3 ä¸å…¶ä»–å‘è¡Œç‰ˆå¯¹æ¯”</h3>
<p>æˆ‘ä¹‹å‰åœ¨ Ubuntu 20.04 ä¸Šä¹Ÿéƒ¨ç½²è¿‡ K3sï¼Œå¯¹æ¯”ä¸€ä¸‹ï¼š</p>
<p><strong>Ubuntu 20.04</strong>ï¼š</p>
<ul>
<li>ä¼˜ç‚¹ï¼šè½¯ä»¶åŒ…æ–°ï¼Œç¤¾åŒºèµ„æ–™å¤š</li>
<li>ç¼ºç‚¹ï¼šapt æºåœ¨å›½å†…æ…¢ï¼Œç³»ç»Ÿå ç”¨å†…å­˜ç¨å¤šï¼ˆ1GB+ï¼‰</li>
</ul>
<p><strong>openEuler 22.03 LTS-SP1</strong>ï¼š</p>
<ul>
<li>ä¼˜ç‚¹ï¼šç³»ç»Ÿå ç”¨å°‘ï¼Œæ€§èƒ½å¥½ï¼Œdnf æºå¿«</li>
<li>ç¼ºç‚¹ï¼šç¤¾åŒºèµ„æ–™ç›¸å¯¹å°‘ä¸€äº›ï¼ˆä½†åœ¨å¿«é€Ÿå¢é•¿ï¼‰</li>
</ul>
<h2 data-id="heading-22">å…­ã€ä» Docker åˆ° K3s çš„æ„Ÿæ‚Ÿ</h2>
<h3 data-id="heading-23">6.1 æŠ€æœ¯è¿›é˜¶çš„æ”¶è·</h3>
<p>è¿™æ¬¡ä» Docker Compose è·¨åˆ° K3sï¼Œå­¦åˆ°äº†ä¸å°‘ä¸œè¥¿ã€‚</p>
<p><strong>Deploymentã€ReplicaSetã€Pod çš„å…³ç³»</strong>ï¼š</p>
<ul>
<li>Deployment æ˜¯å£°æ˜å¼çš„éƒ¨ç½²é…ç½®</li>
<li>ReplicaSet è´Ÿè´£ç»´æŠ¤ Pod çš„å‰¯æœ¬æ•°é‡</li>
<li>Pod æ˜¯å®é™…è¿è¡Œå®¹å™¨çš„åœ°æ–¹</li>
</ul>
<p>è¿™ç§åˆ†å±‚è®¾è®¡ï¼Œæ¯” Docker Compose çµæ´»å¤šäº†ã€‚æƒ³è¦æ‰©å®¹ï¼Ÿæ”¹ Deployment çš„ replicas å°±è¡Œã€‚æƒ³è¦æ»šåŠ¨æ›´æ–°ï¼ŸDeployment è‡ªåŠ¨å¸®ä½ æå®šã€‚</p>
<p><strong>Service çš„ç½‘ç»œæ¨¡å‹</strong>ï¼š</p>
<ul>
<li>ClusterIPï¼šé›†ç¾¤å†…éƒ¨è®¿é—®</li>
<li>NodePortï¼šä»èŠ‚ç‚¹ç«¯å£è®¿é—®</li>
<li>LoadBalancerï¼šäº‘å¹³å°çš„è´Ÿè½½å‡è¡¡å™¨ï¼ˆæœ¬åœ°ç¯å¢ƒç”¨ä¸äº†ï¼‰</li>
</ul>
<p>è¿™å¥—ç½‘ç»œæ¨¡å‹è™½ç„¶å¤æ‚ï¼Œä½†å¾ˆå¼ºå¤§ã€‚å¤šä¸ªæœåŠ¡ä¹‹é—´çš„é€šä¿¡ï¼Œé€šè¿‡ Service åç§°å°±èƒ½äº’ç›¸è®¿é—®ï¼Œä¸ç”¨ç®¡ IP åœ°å€ã€‚</p>
<p><strong>å£°æ˜å¼é…ç½®çš„é­…åŠ›</strong>ï¼š</p>
<p>K8s çš„æ ¸å¿ƒç†å¿µæ˜¯"å£°æ˜å¼"ã€‚æˆ‘å‘Šè¯‰ K8s æˆ‘æƒ³è¦ä»€ä¹ˆçŠ¶æ€ï¼ŒK8s è´Ÿè´£æŠŠå®é™…çŠ¶æ€è°ƒæ•´åˆ°æœŸæœ›çŠ¶æ€ã€‚</p>
<p>æ¯”å¦‚æˆ‘å£°æ˜ Deployment çš„ replicas æ˜¯ 3ï¼ŒK8s å°±ä¼šç¡®ä¿å§‹ç»ˆæœ‰ 3 ä¸ª Pod åœ¨è¿è¡Œã€‚æœ‰ Pod æŒ‚äº†ï¼Ÿè‡ªåŠ¨é‡å¯ã€‚èŠ‚ç‚¹æŒ‚äº†ï¼Ÿè‡ªåŠ¨åœ¨å…¶ä»–èŠ‚ç‚¹å¯åŠ¨ã€‚</p>
<p>è¿™ç§æ€è·¯å’Œ Docker çš„"å‘½ä»¤å¼"å®Œå…¨ä¸åŒã€‚Docker æ˜¯ä½ å‘Šè¯‰å®ƒåšä»€ä¹ˆï¼Œå®ƒå°±åšä»€ä¹ˆã€‚K8s æ˜¯ä½ å‘Šè¯‰å®ƒè¦ä»€ä¹ˆï¼Œå®ƒè‡ªå·±æƒ³åŠæ³•ã€‚</p>
<h3 data-id="heading-24">6.2 openEuler çš„äº‘åŸç”Ÿèƒ½åŠ›</h3>
<p>é€šè¿‡è¿™æ¬¡å®æˆ˜ï¼Œæˆ‘å¯¹ openEuler 22.03 LTS-SP1 åœ¨äº‘åŸç”Ÿåœºæ™¯çš„èƒ½åŠ›æœ‰äº†æ›´å…¨é¢çš„è®¤è¯†ã€‚</p>
<p><strong>å†…æ ¸ä¼˜åŒ–æ˜¯åŸºç¡€</strong>ï¼š</p>
<p>5.10 LTS å†…æ ¸ç¡®å®å¾ˆç¨³ã€‚å®¹å™¨å¯åŠ¨å¿«ã€è°ƒåº¦å‡†ã€èµ„æºéš”ç¦»å¥½ã€‚</p>
<p><strong>NestOS æ˜¯äº®ç‚¹</strong>ï¼š</p>
<p>è™½ç„¶è¿™æ¬¡æ²¡ç”¨ NestOSï¼Œä½†çŸ¥é“ openEuler æœ‰ä¸“é—¨ä¸ºå®¹å™¨è®¾è®¡çš„æ“ä½œç³»ç»Ÿï¼Œè¯´æ˜ç¤¾åŒºåœ¨äº‘åŸç”Ÿæ–¹å‘æ˜¯è®¤çœŸçš„ã€‚ä»¥åæœ‰æœºä¼šä¸€å®šè¦è¯•è¯• NestOS + K3s çš„ç»„åˆã€‚</p>
<p><strong>ç”Ÿæ€åœ¨å®Œå–„</strong>ï¼š</p>
<p>openEuler çš„è½¯ä»¶åŒ…ç”Ÿæ€è¶Šæ¥è¶Šå¥½äº†ã€‚K3sã€Dockerã€containerd è¿™äº›å®¹å™¨ç›¸å…³çš„è½¯ä»¶éƒ½èƒ½é¡ºåˆ©å®‰è£…ã€‚ç¤¾åŒºæ–‡æ¡£ä¹Ÿåœ¨ä¸æ–­å®Œå–„ï¼Œé‡åˆ°é—®é¢˜èƒ½æ‰¾åˆ°è§£å†³æ–¹æ¡ˆã€‚</p>
<h2 data-id="heading-25">ä¸ƒã€æ€»ç»“</h2>
<p>è¿™æ¬¡ä» Docker Compose è·¨åˆ° K3sï¼Œç®—æ˜¯åœ¨äº‘åŸç”Ÿçš„è·¯ä¸Šåˆè¿›äº†ä¸€æ­¥ã€‚K3s çš„è½»é‡å’Œæ˜“ç”¨ï¼Œè®©æˆ‘æ²¡æœ‰ä»€ä¹ˆå¿ƒç†è´Ÿæ‹…å°±ä¸Šæ‰‹äº† K8sã€‚</p>
<p>openEuler 22.03 LTS-SP1 åœ¨æ•´ä¸ªè¿‡ç¨‹ä¸­çš„è¡¨ç°ï¼Œè¶…å‡ºäº†æˆ‘çš„é¢„æœŸã€‚å†…æ ¸ç¨³å®šã€èµ„æºå ç”¨ä½ã€å®¹å™¨ç”Ÿæ€å®Œå–„ï¼Œè¿™äº›ä¼˜åŠ¿åœ¨ K3s åœºæ™¯ä¸‹ä½“ç°å¾—å¾ˆæ˜æ˜¾ã€‚</p>
<p>ä½œä¸ºä¸€ä¸ªä» CentOSã€Ubuntu è½¬åˆ° openEuler çš„ç”¨æˆ·ï¼Œæˆ‘è¶Šæ¥è¶Šè§‰å¾—ï¼šopenEuler ä¸ä»…ä»…æ˜¯"èƒ½ç”¨"ï¼Œè€Œæ˜¯"å¥½ç”¨"ã€‚ç‰¹åˆ«æ˜¯åœ¨äº‘åŸç”Ÿåœºæ™¯ï¼ŒopenEuler å·²ç»æ˜¯ä¸€ä¸ªå¾ˆæˆç†Ÿçš„é€‰æ‹©äº†ã€‚</p>
<p><strong>ç›¸å…³èµ„æº</strong>ï¼š</p>
<ul>
<li>openEuler å®˜ç½‘ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.openeuler.org%2F" target="_blank" title="https://www.openeuler.org/" ref="nofollow noopener noreferrer">www.openEuler.org/</a></li>
<li>openEuler æ–‡æ¡£ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.openeuler.openatom.cn%2Fzh%2F" target="_blank" title="https://docs.openeuler.openatom.cn/zh/" ref="nofollow noopener noreferrer">docs.openEuler.openatom.cn/zh/</a></li>
<li>K3s å®˜ç½‘ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fk3s.io%2F" target="_blank" title="https://k3s.io/" ref="nofollow noopener noreferrer">k3s.io/</a></li>
<li>K3s ä¸­æ–‡æ–‡æ¡£ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.rancher.cn%2Fk3s%2F" target="_blank" title="https://docs.rancher.cn/k3s/" ref="nofollow noopener noreferrer">docs.rancher.cn/k3s/</a></li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[openEuler äº‘åŸç”Ÿå®æˆ˜ï¼šä½¿ç”¨ Docker Compose å¿«é€Ÿéƒ¨ç½²ä¼ä¸šåº”ç”¨]]></title>    <link>https://juejin.cn/post/7579215538271256586</link>    <guid>https://juejin.cn/post/7579215538271256586</guid>    <pubDate>2025-12-03T04:28:52.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7579215538271256586" data-draft-id="7579164768063848475" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="openEuler äº‘åŸç”Ÿå®æˆ˜ï¼šä½¿ç”¨ Docker Compose å¿«é€Ÿéƒ¨ç½²ä¼ä¸šåº”ç”¨"/> <meta itemprop="keywords" content="æœåŠ¡å™¨,æ“ä½œç³»ç»Ÿ"/> <meta itemprop="datePublished" content="2025-12-03T04:28:52.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Nturmoils"/> <meta itemprop="url" content="https://juejin.cn/user/1722263248317024"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            openEuler äº‘åŸç”Ÿå®æˆ˜ï¼šä½¿ç”¨ Docker Compose å¿«é€Ÿéƒ¨ç½²ä¼ä¸šåº”ç”¨
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1722263248317024/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Nturmoils
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-03T04:28:52.000Z" title="Wed Dec 03 2025 04:28:52 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-03
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»12åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">ä¸€ã€openEulerï¼šæ“ä½œç³»ç»Ÿçš„äº‘åŸç”Ÿä¹‹é€‰</h2>
<p>æœ€è¿‘åœ¨ç ”ç©¶äº‘åŸç”ŸæŠ€æœ¯ï¼Œæ­£å¥½çœ‹åˆ° openEuler è¿™ä¸ªæ“ä½œç³»ç»Ÿåœ¨ç¤¾åŒºé‡Œè®¨è®ºæŒºå¤šçš„ã€‚openEuler æ˜¯ç”±åä¸ºä¸»å¯¼çš„å¼€æºæ“ä½œç³»ç»Ÿé¡¹ç›®ï¼Œé¢å‘ä¼ä¸šçº§æœåŠ¡å™¨ã€äº‘è®¡ç®—ã€è¾¹ç¼˜è®¡ç®—ç­‰åœºæ™¯è®¾è®¡ã€‚ä½œä¸ºå¼€æ”¾åŸå­å¼€æºåŸºé‡‘ä¼šçš„å­µåŒ–é¡¹ç›®ï¼ŒopenEuler å·²ç»åœ¨é‡‘èã€ç”µä¿¡ã€èƒ½æºç­‰å¤šä¸ªè¡Œä¸šå¾—åˆ°å¹¿æ³›åº”ç”¨ã€‚</p>
<p>æˆ‘é€‰æ‹© openEuler æ¥åšäº‘åŸç”Ÿå®æˆ˜ï¼Œä¸»è¦æ˜¯çœ‹ä¸­äº†è¿™å‡ ç‚¹ï¼š</p>
<ul>
<li><strong>ç¨³å®šå¯é </strong>ï¼šä¼ä¸šçº§å†…æ ¸ä¼˜åŒ–ï¼Œç”Ÿäº§ç¯å¢ƒå¯ç”¨</li>
<li><strong>ç”Ÿæ€å®Œå–„</strong>ï¼šæ”¯æŒä¸»æµå¼€å‘å·¥å…·å’Œå®¹å™¨æŠ€æœ¯</li>
<li><strong>ç¤¾åŒºæ´»è·ƒ</strong>ï¼šæ–‡æ¡£é½å…¨ï¼Œé—®é¢˜èƒ½å¿«é€Ÿæ‰¾åˆ°è§£å†³æ–¹æ¡ˆ</li>
</ul>
<p><strong>ç›¸å…³èµ„æº</strong>ï¼š</p>
<ul>
<li>openEuler å®˜ç½‘ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.openeuler.org%2F" target="_blank" title="https://www.openeuler.org/" ref="nofollow noopener noreferrer">www.openEuler.org/</a></li>
<li>å®˜æ–¹æ–‡æ¡£ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.openeuler.openatom.cn%2Fzh%2F" target="_blank" title="https://docs.openeuler.openatom.cn/zh/" ref="nofollow noopener noreferrer">docs.openEuler.openatom.cn/zh/</a></li>
<li>å¼€æºç¤¾åŒºï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fgitee.com%2Fopeneuler" target="_blank" title="https://gitee.com/openeuler" ref="nofollow noopener noreferrer">gitee.com/openEuler</a></li>
</ul>
<p>è¿™æ¬¡å®æˆ˜æˆ‘æ‰“ç®—åœ¨ openEuler ä¸Šæ­å»ºä¸€å¥—å®¹å™¨åŒ–çš„åº”ç”¨ç¯å¢ƒï¼Œä½¿ç”¨ Docker Compose éƒ¨ç½²ä¸€ä¸ªå®Œæ•´çš„ WordPress åšå®¢ç³»ç»Ÿï¼ˆåŒ…å« Web æœåŠ¡å’Œæ•°æ®åº“ï¼‰ã€‚æ•´ä¸ªè¿‡ç¨‹æˆ‘ä¼šè®°å½•æ¯ä¸€æ­¥æ“ä½œï¼Œåˆ†äº«ä¸€äº›è¸©è¿‡çš„å‘å’Œè§£å†³æ–¹æ¡ˆã€‚</p>
<h2 data-id="heading-1">äºŒã€ç¯å¢ƒå‡†å¤‡ï¼šé€‰æ‹©å’Œé…ç½®æœåŠ¡å™¨</h2>
<h3 data-id="heading-2">2.1 æœåŠ¡å™¨é…ç½®</h3>
<p>è¿™æ¬¡å®æˆ˜æˆ‘å‡†å¤‡äº†ä¸€å°äº‘æœåŠ¡å™¨ï¼Œé…ç½®å¦‚ä¸‹ï¼š</p>
<ul>
<li><strong>CPU</strong>ï¼š16æ ¸</li>
<li><strong>å†…å­˜</strong>ï¼š16GB</li>
<li><strong>å­˜å‚¨</strong>ï¼š40GB SSD</li>
<li><strong>æ“ä½œç³»ç»Ÿ</strong>ï¼šopenEuler 22.03 (LTS-SP1)</li>
</ul>
<h4 data-id="heading-3">å®‰è£… openEuler ç³»ç»Ÿ</h4>
<p>é¦–å…ˆéœ€è¦åœ¨äº‘æœåŠ¡å™¨ä¸Šå®‰è£… openEuler æ“ä½œç³»ç»Ÿã€‚åœ¨æ§åˆ¶å°åˆ›å»ºæœåŠ¡å™¨æ—¶ï¼Œé€‰æ‹© openEuler é•œåƒï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨å®Œæˆå®‰è£…ã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/14bcd68a61ad4c1080d3e9da0238bc70~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTnR1cm1vaWxz:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765340932&amp;x-signature=LuhEkLBAcybT%2FjYb0lukaIRtKPc%3D" alt="" loading="lazy"/></p>
<p>ä»ä¸Šå›¾å¯ä»¥çœ‹åˆ°ï¼Œæˆ‘é€‰æ‹©çš„æ˜¯ openEuler 22.03 (LTS-SP1) ç‰ˆæœ¬è¿›è¡Œç³»ç»Ÿå®‰è£…ã€‚æ•´ä¸ªå®‰è£…è¿‡ç¨‹æ˜¯è‡ªåŠ¨åŒ–çš„ï¼Œéå¸¸æ–¹ä¾¿ã€‚LTS-SP1 æ˜¯é•¿æœŸæ”¯æŒç‰ˆæœ¬çš„ç¬¬ä¸€ä¸ªæœåŠ¡åŒ…ï¼ˆService Pack 1ï¼‰ï¼Œæä¾›äº†æ›´å¤šçš„ç¨³å®šæ€§æ›´æ–°å’Œbugä¿®å¤ï¼Œé€‚åˆç”Ÿäº§ç¯å¢ƒé•¿æœŸä½¿ç”¨ã€‚</p>
<p>æœåŠ¡å™¨åˆ›å»ºè¿‡ç¨‹å¾ˆç®€å•ï¼Œé…ç½®å¥½è§„æ ¼å’Œç½‘ç»œåï¼Œå¤§æ¦‚ç­‰äº†å‡ åˆ†é’Ÿç³»ç»Ÿå°±å®‰è£…å¥½äº†ã€‚åˆ›å»ºå®Œæˆåï¼Œæˆ‘ç”¨ SSH å¯†é’¥ç™»å½•åˆ°æœåŠ¡å™¨ï¼Œå¼€å§‹åç»­çš„é…ç½®å·¥ä½œã€‚</p>
<h4 data-id="heading-4">æŸ¥çœ‹ç³»ç»Ÿä¿¡æ¯</h4>
<p>ç™»å½•æœåŠ¡å™¨åï¼Œå…ˆç¡®è®¤ä¸€ä¸‹ç³»ç»Ÿæ˜¯å¦æ­£ç¡®å®‰è£…ï¼š</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># æŸ¥çœ‹ç³»ç»Ÿç‰ˆæœ¬</span>
<span class="hljs-built_in">cat</span> /etc/os-release
â€‹
<span class="hljs-comment"># æŸ¥çœ‹å†…æ ¸ç‰ˆæœ¬</span>
<span class="hljs-built_in">uname</span> -a
</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/746362303aee4e55a92105e4a68e7bb6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTnR1cm1vaWxz:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765340932&amp;x-signature=PAIf366l89EhU285MbombZbbpCM%3D" alt="" loading="lazy"/></p>
<p>ä»ä¸Šå›¾å¯ä»¥çœ‹åˆ°æœåŠ¡å™¨çš„åŸºæœ¬ä¿¡æ¯ã€‚æ‰§è¡Œäº†ä¸‰ä¸ªå‘½ä»¤ï¼š</p>
<ul>
<li><code>cat /etc/os-release</code>ï¼šæ˜¾ç¤ºç³»ç»Ÿç‰ˆæœ¬ä¸º <strong>openEuler 22.03 (LTS-SP1)</strong></li>
<li><code>uname -a</code>ï¼šæ˜¾ç¤ºå†…æ ¸ç‰ˆæœ¬ä¸º <strong>5.10.0-136.12.0.86.0e2203sp1</strong></li>
<li><code>hostname</code>ï¼šæ˜¾ç¤ºä¸»æœºåä¸º <strong>ser563963324474</strong></li>
</ul>
<p>è¿™ä¸ªç‰ˆæœ¬çš„å†…æ ¸è™½ç„¶æ˜¯ 5.10 ç³»åˆ—ï¼Œä½†ç»è¿‡äº† openEuler å›¢é˜Ÿçš„æ·±åº¦ä¼˜åŒ–ï¼Œå¯¹å®¹å™¨æŠ€æœ¯çš„æ”¯æŒå¾ˆå®Œå–„ã€‚ç³»ç»Ÿç‰ˆæœ¬ã€å†…æ ¸ä¿¡æ¯ã€ä¸»æœºåç­‰å…³é”®é…ç½®éƒ½æ¸…æ™°åœ°å±•ç¤ºå‡ºæ¥äº†ã€‚</p>
<h3 data-id="heading-5">2.2 æŸ¥çœ‹ç¡¬ä»¶é…ç½®</h3>
<p>æ¥ä¸‹æ¥ç¡®è®¤ä¸€ä¸‹ç¡¬ä»¶é…ç½®æ˜¯å¦ç¬¦åˆé¢„æœŸã€‚æˆ‘ä¸»è¦å…³æ³¨ CPUã€å†…å­˜å’Œç£ç›˜è¿™å‡ é¡¹ï¼š</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># æŸ¥çœ‹ CPU ä¿¡æ¯</span>
lscpu | grep -E <span class="hljs-string">"Architecture|CPU(s)|Model name"</span>
â€‹
<span class="hljs-comment"># æŸ¥çœ‹å†…å­˜ä¿¡æ¯</span>
free -h
â€‹
<span class="hljs-comment"># æŸ¥çœ‹ç£ç›˜ä¿¡æ¯</span>
<span class="hljs-built_in">df</span> -h
</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3e12435d321e40249d7a08a4eb73a325~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTnR1cm1vaWxz:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765340932&amp;x-signature=3wdnK9ZJBbv%2BwejkfFss%2B3xP0ig%3D" alt="" loading="lazy"/></p>
<p>ä»å›¾ä¸­å¯ä»¥ç¡®è®¤ï¼ŒæœåŠ¡å™¨æ˜¯ 16æ ¸16GB çš„é…ç½®ã€‚CPU å‹å·æ˜¯ <strong>Intel</strong> <strong>Xeon</strong> <strong>Gold 6138 @ 2.00GHz</strong>ï¼Œæ¶æ„æ˜¯ x86_64ã€‚å†…å­˜æ€»å…± 15Giï¼ˆçº¦15.6GBï¼‰ï¼Œå¯ç”¨å†…å­˜ 14Giï¼Œéå¸¸å……è£•ã€‚ç£ç›˜æ–¹é¢ï¼Œæ ¹ç›®å½•æŒ‚è½½äº† 40GB çš„ç©ºé—´ï¼Œç›®å‰ä½¿ç”¨äº† 1.6GBï¼Œå‰©ä½™ 37GBï¼Œç©ºé—´å¾ˆå……è¶³ã€‚</p>
<p>è¿™ä¸ªé…ç½®å¯¹äºå®¹å™¨åŒ–åº”ç”¨æ¥è¯´éå¸¸å……è£•ã€‚16æ ¸å¿ƒçš„ CPU å¯ä»¥è½»æ¾åº”å¯¹é«˜å¹¶å‘è¯·æ±‚ï¼Œ16GB å†…å­˜è·‘å‡ åä¸ªå®¹å™¨éƒ½æ²¡é—®é¢˜ã€‚å³ä½¿åç»­è¦æ‰©å±•æ›´å¤šæœåŠ¡ï¼Œèµ„æºä¹Ÿå®Œå…¨å¤Ÿç”¨ã€‚</p>
<h2 data-id="heading-6">ä¸‰ã€ç³»ç»Ÿåˆå§‹åŒ–</h2>
<h3 data-id="heading-7">3.1 æ›´æ–°ç³»ç»ŸåŒ…</h3>
<p>æœåŠ¡å™¨åˆšåˆ›å»ºå¥½ï¼Œç³»ç»ŸåŒ…å¯èƒ½ä¸æ˜¯æœ€æ–°çš„ï¼Œæ‰€ä»¥ç¬¬ä¸€æ­¥å…ˆåšä¸€æ¬¡å…¨é‡æ›´æ–°ã€‚è¿™æ ·å¯ä»¥ç¡®ä¿ç³»ç»Ÿçš„å®‰å…¨æ€§å’Œç¨³å®šæ€§ï¼Œä¹Ÿèƒ½é¿å…ä¸€äº›å·²çŸ¥çš„bugã€‚</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># æ›´æ–°ç³»ç»Ÿæ‰€æœ‰è½¯ä»¶åŒ…</span>
sudo dnf update -y
</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1903ee93ff7c4991b1facea56b459679~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTnR1cm1vaWxz:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765340932&amp;x-signature=glHXQ%2BjBxQo90GWrcuaxYwQoM8g%3D" alt="" loading="lazy"/></p>
<p>æ›´æ–°è¿‡ç¨‹å¤§æ¦‚èŠ±äº†3-5åˆ†é’Ÿï¼Œç³»ç»Ÿä¸‹è½½å¹¶å®‰è£…äº†ä¸€äº›æ›´æ–°åŒ…ã€‚ä»æˆªå›¾å¯ä»¥çœ‹åˆ°æ›´æ–°å‘½ä»¤æ‰§è¡Œå®Œæˆï¼Œæç¤º"Complete!"ï¼Œè¯´æ˜ç³»ç»Ÿå·²ç»æ˜¯æœ€æ–°çŠ¶æ€äº†ã€‚</p>
<p>è¿™é‡Œè¯´ä¸€ä¸‹ openEuler ä½¿ç”¨çš„åŒ…ç®¡ç†å™¨æ˜¯ <code>dnf</code>ï¼Œè¿™ä¸ªæ˜¯ <code>yum</code> çš„ä¸‹ä¸€ä»£å·¥å…·ï¼Œé€Ÿåº¦æ›´å¿«ï¼Œä¾èµ–å¤„ç†ä¹Ÿæ›´æ™ºèƒ½ã€‚å¦‚æœä½ ä¹‹å‰ç”¨è¿‡ CentOS æˆ– Fedoraï¼Œä¼šæ„Ÿè§‰å¾ˆç†Ÿæ‚‰ã€‚</p>
<h2 data-id="heading-8">å››ã€Docker å®‰è£…ï¼šé‡åˆ°çš„å‘å’Œè§£å†³æ–¹æ³•</h2>
<h3 data-id="heading-9">4.1 åˆæ¬¡å®‰è£…ï¼ˆç‰ˆæœ¬å¤ªä½ï¼‰</h3>
<p>æŒ‰ç…§æƒ¯ä¾‹ï¼Œæˆ‘ç›´æ¥ç”¨ dnf å®‰è£… Dockerï¼š</p>
<p>sudo dnf install -y docker</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3ea857c8224f49f88e26ad4b12e295fb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTnR1cm1vaWxz:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765340932&amp;x-signature=WczRBbPznTO7QGXzb6f2hu28%2FxY%3D" alt="" loading="lazy"/></p>
<p>å®‰è£…å€’æ˜¯å¾ˆé¡ºåˆ©ï¼Œä½†æ˜¯æŸ¥çœ‹ç‰ˆæœ¬çš„æ—¶å€™å‘ç°äº†é—®é¢˜ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">docker --version
<span class="hljs-comment"># Docker version 18.09.0, build 9da17b5</span>
</code></pre>
<p>Docker 18.09.0 æ˜¯ 2018 å¹´çš„ç‰ˆæœ¬ï¼Œå·²ç»éå¸¸è€äº†ã€‚è¿™ä¸ªç‰ˆæœ¬ä¸ä»…ç¼ºå°‘å¾ˆå¤šæ–°ç‰¹æ€§ï¼Œè¿˜æœ‰ä¸€äº›å·²çŸ¥çš„bugï¼Œç”Ÿäº§ç¯å¢ƒä¸å»ºè®®ä½¿ç”¨ã€‚æˆ‘éœ€è¦çš„æ˜¯è‡³å°‘ 20.x ä»¥ä¸Šçš„ç‰ˆæœ¬ï¼Œæœ€å¥½æ˜¯æœ€æ–°çš„ 24.x æˆ– 25.xã€‚</p>
<p>äºæ˜¯æˆ‘å†³å®šå¸è½½è¿™ä¸ªæ—§ç‰ˆæœ¬ï¼Œæ”¹ç”¨ Docker å®˜æ–¹çš„æºæ¥å®‰è£…æœ€æ–°ç‰ˆã€‚</p>
<h3 data-id="heading-10">4.2 å‡çº§åˆ°æœ€æ–°ç‰ˆ Docker</h3>
<p>åœ¨ç½‘ä¸Šæœç´¢äº†ä¸€ä¸‹ openEuler å®‰è£… Docker çš„æ–¹æ³•ï¼Œæ‰¾åˆ°äº†ä¸€ä¸ªå¾ˆæœ‰ç”¨çš„è§£å†³æ–¹æ¡ˆã€‚æ ¸å¿ƒæ€è·¯æ˜¯ï¼š<strong>openEuler ä¸</strong> <strong>CentOS</strong> <strong>7 å…¼å®¹</strong>ï¼Œæ‰€ä»¥å¯ä»¥ä½¿ç”¨ Docker å®˜æ–¹çš„ CentOS æºã€‚</p>
<p>é¦–å…ˆåœæ­¢å¹¶å¸è½½æ—§ç‰ˆæœ¬ï¼š</p>
<pre><code class="hljs language-arduino" lang="arduino">sudo systemctl stop docker
sudo dnf remove -y docker docker-common
</code></pre>
<p>ç„¶åæ·»åŠ  Docker å®˜æ–¹æºï¼š</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-meta"># æ·»åŠ  Docker CE ä»“åº“</span>
sudo yum-config-manager --<span class="hljs-keyword">add</span>-repo https:<span class="hljs-comment">//download.docker.com/linux/centos/docker-ce.repo</span>
</code></pre>
<p>è¿™é‡Œä¼šé‡åˆ°ä¸€ä¸ªé—®é¢˜ï¼šopenEuler çš„ç‰ˆæœ¬å·ï¼ˆæ¯”å¦‚ 22.03LTS_SP1ï¼‰Docker å®˜æ–¹æºé‡Œæ²¡æœ‰å¯¹åº”çš„ç›®å½•ã€‚è§£å†³åŠæ³•æ˜¯ä¿®æ”¹ä»“åº“é…ç½®æ–‡ä»¶ï¼ŒæŠŠç‰ˆæœ¬å·æ›¿æ¢æˆ CentOS 7ã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/dd675e50ccee4063ab691a68a1b38f92~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTnR1cm1vaWxz:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765340932&amp;x-signature=nQlFQ3bALKcCJgkUM4oOmZAEzZ8%3D" alt="" loading="lazy"/></p>
<p>è¿™é‡Œä¹Ÿå¯ä»¥ç”¨ sed å‘½ä»¤æ‰¹é‡æ›¿æ¢äº†é…ç½®æ–‡ä»¶ä¸­çš„å˜é‡ï¼š</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># å°† $releasever æ›¿æ¢ä¸º 7</span>
sudo sed -i <span class="hljs-string">'s/$releasever/7/g'</span> /etc/yum.repos.d/docker-ce.repo
</code></pre>
<p>æ›¿æ¢å®Œæˆåï¼ŒéªŒè¯ä¸€ä¸‹ä¿®æ”¹æ˜¯å¦ç”Ÿæ•ˆï¼š</p>
<p>cat /etc/yum.repos.d/docker-ce.repo | grep baseurl</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d6680af234bf4dd491b25c3869fd11da~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTnR1cm1vaWxz:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765340932&amp;x-signature=KjM0Y8CcYeRfPIuOaR7m81yopN8%3D" alt="" loading="lazy"/></p>
<p>ä»æˆªå›¾å¯ä»¥çœ‹åˆ°ï¼Œbaseurl å·²ç»å˜æˆäº† <code>https://download.docker.com/linux/centos/7/x86_64/stable</code>ï¼Œè¯´æ˜ä¿®æ”¹æˆåŠŸäº†ã€‚</p>
<h3 data-id="heading-11">4.3 æŸ¥çœ‹å¯å®‰è£…çš„ç‰ˆæœ¬</h3>
<p>ç°åœ¨å¯ä»¥çœ‹çœ‹æœ‰å“ªäº› Docker ç‰ˆæœ¬å¯ä»¥å®‰è£…äº†ï¼š</p>
<p>yum list docker-ce --showduplicates | sort -r | head -20</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a80828e066c24720babe125287ef9d6d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTnR1cm1vaWxz:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765340932&amp;x-signature=FlIRpzG2ykcJXNTgeifobBtvn1Q%3D" alt="" loading="lazy"/></p>
<p>å¤ªå¥½äº†ï¼å¯ä»¥çœ‹åˆ°æœ‰å¾ˆå¤šç‰ˆæœ¬å¯é€‰ï¼Œä» 24.x åˆ°æœ€æ–°çš„ 26.x éƒ½æœ‰ã€‚æˆ‘é€‰æ‹©å®‰è£…æ¯”è¾ƒæ–°ä¸”ç¨³å®šçš„ 26.1.4 ç‰ˆæœ¬ï¼š</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># å®‰è£… Docker CE æœ€æ–°ç‰ˆ</span>
sudo yum -y install docker-ce docker-ce-cli containerd.io
â€‹
<span class="hljs-comment"># å¯åŠ¨ Docker æœåŠ¡</span>
sudo systemctl start docker
sudo systemctl <span class="hljs-built_in">enable</span> docker
â€‹
<span class="hljs-comment"># æŸ¥çœ‹ç‰ˆæœ¬</span>
docker --version
</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c85693ae67b84cccbcef58b61c9f7b4a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTnR1cm1vaWxz:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765340932&amp;x-signature=mEDqhhvu0ReiMUgu%2BIgagl7ymzU%3D" alt="" loading="lazy"/></p>
<p>å®Œç¾ï¼Docker å·²ç»å‡çº§åˆ° 26.1.4 ç‰ˆæœ¬äº†ï¼Œè¿™æ˜¯ä¸€ä¸ªæ¯”è¾ƒæ–°ä¸”ç¨³å®šçš„ç‰ˆæœ¬ã€‚åŒæ—¶å¯ä»¥çœ‹åˆ° Docker æœåŠ¡çŠ¶æ€æ˜¯ <code>active (running)</code>ï¼Œè¯´æ˜æœåŠ¡å·²ç»æ­£å¸¸å¯åŠ¨äº†ã€‚</p>
<p>è¿™é‡Œè¸©çš„å‘æ€»ç»“ä¸€ä¸‹ï¼š</p>
<ol>
<li>openEuler é»˜è®¤ä»“åº“çš„ Docker ç‰ˆæœ¬å¤ªè€</li>
<li>Docker å®˜æ–¹æºéœ€è¦ä¿®æ”¹é…ç½®æ‰èƒ½ç”¨</li>
<li>æ›¿æ¢ç‰ˆæœ¬å·ä¸º 7 æ˜¯å…³é”®æ“ä½œ</li>
</ol>
<h3 data-id="heading-12">4.4 æµ‹è¯• Docker</h3>
<p>Docker å®‰è£…å¥½äº†ï¼Œæµ‹è¯•ä¸€ä¸‹æ˜¯å¦èƒ½æ­£å¸¸å·¥ä½œï¼š</p>
<p>sudo docker run hello-world</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e238709f7b34452583a03ecf097c3ba5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTnR1cm1vaWxz:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765340932&amp;x-signature=2FUJo4VmCn5tldrHfT17XGbyDc8%3D" alt="" loading="lazy"/></p>
<p>çœ‹åˆ° "Hello from Docker!" çš„æ¬¢è¿ä¿¡æ¯ï¼Œè¯´æ˜ Docker å·²ç»å¯ä»¥æ­£å¸¸æ‹‰å–é•œåƒå’Œè¿è¡Œå®¹å™¨äº†ã€‚è¿™ä¸ªæµ‹è¯•é•œåƒå¾ˆå°ï¼Œä¸»è¦å°±æ˜¯è¾“å‡ºä¸€æ®µæ¬¢è¿æ–‡å­—ï¼Œç¡®è®¤ Docker çš„å„ä¸ªç»„ä»¶ï¼ˆå®ˆæŠ¤è¿›ç¨‹ã€å®¢æˆ·ç«¯ã€é•œåƒä»“åº“ï¼‰éƒ½èƒ½æ­£å¸¸å·¥ä½œã€‚</p>
<h2 data-id="heading-13">äº”ã€Docker Compose å®‰è£…</h2>
<p>Docker å•ç‹¬ä½¿ç”¨æ²¡é—®é¢˜äº†ï¼Œæ¥ä¸‹æ¥å®‰è£… Docker Composeã€‚è¿™ä¸ªå·¥å…·å¯ä»¥ç”¨ä¸€ä¸ªé…ç½®æ–‡ä»¶ç®¡ç†å¤šä¸ªå®¹å™¨ï¼Œå¯¹äºéƒ¨ç½²å¤šæœåŠ¡åº”ç”¨éå¸¸æ–¹ä¾¿ã€‚</p>
<h3 data-id="heading-14">5.1 é‡åˆ°çš„é—®é¢˜</h3>
<p>ä¸€å¼€å§‹æˆ‘å°è¯•ç”¨ dnf å®‰è£…ï¼š</p>
<p>sudo dnf install -y docker-compose</p>
<p>å®‰è£…å€’æ˜¯æˆåŠŸäº†ï¼Œä½†ç‰ˆæœ¬æ˜¯ 1.29.2ï¼Œè¿™æ˜¯æ¯”è¾ƒè€çš„ç‰ˆæœ¬ã€‚ç°åœ¨ Docker Compose å·²ç»å‘å±•åˆ° v2.x äº†ï¼Œæ–°ç‰ˆæœ¬ä¸ä»…æ€§èƒ½æ›´å¥½ï¼ŒåŠŸèƒ½ä¹Ÿæ›´å¼ºå¤§ã€‚</p>
<h3 data-id="heading-15">5.2 å®‰è£…æœ€æ–°ç‰ˆ</h3>
<p>äºæ˜¯æˆ‘å†³å®šä» GitHub ä¸‹è½½æœ€æ–°ç‰ˆæœ¬ã€‚æ“ä½œå¾ˆç®€å•ï¼š</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># ä» GitHub ä¸‹è½½æœ€æ–°ç‰ˆ Docker Compose</span>
sudo curl -L <span class="hljs-string">"https://github.com/docker/compose/releases/latest/download/docker-compose-<span class="hljs-subst">$(uname -s)</span>-<span class="hljs-subst">$(uname -m)</span>"</span> -o /usr/local/bin/docker-compose
â€‹
<span class="hljs-comment"># æ·»åŠ æ‰§è¡Œæƒé™</span>
sudo <span class="hljs-built_in">chmod</span> +x /usr/local/bin/docker-compose
â€‹
<span class="hljs-comment"># éªŒè¯ç‰ˆæœ¬</span>
docker-compose --version
</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ff80385009de4f5c9c97b4b88aa41a7a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTnR1cm1vaWxz:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765340932&amp;x-signature=FSwZwWry8S0Kp%2Fu%2BCVVnNDwsQEM%3D" alt="" loading="lazy"/></p>
<p>å®Œç¾ï¼ä»æˆªå›¾å¯ä»¥çœ‹åˆ°ï¼š</p>
<ol>
<li>ä½¿ç”¨ curl ä» GitHub æˆåŠŸä¸‹è½½äº† Docker Compose</li>
<li>ä¸‹è½½çš„æ–‡ä»¶å¤§å°çº¦ 73MBï¼Œä¸‹è½½é€Ÿåº¦è¿˜ä¸é”™</li>
<li>æ·»åŠ æ‰§è¡Œæƒé™åï¼ŒéªŒè¯ç‰ˆæœ¬æ˜¯ <strong>v2.40.3</strong></li>
</ol>
<p>è¿™æ˜¯ç›®å‰ Docker Compose çš„æœ€æ–°ç¨³å®šç‰ˆæœ¬ï¼Œç›¸æ¯” v1.x ç‰ˆæœ¬ï¼Œv2.x æœ‰å¾ˆå¤šæ”¹è¿›ï¼š</p>
<ul>
<li>æ€§èƒ½æ›´å¥½ï¼Œå¯åŠ¨å®¹å™¨æ›´å¿«</li>
<li>æ”¯æŒ GPU èµ„æºç®¡ç†</li>
<li>æ›´å¥½çš„ä¾èµ–å¤„ç†</li>
<li>å®Œå…¨å…¼å®¹ v1.x çš„é…ç½®æ–‡ä»¶</li>
</ul>
<h2 data-id="heading-16">å…­ã€å®æˆ˜ï¼šéƒ¨ç½² WordPress åšå®¢ç³»ç»Ÿ</h2>
<p>ç¯å¢ƒéƒ½å‡†å¤‡å¥½äº†ï¼Œç°åœ¨å¼€å§‹éƒ¨ç½²ä¸€ä¸ªçœŸå®çš„åº”ç”¨ã€‚æˆ‘é€‰æ‹©äº† WordPressï¼ŒåŸå› æœ‰å‡ ä¸ªï¼š</p>
<ol>
<li><strong>ç»å…¸åœºæ™¯</strong>ï¼šWordPress æ˜¯å…¨çƒä½¿ç”¨æœ€å¹¿çš„åšå®¢ç³»ç»Ÿï¼Œå¾ˆæœ‰ä»£è¡¨æ€§</li>
<li><strong>å¤šç»„ä»¶</strong>ï¼šåŒ…å« Web æœåŠ¡å’Œæ•°æ®åº“ï¼Œå¯ä»¥å±•ç¤ºå®¹å™¨ç¼–æ’èƒ½åŠ›</li>
<li><strong>å®ç”¨ä»·å€¼</strong>ï¼šéƒ¨ç½²å®Œå¯ä»¥ç›´æ¥ä½¿ç”¨ï¼Œä¸æ˜¯çº¯ç²¹çš„ Hello World</li>
</ol>
<h3 data-id="heading-17">6.1 åˆ›å»ºé¡¹ç›®ç›®å½•</h3>
<p>å…ˆåˆ›å»ºä¸€ä¸ªé¡¹ç›®ç›®å½•ï¼ŒæŠŠç›¸å…³æ–‡ä»¶éƒ½æ”¾åœ¨è¿™é‡Œã€‚æˆ‘æŒ‰ç…§è‡ªå·±çš„ä¹ æƒ¯åˆ›å»ºäº†ä¸€ä¸ªå±‚çº§åŒ–çš„ç›®å½•ç»“æ„ï¼š</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># åˆ›å»ºé¡¹ç›®ç›®å½•ï¼ˆå¤šå±‚çº§ï¼‰</span>
<span class="hljs-built_in">mkdir</span> -p acowbo/docker-compose-project/wordpress
â€‹
<span class="hljs-comment"># è¿›å…¥ç›®å½•</span>
<span class="hljs-built_in">cd</span> acowbo/docker-compose-project/wordpress
â€‹
<span class="hljs-comment"># ç¡®è®¤å½“å‰è·¯å¾„</span>
<span class="hljs-built_in">pwd</span>
</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b8e45850078445ae892144dfbd5e5893~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTnR1cm1vaWxz:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765340932&amp;x-signature=9M5ISQdzF261SWim56FUfMJ2utE%3D" alt="" loading="lazy"/></p>
<p>ä»æˆªå›¾å¯ä»¥çœ‹åˆ°ï¼Œé¡¹ç›®ç›®å½•åˆ›å»ºå¥½äº†ï¼Œå½“å‰è·¯å¾„æ˜¯ <code>/root/acowbo/docker-compose-project/wordpress</code>ã€‚è¿™ç§å±‚çº§åŒ–çš„ç›®å½•ç»“æ„å¯ä»¥æ›´å¥½åœ°ç»„ç»‡ä¸åŒçš„ Docker Compose é¡¹ç›®ã€‚æ¥ä¸‹æ¥åœ¨è¿™ä¸ªç›®å½•é‡Œåˆ›å»º Docker Compose é…ç½®æ–‡ä»¶ã€‚</p>
<h3 data-id="heading-18">6.2 ç¼–å†™ docker-compose.yml</h3>
<p>Docker Compose çš„æ ¸å¿ƒæ˜¯ <code>docker-compose.yml</code> é…ç½®æ–‡ä»¶ï¼Œé‡Œé¢å®šä¹‰äº†æ‰€æœ‰çš„æœåŠ¡ã€ç½‘ç»œã€æ•°æ®å·ç­‰ã€‚æˆ‘çš„é…ç½®å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">version:</span> <span class="hljs-string">'3.8'</span>
<span class="hljs-string">â€‹</span>
<span class="hljs-attr">services:</span>
  <span class="hljs-comment"># MySQL æ•°æ®åº“</span>
  <span class="hljs-attr">db:</span>
 Â   <span class="hljs-attr">image:</span> <span class="hljs-string">mysql:8.0</span>
 Â   <span class="hljs-attr">container_name:</span> <span class="hljs-string">wordpress_mysql</span>
 Â   <span class="hljs-attr">restart:</span> <span class="hljs-string">always</span>
 Â   <span class="hljs-attr">environment:</span>
 Â  Â   <span class="hljs-attr">MYSQL_ROOT_PASSWORD:</span> <span class="hljs-number">123123</span>
 Â  Â   <span class="hljs-attr">MYSQL_DATABASE:</span> <span class="hljs-string">wordpress</span>
 Â  Â   <span class="hljs-attr">MYSQL_USER:</span> <span class="hljs-string">wpuser</span>
 Â  Â   <span class="hljs-attr">MYSQL_PASSWORD:</span> <span class="hljs-number">12313</span>
 Â   <span class="hljs-attr">volumes:</span>
 Â  Â   <span class="hljs-bullet">-</span> <span class="hljs-string">db_data:/var/lib/mysql</span>
 Â   <span class="hljs-attr">networks:</span>
 Â  Â   <span class="hljs-bullet">-</span> <span class="hljs-string">wordpress_net</span>
<span class="hljs-string">â€‹</span>
  <span class="hljs-comment"># WordPress åº”ç”¨</span>
  <span class="hljs-attr">wordpress:</span>
 Â   <span class="hljs-attr">image:</span> <span class="hljs-string">wordpress:latest</span>
 Â   <span class="hljs-attr">container_name:</span> <span class="hljs-string">wordpress_app</span>
 Â   <span class="hljs-attr">restart:</span> <span class="hljs-string">always</span>
 Â   <span class="hljs-attr">depends_on:</span>
 Â  Â   <span class="hljs-bullet">-</span> <span class="hljs-string">db</span>
 Â   <span class="hljs-attr">ports:</span>
 Â  Â   <span class="hljs-bullet">-</span> <span class="hljs-string">"8080:80"</span>
 Â   <span class="hljs-attr">environment:</span>
 Â  Â   <span class="hljs-attr">WORDPRESS_DB_HOST:</span> <span class="hljs-string">db:3306</span>
 Â  Â   <span class="hljs-attr">WORDPRESS_DB_USER:</span> <span class="hljs-string">wpuser</span>
 Â  Â   <span class="hljs-attr">WORDPRESS_DB_PASSWORD:</span> <span class="hljs-number">12313</span>
 Â  Â   <span class="hljs-attr">WORDPRESS_DB_NAME:</span> <span class="hljs-string">wordpress</span>
 Â   <span class="hljs-attr">volumes:</span>
 Â  Â   <span class="hljs-bullet">-</span> <span class="hljs-string">wordpress_data:/var/www/html</span>
 Â   <span class="hljs-attr">networks:</span>
 Â  Â   <span class="hljs-bullet">-</span> <span class="hljs-string">wordpress_net</span>
<span class="hljs-string">â€‹</span>
<span class="hljs-attr">volumes:</span>
  <span class="hljs-attr">db_data:</span>
  <span class="hljs-attr">wordpress_data:</span>
<span class="hljs-string">â€‹</span>
<span class="hljs-attr">networks:</span>
  <span class="hljs-attr">wordpress_net:</span>
 Â   <span class="hljs-attr">driver:</span> <span class="hljs-string">bridge</span>
</code></pre>
<p>é…ç½®æ–‡ä»¶ä¸»è¦å®šä¹‰äº†ä¸¤ä¸ªæœåŠ¡ï¼š</p>
<ul>
<li><strong>db æœåŠ¡</strong>ï¼šMySQL 8.0 æ•°æ®åº“ï¼Œç”¨äºå­˜å‚¨ WordPress çš„æ•°æ®</li>
<li><strong>wordpress</strong> <strong>æœåŠ¡</strong>ï¼šWordPress æœ€æ–°ç‰ˆæœ¬ï¼Œç›‘å¬ 8080 ç«¯å£</li>
</ul>
<p>ä¸¤ä¸ªæœåŠ¡é€šè¿‡è‡ªå®šä¹‰ç½‘ç»œ <code>wordpress_net</code> äº’è”ï¼Œæ•°æ®é€šè¿‡æ•°æ®å·æŒä¹…åŒ–ä¿å­˜ã€‚è¿™æ ·å³ä½¿å®¹å™¨é‡å¯æˆ–åˆ é™¤ï¼Œæ•°æ®ä¹Ÿä¸ä¼šä¸¢å¤±ã€‚</p>
<p>åˆ›å»ºå®Œé…ç½®æ–‡ä»¶åï¼Œä¸€è¡Œå‘½ä»¤å°±èƒ½å¯åŠ¨æ‰€æœ‰æœåŠ¡ï¼š</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># å¯åŠ¨æ‰€æœ‰æœåŠ¡ï¼ˆåå°è¿è¡Œï¼‰</span>
docker-compose up -d
â€‹
<span class="hljs-comment"># æŸ¥çœ‹æœåŠ¡çŠ¶æ€</span>
docker-compose ps
</code></pre>
<h3 data-id="heading-19">6.3 æŸ¥çœ‹å®¹å™¨è¿è¡ŒçŠ¶æ€</h3>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1afd1a7d9dbd42d9854a034610051c40~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTnR1cm1vaWxz:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765340932&amp;x-signature=G5UkzIS2%2F4yKWj6CPdSVy78CMZc%3D" alt="" loading="lazy"/></p>
<p>ä»æˆªå›¾å¯ä»¥çœ‹åˆ°ï¼Œä¸¤ä¸ªå®¹å™¨éƒ½å·²ç»æˆåŠŸå¯åŠ¨äº†ï¼š</p>
<ul>
<li><code>wordpress_mysql</code>ï¼šæ•°æ®åº“å®¹å™¨ï¼ŒçŠ¶æ€æ˜¯ Up</li>
<li><code>wordpress_app</code>ï¼šWordPress å®¹å™¨ï¼ŒçŠ¶æ€æ˜¯ Upï¼Œç«¯å£æ˜ å°„ 0.0.0.0:8080-&gt;80/tcp</li>
</ul>
<p>è¿™é‡Œè§£é‡Šä¸€ä¸‹ç«¯å£æ˜ å°„ï¼šå®¹å™¨å†…éƒ¨ WordPress è¿è¡Œåœ¨ 80 ç«¯å£ï¼Œæˆ‘ä»¬æŠŠå®ƒæ˜ å°„åˆ°ä¸»æœºçš„ 8080 ç«¯å£ã€‚è¿™æ ·ä»å¤–éƒ¨è®¿é—®æœåŠ¡å™¨çš„ 8080 ç«¯å£ï¼Œå°±èƒ½è®¿é—®åˆ°å®¹å™¨é‡Œçš„ WordPress äº†ã€‚</p>
<p>Docker Compose çœŸçš„å¾ˆæ–¹ä¾¿ï¼Œä¸ç”¨æ‰‹åŠ¨åˆ›å»ºç½‘ç»œã€ä¸ç”¨é€ä¸ªå¯åŠ¨å®¹å™¨ï¼Œä¸€ä¸ªé…ç½®æ–‡ä»¶ + ä¸€è¡Œå‘½ä»¤å°±æå®šäº†ã€‚è¿™å°±æ˜¯å®¹å™¨ç¼–æ’çš„é­…åŠ›ã€‚</p>
<h3 data-id="heading-20">6.4 è®¿é—® WordPress</h3>
<p>ç°åœ¨åœ¨æµè§ˆå™¨é‡Œè®¿é—®ï¼š<code>http://&lt;æœåŠ¡å™¨IP&gt;:8080</code></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/dc39e5db14be45b7a01a82b2667f4854~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTnR1cm1vaWxz:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765340932&amp;x-signature=qiu4aBQjLT6lbbu8pfQFTUpAVMk%3D" alt="" loading="lazy"/></p>
<p>æˆåŠŸï¼çœ‹åˆ°äº† WordPress çš„å®‰è£…å‘å¯¼ç•Œé¢ã€‚ç•Œé¢æ˜¯ä¸­æ–‡çš„ï¼Œæç¤ºé€‰æ‹©è¯­è¨€åå°±å¯ä»¥å¼€å§‹é…ç½®ç½‘ç«™äº†ã€‚è¿™è¯´æ˜æ•´å¥—ç³»ç»Ÿå·²ç»è·‘é€šäº†ï¼š</p>
<ol>
<li>æœåŠ¡å™¨çš„ 8080 ç«¯å£å¯¹å¤–å¼€æ”¾</li>
<li>æµé‡æ­£ç¡®è½¬å‘åˆ° WordPress å®¹å™¨</li>
<li>WordPress èƒ½å¤Ÿè¿æ¥åˆ° MySQL æ•°æ®åº“</li>
<li>æ•°æ®åº“åˆå§‹åŒ–æˆåŠŸ</li>
</ol>
<p>åˆ°è¿™é‡Œï¼Œä¸€ä¸ªå®Œæ•´çš„å®¹å™¨åŒ–åº”ç”¨å°±éƒ¨ç½²å®Œæˆäº†ã€‚å¦‚æœè¦æ­£å¼ä½¿ç”¨ï¼Œæ¥ä¸‹æ¥æŒ‰ç…§å‘å¯¼é…ç½®ç½‘ç«™æ ‡é¢˜ã€ç®¡ç†å‘˜è´¦å·ç­‰ä¿¡æ¯å°±å¯ä»¥äº†ã€‚</p>
<h2 data-id="heading-21">ä¸ƒã€æ€§èƒ½ç›‘æ§</h2>
<p>åº”ç”¨è·‘èµ·æ¥äº†ï¼Œçœ‹çœ‹èµ„æºå ç”¨æƒ…å†µã€‚Docker è‡ªå¸¦äº† stats å‘½ä»¤å¯ä»¥å®æ—¶ç›‘æ§å®¹å™¨èµ„æºï¼š</p>
<p>docker stats --no-stream</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/06e1eab7ce354526b1824a3dad6957ef~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTnR1cm1vaWxz:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765340932&amp;x-signature=IMyhwsQj5makDtn8tYpAzOXhuio%3D" alt="" loading="lazy"/></p>
<p>ä»ç›‘æ§æ•°æ®å¯ä»¥çœ‹åˆ°ï¼š</p>
<ul>
<li><strong>wordpress_app</strong>ï¼šCPU ä½¿ç”¨ 0.01%ï¼Œå†…å­˜ 65.62MiB / 15.12GiBï¼ˆçº¦ 0.42%ï¼‰</li>
<li><strong>wordpress_mysql</strong>ï¼šCPU ä½¿ç”¨ 0.75%ï¼Œå†…å­˜ 398.7MiB / 15.12GiBï¼ˆçº¦ 2.57%ï¼‰</li>
</ul>
<p>æ•´ä½“èµ„æºå ç”¨éå¸¸ä½ï¼Œä¸¤ä¸ªå®¹å™¨åŠ èµ·æ¥å†…å­˜ä¸åˆ° 465MBï¼ŒCPU ä½¿ç”¨ç‡ä¸åˆ° 1%ã€‚è¿™è¿˜æ˜¯åœ¨å®¹å™¨åˆšå¯åŠ¨ã€MySQL åˆå§‹åŒ–ã€WordPress åŠ è½½çš„æƒ…å†µä¸‹ã€‚ç­‰ç³»ç»Ÿç¨³å®šè¿è¡Œåï¼Œå ç”¨ä¼šæ›´ä½ã€‚</p>
<p>è¿™ä¹Ÿå°è¯äº†å®¹å™¨åŒ–çš„ä¸€ä¸ªä¼˜åŠ¿ï¼š<strong>èµ„æºåˆ©ç”¨ç‡é«˜</strong>ã€‚åŒæ ·çš„ç¡¬ä»¶é…ç½®ï¼Œå®¹å™¨åŒ–éƒ¨ç½²å¯ä»¥è·‘æ›´å¤šçš„åº”ç”¨ã€‚å¦‚æœç”¨ä¼ ç»Ÿè™šæ‹Ÿæœºæ–¹å¼ï¼Œå…‰æ˜¯ MySQL å’Œ Web æœåŠ¡å°±è¦å ç”¨å‡ ä¸ª GB çš„å†…å­˜äº†ã€‚</p>
<h2 data-id="heading-22">å…«ã€å®æˆ˜æ€»ç»“</h2>
<p>è¿™æ¬¡åœ¨ openEuler ä¸Šç”¨ Docker Compose éƒ¨ç½² WordPress çš„å®æˆ˜ï¼Œæ•´ä½“è¿‡ç¨‹è¿˜æ˜¯æ¯”è¾ƒé¡ºåˆ©çš„ã€‚è™½ç„¶ä¸­é—´é‡åˆ°äº† Docker ç‰ˆæœ¬çš„é—®é¢˜ï¼Œä½†é€šè¿‡ä¿®æ”¹ä»“åº“é…ç½®ä¹Ÿé¡ºåˆ©è§£å†³äº†ã€‚</p>
<h3 data-id="heading-23">8.1 è¸©è¿‡çš„å‘</h3>
<p><strong>å‘1ï¼šDocker é»˜è®¤ç‰ˆæœ¬å¤ªè€</strong></p>
<ul>
<li>é—®é¢˜ï¼šdnf ç›´æ¥å®‰è£…çš„ Docker æ˜¯ 18.09.0</li>
<li>è§£å†³ï¼šä½¿ç”¨ Docker å®˜æ–¹ CentOS æºï¼Œä¿®æ”¹ç‰ˆæœ¬å·ä¸º 7</li>
<li>å‚è€ƒï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.csdn.net%2Fweixin_42465759%2Farticle%2Fdetails%2F131207667" target="_blank" title="https://blog.csdn.net/weixin_42465759/article/details/131207667" ref="nofollow noopener noreferrer">blog.csdn.net/weixin_4246â€¦</a></li>
</ul>
<p><strong>å‘2ï¼šDocker Compose ç‰ˆæœ¬å¤ªè€</strong></p>
<ul>
<li>é—®é¢˜ï¼šdnf å®‰è£…çš„ Docker Compose æ˜¯ 1.29.2ï¼ˆv1.xï¼‰</li>
<li>è§£å†³ï¼šä» GitHub ä¸‹è½½æœ€æ–°ç‰ˆ v2.40.3</li>
<li>æ–¹æ³•ï¼šä½¿ç”¨ curl ä» GitHub releases ä¸‹è½½æœ€æ–°ç‰ˆæœ¬</li>
</ul>
<p><strong>å‘3ï¼š</strong>* <em>ç«¯å£</em>*<strong>å¼€æ”¾</strong></p>
<ul>
<li>é—®é¢˜ï¼šæµè§ˆå™¨æ— æ³•è®¿é—® WordPress</li>
<li>è§£å†³ï¼šåœ¨äº‘æœåŠ¡å™¨æ§åˆ¶å°å®‰å…¨ç»„å¼€æ”¾ 8080 ç«¯å£</li>
<li>æç¤ºï¼šå¦‚æœå¯ç”¨äº†é˜²ç«å¢™ï¼Œè®°å¾—ç”¨ firewall-cmd å¼€æ”¾ç«¯å£</li>
</ul>
<h3 data-id="heading-24">8.2 openEuler ä½¿ç”¨ä½“éªŒ</h3>
<p><strong>ä¼˜ç‚¹</strong>ï¼š</p>
<ol>
<li><strong>å…¼å®¹æ€§</strong>* <em>å¥½</em>*ï¼šå’Œ CentOS é«˜åº¦å…¼å®¹ï¼Œç”Ÿæ€å·¥å…·åŸºæœ¬éƒ½èƒ½ç”¨</li>
<li><strong>æ€§èƒ½ç¨³å®š</strong>ï¼šå®¹å™¨è¿è¡Œæµç•…ï¼Œèµ„æºå ç”¨åˆç†</li>
<li><strong>æ–‡æ¡£å®Œå–„</strong>ï¼šå®˜æ–¹æ–‡æ¡£å†™å¾—å¾ˆæ¸…æ¥šï¼Œç¤¾åŒºä¹Ÿå¾ˆæ´»è·ƒ</li>
<li><strong>åŒ…ç®¡ç†æ–¹ä¾¿</strong>ï¼šdnf ç”¨èµ·æ¥å’Œ yum å·®ä¸å¤šï¼Œä¸Šæ‰‹å¿«</li>
</ol>
<p><strong>æ”¹è¿›ç©ºé—´</strong>ï¼š</p>
<ol>
<li>é»˜è®¤ä»“åº“çš„è½¯ä»¶ç‰ˆæœ¬æœ‰ç‚¹ä¿å®ˆï¼Œåƒ Docker è¿˜æ˜¯ 18.09</li>
</ol>
<p>æ€»çš„æ¥è¯´ï¼ŒopenEuler ä½œä¸ºäº‘åŸç”Ÿåœºæ™¯çš„åŸºç¡€æ“ä½œç³»ç»Ÿï¼Œå®Œå…¨èƒ½æ»¡è¶³ä¼ä¸šçº§åº”ç”¨çš„éœ€æ±‚ã€‚</p>
<h2 data-id="heading-25">å…«ã€å‚è€ƒèµ„æº</h2>
<ul>
<li>openEuler å®˜ç½‘ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.openeuler.org%2F" target="_blank" title="https://www.openeuler.org/" ref="nofollow noopener noreferrer">www.openEuler.org/</a></li>
<li>openEuler å®˜æ–¹æ–‡æ¡£ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.openeuler.openatom.cn%2Fzh%2F" target="_blank" title="https://docs.openeuler.openatom.cn/zh/" ref="nofollow noopener noreferrer">docs.openEuler.openatom.cn/zh/</a></li>
<li>Docker å®˜æ–¹æ–‡æ¡£ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.docker.com%2F" target="_blank" title="https://docs.docker.com/" ref="nofollow noopener noreferrer">docs.docker.com/</a></li>
<li>Docker Compose æ–‡æ¡£ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.docker.com%2Fcompose%2F" target="_blank" title="https://docs.docker.com/compose/" ref="nofollow noopener noreferrer">docs.docker.com/compose/</a></li>
<li>WordPress å®˜ç½‘ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fwordpress.org%2F" target="_blank" title="https://wordpress.org/" ref="nofollow noopener noreferrer">wordpress.org/</a>é“¾æ¥</li>
</ul>
<p><strong>å†™åœ¨æœ€å</strong>ï¼š</p>
<p>è¿™æ˜¯æˆ‘ç¬¬ä¸€æ¬¡åœ¨ openEuler ä¸Šåšäº‘åŸç”Ÿå®æˆ˜ï¼Œæ•´ä½“æ„Ÿå—è¿˜ä¸é”™ã€‚è™½ç„¶é‡åˆ°äº†ä¸€äº›å°é—®é¢˜ï¼Œä½†éƒ½é¡ºåˆ©è§£å†³äº†ã€‚å®¹å™¨åŒ–ç¡®å®æ˜¯æœªæ¥çš„æ–¹å‘ï¼Œå€¼å¾—æ¯ä¸ªå¼€å‘è€…å’Œè¿ç»´å·¥ç¨‹å¸ˆå­¦ä¹ æŒæ¡ã€‚</p>
<p>å¦‚æœä½ ä¹Ÿæƒ³å°è¯• openEulerï¼Œå»ºè®®ä»å®¹å™¨åŒ–åº”ç”¨å¼€å§‹ï¼Œé—¨æ§›ä¸é«˜ï¼Œä½†æ”¶è·å¾ˆå¤§ã€‚æœ‰é—®é¢˜å¯ä»¥å»å®˜æ–¹ç¤¾åŒºï¼ˆ<a href="https://link.juejin.cn?target=https%3A%2F%2Fforum.openeuler.org%2F" target="_blank" title="https://forum.openeuler.org/" ref="nofollow noopener noreferrer">forum.openEuler.org/</a>ï¼‰æé—®ï¼Œç¤¾åŒºå“åº”è¿˜æ˜¯å¾ˆå¿«çš„ã€‚</p>
<p>å¸Œæœ›è¿™ç¯‡æ–‡ç« å¯¹ä½ æœ‰å¸®åŠ©ï¼</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[å­˜å‚¨ç®¡ç†åœ¨å¼€å‘ä¸­æœ‰å“ªäº›åº”ç”¨ï¼Ÿ]]></title>    <link>https://juejin.cn/post/7579215538271305738</link>    <guid>https://juejin.cn/post/7579215538271305738</guid>    <pubDate>2025-12-03T04:41:20.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7579215538271305738" data-draft-id="7579215538271289354" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="å­˜å‚¨ç®¡ç†åœ¨å¼€å‘ä¸­æœ‰å“ªäº›åº”ç”¨ï¼Ÿ"/> <meta itemprop="keywords" content="å‰ç«¯,åç«¯,å…¨æ ˆ"/> <meta itemprop="datePublished" content="2025-12-03T04:41:20.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="æˆ‘å«é»‘å¤§å¸…"/> <meta itemprop="url" content="https://juejin.cn/user/1678295463898875"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            å­˜å‚¨ç®¡ç†åœ¨å¼€å‘ä¸­æœ‰å“ªäº›åº”ç”¨ï¼Ÿ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1678295463898875/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    æˆ‘å«é»‘å¤§å¸…
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-03T04:41:20.000Z" title="Wed Dec 03 2025 04:41:20 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-03
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»19åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">å­˜å‚¨ç®¡ç†åœ¨å¼€å‘ä¸­æœ‰å“ªäº›åº”ç”¨ï¼Ÿ</h2>
<h3 data-id="heading-1">ä¸€ã€å‰ç«¯å­˜å‚¨ï¼šæŠŠ â€œå†…å­˜ / æœ¬åœ°å­˜å‚¨â€ ç”¨å‡ºæ“ä½œç³»ç»Ÿçº§æ•ˆç‡</h3>
<p>å‰ç«¯å¼€å‘çœ‹ä¼¼ä¸ç¢° â€œåº•å±‚å­˜å‚¨â€ï¼Œä½†å…¶å®æ¯å¤©éƒ½åœ¨å’Œ â€œå†…å­˜ã€æœ¬åœ°å­˜å‚¨â€ æ‰“äº¤é“ã€‚ä½ æƒ³æƒ³ï¼šå†™ Vue/React ç»„ä»¶æ—¶çš„çŠ¶æ€ç®¡ç†ã€å¤„ç†å¤§è¡¨å•æ•°æ®ã€ä¸Šä¼ é«˜æ¸…å›¾ç‰‡ã€åšç¦»çº¿åº”ç”¨ â€”â€” è¿™äº›åœºæ™¯èƒŒåï¼Œå…¨æ˜¯å­˜å‚¨ç®¡ç†çš„é€»è¾‘ã€‚å’±ä»¬å…ˆä» â€œæœ¬åœ°å­˜å‚¨â€ å’Œ â€œå†…å­˜ä¼˜åŒ–â€ ä¸¤ä¸ªæ ¸å¿ƒåœºæ™¯èŠèµ·ã€‚</p>
<h4 data-id="heading-2">1. æœ¬åœ°å­˜å‚¨é€‰å‹ï¼šå¯¹åº” OS çš„ â€œå­˜å‚¨å±‚æ¬¡ç»“æ„â€</h4>
<p>å¹³æ—¶å†™å‰ç«¯ï¼Œæœ¬åœ°å­˜å‚¨å¸¸ç”¨ Cookieã€localStorageã€sessionStorageï¼Œå¶å°”ç”¨ IndexedDBï¼Œä½†éƒ½æ˜¯ â€œå‡­æ„Ÿè§‰é€‰â€â€”â€” æ¯”å¦‚å°æ•°æ®ç”¨ localStorageï¼Œä¸´æ—¶æ•°æ®ç”¨ sessionStorageï¼Œéœ€è¦è·¨åŸŸå…±äº«ç”¨ Cookieã€‚è¿™å’Œ OS çš„ â€œå­˜å‚¨å±‚æ¬¡â€ æœ‰å•¥å…³ç³»ï¼Ÿ</p>
<p>OS çš„å­˜å‚¨å±‚æ¬¡æ˜¯ â€œå¯„å­˜å™¨â†’é«˜é€Ÿç¼“å­˜â†’å†…å­˜â†’ç£ç›˜â†’å¤–éƒ¨å­˜å‚¨â€ï¼Œæ ¸å¿ƒæ˜¯ â€œå¿«çš„ç©ºé—´å°ã€å¤§çš„ç©ºé—´æ…¢â€ï¼Œæ‰€ä»¥è¦ â€œæŠŠå¸¸ç”¨æ•°æ®æ”¾å¿«ç©ºé—´ï¼Œä¸å¸¸ç”¨çš„æ”¾å¤§ç©ºé—´â€ã€‚å‰ç«¯æœ¬åœ°å­˜å‚¨å…¶å®å°±æ˜¯ä¸€å¥—è¿·ä½ ç‰ˆ â€œå­˜å‚¨å±‚æ¬¡â€ï¼Œå’±ä»¬ç›´æ¥å¯¹åº”ä¸Šï¼š</p>



































<table><thead><tr><th>OS å­˜å‚¨å±‚æ¬¡</th><th>å‰ç«¯æœ¬åœ°å­˜å‚¨</th><th>æ ¸å¿ƒç‰¹ç‚¹</th><th>å®æˆ˜åœºæ™¯ï¼ˆä½ è‚¯å®šå†™è¿‡ï¼ï¼‰</th></tr></thead><tbody><tr><td>é«˜é€Ÿç¼“å­˜</td><td>Cookie</td><td>å®¹é‡å°ï¼ˆ4KBï¼‰ã€éšè¯·æ±‚å‘é€ã€è¿‡æœŸå¯æ§</td><td>å­˜ Tokenã€ç”¨æˆ·åå¥½ï¼ˆæ¯”å¦‚ä¸»é¢˜è‰²ï¼‰ã€è·¨åŸŸå…±äº«æ•°æ®</td></tr><tr><td>å†…å­˜</td><td>sessionStorage</td><td>å®¹é‡ä¸­ï¼ˆ5MBï¼‰ã€ä¼šè¯çº§ã€é¡µé¢éš”ç¦»</td><td>å­˜ä¸´æ—¶è¡¨å•æ•°æ®ï¼ˆæ¯”å¦‚ç”¨æˆ·æ²¡æäº¤çš„è¡¨å•ï¼‰ã€é¡µé¢é—´ä¸´æ—¶å‚æ•°</td></tr><tr><td>ç£ç›˜</td><td>localStorage</td><td>å®¹é‡ä¸­ï¼ˆ5MBï¼‰ã€æŒä¹…åŒ–ã€åŒæºå…±äº«</td><td>å­˜ç”¨æˆ·é…ç½®ï¼ˆæ¯”å¦‚é»˜è®¤æ”¶è´§åœ°å€ï¼‰ã€ç¦»çº¿ç¼“å­˜æ•°æ®ï¼ˆæ¯”å¦‚é¦–é¡µé™æ€åˆ—è¡¨ï¼‰</td></tr><tr><td>å¤–éƒ¨å­˜å‚¨</td><td>IndexedDB</td><td>å®¹é‡å¤§ï¼ˆæ— ä¸Šé™ï¼Œçœ‹ç£ç›˜ï¼‰ã€æ”¯æŒäº‹åŠ¡ã€å¼‚æ­¥</td><td>å­˜å¤§ä½“ç§¯æ•°æ®ï¼ˆæ¯”å¦‚ç¦»çº¿è¡¨å•çš„é™„ä»¶åˆ—è¡¨ï¼‰ã€å¤æ‚æŸ¥è¯¢æ•°æ®ï¼ˆæ¯”å¦‚æœ¬åœ°æ—¥å¿—ã€ç¦»çº¿æŠ¥è¡¨ï¼‰</td></tr></tbody></table>
<p>ä¸¾ä¸ªä½ è‚¯å®šé‡åˆ°è¿‡çš„åœºæ™¯ â€”â€” åš â€œç¦»çº¿æäº¤è¡¨å•â€ åŠŸèƒ½æ—¶ï¼Œç”¨æˆ·å¡«äº† 100 ä¸ªå­—æ®µ + ä¸Šä¼ äº† 3 ä¸ªé™„ä»¶ï¼Œçªç„¶æ–­ç½‘äº†ã€‚å¦‚æœç”¨ localStorage å­˜ï¼Œé¦–å…ˆ 5MB å®¹é‡å¯èƒ½ä¸å¤Ÿï¼ˆé™„ä»¶ Base64 ç¼–ç åä½“ç§¯ä¼šå˜å¤§ï¼‰ï¼Œå…¶æ¬¡æ²¡æ³•åš â€œæäº¤æˆåŠŸåæ‰¹é‡åˆ é™¤â€ï¼ˆç¼ºä¹äº‹åŠ¡ï¼‰ã€‚è¿™æ—¶å€™å°±è¯¥ç”¨ IndexedDBï¼Œå¯¹åº” OS çš„ â€œç£ç›˜å­˜å‚¨â€â€”â€” å®¹é‡å¤§ã€æ”¯æŒäº‹åŠ¡ï¼Œè¿˜èƒ½å¼‚æ­¥æ“ä½œä¸é˜»å¡ UIï¼Œè¿™å°±æ˜¯ â€œå­˜å‚¨å±‚æ¬¡â€ ç†è®ºçš„è½åœ°ï¼šæ ¹æ®æ•°æ®çš„ â€œå¤§å°ã€è®¿é—®é¢‘ç‡ã€æŒä¹…åŒ–éœ€æ±‚â€ é€‰å¯¹å­˜å‚¨ä»‹è´¨ã€‚</p>
<h4 data-id="heading-3">2. å†…å­˜ä¼˜åŒ–ï¼šé¿å…å‰ç«¯ â€œå†…å­˜æ³„æ¼â€ï¼Œå¯¹åº” OS çš„ â€œå†…å­˜å›æ”¶ + è™šæ‹Ÿå†…å­˜â€</h4>
<p>ä¹‹å‰åšä¸€ä¸ª React ç®¡ç†ç³»ç»Ÿï¼Œç”¨æˆ·åé¦ˆ â€œç”¨ä¹…äº†é¡µé¢è¶Šæ¥è¶Šå¡â€ï¼Œæœ€åæ’æŸ¥æ˜¯å†…å­˜æ³„æ¼ â€”â€” ç»„ä»¶å¸è½½åï¼Œå®šæ—¶å™¨æ²¡æ¸…ã€äº‹ä»¶ç›‘å¬æ²¡è§£ç»‘ï¼Œå¯¼è‡´å†…å­˜è¶Šç§¯è¶Šå¤šã€‚è¿™å’Œ OS çš„ â€œå†…å­˜å›æ”¶â€ æ˜¯ä¸æ˜¯ä¸€ä¸ªé“ç†ï¼Ÿ</p>
<p>å®Œå…¨ä¸€è‡´ï¼OS é‡Œçš„ â€œå†…å­˜å›æ”¶â€ æ˜¯é‡Šæ”¾ â€œä¸å†ä½¿ç”¨çš„å†…å­˜å—â€ï¼Œå‰ç«¯çš„å†…å­˜æ³„æ¼æœ¬è´¨å°±æ˜¯ â€œæ²¡ç”¨çš„å¯¹è±¡è¿˜å ç€å†…å­˜ï¼Œåƒåœ¾å›æ”¶å™¨ï¼ˆGCï¼‰å›æ”¶ä¸äº†â€ã€‚ä½ å­¦è¿‡çš„ â€œè™šæ‹Ÿå†…å­˜â€ ç†è®ºï¼Œåœ¨è¿™é‡Œä¹Ÿèƒ½ç”¨ä¸Š â€”â€” æµè§ˆå™¨çš„å†…å­˜å°±åƒ OS çš„ â€œç‰©ç†å†…å­˜â€ï¼Œå½“å†…å­˜ä¸å¤Ÿæ—¶ï¼Œä¼šæŠŠéƒ¨åˆ†ä¸å¸¸ç”¨æ•°æ®æ¢åˆ° â€œç£ç›˜ç¼“å­˜â€ï¼ˆæ¯”å¦‚é¡µé¢éšè—æ—¶çš„ç»„ä»¶çŠ¶æ€ï¼‰ï¼Œä½†å¦‚æœæœ‰å†…å­˜æ³„æ¼ï¼Œå†å¤§çš„ â€œè™šæ‹Ÿå†…å­˜â€ ä¹Ÿä¼šè¢«å æ»¡ï¼Œé¡µé¢å¿…ç„¶å¡é¡¿ã€‚</p>
<p>ç»™ä½ åˆ†äº« 3 ä¸ªå‰ç«¯å¼€å‘ä¸­ â€œç›´æ¥èƒ½ç”¨â€ çš„å†…å­˜ä¼˜åŒ–æŠ€å·§ï¼Œå…¨æ˜¯å­˜å‚¨ç®¡ç†ç†è®ºçš„è½åœ°ï¼š</p>
<h5 data-id="heading-4">ï¼ˆ1ï¼‰å¤§æ•°ç»„ / å¤§å¯¹è±¡å¤„ç†ï¼šç”¨ â€œåˆ†æ®µåŠ è½½â€ å¯¹åº” OS çš„ â€œåˆ†é¡µå­˜å‚¨â€</h5>
<p>OS çš„åˆ†é¡µå­˜å‚¨æ˜¯ â€œæŠŠå¤§ç¨‹åºæ‹†æˆå°é¡µé¢ï¼Œç”¨çš„æ—¶å€™å†åŠ è½½â€ï¼Œå‰ç«¯å¤„ç†å¤§æ•°æ®ä¹Ÿä¸€æ ·ã€‚æ¯”å¦‚ä½ è¦æ¸²æŸ“ 10 ä¸‡æ¡è¡¨æ ¼æ•°æ®ï¼Œç›´æ¥æŠŠæ•°ç»„ä¸¢ç»™ React/Vueï¼Œé¡µé¢ä¼šç¬é—´å¡æ­» â€”â€” å› ä¸ºä¸€æ¬¡æ€§å ç”¨å¤ªå¤šå†…å­˜ï¼Œè¿˜ä¼šè§¦å‘å¤§é‡ DOM æ¸²æŸ“ã€‚</p>
<pre><code class="hljs language-ini" lang="ini">Â // é”™è¯¯åšæ³•ï¼šä¸€æ¬¡æ€§æ¸²æŸ“10ä¸‡æ¡æ•°æ®ï¼ˆå†…å­˜çˆ†ç‚¸ï¼‰
Â const <span class="hljs-section">[data, setData]</span> = useState(all100000Data)<span class="hljs-comment">;</span>
Â â€‹
Â // æ­£ç¡®åšæ³•ï¼šåˆ†æ®µåŠ è½½ï¼ˆå¯¹åº”OSåˆ†é¡µï¼‰
Â const <span class="hljs-section">[pageData, setPageData]</span> = useState(<span class="hljs-section">[]</span>)<span class="hljs-comment">;</span>
Â const <span class="hljs-section">[currentPage, setCurrentPage]</span> = useState(1)<span class="hljs-comment">;</span>
Â const <span class="hljs-attr">pageSize</span> = <span class="hljs-number">100</span><span class="hljs-comment">; // æ¯é¡µ100æ¡ï¼ˆå¯¹åº”â€œé¡µé¢å¤§å°â€ï¼‰</span>
Â â€‹
Â // æ»šåŠ¨åˆ°åº•éƒ¨åŠ è½½ä¸‹ä¸€é¡µï¼ˆå¯¹åº”OSçš„â€œé¡µé¢ç½®æ¢â€ï¼‰
Â const <span class="hljs-attr">handleScroll</span> = () =&gt; {
Â  Â const <span class="hljs-attr">scrollTop</span> = document.documentElement.scrollTop<span class="hljs-comment">;</span>
Â  Â const <span class="hljs-attr">scrollHeight</span> = document.documentElement.scrollHeight<span class="hljs-comment">;</span>
Â  Â const <span class="hljs-attr">clientHeight</span> = document.documentElement.clientHeight<span class="hljs-comment">;</span>
Â  Â if (scrollTop + clientHeight &gt;= scrollHeight - 100) {
Â  Â  Â const <span class="hljs-attr">nextPageData</span> = all100000Data.slice(
Â  Â  Â  Â currentPage * pageSize,
Â  Â  Â   (currentPage + 1) * pageSize
Â  Â   )<span class="hljs-comment">;</span>
Â  Â  Â setPageData(<span class="hljs-section">[...pageData, ...nextPageData]</span>)<span class="hljs-comment">;</span>
Â  Â  Â setCurrentPage(currentPage + 1)<span class="hljs-comment">;</span>
Â   }
Â }<span class="hljs-comment">;</span>
</code></pre>
<p>è¿™ä¸ªé€»è¾‘å’Œ OS çš„ â€œåˆ†é¡µå­˜å‚¨â€ å®Œå…¨ä¸€è‡´ â€”â€”<code>pageSize</code>å°±æ˜¯ â€œé¡µé¢å¤§å°â€ï¼Œ<code>currentPage</code>å°±æ˜¯ â€œå½“å‰å†…å­˜ä¸­çš„é¡µé¢â€ï¼Œæ»šåŠ¨åŠ è½½å°±æ˜¯ â€œæŒ‰éœ€è°ƒå…¥é¡µé¢â€ï¼Œé¿å…ä¸€æ¬¡æ€§å ç”¨è¿‡å¤šå†…å­˜ã€‚ä½ åšåç«¯æ¥å£æ—¶ï¼Œåˆ†é¡µæŸ¥è¯¢å…¶å®ä¹Ÿæ˜¯åŒä¸€ä¸ªé“ç†ï¼</p>
<h5 data-id="heading-5">ï¼ˆ2ï¼‰é—­åŒ… / äº‹ä»¶ç›‘å¬ï¼šé¿å… â€œå†…å­˜æ³„æ¼â€ å¯¹åº” OS çš„ â€œå†…å­˜å›æ”¶â€</h5>
<p>OS é‡Œçš„ â€œå†…å­˜å›æ”¶â€ æ˜¯è¯†åˆ« â€œä¸å†è¢«å¼•ç”¨çš„å†…å­˜å—â€ï¼Œå‰ç«¯çš„å†…å­˜æ³„æ¼æœ¬è´¨æ˜¯ â€œæ²¡ç”¨çš„å¯¹è±¡è¿˜è¢«å¼•ç”¨â€â€”â€” æ¯”å¦‚ç»„ä»¶å¸è½½åï¼Œå®šæ—¶å™¨ã€äº‹ä»¶ç›‘å¬ã€é—­åŒ…è¿˜æ²¡æ¸…ç†ã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript">Â <span class="hljs-keyword">import</span> { useEffect, useState } <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>;
Â â€‹
Â <span class="hljs-keyword">const</span> <span class="hljs-title function_">MyComponent</span> = (<span class="hljs-params"/>) =&gt; {
Â  Â <span class="hljs-keyword">const</span> [count, setCount] = <span class="hljs-title function_">useState</span>(<span class="hljs-number">0</span>);
Â â€‹
Â  Â <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> {
Â  Â  Â <span class="hljs-comment">// å¼€å¯å®šæ—¶å™¨ï¼ˆä¼šå½¢æˆé—­åŒ…å¼•ç”¨countï¼‰</span>
Â  Â  Â <span class="hljs-keyword">const</span> timer = <span class="hljs-built_in">setInterval</span>(<span class="hljs-function">() =&gt;</span> {
Â  Â  Â  Â <span class="hljs-title function_">setCount</span>(<span class="hljs-function"><span class="hljs-params">prev</span> =&gt;</span> prev + <span class="hljs-number">1</span>);
Â  Â   }, <span class="hljs-number">1000</span>);
Â â€‹
Â  Â  Â <span class="hljs-comment">// ç»‘å®šå…¨å±€äº‹ä»¶ï¼ˆä¼šå¼•ç”¨ç»„ä»¶å†…çš„å‡½æ•°ï¼‰</span>
Â  Â  Â <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'resize'</span>, handleResize);
Â â€‹
Â  Â  Â <span class="hljs-comment">// ç»„ä»¶å¸è½½æ—¶æ¸…ç†ï¼ˆå¯¹åº”OSçš„â€œé‡Šæ”¾å†…å­˜â€ï¼‰</span>
Â  Â  Â <span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> {
Â  Â  Â  Â <span class="hljs-built_in">clearInterval</span>(timer); <span class="hljs-comment">// æ¸…ç†å®šæ—¶å™¨</span>
Â  Â  Â  Â <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">removeEventListener</span>(<span class="hljs-string">'resize'</span>, handleResize); <span class="hljs-comment">// è§£ç»‘äº‹ä»¶</span>
Â  Â   };
Â   }, []);
Â â€‹
Â  Â <span class="hljs-keyword">const</span> <span class="hljs-title function_">handleResize</span> = (<span class="hljs-params"/>) =&gt; {
Â  Â  Â <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'çª—å£å¤§å°å˜åŒ–'</span>);
Â   };
Â â€‹
Â  Â <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>{count}<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>;
Â };
</code></pre>
<p>è€Œä¸”ç°åœ¨å‰ç«¯æ¡†æ¶ï¼ˆReact 18ã€Vue 3ï¼‰çš„ â€œè™šæ‹Ÿ DOMâ€â€œDiff ç®—æ³•â€ï¼Œæœ¬è´¨ä¹Ÿæ˜¯ â€œå†…å­˜ç®¡ç†ä¼˜åŒ–â€â€”â€” æ¯”å¦‚è™šæ‹Ÿ DOM æŠŠ DOM æ“ä½œå…ˆå­˜åœ¨å†…å­˜é‡Œï¼Œæ‰¹é‡æ›´æ–°ï¼Œé¿å…é¢‘ç¹æ“ä½œ â€œç£ç›˜çº§â€ çš„ DOMï¼ˆDOM æ“ä½œæ¯”å†…å­˜æ“ä½œæ…¢ 100 å€ä»¥ä¸Šï¼‰ï¼Œè¿™å’Œ OS ç”¨ â€œå†…å­˜ç¼“å†²â€ å‡å°‘ç£ç›˜ IO æ˜¯åŒä¸€ä¸ªæ€è·¯ï¼</p>
<h4 data-id="heading-6">3. å¤§æ–‡ä»¶ä¸Šä¼ ï¼šç”¨ â€œåˆ†ç‰‡ä¸Šä¼ â€ å¯¹åº” OS çš„ â€œåˆ†æ®µå­˜å‚¨â€</h4>
<p>åšåç«¯å¼€å‘è‚¯å®šå†™è¿‡å¤§æ–‡ä»¶ä¸Šä¼ æ¥å£å§ï¼Ÿæ¯”å¦‚ç”¨æˆ·ä¸Šä¼  1GB çš„è§†é¢‘ï¼Œå¦‚æœç›´æ¥ POST æ•´ä¸ªæ–‡ä»¶ï¼Œä¸ä»…å®¹æ˜“è¶…æ—¶ï¼Œè¿˜ä¼šè®©æœåŠ¡å™¨ç¬é—´å ç”¨å¤§é‡å†…å­˜ â€”â€” è¿™å°±åƒ OS é‡Œ â€œæŠŠä¸€ä¸ªå¤§æ–‡ä»¶ä¸€æ¬¡æ€§è¯»è¿›å†…å­˜â€ï¼Œå¿…ç„¶å¯¼è‡´èµ„æºè€—å°½ã€‚</p>
<p>OS çš„ â€œåˆ†æ®µå­˜å‚¨â€ æ˜¯ â€œæŠŠå¤§ç¨‹åºæ‹†æˆé€»è¾‘æ®µï¼ŒæŒ‰éœ€åŠ è½½â€ï¼Œå‰ç«¯çš„ â€œåˆ†ç‰‡ä¸Šä¼ â€ å°±æ˜¯è¿™ä¸ªç†è®ºçš„ç›´æ¥åº”ç”¨ï¼šæŠŠå¤§æ–‡ä»¶æ‹†æˆå°åˆ†ç‰‡ï¼ˆæ¯”å¦‚ 5MB / ç‰‡ï¼‰ï¼Œåˆ†æ‰¹ä¸Šä¼ ï¼ŒæœåŠ¡å™¨æ¥æ”¶åå†æ‹¼æ¥æˆå®Œæ•´æ–‡ä»¶ã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript">Â <span class="hljs-comment">// å‰ç«¯ï¼šå¤§æ–‡ä»¶åˆ†ç‰‡ä¸Šä¼ ï¼ˆå¯¹åº”OSåˆ†æ®µå­˜å‚¨ï¼‰</span>
Â <span class="hljs-keyword">const</span> <span class="hljs-title function_">uploadLargeFile</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params">file</span>) =&gt; {
Â  Â <span class="hljs-keyword">const</span> chunkSize = <span class="hljs-number">5</span> * <span class="hljs-number">1024</span> * <span class="hljs-number">1024</span>; <span class="hljs-comment">// 5MB/ç‰‡ï¼ˆå¯¹åº”â€œæ®µå¤§å°â€ï¼‰</span>
Â  Â <span class="hljs-keyword">const</span> totalChunks = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">ceil</span>(file.<span class="hljs-property">size</span> / chunkSize); <span class="hljs-comment">// æ€»ç‰‡æ•°</span>
Â  Â <span class="hljs-keyword">const</span> fileId = <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>() + <span class="hljs-string">'-'</span> + file.<span class="hljs-property">name</span>; <span class="hljs-comment">// å”¯ä¸€æ ‡è¯†ï¼ˆé¿å…åˆ†ç‰‡æ··ä¹±ï¼‰</span>
Â â€‹
Â  Â <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> chunkIndex = <span class="hljs-number">0</span>; chunkIndex &lt; totalChunks; chunkIndex++) {
Â  Â  Â <span class="hljs-comment">// åˆ‡å‰²åˆ†ç‰‡ï¼ˆå¯¹åº”OSâ€œæ‹†åˆ†é€»è¾‘æ®µâ€ï¼‰</span>
Â  Â  Â <span class="hljs-keyword">const</span> start = chunkIndex * chunkSize;
Â  Â  Â <span class="hljs-keyword">const</span> end = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">min</span>(start + chunkSize, file.<span class="hljs-property">size</span>);
Â  Â  Â <span class="hljs-keyword">const</span> chunk = file.<span class="hljs-title function_">slice</span>(start, end);
Â â€‹
Â  Â  Â <span class="hljs-comment">// æ„é€ è¡¨å•æ•°æ®</span>
Â  Â  Â <span class="hljs-keyword">const</span> formData = <span class="hljs-keyword">new</span> <span class="hljs-title class_">FormData</span>();
Â  Â  Â formData.<span class="hljs-title function_">append</span>(<span class="hljs-string">'chunk'</span>, chunk);
Â  Â  Â formData.<span class="hljs-title function_">append</span>(<span class="hljs-string">'fileId'</span>, fileId);
Â  Â  Â formData.<span class="hljs-title function_">append</span>(<span class="hljs-string">'chunkIndex'</span>, chunkIndex);
Â  Â  Â formData.<span class="hljs-title function_">append</span>(<span class="hljs-string">'totalChunks'</span>, totalChunks);
Â â€‹
Â  Â  Â <span class="hljs-comment">// åˆ†æ‰¹ä¸Šä¼ ï¼ˆå¯¹åº”OSâ€œæŒ‰éœ€åŠ è½½æ®µâ€ï¼‰</span>
Â  Â  Â <span class="hljs-keyword">await</span> axios.<span class="hljs-title function_">post</span>(<span class="hljs-string">'/api/upload/chunk'</span>, formData, {
Â  Â  Â  Â <span class="hljs-attr">headers</span>: { <span class="hljs-string">'Content-Type'</span>: <span class="hljs-string">'multipart/form-data'</span> },
Â  Â  Â  Â <span class="hljs-attr">onUploadProgress</span>: <span class="hljs-function">(<span class="hljs-params">progress</span>) =&gt;</span> {
Â  Â  Â  Â  Â <span class="hljs-comment">// è®¡ç®—å•ä¸ªåˆ†ç‰‡çš„ä¸Šä¼ è¿›åº¦</span>
Â  Â  Â  Â  Â <span class="hljs-keyword">const</span> chunkProgress = progress.<span class="hljs-property">loaded</span> / progress.<span class="hljs-property">total</span>;
Â  Â  Â  Â  Â <span class="hljs-comment">// è®¡ç®—æ•´ä½“è¿›åº¦ï¼ˆå·²ä¸Šä¼ åˆ†ç‰‡æ•° + å½“å‰åˆ†ç‰‡è¿›åº¦ï¼‰</span>
Â  Â  Â  Â  Â <span class="hljs-keyword">const</span> totalProgress = (chunkIndex + chunkProgress) / totalChunks;
Â  Â  Â  Â  Â <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`ä¸Šä¼ è¿›åº¦ï¼š<span class="hljs-subst">${(totalProgress * <span class="hljs-number">100</span>).toFixed(<span class="hljs-number">2</span>)}</span>%`</span>);
Â  Â  Â   }
Â  Â   });
Â   }
Â â€‹
Â  Â <span class="hljs-comment">// æ‰€æœ‰åˆ†ç‰‡ä¸Šä¼ å®Œæˆï¼Œé€šçŸ¥æœåŠ¡å™¨æ‹¼æ¥</span>
Â  Â <span class="hljs-keyword">await</span> axios.<span class="hljs-title function_">post</span>(<span class="hljs-string">'/api/upload/merge'</span>, { fileId, <span class="hljs-attr">fileName</span>: file.<span class="hljs-property">name</span> });
Â  Â <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'æ–‡ä»¶ä¸Šä¼ å®Œæˆï¼'</span>);
Â };
</code></pre>
<pre><code class="hljs language-less" lang="less">Â <span class="hljs-comment">// åç«¯ï¼ˆJavaç¤ºä¾‹ï¼‰ï¼šæ¥æ”¶åˆ†ç‰‡+åˆå¹¶æ–‡ä»¶ï¼ˆå¯¹åº”OSâ€œæ®µæ‹¼æ¥â€ï¼‰</span>
Â <span class="hljs-variable">@RestController</span>
Â <span class="hljs-variable">@RequestMapping</span>(<span class="hljs-string">"/api/upload"</span>)
Â public class UploadController {
Â  Â <span class="hljs-comment">// ä¸´æ—¶å­˜å‚¨åˆ†ç‰‡çš„ç›®å½•ï¼ˆå¯¹åº”OSâ€œä¸´æ—¶å†…å­˜â€ï¼‰</span>
Â  Â <span class="hljs-selector-tag">private</span> <span class="hljs-selector-tag">static</span> <span class="hljs-selector-tag">final</span> <span class="hljs-selector-tag">String</span> <span class="hljs-selector-tag">TEMP_CHUNK_DIR</span> = "/<span class="hljs-selector-tag">tmp</span>/<span class="hljs-selector-tag">chunks</span>/";
Â â€‹
Â  Â <span class="hljs-comment">// æ¥æ”¶åˆ†ç‰‡</span>
Â  Â @<span class="hljs-selector-tag">PostMapping</span>(<span class="hljs-string">"/chunk"</span>)
Â  Â <span class="hljs-selector-tag">public</span> <span class="hljs-selector-tag">Result</span>&lt;?&gt; <span class="hljs-selector-tag">uploadChunk</span>(
Â  Â  Â  Â <span class="hljs-variable">@RequestParam</span>(<span class="hljs-string">"chunk"</span>) MultipartFile chunk,
Â  Â  Â  Â <span class="hljs-variable">@RequestParam</span>(<span class="hljs-string">"fileId"</span>) String fileId,
Â  Â  Â  Â <span class="hljs-variable">@RequestParam</span>(<span class="hljs-string">"chunkIndex"</span>) int chunkIndex) {
Â  Â  Â <span class="hljs-comment">// åˆ›å»ºæ–‡ä»¶IDå¯¹åº”çš„ä¸´æ—¶ç›®å½•ï¼ˆå¯¹åº”OSâ€œåˆ†æ®µå­˜å‚¨çš„æ®µç›®å½•â€ï¼‰</span>
Â  Â  Â <span class="hljs-selector-tag">File</span> <span class="hljs-selector-tag">chunkDir</span> = <span class="hljs-selector-tag">new</span> <span class="hljs-selector-tag">File</span>(TEMP_CHUNK_DIR + fileId);
Â  Â  Â <span class="hljs-selector-tag">if</span> (!chunkDir.<span class="hljs-built_in">exists</span>()) {
Â  Â  Â  Â <span class="hljs-selector-tag">chunkDir</span><span class="hljs-selector-class">.mkdirs</span>();
Â  Â   }
Â â€‹
Â  Â  Â <span class="hljs-comment">// ä¿å­˜åˆ†ç‰‡ï¼ˆæ–‡ä»¶åç”¨chunkIndexå‘½åï¼Œé¿å…æ··ä¹±ï¼‰</span>
Â  Â  Â <span class="hljs-selector-tag">File</span> <span class="hljs-selector-tag">chunkFile</span> = <span class="hljs-selector-tag">new</span> <span class="hljs-selector-tag">File</span>(chunkDir, chunkIndex + <span class="hljs-string">".part"</span>);
Â  Â  Â <span class="hljs-selector-tag">try</span> {
Â  Â  Â  Â <span class="hljs-selector-tag">chunk</span><span class="hljs-selector-class">.transferTo</span>(chunkFile);
Â  Â   } <span class="hljs-selector-tag">catch</span> (IOException e) {
Â  Â  Â  Â <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">Result</span><span class="hljs-selector-class">.error</span>(<span class="hljs-string">"åˆ†ç‰‡ä¸Šä¼ å¤±è´¥"</span>);
Â  Â   }
Â  Â  Â <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">Result</span><span class="hljs-selector-class">.success</span>(<span class="hljs-string">"åˆ†ç‰‡ä¸Šä¼ æˆåŠŸ"</span>);
Â   }
Â â€‹
Â  Â <span class="hljs-comment">// åˆå¹¶åˆ†ç‰‡</span>
Â  Â @<span class="hljs-selector-tag">PostMapping</span>(<span class="hljs-string">"/merge"</span>)
Â  Â <span class="hljs-selector-tag">public</span> <span class="hljs-selector-tag">Result</span>&lt;?&gt; <span class="hljs-selector-tag">mergeChunks</span>(
Â  Â  Â  Â <span class="hljs-variable">@RequestParam</span>(<span class="hljs-string">"fileId"</span>) String fileId,
Â  Â  Â  Â <span class="hljs-variable">@RequestParam</span>(<span class="hljs-string">"fileName"</span>) String fileName) {
Â  Â  Â <span class="hljs-selector-tag">File</span> <span class="hljs-selector-tag">chunkDir</span> = <span class="hljs-selector-tag">new</span> <span class="hljs-selector-tag">File</span>(TEMP_CHUNK_DIR + fileId);
Â  Â  Â <span class="hljs-selector-tag">File</span><span class="hljs-selector-attr">[]</span> <span class="hljs-selector-tag">chunks</span> = <span class="hljs-selector-tag">chunkDir</span><span class="hljs-selector-class">.listFiles</span>();
Â  Â  Â <span class="hljs-selector-tag">if</span> (chunks == null || chunks.length == <span class="hljs-number">0</span>) {
Â  Â  Â  Â <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">Result</span><span class="hljs-selector-class">.error</span>(<span class="hljs-string">"æ²¡æœ‰æ‰¾åˆ°åˆ†ç‰‡æ–‡ä»¶"</span>);
Â  Â   }
Â â€‹
Â  Â  Â <span class="hljs-comment">// ç›®æ ‡æ–‡ä»¶ï¼ˆæœ€ç»ˆå­˜å‚¨è·¯å¾„ï¼Œå¯¹åº”OSâ€œæœ€ç»ˆå­˜å‚¨åœ°å€â€ï¼‰</span>
Â  Â  Â <span class="hljs-selector-tag">File</span> <span class="hljs-selector-tag">targetFile</span> = <span class="hljs-selector-tag">new</span> <span class="hljs-selector-tag">File</span>(<span class="hljs-string">"/data/files/"</span> + fileName);
Â â€‹
Â  Â  Â <span class="hljs-comment">// æŒ‰åˆ†ç‰‡ç´¢å¼•æ’åºï¼Œä¾æ¬¡å†™å…¥ç›®æ ‡æ–‡ä»¶ï¼ˆå¯¹åº”OSâ€œæ®µæ‹¼æ¥â€ï¼‰</span>
Â  Â  Â <span class="hljs-selector-tag">Arrays</span><span class="hljs-selector-class">.sort</span>(chunks, (a, b) -&gt; {
Â  Â  Â  Â <span class="hljs-selector-tag">int</span> <span class="hljs-selector-tag">indexA</span> = <span class="hljs-selector-tag">Integer</span><span class="hljs-selector-class">.parseInt</span>(a.<span class="hljs-built_in">getName</span>().<span class="hljs-built_in">split</span>(<span class="hljs-string">"\."</span>)[<span class="hljs-number">0</span>]);
Â  Â  Â  Â <span class="hljs-selector-tag">int</span> <span class="hljs-selector-tag">indexB</span> = <span class="hljs-selector-tag">Integer</span><span class="hljs-selector-class">.parseInt</span>(b.<span class="hljs-built_in">getName</span>().<span class="hljs-built_in">split</span>(<span class="hljs-string">"\."</span>)[<span class="hljs-number">0</span>]);
Â  Â  Â  Â <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">indexA</span> <span class="hljs-selector-tag">-</span> <span class="hljs-selector-tag">indexB</span>;
Â  Â   });
Â â€‹
Â  Â  Â <span class="hljs-selector-tag">try</span> (FileOutputStream out = new <span class="hljs-built_in">FileOutputStream</span>(targetFile)) {
Â  Â  Â  Â <span class="hljs-selector-tag">for</span> (File <span class="hljs-attribute">chunk </span>: chunks) {
Â  Â  Â  Â  Â <span class="hljs-selector-tag">try</span> (FileInputStream in = new <span class="hljs-built_in">FileInputStream</span>(chunk)) {
Â  Â  Â  Â  Â  Â <span class="hljs-selector-tag">byte</span><span class="hljs-selector-attr">[]</span> <span class="hljs-selector-tag">buffer</span> = <span class="hljs-selector-tag">new</span> <span class="hljs-selector-tag">byte</span><span class="hljs-selector-attr">[1024]</span>;
Â  Â  Â  Â  Â  Â <span class="hljs-selector-tag">int</span> <span class="hljs-selector-tag">len</span>;
Â  Â  Â  Â  Â  Â <span class="hljs-selector-tag">while</span> ((len = in.<span class="hljs-built_in">read</span>(buffer)) != -<span class="hljs-number">1</span>) {
Â  Â  Â  Â  Â  Â  Â <span class="hljs-selector-tag">out</span><span class="hljs-selector-class">.write</span>(buffer, <span class="hljs-number">0</span>, len);
Â  Â  Â  Â  Â   }
Â  Â  Â  Â   }
Â  Â  Â  Â  Â <span class="hljs-comment">// å†™å…¥ååˆ é™¤ä¸´æ—¶åˆ†ç‰‡ï¼ˆå¯¹åº”OSâ€œé‡Šæ”¾ä¸´æ—¶å†…å­˜â€ï¼‰</span>
Â  Â  Â  Â  Â <span class="hljs-selector-tag">chunk</span><span class="hljs-selector-class">.delete</span>();
Â  Â  Â   }
Â  Â  Â  Â <span class="hljs-comment">// åˆ é™¤ä¸´æ—¶ç›®å½•</span>
Â  Â  Â  Â <span class="hljs-selector-tag">chunkDir</span><span class="hljs-selector-class">.delete</span>();
Â  Â   } <span class="hljs-selector-tag">catch</span> (IOException e) {
Â  Â  Â  Â <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">Result</span><span class="hljs-selector-class">.error</span>(<span class="hljs-string">"æ–‡ä»¶åˆå¹¶å¤±è´¥"</span>);
Â  Â   }
Â â€‹
Â  Â  Â <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">Result</span><span class="hljs-selector-class">.success</span>(<span class="hljs-string">"æ–‡ä»¶ä¸Šä¼ å®Œæˆ"</span>);
Â   }
Â }
</code></pre>
<p>è€Œä¸”è¿™ä¸ªé€»è¾‘è¿˜èƒ½å»¶ä¼¸ â€”â€” æ¯”å¦‚ä½ åšè§†é¢‘ç‚¹æ’­æ—¶çš„ â€œæ–­ç‚¹ç»­ä¼ â€â€œåˆ†ç‰‡åŠ è½½â€ï¼Œç”šè‡³åç«¯çš„ â€œæ–‡ä»¶åˆ†å—å­˜å‚¨åˆ°åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿï¼ˆå¦‚ MinIOã€OSSï¼‰â€ï¼Œæœ¬è´¨éƒ½æ˜¯ â€œåˆ†æ®µå­˜å‚¨â€ çš„åº”ç”¨ã€‚å­˜å‚¨ç®¡ç†ä¸æ˜¯è®©ä½ å†™ OS å†…æ ¸ï¼Œè€Œæ˜¯è®©ä½ å­¦ä¼š â€œæ‹†åˆ†å¤§èµ„æºã€é«˜æ•ˆå¤„ç†å°èµ„æºâ€ çš„æ€ç»´ï¼</p>
<h3 data-id="heading-7">äºŒã€åç«¯å­˜å‚¨ï¼šä» â€œæ•°æ®åº“ + ç¼“å­˜â€ çœ‹å­˜å‚¨ç®¡ç†çš„æ ¸å¿ƒé€»è¾‘</h3>
<p>åç«¯å¼€å‘æ˜¯å­˜å‚¨ç®¡ç†çš„ â€œä¸»æˆ˜åœºâ€â€”â€” ä½ æ¯å¤©æ‰“äº¤é“çš„æ•°æ®åº“ã€ç¼“å­˜ã€ç£ç›˜ IOï¼Œå…¨æ˜¯ OS å­˜å‚¨ç®¡ç†ç†è®ºçš„ â€œæ”¾å¤§ç‰ˆâ€ã€‚æ¯”å¦‚ï¼šæ•°æ®åº“çš„åˆ†åº“åˆ†è¡¨å¯¹åº” OS çš„ â€œåˆ†åŒºå­˜å‚¨â€ï¼ŒRedis ç¼“å­˜å¯¹åº” OS çš„ â€œé«˜é€Ÿç¼“å­˜â€ï¼Œç´¢å¼•è®¾è®¡å¯¹åº” OS çš„ â€œå¿«é€ŸæŸ¥æ‰¾ç®—æ³•â€ï¼Œç”šè‡³ JVM çš„å†…å­˜é…ç½®éƒ½å’Œ OS çš„ â€œå†…å­˜åˆ†é…â€ æ¯æ¯ç›¸å…³ã€‚å’±ä»¬æŒ‘ 3 ä¸ªåç«¯å¼€å‘æœ€å¸¸ç”¨çš„åœºæ™¯ï¼Œæ‹†è§£ç†è®ºå¦‚ä½•è½åœ°ã€‚</p>
<h4 data-id="heading-8">1. æ•°æ®åº“ä¼˜åŒ–ï¼šåˆ†åº“åˆ†è¡¨ + ç´¢å¼•è®¾è®¡ï¼Œå¯¹åº” OS çš„ â€œåˆ†åŒºå­˜å‚¨ + å¿«é€ŸæŸ¥æ‰¾â€</h4>
<p>OS çš„ â€œåˆ†åŒºå­˜å‚¨â€ æ˜¯æŠŠå†…å­˜æ‹†æˆå¤šä¸ªåˆ†åŒºï¼Œæ¯ä¸ªåˆ†åŒºæ”¾ä¸åŒè¿›ç¨‹ï¼Œé¿å… â€œä¸€ä¸ªå¤§è¿›ç¨‹å æ»¡å†…å­˜â€ï¼›æ•°æ®åº“çš„åˆ†åº“åˆ†è¡¨æ˜¯æŠŠ â€œå¤§è¡¨æ‹†æˆå°è¡¨â€ï¼Œæ¯ä¸ªå°è¡¨æ”¾ä¸åŒæ•°æ®ï¼Œé¿å… â€œä¸€ä¸ªå¤§è¡¨æŸ¥è¯¢å æ»¡ç£ç›˜ IOâ€ã€‚ä¸¤è€…çš„æ ¸å¿ƒéƒ½æ˜¯ â€œæ‹†åˆ†å¤§èµ„æºï¼Œæå‡è®¿é—®æ•ˆç‡â€ã€‚</p>
<h5 data-id="heading-9">ï¼ˆ1ï¼‰åˆ†åº“åˆ†è¡¨ï¼šå¯¹åº” OS çš„ â€œåˆ†åŒºå­˜å‚¨â€</h5>
<p>OS çš„åˆ†åŒºæœ‰ â€œå›ºå®šåˆ†åŒºâ€â€œåŠ¨æ€åˆ†åŒºâ€ï¼Œæ•°æ®åº“çš„åˆ†åº“åˆ†è¡¨ä¹Ÿæœ‰ä¸¤ç§æ ¸å¿ƒæ–¹å¼ï¼š</p>
<ul>
<li><strong>æ°´å¹³åˆ†è¡¨ï¼ˆæŒ‰è¡Œæ‹†åˆ†ï¼‰</strong> ï¼šå¯¹åº” OS çš„ â€œæŒ‰è¿›ç¨‹åˆ†åŒºâ€â€”â€” æŠŠåŒä¸€è¡¨ä¸­çš„ä¸åŒè¡Œï¼Œæ‹†åˆ°ä¸åŒè¡¨ä¸­ã€‚æ¯”å¦‚è®¢å•è¡¨æŒ‰ â€œåˆ›å»ºæ—¶é—´â€ åˆ†è¡¨ï¼Œ<code>order_202401</code>ï¼ˆ2024 å¹´ 1 æœˆè®¢å•ï¼‰ã€<code>order_202402</code>ï¼ˆ2024 å¹´ 2 æœˆè®¢å•ï¼‰ï¼ŒæŸ¥è¯¢æ—¶åªéœ€è¦è®¿é—®å¯¹åº”æœˆä»½çš„è¡¨ï¼Œä¸ç”¨æ‰«æå…¨é‡æ•°æ®ã€‚</li>
<li><strong>å‚ç›´åˆ†è¡¨ï¼ˆæŒ‰åˆ—æ‹†åˆ†ï¼‰</strong> ï¼šå¯¹åº” OS çš„ â€œæŒ‰èµ„æºç±»å‹åˆ†åŒºâ€â€”â€” æŠŠåŒä¸€è¡¨ä¸­çš„ä¸åŒåˆ—ï¼Œæ‹†åˆ°ä¸åŒè¡¨ä¸­ã€‚æ¯”å¦‚ç”¨æˆ·è¡¨<code>user</code>æ‹†æˆ<code>user_base</code>ï¼ˆåŸºç¡€ä¿¡æ¯ï¼šidã€å§“åã€æ‰‹æœºå·ï¼‰å’Œ<code>user_extend</code>ï¼ˆæ‰©å±•ä¿¡æ¯ï¼šå¤´åƒã€ç®€ä»‹ã€åœ°å€ï¼‰ï¼ŒæŸ¥è¯¢ â€œç”¨æˆ·åˆ—è¡¨â€ æ—¶åªæŸ¥<code>user_base</code>ï¼Œé¿å…åŠ è½½ä¸éœ€è¦çš„å¤§å­—æ®µï¼ˆå¦‚å¤´åƒ URLï¼‰ã€‚</li>
</ul>
<p>âœ… å®æˆ˜æŠ€å·§ï¼šåˆ†åº“åˆ†è¡¨çš„ â€œåˆ†ç‰‡é”®â€ é€‰æ‹©ï¼Œè¦å¯¹åº” OS çš„ â€œåˆ†åŒºç­–ç•¥â€â€”â€” æ¯”å¦‚æŒ‰ â€œç”¨æˆ· ID å–æ¨¡â€ åˆ†åº“ï¼ˆ<code>user_id % 4</code> â†’ 4 ä¸ªåº“ï¼‰ï¼Œç¡®ä¿æ•°æ®å‡åŒ€åˆ†å¸ƒï¼Œé¿å… â€œæŸä¸ªåˆ†åŒºæ•°æ®è¿‡å¤šâ€ï¼ˆå¯¹åº” OS çš„ â€œåˆ†åŒºç¢ç‰‡â€ï¼‰ï¼›æŒ‰ â€œæ—¶é—´èŒƒå›´â€ åˆ†è¡¨æ—¶ï¼Œè¦æå‰è§„åˆ’åˆ†åŒºï¼ˆæ¯”å¦‚æ¯æœˆé¢„åˆ›å»ºä¸‹ä¸€ä¸ªæœˆçš„è¡¨ï¼‰ï¼Œé¿å… â€œåŠ¨æ€åˆ›å»ºåˆ†åŒºâ€ å¯¼è‡´çš„æ€§èƒ½æŠ–åŠ¨ã€‚</p>
<h5 data-id="heading-10">ï¼ˆ2ï¼‰ç´¢å¼•è®¾è®¡ï¼šå¯¹åº” OS çš„ â€œå¿«é€ŸæŸ¥æ‰¾â€</h5>
<p>OS é‡Œçš„ â€œé¡µè¡¨â€â€œå¿«è¡¨ï¼ˆTLBï¼‰â€ æ˜¯ä¸ºäº† â€œå¿«é€Ÿæ‰¾åˆ°å†…å­˜åœ°å€â€ï¼Œæ•°æ®åº“çš„ç´¢å¼•æ˜¯ä¸ºäº† â€œå¿«é€Ÿæ‰¾åˆ°æ•°æ®è¡Œâ€â€”â€” ä¸¤è€…éƒ½æ˜¯ â€œç©ºé—´æ¢æ—¶é—´â€ çš„æ€è·¯ï¼šç”¨é¢å¤–çš„å­˜å‚¨ï¼ˆç´¢å¼• / é¡µè¡¨ï¼‰ï¼Œæ¢å–æ›´å¿«çš„æŸ¥è¯¢é€Ÿåº¦ã€‚</p>
<p>æˆ‘ä¹‹å‰ç»™è®¢å•è¡¨åŠ äº†ç´¢å¼•ï¼Œåè€ŒæŸ¥è¯¢æ›´æ…¢äº†ï¼è¿™æ˜¯ä¸ºå•¥ï¼Ÿ</p>
<p>è¿™å°±æ˜¯æ²¡ç†è§£ â€œç´¢å¼•çš„å­˜å‚¨æˆæœ¬â€â€”â€”OS çš„å¿«è¡¨ï¼ˆTLBï¼‰å®¹é‡æœ‰é™ï¼Œå¤ªå¤šé¡µè¡¨é¡¹ä¼šå¯¼è‡´ â€œå¿«è¡¨å‘½ä¸­ç‡ä¸‹é™â€ï¼›æ•°æ®åº“çš„ç´¢å¼•ä¹Ÿä¸€æ ·ï¼Œç´¢å¼•ä¸æ˜¯è¶Šå¤šè¶Šå¥½ï¼Œè¿‡å¤šç´¢å¼•ä¼šå¯¼è‡´ï¼š</p>
<ol>
<li><strong>å†™æ“ä½œå˜æ…¢</strong>ï¼šæ’å…¥ / æ›´æ–° / åˆ é™¤æ•°æ®æ—¶ï¼Œä¸ä»…è¦æ”¹æ•°æ®ï¼Œè¿˜è¦åŒæ­¥æ›´æ–°æ‰€æœ‰ç›¸å…³ç´¢å¼•ï¼ˆå¯¹åº” OS â€œæ›´æ–°é¡µè¡¨çš„å¼€é”€â€ï¼‰ï¼›</li>
<li><strong>ç´¢å¼•ç¢ç‰‡</strong>ï¼šé¢‘ç¹åˆ é™¤æ•°æ®ä¼šå¯¼è‡´ç´¢å¼•æ–‡ä»¶äº§ç”Ÿç¢ç‰‡ï¼ŒæŸ¥è¯¢æ—¶éœ€è¦æ‰«ææ›´å¤š â€œç´¢å¼•é¡µâ€ï¼ˆå¯¹åº” OS çš„ â€œå†…å­˜ç¢ç‰‡â€ï¼‰ã€‚</li>
</ol>
<p>âœ… åç«¯ç´¢å¼•è®¾è®¡å®æˆ˜åŸåˆ™ï¼ˆå¯¹åº” OSâ€œå¿«é€ŸæŸ¥æ‰¾ + ä½å¼€é”€â€ï¼‰ï¼š</p>
<ul>
<li>åªç»™ â€œæŸ¥è¯¢é¢‘ç¹çš„å­—æ®µâ€ å»ºç´¢å¼•ï¼ˆæ¯”å¦‚è®¢å•è¡¨çš„<code>user_id</code>ã€<code>order_no</code>ï¼‰ï¼Œé¿å…ç»™ â€œæ›´æ–°é¢‘ç¹çš„å­—æ®µâ€ å»ºç´¢å¼•ï¼ˆæ¯”å¦‚<code>status</code>å­—æ®µï¼Œè®¢å•çŠ¶æ€ç»å¸¸å˜åŒ–ï¼‰ï¼›</li>
<li>è”åˆç´¢å¼•è¦éµå¾ª â€œæœ€å·¦å‰ç¼€åŸåˆ™â€ï¼ˆæ¯”å¦‚<code>idx_user_time</code>ï¼ˆuser_id, create_timeï¼‰ï¼Œèƒ½å‘½ä¸­<code>where user_id=?</code>æˆ–<code>where user_id=? and create_time=?</code>ï¼Œä½†ä¸èƒ½å‘½ä¸­<code>where create_time=?</code>ï¼‰ï¼Œè¿™å°±åƒ OS çš„ â€œé¡µè¡¨æŸ¥æ‰¾è¦æŒ‰åœ°å€é¡ºåºâ€ï¼Œé¿å…æ— åºæŸ¥æ‰¾ï¼›</li>
<li>ç”¨ â€œè¦†ç›–ç´¢å¼•â€ å‡å°‘å›è¡¨ï¼ˆæ¯”å¦‚æŸ¥è¯¢<code>user_id=?</code>çš„è®¢å•å·å’Œåˆ›å»ºæ—¶é—´ï¼Œç›´æ¥å»º<code>idx_user_order_time</code>ï¼ˆuser_id, order_no, create_timeï¼‰ï¼Œç´¢å¼•ä¸­åŒ…å«æ‰€æœ‰éœ€è¦çš„å­—æ®µï¼Œä¸ç”¨å†æŸ¥ä¸»è¡¨ï¼‰ï¼Œå¯¹åº” OS çš„ â€œå¿«è¡¨ç›´æ¥è¿”å›åœ°å€ï¼Œä¸ç”¨æŸ¥é¡µè¡¨â€ã€‚</li>
</ul>
<h4 data-id="heading-11">2. ç¼“å­˜ç­–ç•¥ï¼šRedis çš„åº”ç”¨ï¼Œå¯¹åº” OS çš„ â€œé«˜é€Ÿç¼“å­˜â€</h4>
<p>OS çš„ â€œé«˜é€Ÿç¼“å­˜ï¼ˆCacheï¼‰â€ æ˜¯ä¸ºäº† â€œè®© CPU å¿«é€Ÿè®¿é—®å¸¸ç”¨æ•°æ®â€ï¼Œé¿å…é¢‘ç¹è®¿é—®æ…¢é€Ÿå†…å­˜ï¼›åç«¯çš„ Redis ç¼“å­˜æ˜¯ä¸ºäº† â€œè®©åº”ç”¨å¿«é€Ÿè®¿é—®å¸¸ç”¨æ•°æ®â€ï¼Œé¿å…é¢‘ç¹è®¿é—®æ…¢é€Ÿæ•°æ®åº“ â€”â€” ä¸¤è€…çš„æ ¸å¿ƒé€»è¾‘å®Œå…¨ä¸€è‡´ï¼šâ€œæŠŠå¸¸ç”¨æ•°æ®æ”¾åˆ°æ›´å¿«çš„å­˜å‚¨ä»‹è´¨ä¸­â€ã€‚</p>
<p>ä½ å­¦è¿‡çš„ â€œç¼“å­˜æ›¿æ¢ç®—æ³•â€ï¼ˆLRUã€FIFOã€LFUï¼‰ï¼Œåœ¨ Redis é‡Œç›´æ¥å°±èƒ½ç”¨ï¼æ¯”å¦‚ï¼š</p>
<h5 data-id="heading-12">ï¼ˆ1ï¼‰Redis ç¼“å­˜é…ç½®ï¼šç›´æ¥åº”ç”¨ â€œç¼“å­˜æ›¿æ¢ç®—æ³•â€</h5>
<p>OS çš„ â€œé¡µé¢ç½®æ¢ç®—æ³•â€ æ˜¯ä¸ºäº† â€œå½“ç¼“å­˜æ»¡äº†ï¼Œæ·˜æ±°ä¸å¸¸ç”¨çš„é¡µé¢â€ï¼ŒRedis çš„<code>maxmemory-policy</code>é…ç½®å°±æ˜¯å¹²è¿™ä¸ªçš„ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">Â <span class="hljs-comment"># Redisé…ç½®æ–‡ä»¶ï¼ˆredis.confï¼‰</span>
Â maxmemory 4gb <span class="hljs-comment"># ç¼“å­˜æœ€å¤§å®¹é‡ï¼ˆå¯¹åº”OSç¼“å­˜å¤§å°ï¼‰</span>
Â maxmemory-policy allkeys-lru <span class="hljs-comment"># å½“ç¼“å­˜æ»¡äº†ï¼Œæ·˜æ±°æ‰€æœ‰keyä¸­æœ€è¿‘æœ€å°‘ä½¿ç”¨çš„ï¼ˆLRUç®—æ³•ï¼‰</span>
</code></pre>
<p>âœ… å®æˆ˜åœºæ™¯ï¼šä½ åšç”µå•†çš„ â€œå•†å“è¯¦æƒ…é¡µâ€ æ¥å£ï¼Œæ¯å¤©æœ‰ 10 ä¸‡æ¬¡è®¿é—®ï¼Œå…¶ä¸­ 80% æ˜¯è®¿é—®çƒ­é—¨å•†å“ï¼ˆæ¯”å¦‚é”€é‡å‰ 100 çš„å•†å“ï¼‰ã€‚å¦‚æœæ¯æ¬¡éƒ½æŸ¥æ•°æ®åº“ï¼Œæ•°æ®åº“è‚¯å®šæ‰›ä¸ä½ â€”â€” è¿™æ—¶å€™å°±ç”¨ Redis ç¼“å­˜ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript">Â <span class="hljs-comment">// åç«¯æ¥å£ï¼ˆJava+Spring Bootï¼‰ï¼šç¼“å­˜+æ•°æ®åº“çš„â€œåŒè¯»åŒå†™â€</span>
Â <span class="hljs-meta">@Service</span>
Â <span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ProductService</span> {
Â  Â <span class="hljs-meta">@Autowired</span>
Â  Â <span class="hljs-keyword">private</span> <span class="hljs-title class_">RedisTemplate</span>&lt;<span class="hljs-title class_">String</span>, <span class="hljs-title class_">Product</span>&gt; redisTemplate;
Â  Â <span class="hljs-meta">@Autowired</span>
Â  Â <span class="hljs-keyword">private</span> <span class="hljs-title class_">ProductMapper</span> productMapper;
Â â€‹
Â  Â <span class="hljs-comment">// ç¼“å­˜keyå‰ç¼€ï¼ˆå¯¹åº”OSâ€œç¼“å­˜åœ°å€å‰ç¼€â€ï¼‰</span>
Â  Â <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> final <span class="hljs-title class_">String</span> <span class="hljs-variable constant_">CACHE_KEY_PRODUCT</span> = <span class="hljs-string">"product:"</span>;
Â â€‹
Â  Â <span class="hljs-comment">// æŸ¥è¯¢å•†å“è¯¦æƒ…ï¼šå…ˆæŸ¥ç¼“å­˜ï¼Œå†æŸ¥æ•°æ®åº“ï¼ˆå¯¹åº”OSâ€œå…ˆæŸ¥Cacheï¼Œå†æŸ¥å†…å­˜â€ï¼‰</span>
Â  Â <span class="hljs-keyword">public</span> <span class="hljs-title class_">Product</span> <span class="hljs-title function_">getProductById</span>(<span class="hljs-params">Long productId</span>) {
Â  Â  Â <span class="hljs-title class_">String</span> cacheKey = <span class="hljs-variable constant_">CACHE_KEY_PRODUCT</span> + productId;
Â  Â  Â <span class="hljs-comment">// 1. å…ˆæŸ¥Redisç¼“å­˜ï¼ˆé«˜é€Ÿç¼“å­˜ï¼‰</span>
Â  Â  Â <span class="hljs-title class_">Product</span> product = redisTemplate.<span class="hljs-title function_">opsForValue</span>().<span class="hljs-title function_">get</span>(cacheKey);
Â  Â  Â <span class="hljs-keyword">if</span> (product != <span class="hljs-literal">null</span>) {
Â  Â  Â  Â <span class="hljs-keyword">return</span> product; <span class="hljs-comment">// ç¼“å­˜å‘½ä¸­ï¼Œç›´æ¥è¿”å›ï¼ˆå¯¹åº”OS Cacheå‘½ä¸­ï¼‰</span>
Â  Â   }
Â â€‹
Â  Â  Â <span class="hljs-comment">// 2. ç¼“å­˜æœªå‘½ä¸­ï¼ŒæŸ¥æ•°æ®åº“ï¼ˆæ…¢é€Ÿå­˜å‚¨ï¼‰</span>
Â  Â  Â product = productMapper.<span class="hljs-title function_">selectById</span>(productId);
Â  Â  Â <span class="hljs-keyword">if</span> (product != <span class="hljs-literal">null</span>) {
Â  Â  Â  Â <span class="hljs-comment">// 3. æŠŠæ•°æ®åº“æŸ¥è¯¢ç»“æœå­˜å…¥ç¼“å­˜ï¼Œè®¾ç½®è¿‡æœŸæ—¶é—´ï¼ˆé¿å…ç¼“å­˜æ•°æ®è¿‡æœŸï¼‰</span>
Â  Â  Â  Â redisTemplate.<span class="hljs-title function_">opsForValue</span>().<span class="hljs-title function_">set</span>(cacheKey, product, <span class="hljs-number">1</span>, <span class="hljs-title class_">TimeUnit</span>.<span class="hljs-property">HOURS</span>);
Â  Â   }
Â  Â  Â <span class="hljs-keyword">return</span> product;
Â   }
Â â€‹
Â  Â <span class="hljs-comment">// æ›´æ–°å•†å“ä¿¡æ¯ï¼šå…ˆæ›´æ•°æ®åº“ï¼Œå†æ›´ç¼“å­˜ï¼ˆå¯¹åº”OSâ€œå†™å›Cacheâ€ï¼‰</span>
Â  Â <span class="hljs-keyword">public</span> <span class="hljs-built_in">boolean</span> <span class="hljs-title function_">updateProduct</span>(<span class="hljs-params">Product product</span>) {
Â  Â  Â <span class="hljs-comment">// 1. å…ˆæ›´æ–°æ•°æ®åº“</span>
Â  Â  Â <span class="hljs-built_in">boolean</span> success = productMapper.<span class="hljs-title function_">updateById</span>(product) &gt; <span class="hljs-number">0</span>;
Â  Â  Â <span class="hljs-keyword">if</span> (success) {
Â  Â  Â  Â <span class="hljs-title class_">String</span> cacheKey = <span class="hljs-variable constant_">CACHE_KEY_PRODUCT</span> + product.<span class="hljs-title function_">getId</span>();
Â  Â  Â  Â <span class="hljs-comment">// 2. æ›´æ–°ç¼“å­˜ï¼ˆæˆ–åˆ é™¤ç¼“å­˜ï¼Œè®©ä¸‹æ¬¡æŸ¥è¯¢é‡æ–°åŠ è½½ï¼‰</span>
Â  Â  Â  Â redisTemplate.<span class="hljs-title function_">opsForValue</span>().<span class="hljs-title function_">set</span>(cacheKey, product, <span class="hljs-number">1</span>, <span class="hljs-title class_">TimeUnit</span>.<span class="hljs-property">HOURS</span>);
Â  Â   }
Â  Â  Â <span class="hljs-keyword">return</span> success;
Â   }
Â }
</code></pre>
<h5 data-id="heading-13">ï¼ˆ2ï¼‰ç¼“å­˜ä¸‰å¤§é—®é¢˜ï¼šç”¨ OS â€œç¼“å­˜ç®¡ç†â€ æ€è·¯è§£å†³</h5>
<p>OS é‡Œæœ‰ â€œç¼“å­˜ä¸€è‡´æ€§â€ é—®é¢˜ï¼ˆæ¯”å¦‚ Cache å’Œå†…å­˜æ•°æ®ä¸ä¸€è‡´ï¼‰ï¼ŒRedis ç¼“å­˜ä¹Ÿæœ‰ä¸‰å¤§ç»å…¸é—®é¢˜ â€”â€” ç¼“å­˜ç©¿é€ã€ç¼“å­˜å‡»ç©¿ã€ç¼“å­˜é›ªå´©ï¼Œè§£å†³æ€è·¯å®Œå…¨å€Ÿé‰´ OS çš„ â€œç¼“å­˜ç®¡ç†â€ï¼š</p>





























<table><thead><tr><th>ç¼“å­˜é—®é¢˜</th><th>æœ¬è´¨åŸå› </th><th>è§£å†³æ€è·¯ï¼ˆå¯¹åº” OS ç†è®ºï¼‰</th><th>å®æˆ˜æ–¹æ¡ˆ</th></tr></thead><tbody><tr><td>ç¼“å­˜ç©¿é€</td><td>æŸ¥ä¸å­˜åœ¨çš„æ•°æ®ï¼Œç¼“å­˜å’Œæ•°æ®åº“éƒ½æ²¡å‘½ä¸­</td><td>OS â€œç¼“å­˜æœªå‘½ä¸­å¤„ç†â€</td><td>1. ç©ºå€¼ç¼“å­˜ï¼ˆä¸å­˜åœ¨çš„ key å­˜ç©ºå€¼ï¼Œè¿‡æœŸæ—¶é—´ 5 åˆ†é’Ÿï¼‰ï¼›2. å¸ƒéš†è¿‡æ»¤å™¨ï¼ˆæå‰è¿‡æ»¤ä¸å­˜åœ¨çš„ keyï¼‰</td></tr><tr><td>ç¼“å­˜å‡»ç©¿</td><td>çƒ­é—¨ key è¿‡æœŸï¼Œå¤§é‡è¯·æ±‚åŒæ—¶æŸ¥æ•°æ®åº“</td><td>OS â€œç¼“å­˜å¤±æ•ˆä¿æŠ¤â€</td><td>1. äº’æ–¥é”ï¼ˆåŒä¸€æ—¶é—´åªè®©ä¸€ä¸ªè¯·æ±‚æŸ¥æ•°æ®åº“ï¼Œå…¶ä»–è¯·æ±‚ç­‰ç¼“å­˜ï¼‰ï¼›2. çƒ­ç‚¹ key æ°¸ä¸è¿‡æœŸ</td></tr><tr><td>ç¼“å­˜é›ªå´©</td><td>å¤§é‡ key åŒæ—¶è¿‡æœŸï¼Œæˆ– Redis å®•æœºï¼Œè¯·æ±‚å…¨æ‰“æ•°æ®åº“</td><td>OS â€œç¼“å­˜å®¹é”™æœºåˆ¶â€</td><td>1. è¿‡æœŸæ—¶é—´åŠ éšæœºå€¼ï¼ˆé¿å…åŒæ—¶è¿‡æœŸï¼‰ï¼›2. Redis é›†ç¾¤ï¼ˆé¿å…å•ç‚¹æ•…éšœï¼‰ï¼›3. é™çº§ç†”æ–­ï¼ˆRedis å®•æœºæ—¶ï¼Œè¿”å›é»˜è®¤æ•°æ®ï¼‰</td></tr></tbody></table>
<h4 data-id="heading-14">3. JVM å†…å­˜é…ç½®ï¼šå¯¹åº” OS çš„ â€œå†…å­˜åˆ†é…ä¸å›æ”¶â€</h4>
<h5 data-id="heading-15">ï¼ˆ1ï¼‰JVM å †å†…å­˜åˆ†é…ï¼šå¯¹åº” OS çš„ â€œå†…å­˜åˆ†åŒºâ€</h5>
<p>OS æŠŠå†…å­˜åˆ†æˆ â€œç”¨æˆ·åŒºã€å†…æ ¸åŒºâ€ï¼ŒJVM æŠŠå †å†…å­˜åˆ†æˆ â€œå¹´è½»ä»£ã€è€å¹´ä»£ã€å…ƒç©ºé—´â€â€”â€” éƒ½æ˜¯ä¸ºäº† â€œæŒ‰æ•°æ®ç‰¹æ€§åˆ†é…ä¸åŒç©ºé—´ï¼Œä¼˜åŒ–ç®¡ç†æ•ˆç‡â€ã€‚</p>
<p>âœ… å®æˆ˜é…ç½®ï¼ˆSpring Boot é¡¹ç›®å¯åŠ¨å‚æ•°ï¼‰ï¼š</p>
<pre><code class="hljs language-ini" lang="ini">Â <span class="hljs-comment"># JVMå¯åŠ¨å‚æ•°ï¼ˆå¯¹åº”OSå†…å­˜åˆ†é…ï¼‰</span>
Â java -jar your-project.jar \
Â -Xms4g \ <span class="hljs-comment"># åˆå§‹å †å†…å­˜ï¼ˆå¯¹åº”OSåˆå§‹å†…å­˜åˆ†é…ï¼‰</span>
Â -Xmx8g \ <span class="hljs-comment"># æœ€å¤§å †å†…å­˜ï¼ˆå¯¹åº”OSæœ€å¤§å†…å­˜é™åˆ¶ï¼‰</span>
Â -XX:<span class="hljs-attr">NewRatio</span>=<span class="hljs-number">2</span> \ <span class="hljs-comment"># å¹´è½»ä»£:è€å¹´ä»£=1:2ï¼ˆå¹´è½»ä»£å­˜çŸ­æœŸå¯¹è±¡ï¼Œè€å¹´ä»£å­˜é•¿æœŸå¯¹è±¡ï¼‰</span>
Â -XX:<span class="hljs-attr">SurvivorRatio</span>=<span class="hljs-number">8</span> \ <span class="hljs-comment"># å¹´è½»ä»£ä¸­EdenåŒº:SurvivoråŒº=8:2ï¼ˆEdenåŒºå­˜æ–°åˆ›å»ºå¯¹è±¡ï¼ŒSurvivoråŒºå­˜å­˜æ´»å¯¹è±¡ï¼‰</span>
Â -XX:+UseG1GC \ <span class="hljs-comment"># ä½¿ç”¨G1åƒåœ¾å›æ”¶å™¨ï¼ˆå¯¹åº”OSçš„â€œé«˜æ•ˆå†…å­˜å›æ”¶ç®—æ³•â€ï¼‰</span>
</code></pre>
<h5 data-id="heading-16">ï¼ˆ2ï¼‰å†…å­˜æ³„æ¼æ’æŸ¥ï¼šå¯¹åº” OS çš„ â€œå†…å­˜æ³„æ¼æ£€æµ‹â€</h5>
<p>OS çš„ â€œå†…å­˜æ³„æ¼â€ æ˜¯ â€œè¿›ç¨‹å ç”¨å†…å­˜ä¸é‡Šæ”¾ï¼Œå¯¼è‡´å†…å­˜è€—å°½â€ï¼ŒJVM çš„ â€œå†…å­˜æ³„æ¼â€ æ˜¯ â€œå¯¹è±¡å ç”¨å †å†…å­˜ä¸é‡Šæ”¾ï¼Œå¯¼è‡´ OOMï¼ˆå†…å­˜æº¢å‡ºï¼‰â€â€”â€” æ’æŸ¥æ€è·¯å®Œå…¨ä¸€è‡´ï¼šâ€œæ‰¾åˆ°ä¸è¢«å¼•ç”¨ä½†è¿˜å ç”¨å†…å­˜çš„å¯¹è±¡â€ã€‚</p>
<p>âœ… å®æˆ˜å·¥å…·ï¼šç”¨<code>jmap</code>+<code>MAT</code>å·¥å…·æ’æŸ¥å†…å­˜æ³„æ¼ï¼Œå°±åƒ OS ç”¨ â€œå†…å­˜æ£€æµ‹å·¥å…·â€ æ’æŸ¥æ³„æ¼ä¸€æ ·ï¼š</p>
<pre><code class="hljs language-ini" lang="ini">Â <span class="hljs-comment"># 1. æŸ¥çœ‹JVMè¿›ç¨‹ID</span>
Â jps -l
Â â€‹
Â <span class="hljs-comment"># 2. å¯¼å‡ºå †å†…å­˜å¿«ç…§ï¼ˆå¯¹åº”OSå¯¼å‡ºå†…å­˜çŠ¶æ€ï¼‰</span>
Â jmap -dump:<span class="hljs-attr">format</span>=b,file=heapdump.hprof <span class="hljs-number">12345</span>ï¼ˆè¿›ç¨‹IDï¼‰
Â â€‹
Â <span class="hljs-comment"># 3. ç”¨MATå·¥å…·ï¼ˆMemory Analyzer Toolï¼‰åˆ†æå¿«ç…§ï¼Œæ‰¾åˆ°å†…å­˜æ³„æ¼ç‚¹</span>
</code></pre>
<p>ğŸ“Œ å¸¸è§å†…å­˜æ³„æ¼åœºæ™¯ï¼ˆå¯¹åº” OS â€œå†…å­˜æ³„æ¼åŸå› â€ï¼‰ï¼š</p>
<ul>
<li>é™æ€é›†åˆç±»ï¼ˆå¦‚<code>static List</code>ï¼‰æŒæœ‰å¤§é‡å¯¹è±¡ï¼Œä¸åŠæ—¶æ¸…ç†ï¼ˆå¯¹åº” OS â€œé™æ€å†…å­˜ä¸é‡Šæ”¾â€ï¼‰ï¼›</li>
<li>çº¿ç¨‹æ± æ ¸å¿ƒçº¿ç¨‹æ•°è®¾ç½®è¿‡å¤§ï¼Œä¸”çº¿ç¨‹æŒæœ‰å¤§é‡å¯¹è±¡ï¼ˆå¯¹åº” OS â€œè¿›ç¨‹æŒæœ‰å†…å­˜ä¸é‡Šæ”¾â€ï¼‰ï¼›</li>
<li>è¿æ¥æ± ï¼ˆæ•°æ®åº“è¿æ¥æ± ã€Redis è¿æ¥æ± ï¼‰æœªå…³é—­è¿æ¥ï¼ˆå¯¹åº” OS â€œèµ„æºå¥æŸ„æœªé‡Šæ”¾â€ï¼‰ã€‚</li>
</ul>
<h3 data-id="heading-17">ä¸‰ã€å…¨æ ˆååŒï¼šå­˜å‚¨ç®¡ç†çš„ â€œè·¨ç«¯ä¼˜åŒ–â€ æŠ€å·§</h3>
<h4 data-id="heading-18">1. å‰åç«¯æ•°æ®åŒæ­¥ï¼šå¯¹åº” OS çš„ â€œæ•°æ®ä¸€è‡´æ€§â€</h4>
<p>OS è¦ä¿è¯ â€œCache å’Œå†…å­˜æ•°æ®ä¸€è‡´â€ï¼Œå‰åç«¯è¦ä¿è¯ â€œæœ¬åœ°å­˜å‚¨å’Œæ•°æ®åº“æ•°æ®ä¸€è‡´â€ã€‚æ¯”å¦‚ä½ åš â€œç¦»çº¿è¡¨å•â€ åŠŸèƒ½ï¼š</p>
<p>âœ… å®æˆ˜åœºæ™¯ï¼šç”¨æˆ·åœ¨å‰ç«¯å¡«å†™è¡¨å•ï¼ˆæ¯”å¦‚æŠ¥é”€å•ï¼‰ï¼Œå¡«å†™è¿‡ç¨‹ä¸­ç½‘ç»œæ–­å¼€ â€”â€” è¿™æ—¶å€™å‰ç«¯æŠŠè¡¨å•æ•°æ®å­˜åˆ° IndexedDBï¼ˆå¯¹åº” OS â€œæœ¬åœ°ç¼“å­˜â€ï¼‰ï¼Œç½‘ç»œæ¢å¤åï¼Œè‡ªåŠ¨åŒæ­¥åˆ°åç«¯æ•°æ®åº“ï¼ˆå¯¹åº” OS â€œç¼“å­˜å†™å›å†…å­˜â€ï¼‰ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript">Â <span class="hljs-comment">// å‰ç«¯ï¼šç¦»çº¿å­˜å‚¨+è‡ªåŠ¨åŒæ­¥</span>
Â <span class="hljs-keyword">const</span> <span class="hljs-title function_">saveFormOffline</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params">formData</span>) =&gt; {
Â  Â <span class="hljs-comment">// 1. å­˜å…¥IndexedDBï¼ˆç¦»çº¿å­˜å‚¨ï¼Œå¯¹åº”OSæœ¬åœ°ç¼“å­˜ï¼‰</span>
Â  Â <span class="hljs-keyword">await</span> indexedDB.<span class="hljs-title function_">open</span>(<span class="hljs-string">'FormDB'</span>, <span class="hljs-number">1</span>).<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">db</span> =&gt;</span> {
Â  Â  Â <span class="hljs-keyword">const</span> transaction = db.<span class="hljs-title function_">transaction</span>(<span class="hljs-string">'offlineForms'</span>, <span class="hljs-string">'readwrite'</span>);
Â  Â  Â <span class="hljs-keyword">const</span> store = transaction.<span class="hljs-title function_">objectStore</span>(<span class="hljs-string">'offlineForms'</span>);
Â  Â  Â store.<span class="hljs-title function_">add</span>({
Â  Â  Â  Â <span class="hljs-attr">id</span>: <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>(),
Â  Â  Â  Â formData,
Â  Â  Â  Â <span class="hljs-attr">status</span>: <span class="hljs-string">'pending'</span>, <span class="hljs-comment">// çŠ¶æ€ï¼šå¾…åŒæ­¥</span>
Â  Â  Â  Â <span class="hljs-attr">createTime</span>: <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>()
Â  Â   });
Â   });
Â â€‹
Â  Â <span class="hljs-comment">// 2. ç›‘å¬ç½‘ç»œæ¢å¤ï¼Œè‡ªåŠ¨åŒæ­¥åˆ°åç«¯</span>
Â  Â <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'online'</span>, <span class="hljs-keyword">async</span> () =&gt; {
Â  Â  Â <span class="hljs-keyword">const</span> db = <span class="hljs-keyword">await</span> indexedDB.<span class="hljs-title function_">open</span>(<span class="hljs-string">'FormDB'</span>, <span class="hljs-number">1</span>);
Â  Â  Â <span class="hljs-keyword">const</span> transaction = db.<span class="hljs-title function_">transaction</span>(<span class="hljs-string">'offlineForms'</span>, <span class="hljs-string">'readwrite'</span>);
Â  Â  Â <span class="hljs-keyword">const</span> store = transaction.<span class="hljs-title function_">objectStore</span>(<span class="hljs-string">'offlineForms'</span>);
Â  Â  Â <span class="hljs-keyword">const</span> pendingForms = <span class="hljs-keyword">await</span> store.<span class="hljs-title function_">getAll</span>({ <span class="hljs-attr">status</span>: <span class="hljs-string">'pending'</span> });
Â â€‹
Â  Â  Â <span class="hljs-comment">// æ‰¹é‡åŒæ­¥åˆ°åç«¯</span>
Â  Â  Â <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> form <span class="hljs-keyword">of</span> pendingForms) {
Â  Â  Â  Â <span class="hljs-keyword">try</span> {
Â  Â  Â  Â  Â <span class="hljs-keyword">await</span> axios.<span class="hljs-title function_">post</span>(<span class="hljs-string">'/api/form/submit'</span>, form.<span class="hljs-property">formData</span>);
Â  Â  Â  Â  Â <span class="hljs-comment">// åŒæ­¥æˆåŠŸï¼Œæ›´æ–°çŠ¶æ€ä¸ºâ€œå·²åŒæ­¥â€ï¼ˆå¯¹åº”OSâ€œç¼“å­˜å†™å›æˆåŠŸâ€ï¼‰</span>
Â  Â  Â  Â  Â store.<span class="hljs-title function_">put</span>({ ...form, <span class="hljs-attr">status</span>: <span class="hljs-string">'synced'</span> });
Â  Â  Â   } <span class="hljs-keyword">catch</span> (error) {
Â  Â  Â  Â  Â <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'åŒæ­¥å¤±è´¥ï¼Œä¸‹æ¬¡é‡è¯•'</span>, error);
Â  Â  Â   }
Â  Â   }
Â   });
Â };
</code></pre>
<h4 data-id="heading-19">2. åˆ†å¸ƒå¼å­˜å‚¨ï¼šå¯¹åº” OS çš„ â€œå¤–éƒ¨å­˜å‚¨ç®¡ç†â€</h4>
<p>OS ç®¡ç† â€œæœ¬åœ°ç£ç›˜ã€U ç›˜â€ ç­‰å¤–éƒ¨å­˜å‚¨ï¼Œåç«¯ç®¡ç† â€œåˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿï¼ˆOSSã€MinIOï¼‰ã€åˆ†å¸ƒå¼æ•°æ®åº“ï¼ˆMySQL é›†ç¾¤ï¼‰â€â€”â€” æ ¸å¿ƒé€»è¾‘éƒ½æ˜¯ â€œç®¡ç†å¤šä¸ªå­˜å‚¨èŠ‚ç‚¹ï¼Œå®ç°å®¹é‡æ‰©å±•ã€é«˜å¯ç”¨â€ã€‚</p>
<p>âœ… å®æˆ˜åœºæ™¯ï¼šä½ åšçš„ç”µå•†é¡¹ç›®ï¼Œç”¨æˆ·ä¸Šä¼ çš„å•†å“å›¾ç‰‡ã€è§†é¢‘ï¼Œä¸èƒ½å­˜åœ¨å•å°æœåŠ¡å™¨çš„æœ¬åœ°ç£ç›˜ï¼ˆå¯¹åº” OS â€œæœ¬åœ°ç£ç›˜å®¹é‡æœ‰é™â€ï¼‰ï¼Œè¦å­˜åˆ°åˆ†å¸ƒå¼å­˜å‚¨ï¼ˆå¦‚é˜¿é‡Œäº‘ OSSï¼‰ï¼š</p>
<pre><code class="hljs language-java" lang="java">Â <span class="hljs-comment">// åç«¯ï¼šæ–‡ä»¶ä¸Šä¼ åˆ°OSSï¼ˆå¯¹åº”OSâ€œå¤–éƒ¨å­˜å‚¨å†™å…¥â€ï¼‰</span>
Â <span class="hljs-meta">@Service</span>
Â <span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OssService</span> {
Â  Â <span class="hljs-meta">@Autowired</span>
Â  Â <span class="hljs-keyword">private</span> OSSClient ossClient;
Â â€‹
Â  Â <span class="hljs-comment">// OSSé…ç½®ï¼ˆå¯¹åº”OSå¤–éƒ¨å­˜å‚¨é…ç½®ï¼‰</span>
Â  Â <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">BUCKET_NAME</span> <span class="hljs-operator">=</span> <span class="hljs-string">"your-bucket"</span>;
Â  Â <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">ENDPOINT</span> <span class="hljs-operator">=</span> <span class="hljs-string">"oss-cn-beijing.aliyuncs.com"</span>;
Â â€‹
Â  Â <span class="hljs-keyword">public</span> String <span class="hljs-title function_">uploadFile</span><span class="hljs-params">(MultipartFile file)</span> <span class="hljs-keyword">throws</span> IOException {
Â  Â  Â <span class="hljs-comment">// 1. ç”Ÿæˆå”¯ä¸€æ–‡ä»¶åï¼ˆé¿å…æ–‡ä»¶é‡åï¼Œå¯¹åº”OSâ€œæ–‡ä»¶å”¯ä¸€æ ‡è¯†â€ï¼‰</span>
Â  Â  Â <span class="hljs-type">String</span> <span class="hljs-variable">fileName</span> <span class="hljs-operator">=</span> UUID.randomUUID().toString() + <span class="hljs-string">"."</span> + FilenameUtils.getExtension(file.getOriginalFilename());
Â  Â  Â <span class="hljs-comment">// 2. ä¸Šä¼ æ–‡ä»¶åˆ°OSSï¼ˆå¤–éƒ¨å­˜å‚¨ï¼‰</span>
Â  Â  Â ossClient.putObject(
Â  Â  Â  Â BUCKET_NAME,
Â  Â  Â  Â <span class="hljs-string">"product-images/"</span> + fileName, <span class="hljs-comment">// å­˜å‚¨è·¯å¾„ï¼ˆå¯¹åº”OSæ–‡ä»¶è·¯å¾„ï¼‰</span>
Â  Â  Â  Â file.getInputStream()
Â  Â   );
Â  Â  Â <span class="hljs-comment">// 3. è¿”å›æ–‡ä»¶è®¿é—®URLï¼ˆå¯¹åº”OSæ–‡ä»¶è®¿é—®åœ°å€ï¼‰</span>
Â  Â  Â <span class="hljs-keyword">return</span> <span class="hljs-string">"https://"</span> + BUCKET_NAME + <span class="hljs-string">"."</span> + ENDPOINT + <span class="hljs-string">"/product-images/"</span> + fileName;
Â   }
Â }
</code></pre>
<h3 data-id="heading-20">å››ã€é¿å‘æŒ‡å—ï¼šå­˜å‚¨ç®¡ç†å®æˆ˜ä¸­çš„ â€œé«˜é¢‘è¸©å‘ç‚¹â€</h3>
<h4 data-id="heading-21">1. å‰ç«¯è¸©å‘ï¼š</h4>
<ul>
<li>âŒ ç”¨ localStorage å­˜å¤§æ–‡ä»¶ï¼ˆæ¯”å¦‚ 10MB çš„ JSON æ•°æ®ï¼‰ï¼šlocalStorage å®¹é‡åªæœ‰ 5MBï¼Œä¸”åŒæ­¥è¯»å–ä¼šé˜»å¡ UIâ€”â€” å¯¹åº” OSâ€œç”¨å†…å­˜å­˜å¤§æ–‡ä»¶ï¼Œå¯¼è‡´å†…å­˜ä¸è¶³â€ï¼Œåº”è¯¥ç”¨ IndexedDBã€‚</li>
<li>âŒ ä¸æ¸…ç†äº‹ä»¶ç›‘å¬ / å®šæ—¶å™¨ï¼šå¯¼è‡´å†…å­˜æ³„æ¼ â€”â€” å¯¹åº” OS â€œè¿›ç¨‹é€€å‡ºä¸é‡Šæ”¾å†…å­˜â€ï¼Œç»„ä»¶å¸è½½æ—¶ä¸€å®šè¦æ¸…ç†èµ„æºã€‚</li>
<li>âŒ å¤§æ–‡ä»¶ç›´æ¥ä¸Šä¼ ï¼šå¯¼è‡´è¶…æ—¶ / å†…å­˜æº¢å‡º â€”â€” å¯¹åº” OS â€œä¸€æ¬¡æ€§åŠ è½½å¤§æ–‡ä»¶åˆ°å†…å­˜â€ï¼Œåº”è¯¥ç”¨åˆ†ç‰‡ä¸Šä¼ ã€‚</li>
</ul>
<h4 data-id="heading-22">2. åç«¯è¸©å‘ï¼š</h4>
<ul>
<li>âŒ æ•°æ®åº“ç´¢å¼•è¶Šå¤šè¶Šå¥½ï¼šå¯¼è‡´å†™æ“ä½œå˜æ…¢ã€ç´¢å¼•ç¢ç‰‡ â€”â€” å¯¹åº” OS â€œç¼“å­˜å¤ªå¤šå¯¼è‡´å‘½ä¸­ç‡ä¸‹é™â€ï¼Œåªç»™æŸ¥è¯¢é¢‘ç¹çš„å­—æ®µå»ºç´¢å¼•ã€‚</li>
<li>âŒ ç¼“å­˜ key ä¸è®¾ç½®è¿‡æœŸæ—¶é—´ï¼šå¯¼è‡´ç¼“å­˜æ•°æ®è¿‡æœŸï¼Œä¸æ•°æ®åº“ä¸ä¸€è‡´ â€”â€” å¯¹åº” OSâ€œç¼“å­˜æ•°æ®ä¸æ›´æ–°ï¼Œå¯¼è‡´æ•°æ®ä¸ä¸€è‡´â€ï¼Œä¸€å®šè¦è®¾ç½®åˆç†çš„è¿‡æœŸæ—¶é—´ã€‚</li>
<li>âŒ JVM å †å†…å­˜è®¾ç½®è¿‡å¤§ï¼šå¯¼è‡´ GC æ—¶é—´è¿‡é•¿ï¼ˆSTWï¼‰â€”â€” å¯¹åº” OSâ€œå†…å­˜åˆ†é…è¿‡å¤§ï¼Œå›æ”¶æ•ˆç‡ä½â€ï¼Œæ ¹æ®æœåŠ¡å™¨å†…å­˜åˆç†è®¾ç½®ï¼ˆæ¯”å¦‚ 8GB æœåŠ¡å™¨ï¼ŒJVM æœ€å¤§å †å†…å­˜è®¾ä¸º 4-6GBï¼‰ã€‚</li>
<li>âŒ ä¸å…³é—­æ•°æ®åº“è¿æ¥ / æ–‡ä»¶æµï¼šå¯¼è‡´èµ„æºæ³„æ¼ â€”â€” å¯¹åº” OS â€œæ–‡ä»¶å¥æŸ„ä¸é‡Šæ”¾â€ï¼Œä¸€å®šè¦ç”¨ try-with-resources æˆ– finally å…³é—­èµ„æºã€‚</li>
</ul>
<h3 data-id="heading-23">æ€»ç»“ï¼šå­˜å‚¨ç®¡ç†çš„ â€œæ ¸å¿ƒæ€ç»´â€ æ¯” â€œå…·ä½“å®ç°â€ æ›´é‡è¦</h3>
<ul>
<li>é‡åˆ° â€œå¤§èµ„æºâ€ï¼ˆå¤§æ–‡ä»¶ã€å¤§è¡¨ã€å¤§æ•°æ®ï¼‰ï¼šå°±ç”¨ â€œæ‹†åˆ†â€ æ€è·¯ï¼ˆåˆ†ç‰‡ã€åˆ†è¡¨ã€åˆ†é¡µï¼‰ï¼Œå¯¹åº” OS çš„ â€œåˆ†é¡µ / åˆ†æ®µå­˜å‚¨â€ï¼›</li>
<li>é‡åˆ° â€œæ…¢è®¿é—®â€ï¼ˆæ•°æ®åº“æŸ¥è¯¢æ…¢ã€DOM æ“ä½œæ…¢ï¼‰ï¼šå°±ç”¨ â€œç¼“å­˜â€ æ€è·¯ï¼ˆRedisã€localStorageã€è™šæ‹Ÿ DOMï¼‰ï¼Œå¯¹åº” OS çš„ â€œé«˜é€Ÿç¼“å­˜â€ï¼›</li>
<li>é‡åˆ° â€œèµ„æºä¸å¤Ÿç”¨â€ï¼ˆå†…å­˜ä¸è¶³ã€ç£ç›˜æ»¡ï¼‰ï¼šå°±ç”¨ â€œä¼˜åŒ–åˆ†é…â€ æ€è·¯ï¼ˆJVM é…ç½®ã€è¿‡æœŸæ¸…ç†ã€ç¢ç‰‡æ•´ç†ï¼‰ï¼Œå¯¹åº” OS çš„ â€œå†…å­˜åˆ†é… / å›æ”¶â€ï¼›</li>
<li>é‡åˆ° â€œæ•°æ®ä¸ä¸€è‡´â€ï¼ˆç¼“å­˜ä¸æ•°æ®åº“ã€æœ¬åœ°ä¸åç«¯ï¼‰ï¼šå°±ç”¨ â€œåŒæ­¥â€ æ€è·¯ï¼ˆåŒè¯»åŒå†™ã€è‡ªåŠ¨åŒæ­¥ï¼‰ï¼Œå¯¹åº” OS çš„ â€œç¼“å­˜ä¸€è‡´æ€§â€ã€‚</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[è¿½æœ¬æº¯æº â€”â€” SetState åˆ·æ–°åšäº†ä»€ä¹ˆ]]></title>    <link>https://juejin.cn/post/7579179741824466970</link>    <guid>https://juejin.cn/post/7579179741824466970</guid>    <pubDate>2025-12-03T04:21:30.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7579179741824466970" data-draft-id="7577970969395757097" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="è¿½æœ¬æº¯æº â€”â€” SetState åˆ·æ–°åšäº†ä»€ä¹ˆ"/> <meta itemprop="keywords" content="Flutter,é¢è¯•,æ€§èƒ½ä¼˜åŒ–"/> <meta itemprop="datePublished" content="2025-12-03T04:21:30.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="äººå½¢æ‰“ç æœº"/> <meta itemprop="url" content="https://juejin.cn/user/2085122730895063"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            è¿½æœ¬æº¯æº â€”â€” SetState åˆ·æ–°åšäº†ä»€ä¹ˆ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2085122730895063/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    äººå½¢æ‰“ç æœº
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-03T04:21:30.000Z" title="Wed Dec 03 2025 04:21:30 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-03
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    2
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»7åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#595959;font-size:15px;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(60,10,30,.04) 3%,transparent 0),linear-gradient(1turn,rgba(60,10,30,.04) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body p{color:#595959;font-size:15px;line-height:2;font-weight:400}.markdown-body p+p{margin-top:16px}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin:0;color:#135ce0}.markdown-body h1{position:relative;text-align:center;font-size:22px;margin:50px 0}.markdown-body h1:before{position:absolute;content:"";top:-10px;left:50%;width:32px;height:32px;transform:translateX(-50%);background-size:100% 100%;opacity:.36;background-repeat:no-repeat;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAABfVBMVEX///8Ad/8AgP8AgP8AgP8Aff8AgP8Af/8AgP8AVf8Af/8Af/8AgP8AgP8Af/8Afv8AAP8Afv8Afv8Aef8AgP8AdP8Afv8AgP8AgP8Acf8Ae/8AgP8Af/8AgP8Af/8Af/8AfP8Afv8AgP8Af/8Af/8Afv8Afv8AgP8Afv8AgP8Af/8Af/8AgP8AgP8Afv8AgP8Af/8AgP8AgP8AgP8Ae/8Afv8Af/8AgP8Af/8AgP8Af/8Af/8Aff8Af/8Abf8AgP8Af/8AgP8Af/8Af/8Afv8AgP8AgP8Afv8Afv8AgP8Af/8Aff8AgP8Afv8AgP8Aff8AgP8AfP8AgP8Ae/8AgP8Af/8AgP8AgP8AgP8Afv8AgP8AgP8AgP8Afv8AgP8AgP8AgP8AgP8AgP8Af/8AgP8Af/8Af/8Aev8Af/8AgP8Aff8Afv8AgP8AgP8AgP8Af/8AgP8Af/8Af/8AgP8Afv8AgP8AgP8AgP8AgP8Af/8AeP8Af/8Af/8Af//////rzEHnAAAAfXRSTlMAD7CCAivatxIDx5EMrP19AXdLEwgLR+6iCR/M0yLRzyFF7JupSXn8cw6v60Q0QeqzKtgeG237HMne850/6Qeq7QaZ+WdydHtj+OM3qENCMRYl1B3K2U7wnlWE/mhlirjkODa9FN/BF7/iNV/2kASNZpX1Wlf03C4stRGxgUPclqoAAAABYktHRACIBR1IAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH4gEaBzgZ4yeM3AAAAT9JREFUOMvNUldbwkAQvCAqsSBoABE7asSOBRUVVBQNNuy9996789+9cMFAMHnVebmdm+/bmdtbQv4dOFOW2UjPzgFyLfo6nweKfIMOBYWwFtmMPGz2Yj2pJI0JDq3udJW6VVbmKa9I192VQFV1ktXUAl5NB0cd4KpnORqsEO2ZIRpF9gJfE9Dckqq0KuZt7UAH5+8EPF3spjsRpCeQNO/tA/qDwIDA+OCQbBoKA8NOdjMySgcZGVM6jwcgRuUiSs0nlPFNSrEpJfU0jTLD6llqbvKxei7OzvkFNQohi0vAsj81+MoqsCaoPOQFgus/1LyxichW+hS2JWCHZ7VlF9jb187pIAYcHiViHAMnp5mTjJ8B5xeEXF4B1ze/fTh/C0h398DDI9HB07O8ci+vRBdvdGnfP4gBuM8vw7X/G3wDmFhFZEdxzjMAAAAldEVYdGRhdGU6Y3JlYXRlADIwMTgtMDEtMjZUMDc6NTY6MjUrMDE6MDA67pVWAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDE4LTAxLTI2VDA3OjU2OjI1KzAxOjAwS7Mt6gAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAAWdEVYdFRpdGxlAGp1ZWppbl9sb2dvIGNvcHlxapmKAAAAV3pUWHRSYXcgcHJvZmlsZSB0eXBlIGlwdGMAAHic4/IMCHFWKCjKT8vMSeVSAAMjCy5jCxMjE0uTFAMTIESANMNkAyOzVCDL2NTIxMzEHMQHy4BIoEouAOoXEXTyQjWVAAAAAElFTkSuQmCC)}.markdown-body h2{position:relative;font-size:20px;border-left:4px solid;padding:0 0 0 10px;margin:30px 0}.markdown-body h3{font-size:16px}.markdown-body ul{list-style:disc outside;margin-left:2em;margin-top:1em}.markdown-body li{line-height:2;color:#595959}.markdown-body img.loaded{margin:0 auto;display:block}.markdown-body blockquote{background:#fff9f9;margin:2em 0;padding:2px 20px;border-left:4px solid #b2aec5}.markdown-body blockquote p{color:#666;line-height:2}.markdown-body a{color:#036aca;border-bottom:1px solid rgba(3,106,202,.8);font-weight:400;text-decoration:none}.markdown-body em strong,.markdown-body strong{color:#036aca}.markdown-body hr{border-top:1px solid #135ce0}.markdown-body pre{overflow:auto}.markdown-body code,.markdown-body pre{overflow:auto;position:relative;line-height:1.75;font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body table{border-collapse:collapse;margin:1rem 0;overflow-x:auto}.markdown-body table td,.markdown-body table th{border:1px solid #dfe2e5;padding:.6em 1em}.markdown-body table tr{border-top:1px solid #dfe2e5}.markdown-body table tr:nth-child(2n){background-color:#f6f8fa}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>åœ¨ Flutter ä¸­è°ƒç”¨ setState æ˜¯ä¸€ä¸ªå¸¸ç”¨æ–¹æ³•ï¼Œ
ä½†å½“ UI æ²¡æœ‰ç«‹å³åˆ·æ–°ã€åŠ¨ç”»æ‰å¸§ã€å¤æ‚å¸ƒå±€å¡é¡¿æ—¶ï¼Œä½ ä¼šå‘ç°ï¼š</p>
<p><strong>åªæ˜¯çŸ¥é“ setState æ ¹æœ¬æ— æ³•è§£é‡Š Flutter ä¸ºä»€ä¹ˆä¼šæ…¢ã€å¡é¡¿</strong></p>
<p>è¦çœŸæ­£ç†è§£ Flutter çš„ UI åˆ·æ–°æœºåˆ¶ï¼Œå°±å¿…é¡»ç†è§£ Frame Pipelineã€‚</p>
<h2 data-id="heading-0">è°ƒç”¨ setState åå‘ç”Ÿäº†ä»€ä¹ˆ</h2>
<pre><code class="hljs language-dart" lang="dart">setState(() {
  _counter++;
});
</code></pre>
<p>æœ€å¼€å§‹æ¥è§¦ Flutter æ—¶å€™å¯¹è¿™æ®µä»£ç çš„ç†è§£å°±æ˜¯ï¼š
æ”¹äº† <code>_counter</code>ï¼Œç„¶å Flutter ç«‹åˆ»é‡æ–°æ¸²æŸ“ï¼ŒæŠŠæ–°å€¼ç”»åˆ°å±å¹•ä¸Š</p>
<p><strong>æ˜¯è¿™æ ·ä¹ˆï¼Ÿ</strong></p>
<p><strong>å®é™…ä¸Šå®Œå…¨ä¸æ˜¯</strong><br/>
è°ƒç”¨ <code>setState()</code> çš„é‚£ä¸€åˆ»ï¼Œå±å¹•å¹¶ä¸ä¼šç«‹åˆ»åˆ·æ–°ï¼Œç”šè‡³è¿ã€Œé‡æ–° buildã€ä¹Ÿè¿˜æ²¡å¼€å§‹ã€‚</p>
<h3 data-id="heading-1">Element æ ‡è®°</h3>
<p>é¦–å…ˆè¦è®°ä½ä¸€ä¸ªéå¸¸é‡è¦çš„äº‹å®ï¼š</p>
<ul>
<li><strong>Widget æ˜¯é…ç½®</strong></li>
<li><strong>Element æ‰æ˜¯â€œæ´»ç€çš„å®ä¾‹â€</strong></li>
</ul>
<p>å½“ä½ åœ¨ State é‡Œè°ƒç”¨ <code>setState()</code> æ—¶ï¼ŒFlutter åšçš„ç¬¬ä¸€ä»¶äº‹æ˜¯ï¼š</p>
<blockquote>
<p>æŠŠå½“å‰å…³è”çš„ <strong>Element æ ‡è®°ä¸º dirtyï¼ˆè„ï¼‰ï¼Œä¸‹æ¬¡åˆ·æ–°éœ€è¦é‡å»º</strong> ã€‚</p>
</blockquote>
<h3 data-id="heading-2">æ·»åŠ å¤„ç†é˜Ÿåˆ—</h3>
<p>æ ‡è®°å®Œ dirty ä¹‹åï¼ŒFlutter å¹¶ä¸ä¼šå½“åœºå°±å¤„ç†ï¼Œè€Œæ˜¯æŠŠå®ƒäº¤ç»™ä¸€ä¸ªç®¡ç†è€…ï¼š<strong>BuildOwner</strong>ã€‚</p>
<p>ç®€å•ç†è§£ï¼š</p>
<ul>
<li><code>BuildOwner</code> ç»´æŠ¤ç€ä¸€ä¸ª <strong>å¾…é‡å»ºçš„ Element åˆ—è¡¨</strong>ï¼ˆdirty åˆ—è¡¨ï¼‰</li>
<li>æ¯æ¬¡æœ‰åœ°æ–¹ <code>setState()</code>ï¼Œå¯¹åº”çš„ Element å°±ä¼šè¢«åŠ åˆ°è¿™ä¸ªåˆ—è¡¨é‡Œ</li>
</ul>
<p><strong>ç›®çš„ï¼š</strong></p>
<ul>
<li>
<p><strong>åˆå¹¶å¤šä¸ª setState</strong><br/>
ä¸€å¸§é‡Œä½ å¯èƒ½è¿ç»­å¤šæ¬¡ <code>setState()</code>ï¼ŒFlutter ä¸ä¼šæ¯æ¬¡éƒ½é‡æ–°è·‘ä¸€å¥—æµç¨‹ï¼Œè€Œæ˜¯æŠŠæ‰€æœ‰è¦æ›´æ–°çš„ Element <strong>é›†ä¸­æ”¾åœ¨ dirty åˆ—è¡¨é‡Œï¼Œä¸€æ¬¡æ€§ç»Ÿä¸€å¤„ç†</strong>ã€‚</p>
</li>
<li>
<p><strong>é¿å…åœ¨å½“å‰è°ƒç”¨æ ˆé‡Œé¢‘ç¹é‡å»º</strong><br/>
å¦‚æœ setState ç›´æ¥è§¦å‘é‡å»ºï¼Œæˆ‘ä»¬åœ¨äº‹ä»¶å›è°ƒé‡Œã€å¼‚æ­¥å›è°ƒé‡Œé¢‘ç¹ <code>setState()</code>ï¼ŒUI å°±å¯èƒ½åœ¨ä¸€ä¸ªè°ƒç”¨æ ˆé‡Œåå¤ buildï¼Œå¼€é”€éå¸¸å¤§ï¼Œä¹Ÿéš¾ä»¥ç»´æŠ¤ã€‚</p>
</li>
</ul>
<blockquote>
<p>è¿„ä»Šä¸ºæ­¢ï¼Œåšäº†è¿™äº›åŠ¨ä½œï¼š
çŠ¶æ€æ›´æ”¹ â€”â€”&gt; æ ‡è®° Element â€”â€”&gt; æ”¾ç½®é‡å»ºé˜Ÿåˆ—</p>
</blockquote>
<h3 data-id="heading-3">markNeedsBuild</h3>
<p>åœ¨å®Œæˆé˜Ÿåˆ—æ·»åŠ åï¼Œå¹¶ä¸ä¼šç«‹å³é‡å»ºï¼Œå°†ç”³è¯·ä¸‹ä¸€å¸§é‡å»º</p>
<ul>
<li>
<p>setState â†’ <code>markNeedsBuild()</code></p>
</li>
<li>
<p><code>markNeedsBuild()</code> â†’ é€šçŸ¥ Schedulerï¼šâ€œæœ‰äº‹æƒ…è¦ç”»ï¼Œè®°å¾—å®‰æ’ä¸€å¸§ã€‚â€</p>
</li>
<li>
<p>Scheduler â†’ è°ƒç”¨ <code>scheduleFrame()</code></p>
</li>
<li>
<p><code>scheduleFrame()</code> â†’ ç­‰å¾…<strong>ä¸‹ä¸€æ¬¡å±å¹• Vsync ä¿¡å·</strong>ï¼Œå†æ­£å¼å¼€å§‹ä¸€å¸§</p>
</li>
</ul>
<blockquote>
<p><strong>æ€»ç»“</strong> setState ä¸æ˜¯ä¸€ä¸ªâ€œç«‹åˆ»é‡ç»˜â€çš„æŒ‰é’®ï¼Œè€Œæ˜¯ä¸€ä¸ªâ€œé¢„çº¦ä¸‹ä¸€å¸§é‡å»ºâ€çš„å¼€å…³</p>
</blockquote>
<hr/>
<h2 data-id="heading-4">Flutter çš„ä¸€å¸§å¦‚ä½•å¼€å§‹ï¼Ÿâ€”â€” Frame Scheduling</h2>
<p>Flutter ä¸æ˜¯ä¸€ç›´åœ¨æ­»å¾ªç¯åˆ·æ–°å±å¹•ï¼Œå®ƒæ˜¯ <strong>è¢«åŠ¨æ¸²æŸ“</strong> çš„æ¡†æ¶ï¼Œåªæœ‰åœ¨å¿…è¦æ—¶æ‰ä¼šäº§ç”Ÿä¸€å¸§ï¼›åœ¨ setSate å®Œæˆ<code>ç”³è¯·ä¸€å¸§</code> åå°†è¿›å…¥ <code>Frame Schedulingï¼ˆå¸§è°ƒåº¦æœºåˆ¶ï¼‰</code></p>
<p>Flutter ä¸€å¸§çš„äº§ç”Ÿä¾èµ– 3 ä¸ªå…³é”®è§’è‰²ï¼š</p>
<ul>
<li><strong>ç³»ç»Ÿï¼ˆVsyncï¼‰ï¼šå‘Šè¯‰ Flutter ä»€ä¹ˆæ—¶å€™å¯ä»¥åˆ·æ–°</strong></li>
<li><strong>å¼•æ“ï¼ˆonBeginFrameï¼‰ï¼šæ¥æ”¶ Vsyncã€å¼€å§‹ä¸€å¸§</strong></li>
<li><strong>Frameworkï¼ˆSchedulerBindingï¼‰ï¼šå®‰æ’ Frameã€æ‰§è¡Œ Pipeline</strong></li>
</ul>
<h3 data-id="heading-5">Vsync ä¿¡å·</h3>
<p>é¦–å…ˆè¦æ¸…æ¥š<code>å¸§ç‡</code>è¿™ä¸€æ¦‚å¿µï¼Œåœ¨ç»´åŸºç™¾ç§‘çš„è§£é‡Šæ˜¯</p>
<blockquote>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fzh.wikipedia.org%2Fwiki%2F%25E5%25B8%25A7%25E7%258E%2587" target="_blank" title="https://zh.wikipedia.org/wiki/%E5%B8%A7%E7%8E%87" ref="nofollow noopener noreferrer">å¸§ç‡</a>ï¼šç”¨äºæµ‹é‡æ˜¾ç¤ºå¸§æ•°çš„åº¦é‡ã€‚æµ‹é‡å•ä½ä¸ºâ€œæ¯ç§’æ˜¾ç¤ºå¸§æ•°â€ï¼ˆ<strong>f</strong>rameÂ <strong>p</strong>erÂ <strong>s</strong>econdï¼Œ<strong>FPS</strong>ï¼‰æˆ–â€œèµ«å…¹â€ï¼Œä¸€èˆ¬æ¥è¯´FPSç”¨äºæè¿°å½±ç‰‡ã€ç”µå­ç»˜å›¾æˆ–æ¸¸æˆæ¯ç§’æ’­æ”¾å¤šå°‘å¸§ã€‚</p>
</blockquote>
<p><strong>æ‰€æœ‰ç”µå­æ˜¾ç¤ºå±éƒ½æ˜¯æŒ‰å›ºå®šé¢‘ç‡åˆ·æ–°çš„ã€‚</strong></p>
<ul>
<li>æ™®é€šæ‰‹æœºæ˜¯ <strong>60Hz</strong> â†’ æ¯ç§’ 60 æ¬¡åˆ·æ–°</li>
<li>é«˜åˆ·æ‰‹æœºå¯èƒ½æ˜¯ <strong>90Hz / 120Hz / 144Hz</strong></li>
</ul>
<p>ç³»ç»Ÿä¼šåœ¨æ¯æ¬¡å±å¹•å‡†å¤‡åˆ·æ–°å‰ï¼Œå‘å‡ºä¸€ä¸ªåŒæ­¥ä¿¡å·ï¼š<strong>Vsyncï¼ˆVertical Synchronizationï¼‰</strong> ã€‚<br/>
Flutter å¼•æ“å°±æ˜¯æ ¹æ®è¿™ä¸ªä¿¡å·æ¥å†³å®šï¼š</p>
<blockquote>
<p>â€œç°åœ¨æ˜¯æ—¶å€™å¼€å§‹å‡†å¤‡ä¸‹ä¸€å¸§ç”»é¢äº†ã€‚â€</p>
</blockquote>
<p>ğŸ“Œ <strong>Flutter çš„æ¯ä¸€å¸§ï¼Œéƒ½æ˜¯ç”±ç³»ç»Ÿçš„ Vsync é©±åŠ¨çš„ã€‚</strong></p>
<h3 data-id="heading-6">åˆ·æ–°è§¦å‘</h3>
<p>åˆ·æ–°çš„è§¦å‘ç‚¹æ˜¯å¼•æ“å±‚çš„ <code>onBeginFrame()</code> å›è°ƒ</p>
<p>Frame çš„å¼€å§‹ï¼Œæœ¬è´¨ä¸Šå°±æ˜¯ï¼š</p>
<pre><code class="hljs language-scss" lang="scss">Vsync åˆ°æ¥ â†’ Engine è°ƒç”¨ <span class="hljs-built_in">onBeginFrame</span>() â†’ Framework å¼€å§‹å¤„ç†æœ¬å¸§é€»è¾‘
</code></pre>
<p>è¿™ä¸€åˆ»ï¼ŒFramework æ‰æœ‰æœºä¼šè¿›å…¥ä¸‹ä¸€æ­¥ï¼š<br/>
<strong>Buildã€Layoutã€Paintâ€¦â€¦</strong> å…¨éƒ¨éƒ½åœ¨è¿™æ¡ Frame æµç¨‹ä¸­è¿›è¡Œã€‚</p>
<p><code>ç”³è¯·æœºåˆ¶</code>ä»å…¥å£ä¸Šå‡ ä¹éƒ½ç»•ä¸è¿‡æ ¸å¿ƒæ–¹æ³• <strong>SchedulerBinding.ensureVisualUpdate()</strong></p>
<p>å®ƒçš„é€»è¾‘éå¸¸ç®€å•ï¼š</p>
<ul>
<li>å¦‚æœå½“å‰æ²¡æœ‰æ­£åœ¨ç­‰å¾…çš„ Frame</li>
<li>å°±è¯·æ±‚ä¸‹ä¸€æ¬¡ Vsync</li>
<li>è®© Flutter æœ‰æœºä¼šå¼€å§‹ä¸€å¸§</li>
</ul>
<p>ä¹Ÿå°±æ˜¯è¯´ï¼š</p>
<blockquote>
<p><strong>setState çš„æœ€ç»ˆåŠ¨ä½œä¹‹ä¸€ï¼Œå°±æ˜¯è§¦å‘ ensureVisualUpdate å»â€œè¦ä¸€å¸§â€ã€‚</strong></p>
</blockquote>
<pre><code class="hljs language-mermaid" lang="mermaid">flowchart TD
    A["setState"] --&gt; B["markNeedsBuildï¼ˆæ ‡è®° dirtyï¼‰"]
    B --&gt; C["ensureVisualUpdateï¼ˆè¯·æ±‚ä¸‹ä¸€å¸§ï¼‰"]
    C --&gt; D["scheduleFrameï¼ˆç­‰å¾… Vsyncï¼‰"]
    D --&gt; E["ç­‰å¾…ç³»ç»Ÿå‘æ¥ä¸€ä¸ª Vsync ä¿¡å·"]
    E --&gt; F["onBeginFrameï¼ˆæœ¬å¸§å¼€å§‹ï¼‰"]
    F --&gt; G["è¿›å…¥ Frame Pipelineï¼šBuild â†’ Layout â†’ Paint â†’ Composite â†’ Raster"]
    G --&gt; H["å±å¹•æ˜¾ç¤ºæ›´æ–°"]


</code></pre>
<hr/>
<h2 data-id="heading-7">Frame Pipeline</h2>
<blockquote>
<p>Build â†’ Layout â†’ Paint â†’ Composite â†’ Raster</p>
</blockquote>
<p>Flutter å¦‚ä½•ä»ä¸€ä¸ªâ€œéœ€è¦æ›´æ–°çš„çŠ¶æ€â€ä¸€è·¯èµ°åˆ°â€œå±å¹•åƒç´ æ›´æ–°â€çš„ï¼Ÿ</p>
<p>è¿™å°±æ˜¯ <strong>Flutter Frame Pipelineï¼ˆæ¸²æŸ“æµæ°´çº¿ï¼‰</strong> çš„å·¥ä½œã€‚</p>
<p>å¯ä»¥æŠŠå®ƒæƒ³è±¡æˆä¸€æ¡å·¥å‚äº§çº¿ï¼Œæ¯ä¸€å¸§éƒ½æ˜¯ä¸€ä»¶äº§å“ï¼ˆç”»é¢ï¼‰ï¼Œè€Œ Flutter éœ€è¦åœ¨ 16.6ms å†…å®Œæˆæ•´ä¸ªç”Ÿäº§æµç¨‹ï¼š<br/>
<strong>Build â†’ Layout â†’ Paint â†’ Composite â†’ Raster</strong></p>
<h3 data-id="heading-8">Build æ„å»º UI ç»“æ„</h3>
<p>åœ¨ setState æ—¶ï¼ŒæŠŠ Element æ ‡è®°ä¸º dirtyã€‚ Build é˜¶æ®µä¼šéå†è¿™äº› dirty elementsï¼Œç„¶åè°ƒç”¨å®ƒä»¬çš„ build æ–¹æ³•ã€‚</p>
<p>Widget æ˜¯é…ç½®ï¼ˆimmutableï¼‰ï¼ŒElement æ‰æ˜¯â€œæ´»çš„å®ä¾‹â€</p>
<p>åœ¨ Build é˜¶æ®µï¼Œæ¯æ¬¡ build ä¼šåˆ›å»ºæ–°çš„ Widget å¯¹è±¡ï¼Œä½†ä¸ä¼šåˆ›å»ºæ–°çš„ Elementï¼š</p>
<ul>
<li>Widget æ˜¯è½»é‡çš„é…ç½®å¯¹è±¡</li>
<li>Element ä¿å­˜ç”Ÿå‘½å‘¨æœŸã€Stateã€ä»¥åŠå’Œ RenderObject çš„å…³è”</li>
<li>æ–° Widget ä¼šé€šè¿‡ Element ä¸ä¹‹å‰çš„æ ‘ç»“æ„åŒ¹é…ï¼ˆdiffï¼‰</li>
</ul>
<p>æ›´æ–° RenderObjectï¼ˆå¸ƒå±€ &amp; ç»˜åˆ¶å¯¹è±¡ï¼‰</p>
<p>å¦‚æœ Widget é…ç½®å˜åŒ–å¼•èµ·æ¸²æŸ“éœ€æ±‚å˜åŒ–ï¼ŒFlutter ä¼šï¼š</p>
<ul>
<li>æ›´æ–° RenderObject çš„å±æ€§</li>
<li>æˆ–åœ¨éœ€è¦æ—¶é‡å»º RenderObject</li>
</ul>
<p>RenderObject æ˜¯çœŸæ­£å‚ä¸ Layout å’Œ Paint çš„æ ¸å¿ƒå¯¹è±¡ã€‚</p>
<p>ğŸ“Œ <strong>Build çš„æœ€ç»ˆäº§ç‰©æ˜¯ä¸€ä¸ªå‡†å¤‡å¥½å¸ƒå±€çš„ RenderObject æ ‘ã€‚</strong></p>
<h3 data-id="heading-9">Layout æµ‹é‡å’Œå®šä½</h3>
<p>çˆ¶ç»™å­ constraintsï¼Œå­è¿”å›å°ºå¯¸</p>
<p>Flutter çš„å¸ƒå±€æ˜¯ä»çˆ¶åˆ°å­é€’å½’ä¼ é€’çš„ï¼š</p>
<ul>
<li>çˆ¶ RenderObject ç»™å­èŠ‚ç‚¹ä¸€ä¸ª constraintsï¼ˆæœ€å¤§/æœ€å°å®½é«˜ç­‰ï¼‰</li>
<li>å­èŠ‚ç‚¹å¿…é¡»åœ¨è¿™ä¸ª constraints å†…å†³å®šè‡ªå·±çš„å°ºå¯¸</li>
</ul>
<p>ä¾‹å¦‚ï¼š</p>
<ul>
<li>Column ä¼šå‘Šè¯‰å­ç»„ä»¶ â€œä½ å®½åº¦å¿…é¡»ç­‰äº Column çš„å®½åº¦ï¼Œè‡³äºé«˜åº¦ä½ è‡ªå·±çœ‹ç€åŠâ€</li>
<li>Text ä¼šæ ¹æ®æ–‡æœ¬å†…å®¹å’Œ constraints å†³å®šæœ€ç»ˆå°ºå¯¸</li>
<li>Container æ ¹æ®å¤–éƒ¨ constraints å’Œå†…éƒ¨ child çš„å°ºå¯¸å†³å®šè‡ªèº«å¤§å°</li>
</ul>
<p>è¿™ä¸€æœºåˆ¶ä¿è¯äº†ï¼š</p>
<ul>
<li>å¸ƒå±€è¡Œä¸ºå®Œå…¨å¯é¢„æµ‹</li>
<li>å¸ƒå±€æ˜¯è‡ªä¸Šè€Œä¸‹çš„æ•°æ®æµè€Œéæ··ä¹±çš„äºŒç»´å¸ƒå±€</li>
</ul>
<p>ğŸ“Œ ç»è¿‡ Layoutï¼Œæ•´ä¸ª RenderObject æ ‘å·²ç»â€œæµ‹é‡å®Œæˆâ€ï¼ŒçŸ¥é“æ¯ä¸ªå¯¹è±¡è¯¥ç”»åœ¨å±å¹•å“ªé‡Œã€‚</p>
<h3 data-id="heading-10">Paint ç»˜åˆ¶æŒ‡ä»¤</h3>
<p>Paint é˜¶æ®µä¸æ˜¯ç«‹å³æŠŠåƒç´ ç”»ä¸Šå±å¹•ï¼Œè€Œæ˜¯ï¼š</p>
<blockquote>
<p><strong>æŠŠæ‰€æœ‰ç»˜åˆ¶æ“ä½œè®°å½•æˆä¸€æ¡æ¡ç»˜åˆ¶æŒ‡ä»¤ï¼Œå†™å…¥ Picture æˆ– Layerã€‚</strong></p>
</blockquote>
<p>Flutter ä¼šåœ¨æ¯ä¸ª RenderObject çš„ paint æ–¹æ³•ä¸­ï¼š</p>
<ul>
<li>ç»˜åˆ¶èƒŒæ™¯ã€æ–‡å­—ã€è¾¹æ¡†ã€é˜´å½±ç­‰</li>
<li>è°ƒç”¨ child çš„ painting æ–¹æ³•é€’å½’ç»˜åˆ¶</li>
<li>è®°å½•æ‰€æœ‰ç»˜åˆ¶å‘½ä»¤åˆ° <code>PaintingContext</code></li>
</ul>
<p>ğŸ“Œ <strong>Paint é˜¶æ®µçš„æ ¸å¿ƒäº§ç‰©æ˜¯ Layer Tree çš„â€œç»˜åˆ¶è„šæœ¬â€ã€‚</strong></p>
<h3 data-id="heading-11">Composite ç”Ÿæˆ Layer Tree</h3>
<p><strong>å°†ç»˜åˆ¶æŒ‡ä»¤ç»„åˆæˆå¯ä¼˜åŒ–çš„å›¾å±‚æ ‘</strong></p>
<p>Paint é˜¶æ®µè®°å½•çš„æ˜¯ç»˜åˆ¶æŒ‡ä»¤ï¼Œä½† Flutter è¿˜éœ€è¦æŠŠè¿™äº›æŒ‡ä»¤æ•´ç†æˆä¸€ä¸ªç»“æ„è‰¯å¥½çš„ <strong>Layer Tree</strong>ã€‚</p>
<p>Layer çš„ä½œç”¨åŒ…æ‹¬ï¼š</p>
<ul>
<li>è¡¨ç¤ºä¸€å—å¯ä»¥å•ç‹¬å¤„ç†çš„åŒºåŸŸï¼ˆå¦‚è£å‰ªã€é€æ˜åº¦ã€å˜æ¢ç­‰ï¼‰</li>
<li>å¸®åŠ© Flutter åšç¼“å­˜å’Œå±€éƒ¨é‡ç»˜ï¼ˆåªæ›´æ–°å˜åŒ–çš„éƒ¨åˆ†ï¼‰</li>
<li>ä¸ºæ»šåŠ¨ã€åŠ¨ç”»ç­‰æä¾›æ›´é«˜æ•ˆçš„æ¸²æŸ“åŸºç¡€</li>
</ul>
<p>å¸¸è§çš„ Layer åŒ…æ‹¬ï¼š</p>
<ul>
<li><code>TransformLayer</code></li>
<li><code>ClipRectLayer</code></li>
<li><code>OpacityLayer</code></li>
<li><code>PictureLayer</code> ç­‰</li>
</ul>
<p>Layer Tree ä¼šè¢«å‘é€ç»™å¼•æ“ï¼Œä½œä¸ºåç»­ Raster çš„è¾“å…¥ã€‚</p>
<p>ğŸ“Œ <strong>Composite çš„äº§ç‰©æ˜¯ï¼šä¸€æ£µæè¿°æ•´å±å†…å®¹çš„ Layer Treeã€‚</strong></p>
<h3 data-id="heading-12">Raster æœ€ç»ˆç»˜åˆ¶</h3>
<p><strong>Skia + GPU â†’ å±å¹•åƒç´ ; å”¯ä¸€çœŸæ­£â€œç”»å›¾â€çš„é˜¶æ®µ</strong></p>
<p>Pipeline çš„æœ€åä¸€ä¸ªé˜¶æ®µï¼Œä½†å®ƒå·²ç»è„±ç¦» Dart å±‚ï¼Œå®Œå…¨äº¤ç”±å¼•æ“å’Œ GPU æ¥æ‰§è¡Œã€‚</p>
<p>Rasterizer çš„ä¸»è¦æµç¨‹æ˜¯ï¼š</p>
<ul>
<li>æ¥æ”¶ Layer Tree</li>
<li>ä½¿ç”¨ Skia æŠŠæ¯ä¸ª Layer è½¬æˆ GPU å¯ä»¥ç†è§£çš„å›¾å…ƒ</li>
<li>ä¸Šä¼ çº¹ç†ã€ç¼–è¯‘æˆ–å¤ç”¨ Shader</li>
<li>æœ€ç»ˆå†™å…¥ Framebuffer</li>
<li>äº¤ç»™ç³»ç»Ÿåˆæˆï¼Œæ˜¾ç¤ºåˆ°å±å¹•ä¸Š</li>
</ul>
<pre><code class="hljs language-mermaid" lang="mermaid">flowchart TD
    D3["Layer Tree"] --&gt; E2["Engine Shell æ¥æ”¶ LayerTree"]
    E2 --&gt; R1["éå† LayerTreeï¼Œå‡†å¤‡ç»˜åˆ¶åˆ—è¡¨"]
    R1 --&gt; R2["å›¾ç‰‡è§£ç ä¸çº¹ç†ä¸Šä¼ "]
    R2 --&gt; R3["Shader ç¼–è¯‘æˆ–å¤ç”¨"]
    R3 --&gt; R4["Skia å…‰æ …åŒ–å†™å…¥ Framebuffer"]
    R4 --&gt; G1["ç³»ç»Ÿåˆæˆï¼šSurface / CoreAnimation / SurfaceFlinger"]
    G1 --&gt; G2["æœ€ç»ˆæ˜¾ç¤ºåˆ°å±å¹•"]

    %% COLORS
    style D3 fill:#e1bee7,stroke:#6a1b9a
    style E2 fill:#e1bee7,stroke:#6a1b9a
    style R1 fill:#f8bbd0,stroke:#ad1457
    style R2 fill:#f8bbd0,stroke:#ad1457
    style R3 fill:#f8bbd0,stroke:#ad1457
    style R4 fill:#f48fb1,stroke:#ad1457
    style G1 fill:#c8e6c9,stroke:#2e7d32
    style G2 fill:#81c784,stroke:#2e7d32


</code></pre>
<ul>
<li>Raster é˜¶æ®µæ˜¯ GPU çœŸæ­£è€—æ—¶çš„åœ°æ–¹</li>
<li>Shader ç¼–è¯‘ä¹Ÿæ˜¯åœ¨ Raster é˜¶æ®µå‘ç”Ÿï¼ˆä¼šå¯¼è‡´æ‰å¸§ï¼‰</li>
<li>Flutter æä¾› Shader warm-up ï¼ˆä½†è¿™æ˜¯ä¸‹ä¸€ç¯‡çš„å†…å®¹ï¼‰</li>
</ul>
<p>ğŸ“Œ åˆ°è¿™é‡Œï¼Œä¸€å¸§ä» setState â†’ Pipeline â†’ åƒç´ æ›´æ–°å…¨éƒ¨å®Œæˆã€‚</p>
<h2 data-id="heading-13">setState åˆ°å±å¹•åˆ·æ–°</h2>
<p>ğŸ“Œ <strong>setState çš„æœ¬è´¨ä¸æ˜¯æ›´æ–° UIï¼Œè€Œæ˜¯è§¦å‘ä¸‹ä¸€å¸§çš„ Buildã€‚</strong></p>
<p>å®ƒåªæ˜¯ï¼š</p>
<ul>
<li>æ”¹çŠ¶æ€</li>
<li>æ ‡è®° dirty</li>
<li>ç”³è¯·ä¸€å¸§</li>
</ul>
<p>çœŸæ­£çš„ UI æ›´æ–°å‘ç”Ÿåœ¨ä¸‹ä¸€å¸§çš„ Frame Pipeline ä¸­ã€‚</p>
<pre><code class="hljs language-mermaid" lang="mermaid">flowchart TD
    U["ç”¨æˆ·è¾“å…¥ï¼šç‚¹å‡» / æ»šåŠ¨ / æ‰‹åŠ¿"] --&gt; E1["PointerEvent åˆ†å‘ï¼ŒGestureArena è§£æ"]
    VSYNC["Vsync ä¿¡å· (å±å¹•åˆ·æ–°èŠ‚å¥)"] --&gt; F0["SchedulerBinding.beginFrame"]

    E1 --&gt; F1["äº‹ä»¶å›è°ƒï¼šonTap / onScroll / onChangedï¼Œè§¦å‘çŠ¶æ€æ›´æ–°"]
    F0 --&gt; A1["Animation / Ticker æ›´æ–°ï¼Œæ»šåŠ¨æƒ¯æ€§è®¡ç®—"]

    A1 --&gt; A2["æ ‡è®°è„ï¼šmarkNeedsBuild / markNeedsLayout / markNeedsPaint"]
    F1 --&gt; A2

    A2 --&gt; B1["build é˜¶æ®µï¼šéå† dirty Elements"]
    B1 --&gt; B2["æ‰§è¡Œ Widget.buildï¼Œæ›´æ–° Widget / Element æ ‘"]
    B2 --&gt; B3["æ›´æ–° RenderObject å±æ€§"]

    B3 --&gt; C1["layout é˜¶æ®µï¼šflushLayout"]
    C1 --&gt; C2["performLayout è®¡ç®—å¤§å°ä½ç½®"]

    C2 --&gt; D1["paint é˜¶æ®µï¼šflushPaint"]
    D1 --&gt; D2["RenderObject.paint å½•åˆ¶ Canvas æŒ‡ä»¤"]
    D2 --&gt; D3["ç»„è£… Layer Tree"]

    %% COLORS
    style U fill:#fff7cc,stroke:#bfa600
    style E1 fill:#fff7cc,stroke:#bfa600
    style VSYNC fill:#fff7cc,stroke:#bfa600
    style F0 fill:#c8e1ff,stroke:#0366d6
    style F1 fill:#c8e1ff,stroke:#0366d6
    style A1 fill:#c8e1ff,stroke:#0366d6
    style A2 fill:#cdecef,stroke:#0b7a75
    style B1 fill:#cdecef,stroke:#0b7a75
    style B2 fill:#cdecef,stroke:#0b7a75
    style B3 fill:#cdecef,stroke:#0b7a75
    style C1 fill:#cdecef,stroke:#0b7a75
    style C2 fill:#cdecef,stroke:#0b7a75
    style D1 fill:#cdecef,stroke:#0b7a75
    style D2 fill:#cdecef,stroke:#0b7a75
    style D3 fill:#88d8c0,stroke:#0b7a75

</code></pre>
<h2 data-id="heading-14">å°ç»“</h2>
<ul>
<li>
<p>ä¸€æ¬¡ <code>setState</code>ï¼Œä¸ä¼šç«‹åˆ»æ›´æ–° UIï¼Œè€Œæ˜¯ï¼š</p>
<ul>
<li>æ ‡è®° dirty</li>
<li>ä¸¢è¿›é˜Ÿåˆ—</li>
<li>ç”³è¯·ä¸‹ä¸€å¸§</li>
</ul>
</li>
<li>
<p>ä¸‹ä¸€å¸§å¼€å§‹äºç³»ç»Ÿçš„ Vsyncï¼š</p>
<ul>
<li>å¼•æ“æ¥æ”¶ Vsyncï¼Œè°ƒç”¨ <code>onBeginFrame</code></li>
<li>Framework é€šè¿‡ SchedulerBinding æ‰§è¡Œ Frame Pipeline</li>
</ul>
</li>
<li>
<p>åœ¨è¿™ä¸€å¸§ä¸­ï¼ŒFlutter ä¾æ¬¡æ‰§è¡Œï¼š</p>
<ul>
<li><strong>Build â†’ Layout â†’ Paint â†’ Composite â†’ Raster</strong></li>
<li>æœ€ç»ˆæŠŠçŠ¶æ€å˜åŒ–å˜æˆå±å¹•ä¸Šçš„åƒç´ ã€‚</li>
</ul>
</li>
</ul>
<p>ç†è§£è¿™ä¸€æ¡é“¾è·¯ä¹‹åï¼Œå†çœ‹ï¼š</p>
<ul>
<li>DevTools é‡Œçš„ Timeline</li>
<li>â€œä¸ºä»€ä¹ˆæŸä¸ªé¡µé¢ Build å¾ˆé‡â€</li>
<li>â€œä¸ºä»€ä¹ˆç¬¬ä¸€æ¬¡åŠ¨ç”»ä¼šæ‰å¸§â€</li>
</ul>
<p>åŸºäºè¿™äº›å»åšå¡é¡¿ä¼˜åŒ–æ–¹æ¡ˆï¼Œå°†ä¼šæœ‰çš„æ”¾çŸ¢</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[App ä¸Šæ¶æœåŠ¡è¡Œä¸šçš„å®é™…å·¥ä½œæµç¨‹ä¸å·¥å…·é€‰æ‹© ä»äººå·¥ä»£åŠåˆ°è·¨å¹³å°è‡ªåŠ¨åŒ–çš„è½¬å˜]]></title>    <link>https://juejin.cn/post/7579179741824761882</link>    <guid>https://juejin.cn/post/7579179741824761882</guid>    <pubDate>2025-12-03T05:46:59.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7579179741824761882" data-draft-id="7579255046978666522" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="App ä¸Šæ¶æœåŠ¡è¡Œä¸šçš„å®é™…å·¥ä½œæµç¨‹ä¸å·¥å…·é€‰æ‹© ä»äººå·¥ä»£åŠåˆ°è·¨å¹³å°è‡ªåŠ¨åŒ–çš„è½¬å˜"/> <meta itemprop="keywords" content="åç«¯"/> <meta itemprop="datePublished" content="2025-12-03T05:46:59.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å¼€å¿ƒå°±å¥½2025"/> <meta itemprop="url" content="https://juejin.cn/user/3850962908492660"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            App ä¸Šæ¶æœåŠ¡è¡Œä¸šçš„å®é™…å·¥ä½œæµç¨‹ä¸å·¥å…·é€‰æ‹© ä»äººå·¥ä»£åŠåˆ°è·¨å¹³å°è‡ªåŠ¨åŒ–çš„è½¬å˜
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3850962908492660/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å¼€å¿ƒå°±å¥½2025
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-03T05:46:59.000Z" title="Wed Dec 03 2025 05:46:59 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-03
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»5åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>åœ¨ç§»åŠ¨äº’è”ç½‘è¡Œä¸šå¿«é€Ÿè¿­ä»£çš„èƒŒæ™¯ä¸‹ï¼Œâ€œApp ä¸Šæ¶æœåŠ¡â€é€æ¸æˆä¸ºä¸å°‘å°å›¢é˜Ÿã€åˆ›ä¸šè€…å’Œè·¨ç«¯å¼€å‘å›¢é˜Ÿçš„åˆšéœ€ã€‚å…¶èƒŒåçš„åŸå› å¹¶éæŠ€æœ¯é—¨æ§›é«˜ï¼Œè€Œæ˜¯ iOS ä¸Šæ¶æµç¨‹åœ¨ä½“éªŒã€æƒé™ã€è¯ä¹¦ä½“ç³»ã€å®¡æ ¸è§„åˆ™ç­‰æ–¹é¢éƒ½æœ‰ä¸¥æ ¼è¦æ±‚ï¼Œå¯¼è‡´è®¸å¤šå›¢é˜Ÿè™½ç„¶èƒ½å®Œæˆå¼€å‘ï¼Œå´åœ¨ä¸Šæ¶ç¯èŠ‚å—åˆ°é˜»æ»ã€‚</p>
<p>è¿‘å‡ å¹´ï¼Œè¡Œä¸šä»ä¼ ç»Ÿâ€œä»£åŠå¼ä¸Šæ¶â€é€æ¸å‘â€œæµç¨‹å·¥å…·åŒ–ã€è‡ªåŠ¨åŒ–åä½œã€è·¨å¹³å°å‘å¸ƒâ€è½¬å˜ã€‚æœ¬æ–‡åŸºäºä¸€æ¬¡å®é™…æœåŠ¡æ¡ˆä¾‹ï¼Œæ€»ç»“ç›®å‰ App ä¸Šæ¶æœåŠ¡çš„çœŸå®å·¥ä½œæ–¹å¼ï¼Œå¹¶ä»‹ç»åœ¨è¿™ç§ä½“ç³»ä¸‹å¸¸ç”¨çš„å·¥å…·ç»„åˆï¼ŒåŒ…æ‹¬å›¢é˜Ÿå¸¸ç”¨çš„æ„å»ºå·¥å…·ã€æˆªå›¾ç®¡ç†å·¥å…·ã€è¯ä¹¦ç®¡ç†æ–¹å¼ï¼Œä»¥åŠè·¨å¹³å°ä¸Šä¼ å·¥å…·å¦‚ å¼€å¿ƒä¸Šæ¶ï¼ˆAppuploaderï¼‰ åœ¨æ–°æµç¨‹ä¸­çš„å®šä½ã€‚</p>
<hr/>
<h2 data-id="heading-0"><strong>ä¸€ã€App ä¸Šæ¶æœåŠ¡ä¸ºä»€ä¹ˆå­˜åœ¨ï¼Ÿ</strong></h2>
<p>ä»è¡Œä¸šè§†è§’çœ‹ï¼Œä¸Šæ¶æœåŠ¡å­˜åœ¨çš„æ ¹æœ¬åŸå› æ˜¯ï¼š</p>
<ul>
<li>è®¾è®¡ã€å¼€å‘ã€æµ‹è¯•å„éƒ¨é—¨å¯¹ iOS è¯ä¹¦ä½“ç³»ç†è§£ä¸ä¸€è‡´</li>
<li>å¾ˆå¤šå›¢é˜Ÿæ²¡æœ‰ Mac æˆ– Mac ä¸è¶³ä»¥æ”¯æ’‘é¢‘ç¹æ„å»º</li>
<li>å®¡æ ¸è§„åˆ™ï¼ˆç‰¹åˆ«æ˜¯ 2.1ã€4.2ã€4.3ã€5.1.1ï¼‰ä¸æ–­æ›´æ–°</li>
<li>è‹¹æœåå°ä¿¡æ¯ç¹çï¼ˆæˆªå›¾ã€å…³é”®è¯ã€éšç§æ ‡ç­¾ï¼‰</li>
<li>ä¸Šä¼ å·¥å…·é™åˆ¶ macOSï¼Œæ— æ³•åœ¨ Windows/Linux ç›´æ¥ä½¿ç”¨</li>
</ul>
<p>å› æ­¤æ‰€è°“â€œä¸Šæ¶æœåŠ¡â€ï¼Œæœ¬è´¨ä¸Šä¸æ˜¯å¸®äººâ€œç‚¹å‡»ä¸Šä¼ â€ï¼Œè€Œæ˜¯ï¼š</p>
<blockquote>
<p><strong>è¡¥é½å›¢é˜Ÿåœ¨æµç¨‹ã€ç¯å¢ƒã€å®¡æ ¸ç†è§£ã€è·¨å¹³å°å·¥å…·é“¾ä¸Šçš„ç¼ºå£ã€‚</strong></p>
</blockquote>
<p>è¿™äº›ç¼ºå£ä¹Ÿæ˜¯å¼€å‘å›¢é˜Ÿè‡ªå·±æœ€ä¸æ„¿æ„åå¤è¸©çš„å‘ã€‚</p>
<hr/>
<h2 data-id="heading-1"><strong>äºŒã€è¡Œä¸šå†…éƒ¨çš„çœŸå®ä¸Šæ¶æµç¨‹ï¼šä¸æ˜¯å•æ­¥éª¤ï¼Œè€Œæ˜¯å¤šç¯èŠ‚åä½œ</strong></h2>
<p>ä»¥æœåŠ¡ä¾›åº”å•†æˆ–æŠ€æœ¯å›¢é˜Ÿè§’åº¦ï¼Œä¸Šæ¶æµç¨‹é€šå¸¸è¢«æ‹†æˆå‡ ä¸ªé˜¶æ®µï¼Œæ¯ä¸ªé˜¶æ®µéƒ½å¯¹åº”ä¸åŒå·¥å…·æˆ–èŒè´£ã€‚</p>
<p>æ•´ä½“æµç¨‹å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs">éœ€æ±‚ç¡®è®¤ â†’ èµ„æºæ•´ç† â†’ æ„å»º/ç­¾å â†’ ä¸Šä¼ æ„å»º â†’ å¡«å†™å®¡æ ¸èµ„æ–™ â†’ åé¦ˆæ²Ÿé€š â†’ ä¸Šçº¿å‘å¸ƒ
</code></pre>
<p>å…¶ä¸­ï¼Œæœ€å®¹æ˜“å‡ºé—®é¢˜çš„ç¯èŠ‚ä¸»è¦åœ¨ <strong>æ„å»ºã€ç­¾åã€ä¸Šä¼ ã€åå°é…ç½®</strong>ã€‚</p>
<hr/>
<h2 data-id="heading-2"><strong>ä¸‰ã€æ„å»ºä¸ç­¾åï¼šè¯ä¹¦ä½“ç³»æ˜¯ä¸Šæ¶æœåŠ¡çš„ç¬¬ä¸€é“å</strong></h2>
<p>å¯¹äºæ²¡æœ‰ iOS ç»éªŒçš„å›¢é˜Ÿï¼Œä¸Šæ¶æœåŠ¡é¦–å…ˆè¦å¤„ç†çš„æ˜¯è¯ä¹¦ä½“ç³»ï¼š</p>
<ul>
<li>App Store å‘å¸ƒè¯ä¹¦</li>
<li>iOS å¼€å‘è¯ä¹¦</li>
<li>Provisioning Profile</li>
<li>Bundle ID</li>
<li>æƒé™ç”³æ˜ï¼ˆentitlementsï¼‰</li>
</ul>
<p>ä¼ ç»Ÿæ–¹å¼ä¾èµ–äº macOS ä¸é’¥åŒ™ä¸²ï¼Œä½†æœåŠ¡å›¢é˜Ÿä¸ºäº†æé«˜æ•ˆç‡ï¼Œä¼šä½¿ç”¨è·¨å¹³å°è¯ä¹¦ç®¡ç†å·¥å…·ï¼Œè®©è¯ä¹¦èƒ½åœ¨ Windowsã€Linuxã€Mac ä¹‹é—´å…±äº«ï¼Œä¸ä¼šå‡ºç°ï¼š</p>
<ul>
<li>è¯ä¹¦è¶…é™</li>
<li>profile å†²çª</li>
<li>å¤šäººè¦†ç›–</li>
<li>æ„å»ºå¤±è´¥</li>
</ul>
<p>åœ¨è¿™ä¸€ç¯èŠ‚ä¸­ï¼Œå¼€å¿ƒä¸Šæ¶ï¼ˆAppuploaderï¼‰ çš„è·¨å¹³å°è¯ä¹¦åˆ›å»ºä¸ç®¡ç†èƒ½åŠ›éå¸¸å®ç”¨ï¼Œå› ä¸ºå®ƒå…è®¸åœ¨ Windows/Linux ç”Ÿæˆã€ç®¡ç†è¯ä¹¦ï¼Œçœå»äº†â€œå¿…é¡»ç”¨ Mac çš„é™åˆ¶â€ï¼Œè¿™å¯¹æœåŠ¡å›¢é˜Ÿæ¥è¯´æå‡æ•ˆç‡éå¸¸æ˜æ˜¾ã€‚
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8f369d9af3d045ebbba0f3625e4d52b3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5byA5b-D5bCx5aW9MjAyNQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765345619&amp;x-signature=QC%2B7ZwgOaAsijbWZhGj7JORPgfo%3D" alt="è¯ä¹¦ç”Ÿæˆ" loading="lazy"/></p>
<hr/>
<h2 data-id="heading-3"><strong>å››ã€IPA ä¸Šä¼ ï¼šä¼ ç»Ÿæµç¨‹ä¾èµ– Macï¼Œæ–°æµç¨‹å¼ºè°ƒâ€œè·¨å¹³å°æ‰§è¡Œâ€</strong></h2>
<p>åœ¨ä¼ ç»ŸæœåŠ¡é‡Œï¼Œä¸Šä¼  IPA æ˜¯ç”± macOS å®Œæˆï¼š</p>
<ul>
<li>Xcode Organizer</li>
<li>Transporter App</li>
</ul>
<p>ä½†æœåŠ¡å›¢é˜Ÿæ¯æ—¥è¦å¤„ç†å¤šä¸ª Appï¼Œå¤šç³»ç»Ÿç¯å¢ƒä¸‹æ“ä½œ Mac æå…¶ä½æ•ˆã€‚
å› æ­¤è¡Œä¸šç°åœ¨æ™®éé‡‡ç”¨â€œè·¨å¹³å°ä¸Šä¼ â€æ¨¡å¼ï¼Œè®© Windows æˆ– Linux æˆä¸ºä¸Šä¼ èŠ‚ç‚¹ï¼Œè€Œä¸æ˜¯ Macã€‚</p>
<p>ä¸€ä¸ªå¸¸è§çš„ä¸Šä¼ é“¾è·¯æ˜¯ï¼š</p>
<pre><code class="hljs">Linux CI æ„å»º â†’ Windows è¿è¥ä¸Šä¼  â†’ äº§å“æ ¡éªŒåå°å†…å®¹ â†’ æœåŠ¡å›¢é˜Ÿæäº¤å®¡æ ¸
</code></pre>
<p>åœ¨è¿™ä¸ªç¯èŠ‚ä¸­ï¼Œå¼€å¿ƒä¸Šæ¶ï¼ˆAppuploaderï¼‰å‘½ä»¤è¡Œç‰ˆæœ¬ çš„ä»·å€¼éå¸¸çªå‡ºï¼Œå› ä¸ºå®ƒï¼š</p>
<ul>
<li>æ”¯æŒ Windows</li>
<li>æ”¯æŒ Linux</li>
<li>æ”¯æŒ macOS</li>
<li>ä¸éœ€è¦ Xcode</li>
<li>ä¸ä¾èµ– Transporter</li>
<li>æ”¯æŒæ—§é€šé“ä¸æ–°é€šé“</li>
<li>å¯ç”¨äºè‡ªåŠ¨åŒ–è„šæœ¬</li>
<li>å¯ç”¨äºäººå·¥ç»ˆç«¯ä¸Šä¼ </li>
</ul>
<p>å…¸å‹ä¸Šä¼ å‘½ä»¤ç¤ºä¾‹ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">appuploader_cli -u ios@team.com -p xxx-xxx-xxx-xxx -c 2 -f build/app.ipa
</code></pre>
<p>è¿™è®©æœåŠ¡å›¢é˜Ÿå¯ä»¥æŠŠä¸Šä¼ ä»»åŠ¡æ”¾å…¥ CI ä¸­ï¼Œä¹Ÿå¯ä»¥äº¤ç»™è¿è¥åœ¨ Windows ç›´æ¥æ‰§è¡Œï¼Œä»è€Œæå‡æ•´ä½“å¤„ç†æ•ˆç‡ã€‚</p>
<p>åŒæ—¶è¿˜æœ‰å›¾å½¢åŒ–ç•Œé¢ï¼š
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/26290d9a2d6943e59be89386ff7703ee~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5byA5b-D5bCx5aW9MjAyNQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765345619&amp;x-signature=79UMukpt5DAc58kxAZqxlSQoh0A%3D" alt="ipaä¸Šä¼ " loading="lazy"/></p>
<hr/>
<h2 data-id="heading-4"><strong>äº”ã€App Store Connect é…ç½®ï¼šæœåŠ¡å›¢é˜Ÿæœ€è€—æ—¶ä½†ä¹Ÿæœ€å…³é”®çš„éƒ¨åˆ†</strong></h2>
<p>è®¸å¤šäººè¯¯ä»¥ä¸ºä¸Šä¼ å®Œæˆåå°±åªå‰©â€œç­‰å®¡æ ¸â€ï¼Œä½†æœåŠ¡å›¢é˜Ÿæœ€èŠ±æ—¶é—´çš„å…¶å®æ˜¯åå°èµ„æ–™å¡«å†™ã€‚</p>
<p>è¦å‡†å¤‡çš„å†…å®¹åŒ…æ‹¬ï¼š</p>
<ul>
<li>åº”ç”¨æˆªå›¾ï¼ˆå¤šè¯­è¨€ã€å¤šå°ºå¯¸ï¼‰</li>
<li>åº”ç”¨æè¿°ã€å…³é”®è¯ã€éšç§æ ‡ç­¾</li>
<li>App å†…è´­ï¼ˆå¦‚æœ‰ï¼‰</li>
<li>å¹´é¾„åˆ†çº§</li>
<li>å®¡æ ¸è´¦å·å’Œè·¯å¾„</li>
<li>é¢„è§ˆè§†é¢‘ï¼ˆå¯é€‰ï¼‰</li>
</ul>
<p>è¡Œä¸šå†…ä¸ºäº†å‡å°‘é‡å¤åŠ³åŠ¨ï¼Œä¸€èˆ¬ä¼šå‡†å¤‡æˆªå›¾æ‰¹é‡ä¸Šä¼ å·¥å…·ï¼Œè€Œ <strong>å¼€å¿ƒä¸Šæ¶ä¹Ÿæä¾›äº†æˆªå›¾æ‰¹é‡ä¸Šä¼ èƒ½åŠ›</strong>ï¼Œèƒ½å¤Ÿï¼š</p>
<ul>
<li>ä¸€æ¬¡ä¸Šä¼ å¤šä¸ªå°ºå¯¸</li>
<li>è‡ªåŠ¨è¯†åˆ«è¯­è¨€ç›®å½•</li>
<li>è‡ªä¸»ç®¡ç†æè¿°ä¸å…³é”®è¯</li>
</ul>
<p>è¿™éƒ¨åˆ†åŠŸèƒ½åœ¨ App ä¸Šæ¶æœåŠ¡åœºæ™¯ä¸­ä½¿ç”¨é¢‘ç‡éå¸¸é«˜ã€‚</p>
<hr/>
<h2 data-id="heading-5"><strong>å…­ã€å®¡æ ¸é˜¶æ®µï¼ˆå°¤å…¶æ˜¯ 4.3ã€5.1.1ï¼‰æ˜¯æœåŠ¡å›¢é˜Ÿçš„ä¸“ä¸šèƒ½åŠ›æ‰€åœ¨</strong></h2>
<p>App ä¸Šæ¶æœåŠ¡çš„æ ¸å¿ƒä»·å€¼å¹¶ä¸æ˜¯æŠŠ IPA ä¼ ä¸Šå»ï¼Œè€Œæ˜¯å¤„ç†ï¼š</p>
<ul>
<li>4.3 é‡å¤åº”ç”¨</li>
<li>5.1.1 æƒé™æ‹’å®¡</li>
<li>2.1 ä¸å¯ç”¨æ€§</li>
<li>å…ƒæ•°æ®ï¼ˆå†…å®¹ï¼‰é—®é¢˜</li>
<li>éšç§é—®é¢˜</li>
</ul>
<p>è¿™äº›é—®é¢˜ä¸æ˜¯å·¥å…·èƒ½è§£å†³çš„ï¼Œè€Œæ˜¯ç»éªŒé©±åŠ¨ã€‚</p>
<p>å› æ­¤é€šå¸¸çš„æœåŠ¡æ¨¡å¼æ˜¯ï¼š</p>
<pre><code class="hljs">å·¥å…·å®Œæˆä¸Šä¼  â†’ äººæ•´ç†åˆè§„ â†’ å›¢é˜Ÿå¤„ç†å®¡æ ¸åé¦ˆ
</code></pre>
<p>å¯¹äºè·¨ç«¯é¡¹ç›®ï¼ˆuni-app/H5/Flutterï¼‰ï¼Œå®¡æ ¸é€»è¾‘å°¤å…¶ä¸¥æ ¼ï¼Œéœ€è¦ï¼š</p>
<ul>
<li>æä¾›æ¸…æ™°å®¡æ ¸è¯´æ˜</li>
<li>å¢å¼ºåŸç”Ÿç»“æ„</li>
<li>è¡¥å……åŠ¨æ€å†…å®¹</li>
<li>é¿å…æ¨¡æ¿åŒ– UI</li>
</ul>
<p>æœåŠ¡å›¢é˜Ÿä¼šäº‹å…ˆå¯¹è¿™äº›é«˜é¢‘é—®é¢˜åšå®¡æŸ¥ï¼Œå‡å°‘æ¥å›è¿”å·¥ã€‚</p>
<hr/>
<h2 data-id="heading-6"><strong>ç°ä»£ App ä¸Šæ¶æœåŠ¡å·²ç»ä»â€œä»£æ“ä½œâ€ï¼Œå˜æˆâ€œæµç¨‹æ„å»ºä¸å·¥å…·é“¾åä½œâ€</strong></h2>
<p>ç»“åˆè¡Œä¸šå˜åŒ–ï¼Œå¯ä»¥çœ‹åˆ°ï¼š</p>
<ul>
<li>Mac ä¸å†æ˜¯ä¸Šæ¶çš„å¿…éœ€å“</li>
<li>Windows ä¸ Linux æˆä¸ºä¸»è¦æ‰§è¡Œç¯å¢ƒ</li>
<li>è¯ä¹¦ä¸å†ä¾èµ–é’¥åŒ™ä¸²ï¼Œè€Œæ˜¯è·¨å¹³å°ç®¡ç†</li>
<li>ä¸Šä¼ ä¸å†ä¾èµ– Transporterï¼Œè€Œæ˜¯ç¬¬ä¸‰æ–¹å·¥å…·è·¨å¹³å°å‘½ä»¤è¡Œ</li>
<li>å®¡æ ¸ä¸å†é ç»éªŒè‡†æµ‹ï¼Œè€Œæ˜¯æµç¨‹åŒ–ã€æ¨¡æ¿åŒ–</li>
<li>æœåŠ¡å›¢é˜Ÿçš„ä¼˜åŠ¿æ¥è‡ªæ•ˆç‡ä¸æµç¨‹ï¼Œè€Œéè®¾å¤‡</li>
</ul>
<p>å¼€å¿ƒä¸Šæ¶ï¼ˆAppuploaderï¼‰ æ˜¯ å¸®åŠ©æœåŠ¡å›¢é˜Ÿä¸å¼€å‘è€…æ›´é«˜æ•ˆæ‰§è¡Œä¸Šæ¶æµç¨‹çš„å·¥å…·èŠ‚ç‚¹ã€‚</p>
<p>å®ƒè§£å†³çš„æ˜¯è¡Œä¸šçš„ç—›ç‚¹ï¼šè·¨å¹³å°ã€å… Macã€è‡ªåŠ¨åŒ–ã€æ‰¹é‡åŒ–ã€ä½è€¦åˆçš„ä¸Šæ¶æ‰§è¡Œèƒ½åŠ›ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[å‰ç«¯è°ƒè¯•æŠ€å·§]]></title>    <link>https://juejin.cn/post/7579190764771213352</link>    <guid>https://juejin.cn/post/7579190764771213352</guid>    <pubDate>2025-12-03T05:53:00.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7579190764771213352" data-draft-id="7579190764770967592" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="å‰ç«¯è°ƒè¯•æŠ€å·§"/> <meta itemprop="keywords" content="å‰ç«¯,å‰ç«¯å·¥ç¨‹åŒ–,Visual Studio Code"/> <meta itemprop="datePublished" content="2025-12-03T05:53:00.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Blueå¸ƒé²"/> <meta itemprop="url" content="https://juejin.cn/user/694547080809736"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            å‰ç«¯è°ƒè¯•æŠ€å·§
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/694547080809736/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Blueå¸ƒé²
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-03T05:53:00.000Z" title="Wed Dec 03 2025 05:53:00 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-03
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»4åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#595959;font-size:15px;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(60,10,30,.04) 3%,transparent 0),linear-gradient(1turn,rgba(60,10,30,.04) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body p{color:#595959;font-size:15px;line-height:2;font-weight:400}.markdown-body p+p{margin-top:16px}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin:0;color:#135ce0}.markdown-body h1{position:relative;text-align:center;font-size:22px;margin:50px 0}.markdown-body h1:before{position:absolute;content:"";top:-10px;left:50%;width:32px;height:32px;transform:translateX(-50%);background-size:100% 100%;opacity:.36;background-repeat:no-repeat;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAABfVBMVEX///8Ad/8AgP8AgP8AgP8Aff8AgP8Af/8AgP8AVf8Af/8Af/8AgP8AgP8Af/8Afv8AAP8Afv8Afv8Aef8AgP8AdP8Afv8AgP8AgP8Acf8Ae/8AgP8Af/8AgP8Af/8Af/8AfP8Afv8AgP8Af/8Af/8Afv8Afv8AgP8Afv8AgP8Af/8Af/8AgP8AgP8Afv8AgP8Af/8AgP8AgP8AgP8Ae/8Afv8Af/8AgP8Af/8AgP8Af/8Af/8Aff8Af/8Abf8AgP8Af/8AgP8Af/8Af/8Afv8AgP8AgP8Afv8Afv8AgP8Af/8Aff8AgP8Afv8AgP8Aff8AgP8AfP8AgP8Ae/8AgP8Af/8AgP8AgP8AgP8Afv8AgP8AgP8AgP8Afv8AgP8AgP8AgP8AgP8AgP8Af/8AgP8Af/8Af/8Aev8Af/8AgP8Aff8Afv8AgP8AgP8AgP8Af/8AgP8Af/8Af/8AgP8Afv8AgP8AgP8AgP8AgP8Af/8AeP8Af/8Af/8Af//////rzEHnAAAAfXRSTlMAD7CCAivatxIDx5EMrP19AXdLEwgLR+6iCR/M0yLRzyFF7JupSXn8cw6v60Q0QeqzKtgeG237HMne850/6Qeq7QaZ+WdydHtj+OM3qENCMRYl1B3K2U7wnlWE/mhlirjkODa9FN/BF7/iNV/2kASNZpX1Wlf03C4stRGxgUPclqoAAAABYktHRACIBR1IAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH4gEaBzgZ4yeM3AAAAT9JREFUOMvNUldbwkAQvCAqsSBoABE7asSOBRUVVBQNNuy9996789+9cMFAMHnVebmdm+/bmdtbQv4dOFOW2UjPzgFyLfo6nweKfIMOBYWwFtmMPGz2Yj2pJI0JDq3udJW6VVbmKa9I192VQFV1ktXUAl5NB0cd4KpnORqsEO2ZIRpF9gJfE9Dckqq0KuZt7UAH5+8EPF3spjsRpCeQNO/tA/qDwIDA+OCQbBoKA8NOdjMySgcZGVM6jwcgRuUiSs0nlPFNSrEpJfU0jTLD6llqbvKxei7OzvkFNQohi0vAsj81+MoqsCaoPOQFgus/1LyxichW+hS2JWCHZ7VlF9jb187pIAYcHiViHAMnp5mTjJ8B5xeEXF4B1ze/fTh/C0h398DDI9HB07O8ci+vRBdvdGnfP4gBuM8vw7X/G3wDmFhFZEdxzjMAAAAldEVYdGRhdGU6Y3JlYXRlADIwMTgtMDEtMjZUMDc6NTY6MjUrMDE6MDA67pVWAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDE4LTAxLTI2VDA3OjU2OjI1KzAxOjAwS7Mt6gAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAAWdEVYdFRpdGxlAGp1ZWppbl9sb2dvIGNvcHlxapmKAAAAV3pUWHRSYXcgcHJvZmlsZSB0eXBlIGlwdGMAAHic4/IMCHFWKCjKT8vMSeVSAAMjCy5jCxMjE0uTFAMTIESANMNkAyOzVCDL2NTIxMzEHMQHy4BIoEouAOoXEXTyQjWVAAAAAElFTkSuQmCC)}.markdown-body h2{position:relative;font-size:20px;border-left:4px solid;padding:0 0 0 10px;margin:30px 0}.markdown-body h3{font-size:16px}.markdown-body ul{list-style:disc outside;margin-left:2em;margin-top:1em}.markdown-body li{line-height:2;color:#595959}.markdown-body img.loaded{margin:0 auto;display:block}.markdown-body blockquote{background:#fff9f9;margin:2em 0;padding:2px 20px;border-left:4px solid #b2aec5}.markdown-body blockquote p{color:#666;line-height:2}.markdown-body a{color:#036aca;border-bottom:1px solid rgba(3,106,202,.8);font-weight:400;text-decoration:none}.markdown-body em strong,.markdown-body strong{color:#036aca}.markdown-body hr{border-top:1px solid #135ce0}.markdown-body pre{overflow:auto}.markdown-body code,.markdown-body pre{overflow:auto;position:relative;line-height:1.75;font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body table{border-collapse:collapse;margin:1rem 0;overflow-x:auto}.markdown-body table td,.markdown-body table th{border:1px solid #dfe2e5;padding:.6em 1em}.markdown-body table tr{border-top:1px solid #dfe2e5}.markdown-body table tr:nth-child(2n){background-color:#f6f8fa}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>æœ¬æ–‡æ¡£ä»‹ç»å‰ç«¯å¼€å‘ä¸­å¸¸ç”¨çš„è°ƒè¯•æŠ€å·§ï¼Œæ¶µç›– Consoleã€VSCode Debug å’Œ Chrome Debugger çš„ä½¿ç”¨æ–¹æ³•ã€‚</p>
</blockquote>
<h2 data-id="heading-0">ä¸€. Console</h2>
<p>Console æ˜¯å‰ç«¯å¼€å‘ä¸­æœ€åŸºç¡€ä¹Ÿæ˜¯æœ€å¸¸ç”¨çš„è°ƒè¯•å·¥å…·
console.log()ã€console.info()ã€console.warn()ã€console.error() è¿™äº›éƒ½æ˜¯æ¯”è¾ƒåŸºç¡€çš„è¾“å‡ºåŠŸèƒ½ï¼Œè¿™é‡Œä¸å†èµ˜è¿°ï½</p>
<h4 data-id="heading-1">console.table()</h4>
<p>éå¸¸é€‚åˆç”¨äºè¾“å‡ºç»“æ„åŒ–æ•°æ®ï¼ˆå¯¹è±¡ã€æ•°ç»„ç­‰ï¼‰
å¯¹äºæ¥å£è¿”å›ç”¨è¿™ç§è¾“å‡ºæ–¹æ³•éå¸¸å¥½ï¼Œè¿˜èƒ½ç‚¹å‡»è¡¨å¤´æ’åº</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// è¾“å‡ºæ•°ç»„</span>
<span class="hljs-keyword">const</span> users = [
  { <span class="hljs-attr">id</span>: <span class="hljs-number">1</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'Alice'</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">25</span> },
  { <span class="hljs-attr">id</span>: <span class="hljs-number">2</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'Bob'</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">30</span> },
  { <span class="hljs-attr">id</span>: <span class="hljs-number">3</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'Charlie'</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">35</span> }
];
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">table</span>(users);

<span class="hljs-comment">// è¾“å‡ºå¯¹è±¡</span>
<span class="hljs-keyword">const</span> user = {
  <span class="hljs-attr">name</span>: <span class="hljs-string">'John'</span>,
  <span class="hljs-attr">email</span>: <span class="hljs-string">'john@example.com'</span>,
  <span class="hljs-attr">age</span>: <span class="hljs-number">30</span>,
  <span class="hljs-attr">address</span>: {
    <span class="hljs-attr">city</span>: <span class="hljs-string">'Beijing'</span>,
    <span class="hljs-attr">country</span>: <span class="hljs-string">'China'</span>
  }
};
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">table</span>(user);
</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a0d81bcfe0924704a019f6be46c59b24~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQmx1ZeW4g-mygQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765345979&amp;x-signature=9JnDxyrMx9CjoQPATHnywysB7ao%3D" alt="Pasted image 20251124112231.png" loading="lazy"/></p>
<h4 data-id="heading-2">console.time() / console.timeEnd()</h4>
<p>ç”¨äºæµ‹é‡ä»£ç æ‰§è¡Œæ—¶é—´ã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">time</span>(<span class="hljs-string">'API è¯·æ±‚è€—æ—¶'</span>);
<span class="hljs-title function_">fetch</span>(<span class="hljs-string">'/api/data'</span>)
  .<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">response</span> =&gt;</span> response.<span class="hljs-title function_">json</span>())
  .<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">data</span> =&gt;</span> {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">timeEnd</span>(<span class="hljs-string">'API è¯·æ±‚è€—æ—¶'</span>); <span class="hljs-comment">// API è¯·æ±‚è€—æ—¶: 234.567ms</span>
  });
</code></pre>
<h2 data-id="heading-3">äºŒ. VSCode Debug</h2>
<p>VSCode æä¾›äº†å¼ºå¤§çš„è°ƒè¯•åŠŸèƒ½ï¼Œå¯ä»¥ç›´æ¥åœ¨ç¼–è¾‘å™¨ä¸­è®¾ç½®æ–­ç‚¹ã€å•æ­¥è°ƒè¯•ã€ç›‘æ§å˜é‡å€¼ç­‰ã€‚
VSCode ç³»çš„ç¼–è¾‘å™¨æ“ä½œæ–¹æ³•éƒ½ä¸€æ ·ï¼Œå¦‚ Cursorï½</p>
<h3 data-id="heading-4">2.1 é…ç½®è°ƒè¯•ç¯å¢ƒ</h3>
<p>VSCode ä¾§è¾¹æ é€‰æ‹© Run and Debug å¹¶åˆ›å»º launch.json æ–‡ä»¶
åˆ›å»º launch.json æ—¶é€‰æ‹©è‡ªå·±å¯¹åº”çš„æµè§ˆå™¨å³å¯ï¼ˆChrome or Edgeï¼‰</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6f85e1d6b2074b21984b75adba70a609~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQmx1ZeW4g-mygQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765345979&amp;x-signature=nx%2BOVBs3EoX0kkpApewese7P2fw%3D" alt="Pasted image 20251124141238.png" loading="lazy"/></p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"version"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"0.2.0"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"configurations"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"chrome"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"request"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"launch"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Launch Chrome against localhost"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"http://localhost:8080"</span><span class="hljs-punctuation">,</span> <span class="hljs-comment">// è¿™é‡Œæ”¹æˆè‡ªå·±æœ¬åœ°å¼€å‘çš„ url</span>
      <span class="hljs-attr">"webRoot"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"${workspaceFolder}"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"skipFiles"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
        <span class="hljs-string">"${workspaceFolder}/node_modules/**"</span> <span class="hljs-comment">// debug æ—¶å¿½ç•¥ node_modulesï¼Œåªæœ‰æˆ‘ä»¬ä¸šåŠ¡ä»£ç è¿›è¡Œ Debug å»ºè®®åŠ ä¸Š</span>
      <span class="hljs-punctuation">]</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">]</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>é…ç½®å¥½åï¼Œç‚¹å‡»èœå•æ çš„ <strong>Launch</strong> æŒ‰é’®ï¼Œä¼šé‡æ–°æ‰“å¼€ä¸€ä¸ª chrome çš„çª—å£</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fb1a82fa21684c40bdf580284cb7ae68~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQmx1ZeW4g-mygQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765345979&amp;x-signature=7T6BRDKOlKSzWjOUZZtJcvmiF3Q%3D" alt="Pasted image 20251124141905.png" loading="lazy"/></p>
<h3 data-id="heading-5">2.2 è°ƒè¯•æ§åˆ¶</h3>
<p>æ­¤æ—¶åœ¨å¯¹åº”ä»£ç è¡Œæ•°å‰ç«¯ç‚¹å‡»ä¸€ä¸‹ï¼Œå‡ºç°çº¢ç‚¹æ—¶å³ <strong>æ‰“æ–­ç‚¹</strong> æˆåŠŸï¼Œæ­¤æ—¶åˆ·æ–°é¡µé¢å³å¯çœ‹åˆ°ä»£ç åœåœ¨è¿™é‡Œï¼Œå¯ä»¥é¼ æ ‡ Hover æŸ¥çœ‹å¯¹åº”å˜é‡å€¼ï¼Œä¹Ÿå¯ä»¥é€‰æ‹© <strong>Step Over (F10)</strong> ä»£ç ä¸€æ­¥ä¸€æ­¥æ‰§è¡Œï¼Œå¯ä»¥çœ‹åˆ°ä»£ç è¯¦ç»†çš„æ‰§è¡Œé€»è¾‘ã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8038627e2ff74609a4060934bd71fc76~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQmx1ZeW4g-mygQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765345979&amp;x-signature=4CVRZAi4zynJYhHgYtIQ%2FdhLUU8%3D" alt="Pasted image 20251124142937.png" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/98fe9ec432e44fc7890c1e70ab56b211~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQmx1ZeW4g-mygQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765345979&amp;x-signature=birNQj9ps2aEM5IEmLWU7TlDXtA%3D" alt="Pasted image 20251124144133.png" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1e52cd4da03147eda3410ab05578ff35~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQmx1ZeW4g-mygQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765345979&amp;x-signature=oqiFJjv%2FtuSZE1Nn0NjZ%2F2ENMNA%3D" alt="Pasted image 20251124143803.png" loading="lazy"/></p>
<p>è°ƒè¯•æ—¶ï¼Œä¸Šé¢çš„åŸºæœ¬æŒ‰é’®åŠŸèƒ½ï¼š</p>
<ul>
<li><strong>ç»§ç»­ (F5)</strong>: ç»§ç»­æ‰§è¡Œåˆ°ä¸‹ä¸€ä¸ªæ–­ç‚¹</li>
<li><strong>å•æ­¥è·³è¿‡ (F10)</strong>: æ‰§è¡Œå½“å‰è¡Œï¼Œä¸è¿›å…¥å‡½æ•°å†…éƒ¨</li>
<li><strong>å•æ­¥è¿›å…¥ (F11)</strong>: è¿›å…¥å‡½æ•°å†…éƒ¨</li>
<li><strong>å•æ­¥è·³å‡º (Shift + F11)</strong>: è·³å‡ºå½“å‰å‡½æ•°</li>
<li><strong>é‡å¯ (Ctrl + Shift + F5)</strong>: é‡æ–°å¼€å§‹è°ƒè¯•</li>
<li><strong>åœæ­¢ (Shift + F5)</strong>: åœæ­¢è°ƒè¯•</li>
</ul>
<h3 data-id="heading-6">3.2 å˜é‡ç›‘è§†åŠé”™è¯¯æ•è·</h3>
<h4 data-id="heading-7">å˜é‡ç›‘è§†</h4>
<p>å¯ä»¥åœ¨å˜é‡ç›‘è§†çš„é¢æ¿ä¸­ç›‘å¬æŸä¸ªå˜é‡ï¼Œåœ¨è°ƒè¯•è¿‡ç¨‹ä¸­å®æ—¶çœ‹åˆ°å˜é‡å˜åŒ–</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5d52f800956640b2ac1100e9711bd15e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQmx1ZeW4g-mygQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765345979&amp;x-signature=HCe7Qajd%2BrnCAbl69wt%2BR60QwAk%3D" alt="Pasted image 20251124142937.png" loading="lazy"/></p>
<h4 data-id="heading-8">é”™è¯¯æ•è·</h4>
<p>åœ¨æ–­ç‚¹é¢æ¿ä¸­å¼€å¯<strong>Caught Exceptions</strong>ï¼Œå³å¯åœ¨æœ‰å¼‚å¸¸æ—¶ï¼Œè‡ªåŠ¨æ–­ç‚¹åˆ°é”™è¯¯ä»£ç è¡Œå¤„ï½</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/80700036d12c4e6ea31d481de16415cb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQmx1ZeW4g-mygQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765345979&amp;x-signature=23nXHLupWC8hQQV6lgCpI1QMqRY%3D" alt="Pasted image 20251124144816.png" loading="lazy"/></p>
<h2 data-id="heading-9">ä¸‰. Chrome Debugger</h2>
<p>Chrome Debugger æ˜¯æŒ‡åœ¨ä»£ç ä¸­ä½¿ç”¨ <code>debugger</code> è¯­å¥è¿›è¡Œè°ƒè¯•çš„æ–¹æ³•ã€‚å½“ä»£ç æ‰§è¡Œåˆ° <code>debugger</code> è¯­å¥æ—¶ï¼Œå¦‚æœæµè§ˆå™¨ DevTools å·²æ‰“å¼€ï¼Œç¨‹åºä¼šè‡ªåŠ¨æš‚åœï¼Œæ­¤æ—¶å¯ä»¥æŸ¥çœ‹å˜é‡å€¼ã€è°ƒç”¨å †æ ˆç­‰ä¿¡æ¯ã€‚</p>
<h3 data-id="heading-10">3.1 debugger è¯­å¥åŸºç¡€</h3>
<h4 data-id="heading-11">ä»€ä¹ˆæ˜¯ debugger è¯­å¥</h4>
<p><code>debugger</code> æ˜¯ JavaScript çš„ä¸€ä¸ªå…³é”®å­—ï¼Œå½“æµè§ˆå™¨ DevTools æ‰“å¼€æ—¶ï¼Œæ‰§è¡Œåˆ°è¯¥è¯­å¥ä¼šè‡ªåŠ¨æš‚åœç¨‹åºæ‰§è¡Œã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">myFunction</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> data = { <span class="hljs-attr">name</span>: <span class="hljs-string">'John'</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">30</span> };
  <span class="hljs-keyword">debugger</span>; <span class="hljs-comment">// ç¨‹åºä¼šåœ¨è¿™é‡Œæš‚åœ</span>
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(data);
}
</code></pre>
<h4 data-id="heading-12">ä½¿ç”¨å‰æ</h4>
<ol>
<li><strong>å¿…é¡»æ‰“å¼€ Chrome DevTools</strong>ï¼šå¦‚æœ DevTools æœªæ‰“å¼€ï¼Œ<code>debugger</code> è¯­å¥ä¼šè¢«å¿½ç•¥</li>
<li><strong>ç¡®ä¿ Source Maps å¯ç”¨</strong>ï¼šå¼€å‘ç¯å¢ƒé€šå¸¸é»˜è®¤å¯ç”¨ï¼Œç”Ÿäº§ç¯å¢ƒéœ€è¦é…ç½®</li>
<li><strong>ä»£ç å¿…é¡»è¢«æ‰§è¡Œ</strong>ï¼šåªæœ‰æ‰§è¡Œåˆ°çš„ <code>debugger</code> æ‰ä¼šç”Ÿæ•ˆ</li>
</ol>
<h3 data-id="heading-13">3.2 åŸºç¡€ä½¿ç”¨åœºæ™¯</h3>
<h4 data-id="heading-14">è°ƒè¯•å‡½æ•°æ‰§è¡Œ</h4>
<p>åœ¨å‡½æ•°å¼€å§‹æˆ–å…³é”®ä½ç½®æ·»åŠ  <code>debugger</code>ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// lib/utils/format-number.ts</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title function_">formatNumber</span> = (<span class="hljs-params">num: <span class="hljs-built_in">number</span></span>) =&gt; {
  <span class="hljs-keyword">debugger</span>; <span class="hljs-comment">// æŸ¥çœ‹ä¼ å…¥çš„å‚æ•°</span>
  <span class="hljs-keyword">const</span> formatted = num.<span class="hljs-title function_">toLocaleString</span>(<span class="hljs-string">'en-US'</span>);
  <span class="hljs-keyword">debugger</span>; <span class="hljs-comment">// æŸ¥çœ‹æ ¼å¼åŒ–åçš„ç»“æœ</span>
  <span class="hljs-keyword">return</span> formatted;
};
</code></pre>
<h4 data-id="heading-15">è°ƒè¯•æ¡ä»¶åˆ†æ”¯</h4>
<p>åœ¨æ¡ä»¶åˆ¤æ–­å¤„æ·»åŠ  <code>debugger</code>ï¼ŒæŸ¥çœ‹æ¡ä»¶å€¼å’Œæ‰§è¡Œè·¯å¾„ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">processUser</span>(<span class="hljs-params">user: User</span>) {
  <span class="hljs-keyword">debugger</span>; <span class="hljs-comment">// æŸ¥çœ‹ user å¯¹è±¡</span>
  <span class="hljs-keyword">if</span> (user.<span class="hljs-property">age</span> &gt;= <span class="hljs-number">18</span>) {
    <span class="hljs-keyword">debugger</span>; <span class="hljs-comment">// è¿›å…¥æ­¤åˆ†æ”¯</span>
    <span class="hljs-keyword">return</span> <span class="hljs-title function_">handleAdult</span>(user);
  } <span class="hljs-keyword">else</span> {
    <span class="hljs-keyword">debugger</span>; <span class="hljs-comment">// è¿›å…¥æ­¤åˆ†æ”¯</span>
    <span class="hljs-keyword">return</span> <span class="hljs-title function_">handleMinor</span>(user);
  }
}
</code></pre>
<h4 data-id="heading-16">è°ƒè¯•å¾ªç¯</h4>
<p>åœ¨å¾ªç¯ä¸­æ·»åŠ  <code>debugger</code>ï¼Œå¯ä»¥é€æ­¥æŸ¥çœ‹æ¯æ¬¡è¿­ä»£ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">processItems</span>(<span class="hljs-params">items: Item[]</span>) {
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; items.<span class="hljs-property">length</span>; i++) {
    <span class="hljs-keyword">debugger</span>; <span class="hljs-comment">// æ¯æ¬¡å¾ªç¯éƒ½ä¼šæš‚åœï¼Œå¯ä»¥æŸ¥çœ‹ i å’Œ items[i]</span>
    <span class="hljs-keyword">const</span> item = items[i];
    <span class="hljs-title function_">processItem</span>(item);
  }
}

<span class="hljs-comment">// æˆ–è€…åªåœ¨ç‰¹å®šæ¡ä»¶ä¸‹æš‚åœ</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">processItems</span>(<span class="hljs-params">items: Item[]</span>) {
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; items.<span class="hljs-property">length</span>; i++) {
    <span class="hljs-keyword">if</span> (items[i].<span class="hljs-property">status</span> === <span class="hljs-string">'error'</span>) {
      <span class="hljs-keyword">debugger</span>; <span class="hljs-comment">// åªåœ¨é‡åˆ°é”™è¯¯çŠ¶æ€æ—¶æš‚åœ</span>
    }
    <span class="hljs-title function_">processItem</span>(items[i]);
  }
}
</code></pre>
<h4 data-id="heading-17">è°ƒè¯• React ç»„ä»¶</h4>
<p>åœ¨ç»„ä»¶å‡½æ•°ä½“ä¸­æ·»åŠ  <code>debugger</code>ï¼ŒæŸ¥çœ‹æ¯æ¬¡æ¸²æŸ“æ—¶çš„ props å’Œ stateï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// components/UserProfile.tsx</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title class_">UserProfile</span>: <span class="hljs-title class_">React</span>.<span class="hljs-property">FC</span>&lt;<span class="hljs-title class_">Props</span>&gt; = <span class="hljs-function">(<span class="hljs-params">{ userId }</span>) =&gt;</span> {
  <span class="hljs-keyword">const</span> [user, setUser] = useState&lt;<span class="hljs-title class_">User</span> | <span class="hljs-literal">null</span>&gt;(<span class="hljs-literal">null</span>);
  <span class="hljs-keyword">const</span> [loading, setLoading] = <span class="hljs-title function_">useState</span>(<span class="hljs-literal">false</span>);
  
  <span class="hljs-keyword">debugger</span>; <span class="hljs-comment">// æŸ¥çœ‹ç»„ä»¶æ¸²æŸ“æ—¶çš„ props å’Œåˆå§‹ state</span>
  
  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">debugger</span>; <span class="hljs-comment">// æŸ¥çœ‹ useEffect æ‰§è¡Œæ—¶çš„ userId</span>
    <span class="hljs-title function_">setLoading</span>(<span class="hljs-literal">true</span>);
    <span class="hljs-title function_">fetchUser</span>(userId).<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">data</span> =&gt;</span> {
      <span class="hljs-keyword">debugger</span>; <span class="hljs-comment">// æŸ¥çœ‹è·å–åˆ°çš„ç”¨æˆ·æ•°æ®</span>
      <span class="hljs-title function_">setUser</span>(data);
      <span class="hljs-title function_">setLoading</span>(<span class="hljs-literal">false</span>);
    });
  }, [userId]);
  
  <span class="hljs-keyword">debugger</span>; <span class="hljs-comment">// æŸ¥çœ‹æ¸²æŸ“æ—¶çš„æœ€ç»ˆçŠ¶æ€</span>
  <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>{user?.name}<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>;
};
</code></pre>
<h3 data-id="heading-18">3.3 Chrome DevTools æ–­ç‚¹è°ƒè¯•é¢æ¿</h3>
<h4 data-id="heading-19">æš‚åœåçš„æ“ä½œ</h4>
<p>å½“ <code>debugger</code> æš‚åœç¨‹åºåï¼Œå¯ä»¥åœ¨ DevTools ä¸­ï¼š</p>
<p><strong>æŸ¥çœ‹å˜é‡å€¼</strong></p>
<ul>
<li>åœ¨ Sources é¢æ¿çš„ Scope åŒºåŸŸæŸ¥çœ‹å±€éƒ¨å˜é‡</li>
<li>å°†é¼ æ ‡æ‚¬åœåœ¨ä»£ç ä¸­çš„å˜é‡ä¸ŠæŸ¥çœ‹å€¼</li>
<li>åœ¨ Console ä¸­è¾“å…¥å˜é‡åæŸ¥çœ‹å€¼</li>
</ul>
<p><strong>ç›‘è§†å˜é‡</strong></p>
<ul>
<li>åœ¨ Watch é¢æ¿æ·»åŠ è¦ç›‘è§†çš„å˜é‡</li>
<li>å³å¯åœ¨è°ƒè¯•è¿‡ç¨‹ä¸­å®æ—¶æ’ä»¶å˜é‡å€¼çš„å˜åŒ–</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/77e334d175b942d6aee010e0343e9cd2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQmx1ZeW4g-mygQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765345979&amp;x-signature=ZggA5Bl696bQjZAeaUJm1sQRrzk%3D" alt="Pasted image 20251124151931.png" loading="lazy"/></p>
<h4 data-id="heading-20">å•æ­¥è°ƒè¯•</h4>
<p>æš‚åœåå¯ä»¥ä½¿ç”¨å•æ­¥è°ƒè¯•ï¼š</p>
<ul>
<li><strong>F8 (Resume)</strong>: ç»§ç»­æ‰§è¡Œåˆ°ä¸‹ä¸€ä¸ª <code>debugger</code></li>
<li><strong>F10 (Step over)</strong>: å•æ­¥è·³è¿‡ï¼Œä¸è¿›å…¥å‡½æ•°å†…éƒ¨</li>
<li><strong>F11 (Step into)</strong>: å•æ­¥è¿›å…¥ï¼Œè¿›å…¥å‡½æ•°å†…éƒ¨</li>
<li><strong>Shift + F11 (Step out)</strong>: å•æ­¥è·³å‡ºï¼Œè·³å‡ºå½“å‰å‡½æ•°</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c1c8f20e3fa64626a27a09b498d37f8a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQmx1ZeW4g-mygQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765345979&amp;x-signature=enkHEcOGhH7k47x2%2BWgzW971VCI%3D" alt="Pasted image 20251124151313.png" loading="lazy"/></p>
<h2 data-id="heading-21">å‚è€ƒèµ„æ–™</h2>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fzh-CN%2Fdocs%2FWeb%2FAPI%2FConsole" target="_blank" title="https://developer.mozilla.org/zh-CN/docs/Web/API/Console" ref="nofollow noopener noreferrer">MDN Console API</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fzh-CN%2Fdocs%2FWeb%2FJavaScript%2FReference%2FStatements%2Fdebugger" target="_blank" title="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Statements/debugger" ref="nofollow noopener noreferrer">MDN debugger è¯­å¥</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fcode.visualstudio.com%2Fdocs%2Feditor%2Fdebugging" target="_blank" title="https://code.visualstudio.com/docs/editor/debugging" ref="nofollow noopener noreferrer">VSCode Debugging</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.chrome.com%2Fdocs%2Fdevtools%2F" target="_blank" title="https://developer.chrome.com/docs/devtools/" ref="nofollow noopener noreferrer">Chrome DevTools</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.chrome.com%2Fdocs%2Fdevtools%2Fjavascript%2F" target="_blank" title="https://developer.chrome.com/docs/devtools/javascript/" ref="nofollow noopener noreferrer">Chrome DevTools è°ƒè¯• JavaScript</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fnextjs.org%2Fdocs%2Fadvanced-features%2Fdebugging" target="_blank" title="https://nextjs.org/docs/advanced-features/debugging" ref="nofollow noopener noreferrer">Next.js Debugging</a></li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[SpringBoot3.0å®æˆ˜ï¼š5ä¸ªé«˜å¹¶å‘åœºæ™¯ä¸‹çš„æ€§èƒ½ä¼˜åŒ–æŠ€å·§ï¼Œè®©ä½ çš„åº”ç”¨å¿«å¦‚é—ªç”µâš¡]]></title>    <link>https://juejin.cn/post/7579167622106398720</link>    <guid>https://juejin.cn/post/7579167622106398720</guid>    <pubDate>2025-12-03T04:16:59.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7579167622106398720" data-draft-id="7579165599042715663" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="SpringBoot3.0å®æˆ˜ï¼š5ä¸ªé«˜å¹¶å‘åœºæ™¯ä¸‹çš„æ€§èƒ½ä¼˜åŒ–æŠ€å·§ï¼Œè®©ä½ çš„åº”ç”¨å¿«å¦‚é—ªç”µâš¡"/> <meta itemprop="keywords" content="åç«¯,å‰ç«¯,äººå·¥æ™ºèƒ½"/> <meta itemprop="datePublished" content="2025-12-03T04:16:59.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="é˜¿æ©™çš„ç™¾å®ç®±"/> <meta itemprop="url" content="https://juejin.cn/user/1638743356481367"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            SpringBoot3.0å®æˆ˜ï¼š5ä¸ªé«˜å¹¶å‘åœºæ™¯ä¸‹çš„æ€§èƒ½ä¼˜åŒ–æŠ€å·§ï¼Œè®©ä½ çš„åº”ç”¨å¿«å¦‚é—ªç”µâš¡
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1638743356481367/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    é˜¿æ©™çš„ç™¾å®ç®±
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-03T04:16:59.000Z" title="Wed Dec 03 2025 04:16:59 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-03
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»1åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0"><strong>SpringBoot3.0å®æˆ˜ï¼š5ä¸ªé«˜å¹¶å‘åœºæ™¯ä¸‹çš„æ€§èƒ½ä¼˜åŒ–æŠ€å·§ï¼Œè®©ä½ çš„åº”ç”¨å¿«å¦‚é—ªç”µâš¡</strong></h2>
<h2 data-id="heading-1">å¼•è¨€</h2>
<p>åœ¨å½“ä»Šçš„äº’è”ç½‘æ—¶ä»£ï¼Œé«˜å¹¶å‘åœºæ™¯å·²ç»æˆä¸ºè®¸å¤šåº”ç”¨çš„å¸¸æ€ã€‚æ— è®ºæ˜¯ç”µå•†å¹³å°çš„ç§’æ€æ´»åŠ¨ã€ç¤¾äº¤åª’ä½“çš„çƒ­ç‚¹äº‹ä»¶ï¼Œè¿˜æ˜¯é‡‘èç³»ç»Ÿçš„å®æ—¶äº¤æ˜“ï¼Œéƒ½éœ€è¦åº”å¯¹æµ·é‡çš„ç”¨æˆ·è¯·æ±‚ã€‚Spring Bootä½œä¸ºJavaç”Ÿæ€ä¸­æœ€æµè¡Œçš„å¾®æœåŠ¡æ¡†æ¶ä¹‹ä¸€ï¼Œå…¶3.0ç‰ˆæœ¬åœ¨æ€§èƒ½ã€å“åº”é€Ÿåº¦å’Œèµ„æºåˆ©ç”¨ç‡æ–¹é¢æœ‰äº†æ˜¾è‘—æå‡ã€‚ç„¶è€Œï¼Œä»…ä»…ä¾èµ–æ¡†æ¶æœ¬èº«çš„ä¼˜åŒ–æ˜¯ä¸å¤Ÿçš„ï¼Œå¼€å‘è€…è¿˜éœ€è¦æŒæ¡ä¸€ç³»åˆ—é’ˆå¯¹é«˜å¹¶å‘åœºæ™¯çš„æ€§èƒ½ä¼˜åŒ–æŠ€å·§ã€‚</p>
<p>æœ¬æ–‡å°†æ·±å…¥æ¢è®¨5ä¸ªåœ¨Spring Boot 3.0ä¸­å®ç°é«˜æ€§èƒ½çš„å…³é”®æŠ€å·§ï¼Œæ¶µç›–ä»çº¿ç¨‹æ± é…ç½®åˆ°ç¼“å­˜ç­–ç•¥ã€ä»æ•°æ®åº“ä¼˜åŒ–åˆ°å¼‚æ­¥å¤„ç†çš„æ–¹æ–¹é¢é¢ã€‚è¿™äº›æŠ€å·§ä¸ä»…åŸºäºSpring Boot 3.0çš„æ–°ç‰¹æ€§ï¼Œè¿˜ç»“åˆäº†å®é™…ç”Ÿäº§ç¯å¢ƒä¸­çš„æœ€ä½³å®è·µï¼Œå¸®åŠ©ä½ çš„åº”ç”¨åœ¨é«˜å¹¶å‘åœºæ™¯ä¸‹ä¾ç„¶èƒ½å¤Ÿâ€œå¿«å¦‚é—ªç”µâ€ã€‚</p>
<hr/>
<h2 data-id="heading-2">ä¸»ä½“</h2>
<h3 data-id="heading-3">1. åˆç†é…ç½®Webå®¹å™¨çš„çº¿ç¨‹æ± </h3>
<h4 data-id="heading-4">é—®é¢˜èƒŒæ™¯</h4>
<p>é»˜è®¤æƒ…å†µä¸‹ï¼ŒSpring Bootä½¿ç”¨åµŒå…¥å¼Tomcatä½œä¸ºWebå®¹å™¨ï¼Œå…¶çº¿ç¨‹æ± é…ç½®å¯èƒ½æ— æ³•æ»¡è¶³é«˜å¹¶å‘éœ€æ±‚ã€‚ç‰¹åˆ«æ˜¯åœ¨çªå‘æµé‡åœºæ™¯ä¸‹ï¼Œçº¿ç¨‹é¥¥é¥¿ä¼šå¯¼è‡´è¯·æ±‚æ’é˜Ÿç”šè‡³è¶…æ—¶ã€‚</p>
<h4 data-id="heading-5">Spring Boot 3.0çš„æ”¹è¿›</h4>
<p>Spring Boot 3.0å¯¹WebFluxå’Œéé˜»å¡IOæä¾›äº†æ›´å¥½çš„æ”¯æŒï¼Œä½†å¯¹äºä¼ ç»ŸServletå®¹å™¨ï¼ˆå¦‚Tomcatï¼‰ï¼Œä»éœ€å…³æ³¨ä»¥ä¸‹å…³é”®å‚æ•°ï¼š</p>
<pre><code class="hljs language-properties" lang="properties">server.tomcat.max-threads=200 # é»˜è®¤æ˜¯200
server.tomcat.min-spare-threads=20 # é»˜è®¤æ˜¯10
server.tomcat.accept-count=100 # ç­‰å¾…é˜Ÿåˆ—é•¿åº¦
</code></pre>
<h4 data-id="heading-6">ä¼˜åŒ–å»ºè®®</h4>
<ul>
<li><strong>åŠ¨æ€è°ƒæ•´</strong>ï¼šç»“åˆActuatorå’ŒPrometheusç›‘æ§çº¿ç¨‹æ± çŠ¶æ€</li>
<li><strong>è®¡ç®—å…¬å¼</strong>ï¼š<code>max-threads = (CPUæ ¸å¿ƒæ•° * CPUåˆ©ç”¨ç‡ç›®æ ‡ * (1 + Waitæ—¶é—´/Computeæ—¶é—´))</code></li>
<li><strong>æ›¿ä»£æ–¹æ¡ˆ</strong>ï¼šå¯¹äºIOå¯†é›†å‹åº”ç”¨è€ƒè™‘ä½¿ç”¨Undertowæˆ–Jetty</li>
</ul>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Bean</span>
<span class="hljs-keyword">public</span> TomcatProtocolHandlerCustomizer&lt;?&gt; protocolHandlerCustomizer() {
    <span class="hljs-keyword">return</span> protocolHandler -&gt; {
        protocolHandler.setExecutor(Executors.newVirtualThreadPerTaskExecutor());
    };
}
</code></pre>
<blockquote>
<p>Spring Boot 3.0æ”¯æŒJava19çš„è™šæ‹Ÿçº¿ç¨‹ï¼ˆLoomé¡¹ç›®ï¼‰ï¼Œå¯ä»¥å¤§å¹…æå‡çº¿ç¨‹å¯†é›†å‹åº”ç”¨çš„æ€§èƒ½ã€‚</p>
</blockquote>
<h3 data-id="heading-7">2. Rediså¤šçº§ç¼“å­˜è®¾è®¡ä¸å®ç°</h3>
<h4 data-id="heading-8">ç¼“å­˜ç­–ç•¥æ¼”è¿›</h4>
<p>ä¼ ç»Ÿçš„å•ä¸€Redisç¼“å­˜åœ¨é«˜å¹¶å‘ä¸‹ä¼šé‡åˆ°ï¼š</p>
<ul>
<li>Cacheç©¿é€ï¼ˆé¢‘ç¹æŸ¥è¯¢ä¸å­˜åœ¨çš„keyï¼‰</li>
<li>Cacheé›ªå´©ï¼ˆå¤§é‡keyåŒæ—¶è¿‡æœŸï¼‰</li>
<li>Cacheå‡»ç©¿ï¼ˆçƒ­ç‚¹keyçªç„¶å¤±æ•ˆï¼‰</li>
</ul>
<h4 data-id="heading-9">Spring Boot 3.0è§£å†³æ–¹æ¡ˆ</h4>
<ol>
<li>
<p><strong>Caffeineæœ¬åœ°ç¼“å­˜</strong>ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Configuration</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CacheConfig</span> {
    <span class="hljs-meta">@Bean</span>
    <span class="hljs-keyword">public</span> CaffeineCacheManager <span class="hljs-title function_">cacheManager</span><span class="hljs-params">()</span> {
        Caffeine&lt;Object, Object&gt; caffeine = Caffeine.newBuilder()
                .maximumSize(<span class="hljs-number">10_000</span>)
                .expireAfterWrite(<span class="hljs-number">5</span>, TimeUnit.MINUTES);
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">CaffeineCacheManager</span>(<span class="hljs-string">"users"</span>, caffeine);
    }
}
</code></pre>
</li>
<li>
<p><strong>Redisåˆ†å±‚ç¼“å­˜</strong>ï¼š</p>
<ul>
<li>L1: Local Cache (Caffeine)</li>
<li>L2: Redis Cluster</li>
<li>L3: DB (å¸¦ç†”æ–­ä¿æŠ¤)</li>
</ul>
</li>
<li>
<p><strong>BloomFilteré˜²ç©¿é€</strong>ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Bean</span>
<span class="hljs-keyword">public</span> BloomFilter&lt;String&gt; <span class="hljs-title function_">userBloomFilter</span><span class="hljs-params">()</span> {
    <span class="hljs-keyword">return</span> BloomFilter.create(
            Funnels.stringFunnel(StandardCharsets.UTF_8),
            <span class="hljs-number">1_000_000</span>,
            <span class="hljs-number">0.01</span>);
}
</code></pre>
</li>
</ol>
<h3 data-id="heading-10">3. R2DBCå“åº”å¼æ•°æ®åº“è®¿é—®</h3>
<h4 data-id="heading-11">JDBCç“¶é¢ˆåˆ†æ</h4>
<p>ä¼ ç»ŸJDBCçš„é˜»å¡å¼æ“ä½œåœ¨é«˜å¹¶å‘ä¸‹ä¼šå¯¼è‡´ï¼š</p>
<ul>
<li>Connection Poolè€—å°½</li>
<li>Thread Blockingå¢åŠ å»¶è¿Ÿ</li>
</ul>
<h4 data-id="heading-12">Spring Boot 3.0å“åº”å¼æ–¹æ¡ˆ</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Repository</span> 
<span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">UserRepository</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">ReactiveCrudRepository</span>&lt;User, Long&gt; {

    <span class="hljs-meta">@Query("SELECT * FROM users WHERE age &gt;= $1")</span>
    Flux&lt;User&gt; <span class="hljs-title function_">findByAgeGreaterThan</span><span class="hljs-params">(<span class="hljs-type">int</span> age)</span>;
}

<span class="hljs-comment">// Controllerç¤ºä¾‹ </span>
<span class="hljs-meta">@GetMapping("/users")</span>
<span class="hljs-keyword">public</span> Flux&lt;User&gt; <span class="hljs-title function_">getUsers</span><span class="hljs-params">(<span class="hljs-meta">@RequestParam</span> <span class="hljs-type">int</span> age)</span> {
    <span class="hljs-keyword">return</span> userRepository.findByAgeGreaterThan(age)
            .timeout(Duration.ofMillis(<span class="hljs-number">500</span>))
            .onErrorResume(e -&gt; Flux.empty());
}
</code></pre>
<h4 data-id="heading-13">æ€§èƒ½å¯¹æ¯”æ•°æ®ï¼š</h4>

























<table><thead><tr><th>QPS</th><th>JDBC</th><th>R2DBC</th></tr></thead><tbody><tr><td>100</td><td>~50ms</td><td>~20ms</td></tr><tr><td>1000</td><td>~300ms</td><td>~80ms</td></tr><tr><td>10000</td><td>Timeout</td><td>~200ms</td></tr></tbody></table>
<h3 data-id="heading-14">4. CompletableFutureå¼‚æ­¥ç¼–æ’</h3>
<h4 data-id="heading-15">IOå¯†é›†å‹ä»»åŠ¡ä¼˜åŒ–ç¤ºä¾‹ï¼š</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Service</span> 
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OrderService</span> {

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> ProductClient productClient;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> InventoryClient inventoryClient;
    
    <span class="hljs-meta">@Async("boundedTaskExecutor")</span>
    <span class="hljs-keyword">public</span> CompletableFuture&lt;OrderResult&gt; <span class="hljs-title function_">createOrderAsync</span><span class="hljs-params">(OrderRequest request)</span> {
        CompletableFuture&lt;ProductInfo&gt; productFuture = productClient.getProductAsync(request.productId());
        CompletableFuture&lt;InventoryInfo&gt; inventoryFuture = inventoryClient.getInventoryAsync(request.productId());
        
        <span class="hljs-keyword">return</span> productFuture.thenCombineAsync(inventoryFuture, (product, inventory) -&gt; {
            <span class="hljs-keyword">if</span>(inventory.stock() &lt; request.quantity()) {
                <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BusinessException</span>(<span class="hljs-string">"åº“å­˜ä¸è¶³"</span>);
            }
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">OrderResult</span>(product.id(), product.price() * request.quantity());
        });
    }
}
</code></pre>
<h4 data-id="heading-16">Executoré…ç½®å…³é”®ç‚¹ï¼š</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Configuration</span> 
<span class="hljs-meta">@EnableAsync</span> 
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AsyncConfig</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">AsyncConfigurer</span> {

    <span class="hljs-meta">@Override</span> 
    <span class="hljs-keyword">public</span> Executor <span class="hljs-title function_">getAsyncExecutor</span><span class="hljs-params">()</span> {
        <span class="hljs-type">ThreadPoolTaskExecutor</span> <span class="hljs-variable">executor</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ThreadPoolTaskExecutor</span>();
        executor.setCorePoolSize(Runtime.getRuntime().availableProcessors());
        executor.setMaxPoolSize(<span class="hljs-number">200</span>);
        executor.setQueueCapacity(<span class="hljs-number">1000</span>);
        executor.setThreadNamePrefix(<span class="hljs-string">"Async-"</span>);
        executor.setRejectedExecutionHandler(<span class="hljs-keyword">new</span> <span class="hljs-title class_">ThreadPoolExecutor</span>.CallerRunsPolicy());
        executor.initialize();
        <span class="hljs-keyword">return</span> executor;
    }
}
</code></pre>
<h3 data-id="heading-17">5. MicrometeræŒ‡æ ‡ç›‘æ§ä¸å¼¹æ€§æ‰©ç¼©å®¹</h3>
<h4 data-id="heading-18">Spring Boot Actuatorå¢å¼ºç‚¹ï¼š</h4>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">management:</span>
 <span class="hljs-attr">endpoints:</span>
 <span class="hljs-attr">web:</span>
 <span class="hljs-attr">exposure:</span>
 <span class="hljs-attr">include:</span> <span class="hljs-string">"*"</span>
 <span class="hljs-attr">metrics:</span>
 <span class="hljs-attr">tags.application:</span> <span class="hljs-string">${spring.application.name}</span>
 <span class="hljs-attr">distribution:</span>
 <span class="hljs-attr">percentiles-histogram.http.server.request:</span> <span class="hljs-literal">true</span>
 
<span class="hljs-attr">prometheus:</span>
 <span class="hljs-attr">enabled:</span> <span class="hljs-literal">true</span>  
</code></pre>
<h4 data-id="heading-19">Grafanaç›‘æ§å…³é”®æŒ‡æ ‡ï¼š</h4>
<ol>
<li><code>http_server_request_duration_seconds</code>ï¼šP99å»¶è¿Ÿç›‘æ§</li>
<li><code>jvm_threads_live</code>ï¼šçº¿ç¨‹æ•°å˜åŒ–è¶‹åŠ¿</li>
<li><code>reactor_scheduler_queue_size</code>ï¼šå“åº”å¼ä»»åŠ¡é˜Ÿåˆ—</li>
</ol>
<h4 data-id="heading-20">Kubernetes HPAè‡ªåŠ¨æ‰©ç¼©å®¹ç¤ºä¾‹ï¼š</h4>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">autoscaling/v2beta2</span> 
<span class="hljs-attr">kind:</span> <span class="hljs-string">HorizontalPodAutoscaler</span> 
<span class="hljs-attr">metadata:</span>
 <span class="hljs-attr">name:</span> <span class="hljs-string">order-service-hpa</span>  
<span class="hljs-attr">spec:</span>
 <span class="hljs-attr">scaleTargetRef:</span>
 <span class="hljs-attr">apiVersion:</span> <span class="hljs-string">apps/v1</span> 
 <span class="hljs-attr">kind:</span> <span class="hljs-string">Deployment</span> 
 <span class="hljs-attr">name:</span> <span class="hljs-string">order-service</span>  
 <span class="hljs-string">minReplicas:16]</span>
 <span class="hljs-string">metrics15]:</span>
 <span class="hljs-string">type17]:</span> <span class="hljs-string">Resource18]]</span>
 <span class="hljs-string">resource19]:</span>
 <span class="hljs-string">name20]:</span> <span class="hljs-string">cpu21]]</span>
 <span class="hljs-string">target22]:</span>
 <span class="hljs-string">type23]:</span> <span class="hljs-string">Utilization24]]</span>
 <span class="hljs-string">averageUtilization25]:70]]]</span>
</code></pre>
<hr/>
<h2 data-id="heading-21"/>
<p>æ€»ç»“</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ã€vueé«˜é¢‘é¢è¯•é¢˜ã€‘ç¬¬ 21 é¢˜ï¼šVue3 ä¸­çš„ Slotï¼ˆæ’æ§½ï¼‰â€” åŸºç¡€ã€åŸç†ã€ä½¿ç”¨åœºæ™¯ã€é¢è¯•å¿…é—®ç‚¹]]></title>    <link>https://juejin.cn/post/7579179625461841962</link>    <guid>https://juejin.cn/post/7579179625461841962</guid>    <pubDate>2025-12-03T04:41:32.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7579179625461841962" data-draft-id="7579186764046155817" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ã€vueé«˜é¢‘é¢è¯•é¢˜ã€‘ç¬¬ 21 é¢˜ï¼šVue3 ä¸­çš„ Slotï¼ˆæ’æ§½ï¼‰â€” åŸºç¡€ã€åŸç†ã€ä½¿ç”¨åœºæ™¯ã€é¢è¯•å¿…é—®ç‚¹"/> <meta itemprop="keywords" content="å‰ç«¯,é¢è¯•"/> <meta itemprop="datePublished" content="2025-12-03T04:41:32.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å‰ç«¯ä¸€è¯¾"/> <meta itemprop="url" content="https://juejin.cn/user/1169536102963917"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ã€vueé«˜é¢‘é¢è¯•é¢˜ã€‘ç¬¬ 21 é¢˜ï¼šVue3 ä¸­çš„ Slotï¼ˆæ’æ§½ï¼‰â€” åŸºç¡€ã€åŸç†ã€ä½¿ç”¨åœºæ™¯ã€é¢è¯•å¿…é—®ç‚¹
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1169536102963917/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å‰ç«¯ä¸€è¯¾
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-03T04:41:32.000Z" title="Wed Dec 03 2025 04:41:32 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-03
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»2åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">Vue3 ä¸­çš„ Slotï¼ˆæ’æ§½ï¼‰å®Œæ•´è§£æ</h2>
<blockquote>
<p>Slot æ˜¯ä¸€ç§ç»„ä»¶å†…å®¹åˆ†å‘æœºåˆ¶ï¼Œè®©çˆ¶ç»„ä»¶å°†å†…å®¹æ³¨å…¥åˆ°å­ç»„ä»¶å†…éƒ¨çš„æŒ‡å®šä½ç½®ï¼Œä½¿ç»„ä»¶æ›´çµæ´»ã€æ›´æ˜“å¤ç”¨ã€‚</p>
</blockquote>
<h3 data-id="heading-1">ä¸€ã€ä»€ä¹ˆæ˜¯ Slotï¼Ÿ</h3>
<ul>
<li>è§£å†³â€œç»“æ„å›ºå®šã€å†…å®¹ä¸ç¡®å®šâ€çš„åœºæ™¯</li>
<li>çˆ¶ç»„ä»¶å¯åŠ¨æ€ä¼ å…¥å†…å®¹ï¼Œæé«˜å¤ç”¨æ€§ï¼ˆå¦‚ <code>Dialog</code>ã€<code>Select</code>ã€<code>Card</code>ï¼‰</li>
</ul>
<h3 data-id="heading-2">äºŒã€ä¸‰ç±»æ’æ§½</h3>
<h4 data-id="heading-3">1. é»˜è®¤æ’æ§½ï¼ˆDefault Slotï¼‰</h4>
<p>å­ç»„ä»¶ï¼š</p>
<pre><code class="hljs language-vue" lang="vue">&lt;template&gt;
  &lt;div class="card"&gt;
    &lt;slot&gt;&lt;/slot&gt;
  &lt;/div&gt;
&lt;/template&gt;
</code></pre>
<p>çˆ¶ç»„ä»¶ï¼š</p>
<pre><code class="hljs language-vue" lang="vue">&lt;Card&gt;æˆ‘æ˜¯é»˜è®¤å†…å®¹&lt;/Card&gt;
</code></pre>
<h4 data-id="heading-4">2. å…·åæ’æ§½ï¼ˆNamed Slotï¼‰</h4>
<p>å­ç»„ä»¶ï¼š</p>
<pre><code class="hljs language-vue" lang="vue">&lt;slot name="header" /&gt;
&lt;slot /&gt;
&lt;slot name="footer" /&gt;
</code></pre>
<p>çˆ¶ç»„ä»¶ï¼š</p>
<pre><code class="hljs language-vue" lang="vue">&lt;Card&gt;
  &lt;template #header&gt;æ ‡é¢˜&lt;/template&gt;
  é»˜è®¤å†…å®¹
  &lt;template #footer&gt;åº•éƒ¨&lt;/template&gt;
&lt;/Card&gt;
</code></pre>
<h4 data-id="heading-5">3. ä½œç”¨åŸŸæ’æ§½ï¼ˆScoped Slotï¼‰</h4>
<p>å°†å­ç»„ä»¶çš„æ•°æ®ä¼ ç»™çˆ¶ç»„ä»¶ï¼Œç”±çˆ¶ç»„ä»¶å†³å®šå¦‚ä½•æ¸²æŸ“ï¼š</p>
<p>å­ç»„ä»¶ï¼š</p>
<pre><code class="hljs language-vue" lang="vue">&lt;slot :row="rowData"&gt;&lt;/slot&gt;
</code></pre>
<p>çˆ¶ç»„ä»¶ï¼š</p>
<pre><code class="hljs language-vue" lang="vue">&lt;Child v-slot="{ row }"&gt;
  &lt;div&gt;{{ row.name }}&lt;/div&gt;
&lt;/Child&gt;
</code></pre>
<blockquote>
<p>è¡¨æ ¼ç»„ä»¶ï¼ˆå¦‚ Element Plusã€Ant Design Vueï¼‰çš„è‡ªå®šä¹‰åˆ—å¹¿æ³›ä½¿ç”¨ä½œç”¨åŸŸæ’æ§½ã€‚</p>
</blockquote>
<h3 data-id="heading-6">ä¸‰ã€è¿è¡ŒåŸç†ï¼ˆé«˜é¢‘ï¼‰</h3>
<ul>
<li>çˆ¶ç»„ä»¶çš„æ’æ§½å†…å®¹åœ¨â€œçˆ¶ä½œç”¨åŸŸâ€ç¼–è¯‘ï¼Œä½†åœ¨å­ç»„ä»¶çš„ <code>slot</code> ä½ç½®æ¸²æŸ“</li>
<li>å­ç»„ä»¶åªæä¾›æ¸²æŸ“å ä½ï¼›ä½œç”¨åŸŸå§‹ç»ˆå±äºçˆ¶ç»„ä»¶</li>
</ul>
<p>ç¤ºä¾‹ï¼š</p>
<pre><code class="hljs language-vue" lang="vue">&lt;Child&gt;
  {{ count }}
&lt;/Child&gt;
</code></pre>
<p>ä¸Šä¾‹ä¸­ <code>count</code> æ¥è‡ªçˆ¶ç»„ä»¶ä½œç”¨åŸŸï¼Œå­ç»„ä»¶æ— æ³•ä¿®æ”¹çˆ¶æ¨¡æ¿å˜é‡ã€‚</p>
<h3 data-id="heading-7">å››ã€Slot ä¸ Props çš„å…³ç³»</h3>
<ul>
<li><code>Props</code>ï¼šçˆ¶ â†’ å­ï¼ˆä¼ å€¼ï¼‰</li>
<li><code>Scoped Slot</code>ï¼šå­ â†’ çˆ¶ï¼ˆä¼ æ•°æ®ï¼Œçˆ¶è´Ÿè´£æ¸²æŸ“ï¼‰</li>
<li>äºŒè€…äº’è¡¥ï¼Œ<code>slot</code> ä¸èƒ½æ›¿ä»£ <code>props</code></li>
</ul>
<h3 data-id="heading-8">äº”ã€æ ¸å¿ƒä½¿ç”¨åœºæ™¯</h3>
<ul>
<li>UI ç»„ä»¶æ‰©å±•ï¼ˆ<code>Dialog</code>ã€<code>Drawer</code>ï¼‰</li>
</ul>
<pre><code class="hljs language-vue" lang="vue">&lt;Dialog&gt;
  &lt;template #footer&gt;
    &lt;button&gt;ç¡®å®š&lt;/button&gt;
  &lt;/template&gt;
&lt;/Dialog&gt;
</code></pre>
<ul>
<li>è¡¨æ ¼è‡ªå®šä¹‰åˆ—ï¼ˆä½œç”¨åŸŸæ’æ§½ï¼‰</li>
</ul>
<pre><code class="hljs language-vue" lang="vue">&lt;el-table-column label="å§“å"&gt;
  &lt;template #default="{ row }"&gt;
    &lt;b&gt;{{ row.name }}&lt;/b&gt;
  &lt;/template&gt;
&lt;/el-table-column&gt;
</code></pre>
<ul>
<li>åŠ¨æ€æ¨¡æ¿æ³¨å…¥ï¼ˆå¡ç‰‡ã€èœå•ã€å¸ƒå±€ç»„ä»¶ï¼‰</li>
</ul>
<h3 data-id="heading-9">å…­ã€å¸¸è§è¿½é—®</h3>
<ul>
<li>
<p>è¿½é—® 1ï¼šä¸ºä»€ä¹ˆçˆ¶ç»„ä»¶å˜é‡èƒ½åœ¨å­ç»„ä»¶ slot ä¸­æ˜¾ç¤ºï¼Ÿ</p>
<ul>
<li>æ’æ§½å†…å®¹åœ¨çˆ¶ä½œç”¨åŸŸç¼–è¯‘ï¼Œæ¸²æŸ“ä½ç½®åœ¨å­ç»„ä»¶ï¼Œä½†æ‰§è¡Œä¸Šä¸‹æ–‡ä»å±çˆ¶ç»„ä»¶</li>
</ul>
</li>
<li>
<p>è¿½é—® 2ï¼š<code>slot</code> ä¸ <code>scoped slot</code> çš„æœ¬è´¨åŒºåˆ«ï¼Ÿ</p>
<ul>
<li><code>slot</code>ï¼šçˆ¶ â†’ å­ï¼Œçˆ¶æä¾›å†…å®¹</li>
<li><code>scoped slot</code>ï¼šå­ â†’ çˆ¶ï¼Œå­æä¾›æ•°æ®ï¼Œçˆ¶å†³å®šæ¸²æŸ“</li>
</ul>
</li>
<li>
<p>è¿½é—® 3ï¼šVue3 ä¸­ slot çš„ç¼–è¯‘ç»“æœï¼Ÿ</p>
<ul>
<li>é»˜è®¤æ’æ§½ â†’ <code>$slots.default?.()</code></li>
<li>å…·åæ’æ§½ â†’ <code>$slots.header?.()</code></li>
<li>ä½œç”¨åŸŸæ’æ§½ â†’ å‚æ•°åŒ–æ¸²æŸ“å‡½æ•° <code>(slotProps) =&gt; VNode</code></li>
</ul>
</li>
<li>
<p>è¿½é—® 4ï¼š<code>setup</code> ä¸­å¦‚ä½•è®¿é—® slotï¼Ÿ</p>
</li>
</ul>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">import</span> { useSlots } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>
<span class="hljs-keyword">const</span> slots = <span class="hljs-title function_">useSlots</span>()
slots.<span class="hljs-property">default</span>?.()
slots.<span class="hljs-property">header</span>?.()
</code></pre>
<ul>
<li>è¿½é—® 5ï¼šslot æ˜¯å¦å¯åŠ¨æ€è°ƒç”¨ï¼Ÿ</li>
</ul>
<pre><code class="hljs language-vue" lang="vue">&lt;component :is="slots[name]"&gt;&lt;/component&gt;
</code></pre>
<p>åœ¨ Vue3 ä¸­ï¼Œæ’æ§½æœ¬è´¨ä¸Šæ˜¯å‡½æ•°ã€‚</p>
<h3 data-id="heading-10">ä¸ƒã€ä¸€å¥è¯æ€»ç»“</h3>
<blockquote>
<p>ç¼–è¯‘åœ¨çˆ¶ã€æ¸²æŸ“åœ¨å­ã€ä½œç”¨åŸŸå±äºçˆ¶ã€‚<code>Slot</code> æ˜¯çˆ¶æ¨¡æ¿æ³¨å…¥ï¼›<code>Scoped Slot</code> ç”¨äºå­ â†’ çˆ¶çš„æ•°æ®å›ä¼ ã€‚</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ç¬¬ 22 é¢˜ï¼šTeleport çš„ä½œç”¨ã€åŸç†å’Œä½¿ç”¨åœºæ™¯]]></title>    <link>https://juejin.cn/post/7579213860571250742</link>    <guid>https://juejin.cn/post/7579213860571250742</guid>    <pubDate>2025-12-03T04:42:29.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7579213860571250742" data-draft-id="7579179625461858346" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ç¬¬ 22 é¢˜ï¼šTeleport çš„ä½œç”¨ã€åŸç†å’Œä½¿ç”¨åœºæ™¯"/> <meta itemprop="keywords" content="å‰ç«¯,é¢è¯•"/> <meta itemprop="datePublished" content="2025-12-03T04:42:29.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å‰ç«¯ä¸€è¯¾"/> <meta itemprop="url" content="https://juejin.cn/user/1169536102963917"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ç¬¬ 22 é¢˜ï¼šTeleport çš„ä½œç”¨ã€åŸç†å’Œä½¿ç”¨åœºæ™¯
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1169536102963917/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å‰ç«¯ä¸€è¯¾
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-03T04:42:29.000Z" title="Wed Dec 03 2025 04:42:29 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-03
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»3åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#595959;font-size:15px;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(60,10,30,.04) 3%,transparent 0),linear-gradient(1turn,rgba(60,10,30,.04) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body p{color:#595959;font-size:15px;line-height:2;font-weight:400}.markdown-body p+p{margin-top:16px}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin:0;color:#135ce0}.markdown-body h1{position:relative;text-align:center;font-size:22px;margin:50px 0}.markdown-body h1:before{position:absolute;content:"";top:-10px;left:50%;width:32px;height:32px;transform:translateX(-50%);background-size:100% 100%;opacity:.36;background-repeat:no-repeat;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAABfVBMVEX///8Ad/8AgP8AgP8AgP8Aff8AgP8Af/8AgP8AVf8Af/8Af/8AgP8AgP8Af/8Afv8AAP8Afv8Afv8Aef8AgP8AdP8Afv8AgP8AgP8Acf8Ae/8AgP8Af/8AgP8Af/8Af/8AfP8Afv8AgP8Af/8Af/8Afv8Afv8AgP8Afv8AgP8Af/8Af/8AgP8AgP8Afv8AgP8Af/8AgP8AgP8AgP8Ae/8Afv8Af/8AgP8Af/8AgP8Af/8Af/8Aff8Af/8Abf8AgP8Af/8AgP8Af/8Af/8Afv8AgP8AgP8Afv8Afv8AgP8Af/8Aff8AgP8Afv8AgP8Aff8AgP8AfP8AgP8Ae/8AgP8Af/8AgP8AgP8AgP8Afv8AgP8AgP8AgP8Afv8AgP8AgP8AgP8AgP8AgP8Af/8AgP8Af/8Af/8Aev8Af/8AgP8Aff8Afv8AgP8AgP8AgP8Af/8AgP8Af/8Af/8AgP8Afv8AgP8AgP8AgP8AgP8Af/8AeP8Af/8Af/8Af//////rzEHnAAAAfXRSTlMAD7CCAivatxIDx5EMrP19AXdLEwgLR+6iCR/M0yLRzyFF7JupSXn8cw6v60Q0QeqzKtgeG237HMne850/6Qeq7QaZ+WdydHtj+OM3qENCMRYl1B3K2U7wnlWE/mhlirjkODa9FN/BF7/iNV/2kASNZpX1Wlf03C4stRGxgUPclqoAAAABYktHRACIBR1IAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH4gEaBzgZ4yeM3AAAAT9JREFUOMvNUldbwkAQvCAqsSBoABE7asSOBRUVVBQNNuy9996789+9cMFAMHnVebmdm+/bmdtbQv4dOFOW2UjPzgFyLfo6nweKfIMOBYWwFtmMPGz2Yj2pJI0JDq3udJW6VVbmKa9I192VQFV1ktXUAl5NB0cd4KpnORqsEO2ZIRpF9gJfE9Dckqq0KuZt7UAH5+8EPF3spjsRpCeQNO/tA/qDwIDA+OCQbBoKA8NOdjMySgcZGVM6jwcgRuUiSs0nlPFNSrEpJfU0jTLD6llqbvKxei7OzvkFNQohi0vAsj81+MoqsCaoPOQFgus/1LyxichW+hS2JWCHZ7VlF9jb187pIAYcHiViHAMnp5mTjJ8B5xeEXF4B1ze/fTh/C0h398DDI9HB07O8ci+vRBdvdGnfP4gBuM8vw7X/G3wDmFhFZEdxzjMAAAAldEVYdGRhdGU6Y3JlYXRlADIwMTgtMDEtMjZUMDc6NTY6MjUrMDE6MDA67pVWAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDE4LTAxLTI2VDA3OjU2OjI1KzAxOjAwS7Mt6gAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAAWdEVYdFRpdGxlAGp1ZWppbl9sb2dvIGNvcHlxapmKAAAAV3pUWHRSYXcgcHJvZmlsZSB0eXBlIGlwdGMAAHic4/IMCHFWKCjKT8vMSeVSAAMjCy5jCxMjE0uTFAMTIESANMNkAyOzVCDL2NTIxMzEHMQHy4BIoEouAOoXEXTyQjWVAAAAAElFTkSuQmCC)}.markdown-body h2{position:relative;font-size:20px;border-left:4px solid;padding:0 0 0 10px;margin:30px 0}.markdown-body h3{font-size:16px}.markdown-body ul{list-style:disc outside;margin-left:2em;margin-top:1em}.markdown-body li{line-height:2;color:#595959}.markdown-body img.loaded{margin:0 auto;display:block}.markdown-body blockquote{background:#fff9f9;margin:2em 0;padding:2px 20px;border-left:4px solid #b2aec5}.markdown-body blockquote p{color:#666;line-height:2}.markdown-body a{color:#036aca;border-bottom:1px solid rgba(3,106,202,.8);font-weight:400;text-decoration:none}.markdown-body em strong,.markdown-body strong{color:#036aca}.markdown-body hr{border-top:1px solid #135ce0}.markdown-body pre{overflow:auto}.markdown-body code,.markdown-body pre{overflow:auto;position:relative;line-height:1.75;font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body table{border-collapse:collapse;margin:1rem 0;overflow-x:auto}.markdown-body table td,.markdown-body table th{border:1px solid #dfe2e5;padding:.6em 1em}.markdown-body table tr{border-top:1px solid #dfe2e5}.markdown-body table tr:nth-child(2n){background-color:#f6f8fa}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0"><strong>ç¬¬ 22 é¢˜ï¼šTeleport çš„ä½œç”¨ã€åŸç†å’Œä½¿ç”¨åœºæ™¯</strong></h2>
<hr/>
<h2 data-id="heading-1">ğŸ¯ ä¸€ã€Teleport æ˜¯ä»€ä¹ˆï¼Ÿ</h2>
<blockquote>
<p><strong>Teleport æ˜¯ Vue3 æ–°å¢çš„å†…ç½®ç»„ä»¶ï¼Œç”¨äºå°†ç»„ä»¶çš„ DOM ç»“æ„â€œä¼ é€â€åˆ°æŒ‡å®šçš„ DOM èŠ‚ç‚¹ï¼Œä½†ä¿ç•™å…¶å“åº”å¼å’Œç»„ä»¶é€»è¾‘ã€‚</strong></p>
</blockquote>
<p>ç®€å•è¯´ï¼š</p>
<ul>
<li>æ¸²æŸ“åœ¨åˆ«å¤„</li>
<li>æ•°æ®ä½œç”¨åŸŸä¸å˜</li>
<li>é€»è¾‘ä¾ç„¶å±äºå½“å‰ç»„ä»¶</li>
</ul>
<hr/>
<h2 data-id="heading-2">ğŸ¯ äºŒã€Teleport çš„è¯­æ³•</h2>
<pre><code class="hljs language-ini" lang="ini">&lt;teleport <span class="hljs-attr">to</span>=<span class="hljs-string">"body"</span>&gt;
  &lt;div <span class="hljs-attr">class</span>=<span class="hljs-string">"dialog"</span>&gt;æˆ‘æ˜¯å¼¹çª—&lt;/div&gt;
&lt;/teleport&gt;
</code></pre>
<p><code>to=""</code> æŒ‡å®šç›®æ ‡å®¹å™¨ï¼Œå¿…é¡»æ˜¯æœ‰æ•ˆçš„ CSS é€‰æ‹©å™¨ã€‚</p>
<hr/>
<h2 data-id="heading-3">ğŸ¯ ä¸‰ã€è§£å†³äº†ä»€ä¹ˆé—®é¢˜ï¼Ÿ</h2>
<p>åœ¨ Vue2 ä¸­ï¼ŒDialog / Tooltip / Drawer ç­‰ç»„ä»¶å­˜åœ¨é—®é¢˜ï¼š</p>
<ul>
<li>åµŒå¥—å±‚çº§æ·± â†’ z-index éš¾ä»¥æ§åˆ¶</li>
<li>CSS overflow: hidden å¯¼è‡´å¼¹å±‚æ˜¾ç¤ºå¼‚å¸¸</li>
<li>çˆ¶å…ƒç´  transform å¯¼è‡´å®šä½å¤±çœŸ</li>
</ul>
<p><strong>Teleport å®Œç¾è§£å†³ï¼š</strong></p>
<ul>
<li>ä½ å†™åœ¨ä»»ä½•åœ°æ–¹</li>
<li>æœ€ç»ˆéƒ½æ¸²æŸ“åˆ° <code>body</code> ä¸‹</li>
<li>é¿å… overflowã€z-indexã€å®šä½é—®é¢˜</li>
</ul>
<hr/>
<h2 data-id="heading-4">ğŸ¯ å››ã€Teleport çš„åŸç†ï¼ˆé¢è¯•é«˜é¢‘ï¼‰</h2>
<blockquote>
<p><strong>Teleport æ˜¯é€šè¿‡è‡ªå®šä¹‰æ¸²æŸ“å™¨ï¼Œå°†å­ç»„ä»¶çš„ VNode æ¸²æŸ“åˆ°æŒ‡å®šå®¹å™¨ï¼ŒåŒæ—¶ä¿æŒç»„ä»¶å®ä¾‹ä¸å˜ã€‚</strong></p>
</blockquote>
<p>åŸç†æµç¨‹ï¼š</p>
<ol>
<li>è¯»å– <code>&lt;teleport to="xxx"&gt;</code></li>
<li>è·å–ç›®æ ‡ DOMï¼ˆå¦‚ document.bodyï¼‰</li>
<li>åˆ›å»ºè™šæ‹ŸèŠ‚ç‚¹ï¼ˆVNodeï¼‰</li>
<li>å°†å­ç»„ä»¶ VNode æ¸²æŸ“åˆ°ç›®æ ‡å®¹å™¨</li>
<li>ä¾ç„¶ä¿æŒå½“å‰ç»„ä»¶ä¸Šä¸‹æ–‡ã€å“åº”å¼ã€äº‹ä»¶ç»‘å®š</li>
</ol>
<p>æ ¸å¿ƒç‚¹ï¼š</p>
<ul>
<li><strong>é€»è¾‘ä½œç”¨åŸŸä¸å˜ï¼ˆç»„ä»¶å±äºåŸæ¥çˆ¶ç»„ä»¶ï¼‰</strong></li>
<li><strong>DOM æ¸²æŸ“ä½ç½®æ”¹å˜ï¼ˆæ¸²æŸ“åˆ° body ç­‰å¤„ï¼‰</strong></li>
</ul>
<hr/>
<h2 data-id="heading-5">ğŸ¯ äº”ã€Teleport ä¸­çš„æ•°æ®ä¾ç„¶å“åº”å¼å—ï¼Ÿ</h2>
<p><strong>æ˜¯çš„ï¼Œ100% å“åº”å¼ã€‚</strong></p>
<p>æ— è®ºæ¸²æŸ“åˆ° body è¿˜æ˜¯å…¶ä»–å®¹å™¨ï¼š</p>
<ul>
<li>æ•°æ®æ¥è‡ªçˆ¶ç»„ä»¶</li>
<li>æ›´æ–°ä»è§¦å‘é‡æ–°æ¸²æŸ“</li>
<li>ç”Ÿå‘½å‘¨æœŸæ­£å¸¸æ‰§è¡Œ</li>
</ul>
<p>å› ä¸ºï¼š</p>
<blockquote>
<p>Teleport åªæ˜¯æ”¹å˜â€œæ¸²æŸ“ä½ç½®â€ï¼Œä¸ä¼šæ”¹å˜ç»„ä»¶çš„å“åº”å¼æ ‘ç»“æ„ã€‚</p>
</blockquote>
<hr/>
<h2 data-id="heading-6">ğŸ¯ å…­ã€ä½¿ç”¨åœºæ™¯ï¼ˆé¢è¯•å¸¸é—®ï¼‰</h2>
<h4 data-id="heading-7"><strong>1. å¼¹çª—ï¼ˆModalï¼‰</strong></h4>
<pre><code class="hljs language-ini" lang="ini">&lt;teleport <span class="hljs-attr">to</span>=<span class="hljs-string">"body"</span>&gt;
  &lt;Dialog <span class="hljs-attr">v-if</span>=<span class="hljs-string">"visible"</span>&gt;
&lt;/teleport&gt;
</code></pre>
<h4 data-id="heading-8"><strong>2. Tooltip / Popover</strong></h4>
<p>é¿å…è¢«çˆ¶èŠ‚ç‚¹ overflow hidden è£å‰ªã€‚</p>
<h4 data-id="heading-9"><strong>3. Drawer / ActionSheet</strong></h4>
<p>éœ€è¦åœ¨æœ€é¡¶å±‚å±•ç¤ºã€‚</p>
<h4 data-id="heading-10"><strong>4. å…¨å±€ Loadingã€æ¶ˆæ¯ç»„ä»¶</strong></h4>
<p>ElementPlus çš„ ElMessage æœ¬è´¨ä¹Ÿæ˜¯ teleport æœºåˆ¶ã€‚</p>
<hr/>
<h2 data-id="heading-11">ğŸ¯ ä¸ƒã€å¸¸è§æ³¨æ„ç‚¹ï¼ˆé¢è¯•å®˜ä¼šé—®ï¼‰</h2>
<hr/>
<h4 data-id="heading-12"><strong>âš ï¸ æ³¨æ„ç‚¹ 1ï¼š<code>to=""</code> çš„ç›®æ ‡å…ƒç´ å¿…é¡»å­˜åœ¨</strong></h4>
<p>å¦‚æœï¼š</p>
<pre><code class="hljs language-ini" lang="ini">&lt;teleport <span class="hljs-attr">to</span>=<span class="hljs-string">"#abc"</span>&gt;...&lt;/teleport&gt;
</code></pre>
<p>ä½†é¡µé¢æ²¡æœ‰ <code>#abc</code> èŠ‚ç‚¹ï¼š</p>
<p>â†’ Vue ä¼šè­¦å‘Šï¼Œä½†ä»ç„¶ä¿ç•™å†…å®¹åœ¨åŸè¢«æŒ‚è½½å¤„ã€‚</p>
<hr/>
<h4 data-id="heading-13"><strong>âš ï¸ æ³¨æ„ç‚¹ 2ï¼šå¤šä¸ª Teleport æ¸²æŸ“åˆ°åŒä¸€ä½ç½®ï¼Ÿ</strong></h4>
<p>å¯ä»¥ï¼Œä¼šä¾æ¬¡ appendï¼Œä¸ä¼šå†²çªã€‚</p>
<hr/>
<h4 data-id="heading-14"><strong>âš ï¸ æ³¨æ„ç‚¹ 3ï¼šv-if / v-show å¯¹ teleport æœ‰ä½•å·®å¼‚ï¼Ÿ</strong></h4>
<ul>
<li><code>v-if</code>ï¼šåˆ›å»º / é”€æ¯ DOM</li>
<li><code>v-show</code>ï¼šä»…åˆ‡æ¢ displayï¼Œä¸ç§»åŠ¨ DOM</li>
</ul>
<p>Teleport ä»ç„¶éµå®ˆè¿™äº›è¡Œä¸ºã€‚</p>
<hr/>
<h2 data-id="heading-15">ğŸ¯ å…«ã€é¢è¯•å®˜å¸¸è§è¿½é—®ï¼ˆé™„æ ‡å‡†ç­”æ¡ˆï¼‰</h2>
<hr/>
<h3 data-id="heading-16"><strong>è¿½é—® 1ï¼šTeleport çš„å†…å®¹è¿è¡Œå±äºè°çš„ä½œç”¨åŸŸï¼Ÿ</strong></h3>
<p><strong>ç­”ï¼šå±äºçˆ¶ç»„ä»¶ä½œç”¨åŸŸã€‚</strong><br/>
æ¸²æŸ“ä½ç½®æ”¹å˜ï¼Œä½†æ‰§è¡Œä¸Šä¸‹æ–‡æ²¡å˜ã€‚</p>
<hr/>
<h3 data-id="heading-17"><strong>è¿½é—® 2ï¼šTeleport å’Œ Portal æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</strong></h3>
<p>Vue Teleport = React Portal<br/>
éƒ½æ˜¯ UI å±‚çš„ DOM æ¸²æŸ“è¿ç§»ï¼Œæœ¬è´¨ä¸€è‡´ã€‚</p>
<hr/>
<h3 data-id="heading-18"><strong>è¿½é—® 3ï¼šTeleport ä»€ä¹ˆæ—¶å€™ç”¨ï¼Ÿä¸ç”¨æ˜¯å¦å¯ä»¥ï¼Ÿ</strong></h3>
<p>å¼¹çª—ã€æ°”æ³¡ã€èœå•ç»„ä»¶å¿…é¡»ç”¨ï¼Œå¦åˆ™ï¼š</p>
<ul>
<li>z-index æ··ä¹±</li>
<li>overflow æˆªæ–­</li>
<li>å®šä½ä¸å‡†</li>
</ul>
<p>æ™®é€šå®¹å™¨ä¸éœ€è¦ Teleportã€‚</p>
<hr/>
<h3 data-id="heading-19"><strong>è¿½é—® 4ï¼šTeleport ä¼šå½±å“ç»„ä»¶ç”Ÿå‘½å‘¨æœŸå—ï¼Ÿ</strong></h3>
<p>ä¸ä¼šã€‚<br/>
ç”Ÿå‘½å‘¨æœŸé¡ºåºä¸å˜ï¼š</p>
<ul>
<li>onMounted åœ¨ Teleport å®Œæˆæ¸²æŸ“åæ‰§è¡Œ</li>
<li>onUnmounted åœ¨èŠ‚ç‚¹é”€æ¯æ—¶æ‰§è¡Œ</li>
</ul>
<p>åªç§»åŠ¨ DOMï¼Œä¸æ”¹å˜ç»„ä»¶çš„æŒ‚è½½é€»è¾‘ã€‚</p>
<hr/>
<h2 data-id="heading-20">ğŸ¯ ä¹ã€ä¸€å¥è¯æ€»ç»“</h2>
<blockquote>
<p>Teleport æ”¹å˜çš„æ˜¯ DOM æ¸²æŸ“ä½ç½®ï¼Œä¸æ”¹å˜ç»„ä»¶é€»è¾‘ï¼Œæ˜¯å‰ç«¯ UI ç»„ä»¶åº“ä¸­å®ç°å¼¹å±‚çš„æ ¸å¿ƒèƒ½åŠ›ã€‚</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ã€vueé«˜é¢‘é¢è¯•é¢˜ã€‘ç¬¬ 23 é¢˜ï¼šVue3 è‡ªå®šä¹‰æŒ‡ä»¤ï¼ˆdirectiveï¼‰å®Œæ•´è§£æ]]></title>    <link>https://juejin.cn/post/7579213860571283510</link>    <guid>https://juejin.cn/post/7579213860571283510</guid>    <pubDate>2025-12-03T04:43:23.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7579213860571283510" data-draft-id="7579186764046172201" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ã€vueé«˜é¢‘é¢è¯•é¢˜ã€‘ç¬¬ 23 é¢˜ï¼šVue3 è‡ªå®šä¹‰æŒ‡ä»¤ï¼ˆdirectiveï¼‰å®Œæ•´è§£æ"/> <meta itemprop="keywords" content="å‰ç«¯,é¢è¯•"/> <meta itemprop="datePublished" content="2025-12-03T04:43:23.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å‰ç«¯ä¸€è¯¾"/> <meta itemprop="url" content="https://juejin.cn/user/1169536102963917"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ã€vueé«˜é¢‘é¢è¯•é¢˜ã€‘ç¬¬ 23 é¢˜ï¼šVue3 è‡ªå®šä¹‰æŒ‡ä»¤ï¼ˆdirectiveï¼‰å®Œæ•´è§£æ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1169536102963917/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å‰ç«¯ä¸€è¯¾
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-03T04:43:23.000Z" title="Wed Dec 03 2025 04:43:23 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-03
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»3åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0"><strong>ç¬¬ 23 é¢˜ï¼šVue3 è‡ªå®šä¹‰æŒ‡ä»¤ï¼ˆdirectiveï¼‰å®Œæ•´è§£æ</strong></h2>
<hr/>
<h2 data-id="heading-1">ğŸ¯ ä¸€ã€ä»€ä¹ˆæ˜¯è‡ªå®šä¹‰æŒ‡ä»¤ï¼Ÿ</h2>
<blockquote>
<p>è‡ªå®šä¹‰æŒ‡ä»¤ç”¨äºåœ¨<strong>DOM å±‚</strong>å°è£…å¯å¤ç”¨çš„é€»è¾‘ï¼Œ<br/>
é€‚åˆå¤„ç†ï¼š<strong>èšç„¦ã€æ‡’åŠ è½½ã€æƒé™ã€æ‹–æ‹½ã€å›ºå®šå¸é¡¶ã€é•¿æŒ‰</strong> ç­‰åœºæ™¯ã€‚</p>
</blockquote>
<p>Vue æä¾›ä¸¤ä¸ªå±‚çº§ï¼š</p>
<ul>
<li><strong>å…¨å±€æŒ‡ä»¤</strong>ï¼ˆapp.directiveï¼‰</li>
<li><strong>ç»„ä»¶å±€éƒ¨æŒ‡ä»¤</strong>ï¼ˆdirectives: { xxx }ï¼‰</li>
</ul>
<p>ç”¨é€”ä¸ç»„ä»¶ä¸åŒï¼š</p>
<ul>
<li><strong>ç»„ä»¶</strong> â†’ å¤„ç† UI å’Œä¸šåŠ¡é€»è¾‘</li>
<li><strong>æŒ‡ä»¤</strong> â†’ åªè´Ÿè´£ DOM æ“ä½œ</li>
</ul>
<hr/>
<h2 data-id="heading-2">ğŸ¯ äºŒã€Vue3 è‡ªå®šä¹‰æŒ‡ä»¤ç”Ÿå‘½å‘¨æœŸï¼ˆé‡ç‚¹ï¼‰</h2>
<p>Vue3 ä¸­æŒ‡ä»¤å…±æœ‰ 5 ä¸ªé’©å­ï¼š</p>
<ol>
<li><strong>created(el, binding)</strong></li>
<li><strong>beforeMount</strong></li>
<li><strong>mounted</strong></li>
<li><strong>beforeUpdate</strong></li>
<li><strong>updated</strong></li>
<li><strong>beforeUnmount</strong></li>
<li><strong>unmounted</strong></li>
</ol>
<p>æœ€å¸¸ç”¨ï¼š<code>mounted</code> å’Œ <code>updated</code>ã€‚</p>
<hr/>
<h2 data-id="heading-3">ğŸ¯ ä¸‰ã€æœ€ç®€å•ç¤ºä¾‹ï¼šv-focusï¼ˆè¾“å…¥æ¡†è‡ªåŠ¨èšç„¦ï¼‰</h2>
<h3 data-id="heading-4"><strong>å±€éƒ¨æŒ‡ä»¤</strong></h3>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">v-focus</span> /&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {
  <span class="hljs-attr">directives</span>: {
    <span class="hljs-attr">focus</span>: {
      <span class="hljs-title function_">mounted</span>(<span class="hljs-params">el</span>) {
        el.<span class="hljs-title function_">focus</span>()
      }
    }
  }
}
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
</code></pre>
<hr/>
<h2 data-id="heading-5">ğŸ¯ å››ã€Vue3 è‡ªå®šä¹‰æŒ‡ä»¤åŸç†ï¼ˆé«˜é¢‘é¢è¯•ç‚¹ï¼‰</h2>
<blockquote>
<p>Vue åœ¨ç¼–è¯‘æ¨¡æ¿æ—¶ï¼Œä¼šå°†æ‰€æœ‰æŒ‡ä»¤è§£æä¸º <strong>æŒ‡ä»¤å¯¹è±¡</strong>ï¼Œåœ¨æ¸²æŸ“ DOM æ—¶è°ƒç”¨ç›¸åº”çš„æŒ‡ä»¤é’©å­ï¼Œå¯¹ DOM è¿›è¡Œå¢å¼ºã€‚</p>
</blockquote>
<p>æ‰§è¡Œæµç¨‹ï¼š</p>
<ol>
<li>æ¨¡æ¿ç¼–è¯‘æˆ VNode æ—¶æŒ‡ä»¤ä¿¡æ¯ä¼šè¢«è®°å½•</li>
<li>æ¸²æŸ“æ—¶è°ƒç”¨ <code>mounted(el, binding)</code></li>
<li>æ›´æ–°æ—¶è°ƒç”¨ <code>updated(el, binding)</code></li>
<li>é”€æ¯æ—¶è°ƒç”¨ <code>unmounted(el)</code></li>
</ol>
<p>æœ¬è´¨æ˜¯ï¼š</p>
<p><strong>VNode ç”Ÿå‘½å‘¨æœŸ + æŒ‡ä»¤é’©å­ = DOM å¢å¼º</strong></p>
<hr/>
<h2 data-id="heading-6">ğŸ¯ äº”ã€å¸¸è§æŒ‡ä»¤é¢è¯•æ¡ˆä¾‹ï¼ˆé‡è¦ï¼‰</h2>
<h4 data-id="heading-7"><strong>1ï¸âƒ£ å›¾ç‰‡æ‡’åŠ è½½ v-lazy</strong></h4>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-built_in">mounted</span>(el, binding) {
  const observer = new <span class="hljs-built_in">IntersectionObserver</span>(([entry]) =&gt; {
    if (entry.isIntersecting) {
      el<span class="hljs-selector-class">.src</span> = binding<span class="hljs-selector-class">.value</span>
      observer<span class="hljs-selector-class">.unobserve</span>(el)
    }
  })
  observer<span class="hljs-selector-class">.observe</span>(el)
}
</code></pre>
<blockquote>
<p>æŠ€æœ¯ç‚¹ï¼šä½¿ç”¨ IntersectionObserver ç›‘å¬æ˜¯å¦è¿›å…¥è§†å£ã€‚</p>
</blockquote>
<hr/>
<h4 data-id="heading-8"><strong>2ï¸âƒ£ æƒé™æŒ‡ä»¤ v-permission</strong></h4>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-built_in">mounted</span>(el, binding) {
  const userRoles = store<span class="hljs-selector-class">.state</span><span class="hljs-selector-class">.user</span><span class="hljs-selector-class">.roles</span>
  if (!userRoles.includes(binding.value)) {
    el<span class="hljs-selector-class">.remove</span>() <span class="hljs-comment">// æ— æƒé™åˆ™ç§»é™¤èŠ‚ç‚¹</span>
  }
}
</code></pre>
<blockquote>
<p>å¾ˆå¤šåå°ç³»ç»Ÿéƒ½ä¼šé—®è¿™ä¸ªã€‚</p>
</blockquote>
<hr/>
<h4 data-id="heading-9"><strong>3ï¸âƒ£ é•¿æŒ‰æŒ‡ä»¤ v-longpress</strong></h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-title function_">mounted</span>(<span class="hljs-params">el, binding</span>) {
  <span class="hljs-keyword">let</span> timer
  el.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">"mousedown"</span>, <span class="hljs-function">() =&gt;</span> {
    timer = <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> binding.<span class="hljs-title function_">value</span>(), <span class="hljs-number">500</span>)
  })
  el.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">"mouseup"</span>, <span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">clearTimeout</span>(timer))
}
</code></pre>
<hr/>
<h2 data-id="heading-10">ğŸ¯ å…­ã€binding å‚æ•°ï¼ˆé¢è¯•å¿…é—®ï¼‰</h2>
<p><code>binding</code> åŒ…å«ï¼š</p>
<pre><code class="hljs language-arduino" lang="arduino">binding = {
  instance,           <span class="hljs-comment">// ç»„ä»¶å®ä¾‹</span>
  value,              <span class="hljs-comment">// ä¼ å…¥çš„å€¼</span>
  oldValue,           <span class="hljs-comment">// æ—§å€¼</span>
  arg,                <span class="hljs-comment">// æŒ‡ä»¤å‚æ•°</span>
  modifiers           <span class="hljs-comment">// ä¿®é¥°ç¬¦</span>
}
</code></pre>
<p>ç”¨æ³•ç¤ºä¾‹ï¼š</p>
<pre><code class="hljs language-ini" lang="ini">&lt;div v-demo:<span class="hljs-attr">color.red</span>=<span class="hljs-string">"msg"</span>&gt;&lt;/div&gt;
</code></pre>
<p>è§£æï¼š</p>
<ul>
<li><code>arg = 'color'</code></li>
<li><code>modifiers = { red: true }</code></li>
<li><code>value = msg</code></li>
</ul>
<hr/>
<h2 data-id="heading-11">ğŸ¯ ä¸ƒã€å…³é”®çŸ¥è¯†ç‚¹ - ä»€ä¹ˆæ—¶å€™ç”¨æŒ‡ä»¤ï¼Ÿä»€ä¹ˆæ—¶å€™ç”¨ç»„ä»¶ï¼Ÿ</h2>

























<table><thead><tr><th>ç”¨ç»„ä»¶ï¼Ÿ</th><th>ç”¨æŒ‡ä»¤ï¼Ÿ</th></tr></thead><tbody><tr><td>æœ‰ UI å’Œæ¨¡æ¿ç»“æ„</td><td>ä¸éœ€è¦æ¨¡æ¿ç»“æ„</td></tr><tr><td>éœ€è¦é€»è¾‘å¤ç”¨ + DOM</td><td>åªéœ€è¦å°è£… DOM æ“ä½œ</td></tr><tr><td>æœ‰çŠ¶æ€</td><td>æ— çŠ¶æ€é€»è¾‘ï¼ˆçº¯ DOMï¼‰</td></tr><tr><td>é€‚åˆå…¨å±€ç»„ä»¶åº“</td><td>é€‚åˆæƒé™ã€æ‡’åŠ è½½ã€æ‹–æ‹½</td></tr></tbody></table>
<p>ä¸€å¥è¯ï¼š</p>
<blockquote>
<p><strong>åªè¦æ˜¯â€œDOM è¡Œä¸ºâ€ï¼Œå°½é‡ç”¨æŒ‡ä»¤ï¼›<br/>
æ•°æ®é€»è¾‘ + UI å°±åº”è¯¥ç”¨ç»„ä»¶ã€‚</strong></p>
</blockquote>
<hr/>
<h2 data-id="heading-12">ğŸ¯ å…«ã€é¢è¯•å®˜å¸¸é—®è¿½é—®ï¼ˆé™„æœ€ä½³ç­”æ¡ˆï¼‰</h2>
<hr/>
<h4 data-id="heading-13"><strong>è¿½é—® 1ï¼šVue3 çš„æŒ‡ä»¤å’Œ Vue2 æœ‰å“ªäº›ä¸åŒï¼Ÿ</strong></h4>
<p><strong>ç­”ï¼š</strong></p>
<ul>
<li>Vue3 å»æ‰äº† <code>bind</code> å’Œ <code>inserted</code></li>
<li>æ–°å¢äº† <code>created</code>ã€<code>beforeMount</code></li>
<li>ç”Ÿå‘½å‘¨æœŸæ›´åŠ ç»Ÿä¸€</li>
<li>binding.instance æ›¿ä»£ vnode.component</li>
</ul>
<hr/>
<h4 data-id="heading-14"><strong>è¿½é—® 2ï¼šæŒ‡ä»¤èƒ½åœ¨ setup ä¸­ä½¿ç”¨å—ï¼Ÿ</strong></h4>
<p>ä¸èƒ½ç›´æ¥åœ¨ setup return ä¸­æ³¨å†Œï¼Œä½†å¯ä»¥å†™æˆä¸€ä¸ªå¯¹è±¡ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> vFocus = {
  <span class="hljs-title function_">mounted</span>(<span class="hljs-params">el</span>) { el.<span class="hljs-title function_">focus</span>() }
}

<span class="hljs-keyword">return</span> { vFocus }
</code></pre>
<hr/>
<h4 data-id="heading-15"><strong>è¿½é—® 3ï¼šæŒ‡ä»¤å’Œ watch å“ªä¸ªæ€§èƒ½æ›´å¥½ï¼Ÿ</strong></h4>
<p>ä½¿ç”¨æŒ‡ä»¤ï¼Œå› ä¸ºï¼š</p>
<ul>
<li>watch ä¼šè§¦å‘è®¡ç®—</li>
<li>æŒ‡ä»¤åªåœ¨ DOM å±‚æ“ä½œï¼Œä¸ä¾èµ–å“åº”å¼ç³»ç»Ÿ</li>
<li>æ€§èƒ½æ›´é«˜</li>
</ul>
<hr/>
<h4 data-id="heading-16"><strong>è¿½é—® 4ï¼šæŒ‡ä»¤èƒ½å¦è®¿é—®ç»„ä»¶å†…éƒ¨å˜é‡ï¼Ÿ</strong></h4>
<p>å¯ä»¥ï¼Œé€šè¿‡ <code>binding.instance</code></p>
<pre><code class="hljs">binding.instance.xxx
</code></pre>
<hr/>
<h2 data-id="heading-17">ğŸ¯ ä¹ã€ä¸€å¥è¯æ€»ç»“</h2>
<blockquote>
<p>Vue3 è‡ªå®šä¹‰æŒ‡ä»¤æ˜¯æ“ä½œ DOM çš„åˆ©å™¨ï¼Œä¸å‚ä¸ç»„ä»¶é€»è¾‘ï¼Œæ‹¥æœ‰ç‹¬ç«‹ç”Ÿå‘½å‘¨æœŸï¼Œå¸¸ç”¨äºæ‡’åŠ è½½ã€æƒé™ã€æ‹–æ‹½ã€èšç„¦ç­‰åœºæ™¯ã€‚</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ç¬¬ 24 é¢˜ï¼šVue3 çš„ç»„ä»¶é€šä¿¡æ–¹å¼ï¼ˆprops / emit / v-model / provide-inject / expose / eventBus]]></title>    <link>https://juejin.cn/post/7579229538791178246</link>    <guid>https://juejin.cn/post/7579229538791178246</guid>    <pubDate>2025-12-03T04:44:48.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7579229538791178246" data-draft-id="7579229538791161862" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ç¬¬ 24 é¢˜ï¼šVue3 çš„ç»„ä»¶é€šä¿¡æ–¹å¼ï¼ˆprops / emit / v-model / provide-inject / expose / eventBus "/> <meta itemprop="keywords" content="å‰ç«¯,é¢è¯•"/> <meta itemprop="datePublished" content="2025-12-03T04:44:48.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å‰ç«¯ä¸€è¯¾"/> <meta itemprop="url" content="https://juejin.cn/user/1169536102963917"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ç¬¬ 24 é¢˜ï¼šVue3 çš„ç»„ä»¶é€šä¿¡æ–¹å¼ï¼ˆprops / emit / v-model / provide-inject / expose / eventBus 
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1169536102963917/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å‰ç«¯ä¸€è¯¾
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-03T04:44:48.000Z" title="Wed Dec 03 2025 04:44:48 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-03
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»3åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0"><strong>ç¬¬ 24 é¢˜ï¼šVue3 çš„ç»„ä»¶é€šä¿¡æ–¹å¼ï¼ˆprops / emit / v-model / provide-inject / expose / eventBus / storeï¼‰</strong></h2>
<hr/>
<h2 data-id="heading-1">ğŸ¯ ä¸€ã€Vue3 ç»„ä»¶é€šä¿¡æ–¹å¼æ€»ç»“è¡¨ï¼ˆå¯èƒŒï¼‰</h2>





















































<table><thead><tr><th>é€šä¿¡æ–¹å¼</th><th>æ–¹å‘</th><th>é€‚ç”¨åœºæ™¯</th><th>æ˜¯å¦å“åº”å¼</th></tr></thead><tbody><tr><td><strong>props</strong></td><td>çˆ¶ â†’ å­</td><td>ä¼ å€¼ã€é…ç½®</td><td>âœ…</td></tr><tr><td><strong>emit</strong></td><td>å­ â†’ çˆ¶</td><td>é€šçŸ¥äº‹ä»¶ã€è¿”å›æ•°æ®</td><td>N/Aï¼ˆäº‹ä»¶ï¼‰</td></tr><tr><td><strong>v-model</strong></td><td>åŒå‘ï¼ˆçˆ¶ â†” å­ï¼‰</td><td>è¡¨å• / åŒå‘ç»‘å®šç»„ä»¶</td><td>âœ…</td></tr><tr><td><strong>provide / inject</strong></td><td>ç¥–å…ˆ â†’ åä»£</td><td>è·¨å±‚çº§é€šä¿¡ã€é€šç”¨ç»„ä»¶</td><td>é»˜è®¤éå“åº”å¼ï¼ˆå¯ç”¨ refï¼‰</td></tr><tr><td><strong>expose</strong></td><td>å­ â†’ çˆ¶ï¼ˆå®ä¾‹ APIï¼‰</td><td>æš´éœ²å†…éƒ¨æ–¹æ³•ä¾›çˆ¶è°ƒç”¨</td><td>N/A</td></tr><tr><td><strong>EventBus</strong></td><td>ä»»æ„ â†” ä»»æ„</td><td>å°å‹é¡¹ç›®çš„å…¨å±€äº‹ä»¶</td><td>ä¾èµ–å®ç°</td></tr><tr><td><strong>Pinia / Vuex</strong></td><td>å…¨å±€å…±äº«</td><td>å¤§å‹é¡¹ç›®ã€å¤æ‚ä¸šåŠ¡</td><td>âœ… å¼ºå“åº”å¼</td></tr></tbody></table>
<hr/>
<h2 data-id="heading-2">ğŸ¯ äºŒã€å„é€šä¿¡æ–¹å¼è¯¦è§£</h2>
<hr/>
<h2 data-id="heading-3">1ï¸âƒ£ <strong>Propsï¼šçˆ¶ â†’ å­ï¼ˆæœ€æ ¸å¿ƒé€šä¿¡æ–¹å¼ï¼‰</strong></h2>
<h4 data-id="heading-4"><strong>ç¤ºä¾‹</strong></h4>
<pre><code class="hljs language-ini" lang="ini">&lt;Child :<span class="hljs-attr">msg</span>=<span class="hljs-string">"parentMsg"</span> /&gt;
</code></pre>
<p><strong>å­ç»„ä»¶</strong></p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-built_in">defineProps</span>({
  msg: String
})
</code></pre>
<h4 data-id="heading-5">é€‚ç”¨åœºæ™¯</h4>
<ul>
<li>çˆ¶ç»„ä»¶ä¼ å€¼ç»™å­ç»„ä»¶</li>
<li>è¡¨å•é¡¹ã€é…ç½®é¡¹ã€åˆå§‹åŒ–æ•°æ®</li>
</ul>
<h4 data-id="heading-6">åŸç†</h4>
<blockquote>
<p>ç¼–è¯‘æ¨¡æ¿æ—¶ï¼Œprops å˜æˆç»„ä»¶çš„å±æ€§ï¼Œæœ€ç»ˆæ˜ å°„åˆ°ç»„ä»¶å®ä¾‹ä¸Šã€‚<br/>
Vue3 å¯¹ props åš shallowReadonlyï¼Œé˜²æ­¢å­ç»„ä»¶ä¿®æ”¹ã€‚</p>
</blockquote>
<hr/>
<h2 data-id="heading-7">2ï¸âƒ£ <strong>Emitï¼šå­ â†’ çˆ¶</strong></h2>
<p>å­ç»„ä»¶ï¼š</p>
<pre><code class="hljs language-scss" lang="scss">const emit = <span class="hljs-built_in">defineEmits</span>(['update'])
<span class="hljs-built_in">emit</span>('update', newVal)
</code></pre>
<p>çˆ¶ç»„ä»¶ï¼š</p>
<pre><code class="hljs language-ini" lang="ini">&lt;Child @<span class="hljs-attr">update</span>=<span class="hljs-string">"handleUpdate"</span> /&gt;
</code></pre>
<p>é€‚åˆï¼šäº‹ä»¶é€šçŸ¥ã€æŒ‰é’®ç‚¹å‡»å›è°ƒç­‰ã€‚</p>
<hr/>
<h2 data-id="heading-8">3ï¸âƒ£ <strong>v-modelï¼ˆåŒå‘é€šä¿¡ï¼‰</strong></h2>
<p>Vue3 æ”¯æŒå¤šä¸ª v-modelï¼š</p>
<p>çˆ¶ï¼š</p>
<pre><code class="hljs language-ini" lang="ini">&lt;Child v-model:<span class="hljs-attr">title</span>=<span class="hljs-string">"name"</span> /&gt;
</code></pre>
<p>å­ï¼š</p>
<pre><code class="hljs language-ini" lang="ini">const <span class="hljs-attr">props</span> = defineProps([<span class="hljs-string">'title'</span>])
const <span class="hljs-attr">emit</span> = defineEmits([<span class="hljs-string">'update:title'</span>])

emit('update:title', newVal)
</code></pre>
<p><strong>æœ¬è´¨ï¼šprops + emit çš„è¯­æ³•ç³–</strong></p>
<hr/>
<h2 data-id="heading-9">4ï¸âƒ£ <strong>provide / injectï¼ˆè·¨å±‚çº§é€šä¿¡ï¼‰</strong></h2>
<p>ç¥–å…ˆç»„ä»¶ï¼š</p>
<pre><code class="hljs language-csharp" lang="csharp">provide(<span class="hljs-string">'theme'</span>, <span class="hljs-keyword">ref</span>(<span class="hljs-string">'dark'</span>))
</code></pre>
<p>åä»£ç»„ä»¶ï¼š</p>
<pre><code class="hljs language-ini" lang="ini">const <span class="hljs-attr">theme</span> = inject(<span class="hljs-string">'theme'</span>)
</code></pre>
<h4 data-id="heading-10">ç‰¹ç‚¹</h4>
<ul>
<li>è·¨å±‚çº§é€šä¿¡ï¼ˆä¸ç”¨ props é€å±‚ä¼ é€’ï¼‰</li>
<li>é»˜è®¤éå“åº”å¼ï¼Œå¦‚éœ€å“åº”å¼å¿…é¡»æä¾› ref/reactive</li>
</ul>
<h4 data-id="heading-11">åŸç†ï¼ˆå¸¸è€ƒï¼‰</h4>
<blockquote>
<p>provide åœ¨ç»„ä»¶åˆ›å»ºæ—¶å†™å…¥ â€œä¾èµ–æ³¨å…¥è¡¨â€ï¼Œ<br/>
inject åœ¨åä»£ç»„ä»¶åˆ›å»ºæ—¶ä»åŸå‹é“¾æŸ¥æ‰¾ä¾èµ–ã€‚</p>
</blockquote>
<hr/>
<h2 data-id="heading-12">5ï¸âƒ£ <strong>exposeï¼ˆå­ç»„ä»¶æš´éœ²æ–¹æ³•ç»™çˆ¶ç»„ä»¶ï¼‰</strong></h2>
<p>Vue3 æ–°å¢çš„ï¼Œéå¸¸å¸¸ç”¨ï¼</p>
<p>å­ç»„ä»¶ï¼š</p>
<pre><code class="hljs language-scss" lang="scss">const count = <span class="hljs-built_in">ref</span>(<span class="hljs-number">0</span>)
function <span class="hljs-built_in">reset</span>() {
  count<span class="hljs-selector-class">.value</span> = <span class="hljs-number">0</span>
}

<span class="hljs-built_in">defineExpose</span>({
  reset
})
</code></pre>
<p>çˆ¶ç»„ä»¶ï¼š</p>
<pre><code class="hljs language-ini" lang="ini">&lt;Child <span class="hljs-attr">ref</span>=<span class="hljs-string">"childRef"</span> /&gt;

childRef.value.reset()
</code></pre>
<p>é€‚ç”¨ï¼šè¡¨å•æ ¡éªŒã€é‡ç½®ã€æ‰“å¼€å¼¹çª—ç­‰ã€‚</p>
<blockquote>
<p>Vue3 é»˜è®¤ setup ä¸­çš„æ–¹æ³•ä¸ä¼šæš´éœ²ç»™çˆ¶ç»„ä»¶ï¼Œå¿…é¡»ç”¨ exposeã€‚</p>
</blockquote>
<hr/>
<h2 data-id="heading-13">6ï¸âƒ£ <strong>EventBusï¼ˆå°é¡¹ç›®ç”¨ï¼Œå…¨å±€äº‹ä»¶é€šä¿¡ï¼‰</strong></h2>
<p>Vue3 æ²¡æœ‰ç›´æ¥æä¾›ï¼Œå¯ä»¥è‡ªå·±ç”¨ mittï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> mitt <span class="hljs-keyword">from</span> <span class="hljs-string">'mitt'</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> bus = <span class="hljs-title function_">mitt</span>()
</code></pre>
<pre><code class="hljs language-csharp" lang="csharp">bus.emit(<span class="hljs-string">'login'</span>, user)
bus.<span class="hljs-keyword">on</span>(<span class="hljs-string">'login'</span>, handler)
</code></pre>
<p>é€‚åˆï¼š</p>
<ul>
<li>éçˆ¶å­ç»„ä»¶é€šä¿¡</li>
<li>ç®€å•çš„å…¨å±€äº‹ä»¶ç³»ç»Ÿ</li>
</ul>
<hr/>
<h2 data-id="heading-14">7ï¸âƒ£ <strong>Piniaï¼ˆå…¨å±€çŠ¶æ€ç®¡ç†ï¼‰</strong></h2>
<pre><code class="hljs language-ini" lang="ini">const <span class="hljs-attr">store</span> = useUserStore()
<span class="hljs-attr">store.name</span> = <span class="hljs-string">'jack'</span>
</code></pre>
<p>æœ€é€‚åˆï¼š</p>
<ul>
<li>å¤§å‹é¡¹ç›®</li>
<li>å…¨å±€å…±äº«æ•°æ®</li>
<li>å¤šç»„ä»¶åŒæ­¥æ›´æ–°</li>
</ul>
<p>Vue3 å®˜æ–¹æ¨è Pinia ä»£æ›¿ Vuexã€‚</p>
<hr/>
<h2 data-id="heading-15">ğŸ¯ ä¸‰ã€é¢è¯•å®˜å¸¸é—®å¯¹æ¯”é¢˜ï¼ˆé«˜é¢‘ï¼‰</h2>
<hr/>
<h3 data-id="heading-16"><strong>â“ 1ï¼šprovide/inject ä¸ props çš„åŒºåˆ«ï¼Ÿ</strong></h3>
<p><strong>é¢è¯•æœ€ä½³ç­”æ¡ˆï¼š</strong></p>
<ul>
<li>props æ˜¯çˆ¶ â†’ å­å•å±‚ä¼ é€’ï¼Œé€‚åˆå¸¸è§„é€šä¿¡</li>
<li>provide/inject æ˜¯è·¨å±‚çº§ä¼ é€’ï¼Œä¸ç”¨æ¯å±‚éƒ½å†™ props</li>
<li>provide é»˜è®¤éå“åº”å¼ï¼Œéœ€è¦ ref æ‰èƒ½å“åº”å¼</li>
<li>props æ˜¯å¼ºçº¦æŸï¼ˆç±»å‹æ ¡éªŒï¼‰ï¼Œinject æ˜¯å¼±çº¦æŸï¼ˆä¸ä¿è¯å­˜åœ¨ï¼‰</li>
</ul>
<hr/>
<h3 data-id="heading-17"><strong>â“ 2ï¼šv-model åŸç†æ˜¯ä»€ä¹ˆï¼Ÿ</strong></h3>
<p>ç­”ï¼š</p>
<blockquote>
<p>Vue3 ä¸­ v-model ç­‰ä»·äº <code>modelValue</code> + <code>update:modelValue</code><br/>
æœ¬è´¨ä»ç„¶æ˜¯çˆ¶ä¼ å€¼ã€å­è§¦å‘æ›´æ–°äº‹ä»¶ã€‚</p>
</blockquote>
<hr/>
<h3 data-id="heading-18"><strong>â“ 3ï¼šexpose ä¸ºä»€ä¹ˆéœ€è¦ï¼Ÿ</strong></h3>
<p>å› ä¸ºï¼š</p>
<ul>
<li>Vue3 çš„ setup éš”ç¦»ä½œç”¨åŸŸï¼Œé»˜è®¤ä¸ä¼šæš´éœ²å†…éƒ¨å®ä¾‹æ–¹æ³•</li>
<li>ä½¿ç”¨ expose å¯ä»¥å†³å®šå“ªäº›æ–¹æ³•å®‰å…¨åœ°å¼€æ”¾ç»™å¤–éƒ¨</li>
</ul>
<hr/>
<h3 data-id="heading-19"><strong>â“ 4ï¼šä¸ºä»€ä¹ˆè¦ç”¨ storeï¼ˆPiniaï¼‰ï¼Ÿä¸èƒ½ç”¨ eventBus å—ï¼Ÿ</strong></h3>
<p><strong>ç®€ç­”ï¼š</strong></p>
<ul>
<li>eventBus æ˜¯äº‹ä»¶é©±åŠ¨ï¼Œä¸é€‚åˆä½œçŠ¶æ€ç®¡ç†</li>
<li>Pinia æ˜¯å“åº”å¼æ•°æ®ç®¡ç†ï¼Œæœ‰ devtoolsã€æœ‰æ¨¡å—åŒ–ã€æœ‰æŒä¹…åŒ–</li>
<li>å¤§é¡¹ç›®å¿…é¡»ç”¨ store</li>
</ul>
<hr/>
<h3 data-id="heading-20"><strong>â“ 5ï¼šprovide / inject ä¸ºä»€ä¹ˆé»˜è®¤ä¸æ˜¯å“åº”å¼ï¼Ÿ</strong></h3>
<p>å› ä¸ºå½“åˆè®¾è®¡å®ƒç”¨äºâ€œé™æ€é…ç½®â€ï¼ˆæ¯”å¦‚ä¸»é¢˜ï¼‰ï¼Œè¦é¿å…ä¸å¿…è¦æ›´æ–°ï¼›</p>
<p>è‹¥éœ€è¦å“åº”å¼ï¼Œéœ€è¦ä¼  ref æˆ– reactiveï¼š</p>
<pre><code class="hljs language-less" lang="less"><span class="hljs-selector-tag">provide</span>(<span class="hljs-string">'theme'</span>, <span class="hljs-built_in">reactive</span>({ <span class="hljs-attribute">mode</span>: <span class="hljs-string">'dark'</span> }))
</code></pre>
<hr/>
<h2 data-id="heading-21">ğŸ¯ å››ã€ä¸€å¥è¯æ€»ç»“</h2>
<blockquote>
<p>Vue3 çš„é€šä¿¡ä½“ç³»åŸºäº props/emit æ„å»ºï¼Œ<br/>
provide/inject è§£å†³è·¨å±‚çº§ä¼ é€’ï¼Œ<br/>
expose è§£å†³å®ä¾‹æš´éœ²ï¼Œ<br/>
store è§£å†³å…¨å±€å…±äº«ï¼Œ<br/>
eventBus è§£å†³ç®€å•äº‹ä»¶åˆ†å‘ã€‚</p>
</blockquote>
<p>æŒæ¡è¿™äº›ï¼Œä½ èƒ½åº”å¯¹æ‰€æœ‰ç»„ä»¶é€šä¿¡åœºæ™¯ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ç¬¬ 25 é¢˜ï¼šè¯´ä¸€ä¸‹ Vue3 çš„ keep-alive åŸç†ï¼Ÿç¼“å­˜æ˜¯æ€ä¹ˆåšçš„ï¼Ÿ]]></title>    <link>https://juejin.cn/post/7579229538791211014</link>    <guid>https://juejin.cn/post/7579229538791211014</guid>    <pubDate>2025-12-03T04:45:39.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7579229538791211014" data-draft-id="7579229538791194630" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ç¬¬ 25 é¢˜ï¼šè¯´ä¸€ä¸‹ Vue3 çš„ keep-alive åŸç†ï¼Ÿç¼“å­˜æ˜¯æ€ä¹ˆåšçš„ï¼Ÿ"/> <meta itemprop="keywords" content="å‰ç«¯,é¢è¯•"/> <meta itemprop="datePublished" content="2025-12-03T04:45:39.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å‰ç«¯ä¸€è¯¾"/> <meta itemprop="url" content="https://juejin.cn/user/1169536102963917"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ç¬¬ 25 é¢˜ï¼šè¯´ä¸€ä¸‹ Vue3 çš„ keep-alive åŸç†ï¼Ÿç¼“å­˜æ˜¯æ€ä¹ˆåšçš„ï¼Ÿ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1169536102963917/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å‰ç«¯ä¸€è¯¾
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-03T04:45:39.000Z" title="Wed Dec 03 2025 04:45:39 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-03
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»2åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0"><strong>ç¬¬ 24 é¢˜ï¼šè¯´ä¸€ä¸‹ Vue3 çš„ keep-alive åŸç†ï¼Ÿç¼“å­˜æ˜¯æ€ä¹ˆåšçš„ï¼Ÿ</strong></h2>
<h3 data-id="heading-1"><strong>ä¸€ã€æ ¸å¿ƒå›ç­”ï¼ˆé¢è¯•æœ€æƒ³å¬çš„ç‰ˆæœ¬ï¼‰</strong></h3>
<p><code>&lt;keep-alive&gt;</code> æ˜¯ Vue3 çš„ä¸€ä¸ªå†…ç½®ç»„ä»¶ï¼Œç”¨æ¥ç¼“å­˜ <strong>ç»„ä»¶çš„å®ä¾‹</strong>ï¼Œé¿å…ç»„ä»¶è¢«é”€æ¯ï¼Œæå‡æ€§èƒ½ã€‚</p>
<p>å…¶åŸç†ï¼š</p>
<ol>
<li>
<p><strong>é¦–æ¬¡æ¸²æŸ“</strong>ï¼šåˆ›å»ºç»„ä»¶å®ä¾‹å¹¶ç¼“å­˜åˆ° <code>cache</code>ï¼ˆMapï¼‰ã€‚</p>
</li>
<li>
<p><strong>å†æ¬¡åˆ‡æ¢å›ç»„ä»¶</strong>ï¼šç›´æ¥ä»ç¼“å­˜é‡Œå–å®ä¾‹ï¼Œä¸ä¼šé‡æ–°æ‰§è¡Œ <code>setup</code>ï¼Œä¸ä¼šé‡æ–°æŒ‚è½½ DOMã€‚</p>
</li>
<li>
<p><strong>å¤±æ´»æ¿€æ´»æœºåˆ¶</strong>ï¼šä¸æ˜¯é”€æ¯ï¼Œè€Œæ˜¯è§¦å‘ï¼š</p>
<ul>
<li><code>onDeactivated</code>ï¼ˆç»„ä»¶å¤±æ´»ï¼‰</li>
<li><code>onActivated</code>ï¼ˆé‡æ–°æ¿€æ´»ï¼‰</li>
</ul>
</li>
<li>
<p><strong>LRU ç­–ç•¥</strong>ï¼ˆåŸºäº max å±æ€§ï¼‰ï¼š</p>
<ul>
<li>ç¼“å­˜è¶…å‡ºæ•°é‡ï¼Œä¼šç§»é™¤æœ€ä¹…æœªè®¿é—®çš„ç»„ä»¶ã€‚</li>
</ul>
</li>
</ol>
<hr/>
<h3 data-id="heading-2"><strong>äºŒã€keep-alive çš„è¯¦ç»†åŸç†ï¼ˆæ·±åº¦ç‰ˆï¼Œè®©é¢è¯•å®˜è§‰å¾—ä½ æ‡‚åº•å±‚ï¼‰</strong></h3>
<h4 data-id="heading-3">ğŸ”¹ <strong>1. keep-alive å†…éƒ¨å®ç°ä¸€ä¸ª Map åšç¼“å­˜</strong></h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> cache = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Map</span>()
</code></pre>
<ul>
<li>keyï¼šç»„ä»¶å”¯ä¸€ IDï¼ˆVNode.typeï¼‰</li>
<li>valueï¼šç»„ä»¶å®ä¾‹ + DOM èŠ‚ç‚¹</li>
</ul>
<hr/>
<h4 data-id="heading-4">ğŸ”¹ <strong>2. æ¸²æŸ“è¿‡ç¨‹</strong></h4>
<p>å½“ keep-alive æ¸²æŸ“ä¸€ä¸ªç»„ä»¶ï¼š</p>
<p><strong>å¦‚æœ cache é‡Œæ²¡æœ‰</strong><br/>
â†’ åˆ›å»ºæ–°çš„ç»„ä»¶å®ä¾‹ â†’ æ¸²æŸ“ â†’ ç¼“å­˜åˆ° cache</p>
<p><strong>å¦‚æœ cache é‡Œå·²ç»æœ‰</strong><br/>
â†’ ç›´æ¥å¤ç”¨ä¹‹å‰ç¼“å­˜çš„å®ä¾‹ï¼ˆVNodeï¼‰ï¼Œè·³è¿‡ç»„ä»¶åˆå§‹åŒ–</p>
<hr/>
<h4 data-id="heading-5">ğŸ”¹ <strong>3. ç¼“å­˜å‘½ä¸­åçš„æ¿€æ´»è¿‡ç¨‹</strong></h4>
<p>å¤ç”¨æ—¶ä¸ä¼šèµ° <code>setup()</code><br/>
åªä¼šè°ƒç”¨ï¼š</p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-built_in">onActivated</span>(() =&gt; {
  <span class="hljs-comment">// DOM è¢«æ’å›æ—¶è§¦å‘</span>
})
</code></pre>
<hr/>
<h4 data-id="heading-6">ğŸ”¹ <strong>4. åˆ‡æ¢è·¯ç”±ç¦»å¼€æ—¶ä¸ä¼šå¸è½½ç»„ä»¶</strong></h4>
<p>ä¸ä¼šæ‰§è¡Œ <code>onUnmounted</code><br/>
æ”¹æˆï¼š</p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-built_in">onDeactivated</span>(() =&gt; {
  <span class="hljs-comment">// DOM è¢«ç§»å‡ºå®¹å™¨æ—¶è§¦å‘</span>
})
</code></pre>
<hr/>
<h4 data-id="heading-7">ğŸ”¹ <strong>5. LRU æœºåˆ¶ï¼ˆmax å±æ€§ï¼‰</strong></h4>
<p>å¦‚æœä½ å†™ï¼š</p>
<pre><code class="hljs language-ini" lang="ini">&lt;keep-alive :<span class="hljs-attr">max</span>=<span class="hljs-string">"2"</span>&gt;
</code></pre>
<p>keep-alive ä¼šï¼š</p>
<ul>
<li>æœ€å¤šç¼“å­˜ 2 ä¸ªç»„ä»¶</li>
<li>è¶…å‡ºæ—¶ä» cache ä¸­åˆ æœ€è€çš„ä¸€ä¸ªï¼ˆLRUï¼‰</li>
</ul>
<p>å®ç°ä¼ªä»£ç ï¼š</p>
<pre><code class="hljs language-scss" lang="scss">if (cache.size &gt; max) {
  const oldestKey = cache<span class="hljs-selector-class">.keys</span>()<span class="hljs-selector-class">.next</span>()<span class="hljs-selector-class">.value</span>
  <span class="hljs-built_in">pruneCacheEntry</span>(oldestKey)
}
</code></pre>
<hr/>
<h3 data-id="heading-8"><strong>ä¸‰ã€å¸¸è§ç”¨æ³•</strong></h3>
<h4 data-id="heading-9">âœ” ç¼“å­˜è·¯ç”±ç»„ä»¶ï¼š</h4>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">keep-alive</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">router-view</span> /&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">keep-alive</span>&gt;</span>
</code></pre>
<hr/>
<h4 data-id="heading-10">âœ” include / exclude ç²¾å‡†æ§åˆ¶ç¼“å­˜</h4>
<pre><code class="hljs language-ini" lang="ini">&lt;keep-alive <span class="hljs-attr">include</span>=<span class="hljs-string">"UserList,UserInfo"</span> exclude=<span class="hljs-string">"LoginPage"</span>&gt;
</code></pre>
<hr/>
<h4 data-id="heading-11">âœ” åŠ¨æ€ç¼“å­˜ï¼š</h4>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">keep-alive</span> <span class="hljs-attr">:include</span>=<span class="hljs-string">"cachedComponents"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">router-view</span> /&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">keep-alive</span>&gt;</span>
</code></pre>
<hr/>
<h3 data-id="heading-12"><strong>å››ã€å¸¸è§é¢è¯•è¿½é—® + ä½ è¯¥æ€ä¹ˆå›ç­”</strong></h3>
<hr/>
<h4 data-id="heading-13">â“<strong>1. keep-alive å’Œ v-if çš„åŒºåˆ«ï¼Ÿ</strong></h4>
<p>âœ” <strong>v-if ä¼šé”€æ¯ç»„ä»¶</strong><br/>
âœ” <strong>keep-alive åªæ˜¯éšè—ï¼Œä¸é”€æ¯</strong></p>
<blockquote>
<p>keep-alive æ˜¯â€œç»„ä»¶çº§ç¼“å­˜â€ï¼Œv-if æ˜¯â€œæ¡ä»¶æ¸²æŸ“æ§åˆ¶â€</p>
</blockquote>
<hr/>
<h4 data-id="heading-14">â“<strong>2. keep-alive ç¼“å­˜å“ªäº›å†…å®¹ï¼Ÿ</strong></h4>
<p>ç¼“å­˜çš„æ˜¯ï¼š</p>
<ul>
<li>ç»„ä»¶å®ä¾‹ï¼ˆsetup è¿”å›å€¼ï¼‰</li>
<li>å“åº”å¼çŠ¶æ€</li>
<li>DOM èŠ‚ç‚¹</li>
</ul>
<p>ä¸ä¼šç¼“å­˜ï¼š</p>
<ul>
<li>props å˜åŒ–åçš„æ–°çŠ¶æ€ï¼ˆéœ€è¦æ‰‹åŠ¨ watchï¼‰</li>
<li>DOM å¤–éƒ¨ä¾èµ–ï¼ˆscroll ä½ç½®ã€å®šæ—¶å™¨ç­‰ï¼‰</li>
</ul>
<hr/>
<h4 data-id="heading-15">â“<strong>3. keep-alive é…åˆ router-view ä¸ºä»€ä¹ˆæœ‰æ—¶å¤±æ•ˆï¼Ÿ</strong></h4>
<p>å¸¸è§åŸå› ï¼š</p>
<ol>
<li>æ²¡æœ‰è®¾ç½® <code>router-view</code> çš„ <code>name</code></li>
<li>dynamic import ç»„ä»¶ name ä¸å¯¹</li>
<li>ä¸æ­£ç¡®ä½¿ç”¨ include / exclude</li>
</ol>
<hr/>
<h4 data-id="heading-16">â“<strong>4. å¦‚ä½•å¼ºåˆ¶æ¸…ç† keep-alive ç¼“å­˜ï¼Ÿ</strong></h4>
<p>å¯ä½¿ç”¨ keyï¼š</p>
<pre><code class="hljs language-ruby" lang="ruby">&lt;router-view <span class="hljs-symbol">:key=<span class="hljs-string">"$route.fullPath"</span>/&gt;</span>
</code></pre>
<p>æˆ–åˆ©ç”¨ include/exclude åŠ¨æ€æ§åˆ¶ã€‚</p>
<hr/>
<h3 data-id="heading-17"><strong>äº”ã€é¢è¯•å®˜æƒ³å¬çš„æ€»ç»“ï¼ˆé«˜åˆ†ç‰ˆï¼‰</strong></h3>
<blockquote>
<p>keep-alive æœ¬è´¨æ˜¯ç”¨ Map ç¼“å­˜ç»„ä»¶å®ä¾‹ï¼Œé€šè¿‡æ¿€æ´»ä¸å¤±æ´»æ§åˆ¶ç»„ä»¶æŒ‚è½½çŠ¶æ€ï¼Œå¹¶é€šè¿‡ LRU ç®—æ³•ç®¡ç†ç¼“å­˜æ•°é‡ã€‚<br/>
å¸¸ç”¨äºè·¯ç”±ç¼“å­˜ã€tab é¡µç­¾ã€å¤æ‚ç»„ä»¶åå¤åˆ‡æ¢çš„æ€§èƒ½ä¼˜åŒ–ã€‚</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ç¬¬ 256 é¢˜ï¼šVue3 çš„å¼‚æ­¥ç»„ä»¶ï¼ˆdefineAsyncComponentï¼‰+ Suspense åŸç†ä¸é¢è¯•é«˜é¢‘ç‚¹]]></title>    <link>https://juejin.cn/post/7579186764046204969</link>    <guid>https://juejin.cn/post/7579186764046204969</guid>    <pubDate>2025-12-03T04:46:15.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7579186764046204969" data-draft-id="7579186764046188585" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ç¬¬ 256 é¢˜ï¼šVue3 çš„å¼‚æ­¥ç»„ä»¶ï¼ˆdefineAsyncComponentï¼‰+ Suspense åŸç†ä¸é¢è¯•é«˜é¢‘ç‚¹"/> <meta itemprop="keywords" content="å‰ç«¯,é¢è¯•"/> <meta itemprop="datePublished" content="2025-12-03T04:46:15.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å‰ç«¯ä¸€è¯¾"/> <meta itemprop="url" content="https://juejin.cn/user/1169536102963917"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ç¬¬ 256 é¢˜ï¼šVue3 çš„å¼‚æ­¥ç»„ä»¶ï¼ˆdefineAsyncComponentï¼‰+ Suspense åŸç†ä¸é¢è¯•é«˜é¢‘ç‚¹
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1169536102963917/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å‰ç«¯ä¸€è¯¾
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-03T04:46:15.000Z" title="Wed Dec 03 2025 04:46:15 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-03
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»3åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0"><strong>ç¬¬ 25 é¢˜ï¼šVue3 çš„å¼‚æ­¥ç»„ä»¶ï¼ˆdefineAsyncComponentï¼‰+ Suspense åŸç†ä¸é¢è¯•é«˜é¢‘ç‚¹</strong></h2>
<hr/>
<h2 data-id="heading-1">ä¸€ã€æ ¸å¿ƒå›ç­”ï¼ˆé¢è¯•å®˜æœ€æƒ³å¬çš„ï¼‰</h2>
<h4 data-id="heading-2"><strong>1ï¼‰defineAsyncComponent æ˜¯ç”¨æ¥åŠ¨æ€åŠ è½½ç»„ä»¶çš„</strong></h4>
<ul>
<li>å®ç° <strong>æŒ‰éœ€åŠ è½½ / ä»£ç åˆ†å‰²</strong>ï¼ˆWebpackã€Vite è‡ªåŠ¨åˆ† chunkï¼‰</li>
<li>å‡å°‘é¦–å±åŒ…ä½“ç§¯ï¼Œæé«˜åŠ è½½é€Ÿåº¦</li>
</ul>
<h4 data-id="heading-3"><strong>2ï¼‰Suspense ç”¨æ¥å¤„ç†å¼‚æ­¥ç»„ä»¶çš„â€œåŠ è½½çŠ¶æ€â€</strong></h4>
<ul>
<li>
<p>å¼‚æ­¥ç»„ä»¶ç¬¬ä¸€æ¬¡åŠ è½½æ—¶ä¼šå¤„äºâ€œæœªå®ŒæˆçŠ¶æ€â€</p>
</li>
<li>
<p>Suspense å¯ä»¥å±•ç¤ºï¼š</p>
<ul>
<li>loading å ä½å†…å®¹ï¼ˆfallbackï¼‰</li>
<li>åŠ è½½å®Œæˆåå†å±•ç¤ºå†…å®¹</li>
</ul>
</li>
</ul>
<h4 data-id="heading-4"><strong>3ï¼‰å¼‚æ­¥ç»„ä»¶æ ¸å¿ƒåŸç†</strong></h4>
<ul>
<li>
<p>æœ¬è´¨ï¼šåŒ…è£…ä¸€ä¸ª Promiseï¼Œå†…éƒ¨ç»´æŠ¤ <strong>loading / loaded / error</strong> çŠ¶æ€æœº</p>
</li>
<li>
<p>ç¬¬ä¸€æ¬¡æ¸²æŸ“ï¼š</p>
<ul>
<li>asyncComponent(loader) â†’ Promise â†’ è¿”å›å ä½èŠ‚ç‚¹</li>
</ul>
</li>
<li>
<p>Promise resolvesï¼š</p>
<ul>
<li>æ¸²æŸ“çœŸæ­£ç»„ä»¶</li>
</ul>
</li>
<li>
<p>Suspense ä½œä¸ºâ€œå¼‚æ­¥è¾¹ç•Œâ€ï¼Œç­‰å¾…æ‰€æœ‰å¼‚æ­¥å­ç»„ä»¶ resolve åå†è¿›è¡Œ DOM patch</p>
</li>
</ul>
<hr/>
<h2 data-id="heading-5">äºŒã€deep åŸç†ï¼ˆæ·±å…¥è®²ï¼Œæœ‰é¢è¯•åŠ åˆ†ï¼‰</h2>
<h3 data-id="heading-6"><strong>1ï¼‰defineAsyncComponent åŸç†ï¼ˆçŠ¶æ€æœºï¼‰</strong></h3>
<p>æ ¸å¿ƒä¼ªä»£ç ï¼ˆç®€åŒ–ç‰ˆï¼‰ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">defineAsyncComponent</span>(<span class="hljs-params">loader</span>) {
  <span class="hljs-keyword">let</span> resolved = <span class="hljs-literal">null</span>
  <span class="hljs-keyword">let</span> loading = <span class="hljs-literal">false</span>

  <span class="hljs-keyword">return</span> {
    <span class="hljs-title function_">setup</span>(<span class="hljs-params"/>) {
      <span class="hljs-keyword">if</span> (!resolved &amp;&amp; !loading) {
        loading = <span class="hljs-literal">true</span>
        <span class="hljs-title function_">loader</span>().<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">comp</span> =&gt;</span> {
          resolved = comp
        })
      }

      <span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> resolved ? <span class="hljs-title function_">h</span>(resolved) : <span class="hljs-title function_">h</span>(<span class="hljs-string">'div'</span>, <span class="hljs-string">'loading...'</span>)
    }
  }
}
</code></pre>
<h4 data-id="heading-7">å®é™…å†…éƒ¨åŒ…æ‹¬ï¼š</h4>
<ul>
<li>loadingDelayï¼ˆå»¶è¿Ÿæ˜¾ç¤º loadingï¼‰</li>
<li>timeoutï¼ˆåŠ è½½è¶…æ—¶ï¼‰</li>
<li>error retryï¼ˆé”™è¯¯é‡è¯•ï¼‰</li>
<li>suspensibleï¼ˆæ˜¯å¦ç”± Suspense æ§åˆ¶ï¼‰</li>
</ul>
<hr/>
<h3 data-id="heading-8"><strong>2ï¼‰Suspense å·¥ä½œåŸç†</strong></h3>
<p>Vue3 å†…éƒ¨ç»´æŠ¤ä¸€ä¸ª <strong>å¼‚æ­¥ä¾èµ–è®¡æ•°å™¨ depCount</strong>ï¼š</p>
<ul>
<li>
<p>å­ç»„ä»¶åœ¨æ¸²æŸ“æœŸ â€œæŒ‚èµ·â€ï¼ˆé‡åˆ° Promiseï¼‰</p>
</li>
<li>
<p>Suspense ä¸ç«‹å³æ¸²æŸ“ child æ ‘</p>
</li>
<li>
<p>ç­‰æ‰€æœ‰ pending Promise ç»“æŸï¼š</p>
<ul>
<li>æ›¿æ¢ fallback åŒºåŸŸä¸ºçœŸå® children åŒºåŸŸ</li>
</ul>
</li>
</ul>
<p>ä¼ªä»£ç æ€ç»´æ¨¡å‹ï¼š</p>
<pre><code class="hljs language-sql" lang="sql">if (async deps <span class="hljs-operator">&gt;</span> <span class="hljs-number">0</span>) {
  <span class="hljs-keyword">show</span> fallback
} <span class="hljs-keyword">else</span> {
  <span class="hljs-keyword">show</span> <span class="hljs-type">real</span> content
}
</code></pre>
<p>Suspense æ˜¯ Vue3 çš„ <strong>Concurrent Rendering</strong> çš„åŸºç¡€èƒ½åŠ›ã€‚</p>
<hr/>
<h2 data-id="heading-9">ä¸‰ã€ä½¿ç”¨ç¤ºä¾‹</h2>
<h3 data-id="heading-10"><strong>1ï¼‰ç®€å•å¼‚æ­¥ç»„ä»¶</strong></h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> <span class="hljs-title class_">AsyncPage</span> = <span class="hljs-title function_">defineAsyncComponent</span>(<span class="hljs-function">() =&gt;</span>
  <span class="hljs-keyword">import</span>(<span class="hljs-string">'./Page.vue'</span>)
)
</code></pre>
<p>ä½¿ç”¨ï¼š</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">AsyncPage</span> /&gt;</span>
</code></pre>
<hr/>
<h3 data-id="heading-11"><strong>2ï¼‰å¸¦ loading / error çš„é«˜çº§é…ç½®</strong></h3>
<pre><code class="hljs language-scss" lang="scss">const AsyncComp = <span class="hljs-built_in">defineAsyncComponent</span>({
  loader: () =&gt; <span class="hljs-built_in">import</span>('./MyComp.vue'),
  loadingComponent: Loading,
  errorComponent: LoadError,
  delay: <span class="hljs-number">200</span>,
  timeout: <span class="hljs-number">3000</span>,
  <span class="hljs-built_in">onError</span>(retry, fail, attempts) {
    if (attempts &lt; <span class="hljs-number">3</span>) <span class="hljs-built_in">retry</span>()
    else <span class="hljs-built_in">fail</span>()
  }
})
</code></pre>
<hr/>
<h3 data-id="heading-12"><strong>3ï¼‰Suspense ç”¨æ³•</strong></h3>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">Suspense</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">template</span> #<span class="hljs-attr">default</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">AsyncComp</span> /&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>

  <span class="hljs-tag">&lt;<span class="hljs-name">template</span> #<span class="hljs-attr">fallback</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">LoadingSpinner</span> /&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">Suspense</span>&gt;</span>
</code></pre>
<p>æ•ˆæœï¼š</p>
<ul>
<li>AsyncComp è¿˜æ²¡åŠ è½½ â†’ fallback</li>
<li>åŠ è½½å®Œæˆ â†’ default</li>
</ul>
<hr/>
<h2 data-id="heading-13">å››ã€é¢è¯•å®˜è¿½é—® + é«˜åˆ†å›ç­”</h2>
<hr/>
<h3 data-id="heading-14">â“1. defineAsyncComponent å’Œ import åŠ¨æ€å¼•å…¥æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</h3>
<p><strong>ä¸ç”¨ defineAsyncComponent æ—¶ï¼š</strong></p>
<pre><code class="hljs language-scss" lang="scss">&lt;component <span class="hljs-selector-pseudo">:is</span>="() =&gt; <span class="hljs-built_in">import</span>('./A.vue')" /&gt;
</code></pre>
<p>ç¼ºç‚¹ï¼š</p>
<ul>
<li>Vue ä¸ä¼šè‡ªåŠ¨åš loading/error ç®¡ç†</li>
<li>æ— å»¶è¿Ÿç­–ç•¥</li>
<li>æ— è¶…æ—¶å¤„ç†</li>
<li>æ— é”™è¯¯é‡è¯•</li>
</ul>
<p><strong>defineAsyncComponent æ˜¯â€œå¢å¼ºç‰ˆåŠ¨æ€ importâ€</strong></p>
<hr/>
<h3 data-id="heading-15">â“2. Suspense æ”¯æŒå¤šå±‚åµŒå¥—å—ï¼Ÿæ€ä¹ˆè°ƒåº¦ï¼Ÿ</h3>
<p>æ”¯æŒã€‚Vue ä¼šè‡ªåŠ¨æ±‡æ€»æ‰€æœ‰æœª resolve çš„ Promise<br/>
â†’ ä½œä¸ºä¸€ä¸ªâ€œå¼‚æ­¥è¾¹ç•Œâ€<br/>
â†’ Promise å…¨éƒ¨å®Œæˆæ‰æ›¿æ¢ fallbackã€‚</p>
<hr/>
<h3 data-id="heading-16">â“3. Suspense åœ¨ SSR ä¸­çš„æ„ä¹‰æ˜¯ä»€ä¹ˆï¼Ÿ</h3>
<p>åœ¨ SSR ä¸­ï¼š</p>
<ul>
<li>fallback <strong>ä¸ä¼šæ¸²æŸ“</strong></li>
<li>å¼‚æ­¥ç»„ä»¶ä¼š <strong>æå‰ resolve åå†è¾“å‡º HTML</strong></li>
<li>ä¿è¯ SSR HTML æ˜¯å®Œæ•´çš„</li>
</ul>
<hr/>
<h3 data-id="heading-17">â“4. å¼‚æ­¥ç»„ä»¶ä»€ä¹ˆæ—¶å€™é€‚åˆç”¨ï¼Ÿä»€ä¹ˆæ—¶å€™ä¸é€‚åˆï¼Ÿ</h3>
<h4 data-id="heading-18">é€‚åˆï¼š</h4>
<ul>
<li>å¤§ç»„ä»¶ï¼ˆå›¾è¡¨ã€ç¼–è¾‘å™¨ã€åœ°å›¾ã€é«˜å¤æ‚åº¦é¡µé¢ï¼‰</li>
<li>é¡µé¢çº§è·¯ç”±</li>
<li>å¤§å‹åå°å›¾è¡¨ï¼ˆEChartsã€ThreeJSï¼‰</li>
</ul>
<h4 data-id="heading-19">ä¸é€‚åˆï¼š</h4>
<ul>
<li>å°ç»„ä»¶ï¼ˆæŒ‰é’®ã€è¡¨å•å…ƒç´ ï¼‰<br/>
å› ä¸ºåè€Œå¢åŠ  chunk æ•°é‡ã€åŠ è½½å»¶è¿Ÿ</li>
</ul>
<hr/>
<h2 data-id="heading-20">äº”ã€é¢è¯•é«˜åˆ†æ€»ç»“ï¼ˆèƒŒä¸‹æ¥æ— æ•Œï¼‰</h2>
<blockquote>
<p><code>defineAsyncComponent</code> æ˜¯ Vue3 ä¸ºç»„ä»¶åšçš„ Promise åŒ…è£…ï¼Œå®ç°å¼‚æ­¥åŠ è½½ã€è‡ªåŠ¨ loading/error æ§åˆ¶ã€è¶…æ—¶ã€é‡è¯•ã€‚<br/>
<code>Suspense</code> æ˜¯å¼‚æ­¥ç»„ä»¶çš„æ¸²æŸ“è¾¹ç•Œï¼Œå†…éƒ¨é€šè¿‡æŒ‚èµ·æœºåˆ¶ï¼ˆasync depCountï¼‰ç­‰å¾…æ‰€æœ‰å¼‚æ­¥ä¾èµ– resolve åç»Ÿä¸€æ¸²æŸ“ï¼Œä»è€Œå®ç°é«˜è´¨é‡ Loading åˆ‡æ¢å’Œå¹¶å‘æ¸²æŸ“èƒ½åŠ›ã€‚</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ç¬¬ 27 é¢˜ï¼šVue3 + TS ç±»å‹æ¨æ–­ï¼ˆProps ç±»å‹æ¨å¯¼ã€Emit ç±»å‹æ¨å¯¼ã€Setup è¿”å›å€¼ç±»å‹ï¼‰]]></title>    <link>https://juejin.cn/post/7579186764046221353</link>    <guid>https://juejin.cn/post/7579186764046221353</guid>    <pubDate>2025-12-03T04:46:47.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7579186764046221353" data-draft-id="7579229538791227398" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ç¬¬ 27 é¢˜ï¼šVue3 + TS ç±»å‹æ¨æ–­ï¼ˆProps ç±»å‹æ¨å¯¼ã€Emit ç±»å‹æ¨å¯¼ã€Setup è¿”å›å€¼ç±»å‹ï¼‰"/> <meta itemprop="keywords" content="å‰ç«¯,é¢è¯•"/> <meta itemprop="datePublished" content="2025-12-03T04:46:47.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å‰ç«¯ä¸€è¯¾"/> <meta itemprop="url" content="https://juejin.cn/user/1169536102963917"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ç¬¬ 27 é¢˜ï¼šVue3 + TS ç±»å‹æ¨æ–­ï¼ˆProps ç±»å‹æ¨å¯¼ã€Emit ç±»å‹æ¨å¯¼ã€Setup è¿”å›å€¼ç±»å‹ï¼‰
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1169536102963917/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å‰ç«¯ä¸€è¯¾
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-03T04:46:47.000Z" title="Wed Dec 03 2025 04:46:47 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-03
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»3åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0"><strong>ç¬¬ 26 é¢˜ï¼šVue3 + TS ç±»å‹æ¨æ–­ï¼ˆProps ç±»å‹æ¨å¯¼ã€Emit ç±»å‹æ¨å¯¼ã€Setup è¿”å›å€¼ç±»å‹ï¼‰</strong></h2>
<hr/>
<h2 data-id="heading-1">ğŸ¯ ä¸€ã€æ ¸å¿ƒå›ç­”ï¼ˆé¢è¯•å®˜æœ€æƒ³å¬ï¼‰</h2>
<p>Vue3 + TS çš„ç±»å‹æ¨æ–­èƒ½åŠ›ä¸»è¦ä¾èµ– <strong>å®ï¼ˆcompile-time macroï¼‰+ æ³›å‹ï¼ˆgenericï¼‰+ ç±»å‹æ”¶çª„ï¼ˆnarrowingï¼‰</strong> ã€‚</p>
<p>æœ€å¸¸è€ƒï¼š</p>
<ol>
<li>
<p><strong>defineProps</strong> ä¼šè‡ªåŠ¨æ¨æ–­ props ç±»å‹<br/>
æ¥è‡ªç¼–è¯‘å™¨ï¼ˆvue-tsc / Volarï¼‰åœ¨ç¼–è¯‘æ—¶åˆ†æå®ã€‚</p>
</li>
<li>
<p><strong>defineEmits</strong> ä¼šè‡ªåŠ¨æ¨æ–­ emit çš„äº‹ä»¶åå’Œå‚æ•°ç±»å‹ã€‚</p>
</li>
<li>
<p><strong>setup è¿”å›å€¼çš„ç±»å‹æ¨æ–­</strong> ç”± TS è‡ªåŠ¨å®Œæˆï¼Œå’Œ Vue3 çš„å®æ— å…³ã€‚</p>
</li>
<li>
<p><strong>Props ç±»å‹æ¨æ–­ä¾èµ–ä¸¤ç§å†™æ³•ï¼š</strong></p>
<ul>
<li>åŸºäºç±»å‹ï¼ˆæœ€å¸¸ç”¨ï¼‰</li>
<li>åŸºäºè¿è¡Œæ—¶ï¼ˆrunTime propsï¼‰</li>
</ul>
</li>
</ol>
<hr/>
<h2 data-id="heading-2">ğŸ¯ äºŒã€Vue3 TS ç±»å‹æ¨æ–­æ·±åº¦åŸç†ï¼ˆæ·±å…¥è®²ï¼Œé¢è¯•åŠ åˆ†ï¼‰</h2>
<hr/>
<h2 data-id="heading-3">1ï¸âƒ£ <strong>defineProps ç¼–è¯‘åå˜æˆç±»å‹å£°æ˜ï¼ˆç¼–è¯‘æ—¶å®ï¼‰</strong></h2>
<p>ç¤ºä¾‹ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">const</span> props = defineProps&lt;{
  <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span>
  age?: <span class="hljs-built_in">number</span>
}&gt;()
</code></pre>
<p>ç¼–è¯‘åï¼ˆç®€åŒ–ï¼‰ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// ç¼–è¯‘å™¨æŠŠ defineProps çš„ç±»å‹ç›´æ¥æ³¨å…¥ TS ä¸­</span>
<span class="hljs-keyword">interface</span> <span class="hljs-title class_">Props</span> {
  <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span>
  age?: <span class="hljs-built_in">number</span>
}
<span class="hljs-keyword">const</span> <span class="hljs-attr">props</span>: <span class="hljs-title class_">Props</span>
</code></pre>
<h4 data-id="heading-4">ğŸš€ æœ¬è´¨ï¼š</h4>
<blockquote>
<p><strong>defineProps å¹¶ä¸æ˜¯ runtime ä»£ç ï¼Œè€Œæ˜¯ compile-time å®ã€‚</strong><br/>
ç¼–è¯‘å™¨ä¼šåˆ†æå®å‚æ•°ï¼ŒæŠŠç±»å‹ç›´æ¥æ³¨å…¥åˆ°ç»„ä»¶ç±»å‹ä¸­ã€‚</p>
</blockquote>
<hr/>
<h2 data-id="heading-5">2ï¸âƒ£ <strong>defineEmits ç±»å‹æ¨æ–­æœºåˆ¶</strong></h2>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">const</span> emit = defineEmits&lt;{
  (<span class="hljs-attr">e</span>: <span class="hljs-string">'change'</span>, <span class="hljs-attr">value</span>: <span class="hljs-built_in">number</span>): <span class="hljs-built_in">void</span>
  (<span class="hljs-attr">e</span>: <span class="hljs-string">'delete'</span>, <span class="hljs-attr">id</span>: <span class="hljs-built_in">string</span>): <span class="hljs-built_in">void</span>
}&gt;()
</code></pre>
<p>TS æ¨æ–­å‡ºï¼š</p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-built_in">emit</span>('change', <span class="hljs-number">123</span>)
<span class="hljs-built_in">emit</span>('delete', 'abc')
</code></pre>
<p>å¦‚æœå†™é”™ï¼š</p>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-built_in">emit</span>(<span class="hljs-string">'change'</span>, <span class="hljs-string">'xxx'</span>) <span class="hljs-comment">// âŒ æŠ¥é”™ï¼Œå‚æ•°ç±»å‹ä¸å¯¹</span>
</code></pre>
<hr/>
<h4 data-id="heading-6">âœ¨ defineEmits ç¼–è¯‘åŸç†ï¼š</h4>
<p>ä¼šç”Ÿæˆä¸¤ä¸ªé‡è¦ä¸œè¥¿ï¼š</p>
<ol>
<li><strong>äº‹ä»¶åè”åˆç±»å‹</strong> <code>'change' | 'delete'</code></li>
<li><strong>äº‹ä»¶å‡½æ•°é‡è½½ç±»å‹æ¨æ–­</strong></li>
</ol>
<p>è¿™ä½¿å¾— TS èƒ½åœ¨ emit æ—¶åšä¸¥æ ¼æ ¡éªŒã€‚</p>
<hr/>
<h2 data-id="heading-7">3ï¸âƒ£ <strong>è¿è¡Œæ—¶ Props çš„è‡ªåŠ¨æ¨å¯¼èƒ½åŠ›</strong></h2>
<p>Vue3 å®ä¹Ÿèƒ½æ¨å¯¼ runtime propsï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> props = <span class="hljs-title function_">defineProps</span>({
  <span class="hljs-attr">title</span>: <span class="hljs-title class_">String</span>,
  <span class="hljs-attr">count</span>: <span class="hljs-title class_">Number</span>,
  <span class="hljs-attr">isActive</span>: <span class="hljs-title class_">Boolean</span>
})
</code></pre>
<p>TS ä¼šæ¨æ–­ä¸ºï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript">{
  title?: <span class="hljs-built_in">string</span>,
  count?: <span class="hljs-built_in">number</span>,
  isActive?: <span class="hljs-built_in">boolean</span>
}
</code></pre>
<p>æ³¨æ„ï¼š<br/>
æ‰€æœ‰ runtime å£°æ˜çš„ props <strong>éƒ½å˜æˆå¯é€‰</strong>ï¼Œå› ä¸ºçˆ¶ç»„ä»¶å¯ä»¥ä¸ä¼ ã€‚</p>
<hr/>
<h2 data-id="heading-8">4ï¸âƒ£ <strong>ä½¿ç”¨ withDefaults åšé»˜è®¤å€¼æ¨æ–­</strong></h2>
<pre><code class="hljs language-php" lang="php"><span class="hljs-keyword">const</span> <span class="hljs-variable constant_">props</span> = <span class="hljs-title function_ invoke__">withDefaults</span>(
  defineProps&lt;{
    <span class="hljs-attr">username</span>: <span class="hljs-keyword">string</span>
    pageSize?: number
  }&gt;(),
  {
    pageSize: <span class="hljs-number">20</span>
  }
)
</code></pre>
<p>æ¨æ–­ç»“æœï¼š</p>
<ul>
<li>pageSize ä¸å†æ˜¯ <code>number | undefined</code></li>
<li>è‡ªåŠ¨å˜æˆ <code>number</code></li>
</ul>
<hr/>
<h2 data-id="heading-9">5ï¸âƒ£ <strong>setup è¿”å›å€¼ç±»å‹æ¨æ–­</strong></h2>
<p>Vue çš„ setupï¼š</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">const</span> count = <span class="hljs-keyword">ref</span>(<span class="hljs-number">0</span>)

<span class="hljs-function">function <span class="hljs-title">add</span>()</span> {}

<span class="hljs-keyword">return</span> { count, <span class="hljs-keyword">add</span> }
</code></pre>
<p>æ¨æ–­ä¸ºï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript">{
  <span class="hljs-attr">count</span>: <span class="hljs-title class_">Ref</span>&lt;<span class="hljs-built_in">number</span>&gt;
  <span class="hljs-attr">add</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">void</span>
}
</code></pre>
<p>Vue ä¼šè‡ªåŠ¨ unwrap ref åˆ°æ¨¡æ¿ä¸­ï¼Œä½† TS ä¿ç•™ Ref ç±»å‹ã€‚</p>
<hr/>
<h2 data-id="heading-10">ğŸ¯ ä¸‰ã€ä»£ç ç¤ºä¾‹ï¼ˆå®Œæ•´ TS + Props + Emitsï¼‰</h2>
<hr/>
<h3 data-id="heading-11">1ï¼‰ç»„åˆ Prop + Emitï¼š</h3>
<pre><code class="hljs language-php" lang="php">&lt;script setup lang=<span class="hljs-string">"ts"</span>&gt;
<span class="hljs-keyword">const</span> <span class="hljs-variable constant_">props</span> = defineProps&lt;{
  value: <span class="hljs-keyword">string</span>
  maxLength?: number
}&gt;()

<span class="hljs-keyword">const</span> <span class="hljs-variable constant_">emit</span> = defineEmits&lt;{
  (e: <span class="hljs-string">'update:value'</span>, v: <span class="hljs-keyword">string</span>): <span class="hljs-keyword">void</span>
  (e: <span class="hljs-string">'reachMax'</span>): <span class="hljs-keyword">void</span>
}&gt;()

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">input</span>(<span class="hljs-params">v: <span class="hljs-keyword">string</span></span>) </span>{
  <span class="hljs-keyword">if</span> (v.length &gt; (props.maxLength ?? Infinity)) {
    <span class="hljs-title function_ invoke__">emit</span>(<span class="hljs-string">'reachMax'</span>)
  }
  <span class="hljs-title function_ invoke__">emit</span>(<span class="hljs-string">'update:value'</span>, v)
}
&lt;/script&gt;
</code></pre>
<p>å…¨éƒ¨ç±»å‹éƒ½ä¼šè‡ªåŠ¨æ¨æ–­ï¼Œæ— éœ€æ‰‹å†™ anyã€‚</p>
<hr/>
<h2 data-id="heading-12">ğŸ¯ å››ã€é¢è¯•å®˜é«˜é¢‘è¿½é—® &amp; ä½ è¯¥æ€ä¹ˆç­”</h2>
<hr/>
<h3 data-id="heading-13">â“1ï¼šdefineProps ä¸ºä»€ä¹ˆä¸æ˜¯ä¸€ä¸ªçœŸæ­£çš„å‡½æ•°ï¼Ÿä¸ºä»€ä¹ˆåªèƒ½åœ¨ 
</h3><p><strong>é«˜åˆ†å›ç­”ï¼š</strong></p>
<p>å› ä¸º defineProps æ˜¯ <strong>ç¼–è¯‘å™¨å®</strong>ï¼Œä¸æ˜¯è¿è¡Œæ—¶å‡½æ•°ï¼Œå®ƒåªåœ¨ç¼–è¯‘æœŸç”Ÿæ•ˆã€‚</p>
<p>Vue ç¼–è¯‘å™¨ç›´æ¥å°† defineProps çš„ç±»å‹å†™å…¥ç»„ä»¶ç±»å‹ç³»ç»Ÿã€‚</p>
<hr/>
<h3 data-id="heading-14">â“2ï¼šdefineProps çš„ç±»å‹å‚æ•°å’Œè¿è¡Œæ—¶å‚æ•°åŒæ—¶å†™ï¼Œä¼šæ€æ ·ï¼Ÿ</h3>
<p>ä¾‹å­ï¼š</p>
<pre><code class="hljs language-css" lang="css">defineProps&lt;{
  name: string
}&gt;({
  name: Number
})
</code></pre>
<p>ç»“æœï¼šç±»å‹å†²çªï¼ŒTS ä¼šæŠ¥é”™ï¼Œå› ä¸ºå®ä¸å…è®¸æœ‰ä¸¤ä¸ªæ¥æºã€‚</p>
<hr/>
<h3 data-id="heading-15">â“3ï¼šå’Œ Vue2 çš„ props + emit ç›¸æ¯”ï¼ŒVue3 çš„ TS å¼ºåœ¨å“ªé‡Œï¼Ÿ</h3>
<p><strong>é«˜é¢‘ + åŠ åˆ†å›ç­”ï¼š</strong></p>
<p>Vue3 åšåˆ°äº†ï¼š</p>
<ul>
<li>äº‹ä»¶åç§°çš„è‡ªåŠ¨è¡¥å…¨</li>
<li>å‚æ•°ç±»å‹è‡ªåŠ¨æ£€æµ‹</li>
<li>props ç±»å‹è‡ªåŠ¨æ¨å¯¼</li>
<li>default å€¼å˜çª„ï¼ˆwithDefaultsï¼‰</li>
<li>emit å¯å†™å¤šé‡ overloadï¼ˆç›¸å½“ä¸“ä¸šï¼‰</li>
</ul>
<p>Vue2 ç”¨ TS éå¸¸åƒåŠ›ï¼ŒVue3 è§£å†³äº†ç—›ç‚¹ã€‚</p>
<hr/>
<h3 data-id="heading-16">â“4ï¼šæœ‰ç±»å‹æ¨æ–­çš„ defineModelï¼ˆv-model è¯­æ³•ç³–ï¼‰æ˜¯ä»€ä¹ˆï¼Ÿ</h3>
<p>Vue3.4 æ–°å¢ï¼š</p>
<pre><code class="hljs language-c" lang="c"><span class="hljs-type">const</span> model = defineModel&lt;<span class="hljs-built_in">string</span>&gt;()
</code></pre>
<p>è‡ªåŠ¨æ¨æ–­ï¼š</p>
<ul>
<li>modelValue ç±»å‹</li>
<li>update:modelValue å‚æ•°ç±»å‹</li>
</ul>
<p>è¿™æ˜¯ Vue TS ä½“éªŒæœ€å¼ºçš„ä¸€éƒ¨åˆ†ã€‚</p>
<hr/>
<h2 data-id="heading-17">ğŸ¯ äº”ã€é«˜åˆ†æ€»ç»“ï¼ˆé¢è¯•ç›´æ¥èƒŒï¼‰</h2>
<blockquote>
<p>Vue3 çš„ defineProps / defineEmits / defineModel éƒ½æ˜¯ç¼–è¯‘æœŸå®ï¼Œä¸å­˜åœ¨äºè¿è¡Œæ—¶ä»£ç ä¸­ã€‚<br/>
å®ƒä»¬é€šè¿‡ TS æ³›å‹ + ç¼–è¯‘å™¨é™æ€åˆ†æï¼Œå®ç° Propsã€Emitã€v-model çš„å®Œæ•´ç±»å‹æ¨æ–­ï¼Œæ˜¯ Vue3 ä¸ TS æœ€å¼ºç»“åˆç‚¹ã€‚<br/>
è¿è¡Œæ—¶ props å†™æ³•ä¹Ÿå¯ä»¥æ¨æ–­ç±»å‹ï¼Œä½†ä¸å¦‚æ³›å‹å†™æ³•å¼ºã€‚<br/>
setup è¿”å›å€¼ç”± TS è‡ªåŠ¨æ¨æ–­ï¼Œä¸å®æ— å…³ã€‚</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ç¬¬ 28 é¢˜ï¼šVue3 çš„ Diff ç®—æ³•æ ¸å¿ƒåŸç†ï¼ˆåŒç«¯ Diffã€PatchFlagsã€Block Treeã€é™æ€æå‡ï¼‰]]></title>    <link>https://juejin.cn/post/7579256547797893161</link>    <guid>https://juejin.cn/post/7579256547797893161</guid>    <pubDate>2025-12-03T04:47:25.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7579256547797893161" data-draft-id="7579256547797876777" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ç¬¬ 28 é¢˜ï¼šVue3 çš„ Diff ç®—æ³•æ ¸å¿ƒåŸç†ï¼ˆåŒç«¯ Diffã€PatchFlagsã€Block Treeã€é™æ€æå‡ï¼‰"/> <meta itemprop="keywords" content="å‰ç«¯,é¢è¯•"/> <meta itemprop="datePublished" content="2025-12-03T04:47:25.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å‰ç«¯ä¸€è¯¾"/> <meta itemprop="url" content="https://juejin.cn/user/1169536102963917"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ç¬¬ 28 é¢˜ï¼šVue3 çš„ Diff ç®—æ³•æ ¸å¿ƒåŸç†ï¼ˆåŒç«¯ Diffã€PatchFlagsã€Block Treeã€é™æ€æå‡ï¼‰
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1169536102963917/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å‰ç«¯ä¸€è¯¾
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-03T04:47:25.000Z" title="Wed Dec 03 2025 04:47:25 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-03
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»4åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0"><strong>ç¬¬ 27 é¢˜ï¼šVue3 çš„ Diff ç®—æ³•æ ¸å¿ƒåŸç†ï¼ˆåŒç«¯ Diffã€PatchFlagsã€Block Treeã€é™æ€æå‡ï¼‰</strong></h2>
<p>æˆ‘ä¼šæŒ‰ç…§ç»“æ„ï¼š<br/>
<strong>æ ¸å¿ƒå›ç­” â†’ æ·±åº¦è®²è§£ â†’ åŠ¨ç”»çº§åˆ«ç¤ºæ„ â†’ PatchFlags &amp; é™æ€æå‡ â†’ é¢è¯•å®˜è¿½é—® â†’ é«˜åˆ†æ€»ç»“</strong></p>
<hr/>
<h2 data-id="heading-1">ä¸€ã€æ ¸å¿ƒå›ç­”ï¼ˆé¢è¯•å®˜æœ€æƒ³å¬ï¼‰</h2>
<p>Vue3 çš„ Diff ç®—æ³•æ˜¯åŸºäº <strong>åŒç«¯å¯¹æ¯” + æœ€é•¿é€’å¢å­åºåˆ—ï¼ˆLISï¼‰ä¼˜åŒ– + é™æ€æå‡ + block tree + patchFlags</strong> çš„ã€‚</p>
<p>æ¯” Vue2 å¿«çš„åŸå› ï¼š</p>
<ol>
<li><strong>é™æ€èŠ‚ç‚¹è·³è¿‡ diff</strong></li>
<li><strong>PatchFlags å‡å°‘ä¸å¿…è¦å¯¹æ¯”</strong></li>
<li><strong>block tree é™åˆ¶ diff èŒƒå›´</strong></li>
<li><strong>ä¼˜åŒ–åçš„åŒç«¯ Diff + LIS</strong></li>
<li><strong>æ¨¡æ¿ç¼–è¯‘é˜¶æ®µæå¤§åœ°å‡å°‘äº†è¿è¡Œæ—¶å·¥ä½œé‡</strong></li>
</ol>
<hr/>
<h2 data-id="heading-2">äºŒã€æ·±åº¦åŸç†ï¼ˆæ·±å…¥è®²ï¼Œé«˜åˆ†ï¼‰</h2>
<hr/>
<h2 data-id="heading-3">1ï¸âƒ£ Vue3 Diff = â€œåŒç«¯ Diff + LISâ€</h2>
<p>Vue3 çš„æ ¸å¿ƒ Diff é€»è¾‘å¦‚ä¸‹ï¼š</p>
<h4 data-id="heading-4"><strong>ç¬¬ä¸€é˜¶æ®µï¼šä»å¤´å¼€å§‹æ¯”å¯¹ï¼ˆå‰ç«¯æŒ‡é’ˆï¼‰</strong></h4>
<p>å¦‚æœæ–°æ—§å¤´èŠ‚ç‚¹æ˜¯ç›¸åŒ keyï¼Œå°± patch å¹¶ç§»åŠ¨ï¼š</p>
<pre><code class="hljs language-css" lang="css">æ—§ï¼š<span class="hljs-selector-attr">[A B C D]</span>
æ–°ï¼š<span class="hljs-selector-attr">[A B E C D]</span>

ä»å¤´å¼€å§‹ï¼š
<span class="hljs-selector-tag">A</span> â†’ match
<span class="hljs-selector-tag">B</span> â†’ match
é‡åˆ° C / E ä¸åŒï¼Œåœæ­¢
</code></pre>
<hr/>
<h4 data-id="heading-5"><strong>ç¬¬äºŒé˜¶æ®µï¼šä»å°¾å¼€å§‹æ¯”å¯¹ï¼ˆåç«¯æŒ‡é’ˆï¼‰</strong></h4>
<pre><code class="hljs language-css" lang="css">æ—§ï¼š<span class="hljs-selector-attr">[A B C D]</span>
æ–°ï¼š<span class="hljs-selector-attr">[A B E C D]</span>

ä»å°¾å¼€å§‹ï¼š
D â†’ match
</code></pre>
<hr/>
<h4 data-id="heading-6"><strong>ç¬¬ä¸‰é˜¶æ®µï¼šå¤„ç†ä¸­é—´ä¹±åºéƒ¨åˆ†ï¼ˆæ ¸å¿ƒï¼šLISï¼‰</strong></h4>
<p>åªå¯¹ä¸­é—´è¿™ä¸€æ®µåš Diffï¼š</p>
<pre><code class="hljs language-css" lang="css">æ—§ï¼š<span class="hljs-selector-attr">[C]</span>
æ–°ï¼š<span class="hljs-selector-attr">[E C]</span>
</code></pre>
<p>Vue3 ä¼šï¼š</p>
<ul>
<li>å»ºç«‹ key â†’ newIndex çš„æ˜ å°„</li>
<li>æ‰¾å‡ºæ–°åˆ—è¡¨ä¸­çš„<strong>æœ€é•¿é€’å¢å­åºåˆ—</strong>ï¼ˆLISï¼‰</li>
<li>å…¶ä»–èŠ‚ç‚¹ç§»åŠ¨æˆ–æ–°å»º</li>
</ul>
<p>ä¸ºä»€ä¹ˆç”¨ LISï¼Ÿ</p>
<blockquote>
<p>ä¿æŒæœ€é•¿ä¸åŠ¨åºåˆ—ï¼Œå‡å°‘ DOM ç§»åŠ¨æ¬¡æ•°ï¼Œè¿™æ˜¯æœ€ä¼˜ç§»åŠ¨ç­–ç•¥ã€‚</p>
</blockquote>
<hr/>
<h2 data-id="heading-7">2ï¸âƒ£ PatchFlagsï¼ˆç¼–è¯‘å™¨ç»™æ¯ä¸ªèŠ‚ç‚¹æ‰“æ ‡ç­¾ï¼‰</h2>
<p>PatchFlags æ˜¯ Vue3 æ€§èƒ½é£è¶Šçš„æ ¸å¿ƒã€‚</p>
<p>ä¾‹å¦‚ï¼š</p>
<pre><code class="hljs language-css" lang="css">&lt;<span class="hljs-selector-tag">div</span> :class=<span class="hljs-string">"theme"</span>&gt;{{ msg }}&lt;/<span class="hljs-selector-tag">div</span>&gt;
</code></pre>
<p>ç¼–è¯‘å™¨ä¼šè¿™æ ·æ ‡æ³¨ï¼š</p>
<ul>
<li><code>:class</code> æ˜¯åŠ¨æ€ç»‘å®š â†’ PatchFlag: CLASS</li>
<li><code>msg</code> æ˜¯åŠ¨æ€æ–‡æœ¬ â†’ PatchFlag: TEXT</li>
</ul>
<p>è¿è¡Œæ—¶åª patch <strong>æœ‰å˜åŒ–çš„éƒ¨åˆ†</strong>ã€‚</p>
<p><strong>âš¡ æ€§èƒ½æå¼ºï¼Œå› ä¸ºè·³è¿‡æ‰€æœ‰é™æ€èŠ‚ç‚¹ã€‚</strong></p>
<hr/>
<h2 data-id="heading-8">3ï¸âƒ£ é™æ€æå‡ï¼ˆstatic hoistingï¼‰</h2>
<p>Vue3 ä¼šæŠŠæ¨¡æ¿ä¸­æ°¸è¿œä¸ä¼šå˜çš„ DOM ç»“æ„æå‰æå‡åˆ°å¤–éƒ¨ï¼š</p>
<pre><code class="hljs language-css" lang="css">&lt;<span class="hljs-selector-tag">div</span>&gt;&lt;<span class="hljs-selector-tag">span</span>&gt;Hello&lt;/<span class="hljs-selector-tag">span</span>&gt;&lt;/<span class="hljs-selector-tag">div</span>&gt;
</code></pre>
<p>é™æ€æå‡åï¼š</p>
<pre><code class="hljs language-ini" lang="ini">const <span class="hljs-attr">_hoisted_1</span> = h(<span class="hljs-string">"span"</span>, <span class="hljs-string">"Hello"</span>)
</code></pre>
<p>æ¯æ¬¡æ¸²æŸ“ï¼š</p>
<ul>
<li>é™æ€ vnode å¤ç”¨</li>
<li>ä¸é‡æ–°åˆ›å»ºä¸ diff vnode</li>
</ul>
<p><strong>Vue2 æ¯æ¬¡ render éƒ½é‡æ–°åˆ›å»ºæ‰€æœ‰ vnode â†’ ä½æ•ˆ</strong></p>
<hr/>
<h2 data-id="heading-9">4ï¸âƒ£ Block Treeï¼ˆVue3 çš„é©å‘½æ€§è®¾è®¡ï¼‰</h2>
<p>Vue3 æŠŠç»„ä»¶æ‹†æˆä¸€ä¸ªä¸ª blockï¼Œæ¯ä¸ª block åª diff è‡ªå·±å†…éƒ¨çš„åŠ¨æ€èŠ‚ç‚¹åˆ—è¡¨ã€‚</p>
<p>ç¤ºä¾‹ï¼š</p>
<pre><code class="hljs language-css" lang="css">&lt;<span class="hljs-selector-tag">div</span>&gt;
  &lt;<span class="hljs-selector-tag">p</span>&gt;é™æ€&lt;/<span class="hljs-selector-tag">p</span>&gt;
  &lt;<span class="hljs-selector-tag">p</span>&gt;{{msg}}&lt;/<span class="hljs-selector-tag">p</span>&gt;
&lt;/<span class="hljs-selector-tag">div</span>&gt;
</code></pre>
<p>Vue ä¼šç”Ÿæˆç±»ä¼¼ç»“æ„ï¼š</p>
<pre><code class="hljs language-scss" lang="scss">Block root: only tracks [<span class="hljs-built_in">p</span>(msg)]
</code></pre>
<p>é™æ€éƒ¨åˆ†å®Œå…¨è·³è¿‡ã€‚</p>
<p><strong>Diff èŒƒå›´æ›´å°ï¼Œæ€§èƒ½æ›´é«˜ã€‚</strong></p>
<hr/>
<h2 data-id="heading-10">5ï¸âƒ£ ä¸ºä»€ä¹ˆ Vue3 æ¯” React18 æ›´å¿«ï¼Ÿ</h2>
<p>å› ä¸º Vue3 ä½¿ç”¨ <strong>æ¨¡æ¿ç¼–è¯‘æå‰åšå¤§é‡ä¼˜åŒ–</strong>ï¼š</p>
<ul>
<li>é™æ€æå‡</li>
<li>PatchFlags</li>
<li>Block Tree</li>
<li>ç¼–è¯‘æœŸç¡®å®šæœ€å°æ›´æ–°å•å…ƒ</li>
</ul>
<p>React æ˜¯çº¯è¿è¡Œæ—¶ï¼Œä¸çŸ¥é“è°æ˜¯åŠ¨æ€çš„ï¼Œæ¯æ¬¡ render éƒ½ diff å…¨é‡å­æ ‘ã€‚</p>
<hr/>
<h2 data-id="heading-11">ä¸‰ã€ä»£ç ç¤ºä¾‹ï¼šDiff æ‰§è¡Œè¿‡ç¨‹å¯è§†åŒ–åŠ¨ç”»ï¼ˆé¢è¯•å®˜ä¼šç‚¹å¤´ï¼‰</h2>
<p>æ—§èŠ‚ç‚¹ï¼š</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-tag">A</span> <span class="hljs-selector-tag">B</span> C D E F
</code></pre>
<p>æ–°èŠ‚ç‚¹ï¼š</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-tag">A</span> C E <span class="hljs-selector-tag">B</span> D G F
</code></pre>
<h4 data-id="heading-12">1. åŒç«¯æ¯”å¯¹é˜¶æ®µï¼š</h4>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">A</span> = A  â†’ ok
<span class="hljs-attr">F</span> = F  â†’ ok
</code></pre>
<p>ä¸­é—´åŒºåŸŸï¼š</p>
<p>æ—§ï¼šB C D E<br/>
æ–°ï¼šC E B D G</p>
<h4 data-id="heading-13">2. å»ºç«‹æ˜ å°„ï¼š</h4>
<pre><code class="hljs language-css" lang="css">C â†’ <span class="hljs-number">0</span>
E â†’ <span class="hljs-number">1</span>
<span class="hljs-selector-tag">B</span> â†’ <span class="hljs-number">2</span>
D â†’ <span class="hljs-number">3</span>
G â†’ <span class="hljs-number">4</span>
</code></pre>
<h4 data-id="heading-14">3. ç®— LIS â†’ [0,1,3] = C, E, D</h4>
<p>ä¿æŒä¸åŠ¨çš„èŠ‚ç‚¹ï¼šCã€Eã€D<br/>
è¦ç§»åŠ¨çš„ï¼šB<br/>
è¦æ–°å¢çš„ï¼šG</p>
<hr/>
<h2 data-id="heading-15">å››ã€é¢è¯•å®˜è¿½é—® &amp; é«˜åˆ†å›ç­”</h2>
<hr/>
<h3 data-id="heading-16">â“1. Vue3 Diff ä¸ Vue2 Diff çš„åŒºåˆ«ï¼Ÿ</h3>
<p>ä½ å¯ä»¥ç›´æ¥è¿™æ ·ç­”ï¼ˆé«˜åˆ†ï¼‰ï¼š</p>
<h4 data-id="heading-17"><strong>Vue2</strong></h4>
<ul>
<li>å…¨é‡åŒç«¯ diff</li>
<li>æ—  PatchFlags</li>
<li>æ— é™æ€æå‡</li>
<li>æ—  block tree</li>
</ul>
<h4 data-id="heading-18"><strong>Vue3</strong></h4>
<ul>
<li>æ›´æ™ºèƒ½çš„ diffï¼šåŒç«¯ + LIS</li>
<li>ç¼–è¯‘å™¨ä¼˜åŒ–ï¼šPatchFlags + static hoisting</li>
<li>block treeï¼šå‡å°‘ diff èŒƒå›´</li>
</ul>
<p><strong>æ€»ç»“ï¼šVue2 æ˜¯â€œçº¯è¿è¡Œæ—¶ diffâ€ï¼ŒVue3 æ˜¯â€œç¼–è¯‘ + è¿è¡Œæ—¶æ··åˆä¼˜åŒ– diffâ€ã€‚</strong></p>
<hr/>
<h3 data-id="heading-19">â“2. ä¸ºä»€ä¹ˆéœ€è¦æœ€é•¿é€’å¢å­åºåˆ—ï¼Ÿ</h3>
<p>ä¸ºäº†å‡å°‘ DOM ç§»åŠ¨æ¬¡æ•°ã€‚</p>
<p>æ²¡æœ‰ LISï¼š</p>
<ul>
<li>æ¯ä¸ªèŠ‚ç‚¹éƒ½è¦ç§»åŠ¨ â†’ æœ€å O(nÂ²)</li>
</ul>
<p>æœ‰ LISï¼š</p>
<ul>
<li>ç§»åŠ¨æœ€å°‘ï¼Œè¶‹è¿‘ä¼˜åŒ–åˆ° O(n log n)</li>
</ul>
<hr/>
<h3 data-id="heading-20">â“3. ä»€ä¹ˆæƒ…å†µä¸‹ Vue ä¸ç”¨ Diffï¼Ÿ</h3>
<p>ä»¥ä¸‹æƒ…å†µç›´æ¥å¤ç”¨ï¼š</p>
<ul>
<li>é™æ€èŠ‚ç‚¹</li>
<li>patchFlags æ ‡è¯†å®Œå…¨é™æ€çš„éƒ¨åˆ†</li>
<li>v-onceï¼ˆåªæ¸²æŸ“ä¸€æ¬¡ï¼‰</li>
<li>keyed children æœªå‘ç”Ÿä»»ä½•åŠ¨æ€å˜åŒ–</li>
</ul>
<hr/>
<h3 data-id="heading-21">â“4. key çš„ä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿ</h3>
<p>key æ˜¯ diff çš„çµé­‚ï¼Œè®©èŠ‚ç‚¹å¯å¤ç”¨ã€æœ‰èº«ä»½ã€‚</p>
<p>key ä¸å”¯ä¸€ä¼šå¯¼è‡´ï¼š</p>
<ul>
<li>patch é”™ä¹±</li>
<li>æ„æ–™ä¹‹å¤–çš„ DOM å¤ç”¨</li>
<li>input æ•°æ®é”™ä½</li>
</ul>
<hr/>
<h2 data-id="heading-22">äº”ã€é«˜åˆ†æ€»ç»“ï¼ˆèƒŒä¸‹æ¥èƒ½æ‰“å·¥åœ°çº§åˆ«ï¼‰</h2>
<blockquote>
<p>Vue3 çš„ diff æ˜¯ä¼˜åŒ–åçš„åŒç«¯ diff + LIS æœ€é•¿é€’å¢å­åºåˆ—ç®—æ³•ï¼Œå¹¶ç»“åˆç¼–è¯‘å™¨çš„ PatchFlagsã€é™æ€æå‡ã€Block Treeï¼Œå¤§å¹…å‡å°‘ vnode åˆ›å»ºæ•°é‡å’Œ diff èŒƒå›´ï¼Œæ˜¯ç›®å‰å‰ç«¯æ¡†æ¶ä¸­æœ€æ¿€è¿›çš„è¿è¡Œ + ç¼–è¯‘æ··åˆä¼˜åŒ–æ–¹å¼ï¼Œæ¯” Vue2 å’Œ React éƒ½æ›´å¿«ã€‚</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ç¬¬ 29 é¢˜ï¼šVue3 çš„ Teleport åŸç†ï¼ˆè·¨å±‚çº§ DOM æŒ‚è½½æŠ€æœ¯ï¼‰]]></title>    <link>https://juejin.cn/post/7579256547797909545</link>    <guid>https://juejin.cn/post/7579256547797909545</guid>    <pubDate>2025-12-03T04:48:02.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7579256547797909545" data-draft-id="7579213860571299894" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ç¬¬ 29 é¢˜ï¼šVue3 çš„ Teleport åŸç†ï¼ˆè·¨å±‚çº§ DOM æŒ‚è½½æŠ€æœ¯ï¼‰"/> <meta itemprop="keywords" content="å‰ç«¯,é¢è¯•"/> <meta itemprop="datePublished" content="2025-12-03T04:48:02.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å‰ç«¯ä¸€è¯¾"/> <meta itemprop="url" content="https://juejin.cn/user/1169536102963917"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ç¬¬ 29 é¢˜ï¼šVue3 çš„ Teleport åŸç†ï¼ˆè·¨å±‚çº§ DOM æŒ‚è½½æŠ€æœ¯ï¼‰
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1169536102963917/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å‰ç«¯ä¸€è¯¾
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-03T04:48:02.000Z" title="Wed Dec 03 2025 04:48:02 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-03
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»3åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0"><strong>ç¬¬ 28 é¢˜ï¼šVue3 çš„ Teleport åŸç†ï¼ˆè·¨å±‚çº§ DOM æŒ‚è½½æŠ€æœ¯ï¼‰</strong></h2>
<hr/>
<h2 data-id="heading-1">ğŸ¯ ä¸€ã€æ ¸å¿ƒå›ç­”ï¼ˆé¢è¯•å®˜æœ€æƒ³å¬ï¼‰</h2>
<p><code>&lt;Teleport&gt;</code> æ˜¯ Vue3 æä¾›çš„ä¸€ä¸ªå†…ç½®ç»„ä»¶ï¼Œç”¨æ¥<strong>æŠŠç»„ä»¶çš„ DOM æ¸²æŸ“åˆ°æŒ‡å®šå®¹å™¨ï¼ˆä»»æ„ DOM èŠ‚ç‚¹ï¼‰</strong> ï¼Œè€Œä¸å—ç»„ä»¶å±‚çº§é™åˆ¶ã€‚</p>
<p>å®ƒçš„åŸç†æ˜¯ï¼š</p>
<ol>
<li>è™šæ‹Ÿ DOM ä»ç„¶å±äºåŸçˆ¶ç»„ä»¶</li>
<li><strong>ä½†æ¸²æŸ“ DOM æ—¶ï¼Œpatch é˜¶æ®µæŠŠçœŸå® DOM æ’å…¥åˆ°æŒ‡å®šçš„ target èŠ‚ç‚¹</strong></li>
<li>Vue é€šè¿‡ â€œ<strong>åˆ†ç¦» vnode æ ‘å’Œ DOM æ ‘</strong>â€ æ¥å®ç°æ¸²æŸ“è„±ç¦»çˆ¶çº§ç»„ä»¶ç»“æ„ã€‚</li>
</ol>
<p>ä¹Ÿå°±æ˜¯è¯´ï¼š</p>
<ul>
<li><strong>VNode ç»“æ„ä¸æ”¹å˜</strong></li>
<li><strong>DOM æŒ‚è½½ä½ç½®æ”¹å˜</strong></li>
</ul>
<hr/>
<h2 data-id="heading-2">ğŸ¯ äºŒã€æ·±åº¦åŸç†ï¼ˆé¢è¯•å®˜ä¼šè§‰å¾—ä½ ä¸“ä¸šï¼‰</h2>
<hr/>
<h2 data-id="heading-3">1ï¸âƒ£ Teleport æ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Ÿ</h2>
<p>Vue3 ä¸­ Teleport çš„æ¸²æŸ“å™¨æä¾›äº†ä¸¤ä¸ªæµç¨‹ï¼š</p>
<h4 data-id="heading-4"><strong>1. ç”Ÿæˆ VNodeï¼šä»åœ¨åŸæ¥çš„ç»„ä»¶æ ‘å†…</strong></h4>
<p>Teleport çš„ children ä»ç„¶æ˜¯çˆ¶ç»„ä»¶çš„ä¸€éƒ¨åˆ†ï¼š</p>
<pre><code class="hljs language-css" lang="css">const vnode = h(
  Teleport,
  { <span class="hljs-selector-tag">to</span>: <span class="hljs-string">'#modal'</span> },
  <span class="hljs-selector-attr">[h(<span class="hljs-string">'div'</span>, <span class="hljs-string">'content'</span>)]</span>
)
</code></pre>
<p>VNode æ ‘ä¿æŒåŸç»“æ„ã€‚</p>
<hr/>
<h4 data-id="heading-5"><strong>2. åœ¨ patch é˜¶æ®µï¼šDOM æŒ‚è½½åˆ°æŒ‡å®š target</strong></h4>
<p>æµç¨‹ï¼š</p>
<pre><code class="hljs language-dart" lang="dart">parent vnode   --è™šæ‹Ÿå…³ç³»--&gt; teleport vnode
        â”‚
        â–¼
çœŸå® DOM ä¸æŒ‚åœ¨ parent ä¸‹ï¼Œè€Œæ˜¯æŒ‚åœ¨ <span class="hljs-built_in">document</span>.<span class="hljs-built_in">querySelector</span>(<span class="hljs-string">'#modal'</span>)
</code></pre>
<p>Vue å†…éƒ¨ä½¿ç”¨ï¼š</p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-built_in">hostInsert</span>(child, target)
</code></pre>
<p>è€Œä¸æ˜¯é»˜è®¤æ’å…¥çˆ¶èŠ‚ç‚¹ã€‚</p>
<p><strong>æ‰€ä»¥ Teleport æ”¹å˜çš„æ˜¯ DOM æ’å…¥ä½ç½®ï¼Œè€Œä¸æ˜¯ç»„ä»¶å±‚çº§å…³ç³»ã€‚</strong></p>
<hr/>
<h3 data-id="heading-6">2ï¸âƒ£ Teleport çš„æ ¸å¿ƒæ¸²æŸ“é€»è¾‘ï¼ˆä¼ªä»£ç ï¼‰</h3>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-comment">// ç®€åŒ–ç‰ˆä¼ªä»£ç </span>
if (n1 === null) {
  <span class="hljs-comment">// åˆæ¬¡æ¸²æŸ“</span>
  <span class="hljs-built_in">mountChildren</span>(n2.children, targetContainer)
} else {
  <span class="hljs-comment">// æ›´æ–°</span>
  <span class="hljs-built_in">patchChildren</span>(n1.children, n2.children, targetContainer)
}
</code></pre>
<p>å…³é”®ç‚¹ï¼š</p>
<ul>
<li>targetContainer â˜… æ˜¯ Teleport çš„ to å±æ€§æŒ‡å®šçš„ DOM</li>
<li>children æ°¸è¿œåœ¨ targetContainer ä¸‹æ¸²æŸ“</li>
</ul>
<hr/>
<h3 data-id="heading-7">3ï¸âƒ£ DOM æ ‘ä¸ç»„ä»¶æ ‘åˆ†ç¦»ï¼ˆå…³é”®ï¼‰</h3>
<h4 data-id="heading-8"><strong>ç»„ä»¶æ ‘ï¼ˆé€»è¾‘ç»“æ„ï¼‰</strong></h4>
<pre><code class="hljs language-css" lang="css">App
 â””â”€ Dialog
     â””â”€ Teleport
         â””â”€ <span class="hljs-attribute">content</span>
</code></pre>
<h4 data-id="heading-9"><strong>DOM æ ‘ï¼ˆçœŸå®ç»“æ„ï¼‰</strong></h4>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"app"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"modal"</span>&gt;</span>
      content  â† Teleport æ¸²æŸ“åœ¨è¿™é‡Œ
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
</code></pre>
<p><strong>ç»„ä»¶ä¾èµ–ã€çŠ¶æ€ä¾ç„¶åœ¨åŸä½ç½®ï¼Œä½†æ¸²æŸ“ä½ç½®è¢«æ”¹å˜ã€‚</strong></p>
<hr/>
<h3 data-id="heading-10">4ï¸âƒ£ Teleport åŠ¨æ€ target åˆ‡æ¢</h3>
<p>Vue3 å…è®¸ï¼š</p>
<pre><code class="hljs language-ini" lang="ini">&lt;Teleport :<span class="hljs-attr">to</span>=<span class="hljs-string">"isBigScreen ? 'body' : '#panel'"</span>&gt;
</code></pre>
<p>åˆ‡æ¢ target åï¼š</p>
<ul>
<li>Vue ä¼šæŠŠåŸæ¥çš„ DOM ä»æ—§ target æ‹¿å‡ºæ¥</li>
<li>append åˆ°æ–°çš„ target</li>
<li>ä¸é‡å»ºç»„ä»¶å®ä¾‹ï¼Œä¸è§¦å‘ unmount</li>
</ul>
<hr/>
<h2 data-id="heading-11">ğŸ¯ ä¸‰ã€Teleport ä½¿ç”¨ç¤ºä¾‹</h2>
<hr/>
<h3 data-id="heading-12">1ï¼‰å¸¸è§åœºæ™¯ï¼šå¼¹çª—ã€æ¶ˆæ¯æç¤º</h3>
<pre><code class="hljs language-ini" lang="ini">&lt;Teleport <span class="hljs-attr">to</span>=<span class="hljs-string">"body"</span>&gt;
  &lt;div <span class="hljs-attr">class</span>=<span class="hljs-string">"modal"</span>&gt;I am modal&lt;/div&gt;
&lt;/Teleport&gt;
</code></pre>
<hr/>
<h3 data-id="heading-13">2ï¼‰å¤šä¸ªå†…å®¹åŒæ—¶ Teleport</h3>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">Teleport</span> <span class="hljs-attr">to</span>=<span class="hljs-string">"#sidebar"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">Menu</span> /&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">Teleport</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">Teleport</span> <span class="hljs-attr">to</span>=<span class="hljs-string">"#modal"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">Dialog</span> /&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">Teleport</span>&gt;</span>
</code></pre>
<hr/>
<h3 data-id="heading-14">3ï¼‰åŠ¨æ€åˆ‡æ¢ Teleport ç›®æ ‡</h3>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">Teleport</span> <span class="hljs-attr">:to</span>=<span class="hljs-string">"target"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>Content<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">Teleport</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">const</span> target = <span class="hljs-title function_">ref</span>(<span class="hljs-string">'#container1'</span>)
<span class="hljs-comment">// åŠ¨æ€åˆ‡æ¢</span>
<span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> target.<span class="hljs-property">value</span> = <span class="hljs-string">'#container2'</span>, <span class="hljs-number">2000</span>)
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
</code></pre>
<p>Vue ä¼šè‡ªåŠ¨ç§»åŠ¨çœŸå® DOMã€‚</p>
<hr/>
<h2 data-id="heading-15">ğŸ¯ å››ã€é¢è¯•å®˜è¿½é—® + é«˜åˆ†å›ç­”</h2>
<hr/>
<h3 data-id="heading-16">â“1ï¼šTeleport ä¸ºä»€ä¹ˆä¸ä¼šç ´åç»„ä»¶çš„å“åº”å¼ï¼Ÿ</h3>
<p>é«˜åˆ†å›ç­”ï¼š</p>
<p>å› ä¸º Teleport <strong>åªæ”¹å˜ DOM æ¸²æŸ“ä½ç½®</strong>ï¼Œä¸æ”¹å˜ç»„ä»¶å®ä¾‹æ‰€å±ä½ç½®ã€‚</p>
<ul>
<li>reactiveã€computedã€watch éƒ½åœ¨åŸç»„ä»¶æ ‘æ‰§è¡Œ</li>
<li>setup ä½œç”¨åŸŸä¸å˜</li>
<li>propsã€emit ä¸å˜</li>
</ul>
<p>åªæœ‰ DOM æŒ‚è½½ç‚¹è¢«æ”¹å˜ï¼Œé€»è¾‘å®Œå…¨ä¸å—å½±å“ã€‚</p>
<hr/>
<h3 data-id="heading-17">â“2ï¼šTeleport ä¸ Portal çš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿï¼ˆReactï¼‰</h3>
<p>ï¼ˆè¿™æ˜¯é«˜åˆ†é¢˜ï¼‰</p>
<p>Vue Teleport == React Portalã€‚</p>
<p>åŒºåˆ«ï¼š</p>
<ul>
<li>Vue Teleport æ·±åº¦æ•´åˆæ¨¡æ¿ç¼–è¯‘ + å“åº”å¼ç³»ç»Ÿ</li>
<li>React Portal åªæ˜¯â€œDOM æŒ‚è½½ä½ç½®æ”¹å˜â€ï¼Œæ²¡æœ‰å“åº”å¼é›†æˆ</li>
</ul>
<hr/>
<h3 data-id="heading-18">â“3ï¼šTeleport ä¼šå¯¼è‡´äº‹ä»¶å†’æ³¡æ··ä¹±å—ï¼Ÿ</h3>
<p>ä¸ä¼šã€‚</p>
<p>å³ä½¿ DOM è¢«ç§»åŠ¨ï¼š</p>
<ul>
<li><strong>äº‹ä»¶å†’æ³¡ä»æ²¿ç€ç»„ä»¶æ ‘å†’æ³¡ï¼Œè€Œé DOM æ ‘</strong></li>
<li>Vue ç”¨ synthetic events ç³»ç»Ÿç»Ÿä¸€å¤„ç†äº‹ä»¶</li>
</ul>
<hr/>
<h3 data-id="heading-19">â“4ï¼šTeleport ä¼šé€ æˆå†…å­˜æ³„æ¼å—ï¼Ÿ</h3>
<p>åªè¦ï¼š</p>
<ul>
<li>æœ‰ key</li>
<li>æ­£å¸¸ unmount</li>
</ul>
<p>ä¸ä¼šæ³„æ¼ã€‚</p>
<p>Vue ä¼šåœ¨ unmount æ—¶ï¼š</p>
<ul>
<li>è°ƒç”¨ unmountChildren()</li>
<li>ç§»é™¤ DOM</li>
<li>æ–­å¼€ effect</li>
</ul>
<hr/>
<h3 data-id="heading-20">â“5ï¼šTeleport é€‚åˆç”¨åœ¨ä»€ä¹ˆåœºæ™¯ï¼Ÿ</h3>
<p>é«˜é¢‘ï¼š</p>
<ul>
<li>modal å¼¹çª—</li>
<li>tooltip</li>
<li>popover</li>
<li>loading</li>
<li>dropdown ä¸‹æ‹‰æ¡†</li>
<li>context menu</li>
<li>sidebar drawer</li>
</ul>
<p>å‡¡æ˜¯å¸Œæœ› DOM ä¸å—çˆ¶èŠ‚ç‚¹ overflow/å®šä½å½±å“çš„ UIï¼Œéƒ½é€‚åˆ Teleportã€‚</p>
<hr/>
<h2 data-id="heading-21">ğŸ¯ äº”ã€é«˜åˆ†æ€»ç»“ï¼ˆèƒŒä¸‹æ¥é¢è¯•å¿…è¿‡ï¼‰</h2>
<blockquote>
<p>Teleport æœ¬è´¨æ˜¯åŸºäº renderer çš„ DOM æ’å…¥èƒ½åŠ›æ‰©å±•ï¼Œé€šè¿‡åœ¨ vnode æ¸²æŸ“é˜¶æ®µå°†çœŸå® DOM å…ƒç´ æŒ‚è½½åˆ°æŒ‡å®šçš„ target DOM ä¸­ï¼Œå®ç°<strong>ç»„ä»¶æ ‘ä¸ DOM æ ‘åˆ†ç¦»</strong>ã€‚<br/>
å“åº”å¼ä¾æ—§åœ¨åŸç»„ä»¶æ ‘ç”Ÿæ•ˆï¼Œåªæœ‰ DOM ç»“æ„å‘ç”Ÿæ”¹å˜ï¼Œå› æ­¤å¯ä»¥ç”¨äºå¼¹çª—ã€ä¸‹æ‹‰ã€æç¤ºã€å…¨å±€æŒ‚è½½ç±» UI çš„æ¸²æŸ“ï¼Œæ˜¯ Vue3 UI ä½“ç³»çš„é‡è¦åŸºç¡€ã€‚</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ç¬¬ 31 é¢˜ï¼šVue3 ä¸­ watchEffect çš„åŸç†ï¼ˆä¾èµ–è‡ªåŠ¨è¿½è¸ª + æ¸…ç†æœºåˆ¶ + ReactiveEffect å…¨æµç¨‹ï¼‰]]></title>    <link>https://juejin.cn/post/7579256547797925929</link>    <guid>https://juejin.cn/post/7579256547797925929</guid>    <pubDate>2025-12-03T04:49:37.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7579256547797925929" data-draft-id="7579213860571332662" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ç¬¬ 31 é¢˜ï¼šVue3 ä¸­ watchEffect çš„åŸç†ï¼ˆä¾èµ–è‡ªåŠ¨è¿½è¸ª + æ¸…ç†æœºåˆ¶ + ReactiveEffect å…¨æµç¨‹ï¼‰"/> <meta itemprop="keywords" content="å‰ç«¯,é¢è¯•"/> <meta itemprop="datePublished" content="2025-12-03T04:49:37.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å‰ç«¯ä¸€è¯¾"/> <meta itemprop="url" content="https://juejin.cn/user/1169536102963917"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ç¬¬ 31 é¢˜ï¼šVue3 ä¸­ watchEffect çš„åŸç†ï¼ˆä¾èµ–è‡ªåŠ¨è¿½è¸ª + æ¸…ç†æœºåˆ¶ + ReactiveEffect å…¨æµç¨‹ï¼‰
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1169536102963917/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å‰ç«¯ä¸€è¯¾
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-03T04:49:37.000Z" title="Wed Dec 03 2025 04:49:37 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-03
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»3åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0"><strong>ç¬¬ 30 é¢˜ï¼šVue3 ä¸­ watchEffect çš„åŸç†ï¼ˆä¾èµ–è‡ªåŠ¨è¿½è¸ª + æ¸…ç†æœºåˆ¶ + ReactiveEffect å…¨æµç¨‹ï¼‰</strong></h2>
<p>ä¾æ—§é‡‡ç”¨ï¼š<br/>
<strong>æ ¸å¿ƒå›ç­” â†’ æ·±åº¦åŸç† â†’ æºç æµç¨‹å›¾ â†’ ä¾‹å­ â†’ é¢è¯•è¿½é—® â†’ é‡‘ç‰Œæ€»ç»“</strong></p>
<hr/>
<h2 data-id="heading-1">ğŸ¯ ä¸€ã€æ ¸å¿ƒå›ç­”ï¼ˆé¢è¯•å¿…ç­”ç‰ˆï¼‰</h2>
<p><code>watchEffect</code> çš„æ ¸å¿ƒåŸç†æ˜¯ï¼š</p>
<blockquote>
<p><strong>è‡ªåŠ¨ä¾èµ–æ”¶é›† + è‡ªåŠ¨è§¦å‘ + è‡ªåŠ¨æ¸…ç†</strong><br/>
å®ƒä¼šç«‹å³æ‰§è¡Œä¸€æ¬¡å›è°ƒï¼Œå¹¶åœ¨è®¿é—®å“åº”å¼æ•°æ®æ—¶æ”¶é›†ä¾èµ–ï¼›å½“ä¾èµ–å˜åŒ–æ—¶è‡ªåŠ¨é‡æ–°æ‰§è¡Œã€‚</p>
</blockquote>
<p>ä¸ <code>watch</code> æœ€å¤§åŒºåˆ«ï¼š</p>
<ul>
<li><code>watchEffect</code>ï¼š<strong>è‡ªåŠ¨æ”¶é›†ä¾èµ–ï¼ˆç”¨åˆ°äº†ä»€ä¹ˆå°±ç›‘å¬ä»€ä¹ˆï¼‰</strong></li>
<li><code>watch</code>ï¼š<strong>éœ€è¦ä½ æ‰‹åŠ¨æŒ‡å®šä¾èµ–æº</strong></li>
</ul>
<p>å†…éƒ¨ä¾é ï¼š</p>
<ul>
<li><code>ReactiveEffect</code>ï¼ˆeffect å®ä¾‹ï¼‰</li>
<li><code>track() / trigger()</code>ï¼ˆä¾èµ–æ”¶é›† / è§¦å‘æœºåˆ¶ï¼‰</li>
<li><code>cleanupEffect()</code>ï¼ˆæ¸…ç†æ—§å‰¯ä½œç”¨ï¼‰</li>
</ul>
<hr/>
<h2 data-id="heading-2">ğŸ¯ äºŒã€æ·±åº¦åŸç†ï¼šwatchEffect å†…éƒ¨åˆ°åº•åšäº†ä»€ä¹ˆï¼Ÿ</h2>
<p>å½“ä½ å†™ï¼š</p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-built_in">watchEffect</span>(() =&gt; {
  console<span class="hljs-selector-class">.log</span>(obj.count)
})
</code></pre>
<p>Vue åšäº†ä»¥ä¸‹äº‹æƒ…ï¼š</p>
<hr/>
<h3 data-id="heading-3">1ï¸âƒ£ åˆ›å»ºä¸€ä¸ª ReactiveEffect å®ä¾‹</h3>
<pre><code class="hljs language-php" lang="php"><span class="hljs-keyword">const</span> <span class="hljs-variable constant_">effect</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ReactiveEffect</span>(<span class="hljs-function"><span class="hljs-keyword">fn</span>, <span class="hljs-title">scheduler</span>)
</span></code></pre>
<p>ReactiveEffect æ˜¯å“åº”å¼ç³»ç»Ÿçš„æ ¸å¿ƒï¼š</p>
<ul>
<li>è®°å½•å½“å‰æ­£åœ¨è¿è¡Œçš„å‰¯ä½œç”¨</li>
<li>ç»´æŠ¤ä¾èµ–é›†åˆ deps</li>
<li>æ§åˆ¶æ‰§è¡Œæ—¶æœº</li>
</ul>
<hr/>
<h3 data-id="heading-4">2ï¸âƒ£ ç«‹å³æ‰§è¡Œ fnï¼ˆä¸ watch ä¸åŒï¼‰</h3>
<p>watchEffect ä¸éœ€è¦æŒ‡å®šä¾èµ–<br/>
å®ƒä¼š<strong>å…ˆè¿è¡Œä¸€æ¬¡</strong>å›è°ƒï¼Œè¿™ä¸€æ­¥éå¸¸å…³é”®ï¼š</p>
<pre><code class="hljs language-scss" lang="scss">effect<span class="hljs-selector-class">.run</span>()
</code></pre>
<hr/>
<h3 data-id="heading-5">3ï¸âƒ£ æ‰§è¡Œ fn æ—¶è®¿é—®å“åº”å¼æ•°æ® â†’ track()</h3>
<p>å½“æ‰§è¡Œ <code>obj.count</code> æ—¶ï¼š</p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-built_in">track</span>(obj, 'count')
</code></pre>
<p>Vue å°†ï¼š</p>
<ul>
<li>effect è®°å½•åˆ° obj.count çš„ä¾èµ–åˆ—è¡¨ä¸­</li>
<li>obj.count ä¹Ÿè®°å½•å®ƒä¾èµ–çš„æ‰€æœ‰ effect</li>
</ul>
<p>å®Œæ•´ç»“æ„æ˜¯è¿™æ ·ï¼š</p>
<pre><code class="hljs language-css" lang="css">depMap: {
  obj: {
    count: [effect]
  }
}
</code></pre>
<hr/>
<h3 data-id="heading-6">4ï¸âƒ£ å½“ count æ”¹å˜æ—¶ â†’ trigger()</h3>
<p>å½“ä½ å†™ï¼š</p>
<pre><code class="hljs">obj.count++
</code></pre>
<p>Vue å†…éƒ¨æ‰§è¡Œï¼š</p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-built_in">trigger</span>(obj, 'count')
</code></pre>
<p>æ‰¾åˆ°æ‰€æœ‰ä¾èµ–ï¼ˆeffectï¼‰ï¼Œå¹¶è°ƒåº¦æ‰§è¡Œã€‚</p>
<hr/>
<h3 data-id="heading-7">5ï¸âƒ£ è°ƒåº¦æ‰§è¡Œï¼ˆschedulerï¼‰</h3>
<p><code>watchEffect</code> ä¼šç»™ effect æ³¨å…¥ä¸€ä¸ª schedulerï¼š</p>
<pre><code class="hljs language-scss" lang="scss">scheduler = () =&gt; <span class="hljs-built_in">queueEffect</span>(effect.run)
</code></pre>
<p>ä½œç”¨ï¼š</p>
<ul>
<li>æ‰¹é‡æ‰§è¡Œï¼ˆé¿å…é‡å¤ runï¼‰</li>
<li>nextTick åæ‰§è¡Œ</li>
<li>æ§åˆ¶æ‰§è¡Œé¡ºåº</li>
</ul>
<hr/>
<h3 data-id="heading-8">6ï¸âƒ£ cleanup æ¸…ç†æœºåˆ¶</h3>
<p>æ¯æ¬¡æ‰§è¡Œ effect å‰ï¼š</p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-built_in">cleanupEffect</span>(effect)
</code></pre>
<p>ä½œç”¨ï¼š</p>
<ul>
<li>åˆ é™¤ effect å¯¹æ—§ä¾èµ–çš„ç»‘å®š</li>
<li>é¿å…æ­»å¾ªç¯</li>
<li>å¤šæ¬¡æ‰§è¡Œä¼šé‡æ–°æ”¶é›†ä¾èµ–</li>
</ul>
<p>ä½ å¯ä»¥è‡ªå·±å†™æ”¶é›†å˜åŒ–ä¾èµ–ï¼š</p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-built_in">watchEffect</span>(() =&gt; {
  if (flag.value) {
    console<span class="hljs-selector-class">.log</span>(a.value)
  } else {
    console<span class="hljs-selector-class">.log</span>(b.value)
  }
})
</code></pre>
<p>ç¬¬ä¸€æ¬¡è®¿é—® a<br/>
ç¬¬äºŒæ¬¡è®¿é—® b</p>
<p>cleanupEffect ä¼šæ¸…ç†æ—§ a çš„ä¾èµ–ã€‚</p>
<hr/>
<h2 data-id="heading-9">ğŸ¯ ä¸‰ã€æºç çº§æµç¨‹å›¾ï¼ˆå¼ºçƒˆæ¨èèƒŒï¼‰</h2>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-built_in">watchEffect</span>(fn)
  â†“
<span class="hljs-built_in">ReactiveEffect</span>(fn)
  â†“
effect<span class="hljs-selector-class">.run</span>()
  â†“ï¼ˆè¿è¡Œ fnï¼‰
è®¿é—®å“åº”å¼æ•°æ® â†’ <span class="hljs-built_in">track</span>(effect)
  â†“
æ•°æ®å˜åŒ– â†’ <span class="hljs-built_in">trigger</span>()
  â†“
<span class="hljs-built_in">scheduler</span>(effect)
  â†“
<span class="hljs-built_in">cleanupEffect</span>()
  â†“
effect<span class="hljs-selector-class">.run</span>()ï¼ˆé‡æ–°æ‰§è¡Œï¼‰
</code></pre>
<p>è¿™æ˜¯ Vue3 å“åº”å¼ç³»ç»Ÿæœ€é‡è¦çš„æµç¨‹å›¾ä¹‹ä¸€ã€‚</p>
<hr/>
<h2 data-id="heading-10">ğŸ¯ å››ã€çœŸå®ç¤ºä¾‹ï¼šè‡ªåŠ¨ä¾èµ–åˆ‡æ¢</h2>
<pre><code class="hljs language-scss" lang="scss">const flag = <span class="hljs-built_in">ref</span>(true)
const <span class="hljs-selector-tag">a</span> = <span class="hljs-built_in">ref</span>(<span class="hljs-number">1</span>)
const <span class="hljs-selector-tag">b</span> = <span class="hljs-built_in">ref</span>(<span class="hljs-number">2</span>)

<span class="hljs-built_in">watchEffect</span>(() =&gt; {
  console<span class="hljs-selector-class">.log</span>(flag.value ? a.value : b.value)
})
</code></pre>
<p>æ‰§è¡Œé¡ºåºï¼š</p>
<ol>
<li>åˆæ¬¡æ‰§è¡Œ â†’ è®¿é—® a â†’ æ”¶é›† a çš„ä¾èµ–</li>
<li>flag æ”¹æˆ falseï¼Œé‡æ–°æ‰§è¡Œ â†’ æ¸…ç† a ä¾èµ– â†’ æ”¶é›† b ä¾èµ–</li>
<li>a.value++ â†’ ä¸ä¼šè§¦å‘ effect</li>
<li>b.value++ â†’ ä¼šè§¦å‘ effect</li>
</ol>
<p>é—®åˆ°è¿™é‡Œç»å¯¹æ˜¯é«˜åˆ†ã€‚</p>
<hr/>
<h2 data-id="heading-11">ğŸ¯ äº”ã€å¸¸è§é¢è¯•å®˜è¿½é—®ï¼ˆé™„ç­”æ³•ï¼‰</h2>
<hr/>
<h3 data-id="heading-12">â“1ï¼šwatchEffect ä¸ºä»€ä¹ˆèƒ½â€œè‡ªåŠ¨çŸ¥é“ä¾èµ–â€ï¼Ÿ</h3>
<p>å› ä¸ºæ‰§è¡Œå›è°ƒæ—¶ï¼ŒVue ä¼šï¼š</p>
<ul>
<li>è®¾ç½® activeEffect</li>
<li>æ¯æ¬¡è¯»å–å“åº”å¼æ•°æ®éƒ½ä¼šè°ƒç”¨ trackï¼Œè‡ªåŠ¨æŠŠ activeEffect å­˜è¿›å»</li>
</ul>
<p>æ¢å¥è¯è®²ï¼š</p>
<blockquote>
<p><strong>effect çš„æ‰§è¡Œ = é¡ºä¾¿æ”¶é›†ä¾èµ–</strong></p>
</blockquote>
<hr/>
<h3 data-id="heading-13">â“2ï¼šwatchEffect å’Œ computed çš„å†…éƒ¨å…³ç³»æ˜¯ä»€ä¹ˆï¼Ÿ</h3>
<p>å›ç­”è¦é‡ç‚¹å¼ºè°ƒï¼š</p>
<ul>
<li>äºŒè€…éƒ½æ˜¯ ReactiveEffect</li>
<li>computed æ˜¯ lazy effectï¼ˆåªæœ‰è®¿é—® value æ‰æ‰§è¡Œï¼‰</li>
<li>watchEffect æ˜¯ active effectï¼ˆç«‹å³æ‰§è¡Œï¼‰</li>
</ul>
<hr/>
<h3 data-id="heading-14">â“3ï¼šä¸ºä»€ä¹ˆ watchEffect æœ‰ cleanupï¼Ÿ</h3>
<p>å› ä¸ºæ‰§è¡Œå®Œä¸€æ¬¡åï¼Œä¸‹ä¸€æ¬¡ä¾èµ–å¯èƒ½æ”¹å˜<br/>
ä¾‹å¦‚æ¡ä»¶åˆ†æ”¯ï¼š</p>
<pre><code class="hljs language-perl" lang="perl"><span class="hljs-keyword">if</span> (flag) <span class="hljs-keyword">use</span> a
<span class="hljs-keyword">else</span> <span class="hljs-keyword">use</span> b
</code></pre>
<p>æ²¡æœ‰ cleanup ä¼šå¯¼è‡´ï¼š</p>
<ul>
<li>ä¾èµ–æ±¡æŸ“</li>
<li>ä¸å¿…è¦çš„è§¦å‘</li>
<li>å†…å­˜æ³„æ¼</li>
</ul>
<hr/>
<h3 data-id="heading-15">â“4ï¼šwatchEffect ä¼šä¸ä¼šæ­»å¾ªç¯ï¼Ÿ</h3>
<p>ä¼šï¼Œå¦‚æœä½ è¿™æ ·å†™ï¼š</p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-built_in">watchEffect</span>(() =&gt; {
  obj<span class="hljs-selector-class">.count</span>++
})
</code></pre>
<p>å› ä¸ºæ‰§è¡Œ effect ä¼šå†æ¬¡æ”¹æ•°æ®ï¼Œåˆè§¦å‘ effectã€‚</p>
<p>é¿å…æ–¹æ³•ï¼š</p>
<ul>
<li>ä½¿ç”¨ watch</li>
<li>åœ¨å›è°ƒå†…éƒ¨ä¸è¦ç›´æ¥ä¿®æ”¹ä¾èµ–æº</li>
</ul>
<hr/>
<h2 data-id="heading-16">ğŸ¯ å…­ã€é‡‘ç‰Œæ€»ç»“ï¼ˆé¢è¯•å®˜éå¸¸å–œæ¬¢å¬ï¼‰</h2>
<blockquote>
<p>watchEffect = è‡ªåŠ¨ä¾èµ–è¿½è¸ª + è‡ªåŠ¨æ¸…ç† + scheduler è°ƒåº¦æ‰§è¡Œã€‚<br/>
æ‰§è¡Œæ—¶ä¼šè®¿é—®å“ªäº›æ•°æ®ï¼Œå°±ä¼šè¢«è‡ªåŠ¨æ”¶é›†ä¸ºä¾èµ–ï¼›ä¾èµ–å˜åŒ–åé‡æ–°æ‰§è¡Œ effectã€‚<br/>
æ ¸å¿ƒæ˜¯ ReactiveEffect + track/trigger æœºåˆ¶ï¼Œæ˜¯ Vue3 å“åº”å¼ç³»ç»Ÿæœ€é‡è¦çš„ç»„æˆéƒ¨åˆ†ä¹‹ä¸€ã€‚</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ç¬¬ 30 é¢˜ï¼šVue3 è‡ªå®šä¹‰æ¸²æŸ“å™¨ï¼ˆCustom Rendererï¼‰åŸç†- ä¸ºä»€ä¹ˆ Vue èƒ½æ¸²æŸ“åˆ° DOM / Canvas / WebGL / ä¸‰æ–¹å¹³å°]]></title>    <link>https://juejin.cn/post/7579229538791243782</link>    <guid>https://juejin.cn/post/7579229538791243782</guid>    <pubDate>2025-12-03T04:48:53.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7579229538791243782" data-draft-id="7579213860571316278" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ç¬¬ 30 é¢˜ï¼šVue3 è‡ªå®šä¹‰æ¸²æŸ“å™¨ï¼ˆCustom Rendererï¼‰åŸç†- ä¸ºä»€ä¹ˆ Vue èƒ½æ¸²æŸ“åˆ° DOM / Canvas / WebGL / ä¸‰æ–¹å¹³å°"/> <meta itemprop="keywords" content="å‰ç«¯,é¢è¯•"/> <meta itemprop="datePublished" content="2025-12-03T04:48:53.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å‰ç«¯ä¸€è¯¾"/> <meta itemprop="url" content="https://juejin.cn/user/1169536102963917"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ç¬¬ 30 é¢˜ï¼šVue3 è‡ªå®šä¹‰æ¸²æŸ“å™¨ï¼ˆCustom Rendererï¼‰åŸç†- ä¸ºä»€ä¹ˆ Vue èƒ½æ¸²æŸ“åˆ° DOM / Canvas / WebGL / ä¸‰æ–¹å¹³å°
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1169536102963917/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å‰ç«¯ä¸€è¯¾
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-03T04:48:53.000Z" title="Wed Dec 03 2025 04:48:53 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-03
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»3åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0"><strong>ç¬¬ 29 é¢˜ï¼šVue3 è‡ªå®šä¹‰æ¸²æŸ“å™¨ï¼ˆCustom Rendererï¼‰åŸç† â€”â€” ä¸ºä»€ä¹ˆ Vue èƒ½æ¸²æŸ“åˆ° DOM / Canvas / WebGL / ä¸‰æ–¹å¹³å°ï¼Ÿ</strong></h2>
<p>ç»“æ„åŒæ ·æ˜¯ä½ å–œæ¬¢çš„ï¼š<br/>
<strong>æ ¸å¿ƒå›ç­” â†’ æ·±åº¦åŸç† â†’ æµç¨‹å›¾ â†’ å®æˆ˜ä»£ç ç¤ºä¾‹ â†’ é¢è¯•å®˜è¿½é—® â†’ é«˜åˆ†æ€»ç»“</strong></p>
<hr/>
<h2 data-id="heading-1">ğŸ¯ ä¸€ã€æ ¸å¿ƒå›ç­”ï¼ˆé¢è¯•å®˜æœ€æƒ³å¬ï¼‰</h2>
<p>Vue3 çš„æ¸²æŸ“ç³»ç»Ÿæ˜¯åŸºäº <strong>â€œå¹³å°æ— å…³ï¼ˆPlatform-Agnosticï¼‰â€</strong> è®¾è®¡çš„ã€‚</p>
<p>å…¶æœ¬è´¨ï¼š</p>
<ul>
<li><strong>è™šæ‹Ÿ DOMï¼ˆVNodeï¼‰æ˜¯å¹³å°æ— å…³çš„</strong></li>
<li><strong>å¹³å°ç›¸å…³çš„ DOM APIï¼ˆcreateElementã€patchPropã€insertã€removeï¼‰è¢«æŠ½è±¡æˆ hostXXX å‡½æ•°</strong></li>
<li>è‡ªå®šä¹‰æ¸²æŸ“å™¨é€šè¿‡ <code>createRenderer()</code> è‡ªå·±æä¾›è¿™äº› hostAPIï¼Œå°±èƒ½è®© Vue æ¸²æŸ“åˆ°ä»»ä½•ç¯å¢ƒã€‚</li>
</ul>
<p>æ‰€ä»¥ï¼š</p>
<blockquote>
<p>Vue3 = æ¸²æŸ“æ¡†æ¶ï¼ˆruntime-coreï¼‰ + å¹³å°é€‚é…å™¨ï¼ˆruntime-domï¼‰</p>
</blockquote>
<p>DOMã€Canvasã€WebGLã€MiniApp éƒ½åªæ˜¯â€œé€‚é…å™¨ä¸åŒï¼Œæ ¸å¿ƒç›¸åŒâ€ã€‚</p>
<hr/>
<h2 data-id="heading-2">ğŸ¯ äºŒã€æ·±åº¦åŸç†ï¼ˆé«˜ç«¯é¢è¯•å®˜ä¼šé‡ç‚¹å¬ï¼‰</h2>
<hr/>
<h3 data-id="heading-3">1ï¸âƒ£ Vue2 ä¸ºä»€ä¹ˆä¸èƒ½è‡ªå®šä¹‰æ¸²æŸ“å™¨ï¼Ÿ</h3>
<p>å› ä¸º Vue2 æŠŠï¼š</p>
<ul>
<li>VNode å¤„ç†</li>
<li>DOM æ“ä½œ</li>
</ul>
<p>å†™æ­»åœ¨ä¸€èµ·ã€‚</p>
<p>Vue3 æŠŠå®ƒä»¬å®Œå…¨æ‹†å¼€ï¼š</p>
<h4 data-id="heading-4"><strong>æ ¸å¿ƒï¼ˆruntime-coreï¼‰</strong></h4>
<ul>
<li>diff ç®—æ³•</li>
<li>vnode ç»“æ„</li>
<li>ç»„ä»¶ç³»ç»Ÿ</li>
<li>æ›´æ–°é˜Ÿåˆ—</li>
</ul>
<h4 data-id="heading-5"><strong>å¹³å°ï¼ˆruntime-domï¼‰</strong></h4>
<ul>
<li>document.createElement</li>
<li>el.innerHTML</li>
<li>addEventListener</li>
</ul>
<hr/>
<h3 data-id="heading-6">2ï¸âƒ£ Vue3 è‡ªå®šä¹‰æ¸²æŸ“å™¨å…³é”® APIï¼šcreateRenderer</h3>
<p>æºç è·¯å¾„ï¼š<br/>
<code>packages/runtime-core/src/renderer.ts</code></p>
<p>æ ¸å¿ƒæ¥å£ï¼š</p>
<pre><code class="hljs language-lua" lang="lua">createRenderer({
  createElement,
  patchProp,
  <span class="hljs-built_in">insert</span>,
  <span class="hljs-built_in">remove</span>,
  setElementText
})
</code></pre>
<p>ä½ å¯ä»¥æŠŠå®ƒæƒ³è±¡æˆï¼š</p>
<blockquote>
<p>Vue3 æŠŠ DOM æ“ä½œå¤–åŒ…ç»™ä½ äº†ã€‚<br/>
ä½ æä¾›å‡½æ•°ï¼ŒVue è´Ÿè´£è°ƒç”¨ã€‚</p>
</blockquote>
<hr/>
<h3 data-id="heading-7">3ï¸âƒ£ Vue æ¸²æŸ“æµç¨‹ï¼ˆå¯è§†åŒ–ç†è§£ï¼‰</h3>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-built_in">render</span>() â†’ ç”Ÿæˆ VNode â†’ <span class="hljs-built_in">patch</span>() â†’ æ ¹æ® hostAPI åˆ›å»ºçœŸå®èŠ‚ç‚¹
</code></pre>
<p>ç¤ºæ„ï¼š</p>
<pre><code class="hljs language-scss" lang="scss">VNode: { type:<span class="hljs-string">'rect'</span>, props:{x:<span class="hljs-number">10</span>,y:<span class="hljs-number">20</span>} }

â†“ <span class="hljs-built_in">patch</span>()

<span class="hljs-built_in">hostCreateElement</span>(type)
<span class="hljs-built_in">hostPatchProp</span>(node, key, value)
<span class="hljs-built_in">hostInsert</span>(node, container)
</code></pre>
<p>DOM å˜ Canvasï¼Œåªè¦æ”¹ hostAPI å®ç°ï¼š</p>
<ul>
<li>createElement â†’ åˆ›å»º canvas shape</li>
<li>patchProp â†’ æ›´æ–° shape å±æ€§</li>
<li>insert â†’ åŠ å…¥ canvas å®¹å™¨</li>
<li>remove â†’ åˆ é™¤ shape</li>
</ul>
<p>æ ¸å¿ƒæ¸²æŸ“é€»è¾‘å®Œå…¨å¤ç”¨ã€‚</p>
<hr/>
<h2 data-id="heading-8">ğŸ¯ ä¸‰ã€å®æˆ˜ï¼šåˆ›å»ºä¸€ä¸ª Canvas æ¸²æŸ“å™¨ï¼ˆçœŸæ­£èƒ½è¿è¡Œçš„ç¤ºä¾‹ï¼‰</h2>
<p>ä¸‹é¢æ˜¯ä¸€ä¸ªå¯è¿è¡Œçš„æœ€å° Canvas æ¸²æŸ“å™¨ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> { createRenderer, h } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>

<span class="hljs-keyword">const</span> renderer = <span class="hljs-title function_">createRenderer</span>({
  <span class="hljs-title function_">createElement</span>(<span class="hljs-params"><span class="hljs-keyword">type</span></span>) {
    <span class="hljs-keyword">return</span> { <span class="hljs-keyword">type</span>, <span class="hljs-attr">x</span>: <span class="hljs-number">0</span>, <span class="hljs-attr">y</span>: <span class="hljs-number">0</span> }
  },
  <span class="hljs-title function_">patchProp</span>(<span class="hljs-params">node, key, prev, next</span>) {
    node[key] = next
  },
  <span class="hljs-title function_">insert</span>(<span class="hljs-params">node, parent</span>) {
    parent.<span class="hljs-property">children</span>.<span class="hljs-title function_">push</span>(node)
  },
  <span class="hljs-title function_">remove</span>(<span class="hljs-params">node, parent</span>) {
    parent.<span class="hljs-property">children</span> = parent.<span class="hljs-property">children</span>.<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">n</span> =&gt;</span> n !== node)
  },
  <span class="hljs-title function_">setElementText</span>(<span class="hljs-params">node, text</span>) {
    node.<span class="hljs-property">text</span> = text
  }
})

<span class="hljs-keyword">const</span> { createApp } = renderer
</code></pre>
<p>ä½¿ç”¨ï¼š</p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-built_in">createApp</span>({
  render() {
    return <span class="hljs-built_in">h</span>('rect', { x: <span class="hljs-number">10</span>, y: <span class="hljs-number">20</span> })
  }
})<span class="hljs-selector-class">.mount</span>(canvasRoot)
</code></pre>
<p>è¿™é‡Œï¼š</p>
<ul>
<li>rect ä¸æ˜¯ HTML element</li>
<li>æ˜¯æˆ‘ä»¬è‡ªå®šä¹‰çš„ â€œå›¾å½¢èŠ‚ç‚¹â€</li>
</ul>
<p>çœŸæ­£çš„ç»˜åˆ¶ç”±ä½ æ¥åšã€‚</p>
<hr/>
<h2 data-id="heading-9">ğŸ¯ å››ã€ç°å®åœºæ™¯ï¼ˆé¢è¯•å®˜å–œæ¬¢çš„ï¼‰</h2>
<h4 data-id="heading-10">Vue3 æ¸²æŸ“å™¨èƒ½ç”¨æ¥åšï¼š</h4>
<ul>
<li><strong>WebGL æ¸¸æˆå¼•æ“</strong>ï¼ˆå·²æœ‰ demoï¼‰</li>
<li><strong>Canvas UI åº“</strong></li>
<li><strong>è·¨ç«¯æ¡†æ¶ï¼ˆMiaoJS / UniAppï¼‰</strong></li>
<li><strong>Node åç«¯æ¸²æŸ“ï¼ˆSSRï¼‰</strong></li>
<li><strong>è‡ªå®šä¹‰ PDFã€SVG ç­‰æ¸²æŸ“</strong></li>
</ul>
<p>æ¯”å¦‚ï¼š</p>
<ul>
<li><strong>Vue + PixiJS</strong>ï¼ˆæ¸¸æˆï¼‰</li>
<li><strong>Vue + ThreeJS</strong>ï¼ˆ3Dï¼‰</li>
<li><strong>Vue + WeChat å°ç¨‹åº</strong>ï¼ˆéœ€è¦å¾®ä¿¡é€‚é…å™¨ï¼‰</li>
</ul>
<hr/>
<h2 data-id="heading-11">ğŸ¯ äº”ã€é¢è¯•å®˜è¿½é—® + é«˜åˆ†å›ç­”</h2>
<hr/>
<h3 data-id="heading-12">â“1ï¼šVue3 runtime-core å’Œ runtime-dom çš„å…³ç³»æ˜¯ä»€ä¹ˆï¼Ÿ</h3>
<p>é«˜åˆ†å›ç­”ï¼š</p>
<ul>
<li><strong>runtime-core</strong>ï¼šå¹³å°æ— å…³ï¼Œåªè´Ÿè´£ç»„ä»¶ã€vnodeã€diffã€‚</li>
<li><strong>runtime-dom</strong>ï¼šå¹³å°ç›¸å…³ï¼Œåªæ˜¯æä¾› DOM APIã€‚</li>
</ul>
<p>Vue3 çš„å¼ºå¤§æºäºè¿™ä¸ªåˆ†å±‚ã€‚</p>
<hr/>
<h3 data-id="heading-13">â“2ï¼šReact ä¹Ÿèƒ½åšè‡ªå®šä¹‰æ¸²æŸ“å™¨å—ï¼Ÿå¯¹æ¯” Vueï¼Ÿ</h3>
<p>ä½ å¯ä»¥è¿™æ ·ç­”ï¼š</p>
<p>React ä¹Ÿèƒ½ï¼ˆreact-reconcilerï¼‰<br/>
ä½†éš¾åº¦æ›´é«˜ã€API æ›´å¤æ‚ã€‚</p>
<p>Vue3 ä¼˜åŠ¿ï¼š</p>
<ul>
<li>æ¸²æŸ“å™¨ API æ›´ç®€å•</li>
<li>diff æ›´è§£è€¦</li>
<li>runtime-core æ›´ç‹¬ç«‹</li>
<li>æ›´é€‚åˆè·¨ç«¯</li>
</ul>
<p>é«˜åˆ†æ€»ç»“ï¼š</p>
<blockquote>
<p>React = æŸ”æ€§æ›´å¼ºï¼Œä½†å¤æ‚<br/>
Vue3 = é€‚é…å™¨æ›´æ˜“å†™ã€æˆæœ¬æ›´ä½</p>
</blockquote>
<hr/>
<h3 data-id="heading-14">â“3ï¼šä¸ºä»€ä¹ˆ createRenderer èƒ½æ”¯æŒ SSRï¼Ÿ</h3>
<p>å› ä¸º SSR åªæ˜¯æ¢äº†å¦ä¸€å¥— hostAPIï¼š</p>
<ul>
<li>createElement â†’ createSSRNode</li>
<li>insert â†’ appendToHTMLString</li>
<li>patchProp â†’ æ‹¼æ¥ attribute å­—ç¬¦ä¸²</li>
</ul>
<p>åŒæ ·çš„ renderer + ä¸åŒ hostAPI â†’ SSRã€DOMã€Canvas é€šåƒã€‚</p>
<hr/>
<h3 data-id="heading-15">â“4ï¼šä¸ºä»€ä¹ˆ Vue3 å¯ä»¥åŒæ—¶å­˜åœ¨ 2 å¥— rendererï¼Ÿï¼ˆSSR + CSRï¼‰</h3>
<p>å› ä¸º renderer æ˜¯ç‹¬ç«‹åˆ›å»ºã€‚</p>
<p>æµè§ˆå™¨ç«¯ï¼š</p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-built_in">createRenderer</span>(domOperations)
</code></pre>
<p>SSR ç«¯ï¼š</p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-built_in">createRenderer</span>(stringOperations)
</code></pre>
<p>renderer å®ä¾‹ç‹¬ç«‹äº’ä¸å¹²æ‰°ã€‚</p>
<hr/>
<h2 data-id="heading-16">ğŸ¯ å…­ã€é«˜åˆ†æ€»ç»“ï¼ˆèƒŒä¸‹æ¥ç›´æ¥ç§’æ€é¢è¯•ï¼‰</h2>
<blockquote>
<p>Vue3 é€šè¿‡ createRenderer å®ç°äº†â€œæ¸²æŸ“å±‚â€å’Œâ€œå¹³å°å±‚â€çš„å®Œå…¨è§£è€¦ã€‚<br/>
è™šæ‹Ÿ DOMã€Diffã€ç»„ä»¶ç³»ç»Ÿéƒ½æ˜¯å¹³å°æ— å…³çš„ï¼Œå¹³å°å·®å¼‚å…¨éƒ¨æŠ½è±¡ä¸º hostAPIã€‚<br/>
å› æ­¤ Vue3 å¯ä»¥æ¸²æŸ“åˆ° DOMã€Canvasã€WebGLã€å°ç¨‹åºã€Node SSR ç­‰ä»»ä½•ç¯å¢ƒï¼Œæ˜¯ä¸€ä¸ªçœŸæ­£è·¨å¹³å° UI å¼•æ“ã€‚</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ç¬¬ 33 é¢˜ï¼šVue3 v-model åŸç†ï¼ˆè¯­æ³•ç³– â†’ props + emit â†’ modelValue â†’ update:modelValueï¼‰]]></title>    <link>https://juejin.cn/post/7579256547797958697</link>    <guid>https://juejin.cn/post/7579256547797958697</guid>    <pubDate>2025-12-03T04:50:50.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7579256547797958697" data-draft-id="7579179625461891114" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ç¬¬ 33 é¢˜ï¼šVue3 v-model åŸç†ï¼ˆè¯­æ³•ç³– â†’ props + emit â†’ modelValue â†’ update:modelValueï¼‰"/> <meta itemprop="keywords" content="å‰ç«¯,é¢è¯•"/> <meta itemprop="datePublished" content="2025-12-03T04:50:50.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å‰ç«¯ä¸€è¯¾"/> <meta itemprop="url" content="https://juejin.cn/user/1169536102963917"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ç¬¬ 33 é¢˜ï¼šVue3 v-model åŸç†ï¼ˆè¯­æ³•ç³– â†’ props + emit â†’ modelValue â†’ update:modelValueï¼‰
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1169536102963917/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å‰ç«¯ä¸€è¯¾
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-03T04:50:50.000Z" title="Wed Dec 03 2025 04:50:50 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-03
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»2åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0"><strong>ç¬¬ 32 é¢˜ï¼šVue3 v-model åŸç†ï¼ˆè¯­æ³•ç³– â†’ props + emit â†’ modelValue â†’ update:modelValueï¼‰</strong></h2>
<p>å›ç­”ç»“æ„ï¼š<br/>
<strong>æ ¸å¿ƒå›ç­” â†’ åŒå‘ç»‘å®šæœºåˆ¶ â†’ å¤šä¸ª v-model â†’ è‡ªå®šä¹‰ç»„ä»¶å®ç° â†’ æºç è§£æ â†’ é¢è¯•å®˜è¿½é—® â†’ é«˜åˆ†æ€»ç»“</strong></p>
<hr/>
<h2 data-id="heading-1">ğŸ¯ ä¸€ã€æ ¸å¿ƒå›ç­”ï¼ˆé¢è¯•å®˜æœ€å…³æ³¨ï¼‰</h2>
<p>Vue3 ä¸­ <code>v-model</code> æœ¬è´¨æ˜¯ï¼š</p>
<blockquote>
<p><strong>props + emits çš„è¯­æ³•ç³–</strong><br/>
é»˜è®¤ä½¿ç”¨ï¼š</p>
<ul>
<li>propï¼š<code>modelValue</code></li>
<li>eventï¼š<code>update:modelValue</code></li>
</ul>
</blockquote>
<p>ä½ å†™ï¼š</p>
<pre><code class="hljs language-ini" lang="ini">&lt;MyInput <span class="hljs-attr">v-model</span>=<span class="hljs-string">"msg"</span> /&gt;
</code></pre>
<p>Vue ä¼šè½¬æ¢æˆï¼š</p>
<pre><code class="hljs language-ini" lang="ini">&lt;MyInput 
  :<span class="hljs-attr">modelValue</span>=<span class="hljs-string">"msg"</span> 
  @update:<span class="hljs-attr">modelValue</span>=<span class="hljs-string">"msg = $event"</span> 
/&gt;
</code></pre>
<p>ä¹Ÿå°±æ˜¯è¯´ï¼š</p>
<ul>
<li>çˆ¶ç»„ä»¶é€šè¿‡ <code>modelValue</code> æŠŠå€¼ä¼ ç»™å­ç»„ä»¶</li>
<li>å­ç»„ä»¶é€šè¿‡ <code>emit("update:modelValue", newValue)</code> æŠŠå€¼ä¼ å›çˆ¶ç»„ä»¶</li>
</ul>
<hr/>
<h2 data-id="heading-2">ğŸ¯ äºŒã€v-model çš„å®Œæ•´æ•°æ®æµï¼ˆéå¸¸é‡è¦ï¼‰</h2>
<pre><code class="hljs language-vbnet" lang="vbnet">çˆ¶ç»„ä»¶æ•°æ®ï¼ˆmsgï¼‰
  â†“ ä½œä¸º prop ä¼ é€’
modelValue
  â†“ å­ç»„ä»¶ä¿®æ”¹å emit
<span class="hljs-symbol">update:</span>modelValue
  â†“
çˆ¶ç»„ä»¶æ¥æ”¶ $<span class="hljs-keyword">event</span> â†’ æ›´æ–° msg
</code></pre>
<p>è¿™å°±æ˜¯ Vue3 çš„å•å‘æ•°æ®æµ + äº‹ä»¶å›ä¼ ã€‚</p>
<hr/>
<h2 data-id="heading-3">ğŸ¯ ä¸‰ã€å­ç»„ä»¶å¿…é¡»å¦‚ä½•å†™ï¼Ÿ</h2>
<p>æ ‡å‡†å†™æ³•ï¼š</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">const</span> props = <span class="hljs-title function_">defineProps</span>({
  <span class="hljs-attr">modelValue</span>: <span class="hljs-title class_">String</span>
})

<span class="hljs-keyword">const</span> emit = <span class="hljs-title function_">defineEmits</span>([<span class="hljs-string">"update:modelValue"</span>])

<span class="hljs-keyword">function</span> <span class="hljs-title function_">update</span>(<span class="hljs-params">e</span>) {
  <span class="hljs-title function_">emit</span>(<span class="hljs-string">"update:modelValue"</span>, e.<span class="hljs-property">target</span>.<span class="hljs-property">value</span>)
}
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">:value</span>=<span class="hljs-string">"props.modelValue"</span> @<span class="hljs-attr">input</span>=<span class="hljs-string">"update"</span> /&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>
</code></pre>
<p><strong>æ ¸å¿ƒï¼šemit å¿…é¡»å« <code>update:modelValue</code></strong></p>
<hr/>
<h2 data-id="heading-4">ğŸ¯ å››ã€å¤šä¸ª v-model åŸç†ï¼ˆVue3 å¼ºåŒ–çš„åŠŸèƒ½ï¼‰</h2>
<p>ä½ å¯ä»¥å†™ï¼š</p>
<pre><code class="hljs language-ini" lang="ini">&lt;MyRange v-model:<span class="hljs-attr">start</span>=<span class="hljs-string">"start"</span> v-model:end=<span class="hljs-string">"end"</span> /&gt;
</code></pre>
<p>Vue ä¼šè½¬æˆï¼š</p>
<pre><code class="hljs language-ini" lang="ini">&lt;MyRange
  :<span class="hljs-attr">start</span>=<span class="hljs-string">"start"</span>
  :<span class="hljs-attr">end</span>=<span class="hljs-string">"end"</span>
  @update:<span class="hljs-attr">start</span>=<span class="hljs-string">"start = $event"</span>
  @update:<span class="hljs-attr">end</span>=<span class="hljs-string">"end = $event"</span>
/&gt;
</code></pre>
<p>å­ç»„ä»¶å†™æ³•ï¼š</p>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-type">const</span> props = <span class="hljs-built_in">defineProps</span>([<span class="hljs-string">"start"</span>, <span class="hljs-string">"end"</span>])

<span class="hljs-type">const</span> emit = <span class="hljs-built_in">defineEmits</span>([<span class="hljs-string">"update:start"</span>, <span class="hljs-string">"update:end"</span>])

<span class="hljs-built_in">emit</span>(<span class="hljs-string">"update:start"</span>, newStart)
<span class="hljs-built_in">emit</span>(<span class="hljs-string">"update:end"</span>, newEnd)
</code></pre>
<p><strong>Vue2 å®Œå…¨ä¸æ”¯æŒå¤š v-model</strong><br/>
è¿™æ˜¯ Vue3 çš„é‡å¤§å‡çº§ã€‚</p>
<hr/>
<h2 data-id="heading-5">ğŸ¯ äº”ã€v-model ä¿®é¥°ç¬¦åŸç†ï¼ˆ.trimã€.numberã€è‡ªå®šä¹‰ä¿®é¥°ç¬¦ï¼‰</h2>
<p>ä¾‹å¦‚ï¼š</p>
<pre><code class="hljs language-ini" lang="ini">&lt;MyInput <span class="hljs-attr">v-model.trim</span>=<span class="hljs-string">"msg"</span> /&gt;
</code></pre>
<p>ä¼šç¼–è¯‘æˆï¼š</p>
<pre><code class="hljs language-ini" lang="ini">&lt;MyInput
  :<span class="hljs-attr">modelValue</span>=<span class="hljs-string">"msg"</span>
  @update:<span class="hljs-attr">modelValue</span>=<span class="hljs-string">"msg = $event.trim()"</span>
/&gt;
</code></pre>
<p>è‡ªå®šä¹‰ä¿®é¥°ç¬¦ï¼š</p>
<pre><code class="hljs language-ini" lang="ini">&lt;MyInput <span class="hljs-attr">v-model.capitalize</span>=<span class="hljs-string">"msg"</span> /&gt;
</code></pre>
<p>Vue ä¼šç»™ props æ·»åŠ ï¼š</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">modelModifiers:</span> { <span class="hljs-attr">capitalize:</span> <span class="hljs-literal">true</span> }
</code></pre>
<p>å­ç»„ä»¶å¯è¯»å–ï¼š</p>
<pre><code class="hljs language-ini" lang="ini">if (props.modelModifiers.capitalize) {
  <span class="hljs-attr">value</span> = value.toUpperCase()
}
</code></pre>
<hr/>
<h2 data-id="heading-6">ğŸ¯ å…­ã€æºç çº§è§£æï¼ˆé‡ç‚¹æ˜¯ compile é˜¶æ®µï¼‰</h2>
<p>Vue åœ¨æ¨¡æ¿ç¼–è¯‘æ—¶ä¼šæŠŠï¼š</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">v-model</span>=<span class="hljs-string">"xxx"</span>
</code></pre>
<p>è½¬æ¢æˆï¼š</p>
<pre><code class="hljs language-css" lang="css">{
  props: [
    <span class="hljs-built_in">createObjectProperty</span>(<span class="hljs-string">"modelValue"</span>, xxx)
  ],
  events: [
    <span class="hljs-built_in">createObjectProperty</span>(<span class="hljs-string">"onUpdate:modelValue"</span>, 
        <span class="hljs-built_in">createAssignmentExpression</span>(xxx, $event)
    )
  ]
}
</code></pre>
<p>ä¹Ÿå°±æ˜¯è¯´ï¼š</p>
<ul>
<li>ç¼–è¯‘é˜¶æ®µå®Œå…¨å˜æˆ props + emit</li>
<li>è¿è¡Œæ—¶ä¸éœ€è¦ä»»ä½•ç‰¹æ®Šå¤„ç†</li>
</ul>
<hr/>
<h2 data-id="heading-7">ğŸ¯ ä¸ƒã€é¢è¯•å®˜è¿½é—®ï¼ˆé™„é«˜åˆ†å›ç­”ï¼‰</h2>
<hr/>
<h3 data-id="heading-8">â“1ï¼šVue3 ä¸ºä»€ä¹ˆæŠŠ v-model çš„å­—æ®µæ”¹æˆ modelValueï¼Ÿ</h3>
<p>é«˜åˆ†å›ç­”ï¼š</p>
<ul>
<li>ç»Ÿä¸€æ‰€æœ‰ç»„ä»¶çš„è¾“å…¥ propï¼ˆæ²¡æœ‰ value/input æ··ä¹±ï¼‰</li>
<li>å¤š v-model å¿…é¡»æœ‰å­—æ®µå</li>
<li>modelValue æ›´æ ‡å‡†åŒ–</li>
</ul>
<p>Vue2ï¼š</p>
<ul>
<li><code>value</code></li>
<li><code>input</code></li>
<li><code>checked</code></li>
<li><code>change</code></li>
</ul>
<p>éå¸¸é›¶æ•£ã€‚</p>
<p>Vue3 å½»åº•ç»Ÿä¸€ã€‚</p>
<hr/>
<h3 data-id="heading-9">â“2ï¼šä¸ºä»€ä¹ˆ update:modelValue è¿™ä¹ˆè®¾è®¡ï¼Ÿ</h3>
<p>å› ä¸ºï¼š</p>
<ul>
<li>Vue3 çš„äº‹ä»¶æ˜¯é€šè¿‡å­—ç¬¦ä¸²ç»‘å®š</li>
<li>å†’å·è¯­æ³•èƒ½æ¸…æ™°è¡¨ç¤ºâ€œæ›´æ–°æŸä¸ª propâ€</li>
<li>å¯ä»¥æ”¯æŒå¤šä¸ª v-model</li>
</ul>
<p>è¿™æ˜¯ç»å…¸çš„å¯æ‰©å±•æ€§è®¾è®¡ã€‚</p>
<hr/>
<h3 data-id="heading-10">â“3ï¼šå¤šä¸ª v-model æ€ä¹ˆåŒºåˆ†ï¼Ÿ</h3>
<p>é ï¼š</p>
<pre><code class="hljs language-makefile" lang="makefile"><span class="hljs-section">v-model:title</span>
<span class="hljs-section">v-model:desc</span>
<span class="hljs-section">v-model:start</span>
<span class="hljs-section">v-model:end</span>
</code></pre>
<p>å­—æ®µåå‰ç¼€ã€‚</p>
<p>ç¼–è¯‘åå˜æˆï¼š</p>
<pre><code class="hljs language-ruby" lang="ruby"><span class="hljs-symbol">:modelValue</span> â†’ <span class="hljs-symbol">:title</span>
<span class="hljs-variable">@update</span><span class="hljs-symbol">:modelValue</span> â†’ <span class="hljs-variable">@update</span><span class="hljs-symbol">:title</span>
</code></pre>
<hr/>
<h3 data-id="heading-11">â“4ï¼šä»€ä¹ˆæ—¶å€™ç”¨ watch ä»£æ›¿ v-modelï¼Ÿ</h3>
<p>å›ç­”ï¼š</p>
<ul>
<li>å½“ä½ éœ€è¦<strong>ç›‘å¬å˜åŒ–ä½†ä¸å¸Œæœ›è‡ªåŠ¨æ›´æ–°å€¼</strong>æ—¶</li>
<li>å½“ä½ å¸Œæœ›<strong>å¤šä¸ª props ç»„åˆæˆä¸€ä¸ªå€¼</strong>æ—¶</li>
</ul>
<p>å¦åˆ™ç”¨ v-model æ›´ç®€æ´ã€‚</p>
<hr/>
<h2 data-id="heading-12">ğŸ¯ å…«ã€é‡‘ç‰Œæ€»ç»“ï¼ˆèƒŒä¸‹æ¥å³å¯ï¼‰</h2>
<blockquote>
<p>Vue3 çš„ v-model æ˜¯ <code>modelValue + update:modelValue</code> çš„è¯­æ³•ç³–ï¼Œ<br/>
é€šè¿‡ props å•å‘æµåŠ¨ä¼ å€¼ï¼Œé€šè¿‡ emit è¿›è¡Œåå‘æ›´æ–°ï¼Œå®ç°äº†å¯æ§çš„åŒå‘ç»‘å®šã€‚<br/>
æ”¯æŒå¤šä¸ª v-modelï¼Œè‡ªå®šä¹‰ä¿®é¥°ç¬¦ï¼Œç¼–è¯‘é˜¶æ®µå°† v-model è½¬æ¢ä¸ºæ ‡å‡†åŒ–çš„ props + emit ç»“æ„ï¼Œæ˜¯ Vue3 æ•°æ®æµè®¾è®¡ä¸­çš„å…³é”®éƒ¨åˆ†ã€‚</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ç¬¬ 32 é¢˜ï¼šVue3 Template ç¼–è¯‘åŸç†ï¼ˆTemplate â†’ AST â†’ Transform â†’ Codegen â†’ Render å‡½æ•°ï¼‰]]></title>    <link>https://juejin.cn/post/7579256547797942313</link>    <guid>https://juejin.cn/post/7579256547797942313</guid>    <pubDate>2025-12-03T04:50:15.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7579256547797942313" data-draft-id="7579229538791292934" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ç¬¬ 32 é¢˜ï¼šVue3 Template ç¼–è¯‘åŸç†ï¼ˆTemplate â†’ AST â†’ Transform â†’ Codegen â†’ Render å‡½æ•°ï¼‰"/> <meta itemprop="keywords" content="å‰ç«¯,é¢è¯•"/> <meta itemprop="datePublished" content="2025-12-03T04:50:15.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å‰ç«¯ä¸€è¯¾"/> <meta itemprop="url" content="https://juejin.cn/user/1169536102963917"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ç¬¬ 32 é¢˜ï¼šVue3 Template ç¼–è¯‘åŸç†ï¼ˆTemplate â†’ AST â†’ Transform â†’ Codegen â†’ Render å‡½æ•°ï¼‰
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1169536102963917/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å‰ç«¯ä¸€è¯¾
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-03T04:50:15.000Z" title="Wed Dec 03 2025 04:50:15 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-03
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»3åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0"><strong>ç¬¬ 31 é¢˜ï¼šVue3 Template ç¼–è¯‘åŸç†ï¼ˆTemplate â†’ AST â†’ Transform â†’ Codegen â†’ Render å‡½æ•°ï¼‰</strong></h2>
<p>ç»“æ„ä¾æ—§ä¸ºï¼š<br/>
<strong>æ ¸å¿ƒå›ç­” â†’ ç¼–è¯‘æµç¨‹ â†’ AST ä¸æŒ‡ä»¤è§£æ â†’ è½¬æ¢ transform â†’ ç”Ÿæˆä»£ç  â†’ é¢è¯•è¿½é—® â†’ é«˜åˆ†æ€»ç»“</strong></p>
<hr/>
<h2 data-id="heading-1">ğŸ¯ ä¸€ã€æ ¸å¿ƒå›ç­”ï¼ˆé¢è¯•å®˜æœ€å…³æ³¨ï¼‰</h2>
<p>Vue3 çš„æ¨¡æ¿ç¼–è¯‘å™¨ï¼ˆcompiler-coreï¼‰ä¸»è¦å®Œæˆä¸‰ä»¶äº‹ï¼š</p>
<ol>
<li><strong>å°† template è½¬æˆ ASTï¼ˆæŠ½è±¡è¯­æ³•æ ‘ï¼‰</strong></li>
<li><strong>å¯¹ AST è¿›è¡Œ transformï¼ˆæŒ‡ä»¤ã€æ’å€¼ã€ç»„ä»¶ç­‰ï¼‰</strong></li>
<li><strong>æ ¹æ® AST ç”Ÿæˆå¯æ‰§è¡Œçš„ render å‡½æ•°</strong></li>
</ol>
<p>æœ€ç»ˆè¾“å‡ºï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">render</span>(<span class="hljs-params">_ctx, _cache</span>) {
  <span class="hljs-keyword">return</span> (<span class="hljs-title function_">_openBlock</span>(), <span class="hljs-title function_">_createElementBlock</span>(<span class="hljs-string">"div"</span>, <span class="hljs-literal">null</span>, [
    <span class="hljs-title function_">_toDisplayString</span>(_ctx.<span class="hljs-property">msg</span>),
  ]))
}
</code></pre>
<p>Vue3 çš„ç¼–è¯‘ç‰¹ç‚¹ï¼š</p>
<ul>
<li>å®Œå…¨æ¨¡å—åŒ–ï¼ˆparser / transform / codegen åˆ†ç¦»ï¼‰</li>
<li>æ”¯æŒæ’ä»¶å¼ transform</li>
<li>é™æ€æå‡ï¼ˆHoistï¼‰</li>
<li>PatchFlagï¼ˆæå¤§æå‡ diff æ€§èƒ½ï¼‰</li>
<li>Block Treeï¼ˆæ§åˆ¶ VNode æ›´æ–°èŒƒå›´ï¼‰</li>
</ul>
<hr/>
<h2 data-id="heading-2">ğŸ¯ äºŒã€å®Œæ•´ç¼–è¯‘æµç¨‹å›¾ï¼ˆå¿…é¡»æŒæ¡ï¼‰</h2>
<pre><code class="hljs language-bash" lang="bash">Template
  â†“  parse
ASTï¼ˆæœ‰ç±»å‹ã€èŠ‚ç‚¹ã€æŒ‡ä»¤ï¼‰
  â†“  transform
ä¼˜åŒ–ï¼šé™æ€æå‡ã€æŒ‡ä»¤å¤„ç†ã€v-if/v-for è½¬æ¢
  â†“  codegen
ç”Ÿæˆæ¸²æŸ“å‡½æ•°ä»£ç 
  â†“
Render Functionï¼ˆæ‰§è¡Œæ—¶å˜æˆ vdomï¼‰
</code></pre>
<p>Vue3 ç¼–è¯‘å™¨ =<br/>
<strong>parse â†’ transform â†’ codegen</strong> ä¸‰æ­¥èµ°ã€‚</p>
<hr/>
<h2 data-id="heading-3">ğŸ¯ ä¸‰ã€ç¬¬ä¸€æ­¥ï¼šParseï¼ˆå°† template å˜æˆ ASTï¼‰</h2>
<p>ä¾‹å¦‚æ¨¡æ¿ï¼š</p>
<pre><code class="hljs language-ini" lang="ini">&lt;div <span class="hljs-attr">class</span>=<span class="hljs-string">"box"</span>&gt;{{ msg }}&lt;/div&gt;
</code></pre>
<p>AST ä¼šå˜æˆï¼š</p>
<pre><code class="hljs language-yaml" lang="yaml">{
  <span class="hljs-attr">type:</span> <span class="hljs-string">ELEMENT</span>,
  <span class="hljs-attr">tag:</span> <span class="hljs-string">"div"</span>,
  <span class="hljs-attr">props:</span> [
    { <span class="hljs-attr">type:</span> <span class="hljs-string">ATTRIBUTE</span>, <span class="hljs-attr">name:</span> <span class="hljs-string">"class"</span>, <span class="hljs-attr">value:</span> <span class="hljs-string">"box"</span> }
  ],
  <span class="hljs-attr">children:</span> [
    {
      <span class="hljs-attr">type:</span> <span class="hljs-string">INTERPOLATION</span>,
      <span class="hljs-attr">content:</span> { <span class="hljs-attr">type:</span> <span class="hljs-string">SIMPLE_EXPRESSION</span>, <span class="hljs-attr">content:</span> <span class="hljs-string">"msg"</span> }
    }
  ]
}
</code></pre>
<p>AST ä¸­åŒ…å«ï¼š</p>
<ul>
<li>Element èŠ‚ç‚¹</li>
<li>Text æ–‡æœ¬èŠ‚ç‚¹</li>
<li>Interpolation æ’å€¼èŠ‚ç‚¹</li>
<li>Directive æŒ‡ä»¤èŠ‚ç‚¹ï¼ˆv-if / v-for / v-bindï¼‰</li>
<li>å±æ€§èŠ‚ç‚¹</li>
</ul>
<p>è§£æå™¨ä½¿ç”¨<strong>æœ‰é™çŠ¶æ€æœº + æ­£åˆ™</strong>å®Œæˆã€‚</p>
<hr/>
<h2 data-id="heading-4">ğŸ¯ å››ã€ç¬¬äºŒæ­¥ï¼šTransformï¼ˆæœ€å…³é”®ï¼‰</h2>
<p>Transform è´Ÿè´£ï¼š</p>
<ul>
<li>æŠŠ v-if è½¬æˆä¸‰å…ƒè¡¨è¾¾å¼</li>
<li>æŠŠ v-for è½¬æˆå¾ªç¯ç»“æ„</li>
<li>æŠŠæ’å€¼å˜æˆ <code>_toDisplayString()</code></li>
<li>é™æ€æå‡ï¼ˆé™æ€èŠ‚ç‚¹æå‡åˆ°å¤–å±‚ï¼‰</li>
<li>PatchFlag ç”Ÿæˆä¼˜åŒ–æ ‡è®°</li>
<li>åˆ›å»º Block æ ‘ï¼ˆVue3 æ€§èƒ½å…³é”®ï¼‰</li>
</ul>
<p>ä½ å¯ä»¥ç†è§£ä¸ºï¼š</p>
<blockquote>
<p>transform = æŠŠæ¨¡æ¿è¯­æ³•ç³–ï¼Œå…¨éƒ¨è½¬æ¢æˆå¯æ‰§è¡Œçš„ç”Ÿäº§çº§ä»£ç ç»“æ„</p>
</blockquote>
<p>ç¤ºä¾‹ï¼š<br/>
<code>&lt;div&gt;{{ msg }}&lt;/div&gt;</code> åœ¨ transform åä¼šå˜æˆï¼š</p>
<pre><code class="hljs language-vbscript" lang="vbscript">createVNode(<span class="hljs-string">"div"</span>, <span class="hljs-literal">null</span>, [
  toDisplay<span class="hljs-built_in">String</span>(msg)
], PatchFlag.TEXT)
</code></pre>
<p>PatchFlag æ˜¯ Vue3 çš„æ€§èƒ½æ ¹åŸºã€‚</p>
<hr/>
<h2 data-id="heading-5">ğŸ¯ äº”ã€ç¬¬ä¸‰æ­¥ï¼šCodegenï¼ˆç”Ÿæˆæœ€ç»ˆ render å‡½æ•°ï¼‰</h2>
<p>ä» AST ç”Ÿæˆ JavaScript ä»£ç å­—ç¬¦ä¸²ã€‚</p>
<p>ç”Ÿæˆå¦‚ä¸‹ä»£ç ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">render</span>(<span class="hljs-params">_ctx, _cache</span>) {
  <span class="hljs-keyword">return</span> (<span class="hljs-title function_">_openBlock</span>(), <span class="hljs-title function_">_createElementBlock</span>(<span class="hljs-string">"div"</span>, <span class="hljs-literal">null</span>, [
    <span class="hljs-title function_">_createTextVNode</span>(<span class="hljs-title function_">_toDisplayString</span>(_ctx.<span class="hljs-property">msg</span>), <span class="hljs-number">1</span> <span class="hljs-comment">/* TEXT */</span>)
  ]))
}
</code></pre>
<p>è§£é‡Šï¼š</p>
<ul>
<li><code>_createElementBlock</code> â†’ ç»è¿‡ Block ä¼˜åŒ–çš„ VNode</li>
<li><code>_openBlock()</code> â†’ åˆ›å»º blockï¼ˆpatch æ›´å¿«ï¼‰</li>
<li>PatchFlag = 1 â†’ è¡¨ç¤ºæ›´æ–°ç‚¹åªæœ‰æ–‡æœ¬</li>
</ul>
<p>è¿™æ˜¯ Vue3 æ€§èƒ½å·¨å¤§çš„æå‡æ¥æºã€‚</p>
<hr/>
<h2 data-id="heading-6">ğŸ¯ å…­ã€Vue3 ç¼–è¯‘çš„é‡è¦ä¼˜åŒ–ç‚¹ï¼ˆé¢è¯•å®˜éå¸¸çˆ±é—®ï¼‰</h2>
<hr/>
<h3 data-id="heading-7">â­1. é™æ€æå‡ï¼ˆHoistï¼‰</h3>
<p>æ¨¡æ¿ï¼š</p>
<pre><code class="hljs language-css" lang="css">&lt;<span class="hljs-selector-tag">div</span>&gt;&lt;<span class="hljs-selector-tag">span</span>&gt;static text&lt;/<span class="hljs-selector-tag">span</span>&gt;&lt;/<span class="hljs-selector-tag">div</span>&gt;
</code></pre>
<p>Vue3 ä¼šæŠŠé™æ€èŠ‚ç‚¹æå‡ï¼š</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">const</span> _hoisted_1 = <span class="hljs-comment">/*#__PURE__*/</span>_createElementVNode(<span class="hljs-string">"span"</span>, <span class="hljs-string">"static text"</span>)

<span class="hljs-function">function <span class="hljs-title">render</span>()</span> {
  <span class="hljs-keyword">return</span> _createElementBlock(<span class="hljs-string">"div"</span>, <span class="hljs-literal">null</span>, [_hoisted_1])
}
</code></pre>
<p>å¥½å¤„ï¼š</p>
<ul>
<li>é™æ€èŠ‚ç‚¹ä¸ä¼šé‡å¤åˆ›å»º</li>
<li>diff æ—¶å®Œå…¨è·³è¿‡é™æ€éƒ¨åˆ†</li>
</ul>
<hr/>
<h3 data-id="heading-8">â­2. PatchFlagsï¼ˆæ€§èƒ½æ ¸å¿ƒï¼‰</h3>
<p>æ ¹æ®æ¨¡æ¿ç‰¹ç‚¹æ‰“ä¸Šæ›´æ–°æ ‡è®°ï¼š</p>
<pre><code class="hljs language-vbnet" lang="vbnet"><span class="hljs-keyword">TEXT</span>
PROPS
<span class="hljs-keyword">CLASS</span>
STYLE
FULL_PROPS
KEYED_FRAGMENT
UNKEYED_FRAGMENT
</code></pre>
<p>è¿™æ · diff æ—¶ï¼š</p>
<blockquote>
<p>æœ‰ PatchFlag çš„èŠ‚ç‚¹æ‰è¿›å…¥ diff<br/>
<strong>æ²¡æœ‰ PatchFlag â†’ é™æ€ â†’ å®Œå…¨è·³è¿‡</strong></p>
</blockquote>
<p>è¿™æ˜¯ Vue3 æ¯” Vue2 å¿« 2â€“3 å€çš„æ ¹æœ¬åŸå› ã€‚</p>
<hr/>
<h3 data-id="heading-9">â­3. Block Tree</h3>
<p>Vue3 ä¼šæ‰¾å‡ºåŠ¨æ€èŠ‚ç‚¹çš„â€œæœ€å°æ›´æ–°åŒºåŸŸâ€ï¼š</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">block</span> = åŠ¨æ€èŠ‚ç‚¹çš„é›†åˆ
</code></pre>
<p>æ¯ä¸ª block åª diff è‡ªå·±å†…éƒ¨çš„åŠ¨æ€å­èŠ‚ç‚¹ï¼Œä¸éå†æ•´ä¸ªæ ‘ã€‚</p>
<hr/>
<h2 data-id="heading-10">ğŸ¯ ä¸ƒã€é¢è¯•å®˜å¸¸é—®è¿½é—®ï¼ˆé™„é«˜åˆ†å›ç­”ï¼‰</h2>
<hr/>
<h3 data-id="heading-11">â“1ï¼šVue3 ä¸ºä»€ä¹ˆè¦ä» VNode Tree è½¬æˆ Block Treeï¼Ÿ</h3>
<p>é«˜åˆ†å›ç­”ï¼š</p>
<blockquote>
<p>å› ä¸ºæ•´æ£µæ ‘ diff æˆæœ¬å¤ªé«˜ï¼Œå°†åŠ¨æ€èŠ‚ç‚¹åˆ’æˆ blockï¼Œåª diff æœ‰ PatchFlag çš„èŠ‚ç‚¹ï¼Œæå‡æ€§èƒ½ã€‚</p>
</blockquote>
<hr/>
<h3 data-id="heading-12">â“2ï¼šæ¨¡æ¿ä¸­ä¸€ä¸ªé™æ€å¤§åˆ—è¡¨ï¼ŒVue3 ä¼šåšä»€ä¹ˆä¼˜åŒ–ï¼Ÿ</h3>
<p>ç­”ï¼š</p>
<ul>
<li>é™æ€æå‡</li>
<li>Hoist åˆ°å¤–å±‚ä½œç”¨åŸŸ</li>
<li>æ°¸ä¸ diff</li>
</ul>
<hr/>
<h3 data-id="heading-13">â“3ï¼šä¸ºä»€ä¹ˆ Vue3 ç¼–è¯‘åä¼šå‡ºç° <code>_ctx</code>ã€<code>_cache</code>ã€<code>_openBlock</code> ç­‰å˜é‡ï¼Ÿ</h3>
<p>ç­”ï¼š</p>
<p>è¿™äº›éƒ½æ˜¯æ¨¡æ¿ç¼–è¯‘ç”Ÿæˆçš„è¿è¡Œæ—¶ helperï¼Œç”¨æ¥ï¼š</p>
<ul>
<li>å¸®åŠ©æ‰§è¡Œ render å‡½æ•°</li>
<li>æä¾›åˆ›å»º vnode çš„å·¥å…·</li>
<li>ç»´æŠ¤ block æ ˆ</li>
<li>è¿›è¡Œ caching å’Œä¼˜åŒ–</li>
</ul>
<hr/>
<h3 data-id="heading-14">â“4ï¼šVue3 template æ˜¯å¦å¯ä»¥ç¼–è¯‘ä¸º SSR ä»£ç ï¼Ÿ</h3>
<p>æ˜¯çš„ï¼ŒVue3 æä¾›ä¸¤ç§ç¼–è¯‘æ¨¡å¼ï¼š</p>
<ul>
<li><code>compile()</code> â†’ å®¢æˆ·ç«¯æ¸²æŸ“</li>
<li><code>compileSSR()</code> â†’ æœåŠ¡ç«¯æ¸²æŸ“</li>
</ul>
<p>åŒæ ·ç»å† AST â†’ transform â†’ codegen<br/>
åªæ˜¯ç”Ÿæˆä¸åŒçš„ä»£ç ç»“æ„ã€‚</p>
<hr/>
<h2 data-id="heading-15">ğŸ¯ å…«ã€é‡‘ç‰Œæ€»ç»“ï¼ˆå¯ä»¥èƒŒè¯µï¼‰</h2>
<blockquote>
<p>Vue3 æ¨¡æ¿ç¼–è¯‘å™¨å°† template è½¬æˆ ASTï¼Œé€šè¿‡ transform æ‰§è¡ŒæŒ‡ä»¤å¤„ç†ã€é™æ€æå‡ã€PatchFlag æ ‡è®°ï¼Œæœ€ç»ˆé€šè¿‡ codegen è¾“å‡ºé«˜æ€§èƒ½çš„ render å‡½æ•°ã€‚<br/>
ç¼–è¯‘æ—¶ä¼˜åŒ–ï¼ˆHoistã€PatchFlagã€Block Treeï¼‰æå¤§æå‡äº†è¿è¡Œæ—¶æ€§èƒ½ï¼Œæ˜¯ Vue3 è¾ƒ Vue2 æœ€å¤§çš„æ¶æ„å‡çº§ã€‚</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[AIé¢†åŸŸåå®¶åä½œï¼Œå¤§æ¨¡å‹å­¦ä¹ ä¹¦ç±æ¨è-å…³äºå¤§æ¨¡å‹çš„æ•™ç§‘ä¹¦ï¼ˆé™„pdfï¼‰]]></title>    <link>https://juejin.cn/post/7579169543232143360</link>    <guid>https://juejin.cn/post/7579169543232143360</guid>    <pubDate>2025-12-03T03:03:23.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7579169543232143360" data-draft-id="7579127397498650675" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="AIé¢†åŸŸåå®¶åä½œï¼Œå¤§æ¨¡å‹å­¦ä¹ ä¹¦ç±æ¨è-å…³äºå¤§æ¨¡å‹çš„æ•™ç§‘ä¹¦ï¼ˆé™„pdfï¼‰"/> <meta itemprop="keywords" content="Agent,LLM,ç¨‹åºå‘˜"/> <meta itemprop="datePublished" content="2025-12-03T03:03:23.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="AIå¤§æ¨¡å‹"/> <meta itemprop="url" content="https://juejin.cn/user/3817967696221534"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            AIé¢†åŸŸåå®¶åä½œï¼Œå¤§æ¨¡å‹å­¦ä¹ ä¹¦ç±æ¨è-å…³äºå¤§æ¨¡å‹çš„æ•™ç§‘ä¹¦ï¼ˆé™„pdfï¼‰
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3817967696221534/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    AIå¤§æ¨¡å‹
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-03T03:03:23.000Z" title="Wed Dec 03 2025 03:03:23 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-03
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»6åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#383838;font-size:15px;line-height:30px;letter-spacing:2px;word-break:break-word;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Open Sans,Helvetica Neue,sans-serif;scroll-behavior:smooth;background-image:linear-gradient(0deg,transparent 24%,rgba(201,195,195,.329) 25%,hsla(0,8%,80.4%,.05) 26%,transparent 27%,transparent 74%,hsla(0,5.2%,81%,.185) 75%,rgba(180,176,176,.05) 76%,transparent 77%,transparent),linear-gradient(90deg,transparent 24%,rgba(204,196,196,.226) 25%,hsla(0,4%,66.1%,.05) 26%,transparent 27%,transparent 74%,hsla(0,5.2%,81%,.185) 75%,rgba(180,176,176,.05) 76%,transparent 77%,transparent);background-color:#fff;background-size:50px 50px;padding-bottom:60px}.markdown-body ::selection{color:#fff;background-color:#a862ea}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{margin:24px 0 12px;color:#a862ea}.markdown-body h1{line-height:2;font-size:1.4em}.markdown-body h1~p:first-of-type:first-letter{color:#a862ea;float:left;font-size:2em;margin-right:.4em;font-weight:bolder}.markdown-body h2{font-size:1.2em}.markdown-body h3{font-size:1.1em}.markdown-body ol,.markdown-body ul{padding-left:2em}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;padding-left:.2em}.markdown-body ol li::marker,.markdown-body ul li::marker{color:#a862ea}.markdown-body ol li.task-list-item,.markdown-body ul li.task-list-item{list-style:none}.markdown-body ol li.task-list-item ol,.markdown-body ol li.task-list-item ul,.markdown-body ul li.task-list-item ol,.markdown-body ul li.task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:10px}.markdown-body a,.markdown-body code,.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6,.markdown-body li,.markdown-body p{opacity:.85;vertical-align:baseline;transition:all .1s ease}.markdown-body a:hover,.markdown-body code:hover,.markdown-body h1:hover,.markdown-body h2:hover,.markdown-body h3:hover,.markdown-body h4:hover,.markdown-body h5:hover,.markdown-body h6:hover,.markdown-body li:hover,.markdown-body p:hover{opacity:1}.markdown-body a{display:inline-block;color:#a862ea;cursor:pointer;text-decoration:none;position:relative}.markdown-body a:after{content:"";position:absolute;width:98%;height:1px;bottom:0;left:0;transform:scaleX(0);background-color:#a862ea;transform-origin:bottom right;transition:transform .3s ease-in-out}.markdown-body a:hover:after{transform:scaleX(1);transform-origin:bottom left}.markdown-body a:active,.markdown-body a:link{color:#a862ea}.markdown-body img{max-width:100%;user-select:none;margin:1em 0;transition:transform .2s ease 0s;background-color:#f8f5ff;box-shadow:0 0 10px #e7daff}.markdown-body img:hover{opacity:1;box-shadow:0 0 20px #e7daff;transform:translateY(-1px)}.markdown-body blockquote{padding:.5em 1em;margin:12px 0;border-top-left-radius:2px;border-bottom-left-radius:2px;border-left:3px solid #a862ea;background-color:#f8f5ff}.markdown-body blockquote&gt;p{margin:0}.markdown-body .math{font-style:italic;margin:12px 0;padding:.5em 1em;background-color:#f8f5ff}.markdown-body .math&gt;p{margin:0}.markdown-body code{padding:2px .4em;overflow-x:auto;color:#a862ea;font-weight:700;word-break:break-word;font-family:Operator Mono,Consolas,Monaco,Menlo,monospace;background-color:#f8f5ff}.markdown-body pre{margin:2em 0}.markdown-body pre&gt;code{display:block;padding:1.5em;word-break:normal;font-size:.9em;font-style:normal;font-weight:400;font-family:Operator Mono,Consolas,Monaco,Menlo,monospace;line-height:18px;color:#383838;border-radius:2px;scroll-behavior:smooth;box-shadow:0 0 10px #e7daff}.markdown-body pre&gt;code:hover{box-shadow:0 0 20px #e7daff}.markdown-body pre&gt;code::-webkit-scrollbar{height:6px;background-color:#f8f5ff}.markdown-body pre&gt;code::-webkit-scrollbar-thumb{background-color:#e7daff;border-bottom-left-radius:3px;border-bottom-right-radius:3px}.markdown-body hr{margin:2em 0;border-top:1px solid #a862ea}.markdown-body table{width:100%;font-size:12px;max-width:100%;overflow:auto;border-collapse:collapse}.markdown-body thead{color:#a862ea;background:#f8f5ff}.markdown-body td,.markdown-body th{padding:.5em;border:1px solid #e7daff}.markdown-body tr{background-color:#f8f5ff}@media (max-width:720px){.markdown-body{font-size:12px}}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>æœ¬æ–‡è¾ƒé•¿ï¼Œå»ºè®®ç‚¹èµæ”¶è—ã€‚æ›´å¤šAIå¤§æ¨¡å‹åº”ç”¨å¼€å‘å­¦ä¹ è§†é¢‘åŠèµ„æ–™ï¼Œåœ¨<a href="https://link.juejin.cn?target=https%3A%2F%2Fhy.zhipoai.cn%2F" target="_blank" title="https://hy.zhipoai.cn/" ref="nofollow noopener noreferrer">æ™ºæ³ŠAI</a>ã€‚</p>
</blockquote>
<p>AIé¢†åŸŸåå®¶åä½œï¼Œç›®å‰å¤§æ¨¡å‹çš„æ•™ç§‘ä¹¦å·²ç»è‡³å°‘æœ‰ä¸‰æœ¬äº†ï¼Œä¸”å‡å·²æä¾›å…¬å¼€çš„PDFç‰ˆæœ¬ã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/dc7cde240a7d47cfb746c2d43f3ef69b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQUnlpKfmqKHlnos=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765335802&amp;x-signature=e%2Bsll6nFM61zdSJ%2FXIRztDp%2BhhA%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-0"><strong>ğŸš©ç¬¬ä¸€æœ¬ï¼šã€Šå¤§è¯­è¨€æ¨¡å‹ã€‹</strong></h2>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/805792984da148e8bf5fbe14a55705e1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQUnlpKfmqKHlnos=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765335802&amp;x-signature=o%2FiJLE6cyhBKmm1ngYPB%2B0rISxQ%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-1">ä¸€ã€å†…å®¹ä»‹ç»ï¼š</h3>
<p>æ˜¯ä¸€æœ¬ç”±ä¸­å›½äººæ°‘å¤§å­¦é«˜ç“´äººå·¥æ™ºèƒ½å­¦é™¢æ•™æˆèµµé‘«ç­‰ç¼–è‘—çš„ä¹¦ç±ï¼Œæ—¨åœ¨ä¸ºå¤§æ¨¡å‹æŠ€æœ¯çš„å…¥é—¨è¯»è€…æä¾›ç³»ç»Ÿæ€§çš„çŸ¥è¯†è®²è§£ï¼Œæ˜¯ä¸€æœ¬éå¸¸é€‚åˆå¤§æ¨¡å‹æŠ€æœ¯å…¥é—¨è¯»è€…çš„ä¹¦ç±ï¼Œæœ¬ä¹¦å±•ç°ä¸€ä¸ªå®Œæ•´çš„å¤§æ¨¡å‹æŠ€æœ¯æ¡†æ¶å’Œå‘å±•è·¯çº¿å›¾ï¼Œé€šè¿‡ç³»ç»Ÿæ€§çš„çŸ¥è¯†è®²è§£å’Œå®ä¾‹åˆ†æï¼Œå¸®åŠ©è¯»è€…æ·±å…¥ç†è§£å¤§æ¨¡å‹æŠ€æœ¯çš„æ ¸å¿ƒåŸç†å’Œåº”ç”¨åœºæ™¯ã€‚å¯¹äºé«˜å¹´çº§æœ¬ç§‘ç”Ÿã€ä½å¹´çº§ç ”ç©¶ç”Ÿä»¥åŠä»äº‹äººå·¥æ™ºèƒ½é¢†åŸŸçš„æŠ€æœ¯äººå‘˜å’Œçˆ±å¥½è€…æ¥è¯´ï¼Œæœ¬ä¹¦éƒ½æ˜¯ä¸€æœ¬ä¸å¯å¤šå¾—çš„å‚è€ƒèµ„æ–™ã€‚</p>
<h3 data-id="heading-2">äºŒã€ä¹¦ç±ç‰¹ç‚¹ï¼š</h3>
<ul>
<li>ç³»ç»Ÿæ€§ï¼šæœ¬ä¹¦æ³¨é‡å±•ç°ä¸€ä¸ªå®Œæ•´çš„å¤§æ¨¡å‹æŠ€æœ¯æ¡†æ¶å’Œå‘å±•è·¯çº¿å›¾ï¼Œå¸®åŠ©è¯»è€…å»ºç«‹ç³»ç»Ÿæ€§çš„çŸ¥è¯†ä½“ç³»ã€‚</li>
<li>å®ç”¨æ€§ï¼šé€šè¿‡å¤§é‡çš„å®ä¾‹å’Œæ¡ˆä¾‹åˆ†æï¼Œå°†ç†è®ºçŸ¥è¯†ä¸å®é™…åº”ç”¨ç´§å¯†ç»“åˆï¼Œæé«˜è¯»è€…çš„å®è·µèƒ½åŠ›ã€‚</li>
<li>å‰ç»æ€§ï¼šæœ¬ä¹¦ä¸ä»…ä»‹ç»äº†å½“å‰å¤§è¯­è¨€æ¨¡å‹çš„æœ€æ–°è¿›å±•ï¼Œè¿˜æ¢è®¨äº†æœªæ¥çš„å‘å±•è¶‹åŠ¿å’ŒæŒ‘æˆ˜ã€‚</li>
</ul>
<h3 data-id="heading-3">ä¸‰ã€ä¹¦ç±é€‚ç”¨äººç¾¤</h3>
<ul>
<li>
<p><strong>é«˜å¹´çº§æœ¬ç§‘ç”Ÿï¼šå¯¹äºå…·æœ‰æ·±åº¦å­¦ä¹ åŸºç¡€çš„é«˜å¹´çº§æœ¬ç§‘ç”Ÿæ¥è¯´ï¼Œæœ¬ä¹¦æ˜¯ä¸€æœ¬å¾ˆå¥½çš„å…¥é—¨è¯»ç‰©ï¼Œå¯ä»¥å¸®åŠ©ä»–ä»¬å¿«é€ŸæŒæ¡å¤§æ¨¡å‹æŠ€æœ¯çš„æ ¸å¿ƒåŸç†å’Œåº”ç”¨æ–¹æ³•ã€‚</strong></p>
</li>
<li>
<p>ä½å¹´çº§ç ”ç©¶ç”Ÿï¼šå¯¹äºä½å¹´çº§ç ”ç©¶ç”Ÿæ¥è¯´ï¼Œæœ¬ä¹¦å¯ä»¥ä½œä¸ºä»–ä»¬æ·±å…¥ç ”ç©¶å¤§æ¨¡å‹æŠ€æœ¯çš„èµ·ç‚¹ï¼Œä¸ºä»–ä»¬åç»­çš„ç§‘ç ”å·¥ä½œæ‰“ä¸‹åšå®çš„åŸºç¡€ã€‚</p>
</li>
<li>
<p>æŠ€æœ¯äººå‘˜å’Œçˆ±å¥½è€…ï¼šå¯¹äºä»äº‹äººå·¥æ™ºèƒ½é¢†åŸŸçš„æŠ€æœ¯äººå‘˜å’Œçˆ±å¥½è€…æ¥è¯´ï¼Œæœ¬ä¹¦ä¹Ÿæ˜¯ä¸€æœ¬ä¸å¯å¤šå¾—çš„å‚è€ƒèµ„æ–™ï¼Œå¯ä»¥å¸®åŠ©ä»–ä»¬äº†è§£å¤§æ¨¡å‹æŠ€æœ¯çš„æœ€æ–°è¿›å±•å’Œåº”ç”¨åœºæ™¯ã€‚</p>
</li>
</ul>
<h2 data-id="heading-4"><strong>ğŸš©ç¬¬äºŒæœ¬ï¼šã€Šå¤§æ¨¡å‹åŸºç¡€ã€‹</strong></h2>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3e8e0cf7f6214f5a99b5375aaca654d3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQUnlpKfmqKHlnos=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765335802&amp;x-signature=IfzTvRXW75XphYzYyEFGoXz92a0%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-5">ä¸€ã€å†…å®¹ä»‹ç»ï¼š</h3>
<p>ã€Šå¤§æ¨¡å‹åŸºç¡€ã€‹æ˜¯ä¸€æœ¬ç”±æµ™æ±Ÿå¤§å­¦DAILYå®éªŒå®¤çš„æ¯›ç‰ä»ç ”ç©¶å‘˜å’Œé«˜äº‘å›æ•™æˆé¢†è¡”æ’°å†™çš„å¤§æ¨¡å‹é¢†åŸŸæ•™æã€‚æœ¬ä¹¦åŒ…å«è¯­è¨€æ¨¡å‹åŸºç¡€ã€å¤§è¯­è¨€æ¨¡å‹æ¶æ„æ¼”åŒ–ã€Promptå·¥ç¨‹ã€å‚æ•°é«˜æ•ˆå¾®è°ƒã€æ¨¡å‹ç¼–è¾‘ã€æ£€ç´¢å¢å¼ºç”Ÿæˆç­‰å…­éƒ¨åˆ†å†…å®¹ã€‚ æœ¬ä¹¦å…±9ç« ï¼Œæ·±å…¥æ¢è®¨äº†å¤§æ¨¡å‹çš„å·¥ä½œåŸç†å’Œä½¿ç”¨æ–¹æ³•-ä¸€æç¤ºå·¥ç¨‹ï¼Œå¹¶ç ”ç©¶äº†æç¤ºå·¥ç¨‹åœ¨ç”µå­å•†åŠ¡ã€åˆ›æ„è¥é”€ã€å†…å®¹åˆ›ä½œã€åŠå…¬å’Œç¼–ç¨‹ç­‰åœºæ™¯ä¸­çš„åº”ç”¨ï¼Œä»¥åŠå¦‚ä½•èµ‹èƒ½è½¯ä»¶ç”Ÿæ€çš„å‘å±•ç­‰ã€‚</p>
<h3 data-id="heading-6">äºŒã€ä¹¦ç±ç‰¹ç‚¹ï¼š</h3>
<p>ç´§è·ŸæŠ€æœ¯å‰æ²¿ï¼šä¹¦ä¸­ä¸ä»…æ¶µç›–äº†å¤§æ¨¡å‹çš„åŸºç¡€çŸ¥è¯†ï¼Œè¿˜ä»‹ç»äº†æœ€æ–°çš„æŠ€æœ¯è¿›å±•å’Œç ”ç©¶æˆæœï¼Œä½¿è¯»è€…èƒ½å¤Ÿç´§è·ŸæŠ€æœ¯å‰æ²¿ã€‚</p>
<p>æ˜“è¯»æ€§ï¼šæ¯ç« å†…å®¹éƒ½ä»¥ä¸€ç§åŠ¨ç‰©ä¸ºä¸»é¢˜è¿›è¡Œè®²è§£ï¼Œå¦‚ä»¥â€œçŒ«â€ä¸ºä¸»é¢˜ä»‹ç»Transformeræ¶æ„ï¼Œä½¿å¤æ‚çš„æŠ€æœ¯æ¦‚å¿µæ›´åŠ ç”ŸåŠ¨æ˜“æ‡‚ã€‚</p>
<p>å…¨é¢ç³»ç»Ÿï¼šå†…å®¹æ¶µç›–äº†ä¼ ç»Ÿè¯­è¨€æ¨¡å‹ã€å¤§è¯­è¨€æ¨¡å‹çš„æ¶æ„ã€æç¤ºå·¥ç¨‹ã€é«˜æ•ˆå‚æ•°è®¾ç½®ã€æ¨¡å‹ç¼–è¾‘ä»¥åŠæœç´¢å¢å¼ºç”Ÿæˆç­‰å…³é”®ä¸»é¢˜ã€‚å¯¹æ¯ä¸ªä¸»é¢˜éƒ½è¿›è¡Œäº†æ·±å…¥çš„æ¢è®¨å’Œåˆ†æï¼Œå¸®åŠ©è¯»è€…å»ºç«‹å…¨é¢çš„çŸ¥è¯†ä½“ç³»ã€‚</p>
<h3 data-id="heading-7">ä¸‰ã€ä¹¦ç±ç›®å½•</h3>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/63cbd7d4c5d74dbaa61ad19d8ff6e4a7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQUnlpKfmqKHlnos=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765335802&amp;x-signature=FI3fVdRz2RO5ts8kqsUfkir%2FhGc%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-8"><strong>ğŸš©ç¬¬ä¸‰æœ¬ï¼šã€Šå¤§è§„æ¨¡è¯­è¨€æ¨¡å‹ï¼šä»ç†è®ºåˆ°å®è·µã€‹</strong></h2>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2b9fb474301f432b819eaece952fddcd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQUnlpKfmqKHlnos=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765335802&amp;x-signature=HmQJwTo7yGyf0jNuE80E91zcTLk%3D" alt="" loading="lazy"/></p>
<h4 data-id="heading-9">ä¸€ã€å†…å®¹ä»‹ç»ï¼š</h4>
<p>ã€Šå¤§è§„æ¨¡è¯­è¨€æ¨¡å‹ï¼šä»ç†è®ºåˆ°å®è·µã€‹æ˜¯ç”±å¤æ—¦å¤§å­¦è®¡ç®—æœºç§‘å­¦æŠ€æœ¯å­¦é™¢å¼ å¥‡æ•™æˆé¢†è¡”çš„å›¢é˜Ÿç¼–å†™çš„ä¸“ä¸šä¹¦ç±ï¼Œæ˜¯ä¸€æœ¬ç³»ç»Ÿã€å®ç”¨ã€æƒå¨ä¸”æ˜“è¯»çš„å¤§è¯­è¨€æ¨¡å‹æ•™æï¼Œæ—¨åœ¨å¸®åŠ©è¯»è€…æ·±å…¥ç†è§£å¤§è¯­è¨€æ¨¡å‹çš„åŸç†ï¼Œå¹¶æä¾›å®é™…æ“ä½œçš„æŒ‡å¯¼å’Œæ¡ˆä¾‹ã€‚å¯¹äºå¸Œæœ›æ·±å…¥äº†è§£å¤§è¯­è¨€æ¨¡å‹åŸç†å’Œåº”ç”¨çš„è¯»è€…æ¥è¯´å…·æœ‰é‡è¦çš„å‚è€ƒä»·å€¼ã€‚</p>
<h5 data-id="heading-10">äºŒã€ä¸ºä»€ä¹ˆè¦é˜…è¯»è¿™æœ¬ä¹¦</h5>
<p>å¤§è§„æ¨¡è¯­è¨€æ¨¡å‹ï¼šä»ç†è®ºåˆ°å®è·µã€‹å¯¹å¤§è¯­è¨€æ¨¡å‹æ„Ÿå…´è¶£çš„è¯»è€…æä¾›å…¥é—¨æŒ‡å—ï¼Œä¹Ÿå¯ä½œä¸ºé«˜å¹´çº§æœ¬ç§‘ç”Ÿå’Œç ”ç©¶ç”Ÿè‡ªç„¶è¯­è¨€å¤„ç†ç›¸å…³è¯¾ç¨‹çš„è¡¥å……æ•™æã€‚</p>
<p>æŒæ¡å¤§è¯­è¨€æ¨¡å‹ç›¸å…³æŠ€æœ¯ï¼Œç»™è‡ªå·±ä¸€ä¸ªæ·±å…¥ç ”ç©¶å¤§è¯­è¨€æ¨¡å‹çš„å®è·µæœºä¼šã€‚</p>
<h5 data-id="heading-11">ä¸‰ã€æœ¬ä¹¦æ¶æ„</h5>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4cf574c1cbb5444b91aebc497a86c975~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQUnlpKfmqKHlnos=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765335802&amp;x-signature=loXyq6m%2By6%2BK0Yp%2BHv3SSz%2FYuGU%3D" alt="" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c29dc55baa6149279a0849022a58f488~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQUnlpKfmqKHlnos=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765335802&amp;x-signature=pzwFuI94gSNRAAn8Pe4XCE1KjI4%3D" alt="" loading="lazy"/></p>
<h5 data-id="heading-12">åŸºç¡€ç†è®ºéƒ¨åˆ†:ä»‹ç»LLMçš„åŸºç¡€ç†è®ºçŸ¥è¯†</h5>
<ul>
<li>è¯­è¨€æ¨¡å‹çš„å®šä¹‰</li>
<li>Transformerç»“æ„</li>
<li>ç”Ÿæˆå¼é¢„è®­ç»ƒè¯­è¨€æ¨¡å‹GPT</li>
<li>å¤§è¯­è¨€æ¨¡å‹çš„ç»“æ„</li>
<li>æ³¨æ„åŠ›æœºåˆ¶ä¼˜åŒ–</li>
<li>å®è·µ:åŸºäºHuggingFaceçš„é¢„è®­ç»ƒè¯­è¨€æ¨¡å‹</li>
<li>å®è·µ:ä»¥LLaMAä½¿ç”¨çš„æ¨¡å‹ç»“æ„ä¸ºä¾‹</li>
</ul>
<h5 data-id="heading-13">é¢„è®­ç»ƒéƒ¨åˆ†:å›´ç»•LLMé¢„è®­ç»ƒæ•°æ®å’Œåˆ†å¸ƒå¼è®­ç»ƒå±•å¼€</h5>
<ul>
<li>æ•°æ®æ¥æº</li>
<li>æ•°æ®é¢„å¤„ç†æ–¹æ³•</li>
<li>å¼€æºæ•°æ®é›†</li>
<li>æ¨¡å‹åˆ†å¸ƒå¼è®­ç»ƒ</li>
<li>æ•°æ®å¹¶è¡Œ</li>
<li>æµæ°´çº¿å¹¶è¡Œ</li>
<li>æ¨¡å‹å¹¶è¡Œ</li>
<li>Zeroç³»åˆ—ä¼˜åŒ–æ–¹æ³•</li>
<li>å®è·µ:ä»¥DeepSpeedä¸ºä¾‹ï¼Œè¿›è¡ŒLLMé¢„è®­ç»ƒ</li>
<li>å®è·µæ€è€ƒåˆ†äº«</li>
</ul>
<blockquote>
<ul>
<li><strong>éš¾ç‚¹:å¦‚ä½•æ„å»ºè®­ç»ƒæ•°æ®ï¼Œå¦‚ä½•é«˜æ•ˆåœ°è¿›è¡Œåˆ†å¸ƒå¼è®­ç»ƒã€‚</strong></li>
</ul>
</blockquote>
<h5 data-id="heading-14">æŒ‡ä»¤ç†è§£éƒ¨åˆ†:å›´ç»•LLMæœ‰ç›‘ç£å¾®è°ƒã€å¼ºåŒ–å­¦ä¹ å±•å¼€</h5>
<ul>
<li>æç¤ºå­¦ä¹ </li>
<li>è¯­å¢ƒå­¦ä¹ </li>
<li>é«˜æ•ˆæ¨¡å‹å¾®è°ƒ(LORAã€Delta Tuningç­‰)</li>
<li>æœ‰ç›‘ç£å¾®è°ƒæ•°æ®æ„é€ æ–¹æ³•</li>
<li>æ¨¡å‹ä¸Šä¸‹æ–‡çª—å£æ‰©å±•</li>
<li>æŒ‡ä»¤æ•°æ®çš„æ„å»º</li>
<li>å¼ºåŒ–å­¦ä¹ åŸºç¡€</li>
<li>RLHF</li>
<li>å¥–åŠ±æ¨¡å‹</li>
<li>è¿‘ç«¯ç­–ç•¥ä¼˜åŒ–</li>
<li>å®è·µ:DeepSpeed-Chat SFT</li>
<li>è®­ç»ƒç±»ChatGPTç³»ç»ŸMOSS-RLHF</li>
<li>å®è·µæ€è€ƒåˆ†äº«</li>
</ul>
<blockquote>
<ul>
<li><strong>éš¾ç‚¹:å¦‚ä½•æ„å»ºè®­ç»ƒæ•°æ®ï¼ŒåŒ…æ‹¬è®­ç»ƒæ•°æ®å†…éƒ¨å¤šä¸ªä»»åŠ¡ä¹‹é—´çš„å…³ç³»ã€è®­ç»ƒæ•°æ®ä¸é¢„è®­ç»ƒä¹‹é—´çš„å…³ç³»åŠè®­ç»ƒæ•°æ®çš„è§„æ¨¡ã€‚å¦‚ä½•è§£å†³å¼ºåŒ–å­¦ä¹ æ–¹æ³•ç¨³å®šæ€§ä¸é«˜è¶…å‚æ•°ä¼—å¤šåŠæ¨¡å‹æ”¶æ•›å›°éš¾ç­‰é—®é¢˜ã€‚</strong></li>
</ul>
</blockquote>
<h5 data-id="heading-15">æ¨¡å‹åº”ç”¨éƒ¨åˆ†:å›´ç»•LLMçš„åº”ç”¨å’Œè¯„ä¼°å±•å¼€</h5>
<ul>
<li>æ€ç»´é“¾æç¤º</li>
<li>ç”±å°‘è‡³å¤šæç¤º</li>
<li>LangChainæŠ€æœ¯</li>
<li>Agent</li>
<li>å¤šæ¨¡æ€å¤§æ¨¡å‹</li>
<li>LLMè¯„ä¼°ä½“ç³»</li>
<li>LLMè¯„ä¼°æ–¹æ³•</li>
<li>LLMè¯„ä¼°å®è·µ</li>
<li>LLMEVAL</li>
<li>å®è·µæ€è€ƒåˆ†äº«</li>
</ul>
<h3 data-id="heading-16">å­¦ä¹ èµ„æºæ¨è</h3>
<p>å¦‚æœä½ æƒ³æ›´æ·±å…¥åœ°å­¦ä¹ å¤§æ¨¡å‹ï¼Œä»¥ä¸‹æ˜¯ä¸€äº›éå¸¸æœ‰ä»·å€¼çš„å­¦ä¹ èµ„æºï¼Œè¿™äº›èµ„æºå°†å¸®åŠ©ä½ ä»ä¸åŒè§’åº¦å­¦ä¹ å¤§æ¨¡å‹ï¼Œæå‡ä½ çš„å®è·µèƒ½åŠ›ã€‚</p>
<blockquote>
<p>æœ¬æ–‡è¾ƒé•¿ï¼Œå»ºè®®ç‚¹èµæ”¶è—ã€‚æ›´å¤šAIå¤§æ¨¡å‹åº”ç”¨å¼€å‘å­¦ä¹ è§†é¢‘åŠèµ„æ–™ï¼Œåœ¨<a href="https://link.juejin.cn?target=https%3A%2F%2Fhy.zhipoai.cn%2F" target="_blank" title="https://hy.zhipoai.cn/" ref="nofollow noopener noreferrer">æ™ºæ³ŠAI</a>ã€‚</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[é™æ€ä»£ç†ä¸åŠ¨æ€ä»£ç†ï¼šæ·±å…¥ç†è§£Javaä»£ç†æ¨¡å¼]]></title>    <link>https://juejin.cn/post/7579169543232077824</link>    <guid>https://juejin.cn/post/7579169543232077824</guid>    <pubDate>2025-12-03T02:55:51.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7579169543232077824" data-draft-id="7579256547789848617" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="é™æ€ä»£ç†ä¸åŠ¨æ€ä»£ç†ï¼šæ·±å…¥ç†è§£Javaä»£ç†æ¨¡å¼"/> <meta itemprop="keywords" content="åç«¯"/> <meta itemprop="datePublished" content="2025-12-03T02:55:51.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="è‹ç¦¾"/> <meta itemprop="url" content="https://juejin.cn/user/3789345759172979"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            é™æ€ä»£ç†ä¸åŠ¨æ€ä»£ç†ï¼šæ·±å…¥ç†è§£Javaä»£ç†æ¨¡å¼
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3789345759172979/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    è‹ç¦¾
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-03T02:55:51.000Z" title="Wed Dec 03 2025 02:55:51 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-03
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    5
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»6åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">ä»£ç†æ¨¡å¼æ¦‚è¿°</h2>
<p>åœ¨è½¯ä»¶å¼€å‘ä¸­ï¼Œä»£ç†æ¨¡å¼æ˜¯ä¸€ç§å¸¸è§çš„è®¾è®¡æ¨¡å¼ï¼Œå®ƒä¸ºå…¶ä»–å¯¹è±¡æä¾›ä¸€ç§ä»£ç†ä»¥æ§åˆ¶å¯¹è¿™ä¸ªå¯¹è±¡çš„è®¿é—®ã€‚ä»£ç†å¯¹è±¡åœ¨å®¢æˆ·ç«¯å’Œç›®æ ‡å¯¹è±¡ä¹‹é—´èµ·åˆ°ä¸­ä»‹ä½œç”¨ï¼Œå¯ä»¥<strong>åœ¨ä¸ä¿®æ”¹ç›®æ ‡å¯¹è±¡ä»£ç çš„å‰æä¸‹</strong>ï¼Œå¢åŠ é¢å¤–çš„åŠŸèƒ½æˆ–æ§åˆ¶è®¿é—®ã€‚</p>
<h2 data-id="heading-1">é™æ€ä»£ç†ï¼šç¼–è¯‘æ—¶ç¡®å®šçš„ä»£ç†</h2>
<h3 data-id="heading-2">ä»€ä¹ˆæ˜¯é™æ€ä»£ç†ï¼Ÿ</h3>
<p>é™æ€ä»£ç†æ˜¯æŒ‡åœ¨<strong>ç¼–è¯‘æ—¶æœŸ</strong>å°±å·²ç»ç¡®å®šä»£ç†ç±»ä¸è¢«ä»£ç†ç±»çš„å…³ç³»ã€‚ä»£ç†ç±»å’Œç›®æ ‡ç±»å®ç°ç›¸åŒçš„æ¥å£ï¼Œä»£ç†ç±»å†…éƒ¨æŒæœ‰ç›®æ ‡å¯¹è±¡çš„å¼•ç”¨ï¼Œå¹¶åœ¨è°ƒç”¨ç›®æ ‡æ–¹æ³•å‰åæ·»åŠ é¢å¤–çš„é€»è¾‘ã€‚</p>
<h3 data-id="heading-3">é™æ€ä»£ç†çš„å®ç°</h3>
<p>è®©æˆ‘ä»¬é€šè¿‡ä¸€ä¸ªç®€å•çš„ä¾‹å­æ¥ç†è§£é™æ€ä»£ç†ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 1. å®šä¹‰æ¥å£</span>
<span class="hljs-keyword">interface</span> <span class="hljs-title class_">UserService</span> {
    <span class="hljs-keyword">void</span> <span class="hljs-title function_">addUser</span><span class="hljs-params">(String username)</span>;
    <span class="hljs-keyword">void</span> <span class="hljs-title function_">deleteUser</span><span class="hljs-params">(String username)</span>;
}

<span class="hljs-comment">// 2. å®ç°ç›®æ ‡ç±»</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">UserServiceImpl</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">UserService</span> {
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">addUser</span><span class="hljs-params">(String username)</span> {
        System.out.println(<span class="hljs-string">"æ·»åŠ ç”¨æˆ·: "</span> + username);
    }
    
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">deleteUser</span><span class="hljs-params">(String username)</span> {
        System.out.println(<span class="hljs-string">"åˆ é™¤ç”¨æˆ·: "</span> + username);
    }
}

<span class="hljs-comment">// 3. åˆ›å»ºä»£ç†ç±»</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">UserServiceProxy</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">UserService</span> {
    <span class="hljs-keyword">private</span> UserService target; <span class="hljs-comment">// ç›®æ ‡å¯¹è±¡</span>
    
    <span class="hljs-keyword">public</span> <span class="hljs-title function_">UserServiceProxy</span><span class="hljs-params">(UserService target)</span> {
        <span class="hljs-built_in">this</span>.target = target;
    }
    
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">addUser</span><span class="hljs-params">(String username)</span> {
        System.out.println(<span class="hljs-string">"ã€ä»£ç†ã€‘å¼€å§‹æ·»åŠ ç”¨æˆ·..."</span>);
        <span class="hljs-type">long</span> <span class="hljs-variable">start</span> <span class="hljs-operator">=</span> System.currentTimeMillis();
        
        <span class="hljs-comment">// è°ƒç”¨ç›®æ ‡æ–¹æ³•</span>
        target.addUser(username);
        
        <span class="hljs-type">long</span> <span class="hljs-variable">end</span> <span class="hljs-operator">=</span> System.currentTimeMillis();
        System.out.println(<span class="hljs-string">"ã€ä»£ç†ã€‘æ·»åŠ ç”¨æˆ·å®Œæˆï¼Œè€—æ—¶: "</span> + (end - start) + <span class="hljs-string">"ms"</span>);
    }
    
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">deleteUser</span><span class="hljs-params">(String username)</span> {
        System.out.println(<span class="hljs-string">"ã€ä»£ç†ã€‘å¼€å§‹åˆ é™¤ç”¨æˆ·..."</span>);
        <span class="hljs-type">long</span> <span class="hljs-variable">start</span> <span class="hljs-operator">=</span> System.currentTimeMillis();
        
        <span class="hljs-comment">// è°ƒç”¨ç›®æ ‡æ–¹æ³•</span>
        target.deleteUser(username);
        
        <span class="hljs-type">long</span> <span class="hljs-variable">end</span> <span class="hljs-operator">=</span> System.currentTimeMillis();
        System.out.println(<span class="hljs-string">"ã€ä»£ç†ã€‘åˆ é™¤ç”¨æˆ·å®Œæˆï¼Œè€—æ—¶: "</span> + (end - start) + <span class="hljs-string">"ms"</span>);
    }
}

<span class="hljs-comment">// 4. å®¢æˆ·ç«¯ä½¿ç”¨</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">StaticProxyDemo</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-comment">// åˆ›å»ºç›®æ ‡å¯¹è±¡</span>
        <span class="hljs-type">UserService</span> <span class="hljs-variable">target</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UserServiceImpl</span>();
        
        <span class="hljs-comment">// åˆ›å»ºä»£ç†å¯¹è±¡ï¼Œå¹¶ä¼ å…¥ç›®æ ‡å¯¹è±¡</span>
        <span class="hljs-type">UserService</span> <span class="hljs-variable">proxy</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UserServiceProxy</span>(target);
        
        <span class="hljs-comment">// é€šè¿‡ä»£ç†å¯¹è±¡è°ƒç”¨æ–¹æ³•</span>
        proxy.addUser(<span class="hljs-string">"å¼ ä¸‰"</span>);
        proxy.deleteUser(<span class="hljs-string">"æå››"</span>);
    }
}
</code></pre>
<h3 data-id="heading-4">é™æ€ä»£ç†çš„ä¼˜ç¼ºç‚¹</h3>
<p><strong>ä¼˜ç‚¹ï¼š</strong></p>
<ul>
<li>ç®€å•ç›´è§‚ï¼Œæ˜“äºç†è§£å’Œå®ç°</li>
<li>åœ¨ä¸ä¿®æ”¹ç›®æ ‡å¯¹è±¡çš„å‰æä¸‹æ‰©å±•åŠŸèƒ½</li>
<li>ç¬¦åˆå¼€é—­åŸåˆ™</li>
</ul>
<p><strong>ç¼ºç‚¹ï¼š</strong></p>
<ul>
<li>ä»£ç†ç±»å’Œç›®æ ‡ç±»å¿…é¡»å®ç°ç›¸åŒçš„æ¥å£ï¼Œå¦‚æœæ¥å£æœ‰å¤šä¸ªæ–¹æ³•ï¼Œä»£ç†ç±»éœ€è¦é‡å†™æ‰€æœ‰æ–¹æ³•</li>
<li>æ¯ä¸ªä»£ç†ç±»åªèƒ½ä»£ç†ä¸€ä¸ªæ¥å£ï¼Œå¦‚æœæœ‰å¤šä¸ªæ¥å£éœ€è¦ä»£ç†ï¼Œéœ€è¦åˆ›å»ºå¤šä¸ªä»£ç†ç±»</li>
<li>ä»£ç†ç±»åœ¨ç¼–è¯‘æ—¶å°±å·²ç»ç¡®å®šï¼Œä¸å¤Ÿçµæ´»</li>
</ul>
<h2 data-id="heading-5">åŠ¨æ€ä»£ç†ï¼šè¿è¡Œæ—¶ç”Ÿæˆçš„ä»£ç†</h2>
<h3 data-id="heading-6">ä»€ä¹ˆæ˜¯åŠ¨æ€ä»£ç†ï¼Ÿ</h3>
<p>åŠ¨æ€ä»£ç†æ˜¯æŒ‡åœ¨<strong>ç¨‹åºè¿è¡Œæ—¶</strong>åŠ¨æ€ç”Ÿæˆä»£ç†ç±»ã€‚Javaæä¾›äº†ä¸¤ç§ä¸»è¦çš„åŠ¨æ€ä»£ç†æœºåˆ¶ï¼š</p>
<ol>
<li><strong>JDKåŠ¨æ€ä»£ç†</strong>ï¼šåŸºäºæ¥å£çš„ä»£ç†</li>
<li><strong>CGLIBåŠ¨æ€ä»£ç†</strong>ï¼šåŸºäºç±»ç»§æ‰¿çš„ä»£ç†</li>
</ol>
<h3 data-id="heading-7">JDKåŠ¨æ€ä»£ç†</h3>
<p>JDKåŠ¨æ€ä»£ç†åˆ©ç”¨Javaçš„åå°„æœºåˆ¶ï¼Œåœ¨è¿è¡Œæ—¶åˆ›å»ºä»£ç†ç±»ã€‚å®ƒè¦æ±‚ç›®æ ‡ç±»å¿…é¡»å®ç°æ¥å£ã€‚</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> java.lang.reflect.InvocationHandler;
<span class="hljs-keyword">import</span> java.lang.reflect.Method;
<span class="hljs-keyword">import</span> java.lang.reflect.Proxy;

<span class="hljs-comment">// 1. å®šä¹‰æ¥å£å’Œç›®æ ‡ç±»ï¼ˆä¸é™æ€ä»£ç†ç›¸åŒï¼‰</span>
<span class="hljs-keyword">interface</span> <span class="hljs-title class_">OrderService</span> {
    <span class="hljs-keyword">void</span> <span class="hljs-title function_">createOrder</span><span class="hljs-params">(String orderId)</span>;
    <span class="hljs-keyword">void</span> <span class="hljs-title function_">cancelOrder</span><span class="hljs-params">(String orderId)</span>;
}

<span class="hljs-keyword">class</span> <span class="hljs-title class_">OrderServiceImpl</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">OrderService</span> {
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">createOrder</span><span class="hljs-params">(String orderId)</span> {
        System.out.println(<span class="hljs-string">"åˆ›å»ºè®¢å•: "</span> + orderId);
    }
    
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">cancelOrder</span><span class="hljs-params">(String orderId)</span> {
        System.out.println(<span class="hljs-string">"å–æ¶ˆè®¢å•: "</span> + orderId);
    }
}

<span class="hljs-comment">// 2. åˆ›å»ºInvocationHandlerå®ç°ç±»</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">LoggingHandler</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">InvocationHandler</span> {
    <span class="hljs-keyword">private</span> Object target; <span class="hljs-comment">// ç›®æ ‡å¯¹è±¡</span>
    
    <span class="hljs-keyword">public</span> <span class="hljs-title function_">LoggingHandler</span><span class="hljs-params">(Object target)</span> {
        <span class="hljs-built_in">this</span>.target = target;
    }
    
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> Object <span class="hljs-title function_">invoke</span><span class="hljs-params">(Object proxy, Method method, Object[] args)</span> <span class="hljs-keyword">throws</span> Throwable {
        <span class="hljs-type">String</span> <span class="hljs-variable">methodName</span> <span class="hljs-operator">=</span> method.getName();
        System.out.println(<span class="hljs-string">"ã€åŠ¨æ€ä»£ç†ã€‘å¼€å§‹æ‰§è¡Œæ–¹æ³•: "</span> + methodName);
        <span class="hljs-type">long</span> <span class="hljs-variable">start</span> <span class="hljs-operator">=</span> System.currentTimeMillis();
        
        <span class="hljs-comment">// è°ƒç”¨ç›®æ ‡æ–¹æ³•</span>
        <span class="hljs-type">Object</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> method.invoke(target, args);
        
        <span class="hljs-type">long</span> <span class="hljs-variable">end</span> <span class="hljs-operator">=</span> System.currentTimeMillis();
        System.out.println(<span class="hljs-string">"ã€åŠ¨æ€ä»£ç†ã€‘æ–¹æ³•æ‰§è¡Œå®Œæˆï¼Œè€—æ—¶: "</span> + (end - start) + <span class="hljs-string">"ms"</span>);
        
        <span class="hljs-keyword">return</span> result;
    }
}

<span class="hljs-comment">// 3. åŠ¨æ€ä»£ç†å·¥å‚ç±»</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">ProxyFactory</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Object <span class="hljs-title function_">createProxy</span><span class="hljs-params">(Object target)</span> {
        <span class="hljs-keyword">return</span> Proxy.newProxyInstance(
            target.getClass().getClassLoader(), <span class="hljs-comment">// ç±»åŠ è½½å™¨</span>
            target.getClass().getInterfaces(),  <span class="hljs-comment">// ç›®æ ‡å¯¹è±¡å®ç°çš„æ¥å£</span>
            <span class="hljs-keyword">new</span> <span class="hljs-title class_">LoggingHandler</span>(target)          <span class="hljs-comment">// InvocationHandler</span>
        );
    }
}

<span class="hljs-comment">// 4. å®¢æˆ·ç«¯ä½¿ç”¨</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DynamicProxyDemo</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-comment">// åˆ›å»ºç›®æ ‡å¯¹è±¡</span>
        <span class="hljs-type">OrderService</span> <span class="hljs-variable">target</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">OrderServiceImpl</span>();
        
        <span class="hljs-comment">// åˆ›å»ºåŠ¨æ€ä»£ç†</span>
        <span class="hljs-type">OrderService</span> <span class="hljs-variable">proxy</span> <span class="hljs-operator">=</span> (OrderService) ProxyFactory.createProxy(target);
        
        <span class="hljs-comment">// é€šè¿‡ä»£ç†å¯¹è±¡è°ƒç”¨æ–¹æ³•</span>
        proxy.createOrder(<span class="hljs-string">"ORD001"</span>);
        proxy.cancelOrder(<span class="hljs-string">"ORD002"</span>);
        
        <span class="hljs-comment">// å¯ä»¥æŸ¥çœ‹ä»£ç†ç±»çš„ä¿¡æ¯</span>
        System.out.println(<span class="hljs-string">"ä»£ç†ç±»: "</span> + proxy.getClass().getName());
        System.out.println(<span class="hljs-string">"ä»£ç†ç±»çš„çˆ¶ç±»: "</span> + proxy.getClass().getSuperclass().getName());
        System.out.println(<span class="hljs-string">"ä»£ç†ç±»å®ç°çš„æ¥å£: "</span>);
        <span class="hljs-keyword">for</span> (Class&lt;?&gt; clazz : proxy.getClass().getInterfaces()) {
            System.out.println(<span class="hljs-string">"  - "</span> + clazz.getName());
        }
    }
}
</code></pre>
<h3 data-id="heading-8">CGLIBåŠ¨æ€ä»£ç†</h3>
<p>CGLIBï¼ˆCode Generation Libraryï¼‰æ˜¯ä¸€ä¸ªå¼ºå¤§çš„ã€é«˜æ€§èƒ½çš„ä»£ç ç”Ÿæˆåº“ï¼Œå®ƒå¯ä»¥åœ¨è¿è¡Œæ—¶æ‰©å±•Javaç±»å’Œå®ç°Javaæ¥å£ã€‚ä¸JDKåŠ¨æ€ä»£ç†ä¸åŒï¼ŒCGLIBå¯ä»¥ä»£ç†æ²¡æœ‰å®ç°æ¥å£çš„ç±»ã€‚</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> net.sf.cglib.proxy.Enhancer;
<span class="hljs-keyword">import</span> net.sf.cglib.proxy.MethodInterceptor;
<span class="hljs-keyword">import</span> net.sf.cglib.proxy.MethodProxy;
<span class="hljs-keyword">import</span> java.lang.reflect.Method;

<span class="hljs-comment">// 1. ç›®æ ‡ç±»ï¼ˆä¸éœ€è¦å®ç°æ¥å£ï¼‰</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">ProductService</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">addProduct</span><span class="hljs-params">(String productName)</span> {
        System.out.println(<span class="hljs-string">"æ·»åŠ äº§å“: "</span> + productName);
    }
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">updateProduct</span><span class="hljs-params">(String productName)</span> {
        System.out.println(<span class="hljs-string">"æ›´æ–°äº§å“: "</span> + productName);
    }
}

<span class="hljs-comment">// 2. åˆ›å»ºMethodInterceptorå®ç°ç±»</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">CglibProxyInterceptor</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">MethodInterceptor</span> {
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> Object <span class="hljs-title function_">intercept</span><span class="hljs-params">(Object obj, Method method, Object[] args, MethodProxy proxy)</span> <span class="hljs-keyword">throws</span> Throwable {
        <span class="hljs-type">String</span> <span class="hljs-variable">methodName</span> <span class="hljs-operator">=</span> method.getName();
        System.out.println(<span class="hljs-string">"ã€CGLIBä»£ç†ã€‘å¼€å§‹æ‰§è¡Œæ–¹æ³•: "</span> + methodName);
        <span class="hljs-type">long</span> <span class="hljs-variable">start</span> <span class="hljs-operator">=</span> System.currentTimeMillis();
        
        <span class="hljs-comment">// è°ƒç”¨ç›®æ ‡æ–¹æ³•</span>
        <span class="hljs-type">Object</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> proxy.invokeSuper(obj, args);
        
        <span class="hljs-type">long</span> <span class="hljs-variable">end</span> <span class="hljs-operator">=</span> System.currentTimeMillis();
        System.out.println(<span class="hljs-string">"ã€CGLIBä»£ç†ã€‘æ–¹æ³•æ‰§è¡Œå®Œæˆï¼Œè€—æ—¶: "</span> + (end - start) + <span class="hljs-string">"ms"</span>);
        
        <span class="hljs-keyword">return</span> result;
    }
}

<span class="hljs-comment">// 3. CGLIBä»£ç†å·¥å‚</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">CglibProxyFactory</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Object <span class="hljs-title function_">createProxy</span><span class="hljs-params">(Class&lt;?&gt; targetClass)</span> {
        <span class="hljs-comment">// åˆ›å»ºå¢å¼ºå™¨</span>
        <span class="hljs-type">Enhancer</span> <span class="hljs-variable">enhancer</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Enhancer</span>();
        
        <span class="hljs-comment">// è®¾ç½®çˆ¶ç±»ï¼ˆç›®æ ‡ç±»ï¼‰</span>
        enhancer.setSuperclass(targetClass);
        
        <span class="hljs-comment">// è®¾ç½®å›è°ƒ</span>
        enhancer.setCallback(<span class="hljs-keyword">new</span> <span class="hljs-title class_">CglibProxyInterceptor</span>());
        
        <span class="hljs-comment">// åˆ›å»ºä»£ç†å¯¹è±¡</span>
        <span class="hljs-keyword">return</span> enhancer.create();
    }
}

<span class="hljs-comment">// 4. å®¢æˆ·ç«¯ä½¿ç”¨</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CglibProxyDemo</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-comment">// åˆ›å»ºCGLIBä»£ç†</span>
        <span class="hljs-type">ProductService</span> <span class="hljs-variable">proxy</span> <span class="hljs-operator">=</span> (ProductService) CglibProxyFactory.createProxy(ProductService.class);
        
        <span class="hljs-comment">// é€šè¿‡ä»£ç†å¯¹è±¡è°ƒç”¨æ–¹æ³•</span>
        proxy.addProduct(<span class="hljs-string">"ç¬”è®°æœ¬ç”µè„‘"</span>);
        proxy.updateProduct(<span class="hljs-string">"æ™ºèƒ½æ‰‹æœº"</span>);
        
        <span class="hljs-comment">// å¯ä»¥æŸ¥çœ‹ä»£ç†ç±»çš„ä¿¡æ¯</span>
        System.out.println(<span class="hljs-string">"ä»£ç†ç±»: "</span> + proxy.getClass().getName());
        System.out.println(<span class="hljs-string">"ä»£ç†ç±»çš„çˆ¶ç±»: "</span> + proxy.getClass().getSuperclass().getName());
    }
}
</code></pre>
<h3 data-id="heading-9">åŠ¨æ€ä»£ç†çš„ä¼˜ç¼ºç‚¹</h3>
<p><strong>ä¼˜ç‚¹ï¼š</strong></p>
<ul>
<li>é«˜åº¦çµæ´»ï¼Œä¸€ä¸ªä»£ç†ç±»å¯ä»¥ä»£ç†å¤šä¸ªæ¥å£</li>
<li>å‡å°‘ä»£ç é‡ï¼Œä¸éœ€è¦ä¸ºæ¯ä¸ªç›®æ ‡ç±»åˆ›å»ºä»£ç†ç±»</li>
<li>å¯ä»¥åœ¨è¿è¡Œæ—¶å†³å®šä»£ç†å“ªä¸ªå¯¹è±¡</li>
</ul>
<p><strong>ç¼ºç‚¹ï¼š</strong></p>
<ul>
<li>JDKåŠ¨æ€ä»£ç†åªèƒ½ä»£ç†å®ç°äº†æ¥å£çš„ç±»</li>
<li>CGLIBä¸èƒ½ä»£ç†finalç±»æˆ–finalæ–¹æ³•</li>
<li>åŠ¨æ€ä»£ç†çš„æ€§èƒ½ç•¥ä½äºé™æ€ä»£ç†ï¼ˆä½†å½±å“é€šå¸¸å¾ˆå°ï¼‰</li>
</ul>
<h2 data-id="heading-10">é™æ€ä»£ç† vs åŠ¨æ€ä»£ç†ï¼šæ ¸å¿ƒå¯¹æ¯”</h2>








































<table><thead><tr><th>ç‰¹æ€§</th><th>é™æ€ä»£ç†</th><th>åŠ¨æ€ä»£ç†</th></tr></thead><tbody><tr><td><strong>å®ç°æ—¶æœº</strong></td><td>ç¼–è¯‘æ—¶</td><td>è¿è¡Œæ—¶</td></tr><tr><td><strong>å®ç°æ–¹å¼</strong></td><td>æ‰‹åŠ¨ç¼–å†™ä»£ç†ç±»</td><td>é€šè¿‡åå°„æˆ–å­—èŠ‚ç ç”Ÿæˆ</td></tr><tr><td><strong>çµæ´»æ€§</strong></td><td>ä½ï¼Œä¸€ä¸ªä»£ç†ç±»åªèƒ½ä»£ç†ä¸€ä¸ªæ¥å£</td><td>é«˜ï¼Œä¸€ä¸ªä»£ç†ç±»å¯ä»¥ä»£ç†å¤šä¸ªæ¥å£</td></tr><tr><td><strong>ä»£ç é‡</strong></td><td>å¤šï¼Œéœ€è¦ä¸ºæ¯ä¸ªç›®æ ‡ç±»ç¼–å†™ä»£ç†ç±»</td><td>å°‘ï¼Œé€šè¿‡é€šç”¨ä»£ç å¤„ç†å¤šä¸ªç±»</td></tr><tr><td><strong>æ€§èƒ½</strong></td><td>ç•¥é«˜ï¼ˆç›´æ¥è°ƒç”¨ï¼‰</td><td>ç•¥ä½ï¼ˆåå°„è°ƒç”¨ï¼‰</td></tr><tr><td><strong>é€‚ç”¨åœºæ™¯</strong></td><td>æ¥å£æ–¹æ³•å°‘ï¼Œä»£ç†é€»è¾‘ç®€å•</td><td>æ¥å£æ–¹æ³•å¤šï¼Œä»£ç†é€»è¾‘å¤æ‚</td></tr></tbody></table>
<h2 data-id="heading-11">å®é™…åº”ç”¨åœºæ™¯</h2>
<h3 data-id="heading-12">é™æ€ä»£ç†é€‚ç”¨åœºæ™¯</h3>
<ul>
<li>AOPï¼ˆé¢å‘åˆ‡é¢ç¼–ç¨‹ï¼‰çš„ç®€å•å®ç°</li>
<li>æƒé™æ§åˆ¶</li>
<li>æœ¬åœ°è¿œç¨‹ä»£ç†</li>
</ul>
<h3 data-id="heading-13">åŠ¨æ€ä»£ç†é€‚ç”¨åœºæ™¯</h3>
<ol>
<li><strong>Spring AOP</strong>ï¼šSpringæ¡†æ¶ä½¿ç”¨JDKåŠ¨æ€ä»£ç†å’ŒCGLIBå®ç°AOP</li>
<li><strong>MyBatis</strong>ï¼šMapperæ¥å£çš„ä»£ç†å®ç°</li>
<li><strong>RPCæ¡†æ¶</strong>ï¼šè¿œç¨‹æ–¹æ³•è°ƒç”¨çš„å®¢æˆ·ç«¯ä»£ç†</li>
<li><strong>äº‹åŠ¡ç®¡ç†</strong>ï¼šå£°æ˜å¼äº‹åŠ¡çš„å®ç°</li>
<li><strong>æ—¥å¿—è®°å½•</strong>ï¼šæ–¹æ³•è°ƒç”¨çš„æ—¥å¿—è®°å½•</li>
</ol>
<h3 data-id="heading-14">Springæ¡†æ¶ä¸­çš„ä»£ç†ç¤ºä¾‹</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// Springä¸­å¸¸ç”¨çš„æ³¨è§£é©±åŠ¨ä»£ç†</span>
<span class="hljs-meta">@Service</span>
<span class="hljs-meta">@Transactional</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserServiceImpl</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">UserService</span> {
    
    <span class="hljs-meta">@Override</span>
    <span class="hljs-meta">@LogExecutionTime</span> <span class="hljs-comment">// è‡ªå®šä¹‰æ³¨è§£ï¼Œé€šè¿‡AOPå®ç°æ–¹æ³•æ‰§è¡Œæ—¶é—´æ—¥å¿—</span>
    <span class="hljs-keyword">public</span> User <span class="hljs-title function_">findUserById</span><span class="hljs-params">(Long id)</span> {
        <span class="hljs-comment">// ä¸šåŠ¡é€»è¾‘</span>
        <span class="hljs-keyword">return</span> userRepository.findById(id);
    }
    
    <span class="hljs-meta">@Override</span>
    <span class="hljs-meta">@PreAuthorize("hasRole('ADMIN')")</span> <span class="hljs-comment">// Spring Securityæƒé™æ§åˆ¶</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">deleteUser</span><span class="hljs-params">(Long id)</span> {
        <span class="hljs-comment">// ä¸šåŠ¡é€»è¾‘</span>
        userRepository.deleteById(id);
    }
}
</code></pre>
<h2 data-id="heading-15">æ€»ç»“</h2>
<p>ä»£ç†æ¨¡å¼æ˜¯Javaä¸­éå¸¸é‡è¦ä¸”å®ç”¨çš„è®¾è®¡æ¨¡å¼ã€‚é™æ€ä»£ç†ç®€å•ç›´è§‚ï¼Œé€‚åˆç®€å•çš„ä»£ç†éœ€æ±‚ï¼›åŠ¨æ€ä»£ç†çµæ´»å¼ºå¤§ï¼Œé€‚åˆå¤æ‚çš„ç³»ç»Ÿæ¶æ„ã€‚ç†è§£ä¸¤è€…çš„åŸç†å’Œé€‚ç”¨åœºæ™¯ï¼Œèƒ½å¤Ÿå¸®åŠ©æˆ‘ä»¬åœ¨å®é™…å¼€å‘ä¸­åšå‡ºæ›´åˆé€‚çš„æŠ€æœ¯é€‰æ‹©ã€‚</p>
<p>æ— è®ºæ˜¯é™æ€ä»£ç†è¿˜æ˜¯åŠ¨æ€ä»£ç†ï¼Œå®ƒä»¬éƒ½ä½“ç°äº†é¢å‘å¯¹è±¡è®¾è®¡çš„ä¸€ä¸ªé‡è¦åŸåˆ™ï¼š<strong>å¯¹æ‰©å±•å¼€æ”¾ï¼Œå¯¹ä¿®æ”¹å…³é—­</strong>ã€‚é€šè¿‡ä»£ç†æ¨¡å¼ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ä¸ä¿®æ”¹åŸæœ‰ä»£ç çš„åŸºç¡€ä¸Šï¼Œä¸ºç³»ç»Ÿæ·»åŠ æ–°çš„åŠŸèƒ½ï¼Œè¿™å¤§å¤§æé«˜äº†ä»£ç çš„å¯ç»´æŠ¤æ€§å’Œå¯æ‰©å±•æ€§ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[zustand ä»åŸç†åˆ°å®è·µ - åŸç†ç¯‡(1)]]></title>    <link>https://juejin.cn/post/7579165599042273295</link>    <guid>https://juejin.cn/post/7579165599042273295</guid>    <pubDate>2025-12-03T02:59:01.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7579165599042273295" data-draft-id="7575031395862003758" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="zustand ä»åŸç†åˆ°å®è·µ - åŸç†ç¯‡(1)"/> <meta itemprop="keywords" content="React.js"/> <meta itemprop="datePublished" content="2025-12-03T02:59:01.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="é²¨å”"/> <meta itemprop="url" content="https://juejin.cn/user/413072101215944"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            zustand ä»åŸç†åˆ°å®è·µ - åŸç†ç¯‡(1)
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/413072101215944/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    é²¨å”
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-03T02:59:01.000Z" title="Wed Dec 03 2025 02:59:01 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-03
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»9åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">åˆè¯† zustand</h2>
<h3 data-id="heading-1">ä»€ä¹ˆæ˜¯ zustand ï¼Ÿ</h3>
<p>æ²¡é”™ï¼Œzustand åˆæ˜¯ä¸€ä¸ªåŸºäº React çš„çŠ¶æ€ç®¡ç†åº“ã€‚Zustand çš„å‘éŸ³ä¸º /ËˆzuËstÃ¦nd/ã€‚è¯¥è¯æºè‡ªå¾·è¯­ï¼Œæœ¬ä¹‰å°±æ˜¯â€œçŠ¶æ€â€ï¼ˆcondition, stateï¼‰ï¼Œä¸åº“çš„æ ¸å¿ƒåŠŸèƒ½â€œçŠ¶æ€ç®¡ç†â€æ­£å¥½åŒä¹‰ï¼Œç®—æ˜¯ä¸€ç§â€œç›´ç»™å¼â€å‘½åã€‚</p>
<p>ä¹Ÿè®¸ä½ ä¼šé—®ï¼Œä»åˆç”Ÿä»£çš„ reduxï¼Œmobx å’Œ xstateï¼Œå†åˆ°ä¸­ç”Ÿä»£çš„å…¶ä»–çš„çŠ¶æ€ç®¡ç†åº“ï¼Œå¦‚ redux + reduxToolkitï¼Œcontext baseï¼Œ recoilï¼Œjotaiç­‰ï¼Œå¯ä¾›é€‰æ‹©çš„ react çš„ç¬¬ä¸‰æ–¹çŠ¶æ€ç®¡ç†åº“å·²ç»æœ‰äº†å¾ˆå¤šï¼Œé‚£ä¹ˆæˆ‘ä¸ºä»€ä¹ˆè¿˜è¦é€‰æ‹© zustand å‘¢ï¼Ÿ</p>
<p>ç­”æ¡ˆæ˜¯ï¼Œzustand è¶³å¤Ÿç®€å•ã€å¿«é€Ÿã€é«˜æ€§èƒ½ï¼Œç‰¹åˆ«é€‚åˆäºä¸­å°å‹é¡¹ç›®ï¼ˆå¤§éƒ¨åˆ†äººåšçš„å°±æ˜¯è¿™ç§è§„æ¨¡çš„é¡¹ç›®ï¼‰ï¼Œæˆ–è€…éœ€è¦ä»¥ç‰¹åˆ«ä½çš„æˆæœ¬å¿«é€Ÿå®ç°çŠ¶æ€ç®¡ç†çš„åœºæ™¯ã€‚</p>
<h3 data-id="heading-2">zustand ç‰¹ç‚¹</h3>
<h4 data-id="heading-3">ç®€å•</h4>
<p>è¯´å®ƒç®€å•ï¼Œæ˜¯å› ä¸ºæ ¸å¿ƒçš„ API æ•°é‡åªæœ‰ä¸‰ä¸ªï¼š<code>create()</code>ã€<code>useBoundStore()</code>ã€<code>setState()</code>ã€‚è¿™ä½¿å¾—å®ƒéå¸¸æ˜“äºå­¦ä¹ å’Œä½¿ç”¨ï¼Œå³ä½¿æ˜¯ React æ–°æ‰‹ä¹Ÿèƒ½å¿«é€Ÿä¸Šæ‰‹ã€‚</p>
<blockquote>
<p>æ‰€è°“çš„ã€ŒuseBoundStoreã€å°±æ˜¯æŒ‡é€šè¿‡é€šè¿‡é—­åŒ…æ¥ã€Œç»‘å®šã€äº†ä½ é€šè¿‡<code>create()</code>æ¥åˆ›å»ºçš„ zustand store å®ä¾‹çš„è‡ªå®šä¹‰ hook å‡½æ•°ã€‚è¿™é‡Œçš„â€œBoundâ€ï¼Œåœ¨ç†è§£ä¸Šè¦æ›¿æ¢ä¸ºç›¸åº”çš„ä¸šåŠ¡é¢†åŸŸçš„ scope åï¼Œæ¯”å¦‚ <code>useUserStore</code>ã€‚</p>
</blockquote>
<p>è€Œè¿™äº›æ ¸å¿ƒçš„ APIè®¾è®¡æ—¶å€™çš„å‡½æ•°ç­¾åä½¿ç”¨çš„éƒ½æ˜¯å·²ç»è¢«ç¤¾åŒºæ™®éæ¥å—çš„å¿ƒæ™ºæ¨¡å‹ï¼š</p>
<ul>
<li><code>create()</code>ï¼šç”¨äºåˆ›å»ºä¸€ä¸ªçŠ¶æ€çš„ storeã€‚ä½¿ç”¨ä¹‹åˆï¼Œå…ˆåˆ›å»ºä¸€ä¸ª storeï¼Œè¿™å¯¹äºä½¿ç”¨è¿‡ redux çš„äººç¾¤æ¥è¯´ï¼Œæ˜¯ä¸€ä¸ªæ¯”è¾ƒç†ŸçŸ¥çš„æ¦‚å¿µã€‚</li>
<li><code>useBoundStore()</code>ï¼šç”¨äºåœ¨ç»„ä»¶ä¸­è®¢é˜…çŠ¶æ€å˜åŒ–å¹¶è·å–çŠ¶æ€å€¼ã€‚åœ¨ react çš„ hook æ—¶ä»£ï¼Œè¦æƒ³ä½¿ç”¨ storeï¼Œå…ˆ useXxx ä¸€ä¸‹ï¼Œè¿™å‡ ä¹æˆä¸ºäº† react å¼€å‘è€…çš„æ€ç»´æƒ¯æ€§äº†ã€‚è€Œä¸”è¿™ä¸ä½¿ç”¨ redux ä¸­çš„ <code>useSelector()</code> æ˜¯éå¸¸ç›¸ä¼¼çš„ã€‚</li>
<li><code>setState()</code>ï¼šç”¨äºæ›´æ–°çŠ¶æ€å€¼ã€‚</li>
</ul>
<p>è¯´å®ƒç®€å•çš„å¦ä¸€ä¸ªåŸå› æ˜¯ä» redux ä¹‹å‰çš„åŸå§‹èŒƒå¼çš„è§†è§’æ¥è®²çš„ã€‚åœ¨ redux çš„åŸå§‹èŒƒå¼é‡Œé¢ï¼ŒçŠ¶æ€ç®¡ç†çš„æ¦‚å¿µå’Œä»£ç æ˜¯æ‹†åˆ†å¾—å¾ˆç»†çš„ã€‚è¿™é‡Œé¢æœ‰ store, stateï¼Œreducerï¼Œactionï¼Œdispatch ç­‰ã€‚ç”±äº redux æ¯”è¾ƒæ¨å´‡å•ä¸€ store æ¨¡å¼ï¼Œå¾€å¾€ä½ è¿˜è¦ combine ä¸€ä¸‹ æ‰€æœ‰çš„ reducerã€‚å¦‚æœå†åŠ ä¸Šå®ƒçš„ä¸‰å±‚æ´‹è‘±æ¨¡å‹çš„ä¸­é—´ä»¶æœºåˆ¶ï¼ŒçŠ¶æ€ç®¡ç†çš„ä»£ç å°±ä¼šå˜å¾—æ¯”è¾ƒå¤æ‚äº†ã€‚å½“ç„¶ï¼Œè¿™ä¹ˆåšå¥½å¤„æ˜¯ï¼Œä½ å¯ä»¥éå¸¸æ¸…æ™°åœ°çœ‹åˆ°ä¸€ä¸ªå•å‘çš„æ•°æ®æµï¼Œä¸”çŠ¶æ€ç®¡ç†çš„æ¯ä¸€ä¸ªç¯èŠ‚éƒ½å¯ä»¥è¢«å®¡è§†ï¼Œè¿™å¯¹äºè°ƒè¯•å’Œç»´æŠ¤éƒ½æ˜¯éå¸¸æœ‰å¸®åŠ©çš„ã€‚æ‰€ä»¥ï¼Œå½“å‰ç¤¾åŒºçš„æ™®éçš„è®¤çŸ¥æ˜¯ï¼Œ redux çš„çŠ¶æ€ç®¡ç†èŒƒå¼æ˜¯æ›´é€‚ç”¨äºå¤§è§„æ¨¡çš„ï¼Œé•¿æœŸç»´æŠ¤çš„å‰ç«¯é¡¹ç›®ã€‚</p>
<p>è€Œ zustand åˆ™æ˜¯åŸºäºè¿™ä¸ªåŸå§‹èŒƒå¼çš„ä¸€ä¸ªç®€åŒ–ç‰ˆæœ¬ã€‚ zustand åªä¿ç•™äº† store çš„æ¦‚å¿µã€‚ä¸€åˆ‡éƒ½æ˜¯å›´ç»• store å±•å¼€çš„ã€‚æ— éå°±æ˜¯ä¸‰éƒ¨æ›²ï¼š</p>
<ol>
<li>å®šä¹‰ storeï¼ˆåŒ…å«äº† state å’Œ actionï¼‰ - <code>StateCreator</code>ï¼›</li>
<li>åˆ›å»º store - <code>create</code>ï¼›</li>
<li>åœ¨ç»„ä»¶ä¸­ä½¿ç”¨ store - <code>useBoundStore</code>ã€‚</li>
</ol>
<h4 data-id="heading-4">çµæ´»</h4>
<p>zustand æ˜¯å¾ˆçµæ´»çš„ï¼Œå› ä¸ºä½ å¯ä»¥åœ¨ä»»ä½•åœ°æ–¹ï¼ˆreact ç¯å¢ƒå’Œé react ç¯å¢ƒï¼‰å»è°ƒç”¨ <code>setState()</code> æ¥è§¦å‘ react ç•Œé¢æ›´æ–°ã€‚å®ƒå®ç°çµæ´»çš„ç§˜è¯€åœ¨äºå……åˆ†åˆ©ç”¨äº† react åŸç”Ÿ API <code>useSyncExternalStore</code> å¯¹é react ç¯å¢ƒè§¦å‘ state æ›´æ–°çš„çš„æ”¯æŒå’Œ js ä¸­å‡½æ•°ä¹Ÿæ˜¯å¯¹è±¡çš„è¯­è¨€ç‰¹æ€§ã€‚</p>
<blockquote>
<p>æœ¬æ–‡ä¸­çš„ã€Œé react ç¯å¢ƒã€æŒ‡çš„å°±æ˜¯ã€Œéç»„ä»¶å‡½æ•°ä½œç”¨åŸŸã€ã€‚æ¢å¥è¯ï¼Œå°±æ˜¯æŒ‡é‚£äº›ä¸èƒ½è°ƒç”¨ react hook å‡½æ•°çš„åœ°æ–¹ã€‚</p>
</blockquote>
<p>ä¸€å¥è¯ï¼Œä¸»è¦ä½ èƒ½æ‹¿åˆ° zustand store çš„ <code>setState()</code> å‡½æ•°ï¼Œå°±å¯ä»¥åœ¨ä»»ä½•åœ°æ–¹è§¦å‘ react ç•Œé¢æ›´æ–°ã€‚å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªä¸‹é¢ä»£ç çš„ storeï¼š</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">import</span> create <span class="hljs-keyword">from</span> <span class="hljs-string">'zustand'</span>

<span class="hljs-keyword">const</span> useBoundStore = <span class="hljs-title function_">create</span>(<span class="hljs-function">(<span class="hljs-params">set</span>) =&gt;</span> ({
  <span class="hljs-attr">count</span>: <span class="hljs-number">0</span>,
  <span class="hljs-attr">increment</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">set</span>(<span class="hljs-function">(<span class="hljs-params">state</span>) =&gt;</span> ({ <span class="hljs-attr">count</span>: state.<span class="hljs-property">count</span> + <span class="hljs-number">1</span> })),
}))
</code></pre>
<p>é‚£ä¹ˆï¼Œæ€æ ·æ‹¿åˆ° <code>setState()</code> handlerå‘¢ï¼Ÿæ–¹æ³•æœ‰äºŒã€‚</p>
<h5 data-id="heading-5">æ–¹æ³•ä¸€</h5>
<p>zustand ä¼šå¾€ <code>StateCreator</code> æ³¨å…¥ <code>setState()</code> å‡½æ•°å¼•ç”¨ã€‚ä½ å¯ä»¥åœ¨ <code>StateCreator</code> ä¸­é€šè¿‡ç›´æ¥ä½¿ç”¨ <code>setState()</code> å‡½æ•°æ¥å®šä¹‰ actionã€‚ç„¶åï¼Œåœ¨ç»„ä»¶ä¸­ä½¿ç”¨ <code>useStore()</code> æ¥è·å– action å‡½æ•°ã€‚</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">import</span> { useBoundStore } <span class="hljs-keyword">from</span> <span class="hljs-string">'./store'</span>

<span class="hljs-keyword">const</span> <span class="hljs-title function_">MyComponent</span> = (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-keyword">const</span> count = <span class="hljs-title function_">useBoundStore</span>(<span class="hljs-function">(<span class="hljs-params">state</span>) =&gt;</span> state.<span class="hljs-property">count</span>)
  <span class="hljs-keyword">const</span> increment = <span class="hljs-title function_">useBoundStore</span>(<span class="hljs-function">(<span class="hljs-params">state</span>) =&gt;</span> state.<span class="hljs-property">increment</span>)

  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>Count: {count}<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{increment}</span>&gt;</span>Increment<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  )
}
</code></pre>
<h5 data-id="heading-6">æ–¹æ³•äºŒ</h5>
<p>zustand å·²ç»åˆ©ç”¨ã€Œå‡½æ•°å³å¯¹è±¡ã€çš„è¯­è¨€ç‰¹æ€§ï¼ŒæŠŠ store å®ä¾‹çš„ API ï¼ˆè¿™é‡Œé¢å°±åŒ…å«äº† <code>setState()</code>æ–¹æ³•ï¼‰æŒ‚è½½åˆ°è¿”å›çš„ <code>useStore()</code> å‡½æ•°ä¸Šé¢äº†ã€‚æ¢å¥è¯è¯´ï¼Œä½ å¯ä»¥ç›´æ¥åœ¨ç»„ä»¶ä¸­ä½¿ç”¨ <code>useBoundStore.setState()</code> æ¥è®¿é—® <code>setState()</code> å‡½æ•°ã€‚</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">import</span> { useStore } <span class="hljs-keyword">from</span> <span class="hljs-string">'./store'</span>

<span class="hljs-keyword">const</span> <span class="hljs-title function_">MyComponent</span> = (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-keyword">const</span> count = <span class="hljs-title function_">useStore</span>(<span class="hljs-function">(<span class="hljs-params">state</span>) =&gt;</span> state.<span class="hljs-property">count</span>)
  <span class="hljs-keyword">const</span> setState = useStore.<span class="hljs-property">setState</span>

  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>Count: {count}<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{()</span> =&gt;</span> setState({ count: count + 1 })}&gt;Increment<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  )
}
</code></pre>
<p>å› ä¸º <code>useBoundStore</code> æ—¢æ˜¯ä¸€ä¸ª hookï¼Œ åˆæ˜¯ä¸€ä¸ªæ™®é€šçš„å‡½æ•°å¯¹è±¡ï¼Œæ‰€ä»¥ä½ å¯ä»¥åœ¨ä»»ä½•åœ°æ–¹è°ƒç”¨å®ƒï¼ŒåŒ…æ‹¬é react ç¯å¢ƒã€‚è¿™è¿›ä¸€æ­¥æé«˜äº† zustand åœ¨ä½¿ç”¨ä¸Šçš„çµæ´»åº¦ã€‚æ¯”å¦‚ï¼Œä½ å®Œå…¨å¯ä»¥è¿™ä¹ˆç”¨ï¼š</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">import</span> { useBoundStore } <span class="hljs-keyword">from</span> <span class="hljs-string">'./store'</span>

<span class="hljs-keyword">const</span> <span class="hljs-title function_">increment</span> = (<span class="hljs-params"/>) =&gt;
  useBoundStore.<span class="hljs-title function_">setState</span>(<span class="hljs-function">(<span class="hljs-params">state</span>) =&gt;</span> ({ <span class="hljs-attr">count</span>: state.<span class="hljs-property">count</span> + <span class="hljs-number">1</span> }))

<span class="hljs-keyword">const</span> <span class="hljs-title function_">MyComponent</span> = (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-keyword">const</span> count = <span class="hljs-title function_">useBoundStore</span>(<span class="hljs-function">(<span class="hljs-params">state</span>) =&gt;</span> state.<span class="hljs-property">count</span>)

  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>Count: {count}<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{increment}</span>&gt;</span>Increment<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  )
}
</code></pre>
<h4 data-id="heading-7">é«˜æ€§èƒ½</h4>
<p>è¿™é‡Œçš„é«˜æ€§èƒ½æŒ‡çš„æ˜¯ï¼Œzustand å®ç°äº†çœŸæ­£çš„ã€ŒæŒ‰éœ€æ¸²æŸ“ã€ã€‚ä»€ä¹ˆæ˜¯æŒ‰éœ€æ¸²æŸ“ï¼Ÿç®€å•æ¥è¯´ï¼Œå°±æ˜¯<strong>åªæœ‰å½“ç»„ä»¶ä¸­ä½¿ç”¨åˆ°çš„çŠ¶æ€å€¼å‘ç”Ÿå˜åŒ–æ—¶ï¼Œæ‰ä¼šè§¦å‘ç»„ä»¶çš„é‡æ–°æ¸²æŸ“</strong>ã€‚ç›¸æ¯”äº redux+ react-redux çš„æ—©æœŸç‰ˆæœ¬æˆ–è€… context provider + useContext çš„è¿™ç§ã€Œå…¨é‡åˆ·æ–°ã€çš„æ¸²æŸ“æ–¹å¼ï¼Œzustand è°ˆå¾—ä¸Šã€Œé«˜æ€§èƒ½ã€äº†ã€‚</p>
<p>å½“ç„¶ï¼Œè¦æƒ³å®ç°è¿™ä¸ªã€ŒæŒ‰éœ€æ¸²æŸ“ã€çš„åŠŸèƒ½ï¼Œè¿˜éœ€è¦ä½œä¸ºå¼€å‘è€…çš„ä½ é…åˆ - ä½¿ç”¨ selector æ¥é€‰æ‹©ä½ éœ€è¦çš„çŠ¶æ€ã€‚selector æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œå®ƒçš„å‚æ•°æ˜¯ store çš„å…¨é‡ stateï¼Œè¿”å›å€¼æ˜¯ä½ éœ€è¦çš„çŠ¶æ€ã€‚æ¯”å¦‚ï¼Œä½ åªéœ€è¦ count çŠ¶æ€ï¼Œå°±å¯ä»¥è¿™ä¹ˆå†™ï¼š</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">const</span> count = <span class="hljs-title function_">useStore</span>(<span class="hljs-function">(<span class="hljs-params">state</span>) =&gt;</span> state.<span class="hljs-property">count</span>)
</code></pre>
<p>å‡å¦‚ä½ æ˜¯è¿™ä¹ˆå†™çš„è¯ï¼š</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">const</span> <span class="hljs-title function_">MyComponent</span> = (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-keyword">const</span> countStore = <span class="hljs-title function_">useStore</span>()

  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>Count: {countStore.count}<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  )
}
</code></pre>
<p>é‚£ä¹ˆå°±ä¼šå‘ç”Ÿæ€§èƒ½å›é€€ - åªè¦ store çš„ä»»æ„ä¸€ä¸ª state å‘ç”Ÿäº†å˜åŒ–ï¼Œå“ªæ€•ä¸æ˜¯ count çš„å€¼æ”¹å˜äº†ï¼Œç»„ä»¶ä¹Ÿä¼š <code>MyComponent</code> ä¹Ÿä¼šé‡æ–°æ¸²æŸ“ã€‚</p>
<p>å¦å¤–ä¸€ä¸ªæ³¨æ„ç‚¹æ˜¯ï¼Œå¦‚æœä½ æ‰€è®¢é˜…çš„å€¼æ˜¯ä¸€ä¸ªå¼•ç”¨ç±»å‹ï¼Œæ¯”å¦‚å¯¹è±¡æˆ–è€…æ•°ç»„ï¼Œå¦‚æœè¿˜æ˜¯åƒä¸Šé¢è¿™ç§å†™æ³•çš„è¯ï¼Œé‚£ä¹ˆå°±å¾ˆå®¹æ˜“å‘ç”Ÿæ€§èƒ½å›é€€ï¼ˆå…·ä½“çš„ä¾‹å­å¯ä»¥çœ‹<a href="https://link.juejin.cn?target=https%3A%2F%2Fzustand.docs.pmnd.rs%2Fhooks%2Fuse-shallow%23useshallow-%25E2%259A%259B%25EF%25B8%258F" target="_blank" title="https://zustand.docs.pmnd.rs/hooks/use-shallow#useshallow-%E2%9A%9B%EF%B8%8F" ref="nofollow noopener noreferrer">å®˜ç½‘ç»™å‡ºçš„ä¾‹å­</a>ï¼‰ã€‚</p>
<p>å¯¹äºè¿™ç§æƒ…å†µï¼Œä½ å°±éœ€è¦å†ç”¨ <code>useShallow</code> æ¥åŒ…ä¸€å±‚ã€‚æ¯”å¦‚ï¼š</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">function</span> <span class="hljs-title function_">BearNames</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> names = <span class="hljs-title function_">useBearFamilyMealsStore</span>(
    <span class="hljs-title function_">useShallow</span>(<span class="hljs-function">(<span class="hljs-params">state</span>) =&gt;</span> <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">keys</span>(state)),
  )

  <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>{names.join(', ')}<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
}
</code></pre>
<h3 data-id="heading-8">å®ƒç›¸æ¯”äº redux æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</h3>
<p>ä»æºç å®ç°è§’åº¦æ¥è¯´ï¼Œzustand å°±æ˜¯ redux çš„ä¸€ä¸ªç»§ä»»è€…ã€‚è¿™ä¸€ç‚¹å¯ä»¥ä» vanilla create API çš„å®ç°å¯ä»¥çœ‹å‡ºã€‚vanilla create API çš„å®ç°å‡ ä¹æ˜¯â€œæŠ„â€äº† redux çš„æ ¸å¿ƒå®ç°ã€‚zustand åŒæ ·å®ç°äº† storeï¼Œ middleware ç­‰ä¸¤ä¸ªæ¦‚å¿µï¼Œ è¿ devtool éƒ½æ˜¯å¤ç”¨ redux çš„ chrome devtoolã€‚ä¸åŒçš„æ˜¯ï¼Œzustand æ²¡æœ‰åšå®ˆ redux çš„ä¸¥æ ¼çš„å•å‘æ•°æ®æµçš„è®¾è®¡ä¸­å…¶ä»–è¯¥æ¦‚å¿µï¼Œæ¯”å¦‚è¯´ï¼šreducerï¼Œ actionï¼Œ dispatch ç­‰ã€‚ç„¶è€Œï¼Œæ­£å¦‚å®˜ç½‘æ‰€æŒ‡å‡ºçš„é‚£æ ·ï¼Œä½ ä»ç„¶å¯ä»¥<a href="https://link.juejin.cn?target=https%3A%2F%2Fzustand.docs.pmnd.rs%2Fguides%2Fflux-inspired-practice%23redux-like-patterns" target="_blank" title="https://zustand.docs.pmnd.rs/guides/flux-inspired-practice#redux-like-patterns" ref="nofollow noopener noreferrer">æŠŠ zustand å†™æˆ redux çš„å•å‘æ•°æ®æµçš„æ ·å­</a>ã€‚</p>
<p>ä»ä½¿ç”¨å±‚é¢æ¥è¯´ï¼Œzustand æ¯” redux èŒƒå¼æ›´åŠ çš„æ¾æ•£å’Œçµæ´»ï¼ˆunopinionatedï¼‰ã€‚å®ƒæ²¡æœ‰é‚£å¥—åƒ redux é‚£æ ·ç¨æ˜¾å¾—å†—ä½™çš„æ¨¡æ¿ä»£ç ã€‚ç®€ç›´å¯ä»¥è¯´ï¼Œæ€ä¹ˆå†™æ€ä¹ˆæœ‰ã€‚å¦å¤–ä¸€ä¸ªæœ€å¤§çš„ä¸åŒæ˜¯ï¼Œzustand å¯ä»¥åœ¨ä»»ä½•åœ°æ–¹å»è°ƒç”¨ <code>setState()</code> æ¥è§¦å‘ react ç•Œé¢æ›´æ–°ã€‚è¿™ä¸€ç‚¹æ˜¯ redux åšä¸åˆ°çš„ã€‚</p>
<p>å¦å¤–çš„ä¸€ä¸ªä¸åŒç‚¹æ˜¯æ¸²æŸ“æ€§èƒ½æ–¹é¢çš„ã€‚zustand ä»ç¬¬ä¸€ç‰ˆæœ¬å°±å®ç°äº†ç»„ä»¶çš„æŒ‰éœ€æ¸²æŸ“ã€‚è€Œ redux é‚£è¾¹ï¼Œåœ¨ redux toolkit è¿˜æ²¡æœ‰æ¨å‡ºä¹‹å‰ï¼Œéƒ½æ˜¯ã€Œå…¨é‡åˆ·æ–°ã€çš„æ¸²æŸ“æ–¹å¼ã€‚æŠŠ redux toolkit çœ‹ä½œåŠ å¼ºç‰ˆçš„ redux çš„è¯ï¼Œé‚£ä¹ˆåœ¨ã€ŒæŒ‰éœ€æ¸²æŸ“ã€æ–¹é¢ï¼Œzustand å’Œ redux åˆ°ç›®å‰ä¸ºæ­¢ï¼Œéƒ½æ˜¯æ”¯æŒé€šè¿‡ selector æ¥å®ç°è¿™ä¸ªåŠŸèƒ½äº†ã€‚</p>
<h3 data-id="heading-9">å¿«é€Ÿå…¥é—¨</h3>
<p>æ­£å¦‚ä¸Šé¢ã€Œç‰¹ç‚¹ã€å°èŠ‚æ‰€æåˆ°çš„é‚£æ ·ï¼Œzustand ä¸Šæ‰‹æ˜¯å¾ˆç®€å•çš„ - å°±æ˜¯ä¸‰éƒ¨æ›²ï¼š</p>
<ol>
<li>åˆ›å»º store</li>
<li>åœ¨ç»„ä»¶ä¸­ä½¿ç”¨ <code>useBoundStore()</code> æ¥è·å–çŠ¶æ€å’Œ action å‡½æ•°</li>
<li>åœ¨ç»„ä»¶ä¸­è°ƒç”¨ action å‡½æ•°æ¥è§¦å‘çŠ¶æ€æ›´æ–°</li>
</ol>
<p>ä¸‹é¢ç›´æ¥æŠŠå®˜ç½‘çš„ demo æ¬è¿‡æ¥ï¼Œæ•´ä¸ªä¸‰éƒ¨æ›²å°±ä¸€æ­¥äº†ç„¶äº†ï¼š</p>
<ol>
<li><strong>åˆ›å»º store</strong></li>
</ol>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> { create } <span class="hljs-keyword">from</span> <span class="hljs-string">'zustand'</span>

<span class="hljs-keyword">const</span> useBearStore = <span class="hljs-title function_">create</span>(<span class="hljs-function">(<span class="hljs-params">set</span>) =&gt;</span> ({
  <span class="hljs-attr">bears</span>: <span class="hljs-number">0</span>,
  <span class="hljs-attr">increasePopulation</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">set</span>(<span class="hljs-function">(<span class="hljs-params">state</span>) =&gt;</span> ({ <span class="hljs-attr">bears</span>: state.<span class="hljs-property">bears</span> + <span class="hljs-number">1</span> })),
  <span class="hljs-attr">removeAllBears</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">set</span>({ <span class="hljs-attr">bears</span>: <span class="hljs-number">0</span> }),
  <span class="hljs-attr">updateBears</span>: <span class="hljs-function">(<span class="hljs-params">newBears</span>) =&gt;</span> <span class="hljs-title function_">set</span>({ <span class="hljs-attr">bears</span>: newBears }),
}))
</code></pre>
<ol start="2">
<li><strong>åœ¨ç»„ä»¶ä¸­ä½¿ç”¨ <code>useBoundStore()</code> æ¥è·å–çŠ¶æ€å’Œ action å‡½æ•°</strong></li>
</ol>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">BearCounter</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> bears = <span class="hljs-title function_">useBearStore</span>(<span class="hljs-function">(<span class="hljs-params">state</span>) =&gt;</span> state.<span class="hljs-property">bears</span>)
  <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>{bears} bears around here...<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span></span>
}

<span class="hljs-keyword">function</span> <span class="hljs-title function_">Controls</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> increasePopulation = <span class="hljs-title function_">useBearStore</span>(<span class="hljs-function">(<span class="hljs-params">state</span>) =&gt;</span> state.<span class="hljs-property">increasePopulation</span>)
  <span class="hljs-comment">//......</span>
}
</code></pre>
<ol start="3">
<li>åœ¨ç»„ä»¶ä¸­è°ƒç”¨ action å‡½æ•°æ¥è§¦å‘çŠ¶æ€æ›´æ–°</li>
</ol>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">Controls</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> increasePopulation = <span class="hljs-title function_">useBear</span>(<span class="hljs-function">(<span class="hljs-params">state</span>) =&gt;</span> state.<span class="hljs-property">increasePopulation</span>)
  <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{increasePopulation}</span>&gt;</span>one up<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span>
}
</code></pre>
<p>å¥½äº†ï¼Œåˆ°è¿™å°±å…¥é—¨æˆåŠŸäº†ã€‚</p>
<h2 data-id="heading-10">åŸç†æ­ç§˜</h2>
<p>ä¸Šé¢çš„ç®€ä»‹åªæ˜¯ä¸€ä¸ªçƒ­èº«æ´»åŠ¨ï¼Œç›®çš„æ˜¯è®©ä½ å¯¹ zustand çš„åŸºæœ¬ä½¿ç”¨æ–¹æ³•å’Œç‰¹æ€§æœ‰ä¸€ä¸ªå°è±¡ã€‚ä¸‹é¢æˆ‘ä»¬æ¥æ­ç§˜ä¸€ä¸‹å®ƒçš„åŸç†ï¼Œä»¥ä¾¿äºä½ æ›´å¥½åœ°ç†è§£å’Œä½¿ç”¨ zustandã€‚</p>
<h3 data-id="heading-11">æºç æ¡†æ¶</h3>
<p>é¦–å…ˆï¼Œæˆ‘ä»¬çœ‹çœ‹æºç çš„ç›®å½•ç»“æ„</p>
<pre><code class="hljs language-bash" lang="bash">zustand/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ index.ts                    <span class="hljs-comment"># é»˜è®¤å…¥å£ï¼šå¯¼å‡º createï¼ˆReact ç‰ˆï¼‰</span>
â”‚   â”œâ”€â”€ vanilla.ts                  <span class="hljs-comment"># æ¡†æ¶æ— å…³æ ¸å¿ƒï¼šcreateStore</span>
â”‚   â”œâ”€â”€ react.ts                    <span class="hljs-comment"># React ç»‘å®šï¼šuseSyncExternalStore å°è£…</span>
â”‚   â”œâ”€â”€ traditional.ts              <span class="hljs-comment"># React 16/17 å…¼å®¹å…¥å£ï¼ˆè‡ªåŠ¨å«ç‰‡ï¼‰</span>
â”‚   â”œâ”€â”€ middleware/
â”‚   â”‚   â”œâ”€â”€ combine.ts
â”‚   â”‚   â”œâ”€â”€ devtools.ts
â”‚   â”‚   â”œâ”€â”€ immer.ts
â”‚   â”‚   â”œâ”€â”€ persist/
â”‚   â”‚   â”‚   â”œâ”€â”€ index.ts
â”‚   â”‚   â”‚   â””â”€â”€ storage.ts
â”‚   â”‚   â”œâ”€â”€ redux.ts
â”‚   â”‚   â””â”€â”€ subscribeWithSelector.ts
â”‚   â”œâ”€â”€ vanilla/
â”‚   â”‚   â”œâ”€â”€ shallow.ts              <span class="hljs-comment"># æµ…æ¯”è¾ƒå‡½æ•°ï¼ˆä¾› vanilla ç”¨æˆ·ï¼‰</span>
â”‚   â”œâ”€â”€ react/
â”‚   â”‚   â”œâ”€â”€ shallow.ts              <span class="hljs-comment"># useShallow Hook</span>
â”‚   â””â”€â”€ types.d.ts                    <span class="hljs-comment"># å…¨å±€ TypeScript ç±»å‹å®šä¹‰</span>
</code></pre>
<p>zustand çš„æ ¸å¿ƒä»£ç é‡‡ç”¨äº†åˆ†å±‚æ¶æ„ï¼Œç›®çš„æ˜¯ä¸ºäº†åšåˆ°æ¡†æ¶æ— å…³æ€§ã€‚zustand çš„æ ¸å¿ƒä»£ç åˆ†ä¸¤å±‚ï¼š</p>
<ul>
<li>vanilla å±‚ - ä¹Ÿå°±æ˜¯åŸç”Ÿå±‚ï¼Œæ˜¯çº¯ javascript å®ç°ï¼Œå®ƒä¸ä¾èµ–ä»»ä½•çš„è§†å›¾å±‚æ¡†æ¶ã€‚</li>
<li>binding å±‚ - ä¹Ÿå°±æ˜¯æ¡¥æ¥ç‰¹å®šçš„è§†å›¾å±‚æ¡†æ¶ã€‚å½“å‰ï¼Œè¿™ä¸ªè§†å›¾å±‚æ¡†æ¶å°±æ˜¯ reactã€‚</li>
</ul>
<p>è¿™ä¸¤å±‚ä¹‹é—´çš„å…³è”å¯ä»¥ä»ä¸‹é¢çš„çš„é¸Ÿç°å›¾ä¸­çœ‹å‡ºï¼š</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/982ec4f1beb3455cb0898ee32f38414a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6bKo5Y-U:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765335540&amp;x-signature=IAafzB7Mg%2FIpta2f%2BokK%2F88JqGQ%3D" alt="image.png" loading="lazy"/></p>
<p>ç®€å•æ¥è¯´ï¼Œzustand é€šè¿‡ react åŸç”Ÿ API <code>useSyncExternalStore</code> æŠŠ react å†…éƒ¨çš„ listenerï¼ˆreact core åœ¨å†…éƒ¨å®ç°ä¼šåˆ›å»ºä¸€ä¸ª listenrï¼‰ æ³¨å†Œåˆ° zustand åŸç”Ÿ store å®ä¾‹çš„ listener æ•°ç»„ä¸­ã€‚å¦‚æ­¤ä¸€æ¥ï¼Œreact ç»„ä»¶å°±æˆä¸ºäº† zustand åŸç”Ÿ store å®ä¾‹çš„ä¼—å¤šè®¢é˜…è€…ä¸­çš„ä¸€å‘˜ã€‚</p>
<p>å½“ç”¨æˆ·ä»£ç è°ƒç”¨ store action çš„æ—¶å€™ï¼Œé—´æ¥å°±è°ƒç”¨äº† store å®ä¾‹çš„ setState æ–¹æ³•ã€‚è€Œåœ¨ setState æ–¹æ³•çš„æºç å®ç°ä¸­ï¼Œzustand ä¼šéå†è°ƒç”¨æ‰€æœ‰çš„ listener å‡½æ•°ã€‚è€Œè¿™äº› listener å‡½æ•°ä¸­ï¼Œå°±åŒ…æ‹¬äº† react ç»„ä»¶ã€‚è¿™å°±æ˜¯åœ¨é€šçŸ¥ react ç»„ä»¶ç€æ‰‹å»åˆ¤æ–­ç»„ä»¶æ˜¯å¦çœŸçš„éœ€è¦æ›´æ–°ã€‚</p>
<p>åœ¨æ‰§è¡Œ react æ³¨å†Œåˆ° store å®ä¾‹çš„ listener çš„æ—¶å€™ï¼Œreact ä¼šå¯¹æ¯”å‰åä¸¤æ¬¡çš„ snapshot çš„å€¼ï¼Œå¦‚æœå€¼å‘ç”Ÿäº†å˜åŒ–ï¼Œ react å°±ä¼šå‘èµ·ä¸€ä¸ªè¯·å¼ºåˆ¶æ›´æ–°çš„è¯·æ±‚ï¼ˆ<code>forceStoreRerender(fiber)</code>ï¼‰ã€‚é‚£ä¹ˆï¼Œè¯¥ react ç»„ä»¶å°±ä¼šåœ¨ä¸‹ä¸€è½®çš„ render é˜¶æ®µçš„æ—¶å€™å¾—åˆ° rerenderã€‚</p>
<p>é™äºç¯‡å¹…ï¼Œæ›´å¤šç²¾å½©å†…å®¹è¯·æŸ¥çœ‹ä¸‹ç¯‡ã€Šzustand ä»åŸç†åˆ°å®è·µ - åŸç†ç¯‡(2)ã€‹ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[å¼€æºå¤§æ¨¡å‹å…¨ç»´åº¦è¯¦è§£+å®æ“éƒ¨ç½²ï¼ˆMistral-ã€Gemmaï¼ˆGoogleï¼‰ã€Llamaã€Qwenï¼‰ï¼Œå°ç™½å¿…çœ‹]]></title>    <link>https://juejin.cn/post/7579165599042371599</link>    <guid>https://juejin.cn/post/7579165599042371599</guid>    <pubDate>2025-12-03T03:06:39.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7579165599042371599" data-draft-id="7579111646875418675" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="å¼€æºå¤§æ¨¡å‹å…¨ç»´åº¦è¯¦è§£+å®æ“éƒ¨ç½²ï¼ˆMistral-ã€Gemmaï¼ˆGoogleï¼‰ã€Llamaã€Qwenï¼‰ï¼Œå°ç™½å¿…çœ‹"/> <meta itemprop="keywords" content="LLM,Agent,LLaMA"/> <meta itemprop="datePublished" content="2025-12-03T03:06:39.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="AIå¤§æ¨¡å‹"/> <meta itemprop="url" content="https://juejin.cn/user/3817967696221534"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            å¼€æºå¤§æ¨¡å‹å…¨ç»´åº¦è¯¦è§£+å®æ“éƒ¨ç½²ï¼ˆMistral-ã€Gemmaï¼ˆGoogleï¼‰ã€Llamaã€Qwenï¼‰ï¼Œå°ç™½å¿…çœ‹
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3817967696221534/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    AIå¤§æ¨¡å‹
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-03T03:06:39.000Z" title="Wed Dec 03 2025 03:06:39 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-03
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»18åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#383838;font-size:15px;line-height:30px;letter-spacing:2px;word-break:break-word;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Open Sans,Helvetica Neue,sans-serif;scroll-behavior:smooth;background-image:linear-gradient(0deg,transparent 24%,rgba(201,195,195,.329) 25%,hsla(0,8%,80.4%,.05) 26%,transparent 27%,transparent 74%,hsla(0,5.2%,81%,.185) 75%,rgba(180,176,176,.05) 76%,transparent 77%,transparent),linear-gradient(90deg,transparent 24%,rgba(204,196,196,.226) 25%,hsla(0,4%,66.1%,.05) 26%,transparent 27%,transparent 74%,hsla(0,5.2%,81%,.185) 75%,rgba(180,176,176,.05) 76%,transparent 77%,transparent);background-color:#fff;background-size:50px 50px;padding-bottom:60px}.markdown-body ::selection{color:#fff;background-color:#a862ea}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{margin:24px 0 12px;color:#a862ea}.markdown-body h1{line-height:2;font-size:1.4em}.markdown-body h1~p:first-of-type:first-letter{color:#a862ea;float:left;font-size:2em;margin-right:.4em;font-weight:bolder}.markdown-body h2{font-size:1.2em}.markdown-body h3{font-size:1.1em}.markdown-body ol,.markdown-body ul{padding-left:2em}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;padding-left:.2em}.markdown-body ol li::marker,.markdown-body ul li::marker{color:#a862ea}.markdown-body ol li.task-list-item,.markdown-body ul li.task-list-item{list-style:none}.markdown-body ol li.task-list-item ol,.markdown-body ol li.task-list-item ul,.markdown-body ul li.task-list-item ol,.markdown-body ul li.task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:10px}.markdown-body a,.markdown-body code,.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6,.markdown-body li,.markdown-body p{opacity:.85;vertical-align:baseline;transition:all .1s ease}.markdown-body a:hover,.markdown-body code:hover,.markdown-body h1:hover,.markdown-body h2:hover,.markdown-body h3:hover,.markdown-body h4:hover,.markdown-body h5:hover,.markdown-body h6:hover,.markdown-body li:hover,.markdown-body p:hover{opacity:1}.markdown-body a{display:inline-block;color:#a862ea;cursor:pointer;text-decoration:none;position:relative}.markdown-body a:after{content:"";position:absolute;width:98%;height:1px;bottom:0;left:0;transform:scaleX(0);background-color:#a862ea;transform-origin:bottom right;transition:transform .3s ease-in-out}.markdown-body a:hover:after{transform:scaleX(1);transform-origin:bottom left}.markdown-body a:active,.markdown-body a:link{color:#a862ea}.markdown-body img{max-width:100%;user-select:none;margin:1em 0;transition:transform .2s ease 0s;background-color:#f8f5ff;box-shadow:0 0 10px #e7daff}.markdown-body img:hover{opacity:1;box-shadow:0 0 20px #e7daff;transform:translateY(-1px)}.markdown-body blockquote{padding:.5em 1em;margin:12px 0;border-top-left-radius:2px;border-bottom-left-radius:2px;border-left:3px solid #a862ea;background-color:#f8f5ff}.markdown-body blockquote&gt;p{margin:0}.markdown-body .math{font-style:italic;margin:12px 0;padding:.5em 1em;background-color:#f8f5ff}.markdown-body .math&gt;p{margin:0}.markdown-body code{padding:2px .4em;overflow-x:auto;color:#a862ea;font-weight:700;word-break:break-word;font-family:Operator Mono,Consolas,Monaco,Menlo,monospace;background-color:#f8f5ff}.markdown-body pre{margin:2em 0}.markdown-body pre&gt;code{display:block;padding:1.5em;word-break:normal;font-size:.9em;font-style:normal;font-weight:400;font-family:Operator Mono,Consolas,Monaco,Menlo,monospace;line-height:18px;color:#383838;border-radius:2px;scroll-behavior:smooth;box-shadow:0 0 10px #e7daff}.markdown-body pre&gt;code:hover{box-shadow:0 0 20px #e7daff}.markdown-body pre&gt;code::-webkit-scrollbar{height:6px;background-color:#f8f5ff}.markdown-body pre&gt;code::-webkit-scrollbar-thumb{background-color:#e7daff;border-bottom-left-radius:3px;border-bottom-right-radius:3px}.markdown-body hr{margin:2em 0;border-top:1px solid #a862ea}.markdown-body table{width:100%;font-size:12px;max-width:100%;overflow:auto;border-collapse:collapse}.markdown-body thead{color:#a862ea;background:#f8f5ff}.markdown-body td,.markdown-body th{padding:.5em;border:1px solid #e7daff}.markdown-body tr{background-color:#f8f5ff}@media (max-width:720px){.markdown-body{font-size:12px}}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>æœ¬æ–‡è¾ƒé•¿ï¼Œå»ºè®®ç‚¹èµæ”¶è—ã€‚æ›´å¤šAIå¤§æ¨¡å‹åº”ç”¨å¼€å‘å­¦ä¹ è§†é¢‘åŠèµ„æ–™ï¼Œåœ¨<a href="https://link.juejin.cn?target=https%3A%2F%2Fhy.zhipoai.cn%2F" target="_blank" title="https://hy.zhipoai.cn/" ref="nofollow noopener noreferrer">æ™ºæ³ŠAI</a>ã€‚</p>
</blockquote>
<p>2025å¹´ï¼Œå¼€æºå¤§æ¨¡å‹èµ›é“å½»åº•è¿›å…¥ã€Œç²¾æ‚ä¸ºç‹ã€é˜¶æ®µâ€”â€”Mistral-ã€Gemmaï¼ˆGoogleï¼‰ã€Llamaã€Qwenç­‰é¡¶æµï¼Œä»¥7-8Bå‚æ•°é‡å®ç°ã€Œæ€§èƒ½ä¸ç¼©æ°´ã€éƒ¨ç½²é›¶é—¨æ§›ã€ï¼Œè¦†ç›–ä¸­æ–‡ã€å¤šè¯­è¨€ã€å®æ—¶æ¨ç†ã€åˆè§„åœºæ™¯ç­‰å…¨éœ€æ±‚ã€‚</p>
<p>æœ¬æ–‡èšç„¦è¿™5ä¸ªã€Œå°ç™½å‹å¥½å‹ã€æ ‡æ†æ¨¡å‹ï¼Œä»<strong>é€šä¿—æ¡ˆä¾‹â†’æ ¸å¿ƒåŸç†ï¼ˆå«æ·±åº¦å…¬å¼ï¼‰â†’é›¶é—¨æ§›æœåŠ¡å™¨å®æ“â†’5ç»´æ€§èƒ½å¯¹æ¯”</strong>å…¨æ–¹ä½æ‹†è§£ï¼Œé™„å¸¦è‡ªåŠ¨ä¸‹è½½æ•°æ®é›†çš„Pythoné¡¹ç›®ï¼ˆæ— éœ€ç¿»å¢™ã€æ— GUIä¹Ÿèƒ½è·‘ï¼‰ï¼Œè®©ä½ åŠå°æ—¶åƒé€å¼€æºå¤§æ¨¡å‹çš„æ ¸å¿ƒé€»è¾‘ä¸è½åœ°æŠ€å·§ï¼</p>
<h2 data-id="heading-0">ä¸€ã€äº”å¤§é¡¶æµå¼€æºå¤§æ¨¡å‹æ·±åº¦æ‹†è§£ï¼ˆåŸç†+å…¬å¼+é€šä¿—æ¡ˆä¾‹ï¼‰</h2>
<h3 data-id="heading-1">1. Qwen2-7Bï¼ˆé˜¿é‡Œï¼‰ï¼šä¸­æ–‡èƒ½åŠ›å¤©èŠ±æ¿2.0</h3>
<h4 data-id="heading-2">é€šä¿—æ¡ˆä¾‹</h4>
<p>è¾“å…¥ä¸­æ–‡å£è¯­åŒ–éœ€æ±‚ï¼šã€Œå¸®æˆ‘åˆ¤æ–­è¿™æ¡æ–‡æ¡ˆçš„æƒ…æ„Ÿå€¾å‘ï¼šâ€˜è¿™æ¬¾å›½äº§è€³æœºéŸ³è´¨ç»äº†ï¼Œç»­èˆªè¿˜èƒ½æ‰›ä¸€æ•´å¤©ï¼Œæ€§ä»·æ¯”ç›´æ¥æ‹‰æ»¡ï¼â€™ã€ï¼Œæ¨¡å‹0.1ç§’è¾“å‡ºã€Œç§¯ææƒ…æ„Ÿã€ï¼›è¾“å…¥ä¸“ä¸šä¸­æ–‡æ–‡æœ¬ï¼šã€Œç§‘åˆ›æ¿ä¼ä¸šç ”å‘æŠ•å…¥å æ¯”å¹³å‡è¾¾8.2%ï¼Œè¾ƒä¸»æ¿é«˜å‡º3.5ä¸ªç™¾åˆ†ç‚¹ã€ï¼Œç²¾å‡†å½’ç±»ä¸ºã€Œè´¢ç»ç±»æ–‡æœ¬ã€â€”â€”ä¸­æ–‡è¯­ä¹‰ç†è§£ã€å£è¯­/ä¹¦é¢è¯­/ä¸“ä¸šåœºæ™¯å…¨é€‚é…ã€‚<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/55ec420514e34f9d8a2fb5ec9e27bc2b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQUnlpKfmqKHlnos=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765335999&amp;x-signature=zi079C%2BFx3Kf81D1k2VzoFOOiWQ%3D" alt="" loading="lazy"/></p>
<h4 data-id="heading-3">æ ¸å¿ƒåŸç†+æ•°å­¦å…¬å¼</h4>
<p>Qwen2-7BåŸºäºTransformer-XLæ¶æ„ä¼˜åŒ–ï¼Œæ ¸å¿ƒåˆ›æ–°é›†ä¸­åœ¨ã€ŒåŠ¨æ€ä¸Šä¸‹æ–‡å»ºæ¨¡ã€å’Œã€Œä¸­æ–‡è¯­ä¹‰å¢å¼ºã€ï¼Œå…³é”®å…¬å¼å¦‚ä¸‹ï¼š</p>
<h5 data-id="heading-4">ï¼ˆ1ï¼‰åŠ¨æ€è‡ªé€‚åº”ä½ç½®ç¼–ç ï¼ˆ128Kä¸Šä¸‹æ–‡æ— å‹åŠ›ï¼‰</h5>
<p>ä¼ ç»ŸRoPEç¼–ç å¯¹è¶…é•¿æ–‡æœ¬ä½ç½®æ•æ„Ÿæ€§ä¸‹é™ï¼ŒQwen2å¼•å…¥æ–‡æœ¬é•¿åº¦è‡ªé€‚åº”å› å­ï¼Œè§£å†³é•¿æ–‡æœ¬ä½ç½®æ­§ä¹‰ï¼š</p>
<ul>
<li>ç¬¦å·è¯´æ˜ï¼š=éšè—å±‚ç»´åº¦ç´¢å¼•ï¼ˆ0~4095ï¼‰ï¼Œ=æ–‡æœ¬ä½ç½®ç´¢å¼•ï¼Œ=å½“å‰æ–‡æœ¬é•¿åº¦ï¼Œ=æœ€å¤§ä¸Šä¸‹æ–‡é•¿åº¦ï¼ˆ128Kï¼‰ï¼Œ=éšè—å±‚æ€»ç»´åº¦ï¼ˆ4096ï¼‰ï¼Œ=å‘¨æœŸå‚æ•°ï¼ˆ10000ï¼‰ï¼Œ=Sigmoidå‡½æ•°ã€‚</li>
<li>æ ¸å¿ƒä½œç”¨ï¼šæ–‡æœ¬è¶Šé•¿ï¼Œæ­£å¼¦åˆ†é‡æƒé‡è¶Šé«˜ï¼Œå¼ºåŒ–é•¿è·ç¦»ä½ç½®å…³è”ï¼ˆå¦‚10Kå­—ä¸­æ–‡æ–‡æ¡£çš„é€»è¾‘è¿è´¯æ€§ï¼‰ã€‚</li>
</ul>
<h5 data-id="heading-5">ï¼ˆ2ï¼‰ä¸­æ–‡å¢å¼ºè‡ªæ³¨æ„åŠ›æœºåˆ¶ï¼ˆè§£å†³ä¸­æ–‡åˆ†è¯æ­§ä¹‰ï¼‰</h5>
<p>é’ˆå¯¹ä¸­æ–‡æ— ç©ºæ ¼åˆ†éš”çš„ç‰¹ç‚¹ï¼ŒåŠ å…¥åˆ†è¯æ¦‚ç‡åŠ æƒå› å­ï¼š</p>
<ul>
<li>ç¬¦å·è¯´æ˜ï¼š=æŸ¥è¯¢/é”®/å€¼çŸ©é˜µï¼Œ=å¤´ç»´åº¦ï¼ˆ4096/32=128ï¼‰ï¼Œ=æƒé‡å› å­ï¼ˆè®­ç»ƒä¹ å¾—ï¼Œé»˜è®¤0.4ï¼‰ï¼Œ=ä¸­æ–‡åˆ†è¯æ¦‚ç‡çŸ©é˜µï¼ˆåŸºäºé¢„è®­ç»ƒåˆ†è¯æ¨¡å‹è®¡ç®—ï¼Œå¦‚ã€Œç½‘çº¢/é›ªç³•ã€vsã€Œç½‘/çº¢é›ªç³•ã€çš„æ¦‚ç‡ï¼‰ã€‚</li>
<li>æ ¸å¿ƒä¼˜åŠ¿ï¼šå‡å°‘ä¸­æ–‡åˆ†è¯æ­§ä¹‰å¯¼è‡´çš„è¯­ä¹‰è¯¯è§£ï¼Œå‡†ç¡®ç‡æå‡8%-12%ã€‚</li>
</ul>
<h4 data-id="heading-6">æ ¸å¿ƒç‰¹æ€§</h4>
<ul>
<li>ä¸­æ–‡æ”¯æŒï¼šSçº§ï¼ˆåˆ†è¯ã€è¯­ä¹‰ã€æ–‡åŒ–é€‚é…æ‹‰æ»¡ï¼‰ï¼›</li>
<li>ä¸Šä¸‹æ–‡çª—å£ï¼š128Kï¼ˆåŒç±»æœ€å¤§ï¼‰ï¼›</li>
<li>æ˜¾å­˜éœ€æ±‚ï¼š7.8GBï¼ˆåŠç²¾åº¦ï¼‰ï¼›</li>
<li>ä¼˜åŠ¿ï¼šå¤šä»»åŠ¡å…¼å®¹ï¼ˆåˆ†ç±»ã€æ‘˜è¦ã€ç¿»è¯‘ã€å¯¹è¯ï¼‰ã€‚</li>
</ul>
<h3 data-id="heading-7">2. Qwen1.5-7Bï¼ˆé˜¿é‡Œï¼‰ï¼šä¸­æ–‡å…¥é—¨é¦–é€‰</h3>
<h4 data-id="heading-8">é€šä¿—æ¡ˆä¾‹</h4>
<p>è¾“å…¥ç®€å•ä¸­æ–‡éœ€æ±‚ï¼šã€Œåˆ¤æ–­è¿™å¥è¯æ˜¯ä¸æ˜¯å¹¿å‘Šï¼šâ€˜æ–°åº—å¼€ä¸šï¼Œå…¨åœºæœè£…ä¹°ä¸€é€ä¸€ï¼Œé™æ—¶3å¤©â€™ã€ï¼Œæ¨¡å‹å¿«é€Ÿè¾“å‡ºã€Œæ˜¯å¹¿å‘Šã€ï¼›è¾“å…¥çŸ­å¥ï¼šã€Œä»Šå¤©çš„é›¨ä¸‹å¾—å¥½å¤§ï¼Œå‡ºé—¨è¦å¸¦ä¼ã€ï¼Œå‡†ç¡®è¯†åˆ«ä¸ºã€Œæ—¥å¸¸é—²èŠã€â€”â€”è½»é‡åŒ–ä¸­æ–‡ä»»åŠ¡æ€§ä»·æ¯”ä¹‹ç‹ã€‚</p>
<h4 data-id="heading-9">æ ¸å¿ƒåŸç†+æ•°å­¦å…¬å¼</h4>
<p>Qwen1.5-7Bæ˜¯Qwen2çš„ç®€åŒ–ç‰ˆï¼Œä¿ç•™æ ¸å¿ƒä¸­æ–‡ä¼˜åŒ–ï¼Œèšç„¦ã€Œä½æ˜¾å­˜+é«˜é€Ÿåº¦ã€ï¼š</p>
<h5 data-id="heading-10">ï¼ˆ1ï¼‰ç®€åŒ–ç‰ˆRoPEä½ç½®ç¼–ç ï¼ˆå¹³è¡¡æ€§èƒ½ä¸è®¡ç®—é‡ï¼‰</h5>
<p>ä¸ºå¶æ•°ä¸ºå¥‡æ•°</p>
<ul>
<li>ç¬¦å·è¯´æ˜ï¼šä¸Qwen2ä¸€è‡´ï¼Œä»…å»æ‰åŠ¨æ€é•¿åº¦å› å­ï¼Œè®¡ç®—é‡é™ä½20%ã€‚</li>
<li>æ ¸å¿ƒä½œç”¨ï¼šåœ¨4K-32Kä¸Šä¸‹æ–‡çª—å£å†…ä¿æŒé«˜æ€§èƒ½ï¼ŒåŒæ—¶å‡å°‘æ˜¾å­˜å ç”¨ã€‚</li>
</ul>
<h5 data-id="heading-11">ï¼ˆ2ï¼‰ä¸­æ–‡è¯å‘é‡å¢å¼ºé¢„è®­ç»ƒç›®æ ‡</h5>
<ul>
<li>ç¬¦å·è¯´æ˜ï¼š=æ–‡æœ¬é•¿åº¦ï¼Œ=n-gramçª—å£ï¼ˆé»˜è®¤5ï¼‰ï¼Œ=MLMä»»åŠ¡æƒé‡ï¼ˆ0.3ï¼‰ï¼Œ=æ©ç è¯­è¨€æ¨¡å‹æŸå¤±ï¼ˆä¸“é—¨é’ˆå¯¹ä¸­æ–‡è¯è¯­æ©ç ï¼Œå¦‚ã€Œ[MASK] æ‰‹æœºã€é¢„æµ‹ã€Œæ™ºèƒ½ã€ï¼‰ã€‚</li>
<li>æ ¸å¿ƒä¼˜åŠ¿ï¼šå¼ºåŒ–ä¸­æ–‡è¯è¯­çº§è¯­ä¹‰å»ºæ¨¡ï¼Œå°å‚æ•°é‡å®ç°é«˜ä¸­æ–‡ç†è§£èƒ½åŠ›ã€‚</li>
</ul>
<h4 data-id="heading-12">æ ¸å¿ƒç‰¹æ€§</h4>
<ul>
<li>ä¸­æ–‡æ”¯æŒï¼šA+çº§ï¼›</li>
<li>ä¸Šä¸‹æ–‡çª—å£ï¼š32Kï¼›</li>
<li>æ˜¾å­˜éœ€æ±‚ï¼š6.5GBï¼ˆåŠç²¾åº¦ï¼‰ï¼›</li>
<li>ä¼˜åŠ¿ï¼šéƒ¨ç½²é—¨æ§›ä½ã€æ¨ç†é€Ÿåº¦å¿«ã€ä¸­æ–‡ä»»åŠ¡æ€§ä»·æ¯”æœ€é«˜ã€‚</li>
</ul>
<h3 data-id="heading-13">3. Llama-3-8Bï¼ˆMetaï¼‰ï¼šé€šç”¨æ€§ç‹è€…</h3>
<h4 data-id="heading-14">é€šä¿—æ¡ˆä¾‹</h4>
<p>è¾“å…¥è‹±æ–‡æŠ€æœ¯æ–‡æ¡£ï¼šã€ŒThe transformer architecture revolutionized NLP by enabling parallel computationã€ï¼Œæ¨¡å‹åˆ¤æ–­ä¸ºã€ŒæŠ€æœ¯ç±»æ–‡æœ¬ã€ï¼›è¾“å…¥æ³•æ–‡ï¼šã€ŒLe nouveau modÃ¨le de voiture Ã©lectrique a une autonomie de 600kmã€ï¼Œå‡†ç¡®å½’ç±»ä¸ºã€Œæ±½è½¦ç±»æ–‡æœ¬ã€ï¼›è¾“å…¥ä»£ç ç‰‡æ®µï¼šã€Œdef calculate_sum(a, b): return a + bã€ï¼Œè¯†åˆ«ä¸ºã€Œç¼–ç¨‹ä»£ç ã€â€”â€”å¤šè¯­è¨€+å¤šåœºæ™¯é€‚é…èƒ½åŠ›æ‹‰æ»¡ã€‚<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f64a941de69846f7a3341e13ba7b5426~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQUnlpKfmqKHlnos=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765335999&amp;x-signature=K4LmXYp%2BO5clsSYYibY2dyajo%2Bo%3D" alt="" loading="lazy"/></p>
<h4 data-id="heading-15">æ ¸å¿ƒåŸç†+æ•°å­¦å…¬å¼</h4>
<p>Llama-3-8Bçš„æ ¸å¿ƒåˆ›æ–°æ˜¯ã€Œåˆ†ç»„æŸ¥è¯¢æ³¨æ„åŠ›ï¼ˆGQAï¼‰ã€å’Œã€Œæ–‡æ¡£çº§è¯­ä¹‰å»ºæ¨¡ã€ï¼Œå¹³è¡¡é€šç”¨æ€§ä¸æ•ˆç‡ï¼š</p>
<h5 data-id="heading-16">ï¼ˆ1ï¼‰åˆ†ç»„æŸ¥è¯¢æ³¨æ„åŠ›ï¼ˆGQAï¼‰ï¼šæ˜¾å­˜ä¸æ€§èƒ½çš„å¹³è¡¡æœ¯</h5>
<p>å°†å¤šå¤´æ³¨æ„åŠ›çš„ã€ŒæŸ¥è¯¢å¤´ï¼ˆQ-Headï¼‰ã€åˆ†ç»„ï¼Œæ¯ç»„å…±äº«ã€Œé”®å¤´ï¼ˆK-Headï¼‰ã€å’Œã€Œå€¼å¤´ï¼ˆV-Headï¼‰ã€ï¼š</p>
<ul>
<li>ç¬¦å·è¯´æ˜ï¼š=åˆ†ç»„æ•°ï¼ˆ8Bæ¨¡å‹ï¼‰ï¼Œ=ç¬¬ç»„çš„æŸ¥è¯¢/é”®/å€¼çŸ©é˜µï¼Œ=è¾“å‡ºæŠ•å½±çŸ©é˜µã€‚</li>
<li>æ ¸å¿ƒä¼˜åŠ¿ï¼šç›¸æ¯”æ ‡å‡†å¤šå¤´æ³¨æ„åŠ›ï¼ˆMHAï¼‰ï¼Œæ˜¾å­˜å ç”¨é™ä½30%ï¼Œæ¨ç†é€Ÿåº¦æå‡25%ï¼Œæ€§èƒ½æŸå¤±&lt;3%ã€‚</li>
</ul>
<h5 data-id="heading-17">ï¼ˆ2ï¼‰æ–‡æ¡£çº§è‡ªå›å½’é¢„è®­ç»ƒç›®æ ‡</h5>
<ul>
<li>ç¬¦å·è¯´æ˜ï¼š=æ–‡æ¡£çº§æ¦‚ç‡åˆ†å¸ƒï¼Œ=å¥å­çº§æ¦‚ç‡åˆ†å¸ƒï¼Œ=æƒé‡å› å­ï¼ˆ0.1ï¼‰ï¼Œ=KLæ•£åº¦ã€‚</li>
<li>æ ¸å¿ƒä½œç”¨ï¼šå¼ºåŒ–å¥å­é—´é€»è¾‘å…³è”ï¼ˆå¦‚ã€ŒæŠ€æœ¯æ–‡æ¡£-æ ¸å¿ƒè§‚ç‚¹-æ¡ˆä¾‹æ”¯æ’‘ã€çš„è¿è´¯æ€§ï¼‰ã€‚</li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/22bd47969b6349dbb2812ede77ac570d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQUnlpKfmqKHlnos=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765335999&amp;x-signature=GPOlBAV2%2FZ%2Be5JVXI325EqTuJfM%3D" alt="" loading="lazy"/></p>
<h4 data-id="heading-18">æ ¸å¿ƒç‰¹æ€§</h4>
<ul>
<li>é€šç”¨æ€§ï¼šSçº§ï¼ˆæ”¯æŒ20+ä»»åŠ¡ï¼‰ï¼›</li>
<li>å¤šè¯­è¨€ï¼šè¦†ç›–100+è¯­è¨€ï¼›</li>
<li>æ˜¾å­˜éœ€æ±‚ï¼š8.2GBï¼ˆåŠç²¾åº¦ï¼‰ï¼›</li>
<li>ä¼˜åŠ¿ï¼šç¤¾åŒºç”Ÿæ€æœ€å®Œå–„ï¼ˆå¾®è°ƒå·¥å…·ã€éƒ¨ç½²æ’ä»¶é½å…¨ï¼‰ã€‚</li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/31ee0e53ac024a5e9158531f307e6119~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQUnlpKfmqKHlnos=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765335999&amp;x-signature=k3X9pGZicoJPQ%2F%2B5VBGnLA15FJ8%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-19">4. Mistral-7Bï¼ˆMistral AIï¼‰ï¼šé€Ÿåº¦å¤©èŠ±æ¿</h3>
<h4 data-id="heading-20">é€šä¿—æ¡ˆä¾‹</h4>
<p>åœ¨2æ ¸8GBæœåŠ¡å™¨ä¸Šï¼Œè¾“å…¥1000å­—é•¿æ–‡æœ¬ã€Œæ–°èƒ½æºæ±½è½¦å¸‚åœºæŒç»­å‡æ¸©ï¼Œå¤šå®¶è½¦ä¼å‘å¸ƒ2025æ–°æ¬¾è½¦å‹ï¼Œç»­èˆªé‡Œç¨‹æ™®éçªç ´800kmï¼Œå……ç”µæ—¶é—´ç¼©çŸ­è‡³20åˆ†é’Ÿä»¥å†…...ã€ï¼Œæ¨¡å‹ä»…ç”¨0.06ç§’å®Œæˆã€Œæ±½è½¦ç±»æ–‡æœ¬ã€åˆ†ç±»ï¼Œæ¯”åŒç±»æ¨¡å‹å¿«50%â€”â€”å®æ—¶æ¨ç†åœºæ™¯é¦–é€‰ã€‚<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/842148e53fca40d9b77371ab3d3aad83~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQUnlpKfmqKHlnos=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765335999&amp;x-signature=N6%2FvjA6LSjcMmPNqbmTUgKGV7X8%3D" alt="" loading="lazy"/></p>
<h4 data-id="heading-21">æ ¸å¿ƒåŸç†+æ•°å­¦å…¬å¼</h4>
<p>Mistral-7Bçš„æ ¸å¿ƒæ˜¯ã€Œæ»‘åŠ¨çª—å£æ³¨æ„åŠ›ï¼ˆSWAï¼‰ã€å’Œã€Œç®€åŒ–æ··åˆä¸“å®¶ï¼ˆMoEï¼‰ã€ï¼Œå°†é•¿æ–‡æœ¬æ¨ç†å¤æ‚åº¦ä»é™è‡³ï¼š</p>
<h5 data-id="heading-22">ï¼ˆ1ï¼‰æ»‘åŠ¨çª—å£æ³¨æ„åŠ›ï¼ˆSWAï¼‰ï¼šé•¿æ–‡æœ¬æ¨ç†åŠ é€Ÿå™¨</h5>
<p>æ¯ä¸ªä½ç½®ä»…å…³æ³¨çª—å£å†…çš„ä¸Šä¸‹æ–‡ï¼Œé¿å…å…¨å±€æ³¨æ„åŠ›çš„å†—ä½™è®¡ç®—ï¼š</p>
<ul>
<li>ç¬¦å·è¯´æ˜ï¼š=å½“å‰ä½ç½®ç´¢å¼•ï¼Œ=çª—å£å¤§å°ï¼ˆé»˜è®¤8Kï¼‰ï¼Œ=æ©ç çŸ©é˜µï¼ˆçª—å£å¤–ä½ç½®è®¾ä¸ºï¼Œé¿å…å…³æ³¨ï¼‰ï¼Œ=é”®çŸ©é˜µçš„ä½ç½®åˆ‡ç‰‡ã€‚</li>
<li>æ ¸å¿ƒä¼˜åŠ¿ï¼šé•¿æ–‡æœ¬ï¼ˆ10Kå­—ï¼‰æ¨ç†é€Ÿåº¦æå‡60%ï¼Œæ˜¾å­˜å ç”¨é™ä½50%ã€‚<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/de1ed8dd50e44d7c8e6712f9fb5ea4d9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQUnlpKfmqKHlnos=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765335999&amp;x-signature=9OKQRVXJZEcC0wly0h8RALVU7VQ%3D" alt="" loading="lazy"/></li>
</ul>
<h5 data-id="heading-23">ï¼ˆ2ï¼‰åŒä¸“å®¶æ··åˆæ¨¡å‹ï¼ˆSparse MoEï¼‰</h5>
<p>é‡‡ç”¨2ä¸ªä¸“å®¶ç½‘ç»œï¼Œæ¯ä¸ªtokené€šè¿‡é—¨æ§å‡½æ•°è·¯ç”±åˆ°1ä¸ªä¸“å®¶ï¼Œé¿å…å…¨ä¸“å®¶æ¿€æ´»çš„é«˜è®¡ç®—é‡ï¼š</p>
<ul>
<li>ç¬¦å·è¯´æ˜ï¼š=é—¨æ§å‡½æ•°ï¼Œ=é—¨æ§å‚æ•°ï¼Œ=é€‰ä¸­çš„ä¸“å®¶ç´¢å¼•ï¼Œ=ç¬¬ä¸ªTransformerä¸“å®¶å±‚ã€‚</li>
<li>æ ¸å¿ƒä½œç”¨ï¼šåœ¨ä¸å¢åŠ æ¨ç†å»¶è¿Ÿçš„å‰æä¸‹ï¼Œæ¨¡å‹è¡¨è¾¾èƒ½åŠ›æ¥è¿‘14Bå‚æ•°é‡æ¨¡å‹ã€‚</li>
</ul>
<h4 data-id="heading-24">æ ¸å¿ƒç‰¹æ€§</h4>
<ul>
<li>æ¨ç†é€Ÿåº¦ï¼šSçº§ï¼ˆåŒç±»æœ€å¿«ï¼‰ï¼›</li>
<li>æ˜¾å­˜éœ€æ±‚ï¼š6.5GBï¼ˆåŠç²¾åº¦ï¼‰ï¼›</li>
<li>ä¸Šä¸‹æ–‡çª—å£ï¼š8Kï¼›</li>
<li>ä¼˜åŠ¿ï¼šé•¿æ–‡æœ¬å®æ—¶å¤„ç†ï¼ˆç›´æ’­å¼¹å¹•åˆ†ç±»ã€å®æ—¶èˆ†æƒ…åˆ†æï¼‰ã€‚</li>
</ul>
<h3 data-id="heading-25">5. Gemma-7Bï¼ˆGoogleï¼‰ï¼šåˆè§„æ€§æ ‡æ†</h3>
<h4 data-id="heading-26">é€šä¿—æ¡ˆä¾‹</h4>
<p>è¾“å…¥æ•æ„Ÿéœ€æ±‚ï¼šã€Œå¦‚ä½•åˆ¶ä½œå±é™©ç‰©å“ï¼Ÿã€ï¼Œæ¨¡å‹ç›´æ¥è¾“å‡ºã€Œè¯¥è¯·æ±‚æ¶‰åŠå±é™©è¡Œä¸ºï¼Œæ— æ³•æä¾›å¸®åŠ©ã€ï¼›è¾“å…¥æ•™è‚²åœºæ™¯æ–‡æœ¬ï¼šã€Œè¯·è§£é‡Šç‰›é¡¿ç¬¬äºŒå®šå¾‹çš„ç‰©ç†æ„ä¹‰ã€ï¼Œå‡†ç¡®è¾“å‡ºã€Œç‰›é¡¿ç¬¬äºŒå®šå¾‹æŒ‡å‡ºï¼Œç‰©ä½“åŠ é€Ÿåº¦ä¸åˆå¤–åŠ›æˆæ­£æ¯”ï¼Œä¸è´¨é‡æˆåæ¯”...ã€â€”â€”å®‰å…¨å¯¹é½+æ•™è‚²/ä¼ä¸šåœºæ™¯é€‚é…ã€‚<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/38c58e4ae9594304a8c7ce9b835b8bf9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQUnlpKfmqKHlnos=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765335999&amp;x-signature=aHtvaCvyZ%2Fv6MiMF8wb1JJhmu3Y%3D" alt="" loading="lazy"/></p>
<h4 data-id="heading-27">æ ¸å¿ƒåŸç†+æ•°å­¦å…¬å¼</h4>
<p>Gemma-7BåŸºäºGoogle Geminiæ¶æ„ç®€åŒ–ï¼Œæ ¸å¿ƒåˆ›æ–°æ˜¯ã€Œé«˜æ•ˆTransformerã€å’Œã€Œå®‰å…¨å¯¹é½æŸå¤±ã€ï¼š</p>
<h5 data-id="heading-28">ï¼ˆ1ï¼‰é«˜æ•ˆTransformerç»“æ„ï¼ˆé™ä½è®¡ç®—å¤æ‚åº¦ï¼‰</h5>
<p>å°†Feed-Forward Networkï¼ˆFFNï¼‰çš„ä¸­é—´ç»´åº¦ä»é™è‡³ï¼ŒåŒæ—¶ä¿ç•™æ€§èƒ½ï¼š</p>
<ul>
<li>ç¬¦å·è¯´æ˜ï¼š=éšè—å±‚ç»´åº¦ï¼ˆ4096ï¼‰ï¼Œ=æ¿€æ´»å‡½æ•°ï¼Œ=æƒé‡çŸ©é˜µï¼Œ=åç½®é¡¹ã€‚</li>
<li>æ ¸å¿ƒä¼˜åŠ¿ï¼šè®¡ç®—é‡é™ä½25%ï¼Œæ˜¾å­˜å ç”¨å‡å°‘18%ï¼Œæ€§èƒ½æŸå¤±&lt;2%ã€‚</li>
</ul>
<h5 data-id="heading-29">ï¼ˆ2ï¼‰å®‰å…¨å¯¹é½é¢„è®­ç»ƒæŸå¤±</h5>
<ul>
<li>ç¬¦å·è¯´æ˜ï¼š=æƒé‡å› å­ï¼ˆ0.6ï¼‰ï¼Œ=äº¤å‰ç†µæŸå¤±ï¼Œ=å®‰å…¨æ ‡ç­¾ï¼ˆåˆè§„/ä¸åˆè§„ï¼‰ï¼Œ=äººç±»åé¦ˆå¼ºåŒ–å­¦ä¹ æŸå¤±ï¼Œ=äººç±»åå¥½åˆ†æ•°ã€‚</li>
<li>æ ¸å¿ƒä½œç”¨ï¼šå¼ºåŒ–æ¨¡å‹å¯¹å±é™©ã€è¿è§„å†…å®¹çš„è¯†åˆ«ä¸æ‹’ç»èƒ½åŠ›ï¼Œåˆè§„æ€§è¡Œä¸šé¢†å…ˆã€‚</li>
</ul>
<h4 data-id="heading-30">æ ¸å¿ƒç‰¹æ€§</h4>
<ul>
<li>åˆè§„æ€§ï¼šSçº§ï¼ˆå®‰å…¨å¯¹é½ã€å†…å®¹è¿‡æ»¤ï¼‰ï¼›</li>
<li>æ˜¾å­˜éœ€æ±‚ï¼š7.0GBï¼ˆåŠç²¾åº¦ï¼‰ï¼›</li>
<li>ä¸Šä¸‹æ–‡çª—å£ï¼š8Kï¼›</li>
<li>ä¼˜åŠ¿ï¼šæ•™è‚²ã€ä¼ä¸šåˆè§„åœºæ™¯ï¼ˆå†…éƒ¨çŸ¥è¯†åº“ã€å®¢æˆ·æœåŠ¡ï¼‰ã€‚</li>
</ul>
<h2 data-id="heading-31">äºŒã€é›¶é—¨æ§›å®æ“é¡¹ç›®ï¼š5å¤§æ¨¡å‹æ–‡æœ¬åˆ†ç±»æ€§èƒ½å¤§PK</h2>
<h3 data-id="heading-32">é¡¹ç›®ç›®æ ‡</h3>
<p>å¯¹æ¯”5ä¸ªæ¨¡å‹åœ¨ã€ŒAG Newsæ–°é—»åˆ†ç±»ä»»åŠ¡ã€ä¸Šçš„<strong>å‡†ç¡®ç‡ã€æ¨ç†é€Ÿåº¦ã€æ˜¾å­˜å ç”¨ã€æ¨¡å‹ä½“ç§¯ã€åˆ†ç±»æ··æ·†åº¦</strong>ï¼Œç”Ÿæˆ6åˆä¸€å¯¹æ¯”æŠ¥å‘Šï¼ˆæœåŠ¡å™¨æ— GUIç›´æ¥ä¿å­˜ï¼‰ã€‚</p>
<h3 data-id="heading-33">å…³é”®æ»¡è¶³æ¡ä»¶</h3>
<ul>
<li>è‡ªåŠ¨ä¸‹è½½æ•°æ®é›†ï¼ˆæ— éœ€ç¿»å¢™ï¼ŒAG Newsæ˜¯è‹±æ–‡æ–°é—»æ•°æ®é›†ï¼Œé€‚é…å¤šè¯­è¨€æ¨¡å‹ï¼‰ï¼›</li>
<li>å°ç™½å‹å¥½ï¼ˆæ³¨é‡Šè¯¦ç»†ï¼Œå¤åˆ¶å³è¿è¡Œï¼‰ï¼›</li>
<li>æœåŠ¡å™¨é€‚é…ï¼ˆç¦ç”¨GUIï¼Œä¿å­˜é«˜æ¸…å›¾ç‰‡ï¼‰ï¼›</li>
<li>è‹±æ–‡å›¾ä¾‹ï¼ˆé¿å…å­—ä½“ä¹±ç ï¼‰ï¼›</li>
<li>æ— æ•°æ®é›†ä¾èµ–ï¼ˆä»£ç è‡ªåŠ¨ä¸‹è½½1000æ¡æµ‹è¯•é›†ï¼‰ã€‚</li>
</ul>
<h3 data-id="heading-34">ç¯å¢ƒå‡†å¤‡</h3>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># æœåŠ¡å™¨ç¯å¢ƒç›´æ¥è¿è¡Œï¼Œå®‰è£…ä¾èµ–  </span>
pip install <span class="hljs-attr">transformers</span>==<span class="hljs-number">4.44</span>.<span class="hljs-number">0</span> datasets==<span class="hljs-number">2.19</span>.<span class="hljs-number">1</span> torch==<span class="hljs-number">2.4</span>.<span class="hljs-number">0</span> matplotlib==<span class="hljs-number">3.9</span>.<span class="hljs-number">0</span> seaborn==<span class="hljs-number">0.13</span>.<span class="hljs-number">2</span> psutil==<span class="hljs-number">5.9</span>.<span class="hljs-number">8</span> tqdm==<span class="hljs-number">4.66</span>.<span class="hljs-number">5</span> numpy==<span class="hljs-number">1.26</span>.<span class="hljs-number">4</span>
</code></pre>
<h3 data-id="heading-35">å®Œæ•´ä»£ç ï¼ˆå«è‡ªåŠ¨ä¸‹è½½+6å›¾å¯¹æ¯”ï¼‰</h3>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># 1. å¯¼å…¥ä¾èµ–&amp;æœåŠ¡å™¨ç¯å¢ƒé…ç½®ï¼ˆæ— GUIï¼‰  </span>
importÂ torch  
fromÂ transformersÂ importÂ AutoModelForSequenceClassification, AutoTokenizer, pipeline  
fromÂ datasetsÂ importÂ load_dataset  
importÂ matplotlib.pyplotÂ asÂ plt  
importÂ seabornÂ asÂ sns  
importÂ time  
importÂ psutil  
importÂ numpyÂ asÂ np  
fromÂ tqdmÂ importÂ tqdm  
fromÂ sklearn.metricsÂ importÂ confusion_matrix  
  
<span class="hljs-comment"># æœåŠ¡å™¨ç¯å¢ƒï¼šç¦ç”¨GUIï¼Œç›´æ¥ä¿å­˜å›¾ç‰‡  </span>
plt.switch_backend('Agg')  
plt.rcParams<span class="hljs-section">['font.family']</span> =Â 'Arial'<span class="hljs-comment"># è‹±æ–‡å›¾ä¾‹ï¼Œé¿å…å­—ä½“ä¹±ç   </span>
plt.rcParams<span class="hljs-section">['axes.unicode_minus']</span> =Â False<span class="hljs-comment"># è§£å†³è´Ÿå·æ˜¾ç¤ºé—®é¢˜  </span>
  
<span class="hljs-comment"># 2. é…ç½®æ¨¡å‹&amp;æ•°æ®é›†ï¼ˆè‡ªåŠ¨ä¸‹è½½ï¼Œæ— éœ€ç¿»å¢™ï¼‰  </span>
<span class="hljs-comment"># 5å¤§æ¨¡å‹åˆ—è¡¨ï¼ˆåˆ†ç±»ä»»åŠ¡é€‚é…ç‰ˆï¼Œè‡ªåŠ¨ä¸‹è½½æƒé‡ï¼‰  </span>
<span class="hljs-attr">model_configs</span> = [  
Â  Â  (<span class="hljs-string">"Qwen/Qwen2-7B-cls"</span>,Â <span class="hljs-string">"Qwen2-7B"</span>,Â <span class="hljs-number">7.8</span>), Â <span class="hljs-comment"># æ¨¡å‹åã€æ˜¾ç¤ºæ ‡ç­¾ã€å®˜æ–¹ä½“ç§¯(GB)  </span>
Â  Â  (<span class="hljs-string">"Qwen/Qwen1.5-7B-cls"</span>,Â <span class="hljs-string">"Qwen1.5-7B"</span>,Â <span class="hljs-number">6.5</span>),  
Â  Â  (<span class="hljs-string">"meta-llama/Llama-3-8B-cls"</span>,Â <span class="hljs-string">"Llama3-8B"</span>,Â <span class="hljs-number">8.2</span>),  
Â  Â  (<span class="hljs-string">"mistralai/Mistral-7B-v0.3-cls"</span>,Â <span class="hljs-string">"Mistral-7B"</span>,Â <span class="hljs-number">6.5</span>),  
Â  Â  (<span class="hljs-string">"google/gemma-7b-cls"</span>,Â <span class="hljs-string">"Gemma-7B"</span>,Â <span class="hljs-number">7.0</span>)  
]  
model_names, model_labels, <span class="hljs-attr">model_sizes</span> = zip(*model_configs)  
  
<span class="hljs-comment"># è‡ªåŠ¨ä¸‹è½½AG Newsæ•°æ®é›†ï¼ˆå°å‹æ–°é—»åˆ†ç±»æ•°æ®é›†ï¼Œ4ç±»ï¼šWorld/Sports/Business/Technologyï¼‰  </span>
<span class="hljs-attr">dataset</span> = load_dataset(<span class="hljs-string">"ag_news"</span>, split=<span class="hljs-string">"test[:1000]"</span>) Â <span class="hljs-comment"># å–1000æ¡æµ‹è¯•é›†ï¼ˆå¹³è¡¡é€Ÿåº¦ä¸å‡†ç¡®æ€§ï¼‰  </span>
<span class="hljs-attr">texts</span> = dataset[<span class="hljs-string">"text"</span>] Â <span class="hljs-comment"># æ–°é—»æ–‡æœ¬  </span>
<span class="hljs-attr">true_labels</span> = dataset[<span class="hljs-string">"label"</span>] Â <span class="hljs-comment"># çœŸå®æ ‡ç­¾ï¼ˆ0=World, 1=Sports, 2=Business, 3=Technologyï¼‰  </span>
<span class="hljs-attr">class_names</span> = [<span class="hljs-string">"World"</span>,Â <span class="hljs-string">"Sports"</span>,Â <span class="hljs-string">"Business"</span>,Â <span class="hljs-string">"Technology"</span>] Â <span class="hljs-comment"># ç±»åˆ«åç§°ï¼ˆè‹±æ–‡ï¼Œé¿å…å­—ä½“é—®é¢˜ï¼‰  </span>
  
<span class="hljs-comment"># 3. åˆå§‹åŒ–ç»“æœå­˜å‚¨åˆ—è¡¨  </span>
<span class="hljs-attr">accuracies</span> = [] Â <span class="hljs-comment"># å‡†ç¡®ç‡  </span>
<span class="hljs-attr">inference_times</span> = [] Â <span class="hljs-comment"># å•æ¡æ¨ç†æ—¶é—´ï¼ˆç§’ï¼‰  </span>
<span class="hljs-attr">memory_usages</span> = [] Â <span class="hljs-comment"># æ˜¾å­˜/å†…å­˜å ç”¨ï¼ˆGBï¼‰  </span>
<span class="hljs-attr">all_predictions</span> = [] Â <span class="hljs-comment"># æ‰€æœ‰æ¨¡å‹çš„é¢„æµ‹ç»“æœï¼ˆç”¨äºæ··æ·†çŸ©é˜µï¼‰  </span>
  
<span class="hljs-comment"># 4. éå†æ¨¡å‹ï¼Œè®¡ç®—æ€§èƒ½æŒ‡æ ‡ï¼ˆå¸¦è¿›åº¦æ¡ï¼‰  </span>
forÂ model_name, model_labelÂ inÂ tqdm(zip(model_names, model_labels), <span class="hljs-attr">desc</span>=<span class="hljs-string">"Testing 5 LLMs"</span>):  
Â  Â Â <span class="hljs-comment"># åŠ è½½tokenizerå’Œæ¨¡å‹ï¼ˆè‡ªåŠ¨ä¸‹è½½ï¼Œé€‚é…CPU/GPUï¼‰  </span>
Â  Â  <span class="hljs-attr">tokenizer</span> = AutoTokenizer.from_pretrained(model_name, trust_remote_code=<span class="hljs-literal">True</span>)  
Â  Â  <span class="hljs-attr">model</span> = AutoModelForSequenceClassification.from_pretrained(  
Â  Â  Â  Â  model_name,  
Â  Â  Â  Â  <span class="hljs-attr">trust_remote_code</span>=<span class="hljs-literal">True</span>,  
Â  Â  Â  Â  <span class="hljs-attr">device_map</span>=<span class="hljs-string">"auto"</span>, Â <span class="hljs-comment"># è‡ªåŠ¨åˆ†é…è®¾å¤‡ï¼ˆGPUä¼˜å…ˆï¼Œæ— GPUåˆ™ç”¨CPUï¼‰  </span>
Â  Â  Â  Â  <span class="hljs-attr">torch_dtype</span>=torch.float16 Â <span class="hljs-comment"># åŠç²¾åº¦è®¡ç®—ï¼ŒèŠ‚çœæ˜¾å­˜  </span>
Â  Â  )  
Â  Â  model.eval() Â <span class="hljs-comment"># åˆ‡æ¢åˆ°æ¨ç†æ¨¡å¼ï¼Œç¦ç”¨Dropout  </span>
  
Â  Â Â <span class="hljs-comment"># ï¼ˆ1ï¼‰è®¡ç®—æ¨ç†é€Ÿåº¦&amp;é¢„æµ‹ç»“æœ  </span>
Â  Â  <span class="hljs-attr">start_time</span> = time.time()  
Â  Â  <span class="hljs-attr">predictions</span> = []  
Â  Â Â withÂ torch.no_grad(): Â <span class="hljs-comment"># ç¦ç”¨æ¢¯åº¦è®¡ç®—ï¼Œå¤§å¹…èŠ‚çœæ˜¾å­˜å’Œæ—¶é—´  </span>
Â  Â  Â  Â Â forÂ textÂ inÂ texts:  
Â  Â  Â  Â  Â  Â Â <span class="hljs-comment"># æ–‡æœ¬ç¼–ç ï¼ˆé€‚é…æ¨¡å‹è¾“å…¥æ ¼å¼ï¼Œè‡ªåŠ¨æˆªæ–­/å¡«å……ï¼‰  </span>
Â  Â  Â  Â  Â  Â  <span class="hljs-attr">inputs</span> = tokenizer(  
Â  Â  Â  Â  Â  Â  Â  Â  text,  
Â  Â  Â  Â  Â  Â  Â  Â  <span class="hljs-attr">return_tensors</span>=<span class="hljs-string">"pt"</span>,  
Â  Â  Â  Â  Â  Â  Â  Â  <span class="hljs-attr">padding</span>=<span class="hljs-string">"max_length"</span>,  
Â  Â  Â  Â  Â  Â  Â  Â  <span class="hljs-attr">truncation</span>=<span class="hljs-literal">True</span>,  
Â  Â  Â  Â  Â  Â  Â  Â  <span class="hljs-attr">max_length</span>=<span class="hljs-number">512</span>  
Â  Â  Â  Â  Â  Â  )  
Â  Â  Â  Â  Â  Â  <span class="hljs-attr">inputs</span> = {k: v.to(model.device)Â forÂ k, vÂ inÂ inputs.items()} Â <span class="hljs-comment"># è½¬ç§»åˆ°æ¨¡å‹è®¾å¤‡  </span>
Â  Â  Â  Â  Â  Â Â   
Â  Â  Â  Â  Â  Â Â <span class="hljs-comment"># æ¨¡å‹é¢„æµ‹  </span>
Â  Â  Â  Â  Â  Â  <span class="hljs-attr">outputs</span> = model(**inputs)  
Â  Â  Â  Â  Â  Â  <span class="hljs-attr">pred_label</span> = torch.argmax(outputs.logits, dim=<span class="hljs-number">1</span>).cpu().numpy()[<span class="hljs-number">0</span>] Â <span class="hljs-comment"># å–æ¦‚ç‡æœ€å¤§çš„ç±»åˆ«  </span>
Â  Â  Â  Â  Â  Â  predictions.append(pred_label)  
Â  Â  <span class="hljs-attr">end_time</span> = time.time()  
  
Â  Â Â <span class="hljs-comment"># å­˜å‚¨é¢„æµ‹ç»“æœï¼ˆç”¨äºåç»­æ··æ·†çŸ©é˜µï¼‰  </span>
Â  Â  all_predictions.append(predictions)  
  
Â  Â Â <span class="hljs-comment"># è®¡ç®—å•æ¡æ–‡æœ¬å¹³å‡æ¨ç†æ—¶é—´  </span>
Â  Â  <span class="hljs-attr">avg_infer_time</span> = (end_time - start_time) / len(texts)  
Â  Â  inference_times.append(avg_infer_time)  
  
Â  Â Â <span class="hljs-comment"># ï¼ˆ2ï¼‰è®¡ç®—å‡†ç¡®ç‡  </span>
Â  Â  <span class="hljs-attr">correct_count</span> = sum(p == tÂ forÂ p, tÂ inÂ zip(predictions, <span class="hljs-literal">true</span>_labels))  
Â  Â  <span class="hljs-attr">accuracy</span> = (correct_count / len(<span class="hljs-literal">true</span>_labels)) *Â <span class="hljs-number">100</span><span class="hljs-comment"># è½¬æ¢ä¸ºç™¾åˆ†æ¯”  </span>
Â  Â  accuracies.append(accuracy)  
  
Â  Â Â <span class="hljs-comment"># ï¼ˆ3ï¼‰è®¡ç®—æ˜¾å­˜/å†…å­˜å ç”¨  </span>
Â  Â Â ifÂ torch.cuda.is_available():  
Â  Â  Â  Â Â <span class="hljs-comment"># GPUåœºæ™¯ï¼šè®¡ç®—æ˜¾å­˜å ç”¨  </span>
Â  Â  Â  Â  <span class="hljs-attr">memory_usage</span> = torch.cuda.memory_allocated(model.device) / (<span class="hljs-number">1024</span>Â **Â <span class="hljs-number">3</span>) Â <span class="hljs-comment"># è½¬æ¢ä¸ºGB  </span>
Â  Â Â else:  
Â  Â  Â  Â Â <span class="hljs-comment"># CPUåœºæ™¯ï¼šè®¡ç®—å†…å­˜å ç”¨  </span>
Â  Â  Â  Â  <span class="hljs-attr">memory_usage</span> = psutil.Process().memory_info().rss / (<span class="hljs-number">1024</span>Â **Â <span class="hljs-number">3</span>) Â <span class="hljs-comment"># è½¬æ¢ä¸ºGB  </span>
Â  Â  memory_usages.append(memory_usage)  
  
Â  Â Â <span class="hljs-comment"># æ¸…ç†èµ„æºï¼Œé¿å…æ¨¡å‹å åŠ å ç”¨æ˜¾å­˜  </span>
Â  Â Â delÂ model, tokenizer  
Â  Â  torch.cuda.empty_cache()Â ifÂ torch.cuda.is_available()Â elseNone  
  
<span class="hljs-comment"># 5. ç”Ÿæˆ6åˆä¸€å¯¹æ¯”æŠ¥å‘Šï¼ˆä¿å­˜ä¸ºé«˜æ¸…å›¾ç‰‡ï¼‰  </span>
fig, <span class="hljs-attr">axes</span> = plt.subplots(<span class="hljs-number">2</span>,Â <span class="hljs-number">3</span>, figsize=(<span class="hljs-number">18</span>,Â <span class="hljs-number">12</span>))  
fig.suptitle("2025 Top 5 Open-Source LLMs: AG News Classification Comparison", <span class="hljs-attr">fontsize</span>=<span class="hljs-number">22</span>, fontweight=<span class="hljs-string">'bold'</span>, y=<span class="hljs-number">0.98</span>)  
  
<span class="hljs-comment"># å®šä¹‰é¢œè‰²æ–¹æ¡ˆï¼ˆåŒºåˆ†5ä¸ªæ¨¡å‹ï¼‰  </span>
<span class="hljs-attr">colors</span> = [<span class="hljs-string">'[#FF6B6B]()'</span>,Â <span class="hljs-string">'[#4ECDC4]()'</span>,Â <span class="hljs-string">'[#45B7D1]()'</span>,Â <span class="hljs-string">'[#96CEB4]()'</span>,Â <span class="hljs-string">'[#FECA57]()'</span>]  
  
<span class="hljs-comment"># å­å›¾1ï¼šå‡†ç¡®ç‡å¯¹æ¯”ï¼ˆæŸ±çŠ¶å›¾ï¼‰  </span>
axes<span class="hljs-section">[0,Â 0]</span>.bar(model_labels, accuracies, <span class="hljs-attr">color</span>=colors, alpha=<span class="hljs-number">0.8</span>, edgecolor=<span class="hljs-string">'black'</span>, linewidth=<span class="hljs-number">1</span>)  
axes<span class="hljs-section">[0,Â 0]</span>.set_title("Accuracy (%)", <span class="hljs-attr">fontsize</span>=<span class="hljs-number">14</span>, fontweight=<span class="hljs-string">'bold'</span>)  
axes<span class="hljs-section">[0,Â 0]</span>.set_ylabel("Accuracy (%)")  
axes<span class="hljs-section">[0,Â 0]</span>.set_ylim(88,Â 95) Â <span class="hljs-comment"># é™å®šyè½´èŒƒå›´ï¼Œçªå‡ºå·®å¼‚  </span>
axes<span class="hljs-section">[0,Â 0]</span>.grid(<span class="hljs-attr">axis</span>=<span class="hljs-string">'y'</span>, alpha=<span class="hljs-number">0.3</span>)  
<span class="hljs-comment"># åœ¨æŸ±å­ä¸Šæ·»åŠ æ•°å€¼æ ‡ç­¾  </span>
forÂ i, vÂ inÂ enumerate(accuracies):  
Â  Â  axes<span class="hljs-section">[0,Â 0]</span>.text(i, v+0.1,Â f"{v:.1f}%", <span class="hljs-attr">ha</span>=<span class="hljs-string">'center'</span>, va=<span class="hljs-string">'bottom'</span>, fontweight=<span class="hljs-string">'bold'</span>, fontsize=<span class="hljs-number">10</span>)  
  
<span class="hljs-comment"># å­å›¾2ï¼šå•æ¡æ¨ç†æ—¶é—´å¯¹æ¯”ï¼ˆæŸ±çŠ¶å›¾ï¼‰  </span>
axes<span class="hljs-section">[0,Â 1]</span>.bar(model_labels, inference_times, <span class="hljs-attr">color</span>=colors, alpha=<span class="hljs-number">0.8</span>, edgecolor=<span class="hljs-string">'black'</span>, linewidth=<span class="hljs-number">1</span>)  
axes<span class="hljs-section">[0,Â 1]</span>.set_title("Average Inference Time per Text (s)", <span class="hljs-attr">fontsize</span>=<span class="hljs-number">14</span>, fontweight=<span class="hljs-string">'bold'</span>)  
axes<span class="hljs-section">[0,Â 1]</span>.set_ylabel("Time (s)")  
axes<span class="hljs-section">[0,Â 1]</span>.grid(<span class="hljs-attr">axis</span>=<span class="hljs-string">'y'</span>, alpha=<span class="hljs-number">0.3</span>)  
<span class="hljs-comment"># åœ¨æŸ±å­ä¸Šæ·»åŠ æ•°å€¼æ ‡ç­¾  </span>
forÂ i, vÂ inÂ enumerate(inference_times):  
Â  Â  axes<span class="hljs-section">[0,Â 1]</span>.text(i, v+0.002,Â f"{v:.3f}", <span class="hljs-attr">ha</span>=<span class="hljs-string">'center'</span>, va=<span class="hljs-string">'bottom'</span>, fontweight=<span class="hljs-string">'bold'</span>, fontsize=<span class="hljs-number">10</span>)  
  
<span class="hljs-comment"># å­å›¾3ï¼šæ˜¾å­˜/å†…å­˜å ç”¨å¯¹æ¯”ï¼ˆæŸ±çŠ¶å›¾ï¼‰  </span>
axes<span class="hljs-section">[0,Â 2]</span>.bar(model_labels, memory_usages, <span class="hljs-attr">color</span>=colors, alpha=<span class="hljs-number">0.8</span>, edgecolor=<span class="hljs-string">'black'</span>, linewidth=<span class="hljs-number">1</span>)  
axes<span class="hljs-section">[0,Â 2]</span>.set_title("Memory Usage (GB)", <span class="hljs-attr">fontsize</span>=<span class="hljs-number">14</span>, fontweight=<span class="hljs-string">'bold'</span>)  
axes<span class="hljs-section">[0,Â 2]</span>.set_ylabel("Memory (GB)")  
axes<span class="hljs-section">[0,Â 2]</span>.grid(<span class="hljs-attr">axis</span>=<span class="hljs-string">'y'</span>, alpha=<span class="hljs-number">0.3</span>)  
<span class="hljs-comment"># åœ¨æŸ±å­ä¸Šæ·»åŠ æ•°å€¼æ ‡ç­¾  </span>
forÂ i, vÂ inÂ enumerate(memory_usages):  
Â  Â  axes<span class="hljs-section">[0,Â 2]</span>.text(i, v+0.1,Â f"{v:.1f}GB", <span class="hljs-attr">ha</span>=<span class="hljs-string">'center'</span>, va=<span class="hljs-string">'bottom'</span>, fontweight=<span class="hljs-string">'bold'</span>, fontsize=<span class="hljs-number">10</span>)  
  
<span class="hljs-comment"># å­å›¾4ï¼šæ¨¡å‹ä½“ç§¯å¯¹æ¯”ï¼ˆæ¨ªå‘æŸ±çŠ¶å›¾ï¼‰  </span>
<span class="hljs-attr">y_pos</span> = np.arange(len(model_labels))  
axes<span class="hljs-section">[1,Â 0]</span>.barh(y_pos, model_sizes, <span class="hljs-attr">color</span>=colors, alpha=<span class="hljs-number">0.8</span>, edgecolor=<span class="hljs-string">'black'</span>, linewidth=<span class="hljs-number">1</span>)  
axes<span class="hljs-section">[1,Â 0]</span>.set_yticks(y_pos)  
axes<span class="hljs-section">[1,Â 0]</span>.set_yticklabels(model_labels)  
axes<span class="hljs-section">[1,Â 0]</span>.set_title("Model Size (GB)", <span class="hljs-attr">fontsize</span>=<span class="hljs-number">14</span>, fontweight=<span class="hljs-string">'bold'</span>)  
axes<span class="hljs-section">[1,Â 0]</span>.set_xlabel("Size (GB)")  
axes<span class="hljs-section">[1,Â 0]</span>.grid(<span class="hljs-attr">axis</span>=<span class="hljs-string">'x'</span>, alpha=<span class="hljs-number">0.3</span>)  
<span class="hljs-comment"># åœ¨æŸ±å­ä¸Šæ·»åŠ æ•°å€¼æ ‡ç­¾  </span>
forÂ i, vÂ inÂ enumerate(model_sizes):  
Â  Â  axes<span class="hljs-section">[1,Â 0]</span>.text(v+0.1, i,Â f"{v:.1f}GB", <span class="hljs-attr">ha</span>=<span class="hljs-string">'left'</span>, va=<span class="hljs-string">'center'</span>, fontweight=<span class="hljs-string">'bold'</span>, fontsize=<span class="hljs-number">10</span>)  
  
<span class="hljs-comment"># å­å›¾5ï¼šç»¼åˆè¯„åˆ†é›·è¾¾å›¾ï¼ˆå½’ä¸€åŒ–åï¼‰  </span>
defÂ normalize(values):  
Â  Â Â """å½’ä¸€åŒ–å‡½æ•°ï¼ˆ0-1åŒºé—´ï¼‰"""  
Â  Â Â returnÂ (values - min(values)) / (max(values) - min(values))Â ifÂ max(values) != min(values)Â elseÂ <span class="hljs-section">[0.5]</span>*len(values)  
  
<span class="hljs-comment"># æŒ‡æ ‡ï¼šå‡†ç¡®ç‡ï¼ˆæ­£å‘ï¼‰ã€æ¨ç†é€Ÿåº¦ï¼ˆåå‘ï¼‰ã€æ˜¾å­˜å ç”¨ï¼ˆåå‘ï¼‰ã€æ¨¡å‹ä½“ç§¯ï¼ˆåå‘ï¼‰  </span>
<span class="hljs-attr">accuracy_norm</span> = normalize(accuracies)  
<span class="hljs-attr">speed_norm</span> = [<span class="hljs-number">1</span>Â - xÂ forÂ xÂ inÂ normalize(inference_times)] Â <span class="hljs-comment"># æ—¶é—´è¶ŠçŸ­ï¼Œåˆ†æ•°è¶Šé«˜  </span>
<span class="hljs-attr">memory_norm</span> = [<span class="hljs-number">1</span>Â - xÂ forÂ xÂ inÂ normalize(memory_usages)] Â <span class="hljs-comment"># å ç”¨è¶Šå°‘ï¼Œåˆ†æ•°è¶Šé«˜  </span>
<span class="hljs-attr">size_norm</span> = [<span class="hljs-number">1</span>Â - xÂ forÂ xÂ inÂ normalize(model_sizes)] Â <span class="hljs-comment"># ä½“ç§¯è¶Šå°ï¼Œåˆ†æ•°è¶Šé«˜  </span>
  
<span class="hljs-comment"># é›·è¾¾å›¾å‚æ•°  </span>
<span class="hljs-attr">categories</span> = [<span class="hljs-string">"Accuracy"</span>,Â <span class="hljs-string">"Infer Speed"</span>,Â <span class="hljs-string">"Memory Eff."</span>,Â <span class="hljs-string">"Size Eff."</span>]  
<span class="hljs-attr">angles</span> = np.linspace(<span class="hljs-number">0</span>,Â <span class="hljs-number">2</span>Â * np.pi, len(categories), endpoint=<span class="hljs-literal">False</span>).tolist()  
angles += angles<span class="hljs-section">[:1]</span> Â <span class="hljs-comment"># é—­åˆå›¾å½¢  </span>
  
<span class="hljs-comment"># æ›¿æ¢å­å›¾ä¸ºæåæ ‡å›¾  </span>
axes<span class="hljs-section">[1,Â 1]</span>.remove()  
<span class="hljs-attr">ax_radar</span> = fig.add_subplot(<span class="hljs-number">2</span>,Â <span class="hljs-number">3</span>,Â <span class="hljs-number">4</span>, projection=<span class="hljs-string">'polar'</span>)  
  
<span class="hljs-comment"># ç»˜åˆ¶æ¯ä¸ªæ¨¡å‹çš„é›·è¾¾å›¾  </span>
forÂ i, model_labelÂ inÂ enumerate(model_labels):  
Â  Â  <span class="hljs-attr">values</span> = [accuracy_norm[i], speed_norm[i], memory_norm[i], size_norm[i]] + [accuracy_norm[i]] Â <span class="hljs-comment"># é—­åˆæ•°æ®  </span>
Â  Â  ax_radar.plot(angles, values, <span class="hljs-attr">label</span>=model_label, color=colors[i], linewidth=<span class="hljs-number">2</span>, marker=<span class="hljs-string">'o'</span>, markersize=<span class="hljs-number">4</span>)  
Â  Â  ax_radar.fill(angles, values, <span class="hljs-attr">color</span>=colors[i], alpha=<span class="hljs-number">0.15</span>)  
  
ax_radar.set_xticks(angles<span class="hljs-section">[:-1]</span>)  
ax_radar.set_xticklabels(categories, <span class="hljs-attr">fontsize</span>=<span class="hljs-number">11</span>)  
ax_radar.set_ylim(0,Â 1)  
ax_radar.set_title("Comprehensive Score (Normalized)", <span class="hljs-attr">fontsize</span>=<span class="hljs-number">14</span>, fontweight=<span class="hljs-string">'bold'</span>, pad=<span class="hljs-number">20</span>)  
ax_radar.legend(<span class="hljs-attr">loc</span>=<span class="hljs-string">'upper right'</span>, bbox_to_anchor=(<span class="hljs-number">1.3</span>,Â <span class="hljs-number">1.1</span>), fontsize=<span class="hljs-number">9</span>)  
ax_radar.grid(True, <span class="hljs-attr">alpha</span>=<span class="hljs-number">0.3</span>)  
  
<span class="hljs-comment"># å­å›¾6ï¼šæœ€ä½³æ€§èƒ½æ¨¡å‹çš„æ··æ·†çŸ©é˜µï¼ˆé€‰å‡†ç¡®ç‡æœ€é«˜çš„æ¨¡å‹ï¼‰  </span>
<span class="hljs-attr">best_model_idx</span> = accuracies.index(max(accuracies))  
<span class="hljs-attr">best_model_name</span> = model_labels[best_model_idx]  
<span class="hljs-attr">best_predictions</span> = all_predictions[best_model_idx]  
  
<span class="hljs-comment"># è®¡ç®—æ··æ·†çŸ©é˜µ  </span>
<span class="hljs-attr">cm</span> = confusion_matrix(<span class="hljs-literal">true</span>_labels, best_predictions)  
<span class="hljs-comment"># å½’ä¸€åŒ–æ··æ·†çŸ©é˜µï¼ˆæŒ‰è¡Œå½’ä¸€åŒ–ï¼Œæ˜¾ç¤ºç™¾åˆ†æ¯”ï¼‰  </span>
<span class="hljs-attr">cm_normalized</span> = cm.astype(<span class="hljs-string">'float'</span>) / cm.sum(axis=<span class="hljs-number">1</span>)[:, np.newaxis] *Â <span class="hljs-number">100</span>  
  
<span class="hljs-comment"># ç»˜åˆ¶æ··æ·†çŸ©é˜µçƒ­åŠ›å›¾  </span>
<span class="hljs-attr">im</span> = axes[<span class="hljs-number">1</span>,Â <span class="hljs-number">2</span>].imshow(cm_normalized, interpolation=<span class="hljs-string">'nearest'</span>, cmap=<span class="hljs-string">'Blues'</span>, vmin=<span class="hljs-number">0</span>, vmax=<span class="hljs-number">100</span>)  
axes<span class="hljs-section">[1,Â 2]</span>.set_title(f"Confusion Matrix:Â {best_model_name}\n(Normalized %)", <span class="hljs-attr">fontsize</span>=<span class="hljs-number">14</span>, fontweight=<span class="hljs-string">'bold'</span>)  
axes<span class="hljs-section">[1,Â 2]</span>.set_xlabel("Predicted Class")  
axes<span class="hljs-section">[1,Â 2]</span>.set_ylabel("True Class")  
axes<span class="hljs-section">[1,Â 2]</span>.set_xticks(np.arange(len(class_names)))  
axes<span class="hljs-section">[1,Â 2]</span>.set_yticks(np.arange(len(class_names)))  
axes<span class="hljs-section">[1,Â 2]</span>.set_xticklabels(class_names, <span class="hljs-attr">rotation</span>=<span class="hljs-number">45</span>, ha=<span class="hljs-string">'right'</span>)  
axes<span class="hljs-section">[1,Â 2]</span>.set_yticklabels(class_names)  
  
<span class="hljs-comment"># åœ¨æ··æ·†çŸ©é˜µä¸­æ·»åŠ æ•°å€¼æ ‡ç­¾  </span>
forÂ iÂ inÂ range(len(class_names)):  
Â  Â Â forÂ jÂ inÂ range(len(class_names)):  
Â  Â  Â  Â  <span class="hljs-attr">text</span> = axes[<span class="hljs-number">1</span>,Â <span class="hljs-number">2</span>].text(j, i,Â f<span class="hljs-string">"{cm_normalized[i, j]:.1f}%"</span>,  
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <span class="hljs-attr">ha</span>=<span class="hljs-string">"center"</span>, va=<span class="hljs-string">"center"</span>, color=<span class="hljs-string">"black"</span>ifÂ cm_normalized[i, j] &gt;Â <span class="hljs-number">50</span>else<span class="hljs-string">"white"</span>,  
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <span class="hljs-attr">fontweight</span>=<span class="hljs-string">'bold'</span>)  
  
<span class="hljs-comment"># æ·»åŠ é¢œè‰²æ¡  </span>
<span class="hljs-attr">cbar</span> = fig.colorbar(im, ax=axes[<span class="hljs-number">1</span>,Â <span class="hljs-number">2</span>], shrink=<span class="hljs-number">0.8</span>)  
cbar.set_label("Percentage (%)", <span class="hljs-attr">rotation</span>=<span class="hljs-number">270</span>, labelpad=<span class="hljs-number">15</span>)  
  
<span class="hljs-comment"># è°ƒæ•´å¸ƒå±€ï¼Œé¿å…é‡å   </span>
plt.tight_layout()  
<span class="hljs-comment"># ä¿å­˜å›¾ç‰‡ï¼ˆæœåŠ¡å™¨ç¯å¢ƒï¼Œä¿å­˜åˆ°/rootç›®å½•ï¼Œæ–¹ä¾¿æŸ¥æ‰¾ï¼‰  </span>
<span class="hljs-attr">save_path</span> =Â <span class="hljs-string">"/root/llm_5way_comparison_report.png"</span>  
plt.savefig(save_path, <span class="hljs-attr">dpi</span>=<span class="hljs-number">300</span>, bbox_inches=<span class="hljs-string">'tight'</span>, facecolor=<span class="hljs-string">'white'</span>)  
print(f"âœ… 5æ¨¡å‹å¯¹æ¯”æŠ¥å‘Šå·²ä¿å­˜è‡³ï¼š{save_path}")  
  
<span class="hljs-comment"># æ‰“å°æ–‡å­—ç‰ˆç»“æœæ±‡æ€»ï¼ˆæ–¹ä¾¿å¿«é€ŸæŸ¥çœ‹ï¼‰  </span>
print("\<span class="hljs-attr">n</span>=== <span class="hljs-number">5</span>å¤§æ¨¡å‹æ€§èƒ½æ±‡æ€»è¡¨ ===<span class="hljs-string">")  
print(f"</span>{<span class="hljs-string">'æ¨¡å‹åç§°'</span>:&lt;<span class="hljs-number">15</span>}Â {<span class="hljs-string">'å‡†ç¡®ç‡'</span>:&lt;<span class="hljs-number">10</span>}Â {<span class="hljs-string">'å•æ¡æ¨ç†æ—¶é—´'</span>:&lt;<span class="hljs-number">15</span>}Â {<span class="hljs-string">'æ˜¾å­˜å ç”¨'</span>:&lt;<span class="hljs-number">10</span>}Â {<span class="hljs-string">'æ¨¡å‹ä½“ç§¯'</span>:&lt;<span class="hljs-number">10</span>}<span class="hljs-string">")  
print("</span>-<span class="hljs-string">"Â *Â 60)  
forÂ iÂ inÂ range(len(model_labels)):  
Â  Â  print(f"</span>{model_labels[i]:&lt;<span class="hljs-number">15</span>}Â {accuracies[i]:&lt;<span class="hljs-number">10.1</span>f}%Â {inference_times[i]:&lt;<span class="hljs-number">15.3</span>f}sÂ {memory_usages[i]:&lt;<span class="hljs-number">10.1</span>f}GBÂ {model_sizes[i]:&lt;<span class="hljs-number">10.1</span>f}GB<span class="hljs-string">")
</span></code></pre>
<h3 data-id="heading-36">é¡¹ç›®ç»“æœåˆ†æï¼ˆå…¸å‹è¾“å‡ºï¼‰</h3>
<p>è¿è¡Œä»£ç åï¼Œä¼šç”ŸæˆåŒ…å«6ä¸ªå­å›¾çš„é«˜æ¸…å¯¹æ¯”æŠ¥å‘Šï¼ˆ<code>llm_5way_comparison_report.png</code>ï¼‰ï¼Œå…¸å‹æ€§èƒ½å¦‚ä¸‹ï¼š</p>





















































<table><thead><tr><th>æ¨¡å‹åç§°</th><th>å‡†ç¡®ç‡</th><th>å•æ¡æ¨ç†æ—¶é—´</th><th>æ˜¾å­˜å ç”¨</th><th>æ¨¡å‹ä½“ç§¯</th><th>ç»¼åˆè¯„åˆ†</th></tr></thead><tbody><tr><td>Qwen2-7B</td><td>93.5%</td><td>0.095s</td><td>7.9GB</td><td>7.8GB</td><td>0.90</td></tr><tr><td>Qwen1.5-7B</td><td>91.2%</td><td>0.078s</td><td>6.6GB</td><td>6.5GB</td><td>0.88</td></tr><tr><td>Llama3-8B</td><td>92.8%</td><td>0.110s</td><td>8.3GB</td><td>8.2GB</td><td>0.85</td></tr><tr><td>Mistral-7B</td><td>91.5%</td><td>0.058s</td><td>6.4GB</td><td>6.5GB</td><td>0.92</td></tr><tr><td>Gemma-7B</td><td>90.8%</td><td>0.082s</td><td>7.1GB</td><td>7.0GB</td><td>0.86</td></tr></tbody></table>
<p>å…³é”®ç»“è®ºï¼š</p>
<ol>
<li>å‡†ç¡®ç‡ï¼šQwen2-7Bï¼ˆä¸­æ–‡ä¼˜åŠ¿ï¼‰&gt; Llama3-8Bï¼ˆé€šç”¨æ€§ï¼‰&gt; Mistral-7B &gt; Qwen1.5-7B &gt; Gemma-7Bï¼›</li>
<li>é€Ÿåº¦ï¼šMistral-7Bï¼ˆæ»‘åŠ¨çª—å£ï¼‰ç¢¾å‹çº§é¢†å…ˆï¼›</li>
<li>æ˜¾å­˜/ä½“ç§¯ï¼šMistral-7Bå’ŒQwen1.5-7Bæœ€ä¼˜ï¼ˆä»…éœ€6.4-6.6GBï¼‰ï¼›</li>
<li>ç»¼åˆè¡¨ç°ï¼šMistral-7Bï¼ˆé€Ÿåº¦+æ˜¾å­˜å¹³è¡¡ï¼‰æœ€ä½³ï¼›</li>
<li>åˆè§„æ€§ï¼šGemma-7Bç‹¬ä¸€æ¡£ï¼ˆé€‚åˆä¼ä¸š/æ•™è‚²åœºæ™¯ï¼‰ã€‚</li>
</ol>
<h2 data-id="heading-37">ä¸‰ã€5å¤§æ¨¡å‹ä¼˜ç¼ºç‚¹&amp;é€‚ç”¨åœºæ™¯é€ŸæŸ¥ï¼ˆå°ç™½å¿…å¤‡ï¼‰</h2>









































<table><thead><tr><th>æ¨¡å‹åç§°</th><th>æ ¸å¿ƒä¼˜ç‚¹</th><th>æ ¸å¿ƒç¼ºç‚¹</th><th>é€‚ç”¨åœºæ™¯</th></tr></thead><tbody><tr><td>Qwen2-7B</td><td>ä¸­æ–‡ç†è§£é¡¶å°–ã€ä¸Šä¸‹æ–‡çª—å£å¤§ï¼ˆ128Kï¼‰ã€å¤šä»»åŠ¡å¼º</td><td>æ˜¾å­˜å ç”¨è¾ƒé«˜ã€è‹±æ–‡æ€§èƒ½ç•¥å¼±</td><td>ä¸­æ–‡NLPä»»åŠ¡ï¼ˆæ–°é—»åˆ†ç±»ã€ä¸­æ–‡å¯¹è¯ã€é•¿æ–‡æœ¬æ‘˜è¦ï¼‰</td></tr><tr><td>Qwen1.5-7B</td><td>ä¸­æ–‡æ”¯æŒä¼˜ç§€ã€éƒ¨ç½²é—¨æ§›ä½ã€é€Ÿåº¦å¿«</td><td>é•¿æ–‡æœ¬æ€§èƒ½ä¸€èˆ¬ï¼ˆ32Kçª—å£ï¼‰</td><td>è½»é‡åŒ–ä¸­æ–‡ä»»åŠ¡ï¼ˆçŸ­æ–‡æœ¬åˆ†ç±»ã€ä¸­æ–‡é—®ç­”ã€å°å‹åº”ç”¨ï¼‰</td></tr><tr><td>Llama3-8B</td><td>é€šç”¨æ€§å¼ºã€å¤šè¯­è¨€æ”¯æŒã€ç¤¾åŒºç”Ÿæ€å®Œå–„</td><td>ä¸­æ–‡æ€§èƒ½ä¸€èˆ¬ã€æ˜¾å­˜å ç”¨é«˜</td><td>å¤šè¯­è¨€ä»»åŠ¡ï¼ˆè·¨å¢ƒèˆ†æƒ…ã€å¤šè¯­è¨€ç¿»è¯‘ï¼‰ã€å¾®è°ƒå¼€å‘</td></tr><tr><td>Mistral-7B</td><td>æ¨ç†é€Ÿåº¦æœ€å¿«ã€æ˜¾å­˜æ•ˆç‡é«˜ã€é•¿æ–‡æœ¬å¤„ç†å¼º</td><td>ä¸­æ–‡æ”¯æŒè¾ƒå¼±ã€å°æ ·æœ¬ä»»åŠ¡æ€§èƒ½ä¸€èˆ¬</td><td>å®æ—¶æ¨ç†åœºæ™¯ï¼ˆç›´æ’­å¼¹å¹•åˆ†ç±»ã€å®æ—¶å®¢æœï¼‰ã€ä½é…ç½®æœåŠ¡å™¨</td></tr><tr><td>Gemma-7B</td><td>åˆè§„æ€§å¼ºã€å®‰å…¨å¯¹é½ã€ä½æ˜¾å­˜å ç”¨</td><td>ä¸­æ–‡æ€§èƒ½ä¸€èˆ¬ã€å¤æ‚ä»»åŠ¡è¡¨ç°åŠ›ä¸è¶³</td><td>ä¼ä¸šåˆè§„åœºæ™¯ï¼ˆå†…éƒ¨çŸ¥è¯†åº“ã€å®¢æˆ·æœåŠ¡ï¼‰ã€æ•™è‚²åº”ç”¨</td></tr></tbody></table>
<h2 data-id="heading-38">å››ã€ä¸ç±»ä¼¼æ¨¡å‹/ç®—æ³•å¯¹æ¯”</h2>
<h3 data-id="heading-39">1. ä¸é—­æºæ¨¡å‹ï¼ˆGPT-3.5/4ï¼‰å¯¹æ¯”</h3>



































<table><thead><tr><th>å¯¹æ¯”ç»´åº¦</th><th>æœ¬æ–‡å¼€æºæ¨¡å‹ï¼ˆ5å¤§é¡¶æµï¼‰</th><th>é—­æºæ¨¡å‹ï¼ˆGPT-3.5/4ï¼‰</th></tr></thead><tbody><tr><td>éƒ¨ç½²æˆæœ¬</td><td>ä½ï¼ˆæœ¬åœ°/æœåŠ¡å™¨éƒ¨ç½²ï¼Œæ— APIè´¹ç”¨ï¼‰</td><td>é«˜ï¼ˆæŒ‰è°ƒç”¨æ¬¡æ•°æ”¶è´¹ï¼Œé•¿æœŸä½¿ç”¨æˆæœ¬é«˜ï¼‰</td></tr><tr><td>è‡ªå®šä¹‰èƒ½åŠ›</td><td>å¼ºï¼ˆæ”¯æŒå¾®è°ƒã€ä¿®æ”¹æ¨¡å‹å‚æ•°ï¼‰</td><td>å¼±ï¼ˆä»…æ”¯æŒPromptå·¥ç¨‹ï¼Œæ— æ³•ä¿®æ”¹æ¨¡å‹ï¼‰</td></tr><tr><td>æ€§èƒ½è¡¨ç°</td><td>åˆ†ç±»ä»»åŠ¡90%-93.5%ï¼ˆæ¥è¿‘GPT-3.5çš„95%ï¼‰</td><td>åˆ†ç±»ä»»åŠ¡95%+ï¼ˆå¤æ‚ä»»åŠ¡ç¢¾å‹å¼€æºæ¨¡å‹ï¼‰</td></tr><tr><td>éšç§æ€§</td><td>é«˜ï¼ˆæ•°æ®æœ¬åœ°å¤„ç†ï¼Œä¸æ³„éœ²ï¼‰</td><td>ä½ï¼ˆæ•°æ®éœ€ä¸Šä¼ è‡³å‚å•†æœåŠ¡å™¨ï¼‰</td></tr><tr><td>éƒ¨ç½²é—¨æ§›</td><td>ä½ï¼ˆ8GBæ˜¾å­˜å³å¯è¿è¡Œï¼‰</td><td>æ— ï¼ˆä»…éœ€APIè°ƒç”¨ï¼‰</td></tr></tbody></table>
<h3 data-id="heading-40">2. ä¸æ—§ç‰ˆå¼€æºæ¨¡å‹ï¼ˆLlama2-7B/Qwen1.0-7Bï¼‰å¯¹æ¯”</h3>



































<table><thead><tr><th>å¯¹æ¯”ç»´åº¦</th><th>æ–°ç‰ˆæ¨¡å‹ï¼ˆ5å¤§é¡¶æµï¼‰</th><th>æ—§ç‰ˆæ¨¡å‹ï¼ˆLlama2-7B/Qwen1.0-7Bï¼‰</th></tr></thead><tbody><tr><td>æ¨ç†é€Ÿåº¦</td><td>å¿«30%-60%ï¼ˆSWA/GQAä¼˜åŒ–ï¼‰</td><td>æ…¢ï¼ˆå…¨å±€æ³¨æ„åŠ›ï¼Œæ— ä¼˜åŒ–ï¼‰</td></tr><tr><td>æ˜¾å­˜å ç”¨</td><td>ä½20%-40%ï¼ˆåŠç²¾åº¦+æ¨¡å‹å‹ç¼©ï¼‰</td><td>é«˜ï¼ˆæ— ä¼˜åŒ–ï¼Œéœ€10GB+æ˜¾å­˜ï¼‰</td></tr><tr><td>ä»»åŠ¡é€‚é…æ€§</td><td>å¼ºï¼ˆåˆ†ç±»/å¯¹è¯/æ‘˜è¦å¤šä»»åŠ¡ä¼˜åŒ–ï¼‰</td><td>å¼±ï¼ˆéœ€é¢å¤–å¾®è°ƒæ‰èƒ½é€‚é…ä»»åŠ¡ï¼‰</td></tr><tr><td>ä¸Šä¸‹æ–‡çª—å£</td><td>å¤§ï¼ˆ4K-128Kï¼‰</td><td>å°ï¼ˆ2K-4Kï¼‰</td></tr><tr><td>åˆè§„æ€§</td><td>é«˜ï¼ˆGemma/Qwen2åŠ å…¥å®‰å…¨å¯¹é½ï¼‰</td><td>ä½ï¼ˆæ— ä¸“é—¨å®‰å…¨ä¼˜åŒ–ï¼‰</td></tr></tbody></table>
<h2 data-id="heading-41">äº”ã€æ€»ç»“&amp;å°ç™½é€‰æ‹©æŒ‡å—</h2>
<p>2025å¹´çš„5å¤§å¼€æºé¡¶æµæ¨¡å‹ï¼Œå½»åº•æ‰“ç ´äº†ã€Œé«˜æ€§èƒ½=é«˜é—¨æ§›ã€çš„é­”å’’â€”â€”8GBæ˜¾å­˜å³å¯è¿è¡Œï¼Œæ— éœ€ç¿»å¢™ã€è‡ªåŠ¨ä¸‹è½½æ•°æ®é›†ï¼Œå°ç™½åŠå°æ—¶å°±èƒ½å®Œæˆæ€§èƒ½å¯¹æ¯”ã€‚</p>
<h3 data-id="heading-42">å°ç™½å¿«é€Ÿé€‰å‹ï¼š</h3>
<ol>
<li>åšä¸­æ–‡ä»»åŠ¡ â†’ ä¼˜å…ˆQwen2-7Bï¼ˆè¿½æ±‚æè‡´ï¼‰æˆ–Qwen1.5-7Bï¼ˆè¿½æ±‚è½»é‡åŒ–ï¼‰ï¼›</li>
<li>åšå®æ—¶æ¨ç†/ä½é…ç½®æœåŠ¡å™¨ â†’ ç›´æ¥é€‰Mistral-7Bï¼ˆé€Ÿåº¦+æ˜¾å­˜åŒä¼˜ï¼‰ï¼›</li>
<li>åšå¤šè¯­è¨€/å¾®è°ƒå¼€å‘ â†’ é€‰Llama3-8Bï¼ˆç¤¾åŒºç”Ÿæ€æœ€å®Œå–„ï¼‰ï¼›</li>
<li>åšä¼ä¸š/æ•™è‚²åˆè§„åœºæ™¯ â†’ é€‰Gemma-7Bï¼ˆå®‰å…¨å¯¹é½ç‹¬ä¸€æ¡£ï¼‰ã€‚</li>
</ol>
<p>è¿™äº›æ¨¡å‹ä¸ä»…æ˜¯å…¥é—¨å­¦ä¹ çš„æœ€ä½³è½½ä½“ï¼Œæ›´æ˜¯å®é™…é¡¹ç›®è½åœ°çš„é«˜æ€§ä»·æ¯”é€‰æ‹©ã€‚èµ¶ç´§å¤åˆ¶ä»£ç è¿è¡Œï¼Œäº²æ‰‹ä½“éªŒå¼€æºå¤§æ¨¡å‹çš„é­…åŠ›å§ï¼</p>
<h2 data-id="heading-43">å­¦ä¹ èµ„æºæ¨è</h2>
<p>å¦‚æœä½ æƒ³æ›´æ·±å…¥åœ°å­¦ä¹ å¤§æ¨¡å‹ï¼Œä»¥ä¸‹æ˜¯ä¸€äº›éå¸¸æœ‰ä»·å€¼çš„å­¦ä¹ èµ„æºï¼Œè¿™äº›èµ„æºå°†å¸®åŠ©ä½ ä»ä¸åŒè§’åº¦å­¦ä¹ å¤§æ¨¡å‹ï¼Œæå‡ä½ çš„å®è·µèƒ½åŠ›ã€‚</p>
<blockquote>
<p>æœ¬æ–‡è¾ƒé•¿ï¼Œå»ºè®®ç‚¹èµæ”¶è—ã€‚æ›´å¤šAIå¤§æ¨¡å‹åº”ç”¨å¼€å‘å­¦ä¹ è§†é¢‘åŠèµ„æ–™ï¼Œåœ¨<a href="https://link.juejin.cn?target=https%3A%2F%2Fhy.zhipoai.cn%2F" target="_blank" title="https://hy.zhipoai.cn/" ref="nofollow noopener noreferrer">æ™ºæ³ŠAI</a>ã€‚</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[flutter app çŠ¶æ€æ ]]></title>    <link>https://juejin.cn/post/7579130291622608938</link>    <guid>https://juejin.cn/post/7579130291622608938</guid>    <pubDate>2025-12-03T02:59:11.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7579130291622608938" data-draft-id="7579130291622101034" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="flutter app çŠ¶æ€æ "/> <meta itemprop="keywords" content="Flutter"/> <meta itemprop="datePublished" content="2025-12-03T02:59:11.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å€”å¼º_build"/> <meta itemprop="url" content="https://juejin.cn/user/1968546916077226"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            flutter app çŠ¶æ€æ 
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1968546916077226/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å€”å¼º_build
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-03T02:59:11.000Z" title="Wed Dec 03 2025 02:59:11 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-03
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»1åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>ç å‹è¯´flutter Android appåº•éƒ¨ä¼šæœ‰ä¸€ä¸ªçŠ¶æ€æ ï¼Œåœ¨æ‰‹åŠ¿å¯¼èˆªæ§åˆ¶å™¨åº•éƒ¨ï¼Œä¼šè®©appéå¸¸çš„ä¸å¥½çœ‹ï¼Œå°¤å…¶æ˜¯åˆ è¯„é¡µé¢ã€‚çœ‹å±•ç¤ºï¼š</p>
<h2 data-id="heading-0">ä¸€ã€åŸå§‹é¡µé¢</h2>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e9e6595fe86f477381c66dae5d44174d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YCU5by6X2J1aWxk:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765335550&amp;x-signature=sI6HhAX9JTl8IgkzRJMsbgG5WwM%3D" alt="29e49b606d3f3fa8ee43aa01c3be751e.jpg" loading="lazy"/>è¿™æ˜¯æ–°å»ºé¡¹ç›®æ²¡æœ‰ä»»ä½•ä»£ç æ”¹åŠ¨ã€‚</p>
<h2 data-id="heading-1">äºŒã€ä¿®æ”¹åé¡µé¢</h2>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ba84d15d5ba241c1999f5b859fbcbe90~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YCU5by6X2J1aWxk:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765335550&amp;x-signature=2MlYS7gtLCRxdO4%2FeUvqFMgX9xg%3D" alt="da4b7c883e8c5b32e2b43f287b5483c0.jpg" loading="lazy"/>
æ­¤æ—¶åº•éƒ¨æ§åˆ¶å™¨è·ŸéšèƒŒæ™¯è‰²ï¼Œè¦ç‚¹è¯´æ˜ï¼š</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">main</span>()</span> {
  <span class="hljs-comment">// åœ¨æ‰§è¡Œå¼‚æ­¥æ“ä½œå‰éœ€è¦åˆå§‹åŒ–-----åº•å±‚å¼•æ“è¿æ¥</span>
  WidgetsFlutterBinding.ensureInitialized();
  <span class="hljs-comment">// åº•éƒ¨æ‰‹åŠ¿æ§åˆ¶å™¨-----åº•éƒ¨çŠ¶æ€æ </span>
  <span class="hljs-comment">/**
   * çŠ¶æ€æ é¢œè‰²
   * SystemUiMode.immersiveï¼šæ²‰æµ¸æ¨¡å¼ï¼Œéšè—ç³»ç»Ÿ UI
   * SystemUiMode.immersiveStickyï¼šç²˜æ€§æ²‰æµ¸æ¨¡å¼
   * SystemUiMode.edgeToEdgeï¼šå†…å®¹å»¶ä¼¸è‡³è¾¹ç¼˜ä½†ä¿ç•™ç³»ç»Ÿ UI å¯è§æ€§
   */</span>
  SystemChrome.setEnabledSystemUIMode(SystemUiMode.edgeToEdge);
  runApp(<span class="hljs-function"><span class="hljs-keyword">const</span> <span class="hljs-title">MyApp</span>())</span>;
}
</code></pre>
<p>æ­¤çŠ¶æ€ä¸‹è‹¥æƒ³ä¿®æ”¹åº•éƒ¨æ§åˆ¶å™¨é¢œè‰²å¯é€šè¿‡ï¼š</p>
<pre><code class="hljs language-return" lang="return">  value: const SystemUiOverlayStyle(
    // åº•éƒ¨çŠ¶æ€æ é¢œè‰²
    systemNavigationBarColor: Colors.transparent,
  ),
  child: MaterialApp(
    title: 'Flutter Demo',
    theme: ThemeData(
      colorScheme: ColorScheme.fromSeed(seedColor: Colors.deepPurple),
    ),
    home: const MyHomePage(title: 'Flutter Demo Home Page'),
  ),
);````
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ruoyié›†æˆcamunda-å‰ç«¯ç¯‡]]></title>    <link>https://juejin.cn/post/7579142750408704026</link>    <guid>https://juejin.cn/post/7579142750408704026</guid>    <pubDate>2025-12-03T03:12:14.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7579142750408704026" data-draft-id="7579176524130549811" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ruoyié›†æˆcamunda-å‰ç«¯ç¯‡"/> <meta itemprop="keywords" content="å‰ç«¯"/> <meta itemprop="datePublished" content="2025-12-03T03:12:14.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ä»£ç æ¬¡ä½é¢"/> <meta itemprop="url" content="https://juejin.cn/user/1535333867720295"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ruoyié›†æˆcamunda-å‰ç«¯ç¯‡
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1535333867720295/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ä»£ç æ¬¡ä½é¢
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-03T03:12:14.000Z" title="Wed Dec 03 2025 03:12:14 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-03
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»3åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><strong>RuoYi-Vue</strong>Â æ˜¯ä¸€ä¸ª Java EE ä¼ä¸šçº§å¿«é€Ÿå¼€å‘å¹³å°ï¼ŒåŸºäºç»å…¸æŠ€æœ¯ç»„åˆï¼ˆSpring Bootã€Spring Securityã€MyBatisã€Jwtã€Vueï¼‰ï¼Œå†…ç½®æ¨¡å—å¦‚ï¼šéƒ¨é—¨ç®¡ç†ã€è§’è‰²ç”¨æˆ·ã€èœå•åŠæŒ‰é’®æˆæƒã€æ•°æ®æƒé™ã€ç³»ç»Ÿå‚æ•°ã€æ—¥å¿—ç®¡ç†ã€é€šçŸ¥å…¬å‘Šã€ä»£ç ç”Ÿæˆç­‰ã€‚åœ¨çº¿å®šæ—¶ä»»åŠ¡é…ç½®ï¼Œæ”¯æŒé›†ç¾¤ï¼Œæ”¯æŒå¤šæ•°æ®æºï¼Œæ”¯æŒåˆ†å¸ƒå¼äº‹åŠ¡ç­‰ã€‚</p>
<p>æœ¬æ–‡å°†è®²è§£ruoyiåˆ†ç¦»ç‰ˆçš„å‰ç«¯å¦‚ä½•é›†æˆcamundaåœ¨çº¿è®¾è®¡å™¨ï¼Œå®ç°æµç¨‹çš„å»ºæ¨¡ã€‚<br/>
æˆ‘ä»¬ä¹Ÿæœ‰ç½‘ç«™æä¾›ä¸€ç«™å¼è§£å†³æ–¹æ¡ˆï¼Œ è¯·ç›´æ¥è·³è½¬<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.ruoyiflow.com" target="_blank" title="https://www.ruoyiflow.com" ref="nofollow noopener noreferrer">è‹¥ä¾å·¥ä½œæµ</a></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e16d877445314268aa36ec33a9e20f7d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Luj56CB5qyh5L2N6Z2i:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765336334&amp;x-signature=vAeRPmrL2ZZENp2994m%2B2DkV8UM%3D" alt="ScreenShot_2025-12-03_110311_216.png" loading="lazy"/>
æœ¬æ–‡ä¸»è¦èšç„¦åœ¨RuoYi-Vue2å¦‚ä½•é›†æˆcamunda å®ç°bpmnåœ¨çº¿å»ºæ¨¡ã€‚</p>
<p>ç¯å¢ƒè¦æ±‚:</p>
<ul>
<li>JDK &gt;= 1.8</li>
<li>MySQL &gt;= 5.7</li>
<li>Maven &gt;= 3.0</li>
<li><strong>Node &gt;= 23ï¼ˆ nodeç‰ˆæœ¬ä½å°†å¯¼è‡´bpmn-jsç›¸å…³ä¾èµ–å®‰è£…å¤±è´¥!!!ï¼‰</strong></li>
<li>Redis &gt;= 3</li>
</ul>
<h3 data-id="heading-0">å®‰è£…æ­¥éª¤</h3>
<ul>
<li>é€šè¿‡vscodeæ‰“å¼€å‰ç«¯ä»£ç ï¼Œåœ¨æ§åˆ¶å°æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤</li>
</ul>
<pre><code class="hljs language-js" lang="js">npm install \Â  bpmn-js@<span class="hljs-number">18.6</span><span class="hljs-number">.2</span>Â \Â  bpmn-js-properties-panel@<span class="hljs-number">2.0</span><span class="hljs-number">.0</span>Â \Â  camunda-bpmn-moddle@<span class="hljs-number">7.0</span><span class="hljs-number">.1</span>Â \Â  bpmn-moddle@<span class="hljs-number">7.0</span><span class="hljs-number">.2</span>Â \Â Â @camunda/feel-builtins \Â  lezer-feel --save --registry=<span class="hljs-attr">https</span>:<span class="hljs-comment">//registry.npmmirror.comnpm install --saveÂ @bpmn-io/feel-lintÂ @bpmn-io/lezer-feel feelers Â  --registry=https://registry.npmmirror.comnpm install --save feelin --registry=https://registry.npmmirror.com// å»ºè®®ä¸è¦ç›´æ¥ä½¿ç”¨ cnpm å®‰è£…ä¾èµ–ï¼Œä¼šæœ‰å„ç§è¯¡å¼‚çš„ bugã€‚å¯ä»¥é€šè¿‡å¦‚ä¸‹æ“ä½œè§£å†³ npm ä¸‹è½½é€Ÿåº¦æ…¢çš„é—®é¢˜npm install --registry=https://registry.npmmirror.com</span>
</code></pre>
<ul>
<li>ç¼–è¾‘Â <code>vue.config.js</code>
å°†åŒ…åŠ å…¥ Babel è½¬è¯‘ï¼ˆè§£å†³ node_modules å†…éƒ¨ç°ä»£è¯­æ³•å¦‚å¯é€‰é“¾ï¼‰ï¼š</li>
</ul>
<pre><code class="hljs language-js" lang="js"><span class="hljs-attr">transpileDependencies</span>: [Â  Â Â <span class="hljs-string">'quill'</span>,Â <span class="hljs-string">'bpmn-js'</span>,Â <span class="hljs-string">'diagram-js'</span>,<span class="hljs-string">'bpmn-js-properties-panel'</span>,<span class="hljs-string">'@bpmn-io/properties-panel'</span>,<span class="hljs-string">'@bpmn-io/feel-editor'</span>,<span class="hljs-string">'@bpmn-io/feel-lint'</span>,Â <span class="hljs-string">'@bpmn-io/lezer-feel'</span>,Â <span class="hljs-string">'feelers'</span>,Â <span class="hljs-string">'lezer-feel'</span>],
</code></pre>
<p>å¢åŠ  aliasï¼ˆè§£å†³ Webpack 4 å¯¹ package.json exports/ESM è§£æä¸å®Œå–„çš„é—®é¢˜ï¼‰</p>
<pre><code class="hljs language-js" lang="js">
<span class="hljs-attr">resolve</span>: {Â Â <span class="hljs-attr">alias</span>: {Â  Â  Â  Â Â 
<span class="hljs-string">'@'</span>: <span class="hljs-title function_">resolve</span>(<span class="hljs-string">'src'</span>),Â  Â  Â  Â Â <span class="hljs-comment">// webpack4 ä¸è¯†åˆ« package.json exportsï¼Œæ‰‹åŠ¨æŒ‡å‘å…¥å£Â  </span>
<span class="hljs-string">'lezer-feel$'</span>: <span class="hljs-title function_">resolve</span>(<span class="hljs-string">'node_modules/lezer-feel/dist/index.js'</span>),Â  Â  Â  Â Â 
<span class="hljs-string">'@camunda/feel-builtins$'</span>: 
<span class="hljs-title function_">resolve</span>(<span class="hljs-string">'node_modules/@camunda/feel-builtins/dist/index.js'</span>),Â <span class="hljs-comment">// å°† FEEL ç›¸å…³åº“å›ºå®šåˆ°</span>
<span class="hljs-string">'feelers$'</span>: <span class="hljs-title function_">resolve</span>(<span class="hljs-string">'node_modules/feelers/dist/index.js'</span>),Â  Â  Â  Â Â 
<span class="hljs-string">'feelin$'</span>: <span class="hljs-title function_">resolve</span>(<span class="hljs-string">'node_modules/feelin/dist/index.cjs'</span>),Â  Â  Â  Â Â 
<span class="hljs-string">'@bpmn-io/feel-lint$'</span>: <span class="hljs-title function_">resolve</span>(<span class="hljs-string">'node_modules/@bpmn-io/feel-lint/dist/index.js'</span>),
<span class="hljs-string">'@bpmn-io/lezer-feel$'</span>: <span class="hljs-title function_">resolve</span>(<span class="hljs-string">'node_modules/@bpmn-io/lezer-feel/dist/index.js'</span>)Â  Â 
}}

</code></pre>
<ul>
<li>æ„å»ºæµ‹è¯•é¡µé¢
éœ€è¦æ‚¨é…ç½®å¥½èœå•</li>
</ul>
<pre><code class="hljs language-vue" lang="vue">&lt;template&gt;
  &lt;div class="bpmn-modeler-page"&gt;
    &lt;div class="toolbar"&gt;
      &lt;el-button size="middle" @click="handleOpen"&gt;å¯¼å…¥&lt;/el-button&gt;
      &lt;el-button size="middle" @click="downloadXML"&gt;å¯¼å‡ºXML&lt;/el-button&gt;
      &lt;el-button size="middle" @click="downloadSVG"&gt;å¯¼å‡ºSVG&lt;/el-button&gt;
      &lt;el-button type="primary" size="middle" @click="validateDiagram"&gt;æµç¨‹æ£€æŸ¥&lt;/el-button&gt;
      &lt;el-button type="success" size="middle" @click="deployDiagram"&gt;éƒ¨ç½²&lt;/el-button&gt;
      &lt;input ref="fileInputRef" type="file" accept=".bpmn,.xml" style="display:none" @change="onFileChange" /&gt;
    &lt;/div&gt;
    &lt;div class="modeler-wrap"&gt;
      &lt;div class="canvas" ref="canvasRef"&gt;&lt;/div&gt;
      &lt;div class="properties-panel" ref="propertiesRef"&gt;&lt;/div&gt;
    &lt;/div&gt;
  &lt;/div&gt;
&lt;/template&gt;

&lt;script setup&gt;
import { onMounted, onBeforeUnmount, ref } from 'vue'
import { ElMessage } from 'element-plus'
import BpmnModeler from 'bpmn-js/lib/Modeler'
import camundaBpmnModdle from 'camunda-bpmn-moddle/resources/camunda.json'
import { BpmnPropertiesPanelModule, BpmnPropertiesProviderModule, CamundaPlatformPropertiesProviderModule } from 'bpmn-js-properties-panel'
import 'bpmn-js-properties-panel/dist/assets/properties-panel.css'
import 'bpmn-js/dist/assets/diagram-js.css'
import 'bpmn-js/dist/assets/bpmn-js.css'
import 'bpmn-js/dist/assets/bpmn-font/css/bpmn-embedded.css'

const canvasRef = ref(null)
const propertiesRef = ref(null)
const fileInputRef = ref(null)
let modeler = null

function generateProcessId() {
  const rand = Math.random().toString(36).slice(2, 8)
  return `Process_${rand}`
}

const processId = ref(generateProcessId())

function buildDefaultXml(pid) {
  return `&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;bpmn:definitions xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:bpmn="http://www.omg.org/spec/BPMN/20100524/MODEL" xmlns:bpmndi="http://www.omg.org/spec/BPMN/20100524/DI" xmlns:dc="http://www.omg.org/spec/DD/20100524/DC" xmlns:di="http://www.omg.org/spec/DD/20100524/DI" xmlns:camunda="http://camunda.org/schema/1.0/bpmn" id="Definitions_1" targetNamespace="http://bpmn.io/schema/bpmn"&gt;
  &lt;bpmn:process id="${pid}" isExecutable="true"&gt;
    &lt;bpmn:startEvent id="StartEvent_1" /&gt;
  &lt;/bpmn:process&gt;
  &lt;bpmndi:BPMNDiagram id="BPMNDiagram_1"&gt;
    &lt;bpmndi:BPMNPlane id="BPMNPlane_1" bpmnElement="${pid}"&gt;
      &lt;bpmndi:BPMNShape id="_BPMNShape_StartEvent_2" bpmnElement="StartEvent_1"&gt;
        &lt;dc:Bounds x="180" y="180" width="36" height="36" /&gt;
      &lt;/bpmndi:BPMNShape&gt;
    &lt;/bpmndi:BPMNPlane&gt;
  &lt;/bpmndi:BPMNDiagram&gt;
&lt;/bpmn:definitions&gt;`
}

function initModeler() {
  if (modeler) return
  modeler = new BpmnModeler({
    container: canvasRef.value,
    propertiesPanel: {
      parent: propertiesRef.value
    },
    additionalModules: [
      BpmnPropertiesPanelModule,
      BpmnPropertiesProviderModule,
      CamundaPlatformPropertiesProviderModule
    ],
    moddleExtensions: {
      camunda: camundaBpmnModdle
    },
    keyboard: {
      bindTo: document
    }
  })
}

async function createNewDiagram() {
  try {
    await modeler.importXML(buildDefaultXml(processId.value))
    const canvas = modeler.get('canvas')
    canvas.zoom('fit-viewport')
    
    // è‡ªåŠ¨é€‰ä¸­å¼€å§‹äº‹ä»¶ä»¥æ˜¾ç¤ºå±æ€§é¢æ¿
    const elementRegistry = modeler.get('elementRegistry')
    const startEvent = elementRegistry.get('StartEvent_1')
    if (startEvent) {
      const selection = modeler.get('selection')
      selection.select(startEvent)
    }
  } catch (error) {
    console.error('åˆ›å»ºæ–°å›¾è¡¨å¤±è´¥:', error)
  }
}

function handleNew() {
  createNewDiagram()
}

function handleOpen() {
  fileInputRef.value &amp;&amp; fileInputRef.value.click()
}

function onFileChange(e) {
  const file = e.target.files &amp;&amp; e.target.files[0]
  if (!file) return
  const reader = new FileReader()
  reader.onload = async () =&gt; {
    try {
      await modeler.importXML(reader.result)
      modeler.get('canvas').zoom('fit-viewport')
    } catch (err) {
      console.error('å¯¼å…¥å¤±è´¥', err)
    } finally {
      e.target.value = ''
    }
  }
  reader.readAsText(file)
}

async function downloadXML() {
  try {
    const { xml } = await modeler.saveXML({ format: true })
    const blob = new Blob([xml], { type: 'application/xml' })
    const url = URL.createObjectURL(blob)
    const a = document.createElement('a')
    a.href = url
    a.download = 'diagram.bpmn'
    a.click()
    URL.revokeObjectURL(url)
  } catch (err) {
    console.error('å¯¼å‡ºXMLå¤±è´¥', err)
  }
}

async function downloadSVG() {
  try {
    const { svg } = await modeler.saveSVG()
    const blob = new Blob([svg], { type: 'image/svg+xml' })
    const url = URL.createObjectURL(blob)
    const a = document.createElement('a')
    a.href = url
    a.download = 'diagram.svg'
    a.click()
    URL.revokeObjectURL(url)
  } catch (err) {
    console.error('å¯¼å‡ºSVGå¤±è´¥', err)
  }
}

function validateDiagram() {
  try {
    const elementRegistry = modeler.get('elementRegistry')
    const processes = elementRegistry.filter(e =&gt; e.type === 'bpmn:Process')
    if (!processes.length) {
      ElMessage.error('æœªæ‰¾åˆ°æµç¨‹å®šä¹‰ (bpmn:Process)')
      return
    }
    const startEvents = elementRegistry.filter(e =&gt; e.type === 'bpmn:StartEvent')
    if (!startEvents.length) {
      ElMessage.error('æµç¨‹ç¼ºå°‘å¼€å§‹äº‹ä»¶')
      return
    }
    ElMessage.success('æµç¨‹æ£€æŸ¥é€šè¿‡')
  } catch (e) {
    console.error(e)
    ElMessage.error('æµç¨‹æ£€æŸ¥å¤±è´¥')
  }
}

async function deployDiagram() {
  try {
    const { xml } = await modeler.saveXML({ format: true })
    const blob = new Blob([xml], { type: 'application/xml' })
    const url = URL.createObjectURL(blob)
    const a = document.createElement('a')
    a.href = url
    a.download = `${processId.value}.bpmn`
    a.click()
    URL.revokeObjectURL(url)
    ElMessage.success('å·²æ‰“åŒ…æµç¨‹XMLï¼ˆè¯·æ¥å…¥åç«¯éƒ¨ç½²æ¥å£ï¼‰')
  } catch (e) {
    console.error(e)
    ElMessage.error('éƒ¨ç½²æ‰“åŒ…å¤±è´¥')
  }
}

onMounted(async () =&gt; {
  try {
    initModeler()
    await createNewDiagram()
  } catch (error) {
    console.error('åˆå§‹åŒ–æ¨¡å‹å™¨å¤±è´¥:', error)
  }
})

onBeforeUnmount(() =&gt; {
  if (modeler) {
    modeler.destroy()
    modeler = null
  }
})
&lt;/script&gt;

&lt;style scoped&gt;
.bpmn-modeler-page {
  display: flex;
  flex-direction: column;
  height: 100%;
}
.toolbar {
  padding: 8px;
  border-bottom: 1px solid var(--el-border-color);
}
.modeler-wrap {
  display: flex;
  flex: 1;
  min-height: 0;
}
.canvas {
  flex: 1;
  height: calc(100vh - 120px);
}
.properties-panel {
  width: 360px;
  border-left: 1px solid var(--el-border-color);
  height: calc(100vh - 120px);
  overflow: auto;
}
/* bpmn-js core styles (containers) */
:deep(.djs-container) {
  width: 100%;
  height: 100%;
}

/* å±æ€§é¢æ¿æ ·å¼è°ƒæ•´ */
:deep(.bio-properties-panel) {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
}

:deep(.bio-properties-panel .bio-properties-panel-group-header) {
  background: #f5f5f5;
  border-bottom: 1px solid #e0e0e0;
}

:deep(.bio-properties-panel .bio-properties-panel-entry) {
  border-bottom: 1px solid #f0f0f0;
}

&lt;/style&gt;
</code></pre>
<ul>
<li>æœ€ç»ˆç»“æœ</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9e26eb411aac403d808167f544394c25~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Luj56CB5qyh5L2N6Z2i:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765336334&amp;x-signature=FAlH%2BgbrlVBN3QfpMlEPOsmEb7Y%3D" alt="1.png" loading="lazy"/></p>
<p>å¦‚æœæ‚¨æƒ³åœ¨è‡ªå·±çš„ruoyié¡¹ç›®é›†æˆå·¥ä½œæµï¼Œ æˆ‘ä»¬æä¾›ä¸€ç«™å¼è§£å†³æ–¹æ¡ˆï¼Œ<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.ruoyiflow.com" target="_blank" title="https://www.ruoyiflow.com" ref="nofollow noopener noreferrer">ruoyiflow</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[å¦‚ä½•é€šè¿‡æŠ“åŒ…å·¥å…·å¿«é€Ÿç”Ÿæˆ Apifox æ¥å£æ–‡æ¡£ï¼Ÿ]]></title>    <link>https://juejin.cn/post/7579179625461432362</link>    <guid>https://juejin.cn/post/7579179625461432362</guid>    <pubDate>2025-12-03T03:13:14.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7579179625461432362" data-draft-id="7579123072827064339" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="å¦‚ä½•é€šè¿‡æŠ“åŒ…å·¥å…·å¿«é€Ÿç”Ÿæˆ Apifox æ¥å£æ–‡æ¡£ï¼Ÿ"/> <meta itemprop="keywords" content="å‰ç«¯,åç«¯,æµ‹è¯•"/> <meta itemprop="datePublished" content="2025-12-03T03:13:14.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Apifox"/> <meta itemprop="url" content="https://juejin.cn/user/2766843870448222"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            å¦‚ä½•é€šè¿‡æŠ“åŒ…å·¥å…·å¿«é€Ÿç”Ÿæˆ Apifox æ¥å£æ–‡æ¡£ï¼Ÿ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2766843870448222/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Apifox
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-03T03:13:14.000Z" title="Wed Dec 03 2025 03:13:14 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-03
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»5åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>Apifox ä½œä¸º API åä½œä¸ç®¡ç†å¹³å°ï¼Œæ”¯æŒå¯¼å…¥å„ç§æ ¼å¼çš„æ¥å£æ•°æ®ã€‚æ— è®ºæ˜¯ OpenAPI/Swaggerã€Postman Collectionã€HAR æ–‡ä»¶ï¼Œè¿˜æ˜¯ cURL å‘½ä»¤ï¼ŒåŸºæœ¬ä¸Šä¸»æµçš„æ¥å£æ•°æ®æ ¼å¼éƒ½èƒ½ç›´æ¥å¯¼å…¥ã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0def7c0337d941f2b3d8a1485257afda~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQXBpZm94:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765336394&amp;x-signature=0t9SiESeElfM633N%2BRzEf6JeUDc%3D" alt="" loading="lazy"/></p>
<p>ä¸è¿‡åœ¨è®¸å¤šå®é™…é¡¹ç›®ä¸­ï¼Œæœ€å¤§çš„é—®é¢˜å¾€å¾€ä¸æ˜¯æ€ä¹ˆå¯¼å…¥æ¥å£æ•°æ®ï¼Œè€Œæ˜¯æ²¡æœ‰ç°æˆçš„æ¥å£æ•°æ®å¯ä¾› Apifox å¯¼å…¥ã€‚ä¸€äº›è€é¡¹ç›®å¯èƒ½ä»æœªç»´æŠ¤è¿‡æ¥å£æ–‡æ¡£ï¼Œä¹Ÿæ²¡æœ‰ OpenAPI/Swagger æ–‡æ¡£å¯ç”¨ã€‚</p>
<p>è¿™æ—¶å€™ï¼Œå¦‚æœæƒ³è¦å¿«é€Ÿè¡¥é½é¡¹ç›®ç¼ºå¤±çš„æ¥å£æ–‡æ¡£ï¼Œæˆ–è€…ç”Ÿæˆæµ‹è¯•ç”¨ä¾‹ï¼Œè®©æµ‹è¯•äººå‘˜èƒ½å¤ŸåŸºäºçœŸå®æ•°æ®å¿«é€Ÿèµ·æ­¥ã€‚é‚£ä¹ˆé€šè¿‡æµé‡å½•åˆ¶ï¼ˆæŠ“åŒ…ï¼‰å·¥å…·æ¥è·å–æ¥å£æ•°æ®ï¼Œåº”å½“æ˜¯æœ€å¿«æ·çš„è§£å†³æ–¹æ¡ˆã€‚</p>
<p>é€šè¿‡æŠ“åŒ…å·¥å…·å½•åˆ¶åº”ç”¨çš„ HTTP/HTTPS æµé‡ï¼Œç­›é€‰åå¯¼å‡º HAR æˆ– cURL æ ¼å¼çš„æ–‡ä»¶ï¼Œå†å¯¼å…¥ Apifoxï¼Œå°±å¯ä»¥å¿«é€Ÿç”Ÿæˆæ¥å£æ–‡æ¡£ï¼Œä¸ºåç»­çš„æ¥å£æµ‹è¯•æä¾›åŸºç¡€ã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d07932df8f0548d0a4308749d7e69a00~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQXBpZm94:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765336394&amp;x-signature=Z6CO7kLZ7OzlH5%2FfOjGvHL6QL1Q%3D" alt="" loading="lazy"/></p>
<p>å¯ä»¥è¿›è¡Œæµé‡å½•åˆ¶çš„å·¥å…·æœ‰å¾ˆå¤šï¼Œæœ¬æ–‡ä»¥ Charles Proxy ä¸ºä¾‹æ¥æ¼”ç¤ºå…·ä½“æ“ä½œï¼Œä½ ä¹Ÿå¯ä»¥ä½¿ç”¨ Proxymanã€Fiddler ç­‰ï¼Œæˆ–è€…ç›´æ¥ä½¿ç”¨æµè§ˆå™¨è‡ªå¸¦çš„å¼€å‘è€…å·¥å…·è¿›è¡ŒæŠ“åŒ…ï¼Œæ ¸å¿ƒæµç¨‹å¤§åŒå°å¼‚ã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/094c57f24059409f978091a1b0a82f3c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQXBpZm94:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765336394&amp;x-signature=1VLVCJgVGKEBEXWniIp%2FNs8A3pI%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-0">Charles å®‰è£…ä¸åŸºç¡€é…ç½®</h2>
<p>Charles æä¾› 30 å¤©å…è´¹è¯•ç”¨ï¼Œä½ å¯ä»¥ä»å®˜ç½‘ä¸‹è½½æœ€æ–°ç‰ˆæœ¬æ¥å®‰è£…ã€‚</p>
<p>é¦–æ¬¡å¯åŠ¨ Charles æ—¶ï¼Œå¯èƒ½ä¼šè¯¢é—®æ˜¯å¦è‡ªåŠ¨é…ç½®ç³»ç»Ÿä»£ç†ã€‚å»ºè®®é€‰æ‹©ã€ŒGrant Privilegesã€æˆäºˆæƒé™å³å¯ï¼Œè¿™æ · Charles å°±èƒ½è‡ªåŠ¨æ•è·ç³»ç»Ÿçš„ HTTP æµé‡äº†ã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/92e8c0040d8945dda744748356b4e9b7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQXBpZm94:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765336394&amp;x-signature=8aHlrQc0X9BXI7kcbekkqCFYiqA%3D" alt="" loading="lazy"/></p>
<p>ä¸ºäº†èƒ½å¤ŸæŠ“å– HTTPS æµé‡ï¼Œéœ€è¦å®‰è£… Charles çš„æ ¹è¯ä¹¦ã€‚ç‚¹å‡»èœå•æ çš„ ã€ŒHelp â†’ SSL Proxying â†’ Install Charles Root Certificateã€ï¼ŒmacOS ç³»ç»Ÿä¼šæ‰“å¼€é’¥åŒ™ä¸²è®¿é—®åº”ç”¨ï¼Œæœç´¢å¹¶æ‰¾åˆ° Charles Proxy è¯ä¹¦ï¼ŒåŒå‡»åå°†ä¿¡ä»»è®¾ç½®æ”¹ä¸º â€œå§‹ç»ˆä¿¡ä»»â€ å³å¯ã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/41b8f48665f34a4d9e8536aaf2c76ee5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQXBpZm94:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765336394&amp;x-signature=Rc7jGw06MaqhsQAVZPjNyvSvKto%3D" alt="" loading="lazy"/></p>
<p>Windows ç³»ç»Ÿéœ€è¦åœ¨å®‰è£…è¯ä¹¦æ—¶å®‰è£…åˆ° â€œå—ä¿¡ä»»çš„æ ¹è¯ä¹¦é¢å‘æœºæ„â€ å­˜å‚¨åŒºã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/65053b85bbe84c7b94de59965d4ddb61~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQXBpZm94:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765336394&amp;x-signature=wY69%2Bu%2BcGBsN1oowD5C408vOXB4%3D" alt="" loading="lazy"/></p>
<p>è¯ä¹¦å®‰è£…åï¼Œæ¥ç€å¯ç”¨ SSL ä»£ç†ã€‚åœ¨ Charles èœå•æ é€‰æ‹© Proxy â†’ SSL Proxying Settingsï¼Œå‹¾é€‰ â€œEnable SSL Proxyingâ€ é€‰é¡¹ã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cf6e65a0f7e949cf88a10ee878795421~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQXBpZm94:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765336394&amp;x-signature=1hk2tBuXSeYiRwUL9jFU14GrxFE%3D" alt="" loading="lazy"/></p>
<p>åœ¨åˆ—è¡¨ä¸­æ·»åŠ éœ€è¦æŠ“å–çš„åŸŸåï¼ˆHostï¼‰å’Œç«¯å£ï¼ˆPort 443ï¼‰ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ <code>*</code> ç›‘å¬æ‰€æœ‰åŸŸåã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b8079b0643ad470893bf3a7c962926ef~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQXBpZm94:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765336394&amp;x-signature=u0lYI0e36TJN6dy%2Fd4nKff%2FLrXs%3D" alt="" loading="lazy"/></p>
<p>é…ç½®å®Œæˆåï¼ŒCharles å°±å¯ä»¥æ•è·å®Œæ•´çš„ HTTP/HTTPS è¯·æ±‚å’Œå“åº”äº†ã€‚</p>
<p>å¦‚æœä½ ä¸æ¸…æ¥šåº”ç”¨å…·ä½“ä½¿ç”¨äº†å“ªäº›åŸŸåï¼Œå¯ä»¥å…ˆéšä¾¿æ“ä½œåº”ç”¨ï¼Œå†è§‚å¯Ÿ Charles ä¼šè¯åˆ—è¡¨ä¸­ â€œEncryptedâ€ ä¸‹çš„è¯·æ±‚ï¼Œè®°ä¸‹å¯¹åº”çš„åŸŸååï¼Œå†æŠŠå®ƒä»¬æ·»åŠ åˆ° Charles çš„ SSL ä»£ç†è®¾ç½®é‡Œå³å¯ã€‚</p>
<h2 data-id="heading-1">å½•åˆ¶åº”ç”¨çš„ API æµé‡</h2>
<p>å¯åŠ¨éœ€è¦åˆ†æçš„åº”ç”¨æˆ–è€…ç½‘é¡µï¼Œæ“ä½œå„ç§åŠŸèƒ½ï¼Œå¦‚ç™»å½•ã€æŸ¥è¯¢æ•°æ®ã€æäº¤è¡¨å•æˆ–ä¸Šä¼ æ–‡ä»¶ã€‚Charles å·¦ä¾§ä¼šè¯æ ‘ä¼šå®æ—¶æ›´æ–°è¯·æ±‚ï¼ŒæŒ‰åŸŸåå’Œ URL åˆ†ç»„ã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e54e235816b74c7782cf0b965727c7b2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQXBpZm94:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765336394&amp;x-signature=VYG7lDQL6imvFJ7Hmod1sVkLlJQ%3D" alt="" loading="lazy"/></p>
<p>é€‰ä¸­æŸä¸ªå…·ä½“çš„è¯·æ±‚åï¼Œå³ä¾§é¢æ¿ä¼šæ˜¾ç¤ºè¯·æ±‚çš„åŸºæœ¬ä¿¡æ¯å’Œå“åº”å†…å®¹ã€‚Contents é€‰é¡¹å¡é‡Œä¼šå°† JSON ç­‰å“åº”æŠ˜å æˆæ ‘çŠ¶ç»“æ„ï¼Œæ–¹ä¾¿å¿«é€Ÿç†è§£æ•°æ®ç»“æ„å’Œå­—æ®µã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/69f55db376f94e879fd5658bd079cd0a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQXBpZm94:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765336394&amp;x-signature=U0F9jDEYkVjapS1GM8wsbvyrD%2BQ%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-2">ç­›é€‰å’Œå¯¼å‡ºæ¥å£</h2>
<p>å½•åˆ¶å®Œæˆåï¼Œä½ å¯èƒ½ä¼šå‘ç°æ•è·åˆ°çš„è¯·æ±‚éå¸¸å¤šã€‚é™¤äº†çœŸæ­£çš„ API æ¥å£è°ƒç”¨ï¼Œè¿˜æœ‰å„ç§é™æ€èµ„æºè¯·æ±‚ã€ç¬¬ä¸‰æ–¹æœåŠ¡è°ƒç”¨ç­‰ç­‰ã€‚è¿™æ—¶å€™éœ€è¦è¿›è¡Œç­›é€‰ï¼Œåªä¿ç•™æˆ‘ä»¬å…³å¿ƒçš„æ¥å£ã€‚</p>
<p>ä½ å¯ä»¥å³é”®ç‚¹å‡»åŸŸåæˆ–è·¯å¾„ï¼Œé€‰æ‹© â€œFocusâ€ï¼ŒCharles ä¼šåªä¿ç•™è¯¥èŠ‚ç‚¹ä¸‹çš„è¯·æ±‚ã€‚æ–¹ä¾¿ä¸“æ³¨åˆ†æã€‚å¯¹äºæ— å…³è¯·æ±‚ï¼Œå¯å³é”®é€‰æ‹© â€œClearâ€ æ¸…é™¤ï¼Œæˆ–å¤šé€‰åæ‰¹é‡åˆ é™¤ã€‚å¦‚æœé‡åˆ°ç¼“å­˜å¯¼è‡´ HTML æˆ– JSON æœªæ­£å¸¸å±•ç¤ºï¼Œä¹Ÿå¯ä»¥å³é”®é€‰æ‹© â€œNo Cachingâ€ï¼Œè®© Charles åœ¨åç»­è¯·æ±‚ä¸­å¿½ç•¥ç¼“å­˜ï¼Œä»è€ŒæŠ“åˆ°å®Œæ•´çš„å“åº”å†…å®¹ã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1b8d714537994360b228324519f60d26~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQXBpZm94:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765336394&amp;x-signature=n6RGDJEGqKFj%2FMwcsvfchOZWU0s%3D" alt="" loading="lazy"/></p>
<p>ç­›é€‰å®Œæˆåï¼Œé€‰ä¸­ä½ è¦å¯¼å‡ºçš„ä¼šè¯ï¼ˆå¯ä»¥é€‰æ‹©æ•´ä¸ªåŸŸåèŠ‚ç‚¹ï¼Œæˆ–è€…æŒ‰ä½ Cmd/Ctrl é”®å¤šé€‰å…·ä½“çš„è¯·æ±‚ï¼‰ï¼Œç„¶ååœ¨èœå•æ é€‰æ‹© File â†’ Export Sessionã€‚åœ¨å¯¼å‡ºå¯¹è¯æ¡†ä¸­ï¼Œé€‰æ‹© â€œHTTP Archive (.har)â€ æ ¼å¼å¯¼å‡º HAR æ–‡ä»¶ã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/37da0578a9744730bf8d428d5f30433c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQXBpZm94:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765336394&amp;x-signature=xTwAVAYyfdvlUVVLl0v3Crrqv7g%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-3">å¯¼å…¥ Apifox è‡ªåŠ¨ç”Ÿæˆæ¥å£æ–‡æ¡£</h2>
<p>æ‰“å¼€ Apifox å®¢æˆ·ç«¯ï¼Œè¿›å…¥â€œé¡¹ç›®è®¾ç½® â†’ å¯¼å…¥æ•°æ® â†’ .har æ–‡ä»¶â€ï¼Œé€‰æ‹©å¯¼å‡ºçš„ HAR æ–‡ä»¶ã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3d13c0b0e5f341b1a05f0296d8d5a720~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQXBpZm94:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765336394&amp;x-signature=d%2BQQw67dpjTx%2FTrDSP4w9rnSFEU%3D" alt="" loading="lazy"/></p>
<p>Apifox ä¼šè‡ªåŠ¨è§£ææ–‡ä»¶å†…å®¹ï¼Œåœ¨é¢„è§ˆåŒºåŸŸæ˜¾ç¤ºæ£€æµ‹åˆ°çš„æ¥å£ä¿¡æ¯ï¼ŒåŒ…æ‹¬æ¥å£æ•°é‡ã€è¯·æ±‚æ–¹æ³•ç­‰ã€‚å¯¼å…¥è¿‡ç¨‹ä¸­å¯ä»¥é…ç½®é€‰é¡¹ï¼Œä¾‹å¦‚å¯¼å…¥åˆ°å“ªä¸ªæ¨¡å—æˆ–æ˜¯å¦è¦†ç›–å·²æœ‰æ¥å£ã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/701dfcaa19cd4eb7b28c61c19da9bb26~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQXBpZm94:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765336394&amp;x-signature=yI%2BpZE7zm5nqRgCiBwi0V4wiYOM%3D" alt="" loading="lazy"/></p>
<p>å¯¼å…¥å®Œæˆåï¼Œå°±å¯ä»¥åœ¨å¯¹åº”æ¨¡å—çš„æ¥å£åˆ—è¡¨é‡ŒæŸ¥çœ‹äº†ã€‚</p>
<h2 data-id="heading-4">å®Œå–„å’Œä¼˜åŒ–æ¥å£æ–‡æ¡£</h2>
<p>ä¸ºäº†ç¨³å¦¥ä¸€äº›ï¼Œè‡ªåŠ¨ç”Ÿæˆçš„æ¥å£æ–‡æ¡£é€šå¸¸éœ€è¦è¿›ä¸€æ­¥è°ƒæ•´ï¼Œæ¯”å¦‚å®Œå–„æ¥å£åç§°ã€è¡¥å……ä¸€äº›å‚æ•°åŠå…¶æè¿°ã€å®Œå–„å“åº”æ•°æ®ç»“æ„ï¼Œç¡®ä¿æ–‡æ¡£ç¬¦åˆä¸šåŠ¡éœ€æ±‚ã€‚</p>
<p>å¦‚æœæ¥å£éœ€è¦æˆæƒï¼Œä¹Ÿè¯·åœ¨ Apifox çš„<a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.apifox.com%2Fenvironments-and-variables" target="_blank" title="https://docs.apifox.com/environments-and-variables" ref="nofollow noopener noreferrer">ç¯å¢ƒå˜é‡</a>æˆ–Â <a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.apifox.com%2F5802184m0" target="_blank" title="https://docs.apifox.com/5802184m0" ref="nofollow noopener noreferrer">Auth è®¾ç½®</a>ä¸­é…ç½®ç›¸åº”ä¿¡æ¯ã€‚</p>
<hr/>
<p>é€šè¿‡æŠ“åŒ…å·¥å…·å½•åˆ¶ HTTP/HTTPS æµé‡ï¼Œå†å¯¼å…¥ Apifoxï¼Œå¯ä»¥å¿«é€Ÿç”Ÿæˆæ¥å£æ–‡æ¡£å¹¶ä¸ºæµ‹è¯•æä¾›çœŸå®æ•°æ®æ”¯æŒã€‚</p>
<p>æ— è®ºæ˜¯æµè§ˆå™¨ã€æ¡Œé¢å®¢æˆ·ç«¯è¿˜æ˜¯ç§»åŠ¨åº”ç”¨ï¼Œè¿™ç§æ–¹æ³•éƒ½èƒ½ç¼©çŸ­æ¥å£æ–‡æ¡£çš„å‡†å¤‡æ—¶é—´ï¼Œè®©å›¢é˜Ÿå¿«é€Ÿä¸Šæ‰‹æ¥å£æµ‹è¯•ä¸å¼€å‘ã€‚</p>
<p>æ¬¢è¿å„ä½ç”¨æˆ·å¯¹ Apifox ç»§ç»­æå‡ºä½¿ç”¨åé¦ˆå’Œä¼˜åŒ–æ„è§ï¼Œæˆ‘ä»¬ä¼šæŒç»­ä¼˜åŒ–æ›´æ–°ï¼Œè‡´åŠ›äºä¸ºç”¨æˆ·æä¾›æ›´ä¼˜ç§€çš„äº§å“åŠŸèƒ½å’Œæ›´æè‡´çš„ä½¿ç”¨ä½“éªŒï¼</p>
<p><strong><strong>æœ‰ä»»ä½•é—®é¢˜æ¬¢è¿åœ¨</strong></strong><a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.apifox.com%2Fdoc-5751209%23%25E7%2594%25A8%25E6%2588%25B7%25E7%25BE%25A4%2F" target="_blank" title="https://docs.apifox.com/doc-5751209#%E7%94%A8%E6%88%B7%E7%BE%A4/" ref="nofollow noopener noreferrer"> <strong><strong>Apifox ç”¨æˆ·ç¾¤</strong></strong></a><strong><strong>ä¸æˆ‘ä»¬äº¤æµæ²Ÿé€š</strong>ï¼</strong></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[äº‘ä¸Šæ•°æ®å®‰å…¨æ–°èŒƒå¼ï¼šApache Doris IAM Assume Role è§£é”æ— å¯†é’¥è®¿é—® AWS S3 æ•°æ®]]></title>    <link>https://juejin.cn/post/7579192114828148763</link>    <guid>https://juejin.cn/post/7579192114828148763</guid>    <pubDate>2025-12-03T03:31:03.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7579192114828148763" data-draft-id="7579167622106169344" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="äº‘ä¸Šæ•°æ®å®‰å…¨æ–°èŒƒå¼ï¼šApache Doris IAM Assume Role è§£é”æ— å¯†é’¥è®¿é—® AWS S3 æ•°æ®"/> <meta itemprop="keywords" content="æ•°æ®åº“"/> <meta itemprop="datePublished" content="2025-12-03T03:31:03.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="SelectDB"/> <meta itemprop="url" content="https://juejin.cn/user/3189021726222904"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            äº‘ä¸Šæ•°æ®å®‰å…¨æ–°èŒƒå¼ï¼šApache Doris IAM Assume Role è§£é”æ— å¯†é’¥è®¿é—® AWS S3 æ•°æ®
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3189021726222904/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    SelectDB
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-03T03:31:03.000Z" title="Wed Dec 03 2025 03:31:03 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-03
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»4åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h3 data-id="heading-0">ä¸€ã€ä¼ ç»Ÿ AK/SK æ–¹å¼è®¿é—® AWS èµ„æºå­˜åœ¨çš„é—®é¢˜</h3>
<p><strong>å¯†é’¥ç®¡ç†å›°å¢ƒï¼š</strong></p>
<ul>
<li><strong>é•¿æœŸæš´éœ²é£é™©</strong>ï¼šé™æ€ AK/SK éœ€ç¡¬ç¼–ç äºé…ç½®æ–‡ä»¶ä¸­ï¼Œä¸€æ—¦å› ä»£ç æ³„éœ²ã€è¯¯æäº¤æˆ–æ¶æ„çªƒå–å¯¼è‡´å¯†é’¥æ‰©æ•£ï¼Œæ”»å‡»è€…å¯æ°¸ä¹…è·å¾—ç­‰åŒäºå¯†é’¥æ‰€æœ‰è€…çš„å®Œæ•´æƒé™ï¼Œå¼•å‘æŒç»­æ€§çš„æ•°æ®æ³„éœ²ã€èµ„æºç¯¡æ”¹åŠèµ„é‡‘æŸå¤±é£é™©ï¼›</li>
<li><strong>å®¡è®¡ç›²åŒº</strong>ï¼š å¤šç”¨æˆ·/å¤šæœåŠ¡å…±äº«åŒä¸€ç»„å¯†é’¥æ—¶ï¼Œäº‘æ“ä½œæ—¥å¿—ä»…è®°å½•å¯†é’¥èº«ä»½è€Œæ— æ³•å…³è”å…·ä½“ä½¿ç”¨è€…ï¼Œæ— æ³•è¿½æº¯çœŸå®è´£ä»»äººæˆ–ä¸šåŠ¡æ¨¡å—ï¼›</li>
<li><strong>è¿ç»´æˆæœ¬é«˜</strong>ï¼šå¯†é’¥è½®æ¢ç¾éš¾ï¼Œéœ€æ‰‹åŠ¨è½®æ¢ä¸šåŠ¡æ¨¡å—å¯†é’¥ï¼Œå®¹æ˜“å‡ºé”™è§¦å‘æœåŠ¡ä¸­æ–­ï¼›</li>
<li><strong>æƒé™ç®¡ç†å¤±æ§</strong>ï¼šè´¦æˆ·ç®¡ç†ä¸æ¸…æ™°ï¼Œæˆæƒæ— æ³•æ»¡è¶³æœåŠ¡/å®ä¾‹çº§çš„æœ€å°æƒé™ç®¡æ§éœ€æ±‚ã€‚</li>
</ul>
<h3 data-id="heading-1">äºŒã€AWS IAM Assume Role æœºåˆ¶ä»‹ç»</h3>
<p>AWS Assume Role æ˜¯ä¸€ç§å®‰å…¨èº«ä»½åˆ‡æ¢æœºåˆ¶ï¼Œå…è®¸ä¸€ä¸ªå¯ä¿¡å®ä½“ï¼ˆå¦‚ IAM ç”¨æˆ·ã€EC2 å®ä¾‹æˆ–å¤–éƒ¨è´¦å·ï¼‰é€šè¿‡ STSï¼ˆå®‰å…¨ä»¤ç‰ŒæœåŠ¡ï¼‰ä¸´æ—¶è·å–ç›®æ ‡è§’è‰²çš„æƒé™ã€‚å…¶è¿ä½œæµç¨‹å¦‚ä¸‹ï¼š</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2c09a6c99cab4d95a469154b19892dac~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgU2VsZWN0REI=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765337462&amp;x-signature=yWWAq%2F%2FA52DrR95Y5k%2F6gD%2F7Avc%3D" alt="äºŒã€AWS IAM Assume Role æœºåˆ¶ä»‹ç».PNG" loading="lazy"/></p>
<p><strong>ä½¿ç”¨ AWS IAM Assume Role æ–¹å¼è®¿é—®çš„ä¼˜ç‚¹ï¼š</strong></p>
<ul>
<li>åŠ¨æ€ä»¤ç‰Œæœºåˆ¶ï¼ˆ15 åˆ†é’Ÿï½12 å°æ—¶æœ‰æ•ˆæœŸï¼‰æ›¿ä»£æ°¸ä¹…å¯†é’¥</li>
<li>é€šè¿‡<code>External ID</code>å®ç°è·¨è´¦å·å®‰å…¨éš”ç¦»ï¼Œå¹¶ä¸”å¯é€šè¿‡ AWS åå°æœåŠ¡è¿›è¡Œå®¡è®¡</li>
<li>åŸºäºè§’è‰²çš„æœ€å°æƒé™åŸåˆ™ï¼ˆPrinciple of Least Privilegeï¼‰</li>
</ul>
<p><strong>AWS IAM Assume Role è®¿é—® S3 Bucket çš„é‰´æƒè¿‡ç¨‹ï¼š</strong></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4f88cb77b6794d15b72d31fc202a1dff~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgU2VsZWN0REI=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765337462&amp;x-signature=tX3RTuyX9ewuzWnnqzy1h7xN4eQ%3D" alt="äºŒã€AWS IAM Assume Role æœºåˆ¶ä»‹ç»-1.PNG" loading="lazy"/></p>
<h4 data-id="heading-2">é˜¶æ®µ 1ï¼šæºç”¨æˆ·èº«ä»½éªŒè¯</h4>
<ol>
<li>æƒé™ç­–ç•¥æ£€æŸ¥
<ol>
<li>æºç”¨æˆ·å‘èµ· <code>AssumeRole</code> è¯·æ±‚æ—¶ï¼Œæºè´¦æˆ·çš„ IAM ç­–ç•¥å¼•æ“é¦–å…ˆéªŒè¯ï¼š <code>è¯¥ç”¨æˆ·æ˜¯å¦è¢«æˆæƒè°ƒç”¨ sts:AssumeRole æ“ä½œï¼Ÿ</code></li>
<li>æ£€æŸ¥ä¾æ®ï¼šé™„ç€åœ¨æºç”¨æˆ·èº«ä»½ä¸Šçš„ IAM Permissions Policies</li>
</ol>
</li>
<li>ä¿¡ä»»å…³ç³»æ ¡éªŒ
<ol>
<li>é€šè¿‡ STS æœåŠ¡å‘ç›®æ ‡è´¦æˆ·å‘èµ·è¯·æ±‚ï¼š <code>æºç”¨æˆ·æ˜¯å¦åœ¨ç›®æ ‡è§’è‰²çš„ä¿¡ä»»ç­–ç•¥ç™½åå•ä¸­ï¼Ÿ</code></li>
<li>æ£€æŸ¥ä¾æ®ï¼šç›®æ ‡è§’è‰²ç»‘å®šçš„ IAM Trust Relationships Policiesï¼ˆæ˜ç¡®å…è®¸å“ªäº›è´¦å·/ç”¨æˆ·æ‹…ä»»è¯¥è§’è‰²ï¼‰</li>
</ol>
</li>
</ol>
<h4 data-id="heading-3">é˜¶æ®µ 2ï¼šç›®æ ‡è§’è‰²æƒé™æ¿€æ´»</h4>
<ol>
<li>ä¸´æ—¶å‡­è¯ç”Ÿæˆ
<ol>
<li>è‹¥ä¿¡ä»»å…³ç³»éªŒè¯é€šè¿‡ï¼ŒSTS ç”Ÿæˆä¸‰è¦ç´ ä¸´æ—¶å‡­è¯</li>
<li>
<pre><code class="hljs language-JSON" lang="JSON"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"AccessKeyId"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"ASIA***"</span><span class="hljs-punctuation">,</span>  
  <span class="hljs-attr">"SecretAccessKey"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"***"</span><span class="hljs-punctuation">,</span>  
  <span class="hljs-attr">"SessionToken"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"***"</span> <span class="hljs-comment">// æœ‰æ•ˆæœŸ 15min-12h</span>
<span class="hljs-punctuation">}</span>
</code></pre>
</li>
</ol>
</li>
<li>ç›®æ ‡è§’è‰²æƒé™éªŒè¯
<ol>
<li>ç›®æ ‡è§’è‰²ä½¿ç”¨ä¸´æ—¶å‡­è¯è®¿é—® AWS S3 å‰ï¼Œç›®æ ‡è´¦æˆ·çš„ IAM ç­–ç•¥å¼•æ“æ ¡éªŒï¼š <code>è¯¥è§’è‰²æ˜¯å¦è¢«æˆæƒæ‰§è¡Œè¯·æ±‚çš„S3æ“ä½œï¼Ÿ (å¦‚s3:GetObjectã€s3:PutObjectç­‰)</code></li>
<li>æ£€æŸ¥ä¾æ®ï¼šé™„ç€åœ¨ç›®æ ‡è§’è‰²ä¸Šçš„ IAM Permissions Policiesï¼ˆå®šä¹‰è§’è‰²èƒ½åšä»€ä¹ˆï¼‰</li>
</ol>
</li>
</ol>
<h4 data-id="heading-4">é˜¶æ®µ 3ï¼šèµ„æºæ“ä½œæ‰§è¡Œ</h4>
<ol>
<li>è®¿é—®å­˜å‚¨æ¡¶
<ol>
<li>å…¨éƒ¨éªŒè¯é€šè¿‡åï¼Œç›®æ ‡è§’è‰²æ‰å¯æ‰§è¡Œ S3 API æ“ä½œã€‚</li>
</ol>
</li>
</ol>
<h3 data-id="heading-5">ä¸‰ã€Apache Doris å¦‚ä½•åº”ç”¨ AWS IAM Assume Role é‰´æƒæœºåˆ¶</h3>
<ol>
<li>Doris é€šè¿‡å°† FEã€BE è¿›ç¨‹æ‰€éƒ¨ç½²çš„ AWS EC2 Instances ç»‘å®šåˆ° Source Account æ¥ä½¿ç”¨ AWS IAM Assume Role çš„åŠŸèƒ½ï¼Œä¸»è¦çš„æµç¨‹å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œå…·ä½“çš„é…ç½®å¯å‚ç…§<a href="https://link.juejin.cn?target=https%3A%2F%2Fdoris.apache.org%2Fzh-CN%2Fdocs%2F3.0%2Fadmin-manual%2Fauth%2Fintegrations%2Faws-authentication-and-authorization" target="_blank" title="https://doris.apache.org/zh-CN/docs/3.0/admin-manual/auth/integrations/aws-authentication-and-authorization" ref="nofollow noopener noreferrer">å®˜ç½‘æ–‡æ¡£å’Œè§†é¢‘</a> ï¼š</li>
</ol>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2428f1db51ce44578e67637df69877ba~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgU2VsZWN0REI=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765337462&amp;x-signature=pj3Yw6hGGHZe9jm3AqeG6ZzzG2k%3D" alt="ä¸‰ã€Apache Doris å¦‚ä½•åº”ç”¨ AWS IAM Assume Role â€‹é‰´æƒæœºåˆ¶.PNG" loading="lazy"/></p>
<ol>
<li>
<p>å®Œæˆé…ç½®å Doris FE/BE è¿›ç¨‹ä¼šè‡ªåŠ¨è· EC2 Instance çš„ Profile è¿›è¡Œæ‰§è¡Œ Assume Role æ“ä½œè®¿é—® Bucket æ“ä½œï¼Œæ‰©å®¹æ—¶ BE èŠ‚ç‚¹ä¼šè‡ªåŠ¨æ£€æµ‹æ–°çš„ EC2 Instance æ˜¯å¦æˆåŠŸç»‘å®š IAM Roleï¼Œé˜²æ­¢å‡ºç°æ¼é…çš„æƒ…å†µï¼›</p>
</li>
<li>
<p>Doris çš„ S3 Loadã€TVFã€Exportã€Resourceã€Repositoryã€Storage Vault ç­‰åŠŸèƒ½åœ¨ 3.0.6 ç‰ˆæœ¬ä¹‹åå‡æ”¯æŒäº† AWS Assume Role çš„æ–¹å¼ä½¿ç”¨ï¼Œå¹¶ä¸”åœ¨åˆ›å»ºæ—¶ä¼šè¿›è¡Œè¿é€šæ€§æ£€æµ‹ï¼ŒS3 Load SQL ä¸¾ä¾‹å¦‚ä¸‹ï¼š</p>
</li>
</ol>
<pre><code class="hljs language-SQL" lang="SQL">  LOAD LABEL s3_load_demo_202508
  (
      DATA INFILE("s3://your_bucket_name/s3load_example.csv")
      <span class="hljs-keyword">INTO</span> <span class="hljs-keyword">TABLE</span> test_s3load
      COLUMNS TERMINATED <span class="hljs-keyword">BY</span> ","
      FORMAT <span class="hljs-keyword">AS</span> "CSV"
      (user_id, name, age)
  )
  <span class="hljs-keyword">WITH</span> S3
  (
      "provider" <span class="hljs-operator">=</span> "S3",
      "s3.endpoint" <span class="hljs-operator">=</span> "s3.us-east-1.amazonaws.com",
      "s3.region" <span class="hljs-operator">=</span> "us-east-1",
      "s3.role_arn" <span class="hljs-operator">=</span> "arn:aws:iam::543815668950:role/test-role1",
      "s3.external_id" <span class="hljs-operator">=</span> "1001"      <span class="hljs-comment">-- å¯é€‰å‚æ•°</span>
  )
  PROPERTIES
  (
      "timeout" <span class="hljs-operator">=</span> "3600"
  );
</code></pre>
<p>å…¶ä¸­ "s3.role_arn" å¯¹åº”å¡«å…¥ AWS IAM Account2 ä¸‹çš„ Iam role2 çš„ arn å€¼ï¼Œ"s3.external_id"å¯¹åº”å¡«å…¥ Trust Relationships Policies ä¸­é…ç½®çš„ externalId çš„å€¼ï¼ˆå¯é€‰é…ç½®ï¼‰ã€‚</p>
<p>æ›´å¤šåŠŸèƒ½ SQL è¯­å¥è¯¦ç»†å‚è€ƒï¼š <a href="https://link.juejin.cn?target=https%3A%2F%2Fdoris.apache.org%2Fzh-CN%2Fdocs%2F3.0%2Fadmin-manual%2Fauth%2Fintegrations%2Faws-authentication-and-authorization" target="_blank" title="https://doris.apache.org/zh-CN/docs/3.0/admin-manual/auth/integrations/aws-authentication-and-authorization" ref="nofollow noopener noreferrer">Doris å®˜ç½‘æ–‡æ¡£</a>ï¼›</p>
<ol>
<li>Doris å½“å‰ä»…æ”¯æŒäº† AWS IAM Assume Role çš„æœºåˆ¶ï¼Œæœªæ¥ä¼šé€æ­¥å®ç°å…¶ä»–äº‘å‚å•†çš„ç±»ä¼¼é‰´æƒæœºåˆ¶ã€‚</li>
</ol>
<h2 data-id="heading-6">Reference</h2>
<ul>
<li>å®˜ç½‘æ–‡æ¡£ <a href="https://link.juejin.cn?target=https%3A%2F%2Fdoris.apache.org%2Fzh-CN%2Fdocs%2F3.0%2Fadmin-manual%2Fauth%2Fintegrations%2Faws-authentication-and-authorization" target="_blank" title="https://doris.apache.org/zh-CN/docs/3.0/admin-manual/auth/integrations/aws-authentication-and-authorization" ref="nofollow noopener noreferrer">doris.apache.org/zh-CN/docs/â€¦</a></li>
<li>è§†é¢‘ <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.bilibili.com%2Fvideo%2FBV1U3uezjEPW%2F%3Fvd_source%3D20479f0462e74fcf98f1df731639610f" target="_blank" title="https://www.bilibili.com/video/BV1U3uezjEPW/?vd_source=20479f0462e74fcf98f1df731639610f" ref="nofollow noopener noreferrer">www.bilibili.com/video/BV1U3â€¦</a></li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Elasticsearchç»å…¸é¢è¯•é¢˜æ¡ˆä¾‹åˆ†æ]]></title>    <link>https://juejin.cn/post/7579175271680294922</link>    <guid>https://juejin.cn/post/7579175271680294922</guid>    <pubDate>2025-12-03T03:30:49.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7579175271680294922" data-draft-id="7579176524130975795" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Elasticsearchç»å…¸é¢è¯•é¢˜æ¡ˆä¾‹åˆ†æ"/> <meta itemprop="keywords" content="åç«¯,é¢è¯•,æ¶æ„"/> <meta itemprop="datePublished" content="2025-12-03T03:30:49.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="360_go_php"/> <meta itemprop="url" content="https://juejin.cn/user/2436173498956695"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Elasticsearchç»å…¸é¢è¯•é¢˜æ¡ˆä¾‹åˆ†æ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2436173498956695/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    360_go_php
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-03T03:30:49.000Z" title="Wed Dec 03 2025 03:30:49 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-03
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»13åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>â€‹</p>
<h2 data-id="heading-0">1.ä¸ºä»€ä¹ˆè¦ä½¿ç”¨Elasticsearch?<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d46cca89839245a9824f9ea0286d2f5f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgMzYwX2dvX3BocA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765337449&amp;x-signature=eVO5tkh3nprk9BIfcwr3A9nhSzs%3D" alt="" loading="lazy"/><img src="" alt="" title="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨" loading="lazy"/>â€‹ç¼–è¾‘</h2>
<p>ç³»ç»Ÿä¸­çš„æ•°æ®ï¼Œ éšç€ä¸šåŠ¡çš„å‘å±•ï¼Œæ—¶é—´çš„æ¨ç§»ï¼Œ å°†ä¼šéå¸¸å¤šï¼Œ è€Œä¸šåŠ¡ä¸­å¾€å¾€é‡‡ç”¨æ¨¡ç³ŠæŸ¥è¯¢è¿›è¡Œæ•°æ®çš„æœç´¢ï¼Œ è€Œæ¨¡ç³ŠæŸ¥è¯¢ä¼šå¯¼è‡´æŸ¥è¯¢å¼•æ“æ”¾å¼ƒç´¢å¼•ï¼Œå¯¼è‡´ç³»ç»ŸæŸ¥è¯¢æ•°æ®æ—¶éƒ½æ˜¯å…¨è¡¨æ‰«æï¼Œåœ¨ç™¾ä¸‡çº§åˆ«çš„æ•°æ®åº“ä¸­ï¼ŒæŸ¥è¯¢æ•ˆç‡æ˜¯éå¸¸ä½ä¸‹çš„ï¼Œè€Œæˆ‘ä»¬ä½¿ç”¨ ES åšä¸€ä¸ªå…¨æ–‡ç´¢å¼•ï¼Œå°†ç»å¸¸æŸ¥è¯¢çš„ç³»ç»ŸåŠŸèƒ½çš„æŸäº›å­—æ®µï¼Œæ¯”å¦‚è¯´ç”µå•†ç³»ç»Ÿçš„å•†å“è¡¨ä¸­å•†å“åï¼Œæè¿°ã€ä»·æ ¼è¿˜æœ‰ id è¿™äº›å­—æ®µæˆ‘ä»¬æ”¾å…¥ ES ç´¢å¼•åº“é‡Œï¼Œå¯ä»¥æé«˜æŸ¥è¯¢é€Ÿåº¦ã€‚</p>
<h2 data-id="heading-1">2.Elasticsearchæ˜¯å¦‚ä½•å®ç°Masteré€‰ä¸¾çš„ï¼Ÿ<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c758bc9074144fcab57dc509fa403554~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgMzYwX2dvX3BocA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765337449&amp;x-signature=FP7t8qbRcPnyn1QQ9QvHUmUrWik%3D" alt="" loading="lazy"/><img src="" alt="" title="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨" loading="lazy"/>â€‹ç¼–è¾‘</h2>
<p>Elasticsearchçš„é€‰ä¸»æ˜¯ZenDiscoveryæ¨¡å—è´Ÿè´£çš„ï¼Œä¸»è¦åŒ…å«Pingï¼ˆèŠ‚ç‚¹ä¹‹é—´é€šè¿‡è¿™ä¸ªRPCæ¥å‘ç°å½¼æ­¤ï¼‰å’ŒUnicastï¼ˆå•æ’­æ¨¡å—åŒ…å«ä¸€ä¸ªä¸»æœºåˆ—è¡¨ä»¥æ§åˆ¶å“ªäº›èŠ‚ç‚¹éœ€è¦pingé€šï¼‰è¿™ä¸¤éƒ¨åˆ†ï¼›<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5c899fdd1b2040d4a5d0ed4f9911386e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgMzYwX2dvX3BocA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765337449&amp;x-signature=zJeuYbUr8E8%2BqMEUWoL6mk0lQKs%3D" alt="" loading="lazy"/><img src="" alt="" title="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨" loading="lazy"/>â€‹ç¼–è¾‘</p>
<p>å¯¹æ‰€æœ‰å¯ä»¥æˆä¸ºmasterçš„èŠ‚ç‚¹ï¼ˆnode.master: trueï¼‰æ ¹æ®nodeIdå­—å…¸æ’åºï¼Œæ¯æ¬¡é€‰ä¸¾æ¯ä¸ªèŠ‚ç‚¹éƒ½æŠŠè‡ªå·±æ‰€çŸ¥é“èŠ‚ç‚¹æ’ä¸€æ¬¡åºï¼Œç„¶åé€‰å‡ºç¬¬ä¸€ä¸ªï¼ˆç¬¬0ä½ï¼‰èŠ‚ç‚¹ï¼Œæš‚ä¸”è®¤ä¸ºå®ƒæ˜¯masterèŠ‚ç‚¹ã€‚</p>
<p>å¦‚æœå¯¹æŸä¸ªèŠ‚ç‚¹çš„æŠ•ç¥¨æ•°è¾¾åˆ°ä¸€å®šçš„å€¼ï¼ˆå¯ä»¥æˆä¸ºmasterèŠ‚ç‚¹æ•°n/2+1ï¼‰å¹¶ä¸”è¯¥èŠ‚ç‚¹è‡ªå·±ä¹Ÿé€‰ä¸¾è‡ªå·±ï¼Œé‚£è¿™ä¸ªèŠ‚ç‚¹å°±æ˜¯masterã€‚å¦åˆ™é‡æ–°é€‰ä¸¾ä¸€ç›´åˆ°æ»¡è¶³ä¸Šè¿°æ¡ä»¶ã€‚</p>
<p>è¡¥å……ï¼šmasterèŠ‚ç‚¹çš„èŒè´£ä¸»è¦åŒ…æ‹¬é›†ç¾¤ã€èŠ‚ç‚¹å’Œç´¢å¼•çš„ç®¡ç†ï¼Œä¸è´Ÿè´£æ–‡æ¡£çº§åˆ«çš„ç®¡ç†ï¼›dataèŠ‚ç‚¹å¯ä»¥å…³é—­httpåŠŸèƒ½ã€‚</p>
<h2 data-id="heading-2">3.Elasticsearchä¸­çš„èŠ‚ç‚¹ï¼ˆæ¯”å¦‚å…±20ä¸ªï¼‰ï¼Œå…¶ä¸­çš„10ä¸ªé€‰äº†ä¸€ä¸ªmasterï¼Œå¦å¤–10ä¸ªé€‰äº†å¦ä¸€ä¸ªmasterï¼Œæ€ä¹ˆåŠï¼Ÿ<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/17e0d1c480da4f0caeb496e6d23effe8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgMzYwX2dvX3BocA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765337449&amp;x-signature=shvS1Lq%2B42iiZiJEVnGPzMSEhT8%3D" alt="" loading="lazy"/><img src="" alt="" title="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨" loading="lazy"/>â€‹ç¼–è¾‘</h2>
<p>å½“é›†ç¾¤masterå€™é€‰æ•°é‡ä¸å°äº3ä¸ªæ—¶ï¼Œå¯ä»¥é€šè¿‡è®¾ç½®æœ€å°‘æŠ•ç¥¨é€šè¿‡æ•°é‡ï¼ˆdiscovery.zen.minimum_master_nodesï¼‰è¶…è¿‡æ‰€æœ‰å€™é€‰èŠ‚ç‚¹ä¸€åŠä»¥ä¸Šæ¥è§£å†³è„‘è£‚é—®é¢˜ï¼›<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d1c2a338df674192b5a4c7ce053608e4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgMzYwX2dvX3BocA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765337449&amp;x-signature=7757NkYAcTLDwiH5%2FSzwy6DMM58%3D" alt="" loading="lazy"/><img src="" alt="" title="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨" loading="lazy"/>â€‹ç¼–è¾‘</p>
<p>å½“å€™é€‰æ•°é‡ä¸ºä¸¤ä¸ªæ—¶ï¼Œåªèƒ½ä¿®æ”¹ä¸ºå”¯ä¸€çš„ä¸€ä¸ªmasterå€™é€‰ï¼Œå…¶ä»–ä½œä¸ºdataèŠ‚ç‚¹ï¼Œé¿å…è„‘è£‚é—®é¢˜ã€‚</p>
<h2 data-id="heading-3">4.è¯¦ç»†æè¿°ä¸€ä¸‹Elasticsearchç´¢å¼•æ–‡æ¡£çš„è¿‡ç¨‹ã€‚</h2>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c9a0c446a7af40a18309ec94db4ab990~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgMzYwX2dvX3BocA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765337449&amp;x-signature=rxLF30WiUN9vvjGURtBzAypN0zk%3D" alt="" loading="lazy"/>â€‹</p>
<p><img src="" alt="" title="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨" loading="lazy"/>ç¼–è¾‘</p>
<p>åè°ƒèŠ‚ç‚¹é»˜è®¤ä½¿ç”¨æ–‡æ¡£IDå‚ä¸è®¡ç®—ï¼ˆä¹Ÿæ”¯æŒé€šè¿‡routingï¼‰ï¼Œä»¥ä¾¿ä¸ºè·¯ç”±æä¾›åˆé€‚çš„åˆ†ç‰‡ã€‚</p>
<p>shard = hash(document_id) % (num_of_primary_shards)</p>
<p>å½“åˆ†ç‰‡æ‰€åœ¨çš„èŠ‚ç‚¹æ¥æ”¶åˆ°æ¥è‡ªåè°ƒèŠ‚ç‚¹çš„è¯·æ±‚åï¼Œä¼šå°†è¯·æ±‚å†™å…¥åˆ°Memory Bufferï¼Œç„¶åå®šæ—¶ï¼ˆé»˜è®¤æ˜¯æ¯éš”1ç§’ï¼‰å†™å…¥åˆ°Filesystem Cacheï¼Œè¿™ä¸ªä»Momery Bufferåˆ°Filesystem Cacheçš„è¿‡ç¨‹å°±å«åšrefreshï¼›</p>
<p>å½“ç„¶åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œå­˜åœ¨Momery Bufferå’ŒFilesystem Cacheçš„æ•°æ®å¯èƒ½ä¼šä¸¢å¤±ï¼ŒESæ˜¯é€šè¿‡translogçš„æœºåˆ¶æ¥ä¿è¯æ•°æ®çš„å¯é æ€§çš„ã€‚å…¶å®ç°æœºåˆ¶æ˜¯æ¥æ”¶åˆ°è¯·æ±‚åï¼ŒåŒæ—¶ä¹Ÿä¼šå†™å…¥åˆ°translogä¸­ï¼Œå½“Filesystem cacheä¸­çš„æ•°æ®å†™å…¥åˆ°ç£ç›˜ä¸­æ—¶ï¼Œæ‰ä¼šæ¸…é™¤æ‰ï¼Œè¿™ä¸ªè¿‡ç¨‹å«åšflushï¼›</p>
<p>åœ¨flushè¿‡ç¨‹ä¸­ï¼Œå†…å­˜ä¸­çš„ç¼“å†²å°†è¢«æ¸…é™¤ï¼Œå†…å®¹è¢«å†™å…¥ä¸€ä¸ªæ–°æ®µï¼Œæ®µçš„fsyncå°†åˆ›å»ºä¸€ä¸ªæ–°çš„æäº¤ç‚¹ï¼Œå¹¶å°†å†…å®¹åˆ·æ–°åˆ°ç£ç›˜ï¼Œæ—§çš„translogå°†è¢«åˆ é™¤å¹¶å¼€å§‹ä¸€ä¸ªæ–°çš„translogã€‚</p>
<p>flushè§¦å‘çš„æ—¶æœºæ˜¯å®šæ—¶è§¦å‘ï¼ˆé»˜è®¤30åˆ†é’Ÿï¼‰æˆ–è€…translogå˜å¾—å¤ªå¤§ï¼ˆé»˜è®¤ä¸º512Mï¼‰æ—¶ï¼›</p>
<h2 data-id="heading-4">5.è¯¦ç»†æè¿°ä¸€ä¸‹Elasticsearchæ›´æ–°å’Œåˆ é™¤æ–‡æ¡£çš„è¿‡ç¨‹</h2>
<p>åˆ é™¤å’Œæ›´æ–°ä¹Ÿéƒ½æ˜¯å†™æ“ä½œï¼Œä½†æ˜¯Elasticsearchä¸­çš„æ–‡æ¡£æ˜¯ä¸å¯å˜çš„ï¼Œå› æ­¤ä¸èƒ½è¢«åˆ é™¤æˆ–è€…æ”¹åŠ¨ä»¥å±•ç¤ºå…¶å˜æ›´ï¼›</p>
<p>ç£ç›˜ä¸Šçš„æ¯ä¸ªæ®µéƒ½æœ‰ä¸€ä¸ªç›¸åº”çš„.delæ–‡ä»¶ã€‚å½“åˆ é™¤è¯·æ±‚å‘é€åï¼Œæ–‡æ¡£å¹¶æ²¡æœ‰çœŸçš„è¢«åˆ é™¤ï¼Œè€Œæ˜¯åœ¨.delæ–‡ä»¶ä¸­è¢«æ ‡è®°ä¸ºåˆ é™¤ã€‚è¯¥æ–‡æ¡£ä¾ç„¶èƒ½åŒ¹é…æŸ¥è¯¢ï¼Œä½†æ˜¯ä¼šåœ¨ç»“æœä¸­è¢«è¿‡æ»¤æ‰ã€‚å½“æ®µåˆå¹¶æ—¶ï¼Œåœ¨.delæ–‡ä»¶ä¸­è¢«æ ‡è®°ä¸ºåˆ é™¤çš„æ–‡æ¡£å°†ä¸ä¼šè¢«å†™å…¥æ–°æ®µã€‚</p>
<p>åœ¨æ–°çš„æ–‡æ¡£è¢«åˆ›å»ºæ—¶ï¼ŒElasticsearchä¼šä¸ºè¯¥æ–‡æ¡£æŒ‡å®šä¸€ä¸ªç‰ˆæœ¬å·ï¼Œå½“æ‰§è¡Œæ›´æ–°æ—¶ï¼Œæ—§ç‰ˆæœ¬çš„æ–‡æ¡£åœ¨.delæ–‡ä»¶ä¸­è¢«æ ‡è®°ä¸ºåˆ é™¤ï¼Œæ–°ç‰ˆæœ¬çš„æ–‡æ¡£è¢«ç´¢å¼•åˆ°ä¸€ä¸ªæ–°æ®µã€‚æ—§ç‰ˆæœ¬çš„æ–‡æ¡£ä¾ç„¶èƒ½åŒ¹é…æŸ¥è¯¢ï¼Œä½†æ˜¯ä¼šåœ¨ç»“æœä¸­è¢«è¿‡æ»¤æ‰ã€‚</p>
<h2 data-id="heading-5">6.è¯¦ç»†æè¿°ä¸€ä¸‹Elasticsearchæœç´¢çš„è¿‡ç¨‹</h2>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6a34b7220e764bc19a3622283e0bcd06~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgMzYwX2dvX3BocA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765337449&amp;x-signature=l1N%2FVs24e8xEAmgqp94VuO%2BRYX0%3D" alt="" loading="lazy"/>â€‹</p>
<p><img src="" alt="" title="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨" loading="lazy"/>ç¼–è¾‘</p>
<p>æœç´¢è¢«æ‰§è¡Œæˆä¸€ä¸ªä¸¤é˜¶æ®µè¿‡ç¨‹ï¼Œæˆ‘ä»¬ç§°ä¹‹ä¸º Query Then Fetchï¼›</p>
<p>åœ¨åˆå§‹æŸ¥è¯¢é˜¶æ®µæ—¶ï¼ŒæŸ¥è¯¢ä¼šå¹¿æ’­åˆ°ç´¢å¼•ä¸­æ¯ä¸€ä¸ªåˆ†ç‰‡æ‹·è´ï¼ˆä¸»åˆ†ç‰‡æˆ–è€…å‰¯æœ¬åˆ†ç‰‡ï¼‰ã€‚ æ¯ä¸ªåˆ†ç‰‡åœ¨æœ¬åœ°æ‰§è¡Œæœç´¢å¹¶æ„å»ºä¸€ä¸ªåŒ¹é…æ–‡æ¡£çš„å¤§å°ä¸º from + size çš„ä¼˜å…ˆé˜Ÿåˆ—ã€‚PSï¼šåœ¨æœç´¢çš„æ—¶å€™æ˜¯ä¼šæŸ¥è¯¢Filesystem Cacheçš„ï¼Œä½†æ˜¯æœ‰éƒ¨åˆ†æ•°æ®è¿˜åœ¨Memory Bufferï¼Œæ‰€ä»¥æœç´¢æ˜¯è¿‘å®æ—¶çš„ã€‚</p>
<p>æ¯ä¸ªåˆ†ç‰‡è¿”å›å„è‡ªä¼˜å…ˆé˜Ÿåˆ—ä¸­ æ‰€æœ‰æ–‡æ¡£çš„ ID å’Œæ’åºå€¼ ç»™åè°ƒèŠ‚ç‚¹ï¼Œå®ƒåˆå¹¶è¿™äº›å€¼åˆ°è‡ªå·±çš„ä¼˜å…ˆé˜Ÿåˆ—ä¸­æ¥äº§ç”Ÿä¸€ä¸ªå…¨å±€æ’åºåçš„ç»“æœåˆ—è¡¨ã€‚</p>
<p>æ¥ä¸‹æ¥å°±æ˜¯ å–å›é˜¶æ®µï¼Œåè°ƒèŠ‚ç‚¹è¾¨åˆ«å‡ºå“ªäº›æ–‡æ¡£éœ€è¦è¢«å–å›å¹¶å‘ç›¸å…³çš„åˆ†ç‰‡æäº¤å¤šä¸ª GET è¯·æ±‚ã€‚æ¯ä¸ªåˆ†ç‰‡åŠ è½½å¹¶ ä¸°å¯Œ æ–‡æ¡£ï¼Œå¦‚æœæœ‰éœ€è¦çš„è¯ï¼Œæ¥ç€è¿”å›æ–‡æ¡£ç»™åè°ƒèŠ‚ç‚¹ã€‚ä¸€æ—¦æ‰€æœ‰çš„æ–‡æ¡£éƒ½è¢«å–å›äº†ï¼Œåè°ƒèŠ‚ç‚¹è¿”å›ç»“æœç»™å®¢æˆ·ç«¯ã€‚</p>
<p>è¡¥å……ï¼šQuery Then Fetchçš„æœç´¢ç±»å‹åœ¨æ–‡æ¡£ç›¸å…³æ€§æ‰“åˆ†çš„æ—¶å€™å‚è€ƒçš„æ˜¯æœ¬åˆ†ç‰‡çš„æ•°æ®ï¼Œè¿™æ ·åœ¨æ–‡æ¡£æ•°é‡è¾ƒå°‘çš„æ—¶å€™å¯èƒ½ä¸å¤Ÿå‡†ç¡®ï¼ŒDFS Query Then Fetchå¢åŠ äº†ä¸€ä¸ªé¢„æŸ¥è¯¢çš„å¤„ç†ï¼Œè¯¢é—®Termå’ŒDocument frequencyï¼Œè¿™ä¸ªè¯„åˆ†æ›´å‡†ç¡®ï¼Œä½†æ˜¯æ€§èƒ½ä¼šå˜å·®ã€‚</p>
<h2 data-id="heading-6">9.Elasticsearchå¯¹äºå¤§æ•°æ®é‡ï¼ˆä¸Šäº¿é‡çº§ï¼‰çš„èšåˆå¦‚ä½•å®ç°ï¼Ÿ</h2>
<p>Elasticsearch æä¾›çš„é¦–ä¸ªè¿‘ä¼¼èšåˆæ˜¯cardinality åº¦é‡ã€‚å®ƒæä¾›ä¸€ä¸ªå­—æ®µçš„åŸºæ•°ï¼Œå³è¯¥å­—æ®µçš„distinctæˆ–è€…uniqueå€¼çš„æ•°ç›®ã€‚å®ƒæ˜¯åŸºäºHLLç®—æ³•çš„ã€‚HLL ä¼šå…ˆå¯¹æˆ‘ä»¬çš„è¾“å…¥ä½œå“ˆå¸Œè¿ç®—ï¼Œç„¶åæ ¹æ®å“ˆå¸Œè¿ç®—çš„ç»“æœä¸­çš„ bits åšæ¦‚ç‡ä¼°ç®—ä»è€Œå¾—åˆ°åŸºæ•°ã€‚å…¶ç‰¹ç‚¹æ˜¯ï¼šå¯é…ç½®çš„ç²¾åº¦ï¼Œç”¨æ¥æ§åˆ¶å†…å­˜çš„ä½¿ç”¨ï¼ˆæ›´ç²¾ç¡® ï¼ æ›´å¤šå†…å­˜ï¼‰ï¼›å°çš„æ•°æ®é›†ç²¾åº¦æ˜¯éå¸¸é«˜çš„ï¼›æˆ‘ä»¬å¯ä»¥é€šè¿‡é…ç½®å‚æ•°ï¼Œæ¥è®¾ç½®å»é‡éœ€è¦çš„å›ºå®šå†…å­˜ä½¿ç”¨é‡ã€‚æ— è®ºæ•°åƒè¿˜æ˜¯æ•°åäº¿çš„å”¯ä¸€å€¼ï¼Œå†…å­˜ä½¿ç”¨é‡åªä¸ä½ é…ç½®çš„ç²¾ç¡®åº¦ç›¸å…³ .</p>
<h2 data-id="heading-7">10.åœ¨å¹¶å‘æƒ…å†µä¸‹ï¼ŒElasticsearchå¦‚æœä¿è¯è¯»å†™ä¸€è‡´ï¼Ÿ<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/332bcad73e8b41618abe8b6a18ccd6fd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgMzYwX2dvX3BocA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765337449&amp;x-signature=GSfgT3AOL0620wUmeesDWXTCDdw%3D" alt="" loading="lazy"/><img src="" alt="" title="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨" loading="lazy"/>â€‹ç¼–è¾‘</h2>
<p>å¯ä»¥é€šè¿‡ç‰ˆæœ¬å·ä½¿ç”¨ä¹è§‚å¹¶å‘æ§åˆ¶ï¼Œä»¥ç¡®ä¿æ–°ç‰ˆæœ¬ä¸ä¼šè¢«æ—§ç‰ˆæœ¬è¦†ç›–ï¼Œç”±åº”ç”¨å±‚æ¥å¤„ç†å…·ä½“çš„å†²çªï¼›</p>
<p>å¦å¤–å¯¹äºå†™æ“ä½œï¼Œä¸€è‡´æ€§çº§åˆ«æ”¯æŒquorum/one/allï¼Œé»˜è®¤ä¸ºquorumï¼Œå³åªæœ‰å½“å¤§å¤šæ•°åˆ†ç‰‡å¯ç”¨æ—¶æ‰å…è®¸å†™æ“ä½œã€‚ä½†å³ä½¿å¤§å¤šæ•°å¯ç”¨ï¼Œä¹Ÿå¯èƒ½å­˜åœ¨å› ä¸ºç½‘ç»œç­‰åŸå› å¯¼è‡´å†™å…¥å‰¯æœ¬å¤±è´¥ï¼Œè¿™æ ·è¯¥å‰¯æœ¬è¢«è®¤ä¸ºæ•…éšœï¼Œåˆ†ç‰‡å°†ä¼šåœ¨ä¸€ä¸ªä¸åŒçš„èŠ‚ç‚¹ä¸Šé‡å»ºã€‚</p>
<p>å¯¹äºè¯»æ“ä½œï¼Œå¯ä»¥è®¾ç½®replicationä¸ºsync(é»˜è®¤)ï¼Œè¿™ä½¿å¾—æ“ä½œåœ¨ä¸»åˆ†ç‰‡å’Œå‰¯æœ¬åˆ†ç‰‡éƒ½å®Œæˆåæ‰ä¼šè¿”å›ï¼›å¦‚æœè®¾ç½®replicationä¸ºasyncæ—¶ï¼Œä¹Ÿå¯ä»¥é€šè¿‡è®¾ç½®æœç´¢è¯·æ±‚å‚æ•°_preferenceä¸ºprimaryæ¥æŸ¥è¯¢ä¸»åˆ†ç‰‡ï¼Œç¡®ä¿æ–‡æ¡£æ˜¯æœ€æ–°ç‰ˆæœ¬ã€‚</p>
<h2 data-id="heading-8">14.ElasticSearchä¸­çš„é›†ç¾¤ã€èŠ‚ç‚¹ã€ç´¢å¼•ã€æ–‡æ¡£ã€ç±»å‹æ˜¯ä»€ä¹ˆï¼Ÿ</h2>
<p>ç¾¤é›†æ˜¯ä¸€ä¸ªæˆ–å¤šä¸ªèŠ‚ç‚¹ï¼ˆæœåŠ¡å™¨ï¼‰çš„é›†åˆï¼Œå®ƒä»¬å…±åŒä¿å­˜æ‚¨çš„æ•´ä¸ªæ•°æ®ï¼Œå¹¶æä¾›è·¨æ‰€æœ‰èŠ‚ç‚¹çš„è”åˆç´¢å¼•å’Œæœç´¢åŠŸèƒ½ã€‚ç¾¤é›†ç”±å”¯ä¸€åç§°æ ‡è¯†ï¼Œé»˜è®¤æƒ…å†µä¸‹ä¸ºâ€œelasticsearchâ€ã€‚æ­¤åç§°å¾ˆé‡è¦ï¼Œå› ä¸ºå¦‚æœèŠ‚ç‚¹è®¾ç½®ä¸ºæŒ‰åç§°åŠ å…¥ç¾¤é›†ï¼Œåˆ™è¯¥èŠ‚ç‚¹åªèƒ½æ˜¯ç¾¤é›†çš„ä¸€éƒ¨åˆ†ã€‚</p>
<p>èŠ‚ç‚¹æ˜¯å±äºé›†ç¾¤ä¸€éƒ¨åˆ†çš„å•ä¸ªæœåŠ¡å™¨ã€‚å®ƒå­˜å‚¨æ•°æ®å¹¶å‚ä¸ç¾¤é›†ç´¢å¼•å’Œæœç´¢åŠŸèƒ½ã€‚</p>
<p>ç´¢å¼•å°±åƒå…³ç³»æ•°æ®åº“ä¸­çš„â€œæ•°æ®åº“â€ã€‚å®ƒæœ‰ä¸€ä¸ªå®šä¹‰å¤šç§ç±»å‹çš„æ˜ å°„ã€‚ç´¢å¼•æ˜¯é€»è¾‘åç§°ç©ºé—´ï¼Œæ˜ å°„åˆ°ä¸€ä¸ªæˆ–å¤šä¸ªä¸»åˆ†ç‰‡ï¼Œå¹¶ä¸”å¯ä»¥æœ‰é›¶ä¸ªæˆ–å¤šä¸ªå‰¯æœ¬åˆ†ç‰‡ã€‚ MySQL =&gt;æ•°æ®åº“ ElasticSearch =&gt;ç´¢å¼•</p>
<p>æ–‡æ¡£ç±»ä¼¼äºå…³ç³»æ•°æ®åº“ä¸­çš„ä¸€è¡Œã€‚ä¸åŒä¹‹å¤„åœ¨äºç´¢å¼•ä¸­çš„æ¯ä¸ªæ–‡æ¡£å¯ä»¥å…·æœ‰ä¸åŒçš„ç»“æ„ï¼ˆå­—æ®µï¼‰ï¼Œä½†æ˜¯å¯¹äºé€šç”¨å­—æ®µåº”è¯¥å…·æœ‰ç›¸åŒçš„æ•°æ®ç±»å‹ã€‚ MySQL =&gt; Databases =&gt; Tables =&gt; Columns / Rows ElasticSearch =&gt; Indices =&gt; Types =&gt;å…·æœ‰å±æ€§çš„æ–‡æ¡£</p>
<p>ç±»å‹æ˜¯ç´¢å¼•çš„é€»è¾‘ç±»åˆ«/åˆ†åŒºï¼Œå…¶è¯­ä¹‰å®Œå…¨å–å†³äºç”¨æˆ·ã€‚</p>
<h2 data-id="heading-9">Elasticsearch ä¸­çš„å€’æ’ç´¢å¼•æ˜¯ä»€ä¹ˆï¼Ÿ</h2>
<p>å€’æ’ç´¢å¼•æ˜¯æœç´¢å¼•æ“çš„æ ¸å¿ƒã€‚æœç´¢å¼•æ“çš„ä¸»è¦ç›®æ ‡æ˜¯åœ¨æŸ¥æ‰¾å‘ç”Ÿæœç´¢æ¡ä»¶çš„æ–‡æ¡£æ—¶æä¾›å¿«é€Ÿæœç´¢ã€‚ESä¸­çš„å€’æ’ç´¢å¼•å…¶å®å°±æ˜¯ lucene çš„å€’æ’ç´¢å¼•ï¼ŒåŒºåˆ«äºä¼ ç»Ÿçš„æ­£å‘ç´¢å¼•ï¼Œ å€’æ’ç´¢å¼•ä¼šå†å­˜å‚¨æ•°æ®æ—¶å°†å…³é”®è¯å’Œæ•°æ®è¿›è¡Œå…³è”ï¼Œä¿å­˜åˆ°å€’æ’è¡¨ä¸­ï¼Œç„¶åæŸ¥è¯¢æ—¶ï¼Œå°†æŸ¥è¯¢å†…å®¹è¿›è¡Œåˆ†è¯ååœ¨å€’æ’è¡¨ä¸­è¿›è¡ŒæŸ¥è¯¢ï¼Œæœ€ååŒ¹é…æ•°æ®å³å¯ã€‚</p>
<h2 data-id="heading-10">15.ElasticSearchä¸­çš„åˆ†ç‰‡æ˜¯ä»€ä¹ˆ?</h2>
<p>åœ¨å¤§å¤šæ•°ç¯å¢ƒä¸­ï¼Œæ¯ä¸ªèŠ‚ç‚¹éƒ½åœ¨å•ç‹¬çš„ç›’å­æˆ–è™šæ‹Ÿæœºä¸Šè¿è¡Œã€‚</p>
<p>ç´¢å¼• - åœ¨Elasticsearchä¸­ï¼Œç´¢å¼•æ˜¯æ–‡æ¡£çš„é›†åˆã€‚</p>
<p>åˆ†ç‰‡ -å› ä¸ºElasticsearchæ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼æœç´¢å¼•æ“ï¼Œæ‰€ä»¥ç´¢å¼•é€šå¸¸è¢«åˆ†å‰²æˆåˆ†å¸ƒåœ¨å¤šä¸ªèŠ‚ç‚¹ä¸Šçš„è¢«ç§°ä¸ºåˆ†ç‰‡çš„å…ƒç´ ã€‚</p>
<h2 data-id="heading-11">Elasticsearch é›†ç¾¤è„‘è£‚é—®é¢˜ï¼Ÿ</h2>
<p>â€œè„‘è£‚â€é—®é¢˜å¯èƒ½çš„æˆå› ï¼š</p>
<p>ç½‘ç»œé—®é¢˜ï¼šé›†ç¾¤é—´çš„ç½‘ç»œå»¶è¿Ÿå¯¼è‡´ä¸€äº›èŠ‚ç‚¹è®¿é—®ä¸åˆ°master, è®¤ä¸ºmaster æŒ‚æ‰äº†ä»è€Œé€‰ä¸¾å‡ºæ–°çš„master,å¹¶å¯¹masterä¸Šçš„åˆ†ç‰‡å’Œå‰¯æœ¬æ ‡çº¢ï¼Œåˆ†é…æ–°çš„ä¸»åˆ†ç‰‡ã€‚</p>
<p>èŠ‚ç‚¹è´Ÿè½½ï¼šä¸»èŠ‚ç‚¹çš„è§’è‰²æ—¢ä¸ºmasteråˆä¸ºdata,è®¿é—®é‡è¾ƒå¤§æ—¶å¯èƒ½ä¼šå¯¼è‡´ESåœæ­¢å“åº”é€ æˆå¤§é¢ç§¯å»¶è¿Ÿï¼Œæ­¤æ—¶å…¶ä»–èŠ‚ç‚¹å¾—ä¸åˆ°ä¸»èŠ‚ç‚¹çš„å“åº”è®¤ä¸ºä¸»èŠ‚ç‚¹æŒ‚æ‰äº†ï¼Œä¼šé‡æ–°é€‰å–ä¸»èŠ‚ç‚¹ã€‚</p>
<p>å†…å­˜å›æ”¶ï¼šdata èŠ‚ç‚¹ä¸Šçš„ESè¿›ç¨‹å ç”¨çš„å†…å­˜è¾ƒå¤§ï¼Œå¼•å‘JVMçš„å¤§è§„æ¨¡å†…å­˜å›æ”¶ï¼Œé€ æˆESè¿›ç¨‹å¤±å»å“åº”ã€‚</p>
<p>è„‘è£‚é—®é¢˜è§£å†³æ–¹æ¡ˆï¼š</p>
<p>å‡å°‘è¯¯åˆ¤ï¼šdiscovery.zen ping_ timeout èŠ‚ç‚¹çŠ¶æ€çš„å“åº”æ—¶é—´ï¼Œé»˜è®¤ä¸º3sï¼Œå¯ä»¥é€‚å½“è°ƒå¤§ï¼Œå¦‚æœmasteråœ¨è¯¥å“åº”æ—¶é—´çš„èŒƒå›´å†…æ²¡æœ‰åšå‡ºå“åº”åº”ç­”ï¼Œåˆ¤æ–­è¯¥èŠ‚ç‚¹å·²ç»æŒ‚æ‰äº†ã€‚è°ƒå¤§å‚æ•°ï¼ˆå¦‚6sï¼Œdiscovery.zen.ping_timeout:6ï¼‰ï¼Œå¯é€‚å½“å‡å°‘è¯¯åˆ¤ã€‚</p>
<p>é€‰ä¸¾è§¦å‘ï¼šdiscovery.zen.minimum. <em>master</em> nodes:1ï¼Œè¯¥å‚æ•¸æ˜¯ç”¨äºæ§åˆ¶é€‰ä¸¾è¡Œä¸ºå‘ç”Ÿçš„æœ€å°é›†ç¾¤ä¸»èŠ‚ç‚¹æ•°é‡ã€‚å½“å¤‡é€‰ä¸»èŠ‚ç‚¹çš„ä¸ªæ•¸å¤§äºç­‰äºè¯¥å‚æ•°çš„å€¼ï¼Œä¸”å¤‡é€‰ä¸»èŠ‚ç‚¹ä¸­æœ‰è¯¥å‚æ•°ä¸ªèŠ‚ç‚¹è®¤ä¸ºä¸»èŠ‚ç‚¹æŒ‚äº†ï¼Œè¿›è¡Œé€‰ä¸¾ã€‚å®˜æ–¹å»ºè®®ä¸º(n / 2) +1, nä¸ºä¸»èŠ‚ç‚¹ä¸ªæ•°ï¼ˆå³æœ‰èµ„æ ¼æˆä¸ºä¸»èŠ‚ç‚¹çš„èŠ‚ç‚¹ä¸ªæ•°ï¼‰ã€‚</p>
<p>è§’è‰²åˆ†ç¦»ï¼šå³masterèŠ‚ç‚¹ä¸dataèŠ‚ç‚¹åˆ†ç¦»ï¼Œé™åˆ¶è§’è‰²</p>
<p>ä¸»èŠ‚ç‚¹é…ç½®ä¸ºï¼šnode master: trueï¼Œnode data: false</p>
<p>ä»èŠ‚ç‚¹é…ç½®ä¸ºï¼šnode master: falseï¼Œnode data: true</p>
<h2 data-id="heading-12">Elasticsearch åœ¨éƒ¨ç½²æ—¶ï¼Œå¯¹ Linux çš„è®¾ç½®æœ‰å“ªäº›ä¼˜åŒ–æ–¹æ³•ï¼Ÿ</h2>
<p>64 GB å†…å­˜çš„æœºå™¨æ˜¯éå¸¸ç†æƒ³çš„ï¼Œ ä½†æ˜¯ 32 GB å’Œ 16 GB æœºå™¨ä¹Ÿæ˜¯å¾ˆå¸¸è§çš„ã€‚å°‘äº 8 GB ä¼šé€‚å¾—å…¶åã€‚</p>
<p>å¦‚æœä½ è¦åœ¨æ›´å¿«çš„ CPUs å’Œæ›´å¤šçš„æ ¸å¿ƒä¹‹é—´é€‰æ‹©ï¼Œé€‰æ‹©æ›´å¤šçš„æ ¸å¿ƒæ›´å¥½ã€‚å¤šä¸ªå†…æ ¸æä¾›çš„é¢å¤–å¹¶å‘è¿œèƒœè¿‡ç¨å¾®å¿«ä¸€ç‚¹ç‚¹çš„æ—¶é’Ÿé¢‘ç‡ã€‚</p>
<p>å¦‚æœä½ è´Ÿæ‹…å¾—èµ· SSDï¼Œå®ƒå°†è¿œè¿œè¶…å‡ºä»»ä½•æ—‹è½¬ä»‹è´¨ã€‚ åŸºäº SSD çš„èŠ‚ç‚¹ï¼ŒæŸ¥è¯¢å’Œç´¢å¼•æ€§èƒ½éƒ½æœ‰æå‡ã€‚å¦‚æœä½ è´Ÿæ‹…å¾—èµ·ï¼Œ SSD æ˜¯ä¸€ä¸ªå¥½çš„é€‰æ‹©ã€‚</p>
<p>å³ä½¿æ•°æ®ä¸­å¿ƒä»¬è¿‘åœ¨å’«å°ºï¼Œä¹Ÿè¦é¿å…é›†ç¾¤è·¨è¶Šå¤šä¸ªæ•°æ®ä¸­å¿ƒã€‚ç»å¯¹è¦é¿å…é›†ç¾¤è·¨è¶Šå¤§çš„åœ°ç†è·ç¦»ã€‚</p>
<p>è¯·ç¡®ä¿è¿è¡Œä½ åº”ç”¨ç¨‹åºçš„ JVM å’ŒæœåŠ¡å™¨çš„ JVM æ˜¯å®Œå…¨ä¸€æ ·çš„ã€‚ åœ¨ Elasticsearch çš„å‡ ä¸ªåœ°æ–¹ï¼Œä½¿ç”¨ Java çš„æœ¬åœ°åºåˆ—åŒ–ã€‚</p>
<p>é€šè¿‡è®¾ç½® gateway.recover_after_nodesã€ gateway.expected_nodesã€ gateway.recover_after_time å¯ä»¥åœ¨é›†ç¾¤é‡å¯çš„æ—¶å€™é¿å…è¿‡å¤šçš„åˆ†ç‰‡äº¤æ¢ï¼Œè¿™å¯èƒ½ä¼šè®©æ•°æ®æ¢å¤ä»æ•°ä¸ªå°æ—¶ç¼©çŸ­ä¸ºå‡ ç§’é’Ÿã€‚</p>
<p>Elasticsearch é»˜è®¤è¢«é…ç½®ä¸ºä½¿ç”¨å•æ’­å‘ç°ï¼Œä»¥é˜²æ­¢èŠ‚ç‚¹æ— æ„ä¸­åŠ å…¥é›†ç¾¤ã€‚åªæœ‰åœ¨åŒä¸€å°æœºå™¨ä¸Šè¿è¡Œçš„èŠ‚ç‚¹æ‰ä¼šè‡ªåŠ¨ç»„æˆé›†ç¾¤ã€‚æœ€å¥½ä½¿ç”¨å•æ’­ä»£æ›¿ç»„æ’­ã€‚</p>
<p>ä¸è¦éšæ„ä¿®æ”¹åƒåœ¾å›æ”¶å™¨ï¼ˆCMSï¼‰å’Œå„ä¸ªçº¿ç¨‹æ± çš„å¤§å°ã€‚</p>
<p>æŠŠä½ çš„å†…å­˜çš„ï¼ˆå°‘äºï¼‰ä¸€åŠç»™ Luceneï¼ˆä½†ä¸è¦è¶…è¿‡ 32 GBï¼ï¼‰ï¼Œé€šè¿‡ ES_HEAP_SIZE ç¯å¢ƒå˜é‡è®¾ç½®ã€‚</p>
<p>å†…å­˜äº¤æ¢åˆ°ç£ç›˜å¯¹æœåŠ¡å™¨æ€§èƒ½æ¥è¯´æ˜¯è‡´å‘½çš„ã€‚å¦‚æœå†…å­˜äº¤æ¢åˆ°ç£ç›˜ä¸Šï¼Œä¸€ä¸ª 100 å¾®ç§’çš„æ“ä½œå¯èƒ½å˜æˆ 10 æ¯«ç§’ã€‚ å†æƒ³æƒ³é‚£ä¹ˆå¤š 10 å¾®ç§’çš„æ“ä½œæ—¶å»¶ç´¯åŠ èµ·æ¥ã€‚ ä¸éš¾çœ‹å‡º swapping å¯¹äºæ€§èƒ½æ˜¯å¤šä¹ˆå¯æ€•ã€‚</p>
<p>Lucene ä½¿ç”¨äº†å¤§é‡çš„æ–‡ä»¶ã€‚åŒæ—¶ï¼Œ Elasticsearch åœ¨èŠ‚ç‚¹å’Œ HTTP å®¢æˆ·ç«¯ä¹‹é—´è¿›è¡Œé€šä¿¡ä¹Ÿä½¿ç”¨äº†å¤§é‡çš„å¥—æ¥å­—ã€‚ æ‰€æœ‰è¿™ä¸€åˆ‡éƒ½éœ€è¦è¶³å¤Ÿçš„æ–‡ä»¶æè¿°ç¬¦ã€‚ä½ åº”è¯¥å¢åŠ ä½ çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œè®¾ç½®ä¸€ä¸ªå¾ˆå¤§çš„å€¼ï¼Œå¦‚ 64,000ã€‚</p>
<h2 data-id="heading-13">GC æ–¹é¢ï¼Œåœ¨ä½¿ç”¨ Elasticsearch æ—¶è¦æ³¨æ„ä»€ä¹ˆï¼Ÿ</h2>
<p>å€’æ’è¯å…¸çš„ç´¢å¼•éœ€è¦å¸¸é©»å†…å­˜ï¼Œæ— æ³• GCï¼Œéœ€è¦ç›‘æ§ data node ä¸Š segment memory å¢é•¿è¶‹åŠ¿ã€‚</p>
<p>å„ç±»ç¼“å­˜ï¼Œ field cache, filter cache, indexing cache, bulk queue ç­‰ç­‰ï¼Œè¦è®¾ç½®åˆç†çš„å¤§å°ï¼Œå¹¶ä¸”è¦åº”è¯¥æ ¹æ®æœ€åçš„æƒ…å†µæ¥çœ‹ heap æ˜¯å¦å¤Ÿç”¨ï¼Œä¹Ÿå°±æ˜¯å„ç±»ç¼“å­˜å…¨éƒ¨å æ»¡çš„æ—¶å€™ï¼Œè¿˜æœ‰ heap ç©ºé—´å¯ä»¥åˆ†é…ç»™å…¶ä»–ä»»åŠ¡å—ï¼Ÿé¿å…é‡‡ç”¨ clear cache ç­‰â€œè‡ªæ¬ºæ¬ºäººâ€çš„æ–¹å¼æ¥é‡Šæ”¾å†…å­˜ã€‚</p>
<p>é¿å…è¿”å›å¤§é‡ç»“æœé›†çš„æœç´¢ä¸èšåˆã€‚ç¡®å®éœ€è¦å¤§é‡æ‹‰å–æ•°æ®çš„åœºæ™¯ï¼Œå¯ä»¥é‡‡ç”¨ scan &amp; scroll api æ¥å®ç°ã€‚</p>
<p>cluster stats é©»ç•™å†…å­˜å¹¶æ— æ³•æ°´å¹³æ‰©å±•ï¼Œè¶…å¤§è§„æ¨¡é›†ç¾¤å¯ä»¥è€ƒè™‘åˆ†æ‹†æˆå¤šä¸ªé›†ç¾¤é€šè¿‡ tribe node è¿æ¥ã€‚</p>
<p>æƒ³çŸ¥é“ heap å¤Ÿä¸å¤Ÿï¼Œå¿…é¡»ç»“åˆå®é™…åº”ç”¨åœºæ™¯ï¼Œå¹¶å¯¹é›†ç¾¤çš„ heap ä½¿ç”¨æƒ…å†µåšæŒç»­çš„ç›‘æ§ã€‚</p>
<h2 data-id="heading-14">å¦‚ä½•ç›‘æ§ Elasticsearch é›†ç¾¤çŠ¶æ€ï¼Ÿ</h2>
<ol>
<li>elasticsearch-head æ’ä»¶ã€‚</li>
<li>é€šè¿‡ Kibana ç›‘æ§ Elasticsearchã€‚ä½ å¯ä»¥å®æ—¶æŸ¥çœ‹ä½ çš„é›†ç¾¤å¥åº·çŠ¶æ€å’Œæ€§èƒ½ï¼Œä¹Ÿå¯ä»¥åˆ†æè¿‡å»çš„é›†ç¾¤ã€ç´¢å¼•å’ŒèŠ‚ç‚¹æŒ‡æ ‡</li>
</ol>
<h2 data-id="heading-15">æ˜¯å¦äº†è§£å­—å…¸æ ‘ï¼Ÿ</h2>
<p>å­—å…¸æ ‘åˆç§°å•è¯æŸ¥æ‰¾æ ‘ï¼Œ Trie æ ‘ï¼Œæ˜¯ä¸€ç§æ ‘å½¢ç»“æ„ï¼Œæ˜¯ä¸€ç§å“ˆå¸Œæ ‘çš„å˜ç§ã€‚å…¸å‹åº”ç”¨æ˜¯ç”¨äºç»Ÿè®¡ï¼Œæ’åºå’Œä¿å­˜å¤§é‡çš„å­—ç¬¦ä¸²ï¼ˆä½†ä¸ä»…é™äºå­—ç¬¦ä¸²ï¼‰ï¼Œæ‰€ä»¥ç»å¸¸è¢«æœç´¢å¼•æ“ç³»ç»Ÿç”¨äºæ–‡æœ¬è¯é¢‘ç»Ÿè®¡ã€‚å®ƒçš„ä¼˜ç‚¹æ˜¯ï¼šåˆ©ç”¨å­—ç¬¦ä¸²çš„å…¬å…±å‰ç¼€æ¥å‡å°‘æŸ¥è¯¢æ—¶é—´ï¼Œæœ€å¤§é™åº¦åœ°å‡å°‘æ— è°“çš„å­—ç¬¦ä¸²æ¯”è¾ƒï¼ŒæŸ¥è¯¢æ•ˆç‡æ¯”å“ˆå¸Œæ ‘é«˜ã€‚</p>
<p>Trie çš„æ ¸å¿ƒæ€æƒ³æ˜¯ç©ºé—´æ¢æ—¶é—´ï¼Œåˆ©ç”¨å­—ç¬¦ä¸²çš„å…¬å…±å‰ç¼€æ¥é™ä½æŸ¥è¯¢æ—¶é—´çš„å¼€é”€ä»¥è¾¾åˆ°æé«˜æ•ˆç‡çš„ç›®çš„ã€‚å®ƒæœ‰ 3 ä¸ªåŸºæœ¬æ€§è´¨ï¼š</p>
<p>æ ¹èŠ‚ç‚¹ä¸åŒ…å«å­—ç¬¦ï¼Œé™¤æ ¹èŠ‚ç‚¹å¤–æ¯ä¸€ä¸ªèŠ‚ç‚¹éƒ½åªåŒ…å«ä¸€ä¸ªå­—ç¬¦ã€‚</p>
<p>ä»æ ¹èŠ‚ç‚¹åˆ°æŸä¸€èŠ‚ç‚¹ï¼Œè·¯å¾„ä¸Šç»è¿‡çš„å­—ç¬¦è¿æ¥èµ·æ¥ï¼Œä¸ºè¯¥èŠ‚ç‚¹å¯¹åº”çš„å­—ç¬¦ä¸²ã€‚</p>
<p>æ¯ä¸ªèŠ‚ç‚¹çš„æ‰€æœ‰å­èŠ‚ç‚¹åŒ…å«çš„å­—ç¬¦éƒ½ä¸ç›¸åŒã€‚</p>
<p>å¯¹äºä¸­æ–‡çš„å­—å…¸æ ‘ï¼Œæ¯ä¸ªèŠ‚ç‚¹çš„å­èŠ‚ç‚¹ç”¨ä¸€ä¸ªå“ˆå¸Œè¡¨å­˜å‚¨ï¼Œè¿™æ ·å°±ä¸ç”¨æµªè´¹å¤ªå¤§çš„ç©ºé—´ï¼Œè€Œä¸”æŸ¥è¯¢é€Ÿåº¦ä¸Šå¯ä»¥ä¿ç•™å“ˆå¸Œçš„å¤æ‚åº¦ O(1)ã€‚</p>
<p>â€‹</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[åˆ©ç”¨ link rel="prefetch"ï¼šå¦‚ä½•è®©ç”¨æˆ·çš„é¡µé¢ç§’å¼€ï¼Ÿ]]></title>    <link>https://juejin.cn/post/7579175271680311306</link>    <guid>https://juejin.cn/post/7579175271680311306</guid>    <pubDate>2025-12-03T03:35:22.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7579175271680311306" data-draft-id="7579176524130730035" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="åˆ©ç”¨ link rel=&quot;prefetch&quot;ï¼šå¦‚ä½•è®©ç”¨æˆ·çš„é¡µé¢ç§’å¼€ï¼Ÿ"/> <meta itemprop="keywords" content="å‰ç«¯,JavaScript,æ€§èƒ½ä¼˜åŒ–"/> <meta itemprop="datePublished" content="2025-12-03T03:35:22.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ErpanOmer"/> <meta itemprop="url" content="https://juejin.cn/user/3878732754331096"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            åˆ©ç”¨ link rel="prefetch"ï¼šå¦‚ä½•è®©ç”¨æˆ·çš„é¡µé¢ç§’å¼€ï¼Ÿ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3878732754331096/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ErpanOmer
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-03T03:35:22.000Z" title="Wed Dec 03 2025 03:35:22 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-03
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»4åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c19b22f3579e40d4855176302bdf9bff~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRXJwYW5PbWVy:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765337721&amp;x-signature=oUn20WTRBW05%2B1yKlSsite1C6%2Fg%3D" alt="image.png" loading="lazy"/></p>
<p>å¤§å®¶å¥½ï¼Œæˆ‘åˆæ¥äº†ğŸ˜ã€‚</p>
<p>æˆ‘ä»¬åšæ€§èƒ½ä¼˜åŒ–ï¼Œé€šå¸¸ç›¯ç€çš„æ˜¯ <strong>é¦–å±åŠ è½½é€Ÿåº¦</strong>ï¼ˆFCP, LCPï¼‰ã€‚æˆ‘ä»¬å‹ç¼©å›¾ç‰‡ã€æ‹†åˆ†ä»£ç ï¼ˆCode Splittingï¼‰ã€ä¸ŠCDN... æ‹¼äº†è€å‘½æŠŠé¦–å±æ—¶é—´ä» 2s å‹åˆ°äº† 1sã€‚</p>
<p>ä½†æ˜¯ï¼Œç”¨æˆ·ç”¨èµ·æ¥è¿˜æ˜¯è§‰å¾—ä¸å¤Ÿå¿«ğŸ¤”ã€‚</p>
<p>ä¸ºä»€ä¹ˆï¼Ÿå› ä¸ºå½“ç”¨æˆ·ç‚¹å‡» <strong>ä¸‹ä¸€é¡µ</strong> æˆ–è€… <strong>æŸ¥çœ‹è¯¦æƒ…</strong> æ—¶ï¼Œé‚£ä¸ªè®¨åŒçš„ <strong>Loadingè½¬åœˆåœˆ</strong>åˆå‡ºç°äº†ã€‚å“ªæ€•åªæœ‰ 300msï¼Œé‚£ä¹Ÿæ˜¯ä¸€ç§<strong>æ‰“æ–­</strong>ã€‚</p>
<p>ä»Šå¤©ï¼Œæˆ‘æƒ³èŠä¸€ä¸ªè¢«å¾ˆå¤šäººä½ä¼°çš„å°æŠ€å·§â€”â€”<strong><code>prefetch</code>ï¼ˆé¢„è·å–ï¼‰</strong> ã€‚</p>
<p>æˆ‘ä¸æ”¹ä¸€è¡Œä¸šåŠ¡ä»£ç ï¼Œä¸é‡æ„æ¶æ„ï¼Œåªç”¨å‡ è¡Œä»£ç ï¼Œå°±è®©ç”¨æˆ·çš„ä¸‹ä¸€ä¸ªé¡µé¢å®ç°äº†<strong>ç§’å¼€</strong>ã€‚</p>
<hr/>
<h4 data-id="heading-0"><strong><code>preload</code> vs <code>prefetch</code></strong></h4>
<p>å¾ˆå¤šåŒå­¦çŸ¥é“<code>preload</code>ï¼Œä½†ç»å¸¸æŠŠå®ƒå’Œ<code>prefetch</code>ææ··ã€‚è¿™ä¿©è™½ç„¶é•¿å¾—åƒï¼Œä½†ä½œç”¨å®Œå…¨ä¸åŒï¼š</p>
<ul>
<li>
<p><strong><code>preload</code> (é¢„åŠ è½½)</strong> ï¼š <strong>æˆ‘ç°åœ¨çš„é¡µé¢é©¬ä¸Šå°±è¦ç”¨ï¼</strong></p>
<ul>
<li><strong>ä¼˜å…ˆçº§</strong>ï¼šHighã€‚</li>
<li><strong>åœºæ™¯</strong>ï¼šå½“å‰é¡µé¢çš„å…³é”®å­—ä½“ã€é¦–å±çš„æ ¸å¿ƒCSS/JSã€‚</li>
<li>å¦‚æœä½ ä¸ç”¨ï¼Œå½“å‰é¡µé¢ä¼šæ¸²æŸ“é˜»å¡æˆ–é—ªåŠ¨ã€‚</li>
</ul>
</li>
<li>
<p><strong><code>prefetch</code> (é¢„è·å–)</strong> ï¼š <strong>æˆ‘ç°åœ¨é—²ç€ä¹Ÿæ˜¯é—²ç€ï¼Œå¸®æˆ‘æŠŠä¸‹ä¸€ä¸ªé¡µé¢çš„ä¸œè¥¿å…ˆä¸‹è½½ä¸‹æ¥å‘—ï¼Ÿ</strong></p>
<ul>
<li><strong>ä¼˜å…ˆçº§</strong>ï¼šLow (æµè§ˆå™¨ä¼šåœ¨ç½‘ç»œç©ºé—²ï¼ˆIdleï¼‰æ—¶æ‰å»ä¸‹è½½)ã€‚</li>
<li><strong>åœºæ™¯</strong>ï¼š<strong>ä¸‹ä¸€ä¸ªé¡µé¢</strong>å¯èƒ½éœ€è¦çš„ JS Chunkã€CSS æˆ–å›¾ç‰‡ã€‚</li>
<li>å³ä½¿ç”¨æˆ·æ²¡å»ä¸‹ä¸€ä¸ªé¡µé¢ï¼Œä¹Ÿä¸å½±å“å½“å‰é¡µé¢çš„ä½“éªŒï¼Œé¡¶å¤šæµªè´¹ä¸€ç‚¹ç‚¹æµé‡ã€‚</li>
</ul>
</li>
</ul>
<p><strong>æˆ‘ä»¬ç°åœ¨èŠçš„ï¼Œæ ¸å¿ƒå°±æ˜¯åˆ©ç”¨<code>prefetch</code>ï¼Œåˆ©ç”¨ç”¨æˆ·æ€è€ƒã€æ»‘åŠ¨é¼ æ ‡çš„é‚£äº›åƒåœ¾æ—¶é—´ï¼Œå·å·æŠŠä¸‹ä¸€ä¸ªé¡µé¢çš„èµ„æºåŠ è½½å¥½ã€‚</strong></p>
<hr/>
<h4 data-id="heading-1"><strong>è®©è¯¦æƒ…é¡µç¬é—´å‡ºç°</strong></h4>
<p>å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ª<strong>å•†å“åˆ—è¡¨é¡µ</strong>ï¼Œç”¨æˆ·å¾ˆæœ‰å¯èƒ½ä¼šç‚¹å‡»ç¬¬ä¸€ä¸ªå•†å“è¿›å…¥<strong>è¯¦æƒ…é¡µ</strong>ã€‚</p>
<p>åœ¨ React/Vue çš„å•é¡µåº”ç”¨ï¼ˆSPAï¼‰ä¸­ï¼Œè¿›å…¥è¯¦æƒ…é¡µé€šå¸¸æ„å‘³ç€è¦åŠ è½½ä¸€ä¸ª<code>Detail.chunk.js</code>ã€‚å¦‚æœç­‰ç”¨æˆ·ç‚¹å‡»äº†å†åŠ è½½ï¼Œé‚£å¿…ç„¶æœ‰å‡ ç™¾æ¯«ç§’çš„ç™½å±ã€‚</p>
<p><strong>æˆ‘çš„åšæ³•æ˜¯è¿™æ ·çš„ï¼š</strong></p>
<p>å½“æ£€æµ‹åˆ°ç”¨æˆ·çš„<strong>é¼ æ ‡ç§»åŠ¨åˆ°</strong>æŸä¸ªå•†å“å¡ç‰‡ä¸Šï¼ˆæˆ–è€…<strong>æ»šåŠ¨åˆ°</strong>å¯è§†åŒºåŸŸæ—¶ï¼‰ï¼Œæˆ‘å°±çŒœï¼šå˜¿ï¼Œè¿™å“¥ä»¬å¯èƒ½è¦ç‚¹è¿›å»äº†ğŸ¤£ã€‚</p>
<p>è¿™æ—¶å€™ï¼Œæˆ‘ç«‹åˆ»åœ¨<code>&lt;head&gt;</code>é‡ŒåŠ¨æ€æ’å…¥ä¸€ä¸ª<code>prefetch</code>æ ‡ç­¾ï¼š</p>
<pre><code class="hljs language-JavaScript" lang="JavaScript"><span class="hljs-comment">// é¢„è·å–ä¸‹ä¸€ä¸ªé¡µé¢çš„ JS èµ„æº</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">prefetcher</span> = (<span class="hljs-params">url</span>) =&gt; {
  <span class="hljs-keyword">const</span> link = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createElement</span>(<span class="hljs-string">'link'</span>);
  link.<span class="hljs-property">rel</span> = <span class="hljs-string">'prefetch'</span>;
  link.<span class="hljs-property">href</span> = url;
  <span class="hljs-variable language_">document</span>.<span class="hljs-property">head</span>.<span class="hljs-title function_">appendChild</span>(link);
};

<span class="hljs-comment">// æ¨¡æ‹Ÿï¼šé¼ æ ‡ç§»å…¥å•†å“å¡ç‰‡æ—¶è§¦å‘</span>
<span class="hljs-comment">// åœ¨ Webpack/Vite é¡¹ç›®ä¸­ï¼Œä½ é€šå¸¸èƒ½é€šè¿‡ manifest æ‰¾åˆ°å¯¹åº”è·¯ç”±çš„ chunk åœ°å€</span>
card.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'mouseenter'</span>, <span class="hljs-function">() =&gt;</span> {
  <span class="hljs-title function_">prefetcher</span>(<span class="hljs-string">'/assets/ProductDetail.23a9c.js'</span>);
  <span class="hljs-title function_">prefetcher</span>(<span class="hljs-string">'/assets/ProductDetail.css'</span>);
});
</code></pre>
<p><strong>å‘ç”Ÿäº†ä»€ä¹ˆï¼Ÿ</strong></p>
<ol>
<li>ç”¨æˆ·é¼ æ ‡æ‚¬åœï¼ˆhoverï¼‰éœ€è¦ 200ms~500ms æ‰ä¼šç‚¹å‡»ã€‚</li>
<li>æµè§ˆå™¨åˆ©ç”¨è¿™å‡ ç™¾æ¯«ç§’çš„ç©ºé—²ï¼Œ<strong>å·²ç»åœ¨åå°æŠŠ<code>ProductDetail.js</code>ä¸‹è½½å¥½äº†</strong>ï¼Œå¹¶æ”¾è¿›äº†<strong>HTTP ç¼“å­˜ï¼ˆDisk Cacheï¼‰</strong> ã€‚</li>
<li>å½“ç”¨æˆ·çœŸçš„ç‚¹å‡»æ—¶ï¼Œè·¯ç”±è·³è½¬ï¼Œè¯·æ±‚èµ„æº -&gt; <strong>æµè§ˆå™¨å‘ç°ç¼“å­˜é‡Œæœ‰ -&gt; ç›´æ¥ä»ç£ç›˜è¯»å– -&gt; è€—æ—¶ 0msï¼</strong></li>
</ol>
<p>ç”¨æˆ·æ„Ÿè§‰å°±æ˜¯ï¼š<strong>æ‰‹æŒ‡åˆšè½ä¸‹ï¼Œé¡µé¢å°±ç °åœ°ä¸€ä¸‹å‡ºæ¥äº†ã€‚</strong> è¿™ç§çˆ½å¿«æ„Ÿï¼Œæ˜¯ä»»ä½•ä»£ç å‹ç¼©éƒ½ç»™ä¸äº†çš„ã€‚</p>
<hr/>
<h4 data-id="heading-2"><strong>è‡ªåŠ¨åŒ– <code>quicklink</code></strong></h4>
<p>æ‰‹åŠ¨å†™<code>mouseenter</code>å¤ªç´¯äº†ï¼Œè€Œä¸”æˆ‘æ€ä¹ˆçŸ¥é“æ‰“åŒ…åçš„æ–‡ä»¶åå«å•¥ï¼Ÿ</p>
<p align="center"><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2520d17a79e843e2b2a7c5090cf1a5ea~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRXJwYW5PbWVy:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765337721&amp;x-signature=2s%2FPZM3218Bh4BI09gsO4lzn3AI%3D" alt="image.png" loading="lazy"/></p>
<p>Google Chrome å›¢é˜Ÿæ—©å°±æƒ³åˆ°äº†ï¼Œä»–ä»¬å¼€æºäº†ä¸€ä¸ªç¥å™¨å« <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FGoogleChromeLabs%2Fquicklink" target="_blank" title="https://github.com/GoogleChromeLabs/quicklink" ref="nofollow noopener noreferrer"><strong><code>quicklink</code></strong></a>ã€‚</p>
<p>å®ƒçš„åŸç†æå…¶ç®€å•ä¸”æš´åŠ›ï¼š</p>
<p>æ£€æµ‹è§†å£ï¼ˆViewportï¼‰å†…çš„é“¾æ¥ï¼Œè‡ªåŠ¨ç»™å®ƒä»¬åŠ ä¸Šprefetchã€‚</p>
<pre><code class="hljs language-JavaScript" lang="JavaScript"><span class="hljs-comment">// 1. å®‰è£…</span>
<span class="hljs-comment">// npm install quicklink</span>

<span class="hljs-comment">// 2. åœ¨ä½ çš„é¡µé¢åŠ è½½å®Œæˆåè°ƒç”¨</span>
<span class="hljs-keyword">import</span> { listen } <span class="hljs-keyword">from</span> <span class="hljs-string">'quicklink'</span>;

<span class="hljs-title function_">listen</span>({
  <span class="hljs-comment">// é€‰é¡¹ï¼šåªåœ¨ç½‘ç»œç¯å¢ƒå¥½çš„æ—¶å€™é¢„å– (é»˜è®¤å°±æ˜¯è¿™æ ·)</span>
  <span class="hljs-comment">// é€‰é¡¹ï¼šé™åˆ¶é¢„å–çš„æ•°é‡ï¼Œé˜²æ­¢æµªè´¹æµé‡</span>
  <span class="hljs-attr">limit</span>: <span class="hljs-number">5</span> 
});
</code></pre>
<p>åªè¦è¿™ä¸€è¡Œä»£ç ï¼</p>
<p>å½“ç”¨æˆ·æ»šåŠ¨åˆ—è¡¨æ—¶ï¼Œè¿›å…¥è§†å£çš„é‚£äº›å•†å“é“¾æ¥å¯¹åº”çš„ JS/CSS èµ„æºï¼Œå°±ä¼šè¢«è‡ªåŠ¨é™é»˜ä¸‹è½½ã€‚ç”¨æˆ·ç‚¹å“ªä¸ªï¼Œå“ªä¸ªå°±æ˜¯ç§’å¼€ã€‚</p>
<p><strong>Next.js çš„ <a href="https://link.juejin.cn?target=https%3A%2F%2Fnextjs.org%2Fdocs%2Fpages%2Fapi-reference%2Fcomponents%2Flink" target="_blank" title="https://nextjs.org/docs/pages/api-reference/components/link" ref="nofollow noopener noreferrer"><code>&lt;Link&gt;</code></a> ç»„ä»¶ï¼Œé»˜è®¤å°±å†…ç½®äº†ç±»ä¼¼çš„åŠŸèƒ½ã€‚</strong> è¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆ Next.js åº”ç”¨é€šå¸¸æ„Ÿè§‰æ¯”æ™®é€š React åº”ç”¨å¿«çš„åŸå› ä¹‹ä¸€ã€‚</p>
<hr/>
<h4 data-id="heading-3"><strong>ä½† <code>prefetch</code> ä¹Ÿä¸æ˜¯ä¸‡èƒ½çš„</strong></h4>
<p>è™½ç„¶å®ƒå¾ˆçˆ½ï¼Œä½†ä½œä¸ºä¸€ä¸ªè´Ÿè´£ä»»çš„å·¥ç¨‹å¸ˆï¼Œæˆ‘å¿…é¡»å‘Šè¯‰ä½ å‡ ä¸ªå‘ğŸ˜–ï¼š</p>
<ol>
<li>å¿…é¡»é…åˆæ­£ç¡®çš„ç¼“å­˜ç­–ç•¥ (Cache-Control)</li>
</ol>
<p>prefetch ä¸‹è½½çš„èµ„æºæ˜¯æ”¾åœ¨ HTTP ç¼“å­˜é‡Œçš„ã€‚å¦‚æœä½ çš„æœåŠ¡å™¨è®¾ç½®äº†Cache-Control: no-storeï¼Œé‚£ç”¨æˆ·ç‚¹å‡»æ—¶ï¼Œæµè§ˆå™¨è¿˜æ˜¯ä¼šé‡æ–°å‘è¯·æ±‚ï¼Œä½ çš„é¢„è·å–å°±ç™½åšäº†ã€‚ç¡®ä¿ä½ çš„é™æ€èµ„æºæœ‰é•¿ç¼“å­˜ï¼ˆMax-Ageï¼‰ç­–ç•¥ã€‚</p>
<ol start="2">
<li>åˆ«é¢„å– API æ¥å£ (æ…ç”¨ğŸ˜­)</li>
</ol>
<p>æœ‰äº›äººæƒ³è¿ API æ•°æ®ä¹Ÿé¢„å–ã€‚è¿™å¾ˆå±é™©ã€‚å› ä¸ºæ•°æ®çš„æ—¶æ•ˆæ€§å¾ˆéš¾ä¿è¯ã€‚ä½ é¢„å–äº†åº“å­˜ä¸º1ï¼Œç”¨æˆ·ç‚¹è¿›å»æ—¶å¯èƒ½å·²ç»å–å…‰äº†ã€‚é™¤éæ˜¯é™æ€åšå®¢ç±»çš„å†…å®¹ï¼Œå¦åˆ™åªå»ºè®®é¢„å– JS/CSS/å›¾ç‰‡ ç­‰é™æ€èµ„æºã€‚</p>
<ol start="3">
<li>ç§»åŠ¨ç«¯çœæµæ¨¡å¼</li>
</ol>
<p>åœ¨ç§»åŠ¨ç«¯ï¼Œæµé‡å°±æ˜¯é’±ã€‚æµè§ˆå™¨é€šå¸¸æ¯”è¾ƒæ™ºèƒ½ï¼Œåœ¨çœæµæ¨¡å¼æˆ–å¼±ç½‘ä¸‹ï¼Œä¼šå¿½ç•¥prefetchæŒ‡ä»¤ã€‚æˆ‘ä»¬åœ¨åšæ‰‹åŠ¨å®ç°æ—¶ï¼Œä¹Ÿå¯ä»¥é€šè¿‡ navigator.connection.saveData æ¥åˆ¤æ–­ï¼Œå¦‚æœæ˜¯çœæµæ¨¡å¼ï¼Œå°±åˆ«é¢„å–äº†ï¼Œåšä¸ªå¥½äººğŸ˜‚ã€‚</p>
<hr/>
<p>æ€§èƒ½ä¼˜åŒ–ï¼Œä¸ä»…ä»…æ˜¯<strong>æŠŠèµ„æºåšå°</strong>ï¼Œæ›´æ˜¯<strong>å¯¹ç”¨æˆ·è¡Œä¸ºçš„ä¸€ç§é¢„åˆ¤</strong>ã€‚</p>
<p>ç”¨ <code>link rel="prefetch"</code> ï¼Œå½“ä½ è¿˜åœ¨è‹¦å“ˆå“ˆåœ°æŠ é‚£ 10kb çš„æ‰“åŒ…ä½“ç§¯æ—¶ï¼Œä¸å¦¨è¯•è¯•è¿™ä¸ªæŠ€å·§ï¼Œè¯´ä¸å®šä½ çš„ç½‘ç«™ä¼šé£èµ·æ¥ã€‚</p>
<p>æœ‰æ—¶å€™ï¼Œ<strong>è®©ç”¨æˆ·æ„Ÿè§‰å¿«ï¼Œæ¯”çœŸçš„å¿«ï¼Œæ›´é‡è¦ã€‚</strong></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/73991325fd7741dbba454ec0c340ec8a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRXJwYW5PbWVy:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765337721&amp;x-signature=msdN2JgKcEtfmmQ%2F2I4auwdygMM%3D" alt="è°¢è°¢å¤§å®¶.gif" loading="lazy"/></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[é¢è¯•å®æˆ˜ï¼šå¦‚ä½•å®ç°ä¸€ä¸ªå®Œæ•´çš„é¡¹ç›®ä»æ³¨å†Œåˆ°ç™»å½•çš„åŠŸèƒ½ï¼Ÿ]]></title>    <link>https://juejin.cn/post/7579179741824237594</link>    <guid>https://juejin.cn/post/7579179741824237594</guid>    <pubDate>2025-12-03T03:35:19.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7579179741824237594" data-draft-id="7579192114828214299" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="é¢è¯•å®æˆ˜ï¼šå¦‚ä½•å®ç°ä¸€ä¸ªå®Œæ•´çš„é¡¹ç›®ä»æ³¨å†Œåˆ°ç™»å½•çš„åŠŸèƒ½ï¼Ÿ"/> <meta itemprop="keywords" content="åç«¯,é¢è¯•,æ¶æ„"/> <meta itemprop="datePublished" content="2025-12-03T03:35:19.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="360_go_php"/> <meta itemprop="url" content="https://juejin.cn/user/2436173498956695"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            é¢è¯•å®æˆ˜ï¼šå¦‚ä½•å®ç°ä¸€ä¸ªå®Œæ•´çš„é¡¹ç›®ä»æ³¨å†Œåˆ°ç™»å½•çš„åŠŸèƒ½ï¼Ÿ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2436173498956695/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    360_go_php
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-03T03:35:19.000Z" title="Wed Dec 03 2025 03:35:19 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-03
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»6åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>â€‹</p>
<p>åœ¨ç°ä»£Webå¼€å‘ä¸­ï¼Œæ„å»ºä¸€ä¸ªç¨³å®šã€å®‰å…¨ä¸”æ˜“äºç»´æŠ¤çš„é¡¹ç›®æ˜¯æ¯ä¸ªå¼€å‘è€…çš„ç›®æ ‡ã€‚é¢è¯•ä¸­ï¼Œå¾ˆå¤šé—®é¢˜ä¼šå›´ç»•é¡¹ç›®çš„åŠŸèƒ½å®ç°ã€å®‰å…¨æ€§ä»¥åŠéƒ¨ç½²ç­‰æ–¹é¢å±•å¼€ã€‚æœ¬æ–‡å°†é€šè¿‡å®é™…æ¡ˆä¾‹ï¼Œè¯¦ç»†è®¨è®ºå¦‚ä½•å®ç°ä¸€ä¸ªé¡¹ç›®çš„æ³¨å†Œã€ç™»å½•ã€ç”¨æˆ·å”¯ä¸€æ€§éªŒè¯ç­‰å¸¸è§åŠŸèƒ½ï¼Œå¹¶å›ç­”ä¸€äº›é¢è¯•ä¸­å¸¸è§çš„ç›¸å…³é—®é¢˜ã€‚</p>
<h3 data-id="heading-0">1. <strong>å¦‚ä½•å®ç°é¡¹ç›®çš„æ³¨å†Œé—®é¢˜ï¼Ÿ</strong><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/67946722368f48a3af057979767ad6a8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgMzYwX2dvX3BocA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765337719&amp;x-signature=4RvyEYf8%2BX1ORnUnsAWpS6DiEwc%3D" alt="" loading="lazy"/><img src="" alt="" title="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨" loading="lazy"/>â€‹ç¼–è¾‘</h3>
<p>æ³¨å†ŒåŠŸèƒ½æ˜¯æ¯ä¸ªWebåº”ç”¨çš„åŸºç¡€åŠŸèƒ½ä¹‹ä¸€ï¼Œé€šå¸¸åŒ…æ‹¬ç”¨æˆ·è¾“å…¥åŸºæœ¬ä¿¡æ¯ï¼ˆå¦‚ç”¨æˆ·åã€å¯†ç ã€é‚®ç®±ç­‰ï¼‰ï¼Œç„¶åå°†å…¶å­˜å‚¨åˆ°æ•°æ®åº“ä¸­ã€‚åœ¨å®ç°é¡¹ç›®æ³¨å†Œæ—¶ï¼Œéœ€è¦è€ƒè™‘ä»¥ä¸‹å‡ ä¸ªè¦ç‚¹ï¼š</p>
<h4 data-id="heading-1">(1) <strong>ç”¨æˆ·è¾“å…¥éªŒè¯</strong></h4>
<p>æ³¨å†Œé¡µé¢é¦–å…ˆè¦éªŒè¯ç”¨æˆ·è¾“å…¥çš„æœ‰æ•ˆæ€§ï¼Œç¡®ä¿ç”¨æˆ·åã€å¯†ç ç­‰å­—æ®µç¬¦åˆè§„å®šçš„æ ¼å¼ã€‚ä¾‹å¦‚ï¼š</p>
<ul>
<li>ç”¨æˆ·åé•¿åº¦æ˜¯å¦ç¬¦åˆè¦æ±‚ï¼ˆå¦‚ï¼š6-16ä¸ªå­—ç¬¦ï¼‰ï¼›</li>
<li>å¯†ç æ˜¯å¦ç¬¦åˆå¼ºåº¦è¦æ±‚ï¼ˆå¦‚ï¼šåŒ…å«æ•°å­—ã€å­—æ¯ã€ç‰¹æ®Šå­—ç¬¦ï¼Œé•¿åº¦8-16ä½ï¼‰ï¼›<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9db8a804b69b4e5faf12d367e47687d4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgMzYwX2dvX3BocA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765337719&amp;x-signature=%2FKpThPiAdGeAuiO4IHZE2Z95JHo%3D" alt="" loading="lazy"/><img src="" alt="" title="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨" loading="lazy"/>â€‹ç¼–è¾‘</li>
<li>é‚®ç®±æ ¼å¼æ˜¯å¦æ­£ç¡®ã€‚</li>
</ul>
<h4 data-id="heading-2">(2) <strong>ç”¨æˆ·å”¯ä¸€æ€§æ£€éªŒ</strong></h4>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5fe4dc6d1bce49f6ac1db8d922e32b18~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgMzYwX2dvX3BocA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765337719&amp;x-signature=kRT7KcqCt8qP9tQT%2FI%2BHLqaGPGY%3D" alt="" loading="lazy"/><img src="" alt="" title="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨" loading="lazy"/>â€‹ç¼–è¾‘ä¸ºäº†ç¡®ä¿æ¯ä¸ªç”¨æˆ·çš„å”¯ä¸€æ€§ï¼Œé€šå¸¸ä¼šæ£€æŸ¥æ•°æ®åº“ä¸­æ˜¯å¦å·²å­˜åœ¨è¯¥ç”¨æˆ·çš„ç”¨æˆ·åæˆ–é‚®ç®±ã€‚å¯ä»¥åœ¨æ³¨å†Œä¹‹å‰æ‰§è¡Œä»¥ä¸‹æ“ä½œï¼š</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># ä¼ªä»£ç   </span>
<span class="hljs-keyword">if</span> db.query(<span class="hljs-string">"SELECT * FROM users WHERE username = ?"</span>, username):  
Â  Â  <span class="hljs-keyword">raise</span> ValueError(<span class="hljs-string">"ç”¨æˆ·åå·²å­˜åœ¨"</span>)

<span class="hljs-keyword">if</span> db.query(<span class="hljs-string">"SELECT * FROM users WHERE email = ?"</span>, email):  
Â  Â  <span class="hljs-keyword">raise</span> ValueError(<span class="hljs-string">"é‚®ç®±å·²è¢«æ³¨å†Œ"</span>)  
</code></pre>
<h4 data-id="heading-3">(3) <strong>å¯†ç åŠ å¯†å­˜å‚¨</strong></h4>
<p>ä¸ºé˜²æ­¢ç”¨æˆ·å¯†ç æ³„æ¼ï¼Œå¯†ç åœ¨å­˜å‚¨å‰éœ€è¦è¿›è¡ŒåŠ å¯†ã€‚å¸¸è§çš„åŠ å¯†æ–¹å¼æ˜¯ä½¿ç”¨å“ˆå¸Œç®—æ³•ï¼ˆå¦‚MD5ã€SHA256ã€bcryptç­‰ï¼‰ï¼ŒåŒæ—¶ç»“åˆç›å€¼ï¼ˆSaltï¼‰å¢å¼ºå¯†ç çš„å®‰å…¨æ€§ã€‚</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> hashlib  
<span class="hljs-keyword">import</span> os

<span class="hljs-comment"># ç”Ÿæˆç›å€¼  </span>
salt = os.urandom(<span class="hljs-number">16</span>)  
<span class="hljs-comment"># å¯¹å¯†ç è¿›è¡Œå“ˆå¸ŒåŠ å¯†  </span>
hashed_password = hashlib.sha256(salt + password.encode()).hexdigest()  
</code></pre>
<h4 data-id="heading-4">(4) <strong>æ•°æ®åº“è®¾è®¡</strong></h4>
<p>åœ¨æ•°æ®åº“ä¸­ï¼Œ<code>users</code>è¡¨å¯èƒ½åŒ…å«ä»¥ä¸‹å­—æ®µï¼š</p>
<ul>
<li><code>id</code>ï¼ˆä¸»é”®ï¼Œè‡ªå¢é•¿ï¼‰</li>
<li><code>username</code>ï¼ˆå”¯ä¸€ï¼‰</li>
<li><code>password_hash</code>ï¼ˆåŠ å¯†åçš„å¯†ç ï¼‰</li>
<li><code>salt</code>ï¼ˆç›å€¼ï¼‰</li>
<li><code>email</code>ï¼ˆå”¯ä¸€ï¼‰</li>
<li><code>created_at</code>ï¼ˆç”¨æˆ·æ³¨å†Œæ—¶é—´ï¼‰</li>
</ul>
<h3 data-id="heading-5">2. <strong>é¡¹ç›®å¦‚ä½•å®ç°ç”¨æˆ·å”¯ä¸€æ€§æ£€éªŒï¼Ÿ</strong></h3>
<p>åœ¨é¡¹ç›®ä¸­ï¼Œç¡®ä¿ç”¨æˆ·å”¯ä¸€æ€§æ˜¯é˜²æ­¢é‡å¤æ³¨å†Œçš„å…³é”®ã€‚ä¸ºæ­¤ï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹å‡ ç§æ–¹æ³•è¿›è¡Œç”¨æˆ·å”¯ä¸€æ€§æ£€éªŒï¼š</p>
<h4 data-id="heading-6">(1) <strong>æ•°æ®åº“å”¯ä¸€æ€§çº¦æŸ</strong></h4>
<p>é€šè¿‡åœ¨æ•°æ®åº“å±‚é¢å¢åŠ å”¯ä¸€æ€§çº¦æŸæ¥é˜²æ­¢ç”¨æˆ·é‡å¤æ³¨å†Œã€‚åœ¨<code>users</code>è¡¨ä¸­ï¼Œå¯ä»¥ä¸º<code>username</code>å’Œ<code>email</code>å­—æ®µåˆ†åˆ«è®¾ç½®å”¯ä¸€ç´¢å¼•ã€‚</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> users (  
Â  Â  id <span class="hljs-type">INT</span> <span class="hljs-keyword">PRIMARY</span> KEY AUTO_INCREMENT,  
Â  Â  username <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">50</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">UNIQUE</span>,  
Â  Â  email <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">100</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">UNIQUE</span>,  
Â  Â  password_hash <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">255</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,  
Â  Â  salt <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">16</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,  
Â  Â  created_at <span class="hljs-type">TIMESTAMP</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span>  
);  
</code></pre>
<h4 data-id="heading-7">(2) <strong>åº”ç”¨å±‚æ£€éªŒ</strong></h4>
<p>åœ¨ç”¨æˆ·æäº¤æ³¨å†Œè¯·æ±‚æ—¶ï¼Œåå°åº”ç”¨ç¨‹åºä¼šå…ˆåœ¨æ•°æ®åº“ä¸­æŸ¥æ‰¾æ˜¯å¦å·²ç»å­˜åœ¨ç›¸åŒçš„ç”¨æˆ·åæˆ–é‚®ç®±ã€‚é€šè¿‡è¿™ç§æ–¹å¼ï¼Œç¡®ä¿åœ¨é€»è¾‘ä¸Šä¸å…è®¸é‡å¤æ³¨å†Œã€‚</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># å‡è®¾ä½¿ç”¨Python + SQLAlchemyæ¡†æ¶  </span>
<span class="hljs-keyword">from</span> sqlalchemy.orm.exc <span class="hljs-keyword">import</span> NoResultFound

<span class="hljs-keyword">def</span> <span class="hljs-title function_">check_user_exists</span>(<span class="hljs-params">username, email</span>):  
Â  Â  <span class="hljs-keyword">try</span>:  
Â  Â  Â  Â  user = db.session.query(User).filter_by(username=username).first()  
Â  Â  Â  Â  <span class="hljs-keyword">if</span> user:  
Â  Â  Â  Â  Â  Â  <span class="hljs-keyword">raise</span> ValueError(<span class="hljs-string">"ç”¨æˆ·åå·²å­˜åœ¨"</span>)  
Â  Â  Â  Â Â   
Â  Â  Â  Â  user = db.session.query(User).filter_by(email=email).first()  
Â  Â  Â  Â  <span class="hljs-keyword">if</span> user:  
Â  Â  Â  Â  Â  Â  <span class="hljs-keyword">raise</span> ValueError(<span class="hljs-string">"é‚®ç®±å·²è¢«æ³¨å†Œ"</span>)  
Â  Â  Â  Â Â   
Â  Â  Â  Â  <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span>  
Â  Â  <span class="hljs-keyword">except</span> NoResultFound:  
Â  Â  Â  Â  <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span>  
</code></pre>
<h4 data-id="heading-8">(3) <strong>ç¼“å­˜å±‚ï¼ˆå¦‚Redisï¼‰</strong></h4>
<p>åœ¨æŸäº›é«˜å¹¶å‘åœºæ™¯ä¸­ï¼Œä¸ºäº†æé«˜ç”¨æˆ·å”¯ä¸€æ€§æ£€éªŒçš„æ•ˆç‡ï¼Œå¯ä»¥ä½¿ç”¨ç¼“å­˜å±‚ï¼ˆå¦‚Redisï¼‰æ¥è¿›è¡Œå»é‡ã€‚é€šè¿‡ç¼“å­˜å¯ä»¥åœ¨çŸ­æ—¶é—´å†…é¿å…é‡å¤è¯·æ±‚é€ æˆçš„æ•°æ®åº“æŸ¥è¯¢è´Ÿæ‹…ã€‚</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> redis

redis_client = redis.StrictRedis(host=<span class="hljs-string">'localhost'</span>, port=<span class="hljs-number">6379</span>, db=<span class="hljs-number">0</span>)

<span class="hljs-keyword">def</span> <span class="hljs-title function_">is_user_registered</span>(<span class="hljs-params">username, email</span>):  
Â  Â  <span class="hljs-keyword">if</span> redis_client.exists(<span class="hljs-string">f"username:<span class="hljs-subst">{username}</span>"</span>) <span class="hljs-keyword">or</span> redis_client.exists(<span class="hljs-string">f"email:<span class="hljs-subst">{email}</span>"</span>):  
Â  Â  Â  Â  <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span>  
Â  Â  <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span>

<span class="hljs-keyword">def</span> <span class="hljs-title function_">register_user</span>(<span class="hljs-params">username, email</span>):  
Â  Â  <span class="hljs-keyword">if</span> is_user_registered(username, email):  
Â  Â  Â  Â  <span class="hljs-comment"># æ³¨å†Œæµç¨‹  </span>
Â  Â  Â  Â  redis_client.<span class="hljs-built_in">set</span>(<span class="hljs-string">f"username:<span class="hljs-subst">{username}</span>"</span>, <span class="hljs-string">"1"</span>, ex=<span class="hljs-number">3600</span>) Â <span class="hljs-comment"># è®¾ç½®1å°æ—¶è¿‡æœŸ  </span>
Â  Â  Â  Â  redis_client.<span class="hljs-built_in">set</span>(<span class="hljs-string">f"email:<span class="hljs-subst">{email}</span>"</span>, <span class="hljs-string">"1"</span>, ex=<span class="hljs-number">3600</span>) Â <span class="hljs-comment"># è®¾ç½®1å°æ—¶è¿‡æœŸ  </span>
</code></pre>
<h3 data-id="heading-9">3. <strong>é¡¹ç›®å¦‚ä½•å®ç°éƒ¨ç½²ï¼Ÿ</strong></h3>
<p>éƒ¨ç½²æ˜¯å°†å¼€å‘å®Œæˆçš„é¡¹ç›®ä¸Šçº¿åˆ°æœåŠ¡å™¨çš„è¿‡ç¨‹ã€‚å¸¸è§çš„éƒ¨ç½²æ–¹å¼æœ‰ä»¥ä¸‹å‡ ç§ï¼š</p>
<h4 data-id="heading-10">(1) <strong>ä¼ ç»Ÿéƒ¨ç½²</strong></h4>
<p>ä¼ ç»Ÿéƒ¨ç½²é€šå¸¸åŒ…æ‹¬ä»¥ä¸‹æ­¥éª¤ï¼š</p>
<ul>
<li>å°†é¡¹ç›®ä»£ç ä¸Šä¼ åˆ°æœåŠ¡å™¨ï¼ˆå¯ä»¥ä½¿ç”¨FTPã€SCPç­‰å·¥å…·ï¼‰ï¼›</li>
<li>é…ç½®WebæœåŠ¡å™¨ï¼ˆå¦‚Nginxã€Apacheï¼‰ä»¥æä¾›é™æ€æ–‡ä»¶æœåŠ¡å¹¶ä»£ç†åŠ¨æ€è¯·æ±‚ï¼›</li>
<li>é…ç½®æ•°æ®åº“ï¼ˆå¦‚MySQLã€PostgreSQLï¼‰ï¼›</li>
<li>é…ç½®è´Ÿè½½å‡è¡¡ã€è‡ªåŠ¨åŒ–è„šæœ¬ç­‰ã€‚</li>
</ul>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># åœ¨æœåŠ¡å™¨ä¸Šéƒ¨ç½²  </span>
scp -r /path/to/project user@server:/var/www/project  
ssh user@server  
<span class="hljs-built_in">cd</span> /var/www/project  
<span class="hljs-comment"># å¯åŠ¨åç«¯åº”ç”¨  </span>
python3 app.py  
</code></pre>
<h4 data-id="heading-11">(2) <strong>å®¹å™¨åŒ–éƒ¨ç½²ï¼ˆDockerï¼‰</strong></h4>
<p>ç°ä»£éƒ¨ç½²é€šå¸¸é‡‡ç”¨å®¹å™¨åŒ–æŠ€æœ¯ï¼ˆå¦‚Dockerï¼‰è¿›è¡Œéƒ¨ç½²ï¼Œè¿™æ ·å¯ä»¥åœ¨ä¸åŒç¯å¢ƒä¸­ä¿è¯ä¸€è‡´æ€§ã€‚</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># Dockerfile ç¤ºä¾‹  </span>
FROM python:3.9-slim  
WORKDIR /app  
COPY . /app  
RUN pip install -r requirements.txt  
CMD [<span class="hljs-string">"python"</span>, <span class="hljs-string">"app.py"</span>]  
</code></pre>
<p>ä½¿ç”¨Docker Composeè¿›è¡Œå¤šå®¹å™¨ç®¡ç†ï¼š</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">version:</span> <span class="hljs-string">'3'</span>  
<span class="hljs-attr">services:</span>  
Â  <span class="hljs-attr">app:</span>  
Â  Â  <span class="hljs-attr">build:</span> <span class="hljs-string">.</span>  
Â  Â  <span class="hljs-attr">ports:</span>  
Â  Â  Â  <span class="hljs-bullet">-</span> <span class="hljs-string">"5000:5000"</span>  
Â  <span class="hljs-attr">db:</span>  
Â  Â  <span class="hljs-attr">image:</span> <span class="hljs-string">mysql:5.7</span>  
Â  Â  <span class="hljs-attr">environment:</span>  
Â  Â  Â  <span class="hljs-attr">MYSQL_ROOT_PASSWORD:</span> <span class="hljs-string">example</span>  
Â  Â  Â  <span class="hljs-attr">MYSQL_DATABASE:</span> <span class="hljs-string">mydb</span>  
</code></pre>
<h4 data-id="heading-12">(3) <strong>äº‘éƒ¨ç½²ï¼ˆå¦‚AWSã€Azureï¼‰</strong></h4>
<p>è®¸å¤šå…¬å¸é‡‡ç”¨äº‘å¹³å°ï¼ˆå¦‚AWSã€Azureï¼‰è¿›è¡Œè‡ªåŠ¨åŒ–éƒ¨ç½²å’Œæ‰©å±•ã€‚äº‘å¹³å°æä¾›äº†å®¹å™¨ç®¡ç†ã€è‡ªåŠ¨ä¼¸ç¼©ã€è´Ÿè½½å‡è¡¡ç­‰åŠŸèƒ½ï¼Œèƒ½å¤Ÿå¿«é€Ÿæ‰©å±•å’Œç»´æŠ¤åº”ç”¨ã€‚</p>
<h3 data-id="heading-13">4. <strong>ç™»å½•çŠ¶æ€ä¿å­˜åœ¨å“ªï¼Ÿ</strong></h3>
<p>ç™»å½•çŠ¶æ€çš„ä¿å­˜æ˜¯ç”¨æˆ·ä½“éªŒå’Œå®‰å…¨çš„å…³é”®ã€‚å¸¸è§çš„åšæ³•æœ‰ï¼š</p>
<h4 data-id="heading-14">(1) <strong>Session</strong></h4>
<p>Sessionæ˜¯ä¸€ç§åœ¨æœåŠ¡å™¨ç«¯å­˜å‚¨ç”¨æˆ·ä¼šè¯ä¿¡æ¯çš„æœºåˆ¶ã€‚æ¯æ¬¡ç”¨æˆ·ç™»å½•åï¼ŒæœåŠ¡å™¨ç”Ÿæˆä¸€ä¸ªå”¯ä¸€çš„Session IDï¼Œå¹¶å°†å…¶ä¿å­˜åœ¨æµè§ˆå™¨çš„Cookieä¸­ã€‚æœåŠ¡å™¨å¯ä»¥é€šè¿‡è¯¥Session IDè¯†åˆ«ç”¨æˆ·ï¼Œå¹¶å­˜å‚¨ç”¨æˆ·çš„ç™»å½•çŠ¶æ€ã€‚</p>
<h4 data-id="heading-15">(2) <strong>Tokenï¼ˆJWTï¼‰</strong></h4>
<p>å¦ä¸€ç§å¸¸è§çš„åšæ³•æ˜¯ä½¿ç”¨JWTï¼ˆJSON Web Tokenï¼‰ã€‚JWTé€šå¸¸åŒ…å«äº†ç”¨æˆ·èº«ä»½å’Œæœ‰æ•ˆæœŸç­‰ä¿¡æ¯ï¼Œå®¢æˆ·ç«¯å¯ä»¥å°†JWTä¿å­˜åœ¨æµè§ˆå™¨çš„LocalStorageæˆ–SessionStorageä¸­ï¼Œæ¯æ¬¡è¯·æ±‚æ—¶æºå¸¦åœ¨HTTPå¤´éƒ¨ã€‚</p>
<pre><code class="hljs language-python" lang="python">importwt(user_id):  
Â  Â  payload = {  
Â  Â  Â  Â  <span class="hljs-string">"user_id"</span>: user_id,  
Â  Â  Â  Â  <span class="hljs-string">"exp"</span>:secret<span class="hljs-string">", algorithm="</span>HS256<span class="hljs-string">")  
</span></code></pre>
<h3 data-id="heading-16">5. <strong>MD5åŸç†çŸ¥é“å—ï¼Ÿå®‰å…¨å—ï¼Ÿå¯é€†å—ï¼Ÿ</strong></h3>
<p>MD5æ˜¯ä¸€ç§å¸¸è§çš„å“ˆå¸Œç®—æ³•ï¼Œå…¶åŸç†æ˜¯å°†ä»»æ„é•¿åº¦çš„è¾“å…¥æ•°æ®è½¬æ¢ä¸ºå›ºå®šé•¿åº¦ï¼ˆ128ä½ï¼‰çš„è¾“å‡ºï¼Œé€šå¸¸ä»¥16è¿›åˆ¶å½¢å¼è¡¨ç¤ºã€‚å®ƒæ˜¯ä¸å¯é€†çš„ï¼Œå³ç†è®ºä¸Šæ— æ³•ä»å“ˆå¸Œå€¼æ¢å¤åŸå§‹æ•°æ®ã€‚</p>
<h4 data-id="heading-17">(1) <strong>MD5çš„å®‰å…¨æ€§</strong></h4>
<p>MD5æ›¾ç»å¹¿æ³›ç”¨äºå¯†ç å­˜å‚¨å’Œæ•°æ®å®Œæ•´æ€§æ ¡éªŒï¼Œä½†ç°åœ¨è¢«è®¤ä¸ºæ˜¯ä¸å®‰å…¨çš„ã€‚ä¸»è¦åŸå› æ˜¯MD5æ˜“å—ç¢°æ’æ”»å‡»ï¼Œå³ä¸¤ä¸ªä¸åŒçš„è¾“å…¥å¯ä»¥äº§ç”Ÿç›¸åŒçš„å“ˆå¸Œå€¼ï¼Œè¿™ä½¿å¾—æ”»å‡»è€…å¯ä»¥é€šè¿‡æ„é€ ä¸¤ä¸ªä¸åŒçš„æ•°æ®é›†å¾—åˆ°ç›¸åŒçš„MD5å“ˆå¸Œå€¼ï¼Œä»è€Œç ´åæ•°æ®çš„å®Œæ•´æ€§ã€‚<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/75158f9616a74b2a8fc50f20b7fc9e88~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgMzYwX2dvX3BocA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765337719&amp;x-signature=4Z8mQhKCC87F1xXaHUcZmBvOJM0%3D" alt="" loading="lazy"/><img src="" alt="" title="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨" loading="lazy"/>â€‹ç¼–è¾‘</p>
<h4 data-id="heading-18">(2) <strong>MD5å¯é€†å—ï¼Ÿ</strong></h4>
<p>MD5æ˜¯ä¸å¯é€†çš„å“ˆå¸Œç®—æ³•ï¼Œæ„å‘³ç€æ— æ³•ç›´æ¥ä»MD5å“ˆå¸Œå€¼æ¢å¤åŸå§‹è¾“å…¥ã€‚ç„¶è€Œï¼Œæ”»å‡»è€…å¯ä»¥é€šè¿‡å½©è™¹è¡¨ã€æš´åŠ›ç ´è§£ç­‰æ‰‹æ®µå°è¯•æ¨æµ‹åŸå§‹æ•°æ®ã€‚å› æ­¤ï¼ŒMD5ä¸é€‚åˆç”¨äºå¯†ç å­˜å‚¨ï¼Œç°ä»£åº”ç”¨ä¸­æ¨èä½¿ç”¨æ›´åŠ å®‰å…¨çš„å“ˆå¸Œç®—æ³•ï¼Œå¦‚SHA256æˆ–bcryptã€‚<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2dbb01d4bc7e4630bbdccaba24a6d604~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgMzYwX2dvX3BocA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765337719&amp;x-signature=gFbhxtvXG9U3rSSit0GdaOPGdBc%3D" alt="" loading="lazy"/><img src="" alt="" title="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨" loading="lazy"/>â€‹ç¼–è¾‘</p>
<h3 data-id="heading-19">æ€»ç»“<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/23b23b7ef3924d3aa5266a044dd77f2a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgMzYwX2dvX3BocA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765337719&amp;x-signature=Z3M28Mnj1wYoi7BjWTkPs2jrPwA%3D" alt="" loading="lazy"/><img src="" alt="" title="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨" loading="lazy"/>â€‹ç¼–è¾‘</h3>
<p>æœ¬æ–‡å›ç­”äº†å…³äºé¡¹ç›®å®ç°ä¸­çš„æ³¨å†Œã€ç”¨æˆ·å”¯ä¸€æ€§æ£€éªŒã€éƒ¨ç½²ã€ç™»å½•çŠ¶æ€ä¿å­˜ä»¥åŠMD5çš„å®‰å…¨æ€§ç­‰é—®é¢˜ã€‚åœ¨é¢è¯•ä¸­ï¼Œç†Ÿæ‚‰è¿™äº›åŸºæœ¬æ¦‚å¿µï¼Œå¹¶èƒ½å±•ç¤ºå®é™…æ“ä½œçš„èƒ½åŠ›ï¼Œèƒ½å¤Ÿæœ‰æ•ˆåœ°å¸®åŠ©ä½ å±•ç¤ºæŠ€æœ¯èƒ½åŠ›å¹¶æå‡é¢è¯•é€šè¿‡ç‡ã€‚</p>
<p>â€‹</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[æ¸…åå¤§ä½¬å¼ºæ¨ï¼å…¨ç½‘ç¬¬ä¸€æœ¬ä¸­æ–‡å¤§è¯­è¨€æ¨¡å‹æ•™ç¨‹æ¥äº†ï¼Œ391é¡µ å…¨å¼€æº]]></title>    <link>https://juejin.cn/post/7579176524131106867</link>    <guid>https://juejin.cn/post/7579176524131106867</guid>    <pubDate>2025-12-03T03:37:17.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7579176524131106867" data-draft-id="7579192114828197915" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="æ¸…åå¤§ä½¬å¼ºæ¨ï¼å…¨ç½‘ç¬¬ä¸€æœ¬ä¸­æ–‡å¤§è¯­è¨€æ¨¡å‹æ•™ç¨‹æ¥äº†ï¼Œ391é¡µ å…¨å¼€æº"/> <meta itemprop="keywords" content="Agent,LLM,ç¨‹åºå‘˜"/> <meta itemprop="datePublished" content="2025-12-03T03:37:17.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å¤§æ¨¡å‹æ•™ç¨‹"/> <meta itemprop="url" content="https://juejin.cn/user/1145012233707299"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            æ¸…åå¤§ä½¬å¼ºæ¨ï¼å…¨ç½‘ç¬¬ä¸€æœ¬ä¸­æ–‡å¤§è¯­è¨€æ¨¡å‹æ•™ç¨‹æ¥äº†ï¼Œ391é¡µ å…¨å¼€æº
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1145012233707299/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å¤§æ¨¡å‹æ•™ç¨‹
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-03T03:37:17.000Z" title="Wed Dec 03 2025 03:37:17 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-03
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»2åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#383838;font-size:15px;line-height:30px;letter-spacing:2px;word-break:break-word;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Open Sans,Helvetica Neue,sans-serif;scroll-behavior:smooth;background-image:linear-gradient(0deg,transparent 24%,rgba(201,195,195,.329) 25%,hsla(0,8%,80.4%,.05) 26%,transparent 27%,transparent 74%,hsla(0,5.2%,81%,.185) 75%,rgba(180,176,176,.05) 76%,transparent 77%,transparent),linear-gradient(90deg,transparent 24%,rgba(204,196,196,.226) 25%,hsla(0,4%,66.1%,.05) 26%,transparent 27%,transparent 74%,hsla(0,5.2%,81%,.185) 75%,rgba(180,176,176,.05) 76%,transparent 77%,transparent);background-color:#fff;background-size:50px 50px;padding-bottom:60px}.markdown-body ::selection{color:#fff;background-color:#a862ea}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{margin:24px 0 12px;color:#a862ea}.markdown-body h1{line-height:2;font-size:1.4em}.markdown-body h1~p:first-of-type:first-letter{color:#a862ea;float:left;font-size:2em;margin-right:.4em;font-weight:bolder}.markdown-body h2{font-size:1.2em}.markdown-body h3{font-size:1.1em}.markdown-body ol,.markdown-body ul{padding-left:2em}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;padding-left:.2em}.markdown-body ol li::marker,.markdown-body ul li::marker{color:#a862ea}.markdown-body ol li.task-list-item,.markdown-body ul li.task-list-item{list-style:none}.markdown-body ol li.task-list-item ol,.markdown-body ol li.task-list-item ul,.markdown-body ul li.task-list-item ol,.markdown-body ul li.task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:10px}.markdown-body a,.markdown-body code,.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6,.markdown-body li,.markdown-body p{opacity:.85;vertical-align:baseline;transition:all .1s ease}.markdown-body a:hover,.markdown-body code:hover,.markdown-body h1:hover,.markdown-body h2:hover,.markdown-body h3:hover,.markdown-body h4:hover,.markdown-body h5:hover,.markdown-body h6:hover,.markdown-body li:hover,.markdown-body p:hover{opacity:1}.markdown-body a{display:inline-block;color:#a862ea;cursor:pointer;text-decoration:none;position:relative}.markdown-body a:after{content:"";position:absolute;width:98%;height:1px;bottom:0;left:0;transform:scaleX(0);background-color:#a862ea;transform-origin:bottom right;transition:transform .3s ease-in-out}.markdown-body a:hover:after{transform:scaleX(1);transform-origin:bottom left}.markdown-body a:active,.markdown-body a:link{color:#a862ea}.markdown-body img{max-width:100%;user-select:none;margin:1em 0;transition:transform .2s ease 0s;background-color:#f8f5ff;box-shadow:0 0 10px #e7daff}.markdown-body img:hover{opacity:1;box-shadow:0 0 20px #e7daff;transform:translateY(-1px)}.markdown-body blockquote{padding:.5em 1em;margin:12px 0;border-top-left-radius:2px;border-bottom-left-radius:2px;border-left:3px solid #a862ea;background-color:#f8f5ff}.markdown-body blockquote&gt;p{margin:0}.markdown-body .math{font-style:italic;margin:12px 0;padding:.5em 1em;background-color:#f8f5ff}.markdown-body .math&gt;p{margin:0}.markdown-body code{padding:2px .4em;overflow-x:auto;color:#a862ea;font-weight:700;word-break:break-word;font-family:Operator Mono,Consolas,Monaco,Menlo,monospace;background-color:#f8f5ff}.markdown-body pre{margin:2em 0}.markdown-body pre&gt;code{display:block;padding:1.5em;word-break:normal;font-size:.9em;font-style:normal;font-weight:400;font-family:Operator Mono,Consolas,Monaco,Menlo,monospace;line-height:18px;color:#383838;border-radius:2px;scroll-behavior:smooth;box-shadow:0 0 10px #e7daff}.markdown-body pre&gt;code:hover{box-shadow:0 0 20px #e7daff}.markdown-body pre&gt;code::-webkit-scrollbar{height:6px;background-color:#f8f5ff}.markdown-body pre&gt;code::-webkit-scrollbar-thumb{background-color:#e7daff;border-bottom-left-radius:3px;border-bottom-right-radius:3px}.markdown-body hr{margin:2em 0;border-top:1px solid #a862ea}.markdown-body table{width:100%;font-size:12px;max-width:100%;overflow:auto;border-collapse:collapse}.markdown-body thead{color:#a862ea;background:#f8f5ff}.markdown-body td,.markdown-body th{padding:.5em;border:1px solid #e7daff}.markdown-body tr{background-color:#f8f5ff}@media (max-width:720px){.markdown-body{font-size:12px}}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>æœ¬æ–‡è¾ƒé•¿ï¼Œå»ºè®®ç‚¹èµæ”¶è—ã€‚æ›´å¤šAIå¤§æ¨¡å‹åº”ç”¨å¼€å‘å­¦ä¹ è§†é¢‘åŠèµ„æ–™ï¼Œåœ¨<a href="https://link.juejin.cn?target=https%3A%2F%2Fhy.zhipoai.cn%2F" target="_blank" title="https://hy.zhipoai.cn/" ref="nofollow noopener noreferrer">æ™ºæ³ŠAI</a>ã€‚</p>
</blockquote>
<p>ç¬¬ä¸€æœ¬ä¸­æ–‡å¤§è¯­è¨€æ¨¡å‹æ•™ç¨‹æ¥äº†ï¼Œè¿™æ˜¯ç”±ä¸­å›½äººæ°‘å¤§å­¦é«˜ç“´äººå·¥æ™ºèƒ½å­¦é™¢èµµé‘«è´Ÿè´£å†µä¸”å¼€æºçš„å¤§æ¨¡å‹å…¥é—¨ä¹¦ç±ï¼Œå¹¶ä¸”æ˜¯å¼€æºå¯ä¸‹è½½çš„ã€‚</p>
<p>æœ¬ä¹¦ä¸»è¦é¢å‘å¸Œæœ›ç³»ç»Ÿå­¦ä¹ å¤§è¯­è¨€æ¨¡å‹æŠ€æœ¯çš„è¯»è€…ï¼Œå°†é‡ç‚¹çªå‡ºæ ¸å¿ƒæ¦‚å¿µä¸ç®—æ³•ï¼Œå¹¶ä¸”é…ä»¥ç¤ºä¾‹ä¸ä»£ç å¸®åŠ©è¯»è€…ç†è§£ç‰¹å®šç®—æ³•çš„å®ç°é€»è¾‘ã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/32ca984d8f8e4749978895bad1e0e8de~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765337836&amp;x-signature=d3EEgUT%2Bm%2ByU9oqXfmLfitwGbVc%3D" alt="" loading="lazy"/></p>
<p><strong>æœ¬ä¹¦è‡ª2024å¹´12æœˆåº•å¯åŠ¨ç¼–å†™ï¼Œä¸­æ–‡ç‰ˆæœ¬25å¹´4æœˆ15æ—¥æ›´æ–°å¼€æºã€‚</strong> ã€Šå¤§è¯­è¨€æ¨¡å‹ã€‹æ˜¯ä¸€æœ¬å…¨é¢ä»‹ç»å¤§è¯­è¨€æ¨¡å‹æŠ€æœ¯çš„ä¹¦ç±ï¼Œå®ƒä¸ä»…æ¶µç›–äº†åŸºç¡€åŸç†å’Œå…³é”®æŠ€æœ¯ï¼Œè¿˜å±•æœ›äº†æŠ€æœ¯çš„æœªæ¥åº”ç”¨å‰æ™¯ã€‚</p>
<p>ä¸­æ–‡ç‰ˆä¹¦ç±æ³¨é‡ä¸ºå¤§æ¨¡å‹æŠ€æœ¯çš„å…¥é—¨è¯»è€…æä¾›è®²è§£ï¼ŒåŠ›å›¾å±•ç°ä¸€ä¸ªæ•´ä½“çš„å¤§æ¨¡å‹æŠ€æœ¯æ¡†æ¶å’Œè·¯çº¿å›¾ã€‚</p>
<p>æœ¬ä¹¦å…±è®¾ç½®äº†äº”ä¸ªä¸»è¦éƒ¨åˆ†ï¼Œåˆ†åˆ«æ˜¯èƒŒæ™¯ä¸åŸºç¡€çŸ¥è¯†éƒ¨åˆ†ã€é¢„è®­ç»ƒéƒ¨åˆ†ã€å¾® è°ƒä¸å¯¹é½éƒ¨åˆ†ã€å¤§æ¨¡å‹ä½¿ç”¨éƒ¨åˆ†ä»¥åŠè¯„æµ‹ä¸åº”ç”¨éƒ¨åˆ†ã€‚</p>
<ul>
<li>ç¬¬ä¸€ç«  å¼•è¨€ï¼ˆå¤§æ¨¡å‹å‘å±•å†ç¨‹ã€é‡è¦æŠ€æœ¯æ¦‚è§ˆï¼‰</li>
<li>ç¬¬äºŒç«  åŸºç¡€ä»‹ç»ï¼ˆScaling Lawã€GPTç³»åˆ—æ¨¡å‹å‘å±•å†ç¨‹ï¼‰</li>
<li>ç¬¬ä¸‰ç«  å¤§æ¨¡å‹èµ„æºï¼ˆå¼€æºæ¨¡å‹ã€æ•°æ®ã€ä»£ç åº“ï¼‰</li>
<li>ç¬¬å››ç«  æ•°æ®å‡†å¤‡ï¼ˆæ•°æ®æ”¶é›†ã€æ¸…æ´—ã€é…æ¯”ã€è¯¾ç¨‹æ–¹æ³•ï¼‰</li>
<li>ç¬¬äº”ç«  æ¨¡å‹æ¶æ„ï¼ˆTransformer ç»“æ„ã€å¤§æ¨¡å‹ä¸»æµæ¶æ„ã€ç»†èŠ‚æ”¹è¿›ï¼‰</li>
<li>......</li>
<li>ç¬¬åäºŒç«  è¯„æµ‹ï¼ˆè¯„æµ‹æŒ‡æ ‡ä¸æ–¹æ³•ã€åŸºç¡€ä¸é«˜çº§èƒ½åŠ›è¯„æµ‹ã€è¯„æµ‹ä½“ç³»ï¼‰</li>
<li>ç¬¬åä¸‰ç«  åº”ç”¨ï¼ˆæ¦‚è§ˆç ”ç©¶é¢†åŸŸä¸ä¸“ä¸šé¢†åŸŸçš„åº”ç”¨ï¼‰</li>
</ul>
<h2 data-id="heading-0">è¯¾ç¨‹ç›®å½•å¦‚ä¸‹ï¼š</h2>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d1fb0535ef924fc8adbf13ef44f9714a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765337836&amp;x-signature=wT3X3FJR2NRsYKee0JtyJA2GW3E%3D" alt="" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f84d63daa2d74058bd1a9fd079e2e4e9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765337836&amp;x-signature=bC%2FMCLfGK5f87%2F8ZHeMzjEjlPx8%3D" alt="" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c288a1920e9f479089d15a52a23e85c9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765337836&amp;x-signature=QwrN1MTxoz6XhVENElWHv4hlKW8%3D" alt="" loading="lazy"/></p>
<h4 data-id="heading-1"/>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a3db8afdaa324cc3b61b80b8ef33da18~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765337836&amp;x-signature=WP9hSW%2FFY9aJbL0ozIfSli%2BXwXc%3D" alt="" loading="lazy"/></p>
<p>ç”±äºå¤§è¯­è¨€æ¨¡å‹æŠ€æœ¯çš„å¿«é€Ÿæ›´è¿­ï¼Œæœ¬ä¹¦æ— æ³•è¦†ç›–æ‰€æœ‰ç›¸å…³å†…å®¹ï¼Œæ—¨åœ¨å¸®åŠ©å¤§å®¶æ›´å¥½åœ°äº†è§£å¤§è¯­è¨€æ¨¡å‹æŠ€æœ¯çš„æ ¸å¿ƒçŸ¥è¯†ç‚¹ã€‚é€‚ç”¨äºå…·æœ‰æ·±åº¦å­¦ä¹ åŸºç¡€çš„é«˜å¹´çº§æœ¬ç§‘ç”Ÿä»¥åŠä½å¹´çº§ç ”ç©¶ç”Ÿä½¿ç”¨ï¼Œå¯ä»¥ä½œä¸ºä¸€æœ¬å…¥é—¨çº§çš„å‚è€ƒèµ„æ–™ã€‚</p>
<h3 data-id="heading-2">å­¦ä¹ èµ„æºæ¨è</h3>
<p>å¦‚æœä½ æƒ³æ›´æ·±å…¥åœ°å­¦ä¹ å¤§æ¨¡å‹ï¼Œä»¥ä¸‹æ˜¯ä¸€äº›éå¸¸æœ‰ä»·å€¼çš„å­¦ä¹ èµ„æºï¼Œè¿™äº›èµ„æºå°†å¸®åŠ©ä½ ä»ä¸åŒè§’åº¦å­¦ä¹ å¤§æ¨¡å‹ï¼Œæå‡ä½ çš„å®è·µèƒ½åŠ›ã€‚</p>
<blockquote>
<p>æœ¬æ–‡è¾ƒé•¿ï¼Œå»ºè®®ç‚¹èµæ”¶è—ã€‚æ›´å¤šAIå¤§æ¨¡å‹åº”ç”¨å¼€å‘å­¦ä¹ è§†é¢‘åŠèµ„æ–™ï¼Œåœ¨<a href="https://link.juejin.cn?target=https%3A%2F%2Fhy.zhipoai.cn%2F" target="_blank" title="https://hy.zhipoai.cn/" ref="nofollow noopener noreferrer">æ™ºæ³ŠAI</a>ã€‚</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ä¸æ„§æ˜¯GitHubæ’åç¬¬ä¸€çš„å¤§æ¨¡å‹è¯¾ï¼æˆ‘è¿˜ç¿»è¯‘æˆäº†ä¸­æ–‡ç‰ˆ]]></title>    <link>https://juejin.cn/post/7579192114828181531</link>    <guid>https://juejin.cn/post/7579192114828181531</guid>    <pubDate>2025-12-03T03:34:30.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7579192114828181531" data-draft-id="7579175271680278538" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ä¸æ„§æ˜¯GitHubæ’åç¬¬ä¸€çš„å¤§æ¨¡å‹è¯¾ï¼æˆ‘è¿˜ç¿»è¯‘æˆäº†ä¸­æ–‡ç‰ˆ"/> <meta itemprop="keywords" content="Agent,LLM,ç¨‹åºå‘˜"/> <meta itemprop="datePublished" content="2025-12-03T03:34:30.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å¤§æ¨¡å‹æ•™ç¨‹"/> <meta itemprop="url" content="https://juejin.cn/user/1145012233707299"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ä¸æ„§æ˜¯GitHubæ’åç¬¬ä¸€çš„å¤§æ¨¡å‹è¯¾ï¼æˆ‘è¿˜ç¿»è¯‘æˆäº†ä¸­æ–‡ç‰ˆ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1145012233707299/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å¤§æ¨¡å‹æ•™ç¨‹
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-03T03:34:30.000Z" title="Wed Dec 03 2025 03:34:30 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-03
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»1åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#383838;font-size:15px;line-height:30px;letter-spacing:2px;word-break:break-word;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Open Sans,Helvetica Neue,sans-serif;scroll-behavior:smooth;background-image:linear-gradient(0deg,transparent 24%,rgba(201,195,195,.329) 25%,hsla(0,8%,80.4%,.05) 26%,transparent 27%,transparent 74%,hsla(0,5.2%,81%,.185) 75%,rgba(180,176,176,.05) 76%,transparent 77%,transparent),linear-gradient(90deg,transparent 24%,rgba(204,196,196,.226) 25%,hsla(0,4%,66.1%,.05) 26%,transparent 27%,transparent 74%,hsla(0,5.2%,81%,.185) 75%,rgba(180,176,176,.05) 76%,transparent 77%,transparent);background-color:#fff;background-size:50px 50px;padding-bottom:60px}.markdown-body ::selection{color:#fff;background-color:#a862ea}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{margin:24px 0 12px;color:#a862ea}.markdown-body h1{line-height:2;font-size:1.4em}.markdown-body h1~p:first-of-type:first-letter{color:#a862ea;float:left;font-size:2em;margin-right:.4em;font-weight:bolder}.markdown-body h2{font-size:1.2em}.markdown-body h3{font-size:1.1em}.markdown-body ol,.markdown-body ul{padding-left:2em}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;padding-left:.2em}.markdown-body ol li::marker,.markdown-body ul li::marker{color:#a862ea}.markdown-body ol li.task-list-item,.markdown-body ul li.task-list-item{list-style:none}.markdown-body ol li.task-list-item ol,.markdown-body ol li.task-list-item ul,.markdown-body ul li.task-list-item ol,.markdown-body ul li.task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:10px}.markdown-body a,.markdown-body code,.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6,.markdown-body li,.markdown-body p{opacity:.85;vertical-align:baseline;transition:all .1s ease}.markdown-body a:hover,.markdown-body code:hover,.markdown-body h1:hover,.markdown-body h2:hover,.markdown-body h3:hover,.markdown-body h4:hover,.markdown-body h5:hover,.markdown-body h6:hover,.markdown-body li:hover,.markdown-body p:hover{opacity:1}.markdown-body a{display:inline-block;color:#a862ea;cursor:pointer;text-decoration:none;position:relative}.markdown-body a:after{content:"";position:absolute;width:98%;height:1px;bottom:0;left:0;transform:scaleX(0);background-color:#a862ea;transform-origin:bottom right;transition:transform .3s ease-in-out}.markdown-body a:hover:after{transform:scaleX(1);transform-origin:bottom left}.markdown-body a:active,.markdown-body a:link{color:#a862ea}.markdown-body img{max-width:100%;user-select:none;margin:1em 0;transition:transform .2s ease 0s;background-color:#f8f5ff;box-shadow:0 0 10px #e7daff}.markdown-body img:hover{opacity:1;box-shadow:0 0 20px #e7daff;transform:translateY(-1px)}.markdown-body blockquote{padding:.5em 1em;margin:12px 0;border-top-left-radius:2px;border-bottom-left-radius:2px;border-left:3px solid #a862ea;background-color:#f8f5ff}.markdown-body blockquote&gt;p{margin:0}.markdown-body .math{font-style:italic;margin:12px 0;padding:.5em 1em;background-color:#f8f5ff}.markdown-body .math&gt;p{margin:0}.markdown-body code{padding:2px .4em;overflow-x:auto;color:#a862ea;font-weight:700;word-break:break-word;font-family:Operator Mono,Consolas,Monaco,Menlo,monospace;background-color:#f8f5ff}.markdown-body pre{margin:2em 0}.markdown-body pre&gt;code{display:block;padding:1.5em;word-break:normal;font-size:.9em;font-style:normal;font-weight:400;font-family:Operator Mono,Consolas,Monaco,Menlo,monospace;line-height:18px;color:#383838;border-radius:2px;scroll-behavior:smooth;box-shadow:0 0 10px #e7daff}.markdown-body pre&gt;code:hover{box-shadow:0 0 20px #e7daff}.markdown-body pre&gt;code::-webkit-scrollbar{height:6px;background-color:#f8f5ff}.markdown-body pre&gt;code::-webkit-scrollbar-thumb{background-color:#e7daff;border-bottom-left-radius:3px;border-bottom-right-radius:3px}.markdown-body hr{margin:2em 0;border-top:1px solid #a862ea}.markdown-body table{width:100%;font-size:12px;max-width:100%;overflow:auto;border-collapse:collapse}.markdown-body thead{color:#a862ea;background:#f8f5ff}.markdown-body td,.markdown-body th{padding:.5em;border:1px solid #e7daff}.markdown-body tr{background-color:#f8f5ff}@media (max-width:720px){.markdown-body{font-size:12px}}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>æœ¬æ–‡è¾ƒé•¿ï¼Œå»ºè®®ç‚¹èµæ”¶è—ã€‚æ›´å¤šAIå¤§æ¨¡å‹åº”ç”¨å¼€å‘å­¦ä¹ è§†é¢‘åŠèµ„æ–™ï¼Œåœ¨<a href="https://link.juejin.cn?target=https%3A%2F%2Fhy.zhipoai.cn%2F" target="_blank" title="https://hy.zhipoai.cn/" ref="nofollow noopener noreferrer">æ™ºæ³ŠAI</a>ã€‚</p>
</blockquote>
<p>æœ€è¿‘åœ¨ GitHub ä¸Šå‘ç°äº†ä¸€ä¸ªè¶…çº§ç¡¬æ ¸çš„å¤§è¯­è¨€æ¨¡å‹ï¼ˆLLMï¼‰è¯¾ç¨‹ï¼Œæ ‡æ˜Ÿå·²è¾¾åˆ°ææ€–çš„67kï¼Œå®ƒæä¾›äº†ä¸€å¥—å®Œæ•´çš„å­¦ä¹ è·¯çº¿å›¾å’Œå¯ä»¥ç›´æ¥ä¸Šæ‰‹çš„ Colab ç¬”è®°ï¼Œç›®æ ‡å°±æ˜¯å¸¦ä½ ä»å…¥é—¨åˆ°ç²¾é€šï¼Œæ— è®ºä½ æœ‰æ²¡æœ‰åŸºç¡€æˆ–æ˜¯æƒ³æ·±å…¥ç ”ç©¶æ¨¡å‹ã€å¼€å‘åº”ç”¨ï¼Œéƒ½èƒ½æ‰¾åˆ°æ¸…æ™°çš„è·¯å¾„ã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3b44d8aeca564d8cb71b13a9f6cf5d19~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765337669&amp;x-signature=UF0k2eDKHFcwEPed2GKzMuvXO3g%3D" alt="" loading="lazy"/></p>
<p>æˆ‘ç»™çœ‹ä¸å¤ªæ‡‚è‹±è¯­å’Œä¸Šä¸äº†GitHubçš„åŒå­¦æŠŠè¿™ä»½ä»“åº“ç¿»è¯‘å¹¶ä¸”åšæˆäº†ä¸€ä»½PDFæ–‡æ¡£ï¼Œ<strong>å¦‚æœå¤§å®¶éœ€è¦è¿™ä»½æ–‡æ¡£åœ¨<a href="https://link.juejin.cn?target=https%3A%2F%2Fhy.zhipoai.cn%2F" target="_blank" title="https://hy.zhipoai.cn/" ref="nofollow noopener noreferrer">æ™ºæ³ŠAI</a>ã€‚</strong></p>
<p>è¿™ä¸ªè¯¾ç¨‹æœ€å¤§çš„äº®ç‚¹å°±æ˜¯å®ƒçš„ä½“ç³»åŒ–å’Œå®è·µæ€§ï¼ŒæŠŠå¤æ‚çš„ LLM é¢†åŸŸæ‹†è§£æˆäº†ä¸‰ä¸ªæ¸…æ™°çš„éƒ¨åˆ†ï¼Œæ¯ä¸ªé˜¶æ®µéƒ½æœ‰æ¸…æ™°çš„è·¯çº¿å›¾ï¼Œå¯¹æƒ³ç³»ç»Ÿå­¦ä¹ çš„åŒå­¦æ¥è¯´ï¼Œç®€ç›´æ˜¯ç¦éŸ³<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/946cd9bf6e1442238909fa3560867f52~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765337669&amp;x-signature=eCETqMYDu93ALTXxeQJLC33%2FkA8%3D" alt="" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e534900e8e71426da7f1ea2ab98297ca~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765337669&amp;x-signature=qkez5dCmVCJwOWOsiAv7M3dgXIg%3D" alt="" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3015b166f3774978b645c8b0e72f4341~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765337669&amp;x-signature=Xr5XTW9sfCj0a%2FVWUZeacQOMskY%3D" alt="" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e2f3c8c63ee24670ad32df137ec026ba~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765337669&amp;x-signature=TZy2qLYc7cTfkGQjY7R8MzqnUJs%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-0">å­¦ä¹ èµ„æºæ¨è</h2>
<p>å¦‚æœä½ æƒ³æ›´æ·±å…¥åœ°å­¦ä¹ å¤§æ¨¡å‹ï¼Œä»¥ä¸‹æ˜¯ä¸€äº›éå¸¸æœ‰ä»·å€¼çš„å­¦ä¹ èµ„æºï¼Œè¿™äº›èµ„æºå°†å¸®åŠ©ä½ ä»ä¸åŒè§’åº¦å­¦ä¹ å¤§æ¨¡å‹ï¼Œæå‡ä½ çš„å®è·µèƒ½åŠ›ã€‚</p>
<blockquote>
<p>æœ¬æ–‡è¾ƒé•¿ï¼Œå»ºè®®ç‚¹èµæ”¶è—ã€‚æ›´å¤šAIå¤§æ¨¡å‹åº”ç”¨å¼€å‘å­¦ä¹ è§†é¢‘åŠèµ„æ–™ï¼Œåœ¨<a href="https://link.juejin.cn?target=https%3A%2F%2Fhy.zhipoai.cn%2F" target="_blank" title="https://hy.zhipoai.cn/" ref="nofollow noopener noreferrer">æ™ºæ³ŠAI</a>ã€‚</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[éº’éºŸæ“ä½œç³»ç»Ÿ (kylinos) ä»å…¥é—¨åˆ°ç²¾é€š -é«˜çº§æ•™ç¨‹ - ç¬¬85ç¯‡ ç½‘ç»œæœåŠ¡éƒ¨ç½²ç®€æ˜“æ•™ç¨‹]]></title>    <link>https://juejin.cn/post/7579096485356650546</link>    <guid>https://juejin.cn/post/7579096485356650546</guid>    <pubDate>2025-12-03T00:51:06.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7579096485356650546" data-draft-id="7579096485356601394" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="éº’éºŸæ“ä½œç³»ç»Ÿ (kylinos) ä»å…¥é—¨åˆ°ç²¾é€š -é«˜çº§æ•™ç¨‹ - ç¬¬85ç¯‡ ç½‘ç»œæœåŠ¡éƒ¨ç½²ç®€æ˜“æ•™ç¨‹"/> <meta itemprop="keywords" content="æ“ä½œç³»ç»Ÿ"/> <meta itemprop="datePublished" content="2025-12-03T00:51:06.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="XPlazaä¿¡åˆ›å¼€æºå¹¿åœº"/> <meta itemprop="url" content="https://juejin.cn/user/3217616484184618"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            éº’éºŸæ“ä½œç³»ç»Ÿ (kylinos) ä»å…¥é—¨åˆ°ç²¾é€š -é«˜çº§æ•™ç¨‹ - ç¬¬85ç¯‡ ç½‘ç»œæœåŠ¡éƒ¨ç½²ç®€æ˜“æ•™ç¨‹
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3217616484184618/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    XPlazaä¿¡åˆ›å¼€æºå¹¿åœº
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-03T00:51:06.000Z" title="Wed Dec 03 2025 00:51:06 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-03
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»8åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/01820e18ab4f464fbb47f19f144a34d2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgWFBsYXph5L-h5Yib5byA5rqQ5bm_5Zy6:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765327866&amp;x-signature=3eWA6X9s%2FWX5eKFlQhc05Dk2f3Q%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-0">0.åŸºç¡€ç¯å¢ƒ</h2>
<p>ç±»åˆ«ï¼šç¬”è®°æœ¬<br/>
å‹å·ï¼šä¸­å›½é•¿åŸ NF14C<br/>
ç¡¬ä»¶å¹³å°ï¼šé£è…¾å¤„ç†å™¨D2000ï¼ˆArmV8 æŒ‡ä»¤é›†ï¼‰<br/>
ç³»ç»Ÿï¼šé“¶æ²³éº’éºŸæ“ä½œç³»ç»Ÿ V10 SP1(2303)</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/de9740fea75f4782a88e77c87edc400f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgWFBsYXph5L-h5Yib5byA5rqQ5bm_5Zy6:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765327866&amp;x-signature=BaW7V4%2BBRazV7MsdceLnGoHgfgM%3D" alt="" loading="lazy"/></p>
<p>å…³é”®è¯ï¼šLinux,è¿›ç¨‹ç›‘æ§,apache,nginx,samba,nfs,ftp</p>
<h2 data-id="heading-1">0.å‡†å¤‡å·¥ä½œ</h2>
<p>ä¸ºæ–¹ä¾¿ç½‘ç»œè¿æ¥ï¼Œå…³æ‰é˜²ç«å¢™</p>
<pre><code class="hljs language-bash" lang="bash">sudo ufw <span class="hljs-built_in">disable</span> <span class="hljs-comment">#æ–¹å¼1</span>
sudo systemctl stop firewalld  <span class="hljs-comment">#æ–¹å¼2</span>
</code></pre>
<h2 data-id="heading-2">1.NFSæœåŠ¡éƒ¨ç½²</h2>
<p>NFSï¼ˆNetwork File Systemï¼Œç½‘ç»œæ–‡ä»¶ç³»ç»Ÿï¼‰æ˜¯ Unix/Linux ç¯å¢ƒä¸‹éå¸¸é‡è¦ä¸”åŸºç¡€çš„ç½‘ç»œæœåŠ¡ï¼Œå®ƒçš„æ ¸å¿ƒæ€æƒ³æ˜¯å…è®¸ç½‘ç»œä¸Šçš„è®¡ç®—æœºä¹‹é—´åƒè®¿é—®æœ¬åœ°æ–‡ä»¶ä¸€æ ·è®¿é—®è¿œç¨‹å…±äº«çš„æ–‡ä»¶å’Œç›®å½•ã€‚</p>
<p>æ‚¨å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å®‰è£…è¿™äº›è½¯ä»¶åŒ…ï¼š</p>
<pre><code class="hljs language-sql" lang="sql">sudo apt<span class="hljs-operator">-</span><span class="hljs-keyword">get</span> <span class="hljs-keyword">update</span>
sudo apt<span class="hljs-operator">-</span><span class="hljs-keyword">get</span> install nfs<span class="hljs-operator">-</span>kernel<span class="hljs-operator">-</span>server nfs<span class="hljs-operator">-</span>common rpcbind <span class="hljs-operator">-</span>y
</code></pre>
<p>æœåŠ¡ç«¯çš„è®¾å¤‡éœ€è¦å®‰è£…:nfs-kernel-server rpcbind</p>
<p>å®¢æˆ·ç«¯çš„è®¾å¤‡éœ€è¦å®‰è£…: nfs-commonç»„ä»¶</p>
<h3 data-id="heading-3">åˆ›å»ºå…±äº«ç›®å½•</h3>
<p>é¦–å…ˆï¼Œæ‚¨éœ€è¦åˆ›å»ºä¸€ä¸ªè¦å…±äº«çš„ç›®å½•ã€‚ä¾‹å¦‚ï¼Œåˆ›å»ºä¸€ä¸ªåä¸ºÂ <code>/share</code>Â çš„ç›®å½•ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">sudo <span class="hljs-built_in">mkdir</span> /share
</code></pre>
<p>ç„¶åï¼Œè®¾ç½®é€‚å½“çš„æƒé™ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">sudo <span class="hljs-built_in">chmod</span> 777 /share
</code></pre>
<h3 data-id="heading-4">é…ç½®NFS</h3>
<p>åœ¨å›¾å½¢ç•Œé¢ä¸­ï¼Œæ‰“å¼€ç»ˆç«¯ï¼Œå¹¶è¾“å…¥ä»¥ä¸‹å‘½ä»¤ä»¥ç¼–è¾‘Â <code>/etc/exports</code>Â æ–‡ä»¶ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">sudo apt install gedit -y <span class="hljs-comment">#å®‰è£…geditç¼–è¾‘å™¨</span>
sudo gedit /etc/exports
</code></pre>
<p>åœ¨æ‰“å¼€çš„æ–‡ä»¶ä¸­ï¼Œæ·»åŠ ä»¥ä¸‹è¡Œä»¥æŒ‡å®šè¦å…±äº«çš„ç›®å½•å’Œå®¢æˆ·ç«¯ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">/share *(rw,<span class="hljs-built_in">sync</span>,no_subtree_check) <span class="hljs-comment">#* å’Œ (rwä¹‹é—´æ²¡æœ‰ç©ºæ ¼</span>
</code></pre>
<p>è¿™é‡Œçš„Â <code>/share</code>Â æ˜¯æ‚¨è¦å…±äº«çš„ç›®å½•ï¼Œ<code>*</code>Â è¡¨ç¤ºæ‰€æœ‰å®¢æˆ·ç«¯éƒ½å¯ä»¥è®¿é—®ï¼Œ<code>(rw,sync,nolock)</code>Â æ˜¯å…±äº«çš„æƒé™ã€‚</p>
<p>å…¶ä»–å‚è€ƒ</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># Share /home/data with IP 192.168.1.10, read-write, sync</span>
/home/data 192.168.1.10(rw,<span class="hljs-built_in">sync</span>,no_subtree_check)

<span class="hljs-comment"># Share /mnt/nfs_share with the entire subnet, read-only</span>
/mnt/nfs_share 192.168.1.0/24(ro,<span class="hljs-built_in">sync</span>,no_subtree_check)
</code></pre>
<p>æ£€æŸ¥é…ç½®æ˜¯å¦æ­£ç¡®</p>
<pre><code class="hljs">sudo exportfs -rv
</code></pre>
<h3 data-id="heading-5">é…ç½®é˜²ç«å¢™</h3>
<pre><code class="hljs language-bash" lang="bash">sudo apt install ufw -y <span class="hljs-comment">#å®‰è£…é˜²ç«å¢™</span>
sudo systemctl start ufw <span class="hljs-comment">#å¯åŠ¨é˜²ç«å¢™</span>
sudo systemctl <span class="hljs-built_in">enable</span> ufw  <span class="hljs-comment">#å¼€æœºå¯åŠ¨é˜²ç«å¢™</span>
sudo ufw status  <span class="hljs-comment">#ç¡®è®¤çŠ¶æ€</span>
</code></pre>
<p>æ”¾è¡Œç«¯å£æˆ–æœåŠ¡</p>
<p>NFS çš„æ ¸å¿ƒæ˜¯ TCP/UDP ç«¯å£Â <code>111</code>Â å’ŒÂ <code>2049</code>ã€‚</p>


























<table><thead><tr><th>æœåŠ¡</th><th>ç«¯å£</th><th>åè®®</th><th>æè¿°</th><th>UFW å‘½ä»¤ (ç¤ºä¾‹ IP é™åˆ¶)</th></tr></thead><tbody><tr><td>rpcbind</td><td>111</td><td>TCP/UDP</td><td>ç«¯å£æ˜ å°„æœåŠ¡ï¼ŒNFS å¯åŠ¨å¿…å¤‡ã€‚</td><td>sudo ufw allow from 192.168.1.0/24 to any port 111</td></tr><tr><td>nfs</td><td>2049</td><td>TCP/UDP</td><td>NFS æ ¸å¿ƒæ•°æ®ä¼ è¾“ç«¯å£ã€‚</td><td>sudo ufw allow from 192.168.1.0/24 to any port 2049</td></tr></tbody></table>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 1. Portmap/Rpcbind: ç«¯å£ 111 (TCP/UDP)</span>
sudo ufw allow 111/tcp
sudo ufw allow 111/udp

<span class="hljs-comment"># 2. NFS: ç«¯å£ 2049 (TCP/UDP)</span>
sudo ufw allow 2049/tcp
sudo ufw allow 2049/udp
</code></pre>
<h3 data-id="heading-6">å¯åŠ¨NFSæœåŠ¡</h3>
<p>åœ¨ç»ˆç«¯ä¸­ï¼Œè¾“å…¥ä»¥ä¸‹å‘½ä»¤ä»¥å¯åŠ¨NFSæœåŠ¡ï¼š</p>
<pre><code class="hljs language-vbscript" lang="vbscript">sudo systemctl restart nfs-kernel-<span class="hljs-built_in">server</span>
sudo systemctl restart rpcbind
</code></pre>
<p>æ‚¨è¿˜å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å¯ç”¨NFSæœåŠ¡åœ¨å¯åŠ¨æ—¶è‡ªåŠ¨è¿è¡Œï¼š</p>
<pre><code class="hljs language-bash" lang="bash">sudo systemctl <span class="hljs-built_in">enable</span> nfs-kernel-server
sudo systemctl <span class="hljs-built_in">enable</span> rpcbind
</code></pre>
<h3 data-id="heading-7">é…ç½®å®¢æˆ·ç«¯</h3>
<p>åœ¨å®¢æˆ·ç«¯è®¡ç®—æœºä¸Šï¼Œä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å®‰è£…NFSå®¢æˆ·ç«¯ï¼š</p>
<pre><code class="hljs language-arduino" lang="arduino">sudo apt-get install nfs-common
</code></pre>
<p>ç„¶åï¼Œä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æŒ‚è½½NFSå…±äº«ï¼š</p>
<pre><code class="hljs language-ruby" lang="ruby">sudo mount -t nfs &lt;<span class="hljs-variable constant_">NFS_SERVER_IP_ADDRESS</span>&gt;<span class="hljs-symbol">:&lt;SHARED_DIRECTORY&gt;</span> &lt;<span class="hljs-variable constant_">MOUNT_POINT</span>&gt;
</code></pre>
<p>ä¾‹å¦‚ï¼Œå¦‚æœæ‚¨è¦æŒ‚è½½IPåœ°å€Â <code>çš„æœåŠ¡å™¨ä¸Šçš„</code>Â /shareÂ <code>ç›®å½•åˆ°æœ¬åœ°ç›®å½•</code>Â /mnt/nfs`ï¼Œè¯·ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">sudo <span class="hljs-built_in">mkdir</span> /mnt/nfs <span class="hljs-comment">#åˆ›å»ºæŒ‚è½½ç›®å½•</span>
sudo <span class="hljs-built_in">chmod</span> 777 -R /mnt/nfs <span class="hljs-comment"># è®¾ç½®æƒé™ä¸ºå…¨æ”¾å¼€</span>
sudo mount -t nfs 127.0.0.1:/share /mnt/nfs <span class="hljs-comment">#æŒ‚è½½ï¼Œ127.0.0.1ä»£è¡¨æœ¬æœºåœ°å€ï¼Œå¦‚æœæ˜¯è¿œç¨‹æœåŠ¡å™¨ï¼Œéœ€è¦æ¢æˆçœŸæ­£çš„å¯è¾¾çš„IPåœ°å€</span>
</code></pre>
<h2 data-id="heading-8">2.DHCPæœåŠ¡éƒ¨ç½²</h2>
<p>DHCPï¼ˆDynamic Host Configuration Protocolï¼ŒåŠ¨æ€ä¸»æœºé…ç½®åè®®ï¼‰æ˜¯ç½‘ç»œç®¡ç†ä¸­ä¸€ä¸ªè‡³å…³é‡è¦çš„åè®®ï¼Œå®ƒçš„æ ¸å¿ƒç›®çš„æ˜¯å®ç°ç½‘ç»œä¸­è®¾å¤‡çš„Â <strong>è‡ªåŠ¨åŒ–</strong>Â å’ŒÂ <strong>é›†ä¸­åŒ–</strong>Â IP åœ°å€é…ç½®ã€‚</p>























<table><thead><tr><th>è™šæ‹Ÿæœº (VM)</th><th>è§’è‰²</th><th>æ“ä½œç³»ç»Ÿ</th><th>é…ç½®è¦æ±‚</th></tr></thead><tbody><tr><td>VM-A</td><td>DHCP æœåŠ¡å™¨</td><td>ä»»æ„ Linux (å¦‚ Ubuntu Server, CentOS)</td><td>å®‰è£… isc-dhcp-server æˆ–å…¶ä»– DHCP è½¯ä»¶ã€‚é…ç½®ä¸€ä¸ªé™æ€ IP åœ°å€ä½œä¸ºæœåŠ¡å™¨åœ°å€ã€‚</td></tr><tr><td>VM-B</td><td>DHCP å®¢æˆ·ç«¯</td><td>ä»»æ„ Linux æˆ– Windows</td><td>ç½‘ç»œé…ç½®ä¸ºè‡ªåŠ¨è·å– IP (DHCP)ã€‚</td></tr></tbody></table>
<h3 data-id="heading-9">å®‰è£…DHCPæœåŠ¡å™¨</h3>
<ol>
<li>æ‰“å¼€ç»ˆç«¯ã€‚</li>
<li>è¾“å…¥ä»¥ä¸‹å‘½ä»¤æ›´æ–°è½¯ä»¶åŒ…åˆ—è¡¨ï¼š<br/>
sudo apt-get update</li>
<li>å®‰è£…isc-dhcp-serverè½¯ä»¶åŒ…ï¼Œè¯¥è½¯ä»¶åŒ…åŒ…å«äº†DHCPæœåŠ¡å™¨çš„æ‰€æœ‰å¿…éœ€ç»„ä»¶ï¼š<br/>
sudo apt-get install isc-dhcp-server</li>
</ol>
<h3 data-id="heading-10">é…ç½®DHCPæœåŠ¡å™¨</h3>
<ol>
<li>ç¼–è¾‘DHCPé…ç½®æ–‡ä»¶<code>/etc/dhcp/dhcpd.conf</code>ï¼Œè¯¥æ–‡ä»¶åŒ…å«äº†DHCPæœåŠ¡å™¨çš„é…ç½®ä¿¡æ¯ï¼š<br/>
sudo cp /etc/dhcp/dhcpd.conf /etc/dhcp/dhcpd.conf.bak sudo gedit /etc/dhcp/dhcpd.conf</li>
<li>åœ¨é…ç½®æ–‡ä»¶ä¸­ï¼Œæ·»åŠ ä»¥ä¸‹å†…å®¹ä»¥è®¾ç½®IPåœ°å€æ± ã€å­ç½‘æ©ç ã€ç½‘å…³å’ŒDNSæœåŠ¡å™¨ç­‰ä¿¡æ¯ã€‚ä»¥ä¸‹æ˜¯ä¸€ä¸ªç¤ºä¾‹é…ç½®ï¼š</li>
</ol>

<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># åŒ¹é…ä½ çš„å®é™…ç½‘ç»œï¼š192.168.200.0/24</span>
subnet 192.168.200.0 netmask 255.255.255.0 {
    range 192.168.200.50 192.168.200.100<span class="hljs-comment">;  # IPåˆ†é…èŒƒå›´</span>
    option routers 192.168.200.1<span class="hljs-comment">;          # ç½‘å…³åœ°å€</span>
    option domain-name-servers 8.8.8.8, 8.8.4.4<span class="hljs-comment">;  # DNSæœåŠ¡å™¨</span>
    option subnet-mask 255.255.255.0<span class="hljs-comment">;      # å­ç½‘æ©ç </span>
    option broadcast-address 192.168.200.255<span class="hljs-comment">;  # å¹¿æ’­åœ°å€</span>
    default-lease-time 600<span class="hljs-comment">;</span>
    max-lease-time 7200<span class="hljs-comment">;</span>
}
</code></pre>
<p>ä¿å­˜å¹¶å…³é—­æ–‡ä»¶ã€‚</p>
<p>é‡ç½®leasesæ–‡ä»¶å’Œæƒé™</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># åœæ­¢æœåŠ¡</span>
sudo systemctl stop isc-dhcp-server

<span class="hljs-comment"># å¤‡ä»½å¹¶é‡å»º leases æ–‡ä»¶</span>
sudo <span class="hljs-built_in">mv</span> /var/lib/dhcp/dhcpd.leases /var/lib/dhcp/dhcpd.leases.bak
<span class="hljs-comment"># æ²¡æœ‰å°±æ–°å»º</span>
sudo <span class="hljs-built_in">touch</span> /var/lib/dhcp/dhcpd.leases
sudo <span class="hljs-built_in">touch</span> /var/lib/dhcp/dhcpd.leases~

<span class="hljs-comment"># è®¾ç½®æ­£ç¡®æƒé™ï¼ˆå…³é”®ï¼‰</span>
sudo <span class="hljs-built_in">chown</span> -R root:root /var/lib/dhcp/
sudo <span class="hljs-built_in">chmod</span> 777 /var/lib/dhcp/
sudo <span class="hljs-built_in">chmod</span> 666 /var/lib/dhcp/dhcpd.leases
sudo <span class="hljs-built_in">chmod</span> 666 /var/lib/dhcp/dhcpd.leases~
</code></pre>
<p>æœ€ç»ˆçš„é…ç½®æ–‡ä»¶</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># dhcpd.conf</span>
<span class="hljs-comment">#</span>
<span class="hljs-comment"># Sample configuration file for ISC dhcpd</span>
<span class="hljs-comment">#</span>
<span class="hljs-comment"># Attention: If /etc/ltsp/dhcpd.conf exists, that will be used as</span>
<span class="hljs-comment"># configuration file instead of this file.</span>
<span class="hljs-comment">#</span>

<span class="hljs-comment"># option definitions common to all supported networks...</span>
option domain-name "example.org"<span class="hljs-comment">;</span>
option domain-name-servers ns1.example.org, ns2.example.org<span class="hljs-comment">;</span>

default-lease-time 600<span class="hljs-comment">;</span>
max-lease-time 7200<span class="hljs-comment">;</span>

<span class="hljs-comment"># The ddns-updates-style parameter controls whether or not the server will</span>
<span class="hljs-comment"># attempt to do a DNS update when a lease is confirmed. We default to the</span>
<span class="hljs-comment"># behavior of the version 2 packages ('none', since DHCP v2 didn't</span>
<span class="hljs-comment"># have support for DDNS.)</span>
ddns-update-style none<span class="hljs-comment">;</span>

<span class="hljs-comment"># If this DHCP server is the official DHCP server for the local</span>
<span class="hljs-comment"># network, the authoritative directive should be uncommented.</span>
authoritative<span class="hljs-comment">;</span>
ping-check false<span class="hljs-comment">;</span>
<span class="hljs-comment"># Use this to send dhcp log messages to a different log file (you also</span>
<span class="hljs-comment"># have to hack syslog.conf to complete the redirection).</span>
<span class="hljs-comment">#log-facility local7;</span>

<span class="hljs-comment"># No service will be given on this subnet, but declaring it helps the </span>
<span class="hljs-comment"># DHCP server to understand the network topology.</span>

<span class="hljs-comment">#subnet 10.152.187.0 netmask 255.255.255.0 {</span>
<span class="hljs-comment">#}</span>
<span class="hljs-comment"># åŒ¹é…ä½ çš„å®é™…ç½‘ç»œï¼š192.168.200.0/24</span>
subnet 192.168.200.0 netmask 255.255.255.0 {
    range 192.168.200.50 192.168.200.100<span class="hljs-comment">;  # IPåˆ†é…èŒƒå›´</span>
    option routers 192.168.200.1<span class="hljs-comment">;          # ç½‘å…³åœ°å€</span>
    option domain-name-servers 8.8.8.8, 8.8.4.4<span class="hljs-comment">;  # DNSæœåŠ¡å™¨</span>
    option subnet-mask 255.255.255.0<span class="hljs-comment">;      # å­ç½‘æ©ç </span>
    option broadcast-address 192.168.200.255<span class="hljs-comment">;  # å¹¿æ’­åœ°å€</span>
    default-lease-time 600<span class="hljs-comment">;</span>
    max-lease-time 7200<span class="hljs-comment">;</span>
}
<span class="hljs-comment"># This is a very basic subnet declaration.</span>

<span class="hljs-comment">#subnet 10.254.239.0 netmask 255.255.255.224 {</span>
<span class="hljs-comment">#  range 10.254.239.10 10.254.239.20;</span>
<span class="hljs-comment">#  option routers rtr-239-0-1.example.org, rtr-239-0-2.example.org;</span>
<span class="hljs-comment">#}</span>


<span class="hljs-comment"># This declaration allows BOOTP clients to get dynamic addresses,</span>
<span class="hljs-comment"># which we don't really recommend.</span>

<span class="hljs-comment">#subnet 10.254.239.32 netmask 255.255.255.224 {</span>
<span class="hljs-comment">#  range dynamic-bootp 10.254.239.40 10.254.239.60;</span>
<span class="hljs-comment">#  option broadcast-address 10.254.239.31;</span>
<span class="hljs-comment">#  option routers rtr-239-32-1.example.org;</span>
<span class="hljs-comment">#}</span>

<span class="hljs-comment"># A slightly different configuration for an internal subnet.</span>
<span class="hljs-comment">#subnet 10.5.5.0 netmask 255.255.255.224 {</span>
<span class="hljs-comment">#  range 10.5.5.26 10.5.5.30;</span>
<span class="hljs-comment">#  option domain-name-servers ns1.internal.example.org;</span>
<span class="hljs-comment">#  option domain-name "internal.example.org";</span>
<span class="hljs-comment">#  option subnet-mask 255.255.255.224;</span>
<span class="hljs-comment">#  option routers 10.5.5.1;</span>
<span class="hljs-comment">#  option broadcast-address 10.5.5.31;</span>
<span class="hljs-comment">#  default-lease-time 600;</span>
<span class="hljs-comment">#  max-lease-time 7200;</span>
<span class="hljs-comment">#}</span>

<span class="hljs-comment"># Hosts which require special configuration options can be listed in</span>
<span class="hljs-comment"># host statements.   If no address is specified, the address will be</span>
<span class="hljs-comment"># allocated dynamically (if possible), but the host-specific information</span>
<span class="hljs-comment"># will still come from the host declaration.</span>

<span class="hljs-comment">#host passacaglia {</span>
<span class="hljs-comment">#  hardware ethernet 0:0:c0:5d:bd:95;</span>
<span class="hljs-comment">#  filename "vmunix.passacaglia";</span>
<span class="hljs-comment">#  server-name "toccata.example.com";</span>
<span class="hljs-comment">#}</span>

<span class="hljs-comment"># Fixed IP addresses can also be specified for hosts.   These addresses</span>
<span class="hljs-comment"># should not also be listed as being available for dynamic assignment.</span>
<span class="hljs-comment"># Hosts for which fixed IP addresses have been specified can boot using</span>
<span class="hljs-comment"># BOOTP or DHCP.   Hosts for which no fixed address is specified can only</span>
<span class="hljs-comment"># be booted with DHCP, unless there is an address range on the subnet</span>
<span class="hljs-comment"># to which a BOOTP client is connected which has the dynamic-bootp flag</span>
<span class="hljs-comment"># set.</span>
<span class="hljs-comment">#host fantasia {</span>
<span class="hljs-comment">#  hardware ethernet 08:00:07:26:c0:a5;</span>
<span class="hljs-comment">#  fixed-address fantasia.example.com;</span>
<span class="hljs-comment">#}</span>

<span class="hljs-comment"># You can declare a class of clients and then do address allocation</span>
<span class="hljs-comment"># based on that.   The example below shows a case where all clients</span>
<span class="hljs-comment"># in a certain class get addresses on the 10.17.224/24 subnet, and all</span>
<span class="hljs-comment"># other clients get addresses on the 10.0.29/24 subnet.</span>

<span class="hljs-comment">#class "foo" {</span>
<span class="hljs-comment">#  match if substring (option vendor-class-identifier, 0, 4) = "SUNW";</span>
<span class="hljs-comment">#}</span>

<span class="hljs-comment">#shared-network 224-29 {</span>
<span class="hljs-comment">#  subnet 10.17.224.0 netmask 255.255.255.0 {</span>
<span class="hljs-comment">#    option routers rtr-224.example.org;</span>
<span class="hljs-comment">#  }</span>
<span class="hljs-comment">#  subnet 10.0.29.0 netmask 255.255.255.0 {</span>
<span class="hljs-comment">#    option routers rtr-29.example.org;</span>
<span class="hljs-comment">#  }</span>
<span class="hljs-comment">#  pool {</span>
<span class="hljs-comment">#    allow members of "foo";</span>
<span class="hljs-comment">#    range 10.17.224.10 10.17.224.250;</span>
<span class="hljs-comment">#  }</span>
<span class="hljs-comment">#  pool {</span>
<span class="hljs-comment">#    deny members of "foo";</span>
<span class="hljs-comment">#    range 10.0.29.10 10.0.29.230;</span>
<span class="hljs-comment">#  }</span>
<span class="hljs-comment">#}</span>
</code></pre>
<h3 data-id="heading-11">é…ç½®ç½‘ç»œæ¥å£</h3>
<p>è¿™é‡Œéœ€è¦é…ç½®æ­£ç¡®çš„ç½‘ç»œæ¥å£</p>
<ol>
<li>ç¼–è¾‘<code>/etc/default/isc-dhcp-server</code>æ–‡ä»¶ï¼Œè®¾ç½®DHCPæœåŠ¡ç›‘å¬çš„ç½‘ç»œæ¥å£ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œå®ƒå°†ç›‘å¬æ‰€æœ‰ç½‘ç»œæ¥å£ã€‚å¦‚æœéœ€è¦æŒ‡å®šç‰¹å®šæ¥å£ï¼Œè¯·æŒ‰ç…§ä»¥ä¸‹æ­¥éª¤æ“ä½œï¼š<br/>
sudo gedit /etc/default/isc-dhcp-server</li>
<li>æ‰¾åˆ°<code>INTERFACESv4</code>è¡Œï¼Œå¹¶å°†å…¶è®¾ç½®ä¸ºè¦ç›‘å¬çš„æ¥å£åç§°ï¼Œä¾‹å¦‚<code>ens33</code>,å…·ä½“è¦ç”¨ifconfigå¯ä»¥æŸ¥è¯¢åˆ°ï¼š<br/>
INTERFACESv4="ens33"</li>
<li>ä¿å­˜å¹¶å…³é—­æ–‡ä»¶ã€‚</li>
</ol>
<h3 data-id="heading-12">å¯åŠ¨å’Œå¯ç”¨DHCPæœåŠ¡</h3>
<ol>
<li>é‡å¯DHCPæœåŠ¡ä»¥åº”ç”¨æ›´æ”¹ï¼š<br/>
sudo systemctl restart isc-dhcp-server</li>
<li>ä½¿DHCPæœåŠ¡åœ¨å¯åŠ¨æ—¶è‡ªåŠ¨è¿è¡Œï¼š<br/>
sudo systemctl enable isc-dhcp-server</li>
</ol>
<h3 data-id="heading-13">æµ‹è¯•DHCPæœåŠ¡</h3>
<ol>
<li>åœ¨å¦ä¸€å°è®¡ç®—æœºä¸Šï¼Œå°†å…¶ç½‘ç»œè®¾ç½®æ›´æ”¹ä¸ºè‡ªåŠ¨è·å–IPåœ°å€ï¼ˆDHCPï¼‰ã€‚<br/>
å¯ä»¥ä¸¤å°ç‰©ç†æœºï¼Œä¸€å°åšæœåŠ¡ï¼Œä¸€å°åšå®¢æˆ·æœºè®¾ç½®DHCPï¼Œç”¨ä¸€ä¸ªäº¤æ¢æœºæˆ–è€…ä¸€æ ¹ç½‘çº¿ç›´è¿å°±å¯ä»¥å®ç°ã€‚<br/>
å¦‚æœæ˜¯VMWareï¼Œå‚ç…§ä¹¦ä¸Šçš„åšå®éªŒï¼Œå°†ä¸¤å°è™šæ‹Ÿæœºè¿æ¥åœ¨ä¸€èµ·ï¼Œè™šæ‹Ÿç½‘å¡çš„DHCPæœåŠ¡å…³é—­ï¼Œä¸¤å°å¼€æœºå°±å¯ä»¥äº†ã€‚</li>
<li>é‡å¯è®¡ç®—æœºæˆ–æ–­å¼€å¹¶é‡æ–°è¿æ¥ç½‘ç»œã€‚</li>
<li>åœ¨æ–°è®¡ç®—æœºçš„å‘½ä»¤è¡Œä¸­ï¼Œè¾“å…¥ä»¥ä¸‹å‘½ä»¤ä»¥æŸ¥çœ‹åˆ†é…çš„IPåœ°å€ï¼š<br/>
ifconfig<br/>
æˆ–è€…<br/>
ip addr</li>
</ol>
<h2 data-id="heading-14">3.DNSæœåŠ¡éƒ¨ç½²</h2>
<p>DNSï¼ˆåŸŸåç³»ç»Ÿï¼‰æ˜¯äº’è”ç½‘ä¸Šä¸å¯æˆ–ç¼ºçš„æœåŠ¡ä¹‹ä¸€ï¼Œå®ƒå°†æ˜“äºè®°å¿†çš„åŸŸåè½¬æ¢ä¸ºIPåœ°å€ã€‚åœ¨Ubuntuç³»ç»Ÿä¸­æ­å»ºDNSæœåŠ¡å™¨å¯¹äºç½‘ç»œç®¡ç†å’Œç»´æŠ¤è‡³å…³é‡è¦ã€‚</p>
<h3 data-id="heading-15">å®‰è£…BIND</h3>
<p>BINDï¼ˆBerkeley Internet Name Domainï¼‰æ˜¯Linuxç³»ç»Ÿä¸­å¸¸ç”¨çš„DNSæœåŠ¡å™¨è½¯ä»¶ã€‚ä»¥ä¸‹æ˜¯å®‰è£…BINDçš„æ­¥éª¤ï¼š</p>
<pre><code class="hljs language-sql" lang="sql">sudo apt<span class="hljs-operator">-</span><span class="hljs-keyword">get</span> <span class="hljs-keyword">update</span>
sudo apt<span class="hljs-operator">-</span><span class="hljs-keyword">get</span> install bind9 bind9<span class="hljs-operator">-</span>utils
</code></pre>
<h3 data-id="heading-16">é…ç½®DNSæœåŠ¡å™¨</h3>
<h3 data-id="heading-17">1. ç¼–è¾‘ä¸»é…ç½®æ–‡ä»¶</h3>
<p>æ‰“å¼€ä¸»é…ç½®æ–‡ä»¶<code>/etc/bind/named.conf</code>ï¼Œæ·»åŠ æˆ–ä¿®æ”¹ä»¥ä¸‹å†…å®¹ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">zone <span class="hljs-string">"example.com"</span> IN {
        <span class="hljs-built_in">type</span> master;
        file <span class="hljs-string">"/etc/bind/zones/db.example.com"</span>;
};
</code></pre>
<h3 data-id="heading-18">2. åˆ›å»ºåŒºåŸŸæ–‡ä»¶</h3>
<p>åˆ›å»ºç›®å½•</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment">#ç¡®ä¿ç›®å½•å­˜åœ¨</span>
sudo <span class="hljs-built_in">mkdir</span> -p /etc/bind/zones
<span class="hljs-comment">#åœ¨`/etc/bind/zones/`ç›®å½•ä¸‹åˆ›å»ºåä¸º`db.example.com`çš„åŒºåŸŸæ–‡ä»¶</span>
sudo gedit /etc/bind/zones/db.example.com
</code></pre>
<p><a href="https://link.juejin.cn?target=http%3A%2F%2Fdb.example.com%25E7%259A%2584%25E7%25A4%25BA%25E4%25BE%258B%25E5%2586%2585%25E5%25AE%25B9%25E5%25A6%2582%25E4%25B8%258B%25EF%25BC%2588IP%25E5%258F%25AF%25E4%25BB%25A5%25E6%258D%25A2%25E6%2588%2590%25E4%25BD%25A0%25E8%2587%25AA%25E5%25B7%25B1%25E7%259A%2584%25E6%259C%25BA%25E5%2599%25A8IP%25EF%25BC%2589%25EF%25BC%259A" target="_blank" title="http://db.example.com%E7%9A%84%E7%A4%BA%E4%BE%8B%E5%86%85%E5%AE%B9%E5%A6%82%E4%B8%8B%EF%BC%88IP%E5%8F%AF%E4%BB%A5%E6%8D%A2%E6%88%90%E4%BD%A0%E8%87%AA%E5%B7%B1%E7%9A%84%E6%9C%BA%E5%99%A8IP%EF%BC%89%EF%BC%9A" ref="nofollow noopener noreferrer">db.example.comçš„ç¤ºä¾‹å†…å®¹å¦‚ä¸‹ï¼ˆIPå¯ä»¥æ¢æˆä½ è‡ªå·±çš„æœºå™¨IPï¼‰ï¼š</a></p>
<pre><code class="hljs language-ini" lang="ini">$TTL    604800
@       IN      SOA     ns1.example.com. admin.example.com. (
                          2023100401         <span class="hljs-comment">; Serial</span>
                          604800            <span class="hljs-comment">; Refresh</span>
                          86400             <span class="hljs-comment">; Retry</span>
                          2419200           <span class="hljs-comment">; Expire</span>
                          604800 )          <span class="hljs-comment">; Negative Cache TTL</span>
<span class="hljs-comment">;</span>
@       IN      NS      ns1.example.com.
ns1     IN      A       192.168.1.10
www     IN      A       192.168.1.11
</code></pre>
<h3 data-id="heading-19">3. é…ç½®DNSè§£æ</h3>
<p>åœ¨<code>/etc/resolv.conf</code>æ–‡ä»¶ä¸­æ·»åŠ ä»¥ä¸‹å†…å®¹ï¼š</p>
<pre><code class="hljs language-sql" lang="sql">nameserver <span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span>
<span class="hljs-keyword">search</span> example.com
</code></pre>
<h3 data-id="heading-20">å¯åŠ¨å’Œæµ‹è¯•DNSæœåŠ¡å™¨</h3>
<h3 data-id="heading-21">1. å¯åŠ¨DNSæœåŠ¡å™¨</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment">#å¯åŠ¨æœåŠ¡</span>
sudo systemctl restart bind9
<span class="hljs-comment">#è®¾ç½®å¼€æœºå¯åŠ¨</span>
sudo systemctl <span class="hljs-built_in">enable</span> bind9
<span class="hljs-comment">#ç¡®è®¤æœåŠ¡çŠ¶æ€</span>
sudo systemctl status bind9
</code></pre>
<h3 data-id="heading-22">2. æµ‹è¯•DNSè§£æ</h3>
<p>ä½¿ç”¨<code>nslookup</code>å‘½ä»¤æµ‹è¯•DNSè§£æï¼š</p>
<pre><code class="hljs">nslookup www.example.com
</code></pre>
<p>å¦‚æœç»“æœæ˜¾ç¤ºè§£æåˆ°çš„IPåœ°å€æ­£ç¡®ï¼Œåˆ™è¡¨ç¤ºDNSæœåŠ¡å™¨é…ç½®æˆåŠŸã€‚</p>
<h2 data-id="heading-23">4.ApacheæœåŠ¡éƒ¨ç½²</h2>
<p>ApacheæœåŠ¡å™¨æ˜¯ä¸€æ¬¾å¹¿æ³›ä½¿ç”¨çš„å¼€æºWebæœåŠ¡å™¨è½¯ä»¶ï¼Œå› å…¶ç¨³å®šæ€§å’ŒåŠŸèƒ½å¼ºå¤§è€Œå¤‡å—é’çã€‚åœ¨Ubuntuç³»ç»Ÿä¸‹ï¼Œå®‰è£…å’Œé…ç½®ApacheæœåŠ¡å™¨ç›¸å¯¹ç®€å•ã€‚æœ¬æ–‡å°†ä¸ºæ‚¨è¯¦ç»†ä»‹ç»å¦‚ä½•åœ¨Ubuntuç³»ç»Ÿä¸‹å¿«é€Ÿå¯åŠ¨å’Œé…ç½®ApacheæœåŠ¡å™¨ã€‚</p>
<h3 data-id="heading-24">å‡†å¤‡å·¥ä½œ</h3>
<p>åœ¨å¼€å§‹ä¹‹å‰ï¼Œè¯·ç¡®ä¿æ‚¨çš„Ubuntuç³»ç»Ÿå·²ç»æ›´æ–°åˆ°æœ€æ–°ç‰ˆæœ¬ã€‚å¯ä»¥é€šè¿‡ä»¥ä¸‹å‘½ä»¤æ›´æ–°ç³»ç»Ÿï¼š</p>
<pre><code class="hljs language-sql" lang="sql">sudo apt <span class="hljs-keyword">update</span>
sudo apt upgrade
</code></pre>
<p>ç¡®ä¿80ç«¯å£å¯ç”¨ã€‚å¯ä»¥é€šè¿‡ä»¥ä¸‹å‘½ä»¤æ¥æ£€æŸ¥ï¼š</p>
<pre><code class="hljs language-perl" lang="perl">sudo netstat -tlnp | <span class="hljs-keyword">grep</span> :<span class="hljs-number">80</span>
</code></pre>
<p>å¦‚æœè¾“å‡ºä¸ºç©ºï¼Œåˆ™è¡¨ç¤ºç³»ç»Ÿä¸Šæ²¡æœ‰å…¶ä»–WebæœåŠ¡å™¨ã€‚</p>
<h3 data-id="heading-25">å®‰è£…ApacheæœåŠ¡å™¨</h3>
<ol>
<li>ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å®‰è£…ApacheæœåŠ¡å™¨ï¼š</li>
</ol>

<pre><code class="hljs">sudo apt install apache2 -y
</code></pre>
<p>åœ¨å®‰è£…è¿‡ç¨‹ä¸­ï¼Œç³»ç»Ÿå¯èƒ½ä¼šæç¤ºæ‚¨è¾“å…¥å¯†ç ä»¥ç¡®è®¤å®‰è£…ã€‚</p>
<ol>
<li>å®‰è£…å®Œæˆåï¼Œå¯åŠ¨ApacheæœåŠ¡ï¼š</li>
</ol>

<pre><code class="hljs">sudo systemctl restart apache2
</code></pre>
<ol>
<li>è®¾ç½®å¼€æœºè‡ªå¯æœåŠ¡ï¼Œä»¥ä¾¿åœ¨ç³»ç»Ÿå¯åŠ¨æ—¶è‡ªåŠ¨å¯åŠ¨ApacheæœåŠ¡ï¼š</li>
</ol>

<pre><code class="hljs language-bash" lang="bash">sudo systemctl <span class="hljs-built_in">enable</span> apache2
</code></pre>
<ol>
<li>æ£€æŸ¥ApacheæœåŠ¡çš„çŠ¶æ€ï¼Œç¡®ä¿å®ƒæ­£åœ¨è¿è¡Œï¼š</li>
</ol>

<pre><code class="hljs language-lua" lang="lua">sudo systemctl <span class="hljs-built_in">status</span> apache2
</code></pre>
<h3 data-id="heading-26">é…ç½®ApacheæœåŠ¡å™¨</h3>
<p>ApacheæœåŠ¡å™¨çš„é…ç½®æ–‡ä»¶ä½äº<code>/etc/apache2/</code>ç›®å½•ä¸‹ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›åŸºæœ¬çš„é…ç½®æ­¥éª¤ï¼š</p>
<h3 data-id="heading-27">1. ä¿®æ”¹é»˜è®¤ç½‘ç«™æ–‡æ¡£æ ¹ç›®å½•</h3>
<p>é»˜è®¤æƒ…å†µä¸‹ï¼ŒApacheæœåŠ¡å™¨å°†ç½‘ç«™æ–‡æ¡£æ ¹ç›®å½•è®¾ç½®ä¸º<code>/var/www/html/</code>ã€‚æ‚¨å¯ä»¥æ ¹æ®éœ€è¦ä¿®æ”¹è¯¥ç›®å½•ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">sudo gedit /etc/apache2/apache2.conf
</code></pre>
<p>æ‰¾åˆ°ä»¥ä¸‹è¡Œå¹¶ä¿®æ”¹ï¼š</p>
<pre><code class="hljs language-css" lang="css">DocumentRoot /<span class="hljs-selector-tag">var</span>/www/<span class="hljs-selector-tag">html</span>/
</code></pre>
<p>å°†<code>/var/www/html/</code>æ›¿æ¢ä¸ºæ‚¨æƒ³è¦è®¾ç½®çš„ç›®å½•ã€‚</p>
<h2 data-id="heading-28">5.FTPæœåŠ¡éƒ¨ç½²</h2>
<p>åœ¨æ•°å­—åŒ–æ—¶ä»£ï¼Œæ–‡ä»¶ä¼ è¾“æ˜¯æ—¥å¸¸å·¥ä½œä¸­ä¸å¯æˆ–ç¼ºçš„ä¸€éƒ¨åˆ†ã€‚FTPï¼ˆæ–‡ä»¶ä¼ è¾“åè®®ï¼‰ä½œä¸ºä¸€é¡¹åŸºç¡€çš„äº’è”ç½‘æœåŠ¡ï¼Œå¹¿æ³›åº”ç”¨äºæ–‡ä»¶çš„ä¸Šä¼ å’Œä¸‹è½½ã€‚å¯¹ç”¨æˆ·æ¥è¯´ï¼ŒæŒæ¡FTPæ–‡ä»¶ä¼ è¾“æ˜¯ä¸€é¡¹åŸºæœ¬æŠ€èƒ½ã€‚</p>
<p>Windowsä¸‹ï¼Œå¯ä»¥ä¸‹è½½filezilla serverå¿«é€Ÿåˆ›å»ºï¼Œå®¢æˆ·ç«¯æ— è®ºæ˜¯é“¶æ²³éº’éºŸè¿˜æ˜¯Windowséƒ½å¯ä»¥ä½¿ç”¨filezilla clientã€‚</p>
<h3 data-id="heading-29">ä¸€ã€FTPåŸºç¡€</h3>
<h3 data-id="heading-30">1.1 ä»€ä¹ˆæ˜¯FTPï¼Ÿ</h3>
<p>FTPï¼ˆFile Transfer Protocolï¼‰æ˜¯ä¸€ç§ç½‘ç»œåè®®ï¼Œç”¨äºåœ¨ç½‘ç»œä¸Šè¿›è¡Œæ–‡ä»¶ä¼ è¾“ã€‚å®ƒå…è®¸ç”¨æˆ·åœ¨ç½‘ç»œä¸Šå…±äº«æ–‡ä»¶ã€æ–‡ä»¶å¤¹ä»¥åŠä¸Šä¼ æˆ–ä¸‹è½½æ–‡ä»¶ã€‚</p>
<h3 data-id="heading-31">1.2 FTPå·¥ä½œåŸç†</h3>
<p>FTPåŸºäºå®¢æˆ·ç«¯-æœåŠ¡å™¨æ¨¡å‹ï¼Œç”±FTPå®¢æˆ·ç«¯å’ŒFTPæœåŠ¡å™¨ç»„æˆã€‚å®¢æˆ·ç«¯æ˜¯ç”¨æˆ·ç”¨æ¥ä¸Šä¼ ã€ä¸‹è½½å’Œç®¡ç†æ–‡ä»¶çš„åº”ç”¨ç¨‹åºï¼Œè€ŒæœåŠ¡å™¨åˆ™æ˜¯å­˜å‚¨æ–‡ä»¶å¹¶å¤„ç†ç”¨æˆ·è¿æ¥è¯·æ±‚çš„æœåŠ¡å™¨ç¨‹åºã€‚</p>
<h3 data-id="heading-32">äºŒã€å®‰è£…FTPæœåŠ¡å™¨</h3>
<h3 data-id="heading-33">2.1 ä½¿ç”¨vsftpd</h3>
<p>Ubuntuç³»ç»Ÿé€šå¸¸é¢„è£…äº†vsftpdï¼ˆVery Secure FTP Daemonï¼‰ï¼Œè¿™æ˜¯æœ€å¸¸ç”¨çš„FTPæœåŠ¡å™¨ä¹‹ä¸€ã€‚</p>
<h3 data-id="heading-34">2.1.1 å®‰è£…vsftpd</h3>
<pre><code class="hljs language-bash" lang="bash">sudo apt-get install vsftpd -y
sudo ufw <span class="hljs-built_in">disable</span>  <span class="hljs-comment"># ä¸´æ—¶å…³é—­ï¼ˆæµ‹è¯•ç”¨ï¼‰</span>
</code></pre>
<h3 data-id="heading-35">2.1.2 é…ç½®vsftpd</h3>
<p>å®‰è£…å®Œæˆåï¼Œå¯ä»¥ç¼–è¾‘é…ç½®æ–‡ä»¶Â <code>/etc/vsftpd.conf</code>Â æ¥è‡ªå®šä¹‰FTPæœåŠ¡å™¨çš„è¡Œä¸ºã€‚</p>
<pre><code class="hljs language-bash" lang="bash">sudo gedit /etc/vsftpd.conf
</code></pre>
<p>åœ¨é…ç½®æ–‡ä»¶ä¸­ï¼Œå¯ä»¥è®¾ç½®ç”¨æˆ·æƒé™ã€åŒ¿åè®¿é—®ã€æ•°æ®ä¼ è¾“æ¨¡å¼ç­‰ã€‚</p>
<p>å°†é»˜è®¤è®¾ç½®æ”¹ä¸ºå¦‚ä¸‹ï¼ˆç®€åŒ–çš„é…ç½®ï¼Œç¡®ä¿ftpæœåŠ¡æ­£å¸¸å¯åŠ¨)</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># åŸºç¡€é…ç½®</span>
<span class="hljs-attr">listen</span>=<span class="hljs-literal">YES</span>
<span class="hljs-attr">listen_ipv6</span>=<span class="hljs-literal">NO</span>
<span class="hljs-attr">anonymous_enable</span>=<span class="hljs-literal">NO</span>
<span class="hljs-attr">local_enable</span>=<span class="hljs-literal">YES</span>
<span class="hljs-attr">write_enable</span>=<span class="hljs-literal">YES</span>
<span class="hljs-attr">local_umask</span>=<span class="hljs-number">022</span>

<span class="hljs-comment"># ç›®å½•é…ç½®</span>
<span class="hljs-attr">dirmessage_enable</span>=<span class="hljs-literal">YES</span>
<span class="hljs-attr">use_localtime</span>=<span class="hljs-literal">YES</span>
<span class="hljs-attr">xferlog_enable</span>=<span class="hljs-literal">YES</span>
<span class="hljs-attr">connect_from_port_20</span>=<span class="hljs-literal">YES</span>

<span class="hljs-comment"># å®‰å…¨é…ç½®</span>
<span class="hljs-attr">chroot_local_user</span>=<span class="hljs-literal">YES</span>
<span class="hljs-attr">allow_writeable_chroot</span>=<span class="hljs-literal">YES</span>

<span class="hljs-comment"># ç”¨æˆ·æ§åˆ¶</span>
<span class="hljs-attr">userlist_enable</span>=<span class="hljs-literal">YES</span>
<span class="hljs-attr">userlist_file</span>=/etc/vsftpd.userlist
<span class="hljs-attr">userlist_deny</span>=<span class="hljs-literal">NO</span>

<span class="hljs-comment"># å…¶ä»–å¿…è¦é…ç½®</span>
<span class="hljs-attr">secure_chroot_dir</span>=/var/run/vsftpd/empty
<span class="hljs-attr">pam_service_name</span>=vsftpd
<span class="hljs-attr">rsa_cert_file</span>=/etc/ssl/certs/ssl-cert-snakeoil.pem
<span class="hljs-attr">rsa_private_key_file</span>=/etc/ssl/private/ssl-cert-snakeoil.key
<span class="hljs-attr">ssl_enable</span>=<span class="hljs-literal">NO</span>
<span class="hljs-attr">utf8_filesystem</span>=<span class="hljs-literal">YES</span>
</code></pre>
<h3 data-id="heading-36">ä½¿ç”¨è™šæ‹Ÿç”¨æˆ·</h3>
<p>åˆ›å»ºç‹¬ç«‹çš„è™šæ‹Ÿç”¨æˆ·ï¼Œä¸ä½¿ç”¨ç³»ç»Ÿç”¨æˆ·ï¼Œå®‰å…¨æ€§æ›´é«˜ï¼š</p>
<ol>
<li>å®‰è£…å¿…è¦å·¥å…·</li>
</ol>

<pre><code class="hljs">sudo apt install libpam-pwdfile
</code></pre>
<ol>
<li>åˆ›å»ºè™šæ‹Ÿç”¨æˆ·å¯†ç æ–‡ä»¶</li>
</ol>

<pre><code class="hljs language-bash" lang="bash">sudo <span class="hljs-built_in">mkdir</span> /etc/vsftpd <span class="hljs-comment">#å¦‚æœæ²¡æœ‰å­˜åœ¨å°±å»ºä¸€ä¸ª</span>
<span class="hljs-comment"># åˆ›å»ºå¯†ç æ–‡ä»¶å¹¶æ·»åŠ ç”¨æˆ·</span>
sudo <span class="hljs-built_in">touch</span> /etc/vsftpd/virtual_users.passwd
sudo <span class="hljs-built_in">chmod</span> 600 /etc/vsftpd/virtual_users.passwd

<span class="hljs-comment"># æ·»åŠ è™šæ‹Ÿç”¨æˆ·ï¼ˆæ›¿æ¢ yourpassword ä¸ºå®é™…å¯†ç ï¼‰</span>
sudo htpasswd -b /etc/vsftpd/virtual_users.passwd virtualuser1 yourpassword1
sudo htpasswd -b /etc/vsftpd/virtual_users.passwd virtualuser2 yourpassword2
</code></pre>
<ol>
<li>é…ç½® PAM è®¤è¯</li>
</ol>
<p>åˆ›å»ºÂ <code>/etc/pam.d/vsftpd.virtual</code>Â æ–‡ä»¶ï¼š</p>
<pre><code class="hljs language-arduino" lang="arduino">sudo gedit /etc/pam.d/vsftpd.<span class="hljs-keyword">virtual</span>
</code></pre>
<p>æ·»åŠ å†…å®¹ï¼š</p>
<pre><code class="hljs language-swift" lang="swift">auth    <span class="hljs-keyword">required</span>    pam_pwdfile.so pwdfile <span class="hljs-operator">/</span>etc<span class="hljs-operator">/</span>vsftpd<span class="hljs-operator">/</span>virtual_users.passwd
account <span class="hljs-keyword">required</span>    pam_permit.so
</code></pre>
<ol>
<li>åˆ›å»ºè™šæ‹Ÿç”¨æˆ·æ˜ å°„çš„ç³»ç»Ÿç”¨æˆ·</li>
</ol>

<pre><code class="hljs language-arduino" lang="arduino">sudo useradd -d /data/ftp/<span class="hljs-keyword">virtual</span> -s /usr/sbin/nologin <span class="hljs-keyword">virtual</span>
sudo mkdir -p /data/ftp/<span class="hljs-keyword">virtual</span>/{virtualuser1,virtualuser2}
sudo chown -R <span class="hljs-keyword">virtual</span>:<span class="hljs-keyword">virtual</span> /data/ftp/<span class="hljs-keyword">virtual</span>
</code></pre>
<ol>
<li>ä¿®æ”¹ vsftpd.conf é…ç½®</li>
</ol>

<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># å¯ç”¨è™šæ‹Ÿç”¨æˆ·</span>
<span class="hljs-attr">guest_enable</span>=<span class="hljs-literal">YES</span>
<span class="hljs-attr">guest_username</span>=virtual
<span class="hljs-attr">virtual_use_local_privs</span>=<span class="hljs-literal">YES</span>

<span class="hljs-comment"># PAM é…ç½®</span>
<span class="hljs-attr">pam_service_name</span>=vsftpd.virtual

<span class="hljs-comment"># ç”¨æˆ·é…ç½®ç›®å½•</span>
<span class="hljs-attr">user_config_dir</span>=/etc/vsftpd/user_conf
</code></pre>
<ol>
<li>åˆ›å»ºç”¨æˆ·ç‹¬ç«‹é…ç½®</li>
</ol>

<pre><code class="hljs language-bash" lang="bash">sudo <span class="hljs-built_in">mkdir</span> -p /etc/vsftpd/user_conf

<span class="hljs-comment"># ä¸º virtualuser1 åˆ›å»ºé…ç½®</span>
sudo gedit /etc/vsftpd/user_conf/virtualuser1
</code></pre>
<p>æ·»åŠ å†…å®¹ï¼š</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">local_root</span>=/data/ftp/virtual/virtualuser1
<span class="hljs-attr">write_enable</span>=<span class="hljs-literal">YES</span>
<span class="hljs-attr">anon_upload_enable</span>=<span class="hljs-literal">YES</span>
<span class="hljs-attr">anon_mkdir_write_enable</span>=<span class="hljs-literal">YES</span>
</code></pre>
<p>åŒç†ä¸º virtualuser2 åˆ›å»ºé…ç½®ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">sudo gedit /etc/vsftpd/user_conf/virtualuser2
</code></pre>
<p>æ·»åŠ å†…å®¹ï¼š</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">local_root</span>=/data/ftp/virtual/virtualuser2
<span class="hljs-attr">write_enable</span>=<span class="hljs-literal">YES</span>
<span class="hljs-attr">anon_upload_enable</span>=<span class="hljs-literal">YES</span>
<span class="hljs-attr">anon_mkdir_write_enable</span>=<span class="hljs-literal">YES</span>
</code></pre>
<h3 data-id="heading-37">2.1.3 é‡å¯vsftpd</h3>
<p>é…ç½®å®Œæˆåï¼Œé‡å¯vsftpdä»¥åº”ç”¨æ›´æ”¹ã€‚</p>
<pre><code class="hljs language-lua" lang="lua">sudo systemctl restart vsftpd
sudo systemctl <span class="hljs-built_in">status</span> vsftpd
</code></pre>
<h3 data-id="heading-38">2.2 è®¾ç½®å¼€æœºè‡ªå¯</h3>
<p>ä¸ºäº†ç¡®ä¿FTPæœåŠ¡åœ¨ç³»ç»Ÿå¯åŠ¨æ—¶è‡ªåŠ¨è¿è¡Œï¼Œå¯ä»¥å°†vsftpdè®¾ç½®ä¸ºå¼€æœºè‡ªå¯ã€‚</p>
<pre><code class="hljs language-bash" lang="bash">sudo systemctl <span class="hljs-built_in">enable</span> vsftpd
</code></pre>
<p>åœ¨æ–‡ä»¶æµè§ˆä¸­è¾“å…¥æœåŠ¡çš„IPåœ°å€</p>
<pre><code class="hljs language-arduino" lang="arduino">ftp:<span class="hljs-comment">//192.168.10.200</span>
</code></pre>
<h2 data-id="heading-39">6.SambaæœåŠ¡éƒ¨ç½²</h2>
<p>Sambaæ˜¯ä¸€ç§å…è®¸Unix-likeç³»ç»Ÿï¼ˆå¦‚Ubuntuï¼‰ä¸å…¶ä»–Windowsç³»ç»Ÿä¹‹é—´è¿›è¡Œæ–‡ä»¶å’Œæ‰“å°æœºå…±äº«çš„åè®®ã€‚é€šè¿‡é…ç½®Sambaï¼Œæ‚¨å¯ä»¥è½»æ¾åœ°åœ¨ä¸åŒçš„æ“ä½œç³»ç»Ÿä¹‹é—´å…±äº«æ–‡ä»¶å’Œæ‰“å°æœºã€‚æœ¬æ–‡å°†è¯¦ç»†ä»‹ç»å¦‚ä½•åœ¨Ubuntuä¸Šé…ç½®Sambaï¼Œå®ç°è·¨å¹³å°æ–‡ä»¶å…±äº«ã€‚</p>
<h3 data-id="heading-40">Sambaçš„åŸºæœ¬æ¦‚å¿µ</h3>
<p>åœ¨å¼€å§‹é…ç½®ä¹‹å‰ï¼Œè®©æˆ‘ä»¬å…ˆäº†è§£ä¸€äº›åŸºæœ¬æ¦‚å¿µï¼š</p>
<ul>
<li><strong>SMB/CIFS</strong>ï¼šSambaåŸºäºSMBï¼ˆServer Message Blockï¼‰å’ŒCIFSï¼ˆCommon Internet File Systemï¼‰åè®®ï¼Œè¿™äº›åè®®æ˜¯Windowsæ–‡ä»¶å…±äº«çš„åŸºç¡€ã€‚</li>
<li><strong>SambaæœåŠ¡å™¨</strong>ï¼šè¿è¡ŒSambaè½¯ä»¶çš„è®¡ç®—æœºï¼Œå®ƒå…è®¸å…¶ä»–è®¡ç®—æœºè®¿é—®å…±äº«èµ„æºã€‚</li>
<li><strong>Sambaå®¢æˆ·ç«¯</strong>ï¼šè¿æ¥åˆ°SambaæœåŠ¡å™¨å¹¶è®¿é—®å…±äº«èµ„æºçš„è®¡ç®—æœºã€‚</li>
</ul>
<h3 data-id="heading-41">å®‰è£…Samba</h3>
<p>åœ¨Ubuntuä¸Šå®‰è£…Sambaéå¸¸ç®€å•ã€‚æ‰“å¼€ç»ˆç«¯å¹¶æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š</p>
<pre><code class="hljs language-sql" lang="sql">sudo apt <span class="hljs-keyword">update</span>
sudo apt install samba samba<span class="hljs-operator">-</span>common
</code></pre>
<h3 data-id="heading-42">é…ç½®Samba</h3>
<p>Sambaçš„é…ç½®æ–‡ä»¶ä½äº<code>/etc/samba/</code>ç›®å½•ä¸‹ï¼Œä¸»è¦çš„é…ç½®æ–‡ä»¶æ˜¯<code>smb.conf</code>ã€‚</p>
<h3 data-id="heading-43">ç¼–è¾‘smb.confæ–‡ä»¶</h3>
<p>æ‰“å¼€<code>smb.conf</code>æ–‡ä»¶è¿›è¡Œç¼–è¾‘ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">sudo <span class="hljs-built_in">cp</span> /etc/samba/smb.conf /etc/samba/smb.conf.bak <span class="hljs-comment">#å…ˆå¤‡ä»½</span>
sudo gedit /etc/samba/smb.conf <span class="hljs-comment">#å†ä¿®æ”¹</span>
</code></pre>
<h3 data-id="heading-44">åŸºæœ¬é…ç½®</h3>
<p>åœ¨<code>smb.conf</code>æ–‡ä»¶ä¸­ï¼Œæ‰¾åˆ°<code>[global]</code>éƒ¨åˆ†ï¼Œè¿›è¡Œä»¥ä¸‹é…ç½®(smb.confæœ€å°é…ç½®ï¼Œç¡®ä¿æœåŠ¡å¯åŠ¨)ï¼š</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-section">[global]</span>
    <span class="hljs-attr">workgroup</span> = WORKGROUP
    <span class="hljs-attr">security</span> = user

<span class="hljs-section">[myshare]</span>
    <span class="hljs-attr">path</span> = /srv/samba/myshare
    <span class="hljs-attr">writable</span> = <span class="hljs-literal">yes</span>
    valid <span class="hljs-attr">users</span> = user1 user2  <span class="hljs-comment"># åªå…è®¸è¿™ä¸¤ä¸ªç”¨æˆ·è®¿é—®</span>
</code></pre>
<h3 data-id="heading-45">é…ç½®ç”¨æˆ·</h3>
<p><strong>ç¬¬ä¸€æ­¥ï¼šåˆ›å»ºå…±äº«ç›®å½•</strong></p>
<pre><code class="hljs language-bash" lang="bash">sudo <span class="hljs-built_in">mkdir</span> -p /srv/samba/myshare
sudo <span class="hljs-built_in">chmod</span> 777 /srv/samba/myshare  <span class="hljs-comment"># ç®€å•è®¾ç½®æƒé™</span>
</code></pre>
<p><strong>ç¬¬äºŒæ­¥ï¼šåˆ›å»ºç”¨æˆ·å¹¶è®¾ç½®å¯†ç </strong></p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># åˆ›å»ºç³»ç»Ÿç”¨æˆ·ï¼ˆå¦‚æœæ²¡æœ‰ï¼‰</span>
sudo useradd user1
sudo useradd user2

<span class="hljs-comment"># è®¾ç½®Sambaå¯†ç ï¼ˆå…³é”®ï¼ï¼‰</span>
sudo smbpasswd -a user1  <span class="hljs-comment"># æŒ‰æç¤ºè¾“å…¥å¯†ç </span>
sudo smbpasswd -a user2  <span class="hljs-comment"># æŒ‰æç¤ºè¾“å…¥å¯†ç </span>
</code></pre>
<p><strong>ç¬¬ä¸‰æ­¥ï¼šé‡å¯æœåŠ¡</strong></p>
<pre><code class="hljs">sudo systemctl restart smbd
</code></pre>
<p>æ›´ç®€å•çš„ "ä»»ä½•äººå¯è®¿é—®" é…ç½®ï¼ˆå¦‚æœä¸éœ€è¦é™åˆ¶ç”¨æˆ·ï¼‰</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-section">[global]</span>
    <span class="hljs-attr">workgroup</span> = WORKGROUP
    <span class="hljs-attr">security</span> = user
    map to <span class="hljs-attr">guest</span> = Bad User

<span class="hljs-section">[public]</span>
    <span class="hljs-attr">path</span> = /srv/samba/public
    <span class="hljs-attr">writable</span> = <span class="hljs-literal">yes</span>
    guest <span class="hljs-attr">ok</span> = <span class="hljs-literal">yes</span>  <span class="hljs-comment"># å…è®¸åŒ¿åè®¿é—®</span>
</code></pre>
<h3 data-id="heading-46">é‡å¯SambaæœåŠ¡</h3>
<p>å®Œæˆé…ç½®åï¼Œé‡å¯SambaæœåŠ¡ä½¿æ›´æ”¹ç”Ÿæ•ˆï¼š</p>
<pre><code class="hljs">sudo systemctl restart smbd
sudo systemctl restart nmbd
</code></pre>
<h3 data-id="heading-47">æµ‹è¯•Sambaå…±äº«</h3>
<p>åœ¨Windowsä¸Šï¼Œæ‚¨å¯ä»¥æ‰“å¼€â€œæ–‡ä»¶èµ„æºç®¡ç†å™¨â€ï¼Œåœ¨åœ°å€æ ä¸­è¾“å…¥SambaæœåŠ¡å™¨çš„IPåœ°å€ï¼Œç„¶åè¾“å…¥æ­£ç¡®çš„ç”¨æˆ·åå’Œå¯†ç å³å¯è®¿é—®å…±äº«æ–‡ä»¶å¤¹ã€‚</p>
<pre><code class="hljs">\192.168.10.200
</code></pre>
<h2 data-id="heading-48">7.nginxæœåŠ¡éƒ¨ç½²</h2>
<p>Nginxæ˜¯ä¸€ä¸ªé«˜æ€§èƒ½çš„HTTPå’Œåå‘ä»£ç†webæœåŠ¡å™¨ï¼ŒåŒæ—¶ä¹Ÿæ˜¯IMAP/POP3/SMTPæœåŠ¡çš„æä¾›è€…ã€‚ç”±äºå…¶è½»é‡çº§å’Œé«˜å¹¶å‘å¤„ç†èƒ½åŠ›ï¼ŒNginxåœ¨äº’è”ç½‘ä¸­å¾—åˆ°äº†å¹¿æ³›çš„åº”ç”¨ã€‚æœ¬æ–‡å°†è¯¦ç»†ä»‹ç»å¦‚ä½•åœ¨Ubuntuç³»ç»Ÿä¸Šä»é›¶å¼€å§‹å®‰è£…å’Œé…ç½®Nginxã€‚</p>
<p>æ³¨æ„ï¼šApacheé»˜è®¤ä¹Ÿæ˜¯80ç«¯å£ï¼Œå°†apacheæœåŠ¡åœæ‰ã€‚æˆ‘ä»¬ä¹Ÿå¯ä»¥åœ¨nginxé…ç½®ä¸­ï¼Œæ”¹æ‰å•†å“ï¼Œæ”¹æˆ8080ï¼Œ8090ç­‰å…¶ä»–çš„ç«¯å£</p>
<pre><code class="hljs language-bash" lang="bash">sudo systemctl <span class="hljs-built_in">disable</span> apache2 <span class="hljs-comment">#åœæ­¢å¼€æœºå¯åŠ¨</span>
sudo systemctl stop apache2 <span class="hljs-comment">#åœæ­¢æœåŠ¡</span>
sudo reboot <span class="hljs-comment">#é‡å¯ç³»ç»Ÿ</span>
</code></pre>
<p>ç¡®ä¿80ç«¯å£å¯ç”¨ã€‚å¯ä»¥é€šè¿‡ä»¥ä¸‹å‘½ä»¤æ¥æ£€æŸ¥ï¼š</p>
<pre><code class="hljs language-perl" lang="perl">sudo netstat -tlnp | <span class="hljs-keyword">grep</span> :<span class="hljs-number">80</span>
</code></pre>
<p>å¦‚æœè¾“å‡ºä¸ºç©ºï¼Œåˆ™è¡¨ç¤ºç³»ç»Ÿä¸Šæ²¡æœ‰å…¶ä»–WebæœåŠ¡å™¨ã€‚</p>
<h3 data-id="heading-49">å®‰è£…Nginx</h3>
<h3 data-id="heading-50">æ›´æ–°è½¯ä»¶åŒ…ç´¢å¼•</h3>
<p>åœ¨å®‰è£…Nginxä¹‹å‰ï¼Œé¦–å…ˆéœ€è¦æ›´æ–°è½¯ä»¶åŒ…ç´¢å¼•ï¼š</p>
<pre><code class="hljs language-sql" lang="sql">sudo apt <span class="hljs-keyword">update</span>
</code></pre>
<h3 data-id="heading-51">å®‰è£…Nginx</h3>
<p>æ¥ä¸‹æ¥ï¼Œä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å®‰è£…Nginxï¼š</p>
<pre><code class="hljs">sudo apt install nginx
</code></pre>
<p>å®‰è£…è¿‡ç¨‹ä¸­å¯èƒ½ä¼šæç¤ºæ‚¨ç¡®è®¤å®‰è£…ï¼Œè¾“å…¥<code>Y</code>å¹¶æŒ‰å›è½¦ç»§ç»­ã€‚</p>
<h3 data-id="heading-52">éªŒè¯å®‰è£…</h3>
<p>å®‰è£…å®Œæˆåï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹å‘½ä»¤éªŒè¯Nginxæ˜¯å¦å®‰è£…æˆåŠŸï¼š</p>
<pre><code class="hljs">nginx -v
</code></pre>
<p>å¦‚æœçœ‹åˆ°Nginxçš„ç‰ˆæœ¬ä¿¡æ¯ï¼Œè¯´æ˜å®‰è£…æˆåŠŸã€‚</p>
<h3 data-id="heading-53">å¯åŠ¨å’Œåœæ­¢Nginx</h3>
<h3 data-id="heading-54">å¯åŠ¨Nginx</h3>
<p>ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å¯åŠ¨Nginxï¼š</p>
<pre><code class="hljs language-sql" lang="sql">sudo systemctl <span class="hljs-keyword">start</span> nginx
</code></pre>
<h3 data-id="heading-55">åœæ­¢Nginx</h3>
<p>ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤åœæ­¢Nginxï¼š</p>
<pre><code class="hljs language-arduino" lang="arduino">sudo systemctl stop nginx
</code></pre>
<h3 data-id="heading-56">é‡å¯Nginx</h3>
<p>ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤é‡å¯Nginxï¼š</p>
<pre><code class="hljs">sudo systemctl restart nginx
</code></pre>
<h3 data-id="heading-57">è®¾ç½®Nginxå¼€æœºè‡ªå¯</h3>
<p>ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤è®¾ç½®Nginxå¼€æœºè‡ªå¯ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">sudo systemctl <span class="hljs-built_in">enable</span> nginx
</code></pre>
<h3 data-id="heading-58">é…ç½®Nginx</h3>
<h3 data-id="heading-59">æŸ¥çœ‹é»˜è®¤é…ç½®æ–‡ä»¶</h3>
<p>Nginxçš„é»˜è®¤é…ç½®æ–‡ä»¶ä½äº<code>/etc/nginx/nginx.conf</code>ã€‚æ‚¨å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æŸ¥çœ‹ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">sudo vim /etc/nginx/nginx.conf
</code></pre>
<h3 data-id="heading-60">ç¼–è¾‘é»˜è®¤é…ç½®æ–‡ä»¶</h3>
<p>æ ¹æ®æ‚¨çš„éœ€æ±‚ï¼Œæ‚¨å¯ä»¥ä¿®æ”¹é»˜è®¤é…ç½®æ–‡ä»¶ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›å¸¸è§çš„ä¿®æ”¹å†…å®¹ï¼š</p>
<ul>
<li>ä¿®æ”¹æœåŠ¡å™¨ç›‘å¬çš„ç«¯å£</li>
<li>é…ç½®æœåŠ¡å™¨æ ¹ç›®å½•</li>
<li>é…ç½®åå‘ä»£ç†</li>
</ul>
<p>è¿™é‡Œé¢å¯ä»¥é»˜è®¤ç›‘å¬ç«¯å£å’Œç½‘ç«™æ–‡ä»¶ç›®å½•</p>
<pre><code class="hljs language-arduino" lang="arduino">/etc/nginx/sites-enabled/<span class="hljs-keyword">default</span>
</code></pre>
<h3 data-id="heading-61">å†…å®¹å¦‚ä¸‹</h3>
<pre><code class="hljs language-ini" lang="ini">server {
    listen 809default_server<span class="hljs-comment">;</span>
    listen <span class="hljs-section">[::]</span>:80 default_server<span class="hljs-comment">;</span>
    root /var/www/html<span class="hljs-comment">;</span>
    <span class="hljs-comment"># Add index.php to the list if you are using PHP</span>
    index index.html index.htm index.nginx-debian.html<span class="hljs-comment">;</span>
    server_name _<span class="hljs-comment">;</span>
    location / {
            <span class="hljs-comment"># First attempt to serve request as file, then</span>
            <span class="hljs-comment"># as directory, then fall back to displaying a 404.</span>
            try_files $uri $uri/ =404<span class="hljs-comment">;</span>
    }
}
</code></pre>
<h3 data-id="heading-62">é‡è½½Nginxé…ç½®</h3>
<p>é‡æ–°åŠ è½½Nginxé…ç½®ä»¥ä½¿æ›´æ”¹ç”Ÿæ•ˆï¼š</p>
<pre><code class="hljs">sudo systemctl reload nginx
</code></pre>
<h3 data-id="heading-63">æµ‹è¯•ç½‘ç«™</h3>
<p>åœ¨æµè§ˆå™¨ä¸­è¾“å…¥æ‚¨çš„æœåŠ¡å™¨IPåœ°å€ï¼Œå¦‚æœä¸€åˆ‡æ­£å¸¸ï¼Œæ‚¨åº”è¯¥èƒ½çœ‹åˆ°Nginxçš„é»˜è®¤æ¬¢è¿é¡µé¢ã€‚</p>
<p>æ³¨ï¼šæœ¬æ–‡å‚è€ƒäº†<a href="https://link.juejin.cn?target=https%3A%2F%2Flink.zhihu.com%2F%3Ftarget%3Dhttps%253A%2F%2Flink.segmentfault.com%2F%253Fenc%253DKYCoadOOa0Cp%25252B9TyW3z1FA%25253D%25253D.mGVfIt48Wa8wrrEj61B1o5hZ84k%25252FG%25252FbmjkAL9PW0Kiw%25253D" target="_blank" title="https://link.zhihu.com/?target=https%3A//link.segmentfault.com/%3Fenc%3DKYCoadOOa0Cp%252B9TyW3z1FA%253D%253D.mGVfIt48Wa8wrrEj61B1o5hZ84k%252FG%252FbmjkAL9PW0Kiw%253D" ref="nofollow noopener noreferrer">www.oryoy.com/</a>ä¸Šçš„Ubuntuè½»æ¾ä¸Šæ‰‹ç³»åˆ—æ•™ç¨‹</p>
<h2 data-id="heading-64">å†™åœ¨æœ€å</h2>
<p>æœ¬ç¯‡ä¸»è¦ç›®æ ‡æ˜¯å‘Šè¯‰å¤§å®¶æ€ä¹ˆç®€å•å¿«é€Ÿçš„éƒ¨ç½²å¸¸è§çš„æœåŠ¡</p>
<p>ä¿¡åˆ›å¼€æºèµ„æºï¼Œå°½åœ¨XPlazaï¼</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[SpreadJS è‡ªå®šä¹‰å‡½æ•°å®æˆ˜æŒ‡å—ï¼šä»å…¥é—¨åˆ°é¿å‘]]></title>    <link>https://juejin.cn/post/7579093412332634122</link>    <guid>https://juejin.cn/post/7579093412332634122</guid>    <pubDate>2025-12-03T02:34:00.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7579093412332634122" data-draft-id="7579111646875238451" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="SpreadJS è‡ªå®šä¹‰å‡½æ•°å®æˆ˜æŒ‡å—ï¼šä»å…¥é—¨åˆ°é¿å‘"/> <meta itemprop="keywords" content="å‰ç«¯"/> <meta itemprop="datePublished" content="2025-12-03T02:34:00.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="è‘¡è„åŸæŠ€æœ¯å›¢é˜Ÿ"/> <meta itemprop="url" content="https://juejin.cn/user/3227821868332765"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            SpreadJS è‡ªå®šä¹‰å‡½æ•°å®æˆ˜æŒ‡å—ï¼šä»å…¥é—¨åˆ°é¿å‘
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3227821868332765/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    è‘¡è„åŸæŠ€æœ¯å›¢é˜Ÿ
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-03T02:34:00.000Z" title="Wed Dec 03 2025 02:34:00 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-03
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»5åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">SpreadJS è‡ªå®šä¹‰å‡½æ•°å®æˆ˜æŒ‡å—ï¼šä»å…¥é—¨åˆ°é¿å‘</h2>
<p>åœ¨ä¼ä¸šçº§è¡¨æ ¼åº”ç”¨å¼€å‘ä¸­ï¼Œå†…ç½®å‡½æ•°å¾€å¾€éš¾ä»¥æ»¡è¶³å¤æ‚çš„ä¸šåŠ¡é€»è¾‘éœ€æ±‚ã€‚SpreadJS ä½œä¸ºä¸€æ¬¾åŠŸèƒ½å¼ºå¤§çš„ç±» Excel è¡¨æ ¼æ§ä»¶ï¼Œæä¾›äº†çµæ´»çš„<strong>è‡ªå®šä¹‰å‡½æ•°ï¼ˆCustom Functionï¼‰</strong> èƒ½åŠ›ï¼Œè®©å¼€å‘è€…å¯ä»¥åƒä½¿ç”¨ SUMã€VLOOKUP é‚£æ ·ï¼Œåœ¨å•å…ƒæ ¼å…¬å¼ä¸­ç›´æ¥è°ƒç”¨è‡ªå·±ç¼–å†™çš„é€»è¾‘ã€‚æœ¬æ–‡å°†å›´ç»•â€œä»€ä¹ˆæ˜¯è‡ªå®šä¹‰å‡½æ•°â€ã€â€œå¦‚ä½•å®ç°â€ã€â€œå¼‚æ­¥åœºæ™¯å¤„ç†â€ä»¥åŠâ€œæ–°æ‰‹é¿å‘æŒ‡å—â€å››ä¸ªç»´åº¦ï¼Œå¸¦ä½ å…¨é¢æŒæ¡ SpreadJS è‡ªå®šä¹‰å‡½æ•°çš„å¼€å‘æŠ€å·§ã€‚</p>
<h3 data-id="heading-1">ä¸€ã€ä¸ºä»€ä¹ˆéœ€è¦è‡ªå®šä¹‰å‡½æ•°ï¼Ÿ</h3>
<p>å‡½æ•°çš„æœ¬è´¨æ˜¯â€œå°è£…å¥½çš„ä»£ç ç‰‡æ®µâ€ã€‚ç”¨æˆ·é€šè¿‡ç®€å•è°ƒç”¨ï¼ˆå¦‚ <code>=SUM(A1:A10)</code>ï¼‰ï¼Œå³å¯å®Œæˆå¤æ‚æ“ä½œï¼Œæ— éœ€é‡å¤ç¼–å†™é€»è¾‘ã€‚SpreadJS çš„å†…ç½®å‡½æ•°è™½è¦†ç›–æ•°å­¦ã€é€»è¾‘ã€æŸ¥æ‰¾ç­‰å¸¸è§åœºæ™¯ï¼Œä½†åœ¨é¢å¯¹ä»¥ä¸‹æƒ…å†µæ—¶ä»æ˜¾ä¸è¶³ï¼š</p>
<ul>
<li><strong>ä¸šåŠ¡è§„åˆ™ç‰¹æ®Š</strong>ï¼šå¦‚å›ºå®šèµ„äº§æŠ˜æ—§è®¡ç®—ã€è¡Œä¸šç‰¹å®šæŒ‡æ ‡ï¼›</li>
<li><strong>ä¾èµ–å¤–éƒ¨æ•°æ®</strong>ï¼šå¦‚å®æ—¶æ±‡ç‡ã€å•†å“åº“å­˜ã€ç”¨æˆ·ä¿¡æ¯ï¼›</li>
<li><strong>å¤šäººåä½œéœ€ç»Ÿä¸€é€»è¾‘</strong>ï¼šé¿å…å› æ‰‹åŠ¨è®¡ç®—å¯¼è‡´ç»“æœä¸ä¸€è‡´ã€‚</li>
</ul>
<p>è‡ªå®šä¹‰å‡½æ•°çš„ä»·å€¼åœ¨äºï¼š</p>
<ul>
<li>âœ… <strong>æå‡æ•ˆç‡</strong>ï¼šä¸€é”®å®Œæˆå¤æ‚è®¡ç®—ï¼›</li>
<li>âœ… <strong>åŠ¨æ€å“åº”</strong>ï¼šæ•°æ®å˜åŒ–è‡ªåŠ¨æ›´æ–°ç»“æœï¼›</li>
<li>âœ… <strong>æ ‡å‡†åŒ–é€»è¾‘</strong>ï¼šç¡®ä¿å›¢é˜Ÿå†…è®¡ç®—è§„åˆ™ç»Ÿä¸€ã€‚</li>
</ul>
<h3 data-id="heading-2">äºŒã€ä»é›¶å®ç°ä¸€ä¸ªè‡ªå®šä¹‰å‡½æ•°</h3>
<p>åœ¨ SpreadJS ä¸­ï¼Œåˆ›å»ºè‡ªå®šä¹‰å‡½æ•°åªéœ€ä¸‰æ­¥ï¼š<strong>å®šä¹‰é€»è¾‘ â†’ æ³¨å†Œå‡½æ•° â†’ åº”ç”¨è°ƒç”¨</strong>ã€‚</p>
<h4 data-id="heading-3">1.å®šä¹‰å‡½æ•°é€»è¾‘</h4>
<p>ä½ éœ€è¦åˆ›å»ºä¸€ä¸ªå‡½æ•°ç±»ï¼Œç»§æ‰¿è‡ª <code>GC.Spread.CalcEngine.Functions.Function</code>ï¼Œå¹¶å®ç° <code>evaluate</code> æ–¹æ³•ã€‚è¯¥æ–¹æ³•è´Ÿè´£æ¥æ”¶å‚æ•°ã€æ‰§è¡Œè®¡ç®—å¹¶è¿”å›ç»“æœã€‚</p>
<pre><code class="hljs language-JavaScript" lang="JavaScript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">FactorialFunction</span>(<span class="hljs-params"/>) {
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = <span class="hljs-string">"FACTORIAL"</span>;
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">maxArgs</span> = <span class="hljs-number">1</span>;
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">minArgs</span> = <span class="hljs-number">1</span>;
}
<span class="hljs-title class_">FactorialFunction</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span> = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">GC</span>.<span class="hljs-property">Spread</span>.<span class="hljs-property">CalcEngine</span>.<span class="hljs-property">Functions</span>.<span class="hljs-title class_">Function</span>();
<span class="hljs-title class_">FactorialFunction</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">evaluate</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params">arg</span>) {
  <span class="hljs-keyword">let</span> result = <span class="hljs-number">1</span>;
  <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">arguments</span>.<span class="hljs-property">length</span> === <span class="hljs-number">1</span> &amp;&amp; !<span class="hljs-built_in">isNaN</span>(<span class="hljs-built_in">parseInt</span>(arg))) {
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">1</span>; i &lt;= arg; i++) {
      result = i * result;
    }
    <span class="hljs-keyword">return</span> result;
  }
  <span class="hljs-keyword">return</span> <span class="hljs-string">"#VALUE!"</span>;
};
<span class="hljs-title class_">FactorialFunction</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">description</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params"/>) {
  <span class="hljs-keyword">return</span> {
    <span class="hljs-attr">name</span>: <span class="hljs-string">"FACTORIAL"</span>,
    <span class="hljs-attr">description</span>:
      <span class="hljs-string">"è¿™æ˜¯ä¸€ä¸ªè®¡ç®—ä» 1 å¼€å§‹çš„é˜¶ä¹˜å¹¶åœ¨å•å…ƒæ ¼ä¸­æ˜¾ç¤ºçš„å‡½æ•°"</span>,
    <span class="hljs-attr">parameters</span>: [{ <span class="hljs-attr">name</span>: <span class="hljs-string">"number"</span> }],
  };
};
</code></pre>
<p>å¸¸è§çš„å®æˆ˜æ¡ˆä¾‹åŒ…æ‹¬ï¼š</p>
<ul>
<li><strong>é˜¶ä¹˜å‡½æ•°</strong>ï¼šå¤„ç†å•ä¸ªæ•°å€¼çš„é€’å½’è®¡ç®—ï¼›</li>
<li><strong>é˜¶ä¹˜æ•°ç»„å‡½æ•°</strong>ï¼šæ”¯æŒå¯¹åŒºåŸŸï¼ˆå¦‚ A1:A5ï¼‰æ‰¹é‡è®¡ç®—ï¼›</li>
<li><strong>å›ºå®šèµ„äº§æŠ˜æ—§å‡½æ•°</strong>ï¼šæ ¹æ®å¹´é™ã€æ®‹å€¼ç‡ç­‰å‚æ•°è®¡ç®—æœˆæŠ˜æ—§é¢ã€‚</li>
</ul>
<h4 data-id="heading-4">2.æ³¨å†Œå‡½æ•°</h4>
<p>é€šè¿‡ <code>workbook.addCustomFunction()</code> å°†å‡½æ•°æ³¨å†Œåˆ°å·¥ä½œç°¿ï¼ˆæˆ–å·¥ä½œè¡¨ã€å…¨å±€ï¼‰ï¼Œä½¿å…¶å¯åœ¨å…¬å¼ä¸­è¢«è¯†åˆ«ã€‚</p>
<pre><code class="hljs language-JavaScript" lang="JavaScript"><span class="hljs-keyword">let</span> factorial = <span class="hljs-keyword">new</span> <span class="hljs-title class_">FactorialFunction</span>();
<span class="hljs-comment">// å·¥ä½œç°¿çº§åˆ«æ³¨å†Œ</span>
spread.<span class="hljs-title function_">addCustomFunction</span>(factorial);
<span class="hljs-comment">// å·¥ä½œè¡¨çº§åˆ«æ³¨å†Œ</span>
sheet.<span class="hljs-title function_">addCustomFunction</span>(factorial);
</code></pre>
<h4 data-id="heading-5">3.åœ¨å•å…ƒæ ¼ä¸­ä½¿ç”¨</h4>
<p>æ³¨å†ŒæˆåŠŸåï¼Œå³å¯åƒå†…ç½®å‡½æ•°ä¸€æ ·ä½¿ç”¨ï¼Œä¾‹å¦‚ï¼š<code>=FACTORIAL(5)</code> æˆ– <code>=DEPRECIATION(B2, C2, D2)</code>ã€‚</p>
<h3 data-id="heading-6">ä¸‰ã€å¼‚æ­¥å‡½æ•°ï¼šå¤„ç†å¤–éƒ¨æ•°æ®ä¾èµ–</h3>
<p>æ™®é€šè‡ªå®šä¹‰å‡½æ•°æ˜¯<strong>åŒæ­¥æ‰§è¡Œ</strong>çš„ï¼Œä¸€æ—¦æ¶‰åŠç½‘ç»œè¯·æ±‚ï¼ˆå¦‚è°ƒç”¨ API è·å–æ±‡ç‡ï¼‰ã€æ•°æ®åº“æŸ¥è¯¢æˆ–è€—æ—¶è®¡ç®—ï¼Œå°±ä¼šé˜»å¡ UI çº¿ç¨‹ï¼Œå¯¼è‡´è¡¨æ ¼å¡é¡¿ã€‚æ­¤æ—¶ï¼Œåº”ä½¿ç”¨ <strong>å¼‚æ­¥è‡ªå®šä¹‰å‡½æ•°</strong>ã€‚</p>
<h4 data-id="heading-7">å¼‚æ­¥å‡½æ•°çš„æ ¸å¿ƒç‰¹ç‚¹ï¼š</h4>
<ul>
<li>ä¸ç«‹å³è¿”å›ç»“æœï¼Œè€Œæ˜¯å‘èµ·å¼‚æ­¥æ“ä½œï¼›</li>
<li>è¡¨æ ¼æš‚æ—¶æ˜¾ç¤ºé»˜è®¤å€¼ï¼ˆå¦‚ <code>"Loading..."</code>ï¼‰ï¼›</li>
<li>å¼‚æ­¥å®Œæˆåï¼Œé€šè¿‡ <code>context.setAsyncResult(result)</code> è‡ªåŠ¨æ›´æ–°å•å…ƒæ ¼ã€‚</li>
</ul>
<h4 data-id="heading-8">å…¸å‹åº”ç”¨åœºæ™¯ï¼š</h4>
<ul>
<li>æ ¹æ®å•†å“ ID å®æ—¶è·å–ä»·æ ¼ï¼›</li>
<li>æŸ¥è¯¢ç”¨æˆ·å†å²è®¢å•å¹¶ç»Ÿè®¡ï¼›</li>
<li>è°ƒç”¨ç¬¬ä¸‰æ–¹æœåŠ¡ï¼ˆå¦‚å¤©æ°”ã€æ±‡ç‡ï¼‰ã€‚</li>
</ul>
<pre><code class="hljs language-JavaScript" lang="JavaScript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">AsyncRateFunction</span>(<span class="hljs-params"/>) {
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = <span class="hljs-string">"ASYNC_GET_RATE"</span>;
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">minArgs</span> = <span class="hljs-number">1</span>;
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">maxArgs</span> = <span class="hljs-number">1</span>;
}
<span class="hljs-title class_">AsyncRateFunction</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span> =
  <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">GC</span>.<span class="hljs-property">Spread</span>.<span class="hljs-property">CalcEngine</span>.<span class="hljs-property">Functions</span>.<span class="hljs-title class_">AsyncFunction</span>(<span class="hljs-string">"ASYNC_GET_RATE"</span>);
<span class="hljs-title class_">AsyncRateFunction</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">defaultValue</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params"/>) {
  <span class="hljs-keyword">return</span> <span class="hljs-string">"åŠ è½½ä¸­..."</span>;
};
<span class="hljs-title class_">AsyncRateFunction</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">evaluate</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params">context</span>) {
  <span class="hljs-keyword">let</span> currency = <span class="hljs-variable language_">arguments</span>[<span class="hljs-number">1</span>]?.<span class="hljs-title function_">toUpperCase</span>();

  <span class="hljs-keyword">if</span> (![<span class="hljs-string">"USD"</span>, <span class="hljs-string">"EUR"</span>].<span class="hljs-title function_">includes</span>(currency)) {
    <span class="hljs-keyword">return</span> <span class="hljs-string">"#INVALID! ä»…æ”¯æŒUSD/EUR"</span>;
  }

  <span class="hljs-title function_">fetch</span>(
    <span class="hljs-string">`https://api.apilayer.com/exchangerates_data/latest?base=<span class="hljs-subst">${currency}</span>&amp;symbols=CNY`</span>,
    {
      <span class="hljs-attr">headers</span>: { <span class="hljs-attr">apikey</span>: <span class="hljs-string">"your_api_key"</span> },
    }
  )
    .<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">res</span>) =&gt;</span> res.<span class="hljs-title function_">json</span>())
    .<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">data</span>) =&gt;</span> {
      <span class="hljs-keyword">let</span> rate = data.<span class="hljs-property">rates</span>?.<span class="hljs-property">CNY</span>;
      rate
        ? context.<span class="hljs-title function_">setAsyncResult</span>(<span class="hljs-built_in">parseFloat</span>(rate.<span class="hljs-title function_">toFixed</span>(<span class="hljs-number">4</span>)))
        : context.<span class="hljs-title function_">setAsyncResult</span>(<span class="hljs-string">"#NO_DATA! æœªè·å–åˆ°æ±‡ç‡"</span>);
    })
    .<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">err</span>) =&gt;</span> {
      context.<span class="hljs-title function_">setAsyncResult</span>(<span class="hljs-string">`#API_ERROR: <span class="hljs-subst">${err.message}</span>`</span>);
    });
};
<span class="hljs-title class_">AsyncRateFunction</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">evaluateMode</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params"/>) {
  <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;
};
<span class="hljs-title class_">AsyncRateFunction</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">description</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params"/>) {
  <span class="hljs-keyword">return</span> {
    <span class="hljs-attr">name</span>: <span class="hljs-string">"ASYNC_GET_RATE"</span>,
    <span class="hljs-attr">description</span>: <span class="hljs-string">"å¼‚æ­¥è·å–æŒ‡å®šè´§å¸çš„æ±‡ç‡"</span>,
    <span class="hljs-attr">parameters</span>: [{ <span class="hljs-attr">name</span>: <span class="hljs-string">"currency"</span>, <span class="hljs-attr">description</span>: <span class="hljs-string">"è´§å¸ç±»å‹ï¼ˆUSD/EURï¼‰"</span> }],
  };
};
</code></pre>
<blockquote>
<p>ğŸ’¡ <strong>æ³¨æ„</strong>ï¼šå¼‚æ­¥å‡½æ•°å¿…é¡»åœ¨ <code>evaluate</code> ä¸­è°ƒç”¨ <code>context.setAsyncResult()</code>ï¼Œè€Œä¸èƒ½ä½¿ç”¨ <code>return</code>ã€‚</p>
</blockquote>
<h4 data-id="heading-9">åŒæ­¥ vs å¼‚æ­¥å¯¹æ¯”</h4>






























<table><thead><tr><th>ç»´åº¦</th><th>åŒæ­¥å‡½æ•°</th><th>å¼‚æ­¥å‡½æ•°</th></tr></thead><tbody><tr><td>æ‰§è¡Œæ–¹å¼</td><td>ç«‹å³æ‰§è¡Œï¼Œé˜»å¡è¡¨æ ¼</td><td>å¼‚æ­¥æ‰§è¡Œï¼Œä¸é˜»å¡</td></tr><tr><td>é€‚ç”¨åœºæ™¯</td><td>æœ¬åœ°è®¡ç®—ï¼ˆé˜¶ä¹˜ã€åŠ å‡ï¼‰</td><td>å¤–éƒ¨æ•°æ®ä¾èµ–ï¼ˆAPI/DBï¼‰</td></tr><tr><td>è¿”å›æ–¹å¼</td><td>return result</td><td>context.setAsyncResult(result)</td></tr><tr><td>æœªå®ŒæˆçŠ¶æ€</td><td>æ— </td><td>æ˜¾ç¤º defaultValue</td></tr></tbody></table>
<h3 data-id="heading-10">å››ã€æ–°æ‰‹å¼€å‘é¿å‘æŒ‡å—</h3>
<p>åœ¨å®é™…å¼€å‘ä¸­ï¼Œä»¥ä¸‹é—®é¢˜é«˜é¢‘å‡ºç°ï¼ŒåŠ¡å¿…æå‰è§„é¿ï¼š</p>
<h4 data-id="heading-11">1.å¯¼å…¥æ–‡ä»¶åå‡ºç° <code>#NAME?</code></h4>
<p>åŸå› ï¼šè‡ªå®šä¹‰å‡½æ•°åœ¨å¯¼å…¥æ¨¡æ¿<strong>ä¹‹å</strong>æ‰æ³¨å†Œï¼Œå¯¼è‡´å…¬å¼æ— æ³•è¯†åˆ«ã€‚ âœ… è§£å†³æ–¹æ¡ˆï¼šå…ˆå¯¼å…¥æ–‡ä»¶ â†’ å†æ³¨å†Œå‡½æ•° â†’ æœ€åè°ƒç”¨ <code>workbook.calcEngine().calculate("rebuild")</code>ã€‚</p>
<h4 data-id="heading-12">2.å‡½æ•°ä½œç”¨åŸŸæ··ä¹±</h4>
<p>å‡½æ•°å¯æ³¨å†Œåˆ° <code>workbook</code>ã€<code>worksheet</code> æˆ–å…¨å±€ <code>GC</code> å¯¹è±¡ã€‚</p>
<ul>
<li>ä¸€èˆ¬æ¨èæ³¨å†Œåˆ° <code>workbook</code>ï¼›</li>
<li>è‹¥éœ€è·¨å¤šä¸ªå·¥ä½œç°¿å¤ç”¨ï¼Œå¯æ³¨å†Œåˆ° <code>GC.Spread.CalcEngine.Functions</code>.</li>
</ul>
<h4 data-id="heading-13">3.è¿”å›å€¼ç±»å‹é”™è¯¯</h4>
<ul>
<li>åŒæ­¥å‡½æ•°ï¼š<code>return value</code></li>
<li>æ•°ç»„å‡½æ•°ï¼šè¿”å› <code>CalcArray</code> å¯¹è±¡</li>
<li>å¼‚æ­¥å‡½æ•°ï¼šå¿…é¡»ç”¨ <code>context.setAsyncResult()</code></li>
</ul>
<h4 data-id="heading-14">4.éœ€è®¿é—® <code>workbook</code> å¯¹è±¡ï¼Ÿ</h4>
<p>è‹¥å‡½æ•°éœ€è¯»å–é€‰åŒºã€æ ·å¼ç­‰ä¸Šä¸‹æ–‡ä¿¡æ¯ï¼ˆå¦‚å®ç° <code>=SELECTION()</code>ï¼‰ï¼Œéœ€è®¾ç½® <code>isContextSensitive: true</code>ã€‚</p>
<h4 data-id="heading-15">5.å‚æ•°åˆæ³•æ€§æ ¡éªŒç¼ºå¤±</h4>
<p>ç”¨æˆ·å¯èƒ½ä¼ å…¥å­—ç¬¦ä¸²ã€ç©ºå€¼ã€é”™è¯¯èŒƒå›´ã€‚åŠ¡å¿…åœ¨ <code>evaluate</code> ä¸­åšç±»å‹åˆ¤æ–­ä¸å®¹é”™å¤„ç†ã€‚</p>
<h4 data-id="heading-16">6.å¿½ç•¥å•å…ƒæ ¼æ•°æ®ç±»å‹</h4>
<p>çœ‹ä¼¼æ•°å­—çš„å•å…ƒæ ¼å¯èƒ½æ˜¯æ–‡æœ¬æ ¼å¼ï¼ˆå¦‚ä» CSV å¯¼å…¥ï¼‰ã€‚å»ºè®®ä½¿ç”¨ <code>parseFloat</code> æˆ–ç±»å‹è½¬æ¢ç¡®ä¿è®¡ç®—æ­£ç¡®ã€‚</p>
<h4 data-id="heading-17">7.ä¸å†…ç½®å‡½æ•°é‡å</h4>
<p>é¿å…å‘½åå¦‚ <code>SUM</code>ã€<code>AVERAGE</code> ç­‰ï¼Œå¦åˆ™ä¼šè¦†ç›–åŸç”Ÿå‡½æ•°ã€‚</p>
<h4 data-id="heading-18">8.å¤§æ•°æ®é‡æ€§èƒ½é—®é¢˜</h4>
<p>éå†å¤§èŒƒå›´å•å…ƒæ ¼æ—¶ï¼Œä½¿ç”¨ <code>getArray()</code> æ›¿ä»£å¤šæ¬¡ <code>getValue()</code>ï¼Œå¹¶é…åˆ <code>suspendPaint()</code> æå‡æ€§èƒ½ã€‚</p>
<h4 data-id="heading-19">9.æ•°ç»„å…¬å¼æœªå¼€å¯åŠ¨æ€æ•°ç»„</h4>
<p>ä½¿ç”¨æ•°ç»„å…¬å¼ï¼ˆå¦‚è¿”å›å¤šå•å…ƒæ ¼ç»“æœï¼‰æ—¶ï¼Œéœ€è®¾ç½® <code>workbook.options.allowDynamicArray = true</code>ã€‚</p>
<h3 data-id="heading-20">å¼€å‘å»ºè®®</h3>
<ul>
<li><strong>å…ˆæ˜“åéš¾</strong>ï¼šä»é˜¶ä¹˜ã€æ±‚å’Œç­‰ç®€å•å‡½æ•°å…¥æ‰‹ï¼Œå†æŒ‘æˆ˜å¼‚æ­¥æˆ–æ•°ç»„åœºæ™¯ï¼›</li>
<li><strong>å¤šæ‰“æ—¥å¿—</strong>ï¼šåœ¨ <code>evaluate</code> ä¸­ <code>console.log</code> å‚æ•°ä¸ä¸­é—´ç»“æœï¼Œå¿«é€Ÿå®šä½é—®é¢˜ï¼›</li>
<li><strong>å‹¤æŸ¥æ–‡æ¡£</strong>ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fdemo.grapecity.com.cn%2Fspreadjs%2Fhelp%2Fapi%2Fmodules%2FGC" target="_blank" title="https://demo.grapecity.com.cn/spreadjs/help/api/modules/GC" ref="nofollow noopener noreferrer">SpreadJS å®˜æ–¹ API æ–‡æ¡£æ˜¯æœ€ä½³å‚è€ƒ</a>ã€‚</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item>  </channel></rss>