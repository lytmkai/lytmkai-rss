<?xml version="1.0" encoding="UTF-8"?><rss version="2.0">  <channel>      <title>掘金文章推荐</title>      <link>https://juejin.cn/recommended?sort=newest</link>      <description>一个帮助开发者成长的社区</description>      <generator>python juejin_recom.py @Pi20</generator>      <item>    <title><![CDATA[深入理解 Gunicorn]]></title>    <link>https://juejin.cn/post/7582136489770958858</link>    <guid>https://juejin.cn/post/7582136489770958858</guid>    <pubDate>2025-12-11T06:06:17.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7582136489770958858" data-draft-id="7582156410319601674" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="深入理解 Gunicorn "/> <meta itemprop="keywords" content="Python,uWSGI"/> <meta itemprop="datePublished" content="2025-12-11T06:06:17.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Xier"/> <meta itemprop="url" content="https://juejin.cn/user/1152710585356295"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            深入理解 Gunicorn 
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1152710585356295/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Xier
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-11T06:06:17.000Z" title="Thu Dec 11 2025 06:06:17 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-11
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    12
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><strong>Gunicorn</strong> (Green Unicorn) 是一个为 UNIX 设计的 Python <strong>WSGI HTTP Server</strong>。它采用 <strong>Pre-fork Worker</strong> 模型，以其性能稳定、配置简单和资源占用低而闻名，是目前部署 Python Web 应用（如 Django、Flask、FastAPI）的工业级标准选择。</p>
<h2 data-id="heading-0">1. 为什么需要 Gunicorn？</h2>
<p>在开发 Django 或 Flask 应用时，我们通常使用自带的 <code>runserver</code>。但这些内置服务器主要用于开发调试，<strong>不能用于生产环境</strong>，原因如下：</p>
<ul>
<li><strong>单进程/单线程</strong>：通常一次只能处理一个请求。</li>
<li><strong>稳定性差</strong>：缺乏进程管理和自愈能力。</li>
<li><strong>安全性低</strong>：没有针对并发攻击和异常连接的优化。</li>
</ul>
<p><strong>Gunicorn 的作用</strong>就是在你的 Web 应用（App）和外界（通常是 Nginx）之间搭建一座桥梁，并发地处理大量 HTTP 请求。</p>
<h2 data-id="heading-1">2. 核心架构：Pre-fork 模型</h2>
<p>Gunicorn 的运行机制可以概括为：<strong>一个主进程（Master）管理一组工作进程（Worker）</strong> 。</p>
<ul>
<li><strong>Master 进程</strong>：不处理具体的客户端请求。它负责接收操作系统的信号（如重启、停止），并监控 Worker 进程的状态。如果某个 Worker 挂了，Master 会自动拉起一个新的。</li>
<li><strong>Worker 进程</strong>：由 Master 进程 fork 出来，是真正处理请求的地方。</li>
<li><strong>优点</strong>：进程之间相互隔离，一个请求导致进程崩溃不会影响其他请求，增强了系统的健壮性。</li>
</ul>
<h2 data-id="heading-2">3. 工作模式（Worker Types）</h2>
<p>选择正确的 Worker 类型对于性能至关重要：</p>






























<table><thead><tr><th><strong>Worker 类型</strong></th><th><strong>描述</strong></th><th><strong>适用场景</strong></th></tr></thead><tbody><tr><td><strong>Sync (默认)</strong></td><td>每个进程一次处理一个请求。</td><td>CPU 密集型任务，或者请求处理非常快的情况。</td></tr><tr><td><strong>Gevent / Eventlet</strong></td><td>基于协程的异步模式。</td><td>IO 密集型（如频繁读写数据库、调用外部 API）。</td></tr><tr><td><strong>Thread</strong></td><td>在每个 Worker 进程中使用线程池。</td><td>介于 Sync 和协程之间，适合受限于 IO 但又不想用协程的情况。</td></tr><tr><td><strong>Uvicorn</strong></td><td>用于支持 ASGI (如 FastAPI)。</td><td>现代异步 Python 应用。</td></tr></tbody></table>
<h3 data-id="heading-3">应该配置多少个 Worker？</h3>
<p>官方推荐的公式是：</p>
<p><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>W</mi><mi>o</mi><mi>r</mi><mi>k</mi><mi>e</mi><mi>r</mi><mi>s</mi><mo>=</mo><mo stretchy="false">(</mo><mn>2</mn><mo>×</mo><mtext>CPU 核心数</mtext><mo stretchy="false">)</mo><mo>+</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">Workers = (2 \times \text{CPU 核心数}) + 1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"/><span class="mord mathnormal" style="margin-right:0.13889em;">W</span><span class="mord mathnormal" style="margin-right:0.02778em;">or</span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="mord mathnormal">ers</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mopen">(</span><span class="mord">2</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord text"><span class="mord">CPU </span><span class="mord cjk_fallback">核心数</span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:0.6444em;"/><span class="mord">1</span></span></span></span></span></p>
<h2 data-id="heading-4">4. 基础使用指南</h2>
<h3 data-id="heading-5">安装</h3>
<pre><code class="hljs">pip install gunicorn
</code></pre>
<h3 data-id="heading-6">启动应用</h3>
<p>假设你的文件名是 <code>main.py</code>，Flask 实例名为 <code>app</code>：</p>
<pre><code class="hljs language-less" lang="less"># 格式：<span class="hljs-selector-tag">gunicorn</span> <span class="hljs-selector-attr">[模块名]</span>:<span class="hljs-selector-attr">[变量名]</span>
<span class="hljs-selector-tag">gunicorn</span> <span class="hljs-selector-tag">-w</span> <span class="hljs-number">4</span> <span class="hljs-selector-tag">-b</span> <span class="hljs-number">0.0</span><span class="hljs-selector-class">.0</span><span class="hljs-selector-class">.0</span>:<span class="hljs-number">8000</span> <span class="hljs-selector-tag">main</span>:<span class="hljs-selector-tag">app</span>
</code></pre>
<ul>
<li><code>-w 4</code>：启动 4 个工作进程。</li>
<li><code>-b 0.0.0.0:8000</code>：绑定 IP 和端口。</li>
</ul>
<h3 data-id="heading-7">常用配置参数</h3>
<ul>
<li><code>--timeout</code>：请求超时时间（默认 30s）。</li>
<li><code>--access-logfile</code>：访问日志路径。</li>
<li><code>--worker-class</code>：指定 worker 类型（如 <code>gevent</code>）。</li>
<li><code>--daemon</code>：后台运行。</li>
</ul>
<h2 data-id="heading-8">5. 生产环境最佳实践：Nginx + Gunicorn</h2>
<p>在生产环境中，<strong>永远不要</strong>让 Gunicorn 直接暴露在公网上。通常会在前面加一个 <strong>Nginx</strong> 作为反向代理。</p>
<p><strong>为什么要配合 Nginx？</strong></p>
<ol>
<li><strong>处理静态资源</strong>：Nginx 处理图片、CSS、JS 的效率远高于 Python。</li>
<li><strong>负载均衡</strong>：Nginx 可以分发流量到多台 Gunicorn 服务器。</li>
<li><strong>安全缓冲</strong>：Nginx 可以过滤恶意请求，并缓存慢速连接，保护 Gunicorn 不被耗尽。</li>
<li><strong>SSL 终止</strong>：在 Nginx 层处理 HTTPS 加密。</li>
</ol>
<hr/>
<h2 data-id="heading-9">6 配置参数</h2>
<h3 data-id="heading-10"><code>daemon</code> (守护进程模式)</h3>
<p><strong>作用：</strong> 让 Gunicorn 在后台运行，脱离当前的终端控制台。</p>
<ul>
<li>
<p><strong>不仅仅是“守护”：</strong> 当你设置为 <code>True</code> 时，Gunicorn 会执行两次 <code>fork()</code>，将进程与启动它的终端（Tty）完全脱离。这意味着即使你关闭了 SSH 窗口或断开了连接，Gunicorn 进程依然会在后台运行。</p>
</li>
<li>
<p><strong>PID 文件：</strong> 在使用 <code>daemon</code> 模式时，通常建议配合 <code>pidfile</code> 参数使用，这样你才能知道后台进程的 ID，方便后续进行重启或停止操作。</p>
</li>
<li>
<p><strong>生产环境建议：</strong> 虽然 Gunicorn 自带 <code>daemon</code> 功能，但在现代运维实践中（如使用 <strong>Docker</strong> 或 <strong>Systemd</strong>），我们通常将此参数保持为 <code>False</code>。</p>
<ul>
<li><strong>Docker：</strong> 必须前台运行（False），否则容器启动后会立即退出。</li>
<li><strong>Systemd：</strong> 推荐前台运行，由 Systemd 统一管理日志和进程生命周期。</li>
</ul>
</li>
</ul>
<h3 data-id="heading-11"><code>preload_app</code> (预加载应用)</h3>
<p>这是一个非常核心的性能优化参数。</p>
<p><strong>作用：</strong> 在 Master 进程 fork 出 Worker 进程<strong>之前</strong>，先加载应用程序的代码。</p>
<h3 data-id="heading-12">优点：</h3>
<ol>
<li><strong>节省内存 (Copy-on-Write)：</strong> 现代操作系统使用“写时复制”机制。如果在 Master 进程中预先加载了应用，所有 Worker 进程将共享同一块物理内存。只有当 Worker 尝试修改这些内存时，才会复制。对于大型应用（如 Django），这能显著降低内存占用。</li>
<li><strong>启动速度快：</strong> Worker 进程由 Master 直接 fork 出来，不需要重新解析 Python 代码和导入库。</li>
</ol>
<h3 data-id="heading-13">缺点与风险：</h3>
<ul>
<li><strong>共享资源冲突：</strong> 如果你的应用在初始化时（即在全局作用域内）打开了数据库连接、缓存连接或文件描述符，开启 <code>preload</code> 可能会导致多个 Worker 共享同一个连接，从而引发报错或数据错乱。</li>
<li><strong>代码热更新：</strong> 开启后，如果你重启 Worker（HUP 信号），代码不会重载，必须重启整个 Master 进程才能看到代码变更。</li>
</ul>
<hr/>
<h3 data-id="heading-14">3. 其他核心参数详解</h3>
<p>除了上述两个，以下参数在调优时最为常用：</p>
<h3 data-id="heading-15"><code>worker_class</code> (工作模式)</h3>
<p>决定了 Gunicorn 如何处理请求。</p>
<ul>
<li><code>sync</code> (默认): 传统的同步模式。适合 CPU 密集型。</li>
<li><code>gevent</code> / <code>eventlet</code>: 协程异步模式。适合 <strong>IO 密集型</strong>（如大量 API 调用、长连接）。</li>
<li><code>gthread</code>: 混合模式。每个 Worker 开启多个线程处理请求。</li>
</ul>
<h3 data-id="heading-16"><code>max_requests</code> &amp; <code>max_requests_jitter</code></h3>
<p><strong>作用：防止内存泄漏。</strong></p>
<ul>
<li><code>max_requests</code>: 一个 Worker 在处理多少个请求后会自动重启。</li>
<li><code>max_requests_jitter</code>: 在最大请求数上增加一个随机抖动值（例如 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>50</mn><mo>±</mo><mtext>random</mtext></mrow><annotation encoding="application/x-tex">50 \pm \text{random}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7278em;vertical-align:-0.0833em;"/><span class="mord">50</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">±</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:0.6944em;"/><span class="mord text"><span class="mord">random</span></span></span></span></span></span>）。</li>
<li><strong>原理：</strong> Python 应用（尤其是使用了第三方库时）有时会有微小的内存泄漏。通过定期重启 Worker，可以释放这些被占用的内存。</li>
</ul>
<h3 data-id="heading-17"><code>timeout</code> (超时时间)</h3>
<ul>
<li><strong>作用：</strong> 如果 Worker 处理单个请求的时间超过此值，Master 会杀掉该 Worker 并重新拉起一个新的。</li>
<li><strong>注意：</strong> 默认是 <strong>30 秒</strong>。如果你有耗时很长的文件上传或复杂计算，需要调大此值，否则用户会看到 502 错误。</li>
</ul>
<h3 data-id="heading-18"><code>keepalive</code> (长连接保持)</h3>
<ul>
<li><strong>作用：</strong> 在同一个 TCP 连接上等待下一个请求的秒数。</li>
<li><strong>建议：</strong> 当 Gunicorn 后面跟着 Nginx 时，通常设置为 <strong>2-5 秒</strong>。</li>
</ul>
<h2 data-id="heading-19">7. 总结</h2>
<p>Gunicorn 是 Python Web 部署的“压舱石”。它简单、可靠，专注于做好一件事：<strong>管理进程并稳定地运行 WSGI 应用</strong>。</p>
<blockquote>
<p><strong>核心原则</strong>：</p>
<ul>
<li>IO 密集型用 <code>gevent</code> 或 <code>threads</code>。</li>
<li>CPU 密集型用默认 <code>sync</code>。</li>
<li>前面必须挡一个 Nginx。</li>
</ul>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[基于arthas的一次提升定时任务TPS总结]]></title>    <link>https://juejin.cn/post/7582156219059929151</link>    <guid>https://juejin.cn/post/7582156219059929151</guid>    <pubDate>2025-12-11T05:43:06.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7582156219059929151" data-draft-id="7582207260198715446" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="基于arthas的一次提升定时任务TPS总结"/> <meta itemprop="keywords" content="后端,性能优化"/> <meta itemprop="datePublished" content="2025-12-11T05:43:06.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="大肚子飞行员"/> <meta itemprop="url" content="https://juejin.cn/user/852876755994445"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            基于arthas的一次提升定时任务TPS总结
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/852876755994445/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    大肚子飞行员
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-11T05:43:06.000Z" title="Thu Dec 11 2025 05:43:06 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-11
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">1.  <strong>问题描述</strong></h2>
<p>后台服务班次转换通过定时任务，每五分钟执行一次，每日1000班次，要跑将近4，5小时，平均下来1分钟仅能跑几个班次。单个班次执行约20-30s。班次转换速率严重滞后，月底重跑多天报表，可能严重拖慢报表生成进度。</p>
<h2 data-id="heading-1">2.  <strong>问题定位及分析</strong></h2>
<h3 data-id="heading-2">2.1.  <strong>服务器负载分析</strong></h3>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0ad969375d9a402f9bf93ec6245757a8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn6IKa5a2Q6aOe6KGM5ZGY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766036775&amp;x-signature=s9iHJFUzBMAb5WGgaPSRPXq1Wns%3D" alt="image" loading="lazy"/>
定时任务跑批次期间，通过top命令查看服务负载情况，CPU负载仅23.3%，内存负载13.2GB约56%，并不存在瓶颈情况。</p>
<h3 data-id="heading-3">2.2.  <strong>JVM负载分析</strong></h3>
<p>使用Arthas工具（dashboard），查看cms服务班次跑批期间的jvm负载情况，具体情况如下：
（备注：原默认垃圾回收器ps_survivor占用98%，切换g1gc，由jvm自行分配eden和s区的大小，以及对象晋升的次数）
Heap情况: </p>
<ul>
<li><strong>总堆内存</strong>: 12GB (12288M)</li>
<li><strong>已使用</strong>: 3.8GB (3949M) - <strong>32.14%</strong> 使用率</li>
<li><strong>年轻代</strong>: 3.6GB (3668M) - 占堆的 <strong>47.74%</strong></li>
<li><strong>老年代</strong>: 221M - 仅占堆的 <strong>1.80%</strong></li>
</ul>
<p>Gc情况：</p>
<ul>
<li>  年轻代GC次数: 65次，时间1700ms</li>
<li> 老年带GC次数0</li>
</ul>
<p>根据Arthas工具dashboard实时打印的结果，JVM的总体负载不高，不存在瓶颈情况。</p>
<h3 data-id="heading-4">2.3.  <strong>关键代码执行时间分析</strong></h3>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cdabe3d544b7449a8d4031cd1e53baf0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn6IKa5a2Q6aOe6KGM5ZGY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766036775&amp;x-signature=a4Uy7%2BLiy%2BQoKhNK0wGJa%2Byvs1A%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e6bb57e433284c93b4280ea4383676e7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn6IKa5a2Q6aOe6KGM5ZGY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766036775&amp;x-signature=DPUOrQbOz6qHkGZ4HU5kzJ%2BMmbE%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/790ceec7f7f2487fa48227f2cceb5061~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn6IKa5a2Q6aOe6KGM5ZGY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766036775&amp;x-signature=1IGVF5NfumpjhpfCxm%2FV43ZNTIU%3D" alt="image.png" loading="lazy"/></p>
<p>使用Arthas工具对定时任务代码分析：</p>
<ul>
<li>
<p>trace com.hkl.pos.service.impl.AtsConvertServiceImpl convertSuccessionByLock </p>
<p>以下捞出关键的几种类型：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/43ae4dd9391f4dbd9bb44c5514207e74~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn6IKa5a2Q6aOe6KGM5ZGY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766036775&amp;x-signature=UzkK8bnQXO7iW%2Fc4Rv6oCeNVA0s%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c435002508cf4f42b2421b0de5fb3735~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn6IKa5a2Q6aOe6KGM5ZGY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766036775&amp;x-signature=p10YxPkbXKoGzeDCVvxDUlHVFIw%3D" alt="image.png" loading="lazy"/></p>
<p>以上截图trace结果可以得出结论：</p>
<ol>
<li>大量耗时存在于班次的转换的方法内；</li>
<li>约一半的方法执行失败，获取jdbc连接超时；</li>
<li>trace因为性能关系只统计一个层架，需要往下再定位详细方法的执行耗时；</li>
</ol>
</li>
<li>
<p>trace -E com.hkl.pos.service.impl.AtsConvertServiceImpl convertSuccessionByLock|convertSuccession|convertOrder -n 1000</p>
</li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d31266c3418845ce888d63c5a3ad74ae~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn6IKa5a2Q6aOe6KGM5ZGY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766036775&amp;x-signature=GO2eNB2frw%2FeMKBK9nlhkpHBD5k%3D" alt="image.png" loading="lazy"/></p>
<p>以上trace结果可以得出结论：主要执行耗时代码在ats_bb表执行插入数据耗时过长；</p>
<h3 data-id="heading-5">2.4.  <strong>数据库入库慢定位</strong></h3>
<pre><code class="hljs language-markdown" lang="markdown">定位bb表插入慢的主要原因：
<span class="hljs-bullet">1.</span>  数据量过大或者索引过多，锁或者外键，触发器导致插入慢；
<span class="hljs-bullet">2.</span>  插入数据需要写数据文件、redo日志文件、undo表空间配置问题导致插入慢；
</code></pre>
<h2 data-id="heading-6">3.  <strong>优化方案与结果</strong></h2>
<h3 data-id="heading-7">3.1.  <strong>单个任务优化</strong></h3>
<h4 data-id="heading-8">3.1.1.  历史数据归档</h4>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6c1a7844d2a642649f1617208099ba50~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn6IKa5a2Q6aOe6KGM5ZGY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766036775&amp;x-signature=%2FWy7722wd6n%2BHlcC6xBPjcNj0%2FY%3D" alt="63b2a20e170194f2a128454e02fb246f.png" loading="lazy"/></p>
<p>bb表历史数据先归档处理，大大提升入库时间。</p>
<h4 data-id="heading-9">3.1.2.   JDBC连接池优化</h4>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/96aa02cffa464a05b19c0d61351cc225~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn6IKa5a2Q6aOe6KGM5ZGY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766036775&amp;x-signature=lUuau2ruVGcF2S0VMhRyYE23m9o%3D" alt="image.png" loading="lazy"/></p>
<h4 data-id="heading-10">3.1.3.   长事务周期优化</h4>
<p>将大事务拆分成小事务，查询和转换方法执行后，再进行数据库事务操作，防止大事务长时间持有占用JDBC连接。具体操作如下：
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/43f3cf4746874e1fa1873ee5d77ee2b6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn6IKa5a2Q6aOe6KGM5ZGY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766036775&amp;x-signature=hh43jBq1LRScej8ZHenl6yCs8eI%3D" alt="image.png" loading="lazy"/></p>
<h4 data-id="heading-11">3.1.4.  优化效果</h4>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3581d0caea9f45d782d2c65516747a33~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn6IKa5a2Q6aOe6KGM5ZGY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766036775&amp;x-signature=2VQNzHBOS1d4E2ZrtEXxt%2Fk0zcE%3D" alt="image.png" loading="lazy"/></p>
<p>耗时统计
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9617d6e5941e41768e81a63e949e49bf~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn6IKa5a2Q6aOe6KGM5ZGY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766036775&amp;x-signature=OBeOABKgjwhGYSCLhSK7998stYs%3D" alt="image.png" loading="lazy"/>
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/64f46bbbb9064a3988ac1d5a0bcc1639~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn6IKa5a2Q6aOe6KGM5ZGY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766036775&amp;x-signature=XlAQMGGGgXsyya6eacVq%2BoMMhpc%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-12">3.2.  <strong>引入分布式中间件（后续安排）</strong></h3>
<p>后续走直接生成，暂不需要进一步优化......</p>
<h2 data-id="heading-13">1.  <strong>总结</strong></h2>
<ol>
<li>增加数据库连接数的最大连接池个数，是最直接的问题的方式。解决大量jdbc连接获取失败问题；</li>
<li>历史数据归档，大大降低数据库入库和删除时间；</li>
<li>限制每个定时任务跑固定个数（当前每5分钟定时任务500条班次任务-&gt;约每天的班次要10分钟）</li>
<li>拆分大事务，防止长时间占用jdbc连接；</li>
<li>排查定位：使用阿里开源工具Arthas，可以快速定位问题和瓶颈，且上手快。</li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[从零实现一个低代码 H5 页面编辑器（Vue3 + 拖拽）]]></title>    <link>https://juejin.cn/post/7582118218649337882</link>    <guid>https://juejin.cn/post/7582118218649337882</guid>    <pubDate>2025-12-11T05:59:21.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7582118218649337882" data-draft-id="7582104240988405786" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="从零实现一个低代码 H5 页面编辑器（Vue3 + 拖拽）"/> <meta itemprop="keywords" content="前端,Vue.js"/> <meta itemprop="datePublished" content="2025-12-11T05:59:21.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="live丶"/> <meta itemprop="url" content="https://juejin.cn/user/3131009846745245"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            从零实现一个低代码 H5 页面编辑器（Vue3 + 拖拽）
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3131009846745245/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    live丶
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-11T05:59:21.000Z" title="Thu Dec 11 2025 05:59:21 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-11
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    3
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">从零实现一个低代码 H5 页面编辑器（Vue3 + 拖拽）</h2>
<blockquote>
<p>本文带你手把手实现一个类似有赞、微盟的 H5 营销页面编辑器，支持拖拽搭建、实时预览、属性配置。</p>
</blockquote>
<h3 data-id="heading-1">前言</h3>
<p>低代码平台这几年很火，但很多人觉得很复杂不敢下手。其实核心原理并不难，今天我们就用 <strong>Vue3 + vuedraggable</strong> 实现一个麻雀虽小五脏俱全的 H5 页面编辑器。</p>
<p><strong>最终效果：</strong></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0bf9d468101748058e390b42f4f67401~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgbGl2ZeS4tg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766037771&amp;x-signature=S2q0JyzVGNo5FtL6KcE1Cv%2Fyc4I%3D" alt="微信图片_20251211134433_21_84.png" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a0786cc8785f433fb046d39e85459bbd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgbGl2ZeS4tg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766037771&amp;x-signature=wt70AQtaznVZrnk8IUIoHOL%2FOuw%3D" alt="微信图片_20251211134305_19_84.png" loading="lazy"/></p>
<p><strong>技术栈：</strong></p>
<ul>
<li>Vue 3 + Composition API</li>
<li>Pinia 状态管理</li>
<li>Element Plus</li>
<li>vuedraggable 拖拽</li>
<li>Tailwind CSS</li>
</ul>
<h3 data-id="heading-2">一、整体架构设计</h3>
<p>低代码编辑器的核心是 <strong>三栏布局 + 统一数据源</strong>：</p>
<pre><code class="hljs language-scss" lang="scss">┌──────────────────────────────────────────────────────┐
│                      App<span class="hljs-selector-class">.vue</span>                          │
│  ┌──────────┐  ┌────────────────┐  ┌──────────────┐  │
│  │LeftPanel │  │  CenterCanvas  │  │  RightPanel  │  │
│  │  组件库   │ → │    画布预览    │ ← │   属性配置   │  │
│  └──────────┘  └────────────────┘  └──────────────┘  │
│                        ↑↓                             │
│                   Pinia Store                         │
│                  (全局状态管理)                        │
└──────────────────────────────────────────────────────┘
</code></pre>
<p><strong>数据流向：</strong></p>
<ol>
<li>左侧组件库 → 拖拽克隆 → 画布</li>
<li>点击画布组件 → 选中 → 右侧显示配置</li>
<li>修改配置 → 更新 Store → 画布实时刷新</li>
</ol>
<h3 data-id="heading-3">二、定义组件配置</h3>
<p>首先定义组件库，每个组件包含类型、名称、图标和默认属性：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// src/config/components.js</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> componentLibrary = {
  <span class="hljs-attr">basic</span>: {
    <span class="hljs-attr">name</span>: <span class="hljs-string">'基础组件'</span>,
    <span class="hljs-attr">icon</span>: <span class="hljs-string">'Grid'</span>,
    <span class="hljs-attr">components</span>: [
      {
        <span class="hljs-attr">type</span>: <span class="hljs-string">'text'</span>,
        <span class="hljs-attr">name</span>: <span class="hljs-string">'文本'</span>,
        <span class="hljs-attr">icon</span>: <span class="hljs-string">'Document'</span>,
        <span class="hljs-attr">props</span>: {
          <span class="hljs-attr">content</span>: <span class="hljs-string">'请输入文本内容'</span>,
          <span class="hljs-attr">fontSize</span>: <span class="hljs-number">14</span>,
          <span class="hljs-attr">color</span>: <span class="hljs-string">'#333333'</span>,
          <span class="hljs-attr">textAlign</span>: <span class="hljs-string">'left'</span>,
          <span class="hljs-attr">fontWeight</span>: <span class="hljs-string">'normal'</span>,
          <span class="hljs-attr">padding</span>: <span class="hljs-number">10</span>
        }
      },
      {
        <span class="hljs-attr">type</span>: <span class="hljs-string">'image'</span>,
        <span class="hljs-attr">name</span>: <span class="hljs-string">'图片'</span>,
        <span class="hljs-attr">icon</span>: <span class="hljs-string">'Picture'</span>,
        <span class="hljs-attr">props</span>: {
          <span class="hljs-attr">src</span>: <span class="hljs-string">'https://via.placeholder.com/350x150'</span>,
          <span class="hljs-attr">width</span>: <span class="hljs-string">'100%'</span>,
          <span class="hljs-attr">borderRadius</span>: <span class="hljs-number">0</span>
        }
      },
      <span class="hljs-comment">// ... 更多组件</span>
    ]
  },
  <span class="hljs-attr">marketing</span>: {
    <span class="hljs-attr">name</span>: <span class="hljs-string">'营销组件'</span>,
    <span class="hljs-attr">components</span>: [
      {
        <span class="hljs-attr">type</span>: <span class="hljs-string">'banner'</span>,
        <span class="hljs-attr">name</span>: <span class="hljs-string">'轮播图'</span>,
        <span class="hljs-attr">props</span>: {
          <span class="hljs-attr">images</span>: [<span class="hljs-string">'banner1.jpg'</span>, <span class="hljs-string">'banner2.jpg'</span>],
          <span class="hljs-attr">height</span>: <span class="hljs-number">200</span>,
          <span class="hljs-attr">autoplay</span>: <span class="hljs-literal">true</span>
        }
      },
      {
        <span class="hljs-attr">type</span>: <span class="hljs-string">'coupon'</span>,
        <span class="hljs-attr">name</span>: <span class="hljs-string">'优惠券'</span>,
        <span class="hljs-attr">props</span>: {
          <span class="hljs-attr">title</span>: <span class="hljs-string">'满减优惠券'</span>,
          <span class="hljs-attr">value</span>: <span class="hljs-number">50</span>,
          <span class="hljs-attr">condition</span>: <span class="hljs-string">'满200可用'</span>
        }
      }
    ]
  }
}
</code></pre>
<p><strong>设计要点：</strong></p>
<ul>
<li><code>type</code> 用于匹配渲染组件</li>
<li><code>props</code> 是默认属性，拖入画布后可独立修改</li>
<li>分类管理，便于扩展</li>
</ul>
<h3 data-id="heading-4">三、Pinia 状态管理</h3>
<p>这是整个编辑器的核心，管理画布状态：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// src/stores/editor.js</span>
<span class="hljs-keyword">import</span> { defineStore } <span class="hljs-keyword">from</span> <span class="hljs-string">'pinia'</span>

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> useEditorStore = <span class="hljs-title function_">defineStore</span>(<span class="hljs-string">'editor'</span>, {
  <span class="hljs-attr">state</span>: <span class="hljs-function">() =&gt;</span> ({
    <span class="hljs-attr">components</span>: [],      <span class="hljs-comment">// 画布中的组件列表</span>
    <span class="hljs-attr">selectedIndex</span>: -<span class="hljs-number">1</span>,   <span class="hljs-comment">// 当前选中的组件索引</span>
    <span class="hljs-attr">idCounter</span>: <span class="hljs-number">0</span>         <span class="hljs-comment">// 组件ID计数器</span>
  }),

  <span class="hljs-attr">getters</span>: {
    <span class="hljs-comment">// 获取当前选中的组件</span>
    <span class="hljs-attr">selectedComponent</span>: <span class="hljs-function">(<span class="hljs-params">state</span>) =&gt;</span> {
      <span class="hljs-keyword">if</span> (state.<span class="hljs-property">selectedIndex</span> &gt;= <span class="hljs-number">0</span>) {
        <span class="hljs-keyword">return</span> state.<span class="hljs-property">components</span>[state.<span class="hljs-property">selectedIndex</span>]
      }
      <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>
    }
  },

  <span class="hljs-attr">actions</span>: {
    <span class="hljs-comment">// 添加组件（拖入时调用）</span>
    <span class="hljs-title function_">addComponent</span>(<span class="hljs-params">component</span>) {
      <span class="hljs-keyword">const</span> newComponent = {
        ...<span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(<span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(component)), <span class="hljs-comment">// 深拷贝</span>
        <span class="hljs-attr">id</span>: ++<span class="hljs-variable language_">this</span>.<span class="hljs-property">idCounter</span>
      }
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">components</span>.<span class="hljs-title function_">push</span>(newComponent)
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">selectedIndex</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">components</span>.<span class="hljs-property">length</span> - <span class="hljs-number">1</span>
    },

    <span class="hljs-comment">// 选中组件</span>
    <span class="hljs-title function_">selectComponent</span>(<span class="hljs-params">index</span>) {
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">selectedIndex</span> = index
    },

    <span class="hljs-comment">// 删除组件</span>
    <span class="hljs-title function_">deleteComponent</span>(<span class="hljs-params">index</span>) {
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">components</span>.<span class="hljs-title function_">splice</span>(index, <span class="hljs-number">1</span>)
      <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">selectedIndex</span> &gt;= <span class="hljs-variable language_">this</span>.<span class="hljs-property">components</span>.<span class="hljs-property">length</span>) {
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">selectedIndex</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">components</span>.<span class="hljs-property">length</span> - <span class="hljs-number">1</span>
      }
    },

    <span class="hljs-comment">// 上移/下移</span>
    <span class="hljs-title function_">moveUp</span>(<span class="hljs-params">index</span>) {
      <span class="hljs-keyword">if</span> (index &gt; <span class="hljs-number">0</span>) {
        [<span class="hljs-variable language_">this</span>.<span class="hljs-property">components</span>[index], <span class="hljs-variable language_">this</span>.<span class="hljs-property">components</span>[index - <span class="hljs-number">1</span>]] = 
        [<span class="hljs-variable language_">this</span>.<span class="hljs-property">components</span>[index - <span class="hljs-number">1</span>], <span class="hljs-variable language_">this</span>.<span class="hljs-property">components</span>[index]]
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">selectedIndex</span> = index - <span class="hljs-number">1</span>
      }
    },

    <span class="hljs-comment">// 更新组件属性</span>
    <span class="hljs-title function_">updateComponentProps</span>(<span class="hljs-params">index, props</span>) {
      <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">components</span>[index]) {
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">components</span>[index].<span class="hljs-property">props</span> = { 
          ...<span class="hljs-variable language_">this</span>.<span class="hljs-property">components</span>[index].<span class="hljs-property">props</span>, 
          ...props 
        }
      }
    },

    <span class="hljs-comment">// 导出数据</span>
    <span class="hljs-title function_">getSaveData</span>(<span class="hljs-params"/>) {
      <span class="hljs-keyword">return</span> <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">components</span>)
    }
  }
})
</code></pre>
<h3 data-id="heading-5">四、左侧组件库（拖拽源）</h3>
<p>使用 <code>vuedraggable</code> 实现拖拽，关键是 <code>group</code> 配置：</p>
<pre><code class="hljs language-vue" lang="vue">&lt;!-- src/components/LeftPanel.vue --&gt;
&lt;template&gt;
  &lt;div class="left-panel"&gt;
    &lt;div class="p-3 border-b font-bold"&gt;组件库&lt;/div&gt;
    
    &lt;el-collapse v-model="activeNames"&gt;
      &lt;el-collapse-item 
        v-for="(category, key) in componentLibrary" 
        :key="key"
        :name="key"
      &gt;
        &lt;template #title&gt;
          &lt;el-icon class="mr-2"&gt;&lt;component :is="category.icon" /&gt;&lt;/el-icon&gt;
          {{ category.name }}
        &lt;/template&gt;
        
        &lt;!-- 🔥 核心：draggable 配置 --&gt;
        &lt;draggable
          :list="category.components"
          :group="{ name: 'components', pull: 'clone', put: false }"
          :clone="cloneComponent"
          :sort="false"
          item-key="type"
        &gt;
          &lt;template #item="{ element }"&gt;
            &lt;div class="component-item"&gt;
              &lt;el-icon&gt;&lt;component :is="element.icon" /&gt;&lt;/el-icon&gt;
              &lt;span&gt;{{ element.name }}&lt;/span&gt;
            &lt;/div&gt;
          &lt;/template&gt;
        &lt;/draggable&gt;
      &lt;/el-collapse-item&gt;
    &lt;/el-collapse&gt;
  &lt;/div&gt;
&lt;/template&gt;

&lt;script setup&gt;
import draggable from 'vuedraggable'
import { componentLibrary } from '@/config/components'

// 深拷贝，确保每个实例独立
const cloneComponent = (item) =&gt; {
  return JSON.parse(JSON.stringify(item))
}
&lt;/script&gt;
</code></pre>
<p><strong>🔥 group 配置详解：</strong></p>

























<table><thead><tr><th>属性</th><th>值</th><th>含义</th></tr></thead><tbody><tr><td><code>name</code></td><td><code>'components'</code></td><td>分组名，同名才能互相拖拽</td></tr><tr><td><code>pull</code></td><td><code>'clone'</code></td><td>拖出时克隆，原列表不变</td></tr><tr><td><code>put</code></td><td><code>false</code></td><td>禁止放入，只能拖出</td></tr></tbody></table>
<p>这样设计的好处：</p>
<ul>
<li>组件库是"模板"，拖多少次都不会消失</li>
<li>防止用户把画布组件拖回组件库</li>
</ul>
<h3 data-id="heading-6">五、中间画布（拖拽目标）</h3>
<pre><code class="hljs language-vue" lang="vue">&lt;!-- src/components/CenterCanvas.vue --&gt;
&lt;template&gt;
  &lt;div class="center-canvas"&gt;
    &lt;!-- 工具栏 --&gt;
    &lt;div class="toolbar"&gt;
      &lt;el-button type="primary" @click="handleSave"&gt;保存&lt;/el-button&gt;
      &lt;el-button @click="store.reset()"&gt;重置&lt;/el-button&gt;
    &lt;/div&gt;
    
    &lt;!-- 手机预览框 --&gt;
    &lt;div class="phone-frame"&gt;
      &lt;draggable
        v-model="store.components"
        group="components"
        item-key="id"
        ghost-class="ghost"
        @add="onAdd"
      &gt;
        &lt;template #item="{ element, index }"&gt;
          &lt;div 
            class="component-wrapper"
            :class="{ selected: store.selectedIndex === index }"
            @click="store.selectComponent(index)"
          &gt;
            &lt;!-- 动态渲染组件 --&gt;
            &lt;component 
              :is="previewComponents[element.type]" 
              :props="element.props"
            /&gt;
          &lt;/div&gt;
        &lt;/template&gt;
      &lt;/draggable&gt;
      
      &lt;!-- 空状态 --&gt;
      &lt;div v-if="store.components.length === 0" class="empty-tip"&gt;
        拖拽组件到此处
      &lt;/div&gt;
    &lt;/div&gt;
    
    &lt;!-- 操作按钮 --&gt;
    &lt;div v-if="store.selectedComponent" class="action-btns"&gt;
      &lt;el-button @click="store.moveUp(store.selectedIndex)"&gt;上移&lt;/el-button&gt;
      &lt;el-button @click="store.moveDown(store.selectedIndex)"&gt;下移&lt;/el-button&gt;
      &lt;el-button type="danger" @click="store.deleteComponent(store.selectedIndex)"&gt;
        删除
      &lt;/el-button&gt;
    &lt;/div&gt;
  &lt;/div&gt;
&lt;/template&gt;

&lt;script setup&gt;
import draggable from 'vuedraggable'
import { useEditorStore } from '@/stores/editor'
import { previewComponents } from './preview'

const store = useEditorStore()

const onAdd = (evt) =&gt; {
  store.selectComponent(evt.newIndex)
}
&lt;/script&gt;
</code></pre>
<p><strong>动态组件渲染：</strong></p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// src/components/preview/index.js</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">TextPreview</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'./TextPreview.vue'</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">ImagePreview</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'./ImagePreview.vue'</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">BannerPreview</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'./BannerPreview.vue'</span>
<span class="hljs-comment">// ...</span>

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> previewComponents = {
  <span class="hljs-string">'text'</span>: <span class="hljs-title class_">TextPreview</span>,
  <span class="hljs-string">'image'</span>: <span class="hljs-title class_">ImagePreview</span>,
  <span class="hljs-string">'banner'</span>: <span class="hljs-title class_">BannerPreview</span>,
  <span class="hljs-comment">// ...</span>
}
</code></pre>
<p>通过 <code>element.type</code> 匹配对应的预览组件，实现动态渲染。</p>
<h3 data-id="heading-7">六、右侧属性配置</h3>
<pre><code class="hljs language-vue" lang="vue">&lt;!-- src/components/RightPanel.vue --&gt;
&lt;template&gt;
  &lt;div class="right-panel"&gt;
    &lt;div class="p-3 border-b font-bold"&gt;属性配置&lt;/div&gt;
    
    &lt;div v-if="!store.selectedComponent" class="empty"&gt;
      请选择组件
    &lt;/div&gt;

    &lt;div v-else class="p-4"&gt;
      &lt;!-- 文本组件配置 --&gt;
      &lt;template v-if="store.selectedComponent.type === 'text'"&gt;
        &lt;el-form label-position="top"&gt;
          &lt;el-form-item label="文本内容"&gt;
            &lt;el-input 
              v-model="props.content" 
              type="textarea" 
              @input="updateProps" 
            /&gt;
          &lt;/el-form-item&gt;
          &lt;el-form-item label="字体大小"&gt;
            &lt;el-slider 
              v-model="props.fontSize" 
              :min="12" :max="36" 
              @change="updateProps" 
            /&gt;
          &lt;/el-form-item&gt;
          &lt;el-form-item label="文字颜色"&gt;
            &lt;el-color-picker 
              v-model="props.color" 
              @change="updateProps" 
            /&gt;
          &lt;/el-form-item&gt;
        &lt;/el-form&gt;
      &lt;/template&gt;
      
      &lt;!-- 其他组件配置... --&gt;
    &lt;/div&gt;
  &lt;/div&gt;
&lt;/template&gt;

&lt;script setup&gt;
import { reactive, watch } from 'vue'
import { useEditorStore } from '@/stores/editor'

const store = useEditorStore()
const props = reactive({})

// 监听选中组件变化，同步属性到本地
watch(() =&gt; store.selectedComponent, (comp) =&gt; {
  if (comp) {
    Object.assign(props, JSON.parse(JSON.stringify(comp.props)))
  }
}, { immediate: true, deep: true })

// 更新属性到 Store
const updateProps = () =&gt; {
  if (store.selectedIndex &gt;= 0) {
    store.updateComponentProps(store.selectedIndex, { ...props })
  }
}
&lt;/script&gt;
</code></pre>
<p><strong>为什么需要本地 <code>props</code> + <code>updateProps</code>？</strong></p>
<pre><code class="hljs language-scss" lang="scss">Store<span class="hljs-selector-class">.selectedComponent</span><span class="hljs-selector-class">.props</span>  →  深拷贝  →  本地 props (v-model 绑定)
                                              ↓
                                         用户修改
                                              ↓
                                         <span class="hljs-built_in">updateProps</span>()
                                              ↓
Store<span class="hljs-selector-class">.updateComponentProps</span>()  ←  同步回 Store  ←  画布更新
</code></pre>
<p>如果直接 <code>v-model</code> 绑定 Store 数据，虽然也能工作，但不够规范。使用本地副本可以：</p>
<ul>
<li>更好地控制更新时机</li>
<li>方便做表单校验</li>
<li>支持"取消修改"功能</li>
</ul>
<h3 data-id="heading-8">七、预览组件示例</h3>
<pre><code class="hljs language-vue" lang="vue">&lt;!-- src/components/preview/TextPreview.vue --&gt;
&lt;template&gt;
  &lt;div 
    :style="{
      fontSize: props.fontSize + 'px',
      color: props.color,
      textAlign: props.textAlign,
      fontWeight: props.fontWeight,
      padding: props.padding + 'px'
    }"
  &gt;
    {{ props.content }}
  &lt;/div&gt;
&lt;/template&gt;

&lt;script setup&gt;
defineProps({
  props: { type: Object, required: true }
})
&lt;/script&gt;
</code></pre>
<p>每个预览组件接收 <code>props</code> 对象，根据属性渲染样式。</p>
<h3 data-id="heading-9">八、总结</h3>
<p>核心要点：</p>
<ol>
<li><strong>vuedraggable 的 group 配置</strong> - <code>pull: 'clone'</code> 实现克隆拖拽</li>
<li><strong>Pinia 统一状态管理</strong> - 三个面板共享数据源</li>
<li><strong>动态组件</strong> - <code>&lt;component :is=""&gt;</code> 根据类型渲染</li>
<li><strong>深拷贝</strong> - 确保每个组件实例独立</li>
</ol>
<p>扩展方向：</p>
<ul>
<li>撤销/重做（操作历史栈）</li>
<li>组件嵌套（容器组件）</li>
<li>模板保存/加载</li>
<li>真实预览（生成 H5 页面）</li>
<li>更多组件类型</li>
</ul>
<h3 data-id="heading-10">最后源码地址</h3>
<p>gitee: <a href="https://link.juejin.cn?target=https%3A%2F%2Fgitee.com%2Flive1906%2Flow-codeh5" target="_blank" title="https://gitee.com/live1906/low-codeh5" ref="nofollow noopener noreferrer">gitee.com/live1906/lo…</a></p>
<p>如果对你有帮助，欢迎 Star ⭐ 支持一下！</p>
<hr/>
<p>我是文强，专注前端开发，欢迎关注交流 👋</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[无硬件模拟灵衢架构：基于openFuyao社区的UB组件一站式开发实践]]></title>    <link>https://juejin.cn/post/7582163781183848454</link>    <guid>https://juejin.cn/post/7582163781183848454</guid>    <pubDate>2025-12-11T06:07:32.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7582163781183848454" data-draft-id="7582156219060027455" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="无硬件模拟灵衢架构：基于openFuyao社区的UB组件一站式开发实践"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2025-12-11T06:07:32.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="是Dream呀"/> <meta itemprop="url" content="https://juejin.cn/user/765678294413181"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            无硬件模拟灵衢架构：基于openFuyao社区的UB组件一站式开发实践
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/765678294413181/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    是Dream呀
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-11T06:07:32.000Z" title="Thu Dec 11 2025 06:07:32 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-11
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读10分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#383838;font-size:15px;line-height:30px;letter-spacing:2px;word-break:break-word;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Open Sans,Helvetica Neue,sans-serif;scroll-behavior:smooth;background-image:linear-gradient(0deg,transparent 24%,rgba(201,195,195,.329) 25%,hsla(0,8%,80.4%,.05) 26%,transparent 27%,transparent 74%,hsla(0,5.2%,81%,.185) 75%,rgba(180,176,176,.05) 76%,transparent 77%,transparent),linear-gradient(90deg,transparent 24%,rgba(204,196,196,.226) 25%,hsla(0,4%,66.1%,.05) 26%,transparent 27%,transparent 74%,hsla(0,5.2%,81%,.185) 75%,rgba(180,176,176,.05) 76%,transparent 77%,transparent);background-color:#fff;background-size:50px 50px;padding-bottom:60px}.markdown-body ::selection{color:#fff;background-color:#a862ea}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{margin:24px 0 12px;color:#a862ea}.markdown-body h1{line-height:2;font-size:1.4em}.markdown-body h1~p:first-of-type:first-letter{color:#a862ea;float:left;font-size:2em;margin-right:.4em;font-weight:bolder}.markdown-body h2{font-size:1.2em}.markdown-body h3{font-size:1.1em}.markdown-body ol,.markdown-body ul{padding-left:2em}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;padding-left:.2em}.markdown-body ol li::marker,.markdown-body ul li::marker{color:#a862ea}.markdown-body ol li.task-list-item,.markdown-body ul li.task-list-item{list-style:none}.markdown-body ol li.task-list-item ol,.markdown-body ol li.task-list-item ul,.markdown-body ul li.task-list-item ol,.markdown-body ul li.task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:10px}.markdown-body a,.markdown-body code,.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6,.markdown-body li,.markdown-body p{opacity:.85;vertical-align:baseline;transition:all .1s ease}.markdown-body a:hover,.markdown-body code:hover,.markdown-body h1:hover,.markdown-body h2:hover,.markdown-body h3:hover,.markdown-body h4:hover,.markdown-body h5:hover,.markdown-body h6:hover,.markdown-body li:hover,.markdown-body p:hover{opacity:1}.markdown-body a{display:inline-block;color:#a862ea;cursor:pointer;text-decoration:none;position:relative}.markdown-body a:after{content:"";position:absolute;width:98%;height:1px;bottom:0;left:0;transform:scaleX(0);background-color:#a862ea;transform-origin:bottom right;transition:transform .3s ease-in-out}.markdown-body a:hover:after{transform:scaleX(1);transform-origin:bottom left}.markdown-body a:active,.markdown-body a:link{color:#a862ea}.markdown-body img{max-width:100%;user-select:none;margin:1em 0;transition:transform .2s ease 0s;background-color:#f8f5ff;box-shadow:0 0 10px #e7daff}.markdown-body img:hover{opacity:1;box-shadow:0 0 20px #e7daff;transform:translateY(-1px)}.markdown-body blockquote{padding:.5em 1em;margin:12px 0;border-top-left-radius:2px;border-bottom-left-radius:2px;border-left:3px solid #a862ea;background-color:#f8f5ff}.markdown-body blockquote&gt;p{margin:0}.markdown-body .math{font-style:italic;margin:12px 0;padding:.5em 1em;background-color:#f8f5ff}.markdown-body .math&gt;p{margin:0}.markdown-body code{padding:2px .4em;overflow-x:auto;color:#a862ea;font-weight:700;word-break:break-word;font-family:Operator Mono,Consolas,Monaco,Menlo,monospace;background-color:#f8f5ff}.markdown-body pre{margin:2em 0}.markdown-body pre&gt;code{display:block;padding:1.5em;word-break:normal;font-size:.9em;font-style:normal;font-weight:400;font-family:Operator Mono,Consolas,Monaco,Menlo,monospace;line-height:18px;color:#383838;border-radius:2px;scroll-behavior:smooth;box-shadow:0 0 10px #e7daff}.markdown-body pre&gt;code:hover{box-shadow:0 0 20px #e7daff}.markdown-body pre&gt;code::-webkit-scrollbar{height:6px;background-color:#f8f5ff}.markdown-body pre&gt;code::-webkit-scrollbar-thumb{background-color:#e7daff;border-bottom-left-radius:3px;border-bottom-right-radius:3px}.markdown-body hr{margin:2em 0;border-top:1px solid #a862ea}.markdown-body table{width:100%;font-size:12px;max-width:100%;overflow:auto;border-collapse:collapse}.markdown-body thead{color:#a862ea;background:#f8f5ff}.markdown-body td,.markdown-body th{padding:.5em;border:1px solid #e7daff}.markdown-body tr{background-color:#f8f5ff}@media (max-width:720px){.markdown-body{font-size:12px}}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">一、引言</h2>
<p>在AI与云原生技术深度融合的时代，底层算力基础设施正经历着一场深刻的变革。**灵衢”（Unified Bus）**互联协议与硬件架构，以其“协议归一、硬件资源池化”的核心理念，旨在构建可扩展的超大规模异构算力集群。为了将这一先进的硬件能力无缝交付给广大开发者与应用，<strong>openFuyao</strong>开源社区应运而生，它扮演着关键的“软件使能层”角色，致力于让基于灵衢协议的硬件能够极简、高效地接入和管理到云原生（Kubernetes）环境中。</p>
<p>然而，对于广大开发者和研究者而言，直接获取并搭建真实的灵衢硬件环境成本高昂、门槛极高。这正是 openFuyao开源社区的关键价值所在——它作为连接先进硬件与云原生应用之间的 “软件使能层”，致力于将如灵衢这般的前沿硬件能力，通过标准、易用的Kubernetes接口开放给上层应用。社区提供的无硬件模拟开发方案，让开发者能够在个人电脑上，即可体验并参与面向下一代算力架构的软件创新。</p>
<p>本文将以一个具体的实践案例，引导您基于openFuyao社区的工具链，在虚拟Kubernetes集群中，完成一个用于管理“灵衢统一总线（Unified Bus, UB）”资源的控制器的开发、编译、部署与验证全流程。通过这篇指南，您不仅能够掌握在无硬件条件下进行异构算力使能开发的方法，更能深入理解“硬件资源池化”的软件抽象逻辑，为未来参与智能算力基础设施生态建设奠定基础。</p>
<h2 data-id="heading-1">二、灵衢超节点架构概述</h2>
<p><strong>灵衢（Unified Bus，简称UB）</strong>是华为推出的数据中心级硬件互联协议与架构，其核心目标是通过“协议归一、硬件资源池化”的理念，构建可扩展的超大规模异构算力集群。</p>
<h3 data-id="heading-2">2.1 灵衢超节点的核心特征</h3>
<ul>
<li><strong>统一总线（UB）</strong>：打破传统服务器内外的计算、存储、网络边界，通过统一交换协议实现CPU、GPU、NPU、内存、存储等资源的池化。</li>
<li><strong>超节点（Super Node）</strong>：多个物理节点通过灵衢总线互联，形成一个逻辑上的“超节点”，对外提供统一的资源视图。</li>
<li><strong>资源池化与弹性调度</strong>：支持跨节点的算力、内存、存储资源动态分配与迁移，实现“算力如电”的按需使用体验。</li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/30141665c5b541f4b1ad219362e69c0c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pivRHJlYW3lkYA=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766038052&amp;x-signature=5ZbK9zc%2BZUXINtVj5dKjv%2B8P%2BM4%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-3">2.2 灵衢在云原生环境中的价值</h3>
<ul>
<li><strong>异构算力统一接入</strong>：通过UB协议，各类AI芯片、FPGA、智能网卡等可被Kubernetes统一纳管。</li>
<li><strong>低延迟高带宽互联</strong>：支持容器间、节点间的高性能通信，适合AI训练、推理等密集型场景。</li>
<li><strong>热迁移与高可用</strong>：基于UB的资源池化能力，可实现容器、虚拟机甚至AI任务的无感迁移与故障恢复。</li>
</ul>
<p>根据<strong>官方文档（</strong><a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.openfuyao.cn%2Fdocs%2F%25E5%25BF%25AB%25E9%2580%259F%25E5%2585%25A5%25E9%2597%25A8%2F" target="_blank" title="https://docs.openfuyao.cn/docs/%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8/" ref="nofollow noopener noreferrer"><strong>https://docs.openfuyao.cn/docs/%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8/</strong></a><strong>）</strong>，它能实现节点特征发现和资源池管理。面对昂贵的超节点硬件，openFuyao社区致力于打造<strong>普惠的开发者生态</strong>。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/747d6e4abb904a109d2c1e38ef2d9d65~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pivRHJlYW3lkYA=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766038052&amp;x-signature=RvC7wl%2F2hGK5Gq5JTLv%2Fbzfyja8%3D" alt="" loading="lazy"/></p>
<hr/>
<h2 data-id="heading-4">三、openFuyao社区：灵衢超节点的软件使能者</h2>
<p>openFuyao是一个基于Kubernetes生态构建的开源社区，致力于为灵衢等新型硬件提供标准、易用的云原生接入与管理能力。其在灵衢超节点支持方面主要包括以下四个维度：</p>
<h3 data-id="heading-5">3.1 K8s灵衢化使能</h3>
<p>通过设备插件、CNI/CSI插件等方式，将灵衢硬件能力暴露给Kubernetes。</p>

























<table><thead><tr><th><strong>组件</strong></th><th><strong>功能描述</strong></th><th><strong>适用场景</strong></th></tr></thead><tbody><tr><td>UB CNI 插件</td><td>为Pod提供基于UB的高性能网络互通能力</td><td>AI训练、高性能计算</td></tr><tr><td>UB CSI 插件</td><td>实现跨节点的存储卷动态挂载与迁移</td><td>有状态应用、数据密集型任务</td></tr><tr><td>UB Device Plugin</td><td>将灵衢设备（如NPU、智能网卡）作为K8s资源管理</td><td>异构算力调度</td></tr></tbody></table>
<h3 data-id="heading-6">3.2 灵衢化编排能力</h3>
<p>提供面向灵衢资源的增强调度与管控能力。</p>

























<table><thead><tr><th><strong>组件</strong></th><th><strong>功能描述</strong></th></tr></thead><tbody><tr><td>UB Node Controller</td><td>管理灵衢节点资源状态，支持动态加入/退出</td></tr><tr><td>UB 增强调度器</td><td>支持基于UB拓扑感知的容器调度</td></tr><tr><td>UB 热迁移引擎</td><td>实现容器、AI任务的无中断迁移</td></tr><tr><td>RemoteFork</td><td>快速批量克隆容器，应对突发负载</td></tr></tbody></table>
<h3 data-id="heading-7">3.3 灵衢化K8s中间件</h3>
<p>基于UB特性构建的高性能云原生中间件。</p>

























<table><thead><tr><th><strong>中间件</strong></th><th><strong>说明</strong></th></tr></thead><tbody><tr><td>Service Mesh（如Istio+UB）</td><td>提供低延迟、高吞吐的服务网格通信</td></tr><tr><td>分布式消息（如Kafka over UB）</td><td>实现跨节点的高效消息传递</td></tr><tr><td>分布式缓存（如Redis Cluster over UB）</td><td>提供一致性与性能兼顾的缓存服务</td></tr><tr><td>分布式文件系统（如Ceph over UB）</td><td>支持跨节点存储池的统一访问</td></tr></tbody></table>
<h3 data-id="heading-8">3.4 一站式开发者生态</h3>
<p>为开发者提供不依赖真实硬件的全流程开发支持。</p>

























<table><thead><tr><th><strong>工具/环境</strong></th><th><strong>功能</strong></th></tr></thead><tbody><tr><td>Minikube + openFuyao 模拟环境</td><td>在本地PC上模拟灵衢超节点集群</td></tr><tr><td>UB Controller 代码框架</td><td>提供Controller开发模板与CRD定义</td></tr><tr><td>仿真测试工具链</td><td>支持UB资源调度、热迁移等场景仿真</td></tr><tr><td>性能分析工具（Prometheus + Grafana）</td><td>提供资源使用、延迟、带宽等监控能力</td></tr></tbody></table>
<p>因此，我们提供了一套不依赖物理灵衢硬件的“全流程仿真工具链”，让开发者在普通PC上即可完成以下闭环。下图便是<strong>openFuyao全栈架构图</strong>， 清晰地展示了 openFuyao 社区如何围绕灵衢硬件构建起一套完整的软件生态。这种“软件定义硬件”的模式，让每一位开发者都能提前通过虚拟环境参与到下一代算力架构的创新中来。</p>
<ul>
<li><strong>Layer 0 (Hardware):</strong> 最底层是灵衢超节点，提供基于 UB 总线的统一资源池。</li>
<li><strong>Layer 1 (Enablement):</strong> 通过 UB CNI（网络）和 UB CSI（存储）插件，让 K8s 能够直接纳管底层硬件资源。</li>
<li><strong>Layer 2 (Orchestration):</strong> 核心的编排层，包含 UB Node Controller、增强调度器以及支持热迁移/RemoteFork 的高级特性。</li>
<li><strong>Layer 3 (Middleware):</strong> 针对 UB 优化的中间件，如 Service Mesh、分布式缓存和消息队列，充分利用总线的高带宽低延时。</li>
<li><strong>Layer 4 (Applications):</strong> 顶层支撑各类 AI 和大数据应用。</li>
<li><strong>Side Bar (Dev Ecosystem):</strong> 右侧展示了贯穿全流程的开发者工具链，包括开发、编译、仿真、测试和 SDK，印证了“一站式无硬件开发”。
<ul>
<li><strong>开发（Develop）：</strong> 基于标准K8s接口的SDK，编写适配UB总线的应用逻辑。</li>
<li><strong>编译（Build）：</strong> 包含UB设备模拟桩的交叉编译工具链。</li>
<li><strong>仿真（Simulate）：</strong> 高保真的UB硬件模拟器，能够在软件层面精确复现总线竞争、拓扑结构和资源池化行为。</li>
<li><strong>测试（Test）：</strong> 集成自动化测试框架，验证应用在超节点环境下的鲁棒性。</li>
</ul>
</li>
</ul>
<blockquote>
<p>官网如下：<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.openfuyao.cn%2Fzh%2F" target="_blank" title="https://www.openfuyao.cn/zh/" ref="nofollow noopener noreferrer"><strong>https://www.openfuyao.cn/zh/</strong></a><strong>。</strong></p>
</blockquote>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/350f15596ca74c328663310f2ae56501~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pivRHJlYW3lkYA=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766038052&amp;x-signature=ZT0KETaclUbayjj5xNnV7fgq4BI%3D" alt="" loading="lazy"/></p>
<hr/>
<h2 data-id="heading-9">四、实战案例：<strong>无硬件模拟灵衢UB控制器开发</strong></h2>
<h3 data-id="heading-10">4.1  环境搭建与部署</h3>
<p>要实现无硬件下的灵衢开发，首先搭建模拟环境。openFuyao基于Kubernetes，因此我们使用Minikube模拟单节点集群。以下步骤基于官方快速入门文档调整。</p>
<p><strong>前提条件：</strong></p>
<ul>
<li>系统：Ubuntu 22.04 / macOS / Windows WSL2 / openEuler 22.03（虚拟机）</li>
<li>工具：Docker、kubectl、Minikube</li>
<li>资源：至少4GB内存、2核CPU（本地PC即可）</li>
</ul>
<h4 data-id="heading-11">4.1.1 安装Minikube模拟集群</h4>
<p>下载Minikube（<a href="https://link.juejin.cn?target=https%3A%2F%2Fminikube.sigs.k8s.io%2Fdocs%2Fstart%2F" target="_blank" title="https://minikube.sigs.k8s.io/docs/start/" ref="nofollow noopener noreferrer">minikube.sigs.k8s.io/docs/start/</a>）：</p>
<pre><code class="hljs language-bash" lang="bash">curl -LO https://storage.googleapis.com/minikube/releases/latest/minikube-linux-amd64
sudo install minikube-linux-amd64 /usr/local/bin/minikube
minikube start --driver=docker
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/90a7cc03495c4679812cbaba2b358e60~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pivRHJlYW3lkYA=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766038052&amp;x-signature=k0hRERcxyfc4uzieIYtTdyo1hDg%3D" alt="" loading="lazy"/></p>
<h4 data-id="heading-12">4.1.2 集成openFuyao组件</h4>
<p>由于openFuyao是Kubernetes增强版，我们模拟安装其发行版。参考文档：</p>
<pre><code class="hljs language-plain" lang="plain">curl -sfL https://openfuyao.obs.cn-north-4.myhuaweicloud.com/openFuyao/bkeadm/releases/download/v25.09/download.sh | bash
bke init --otherRepo cr.openfuyao.cn/openfuyao/bke-online-installed:v25.09
kubectl get pods -A  # 检查Pod状态
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d1408565f9334de2b2eb2f51f0148ac7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pivRHJlYW3lkYA=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766038052&amp;x-signature=gR4VGgF%2FVvBwhpyFh0j8DIzZkfU%3D" alt="" loading="lazy"/></p>
<p>如果初始化失败，检查网络连通性。模拟环境预计15分钟完成。</p>
<h4 data-id="heading-13">4.1.3 创建灵衢CRD</h4>
<p>为模拟UB，添加自定义CRD（Custom Resource Definition）：</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-comment"># crd.yaml</span>
<span class="hljs-attr">apiVersion:</span> <span class="hljs-string">apiextensions.k8s.io/v1</span>
<span class="hljs-attr">kind:</span> <span class="hljs-string">CustomResourceDefinition</span>
<span class="hljs-attr">metadata:</span>
<span class="hljs-comment"># （完整YAML见后文代码块）</span>
<span class="hljs-string">kubectl</span> <span class="hljs-string">apply</span> <span class="hljs-string">-f</span> <span class="hljs-string">crd.yaml</span>
<span class="hljs-string">kubectl</span> <span class="hljs-string">describe</span> <span class="hljs-string">crd</span> <span class="hljs-string">ubbridges.lingqu.openfuyao.cn</span>
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fd1e2ad2178a4276a144f86e255a54a7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pivRHJlYW3lkYA=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766038052&amp;x-signature=Ib3rKHF050rIgnbNBV8RPr0xR0U%3D" alt="" loading="lazy"/></p>
<hr/>
<h3 data-id="heading-14"><strong>4.2 项目结构与代码实现</strong></h3>
<p>在本实践中，我们将开发一个用于管理“灵衢统一总线（Unified Bus, UB）”资源的Kubernetes自定义控制器（Controller）。此处的“UB”并非泛指，它特指灵衢硬件协议中核心的“统一总线”这一实体概念。我们的控制器代码，是在软件层面<strong>抽象并模拟</strong>了对这条硬件总线上资源（如虚拟通道、连接状态）的调度与管理行为。</p>
<h4 data-id="heading-15">4.2.1 项目结构</h4>
<pre><code class="hljs language-bash" lang="bash">lingqu-ub-controller/
├── go.mod
├── main.go
├── api/v1/ubbridge_types.go
├── controllers/ubbridge_controller.go
├── crd.yaml
├── Dockerfile
└── deployment.yaml
</code></pre>
<h4 data-id="heading-16">4.2.2 完整代码</h4>
<p><strong>（1）go.mod</strong></p>
<pre><code class="hljs language-plain" lang="plain">module lingqu-ub

go 1.23

require (
k8s.io/apimachinery v0.30.0
k8s.io/client-go v0.30.0
sigs.k8s.io/controller-runtime v0.18.0
)
</code></pre>
<p><strong>（2）api/v1/ubbridge_types.go</strong></p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">package</span> v1

<span class="hljs-keyword">import</span> ( metav1 <span class="hljs-string">"k8s.io/apimachinery/pkg/apis/meta/v1"</span> )

<span class="hljs-keyword">type</span> UBBridgeSpec <span class="hljs-keyword">struct</span> {
    SourceNode    <span class="hljs-type">string</span> <span class="hljs-string">`json:"sourceNode,omitempty"`</span>
    TargetNode    <span class="hljs-type">string</span> <span class="hljs-string">`json:"targetNode,omitempty"`</span>
    MigrationType <span class="hljs-type">string</span> <span class="hljs-string">`json:"migrationType,omitempty"`</span>
}

<span class="hljs-keyword">type</span> UBBridgeStatus <span class="hljs-keyword">struct</span> { Phase <span class="hljs-type">string</span> <span class="hljs-string">`json:"phase,omitempty"`</span> }

<span class="hljs-keyword">type</span> UBBridge <span class="hljs-keyword">struct</span> {
    metav1.TypeMeta   <span class="hljs-string">`json:",inline"`</span>
    metav1.ObjectMeta <span class="hljs-string">`json:"metadata,omitempty"`</span>
    Spec   UBBridgeSpec   <span class="hljs-string">`json:"spec,omitempty"`</span>
    Status UBBridgeStatus <span class="hljs-string">`json:"status,omitempty"`</span>
}

<span class="hljs-comment">// +kubebuilder:object:root=true</span>
<span class="hljs-keyword">type</span> UBBridgeList <span class="hljs-keyword">struct</span> {
    metav1.TypeMeta <span class="hljs-string">`json:",inline"`</span>
    metav1.ListMeta <span class="hljs-string">`json:"metadata,omitempty"`</span>
    Items           []UBBridge <span class="hljs-string">`json:"items"`</span>
}
</code></pre>
<p><strong>（3）controllers/ubbridge_controller.go</strong></p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">package</span> controllers

<span class="hljs-keyword">import</span> (
    <span class="hljs-string">"context"</span>
    lingquv1 <span class="hljs-string">"lingqu-ub/api/v1"</span>
    ctrl <span class="hljs-string">"sigs.k8s.io/controller-runtime/pkg/log"</span>
)

<span class="hljs-keyword">type</span> UBBridgeReconciler <span class="hljs-keyword">struct</span> {
    client.Client
    Scheme *runtime.Scheme
}

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(r *UBBridgeReconciler)</span></span> Reconcile(ctx context.Context, req ctrl.Request) (ctrl.Result, <span class="hljs-type">error</span>) {
    <span class="hljs-keyword">var</span> ub lingquv1.UBBridge
    <span class="hljs-keyword">if</span> err := r.Get(ctx, req.NamespacedName, &amp;ub); err != <span class="hljs-literal">nil</span> {
        <span class="hljs-keyword">return</span> ctrl.Result{}, client.IgnoreNotFound(err)
    }
    ub.Status.Phase = <span class="hljs-string">"Migrated"</span>
    r.Status().Update(ctx, &amp;ub)
    <span class="hljs-keyword">return</span> ctrl.Result{}, <span class="hljs-literal">nil</span>
}

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(r *UBBridgeReconciler)</span></span> SetupWithManager(mgr ctrl.Manager) <span class="hljs-type">error</span> {
    <span class="hljs-keyword">return</span> ctrl.NewControllerManagedBy(mgr).For(&amp;lingquv1.UBBridge{}).Complete(r)
}
</code></pre>
<p><strong>（4）main.go</strong></p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">package</span> main

<span class="hljs-keyword">import</span> (
    <span class="hljs-string">"flag"</span>
    <span class="hljs-string">"os"</span>

    <span class="hljs-string">"k8s.io/apimachinery/pkg/runtime"</span>
    utilruntime <span class="hljs-string">"k8s.io/apimachinery/pkg/util/runtime"</span>
    clientgoscheme <span class="hljs-string">"k8s.io/client-go/kubernetes/scheme"</span>
    ctrl <span class="hljs-string">"sigs.k8s.io/controller-runtime"</span>
    <span class="hljs-string">"sigs.k8s.io/controller-runtime/pkg/healthz"</span>
    <span class="hljs-string">"sigs.k8s.io/controller-runtime/pkg/log/zap"</span>

    lingquv1 <span class="hljs-string">"lingqu-ub/api/v1"</span>
    <span class="hljs-string">"lingqu-ub/controllers"</span>
)

<span class="hljs-keyword">var</span> (
    scheme   = runtime.NewScheme()
    setupLog = ctrl.Log.WithName(<span class="hljs-string">"setup"</span>)
)

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">init</span><span class="hljs-params">()</span></span> {
    utilruntime.Must(clientgoscheme.AddToScheme(scheme))
    utilruntime.Must(lingquv1.AddToScheme(scheme))
}

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
    <span class="hljs-keyword">var</span> metricsAddr <span class="hljs-type">string</span>
    <span class="hljs-keyword">var</span> enableLeaderElection <span class="hljs-type">bool</span>
    <span class="hljs-keyword">var</span> probeAddr <span class="hljs-type">string</span>
    flag.StringVar(&amp;metricsAddr, <span class="hljs-string">"metrics-bind-address"</span>, <span class="hljs-string">":8080"</span>, <span class="hljs-string">"The address the metric endpoint binds to."</span>)
    flag.BoolVar(&amp;enableLeaderElection, <span class="hljs-string">"leader-elect"</span>, <span class="hljs-literal">false</span>, <span class="hljs-string">"Enable leader election for controller manager."</span>)
    flag.StringVar(&amp;probeAddr, <span class="hljs-string">"health-probe-bind-address"</span>, <span class="hljs-string">":8081"</span>, <span class="hljs-string">"The address the probe endpoint binds to."</span>)
    flag.Parse()

    ctrl.SetLogger(zap.New(zap.UseDevMode(<span class="hljs-literal">true</span>)))

    mgr, err := ctrl.NewManager(ctrl.GetConfigOrDie(), ctrl.Options{
        Scheme:                 scheme,
        MetricsBindAddress:     metricsAddr,
        Port:                   <span class="hljs-number">9443</span>,
        HealthProbeBindAddress: probeAddr,
        LeaderElection:         enableLeaderElection,
        LeaderElectionID:       <span class="hljs-string">"ub-controller.lingqu.openfuyao.cn"</span>,
    })
    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
        setupLog.Error(err, <span class="hljs-string">"unable to start manager"</span>)
        os.Exit(<span class="hljs-number">1</span>)
    }

    <span class="hljs-keyword">if</span> err = (&amp;controllers.UBBridgeReconciler{
        Client: mgr.GetClient(),
        Scheme: mgr.GetScheme(),
    }).SetupWithManager(mgr); err != <span class="hljs-literal">nil</span> {
        setupLog.Error(err, <span class="hljs-string">"unable to create controller"</span>, <span class="hljs-string">"controller"</span>, <span class="hljs-string">"UBBridge"</span>)
        os.Exit(<span class="hljs-number">1</span>)
    }

    <span class="hljs-keyword">if</span> err := mgr.AddHealthzCheck(<span class="hljs-string">"healthz"</span>, healthz.Ping); err != <span class="hljs-literal">nil</span> {
        setupLog.Error(err, <span class="hljs-string">"unable to set up health check"</span>)
        os.Exit(<span class="hljs-number">1</span>)
    }
    <span class="hljs-keyword">if</span> err := mgr.AddReadyzCheck(<span class="hljs-string">"readyz"</span>, healthz.Ping); err != <span class="hljs-literal">nil</span> {
        setupLog.Error(err, <span class="hljs-string">"unable to set up ready check"</span>)
        os.Exit(<span class="hljs-number">1</span>)
    }

    setupLog.Info(<span class="hljs-string">"starting manager"</span>)
    <span class="hljs-keyword">if</span> err := mgr.Start(ctrl.SetupSignalHandler()); err != <span class="hljs-literal">nil</span> {
        setupLog.Error(err, <span class="hljs-string">"problem running manager"</span>)
        os.Exit(<span class="hljs-number">1</span>)
    }
}
</code></pre>
<h4 data-id="heading-17">4.2.3 编译与镜像构建</h4>
<pre><code class="hljs language-bash" lang="bash">go mod tidy
go build -o ub-controller
docker build -t ub-controller:latest .
minikube image load ub-controller:latest
</code></pre>
<h4 data-id="heading-18">4.2.4 部署到Minikube</h4>
<p><strong>（1）deployment.yaml</strong></p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-comment"># deployment.yaml</span>
<span class="hljs-attr">apiVersion:</span> <span class="hljs-string">apps/v1</span>
<span class="hljs-attr">kind:</span> <span class="hljs-string">Deployment</span>
<span class="hljs-attr">metadata: name:</span> <span class="hljs-string">ub-controller</span>
<span class="hljs-attr">spec:</span>
  <span class="hljs-attr">replicas:</span> <span class="hljs-number">1</span>
  <span class="hljs-attr">selector:</span>
    <span class="hljs-attr">matchLabels:</span> { <span class="hljs-attr">app:</span> <span class="hljs-string">ub-controller</span> }
  <span class="hljs-attr">template:</span>
    <span class="hljs-attr">metadata:</span> { <span class="hljs-attr">labels:</span> { <span class="hljs-attr">app:</span> <span class="hljs-string">ub-controller</span> } }
    <span class="hljs-attr">spec:</span>
      <span class="hljs-attr">containers:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">manager</span>
        <span class="hljs-attr">image:</span> <span class="hljs-string">ub-controller:latest</span>
        <span class="hljs-attr">imagePullPolicy:</span> <span class="hljs-string">Never</span>
</code></pre>
<p><strong>（2）分析命令</strong></p>
<pre><code class="hljs language-bash" lang="bash">kubectl apply -f deployment.yaml
kubectl logs -f deployment/ub-controller
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1deaae0ca10d4bdd99b4fe868f2e0f2d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pivRHJlYW3lkYA=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766038052&amp;x-signature=N9C8vGl%2BaYq9C0gKQTvQCBvWcJ8%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-19">4.3 <strong>编译、部署与验证</strong></h3>
<p>定性分析评估UB性能，如迁移效率和资源利用。无硬件下，使用kubectl top和Prometheus模拟。</p>
<p><strong>（1）安装Prometheus</strong></p>
<pre><code class="hljs language-bash" lang="bash">kubectl apply -f https://raw.githubusercontent.com/prometheus-operator/prometheus-operator/main/bundle.yaml
</code></pre>
<p><strong>（2）分析命令</strong></p>
<pre><code class="hljs language-bash" lang="bash">kubectl top pods  <span class="hljs-comment"># 查看资源使用</span>
kubectl logs -f ub-controller-pod  <span class="hljs-comment"># 检查日志</span>
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b275df3618cb4faa96217ad4558636fe~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pivRHJlYW3lkYA=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766038052&amp;x-signature=fd088fztbBvyoNSic%2FcjS0UI1t8%3D" alt="" loading="lazy"/></p>
<pre><code class="hljs language-bash" lang="bash">NAME            CPU(cores)   MEMORY(bytes)  
ub-controller   150m         256Mi          
ub-pod-1        200m         512Mi          
ub-pod-2        80m          128Mi
</code></pre>
<h3 data-id="heading-20">4.4 <strong>样例演示与问题排查</strong></h3>
<p><strong>（1）ub-demo.yaml（简单UB热迁移）</strong></p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-comment"># ub-demo.yaml</span>
<span class="hljs-attr">apiVersion:</span> <span class="hljs-string">lingqu.openfuyao.cn/v1</span>
<span class="hljs-attr">kind:</span> <span class="hljs-string">UnifiedBus</span>  <span class="hljs-comment"># 或 BusLink, BusChannel，使其更贴近“总线”概念</span>
<span class="hljs-attr">metadata:</span>
  <span class="hljs-attr">name:</span> <span class="hljs-string">test-bus-link</span>
<span class="hljs-attr">spec:</span>
  <span class="hljs-attr">sourceEndpoint:</span> <span class="hljs-string">node-a</span>
  <span class="hljs-attr">targetEndpoint:</span> <span class="hljs-string">node-b</span>
  <span class="hljs-attr">bandwidthRequest:</span> <span class="hljs-string">"10G"</span>
<span class="hljs-comment"># status: # 可以增加状态字段，如 established, migrating, error</span>
</code></pre>
<p><strong>（2）分析命令</strong></p>
<pre><code class="hljs language-bash" lang="bash">kubectl apply -f ub-demo.yaml
kubectl get ubbridges -w  <span class="hljs-comment"># 查看状态</span>
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c8e724db53f34359bf488feca35320cf~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pivRHJlYW3lkYA=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766038052&amp;x-signature=HLxrBgCPyhtq3Vb58P5z9i938J0%3D" alt="" loading="lazy"/></p>
<p><strong>常见问题</strong>：</p>
<ul>
<li>Pod Pending → 检查节点资源 kubectl describe node</li>
<li>镜像拉取失败 → 记得minikube image load</li>
<li>网络问题 → 验证Minikube IP</li>
</ul>
<hr/>
<h2 data-id="heading-21">五、总结与展望</h2>
<p>通过本文的实践，我们展示了如何在无真实硬件的情况下，基于openFuyao社区工具链完成灵衢UB控制器的全流程开发与验证。openFuyao不仅提供了灵衢硬件的软件使能能力，更构建了一个涵盖开发、仿真、测试、部署的一站式开发者生态。未来，我们可以通过以下方式不断推动社区和生态的发展。</p>
<ul>
<li><strong>更多灵衢硬件模拟场景</strong>：支持GPU/NPU池化、内存热插拔等高级特性仿真。</li>
<li><strong>生态工具链持续丰富</strong>：提供更易用的CLI、Web控制台、插件市场等。</li>
<li><strong>社区协作与标准推进</strong>：推动灵衢协议与Kubernetes生态的深度融合与标准化。</li>
</ul>
<p>我们鼓励更多开发者加入openFuyao社区，共同推动智能算力基础设施的软件创新与生态繁荣。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[已有Flutter项目适配鸿蒙6]]></title>    <link>https://juejin.cn/post/7582149417768812594</link>    <guid>https://juejin.cn/post/7582149417768812594</guid>    <pubDate>2025-12-11T06:06:41.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7582149417768812594" data-draft-id="7579906040537219118" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="已有Flutter项目适配鸿蒙6"/> <meta itemprop="keywords" content="Flutter"/> <meta itemprop="datePublished" content="2025-12-11T06:06:41.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="new小码"/> <meta itemprop="url" content="https://juejin.cn/user/1558425622815504"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            已有Flutter项目适配鸿蒙6
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1558425622815504/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    new小码
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-11T06:06:41.000Z" title="Thu Dec 11 2025 06:06:41 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-11
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body .octicon{display:inline-block;fill:currentColor;vertical-align:text-bottom}.markdown-body .anchor{float:left;line-height:1;margin-left:-20px;padding-right:4px}.markdown-body .anchor:focus{outline:none}.markdown-body h1 .octicon-link,.markdown-body h2 .octicon-link,.markdown-body h3 .octicon-link,.markdown-body h4 .octicon-link,.markdown-body h5 .octicon-link,.markdown-body h6 .octicon-link{color:#1b1f23;vertical-align:middle;visibility:hidden}.markdown-body h1:hover .anchor,.markdown-body h2:hover .anchor,.markdown-body h3:hover .anchor,.markdown-body h4:hover .anchor,.markdown-body h5:hover .anchor,.markdown-body h6:hover .anchor{text-decoration:none}.markdown-body h1:hover .anchor .octicon-link,.markdown-body h2:hover .anchor .octicon-link,.markdown-body h3:hover .anchor .octicon-link,.markdown-body h4:hover .anchor .octicon-link,.markdown-body h5:hover .anchor .octicon-link,.markdown-body h6:hover .anchor .octicon-link{visibility:visible}.markdown-body h1:hover .anchor .octicon-link:before,.markdown-body h2:hover .anchor .octicon-link:before,.markdown-body h3:hover .anchor .octicon-link:before,.markdown-body h4:hover .anchor .octicon-link:before,.markdown-body h5:hover .anchor .octicon-link:before,.markdown-body h6:hover .anchor .octicon-link:before{width:16px;height:16px;content:" ";display:inline-block;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' aria-hidden='true'%3E%3Cpath fill-rule='evenodd' d='M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z'/%3E%3C/svg%3E")}.markdown-body{-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%;color:#24292e;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Helvetica,Arial,sans-serif,Apple Color Emoji,Segoe UI Emoji;font-size:16px;line-height:1.5;word-wrap:break-word}.markdown-body details{display:block}.markdown-body summary{display:list-item}.markdown-body a{background-color:initial}.markdown-body a:active,.markdown-body a:hover{outline-width:0}.markdown-body strong{font-weight:inherit;font-weight:bolder}.markdown-body h1{margin:.67em 0}.markdown-body img{border-style:none}.markdown-body code,.markdown-body kbd,.markdown-body pre{font-family:monospace,monospace;font-size:1em}.markdown-body hr{box-sizing:initial;overflow:visible}.markdown-body input{font:inherit;margin:0;overflow:visible}.markdown-body [type=checkbox]{box-sizing:border-box;padding:0}.markdown-body *{box-sizing:border-box}.markdown-body input{font-family:inherit;font-size:inherit;line-height:inherit}.markdown-body a{color:#0366d6;text-decoration:none}.markdown-body a:hover{text-decoration:underline}.markdown-body strong{font-weight:600}.markdown-body hr{height:0;margin:15px 0;overflow:hidden;background:transparent;border-bottom:1px solid #dfe2e5}.markdown-body hr:after,.markdown-body hr:before{display:table;content:""}.markdown-body hr:after{clear:both}.markdown-body table{border-spacing:0;border-collapse:collapse}.markdown-body td,.markdown-body th{padding:0}.markdown-body details summary{cursor:pointer}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{margin-top:0;margin-bottom:0}.markdown-body h1{font-size:32px}.markdown-body h1,.markdown-body h2{font-weight:600}.markdown-body h2{font-size:24px}.markdown-body h3{font-size:20px}.markdown-body h3,.markdown-body h4{font-weight:600}.markdown-body h4{font-size:16px}.markdown-body h5{font-size:14px}.markdown-body h5,.markdown-body h6{font-weight:600}.markdown-body h6{font-size:12px}.markdown-body p{margin-top:0;margin-bottom:10px}.markdown-body blockquote{margin:0}.markdown-body ol,.markdown-body ul{padding-left:0;margin-top:0;margin-bottom:0}.markdown-body ol ol,.markdown-body ul ol{list-style-type:lower-roman}.markdown-body ol ol ol,.markdown-body ol ul ol,.markdown-body ul ol ol,.markdown-body ul ul ol{list-style-type:lower-alpha}.markdown-body dd{margin-left:0}.markdown-body code,.markdown-body pre{font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,monospace;font-size:12px}.markdown-body pre{margin-top:0;margin-bottom:0}.markdown-body input::-webkit-inner-spin-button,.markdown-body input::-webkit-outer-spin-button{margin:0;-webkit-appearance:none;appearance:none}.markdown-body :checked+.radio-label{position:relative;z-index:1;border-color:#0366d6}.markdown-body .border{border:1px solid #e1e4e8!important}.markdown-body .border-0{border:0!important}.markdown-body .border-bottom{border-bottom:1px solid #e1e4e8!important}.markdown-body .rounded-1{border-radius:3px!important}.markdown-body .bg-white{background-color:#fff!important}.markdown-body .bg-gray-light{background-color:#fafbfc!important}.markdown-body .text-gray-light{color:#6a737d!important}.markdown-body .pl-3,.markdown-body .px-3{padding-left:16px!important}.markdown-body .px-3{padding-right:16px!important}.markdown-body .f6{font-size:12px!important}.markdown-body .lh-condensed{line-height:1.25!important}.markdown-body .text-bold{font-weight:600!important}.markdown-body .pl-c{color:#6a737d}.markdown-body .pl-c1,.markdown-body .pl-s .pl-v{color:#005cc5}.markdown-body .pl-e,.markdown-body .pl-en{color:#6f42c1}.markdown-body .pl-s .pl-s1,.markdown-body .pl-smi{color:#24292e}.markdown-body .pl-ent{color:#22863a}.markdown-body .pl-k{color:#d73a49}.markdown-body .pl-pds,.markdown-body .pl-s,.markdown-body .pl-s .pl-pse .pl-s1,.markdown-body .pl-sr,.markdown-body .pl-sr .pl-cce,.markdown-body .pl-sr .pl-sra,.markdown-body .pl-sr .pl-sre{color:#032f62}.markdown-body .pl-smw,.markdown-body .pl-v{color:#e36209}.markdown-body .pl-bu{color:#b31d28}.markdown-body .pl-ii{color:#fafbfc;background-color:#b31d28}.markdown-body .pl-c2{color:#fafbfc;background-color:#d73a49}.markdown-body .pl-c2:before{content:"^M"}.markdown-body .pl-sr .pl-cce{font-weight:700;color:#22863a}.markdown-body .pl-ml{color:#735c0f}.markdown-body .pl-mh,.markdown-body .pl-mh .pl-en,.markdown-body .pl-ms{font-weight:700;color:#005cc5}.markdown-body .pl-mi{font-style:italic;color:#24292e}.markdown-body .pl-mb{font-weight:700;color:#24292e}.markdown-body .pl-md{color:#b31d28;background-color:#ffeef0}.markdown-body .pl-mi1{color:#22863a;background-color:#f0fff4}.markdown-body .pl-mc{color:#e36209;background-color:#ffebda}.markdown-body .pl-mi2{color:#f6f8fa;background-color:#005cc5}.markdown-body .pl-mdr{font-weight:700;color:#6f42c1}.markdown-body .pl-ba{color:#586069}.markdown-body .pl-sg{color:#959da5}.markdown-body .pl-corl{text-decoration:underline;color:#032f62}.markdown-body .mb-0{margin-bottom:0!important}.markdown-body .my-2{margin-bottom:8px!important;margin-top:8px!important}.markdown-body .pl-0{padding-left:0!important}.markdown-body .py-0{padding-top:0!important;padding-bottom:0!important}.markdown-body .pl-1{padding-left:4px!important}.markdown-body .pl-2{padding-left:8px!important}.markdown-body .py-2{padding-top:8px!important;padding-bottom:8px!important}.markdown-body .pl-3{padding-left:16px!important}.markdown-body .pl-4{padding-left:24px!important}.markdown-body .pl-5{padding-left:32px!important}.markdown-body .pl-6{padding-left:40px!important}.markdown-body .pl-7{padding-left:48px!important}.markdown-body .pl-8{padding-left:64px!important}.markdown-body .pl-9{padding-left:80px!important}.markdown-body .pl-10{padding-left:96px!important}.markdown-body .pl-11{padding-left:112px!important}.markdown-body .pl-12{padding-left:128px!important}.markdown-body hr{border-bottom-color:#eee}.markdown-body kbd{display:inline-block;padding:3px 5px;font:11px SFMono-Regular,Consolas,Liberation Mono,Menlo,monospace;line-height:10px;color:#444d56;vertical-align:middle;background-color:#fafbfc;border:1px solid #d1d5da;border-radius:3px;box-shadow:inset 0 -1px 0 #d1d5da}.markdown-body:after,.markdown-body:before{display:table;content:""}.markdown-body:after{clear:both}.markdown-body&gt;:first-child{margin-top:0!important}.markdown-body&gt;:last-child{margin-bottom:0!important}.markdown-body a:not([href]){color:inherit;text-decoration:none}.markdown-body blockquote,.markdown-body details,.markdown-body dl,.markdown-body ol,.markdown-body p,.markdown-body pre,.markdown-body table,.markdown-body ul{margin-top:0;margin-bottom:16px}.markdown-body hr{height:.25em;padding:0;margin:24px 0;background-color:#e1e4e8;border:0}.markdown-body blockquote{padding:0 1em;color:#6a737d;border-left:.25em solid #dfe2e5}.markdown-body blockquote&gt;:first-child{margin-top:0}.markdown-body blockquote&gt;:last-child{margin-bottom:0}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{margin-top:24px;margin-bottom:16px;font-weight:600;line-height:1.25}.markdown-body h1{font-size:2em}.markdown-body h1,.markdown-body h2{padding-bottom:.3em;border-bottom:1px solid #eaecef}.markdown-body h2{font-size:1.5em}.markdown-body h3{font-size:1.25em}.markdown-body h4{font-size:1em}.markdown-body h5{font-size:.875em}.markdown-body h6{font-size:.85em;color:#6a737d}.markdown-body ol,.markdown-body ul{padding-left:2em}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:0;margin-bottom:0}.markdown-body li{word-wrap:break-all}.markdown-body li&gt;p{margin-top:16px}.markdown-body li+li{margin-top:.25em}.markdown-body dl{padding:0}.markdown-body dl dt{padding:0;margin-top:16px;font-size:1em;font-style:italic;font-weight:600}.markdown-body dl dd{padding:0 16px;margin-bottom:16px}.markdown-body table{display:block;width:100%;overflow:auto}.markdown-body table th{font-weight:600}.markdown-body table td,.markdown-body table th{padding:6px 13px;border:1px solid #dfe2e5}.markdown-body table tr{background-color:#fff;border-top:1px solid #c6cbd1}.markdown-body table tr:nth-child(2n){background-color:#f6f8fa}.markdown-body img{max-width:100%;box-sizing:initial;background-color:#fff}.markdown-body img[align=right]{padding-left:20px}.markdown-body img[align=left]{padding-right:20px}.markdown-body code{padding:.2em .4em;margin:0;font-size:85%;background-color:rgba(27,31,35,.05);border-radius:3px}.markdown-body pre{word-wrap:normal}.markdown-body pre&gt;code{padding:0;margin:0;font-size:100%;word-break:normal;white-space:pre;background:transparent;border:0}.markdown-body .highlight{margin-bottom:16px}.markdown-body .highlight pre{margin-bottom:0;word-break:normal}.markdown-body .highlight pre,.markdown-body pre{padding:16px;overflow:auto;font-size:85%;line-height:1.45;background-color:#f6f8fa;border-radius:3px}.markdown-body pre code{display:inline;max-width:auto;padding:0;margin:0;overflow:visible;line-height:inherit;word-wrap:normal;background-color:initial;border:0}.markdown-body .commit-tease-sha{display:inline-block;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,monospace;font-size:90%;color:#444d56}.markdown-body .full-commit .btn-outline:not(:disabled):hover{color:#005cc5;border-color:#005cc5}.markdown-body .blob-wrapper{overflow-x:auto;overflow-y:hidden}.markdown-body .blob-wrapper-embedded{max-height:240px;overflow-y:auto}.markdown-body .blob-num{width:1%;min-width:50px;padding-right:10px;padding-left:10px;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,monospace;font-size:12px;line-height:20px;color:rgba(27,31,35,.3);text-align:right;white-space:nowrap;vertical-align:top;cursor:pointer;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.markdown-body .blob-num:hover{color:rgba(27,31,35,.6)}.markdown-body .blob-num:before{content:attr(data-line-number)}.markdown-body .blob-code{position:relative;padding-right:10px;padding-left:10px;line-height:20px;vertical-align:top}.markdown-body .blob-code-inner{overflow:visible;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,monospace;font-size:12px;color:#24292e;word-wrap:normal;white-space:pre}.markdown-body .pl-token.active,.markdown-body .pl-token:hover{cursor:pointer;background:#ffea7f}.markdown-body .tab-size[data-tab-size="1"]{-moz-tab-size:1;tab-size:1}.markdown-body .tab-size[data-tab-size="2"]{-moz-tab-size:2;tab-size:2}.markdown-body .tab-size[data-tab-size="3"]{-moz-tab-size:3;tab-size:3}.markdown-body .tab-size[data-tab-size="4"]{-moz-tab-size:4;tab-size:4}.markdown-body .tab-size[data-tab-size="5"]{-moz-tab-size:5;tab-size:5}.markdown-body .tab-size[data-tab-size="6"]{-moz-tab-size:6;tab-size:6}.markdown-body .tab-size[data-tab-size="7"]{-moz-tab-size:7;tab-size:7}.markdown-body .tab-size[data-tab-size="8"]{-moz-tab-size:8;tab-size:8}.markdown-body .tab-size[data-tab-size="9"]{-moz-tab-size:9;tab-size:9}.markdown-body .tab-size[data-tab-size="10"]{-moz-tab-size:10;tab-size:10}.markdown-body .tab-size[data-tab-size="11"]{-moz-tab-size:11;tab-size:11}.markdown-body .tab-size[data-tab-size="12"]{-moz-tab-size:12;tab-size:12}.markdown-body .task-list-item{list-style-type:none}.markdown-body .task-list-item+.task-list-item{margin-top:3px}.markdown-body .task-list-item input{margin:0 .2em .25em -1.6em;vertical-align:middle}</style><style data-highlight="" data-highlight-key="dark">.markdown-body pre,.markdown-body pre&gt;code.hljs{background:#444}.hljs-keyword,.hljs-link,.hljs-literal,.hljs-section,.hljs-selector-tag{color:#fff}.hljs-subst,.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#ddd}.hljs-addition,.hljs-attribute,.hljs-built_in,.hljs-bullet,.hljs-name,.hljs-string,.hljs-symbol,.hljs-template-tag,.hljs-template-variable,.hljs-title,.hljs-type,.hljs-variable{color:#d88}.hljs-comment,.hljs-deletion,.hljs-meta,.hljs-quote{color:#777}.hljs-doctag,.hljs-keyword,.hljs-literal,.hljs-name,.hljs-section,.hljs-selector-tag,.hljs-strong,.hljs-title,.hljs-type{font-weight:700}.hljs-emphasis{font-style:italic}</style><p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a9d2b1d467d245d4be28f9115f95563b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgbmV35bCP56CB:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766038001&amp;x-signature=GxhhvAjq2246ZTfUqmCIyIxKac4%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-0">环境准备</h3>
<p>HarmonyOS 开发环境</p>
<p>Flutter 环境管理工具FVM （安装方式网上有很多）</p>
<p>官方Flutter</p>
<h3 data-id="heading-1">使用FVM安装鸿蒙版的Flutter</h3>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgitcode.com%2Fopenharmony-tpc%2Fflutter_flutter" target="_blank" title="https://gitcode.com/openharmony-tpc/flutter_flutter" ref="nofollow noopener noreferrer">前往鸿蒙flutter官方仓库 </a>
可以发现他的标签已经支持到3.27.5，但这不是一个正式版，但是他是目前最新的版本了</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/02cb77a454d04e95831ee83fe09192eb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgbmV35bCP56CB:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766038001&amp;x-signature=o23tYzoKQGOBWaPMqvZrb2cf3E0%3D" alt="截屏2025-12-11 10.37.55.png" loading="lazy"/></p>
<p>接下来，我们需要下载项目，并将其切到 3.27.5-ohos-1.0.1 标签</p>
<pre><code class="hljs language-shell" lang="shell"><span class="hljs-meta prompt_">
# </span><span class="bash">将目录先切换到FVM的版本路径</span>
cd /XXX/fvm/versions
<span class="hljs-meta prompt_">
# </span><span class="bash">下载仓库</span> 
git clone https://gitcode.com/openharmony-sig/flutter_flutter.git 
<span class="hljs-meta prompt_">

# </span><span class="bash">切换到 3.22.1-ohos-1.0.0 标签</span> 
cd flutter_flutter 
git checkout 3.27.5-ohos-1.0.1

</code></pre>
<h3 data-id="heading-2">完成后查看Flutter版本</h3>
<p>在命令行执行</p>
<pre><code class="hljs language-shell" lang="shell">fvm list
</code></pre>
<p>会看到我们安装后的鸿蒙版本SDK</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/636a1fe65d9340658f64e8744c573f8e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgbmV35bCP56CB:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766038001&amp;x-signature=QgG8da3FwB1NjnxhU1HO457AFis%3D" alt="截屏2025-12-11 10.57.03.png" loading="lazy"/></p>
<h3 data-id="heading-3">使用我们安装的鸿蒙Flutter</h3>
<p>切换到我们的项目中来使用 鸿蒙版的Flutter，这里如果你的工程使用了git 托管，我建议另起一个分支来处理鸿蒙适配</p>
<p>接下来，<strong>切换到项目根目录下</strong>，运行以下命令使用刚刚安装的 Flutter SDK：<strong>（注意，如果弹出一些提醒，一路 <code>yes</code> 即可：）</strong></p>
<pre><code class="hljs language-shell" lang="shell">fvm use  3.27.5-ohos-1.0.1
</code></pre>
<h3 data-id="heading-4">改造我们的工程来适配鸿蒙</h3>
<p><strong>如果你的工程使用了git 托管，我建议另起一个分支来处理鸿蒙适配</strong>
下面我们使用鸿蒙版的Flutter来为我们的项目创建 ohos 文件夹：</p>
<pre><code class="hljs language-shell" lang="shell"><span class="hljs-meta prompt_"># </span><span class="bash">建议先在这里确认一下你的 当前flutter sdk有没有切换成功</span>
flutter --version
<span class="hljs-meta prompt_">
# </span><span class="bash">如果没有切换可以执行 fvm use 指令来切换到鸿蒙Flutter</span>
<span class="hljs-meta prompt_">
# </span><span class="bash">执行命令创建ohos文件</span>
flutter create --platforms ohos .  //这行最好这里有个点.
<span class="hljs-meta prompt_">
# </span><span class="bash">如果上面这个命令不好用 可以试试</span>
fvm flutter create --platforms ohos .
</code></pre>
<p>这样工程中就出现了ohos 文件</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4116fbb1a79945d2acb8ae9e0a372a27~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgbmV35bCP56CB:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766038001&amp;x-signature=969P5kfwKd9g6aS8yYLtix%2FyKjA%3D" alt="截屏2025-12-11 11.12.29.png" loading="lazy"/></p>
<h3 data-id="heading-5">第三方插件的管理</h3>
<p>对于三方插件来说，纯 Dart 的库是可以直接在鸿蒙上使用的，和平台相关的类库，需要兼容鸿蒙的库。他们不在 pub 上，而是由开源项目进行维护。有哪些插件支持了鸿蒙，可以在这个清单列表中查看 <a href="https://link.juejin.cn?target=https%3A%2F%2Fgitcode.com%2Fopenharmony-tpc%2Fflutter_packages%23openharmony%25E5%25B9%25B3%25E5%258F%25B0%25E5%25B7%25B2%25E5%2585%25BC%25E5%25AE%25B9%25E5%25BA%2593" target="_blank" title="https://gitcode.com/openharmony-tpc/flutter_packages#openharmony%E5%B9%B3%E5%8F%B0%E5%B7%B2%E5%85%BC%E5%AE%B9%E5%BA%93" ref="nofollow noopener noreferrer">gitcode.com/openharmony…</a>
比如我的项目中使用了 <code>shared_preferences</code> 就需要使用鸿蒙提供的版本，这里我们可以使用<code>dependency_overrides</code> 覆盖依赖，这样不会影响以前的代码结构：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0ffcb26773c54394a56d82adee6f7d65~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgbmV35bCP56CB:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766038001&amp;x-signature=dCARxB9ZCJS5fwHR%2Fbs4ObsMQds%3D" alt="截屏2025-12-11 11.16.34.png" loading="lazy"/></p>
<p>在项目目录下执行一下命令 来下载依赖库</p>
<pre><code class="hljs language-shell" lang="shell">flutter pub get //或者是fvm flutter pub get
</code></pre>
<h3 data-id="heading-6">对项目进行打包运行</h3>
<p>这时候就需要使用鸿蒙的开发 IDE了。打开DevEco-studio</p>
<p>使用DevEco-studio打开刚刚创建的ohos 文件夹</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8a0cbacce3314745be22c4365bdf4ff6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgbmV35bCP56CB:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766038001&amp;x-signature=7YoDnXuNYEoBXFAFqP7DnPV%2Fnxo%3D" alt="截屏2025-12-11 11.25.25.png" loading="lazy"/></p>
<p>IDE 第一次可能会执行构建</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/95a24d0a68a74a98b88f6a3a86b674c8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgbmV35bCP56CB:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766038001&amp;x-signature=Lf%2BQF6jU%2FMhXjc06533vpMJN4YE%3D" alt="image.png" loading="lazy"/>
如果有失败可以使用<code>flutter doctor</code>或者 <code>fvm flutter doctor</code>来排除一下问题</p>
<h4 data-id="heading-7">一切正常的话，来打包吧</h4>
<pre><code class="hljs language-shell" lang="shell">flutter build hap --release    //或 fvm flutter build hap --release
</code></pre>
<p>这样项目就可以在鸿蒙上跑起来了, 打开模拟器，点击运行即可，如果是真机调试，打开开发者模式重启手机，打开USB调试，插在电脑上，这里我遇到过不识别的问题，我换了官方数据线就好了，普通安卓type-C线可能会不识别【裂开】</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[JavaScript 内存三空间协同机制：代码空间、栈空间与堆空间如何联合运行]]></title>    <link>https://juejin.cn/post/7582156219060043839</link>    <guid>https://juejin.cn/post/7582156219060043839</guid>    <pubDate>2025-12-11T06:09:41.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7582156219060043839" data-draft-id="7582182817107640346" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="JavaScript 内存三空间协同机制：代码空间、栈空间与堆空间如何联合运行"/> <meta itemprop="keywords" content="前端,JavaScript"/> <meta itemprop="datePublished" content="2025-12-11T06:09:41.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="烟袅破辰"/> <meta itemprop="url" content="https://juejin.cn/user/1845419006243504"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            JavaScript 内存三空间协同机制：代码空间、栈空间与堆空间如何联合运行
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1845419006243504/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    烟袅破辰
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-11T06:09:41.000Z" title="Thu Dec 11 2025 06:09:41 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-11
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>在 JavaScript 开发中，我们常常听说“原始类型存在栈里，对象存在堆里”，但很少有人深入探讨：<strong>函数代码存在哪里？执行时到底发生了什么？为什么闭包能记住变量？</strong></p>
<p>要真正理解这些问题，必须跳出“栈 vs 堆”的二元模型，引入第三个关键角色——<strong>代码空间（Code Space）</strong> 。本文将系统阐述 JavaScript 引擎（以 V8 为例）中 <strong>代码空间、栈空间、堆空间</strong> 三者如何协同工作，共同支撑起整个语言的运行机制。</p>
<hr/>
<h2 data-id="heading-0">一、三大内存空间的角色定位</h2>
<p>JavaScript 引擎在运行时，会将内存划分为三个逻辑区域，各司其职：</p>

























<table><thead><tr><th>空间</th><th>存储内容</th><th>特点</th></tr></thead><tbody><tr><td><strong>代码空间</strong></td><td>编译后的字节码或机器码</td><td>只读、共享、由引擎管理</td></tr><tr><td><strong>栈空间</strong></td><td>执行上下文、原始值、对象引用</td><td>快速分配/释放、连续、生命周期短</td></tr><tr><td><strong>堆空间</strong></td><td>所有对象（包括函数对象、闭包环境）</td><td>动态分配、不连续、依赖垃圾回收</td></tr></tbody></table>
<p>这三者并非孤立存在，而是通过<strong>指针引用</strong>和<strong>执行流</strong>紧密协作。</p>
<hr/>
<h2 data-id="heading-1">二、函数定义：三空间的初次联动</h2>
<p>考虑以下函数定义：</p>
<pre><code class="hljs language-css" lang="css">function add(<span class="hljs-selector-tag">a</span>, <span class="hljs-selector-tag">b</span>) {
  return <span class="hljs-selector-tag">a</span> + <span class="hljs-selector-tag">b</span>;
}
</code></pre>
<h3 data-id="heading-2">1. 代码空间：存放执行逻辑</h3>
<ul>
<li>引擎将 <code>return a + b</code> 编译为字节码（如 <code>Load a</code>, <code>Load b</code>, <code>Add</code>, <code>Return</code>）；</li>
<li>这些指令被存入<strong>代码空间</strong>，作为可复用的执行模板。</li>
</ul>
<h3 data-id="heading-3">2. 堆空间：创建函数对象</h3>
<ul>
<li>
<p>JavaScript 中函数是<strong>一等对象</strong>，因此会创建一个 <code>Function</code> 类型的对象；</p>
</li>
<li>
<p>该对象包含：</p>
<ul>
<li>属性：<code>name: "add"</code>, <code>length: 2</code>；</li>
<li>内部指针 <code>[[Code]]</code>：指向代码空间中 <code>add</code> 的字节码入口；</li>
<li><code>[[Environment]]</code>：指向定义时的词法环境（用于闭包）。</li>
</ul>
</li>
</ul>
<h3 data-id="heading-4">3. 栈空间：注册变量引用</h3>
<ul>
<li>在全局执行上下文中，变量 <code>add</code> 被注册；</li>
<li>其值是一个<strong>引用（指针）</strong> ，指向堆中的函数对象。</li>
</ul>
<blockquote>
<p>此时三空间已建立连接：<br/>
<strong>栈（add 变量） → 堆（函数对象） → 代码空间（字节码）</strong></p>
</blockquote>
<hr/>
<h2 data-id="heading-5">三、函数调用：三空间的动态协作</h2>
<p>执行 <code>const result = add(2, 3);</code> 时，三空间开始动态交互：</p>
<h3 data-id="heading-6">步骤 1：查找函数入口</h3>
<ul>
<li>引擎通过栈中的 <code>add</code> 变量，找到堆中的函数对象；</li>
<li>从函数对象取出 <code>[[Code]]</code> 指针，定位到代码空间的起始指令。</li>
</ul>
<h3 data-id="heading-7">步骤 2：压入执行上下文（栈空间）</h3>
<ul>
<li>
<p>在调用栈顶部创建新帧，包含：</p>
<ul>
<li>参数 <code>a = 2</code>, <code>b = 3</code>（原始值，直接存栈）；</li>
<li>返回地址、作用域链等控制信息。</li>
</ul>
</li>
</ul>
<h3 data-id="heading-8">步骤 3：执行指令（引擎驱动）</h3>
<ul>
<li>
<p>引擎（如 V8 的 Ignition 解释器）<strong>逐条读取代码空间中的字节码</strong>，并在 CPU 上执行：</p>
<ul>
<li><code>Load a</code> → 从当前栈帧读取 <code>2</code>；</li>
<li><code>Load b</code> → 读取 <code>3</code>；</li>
<li><code>Add</code> → 引擎内部计算 <code>2 + 3 = 5</code>（这是 C++ 实现的底层操作）；</li>
<li><code>Return</code> → 准备返回值。</li>
</ul>
</li>
</ul>
<blockquote>
<p>注意：<strong>执行发生在引擎/CPU 层面，不是在栈或堆中</strong>。<br/>
栈和堆只是被操作的“数据区”。</p>
</blockquote>
<h3 data-id="heading-9">步骤 4：返回结果（写回栈）</h3>
<ul>
<li>返回值 <code>5</code>（原始类型）被写入<strong>调用者的栈帧</strong>（即 <code>result = 5</code>）；</li>
<li><code>add</code> 的栈帧被弹出，参数 <code>a</code>、<code>b</code> 自动销毁。</li>
</ul>
<hr/>
<h2 data-id="heading-10">四、复杂场景：对象与闭包如何影响三空间</h2>
<h3 data-id="heading-11">场景 1：返回对象</h3>
<pre><code class="hljs language-ini" lang="ini">function createObj(x) {
  return { value: x }<span class="hljs-comment">;</span>
}
const <span class="hljs-attr">obj</span> = createObj(<span class="hljs-number">10</span>)<span class="hljs-comment">;</span>
</code></pre>
<ul>
<li><code>{ value: x }</code> 是引用类型 → 在<strong>堆空间</strong>分配内存；</li>
<li>栈中 <code>obj</code> 变量存储的是<strong>堆地址（引用）</strong> ；</li>
<li>即使 <code>createObj</code> 执行结束，只要 <code>obj</code> 存在，堆中对象就不会被 GC 回收。</li>
</ul>
<h3 data-id="heading-12">场景 2：闭包捕获变量</h3>
<pre><code class="hljs language-ini" lang="ini">function outer(n) {
  let <span class="hljs-attr">count</span> = n<span class="hljs-comment">;</span>
  return function inner() {
    return ++count<span class="hljs-comment">;</span>
  }<span class="hljs-comment">;</span>
}
const <span class="hljs-attr">inc</span> = outer(<span class="hljs-number">5</span>)<span class="hljs-comment">;</span>
inc()<span class="hljs-comment">; // 6</span>
</code></pre>
<ul>
<li><code>count</code> 原本是 <code>outer</code> 的局部变量（应存栈中）；</li>
<li>但 <code>inner</code> 引用了它 → 引擎检测到闭包；</li>
<li>于是将 <code>count</code> <strong>从栈提升到堆中</strong>，放入一个特殊的 <strong>closure 环境对象</strong>；</li>
<li><code>inner</code> 的 <code>[[Environment]]</code> 指向该堆对象；</li>
<li>即使 <code>outer</code> 栈帧销毁，<code>count</code> 仍存活于堆中。</li>
</ul>
<blockquote>
<p>闭包的本质：<strong>通过堆空间延长变量生命周期</strong>，打破栈的自动回收规则。</p>
</blockquote>
<hr/>
<h2 data-id="heading-13">五、总结</h2>
<p>执行流程：
引擎 → 读代码空间指令 → 操作栈（取参数）和堆（建对象） → 结果写回调用者栈帧</p>
<ul>
<li><strong>代码空间</strong>：提供“做什么”（指令）；</li>
<li><strong>栈空间</strong>：提供“用什么”（临时数据）；</li>
<li><strong>堆空间</strong>：提供“存什么”（持久对象）；</li>
<li><strong>JavaScript 引擎</strong>：负责“怎么做”（执行协调）。</li>
</ul>
<p>理解这三者的分工与协作，你就能真正看透 JavaScript 的运行本质——无论是性能优化、内存泄漏排查，还是闭包、异步、模块化等高级特性，都将变得清晰而自然。</p>
<blockquote>
<p>掌握内存，方能驾驭语言。</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[深入理解 JavaScript 内存机制与闭包原理]]></title>    <link>https://juejin.cn/post/7582207260198862902</link>    <guid>https://juejin.cn/post/7582207260198862902</guid>    <pubDate>2025-12-11T06:10:52.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7582207260198862902" data-draft-id="7582169248094748678" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="深入理解 JavaScript 内存机制与闭包原理"/> <meta itemprop="keywords" content="前端,JavaScript"/> <meta itemprop="datePublished" content="2025-12-11T06:10:52.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="烟袅破辰"/> <meta itemprop="url" content="https://juejin.cn/user/1845419006243504"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            深入理解 JavaScript 内存机制与闭包原理
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1845419006243504/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    烟袅破辰
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-11T06:10:52.000Z" title="Thu Dec 11 2025 06:10:52 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-11
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>在前端开发中，JavaScript 的内存管理常常被开发者忽视。然而，掌握其底层内存机制，不仅能帮助我们写出更高效的代码，还能深入理解诸如闭包、作用域链等核心概念。本文将从 JavaScript 的执行机制出发，逐步剖析栈内存与堆内存的分工，并揭示闭包背后的真实运作逻辑。</p>
<hr/>
<h2 data-id="heading-0">一、JavaScript 是什么语言？</h2>
<p>JavaScript 是一门<strong>动态弱类型语言</strong>：</p>
<ul>
<li><strong>动态语言</strong>：变量的数据类型在运行时确定，无需提前声明。</li>
<li><strong>弱类型语言</strong>：不同类型之间可以自动转换（如 <code>"1" + 2 === "12"</code>）。</li>
</ul>
<p>与 C/C++ 等需要手动申请（<code>malloc</code>）和释放（<code>free</code>）内存的语言不同，JavaScript 的内存由引擎自动管理，开发者<strong>无需直接操作内存</strong>。</p>
<hr/>
<h2 data-id="heading-1">二、JavaScript 的执行机制简述</h2>
<p>JavaScript 引擎（如 V8）通过以下结构来组织程序的执行：</p>
<h3 data-id="heading-2">1. 调用栈（Call Stack）</h3>
<p>调用栈是 JavaScript 执行函数的核心数据结构，采用“先进后出”的原则。每当一个函数被调用，就会创建一个**执行上下文（Execution Context）**并压入栈顶；函数执行完毕后，该上下文被弹出。</p>
<h3 data-id="heading-3">2. 执行上下文的组成</h3>
<p>每个执行上下文包含以下关键部分：</p>
<ul>
<li><strong>变量环境（Variable Environment）</strong> ：存放 <code>var</code> 声明的变量。</li>
<li><strong>词法环境（Lexical Environment）</strong> ：存放 <code>let</code>、<code>const</code> 和函数参数等。</li>
<li><strong>Outer 引用</strong>：指向父级词法环境，构成<strong>作用域链</strong>。</li>
<li><strong>this 绑定</strong>：当前上下文中的 this 值。</li>
</ul>
<p>当内部函数引用了外部函数的变量时，就形成了<strong>闭包（Closure）</strong> 。</p>
<hr/>
<h2 data-id="heading-4">三、JavaScript 的内存模型：栈 vs 堆</h2>
<p>JavaScript 的内存主要分为两类：<strong>栈内存</strong>和<strong>堆内存</strong>。它们分别用于存储不同类型的数据。</p>
<h3 data-id="heading-5">1. 栈内存（Stack）</h3>
<ul>
<li>存储<strong>简单数据类型（原始类型）</strong> ：<code>number</code>、<code>string</code>、<code>boolean</code>、<code>null</code>、<code>undefined</code>、<code>symbol</code>、<code>bigint</code>。</li>
<li>特点：<strong>空间小、分配快、连续、生命周期短</strong>。</li>
<li>栈内存的管理非常高效，因为只需移动栈顶指针即可完成分配与回收。</li>
</ul>
<h3 data-id="heading-6">2. 堆内存（Heap）</h3>
<ul>
<li>存储<strong>复杂数据类型（引用类型）</strong> ：<code>Object</code>、<code>Array</code>、<code>Function</code> 等。</li>
<li>特点：<strong>空间大、分配慢、不连续、生命周期长</strong>。</li>
<li>对象在堆中创建后，栈中只保存其<strong>引用地址（指针）</strong> 。</li>
</ul>
<blockquote>
<p>为什么这样设计？<br/>
如果所有数据都放在栈中，尤其是大型对象，会导致栈空间迅速膨胀，影响上下文切换效率。而将大对象放入堆中，栈只需维护轻量级的引用，极大提升了执行效率。</p>
</blockquote>
<hr/>
<h2 data-id="heading-7">四、闭包的本质：堆内存中的作用域快照</h2>
<p>闭包常被描述为“函数 + 其词法环境”，但其底层实现依赖于<strong>堆内存</strong>。</p>
<h3 data-id="heading-8">闭包的形成过程</h3>
<p>以如下代码为例：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">foo</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">let</span> myName = <span class="hljs-string">'Alice'</span>;
  <span class="hljs-keyword">function</span> <span class="hljs-title function_">getName</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">return</span> myName;
  }
  <span class="hljs-keyword">return</span> getName;
}

<span class="hljs-keyword">const</span> getName = <span class="hljs-title function_">foo</span>();
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title function_">getName</span>()); <span class="hljs-comment">// 'Alice'</span>
</code></pre>
<p>执行流程如下：</p>
<ol>
<li>
<p><strong>全局上下文创建</strong>：<code>foo</code> 函数被定义。</p>
</li>
<li>
<p><strong>调用 <code>foo()</code></strong> ：</p>
<ul>
<li>创建 <code>foo</code> 的执行上下文，压入调用栈。</li>
<li>引擎进行<strong>词法扫描</strong>，发现内部函数 <code>getName</code> 引用了外部变量 <code>myName</code>。</li>
<li>判断存在闭包 → 在<strong>堆内存中创建一个 closure(foo) 对象</strong>，用于保存 <code>myName</code> 的值。</li>
</ul>
</li>
<li>
<p><strong>返回 <code>getName</code> 函数</strong>：</p>
<ul>
<li><code>foo</code> 执行上下文从栈中弹出（栈内存释放）。</li>
<li>但 <code>getName</code> 仍持有对堆中 <code>closure(foo)</code> 的引用，因此 <code>myName</code> 不会被垃圾回收。</li>
</ul>
</li>
<li>
<p><strong>后续调用 <code>getName()</code></strong> ：</p>
<ul>
<li>通过作用域链访问堆中的 <code>closure(foo)</code>，成功读取 <code>myName</code>。</li>
</ul>
</li>
</ol>
<blockquote>
<p>关键点：<strong>闭包变量并非“保留在栈中”，而是被提升到堆内存中持久化存储</strong>。这是闭包能跨越函数生命周期的根本原因。</p>
</blockquote>
<hr/>
<h2 data-id="heading-9">五、为什么只有两种内存机制就够了？</h2>
<p>JavaScript 的八种数据类型可归为两类：</p>
<ul>
<li><strong>7 种原始类型</strong>：值直接存于栈中，拷贝传递。</li>
<li><strong>1 种引用类型（Object）</strong> ：值存于堆中，栈中存引用。</li>
</ul>
<p>这种“栈+堆”的二分模型，既保证了基本类型的高效访问，又支持复杂对象的动态扩展，完美平衡了性能与灵活性。</p>
<p>此外，<code>Object</code> 的 key 只能是 <code>string</code> 或 <code>symbol</code>，而 value 可以是任意类型——这进一步体现了 JavaScript 动态弱类型的特性。</p>
<hr/>
<h2 data-id="heading-10">六、总结</h2>
<ul>
<li>JavaScript 通过<strong>调用栈</strong>管理函数执行，通过<strong>栈/堆内存</strong>区分数据存储。</li>
<li><strong>原始类型</strong>存于栈，<strong>对象类型</strong>存于堆，栈中仅保留引用。</li>
<li><strong>闭包</strong>的本质是：引擎检测到内部函数引用外部变量时，在<strong>堆中创建一个 closure 对象</strong>，保存所需变量，使这些变量在外部函数执行结束后仍可访问。</li>
<li>理解内存机制，有助于我们避免内存泄漏、优化性能，并真正掌握 JavaScript 的运行原理。</li>
</ul>
<p>掌握这些底层知识，你就能在面对复杂作用域、异步回调、模块封装等问题时，做到心中有数，游刃有余。</p>
<hr/></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[JavaScript 原生方法实现：数学与数字处理全解析]]></title>    <link>https://juejin.cn/post/7582207260198912054</link>    <guid>https://juejin.cn/post/7582207260198912054</guid>    <pubDate>2025-12-11T06:23:01.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7582207260198912054" data-draft-id="7582156219060092991" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="JavaScript 原生方法实现：数学与数字处理全解析"/> <meta itemprop="keywords" content="前端,JavaScript,ECMAScript 6"/> <meta itemprop="datePublished" content="2025-12-11T06:23:01.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="1024肥宅"/> <meta itemprop="url" content="https://juejin.cn/user/588993964030574"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            JavaScript 原生方法实现：数学与数字处理全解析
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/588993964030574/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    1024肥宅
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-11T06:23:01.000Z" title="Thu Dec 11 2025 06:23:01 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-11
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h4 data-id="heading-0">引言</h4>
<p>JavaScript中的数字处理看似简单，实则隐藏着许多值得深入探讨的细节。从基本运算到复杂的大数处理，从浮点数精度到随机数生成，每个环节都影响着程序的准确性和可靠性。本文将系统性地解析JavaScript中数学与数字处理的核心实现，帮助你建立完整的技术认知体系。</p>
<h4 data-id="heading-1">一、JavaScript数字系统基础</h4>
<h5 data-id="heading-2">1.1 数字类型概览</h5>
<p>JavaScript使用IEEE 754标准的双精度浮点数表示所有数字，这导致:</p>
<ul>
<li>所有数字都是64位浮点数</li>
<li>安全整数范围: -2⁵³ + 1 到 2⁵³ - 1（±9,007,199,254,740,991）</li>
<li>最大安全值: Number.MAX_SAFE_INTEGER (9,007,199,254,740,991)</li>
<li>最小安全值: Number.MIN_SAFE_INTEGER (-9,007,199,254,740,991)</li>
</ul>
<h5 data-id="heading-3">1.2 特殊数值</h5>
<ul>
<li>Infinity 和 -Infinity：表示无穷大</li>
<li>NaN：非数字值（但类型是number）</li>
<li>Number.EPSILON：表示1与大于1的最小浮点数之间的差（约2.22e-16）</li>
</ul>
<h4 data-id="heading-4">二、大数运算实现</h4>
<h5 data-id="heading-5">2.1 BigInt类型</h5>
<p>ES2020引入的BigInt类型是处理大数的原生解决方案：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// BigInt字面量</span>
<span class="hljs-keyword">const</span> bigInt1 = <span class="hljs-number">123456789012345678901234567890n</span>;
<span class="hljs-keyword">const</span> bigInt2 = <span class="hljs-title class_">BigInt</span>(<span class="hljs-string">"123456789012345678901234567890"</span>);

<span class="hljs-comment">// 运算</span>
<span class="hljs-keyword">const</span> sum = bigInt1 + bigInt2;
<span class="hljs-keyword">const</span> product = bigInt1 * bigInt2;
<span class="hljs-keyword">const</span> modulo = bigInt1 % bigInt2;
</code></pre>
<h5 data-id="heading-6">2.2 BigInt的限制与特性</h5>
<ul>
<li>不能与普通Number混合运算</li>
<li>不支持无符号右移运算符（&gt;&gt;&gt;）</li>
<li>在JSON.stringify()中需要自定义序列化</li>
<li>除法运算会向下取整</li>
</ul>
<h5 data-id="heading-7">2.3 大数运算的最佳实践</h5>
<ol>
<li>明确使用场景：仅在超出安全整数范围时使用BigInt</li>
<li>类型一致性：避免BigInt与Number的隐式转换</li>
<li>性能考虑：BigInt运算通常比Number慢</li>
</ol>
<h4 data-id="heading-8">三、浮点数精度处理</h4>
<h5 data-id="heading-9">3.1 精度问题的根源</h5>
<p>IEEE 754双精度浮点数的固有限制：</p>
<ul>
<li>二进制无法精确表示某些十进制小数（如0.1）</li>
<li>累积误差在连续运算中会放大</li>
</ul>
<h5 data-id="heading-10">3.2 精度问题解决方案</h5>
<p>方案一：扩大为整数运算</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">add</span>(<span class="hljs-params">num1, num2</span>) {
    <span class="hljs-keyword">const</span> scale = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">max</span>(
        num1.<span class="hljs-title function_">toString</span>().<span class="hljs-title function_">split</span>(<span class="hljs-string">'.'</span>)[<span class="hljs-number">1</span>]?.<span class="hljs-property">length</span> || <span class="hljs-number">0</span>,
        num2.<span class="hljs-title function_">toString</span>().<span class="hljs-title function_">split</span>(<span class="hljs-string">'.'</span>)[<span class="hljs-number">1</span>]?.<span class="hljs-property">length</span> || <span class="hljs-number">0</span>
    );
    <span class="hljs-keyword">const</span> factor = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">pow</span>(<span class="hljs-number">10</span>, scale);
    <span class="hljs-keyword">return</span> (num1 * factor + num2 * factor) / factor;
}
</code></pre>
<p>方案二：使用toFixed配合数值转换</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">preciseAddition</span>(<span class="hljs-params">num1, num2, precision = <span class="hljs-number">12</span></span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-built_in">parseFloat</span>((num1 + num2).<span class="hljs-title function_">toFixed</span>(precision));
}
</code></pre>
<p>方案三：第三方库方案</p>
<ul>
<li>decimal.js：功能完整的大数运算库</li>
<li>bignumber.js：专门处理任意精度十进制数</li>
<li>mathjs：综合数学计算库</li>
</ul>
<h5 data-id="heading-11">3.3 比较浮点数的最佳实践</h5>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">areNumbersEqual</span>(<span class="hljs-params">num1, num2, epsilon = <span class="hljs-built_in">Number</span>.EPSILON</span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">abs</span>(num1 - num2) &lt; epsilon;
}

<span class="hljs-keyword">function</span> <span class="hljs-title function_">compareWithPrecision</span>(<span class="hljs-params">num1, num2, precision = <span class="hljs-number">0.000001</span></span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">abs</span>(num1 - num2) &lt;= precision;
}
</code></pre>
<h4 data-id="heading-12">四、随机数生成器</h4>
<h5 data-id="heading-13">4.1 Math.random()的局限性</h5>
<ul>
<li>生成[0, 1)区间的伪随机浮点数</li>
<li>加密学上不安全</li>
<li>不可设置种子值</li>
</ul>
<h5 data-id="heading-14">4.2 增强型随机数函数</h5>
<p>生成指定范围整数</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">randomInt</span>(<span class="hljs-params">min, max</span>) {
    min = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">ceil</span>(min);
    max = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">floor</span>(max);
    <span class="hljs-keyword">return</span> <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">floor</span>(<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>() * (max - min + <span class="hljs-number">1</span>)) + min;
}
</code></pre>
<p>生成指定范围浮点数</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">randomFloat</span>(<span class="hljs-params">min, max, precision = <span class="hljs-number">4</span></span>) {
    <span class="hljs-keyword">const</span> value = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>() * (max - min) + min;
    <span class="hljs-keyword">return</span> <span class="hljs-built_in">parseFloat</span>(value.<span class="hljs-title function_">toFixed</span>(precision));
}
</code></pre>
<p>生成不重复随机序列</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">generateUniqueRandomNumbers</span>(<span class="hljs-params">count, min, max</span>) {
    <span class="hljs-keyword">if</span> (max - min + <span class="hljs-number">1</span> &lt; count) {
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">"范围太小无法生成指定数量的不重复随机数"</span>);
    }
    
    <span class="hljs-keyword">const</span> numbers = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Set</span>();
    <span class="hljs-keyword">while</span> (numbers.<span class="hljs-property">size</span> &lt; count) {
        numbers.<span class="hljs-title function_">add</span>(<span class="hljs-title function_">randomInt</span>(min, max));
    }
    <span class="hljs-keyword">return</span> <span class="hljs-title class_">Array</span>.<span class="hljs-title function_">from</span>(numbers);
}
</code></pre>
<h5 data-id="heading-15">4.3 加密安全的随机数</h5>
<p>使用Web Crypto API生成加密学安全的随机数：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">secureRandomInt</span>(<span class="hljs-params">min, max</span>) {
    <span class="hljs-keyword">const</span> range = max - min + <span class="hljs-number">1</span>;
    <span class="hljs-keyword">const</span> bytesNeeded = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">ceil</span>(<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">log2</span>(range) / <span class="hljs-number">8</span>);
    <span class="hljs-keyword">const</span> randomBytes = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Uint8Array</span>(bytesNeeded);
    crypto.<span class="hljs-title function_">getRandomValues</span>(randomBytes);
    
    <span class="hljs-keyword">let</span> randomValue = <span class="hljs-number">0</span>;
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; bytesNeeded; i++) {
        randomValue = (randomValue &lt;&lt; <span class="hljs-number">8</span>) | randomBytes[i];
    }
    
    <span class="hljs-keyword">return</span> min + (randomValue % range);
}
</code></pre>
<h4 data-id="heading-16">五、进制转换算法</h4>
<h5 data-id="heading-17">5.1 内置进制转换方法</h5>
<p>十进制转其他进制</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 数字的进制转换方法</span>
<span class="hljs-keyword">const</span> num = <span class="hljs-number">255</span>;

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(num.<span class="hljs-title function_">toString</span>(<span class="hljs-number">2</span>));  <span class="hljs-comment">// "11111111" - 二进制</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(num.<span class="hljs-title function_">toString</span>(<span class="hljs-number">8</span>));  <span class="hljs-comment">// "377"      - 八进制</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(num.<span class="hljs-title function_">toString</span>(<span class="hljs-number">16</span>)); <span class="hljs-comment">// "ff"       - 十六进制</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(num.<span class="hljs-title function_">toString</span>(<span class="hljs-number">32</span>)); <span class="hljs-comment">// "7v"       - 三十二进制</span>
</code></pre>
<p>其他进制转十进制</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// parseInt的进制转换</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-built_in">parseInt</span>(<span class="hljs-string">"11111111"</span>, <span class="hljs-number">2</span>));   <span class="hljs-comment">// 255</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-built_in">parseInt</span>(<span class="hljs-string">"377"</span>, <span class="hljs-number">8</span>));        <span class="hljs-comment">// 255</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-built_in">parseInt</span>(<span class="hljs-string">"ff"</span>, <span class="hljs-number">16</span>));        <span class="hljs-comment">// 255</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-built_in">parseInt</span>(<span class="hljs-string">"7v"</span>, <span class="hljs-number">32</span>));        <span class="hljs-comment">// 255</span>
</code></pre>
<h5 data-id="heading-18">5.2 自定义进制转换函数</h5>
<p>通用进制转换函数</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">convertBase</span>(<span class="hljs-params">number, fromBase, toBase</span>) {
    <span class="hljs-keyword">if</span> (fromBase &lt; <span class="hljs-number">2</span> || fromBase &gt; <span class="hljs-number">36</span> || toBase &lt; <span class="hljs-number">2</span> || toBase &gt; <span class="hljs-number">36</span>) {
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">"基数必须在2到36之间"</span>);
    }
    
    <span class="hljs-comment">// 先转换为十进制</span>
    <span class="hljs-keyword">const</span> decimal = <span class="hljs-built_in">parseInt</span>(number.<span class="hljs-title function_">toString</span>(), fromBase);
    
    <span class="hljs-comment">// 从十进制转换为目标进制</span>
    <span class="hljs-keyword">return</span> decimal.<span class="hljs-title function_">toString</span>(toBase);
}
</code></pre>
<p>支持自定义字符集的进制转换</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">customBaseConvert</span>(<span class="hljs-params">number, fromChars, toChars</span>) {
    <span class="hljs-keyword">const</span> fromBase = fromChars.<span class="hljs-property">length</span>;
    <span class="hljs-keyword">const</span> toBase = toChars.<span class="hljs-property">length</span>;
    
    <span class="hljs-comment">// 转换为十进制</span>
    <span class="hljs-keyword">let</span> decimal = <span class="hljs-number">0</span>;
    <span class="hljs-keyword">const</span> numberStr = number.<span class="hljs-title function_">toString</span>();
    
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; numberStr.<span class="hljs-property">length</span>; i++) {
        <span class="hljs-keyword">const</span> char = numberStr[numberStr.<span class="hljs-property">length</span> - <span class="hljs-number">1</span> - i];
        <span class="hljs-keyword">const</span> value = fromChars.<span class="hljs-title function_">indexOf</span>(char);
        <span class="hljs-keyword">if</span> (value === -<span class="hljs-number">1</span>) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">`无效字符: <span class="hljs-subst">${char}</span>`</span>);
        }
        decimal += value * <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">pow</span>(fromBase, i);
    }
    
    <span class="hljs-comment">// 从十进制转换为目标进制</span>
    <span class="hljs-keyword">if</span> (decimal === <span class="hljs-number">0</span>) <span class="hljs-keyword">return</span> toChars[<span class="hljs-number">0</span>];
    
    <span class="hljs-keyword">let</span> result = <span class="hljs-string">""</span>;
    <span class="hljs-keyword">while</span> (decimal &gt; <span class="hljs-number">0</span>) {
        result = toChars[decimal % toBase] + result;
        decimal = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">floor</span>(decimal / toBase);
    }
    
    <span class="hljs-keyword">return</span> result;
}

<span class="hljs-comment">// 示例：十进制转Base62（用于URL短链接）</span>
<span class="hljs-keyword">const</span> base62Chars = <span class="hljs-string">"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz"</span>;
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title function_">customBaseConvert</span>(<span class="hljs-number">123456789</span>, <span class="hljs-string">"0123456789"</span>, base62Chars)); <span class="hljs-comment">// "8M0kX"</span>
</code></pre>
<h5 data-id="heading-19">5.3 特殊进制处理</h5>
<p>二进制与十六进制互转</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">binaryToHex</span>(<span class="hljs-params">binaryStr</span>) {
    <span class="hljs-comment">// 补全到4的倍数位</span>
    <span class="hljs-keyword">const</span> padded = binaryStr.<span class="hljs-title function_">padStart</span>(<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">ceil</span>(binaryStr.<span class="hljs-property">length</span> / <span class="hljs-number">4</span>) * <span class="hljs-number">4</span>, <span class="hljs-string">'0'</span>);
    <span class="hljs-keyword">let</span> hexStr = <span class="hljs-string">''</span>;
    
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; padded.<span class="hljs-property">length</span>; i += <span class="hljs-number">4</span>) {
        <span class="hljs-keyword">const</span> nibble = padded.<span class="hljs-title function_">substr</span>(i, <span class="hljs-number">4</span>);
        hexStr += <span class="hljs-built_in">parseInt</span>(nibble, <span class="hljs-number">2</span>).<span class="hljs-title function_">toString</span>(<span class="hljs-number">16</span>);
    }
    
    <span class="hljs-keyword">return</span> hexStr.<span class="hljs-title function_">toUpperCase</span>();
}

<span class="hljs-keyword">function</span> <span class="hljs-title function_">hexToBinary</span>(<span class="hljs-params">hexStr</span>) {
    <span class="hljs-keyword">let</span> binaryStr = <span class="hljs-string">''</span>;
    
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> char <span class="hljs-keyword">of</span> hexStr) {
        <span class="hljs-keyword">const</span> binary = <span class="hljs-built_in">parseInt</span>(char, <span class="hljs-number">16</span>).<span class="hljs-title function_">toString</span>(<span class="hljs-number">2</span>).<span class="hljs-title function_">padStart</span>(<span class="hljs-number">4</span>, <span class="hljs-string">'0'</span>);
        binaryStr += binary;
    }
    
    <span class="hljs-keyword">return</span> binaryStr;
}
</code></pre>
<h4 data-id="heading-20">六、数值验证与边界处理</h4>
<h5 data-id="heading-21">6.1 数字验证函数</h5>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">isValidNumber</span>(<span class="hljs-params">value</span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">typeof</span> value === <span class="hljs-string">'number'</span> &amp;&amp; !<span class="hljs-built_in">isNaN</span>(value) &amp;&amp; <span class="hljs-built_in">isFinite</span>(value);
}

<span class="hljs-keyword">function</span> <span class="hljs-title function_">isSafeInteger</span>(<span class="hljs-params">value</span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-title class_">Number</span>.<span class="hljs-title function_">isSafeInteger</span>(value);
}

<span class="hljs-keyword">function</span> <span class="hljs-title function_">isPositiveNumber</span>(<span class="hljs-params">value</span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-title function_">isValidNumber</span>(value) &amp;&amp; value &gt; <span class="hljs-number">0</span>;
}
</code></pre>
<h5 data-id="heading-22">6.2 数值范围限制</h5>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">clamp</span>(<span class="hljs-params">value, min, max</span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">min</span>(<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">max</span>(value, min), max);
}

<span class="hljs-keyword">function</span> <span class="hljs-title function_">normalize</span>(<span class="hljs-params">value, min, max</span>) {
    <span class="hljs-keyword">return</span> (value - min) / (max - min);
}
</code></pre>
<h4 data-id="heading-23">七、性能优化与最佳实践</h4>
<h5 data-id="heading-24">7.1 数值运算优化</h5>
<ol>
<li><strong>避免不必要的类型转换:</strong> 尽量减少Number与String之间的转换</li>
<li><strong>使用位运算替代部分数学运算:</strong> 在适当场景下使用</li>
<li><strong>缓存重复计算结果:</strong> 特别是复杂的数学运算</li>
</ol>
<h5 data-id="heading-25">7.2 内存优化</h5>
<ol>
<li>使用TypedArray处理大量数值数据</li>
<li>及时释放不再使用的数值变量</li>
<li>避免创建过多的临时数值对象</li>
</ol>
<h5 data-id="heading-26">7.3 错误处理策略</h5>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">NumberUtils</span> {
    <span class="hljs-keyword">static</span> <span class="hljs-title function_">safeOperation</span>(<span class="hljs-params">operation, defaultValue = <span class="hljs-number">0</span></span>) {
        <span class="hljs-keyword">try</span> {
            <span class="hljs-keyword">const</span> result = <span class="hljs-title function_">operation</span>();
            <span class="hljs-keyword">return</span> <span class="hljs-title function_">isValidNumber</span>(result) ? result : defaultValue;
        } <span class="hljs-keyword">catch</span> (error) {
            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">warn</span>(<span class="hljs-string">'数值运算错误:'</span>, error.<span class="hljs-property">message</span>);
            <span class="hljs-keyword">return</span> defaultValue;
        }
    }
}
</code></pre>
<h4 data-id="heading-27">八、实际应用场景</h4>
<h5 data-id="heading-28">8.1 金融计算</h5>
<ul>
<li>使用decimal.js处理货币计算</li>
<li>固定小数位数展示</li>
<li>四舍五入规则符合会计标准</li>
</ul>
<h5 data-id="heading-29">8.2 科学计算</h5>
<ul>
<li>高精度计算需求</li>
<li>大数处理</li>
<li>误差控制</li>
</ul>
<h5 data-id="heading-30">8.3 游戏开发</h5>
<ul>
<li>伪随机数生成（可重现的随机序列）</li>
<li>物理引擎中的数值计算</li>
<li>性能优化的数学运算</li>
</ul>
<h4 data-id="heading-31">总结</h4>
<p>JavaScript的数学与数字处理能力虽然基础，但深入理解其原理和最佳实践对于开发高质量应用至关重要。关键要点包括：</p>
<ol>
<li><strong>理解JavaScript数字系统的本质:</strong> IEEE 754双精度浮点数的特性决定了数值处理的边界</li>
<li><strong>正确选择工具:</strong> 根据需求选择原生方法、BigInt或第三方库</li>
<li><strong>重视精度问题:</strong> 特别是在金融和科学计算领域</li>
<li><strong>关注安全性:</strong> 在需要加密安全的场景使用Web Crypto API</li>
<li><strong>优化性能:</strong> 合理选择算法和数据结构</li>
</ol>
<p>通过掌握这些核心概念和技术，你可以在实际开发中游刃有余地处理各种数值计算场景，构建更加稳定可靠的JavaScript应用。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[微信小程序代码复用技巧]]></title>    <link>https://juejin.cn/post/7582182817107705882</link>    <guid>https://juejin.cn/post/7582182817107705882</guid>    <pubDate>2025-12-11T06:24:02.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7582182817107705882" data-draft-id="7582118218649403418" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="微信小程序代码复用技巧"/> <meta itemprop="keywords" content="微信小程序,性能优化"/> <meta itemprop="datePublished" content="2025-12-11T06:24:02.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="yogalin1993"/> <meta itemprop="url" content="https://juejin.cn/user/1626932939328311"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            微信小程序代码复用技巧
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1626932939328311/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    yogalin1993
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-11T06:24:02.000Z" title="Thu Dec 11 2025 06:24:02 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-11
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#595959;font-size:15px;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(60,10,30,.04) 3%,transparent 0),linear-gradient(1turn,rgba(60,10,30,.04) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body p{color:#595959;font-size:15px;line-height:2;font-weight:400}.markdown-body p+p{margin-top:16px}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin:0;color:#135ce0}.markdown-body h1{position:relative;text-align:center;font-size:22px;margin:50px 0}.markdown-body h1:before{position:absolute;content:"";top:-10px;left:50%;width:32px;height:32px;transform:translateX(-50%);background-size:100% 100%;opacity:.36;background-repeat:no-repeat;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAABfVBMVEX///8Ad/8AgP8AgP8AgP8Aff8AgP8Af/8AgP8AVf8Af/8Af/8AgP8AgP8Af/8Afv8AAP8Afv8Afv8Aef8AgP8AdP8Afv8AgP8AgP8Acf8Ae/8AgP8Af/8AgP8Af/8Af/8AfP8Afv8AgP8Af/8Af/8Afv8Afv8AgP8Afv8AgP8Af/8Af/8AgP8AgP8Afv8AgP8Af/8AgP8AgP8AgP8Ae/8Afv8Af/8AgP8Af/8AgP8Af/8Af/8Aff8Af/8Abf8AgP8Af/8AgP8Af/8Af/8Afv8AgP8AgP8Afv8Afv8AgP8Af/8Aff8AgP8Afv8AgP8Aff8AgP8AfP8AgP8Ae/8AgP8Af/8AgP8AgP8AgP8Afv8AgP8AgP8AgP8Afv8AgP8AgP8AgP8AgP8AgP8Af/8AgP8Af/8Af/8Aev8Af/8AgP8Aff8Afv8AgP8AgP8AgP8Af/8AgP8Af/8Af/8AgP8Afv8AgP8AgP8AgP8AgP8Af/8AeP8Af/8Af/8Af//////rzEHnAAAAfXRSTlMAD7CCAivatxIDx5EMrP19AXdLEwgLR+6iCR/M0yLRzyFF7JupSXn8cw6v60Q0QeqzKtgeG237HMne850/6Qeq7QaZ+WdydHtj+OM3qENCMRYl1B3K2U7wnlWE/mhlirjkODa9FN/BF7/iNV/2kASNZpX1Wlf03C4stRGxgUPclqoAAAABYktHRACIBR1IAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH4gEaBzgZ4yeM3AAAAT9JREFUOMvNUldbwkAQvCAqsSBoABE7asSOBRUVVBQNNuy9996789+9cMFAMHnVebmdm+/bmdtbQv4dOFOW2UjPzgFyLfo6nweKfIMOBYWwFtmMPGz2Yj2pJI0JDq3udJW6VVbmKa9I192VQFV1ktXUAl5NB0cd4KpnORqsEO2ZIRpF9gJfE9Dckqq0KuZt7UAH5+8EPF3spjsRpCeQNO/tA/qDwIDA+OCQbBoKA8NOdjMySgcZGVM6jwcgRuUiSs0nlPFNSrEpJfU0jTLD6llqbvKxei7OzvkFNQohi0vAsj81+MoqsCaoPOQFgus/1LyxichW+hS2JWCHZ7VlF9jb187pIAYcHiViHAMnp5mTjJ8B5xeEXF4B1ze/fTh/C0h398DDI9HB07O8ci+vRBdvdGnfP4gBuM8vw7X/G3wDmFhFZEdxzjMAAAAldEVYdGRhdGU6Y3JlYXRlADIwMTgtMDEtMjZUMDc6NTY6MjUrMDE6MDA67pVWAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDE4LTAxLTI2VDA3OjU2OjI1KzAxOjAwS7Mt6gAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAAWdEVYdFRpdGxlAGp1ZWppbl9sb2dvIGNvcHlxapmKAAAAV3pUWHRSYXcgcHJvZmlsZSB0eXBlIGlwdGMAAHic4/IMCHFWKCjKT8vMSeVSAAMjCy5jCxMjE0uTFAMTIESANMNkAyOzVCDL2NTIxMzEHMQHy4BIoEouAOoXEXTyQjWVAAAAAElFTkSuQmCC)}.markdown-body h2{position:relative;font-size:20px;border-left:4px solid;padding:0 0 0 10px;margin:30px 0}.markdown-body h3{font-size:16px}.markdown-body ul{list-style:disc outside;margin-left:2em;margin-top:1em}.markdown-body li{line-height:2;color:#595959}.markdown-body img.loaded{margin:0 auto;display:block}.markdown-body blockquote{background:#fff9f9;margin:2em 0;padding:2px 20px;border-left:4px solid #b2aec5}.markdown-body blockquote p{color:#666;line-height:2}.markdown-body a{color:#036aca;border-bottom:1px solid rgba(3,106,202,.8);font-weight:400;text-decoration:none}.markdown-body em strong,.markdown-body strong{color:#036aca}.markdown-body hr{border-top:1px solid #135ce0}.markdown-body pre{overflow:auto}.markdown-body code,.markdown-body pre{overflow:auto;position:relative;line-height:1.75;font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body table{border-collapse:collapse;margin:1rem 0;overflow-x:auto}.markdown-body table td,.markdown-body table th{border:1px solid #dfe2e5;padding:.6em 1em}.markdown-body table tr{border-top:1px solid #dfe2e5}.markdown-body table tr:nth-child(2n){background-color:#f6f8fa}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">1. <strong>自定义组件复用</strong></h2>
<h3 data-id="heading-1">基本组件封装</h3>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// components/common-button/common-button.js</span>
<span class="hljs-title class_">Component</span>({
  <span class="hljs-attr">properties</span>: {
    <span class="hljs-comment">// 定义属性</span>
    <span class="hljs-attr">type</span>: {
      <span class="hljs-attr">type</span>: <span class="hljs-title class_">String</span>,
      <span class="hljs-attr">value</span>: <span class="hljs-string">'primary'</span>  <span class="hljs-comment">// primary/default/danger</span>
    },
    <span class="hljs-attr">text</span>: <span class="hljs-title class_">String</span>,
    <span class="hljs-attr">disabled</span>: <span class="hljs-title class_">Boolean</span>
  },
  <span class="hljs-attr">methods</span>: {
    <span class="hljs-title function_">handleTap</span>(<span class="hljs-params"/>) {
      <span class="hljs-keyword">if</span> (!<span class="hljs-variable language_">this</span>.<span class="hljs-property">data</span>.<span class="hljs-property">disabled</span>) {
        <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">triggerEvent</span>(<span class="hljs-string">'tap'</span>)
      }
    }
  }
})
</code></pre>
<pre><code class="hljs language-html" lang="html"><span class="hljs-comment">&lt;!-- components/common-button/common-button.wxml --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">button</span> 
  <span class="hljs-attr">class</span>=<span class="hljs-string">"common-btn {{type}} {{disabled ? 'disabled' : ''}}"</span>
  <span class="hljs-attr">bindtap</span>=<span class="hljs-string">"handleTap"</span>
&gt;</span>
  {{text}}
<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
</code></pre>
<pre><code class="hljs language-css" lang="css"><span class="hljs-comment">/* components/common-button/common-button.wxss */</span>
<span class="hljs-selector-class">.common-btn</span> {
  <span class="hljs-attribute">padding</span>: <span class="hljs-number">20</span>rpx <span class="hljs-number">40</span>rpx;
  <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">8</span>rpx;
  <span class="hljs-attribute">font-size</span>: <span class="hljs-number">28</span>rpx;
}
<span class="hljs-selector-class">.common-btn</span><span class="hljs-selector-class">.primary</span> {
  <span class="hljs-attribute">background</span>: <span class="hljs-number">#07c160</span>;
  <span class="hljs-attribute">color</span>: <span class="hljs-number">#fff</span>;
}
<span class="hljs-selector-class">.common-btn</span><span class="hljs-selector-class">.disabled</span> {
  <span class="hljs-attribute">opacity</span>: <span class="hljs-number">0.5</span>;
}
</code></pre>
<h3 data-id="heading-2">使用组件</h3>
<pre><code class="hljs language-json" lang="json"><span class="hljs-comment">// 页面.json</span>
<span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"usingComponents"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"common-button"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"/components/common-button/common-button"</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<pre><code class="hljs language-html" lang="html"><span class="hljs-comment">&lt;!-- 页面.wxml --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">common-button</span> 
  <span class="hljs-attr">text</span>=<span class="hljs-string">"提交"</span> 
  <span class="hljs-attr">type</span>=<span class="hljs-string">"primary"</span> 
  <span class="hljs-attr">bindtap</span>=<span class="hljs-string">"onSubmit"</span>
/&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">common-button</span> 
  <span class="hljs-attr">text</span>=<span class="hljs-string">"取消"</span> 
  <span class="hljs-attr">type</span>=<span class="hljs-string">"default"</span> 
  <span class="hljs-attr">bindtap</span>=<span class="hljs-string">"onCancel"</span>
/&gt;</span>
</code></pre>
<h2 data-id="heading-3">2. <strong>Behavior（行为）复用</strong></h2>
<h3 data-id="heading-4">创建公共Behavior</h3>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// behaviors/loading-behavior.js</span>
<span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = <span class="hljs-title class_">Behavior</span>({
  <span class="hljs-attr">data</span>: {
    <span class="hljs-attr">isLoading</span>: <span class="hljs-literal">false</span>
  },
  <span class="hljs-attr">methods</span>: {
    <span class="hljs-comment">// 显示加载</span>
    <span class="hljs-title function_">showLoading</span>(<span class="hljs-params">text = <span class="hljs-string">'加载中...'</span></span>) {
      wx.<span class="hljs-title function_">showLoading</span>({ <span class="hljs-attr">title</span>: text })
      <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">setData</span>({ <span class="hljs-attr">isLoading</span>: <span class="hljs-literal">true</span> })
    },
    
    <span class="hljs-comment">// 隐藏加载</span>
    <span class="hljs-title function_">hideLoading</span>(<span class="hljs-params"/>) {
      wx.<span class="hljs-title function_">hideLoading</span>()
      <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">setData</span>({ <span class="hljs-attr">isLoading</span>: <span class="hljs-literal">false</span> })
    },
    
    <span class="hljs-comment">// 带加载状态的请求</span>
    <span class="hljs-keyword">async</span> <span class="hljs-title function_">requestWithLoading</span>(<span class="hljs-params">options</span>) {
      <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">showLoading</span>()
      <span class="hljs-keyword">try</span> {
        <span class="hljs-keyword">const</span> res = <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">request</span>(options)
        <span class="hljs-keyword">return</span> res
      } <span class="hljs-keyword">finally</span> {
        <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">hideLoading</span>()
      }
    }
  }
})
</code></pre>
<h3 data-id="heading-5">在多个组件中复用</h3>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// components/user-card/user-card.js</span>
<span class="hljs-keyword">const</span> loadingBehavior = <span class="hljs-built_in">require</span>(<span class="hljs-string">'../../behaviors/loading-behavior'</span>)

<span class="hljs-title class_">Component</span>({
  <span class="hljs-attr">behaviors</span>: [loadingBehavior],
  <span class="hljs-attr">methods</span>: {
    <span class="hljs-keyword">async</span> <span class="hljs-title function_">fetchUserInfo</span>(<span class="hljs-params"/>) {
      <span class="hljs-keyword">const</span> data = <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">requestWithLoading</span>({
        <span class="hljs-attr">url</span>: <span class="hljs-string">'/api/user/info'</span>
      })
      <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">setData</span>({ <span class="hljs-attr">userInfo</span>: data })
    }
  }
})
</code></pre>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// components/product-list/product-list.js</span>
<span class="hljs-keyword">const</span> loadingBehavior = <span class="hljs-built_in">require</span>(<span class="hljs-string">'../../behaviors/loading-behavior'</span>)

<span class="hljs-title class_">Component</span>({
  <span class="hljs-attr">behaviors</span>: [loadingBehavior],
  <span class="hljs-attr">methods</span>: {
    <span class="hljs-keyword">async</span> <span class="hljs-title function_">loadProducts</span>(<span class="hljs-params"/>) {
      <span class="hljs-keyword">const</span> products = <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">requestWithLoading</span>({
        <span class="hljs-attr">url</span>: <span class="hljs-string">'/api/products'</span>
      })
      <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">setData</span>({ products })
    }
  }
})
</code></pre>
<h2 data-id="heading-6">3. <strong>Mixins模式实现</strong></h2>
<p>虽然小程序不直接支持Mixins，但可以通过Behavior模拟：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// behaviors/form-behavior.js</span>
<span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = <span class="hljs-title class_">Behavior</span>({
  <span class="hljs-attr">data</span>: {
    <span class="hljs-attr">formData</span>: {},
    <span class="hljs-attr">formErrors</span>: {}
  },
  <span class="hljs-attr">methods</span>: {
    <span class="hljs-comment">// 表单字段变化</span>
    <span class="hljs-title function_">onFormChange</span>(<span class="hljs-params">e</span>) {
      <span class="hljs-keyword">const</span> { field } = e.<span class="hljs-property">currentTarget</span>.<span class="hljs-property">dataset</span>
      <span class="hljs-keyword">const</span> { value } = e.<span class="hljs-property">detail</span>
      
      <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">setData</span>({
        [<span class="hljs-string">`formData.<span class="hljs-subst">${field}</span>`</span>]: value,
        [<span class="hljs-string">`formErrors.<span class="hljs-subst">${field}</span>`</span>]: <span class="hljs-string">''</span>
      })
    },
    
    <span class="hljs-comment">// 表单验证</span>
    <span class="hljs-title function_">validateForm</span>(<span class="hljs-params">rules</span>) {
      <span class="hljs-keyword">const</span> errors = {}
      <span class="hljs-keyword">let</span> isValid = <span class="hljs-literal">true</span>
      
      <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">keys</span>(rules).<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">field</span> =&gt;</span> {
        <span class="hljs-keyword">const</span> value = <span class="hljs-variable language_">this</span>.<span class="hljs-property">data</span>.<span class="hljs-property">formData</span>[field]
        <span class="hljs-keyword">const</span> rule = rules[field]
        
        <span class="hljs-keyword">if</span> (rule.<span class="hljs-property">required</span> &amp;&amp; !value) {
          errors[field] = rule.<span class="hljs-property">message</span> || <span class="hljs-string">'该字段必填'</span>
          isValid = <span class="hljs-literal">false</span>
        }
        <span class="hljs-comment">// 更多验证规则...</span>
      })
      
      <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">setData</span>({ <span class="hljs-attr">formErrors</span>: errors })
      <span class="hljs-keyword">return</span> isValid
    }
  }
})
</code></pre>
<h2 data-id="heading-7">4. <strong>高阶组件模式</strong></h2>
<h3 data-id="heading-8">创建高阶组件工厂</h3>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// utils/with-auth.js</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">withAuth</span>(<span class="hljs-params">Component</span>) {
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">function</span>(<span class="hljs-params">options</span>) {
    <span class="hljs-keyword">const</span> originalOnLoad = options.<span class="hljs-property">methods</span>.<span class="hljs-property">onLoad</span> || <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {}
    
    options.<span class="hljs-property">methods</span>.<span class="hljs-property">onLoad</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params">params</span>) {
      <span class="hljs-comment">// 检查登录状态</span>
      <span class="hljs-keyword">if</span> (!<span class="hljs-variable language_">this</span>.<span class="hljs-title function_">checkAuth</span>()) {
        wx.<span class="hljs-title function_">redirectTo</span>({ <span class="hljs-attr">url</span>: <span class="hljs-string">'/pages/login/login'</span> })
        <span class="hljs-keyword">return</span>
      }
      
      originalOnLoad.<span class="hljs-title function_">call</span>(<span class="hljs-variable language_">this</span>, params)
    }
    
    <span class="hljs-comment">// 添加登录检查方法</span>
    options.<span class="hljs-property">methods</span>.<span class="hljs-property">checkAuth</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
      <span class="hljs-keyword">const</span> token = wx.<span class="hljs-title function_">getStorageSync</span>(<span class="hljs-string">'token'</span>)
      <span class="hljs-keyword">return</span> !!token
    }
    
    <span class="hljs-keyword">return</span> <span class="hljs-title class_">Component</span>(options)
  }
}
</code></pre>
<h3 data-id="heading-9">使用高阶组件</h3>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// pages/user/user.js</span>
<span class="hljs-keyword">import</span> withAuth <span class="hljs-keyword">from</span> <span class="hljs-string">'../../utils/with-auth'</span>

<span class="hljs-keyword">const</span> originalOptions = {
  <span class="hljs-attr">data</span>: { <span class="hljs-attr">userInfo</span>: {} },
  <span class="hljs-attr">methods</span>: {
    <span class="hljs-title function_">onLoad</span>(<span class="hljs-params"/>) {
      <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">loadUserInfo</span>()
    },
    <span class="hljs-title function_">loadUserInfo</span>(<span class="hljs-params"/>) {
      <span class="hljs-comment">// 加载用户信息</span>
    }
  }
}

<span class="hljs-comment">// 包装原始配置</span>
<span class="hljs-title function_">withAuth</span>(<span class="hljs-title class_">Component</span>)(originalOptions)
</code></pre>
<h2 data-id="heading-10">5. <strong>工具函数复用</strong></h2>
<h3 data-id="heading-11">按功能分类的工具函数</h3>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// utils/date-util.js</span>
<span class="hljs-comment">// 日期格式化</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">formatDate</span>(<span class="hljs-params">date, format = <span class="hljs-string">'YYYY-MM-DD'</span></span>) {
  <span class="hljs-keyword">if</span> (!date) <span class="hljs-keyword">return</span> <span class="hljs-string">''</span>
  <span class="hljs-keyword">const</span> d = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>(date)
  <span class="hljs-keyword">const</span> year = d.<span class="hljs-title function_">getFullYear</span>()
  <span class="hljs-keyword">const</span> month = <span class="hljs-title class_">String</span>(d.<span class="hljs-title function_">getMonth</span>() + <span class="hljs-number">1</span>).<span class="hljs-title function_">padStart</span>(<span class="hljs-number">2</span>, <span class="hljs-string">'0'</span>)
  <span class="hljs-keyword">const</span> day = <span class="hljs-title class_">String</span>(d.<span class="hljs-title function_">getDate</span>()).<span class="hljs-title function_">padStart</span>(<span class="hljs-number">2</span>, <span class="hljs-string">'0'</span>)
  
  <span class="hljs-keyword">return</span> format
    .<span class="hljs-title function_">replace</span>(<span class="hljs-string">'YYYY'</span>, year)
    .<span class="hljs-title function_">replace</span>(<span class="hljs-string">'MM'</span>, month)
    .<span class="hljs-title function_">replace</span>(<span class="hljs-string">'DD'</span>, day)
}

<span class="hljs-comment">// 相对时间</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">relativeTime</span>(<span class="hljs-params">date</span>) {
  <span class="hljs-keyword">const</span> now = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>()
  <span class="hljs-keyword">const</span> target = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>(date)
  <span class="hljs-keyword">const</span> diff = now - target
  
  <span class="hljs-keyword">const</span> minutes = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">floor</span>(diff / <span class="hljs-number">60000</span>)
  <span class="hljs-keyword">if</span> (minutes &lt; <span class="hljs-number">60</span>) <span class="hljs-keyword">return</span> <span class="hljs-string">`<span class="hljs-subst">${minutes}</span>分钟前`</span>
  
  <span class="hljs-keyword">const</span> hours = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">floor</span>(minutes / <span class="hljs-number">60</span>)
  <span class="hljs-keyword">if</span> (hours &lt; <span class="hljs-number">24</span>) <span class="hljs-keyword">return</span> <span class="hljs-string">`<span class="hljs-subst">${hours}</span>小时前`</span>
  
  <span class="hljs-keyword">const</span> days = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">floor</span>(hours / <span class="hljs-number">24</span>)
  <span class="hljs-keyword">if</span> (days &lt; <span class="hljs-number">30</span>) <span class="hljs-keyword">return</span> <span class="hljs-string">`<span class="hljs-subst">${days}</span>天前`</span>
  
  <span class="hljs-keyword">return</span> <span class="hljs-title function_">formatDate</span>(date)
}
</code></pre>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// utils/request-util.js</span>
<span class="hljs-comment">// 统一的网络请求</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">request</span>(<span class="hljs-params">options</span>) {
  <span class="hljs-keyword">const</span> token = wx.<span class="hljs-title function_">getStorageSync</span>(<span class="hljs-string">'token'</span>)
  <span class="hljs-keyword">const</span> header = {
    <span class="hljs-string">'Content-Type'</span>: <span class="hljs-string">'application/json'</span>,
    ...options.<span class="hljs-property">header</span>
  }
  
  <span class="hljs-keyword">if</span> (token) {
    header[<span class="hljs-string">'Authorization'</span>] = <span class="hljs-string">`Bearer <span class="hljs-subst">${token}</span>`</span>
  }
  
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> {
    wx.<span class="hljs-title function_">request</span>({
      <span class="hljs-attr">url</span>: <span class="hljs-string">`https://api.example.com<span class="hljs-subst">${options.url}</span>`</span>,
      <span class="hljs-attr">method</span>: options.<span class="hljs-property">method</span> || <span class="hljs-string">'GET'</span>,
      <span class="hljs-attr">data</span>: options.<span class="hljs-property">data</span>,
      header,
      <span class="hljs-attr">success</span>: <span class="hljs-function">(<span class="hljs-params">result</span>) =&gt;</span> {
        <span class="hljs-keyword">if</span> (result.<span class="hljs-property">statusCode</span> === <span class="hljs-number">200</span>) {
          <span class="hljs-title function_">resolve</span>(result.<span class="hljs-property">data</span>)
        } <span class="hljs-keyword">else</span> {
          <span class="hljs-title function_">reject</span>(result.<span class="hljs-property">data</span>)
        }
      },
      <span class="hljs-attr">fail</span>: reject
    })
  })
}
</code></pre>
<h2 data-id="heading-12">6. <strong>组合式复用</strong></h2>
<h3 data-id="heading-13">复杂组件的组合</h3>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// components/smart-form/smart-form.js</span>
<span class="hljs-keyword">const</span> formBehavior = <span class="hljs-built_in">require</span>(<span class="hljs-string">'../../behaviors/form-behavior'</span>)
<span class="hljs-keyword">const</span> validationBehavior = <span class="hljs-built_in">require</span>(<span class="hljs-string">'../../behaviors/validation-behavior'</span>)

<span class="hljs-title class_">Component</span>({
  <span class="hljs-attr">behaviors</span>: [formBehavior, validationBehavior],
  
  <span class="hljs-attr">methods</span>: {
    <span class="hljs-comment">// 继承自formBehavior的onFormChange</span>
    <span class="hljs-comment">// 继承自validationBehavior的validateForm</span>
    
    <span class="hljs-keyword">async</span> <span class="hljs-title function_">onSubmit</span>(<span class="hljs-params"/>) {
      <span class="hljs-keyword">if</span> (!<span class="hljs-variable language_">this</span>.<span class="hljs-title function_">validateForm</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">data</span>.<span class="hljs-property">rules</span>)) {
        <span class="hljs-keyword">return</span>
      }
      
      <span class="hljs-comment">// 提交表单</span>
      <span class="hljs-keyword">const</span> result = <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">submitData</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">data</span>.<span class="hljs-property">formData</span>)
      
      <span class="hljs-keyword">if</span> (result.<span class="hljs-property">success</span>) {
        <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">triggerEvent</span>(<span class="hljs-string">'success'</span>, result.<span class="hljs-property">data</span>)
      }
    }
  }
})
</code></pre>
<h2 data-id="heading-14">7. <strong>模板复用</strong></h2>
<h3 data-id="heading-15">WXML模板</h3>
<pre><code class="hljs language-html" lang="html"><span class="hljs-comment">&lt;!-- templates/empty-state.wxml --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">template</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"emptyState"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">view</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"empty-container"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">image</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"{{icon}}"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"empty-icon"</span> /&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">text</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"empty-text"</span>&gt;</span>{{text}}<span class="hljs-tag">&lt;/<span class="hljs-name">text</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">wx:if</span>=<span class="hljs-string">"{{showButton}}"</span> <span class="hljs-attr">bindtap</span>=<span class="hljs-string">"onButtonTap"</span>&gt;</span>
      {{buttonText}}
    <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">view</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">template</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"loading"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">view</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"loading-container"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">image</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"/images/loading.gif"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"loading-icon"</span> /&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">text</span>&gt;</span>{{text || '加载中...'}}<span class="hljs-tag">&lt;/<span class="hljs-name">text</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">view</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>
</code></pre>
<h3 data-id="heading-16">使用模板</h3>
<pre><code class="hljs language-html" lang="html"><span class="hljs-comment">&lt;!-- 页面.wxml --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">import</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"/templates/empty-state.wxml"</span> /&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">import</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"/templates/loading.wxml"</span> /&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">view</span> <span class="hljs-attr">wx:if</span>=<span class="hljs-string">"{{isLoading}}"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">template</span> <span class="hljs-attr">is</span>=<span class="hljs-string">"loading"</span> <span class="hljs-attr">data</span>=<span class="hljs-string">"{{text: '拼命加载中...'}}"</span> /&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">view</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">view</span> <span class="hljs-attr">wx:elif</span>=<span class="hljs-string">"{{isEmpty}}"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">template</span> 
    <span class="hljs-attr">is</span>=<span class="hljs-string">"emptyState"</span> 
    <span class="hljs-attr">data</span>=<span class="hljs-string">"{{{
      icon: '/images/empty.png',
      text: '暂无数据',
      showButton: true,
      buttonText: '刷新试试'
    }}}"</span> 
  /&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">view</span>&gt;</span>
</code></pre>
<h2 data-id="heading-17">8. <strong>样式复用策略</strong></h2>
<h3 data-id="heading-18">创建样式变量</h3>
<pre><code class="hljs language-css" lang="css"><span class="hljs-comment">/* styles/variables.wxss */</span>
<span class="hljs-selector-pseudo">:root</span> {
  <span class="hljs-attr">--primary-color</span>: <span class="hljs-number">#07c160</span>;
  <span class="hljs-attr">--danger-color</span>: <span class="hljs-number">#fa5151</span>;
  <span class="hljs-attr">--text-color</span>: <span class="hljs-number">#333</span>;
  <span class="hljs-attr">--border-color</span>: <span class="hljs-number">#eee</span>;
  <span class="hljs-attr">--font-size-sm</span>: <span class="hljs-number">24</span>rpx;
  <span class="hljs-attr">--font-size-md</span>: <span class="hljs-number">28</span>rpx;
  <span class="hljs-attr">--font-size-lg</span>: <span class="hljs-number">32</span>rpx;
  <span class="hljs-attr">--border-radius</span>: <span class="hljs-number">8</span>rpx;
}
</code></pre>
<h3 data-id="heading-19">复用样式类</h3>
<pre><code class="hljs language-css" lang="css"><span class="hljs-comment">/* styles/common.wxss */</span>
<span class="hljs-selector-class">.flex-center</span> {
  <span class="hljs-attribute">display</span>: flex;
  <span class="hljs-attribute">align-items</span>: center;
  <span class="hljs-attribute">justify-content</span>: center;
}

<span class="hljs-selector-class">.text-ellipsis</span> {
  <span class="hljs-attribute">overflow</span>: hidden;
  <span class="hljs-attribute">text-overflow</span>: ellipsis;
  <span class="hljs-attribute">white-space</span>: nowrap;
}

<span class="hljs-selector-class">.hairline</span> {
  <span class="hljs-attribute">position</span>: relative;
}
<span class="hljs-selector-class">.hairline</span><span class="hljs-selector-pseudo">::after</span> {
  <span class="hljs-attribute">content</span>: <span class="hljs-string">''</span>;
  <span class="hljs-attribute">position</span>: absolute;
  <span class="hljs-attribute">left</span>: <span class="hljs-number">0</span>;
  <span class="hljs-attribute">right</span>: <span class="hljs-number">0</span>;
  <span class="hljs-attribute">bottom</span>: <span class="hljs-number">0</span>;
  <span class="hljs-attribute">border-bottom</span>: <span class="hljs-number">1</span>rpx solid <span class="hljs-built_in">var</span>(--border-color);
  <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">scaleY</span>(<span class="hljs-number">0.5</span>);
}
</code></pre>
<h3 data-id="heading-20">在页面中引入</h3>
<pre><code class="hljs language-css" lang="css"><span class="hljs-comment">/* 页面.wxss */</span>
<span class="hljs-keyword">@import</span> <span class="hljs-string">"/styles/variables.wxss"</span>;
<span class="hljs-keyword">@import</span> <span class="hljs-string">"/styles/common.wxss"</span>;

<span class="hljs-selector-class">.user-card</span> {
  composes: flex-center;
  <span class="hljs-attribute">padding</span>: <span class="hljs-number">20</span>rpx;
  <span class="hljs-attribute">border-radius</span>: <span class="hljs-built_in">var</span>(--border-radius);
  <span class="hljs-attribute">background</span>: <span class="hljs-number">#fff</span>;
}
</code></pre>
<h2 data-id="heading-21">9. <strong>数据状态复用</strong></h2>
<h3 data-id="heading-22">创建全局状态管理器</h3>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// store/user-store.js</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">UserStore</span> {
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">_listeners</span> = []
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">_userInfo</span> = <span class="hljs-literal">null</span>
  }
  
  <span class="hljs-comment">// 获取用户信息</span>
  <span class="hljs-title function_">getUserInfo</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">if</span> (!<span class="hljs-variable language_">this</span>.<span class="hljs-property">_userInfo</span>) {
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">_userInfo</span> = wx.<span class="hljs-title function_">getStorageSync</span>(<span class="hljs-string">'userInfo'</span>)
    }
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">_userInfo</span>
  }
  
  <span class="hljs-comment">// 更新用户信息</span>
  <span class="hljs-title function_">setUserInfo</span>(<span class="hljs-params">userInfo</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">_userInfo</span> = userInfo
    wx.<span class="hljs-title function_">setStorageSync</span>(<span class="hljs-string">'userInfo'</span>, userInfo)
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_notifyListeners</span>()
  }
  
  <span class="hljs-comment">// 订阅变化</span>
  <span class="hljs-title function_">subscribe</span>(<span class="hljs-params">listener</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">_listeners</span>.<span class="hljs-title function_">push</span>(listener)
    <span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> {
      <span class="hljs-keyword">const</span> index = <span class="hljs-variable language_">this</span>.<span class="hljs-property">_listeners</span>.<span class="hljs-title function_">indexOf</span>(listener)
      <span class="hljs-keyword">if</span> (index &gt; -<span class="hljs-number">1</span>) <span class="hljs-variable language_">this</span>.<span class="hljs-property">_listeners</span>.<span class="hljs-title function_">splice</span>(index, <span class="hljs-number">1</span>)
    }
  }
  
  <span class="hljs-title function_">_notifyListeners</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">_listeners</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">listener</span> =&gt;</span> <span class="hljs-title function_">listener</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">_userInfo</span>))
  }
}

<span class="hljs-comment">// 导出单例</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UserStore</span>()
</code></pre>
<h3 data-id="heading-23">在多个页面中使用</h3>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// pages/profile/profile.js</span>
<span class="hljs-keyword">import</span> userStore <span class="hljs-keyword">from</span> <span class="hljs-string">'../../store/user-store'</span>

<span class="hljs-title class_">Page</span>({
  <span class="hljs-title function_">onLoad</span>(<span class="hljs-params"/>) {
    <span class="hljs-comment">// 获取用户信息</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">setData</span>({ 
      <span class="hljs-attr">userInfo</span>: userStore.<span class="hljs-title function_">getUserInfo</span>() 
    })
    
    <span class="hljs-comment">// 订阅更新</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">unsubscribe</span> = userStore.<span class="hljs-title function_">subscribe</span>(<span class="hljs-function">(<span class="hljs-params">userInfo</span>) =&gt;</span> {
      <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">setData</span>({ userInfo })
    })
  },
  
  <span class="hljs-title function_">onUnload</span>(<span class="hljs-params"/>) {
    <span class="hljs-comment">// 取消订阅</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">unsubscribe</span> &amp;&amp; <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">unsubscribe</span>()
  }
})
</code></pre>
<h2 data-id="heading-24">10. <strong>复用最佳实践</strong></h2>
<h3 data-id="heading-25">1. <strong>按职责分层</strong></h3>
<pre><code class="hljs language-bash" lang="bash">utils/
  ├── date-util.js        <span class="hljs-comment"># 日期处理</span>
  ├── request-util.js     <span class="hljs-comment"># 网络请求</span>
  ├── validate-util.js    <span class="hljs-comment"># 验证工具</span>
  └── storage-util.js     <span class="hljs-comment"># 存储工具</span>

behaviors/
  ├── form-behavior.js
  ├── loading-behavior.js
  └── auth-behavior.js

components/
  ├── common/            <span class="hljs-comment"># 通用组件</span>
  ├── business/          <span class="hljs-comment"># 业务组件</span>
  └── layout/            <span class="hljs-comment"># 布局组件</span>

mixins/                  <span class="hljs-comment"># 混合功能</span>
templates/               <span class="hljs-comment"># 模板文件</span>
styles/                  <span class="hljs-comment"># 样式文件</span>
</code></pre>
<h3 data-id="heading-26">2. <strong>创建配置中心</strong></h3>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-comment">// config/app-config.js</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {
  <span class="hljs-comment">// API配置</span>
  api: {
    baseURL: <span class="hljs-string">'https://api.example.com'</span>,
    timeout: <span class="hljs-number">10000</span>
  },
  
  <span class="hljs-comment">// 页面路径</span>
  pages: {
    login: <span class="hljs-string">'/pages/login/login'</span>,
    home: <span class="hljs-string">'/pages/home/home'</span>
  },
  
  <span class="hljs-comment">// 存储键名</span>
  storageKeys: {
    token: <span class="hljs-string">'user_token'</span>,
    userInfo: <span class="hljs-string">'user_info'</span>
  }
}
</code></pre>
<h3 data-id="heading-27">3. <strong>文档和示例</strong></h3>
<p>为每个复用组件创建示例页面：</p>
<pre><code class="hljs language-css" lang="css">components/common-<span class="hljs-selector-tag">button</span>/
  ├── common-<span class="hljs-selector-tag">button</span><span class="hljs-selector-class">.js</span>
  ├── common-<span class="hljs-selector-tag">button</span><span class="hljs-selector-class">.wxml</span>
  ├── common-<span class="hljs-selector-tag">button</span><span class="hljs-selector-class">.wxss</span>
  └── example/
      ├── example<span class="hljs-selector-class">.js</span>      # 使用示例
      └── example<span class="hljs-selector-class">.wxml</span>
</code></pre>
<h2 data-id="heading-28">复用带来的好处</h2>
<ol>
<li><strong>减少代码量</strong>：避免重复编写相同逻辑</li>
<li><strong>便于维护</strong>：修改只需在一处进行</li>
<li><strong>一致性</strong>：保证功能和行为统一</li>
<li><strong>团队协作</strong>：提供标准化的开发模式</li>
<li><strong>包体积优化</strong>：显著减少重复代码</li>
</ol>
<p>通过合理的代码复用，不仅能减小包体积，还能提升开发效率和代码质量。建议在项目初期就规划好复用策略，建立代码规范。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[React Native 应用保护全链路实践 从 JS Bundle 到 IPA 层混淆的多维度安全方案]]></title>    <link>https://juejin.cn/post/7582152511538479145</link>    <guid>https://juejin.cn/post/7582152511538479145</guid>    <pubDate>2025-12-11T06:23:53.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7582152511538479145" data-draft-id="7582163781183946758" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="React Native 应用保护全链路实践 从 JS Bundle 到 IPA 层混淆的多维度安全方案"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2025-12-11T06:23:53.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="bcbnb"/> <meta itemprop="url" content="https://juejin.cn/user/895474073078377"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            React Native 应用保护全链路实践 从 JS Bundle 到 IPA 层混淆的多维度安全方案
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/895474073078377/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    bcbnb
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-11T06:23:53.000Z" title="Thu Dec 11 2025 06:23:53 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-11
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>React Native（RN）给移动开发带来了极强的跨平台效率，但也带来了一个极其明显的安全短板：</p>
<blockquote>
<p><strong>绝大部分业务逻辑最终都以 JS Bundle 的形式明文存在于 IPA 中。</strong></p>
</blockquote>
<p>这意味着只要攻击者解压 IPA，就能直接看到：</p>
<ul>
<li>业务 JS 代码</li>
<li>常量、字符串、接口路径</li>
<li>配置 JSON</li>
<li>UI 定义</li>
<li>路由逻辑</li>
<li>Redux 状态信息</li>
<li>网络请求封装</li>
<li>加密逻辑实现细节</li>
</ul>
<p>RN 的 bundle 文件是研发效率的利器，但同样也成为攻击者极易利用的突破点。</p>
<p>因此，“React Native 应用保护”不能只停留在 JS 混淆，而要从 <strong>JS → 资源 → 原生层 → IPA 层</strong> 完成整套保护链路。</p>
<p>本文将从 RN 工程结构、逆向者的攻击路径，构建一套真正可工程化、可自动化的 RN 加固体系。</p>
<hr/>
<h2 data-id="heading-0">一、为什么 RN 的安全风险比原生更明显？</h2>
<p>RN 在打包后生成的 iOS 包结构中，通常会有如下文件：</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-tag">main</span><span class="hljs-selector-class">.jsbundle</span>
assets<span class="hljs-comment">/*.png
assets/*.json
index.bundle
runtime.js
</span></code></pre>
<p>这些文件的特点是：</p>
<h3 data-id="heading-1">全明文</h3>
<p>JS 与 JSON 都无需任何工具即可读取。</p>
<h3 data-id="heading-2">包含真实业务逻辑</h3>
<p>例如登录流程、订单逻辑、关键判断等。</p>
<h3 data-id="heading-3">可被替换</h3>
<p>攻击者可以修改 JS 后重新打包。</p>
<h3 data-id="heading-4">Hook 难度低</h3>
<p>RN 程序的业务逻辑位置非常固定，因此动态插桩更容易。</p>
<hr/>
<h2 data-id="heading-5">二、破解 RN 应用的攻击路径（逆向者视角）</h2>
<p>攻击者常见攻击链路如下：</p>
<hr/>
<h3 data-id="heading-6"><strong>① 解压 IPA，读取 JS Bundle</strong></h3>
<p>可直接获得逻辑结构。</p>
<hr/>
<h3 data-id="heading-7"><strong>② 分析 JS Bundle</strong></h3>
<p>攻击者会：</p>
<ul>
<li>搜索关键字</li>
<li>查找接口</li>
<li>跟踪路由</li>
<li>修改逻辑判断</li>
<li>清除风控</li>
<li>删除权限检查</li>
<li>甚至取消广告或订阅限制</li>
</ul>
<hr/>
<h3 data-id="heading-8"><strong>③ 替换资源并重打包</strong></h3>
<p>只需：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-built_in">zip</span> → 重签 → 安装
</code></pre>
<p>简单到令人发指。</p>
<hr/>
<h3 data-id="heading-9"><strong>④ 使用 Frida 等工具 Hook 原生层</strong></h3>
<p>如：</p>
<ul>
<li>拦截 NativeModules</li>
<li>修改网络请求</li>
<li>Hook RN Bridge</li>
<li>劫持 JS 调用链</li>
</ul>
<hr/>
<h2 data-id="heading-10">三、RN 应用保护必须覆盖四个层面</h2>
<ol>
<li><strong>JS Bundle 加固（可读性与结构保护）</strong></li>
<li><strong>资源与路径保护（防替换）</strong></li>
<li><strong>原生层符号混淆（防 Hook）</strong></li>
<li><strong>IPA 层结构扰动（整体防破解）</strong></li>
</ol>
<p>使用单一工具永远无法完成这套体系。</p>
<hr/>
<h2 data-id="heading-11">四、多工具组合：构建可落地的 RN 加固方案</h2>
<p>以下按层级来介绍对应工具的职责。</p>
<hr/>
<h2 data-id="heading-12">第一层：JS Bundle 混淆（前端安全基础层）</h2>
<p>常见工具：</p>
<ul>
<li>javascript-obfuscator</li>
<li>babel-plugin-minify</li>
<li>metro bundle 优化</li>
</ul>
<p>这些工具的作用包括：</p>
<ul>
<li>改变变量名</li>
<li>压缩 JS</li>
<li>减少代码可读性</li>
<li>防止快速定位敏感逻辑</li>
</ul>
<p><strong>但要注意：</strong>
即使混淆了 JS，攻击者仍能替换整个 bundle，因此这层不是终极防护。</p>
<hr/>
<h2 data-id="heading-13">第二层：IPA 层资源防篡改（真正防攻击的关键）</h2>
<p>这是 RN 项目最重要的保护层。</p>
<p><strong>Ipa Guard CLI 适用于这一层，能够保护 RN 的所有资源结构：</strong></p>
<ul>
<li>修改 main.jsbundle 名称</li>
<li>修改资源文件名</li>
<li>路径扰动，使 JS/资源引用不再可预测</li>
<li>修改文件 MD5，使替换无法通过校验</li>
<li>ISA 层符号混淆，保护 NativeModules</li>
<li>支持所有 Hybrid 场景</li>
<li>无需源码，可对任意 RN IPA 加固</li>
</ul>
<p>示例流程：</p>
<hr/>
<h2 data-id="heading-14">Step 1：从 IPA 中解析符号与资源依赖关系</h2>
<pre><code class="hljs language-bash" lang="bash">ipaguard_cli parse app.ipa -o sym.json
</code></pre>
<p>输出会包含：</p>
<ul>
<li>main.jsbundle 路径</li>
<li>assets 中所有资源文件</li>
<li>JS 引用关系</li>
<li>Swift/ObjC 符号</li>
</ul>
<p>非常适合用来制定保护策略。</p>
<hr/>
<h2 data-id="heading-15">Step 2：编辑保护策略（最重要的环节）</h2>
<ul>
<li>保留 RN Bridge 相关类（防止通信失败）</li>
<li>保护所有 jsbundle</li>
<li>修改所有 png/json 名称</li>
<li>开启文件 MD5 防替换</li>
<li>混淆原生层类与调用链（防 Frida Hook）</li>
<li>若应用带 H5，也可开启 JS 混淆</li>
</ul>
<hr/>
<h2 data-id="heading-16">Step 3：执行 IPA 加固操作</h2>
<pre><code class="hljs language-bash" lang="bash">ipaguard_cli protect app.ipa \
   -c sym.json \
   --js \
   --image \
   -o protected.ipa \
   --email dev@team.com
</code></pre>
<p>效果包括：</p>
<ul>
<li>main.jsbundle 改名，攻击者无法定位</li>
<li>json 资源无法替换</li>
<li>png 动态改名 + MD5 改变</li>
<li>原生层符号乱码化</li>
<li>JS 混淆进一步提高阅读难度</li>
<li>资源路径被打散，不再可预测</li>
</ul>
<p>攻击者即便找到 bundle，也无法直接替换文件使 App 正常运行。</p>
<hr/>
<h2 data-id="heading-17">第三层：原生层符号混淆（强烈建议）</h2>
<p>RN 与 NativeModules 深度绑定：</p>
<pre><code class="hljs">RCTBridge
RCTModule
NativeModules.LoginManager
NativeModules.DeviceInfo
</code></pre>
<p>这些原生层符号若不混淆，攻击者可轻松 Hook。</p>
<p>可使用：</p>
<ul>
<li>Ipa Guard CLI（无需源码）</li>
<li>Swift Shield（若项目有 Swift 部分）</li>
<li>Obfuscator-LLVM（源码级，成本高）</li>
</ul>
<p>IPA 层混淆是 RN 项目的最简单、最适配方案。</p>
<hr/>
<h2 data-id="heading-18">第四层：动态调试防护（运行时保护）</h2>
<p>常见对抗：</p>
<ul>
<li>Frida 检测</li>
<li>防双开</li>
<li>完整性校验</li>
<li>防止注入动态库</li>
<li>检测敏感调用链</li>
</ul>
<p>可使用内部代码实现，也可依赖 IPA 层扰动来增加 Hook 难度。</p>
<hr/>
<h2 data-id="heading-19">五、验证保护效果的工程流程</h2>
<p>保护完成后必须通过逆向工具验证：</p>

























<table><thead><tr><th>工具</th><th>用途</th></tr></thead><tbody><tr><td>Hopper</td><td>检查符号是否已混淆</td></tr><tr><td>Frida</td><td>测试是否还能 Hook NativeModules</td></tr><tr><td>文件替换实验</td><td>替换 bundle 或 json 是否仍可运行</td></tr><tr><td>MobSF</td><td>自动检查 ipa 暴露点</td></tr></tbody></table>
<p>若替换 bundle 后应用崩溃或无法加载，即保护成功。</p>
<hr/>
<h2 data-id="heading-20">六、React Native 应用加固的自动化 CI/CD 流程</h2>
<p>可直接落地：</p>
<hr/>
<h2 data-id="heading-21"><strong>① RN 构建生成 IPA（CI）</strong></h2>
<hr/>
<h2 data-id="heading-22"><strong>② 用 Ipa Guard CLI 分析 IPA</strong></h2>
<pre><code class="hljs">ipaguard_cli parse app.ipa -o sym.json
</code></pre>
<hr/>
<h2 data-id="heading-23"><strong>③ 自动生成混淆策略</strong></h2>
<ul>
<li>JS bundle 强保护</li>
<li>资产文件保护</li>
<li>保留 NativeModules 白名单</li>
<li>资源路径扰动</li>
</ul>
<hr/>
<h2 data-id="heading-24"><strong>④ 执行 IPA 层混淆</strong></h2>
<pre><code class="hljs language-css" lang="css">ipaguard_cli protect app<span class="hljs-selector-class">.ipa</span> -c sym<span class="hljs-selector-class">.json</span> <span class="hljs-attr">--js</span> <span class="hljs-attr">--image</span> -o encrypted<span class="hljs-selector-class">.ipa</span>
</code></pre>
<hr/>
<h2 data-id="heading-25"><strong>⑤ 重签名并安装测试</strong></h2>
<p>使用 kxsign：</p>
<pre><code class="hljs language-bash" lang="bash">kxsign sign encrypted.ipa -c cert.p12 -p <span class="hljs-built_in">pwd</span> -m dev.mobileprovision -z signed.ipa -i
</code></pre>
<hr/>
<h2 data-id="heading-26"><strong>⑥ 逆向对抗测试</strong></h2>
<ul>
<li>修改 bundle → 必须失败</li>
<li>Hopper 检查符号乱码</li>
<li>Frida Hook → 入口应难以定位</li>
</ul>
<hr/>
<h2 data-id="heading-27"><strong>⑦ 映射文件与配置治理</strong></h2>
<p>确保可回滚，可排查崩溃。</p>
<hr/>
<h2 data-id="heading-28">RN 保护必须从“资源 + 符号 + IPA 层”同时下手</h2>
<p>最终多工具组合方案如下：</p>
<h2 data-id="heading-29"><strong>JS 层保护</strong></h2>
<p>javascript-obfuscator
bundle 压缩混淆</p>
<h2 data-id="heading-30"><strong>IPA 资源层保护（核心）</strong></h2>
<p><strong>Ipa Guard CLI</strong></p>
<ul>
<li>保护 jsbundle</li>
<li>修改资源 MD5</li>
<li>扰动路径</li>
<li>混淆 Native 层符号</li>
</ul>
<h2 data-id="heading-31"><strong>原生层保护</strong></h2>
<p>Swift Shield（如使用 Swift）、Obfuscator-LLVM（源码级）</p>
<h2 data-id="heading-32"><strong>动态防护层</strong></h2>
<p>Anti-Frida、完整性校验</p>
<h2 data-id="heading-33"><strong>验证层</strong></h2>
<p>Hopper、Frida、MobSF、文件替换实验</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[基于 openFuyao 的 AI 推理加速实战：智能路由与 PD 分离式 KVCache 架构揭秘]]></title>    <link>https://juejin.cn/post/7582169248094797830</link>    <guid>https://juejin.cn/post/7582169248094797830</guid>    <pubDate>2025-12-11T06:25:15.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7582169248094797830" data-draft-id="7582156219060109375" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="基于 openFuyao 的 AI 推理加速实战：智能路由与 PD 分离式 KVCache 架构揭秘"/> <meta itemprop="keywords" content="人工智能"/> <meta itemprop="datePublished" content="2025-12-11T06:25:15.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="是Dream呀"/> <meta itemprop="url" content="https://juejin.cn/user/765678294413181"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            基于 openFuyao 的 AI 推理加速实战：智能路由与 PD 分离式 KVCache 架构揭秘
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/765678294413181/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    是Dream呀
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-11T06:25:15.000Z" title="Thu Dec 11 2025 06:25:15 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-11
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{line-height:1.75;font-family:-apple-system-font,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei UI,Microsoft YaHei,Arial,sans-serif;letter-spacing:2px;background-image:linear-gradient(90deg,rgba(50,0,0,.05) 3%,transparent 0),linear-gradient(1turn,rgba(50,0,0,.05) 3%,transparent 0);background-size:20px 20px;background-position:50%;word-break:break-word;font-weight:400;font-size:15px;overflow-x:hidden;color:#333}.markdown-body h1{font-size:23px;margin-bottom:5px;font-weight:700;padding-left:10px;border-left:5px solid #773098}.markdown-body h2{font-size:19px;font-weight:700;padding-left:10px;border-left:5px solid #916dd5}.markdown-body h3{font-size:17px;font-weight:700;padding-left:10px;border-left:5px solid #d89cf6}.markdown-body h4{font-size:16px}.markdown-body h5{font-size:15px}.markdown-body h6{font-size:14px;margin-top:5px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{display:block;max-width:100%;margin:1em 0;border-radius:6px;box-shadow:2px 4px 7px #999;user-select:none}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{padding:.2em .5em;font-weight:700;font-family:-apple-system-font,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei UI,Microsoft YaHei,Arial,sans-serif;font-size:1em;color:#916dd5;word-break:break-word;overflow-x:auto;background-color:none;border-radius:2px}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{display:block;font-family:-apple-system-font,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei UI,Microsoft YaHei,Arial,sans-serif;font-weight:400;font-size:.9em;padding:16px 12px;margin:0;color:#333;word-break:normal;overflow-x:auto;background:#f8f8f8;scroll-behavior:smooth}.markdown-body a{text-decoration:none;color:#916dd5;font-weight:700;border-bottom:1px solid #916dd5}.markdown-body a:active,.markdown-body a:hover{color:#773098}.markdown-body table{display:inline-block!important;font-size:14px;width:auto;max-width:100%;overflow:auto;border:1px solid #916dd5;border-collapse:collapse}.markdown-body thead{background-color:#916dd5;color:#fff;text-align:left}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px;border:1px solid #916dd5}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #d89cf6;background-color:#f4eeff}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0;line-height:26px}.markdown-body ol,.markdown-body ul{padding-left:28px;list-style-type:circle}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body b,.markdown-body strong{color:#916dd5;font-weight:700}.markdown-body b:before,.markdown-body strong:before{content:"「"}.markdown-body b:after,.markdown-body strong:after{content:"」"}.markdown-body em,.markdown-body i{color:#916dd5}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="github-gist">.markdown-body pre,.markdown-body pre&gt;code.hljs{background:#fff;color:#333}.hljs-comment,.hljs-meta{color:#969896}.hljs-emphasis,.hljs-quote,.hljs-strong,.hljs-template-variable,.hljs-variable{color:#df5000}.hljs-keyword,.hljs-selector-tag,.hljs-type{color:#d73a49}.hljs-attribute,.hljs-bullet,.hljs-literal,.hljs-symbol{color:#0086b3}.hljs-name,.hljs-section{color:#63a35c}.hljs-tag{color:#333}.hljs-attr,.hljs-selector-attr,.hljs-selector-class,.hljs-selector-id,.hljs-selector-pseudo,.hljs-title{color:#6f42c1}.hljs-addition{color:#55a532;background-color:#eaffea}.hljs-deletion{color:#bd2c00;background-color:#ffecec}.hljs-link{text-decoration:underline}.hljs-number{color:#005cc5}.hljs-string{color:#032f62}</style><h2 data-id="heading-0">一、背景：AI 推理的算力挑战</h2>
<p>随着大模型与多模态 AI 应用的快速落地，推理阶段的算力需求呈现爆炸式增长。传统推理系统在面对复杂算力调度、缓存失配、数据热点等问题时，往往存在<strong>资源利用率低、推理延迟高</strong>等瓶颈。</p>
<p>为此，openFuyao 社区推出了面向 AI 推理场景的<strong>算力释放创新组件</strong>，其中“<strong>智能路由</strong>”与“<strong>PD 分离式分布式 KVCache</strong>”架构成为关键突破。该方案在保持系统轻量化的同时，实现了推理性能的显著提升，助力开发者快速构建高效、稳定的推理服务。</p>
<p>openFuyao平台解决方案支持在如下操作系统与架构上进行安装与使用：</p>






























<table><thead><tr><th>操作系统</th><th>版本</th><th>架构</th></tr></thead><tbody><tr><td>openEuler</td><td>20.03</td><td>ARM64、x86_64</td></tr><tr><td>openEuler</td><td>22.03</td><td>ARM64、x86_64</td></tr><tr><td>openEuler</td><td>24.03</td><td>ARM64、x86_64</td></tr><tr><td>Ubuntu</td><td>22.04</td><td>ARM64、x86_64</td></tr></tbody></table>
<hr/>
<h2 data-id="heading-1">二、技术亮点：智能路由与 PD 分离的协同加速</h2>
<h3 data-id="heading-2">1. 智能路由（Intelligent Routing）</h3>
<p>openFuyao 的智能路由组件通过实时监控节点算力使用情况（CPU、GPU/NPU、内存、带宽等），自动为每次推理请求选择最优节点。<br/>
该机制有效避免了节点负载不均、热点集群拥塞等问题，实现了<strong>推理任务在多节点间的动态最优分配</strong>。</p>
<p>其核心机制包括：</p>
<ul>
<li><strong>实时节点特征采集与健康度评估</strong></li>
<li><strong>基于权重的动态节点调度算法</strong></li>
<li><strong>多级容灾与优先级控制</strong></li>
</ul>
<blockquote>
<p>智能路由的目标是让推理请求“走最优路径”，最大限度减少等待和网络开销。</p>
</blockquote>
<h3 data-id="heading-3">2. PD 分离分布式 KVCache（Parameter-Data Separation）</h3>
<p>传统推理场景下，KVCache（键值缓存）往往与推理引擎绑定部署，易导致数据耦合、缓存命中率低。<br/>
openFuyao 采用了 <strong>PD（Parameter/Data）分离架构</strong>，将参数存储与数据存储解耦，通过统一的分布式 KVCache 提供高性能缓存访问。</p>
<p>该机制带来了三大优势：</p>
<ul>
<li><strong>高命中率</strong>：同模型多实例共享缓存，显著减少重复加载。</li>
<li><strong>可扩展性</strong>：缓存节点可独立扩缩容，适配不同推理负载。</li>
<li><strong>一致性保障</strong>：分布式同步机制确保多节点读取一致。</li>
</ul>
<p><strong>PD分离模式AI推理集成部署图</strong></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f24183ba8c334591931e5e54ed8a0fe7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pivRHJlYW3lkYA=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766039115&amp;x-signature=xJ%2F%2BralPELc8okx4aV4kciOAygQ%3D" alt="" loading="lazy"/></p>
<ul>
<li><strong>hermes-router</strong>：智能路由模块。负责接收用户请求并根据路由策略转发到最优的推理后端服务。</li>
<li><strong>cache-indexer</strong>：KV Cache全局管理器，为路由决策提供数据支持。</li>
<li><strong>Inference Backend</strong>：推理后端模块，基于vLLM提供高性能大模型推理服务，由1个Proxy Server Service，1个Proxy Server实例，n个vLLM Prefill推理引擎实例和n个vLLM Decode推理引擎实例组成。</li>
<li><strong>Proxy Server Service</strong>：推理后端服务的流量入口。</li>
<li><strong>Proxy Server</strong>：二层路由转发组件。负责每个推理后端服务内的负载均衡路由。</li>
<li><strong>vLLM</strong>：vLLM推理引擎实例。</li>
<li><strong>Mooncake Connector</strong>：负责PD实例之间的KV Cache P2P高速传输。</li>
</ul>
<hr/>
<h2 data-id="heading-4">三、部署实战：一分钟启动高性能推理服务</h2>
<p>借助 openFuyao 的“算力释放创新组件”，开发者可快速构建一套分布式推理环境。以下为简化示例流程：</p>
<p><strong>准备部署文件</strong></p>
<pre><code class="hljs language-bash" lang="bash">kubectl apply -f inference-deployment.yaml
</code></pre>
<p><strong>查看推理 Pod 状态</strong></p>
<pre><code class="hljs language-bash" lang="bash">kubectl get pods -n openfuyao
<span class="hljs-comment"># 输出：</span>
<span class="hljs-comment"># inference-pod-1   Running</span>
<span class="hljs-comment"># inference-pod-2   Running</span>
</code></pre>
<p><strong>通过 openFuyao 控制台查看任务运行状态</strong><br/>
新建监控组件。可在 Dashboard 页面直观查看推理服务负载、节点利用率及任务分布情况。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e6093dd43dc34f978947ea17918b93f2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pivRHJlYW3lkYA=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766039115&amp;x-signature=FYyngbWBP81vNny7JvN0neLdV3k%3D" alt="" loading="lazy"/></p>
<hr/>
<h2 data-id="heading-5">四、性能对比：延迟下降，算力利用率提升</h2>
<p>在实际测试中，使用智能路由 + PD 分离式 KVCache 后，openFuyao 推理集群的性能提升显著。</p>





























<table><thead><tr><th>指标</th><th>优化前</th><th>优化后</th><th>提升比例</th></tr></thead><tbody><tr><td>平均推理延迟(ms)</td><td>120</td><td>85</td><td>↓ 29.1%</td></tr><tr><td>吞吐量(QPS)</td><td>200</td><td>320</td><td>↑ 60%</td></tr><tr><td>GPU 利用率</td><td>65%</td><td>91%</td><td>↑ 26%</td></tr></tbody></table>
<blockquote>
<p>实验环境：4×NVIDIA A100，openFuyao 24.09 集群版本，模型为 7B Qwen 推理场景。</p>
</blockquote>
<p><strong>性能对比图</strong></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b98df063529e44fbaaed59e37f221cf9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pivRHJlYW3lkYA=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766039115&amp;x-signature=59mQQslA0%2B9BLMw1C%2FglT6HJuQk%3D" alt="" loading="lazy"/></p>
<p>通过对比可见，openFuyao 在引入智能路由与 PD 分离式 KVCache 架构后，整体推理吞吐量（QPS）获得显著提升。随着模型规模的扩大，优化效果愈发明显。例如，在 Qwen-14B 模型上，系统吞吐量由 50 QPS 提升至 110 QPS，增幅超过 100%。这主要得益于智能路由机制对计算节点的动态负载分配，以及 PD 分离架构下 KVCache 的分布式高效访问，从而显著提高了算力资源利用率与推理并发性能。</p>
<p>性能提升主要来源于：</p>
<ul>
<li><strong>智能路由降低请求调度延迟</strong>；</li>
<li><strong>PD 分离式 KVCache 提升缓存复用率</strong>；</li>
<li><strong>集群负载自动均衡</strong>，减少节点空转。</li>
</ul>
<p><strong>延迟对比图</strong></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/19030935f70543efb2dfe71d5157fbf3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pivRHJlYW3lkYA=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766039115&amp;x-signature=wzxcNGMhUhTNJXlk3GRUrBZphhQ%3D" alt="" loading="lazy"/></p>
<p>由上图可见，经过 PD 分离与智能路由的优化后，openFuyao 在多规模 Qwen 模型上的推理延迟显著下降。例如，在 Qwen-14B 模型上，平均延迟由 130ms 降至 88ms，整体性能提升约 32%。这得益于系统在路由调度与 KVCache 分布式访问策略上的协同优化。</p>
<hr/>
<h2 data-id="heading-6">五、结果验证：推理服务高效稳定运行</h2>
<p>通过 openFuyao CLI 或 RESTful API 发起推理请求：</p>
<pre><code class="hljs language-bash" lang="bash">curl http://127.0.0.1:8080/infer -d <span class="hljs-string">'{"input":"你好，世界"}'</span>
<span class="hljs-comment"># 输出：</span>
<span class="hljs-comment"># {"result":"Hello, world!", "latency":84.3}</span>
</code></pre>
<p>在日志中可看到：</p>
<pre><code class="hljs language-bash" lang="bash">[INFO] Intelligent routing selected node: gpu-node-3
[INFO] KVCache hit rate: 92.7%
[INFO] Inference completed <span class="hljs-keyword">in</span> 84.3 ms
</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/34a93659114841148c15f8fb283668cd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pivRHJlYW3lkYA=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766039115&amp;x-signature=ZH3WCJtlXIRWqIo910VAqGMFNGE%3D" alt="" loading="lazy"/></p>
<p>这验证了 openFuyao 推理加速组件的有效性：<br/>
推理延迟显著降低，缓存命中率持续维持在 90% 以上，集群调度稳定可靠。</p>
<hr/>
<h2 data-id="heading-7">六、总结与展望</h2>
<p>总的来说，openFuyao 社区通过“智能路由 + PD 分离式 KVCache”架构，构建了一个<strong>高效、弹性、智能</strong>的 AI 推理加速方案。<br/>
该方案不仅显著提升了算力利用率与推理性能，还为开发者提供了<strong>即插即用的轻量化部署体验</strong>。</p>
<p>期待未来，openFuyao 继续完善 AI 推理生态，与更多硬件厂商、AI 框架、模型社区协同合作，为开发者带来更开放、更智能的算力释放平台。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9fa5070c827a4d17838c1301fba7bb07~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pivRHJlYW3lkYA=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766039115&amp;x-signature=uXlLZQQ9sFqxVZzDPnqrjrxbxpQ%3D" alt="" loading="lazy"/></p>
<p>📎 <strong>参考链接</strong></p>
<ul>
<li>openFuyao 官网：<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.openfuyao.cn%2Fzh%2F" target="_blank" title="https://www.openfuyao.cn/zh/" ref="nofollow noopener noreferrer">www.openfuyao.cn/zh/</a></li>
<li>官方文档中心：<a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.openfuyao.cn%2Fdocs%2F%25E5%25BF%25AB%25E9%2580%259F%25E5%2585%25A5%25E9%2597%25A8%2F" target="_blank" title="https://docs.openfuyao.cn/docs/%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8/" ref="nofollow noopener noreferrer">docs.openfuyao.cn/docs/快速入门/</a></li>
<li>部分图片来源：<a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.openfuyao.cn%2Fdocs%2F%25E5%258F%2591%25E8%25A1%258C%25E8%25AF%25B4%25E6%2598%258E%2F%25E7%25AE%2580%25E4%25BB%258B" target="_blank" title="https://docs.openfuyao.cn/docs/%E5%8F%91%E8%A1%8C%E8%AF%B4%E6%98%8E/%E7%AE%80%E4%BB%8B" ref="nofollow noopener noreferrer">简介 | openFuyao文档</a></li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Tailwind CSS 入门介绍]]></title>    <link>https://juejin.cn/post/7582246395986395170</link>    <guid>https://juejin.cn/post/7582246395986395170</guid>    <pubDate>2025-12-11T06:35:00.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7582246395986395170" data-draft-id="7582096212663812096" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Tailwind CSS 入门介绍"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2025-12-11T06:35:00.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="三年三月"/> <meta itemprop="url" content="https://juejin.cn/user/694547078186440"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Tailwind CSS 入门介绍
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/694547078186440/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    三年三月
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-11T06:35:00.000Z" title="Thu Dec 11 2025 06:35:00 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-11
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#595959;font-size:15px;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(60,10,30,.04) 3%,transparent 0),linear-gradient(1turn,rgba(60,10,30,.04) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body p{color:#595959;font-size:15px;line-height:2;font-weight:400}.markdown-body p+p{margin-top:16px}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin:0;color:#135ce0}.markdown-body h1{position:relative;text-align:center;font-size:22px;margin:50px 0}.markdown-body h1:before{position:absolute;content:"";top:-10px;left:50%;width:32px;height:32px;transform:translateX(-50%);background-size:100% 100%;opacity:.36;background-repeat:no-repeat;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAABfVBMVEX///8Ad/8AgP8AgP8AgP8Aff8AgP8Af/8AgP8AVf8Af/8Af/8AgP8AgP8Af/8Afv8AAP8Afv8Afv8Aef8AgP8AdP8Afv8AgP8AgP8Acf8Ae/8AgP8Af/8AgP8Af/8Af/8AfP8Afv8AgP8Af/8Af/8Afv8Afv8AgP8Afv8AgP8Af/8Af/8AgP8AgP8Afv8AgP8Af/8AgP8AgP8AgP8Ae/8Afv8Af/8AgP8Af/8AgP8Af/8Af/8Aff8Af/8Abf8AgP8Af/8AgP8Af/8Af/8Afv8AgP8AgP8Afv8Afv8AgP8Af/8Aff8AgP8Afv8AgP8Aff8AgP8AfP8AgP8Ae/8AgP8Af/8AgP8AgP8AgP8Afv8AgP8AgP8AgP8Afv8AgP8AgP8AgP8AgP8AgP8Af/8AgP8Af/8Af/8Aev8Af/8AgP8Aff8Afv8AgP8AgP8AgP8Af/8AgP8Af/8Af/8AgP8Afv8AgP8AgP8AgP8AgP8Af/8AeP8Af/8Af/8Af//////rzEHnAAAAfXRSTlMAD7CCAivatxIDx5EMrP19AXdLEwgLR+6iCR/M0yLRzyFF7JupSXn8cw6v60Q0QeqzKtgeG237HMne850/6Qeq7QaZ+WdydHtj+OM3qENCMRYl1B3K2U7wnlWE/mhlirjkODa9FN/BF7/iNV/2kASNZpX1Wlf03C4stRGxgUPclqoAAAABYktHRACIBR1IAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH4gEaBzgZ4yeM3AAAAT9JREFUOMvNUldbwkAQvCAqsSBoABE7asSOBRUVVBQNNuy9996789+9cMFAMHnVebmdm+/bmdtbQv4dOFOW2UjPzgFyLfo6nweKfIMOBYWwFtmMPGz2Yj2pJI0JDq3udJW6VVbmKa9I192VQFV1ktXUAl5NB0cd4KpnORqsEO2ZIRpF9gJfE9Dckqq0KuZt7UAH5+8EPF3spjsRpCeQNO/tA/qDwIDA+OCQbBoKA8NOdjMySgcZGVM6jwcgRuUiSs0nlPFNSrEpJfU0jTLD6llqbvKxei7OzvkFNQohi0vAsj81+MoqsCaoPOQFgus/1LyxichW+hS2JWCHZ7VlF9jb187pIAYcHiViHAMnp5mTjJ8B5xeEXF4B1ze/fTh/C0h398DDI9HB07O8ci+vRBdvdGnfP4gBuM8vw7X/G3wDmFhFZEdxzjMAAAAldEVYdGRhdGU6Y3JlYXRlADIwMTgtMDEtMjZUMDc6NTY6MjUrMDE6MDA67pVWAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDE4LTAxLTI2VDA3OjU2OjI1KzAxOjAwS7Mt6gAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAAWdEVYdFRpdGxlAGp1ZWppbl9sb2dvIGNvcHlxapmKAAAAV3pUWHRSYXcgcHJvZmlsZSB0eXBlIGlwdGMAAHic4/IMCHFWKCjKT8vMSeVSAAMjCy5jCxMjE0uTFAMTIESANMNkAyOzVCDL2NTIxMzEHMQHy4BIoEouAOoXEXTyQjWVAAAAAElFTkSuQmCC)}.markdown-body h2{position:relative;font-size:20px;border-left:4px solid;padding:0 0 0 10px;margin:30px 0}.markdown-body h3{font-size:16px}.markdown-body ul{list-style:disc outside;margin-left:2em;margin-top:1em}.markdown-body li{line-height:2;color:#595959}.markdown-body img.loaded{margin:0 auto;display:block}.markdown-body blockquote{background:#fff9f9;margin:2em 0;padding:2px 20px;border-left:4px solid #b2aec5}.markdown-body blockquote p{color:#666;line-height:2}.markdown-body a{color:#036aca;border-bottom:1px solid rgba(3,106,202,.8);font-weight:400;text-decoration:none}.markdown-body em strong,.markdown-body strong{color:#036aca}.markdown-body hr{border-top:1px solid #135ce0}.markdown-body pre{overflow:auto}.markdown-body code,.markdown-body pre{overflow:auto;position:relative;line-height:1.75;font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body table{border-collapse:collapse;margin:1rem 0;overflow-x:auto}.markdown-body table td,.markdown-body table th{border:1px solid #dfe2e5;padding:.6em 1em}.markdown-body table tr{border-top:1px solid #dfe2e5}.markdown-body table tr:nth-child(2n){background-color:#f6f8fa}</style><style data-highlight="" data-highlight-key="agate">.markdown-body pre,.markdown-body pre&gt;code.hljs{background:#333;color:#fff}.hljs-name,.hljs-strong{font-weight:700}.hljs-code,.hljs-emphasis{font-style:italic}.hljs-tag{color:#62c8f3}.hljs-selector-class,.hljs-selector-id,.hljs-template-variable,.hljs-variable{color:#ade5fc}.hljs-bullet,.hljs-string{color:#a2fca2}.hljs-attribute,.hljs-built_in,.hljs-builtin-name,.hljs-quote,.hljs-section,.hljs-title,.hljs-type{color:#ffa}.hljs-bullet,.hljs-number,.hljs-symbol{color:#d36363}.hljs-keyword,.hljs-literal,.hljs-selector-tag{color:#fcc28c}.hljs-code,.hljs-comment,.hljs-deletion{color:#888}.hljs-link,.hljs-regexp{color:#c6b4f0}.hljs-meta{color:#fc9b9b}.hljs-deletion{background-color:#fc9b9b;color:#333}.hljs-addition{background-color:#a2fca2;color:#333}.hljs a{color:inherit}.hljs a:focus,.hljs a:hover{color:inherit;text-decoration:underline}</style><h2 data-id="heading-0">Tailwind CSS 入门介绍</h2>
<h3 data-id="heading-1">1. Tailwind 是什么</h3>
<p>Tailwind CSS 是一个基于原子化 CSS（Atomic CSS）思想的实用优先（Utility-First）CSS 框架。与传统的 CSS 框架不同，Tailwind 不提供预定义的组件（如按钮、卡片等），而是提供了一系列底层的实用工具类（Utility Classes），让开发者可以直接在 HTML 中快速构建自定义界面。</p>
<h4 data-id="heading-2">与传统 CSS 的对比</h4>
<h5 data-id="heading-3">传统 CSS 方式</h5>
<pre><code class="hljs language-html" lang="html"><span class="hljs-comment">&lt;!-- HTML --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"btn-primary"</span>&gt;</span>提交<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>

<span class="hljs-comment">&lt;!-- CSS --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span><span class="css">
<span class="hljs-selector-class">.btn-primary</span> {
  <span class="hljs-attribute">background-color</span>: <span class="hljs-number">#3b82f6</span>;
  <span class="hljs-attribute">color</span>: white;
  <span class="hljs-attribute">padding</span>: <span class="hljs-number">0.5rem</span> <span class="hljs-number">1rem</span>;
  <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">0.25rem</span>;
  <span class="hljs-attribute">font-weight</span>: <span class="hljs-number">600</span>;
  <span class="hljs-attribute">transition</span>: background-color <span class="hljs-number">0.2s</span>;
}

<span class="hljs-selector-class">.btn-primary</span><span class="hljs-selector-pseudo">:hover</span> {
  <span class="hljs-attribute">background-color</span>: <span class="hljs-number">#2563eb</span>;
}
</span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>
</code></pre>
<h5 data-id="heading-4">Tailwind CSS 方式</h5>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"bg-blue-500 text-white py-2 px-4 rounded font-semibold hover:bg-blue-600 transition-colors"</span>&gt;</span>
  提交
<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
</code></pre>
<h5 data-id="heading-5">项目中的实际示例</h5>
<p>在项目的 <code>src/App.js</code> 文件中，可以看到 Tailwind 的实际使用：</p>
<pre><code class="hljs language-jsx" lang="jsx">div className=<span class="hljs-string">'text-base p-1 text-[14px] hover:text-[32px] border border-black border-solid'</span>&gt;test&lt;/div&gt;
</code></pre>
<h3 data-id="heading-6">2. Tailwind 官方地址</h3>
<ul>
<li>官方英文文档：<a href="https://link.juejin.cn?target=https%3A%2F%2Ftailwindcss.com%2F" target="_blank" title="https://tailwindcss.com/" ref="nofollow noopener noreferrer">tailwindcss.com/</a></li>
<li>官方中文文档：<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.tailwindcss.cn%2F" target="_blank" title="https://www.tailwindcss.cn/" ref="nofollow noopener noreferrer">www.tailwindcss.cn/</a></li>
</ul>
<h3 data-id="heading-7">3. Tailwind 的优势</h3>
<h4 data-id="heading-8">3.1 快速开发</h4>
<p>使用预定义的工具类可以快速构建界面，无需频繁切换 HTML 和 CSS 文件。</p>
<pre><code class="hljs language-jsx" lang="jsx"><span class="hljs-comment">// 快速创建一个响应式卡片</span>
&lt;div <span class="hljs-keyword">class</span>=<span class="hljs-string">"bg-white rounded-lg shadow-md p-6 md:p-8"</span>&gt;
  <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">h3</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"text-xl font-bold mb-2"</span>&gt;</span>卡片标题<span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span></span>
  <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"text-gray-600"</span>&gt;</span>卡片内容<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span></span>
&lt;/div&gt;
</code></pre>
<h4 data-id="heading-9">3.2 高度可定制</h4>
<p>通过 <code>tailwind.config.js</code> 可以轻松定制主题、颜色、间距等。</p>
<p>项目中的 <code>tailwind.config.js</code> 示例：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = {
  <span class="hljs-comment">// prefix: 'yuan-', // 可以添加自定义前缀</span>
  <span class="hljs-attr">content</span>: [
    <span class="hljs-string">"./src/**/*.{js,jsx}"</span>,
  ],
  <span class="hljs-attr">theme</span>: {
    <span class="hljs-attr">extend</span>: {
      <span class="hljs-attr">padding</span>: {
        <span class="hljs-string">'1'</span> : <span class="hljs-string">'30px'</span>
      },
      <span class="hljs-comment">// 可以扩展主题配置</span>
    },
    <span class="hljs-attr">screens</span>: {
      <span class="hljs-string">'md'</span>: <span class="hljs-string">'300px'</span> <span class="hljs-comment">// 自定义断点</span>
    }
  },
  <span class="hljs-attr">plugins</span>: [
    <span class="hljs-built_in">require</span>(<span class="hljs-string">'./yuan.plugin'</span>) <span class="hljs-comment">// 引入自定义插件</span>
  ],
}
</code></pre>
<h4 data-id="heading-10">3.3 响应式设计简单</h4>
<p>使用 <code>sm:</code>, <code>md:</code>, <code>lg:</code>, <code>xl:</code> 等前缀可以轻松实现响应式设计。</p>
<pre><code class="hljs language-jsx" lang="jsx">&lt;div <span class="hljs-keyword">class</span>=<span class="hljs-string">"w-full md:w-1/2 lg:w-1/3"</span>&gt;
  &lt;!-- 移动端占满宽，平板占一半，桌面占三分之一 --&gt;
&lt;/div&gt;
</code></pre>
<h4 data-id="heading-11">3.4 减少 CSS 文件体积</h4>
<p>Tailwind 会自动移除未使用的样式，最终生成的 CSS 文件体积很小。</p>
<h4 data-id="heading-12">3.5 自定义插件支持</h4>
<p>可以通过插件扩展 Tailwind 的功能。</p>
<p>项目中的自定义插件 <code>yuan.plugin.js</code> 示例：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> plugin = <span class="hljs-built_in">require</span>(<span class="hljs-string">'tailwindcss/plugin'</span>);

<span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = <span class="hljs-title function_">plugin</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params">{ addUtilities }</span>) {
    <span class="hljs-title function_">addUtilities</span>({
        <span class="hljs-string">'.aaa'</span>: {
            <span class="hljs-attr">background</span>: <span class="hljs-string">'blue'</span>,
            <span class="hljs-attr">color</span>: <span class="hljs-string">'yellow'</span>
        },
        <span class="hljs-string">'.bbb'</span>: {
            <span class="hljs-string">'font-size'</span>: <span class="hljs-string">'70px'</span>
        }
    })
})
</code></pre>
<h3 data-id="heading-13">4. Tailwind 的缺点</h3>
<h4 data-id="heading-14">4.1 学习曲线</h4>
<p>需要记忆大量的工具类名称，初期学习成本较高。</p>
<pre><code class="hljs language-jsx" lang="jsx"><span class="hljs-comment">// 类名较长，需要记忆</span>
&lt;div <span class="hljs-keyword">class</span>=<span class="hljs-string">"flex items-center justify-between p-4 bg-white rounded-lg shadow-md hover:shadow-lg transition-shadow"</span>&gt;
  &lt;!-- 内容 --&gt;
&lt;/div&gt;
</code></pre>
<h4 data-id="heading-15">4.2 HTML 代码冗长</h4>
<p>过多的类名会导致 HTML 代码变得冗长，影响可读性。</p>
<p>项目中的示例：</p>
<pre><code class="hljs language-jsx" lang="jsx">div className=<span class="hljs-string">'text-base p-1 text-[14px] hover:text-[32px] border border-black border-solid'</span>&gt;yuan&lt;/div&gt;
</code></pre>
<h4 data-id="heading-16">4.3 调试困难</h4>
<p>在浏览器开发者工具中查看元素样式时，会看到很多 Tailwind 类名，不如传统 CSS 类名直观。</p>
<h4 data-id="heading-17">4.4 过度依赖工具类</h4>
<p>可能会导致开发者过度依赖工具类，而忽略了 CSS 的基本原理。</p>
<h3 data-id="heading-18">5. Tailwind 的功能模块及 API 介绍</h3>
<h4 data-id="heading-19">5.1 核心指令</h4>
<p>在项目的 <code>src/App.css</code> 中可以看到这三个核心指令：</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-keyword">@tailwind</span> base;
<span class="hljs-keyword">@tailwind</span> components;
<span class="hljs-keyword">@tailwind</span> utilities;
</code></pre>
<ul>
<li><code>@tailwind base</code>：引入基础样式，包括浏览器重置样式（Preflight）和一些基础元素样式</li>
<li><code>@tailwind components</code>：引入组件样式，用于定义可复用的组件类</li>
<li><code>@tailwind utilities</code>：引入核心的工具类</li>
</ul>
<h4 data-id="heading-20">5.2 布局类</h4>
<h5 data-id="heading-21">容器与边框</h5>
<ul>
<li><code>container</code>：创建响应式容器</li>
<li><code>border</code>：添加边框</li>
<li><code>rounded</code>：添加圆角</li>
<li><code>shadow</code>：添加阴影</li>
</ul>
<p>示例：</p>
<pre><code class="hljs language-jsx" lang="jsx">div className=<span class="hljs-string">'border border-black border-solid'</span>&gt;yuan&lt;/div&gt;
</code></pre>
<h5 data-id="heading-22">弹性布局与网格布局</h5>
<ul>
<li><code>flex</code>：启用弹性布局</li>
<li><code>grid</code>：启用网格布局</li>
<li><code>flex-col</code>：设置弹性方向为垂直</li>
<li><code>items-center</code>：垂直居中对齐</li>
<li><code>justify-between</code>：两端对齐</li>
</ul>
<p>示例：</p>
<pre><code class="hljs language-jsx" lang="jsx">&lt;div <span class="hljs-keyword">class</span>=<span class="hljs-string">"flex items-center justify-between"</span>&gt;
  <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>左侧内容<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>右侧内容<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
&lt;/div&gt;
</code></pre>
<h4 data-id="heading-23">5.3 间距类</h4>
<ul>
<li><code>p-{size}</code>：内边距</li>
<li><code>m-{size}</code>：外边距</li>
<li><code>px-{size}</code>：水平内边距</li>
<li><code>py-{size}</code>：垂直内边距</li>
</ul>
<p>项目中可以通过配置自定义间距：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-attr">theme</span>: {
  <span class="hljs-attr">extend</span>: {
    <span class="hljs-attr">padding</span>: {
      <span class="hljs-string">'1'</span> : <span class="hljs-string">'30px'</span> <span class="hljs-comment">// 自定义 p-1 为 30px</span>
    }
  }
}
</code></pre>
<h4 data-id="heading-24">5.4 排版类</h4>
<ul>
<li><code>text-{size}</code>：字体大小</li>
<li><code>font-{weight}</code>：字重</li>
<li><code>text-{color}</code>：文字颜色</li>
<li><code>text-center</code>：文字居中</li>
</ul>
<p>项目中可以自定义字体大小：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-attr">theme</span>: {
  <span class="hljs-attr">extend</span>: {
    <span class="hljs-attr">fontSize</span>: {
      <span class="hljs-string">'base'</span>: [<span class="hljs-string">'30px'</span>, <span class="hljs-string">'2rem'</span>] <span class="hljs-comment">// 自定义 base 字体大小</span>
    }
  }
}
</code></pre>
<h4 data-id="heading-25">5.5 颜色类</h4>
<ul>
<li><code>bg-{color}</code>：背景颜色</li>
<li><code>text-{color}</code>：文字颜色</li>
<li><code>border-{color}</code>：边框颜色</li>
</ul>
<p>示例：</p>
<pre><code class="hljs language-jsx" lang="jsx">&lt;div <span class="hljs-keyword">class</span>=<span class="hljs-string">"bg-blue-500 text-white border border-red-500"</span>&gt;
  蓝底白字红边框
&lt;/div&gt;
</code></pre>
<h4 data-id="heading-26">5.6 响应式类</h4>
<ul>
<li><code>sm:</code>：小屏幕（默认 640px）</li>
<li><code>md:</code>：中等屏幕（默认 768px，项目中自定义为 300px）</li>
<li><code>lg:</code>：大屏幕（默认 1024px）</li>
<li><code>xl:</code>：超大屏幕（默认 1280px）</li>
</ul>
<p>项目中自定义断点：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-attr">theme</span>: {
  <span class="hljs-attr">screens</span>: {
    <span class="hljs-string">'md'</span>: <span class="hljs-string">'300px'</span> <span class="hljs-comment">// 自定义 md 断点为 300px</span>
  }
}

### <span class="hljs-number">5.7</span> 状态类

- <span class="hljs-string">`hover:`</span>：鼠标悬停状态
- <span class="hljs-string">`focus:`</span>：获取焦点状态
- <span class="hljs-string">`active:`</span>：激活状态

示例：
<span class="hljs-string">``</span><span class="hljs-string">`jsx
div className='text-[14px] hover:text-[32px]'&gt;yuan&lt;/div&gt;
</span></code></pre>
<h4 data-id="heading-27">5.8 任意值（Arbitrary Values）</h4>
<p>Tailwind v3 引入的特性，允许使用自定义值：</p>
<pre><code class="hljs language-jsx" lang="jsx">div className=<span class="hljs-string">'text-[14px] w-[200px] h-[100px]'</span>&gt;yuan&lt;/div&gt;
</code></pre>
<h3 data-id="heading-28">6. Tailwind 如何集成到 Vue3 和 React 中</h3>
<h4 data-id="heading-29">6.1 集成到 React 项目</h4>
<h5 data-id="heading-30">步骤 1：创建 React 项目</h5>
<pre><code class="hljs language-bash" lang="bash">npx create-react-app tailwind-react-app
<span class="hljs-built_in">cd</span> tailwind-react-app
</code></pre>
<h5 data-id="heading-31">步骤 2：安装 Tailwind CSS</h5>
<pre><code class="hljs language-bash" lang="bash">npm install -D tailwindcss postcss autoprefixer
npx tailwindcss init -p
</code></pre>
<h5 data-id="heading-32">步骤 3：配置 Tailwind</h5>
<p>在 <code>tailwind.config.js</code> 中配置内容路径：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = {
  <span class="hljs-attr">content</span>: [
    <span class="hljs-string">"./src/**/*.{js,jsx,ts,tsx}"</span>,
  ],
  <span class="hljs-attr">theme</span>: {
    <span class="hljs-attr">extend</span>: {},
  },
  <span class="hljs-attr">plugins</span>: [],
}
</code></pre>
<h5 data-id="heading-33">步骤 4：添加 Tailwind 指令</h5>
<p>在 <code>src/index.css</code> 中添加：</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-keyword">@tailwind</span> base;
<span class="hljs-keyword">@tailwind</span> components;
<span class="hljs-keyword">@tailwind</span> utilities;
</code></pre>
<h5 data-id="heading-34">步骤 5：使用 Tailwind</h5>
<p>在组件中使用 Tailwind 类：</p>
<pre><code class="hljs language-jsx" lang="jsx"><span class="hljs-keyword">import</span> <span class="hljs-title class_">React</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>;

<span class="hljs-keyword">function</span> <span class="hljs-title function_">App</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"container mx-auto p-4"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">h1</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"text-3xl font-bold text-center mb-4"</span>&gt;</span>
        Tailwind React App
      <span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"bg-blue-500 text-white py-2 px-4 rounded hover:bg-blue-600"</span>&gt;</span>
        点击我
      <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  );
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title class_">App</span>;
</code></pre>
<h4 data-id="heading-35">6.2 集成到 Vue3 项目</h4>
<h5 data-id="heading-36">步骤 1：创建 Vue3 项目</h5>
<pre><code class="hljs language-bash" lang="bash">npm create vite@latest tailwind-vue-app -- --template vue
<span class="hljs-built_in">cd</span> tailwind-vue-app
</code></pre>
<h5 data-id="heading-37">步骤 2：安装 Tailwind CSS</h5>
<pre><code class="hljs language-bash" lang="bash">npm install -D tailwindcss postcss autoprefixer
npx tailwindcss init -p
</code></pre>
<h5 data-id="heading-38">步骤 3：配置 Tailwind</h5>
<p>在 <code>tailwind.config.js</code> 中配置内容路径：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = {
  <span class="hljs-attr">content</span>: [
    <span class="hljs-string">"./index.html"</span>,
    <span class="hljs-string">"./src/**/*.{vue,js,ts,jsx,tsx}"</span>,
  ],
  <span class="hljs-attr">theme</span>: {
    <span class="hljs-attr">extend</span>: {},
  },
  <span class="hljs-attr">plugins</span>: [],
}
</code></pre>
<h5 data-id="heading-39">步骤 4：添加 Tailwind 指令</h5>
<p>在 <code>src/index.css</code> 中添加：</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-keyword">@tailwind</span> base;
<span class="hljs-keyword">@tailwind</span> components;
<span class="hljs-keyword">@tailwind</span> utilities;
</code></pre>
<h5 data-id="heading-40">步骤 5：使用 Tailwind</h5>
<p>在组件中使用 Tailwind 类：</p>
<pre><code class="hljs language-vue" lang="vue">&lt;template&gt;
  &lt;div class="container mx-auto p-4"&gt;
    &lt;h1 class="text-3xl font-bold text-center mb-4"&gt;
      Tailwind Vue3 App
    &lt;/h1&gt;
    &lt;button class="bg-blue-500 text-white py-2 px-4 rounded hover:bg-blue-600"&gt;
      点击我
    &lt;/button&gt;
  &lt;/div&gt;
&lt;/template&gt;

&lt;script setup&gt;
// 组件逻辑
&lt;/script&gt;
</code></pre>
<h3 data-id="heading-41">总结</h3>
<p>Tailwind CSS 是一个革命性的 CSS 框架，通过实用优先的方法改变了前端开发的方式。它提供了极高的灵活性和开发效率，但也带来了一定的学习成本和代码可读性挑战。通过本文的介绍，希望你能对 Tailwind CSS 有一个全面的了解，并能够在项目中灵活运用它来构建现代化的用户界面。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[C# 实现 XML 转 Excel：从解析到生成 XLSX 的详细步骤]]></title>    <link>https://juejin.cn/post/7582156219060191295</link>    <guid>https://juejin.cn/post/7582156219060191295</guid>    <pubDate>2025-12-11T06:34:14.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7582156219060191295" data-draft-id="7582169248094896134" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="C# 实现 XML 转 Excel：从解析到生成 XLSX 的详细步骤"/> <meta itemprop="keywords" content="后端,C#"/> <meta itemprop="datePublished" content="2025-12-11T06:34:14.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="用户835629078051"/> <meta itemprop="url" content="https://juejin.cn/user/3150554985403516"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            C# 实现 XML 转 Excel：从解析到生成 XLSX 的详细步骤
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3150554985403516/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    用户835629078051
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-11T06:34:14.000Z" title="Thu Dec 11 2025 06:34:14 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-11
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a53e416094024275b667edc2c7034aee~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55So5oi3ODM1NjI5MDc4MDUx:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766039653&amp;x-signature=M3hnXgBfnexLBRvyS50yy8L9sDo%3D" alt="使用C#写入XML数据到Excel文件" loading="lazy"/></p>
<p>在现代企业级应用中，数据处理与报表生成是核心环节。我们经常需要将各种格式的数据，尤其是半结构化的XML数据，转换成易于阅读和分析的结构化报表，例如Excel文件。手动进行这种转换不仅效率低下，而且容易出错，尤其是在数据量庞大或需要频繁更新的场景下。因此，寻求一种编程方式来实现XML数据到Excel的自动化写入，成为了.NET开发者面临的常见挑战。</p>
<p>C#作为功能强大的编程语言，在数据处理领域拥有卓越的能力。结合专业的第三方库，我们可以高效、精准地完成这类任务。本文将深入探讨如何利用C#和一款优秀的库，将XML数据自动化地写入Excel文件，为开发者提供清晰、可操作的解决方案。</p>
<h2 data-id="heading-0">理解XML数据结构与Excel的对应关系</h2>
<p>在开始编码之前，首先要明确XML数据的结构特点及其如何映射到Excel的行和列。XML数据通常由元素（Element）、属性（Attribute）和文本内容（Text Content）组成，形成一个层级结构。</p>
<p>例如，考虑以下一个简单的产品库存XML数据：</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">Products</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">Product</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"P001"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">Name</span>&gt;</span>Laptop<span class="hljs-tag">&lt;/<span class="hljs-name">Name</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">Category</span>&gt;</span>Electronics<span class="hljs-tag">&lt;/<span class="hljs-name">Category</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">Price</span>&gt;</span>1200.00<span class="hljs-tag">&lt;/<span class="hljs-name">Price</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">Stock</span>&gt;</span>50<span class="hljs-tag">&lt;/<span class="hljs-name">Stock</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">Product</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">Product</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"P002"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">Name</span>&gt;</span>Mouse<span class="hljs-tag">&lt;/<span class="hljs-name">Name</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">Category</span>&gt;</span>Electronics<span class="hljs-tag">&lt;/<span class="hljs-name">Category</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">Price</span>&gt;</span>25.00<span class="hljs-tag">&lt;/<span class="hljs-name">Price</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">Stock</span>&gt;</span>200<span class="hljs-tag">&lt;/<span class="hljs-name">Stock</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">Product</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">Products</span>&gt;</span>
</code></pre>
<p>这段XML数据可以映射到Excel的结构如下：</p>


























<table><thead><tr><th align="left">产品ID</th><th align="left">产品名称</th><th align="left">类别</th><th align="left">价格</th><th align="left">库存</th></tr></thead><tbody><tr><td align="left">P001</td><td align="left">Laptop</td><td align="left">Electronics</td><td align="left">1200.00</td><td align="left">50</td></tr><tr><td align="left">P002</td><td align="left">Mouse</td><td align="left">Electronics</td><td align="left">25.00</td><td align="left">200</td></tr></tbody></table>
<p>通常，XML中的每个“记录”或“实体”（如这里的<code>&lt;Product&gt;</code>元素）会对应Excel中的一行，而每个“字段”或“属性”（如<code>id</code>属性、<code>&lt;Name&gt;</code>元素的内容）则对应Excel中的一列。理解这种映射关系是成功转换数据的基础。</p>
<h2 data-id="heading-1">引入高效工具：使用Spire.XLS for .NET</h2>
<p>在处理Excel文件时，直接操作Office COM对象或手动构建Open XML SDK可能会非常复杂，尤其是在需要处理格式、样式、合并单元格或大量数据时。因此，选择一个专业的Excel操作库至关重要。本文将使用Spire.XLS for .NET。</p>
<p>Spire.XLS for .NET是一个功能全面且易于使用的.NET库，专门用于创建、读取、编辑和转换Excel文件。它提供了丰富的API，使得开发者能够以编程方式高效地完成各种Excel操作，例如数据写入、样式设置、图表生成等。</p>
<h3 data-id="heading-2">安装Spire.XLS for .NET</h3>
<p>您可以通过NuGet包管理器轻松地将<code>Spire.XLS</code>添加到您的C#项目中。在Visual Studio中，右键点击项目，选择“管理NuGet程序包”，然后搜索<code>Spire.XLS</code>并安装。</p>
<pre><code class="hljs language-bash" lang="bash">Install-Package Spire.XLS
</code></pre>
<p>安装完成后，您就可以在项目中引用并使用<code>Spire.XLS</code>的功能了。</p>
<h2 data-id="heading-3">C#实现XML数据到Excel的详细步骤与代码实践</h2>
<p>接下来，我们将通过具体的C#代码示例，展示如何将上述产品库存XML数据写入Excel。</p>
<h3 data-id="heading-4">步骤一：加载XML数据</h3>
<p>首先，我们需要使用C#的<code>XDocument</code>类来加载和解析XML数据。<code>XDocument</code>是LINQ to XML的一部分，提供了一种更现代、更易于使用的方式来处理XML。</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">using</span> System;
<span class="hljs-keyword">using</span> System.Xml.Linq;
<span class="hljs-keyword">using</span> Spire.Xls; <span class="hljs-comment">// 引入Spire.Xls命名空间</span>

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">XmlToExcelConverter</span>
{
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">ConvertXmlToExcel</span>(<span class="hljs-params"><span class="hljs-built_in">string</span> xmlFilePath, <span class="hljs-built_in">string</span> excelFilePath</span>)</span>
    {
        <span class="hljs-comment">// 假设XML文件内容如上所示</span>
        <span class="hljs-built_in">string</span> xmlContent = <span class="hljs-string">@"
&lt;Products&gt;
  &lt;Product id='P001'&gt;
    &lt;Name&gt;Laptop&lt;/Name&gt;
    &lt;Category&gt;Electronics&lt;/Category&gt;
    &lt;Price&gt;1200.00&lt;/Price&gt;
    &lt;Stock&gt;50&lt;/Stock&gt;
  &lt;/Product&gt;
  &lt;Product id='P002'&gt;
    &lt;Name&gt;Mouse&lt;/Name&gt;
    &lt;Category&gt;Electronics&lt;/Category&gt;
    &lt;Price&gt;25.00&lt;/Price&gt;
    &lt;Stock&gt;200&lt;/Stock&gt;
  &lt;/Product&gt;
&lt;/Products&gt;"</span>;

        XDocument doc;
        <span class="hljs-keyword">try</span>
        {
            <span class="hljs-comment">// 从字符串加载XML，也可以使用 XDocument.Load(xmlFilePath) 从文件加载</span>
            doc = XDocument.Parse(xmlContent); 
            Console.WriteLine(<span class="hljs-string">"XML数据加载成功。"</span>);
        }
        <span class="hljs-keyword">catch</span> (Exception ex)
        {
            Console.WriteLine(<span class="hljs-string">$"加载XML数据时发生错误: <span class="hljs-subst">{ex.Message}</span>"</span>);
            <span class="hljs-keyword">return</span>;
        }

        <span class="hljs-comment">// ... 后续写入Excel的代码</span>
    }
}
</code></pre>
<h3 data-id="heading-5">步骤二：创建Excel工作簿并写入数据</h3>
<p>现在，我们将使用<code>Spire.XLS</code>来创建一个新的Excel工作簿，并将解析后的XML数据逐行写入。</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-comment">// ... 承接上一步的 ConvertXmlToExcel 方法</span>

        <span class="hljs-comment">// 创建一个新的工作簿</span>
        Workbook workbook = <span class="hljs-keyword">new</span> Workbook();
        Worksheet sheet = workbook.Worksheets[<span class="hljs-number">0</span>]; <span class="hljs-comment">// 获取第一个工作表</span>

        <span class="hljs-comment">// 设置列标题</span>
        sheet.Range[<span class="hljs-string">"A1"</span>].Text = <span class="hljs-string">"产品ID"</span>;
        sheet.Range[<span class="hljs-string">"B1"</span>].Text = <span class="hljs-string">"产品名称"</span>;
        sheet.Range[<span class="hljs-string">"C1"</span>].Text = <span class="hljs-string">"类别"</span>;
        sheet.Range[<span class="hljs-string">"D1"</span>].Text = <span class="hljs-string">"价格"</span>;
        sheet.Range[<span class="hljs-string">"E1"</span>].Text = <span class="hljs-string">"库存"</span>;

        <span class="hljs-comment">// 遍历XML数据并写入Excel</span>
        <span class="hljs-built_in">int</span> row = <span class="hljs-number">2</span>; <span class="hljs-comment">// 从第二行开始写入数据，第一行是标题</span>
        <span class="hljs-keyword">foreach</span> (XElement product <span class="hljs-keyword">in</span> doc.Descendants(<span class="hljs-string">"Product"</span>))
        {
            <span class="hljs-comment">// 从XML节点提取数据</span>
            <span class="hljs-built_in">string</span> productId = product.Attribute(<span class="hljs-string">"id"</span>)?.Value;
            <span class="hljs-built_in">string</span> productName = product.Element(<span class="hljs-string">"Name"</span>)?.Value;
            <span class="hljs-built_in">string</span> category = product.Element(<span class="hljs-string">"Category"</span>)?.Value;
            <span class="hljs-built_in">string</span> price = product.Element(<span class="hljs-string">"Price"</span>)?.Value;
            <span class="hljs-built_in">string</span> stock = product.Element(<span class="hljs-string">"Stock"</span>)?.Value;

            <span class="hljs-comment">// 将数据写入Excel单元格</span>
            sheet.Range[<span class="hljs-string">$"A<span class="hljs-subst">{row}</span>"</span>].Text = productId;
            sheet.Range[<span class="hljs-string">$"B<span class="hljs-subst">{row}</span>"</span>].Text = productName;
            sheet.Range[<span class="hljs-string">$"C<span class="hljs-subst">{row}</span>"</span>].Text = category;
            
            <span class="hljs-comment">// 尝试将价格和库存转换为数字类型，以便Excel正确处理</span>
            <span class="hljs-keyword">if</span> (<span class="hljs-built_in">decimal</span>.TryParse(price, <span class="hljs-keyword">out</span> <span class="hljs-built_in">decimal</span> dPrice))
            {
                sheet.Range[<span class="hljs-string">$"D<span class="hljs-subst">{row}</span>"</span>].NumberValue = (<span class="hljs-built_in">double</span>)dPrice;
            }
            <span class="hljs-keyword">else</span>
            {
                sheet.Range[<span class="hljs-string">$"D<span class="hljs-subst">{row}</span>"</span>].Text = price;
            }

            <span class="hljs-keyword">if</span> (<span class="hljs-built_in">int</span>.TryParse(stock, <span class="hljs-keyword">out</span> <span class="hljs-built_in">int</span> iStock))
            {
                sheet.Range[<span class="hljs-string">$"E<span class="hljs-subst">{row}</span>"</span>].NumberValue = iStock;
            }
            <span class="hljs-keyword">else</span>
            {
                sheet.Range[<span class="hljs-string">$"E<span class="hljs-subst">{row}</span>"</span>].Text = stock;
            }
            
            row++;
        }

        <span class="hljs-comment">// 自动调整列宽，使内容可见</span>
        sheet.AllocatedRange.AutoFitColumns();

        <span class="hljs-comment">// ... 后续保存Excel的代码</span>
</code></pre>
<h3 data-id="heading-6">步骤三：保存Excel文件</h3>
<p>最后一步是将填充好数据的Excel工作簿保存到指定路径。</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-comment">// ... 承接上一步的代码</span>

        <span class="hljs-keyword">try</span>
        {
            workbook.SaveToFile(excelFilePath, ExcelVersion.Version2016); <span class="hljs-comment">// 保存为Excel 2016格式</span>
            Console.WriteLine(<span class="hljs-string">$"Excel文件已成功保存到: <span class="hljs-subst">{excelFilePath}</span>"</span>);
        }
        <span class="hljs-keyword">catch</span> (Exception ex)
        {
            Console.WriteLine(<span class="hljs-string">$"保存Excel文件时发生错误: <span class="hljs-subst">{ex.Message}</span>"</span>);
        }
        <span class="hljs-keyword">finally</span>
        {
            workbook.Dispose(); <span class="hljs-comment">// 释放资源</span>
        }
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Main</span>(<span class="hljs-params"><span class="hljs-built_in">string</span>[] args</span>)</span>
    {
        <span class="hljs-built_in">string</span> xmlFile = <span class="hljs-string">"products.xml"</span>; <span class="hljs-comment">// 实际应用中可以是文件路径</span>
        <span class="hljs-built_in">string</span> excelFile = <span class="hljs-string">"ProductsReport.xlsx"</span>;
        ConvertXmlToExcel(xmlFile, excelFile);
    }
}
</code></pre>
<h3 data-id="heading-7">进阶提示：添加基本样式</h3>
<p>为了让生成的Excel报表更具可读性，我们可以为标题行添加一些基本样式，例如加粗和设置背景色。</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-comment">// ... 在设置列标题之后，写入数据之前</span>

        <span class="hljs-comment">// 设置标题行的样式</span>
        sheet.Range[<span class="hljs-string">"A1:E1"</span>].Style.Font.IsBold = <span class="hljs-literal">true</span>; <span class="hljs-comment">// 加粗</span>
        sheet.Range[<span class="hljs-string">"A1:E1"</span>].Style.KnownColor = ExcelKnownColor.LightGreen; <span class="hljs-comment">// 设置背景色</span>
        sheet.Range[<span class="hljs-string">"A1:E1"</span>].Style.HorizontalAlignment = HorizontalAlignType.Center; <span class="hljs-comment">// 居中对齐</span>

<span class="hljs-comment">// ...</span>
</code></pre>
<p>通过上述步骤，我们能够将XML数据有效地解析并写入到Excel文件中，同时对数据类型进行适当处理，并对报表进行初步的样式美化。</p>
<h3 data-id="heading-8">生成结果示例</h3>
<p>以下是使用上述代码通过Spire.XLS for .NET库生成的Excel文件（包含格式设置）：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d389e97be1194139a141d85d443fb4dc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55So5oi3ODM1NjI5MDc4MDUx:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766039653&amp;x-signature=W2cV83XKr6Z%2F3VSpHJYS3%2Brf32I%3D" alt="写入XML数据到Excel文件" loading="lazy"/></p>
<h2 data-id="heading-9">总结</h2>
<p>本文详细介绍了如何利用C#和Spire.XLS for .NET库将XML数据高效地写入Excel文件。我们从理解XML与Excel的映射关系开始，逐步讲解了如何加载XML数据、创建Excel工作簿、遍历XML并逐行写入数据，以及最终保存文件。通过本文提供的代码示例和详细解释，C#开发者可以轻松地实现XML数据到Excel的自动化导出。</p>
<p>C#结合Spire.XLS for .NET在自动化数据导出方面展现出强大的能力和灵活性。掌握这一技能将极大地提升您在.NET开发中处理数据和生成报表的效率。我鼓励读者尝试本文提供的代码示例，并根据自身的业务需求进行扩展，例如处理更复杂的嵌套XML结构、添加更丰富的Excel样式、图表或数据验证等。这将是您提升开发效率和数据处理能力的有力一步。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[COALESCE函数：处理NULL值的利器]]></title>    <link>https://juejin.cn/post/7582156219060240447</link>    <guid>https://juejin.cn/post/7582156219060240447</guid>    <pubDate>2025-12-11T06:43:43.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7582156219060240447" data-draft-id="7582163781184126982" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="COALESCE函数：处理NULL值的利器"/> <meta itemprop="keywords" content="SQL,MySQL,函数式编程"/> <meta itemprop="datePublished" content="2025-12-11T06:43:43.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="独泪了无痕"/> <meta itemprop="url" content="https://juejin.cn/user/2981531265546328"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            COALESCE函数：处理NULL值的利器
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2981531265546328/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    独泪了无痕
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-11T06:43:43.000Z" title="Thu Dec 11 2025 06:43:43 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-11
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1e2e90208d504a819f80321a8b59f0db~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54us5rOq5LqG5peg55eV:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766040222&amp;x-signature=3WJQtCO87YUt70aaNlftOOMZlqk%3D" alt="image" loading="lazy"/></p>
<h2 data-id="heading-0">一、基础解析</h2>
<h3 data-id="heading-1">基本概念</h3>
<p>  在 SQL 数据查询中，空值（NULL）处理是开发者经常面临的挑战，空值可能由于数据缺失、未知或未定义的值而存在。SQL 提供了多种方法来处理空值，其中 COALESCE 函数是一个非常有用的工具，能够优雅地解决数据缺失问题，为查询结果提供可靠的默认值。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/206af3e8a41b4c36be3386a66e44e1fc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54us5rOq5LqG5peg55eV:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766040222&amp;x-signature=fA7N7gd524SOqzAqOdbyaIK%2Bqss%3D" alt="image" loading="lazy"/></p>
<p>  COALESCE 是ANSI SQL标准定义的函数，其名称源自"coalition"（联合）一词，寓意从多个值中联合选择第一个有效值。该函数接受两个或多个参数，按顺序检查每个参数，返回第一个非NULL的值。如果所有的表达式都是空值（NULL），则返回 NULL。这个函数常用于处理可能存在 NULL 值的数据列，确保查询结果更加稳定和可预测，在数据清洗、报表生成以及为可能为空的字段提供默认值等场景中非常实用。</p>
<h3 data-id="heading-2">基本语法结构</h3>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-built_in">COALESCE</span>(expression1, expression2, ..., expressionN)
</code></pre>
<p>  其中，<code>expression1, expression2, ... , expressionN</code> 是一个或多个表达式。COALESCE 函数从左到右依次评估每个表达式，返回列表中的第一个非空参数，当所有参数均为 NULL 时，此函数将返回 NULL。这种设计遵循了SQL的三值逻辑（TRUE/FALSE/UNKNOWN），确保在数据确实缺失时保持结果的明确性。下面的示例显示了 COALESCE 函数的一些基本用法示例：</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 如果 column1 的值为 NULL，那么将返回 '默认值'。</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-built_in">COALESCE</span>(column1, <span class="hljs-string">'默认值'</span>);

<span class="hljs-comment">-- 如果 column1 和 column2 都是 NULL，那么返回 '默认值'。</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-built_in">COALESCE</span>(column1, column2, <span class="hljs-string">'默认值'</span>);
<span class="hljs-comment">-- Mumbai</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-built_in">COALESCE</span>(<span class="hljs-string">'Mumbai'</span>, <span class="hljs-keyword">NULL</span>, <span class="hljs-keyword">NULL</span>, <span class="hljs-string">'London'</span>, <span class="hljs-string">'Paris'</span>);
<span class="hljs-comment">-- NULL</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-built_in">COALESCE</span>(<span class="hljs-keyword">NULL</span>, <span class="hljs-keyword">NULL</span>, <span class="hljs-keyword">NULL</span>, <span class="hljs-keyword">NULL</span>, <span class="hljs-keyword">NULL</span>); 
<span class="hljs-comment">-- 1</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-built_in">COALESCE</span>(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-keyword">NULL</span>, <span class="hljs-keyword">NULL</span>, <span class="hljs-number">3</span>);
<span class="hljs-comment">-- 10</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-built_in">COALESCE</span>(<span class="hljs-keyword">NULL</span>, <span class="hljs-number">10</span>, <span class="hljs-keyword">NULL</span>, <span class="hljs-number">20</span>, <span class="hljs-number">30</span>);
</code></pre>
<ul>
<li><strong>短路求值机制</strong>：函数从左到右依次评估参数，发现第一个非NULL值后立即返回，不再评估后续参数</li>
<li><strong>类型一致性要求</strong>：所有参数必须是可以隐式转换的兼容数据类型</li>
<li><strong>确定性结果</strong>：对于相同的输入参数，总是返回相同的结果</li>
</ul>
<h2 data-id="heading-3">二、典型应用场景</h2>
<h3 data-id="heading-4">默认值设置</h3>
<p>  在实际的数据查询和处理中，我们经常会遇到空值的情况。例如，当某个字段为空时，我们可以使用 COALESCE 函数将其替换为空字符串或者其他默认值。这对于数据报告和用户界面显示特别有用，因为可以避免显示 NULL 值，而是显示一个更有意义的默认值。假设有一个 employees 表，用于展示员工的信息，其中包括员工姓名和薪水。有时候，薪水字段可能为空，我们希望在查询结果中将其显示为默认值，比如 0。</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">SELECT</span> employee_id,name,<span class="hljs-built_in">COALESCE</span>(salary, <span class="hljs-number">0</span>) <span class="hljs-keyword">AS</span> effective_salary <span class="hljs-keyword">FROM</span> employees;
</code></pre>
<p>  在上述示例中，我们使用 COALESCE 函数确保 effective_salary 列不会包含 NULL 值，如果 salary 是 NULL，则 effective_salary 会显示为0。</p>
<h3 data-id="heading-5">多列优先级选择</h3>
<p>  为了更准确地反映需求，可能会存在多个数据源时，按优先级顺序选择第一个有效值。假设一个contacts（联系人）表包含work_phone（工作电话）、home_phone（家庭电话）和mobile_phone（移动电话）三个字段，希望获取任意一个可用的联系电话。</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 用户联系方式优先级：手机&gt;固话&gt;邮箱</span>
<span class="hljs-keyword">SELECT</span> user_id,<span class="hljs-built_in">COALESCE</span>(mobile_phone, home_phone, email,<span class="hljs-string">'暂无联系方式'</span>) <span class="hljs-keyword">AS</span> primary_contact <span class="hljs-keyword">FROM</span> contacts;
</code></pre>
<p>  将按顺序检查work_phone、home_phone和mobile_phone，并返回第一个非 NULL 的电话号码。如果所有电话字段都为 NULL，则返回字符串'暂无联系方式'。</p>
<h3 data-id="heading-6">构造处理逻辑条件</h3>
<p>  除了处理空值情况，COALESCE 函数还可以与其他条件语句一起使用，来处理更复杂的数据情况。假设我们有一个名为 orders 的表，包含了订单的相关信息，如下所示：</p>






























<table><thead><tr><th align="center">id</th><th align="left">product</th><th align="left">quantity</th></tr></thead><tbody><tr><td align="center">1</td><td align="left">Apple</td><td align="left">10</td></tr><tr><td align="center">2</td><td align="left">Orange</td><td align="left">NULL</td></tr><tr><td align="center">3</td><td align="left">Banana</td><td align="left">5</td></tr><tr><td align="center">4</td><td align="left">NULL</td><td align="left">3</td></tr></tbody></table>
<p>  现在我们想要查询每个订单的总价值，并且对于一些缺少产品或者数量的订单，我们希望将其单价和数量设为0，并计算总价值。</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">SELECT</span> id, product, quantity, <span class="hljs-built_in">COALESCE</span>(quantity, <span class="hljs-number">0</span>) <span class="hljs-operator">*</span> <span class="hljs-built_in">COALESCE</span>(price, <span class="hljs-number">0</span>) <span class="hljs-keyword">AS</span> total_price <span class="hljs-keyword">FROM</span> orders;
</code></pre>
<p>  运行结果如下：</p>



































<table><thead><tr><th align="center">id</th><th align="center">product</th><th align="center">quantity</th><th align="center">total_price</th></tr></thead><tbody><tr><td align="center">1</td><td align="center">Apple</td><td align="center">10</td><td align="center">100</td></tr><tr><td align="center">2</td><td align="center">Orange</td><td align="center">0</td><td align="center">0</td></tr><tr><td align="center">3</td><td align="center">Banana</td><td align="center">5</td><td align="center">50</td></tr><tr><td align="center">4</td><td align="center">NULL</td><td align="center">3</td><td align="center">0</td></tr></tbody></table>
<h2 data-id="heading-7">跨数据库兼容性分析</h2>
<p>  虽然 COALESCE 是标准 SQL 函数，但不同数据库系统也提供了各自的替代方案：</p>









































<table><thead><tr><th align="left">数据库系统</th><th align="left">SQL标准函数</th><th align="left">专有函数</th><th align="left">备注</th></tr></thead><tbody><tr><td align="left">SQL Server</td><td align="left">COALESCE</td><td align="left">ISNULL(expr1,expr2)</td><td align="left">ISNULL只能有两个参数</td></tr><tr><td align="left">Oracle</td><td align="left">COALESCE</td><td align="left">NVL(expr1,expr2)</td><td align="left">NVL仅接受两个参数</td></tr><tr><td align="left">PostgreSQL</td><td align="left">COALESCE</td><td align="left"/><td align="left">完全支持标准语法</td></tr><tr><td align="left">MySQL</td><td align="left">COALESCE</td><td align="left">IFNULL(expr1,expr2)</td><td align="left">IFNULL只能有两个参数</td></tr><tr><td align="left">SQLite</td><td align="left">COALESCE</td><td align="left"/><td align="left">完全支持标准语法</td></tr></tbody></table>
<p>  在实际开发中，建议结合具体数据库系统的特性和查询优化器的行为，灵活运用COALESCE函数，在保证代码可读性的同时实现最佳性能。最佳实践建议：</p>
<ol>
<li>在需要跨数据库兼容的代码中使用COALESCE</li>
<li>仅在确定目标数据库时使用专有函数以获得轻微性能优势</li>
<li>复杂场景中COALESCE的可读性通常优于嵌套的CASE表达式</li>
<li>COALESCE() 函数在处理 NULL 值时非常有效，但在设计数据库和编写查询时，应尽量减少依赖此类函数的情况，以保持数据的完整性和查询的效率。</li>
</ol>
<h2 data-id="heading-8">总结</h2>
<p>  COALESCE 函数以其简洁性和强大功能，成为 SQL 查询中处理NULL值的标配工具。从简单的默认值设置到复杂的数据优先级选择，从关系型数据库到现代文档型数据库，COALESCE 都展现出其不可替代的价值。通过合理应用这一函数，开发者能够编写出更健壮、更易维护的 SQL 代码，有效应对数据缺失带来的各种挑战，提高数据处理的效率和可读性。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/21880ceba4a54b629d91041b8eaaa8e5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54us5rOq5LqG5peg55eV:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766040222&amp;x-signature=Cqp9Ih0cB45bviHsvQr5bHiJA%2BE%3D" alt="image" loading="lazy"/></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[动态库和静态库的区别]]></title>    <link>https://juejin.cn/post/7582246395986362402</link>    <guid>https://juejin.cn/post/7582246395986362402</guid>    <pubDate>2025-12-11T06:31:07.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7582246395986362402" data-draft-id="7582155513586434100" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="动态库和静态库的区别"/> <meta itemprop="keywords" content="面试"/> <meta itemprop="datePublished" content="2025-12-11T06:31:07.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="诗和远方1493956232734"/> <meta itemprop="url" content="https://juejin.cn/user/272334612078663"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            动态库和静态库的区别
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/272334612078663/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    诗和远方1493956232734
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-11T06:31:07.000Z" title="Thu Dec 11 2025 06:31:07 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-11
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">一、基本概念</h2>
<h3 data-id="heading-1">静态库（Static Library）</h3>
<ul>
<li><strong>iOS/macOS</strong>: <code>.a</code> 文件</li>
<li><strong>Windows</strong>: <code>.lib</code> 文件</li>
<li><strong>Linux</strong>: <code>.a</code> 文件</li>
</ul>
<h3 data-id="heading-2">动态库（Dynamic Library）</h3>
<ul>
<li><strong>iOS/macOS</strong>: <code>.dylib</code> 或 <code>.framework</code></li>
<li><strong>Windows</strong>: <code>.dll</code> 文件</li>
<li><strong>Linux</strong>: <code>.so</code> 文件</li>
</ul>
<hr/>
<h2 data-id="heading-3">二、核心区别对比表</h2>


















































<table><thead><tr><th>对比维度</th><th>静态库</th><th>动态库</th></tr></thead><tbody><tr><td><strong>链接时机</strong></td><td>编译时链接到可执行文件</td><td>运行时加载</td></tr><tr><td><strong>文件大小</strong></td><td>增加可执行文件体积</td><td>不增加可执行文件体积</td></tr><tr><td><strong>内存占用</strong></td><td>每个进程独立占用内存</td><td>多进程共享内存</td></tr><tr><td><strong>更新方式</strong></td><td>需要重新编译整个程序</td><td>只需替换库文件</td></tr><tr><td><strong>加载速度</strong></td><td>启动快（已在可执行文件中）</td><td>启动慢（需要动态加载）</td></tr><tr><td><strong>依赖管理</strong></td><td>无运行时依赖</td><td>需要确保库文件存在</td></tr><tr><td><strong>版本冲突</strong></td><td>不存在</td><td>可能存在版本冲突</td></tr><tr><td><strong>代码复用</strong></td><td>每个程序独立拷贝</td><td>多个程序共享一份</td></tr></tbody></table>
<hr/>
<h2 data-id="heading-4">三、工作原理图解</h2>
<h3 data-id="heading-5">静态库链接过程</h3>
<pre><code class="hljs language-mermaid" lang="mermaid">flowchart LR
    subgraph 编译时
        A[源代码 main.c] --&gt; B[编译器]
        C[静态库 libmath.a] --&gt; B
        B --&gt; D[链接器]
        D --&gt; E[可执行文件 app&lt;br/&gt;包含库代码]
    end
    
    subgraph 运行时
        E --&gt; F[直接运行&lt;br/&gt;无需外部依赖]
    end
    
    style E fill:#FF6B6B
    style F fill:#98FB98
</code></pre>
<h3 data-id="heading-6">动态库链接过程</h3>
<pre><code class="hljs language-mermaid" lang="mermaid">flowchart LR
    subgraph 编译时
        A[源代码 main.c] --&gt; B[编译器]
        C[动态库 libmath.dylib] -.引用.-&gt; B
        B --&gt; D[链接器]
        D --&gt; E[可执行文件 app&lt;br/&gt;只包含引用]
    end
    
    subgraph 运行时
        E --&gt; F[动态加载器]
        G[libmath.dylib] --&gt; F
        F --&gt; H[程序运行]
    end
    
    style E fill:#FFD93D
    style G fill:#FFA07A
    style H fill:#98FB98
</code></pre>
<hr/>
<h2 data-id="heading-7">四、内存占用对比</h2>
<h3 data-id="heading-8">静态库内存模型</h3>
<pre><code class="hljs language-mermaid" lang="mermaid">graph TB
    subgraph 内存
        A[进程 A&lt;br/&gt;包含 libmath 代码]
        B[进程 B&lt;br/&gt;包含 libmath 代码]
        C[进程 C&lt;br/&gt;包含 libmath 代码]
    end
    
    style A fill:#FF6B6B
    style B fill:#FF6B6B
    style C fill:#FF6B6B
</code></pre>
<p><strong>特点</strong>: 每个进程都有一份完整的库代码副本</p>
<h3 data-id="heading-9">动态库内存模型</h3>
<pre><code class="hljs language-mermaid" lang="mermaid">graph TB
    subgraph 内存
        D[共享库区域&lt;br/&gt;libmath.dylib&lt;br/&gt;只加载一次]
        
        A[进程 A] -.引用.-&gt; D
        B[进程 B] -.引用.-&gt; D
        C[进程 C] -.引用.-&gt; D
    end
    
    style D fill:#98FB98
    style A fill:#FFD93D
    style B fill:#FFD93D
    style C fill:#FFD93D
</code></pre>
<p><strong>特点</strong>: 多个进程共享同一份库代码，节省内存</p>
<hr/>
<h2 data-id="heading-10">五、详细对比</h2>
<h3 data-id="heading-11">1. 文件大小对比</h3>
<h4 data-id="heading-12">静态库示例</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 编译静态库</span>
gcc -c math.c -o math.o
ar rcs libmath.a math.o

<span class="hljs-comment"># 链接到程序</span>
gcc main.c -L. -lmath -o app_static

<span class="hljs-comment"># 查看大小</span>
<span class="hljs-built_in">ls</span> -lh app_static
<span class="hljs-comment"># 输出: -rwxr-xr-x  1 user  staff   50K  app_static  ← 包含库代码</span>
</code></pre>
<h4 data-id="heading-13">动态库示例</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 编译动态库</span>
gcc -shared -fPIC math.c -o libmath.dylib

<span class="hljs-comment"># 链接到程序</span>
gcc main.c -L. -lmath -o app_dynamic

<span class="hljs-comment"># 查看大小</span>
<span class="hljs-built_in">ls</span> -lh app_dynamic
<span class="hljs-comment"># 输出: -rwxr-xr-x  1 user  staff   10K  app_dynamic  ← 只包含引用</span>

<span class="hljs-built_in">ls</span> -lh libmath.dylib
<span class="hljs-comment"># 输出: -rwxr-xr-x  1 user  staff   20K  libmath.dylib</span>
</code></pre>
<p><strong>对比</strong>:</p>
<ul>
<li>静态链接: <code>app_static</code> = 50K（包含所有代码）</li>
<li>动态链接: <code>app_dynamic</code> (10K) + <code>libmath.dylib</code> (20K) = 30K</li>
</ul>
<hr/>
<h3 data-id="heading-14">2. 更新方式对比</h3>
<h4 data-id="heading-15">静态库更新流程</h4>
<pre><code class="hljs language-mermaid" lang="mermaid">flowchart TD
    A[库代码有 Bug] --&gt; B[修改库源代码]
    B --&gt; C[重新编译静态库]
    C --&gt; D[重新编译所有使用该库的程序]
    D --&gt; E[重新发布所有程序]
    
    style A fill:#FF6B6B
    style E fill:#FFD93D
</code></pre>
<h4 data-id="heading-16">动态库更新流程</h4>
<pre><code class="hljs language-mermaid" lang="mermaid">flowchart TD
    A[库代码有 Bug] --&gt; B[修改库源代码]
    B --&gt; C[重新编译动态库]
    C --&gt; D[替换动态库文件]
    D --&gt; E[程序自动使用新库]
    
    style A fill:#FF6B6B
    style E fill:#98FB98
</code></pre>
<hr/>
<h3 data-id="heading-17">3. iOS 开发中的实际应用</h3>
<h4 data-id="heading-18">静态库 (.a)</h4>
<pre><code class="hljs language-objective-c" lang="objective-c">// 创建静态库项目
// File -&gt; New -&gt; Project -&gt; Cocoa Touch Static Library

// MyStaticLib.h
#import &lt;Foundation/Foundation.h&gt;

@interface MyStaticLib : NSObject
+ (NSString *)getVersion;
@end

// MyStaticLib.m
@implementation MyStaticLib
+ (NSString *)getVersion {
    return @"1.0.0";
}
@end

// 使用静态库
// 1. 将 libMyStaticLib.a 添加到项目
// 2. 在 Build Phases -&gt; Link Binary With Libraries 中添加
// 3. 直接使用
#import "MyStaticLib.h"
NSString *version = [MyStaticLib getVersion];
</code></pre>
<p><strong>特点</strong>:</p>
<ul>
<li>✅ 编译后代码在 App 内部，无需额外文件</li>
<li>✅ 启动速度快</li>
<li>❌ 增加 App 体积</li>
<li>❌ 更新需要重新提交 App</li>
</ul>
<h4 data-id="heading-19">动态库 (.framework)</h4>
<pre><code class="hljs language-objective-c" lang="objective-c">// 创建动态库项目
// File -&gt; New -&gt; Project -&gt; Cocoa Touch Framework

// MyDynamicLib.h
#import &lt;Foundation/Foundation.h&gt;

@interface MyDynamicLib : NSObject
+ (NSString *)getVersion;
@end

// MyDynamicLib.m
@implementation MyDynamicLib
+ (NSString *)getVersion {
    return @"2.0.0";
}
@end

// 使用动态库
// 1. 将 MyDynamicLib.framework 添加到项目
// 2. 在 General -&gt; Frameworks, Libraries, and Embedded Content
//    选择 "Embed &amp; Sign"
// 3. 使用
#import &lt;MyDynamicLib/MyDynamicLib.h&gt;
NSString *version = [MyDynamicLib getVersion];
</code></pre>
<p><strong>特点</strong>:</p>
<ul>
<li>✅ 不增加主 App 体积</li>
<li>✅ 可以在 App Extension 间共享</li>
<li>✅ 支持热更新（越狱环境）</li>
<li>❌ 启动速度稍慢</li>
<li>❌ 需要确保 framework 正确嵌入</li>
</ul>
<hr/>
<h2 data-id="heading-20">六、性能对比</h2>
<h3 data-id="heading-21">启动时间对比</h3>
<pre><code class="hljs language-mermaid" lang="mermaid">gantt
    title 应用启动时间对比
    dateFormat X
    axisFormat %L ms
    
    section 静态库
    加载可执行文件    :0, 50
    初始化           :50, 100
    
    section 动态库
    加载可执行文件    :0, 30
    加载动态库        :30, 80
    符号解析         :80, 120
    初始化           :120, 170
</code></pre>
<p><strong>结论</strong>: 静态库启动更快（100ms vs 170ms）</p>
<hr/>
<h2 data-id="heading-22">七、实际案例分析</h2>
<h3 data-id="heading-23">案例 1: 系统库（动态库）</h3>
<pre><code class="hljs language-objective-c" lang="objective-c">// iOS 系统库都是动态库
#import &lt;UIKit/UIKit.h&gt;
#import &lt;Foundation/Foundation.h&gt;

// 这些库在系统中只有一份
// 所有 App 共享，节省内存
</code></pre>
<h3 data-id="heading-24">案例 2: 第三方库</h3>
<h4 data-id="heading-25">CocoaPods 静态库配置</h4>
<pre><code class="hljs language-ruby" lang="ruby"><span class="hljs-comment"># Podfile</span>
platform <span class="hljs-symbol">:ios</span>, <span class="hljs-string">'13.0'</span>
use_frameworks! <span class="hljs-symbol">:linkage</span> =&gt; <span class="hljs-symbol">:static</span>  <span class="hljs-comment"># 使用静态库</span>

target <span class="hljs-string">'MyApp'</span> <span class="hljs-keyword">do</span>
  pod <span class="hljs-string">'AFNetworking'</span>
  pod <span class="hljs-string">'SDWebImage'</span>
<span class="hljs-keyword">end</span>
</code></pre>
<h4 data-id="heading-26">CocoaPods 动态库配置</h4>
<pre><code class="hljs language-ruby" lang="ruby"><span class="hljs-comment"># Podfile</span>
platform <span class="hljs-symbol">:ios</span>, <span class="hljs-string">'13.0'</span>
use_frameworks!  <span class="hljs-comment"># 使用动态库（默认）</span>

target <span class="hljs-string">'MyApp'</span> <span class="hljs-keyword">do</span>
  pod <span class="hljs-string">'AFNetworking'</span>
  pod <span class="hljs-string">'SDWebImage'</span>
<span class="hljs-keyword">end</span>
</code></pre>
<hr/>
<h2 data-id="heading-27">八、选择建议</h2>
<h3 data-id="heading-28">使用静态库的场景</h3>
<pre><code class="hljs language-mermaid" lang="mermaid">mindmap
  root((静态库))
    性能要求高
      启动速度关键
      实时性应用
    独立分发
      单一可执行文件
      无外部依赖
    安全性
      代码不易被替换
      防止篡改
    小型项目
      库数量少
      体积可控
</code></pre>
<h3 data-id="heading-29">使用动态库的场景</h3>
<pre><code class="hljs language-mermaid" lang="mermaid">mindmap
  root((动态库))
    代码共享
      多个 App 使用
      App Extension
    频繁更新
      独立更新库
      不影响主程序
    大型项目
      模块化开发
      减少主程序体积
    插件系统
      动态加载
      可选功能
</code></pre>
<hr/>
<h2 data-id="heading-30">九、iOS 特殊情况</h2>
<h3 data-id="heading-31">iOS 动态库限制</h3>
<pre><code class="hljs language-mermaid" lang="mermaid">flowchart TD
    A[iOS 动态库] --&gt; B{库来源}
    
    B --&gt;|系统库| C[允许&lt;br/&gt;UIKit, Foundation 等]
    B --&gt;|自定义库| D{使用场景}
    
    D --&gt;|主 App 内部| E[允许&lt;br/&gt;Embed &amp; Sign]
    D --&gt;|App Extension| F[允许&lt;br/&gt;共享 Framework]
    D --&gt;|跨 App 共享| G[ 不允许&lt;br/&gt;沙盒限制]
    
    style C fill:#98FB98
    style E fill:#98FB98
    style F fill:#98FB98
    style G fill:#FF6B6B
</code></pre>
<h3 data-id="heading-32">App Extension 共享 Framework</h3>
<pre><code class="hljs language-scss" lang="scss">MyApp<span class="hljs-selector-class">.app</span>/
├── MyApp (可执行文件)
├── Frameworks/
│   └── SharedLib<span class="hljs-selector-class">.framework</span>  ← 主 App 和 Extension 共享
└── PlugIns/
    └── MyExtension<span class="hljs-selector-class">.appex</span>/
        └── MyExtension (可执行文件)
</code></pre>
<p><strong>配置方法</strong>:</p>
<pre><code class="hljs language-objective-c" lang="objective-c">// 1. 创建 Framework (Dynamic)
// 2. 在主 App Target 中: Embed &amp; Sign
// 3. 在 Extension Target 中: Do Not Embed
// 4. 两者都可以使用该 Framework
</code></pre>
<hr/>
<h2 data-id="heading-33">十、常见问题</h2>
<h3 data-id="heading-34">Q1: 为什么 iOS 主要使用动态库？</h3>
<pre><code class="hljs language-markdown" lang="markdown">原因:
<span class="hljs-bullet">1.</span> 系统库共享，节省内存
<span class="hljs-bullet">2.</span> 支持 App Extension 代码共享
<span class="hljs-bullet">3.</span> 模块化开发，便于维护
<span class="hljs-bullet">4.</span> Swift 库必须是动态库（Swift ABI 稳定前）
</code></pre>
<h3 data-id="heading-35">Q2: 静态库会增加多少体积？</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 示例计算</span>
静态库大小: 5MB
使用该库的函数: 20%

实际增加体积:
- 理论上: 5MB (完整拷贝)
- 实际上: 1-2MB (链接器会移除未使用代码)
</code></pre>
<h3 data-id="heading-36">Q3: 如何查看 App 使用的库？</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 查看动态库依赖</span>
otool -L MyApp.app/MyApp

<span class="hljs-comment"># 输出示例:</span>
/System/Library/Frameworks/UIKit.framework/UIKit
/System/Library/Frameworks/Foundation.framework/Foundation
@rpath/MyDynamicLib.framework/MyDynamicLib  ← 自定义动态库
</code></pre>
<hr/>
<h2 data-id="heading-37">十一、最佳实践</h2>
<h3 data-id="heading-38">混合使用策略</h3>
<pre><code class="hljs language-mermaid" lang="mermaid">graph TB
    A[第三方库选择] --&gt; B{库特征}
    
    B --&gt;|基础工具库&lt;br/&gt;如 JSON 解析| C[静态库&lt;br/&gt;减少启动时间]
    B --&gt;|UI 组件库&lt;br/&gt;频繁更新| D[动态库&lt;br/&gt;便于维护]
    B --&gt;|大型 SDK&lt;br/&gt;如地图| E[动态库&lt;br/&gt;减少体积]
    B --&gt;|核心业务库&lt;br/&gt;稳定| F[静态库&lt;br/&gt;提高性能]
    
    style C fill:#FFD93D
    style D fill:#FFA07A
    style E fill:#FFA07A
    style F fill:#FFD93D
</code></pre>
<h3 data-id="heading-39">性能优化建议</h3>
<pre><code class="hljs language-objective-c" lang="objective-c">// 1. 减少动态库数量
// 不推荐: 10 个小动态库
// 推荐: 合并为 2-3 个大动态库

// 2. 延迟加载非必要库
dispatch_async(dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_LOW, 0), ^{
    // 加载非启动必需的库
    [self loadOptionalLibraries];
});

// 3. 使用静态库优化启动速度
// 核心启动库 -&gt; 静态库
// 其他功能库 -&gt; 动态库
</code></pre>
<hr/>
<h2 data-id="heading-40">总结</h2>









































<table><thead><tr><th>维度</th><th>静态库</th><th>动态库</th><th>推荐场景</th></tr></thead><tbody><tr><td><strong>体积</strong></td><td>增加 App 体积</td><td>不增加</td><td>动态库 ✅</td></tr><tr><td><strong>性能</strong></td><td>启动快</td><td>启动慢</td><td>静态库 ✅</td></tr><tr><td><strong>更新</strong></td><td>需重新编译</td><td>独立更新</td><td>动态库 ✅</td></tr><tr><td><strong>共享</strong></td><td>不支持</td><td>支持</td><td>动态库 ✅</td></tr><tr><td><strong>依赖</strong></td><td>无外部依赖</td><td>需确保库存在</td><td>静态库 ✅</td></tr></tbody></table>
<p><strong>一般建议</strong>:</p>
<ul>
<li>🎯 <strong>小型 App</strong>: 优先使用静态库</li>
<li>🎯 <strong>大型 App</strong>: 混合使用，核心用静态，功能用动态</li>
<li>🎯 <strong>SDK 开发</strong>: 提供两种版本供开发者选择</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[props 、emits 、组件上的v-model（详细版）]]></title>    <link>https://juejin.cn/post/7582182817107771418</link>    <guid>https://juejin.cn/post/7582182817107771418</guid>    <pubDate>2025-12-11T06:34:58.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7582182817107771418" data-draft-id="7579142750408851482" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="props 、emits 、组件上的v-model（详细版）"/> <meta itemprop="keywords" content="前端,JavaScript"/> <meta itemprop="datePublished" content="2025-12-11T06:34:58.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="nnnnna"/> <meta itemprop="url" content="https://juejin.cn/user/248908298065256"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            props 、emits 、组件上的v-model（详细版）
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/248908298065256/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    nnnnna
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-11T06:34:58.000Z" title="Thu Dec 11 2025 06:34:58 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-11
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">props (父组件 -&gt; 子组件通信)</h2>
<h3 data-id="heading-1">一、声明props的三种方式</h3>
<h4 data-id="heading-2">1.使用字符串数组的方式声明props</h4>
<p><code>const props = defineProps(["num", "name", "isShow", "arrList", "objList"]);</code></p>
<h4 data-id="heading-3">2.使用对象的方式声明props</h4>
<pre><code class="hljs language-对象方式传递props" lang="对象方式传递props">const props = defineProps({
  num: Number,
  name: String,
  isShow: Boolean,
  arrList: Array,
  objList: Object,
});
</code></pre>
<p>其中，属性名为props的名称，属性值为props预期类型的构造函数</p>
<h4 data-id="heading-4">3.带有props校验和默认值的props声明</h4>
<pre><code class="hljs language-带有props校验和默认值的props声明" lang="带有props校验和默认值的props声明">const props = defineProps({
  num: {
    type: Number,
    //设置必传
    required: true,
  },
  name: {
    type: String,
    default: "张三",
  },
  isShow: {
    type: Boolean,
    default: true,
  },
  arrList: {
    type: Array,
    default: () =&gt; {
      return [1, 2, 3];
    },
  },
  objList: {
    type: Object,
    default: (rawProps: any) =&gt; {
      //此处可以拿到原始prop
      console.log(rawProps);
      return { name: "张三", age: 18 };
    },
  },
});
</code></pre>
<h3 data-id="heading-5">二、响应式解构props</h3>
<p>props为Vue封装的响应式对象，当我们直接解构props时，会将属性值提取为普通变量，使得解构后的值失去了响应性，后续props更新时，解构后的变量不会发生响应式变化</p>
<p>因此，如果想要解构后的值依旧保持响应性，我们可以使用Vue提供的toRefs来解构，它可以将响应式对象的每个属性转换为对应的 ref对象，使得解构后仍保留响应性，值得注意的是，通过toRefs解构后的值，因为被转换为了ref，因此访问的时候需要带上.value</p>
<pre><code class="hljs language-响应式解构props" lang="响应式解构props">import { onMounted, toRefs } from "vue";
const props = defineProps({
  num: {
    type: Number,
    //设置必传
    required: true,
  },
  name: {
    type: String,
    default: "张三",
  },
  isShow: {
    type: Boolean,
    default: true,
  },
  arrList: {
    type: Array,
    default: () =&gt; {
      return [1, 2, 3];
    },
  },
  objList: {
    type: Object,
    default: (rawProps: any) =&gt; {
      //此处可以拿到原始prop
      console.log(rawProps);
      return { name: "张三", age: 18 };
    },
  },
});
const { num, name, isShow, arrList, objList } = toRefs(props);
onMounted(() =&gt; {
  console.log(num.value);
  console.log(name.value);
  console.log(isShow.value);
  console.log(arrList.value);
  console.log(objList.value);
});
</code></pre>
<h3 data-id="heading-6">三、props的命名规范</h3>
<p>在子组件定义props时，使用小驼峰命名法（<strong>camelCase</strong>）</p>
<p>在父组件传递props时，使用短线命名法（<strong>kebab-case</strong>）</p>
<pre><code class="hljs language-子组件使用小驼峰命名" lang="子组件使用小驼峰命名">&lt;script setup lang="ts"&gt;
const props = defineProps({
  arrList: {
    type: Array,
    default: () =&gt; {
      return [1, 2, 3];
    },
  },
  objList: {
    type: Object,
    default: () =&gt; {
      return { name: "张三", age: 18 };
    },
  },
});
&lt;/script&gt;
</code></pre>
<pre><code class="hljs language-父组件使用短线命名" lang="父组件使用短线命名">&lt;template&gt;
  &lt;div&gt;
    &lt;TestCom :arr-list="arrList" :obj-list="objList" /&gt;
  &lt;/div&gt;
&lt;/template&gt;
</code></pre>
<h3 data-id="heading-7">四、单向数据流</h3>
<p><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle mathcolor="red"><mrow><mi>p</mi><mi>r</mi><mi>o</mi><mi>p</mi><mi>s</mi><mtext>遵循单向数据流的原则，即数据通过父组件流向子组件</mtext></mrow></mstyle></mrow><annotation encoding="application/x-tex">\color{red}{props遵循单向数据流的原则，即数据通过父组件流向子组件}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8778em;vertical-align:-0.1944em;"/><span class="mord" style="color:red;"><span class="mord mathnormal" style="color:red;">p</span><span class="mord mathnormal" style="color:red;">ro</span><span class="mord mathnormal" style="color:red;">p</span><span class="mord mathnormal" style="color:red;">s</span><span class="mord cjk_fallback" style="color:red;">遵循单向数据流的原则，即数据通过父组件流向子组件</span></span></span></span></span></span></p>
<h4 data-id="heading-8">1.当数据为原始类型时，如果我们尝试去修改一个props的值，Vue会在控制台抛出一个警告，并且修改不成功</h4>
<pre><code class="hljs language-直接修改porps中的原始类型的值" lang="直接修改porps中的原始类型的值">&lt;script setup lang="ts"&gt;
import { onMounted } from "vue";

const props = defineProps({
  num: Number,
  name: String,
  isShow: Boolean,
});
onMounted(() =&gt; {
  props.num = 456;
  props.name = "李四";
  props.isShow = false;
  console.log(props.num);
  console.log(props.name);
  console.log(props.isShow);
});
&lt;/script&gt;
</code></pre>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0322179dcb05434185d59e3b7bd1ffb6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgbm5ubm5h:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766039766&amp;x-signature=yAkXqduuXbamu7n%2F2Nt6f1UQiDE%3D" alt="image.png" loading="lazy"/></p>
<h4 data-id="heading-9">2.如果数据为对象或者数组时，我们能够直接修改数组或者对象内部的值，因为对象和数组是按引用传递的，即传递的是一个地址值，因此能够直接修改内部的值。但是这种修改会导致数据流变得混乱而难以理解</h4>
<pre><code class="hljs language-直接修改props中的对象或者数组内部的值" lang="直接修改props中的对象或者数组内部的值">&lt;script setup lang="ts"&gt;
import { onMounted } from "vue";
const props = defineProps({
  arrList: Array,
  objList: Object,
});
onMounted(() =&gt; {
  props.arrList[0].salary = 400;
  props.objList.name = "王五";
  console.log(props.arrList[0].salary);
  console.log(props.objList.name);
});
&lt;/script&gt;
</code></pre>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bb6d78da29df4ab3ba9a13a64128586a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgbm5ubm5h:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766039766&amp;x-signature=Zr5vMR8QBsYUFoSbJ0XhhrMrjMI%3D" alt="image.png" loading="lazy"/></p>
<h4 data-id="heading-10">3.重新定义一个ref或者computed来间接修改props的值</h4>
<p>3.1 重新定义一个ref</p>
<pre><code class="hljs language-重新定义一个ref" lang="重新定义一个ref">&lt;script setup lang="ts"&gt;
import { ref, onMounted } from "vue";
const props = defineProps({
  num: Number,
  name: String,
  isShow: Boolean,
  arrList: Array,
  objList: Object,
});
const newNum = ref(props.num);
const newName = ref(props.name);
const newIsShow = ref(props.isShow);
const newArrList = ref(props.arrList);
const newObjList = ref(props.objList);
onMounted(() =&gt; {
  newNum.value = 456;
  newName.value = "李四";
  newIsShow.value = false;
  newArrList.value[0].salary = 400;
  newObjList.value.name = "王五";
  console.log(newNum.value);
  console.log(newName.value);
  console.log(newIsShow.value);
  console.log(newArrList.value[0].salary);
  console.log(newObjList.value.name);
});
&lt;/script&gt;
</code></pre>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/af6e778c491e46a1a8fc8fffc8df5f57~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgbm5ubm5h:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766039766&amp;x-signature=fbsNV%2FR4%2BQ%2BMv2VQmrivcJnh8CI%3D" alt="image.png" loading="lazy"/></p>
<p>3.2 重新定义一个computed</p>
<pre><code class="hljs language-定义一个computed" lang="定义一个computed">&lt;script setup lang="ts"&gt;
import { computed, onMounted } from "vue";
const props = defineProps({
  num: Number,
  isShow: Boolean,
});
const newNum = computed(() =&gt; {
  return props.num + 1;
});
const newIsShow = computed(() =&gt; {
  return !props.isShow;
});
onMounted(() =&gt; {
  console.log(newNum.value);
  console.log(newIsShow.value);
});
&lt;/script&gt;
</code></pre>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d2709ddc5e5f4aa79b2e8def7df6b9e6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgbm5ubm5h:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766039766&amp;x-signature=E%2BFsAyyaoUm11sHSOgzbwgg%2FApk%3D" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-11">emits (子组件 -&gt; 父组件通信)</h2>
<h3 data-id="heading-12">一、模板表达式中直接使用emit</h3>
<pre><code class="hljs language-模板表达式中直接使用emit" lang="模板表达式中直接使用emit">&lt;template&gt;
  &lt;div&gt;
    &lt;button @click="$emit('test', testValue)"&gt;按钮&lt;/button&gt;
  &lt;/div&gt;
&lt;/template&gt;

&lt;script setup lang="ts"&gt;
import { ref } from "vue";
const testValue = ref("张三");
&lt;/script&gt;
</code></pre>
<h3 data-id="heading-13">二、显式的通过defineEmits声明</h3>
<pre><code class="hljs language-通过defineEmits显式声明" lang="通过defineEmits显式声明">&lt;template&gt;
  &lt;div&gt;
    &lt;button @click="handleTestEmit"&gt;按钮&lt;/button&gt;
  &lt;/div&gt;
&lt;/template&gt;

&lt;script setup lang="ts"&gt;
import { ref } from "vue";
const testValue = ref("张三");

const emit = defineEmits(["test"]);

const handleTestEmit = () =&gt; {
  emit("test", testValue.value);
};
&lt;/script&gt;
</code></pre>
<h3 data-id="heading-14">三、defineEmits结合TS进行类型声明</h3>
<pre><code class="hljs language-TS类型声明" lang="TS类型声明">&lt;template&gt;
  &lt;div&gt;
    &lt;button @click="handleTestEmit"&gt;按钮&lt;/button&gt;
  &lt;/div&gt;
&lt;/template&gt;

&lt;script setup lang="ts"&gt;
import { ref } from "vue";
const testValue = ref("张三");

interface Emit {
  (e: "test", value: string): void;
}
const emit = defineEmits&lt;Emit&gt;();

const handleTestEmit = () =&gt; {
  emit("test", testValue.value);
};
&lt;/script&gt;
</code></pre>
<h2 data-id="heading-15">组件上的v-model</h2>
<h3 data-id="heading-16">一、绑定单个v-model</h3>
<pre><code class="hljs language-绑定单个v-model" lang="绑定单个v-model">&lt;template&gt;
  &lt;div&gt;
    &lt;TestCom v-model="testValue" /&gt;
    &lt;!-- 等价于：&lt;TestCom :modelValue="testValue" @update:modelValue="testValue = $event" /&gt; --&gt;
  &lt;/div&gt;
&lt;/template&gt;
</code></pre>
<p>在父组件上绑定v-model，等同于向子组件内部传入了一个名为modelValue的props，并且监听一个update:modelValue事件并赋值，因此需要在子组件内部定义一个props去接收这个modelValue，并且通过emit给父组件发送一个@update:modelValue事件</p>
<pre><code class="hljs language-子组件定义prop和emit" lang="子组件定义prop和emit">&lt;template&gt;
  &lt;div&gt;
    &lt;input :value="modelValue" @input="handleEmit" /&gt;
  &lt;/div&gt;
&lt;/template&gt;

&lt;script setup lang="ts"&gt;
const prop = defineProps(["modelValue"]);
const emit = defineEmits(["update:modelValue"]);

const handleEmit = (e) =&gt; {
  emit("update:modelValue", e.target.value);
};
&lt;/script&gt;
</code></pre>
<h3 data-id="heading-17">二、绑定多个v-model</h3>
<pre><code class="hljs language-绑定多个v-model" lang="绑定多个v-model">&lt;template&gt;
  &lt;div&gt;
    &lt;TestCom
      v-model:one="testValue1"
      v-model:two="testValue2"
      v-model:three="testValue3"
    /&gt;
  &lt;/div&gt;
&lt;/template&gt;

&lt;script setup lang="ts"&gt;
import TestCom from "./components/index.vue";
import { ref } from "vue";
const testValue1 = ref();
const testValue2 = ref();
const testValue3 = ref();
&lt;/script&gt;
</code></pre>
<p>当我们需要在一个组件上绑定多个v-model时，需要我们自定义每个v-model传入的props名字</p>
<pre><code class="hljs language-js" lang="js">&lt;template&gt;
  <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">:value</span>=<span class="hljs-string">"one"</span> @<span class="hljs-attr">input</span>=<span class="hljs-string">"handleEmitOne"</span> /&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">:value</span>=<span class="hljs-string">"two"</span> @<span class="hljs-attr">input</span>=<span class="hljs-string">"handleEmitTwo"</span> /&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">:value</span>=<span class="hljs-string">"three"</span> @<span class="hljs-attr">input</span>=<span class="hljs-string">"handleEmitThree"</span> /&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
&lt;/template&gt;

<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"ts"</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">const</span> prop = <span class="hljs-title function_">defineProps</span>([<span class="hljs-string">"one"</span>, <span class="hljs-string">"two"</span>, <span class="hljs-string">"three"</span>]);
<span class="hljs-keyword">const</span> emit = <span class="hljs-title function_">defineEmits</span>([<span class="hljs-string">"update:one"</span>, <span class="hljs-string">"update:two"</span>, <span class="hljs-string">"update:three"</span>]);

<span class="hljs-keyword">const</span> <span class="hljs-title function_">handleEmitOne</span> = (<span class="hljs-params">e</span>) =&gt; {
  <span class="hljs-title function_">emit</span>(<span class="hljs-string">"update:one"</span>, e.<span class="hljs-property">target</span>.<span class="hljs-property">value</span>);
};
<span class="hljs-keyword">const</span> <span class="hljs-title function_">handleEmitTwo</span> = (<span class="hljs-params">e</span>) =&gt; {
  <span class="hljs-title function_">emit</span>(<span class="hljs-string">"update:two"</span>, e.<span class="hljs-property">target</span>.<span class="hljs-property">value</span>);
};
<span class="hljs-keyword">const</span> <span class="hljs-title function_">handleEmitThree</span> = (<span class="hljs-params">e</span>) =&gt; {
  <span class="hljs-title function_">emit</span>(<span class="hljs-string">"update:three"</span>, e.<span class="hljs-property">target</span>.<span class="hljs-property">value</span>);
};
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span>
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[H5回调页开发与调试复盘]]></title>    <link>https://juejin.cn/post/7582118218649534490</link>    <guid>https://juejin.cn/post/7582118218649534490</guid>    <pubDate>2025-12-11T06:35:08.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7582118218649534490" data-draft-id="7582156410319781898" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="H5回调页开发与调试复盘"/> <meta itemprop="keywords" content="微信小程序"/> <meta itemprop="datePublished" content="2025-12-11T06:35:08.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Gracemark"/> <meta itemprop="url" content="https://juejin.cn/user/184373684482216"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            H5回调页开发与调试复盘
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/184373684482216/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Gracemark
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-11T06:35:08.000Z" title="Thu Dec 11 2025 06:35:08 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-11
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">H5回调页开发与调试复盘</h2>
<h3 data-id="heading-1">1. 问题背景与需求分析</h3>
<h4 data-id="heading-2">1.1 原始需求</h4>
<p>开发一个H5环境下的签约回调页面，实现签约成功/失败后的自动跳转功能，支持不同回调类型（签约类型、人脸认证类型），并确保在微信小程序、微信浏览器和普通浏览器环境下都能正常工作。</p>
<h4 data-id="heading-3">1.2 遇到的问题</h4>
<ul>
<li><strong>H5环境签约跳转失败</strong>：用户在完成签约后无法正确跳转到目标页面</li>
<li><strong>缺少必要参数错误</strong>：系统提示"缺少必要参数：callback"</li>
<li><strong>URL路径异常</strong>：跳转URL中包含"undefined"（如<code>https://testgong.jiandankongjian.com/callback/undefined</code>）</li>
<li><strong>参数传递错误</strong>：调试数据显示参数值异常（如<code>callbacktype=contractType%2F</code>）</li>
</ul>
<h3 data-id="heading-4">2. 开发与调试过程</h3>
<h4 data-id="heading-5">2.1 代码结构分析</h4>
<p>首先对现有的回调配置文件<code>callback-config.html</code>进行了全面分析，重点关注：</p>
<ul>
<li><code>handleCallback()</code>：主流程函数，负责参数处理和环境判断</li>
<li><code>executeInH5()</code>：H5环境下的跳转逻辑实现</li>
<li><code>executeInMiniProgram()</code>：小程序环境下的跳转逻辑</li>
<li><code>getUrlParams()</code>：URL参数获取函数</li>
<li><code>buildTargetPath()</code>：目标路径构建函数</li>
<li><code>detectWeChat()</code>：环境检测函数</li>
</ul>
<h4 data-id="heading-6">2.2 问题定位</h4>
<p>通过查看代码和添加调试信息，逐步定位到以下关键问题：</p>
<ol>
<li>
<p><strong>无data参数时跳转路径未正确设置</strong>：在<code>executeInH5()</code>函数中，当缺少data参数时，h5TargetUrl未被正确赋值</p>
</li>
<li>
<p><strong>URL路径参数提取问题</strong>：当URL路径中包含"undefined"时，无法正确获取callback参数</p>
</li>
<li>
<p><strong>参数值引用错误</strong>：在构建跳转URL时，similarity参数错误地使用了liveRate的值</p>
</li>
<li>
<p><strong>回调类型参数格式问题</strong>：callbacktype参数值包含末尾斜杠（如<code>contractType/</code>），导致精确匹配失败</p>
</li>
</ol>
<h4 data-id="heading-7">2.3 解决方案实现</h4>
<h5 data-id="heading-8">2.3.1 修复无data参数时的跳转路径</h5>
<p>在<code>executeInH5()</code>函数中添加了data参数不存在时的处理逻辑：</p>
<pre><code class="hljs language-javascript" lang="javascript">} <span class="hljs-keyword">else</span> {
    <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'loadingText'</span>).<span class="hljs-property">textContent</span> += <span class="hljs-string">'没有data参数，使用buildTargetPath构建路径...\n'</span>;  
    <span class="hljs-comment">// 没有data参数，使用buildTargetPath构建路径</span>
    <span class="hljs-keyword">const</span> targetPath = <span class="hljs-title function_">buildTargetPath</span>(programConfig, {
        <span class="hljs-attr">taskId</span>: params.<span class="hljs-property">taskId</span> || <span class="hljs-string">''</span>,
        <span class="hljs-attr">orderId</span>: params.<span class="hljs-property">orderId</span> || <span class="hljs-string">''</span>,
        <span class="hljs-attr">status</span>: params.<span class="hljs-property">status</span> || <span class="hljs-string">''</span>,
        <span class="hljs-attr">faceOrderNo</span>: params.<span class="hljs-property">faceOrderNo</span> || <span class="hljs-string">''</span>,
        <span class="hljs-attr">faceId</span>: params.<span class="hljs-property">faceId</span> || <span class="hljs-string">''</span>,
        <span class="hljs-attr">signNo</span>: params.<span class="hljs-property">signNo</span> || <span class="hljs-string">''</span>
    }, params);
    h5TargetUrl = currentDomain + <span class="hljs-string">'/#'</span> + targetPath;
    <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'loadingText'</span>).<span class="hljs-property">textContent</span> += <span class="hljs-string">`buildTargetPath构建的路径: <span class="hljs-subst">${targetPath}</span>\n`</span>;
}
</code></pre>
<h5 data-id="heading-9">2.3.2 添加URL路径参数提取</h5>
<p>在<code>handleCallback()</code>函数中添加了从路径提取callback参数的逻辑：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 检查当前URL路径，如果路径中包含undefined，尝试从路径中提取callback参数</span>
<span class="hljs-keyword">const</span> currentPath = <span class="hljs-variable language_">window</span>.<span class="hljs-property">location</span>.<span class="hljs-property">pathname</span>;
<span class="hljs-keyword">if</span> (currentPath.<span class="hljs-title function_">includes</span>(<span class="hljs-string">'/undefined'</span>)) {
    <span class="hljs-comment">// 从路径中提取callback参数</span>
    <span class="hljs-keyword">const</span> pathParts = currentPath.<span class="hljs-title function_">split</span>(<span class="hljs-string">'/'</span>);
    <span class="hljs-keyword">const</span> callbackFromPath = pathParts[pathParts.<span class="hljs-property">length</span> - <span class="hljs-number">1</span>];
    <span class="hljs-keyword">if</span> (callbackFromPath &amp;&amp; callbackFromPath !== <span class="hljs-string">'undefined'</span>) {
        params.<span class="hljs-property">callback</span> = callbackFromPath;
        <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'loadingText'</span>).<span class="hljs-property">textContent</span> += <span class="hljs-string">`\n从路径提取callback参数: <span class="hljs-subst">${callbackFromPath}</span>`</span>;
    }
}
</code></pre>
<h5 data-id="heading-10">2.3.3 修复参数引用错误</h5>
<p>将similarity参数的错误引用从data.liveRate改为data.similarity：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">if</span> (data.<span class="hljs-property">similarity</span>) h5TargetUrl += (h5TargetUrl.<span class="hljs-title function_">includes</span>(<span class="hljs-string">'?'</span>) ? <span class="hljs-string">'&amp;'</span> : <span class="hljs-string">'?'</span>) + <span class="hljs-string">'similarity='</span> + <span class="hljs-built_in">encodeURIComponent</span>(data.<span class="hljs-property">similarity</span>);
</code></pre>
<h5 data-id="heading-11">2.3.4 修复回调类型参数格式</h5>
<p>在<code>buildTargetPath()</code>函数中添加了对callbacktype参数的特殊处理：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 补充其他URL参数</span>
<span class="hljs-keyword">if</span> (allUrlParams) {
    <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">keys</span>(allUrlParams).<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">key</span> =&gt;</span> {
        <span class="hljs-keyword">if</span> (!excludeKeys.<span class="hljs-title function_">includes</span>(key) &amp;&amp; !keys.<span class="hljs-title function_">includes</span>(key) &amp;&amp; allUrlParams[key]) {
            <span class="hljs-comment">// 特殊处理callbacktype参数，确保其值不包含末尾的/字符</span>
            <span class="hljs-keyword">let</span> value = allUrlParams[key];
            <span class="hljs-keyword">if</span> (key === <span class="hljs-string">'callbacktype'</span>) {
                value = value.<span class="hljs-title function_">replace</span>(<span class="hljs-regexp">/\/$/</span>, <span class="hljs-string">''</span>);
            }
            queryParams.<span class="hljs-title function_">push</span>(<span class="hljs-string">`<span class="hljs-subst">${key}</span>=<span class="hljs-subst">${<span class="hljs-built_in">encodeURIComponent</span>(value)}</span>`</span>);
        }
    });
}
</code></pre>
<h3 data-id="heading-12">3. 调试策略与工具</h3>
<h4 data-id="heading-13">3.1 页面调试信息</h4>
<p>在关键函数中添加了详细的调试信息显示，帮助实时查看参数状态和执行流程：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'loadingText'</span>).<span class="hljs-property">textContent</span> = <span class="hljs-string">`URL参数: <span class="hljs-subst">${<span class="hljs-built_in">JSON</span>.stringify(params)}</span>`</span>;
<span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'loadingText'</span>).<span class="hljs-property">textContent</span> += <span class="hljs-string">`\n环境检测: 微信=<span class="hljs-subst">${env.isWeChat}</span>, 小程序=<span class="hljs-subst">${env.isMiniProgram}</span>`</span>;
<span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'loadingText'</span>).<span class="hljs-property">textContent</span> += <span class="hljs-string">`\n当前URL: <span class="hljs-subst">${<span class="hljs-variable language_">window</span>.location.href}</span>`</span>;
<span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'loadingText'</span>).<span class="hljs-property">textContent</span> += <span class="hljs-string">`\ncallbackType: <span class="hljs-subst">${callbackType}</span>`</span>;
</code></pre>
<h4 data-id="heading-14">3.2 测试页面开发</h4>
<p>创建了<code>test-h5-debug.html</code>测试页面，模拟不同场景的回调参数，方便快速测试和验证修复效果：</p>
<ul>
<li>签约成功场景</li>
<li>签约失败场景</li>
<li>无data参数场景</li>
<li>路径参数场景（模拟undefined问题）</li>
<li>人脸认证成功/失败场景</li>
</ul>
<h3 data-id="heading-15">4. 经验教训与改进建议</h3>
<h4 data-id="heading-16">4.1 经验教训</h4>
<ol>
<li>
<p><strong>调试信息的重要性</strong>：添加详细的调试信息可以大大提高问题定位效率，尤其是在复杂的环境判断和参数处理场景中</p>
</li>
<li>
<p><strong>边界情况处理</strong>：必须考虑各种边界情况，如参数缺失、格式错误、URL路径异常等</p>
</li>
<li>
<p><strong>参数校验与标准化</strong>：对输入参数进行校验和标准化处理，可以避免因参数格式问题导致的功能故障</p>
</li>
<li>
<p><strong>环境兼容性</strong>：不同环境（小程序、微信浏览器、普通浏览器）的API和行为差异较大，需要充分测试</p>
</li>
<li>
<p><strong>代码规范性</strong>：保持良好的代码格式和可读性，有助于后续维护和问题排查</p>
</li>
</ol>
<h4 data-id="heading-17">4.2 改进建议</h4>
<ol>
<li>
<p><strong>参数验证增强</strong>：添加更严格的参数验证逻辑，对必填参数进行检查并提供清晰的错误提示</p>
</li>
<li>
<p><strong>错误处理优化</strong>：完善错误处理机制，记录详细的错误日志，便于问题追踪</p>
</li>
<li>
<p><strong>测试覆盖度</strong>：增加自动化测试用例，覆盖不同参数组合、环境和异常场景</p>
</li>
<li>
<p><strong>配置化设计</strong>：将跳转路径、参数映射等配置信息提取到配置文件中，提高代码灵活性</p>
</li>
<li>
<p><strong>性能优化</strong>：减少不必要的参数解析和字符串拼接操作，提高页面加载和跳转速度</p>
</li>
</ol>
<h3 data-id="heading-18">5. 总结</h3>
<p>通过本次回调页的开发与调试，成功解决了H5环境下签约跳转失败的问题，修复了参数处理、路径构建等多个关键bug。整个过程展示了良好的问题定位、分析和解决能力，同时也积累了宝贵的前端调试和跨环境开发经验。在未来的开发中，应进一步加强边界情况处理、参数验证和测试覆盖，提高代码质量和系统稳定性。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e85a08f514034c4f8e8112e8447ac74a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgR3JhY2VtYXJr:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766039708&amp;x-signature=B8XV%2B9c5H%2Fc0y6vFHrSeMJ1IvDc%3D" alt="juejin-2.png" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/53bfa09c35ca49b394db3d85902f4cf2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgR3JhY2VtYXJr:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766039708&amp;x-signature=kjf03Rcwn0ossNEeKvMgpwJi41g%3D" alt="juejin-1.jpg" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e1bd637f537e4256906e8234f5a0ac88~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgR3JhY2VtYXJr:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766039708&amp;x-signature=GQpKJxGvRkx8HWES1%2Fz9yWUmwIw%3D" alt="jujin-5.png" loading="lazy"/></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[麻省理工学院的“冰山计划”揭示了AI对就业的影响远比表面上看起来要大得多]]></title>    <link>https://juejin.cn/post/7582155513586614324</link>    <guid>https://juejin.cn/post/7582155513586614324</guid>    <pubDate>2025-12-11T06:46:03.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7582155513586614324" data-draft-id="7582096212663877632" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="麻省理工学院的“冰山计划”揭示了AI对就业的影响远比表面上看起来要大得多"/> <meta itemprop="keywords" content="OpenAI,AIGC,Agent"/> <meta itemprop="datePublished" content="2025-12-11T06:46:03.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="安思派Anspire"/> <meta itemprop="url" content="https://juejin.cn/user/3044964115417419"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            麻省理工学院的“冰山计划”揭示了AI对就业的影响远比表面上看起来要大得多
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3044964115417419/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    安思派Anspire
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-11T06:46:03.000Z" title="Thu Dec 11 2025 06:46:03 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-11
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>麻省理工学院（MIT）的一项新模型显示，人工智能（AI）对工作的改变速度超过了政府、企业或劳动者的应对能力，而且它影响的工作岗位数量将远远超过大多数人的想象。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f887e5673e2643dea040c6d412a0550b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a6J5oCd5rS-QW5zcGlyZQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766040363&amp;x-signature=N0ePhvpSUevG%2BqA2o3nk%2BhMx6%2Fw%3D" alt="" loading="lazy"/></p>
<p>由DALL-E生成的图像</p>
<p>作为一个在技术（包括AI，因为我拥有多项与AI相关的专利并开发过AI产品）和职业发展两方面都有专长的人，我在观察AI对劳动力市场的影响方面有着独特的视角。我在多篇文章中广泛探讨过这个问题，但归根结底，主要有三个核心观点。</p>
<ol>
<li>
<p>这不是关于AI取代整个工作岗位，而是关于逐步改进工作的某些部分以提高效率；这将减少该岗位所需的人员数量（见 “<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.thecareertoolkitbook.com%2Fblog%2Fwhy-ai-isnt-yet-ready-to-take-your-job" target="_blank" title="https://www.thecareertoolkitbook.com/blog/why-ai-isnt-yet-ready-to-take-your-job" ref="nofollow noopener noreferrer">为什么AI（目前）还不准备取代你的工作</a>”）。</p>
</li>
<li>
<p>变革的步伐将是前所未有的（见 “<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.thecareertoolkitbook.com%2Fblog%2Fno-ai-isnt-going-to-kill-you-but-it-will-cause-social-unrest-part-1" target="_blank" title="https://www.thecareertoolkitbook.com/blog/no-ai-isnt-going-to-kill-you-but-it-will-cause-social-unrest-part-1" ref="nofollow noopener noreferrer">不，AI不会杀了你，但它会引发社会动荡——第一部分</a>”）。</p>
</li>
<li>
<p>微小的变化，那些我们很可能会误判，甚至完全忽略的变化，将产生巨大的影响（见 “<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.thecareertoolkitbook.com%2Fblog%2Fthe-coming-ai-recession-looking-over-the-cliff-of-technological-based-job-loss" target="_blank" title="https://www.thecareertoolkitbook.com/blog/the-coming-ai-recession-looking-over-the-cliff-of-technological-based-job-loss" ref="nofollow noopener noreferrer">即将到来的 AI 衰退：审视基于技术的失业悬崖</a>” 和 “<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.thecareertoolkitbook.com%2Fblog%2Fthe-path-to-hell-is-paved-with-ai" target="_blank" title="https://www.thecareertoolkitbook.com/blog/the-path-to-hell-is-paved-with-ai" ref="nofollow noopener noreferrer">通往地狱的道路是由 AI 铺就的</a>”）。</p>
</li>
</ol>
<p>最近，我撰写了文章“<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.thecareertoolkitbook.com%2Fblog%2Fthe-canary-in-the-code-mine-what-techs-job-slump-means-for-the-rest-of-us" target="_blank" title="https://www.thecareertoolkitbook.com/blog/the-canary-in-the-code-mine-what-techs-job-slump-means-for-the-rest-of-us" ref="nofollow noopener noreferrer">代码矿井中的金丝雀：科技行业的就业低迷对我们其他人意味着什么</a>”，分析了科技行业就业的现状，以及科技如何成为其他行业问题的领先指标。现在来看看<a href="https://link.juejin.cn?target=https%3A%2F%2Ficeberg.mit.edu%2F" target="_blank" title="https://iceberg.mit.edu/" ref="nofollow noopener noreferrer">麻省理工学院（MIT）的冰山项目</a>，该项目刚刚发布了一份题为“<a href="https://link.juejin.cn?target=https%3A%2F%2Ficeberg.mit.edu%2Freport.pdf" target="_blank" title="https://iceberg.mit.edu/report.pdf" ref="nofollow noopener noreferrer">冰山指数：衡量人工智能（AI）经济中以技能为中心的风险敞口</a>”的报告。他们的研究采用了非常复杂的方法、详细的建模，并为类似预测提供了更为严谨的分析。我通常不会撰写只是总结他人工作的文章，但像这样有影响力的研究值得报道。</p>
<p>在《<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.thecareertoolkitbook.com%2Fblog%2Fthe-canary-in-the-code-mine-what-techs-job-slump-means-for-the-rest-of-us" target="_blank" title="https://www.thecareertoolkitbook.com/blog/the-canary-in-the-code-mine-what-techs-job-slump-means-for-the-rest-of-us" ref="nofollow noopener noreferrer">代码矿中的金丝雀：科技行业的就业低迷对我们其他人意味着什么</a>》一文中，我指出科技行业的工作岗位和客服中心一样，是最早受到AI进步影响的领域之一。报告作者指出，“AI系统如今每天编写的代码超过10亿行，超过了人类开发者的产出”。（公平地说，关于这类代码的长期影响仍存在有趣的争论； 我会在未来的文章中详细介绍。）但这只是冰山一角，而这正是项目名称背后的动机所在；真正的影响将大得多、大得多。</p>
<p>在这项研究中，他们将工作拆解为超过32000种不同的技能。然后，他们对3000个县的923种职业中的1.51亿名工人进行了建模；每名工人都被建模为一个智能体（换句话说，模拟中有1.51亿个不同的实体）。通过基于智能体的建模（这本身是一种AI，但与大语言模型不同），他们可以对技术和政策变化如何影响劳动力市场进行预测。主要结论如下。</p>
<p>首先，作者们认为我们目前无法准确衡量AI的影响； 像GDP和失业率这样现有的指标是不够的。举个例子（这是我举的例子，不是报告中的例子），在工业时代，我们会统计工厂的数量、在这些工厂就业的人数以及这些工厂的产出。例如，随着汽车行业实现自动化，我们可以看到某一年每生产一辆汽车所需的工人比例。我们没有衡量AI正在产生多少经济产出的方法。经济学家通过观察新型电视，将其与旧型号进行比较，并确定新型电视的改进程度，以此来衡量生产率的提高。他们可以比较不同年份生产的两种产品，并衡量其改进情况（即使这并非一门精确的科学）。当AI自动处理一些医疗文书工作，让医护人员有更多时间照顾患者时，我们目前还没有办法衡量这一点。由于大语言模型正在影响服务业，我们无法像衡量实物商品那样轻松地衡量它。</p>
<p>其次，适应这种变化将困难得多。他们写道，“有证据表明，劳动力的变化速度比规划周期所能适应的速度更快”。再加上上述缺乏适当数据的情况，这意味着政策制定者在盲目行事。多年来我一直主张，我们需要对劳动力进行大规模再培训，这需要公共部门和私营部门共同努力。但如果对变化和需求缺乏适当的了解，相关计划的制定就会更慢，而且/或者会出现偏差。</p>
<p>第三点，或许也是最重要的一点，就是冰山本身。众所周知，冰山大部分的质量都隐藏在水线以下。在海洋中看似相对较小的冰山，实际上要大得多，只是看不见而已。这就是这里的主要问题所在。</p>
<p>研究人员指出，“科技行业在标准普尔500指数的市值中占比超过30%，但在劳动力中仅占约6%”。我们已经知道科技行业的从业者日子不好过。更重要的是，他们写道，“分析显示，集中在计算和技术领域（工资价值的2.2%，约2110亿美元）的可见AI应用只是冰山一角。通过跨越行政、金融和专业服务的认知自动化，技术能力在表面之下延伸得更深（11.7%，约1.2万亿美元）”。换句话说，这些科技从业者只是冰山一角。其他专业服务才是隐藏在水下的部分，对劳动力市场的影响要大得多。</p>
<p>研究人员创建了“冰山指数”来衡量对劳动力的可见影响与隐藏影响的比率。上述数据简洁地表述为：“数字AI的冰山指数平均值为11.7%，是2.2%的表面指数的五倍。”换句话说，问题的规模比目前看起来大约大五倍。</p>
<p>需要注意的是，该研究明确指出，“验证是相关性而非因果性的”。这意味着从技术上讲，它并没有证明AI的改进或政策导致了这些结果，仅仅表明它们存在相关性。尽管如此，相信它们存在因果关系似乎是合理的，因为因果机制很直接且易于理解。至少，我们不能忽视如此规模的影响，坐等因果关系得到证明。</p>
<p>报告中未提及、我也认为模型中未考虑到的，是次生效应。例如，假设一个商业园区将在那里工作的员工数量削减三分之一。这意味着为员工提供支持的企业，如清洁服务、当地午餐场所、下班后的酒吧等，都会看到收入下降，并可能经历连锁裁员。理论上，减少员工节省下来的资金只会转移到使用AI的公司的股东以及AI公司本身的股东手中。不幸的是，涓滴经济学已被证明是海市蜃楼。即使它确实有效，我在之前的文章中也论证过，失业和创造就业之间会有显著的延迟，可能长达数年（可能多达五到十年）。值得注意的是，冰山指数对于以低技术劳动力为起点的美国各州尤为重要，因为这些州在隐藏在水下的冰山部分的劳动力占比最大。</p>
<p>简而言之，AI的影响可能比大多数人想象的更大、更快到来。大语言模型（LLMs）已经在创造采用记录，这意味着采用带来的影响也将创下纪录。即使你的工作今天没有受到影响，很快也可能会受到影响，直接或间接。</p>
<p>社会需要做好准备。自“大萧条”以来，我们比以往任何时候都更需要完善的社会安全网，以及对再培训和创业的支持。地方、州和联邦政府需要制定税收政策，以弥补工资收入的损失。重要的是，这些新的收入来源将为所需的再培训提供资金。在“大衰退”期间，我在纽约州立大学莱文学院任教，参与了一个由纽约市经济发展委员会资助的项目，为那些失去工作且工作不会再恢复的专业人士提供再培训。我们需要在全国范围内开展类似的项目，而且今天就需要开始试点这些项目。</p>
<p>个人需要认识到，他们向公司提供的价值主张将会转变。正如我在《<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.thecareertoolkitbook.com%2Fblog%2Fteach-your-kids-to-program-but-dont-teach-them-to-be-programmers" target="_blank" title="https://www.thecareertoolkitbook.com/blog/teach-your-kids-to-program-but-dont-teach-them-to-be-programmers" ref="nofollow noopener noreferrer">教你的孩子编程，但不要教他们成为程序员</a>》中所写的那样，你工作中可以被自动化的部分将不再能让你在劳动力市场中脱颖而出（编程只是一个例子，这篇文章总体上是关于面对AI时的技能）。加强你的沟通、团队合作、领导能力、人脉拓展和其他专业技能，将是在变革的浪潮中保持领先的关键。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[CentOS7/8在线yum源自动设置]]></title>    <link>https://juejin.cn/post/7582246395986427938</link>    <guid>https://juejin.cn/post/7582246395986427938</guid>    <pubDate>2025-12-11T06:41:25.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7582246395986427938" data-draft-id="7582133314687336500" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="CentOS7/8在线yum源自动设置 "/> <meta itemprop="keywords" content="CentOS"/> <meta itemprop="datePublished" content="2025-12-11T06:41:25.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="用户722786812344"/> <meta itemprop="url" content="https://juejin.cn/user/4100515739233513"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            CentOS7/8在线yum源自动设置 
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4100515739233513/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    用户722786812344
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-11T06:41:25.000Z" title="Thu Dec 11 2025 06:41:25 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-11
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">1. 前提说明</h2>
<p>CentOS7/8版本官方已经归档，默认的安装源无法使用，而且网上大多数提供的国内yum地址也大部分失效。故为了快速有效的使用在线yum，结合国内清华源，来生成有效的repo文件，帮助实施人员解决手动配置慢等问题。</p>
<h2 data-id="heading-1">2. 使用方法</h2>
<p>核心命令：</p>
<pre><code class="hljs language-csharp" lang="csharp">[<span class="hljs-meta">root@localhost soft</span>]<span class="hljs-meta"># wget  https://raw.githubusercontent.com/FlowerBirds/centosv7v8-china-repo/refs/heads/main/install-repo.py</span>
[<span class="hljs-meta">root@localhost soft</span>]<span class="hljs-meta"># python install-repo.py</span>
</code></pre>
<p>默认使用Linux自带的Python2环境执行脚本，会自动检测当前系统版本，并生成repo文件。例如：</p>
<pre><code class="hljs language-bash" lang="bash">[root@localhost soft]<span class="hljs-comment"># wget https://raw.githubusercontent.com/FlowerBirds/centosv7v8-china-repo/refs/heads/main/install-repo.py</span>
--2025-12-10 16:46:52-- https://www.falvce.com/ https://raw.githubusercontent.com/FlowerBirds/centosv7v8-china-repo/refs/heads/main/install-repo.py
正在解析主机 raw.githubusercontent.com (raw.githubusercontent.com)... 185.199.109.133, 185.199.110.133, 185.199.111.133, ...
正在连接 raw.githubusercontent.com (raw.githubusercontent.com)|185.199.109.133|:443... 已连接。
已发出 HTTP 请求，正在等待回应... 200 OK
长度：9144 (8.9K) [text/plain]
正在保存至: “install-repo.py”

100%[========================================================================================================================================================&gt;] 9,144       --.-K/s 用时 0.003s

2025-12-10 16:46:52 (2.69 MB/s) - 已保存 “install-repo.py” [9144/9144])

[root@localhost soft]<span class="hljs-comment"># python install-repo.py</span>
⚠️  警告：当前为Python2环境，建议使用Python3运行（Python2已停止维护）

===== 开始备份YUM源配置 =====
已备份：/etc/yum.repos.d/CentOS-Base.repo -&gt; /etc/yum.repos.d/repo_bak_20251210_160331/CentOS-Base.repo
已备份：/etc/yum.repos.d/test.repo -&gt; /etc/yum.repos.d/repo_bak_20251210_160331/test.repo
所有.repo文件已备份至：/etc/yum.repos.d/repo_bak_20251210_160331

===== 开始识别系统版本 =====
已识别系统版本：CentOS 7.9.2009

===== 开始生成清华Vault源 =====
✅ 成功生成CentOS 7.9.2009的清华源配置：/etc/yum.repos.d/CentOS-Base.repo

===== 操作完成 =====
📁 原有配置备份目录：https://www.falvce.com/ /etc/yum.repos.d/repo_bak_20251210_160331
🔧 建议执行以下命令刷新缓存：
   yum clean all &amp;&amp; yum makecache
   yum repolist enabled
[root@localhost soft]<span class="hljs-comment">#</span>
[root@localhost soft]<span class="hljs-comment"># yum clean all &amp;&amp; yum makecache</span>
已加载插件：fastestmirror, langpacks
正在清理软件源： base extras updates
Cleaning up list of fastest mirrors
Other repos take up 169 M of disk space (use --verbose <span class="hljs-keyword">for</span> details)
已加载插件：fastestmirror, langpacks
Determining fastest mirrors
base                                                                                                                                                                       | 3.6 kB  00:00:00
extras                                                                                                                                                                     | 2.9 kB  00:00:00
updates                                                                                                                                                                    | 2.9 kB  00:00:00
(1/10): base/x86_64/group_gz                                                                                                                                               | 153 kB  00:00:00
(2/10): base/x86_64/primary_db                                                                                                                                             | 6.1 MB  00:00:02
(3/10): extras/x86_64/primary_db                                                                                                                                           | 253 kB  00:00:00
(4/10): base/x86_64/other_db                                                                                                                                               | 2.6 MB  00:00:01
(5/10): extras/x86_64/filelists_db                                                                                                                                         | 305 kB  00:00:01
(6/10): extras/x86_64/other_db                                                                                                                                             | 154 kB  00:00:00
(7/10): base/x86_64/filelists_db                                                                                                                                           | 7.2 MB  00:00:04
(8/10): updates/x86_64/primary_db                                                                                                                                          |  27 MB  00:00:09
(9/10): updates/x86_64/filelists_db                                                                                                                                        |  15 MB  00:00:10
(10/10): updates/x86_64/other_db                                                                                                                                           | 1.6 MB  00:00:00
元数据缓存已建立
[root@localhost soft]<span class="hljs-comment">#  yum repolist enabled</span>
已加载插件：fastestmirror, langpacks
Loading mirror speeds from cached hostfile
源标识                                                                          源名称                                                                                                      状态
base/x86_64                                                                     CentOS-7.9.2009 - Base - Tsinghua Vault                                                                     10,072
extras/x86_64                                                                   CentOS-7.9.2009 - Extras - Tsinghua Vault                                                                      526
updates/x86_64                                                                  CentOS-7.9.2009 - Updates - Tsinghua Vault                                                                   6,173
repolist: 16,771
</code></pre>
<p>执行成功后，提示执行命令即可。脚本会将之前的repo文件进行备份，不影响后续还原。</p>
<p>脚本仓库地址：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FFlowerBirds%2Fcentosv7v8-china-repo" target="_blank" title="https://github.com/FlowerBirds/centosv7v8-china-repo" ref="nofollow noopener noreferrer">github.com/FlowerBirds…</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Vite开发环境按需编译是怎么实现的？]]></title>    <link>https://juejin.cn/post/7582169248094978054</link>    <guid>https://juejin.cn/post/7582169248094978054</guid>    <pubDate>2025-12-11T06:55:02.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7582169248094978054" data-draft-id="7582169248094945286" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Vite开发环境按需编译是怎么实现的？"/> <meta itemprop="keywords" content="前端,JavaScript,Vite"/> <meta itemprop="datePublished" content="2025-12-11T06:55:02.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="sorryhc"/> <meta itemprop="url" content="https://juejin.cn/user/3061476130044487"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Vite开发环境按需编译是怎么实现的？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3061476130044487/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    sorryhc
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-11T06:55:02.000Z" title="Thu Dec 11 2025 06:55:02 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-11
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">前言</h2>
<p><code>Vite</code>的快，我们并不陌生，主要体现在开发环境时的体验。</p>
<p>而相较于其他构建工具，<code>Vite</code>核心是依靠了现代浏览器对于原生<code>esm</code>模块的支持+按需实时编译将性能达到了极致。</p>
<p>我们基于源码来看看<code>esbuild</code>编译的完整过程。</p>
<h2 data-id="heading-1">核心流程图</h2>
<pre><code class="hljs language-bash" lang="bash">Browser Request
    ↓
Vite DevServer (Connect 中间件)
    ↓
请求路由判断
    ├─ /.vite/client → 注入客户端代码
    ├─ /@modules/* → node_modules 导入
    ├─ /src/* → 源代码文件
    └─ *.json, *.css 等 → 特殊处理
    ↓
ModuleGraph 缓存检查
    ├─ 命中缓存 → 返回
    └─ 未命中 → esbuild 编译
    ↓
TransformPlugin 流程
    ├─ pre plugins
    ├─ esbuild transform
    └─ post plugins
    ↓
发送给浏览器 (ES Modules)
</code></pre>
<h3 data-id="heading-2">DevServer入口代码</h3>
<p>这里初始化了开发服务器、模块图（缓存系统）、很多中间件（用于拦截实时编译）。</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-comment">// packages/vite/src/node/server/index.ts</span>

<span class="hljs-keyword">import</span> connect <span class="hljs-keyword">from</span> <span class="hljs-string">'connect'</span>
<span class="hljs-keyword">import</span> { createPluginContainer } <span class="hljs-keyword">from</span> <span class="hljs-string">'./pluginContainer'</span>

<span class="hljs-keyword">export</span> <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">createServer</span>(<span class="hljs-params">inlineConfig: InlineConfig = {}</span>) {
  <span class="hljs-keyword">const</span> config = <span class="hljs-keyword">await</span> <span class="hljs-title function_">resolveConfig</span>(inlineConfig, <span class="hljs-string">'serve'</span>)
  
  <span class="hljs-comment">// 创建 Express-like 应用</span>
  <span class="hljs-keyword">const</span> middlewares = <span class="hljs-title function_">connect</span>()
  <span class="hljs-keyword">const</span> httpServer = <span class="hljs-title function_">createHttpServer</span>(middlewares)
  
  <span class="hljs-comment">// 创建模块图（缓存系统）</span>
  <span class="hljs-keyword">const</span> moduleGraph = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ModuleGraph</span>(<span class="hljs-function">(<span class="hljs-params">url</span>) =&gt;</span>
    pluginContainer.<span class="hljs-title function_">resolveId</span>(url)
  )
  
  <span class="hljs-comment">// 创建插件容器（执行插件）</span>
  <span class="hljs-keyword">const</span> pluginContainer = <span class="hljs-keyword">await</span> <span class="hljs-title function_">createPluginContainer</span>(config)
  
  <span class="hljs-comment">// 核心中间件们</span>
  middlewares.<span class="hljs-title function_">use</span>(timeMiddleware)
  middlewares.<span class="hljs-title function_">use</span>(cors)
  middlewares.<span class="hljs-title function_">use</span>(<span class="hljs-title function_">transformMiddleware</span>(server))  <span class="hljs-comment">// ⭐ 重点</span>
  middlewares.<span class="hljs-title function_">use</span>(servePublicDir)
  middlewares.<span class="hljs-title function_">use</span>(serveRawFs)
  
  <span class="hljs-keyword">const</span> server = {
    middlewares,
    httpServer,
    moduleGraph,
    pluginContainer,
    <span class="hljs-attr">ws</span>: <span class="hljs-title function_">createWebSocketServer</span>(httpServer),
    <span class="hljs-comment">// ... 其他属性</span>
  }
  
  <span class="hljs-keyword">return</span> server
}
</code></pre>
<h3 data-id="heading-3">Transform中间件（请求拦截）</h3>
<p>这里是一个很经典的例子，从浏览器发起第一次<code>main.ts</code>请求开始，<code>Vite</code>做了<code>ts</code>文件的转换。</p>
<p>而后续的请求会从<code>main.ts</code>中发起。</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-comment">// packages/vite/src/node/server/middlewares/transform.ts</span>

<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">transformMiddleware</span>(<span class="hljs-params">server: ViteDevServer</span>) {
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">async</span> (<span class="hljs-attr">req</span>: <span class="hljs-title class_">IncomingMessage</span>, <span class="hljs-attr">res</span>: <span class="hljs-title class_">ServerResponse</span>, <span class="hljs-attr">next</span>: <span class="hljs-title class_">NextFunction</span>) =&gt; {
    <span class="hljs-keyword">if</span> (req.<span class="hljs-property">method</span> !== <span class="hljs-string">'GET'</span> || <span class="hljs-title function_">isSkipped</span>(req.<span class="hljs-property">url</span>)) {
      <span class="hljs-keyword">return</span> <span class="hljs-title function_">next</span>()
    }

    <span class="hljs-keyword">let</span> url = req.<span class="hljs-property">url</span>
    <span class="hljs-keyword">const</span> { pathname, search, hash } = <span class="hljs-keyword">new</span> <span class="hljs-title function_">URL</span>(url, <span class="hljs-string">`http://<span class="hljs-subst">${req.headers.host}</span>`</span>)
    
    <span class="hljs-comment">// 示例：/src/main.ts?t=123 → /src/main.ts</span>
    url = pathname + search + hash

    <span class="hljs-keyword">try</span> {
      <span class="hljs-comment">// ⭐ 核心：调用加载和转换</span>
      <span class="hljs-keyword">const</span> result = <span class="hljs-keyword">await</span> <span class="hljs-title function_">transformRequest</span>(url, server, {
        <span class="hljs-attr">raw</span>: req.<span class="hljs-property">headers</span>[<span class="hljs-string">'accept'</span>]?.<span class="hljs-title function_">includes</span>(<span class="hljs-string">'application/octet-stream'</span>),
      })

      <span class="hljs-keyword">if</span> (result) {
        <span class="hljs-keyword">const</span> <span class="hljs-keyword">type</span> = <span class="hljs-title function_">isDirectCSSRequest</span>(url) ? <span class="hljs-string">'text/css'</span> : <span class="hljs-string">'application/javascript'</span>
        res.<span class="hljs-title function_">setHeader</span>(<span class="hljs-string">'Content-Type'</span>, <span class="hljs-keyword">type</span>)
        res.<span class="hljs-title function_">setHeader</span>(<span class="hljs-string">'Cache-Control'</span>, <span class="hljs-string">'no-cache'</span>)
        res.<span class="hljs-title function_">setHeader</span>(<span class="hljs-string">'ETag'</span>, <span class="hljs-title function_">getEtag</span>(result.<span class="hljs-property">code</span>))
        
        <span class="hljs-keyword">return</span> res.<span class="hljs-title function_">end</span>(result.<span class="hljs-property">code</span>)
      }
    } <span class="hljs-keyword">catch</span> (e) {
      <span class="hljs-comment">// 错误处理</span>
      <span class="hljs-keyword">if</span> (e.<span class="hljs-property">code</span> === <span class="hljs-string">'ENOENT'</span>) {
        <span class="hljs-keyword">return</span> <span class="hljs-title function_">next</span>()
      }
      <span class="hljs-comment">// HMR 错误通知浏览器</span>
      server.<span class="hljs-property">ws</span>.<span class="hljs-title function_">send</span>({
        <span class="hljs-attr">type</span>: <span class="hljs-string">'error'</span>,
        <span class="hljs-attr">event</span>: <span class="hljs-string">'vite:error'</span>,
        <span class="hljs-attr">err</span>: e,
      })
    }

    <span class="hljs-title function_">next</span>()
  }
}

</code></pre>
<h3 data-id="heading-4">请求转换核心逻辑</h3>
<p>这里是核心的源码转换逻辑，基于源码优先从模块缓存表中取，如果没有才走该模块的首次转换，最后会落到缓存中。</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-comment">// packages/vite/src/node/server/transformRequest.ts</span>

<span class="hljs-keyword">export</span> <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">transformRequest</span>(<span class="hljs-params">
  url: <span class="hljs-built_in">string</span>,
  server: ViteDevServer,
  options?: TransformOptions,
</span>) {
  <span class="hljs-comment">// 1️⃣ 获取文件内容 + 元数据</span>
  <span class="hljs-keyword">const</span> { <span class="hljs-attr">code</span>: raw, map } = <span class="hljs-keyword">await</span> <span class="hljs-title function_">loadRawRequest</span>(url, server)
  
  <span class="hljs-keyword">let</span> code = raw
  <span class="hljs-keyword">const</span> inMap = map

  <span class="hljs-comment">// 2️⃣ 检查缓存</span>
  <span class="hljs-keyword">const</span> cached = server.<span class="hljs-property">moduleGraph</span>.<span class="hljs-title function_">getModuleByUrl</span>(url)
  <span class="hljs-keyword">if</span> (!server.<span class="hljs-property">config</span>.<span class="hljs-property">command</span> === <span class="hljs-string">'serve'</span> &amp;&amp; cached?.<span class="hljs-property">transformedCode</span>) {
    <span class="hljs-keyword">return</span> {
      <span class="hljs-attr">code</span>: cached.<span class="hljs-property">transformedCode</span>,
      <span class="hljs-attr">map</span>: cached.<span class="hljs-property">map</span>,
    }
  }

  <span class="hljs-comment">// 3️⃣ 执行插件转换</span>
  <span class="hljs-keyword">const</span> result = <span class="hljs-keyword">await</span> pluginContainer.<span class="hljs-title function_">transform</span>(code, url)
  <span class="hljs-keyword">if</span> (result) {
    code = result.<span class="hljs-property">code</span>
  }

  <span class="hljs-comment">// 4️⃣ 特殊处理：自动导入注入</span>
  <span class="hljs-keyword">if</span> (!options?.<span class="hljs-property">raw</span>) {
    code = <span class="hljs-title function_">injectHelper</span>(code, url)
  }

  <span class="hljs-comment">// 5️⃣ 缓存结果</span>
  server.<span class="hljs-property">moduleGraph</span>.<span class="hljs-title function_">updateModuleInfo</span>(url, {
    <span class="hljs-attr">transformedCode</span>: code,
    <span class="hljs-attr">map</span>: result?.<span class="hljs-property">map</span>,
  })

  <span class="hljs-keyword">return</span> { code, <span class="hljs-attr">map</span>: result?.<span class="hljs-property">map</span> }
}

</code></pre>
<h3 data-id="heading-5">加载原始请求（磁盘读写）</h3>
<p>而加载和编译源码则是直接通过<code>esbuild</code>能力来实现。</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-comment">// packages/vite/src/node/server/transformRequest.ts</span>

<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">loadRawRequest</span>(<span class="hljs-params">url: <span class="hljs-built_in">string</span>, server: ViteDevServer</span>) {
  <span class="hljs-keyword">let</span> id = <span class="hljs-built_in">decodeURIComponent</span>(<span class="hljs-title function_">parseUrl</span>(url).<span class="hljs-property">pathname</span>)
  
  <span class="hljs-comment">// ⭐ 调用插件的 resolveId hook</span>
  <span class="hljs-keyword">const</span> resolveResult = <span class="hljs-keyword">await</span> server.<span class="hljs-property">pluginContainer</span>.<span class="hljs-title function_">resolveId</span>(id)
  
  <span class="hljs-keyword">if</span> (resolveResult?.<span class="hljs-property">id</span>) {
    id = resolveResult.<span class="hljs-property">id</span>
  }

  <span class="hljs-comment">// 从文件系统读取</span>
  <span class="hljs-keyword">let</span> code = <span class="hljs-keyword">await</span> fs.<span class="hljs-property">promises</span>.<span class="hljs-title function_">readFile</span>(id, <span class="hljs-string">'utf-8'</span>)
  <span class="hljs-keyword">let</span> <span class="hljs-attr">map</span>: <span class="hljs-title class_">SourceMap</span> | <span class="hljs-literal">null</span> = <span class="hljs-literal">null</span>

  <span class="hljs-comment">// 如果是 TypeScript，用 esbuild 转译</span>
  <span class="hljs-keyword">if</span> (id.<span class="hljs-title function_">endsWith</span>(<span class="hljs-string">'.ts'</span>) || id.<span class="hljs-title function_">endsWith</span>(<span class="hljs-string">'.tsx'</span>)) {
    <span class="hljs-keyword">const</span> result = <span class="hljs-keyword">await</span> esbuildService.<span class="hljs-title function_">transform</span>(code, {
      <span class="hljs-attr">loader</span>: <span class="hljs-string">'ts'</span>,
      <span class="hljs-attr">target</span>: <span class="hljs-string">'esnext'</span>,
      <span class="hljs-attr">sourcemap</span>: <span class="hljs-literal">true</span>,
    })
    code = result.<span class="hljs-property">code</span>
    map = result.<span class="hljs-property">map</span>
  }

  <span class="hljs-keyword">return</span> { code, map }
}
</code></pre>
<p>因此一次完整的编译流程如下：</p>
<pre><code class="hljs language-ruby" lang="ruby">/<span class="hljs-regexp">/ 实际请求处理过程

/</span><span class="hljs-regexp">/ 浏览器请求：GET /src</span><span class="hljs-regexp">/main.ts
/</span><span class="hljs-regexp">/ ↓
/</span><span class="hljs-regexp">/ transformMiddleware 拦截
/</span><span class="hljs-regexp">/ ↓
/</span><span class="hljs-regexp">/ transformRequest('/src</span><span class="hljs-regexp">/main.ts', server)
/</span><span class="hljs-regexp">/ ↓
/</span><span class="hljs-regexp">/ loadRawRequest: 从磁盘读取 main.ts
/</span><span class="hljs-regexp">/ ├─ 如果是 .ts，用 esbuild 转译为 .js
/</span><span class="hljs-regexp">/ └─ 返回 { code, map }
/</span><span class="hljs-regexp">/ ↓
/</span><span class="hljs-regexp">/ pluginContainer.transform(code, '/src</span><span class="hljs-regexp">/main.ts')
/</span><span class="hljs-regexp">/ ├─ vue plugin: .vue 转换为 { script, template, style }
/</span><span class="hljs-regexp">/ ├─ css-in-js plugin: 处理 styled-components 等
/</span><span class="hljs-regexp">/ ├─ import-analysis plugin: 分析依赖，重写为 /</span><span class="hljs-variable">@modules</span>/xxx
/<span class="hljs-regexp">/ └─ ...其他插件
/</span><span class="hljs-regexp">/ ↓
/</span><span class="hljs-regexp">/ 返回转换后的代码给浏览器
/</span><span class="hljs-regexp">/ ↓
/</span><span class="hljs-regexp">/ 浏览器 import './main</span>.ts<span class="hljs-string">' 
// → 收到 ESM 代码，正常执行
</span></code></pre>
<h3 data-id="heading-6">依赖解析重写</h3>
<p>而<code>Vite</code>如果这样设计，会面临一个问题：请求的数量特别大，导致浏览器首屏时间反而更久。</p>
<p><code>Vite</code>做了一层设计，将多个模块合并到一个模块，即<code>依赖解析重写</code>，如<code>vue -&gt; @modules/vue?v=xxx</code></p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-comment">// packages/vite/src/node/plugins/importAnalysis.ts</span>

<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">importAnalysisPlugin</span>(<span class="hljs-params"/>): <span class="hljs-title class_">Plugin</span> {
  <span class="hljs-keyword">return</span> {
    <span class="hljs-attr">name</span>: <span class="hljs-string">'vite:import-analysis'</span>,
    
    <span class="hljs-keyword">async</span> <span class="hljs-title function_">transform</span>(<span class="hljs-params">code: <span class="hljs-built_in">string</span>, id: <span class="hljs-built_in">string</span></span>) {
      <span class="hljs-comment">// 匹配 import/export 语句</span>
      <span class="hljs-keyword">const</span> imports = <span class="hljs-title function_">parse</span>(code) <span class="hljs-comment">// 用 es-module-lexer 解析</span>
      
      <span class="hljs-keyword">let</span> s = <span class="hljs-keyword">new</span> <span class="hljs-title class_">MagicString</span>(code)
      
      <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> imp <span class="hljs-keyword">of</span> imports) {
        <span class="hljs-comment">// 例如：import { ref } from 'vue'</span>
        <span class="hljs-keyword">const</span> source = imp.<span class="hljs-property">source</span>
        
        <span class="hljs-keyword">if</span> (<span class="hljs-title function_">isRelative</span>(source)) {
          <span class="hljs-comment">// 相对路径，保持不变</span>
          <span class="hljs-comment">// import Foo from './foo.ts'</span>
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-title function_">isBuiltin</span>(source)) {
          <span class="hljs-comment">// Node 内置模块，忽略</span>
        } <span class="hljs-keyword">else</span> {
          <span class="hljs-comment">// ⭐ NPM 包，重写为 /@modules/xxx</span>
          <span class="hljs-comment">// import { ref } from 'vue'</span>
          <span class="hljs-comment">// ↓</span>
          <span class="hljs-comment">// import { ref } from '/@modules/vue?v=xxx'</span>
          
          <span class="hljs-keyword">const</span> resolved = <span class="hljs-keyword">await</span> <span class="hljs-title function_">resolveImport</span>(source)
          <span class="hljs-keyword">const</span> rewritten = <span class="hljs-string">`/@modules/<span class="hljs-subst">${resolved.id}</span>`</span>
          
          s.<span class="hljs-title function_">overwrite</span>(imp.<span class="hljs-property">startPos</span>, imp.<span class="hljs-property">endPos</span>, 
            <span class="hljs-string">`import {...} from '<span class="hljs-subst">${rewritten}</span>'`</span>
          )
        }
      }
      
      <span class="hljs-keyword">return</span> {
        <span class="hljs-attr">code</span>: s.<span class="hljs-title function_">toString</span>(),
        <span class="hljs-attr">map</span>: s.<span class="hljs-title function_">generateMap</span>(),
      }
    }
  }
}
</code></pre>
<h3 data-id="heading-7">处理node_modules三方库请求</h3>
<p>既然将三方库依赖路径重写，那处理对应的请求也需要进行一次路径转换。</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-comment">// 当浏览器请求 /@modules/vue?v=xxx 时</span>

middlewares.<span class="hljs-title function_">use</span>(<span class="hljs-string">'/@modules/'</span>, <span class="hljs-keyword">async</span> (req, res, next) =&gt; {
  <span class="hljs-keyword">const</span> moduleName = req.<span class="hljs-property">url</span>.<span class="hljs-title function_">split</span>(<span class="hljs-string">'/'</span>)[<span class="hljs-number">2</span>]?.<span class="hljs-title function_">split</span>(<span class="hljs-string">'?'</span>)[<span class="hljs-number">0</span>]
  
  <span class="hljs-comment">// /@modules/vue → node_modules/vue/dist/vue.esm.js</span>
  <span class="hljs-keyword">const</span> modulePath = <span class="hljs-built_in">require</span>.<span class="hljs-title function_">resolve</span>(moduleName, {
    <span class="hljs-attr">paths</span>: [config.<span class="hljs-property">root</span>],
  })
  
  <span class="hljs-keyword">const</span> code = <span class="hljs-keyword">await</span> fs.<span class="hljs-property">promises</span>.<span class="hljs-title function_">readFile</span>(modulePath, <span class="hljs-string">'utf-8'</span>)
  
  <span class="hljs-comment">// 继续执行 transform 中间件处理</span>
  <span class="hljs-comment">// 确保 node_modules 中的代码也被正确处理</span>
  res.<span class="hljs-title function_">end</span>(code)
})
</code></pre>
<h3 data-id="heading-8">HMR热更新</h3>
<p>那按照这样的设计，所有模块只要经过一次编译，就会保存在模块缓存表中，热更新如何处理呢？</p>
<p><code>Vite</code>做的也比较通俗易懂，当文件系统监听到文件变化，则清除该模块相关缓存信息，然后<code>websocket</code>通知浏览器，<code>Vite client runtime</code>会重新发起相关改动模块的请求。</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-comment">// packages/vite/src/node/server/hmr.ts</span>

<span class="hljs-comment">// 当文件变更时</span>
watcher.<span class="hljs-title function_">on</span>(<span class="hljs-string">'change'</span>, <span class="hljs-keyword">async</span> (file) =&gt; {
  <span class="hljs-keyword">const</span> url = <span class="hljs-title function_">urlFromFile</span>(file, config.<span class="hljs-property">root</span>)
  
  <span class="hljs-comment">// 1️⃣ 清除模块缓存</span>
  server.<span class="hljs-property">moduleGraph</span>.<span class="hljs-title function_">invalidateModule</span>(url)
  
  <span class="hljs-comment">// 2️⃣ 收集受影响的模块</span>
  <span class="hljs-keyword">const</span> affectedModules = server.<span class="hljs-property">moduleGraph</span>.<span class="hljs-title function_">getImporters</span>(url)
  
  <span class="hljs-comment">// 3️⃣ 通过 WebSocket 通知浏览器</span>
  server.<span class="hljs-property">ws</span>.<span class="hljs-title function_">send</span>({
    <span class="hljs-attr">type</span>: <span class="hljs-string">'update'</span>,
    <span class="hljs-attr">event</span>: <span class="hljs-string">'vite:beforeUpdate'</span>,
    <span class="hljs-attr">updates</span>: affectedModules.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">m</span> =&gt;</span> ({
      <span class="hljs-attr">type</span>: m.<span class="hljs-property">isSelfAccepting</span> ? <span class="hljs-string">'js-update'</span> : <span class="hljs-string">'full-reload'</span>,
      <span class="hljs-attr">event</span>: <span class="hljs-string">'vite:beforeUpdate'</span>,
      <span class="hljs-attr">path</span>: m.<span class="hljs-property">url</span>,
      <span class="hljs-attr">acceptedPath</span>: url,
      <span class="hljs-attr">timestamp</span>: <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>(),
    }))
  })
})
</code></pre>
<h3 data-id="heading-9">HMR客户端脚本注入</h3>
<p>这就是客户端热更新的核心代码。</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-comment">// packages/vite/src/client/client.ts</span>

<span class="hljs-comment">// 注入到每个 HTML 的脚本</span>
<span class="hljs-keyword">const</span> hotModule = <span class="hljs-keyword">import</span>.<span class="hljs-property">meta</span>.<span class="hljs-property">hot</span>

<span class="hljs-keyword">if</span> (hotModule) {
  hotModule.<span class="hljs-title function_">accept</span>(<span class="hljs-function">(<span class="hljs-params">{ <span class="hljs-keyword">default</span>: newModule }</span>) =&gt;</span> {
    <span class="hljs-comment">// 接收模块更新</span>
    <span class="hljs-comment">// 执行自定义 HMR 逻辑或完整重载</span>
  })
  
  <span class="hljs-comment">// 监听服务器推送</span>
  hotModule.<span class="hljs-title function_">on</span>(<span class="hljs-string">'vite:beforeUpdate'</span>, <span class="hljs-keyword">async</span> (event) =&gt; {
    <span class="hljs-keyword">if</span> (event.<span class="hljs-property">type</span> === <span class="hljs-string">'js-update'</span>) {
      <span class="hljs-comment">// 动态 import 新版本模块</span>
      <span class="hljs-keyword">await</span> <span class="hljs-keyword">import</span>(event.<span class="hljs-property">path</span> + <span class="hljs-string">`?t=<span class="hljs-subst">${event.timestamp}</span>`</span>)
    } <span class="hljs-keyword">else</span> {
      <span class="hljs-comment">// 完整页面刷新</span>
      <span class="hljs-variable language_">window</span>.<span class="hljs-property">location</span>.<span class="hljs-title function_">reload</span>()
    }
  })
}
</code></pre>
<p>因此热更新的流程总结如下：</p>
<pre><code class="hljs language-scss" lang="scss">用户编辑文件保存
    ↓
文件系统监听器检测变化
    ↓
清除 ModuleGraph 缓存
    ↓
WebSocket 通知浏览器
    ↓
浏览器发起新请求（带时间戳）
    ↓
transformMiddleware 拦截
    ↓
loadRawRequest (esbuild 编译 TS/JSX)
    ↓
pluginContainer<span class="hljs-selector-class">.transform</span> (执行插件 Vue/CSS 等)
    ↓
返回最新的 ESM 代码
    ↓
浏览器执行 HMR 回调更新页面
</code></pre>
<h2 data-id="heading-10">结尾</h2>
<p>这就是<code>Vite</code>开发环境的核心机制！按需编译+缓存+HMR推送，相比于<code>Webpack</code>，少了最早的整个bundle的构建，自然而然会快非常多，因为<code>Vite</code>在初始化根本就没有<code>build</code>的过程，甚至连<code>main.ts</code>入口文件都是实时编译的。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[人脸识别项目如何在Spring Boot项目中如何建立数据库和管理]]></title>    <link>https://juejin.cn/post/7582136489770762250</link>    <guid>https://juejin.cn/post/7582136489770762250</guid>    <pubDate>2025-12-11T05:24:49.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7582136489770762250" data-draft-id="7582136489770729482" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="人脸识别项目如何在Spring Boot项目中如何建立数据库和管理"/> <meta itemprop="keywords" content="后端,数据库,MySQL"/> <meta itemprop="datePublished" content="2025-12-11T05:24:49.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="进击的丸子"/> <meta itemprop="url" content="https://juejin.cn/user/2506542243120680"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            人脸识别项目如何在Spring Boot项目中如何建立数据库和管理
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2506542243120680/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    进击的丸子
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-11T05:24:49.000Z" title="Thu Dec 11 2025 05:24:49 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-11
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读11分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">讲讲在Spring Boot项目中如何建立数据库和管理</h2>
<p>随着智能门禁、考勤、访客系统的普及，<strong>人脸识别模块</strong>已成为众多项目的重要组成部分。在高性能的人脸识别系统中，数据库主要负责<strong>持久化存储</strong>，而识别比对操作应全部在<strong>内存中完成</strong>，以保证毫秒级响应和高并发性能。本文将介绍如何在 <strong>Spring Boot 项目</strong>中建立一个高效、可扩展的人脸识别数据库，并实现基础的人脸数据管理功能，同时结合 MySQL、Redis 与内存优化策略，提升系统整体性能。</p>
<h2 data-id="heading-1">一、基础入门介绍</h2>
<p>这里为了能让大家对SDK结合数据库有个初步了解，我们先利用<a href="https://link.juejin.cn?target=https%3A%2F%2Fai.arcsoft.com.cn%2F%3Futm_source%3DJuejin%26%26utm_medium%3Dshentao" target="_blank" title="https://ai.arcsoft.com.cn/?utm_source=Juejin&amp;&amp;utm_medium=shentao" ref="nofollow noopener noreferrer">虹软人脸识别SDK</a> 对应的<strong>ArcSoftFaceDemo</strong> ，讲解下此Demo是如何对人脸数据库进行管理的，以及如何正确地注册到 <strong>ArcFace SDK</strong> 的引擎中，以支持后续的人脸检测和识别功能。下面结合代码分析整个管理流程。</p>
<h3 data-id="heading-2">1、数据库环境准备</h3>
<p>在开始使用 ArcsoftFaceDemo 前，需要先准备好 MySQL 数据库环境。为了快速搭建，可以直接使用 <strong>Docker</strong> 启动一个数据库实例。</p>
<h5 data-id="heading-3">使用 Docker 启动 MySQL 8.0</h5>
<p>执行以下命令启动 MySQL 容器：</p>
<pre><code class="hljs language-bash" lang="bash">docker run -d \
  --name arcsoft_mysql \
  -e MYSQL_ROOT_PASSWORD=Root123 \
  -e MYSQL_DATABASE=arcsoft_face \
  -p 3306:3306 \
  registry.cn-hangzhou.aliyuncs.com/china-images/mysql:8.0
</code></pre>
<p><strong>说明：</strong></p>
<ul>
<li><code>--name arcsoft_mysql</code>：容器名称，方便管理。</li>
<li><code>MYSQL_ROOT_PASSWORD=Root123</code>：root 用户密码。</li>
<li><code>MYSQL_DATABASE=arcsoft_face</code>：初始化创建数据库 <code>arcsoft_face</code>。</li>
<li><code>-p 3306:3306</code>：将容器端口映射到宿主机，方便程序连接。</li>
<li><code>registry.cn-hangzhou.aliyuncs.com/china-images/mysql:8.0</code>：指定使用 MySQL 8.0 阿里云镜像，如果有外网环境，可直接使用mysql:8.0代替。</li>
</ul>
<blockquote>
<p>如果你想了解更多 Docker 使用方式，可以参考其他 Docker 入门文档或教程。也可直接在物理操作系统上安装MySQL</p>
</blockquote>
<h5 data-id="heading-4">数据库连接信息</h5>
<p>启动完成后，你就可以通过以下信息连接数据库：</p>
<ul>
<li><strong>URL</strong>：<code>物理机IP:3306</code></li>
<li><strong>用户名</strong>：<code>root</code></li>
<li><strong>密码</strong>：<code>Root123</code></li>
<li><strong>数据库</strong>：<code>arcsoft_face</code></li>
</ul>
<p>这样就完成了数据库环境的搭建，为 ArcsoftFaceDemo 的人脸库管理做好了基础准备。</p>
<h3 data-id="heading-5">2、工程导入与数据库配置</h3>
<p>在完成数据库环境准备后，下一步是导入 <strong>ArcSoftFaceDemo</strong> 工程，并将默认数据库配置改为 MySQL。</p>
<h5 data-id="heading-6">导入工程</h5>
<ol>
<li>从 ArcSoft <a href="https://link.juejin.cn?target=https%3A%2F%2Fai.arcsoft.com.cn%2F%3Futm_source%3DJuejin%26%26utm_medium%3Dshentao" target="_blank" title="https://ai.arcsoft.com.cn/?utm_source=Juejin&amp;&amp;utm_medium=shentao" ref="nofollow noopener noreferrer">官网</a>下载 <strong>ArcSoftFaceDemo</strong> 工程压缩包。</li>
<li>解压后，用 <strong>IntelliJ IDEA</strong> 打开工程目录。</li>
</ol>
<h5 data-id="heading-7">修改数据库配置</h5>
<p>工程默认使用的是 <strong>H2 内存数据库</strong>，适合快速演示和测试。但在正式环境中，建议切换到 <strong>MySQL</strong> 或其他持久化数据库。</p>
<p>打开 <code>application.properties</code> 文件，找到默认配置：</p>
<pre><code class="hljs language-properties" lang="properties">spring.datasource.url=jdbc:h2:file:./data/arcdb
spring.datasource.driver-class-name=org.h2.Driver
spring.datasource.username=sa
spring.datasource.password=password
spring.h2.console.enabled=true
spring.h2.console.path=/h2-console
spring.sql.init.mode=always
spring.sql.init.schema-locations=classpath:db/schema-h2.sql
</code></pre>
<p><strong>说明：</strong></p>
<ul>
<li><code>spring.datasource.url</code>：H2 数据库文件路径。</li>
<li><code>spring.datasource.driver-class-name</code>：H2 数据库驱动。</li>
<li><code>spring.datasource.username</code> / <code>spring.datasource.password</code>：数据库账号密码。</li>
<li><code>spring.h2.console.*</code>：H2 Web 控制台相关配置，方便调试。</li>
<li><code>spring.sql.init.*</code>：初始化 SQL 文件路径，用于创建示例表结构。</li>
</ul>
<h5 data-id="heading-8">H2切换为MySQL</h5>
<p>在正式环境中，我们需要将默认 H2 配置改为 MySQL。打开 <code>application.properties</code>，将数据库相关配置修改为 MySQL 连接信息：</p>
<pre><code class="hljs language-properties" lang="properties">spring.datasource.url=jdbc:mysql://localhost:3306/arcsoft_face?useUnicode=true&amp;characterEncoding=UTF-8&amp;serverTimezone=Asia/Shanghai
spring.datasource.driver-class-name=com.mysql.cj.jdbc.Driver
spring.datasource.username=root
spring.datasource.password=Root123
spring.sql.init.mode=always
spring.sql.init.schema-locations=classpath:db/schema-mysql.sql
</code></pre>
<p><strong>说明：</strong></p>
<ul>
<li><code>spring.datasource.url</code>：MySQL 连接 URL，包含数据库名 <code>arcsoft_face</code>，字符集与时区设置。<code>localhost</code>地址根据实际数据库IP地址设置</li>
<li><code>spring.datasource.driver-class-name</code>：MySQL 驱动类。</li>
<li><code>spring.datasource.username</code> / <code>spring.datasource.password</code>：MySQL 账号密码，对应 Docker 启动 MySQL 时设置的用户名和密码。</li>
<li><code>spring.sql.init.*</code>：初始化 SQL 文件路径，用于创建用户表结构（与 H2 不同，需要使用 MySQL 版本 SQL）。</li>
</ul>
<hr/>
<h5 data-id="heading-9">验证数据库连接</h5>
<ol>
<li>启动 ArcSoftFaceDemo 工程。</li>
<li>检查启动日志，确认数据库连接成功：</li>
</ol>
<pre><code class="hljs language-erlang" lang="erlang">HikariPool-<span class="hljs-number">1</span> - Starting...
HikariPool-<span class="hljs-number">1</span> - Start completed.
</code></pre>
<p>注意：使用 MySQL 客户端（如 <code>mysql</code> 命令行或 Navicat等）连接数据库，确认 <code>arcsoft_face</code> 数据库已创建成功。</p>
<hr/>
<h5 data-id="heading-10">创建用户表</h5>
<p>如果 MySQL 数据库中没有表，需要执行初始化 SQL 创建 <code>user_info</code> 表：</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> IF <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">EXISTS</span> user_info (
    id <span class="hljs-type">BIGINT</span> AUTO_INCREMENT <span class="hljs-keyword">PRIMARY</span> KEY,
    name <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">60</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,
    extra_info <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">500</span>),
    face_feature <span class="hljs-type">BLOB</span>,
    image_url <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">120</span>),
    create_time <span class="hljs-type">TIMESTAMP</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span>,
    <span class="hljs-keyword">UNIQUE</span> KEY user_info_name_uindex (name)
) ENGINE<span class="hljs-operator">=</span>InnoDB <span class="hljs-keyword">DEFAULT</span> CHARSET<span class="hljs-operator">=</span>utf8mb4;

</code></pre>
<p><strong>关键字段说明：</strong></p>
<ul>
<li><code>id</code>：用户唯一标识。</li>
<li><code>name</code>：用户名。</li>
<li><code>face_feature</code>：ArcSoft SDK 提取的人脸特征二进制数据。这里也可以根据业务来，使用text类型，存储base64编码后的字符串数据</li>
<li><code>image_url</code>：注册证存储地址。</li>
</ul>
<p>这样就完成了 MySQL 数据库接入 ArcSoftFaceDemo 的准备工作。</p>
<h3 data-id="heading-11">3、人脸注册过程说明（FaceService.java）</h3>
<p><code>FaceService</code> 是整个系统的人脸注册与管理核心逻辑，负责：</p>
<ul>
<li>从数据库读取用户人脸信息</li>
<li>注册/更新人脸到 ArcFace SDK 内存引擎</li>
<li>删除人脸</li>
<li>系统启动时批量加载人脸</li>
<li>支持从数据库、本地图片、classpath 目录三种来源初始化</li>
</ul>
<p>下面详细说明各功能模块的逻辑。</p>
<h4 data-id="heading-12">人脸注册核心方法：addUser</h4>
<pre><code class="hljs language-java" lang="java">    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">addUser</span><span class="hljs-params">(String name, <span class="hljs-type">byte</span>[] faceFeature)</span> {
        <span class="hljs-type">UserInfo</span> <span class="hljs-variable">userInfo</span> <span class="hljs-operator">=</span> userInfoMapper.selectOne(Wrappers.&lt;UserInfo&gt;lambdaQuery().eq(UserInfo::getName, name));
        <span class="hljs-keyword">if</span> (userInfo == <span class="hljs-literal">null</span>) {
            <span class="hljs-type">UserInfo</span> <span class="hljs-variable">userInfoInsert</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UserInfo</span>();
            userInfoInsert.setId((<span class="hljs-type">int</span>) (System.currentTimeMillis() % <span class="hljs-number">1_000_000_000</span>)); <span class="hljs-comment">//如果是MySQL数据库，可去掉这个，利用数据库自增长id来生成</span>
            userInfoInsert.setName(name);
            userInfoInsert.setFaceFeature(faceFeature);
            userInfoMapper.insert(userInfoInsert);
            faceEngineService.registerFaceFeature2Engine(userInfoInsert.getId(), name, faceFeature);

        } <span class="hljs-keyword">else</span> {
            <span class="hljs-type">UserInfo</span> <span class="hljs-variable">userInfoUpdate</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UserInfo</span>();
            userInfoUpdate.setId(userInfo.getId());
            userInfoUpdate.setName(name);
            userInfoUpdate.setFaceFeature(faceFeature);
            userInfoMapper.updateById(userInfoUpdate);
            faceEngineService.removeFaceFeature2Engine(userInfo.getId());
            faceEngineService.registerFaceFeature2Engine(userInfo.getId(), name, faceFeature);
        }
    }
</code></pre>
<h5 data-id="heading-13">功能说明</h5>
<p><code>addUser</code> 是 ArcSoftFaceDemo 项目中最核心的人脸注册方法，主要功能是：</p>
<ul>
<li>将输入的人脸特征（byte[]）写入数据库</li>
<li>将人脸特征注册到 ArcFace 引擎的内存特征库（内存中的索引结构）</li>
<li>同步维护两端的数据一致性（数据库 ↔ 识别引擎）</li>
</ul>
<p>ArcFace SDK 的识别能力依赖于<strong>内存中的特征库</strong>，因此每次注册、更新、删除都必须保持数据库与 SDK 内存库一致。在做新增的时候，同步两边需同时新增，保证数据一致性。</p>
<p>这里注册存储的时候，也可以同时带一些业务上的信息，如人员id，人员姓名，人员注册照存放地址等。这些信息，<strong>在数据库中可以以字段的形式进行存储归档</strong>，可参考上面<code>user_info</code>表进行字段扩展优化。如果想通过SDK的<code>searchFaceFeature</code>接口获取到这些额外信息，在<code>registerFaceFeature</code>接口中提供了<code>faceTag</code>的一个字符串类型，用于存放业务数据，可以把这些信息<strong>以JSON字符串形式存放到<code>faceTag</code>中去</strong>，当然也可通过searchId，再查询数据库的方式，把对应的人员信息查询出来</p>
<p>ArcFace SDK 提取的人脸特征是一个 <strong>byte[] 数组</strong>。5.0 的中模型特征长度在 2056字节，大模型特征特征长度3080字节，这里在做数据库字段大小的时候需要关注下</p>
<p><strong>两种存储方式：SDK的特征类型是byte[]数组类型，存储到数据库方式：</strong></p>
<p>1、可以直接使用BLOB类型，一般推荐用<strong>BLOB类型</strong>存储，可以减少编解码带来的性能损失</p>
<p>2、byte[]数组转成base64字符串，数据库用<strong>TEXT类型</strong>进行存储，如果涉及到网络传输，可使用Base64字符串</p>
<h4 data-id="heading-14">删除用户 removeUser</h4>
<pre><code class="hljs language-java" lang="java">    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">removeUser</span><span class="hljs-params">(String name)</span> {
        <span class="hljs-type">UserInfo</span> <span class="hljs-variable">userInfo</span> <span class="hljs-operator">=</span> userInfoMapper.selectOne(Wrappers.&lt;UserInfo&gt;lambdaQuery().eq(UserInfo::getName, name));
        <span class="hljs-keyword">if</span> (userInfo != <span class="hljs-literal">null</span>) {
            faceEngineService.removeFaceFeature2Engine(userInfo.getId());
            userInfoMapper.deleteById(userInfo.getId());
        }
    }
</code></pre>
<ol>
<li>根据用户名查询用户</li>
<li>从 SDK 内存引擎移除人脸</li>
<li>从数据库删除记录</li>
</ol>
<h4 data-id="heading-15">系统启动时自动加载人脸</h4>
<pre><code class="hljs language-java" lang="java">    <span class="hljs-meta">@PostConstruct</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">loadImage2Engine</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">if</span> (<span class="hljs-string">"true"</span>.equals(faceImageClear)) {
            removeAllUser();
            initSystemFace();
            <span class="hljs-type">File</span> <span class="hljs-variable">file</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">File</span>(testImagePath);
            <span class="hljs-keyword">if</span> (file.isDirectory()) {
                File[] files = file.listFiles();
                log.info(<span class="hljs-string">"开始加载本地人脸图片到引擎中"</span>);
                <span class="hljs-keyword">for</span> (File imageFile : files) {
                    <span class="hljs-type">String</span> <span class="hljs-variable">name</span> <span class="hljs-operator">=</span> imageFile.getName();
                    <span class="hljs-keyword">if</span> (name.endsWith(<span class="hljs-string">".jpg"</span>) || name.endsWith(<span class="hljs-string">".png"</span>)) {
                        <span class="hljs-type">String</span> <span class="hljs-variable">userName</span> <span class="hljs-operator">=</span> name.substring(<span class="hljs-number">0</span>, name.lastIndexOf(<span class="hljs-string">"."</span>));
                        register(userName, imageFile, <span class="hljs-literal">null</span>);
                    }
                }
                log.info(<span class="hljs-string">"加载本地人脸图片到引擎中完成"</span>);
            }
        }<span class="hljs-keyword">else</span> {
            initDatabaseFace2Engine();
        }
    }
</code></pre>
<p>系统启动后执行，用于初始化内存人脸库，为了加快识别速度，建议每次启动服务后，就直接把数据库里的人脸注册信息放到SDK引擎里，减少下次识别读取数据库带来的耗时增加。Demo中提供了有两种模式，根据配置文件的<code>register.faceimage.clean</code>进行切换</p>
<p><code>register.faceimage.clean</code>=true，每次启动会清空数据库，重新加载本地图片进行注册，同时存储到数据库和SDK</p>
<p><code>register.faceimage.clean</code>=false，每次启动从数据库读取特征，加载到SDK。Demo为了测试，会同时把本地本次未注册的图片进行存储和注册，生产环境可只保留从数据库读取加载</p>
<h3 data-id="heading-16">4、人脸识别方式</h3>
<p>这里再另外提一下，SDK人脸识别主要有以下两种方案，Demo采用的是第2种方案，也可根据实际业务使用第1种方案</p>
<h4 data-id="heading-17">①、使用 Map 列表 + <code>compareFaceFeature</code> 接口</h4>
<ul>
<li><strong>原理</strong>：将注册的人脸特征存放在 Map 或列表中，通过 SDK 的 <code>compareFaceFeature</code> 接口进行循环比对。</li>
<li><strong>优点</strong>：可灵活分组管理人脸库；支持多线程并发比对。</li>
<li><strong>缺点</strong>：当人脸库量大时，频繁调用比对接口会增加性能损耗。</li>
</ul>
<h4 data-id="heading-18">②、使用 SDK 提供的原生接口注册</h4>
<ul>
<li><strong>原理</strong>：利用<code>registerFaceFeature</code>、<code>removeFaceFeature</code>、<code>updateFaceFeature</code>、<code>searchFaceFeature</code> 组合接口，实现对人脸的增删改查</li>
<li><strong>优点</strong>：SDK 原生实现比对，性能快，资源消耗少。</li>
<li><strong>缺点</strong>：不支持分组比对；系统重启后需重新注册特征；多引擎并发时，每个引擎的人脸库需单独管理，维护复杂。</li>
</ul>
<p>​	<strong>为了实现长久保存和分布式共享，人脸特征需进行合理存储</strong></p>
<h3 data-id="heading-19">5、人脸引擎说明（FaceEngineService.java）</h3>
<p><code>FaceEngineService</code> 是人脸SDK 的核心部分，负责：</p>
<ul>
<li>人脸检测、特征提取、活体检测、属性检测等</li>
<li>人员信息的新增、删除、修改、人脸搜索</li>
</ul>
<p>下面详细说明各功能模块的逻辑。</p>
<h4 data-id="heading-20">人员新增：registerFaceFeature2Engine</h4>
<pre><code class="hljs language-java" lang="java"> <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">registerFaceFeature2Engine</span><span class="hljs-params">(<span class="hljs-type">int</span> searchId, String faceTag, <span class="hljs-type">byte</span>[] faceFeature)</span> {

        <span class="hljs-type">FaceEngineFactory</span> <span class="hljs-variable">factory</span> <span class="hljs-operator">=</span> (FaceEngineFactory) faceEngineComparePool.getFactory();

        List&lt;FaceEngine&gt; allObjects = factory.getAllObjects();
        <span class="hljs-type">FaceFeatureInfo</span> <span class="hljs-variable">faceFeatureInfo</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">FaceFeatureInfo</span>();
        faceFeatureInfo.setSearchId(searchId);
        faceFeatureInfo.setFaceTag(faceTag);
        faceFeatureInfo.setFeatureData(faceFeature);
<span class="hljs-comment">//        log.info("Register:"+ JSON.toJSONString(faceFeatureInfo));</span>
        <span class="hljs-keyword">for</span> (FaceEngine allObject : allObjects) {
            <span class="hljs-type">int</span> <span class="hljs-variable">res</span> <span class="hljs-operator">=</span> allObject.registerFaceFeature(faceFeatureInfo);
        }、、

    }
</code></pre>
<p><strong>这里重点说明下，因为我们的FaceEngine用了线程池，同时初始化了多个引擎，所以我们在向SDK注册人员信息的时候，需要给每个引擎进行注册，删除同理。</strong></p>
<h4 data-id="heading-21">人员新增：removeFaceFeature2Engine</h4>
<pre><code class="hljs language-java" lang="java">    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">removeFaceFeature2Engine</span><span class="hljs-params">(<span class="hljs-type">int</span> searchId)</span> {
        <span class="hljs-type">FaceEngineFactory</span> <span class="hljs-variable">factory</span> <span class="hljs-operator">=</span> (FaceEngineFactory) faceEngineComparePool.getFactory();
        List&lt;FaceEngine&gt; allObjects = factory.getAllObjects();
        <span class="hljs-keyword">for</span> (FaceEngine allObject : allObjects) {
            allObject.removeFaceFeature(searchId);
        }
    }
</code></pre>
<p>删除同注册接口，需要同步向所有FaceEngine库进行移除操作</p>
<h3 data-id="heading-22">二、人脸特征三层存储与分布式管理</h3>
<p>上面已经介绍了基本的数据库接入和使用，那么在实际人脸识别场景下，系统的数据存储与识别通常采用三层设计：</p>
<ol>
<li><strong>MySQL</strong>：负责持久化存储人脸特征信息，实现可靠的长期保存。</li>
<li><strong>Redis</strong>：用于异步更新与分布式缓存，实现多机器环境下的人脸特征共享。</li>
<li><strong>内存（ConcurrentHashMap / 特征池）</strong>：存储当前在线的活跃人脸特征，实现毫秒级识别。</li>
</ol>
<p>这种设计保证了系统既能持久化存储，又能在识别时获得最佳性能。</p>
<p>在 Spring Boot 项目中，实现人脸特征的管理可以从<strong>数据库建表、服务层加载、Redis缓存、特征注册与比对</strong>几个方面进行详细设计。</p>
<p>在多台识别服务器部署的分布式环境中，人脸特征需要在各节点之间保持<strong>一致性、高可用和高性能</strong>。结合内存、Redis 和数据库三层存储，设计参考方案：</p>
<h5 data-id="heading-23">1、 启动加载策略</h5>
<ul>
<li><strong>流程</strong>：
<ol>
<li>每台识别服务器启动时，先从 Redis 拉取最新的人脸特征到本地内存缓存。</li>
<li>如果 Redis 中没有特征数据（如初次部署），则从 MySQL 数据库加载。Redis 可作为 <strong>内存缓存 + 异步更新机制</strong>，保证各节点识别数据一致性</li>
<li>加载后，内存缓存即可支持毫秒级人脸识别。</li>
</ol>
</li>
<li><strong>实现示例</strong>：</li>
</ul>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@PostConstruct</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">loadFeaturesOnStartup</span><span class="hljs-params">()</span> {
    Set&lt;String&gt; keys = redisTemplate.keys(<span class="hljs-string">"face:*"</span>);
    <span class="hljs-keyword">if</span> (keys != <span class="hljs-literal">null</span> &amp;&amp; !keys.isEmpty()) {
        <span class="hljs-keyword">for</span> (String key : keys) {
            <span class="hljs-type">byte</span>[] featureData =(<span class="hljs-type">byte</span>[]) redisTemplate.opsForValue().get(key);
            <span class="hljs-keyword">if</span> (featureData != <span class="hljs-literal">null</span>) {
                featureMap.put(key.replace(<span class="hljs-string">"face:"</span>, <span class="hljs-string">""</span>), featureData);
            }
        }
    } <span class="hljs-keyword">else</span> {
        <span class="hljs-comment">// Redis为空，从数据库加载</span>
        List&lt;FaceFeature&gt; features = repository.findAll();
        <span class="hljs-keyword">for</span> (FaceFeature f : features) {
            featureMap.put(f.getUserId(), f.getFeature());
            redisTemplate.opsForValue().set(<span class="hljs-string">"face:"</span> + f.getUserId(), f.getFeature());
        }
    }
}
</code></pre>
<ul>
<li><strong>优势</strong>：
<ul>
<li>避免每次识别都访问数据库，提高性能。</li>
<li>启动即加载最新特征，保证识别数据实时性。</li>
</ul>
</li>
</ul>
<h5 data-id="heading-24">2、 特征更新与同步策略</h5>
<p>在分布式场景下，用户新增、删除或更新人脸特征时，需要保证所有节点内存保持一致：</p>
<ol>
<li>
<p><strong>更新顺序</strong>：</p>
<p><strong>写内存</strong>：立即更新本地内存缓存，保证识别服务实时可用。</p>
<ul>
<li><strong>写 Redis</strong>：同步到 Redis，作为分布式共享层。</li>
<li><strong>写数据库</strong>：异步持久化到 MySQL，保证长期数据安全。</li>
</ul>
</li>
<li>
<p><strong>同步机制</strong>：</p>
<ul>
<li>利用 Redis <strong>Pub/Sub</strong> 或消息队列（Kafka、RabbitMQ）广播更新事件。</li>
<li>其他节点接收到更新事件后，刷新本地内存特征缓存。</li>
</ul>
</li>
</ol>
<ul>
<li><strong>示例逻辑</strong>：</li>
</ul>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">updateFeature</span>(<span class="hljs-params"><span class="hljs-built_in">String</span> userId, byte[] feature</span>) {
    <span class="hljs-comment">// 更新本地内存</span>
    featureMap.<span class="hljs-title function_">put</span>(userId, feature);
    <span class="hljs-comment">// 更新 Redis</span>
    redisTemplate.<span class="hljs-title function_">opsForValue</span>().<span class="hljs-title function_">set</span>(<span class="hljs-string">"face:"</span> + userId, feature);
    <span class="hljs-comment">// 发布更新事件通知其他节点</span>
    redisTemplate.<span class="hljs-title function_">convertAndSend</span>(<span class="hljs-string">"face:update"</span>, userId);
    <span class="hljs-comment">// 异步更新数据库</span>
    <span class="hljs-title function_">asyncUpdateDatabase</span>(userId, feature);
}

<span class="hljs-comment">// 订阅事件刷新内存</span>
<span class="hljs-meta">@EventListener</span>
<span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">handleRedisUpdateEvent</span>(<span class="hljs-params">Message message</span>) {
    <span class="hljs-title class_">String</span> userId = (<span class="hljs-title class_">String</span>) message.<span class="hljs-title function_">getBody</span>();
    <span class="hljs-title class_">String</span> feature = redisTemplate.<span class="hljs-title function_">opsForValue</span>().<span class="hljs-title function_">get</span>(<span class="hljs-string">"face:"</span> + userId);
    <span class="hljs-keyword">if</span> (feature != <span class="hljs-literal">null</span>) {
        featureMap.<span class="hljs-title function_">put</span>(userId, feature);
    }
}
</code></pre>
<p>通过合理的存储架构和内存优化，Spring Boot 项目的人脸识别系统可以在保证高性能的同时，实现可扩展、分布式的人脸管理功能，为智能门禁、考勤和访客系统提供稳定支撑。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[终于来了！Flutter 拥有了一个可用的液态玻璃解决方案！]]></title>    <link>https://juejin.cn/post/7582200865907589154</link>    <guid>https://juejin.cn/post/7582200865907589154</guid>    <pubDate>2025-12-11T05:26:15.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7582200865907589154" data-draft-id="7581324707480256553" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="终于来了！Flutter 拥有了一个可用的液态玻璃解决方案！"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2025-12-11T05:26:15.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="JarvanMo"/> <meta itemprop="url" content="https://juejin.cn/user/2348212565845704"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            终于来了！Flutter 拥有了一个可用的液态玻璃解决方案！
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2348212565845704/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    JarvanMo
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-11T05:26:15.000Z" title="Thu Dec 11 2025 05:26:15 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-11
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>关注微信公众号： OpenFlutter</p>
</blockquote>
<p>简史回顾。</p>
<h3 data-id="heading-0">以前的尝试及其不足之处</h3>
<p>让我们来看看 <strong>pub.dev</strong>（Flutter 包管理网站）。</p>
<p>如果我们搜索 <code>liquid glass</code>（液态玻璃），我们会找到以下几个软件包：</p>





































<table><thead><tr><th><strong>软件包名称</strong></th><th><strong>关键问题和评价</strong></th></tr></thead><tbody><tr><td><a href="https://link.juejin.cn?target=https%3A%2F%2Fpub.dev%2Fpackages%2Fliquid_glass" target="_blank" title="https://pub.dev/packages/liquid_glass" ref="nofollow noopener noreferrer">liquid_glass</a></td><td><strong>无示例，无 GitHub 链接</strong>。有些可疑。</td></tr><tr><td><a href="https://link.juejin.cn?target=https%3A%2F%2Fpub.dev%2Fpackages%2Fliquid_glass_renderer" target="_blank" title="https://pub.dev/packages/liquid_glass_renderer" ref="nofollow noopener noreferrer">liquid_glass_renderer </a></td><td>非常优秀，高票支持，跨平台，<strong>可能是目前最好的尝试</strong>。但<strong>仅适用于 Impeller</strong> 渲染引擎，因此<strong>不支持 Windows 和 Web</strong> 平台。存在<strong>性能问题</strong>。</td></tr><tr><td><a href="https://link.juejin.cn?target=https%3A%2F%2Fpub.dev%2Fpackages%2Fcupertino_native" target="_blank" title="https://pub.dev/packages/cupertino_native" ref="nofollow noopener noreferrer">cupertino_native</a></td><td>使用<strong>原生 iOS 组件</strong>。由 Serverpod 创始人周末匆忙编写。<strong>非跨平台</strong>。</td></tr><tr><td><a href="https://link.juejin.cn?target=https%3A%2F%2Fpub.dev%2Fpackages%2Fadaptive_platform_ui" target="_blank" title="https://pub.dev/packages/adaptive_platform_ui" ref="nofollow noopener noreferrer">adaptive_platform_ui</a></td><td>根据平台渲染组件。<strong>非跨平台</strong>。</td></tr><tr><td><a href="https://link.juejin.cn?target=https%3A%2F%2Fpub.dev%2Fpackages%2Foc_liquid_glass" target="_blank" title="https://pub.dev/packages/oc_liquid_glass" ref="nofollow noopener noreferrer">oc_liquid_glass</a></td><td><strong>依赖 Impeller</strong>。在 Windows 和 Web 上不起作用。</td></tr><tr><td><a href="https://link.juejin.cn?target=https%3A%2F%2Fpub.dev%2Fpackages%2Fliquid_glass_ui" target="_blank" title="https://pub.dev/packages/liquid_glass_ui" ref="nofollow noopener noreferrer">liquid_glass_ui</a></td><td>仅一行代码实现了一个带有 <code>DropFilter.blur</code> 的<strong>常规玻璃拟物容器 (glassmorphic container)</strong> 。作者获得了一些赞和下载，但<strong>意义何在</strong>？😕</td></tr><tr><td><a href="https://link.juejin.cn?target=https%3A%2F%2Fpub.dev%2Fpackages%2Fliquid_glass_ui_design" target="_blank" title="https://pub.dev/packages/liquid_glass_ui_design" ref="nofollow noopener noreferrer">liquid_glass_ui_design</a></td><td>这可能是<strong>传统玻璃拟物设计（磨砂玻璃效果）<strong>中最完整的 UI 库。像前一个包一样，作者只是利用了“liquid”这个词。值得一试，但</strong>无论如何都不是液态玻璃</strong>。</td></tr></tbody></table>
<p><strong>总结一下</strong>：现有的解决方案要么<strong>依赖 Impeller</strong>，要么<strong>使用原生 iOS 组件</strong>，因此<strong>无法实现跨平台</strong>；或者它们只是提供了<strong>常规的玻璃拟物设计，完全没有“液态”效果</strong>。</p>
<hr/>
<h3 data-id="heading-1">英雄登场</h3>
<p>而我们的英雄是：</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fpub.dev%2Fpackages%2Fliquid_glass_easy" target="_blank" title="https://pub.dev/packages/liquid_glass_easy" ref="nofollow noopener noreferrer">liquid_glass_easy</a></p>
<blockquote>
<p>这是一个 Flutter 软件包，它能够添加实时、交互式的液态玻璃透镜（Liquid Glass Lenses）效果。
这些动态透镜可以对底层内容进行<strong>放大、扭曲、模糊、着色和折射</strong>处理，从而创造出<strong>引人注目的、玻璃般的视觉效果</strong>，并<strong>流畅地响应移动和触摸</strong>。</p>
</blockquote>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2d7954cbcb2749ffb7e314bd0c7fd617~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmFydmFuTW8=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766035575&amp;x-signature=Ak6hZcXrIrX%2FfbmVmuAdF5SyKdc%3D" alt="image.png" loading="lazy"/></p>
<blockquote>
<p>与<strong>传统的玻璃拟物（Glassmorphism）<strong>或</strong>静态模糊效果</strong>不同，<code>LiquidGlassEasy</code> 模拟了<strong>真实的玻璃物理特性</strong>，包括完整的<strong>折射、扭曲和流体响应能力</strong>。
它能<strong>实时捕获并折射</strong>（refract）实时背景内容，从而产生<strong>身临其境、响应动态</strong>的视觉效果，为你的 UI 带来<strong>深度和真实感</strong>。</p>
</blockquote>
<h3 data-id="heading-2">主要特性</h3>
<ul>
<li><strong>💠 真实的液态玻璃视觉效果</strong>：以流动的透明度、柔和的高光和<strong>自然弯曲光线的折射</strong>，来重现真实玻璃的外观和物理特性。</li>
<li><strong>🌀 实时透镜渲染</strong>：当元素在玻璃后面移动时，立即看到<strong>扭曲、模糊、着色和折射</strong>做出响应。</li>
<li><strong>🎨 自定义形状</strong>：将透镜设计为<strong>圆角矩形、圆形或平滑的超椭圆</strong>，使其完美匹配你的界面风格。</li>
<li><strong>🌈 完全可定制的效果</strong>：控制<strong>着色颜色、强度、柔和度、折射深度和光线方向</strong>，实现精确的玻璃行为。</li>
<li><strong>🧠 控制器驱动的动画</strong>：通过 <strong><code>LiquidGlassController</code></strong>，实时显示、隐藏或动画化透镜。</li>
<li><strong>⚙️ 着色器驱动、GPU 加速的管线</strong>：即使有多个动态透镜，也能确保<strong>平滑、高 FPS 的性能</strong>。</li>
<li><strong>📱 跨平台兼容性</strong>：在 <strong>Android、iOS、Web、macOS 和 Windows</strong> 上无缝运行。</li>
</ul>
<p>让我们一起尝试</p>
<p>将软件包添加到项目：</p>
<pre><code class="hljs language-bash" lang="bash">flutter pub add liquid_glass_easy
</code></pre>
<p>或者</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-comment"># 在 pubspec.yaml 文件中</span>
<span class="hljs-attr">dependencies:</span>
  <span class="hljs-attr">flutter:</span>
    <span class="hljs-attr">sdk:</span> <span class="hljs-string">flutter</span>
  <span class="hljs-attr">liquid_glass_easy:</span> <span class="hljs-string">^[latest_version]</span>
</code></pre>
<p>pub.dev 上的<a href="https://link.juejin.cn?target=https%3A%2F%2Fpub.dev%2Fpackages%2Fliquid_glass_easy%2Fexample" target="_blank" title="https://pub.dev/packages/liquid_glass_easy/example" ref="nofollow noopener noreferrer">示例 (Example)标签页</a>包含了官方示例，代码相当长，因此我不会在这里重新粘贴。</p>
<p>但我从中得到的信息是，我们需要使用<strong>两个组件（Widget）<strong>来创建液态玻璃效果：</strong> <code>LiquidGlassView</code></strong> 和 <strong><code>LiquidGlass</code></strong>。</p>
<hr/>
<h3 data-id="heading-3">组件作用简述</h3>

















<table><thead><tr><th><strong>组件名称</strong></th><th><strong>作用</strong></th></tr></thead><tbody><tr><td><strong><code>LiquidGlassView</code></strong></td><td>这是<strong>背景捕获器</strong>，它包裹住需要被“液态玻璃”效果影响的<strong>底层内容</strong>。它捕获<strong>其下方的实时渲染内容</strong>，并将该内容作为纹理提供给 <code>LiquidGlass</code>。</td></tr><tr><td><strong><code>LiquidGlass</code></strong></td><td>这是<strong>液态玻璃透镜</strong>本身。它必须位于 <code>LiquidGlassView</code> <strong>内部</strong>，并利用捕获到的背景纹理，通过着色器渲染出<strong>折射、扭曲和模糊</strong>的动态效果。</td></tr></tbody></table>
<pre><code class="hljs language-dart" lang="dart">
LiquidGlassView(
          controller: viewController,
          backgroundWidget: Image.network(
                                 <span class="hljs-string">"https://raw.githubusercontent.com/AhmeedGamil/liquid_glass_easy_assets/refs/heads/main/flower.jpg"</span>,
                                fit: BoxFit.fitWidth,
                                width: <span class="hljs-built_in">double</span>.infinity,
                                height: <span class="hljs-built_in">double</span>.infinity,
                            ),
          pixelRatio: <span class="hljs-number">1</span>,
          useSync: <span class="hljs-keyword">true</span>,
          realTimeCapture: <span class="hljs-keyword">true</span>,
          refreshRate: LiquidGlassRefreshRate.deviceRefreshRate,
          children: [            
               LiquidGlass(
                controller: lensController,
                position:
                <span class="hljs-keyword">const</span> LiquidGlassAlignPosition(alignment: Alignment.center),
                width: <span class="hljs-number">100</span>,
                height: <span class="hljs-number">100</span>,
                magnification: <span class="hljs-number">1</span>,
                enableInnerRadiusTransparent: <span class="hljs-keyword">false</span>,
                diagonalFlip: <span class="hljs-number">0</span>,
                distortion: <span class="hljs-number">0.225</span>,
                distortionWidth: <span class="hljs-number">50</span>,
                draggable: <span class="hljs-keyword">true</span>,
                outOfBoundaries: <span class="hljs-keyword">true</span>,
                blur: LiquidGlassBlur(sigmaX: <span class="hljs-number">0.75</span>, sigmaY: <span class="hljs-number">0.75</span>),
                shape: RoundedRectangleShape(
                    <span class="hljs-comment">//highDistortionOnCurves: true,</span>
                    cornerRadius: <span class="hljs-number">50</span>,
                    borderWidth: <span class="hljs-number">1</span>,
                    borderSoftness: <span class="hljs-number">2.5</span>,
                    lightIntensity: <span class="hljs-number">1.5</span>,
                    lightDirection: <span class="hljs-number">39.0</span>),
              child:
                Container(
                  decoration:  BoxDecoration(borderRadius: BorderRadius.circular(<span class="hljs-number">50</span>),),
                  child: InkWell(
                    borderRadius: BorderRadius.circular(<span class="hljs-number">50</span>),
                      child: Container(
                          height: <span class="hljs-number">50</span>,
                          width: <span class="hljs-number">50</span>,
                          child: Icon(
                            color: Colors.white,
                          Icons.pause,
                            size: <span class="hljs-number">36</span>,
                          ))),
                ),
              ),
</code></pre>
<p>我们需要创建<strong>视图控制器（view controller）和透镜控制器（lens controller）</strong> ：</p>
<pre><code class="hljs language-dart" lang="dart">
<span class="hljs-comment">// 创建视图控制器：用于控制 LiquidGlassView 捕获的背景内容</span>
<span class="hljs-keyword">final</span> viewController = LiquidGlassViewController();
<span class="hljs-comment">// 创建透镜控制器：用于控制 LiquidGlass 效果（例如：显示/隐藏/动画）</span>
<span class="hljs-keyword">final</span> lensController = LiquidGlassController();

</code></pre>
<p>然后我们会得到下面的：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e21e3be755564bd19b0f7fb40b3a2670~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmFydmFuTW8=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766035575&amp;x-signature=hcnPOeZVTeN7XcFnLaCVBAyS8ks%3D" alt="image.png" loading="lazy"/></p>
<p><strong>GIF 画质比较低，是为了帮你节省流量 😉。</strong> 但这个液态玻璃效果很不错，对吧？</p>
<p>接下来，我们来看看同一个示例 App 中的更多例子。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9abac56f88d543d48292a1cffa5f91f0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmFydmFuTW8=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766035575&amp;x-signature=wyQUxvjszKcka7GDwRVRstMHYQw%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0896d2fe780e4c68b155bb722a336328~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmFydmFuTW8=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766035575&amp;x-signature=4tcu5QCyCljoRUcXd46f1zS9AGc%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-4">文档</h3>
<p>pub.dev 上的<strong>文档</strong>比较基础，但<strong>类（Classes）的注释很充分</strong>，并且提供了一个<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FAhmeedGamil%2Fliquid_glass_easy%2Fblob%2Fmain%2Flib%2Fsrc%2Fdemos%2Fliquid_glass_showcase.dart" target="_blank" title="https://github.com/AhmeedGamil/liquid_glass_easy/blob/main/lib/src/demos/liquid_glass_showcase.dart" ref="nofollow noopener noreferrer">展示应用</a> ，允许用户试玩各种属性：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b00ade9d06e34f0b9e6e31e0fef8f493~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmFydmFuTW8=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766035575&amp;x-signature=%2F5%2FQpMnSZYcLZC6GsfuCjtPUUTg%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d6c653905240414d8c5c3f94f90f3ca9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmFydmFuTW8=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766035575&amp;x-signature=rOF2Roy6vHbaXjOeBIRH3j3KKgA%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/446221b4bbe9489bbce2509cc931d1a4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmFydmFuTW8=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766035575&amp;x-signature=VeCa%2BX4zqGOlUS%2FoUVZjhcLPxlc%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-5">创建液态玻璃组件</h3>
<p>文档中没有说明如何制作**“液态”<strong>组件。此外，这个软件包也没有提供任何</strong>即用型的液态组件**。</p>
<p>因此，我猜唯一且显而易见的方法是：将某个组件作为 <strong><code>LiquidGlass</code></strong> 的 <strong><code>child</code></strong>，并将其设置为<strong>透明</strong>。</p>
<p>以下是我<strong>快速且粗糙</strong>地尝试创建一个<strong>液态按钮</strong>：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/45268ce9dac34774b83bf05ca1e95089~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmFydmFuTW8=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766035575&amp;x-signature=Jo8VPCgA3gUsozUV3czH%2BxzDRWI%3D" alt="image.png" loading="lazy"/></p>
<pre><code class="hljs language-dart" lang="dart">Widget build(BuildContext context) {
    <span class="hljs-keyword">return</span> Scaffold(
      appBar: AppBar(
        title: <span class="hljs-keyword">const</span> Text(<span class="hljs-string">'Liquid button'</span>),
        centerTitle: <span class="hljs-keyword">true</span>,
      ),
      body: LiquidGlassView(
        backgroundWidget:<span class="hljs-comment">// Image.asset('assets/images/background/purple_texture_dark.webp', fit: BoxFit.cover),</span>
         Image.network(
        <span class="hljs-string">"https://raw.githubusercontent.com/AhmeedGamil/liquid_glass_easy_assets/refs/heads/main/socotra_tree_2.jpg"</span>,
        fit: BoxFit.cover,
        width: <span class="hljs-built_in">double</span>.infinity,
        height: <span class="hljs-built_in">double</span>.infinity,
      ),
        children: [
          LiquidGlass(
            width: <span class="hljs-number">300</span>,
            height: <span class="hljs-number">70</span>,
            magnification: <span class="hljs-number">1</span>,
            distortion: <span class="hljs-number">0.2</span>,
            distortionWidth: <span class="hljs-number">50</span>,
            blur: LiquidGlassBlur(sigmaX: <span class="hljs-number">1.75</span>, sigmaY: <span class="hljs-number">0.75</span>),
                shape: RoundedRectangleShape(
                    <span class="hljs-comment">//highDistortionOnCurves: true,</span>
                    cornerRadius: <span class="hljs-number">24</span>,
                    borderWidth: <span class="hljs-number">3</span>,
                    borderSoftness: <span class="hljs-number">5.5</span>,
                    lightIntensity: <span class="hljs-number">1.5</span>,
                ),
            position: LiquidGlassAlignPosition(alignment: Alignment.center),
            
            child: Center(child: 
            SizedBox(
              width: <span class="hljs-number">300</span>,
              height: <span class="hljs-number">70</span>,
              child: FilledButton(onPressed: () {  },
              style: FilledButton.styleFrom(
                backgroundColor: Colors.transparent, 
                foregroundColor: Colors.white,
                overlayColor: Colors.yellow,
                surfaceTintColor: Colors.blue,
              ), 
              child: Text(<span class="hljs-string">'Click me!'</span>, style: TextStyle(fontSize: <span class="hljs-number">24</span>,),)),
            )), 
          ),
        ],
      ),
    );
  }
}
</code></pre>
<h3 data-id="heading-6">性能</h3>
<p>不幸的是，我用于测试 <code>liquid_glass_easy</code> 的项目有些老旧，<strong>Android 构建失败了</strong>。我懒得去修复它，反正这个项目只是用于教育用途。</p>
<p>但<strong>在 Windows 平台上，它对性能完全没有影响</strong>。（我已经对上面带有按钮的页面进行了性能分析）。</p>
<h3 data-id="heading-7">总结</h3>
<p>我并不认为液态玻璃效果有多么重要。它不会让一个无用的 App 变得有用，它的缺失也不会让一个有用的 App 变得无用。所以，<strong>我个人不打算在我的项目中使用它</strong>。</p>
<p>但是，作为一个 <strong>Flutter 爱好者</strong>，我很高兴这个解决方案的存在，并且我确信<strong>其他解决方案</strong>（可能更优秀的）也正在路上。我相信，<strong>很快在 Flutter 中创建液态玻璃组件将比在 SwiftUI 中更容易</strong>。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[LOG：如何在Linux系统安装微软雅黑字体]]></title>    <link>https://juejin.cn/post/7582155513585975348</link>    <guid>https://juejin.cn/post/7582155513585975348</guid>    <pubDate>2025-12-11T04:21:40.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7582155513585975348" data-draft-id="7582133314686812212" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="LOG：如何在Linux系统安装微软雅黑字体"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2025-12-11T04:21:40.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="披荆斩棘的哥哥"/> <meta itemprop="url" content="https://juejin.cn/user/1415826709423757"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            LOG：如何在Linux系统安装微软雅黑字体
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1415826709423757/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    披荆斩棘的哥哥
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-11T04:21:40.000Z" title="Thu Dec 11 2025 04:21:40 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-11
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    8
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>安装微软雅黑字体，操作系统：Ubuntu22.04</p>
</blockquote>
<ol>
<li>准备字体文件，下载微软雅黑字体，字体格式<code>ttf</code>，文件名称：<code>msyh.ttf</code> <code>msyhbd.ttf</code>。</li>
<li>打开系统字体文件夹：<code>/usr/share/fonts/truetype</code>，创建文件夹：<code>mshy</code>，复制上述字体文件。</li>
</ol>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">cd</span> /usr/share/fonts/truetype
sudo <span class="hljs-built_in">mkdir</span> mshy
sudo <span class="hljs-built_in">cp</span> /path/to/msyh.ttf /usr/share/fonts/truetype/mshy/msyh.ttf
sudo <span class="hljs-built_in">cp</span> /path/to/msyhbd.ttf /usr/share/fonts/truetype/mshy/msyhbd.ttf
</code></pre>
<ol start="3">
<li>修改文件权限为<code>644</code>：</li>
</ol>
<pre><code class="hljs language-bash" lang="bash">sudo <span class="hljs-built_in">chmod</span> 644 /usr/share/fonts/truetype/mshy/*.ttf
</code></pre>
<ol start="4">
<li>下载安装字体必要的工具：</li>
</ol>
<pre><code class="hljs language-bash" lang="bash">sudo apt-get update
sudo apt-get install xfonts-utils
sudo apt-get install fontconfig
</code></pre>
<ol start="5">
<li>创建字体的<code>fonts.scale</code>文件，控制字体旋转缩放：</li>
</ol>
<pre><code class="hljs language-bash" lang="bash">sudo mkfontscale
</code></pre>
<ol start="6">
<li>创建字体的<code>fonts.dir</code>文件，控制字体粗斜体：</li>
</ol>
<pre><code class="hljs language-bash" lang="bash">sudo mkfontdir
</code></pre>
<ol start="7">
<li>建立字体缓存信息：</li>
</ol>
<pre><code class="hljs language-bash" lang="bash">sudo fc-cache -fv
</code></pre>
<ol start="8">
<li>查看字体是否成功安装：</li>
</ol>
<pre><code class="hljs language-bash" lang="bash">fc-list
</code></pre>
<ol start="9">
<li>完成。</li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Python对接天远数据多头借贷API：AES加密解密、代码实现与数据深度解析]]></title>    <link>https://juejin.cn/post/7582118538562699283</link>    <guid>https://juejin.cn/post/7582118538562699283</guid>    <pubDate>2025-12-11T04:33:51.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7582118538562699283" data-draft-id="7582163781183438854" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Python对接天远数据多头借贷API：AES加密解密、代码实现与数据深度解析"/> <meta itemprop="keywords" content="API,大数据"/> <meta itemprop="datePublished" content="2025-12-11T04:33:51.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="代码方舟"/> <meta itemprop="url" content="https://juejin.cn/user/2789874177939755"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Python对接天远数据多头借贷API：AES加密解密、代码实现与数据深度解析
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2789874177939755/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    代码方舟
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-11T04:33:51.000Z" title="Thu Dec 11 2025 04:33:51 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-11
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    6
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读8分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">一、多头借贷风险数据的风控价值与应用</h2>
<p>在<strong>银行信贷审批</strong>、<strong>消费金融授信</strong>、<strong>小额贷款风控</strong>以及<strong>互联网金融反欺诈</strong>等众多场景中，精准评估申请人的多头借贷（Multi-Lending）行为是决定放款与否的关键依据。"全国自然人多头借贷风险信息查询"API，能够提供多维度的贷款行为统计与风险标签体系，通过区间化指标精准刻画用户在贷款申请、交易、还款及逾期等方面的历史与近期行为。</p>
<p>本文将作为一份详细的开发文档，深入剖析此API，详细解读其基于AES加密的请求响应机制、返回的原始数据结构以及每一个核心字段的业务含义。通过接入<strong>天远API</strong>提供的这项数据服务，开发者可以帮助企业快速构建贷前风控模型、完善贷中监控体系，并制定更科学的额度策略，从而有效降低坏账风险。</p>
<h2 data-id="heading-1">二、API接口调用示例</h2>
<p>本接口采用高安全性的加密传输机制，开发者在调用前需确保已获取 <code>Access-Id</code> 和 <code>Access-Key</code>。</p>
<h3 data-id="heading-2">1. 调用前置说明</h3>
<ul>
<li>
<p><strong>接口地址</strong>：<code>https://api.tianyuanapi.com/api/v1/JRZQ9E2A?t={13位时间戳}</code></p>
</li>
<li>
<p><strong>请求方式</strong>：POST</p>
</li>
<li>
<p><strong>安全机制</strong>：</p>
<ul>
<li>请求头需携带 <code>Access-Id</code>。</li>
<li>请求体 <code>data</code> 字段为 Base64 编码的 AES 加密字符串。</li>
<li><strong>加密算法</strong>：AES-128-CBC，PKCS7 填充，IV（初始化向量）为随机生成的16字节，拼接在密文前一并 Base64 编码。</li>
</ul>
</li>
</ul>
<h3 data-id="heading-3">2. Curl 调用示例</h3>
<p>Bash</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># 注意：data 字段必须是经过 AES 加密并 Base64 编码后的字符串</span>
<span class="hljs-comment"># 实际开发中请使用编程语言生成动态的 data 和 t (时间戳)</span>

curl -X POST "&lt;https://api.tianyuanapi.com/api/v1/JRZQ9E2A?<span class="hljs-attr">t</span>=<span class="hljs-number">1716345678000</span>&gt;<span class="hljs-string">" \
  -H "</span>Content-Type: application/json<span class="hljs-string">" \
  -H "</span>Access-Id: YOUR_ACCESS_ID<span class="hljs-string">" \
  -d '{
    "</span>data<span class="hljs-string">": "</span>U2FsdGVkX1+...<span class="hljs-string">" 
  }'
</span></code></pre>
<h3 data-id="heading-4">3. Python 完整调用代码 (含加密解密逻辑)</h3>
<p>本示例使用 <code>requests</code> 库进行网络请求，使用 <code>pycryptodome</code> 库进行 AES 加解密处理。</p>
<p>Python</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> requests
<span class="hljs-keyword">import</span> json
<span class="hljs-keyword">import</span> time
<span class="hljs-keyword">import</span> base64
<span class="hljs-keyword">from</span> Crypto.Cipher <span class="hljs-keyword">import</span> AES
<span class="hljs-keyword">from</span> Crypto.Util.Padding <span class="hljs-keyword">import</span> pad, unpad
<span class="hljs-keyword">from</span> Crypto.Random <span class="hljs-keyword">import</span> get_random_bytes

<span class="hljs-keyword">class</span> <span class="hljs-title class_">TianyuanRiskAPI</span>:
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, access_id, access_key</span>):
        self.access_id = access_id
        <span class="hljs-comment"># 密钥通常为16进制字符串，需根据实际情况处理，此处假设为16字节</span>
        self.access_key = access_key.encode(<span class="hljs-string">'utf-8'</span>)[:<span class="hljs-number">16</span>] 
        self.api_url = <span class="hljs-string">"&lt;https://api.tianyuanapi.com/api/v1/JRZQ9E2A&gt;"</span>

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">encrypt_data</span>(<span class="hljs-params">self, plain_dict</span>):
        <span class="hljs-string">"""
        AES-128-CBC 加密逻辑
        1. 生成随机 16 字节 IV
        2. 使用 PKCS7 填充数据
        3. 加密后将 IV 拼接到密文前
        4. 进行 Base64 编码
        """</span>
        <span class="hljs-keyword">try</span>:
            plain_text = json.dumps(plain_dict).encode(<span class="hljs-string">'utf-8'</span>)
            iv = get_random_bytes(<span class="hljs-number">16</span>)
            cipher = AES.new(self.access_key, AES.MODE_CBC, iv)
            encrypted_bytes = cipher.encrypt(pad(plain_text, AES.block_size))
            <span class="hljs-comment"># 拼接 IV 和 密文，然后 Base64</span>
            combined = iv + encrypted_bytes
            <span class="hljs-keyword">return</span> base64.b64encode(combined).decode(<span class="hljs-string">'utf-8'</span>)
        <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:
            <span class="hljs-built_in">print</span>(<span class="hljs-string">f"加密失败: <span class="hljs-subst">{e}</span>"</span>)
            <span class="hljs-keyword">return</span> <span class="hljs-literal">None</span>

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">decrypt_data</span>(<span class="hljs-params">self, encrypted_base64</span>):
        <span class="hljs-string">"""
        AES-128-CBC 解密逻辑
        1. Base64 解码
        2. 提取前 16 字节作为 IV
        3. 解密剩余密文并去除填充
        """</span>
        <span class="hljs-keyword">try</span>:
            encrypted_bytes = base64.b64decode(encrypted_base64)
            iv = encrypted_bytes[:<span class="hljs-number">16</span>]
            ciphertext = encrypted_bytes[<span class="hljs-number">16</span>:]
            cipher = AES.new(self.access_key, AES.MODE_CBC, iv)
            decrypted_text = unpad(cipher.decrypt(ciphertext), AES.block_size)
            <span class="hljs-keyword">return</span> json.loads(decrypted_text.decode(<span class="hljs-string">'utf-8'</span>))
        <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:
            <span class="hljs-built_in">print</span>(<span class="hljs-string">f"解密失败: <span class="hljs-subst">{e}</span>"</span>)
            <span class="hljs-keyword">return</span> <span class="hljs-literal">None</span>

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">query_risk_info</span>(<span class="hljs-params">self, name, id_card, mobile, auth_code</span>):
        <span class="hljs-comment"># 1. 构造请求参数</span>
        payload = {
            <span class="hljs-string">"name"</span>: name,
            <span class="hljs-string">"id_card"</span>: id_card,
            <span class="hljs-string">"mobile_no"</span>: mobile,
            <span class="hljs-string">"auth_authorize_file_code"</span>: auth_code <span class="hljs-comment"># 授权书编号</span>
        }

        <span class="hljs-comment"># 2. 加密参数</span>
        encrypted_data = self.encrypt_data(payload)
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> encrypted_data:
            <span class="hljs-keyword">return</span>

        <span class="hljs-comment"># 3. 发起请求</span>
        headers = {<span class="hljs-string">"Access-Id"</span>: self.access_id}
        timestamp = <span class="hljs-built_in">int</span>(time.time() * <span class="hljs-number">1000</span>)
        url = <span class="hljs-string">f"<span class="hljs-subst">{self.api_url}</span>?t=<span class="hljs-subst">{timestamp}</span>"</span>
        
        <span class="hljs-keyword">try</span>:
            response = requests.post(url, json={<span class="hljs-string">"data"</span>: encrypted_data}, headers=headers)
            res_json = response.json()

            <span class="hljs-comment"># 4. 处理响应</span>
            <span class="hljs-keyword">if</span> res_json.get(<span class="hljs-string">"code"</span>) == <span class="hljs-number">0</span>: <span class="hljs-comment"># 0 表示业务成功 </span>
                <span class="hljs-built_in">print</span>(<span class="hljs-string">"请求成功，正在解密数据..."</span>)
                <span class="hljs-comment"># 解密 data 字段</span>
                decrypted_result = self.decrypt_data(res_json.get(<span class="hljs-string">"data"</span>))
                <span class="hljs-built_in">print</span>(<span class="hljs-string">"多头借贷风险数据解析结果："</span>)
                <span class="hljs-built_in">print</span>(json.dumps(decrypted_result, indent=<span class="hljs-number">4</span>, ensure_ascii=<span class="hljs-literal">False</span>))
            <span class="hljs-keyword">else</span>:
                <span class="hljs-built_in">print</span>(<span class="hljs-string">f"API请求错误: Code <span class="hljs-subst">{res_json.get(<span class="hljs-string">'code'</span>)}</span>, Message: <span class="hljs-subst">{res_json.get(<span class="hljs-string">'message'</span>)}</span>"</span>)
        
        <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:
            <span class="hljs-built_in">print</span>(<span class="hljs-string">f"网络请求异常: <span class="hljs-subst">{e}</span>"</span>)

<span class="hljs-comment"># 使用示例</span>
<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">"__main__"</span>:
    <span class="hljs-comment"># 请替换为实际的 Access-Id 和 Access-Key</span>
    api_client = TianyuanRiskAPI(<span class="hljs-string">"YOUR_ACCESS_ID"</span>, <span class="hljs-string">"YOUR_ACCESS_KEY_128BIT"</span>)
    
    api_client.query_risk_info(
        name=<span class="hljs-string">"张三"</span>,
        id_card=<span class="hljs-string">"110101199001011234"</span>,
        mobile=<span class="hljs-string">"13800138000"</span>,
        auth_code=<span class="hljs-string">"AUTH20251210001"</span>
    )
</code></pre>
<h2 data-id="heading-5">三、核心数据结构解析</h2>
<p>API 的响应数据分为两层。第一层是公共响应参数，包含状态码和流水号；第二层是加密的 <code>data</code> 业务数据，解密后是一个包含数百个风险指标的 JSON 对象。</p>
<h3 data-id="heading-6">1. 公共响应结构</h3>






























<table><thead><tr><th><strong>字段名</strong></th><th><strong>类型</strong></th><th><strong>描述</strong></th></tr></thead><tbody><tr><td>code</td><td>int</td><td>状态码，0表示成功，非0表示异常（如1002参数解密失败）</td></tr><tr><td>message</td><td>string</td><td>错误或成功信息描述</td></tr><tr><td>transaction_id</td><td>string</td><td>业务流水号，用于排查问题</td></tr><tr><td>data</td><td>string</td><td><strong>加密后的业务数据</strong>，需解密查看</td></tr></tbody></table>
<h3 data-id="heading-7">2. 业务数据层级</h3>
<p>解密后的 JSON 数据主要包含以下几类指标：</p>
<ul>
<li><strong>机构数量统计</strong>：如贷款总机构数、近7天/30天贷款机构数。</li>
<li><strong>交易与还款行为</strong>：历史还款成功笔数、交易失败笔数。</li>
<li><strong>逾期风险指标</strong>：当前逾期状态、历史逾期天数。</li>
<li><strong>金额统计</strong>：近30天/90天/180天的交易与还款金额统计。</li>
<li/>
</ul>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-strong">**模型评分**</span>：信用风险评分、小额网贷分等。
</code></pre>
<h2 data-id="heading-8">四、字段详解</h2>
<p>由于接口返回字段极其丰富，以下列举核心风控场景中最常用的字段进行解析。注意，大部分金额和次数类字段采用<strong>区间化输出</strong>（Mapping），例如 "1" 可能代表 "(0,9)" 区间。</p>
<h3 data-id="heading-9">1. 机构申请与借贷概览</h3>



































<table><thead><tr><th><strong>参数代码</strong></th><th><strong>中文描述</strong></th><th><strong>说明/区间示例</strong></th></tr></thead><tbody><tr><td>xyp_cpl0001</td><td>贷款总机构数</td><td>区间输出，如 "1"代表(0,9)家</td></tr><tr><td>xyp_cpl0002</td><td>贷款已结清机构数</td><td>衡量用户过往信誉，区间输出</td></tr><tr><td>xyp_cpl0044</td><td>当前是否存在逾期未结清</td><td><strong>重要</strong>：1 - 逾期 ； 0 - 未逾期</td></tr><tr><td>xyp_cpl0007</td><td>消费金融类机构数</td><td>包含有场景的分期业务</td></tr><tr><td>xyp_cpl0008</td><td>网络贷款类机构数</td><td>主要指现金贷类机构</td></tr></tbody></table>
<h3 data-id="heading-10">2. 短期申请集中度（多头预警）</h3>

























<table><thead><tr><th><strong>参数代码</strong></th><th><strong>中文描述</strong></th><th><strong>说明</strong></th></tr></thead><tbody><tr><td>xyp_cpl0070</td><td>最近1天贷款机构数</td><td>突发急借指标</td></tr><tr><td>xyp_cpl0009</td><td>最近7天贷款机构数</td><td>衡量短期资金饥渴度</td></tr><tr><td>xyp_cpl0011</td><td>最近30天贷款机构数</td><td>中短期多头借贷风险指标</td></tr></tbody></table>
<h3 data-id="heading-11">3. 逾期与履约能力</h3>






























<table><thead><tr><th><strong>参数代码</strong></th><th><strong>中文描述</strong></th><th><strong>说明</strong></th></tr></thead><tbody><tr><td>xyp_cpl0028</td><td>最近1天是否发生过逾期</td><td>1-逾期，0-未逾期</td></tr><tr><td>xyp_cpl0031</td><td>最近30天是否发生过逾期</td><td>反应近期还款压力</td></tr><tr><td>xyp_cpl0071</td><td>当前逾期机构数</td><td>同时违约的平台数量</td></tr><tr><td>xyp_cpl0072</td><td>当前逾期金额</td><td>违约资金规模（区间化）</td></tr></tbody></table>
<h3 data-id="heading-12">4. 信用评分与模型分</h3>

























<table><thead><tr><th><strong>参数代码</strong></th><th><strong>中文描述</strong></th><th><strong>说明</strong></th></tr></thead><tbody><tr><td>xyp_cpl0081</td><td>信用风险评分</td><td>0-1之间，分数越高用户信用越低</td></tr><tr><td>xyp_model_score_high</td><td>小额网贷分V1</td><td>[350,950]，分数越大逾期率越</td></tr><tr><td>xyp_model_score_mid</td><td>小额分期分V1</td><td>[350,950]，分数越大逾期率越低</td></tr></tbody></table>
<h2 data-id="heading-13">五、应用价值分析</h2>
<p>通过集成<strong>天远API</strong>的多头借贷风险查询服务，开发者可以为企业风控系统带来显著价值：</p>
<ol>
<li>
<p>精准识别"拆东墙补西墙"：</p>
<p>通过分析 xyp_cpl0009 (近7天贷款机构数) 和 xyp_cpl0031 (近30天是否逾期) 等字段，系统能快速识别出急需资金周转的潜在高风险用户，有效拦截共债风险。</p>
</li>
<li>
<p>量化评估还款能力：</p>
<p>利用 xyp_cpl0039 (近30天还款成功总金额) 与 xyp_cpl0072 (当前逾期金额) 的对比，结合收入证明，金融机构可以更科学地核定授信额度，避免过度授信。</p>
</li>
<li>
<p>贷中动态监控：</p>
<p>对于存量客户，定期调用此API监控其 xyp_cpl0044 (当前是否存在逾期) 和 xyp_cpl0008 (网贷机构数) 的变化。一旦发现用户在短时间内在多家平台发生借贷行为，系统可触发预警，及时采取降额或催收策略。</p>
</li>
</ol>
<h2 data-id="heading-14">六、总结</h2>
<p>全国自然人多头借贷风险信息查询API为金融科技开发者提供了一套标准化、数据化、区间化的风控解决方案。虽然其接口涉及 AES 加密与 Base64 编码，增加了一定的对接门槛，但这也极大地保障了用户隐私数据的传输安全。</p>
<p>建议开发者在接入过程中，重点关注错误码处理（如 1002 解密失败、1007 余额不足），并建立完善的日志系统。通过合理利用<strong>天远API</strong>提供的丰富维度数据，企业将能够构建出更加坚固的风险防火墙。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Spring Method Agent：一款无侵入的Spring方法级调试神器]]></title>    <link>https://juejin.cn/post/7582163781183602694</link>    <guid>https://juejin.cn/post/7582163781183602694</guid>    <pubDate>2025-12-11T04:56:35.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7582163781183602694" data-draft-id="7582118538562715667" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Spring Method Agent：一款无侵入的Spring方法级调试神器"/> <meta itemprop="keywords" content="Java"/> <meta itemprop="datePublished" content="2025-12-11T04:56:35.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="caterpillar"/> <meta itemprop="url" content="https://juejin.cn/user/397351653214539"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Spring Method Agent：一款无侵入的Spring方法级调试神器
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/397351653214539/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    caterpillar
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-11T04:56:35.000Z" title="Thu Dec 11 2025 04:56:35 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-11
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    14
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">Spring Method Agent：一款无侵入的Spring方法级调试神器</h2>
<h3 data-id="heading-1">🎯 工具简介</h3>
<p><strong>Spring Method Agent</strong>​ 是一款面向Java开发者的高效调试工具，能够以<strong>零代码侵入</strong>的方式对Spring项目进行方法级别的测试和调试。通过Java Agent技术，在Spring应用启动时进行增强，无需修改任何业务代码即可实现方法的可视化查询与调用。</p>
<h3 data-id="heading-2">✨ 核心特性</h3>
<ul>
<li><strong>无代码侵入</strong>：基于Java Agent实现，对应用完全透明</li>
<li><strong>可视化操作</strong>：内置Web界面，直观查看和调用Spring Bean方法</li>
<li><strong>方法Mock支持</strong>：无需修改代码即可模拟方法返回值</li>
<li><strong>条件Mock</strong>：支持基于条件的智能Mock规则</li>
<li><strong>多数据类型</strong>：支持JSON、对象、数组、基本类型等多种返回值</li>
<li><strong>灵活配置</strong>：支持动态配置和规则管理</li>
</ul>
<h3 data-id="heading-3">🚀 快速开始</h3>
<h4 data-id="heading-4">1. 下载安装</h4>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgitee.com%2Fxiaowomiaomiao%2Fspring-method-agent" target="_blank" title="https://gitee.com/xiaowomiaomiao/spring-method-agent" ref="nofollow noopener noreferrer">gitee.com/xiaowomiaom…</a></p>
<h4 data-id="heading-5">2. 配置启动参数</h4>
<pre><code class="hljs language-bash" lang="bash">-javaagent:{your path}/spring-method-agent-2.0.0.jar
</code></pre>
<h4 data-id="heading-6">3. 启动应用</h4>
<p>应用启动后，工具会监听<strong>8100端口</strong>（可通过<code>-Dagent.port=8080</code>修改）</p>
<h4 data-id="heading-7">4. 访问界面</h4>
<pre><code class="hljs language-arduino" lang="arduino">http:<span class="hljs-comment">//localhost:8100</span>
</code></pre>
<h3 data-id="heading-8">🔧 Mock功能介绍</h3>
<h4 data-id="heading-9">启用Mock</h4>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">-Dsma.mockEnable</span>=<span class="hljs-literal">true</span>
<span class="hljs-attr">-Dsma.configPath</span>=/yourPath/sma-mockConfig
</code></pre>
<h4 data-id="heading-10">配置文件示例</h4>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"globalEnabled"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"rules"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"className"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"org.example.controller.EchoController"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"methodName"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"echo"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"conditionField"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"url"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"conditionValue"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"hello"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"mockReturnValue"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"lin"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"enabled"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"className"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"org.example.controller.EchoController"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"methodName"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"user"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"conditionField"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"user.name"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"conditionValue"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"bob"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"mockReturnValue"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"age"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">18</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"bob"</span>
      <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"enabled"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">]</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h4 data-id="heading-11">支持的数据类型</h4>
<ul>
<li>字符串：<code>"mockReturnValue": "lin"</code></li>
<li>数字：<code>"mockReturnValue": 3.14</code></li>
<li>布尔值：<code>"mockReturnValue": true</code></li>
<li>对象：<code>"mockReturnValue": { "age": 18, "name": "bob" }</code></li>
<li>数组：<code>"mockReturnValue": [1, 2, 3]</code></li>
<li>JSON字符串：<code>"mockReturnValue": "{ "items": [1,2,3], "count": 3 }"</code></li>
</ul>
<h3 data-id="heading-12">📊 应用场景</h3>
<h4 data-id="heading-13">1. 快速调试</h4>
<p>无需编写测试代码，直接在Web界面调用任意Spring Bean方法，查看返回结果。</p>
<h4 data-id="heading-14">2. 集成测试</h4>
<p>在联调阶段模拟依赖服务的响应，无需启动完整的依赖链。</p>
<h4 data-id="heading-15">3. 问题排查</h4>
<p>生产环境问题复现时，可以临时Mock方法返回值，快速定位问题。</p>
<h4 data-id="heading-16">4. 演示展示</h4>
<p>在演示时Mock特定数据，避免依赖外部服务的不稳定性。</p>
<h3 data-id="heading-17">🎨 使用示例</h3>
<h4 data-id="heading-18">场景一：条件Mock</h4>
<p>当用户名为"bob"时，返回预设的用户信息：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"className"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"org.example.controller.UserController"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"methodName"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"getUserInfo"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"conditionField"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"user.name"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"conditionValue"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"bob"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"mockReturnValue"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"bob"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"role"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"admin"</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h4 data-id="heading-19">场景二：异常模拟</h4>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"className"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"org.example.service.PaymentService"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"methodName"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"processPayment"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"conditionField"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"amount"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"conditionValue"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">10000</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"mockReturnValue"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"error"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"余额不足"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"code"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"INSUFFICIENT_BALANCE"</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h3 data-id="heading-20">🔄 配置参数说明</h3>













































<table><thead><tr><th>参数</th><th>说明</th><th>默认值</th></tr></thead><tbody><tr><td><code>className</code></td><td>完整类名（全限定名）</td><td>必填</td></tr><tr><td><code>methodName</code></td><td>要Mock的方法名</td><td>必填</td></tr><tr><td><code>conditionField</code></td><td>条件字段路径（可选）</td><td>可选</td></tr><tr><td><code>conditionValue</code></td><td>条件匹配值（可选）</td><td>可选</td></tr><tr><td><code>mockReturnValue</code></td><td>Mock返回值</td><td>必填</td></tr><tr><td><code>enabled</code></td><td>规则开关</td><td>true</td></tr><tr><td><code>globalEnabled</code></td><td>全局Mock开关</td><td>true</td></tr></tbody></table>
<h3 data-id="heading-21">⚡ 性能优势</h3>
<ul>
<li><strong>低开销</strong>：仅在方法调用时进行匹配检查</li>
<li><strong>按需加载</strong>：Mock规则可动态配置</li>
<li><strong>精准匹配</strong>：支持条件匹配，避免不必要的Mock开销</li>
</ul>
<h3 data-id="heading-22">📈 对比传统方案</h3>

































<table><thead><tr><th>方案</th><th>代码侵入</th><th>维护成本</th><th>灵活性</th><th>学习成本</th></tr></thead><tbody><tr><td>传统单元测试</td><td>高</td><td>高</td><td>低</td><td>高</td></tr><tr><td>Mock框架</td><td>中</td><td>中</td><td>中</td><td>中</td></tr><tr><td><strong>Spring Method Agent</strong>​</td><td><strong>无</strong>​</td><td><strong>低</strong>​</td><td><strong>高</strong>​</td><td><strong>低</strong>​</td></tr></tbody></table>
<h3 data-id="heading-23">🤝 贡献与反馈</h3>
<p>该项目已在GitHub开源，欢迎提交Issue和PR： GitHub项目地址</p>
<h3 data-id="heading-24">💡 使用建议</h3>
<ol>
<li><strong>开发环境</strong>：长期启用，提升开发效率</li>
<li><strong>测试环境</strong>：用于集成测试和场景模拟</li>
<li><strong>生产环境</strong>：仅用于紧急问题排查，建议谨慎使用</li>
</ol>
<hr/>
<p>通过这个工具，开发者可以<strong>节省大量</strong>的测试代码编写时间，<strong>提升调试效率</strong>，让Spring应用的调试和测试变得更加简单高效。立即尝试，体验无侵入式调试的魅力！</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[实现紧贴边框的高亮流光动画效果（长方形适配）]]></title>    <link>https://juejin.cn/post/7582156410319388682</link>    <guid>https://juejin.cn/post/7582156410319388682</guid>    <pubDate>2025-12-11T03:50:21.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7582156410319388682" data-draft-id="7582110969201049638" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="实现紧贴边框的高亮流光动画效果（长方形适配）"/> <meta itemprop="keywords" content="前端,JavaScript,CSS"/> <meta itemprop="datePublished" content="2025-12-11T03:50:21.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="茄汁面"/> <meta itemprop="url" content="https://juejin.cn/user/4143434758889517"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            实现紧贴边框的高亮流光动画效果（长方形适配）
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4143434758889517/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    茄汁面
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-11T03:50:21.000Z" title="Thu Dec 11 2025 03:50:21 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-11
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    7
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>在前端开发中，边框流光动画是提升界面科技感的常用效果。本文将基于精简的 HTML+CSS 代码，实现「3px 宽高亮流光 + 紧贴边框流动 + 拐角停顿」的效果，适配从正方形到长方形的容器形态，代码简洁易复用，适合直接集成到项目中。</p>
<h2 data-id="heading-0">效果核心亮点</h2>
<ul>
<li><strong>精准贴合</strong>：流光线条完全紧贴容器边框，无偏移、无超出</li>
<li><strong>精致质感</strong>：3px 纤细线条 + 蓝紫渐变 + 多层发光阴影，亮度充足不刺眼</li>
<li><strong>丝滑流动</strong>：四个拐角均有停顿过渡，拉伸时仅单维度变化，无顿挫感</li>
<li><strong>灵活适配</strong>：支持正方形、长方形等多种容器形态，无需大幅修改代码</li>
</ul>
<h2 data-id="heading-1">完整实现代码</h2>
<p>html</p>
<p>预览</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"zh-CN"</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">"UTF-8"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"viewport"</span> <span class="hljs-attr">content</span>=<span class="hljs-string">"width=device-width, initial-scale=1.0"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>3px边框流光动画<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span><span class="css">
    <span class="hljs-comment">/* 页面居中布局基础样式 */</span>
    <span class="hljs-selector-tag">body</span> {
      <span class="hljs-attribute">margin</span>: <span class="hljs-number">0</span>;
      <span class="hljs-attribute">height</span>: <span class="hljs-number">100vh</span>;
      <span class="hljs-attribute">display</span>: flex;
      <span class="hljs-attribute">justify-content</span>: center;
      <span class="hljs-attribute">align-items</span>: center;
      <span class="hljs-attribute">background-color</span>: <span class="hljs-number">#0a1929</span>; <span class="hljs-comment">/* 深色背景凸显流光效果 */</span>
    }

    <span class="hljs-comment">/* 外层容器：控制整体尺寸和阴影 */</span>
    <span class="hljs-selector-class">.container</span> {
      <span class="hljs-attribute">position</span>: relative;
      <span class="hljs-attribute">width</span>: <span class="hljs-number">200px</span>; <span class="hljs-comment">/* 可修改为任意宽度（如52%适配响应式） */</span>
      <span class="hljs-attribute">height</span>: <span class="hljs-number">200px</span>; <span class="hljs-comment">/* 可修改为任意高度（如20%适配屏幕高度） */</span>
      <span class="hljs-attribute">box-shadow</span>: <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">60px</span> <span class="hljs-built_in">rgba</span>(<span class="hljs-number">0</span>, <span class="hljs-number">188</span>, <span class="hljs-number">212</span>, <span class="hljs-number">0.3</span>);
    }

    <span class="hljs-comment">/* 内层内容框：长方形示例（宽50%+高20%） */</span>
    <span class="hljs-selector-class">.box</span> {
      <span class="hljs-attribute">width</span>: <span class="hljs-number">50%</span>;
      <span class="hljs-attribute">height</span>: <span class="hljs-number">20%</span>;
      <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">10px</span>;
      <span class="hljs-attribute">position</span>: relative;
      <span class="hljs-attribute">overflow</span>: hidden;
      <span class="hljs-attribute">z-index</span>: <span class="hljs-number">2</span>;
      <span class="hljs-attribute">background-color</span>: <span class="hljs-built_in">rgba</span>(<span class="hljs-number">12</span>, <span class="hljs-number">30</span>, <span class="hljs-number">50</span>, <span class="hljs-number">0.8</span>); <span class="hljs-comment">/* 半透明深色背景 */</span>
    }

    <span class="hljs-comment">/* 流光线条核心样式 */</span>
    <span class="hljs-selector-class">.container</span><span class="hljs-selector-pseudo">::before</span> {
      <span class="hljs-attribute">content</span>: <span class="hljs-string">""</span>;
      <span class="hljs-attribute">position</span>: absolute;
      <span class="hljs-attribute">z-index</span>: <span class="hljs-number">1</span>; <span class="hljs-comment">/* 低于内容框层级，不遮挡内容 */</span>
      <span class="hljs-attribute">top</span>: <span class="hljs-number">0</span>; <span class="hljs-comment">/* 紧贴容器顶部边框 */</span>
      <span class="hljs-attribute">left</span>: <span class="hljs-number">0</span>; <span class="hljs-comment">/* 紧贴容器左侧边框 */</span>
      <span class="hljs-attribute">width</span>: <span class="hljs-number">3px</span>; <span class="hljs-comment">/* 固定3px宽度 */</span>
      <span class="hljs-attribute">height</span>: <span class="hljs-number">3px</span>; <span class="hljs-comment">/* 初始高度与宽度一致 */</span>
      <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">2px</span>; <span class="hljs-comment">/* 圆角优化，避免生硬 */</span>
      <span class="hljs-comment">/* 蓝紫渐变：增强科技感 */</span>
      <span class="hljs-attribute">background</span>: <span class="hljs-built_in">linear-gradient</span>(
        <span class="hljs-number">135deg</span>,
        <span class="hljs-built_in">rgba</span>(<span class="hljs-number">0</span>, <span class="hljs-number">245</span>, <span class="hljs-number">255</span>, <span class="hljs-number">0.6</span>) <span class="hljs-number">0%</span>,
        <span class="hljs-built_in">rgba</span>(<span class="hljs-number">0</span>, <span class="hljs-number">132</span>, <span class="hljs-number">255</span>, <span class="hljs-number">0.5</span>) <span class="hljs-number">50%</span>,
        <span class="hljs-built_in">rgba</span>(<span class="hljs-number">110</span>, <span class="hljs-number">0</span>, <span class="hljs-number">255</span>, <span class="hljs-number">0.6</span>) <span class="hljs-number">100%</span>
      );
      <span class="hljs-comment">/* 多层发光阴影：提升亮度和层次感 */</span>
      <span class="hljs-attribute">box-shadow</span>:
        <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">10px</span> <span class="hljs-built_in">rgba</span>(<span class="hljs-number">0</span>, <span class="hljs-number">119</span>, <span class="hljs-number">182</span>, <span class="hljs-number">0.8</span>),
        <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">25px</span> <span class="hljs-built_in">rgba</span>(<span class="hljs-number">0</span>, <span class="hljs-number">150</span>, <span class="hljs-number">199</span>, <span class="hljs-number">0.6</span>),
        <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">40px</span> <span class="hljs-built_in">rgba</span>(<span class="hljs-number">0</span>, <span class="hljs-number">245</span>, <span class="hljs-number">255</span>, <span class="hljs-number">0.4</span>),
        inset <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">8px</span> <span class="hljs-built_in">rgba</span>(<span class="hljs-number">0</span>, <span class="hljs-number">119</span>, <span class="hljs-number">182</span>, <span class="hljs-number">0.5</span>);
      <span class="hljs-comment">/* 双动画：流动+呼吸发光 */</span>
      <span class="hljs-attribute">animation</span>: flow <span class="hljs-number">6s</span> linear infinite, glow <span class="hljs-number">3s</span> linear infinite alternate;
      <span class="hljs-attribute">pointer-events</span>: none; <span class="hljs-comment">/* 避免遮挡鼠标事件 */</span>
    }

    <span class="hljs-comment">/* 流动动画：紧贴边框+拐角停顿 */</span>
    <span class="hljs-keyword">@keyframes</span> flow {
      <span class="hljs-number">0%</span> {
        <span class="hljs-attribute">width</span>: <span class="hljs-number">3px</span>;
        <span class="hljs-attribute">height</span>: <span class="hljs-number">3px</span>;
        <span class="hljs-attribute">top</span>: <span class="hljs-number">0</span>;
        <span class="hljs-attribute">left</span>: <span class="hljs-number">0</span>;
      }
      <span class="hljs-comment">/* 上边框：左→右拉伸（高度固定3px） */</span>
      <span class="hljs-number">15%</span> {
        <span class="hljs-attribute">left</span>: <span class="hljs-number">0</span>;
        <span class="hljs-attribute">top</span>: <span class="hljs-number">0</span>;
        <span class="hljs-attribute">width</span>: <span class="hljs-number">100%</span>; <span class="hljs-comment">/* 精准匹配容器宽度 */</span>
        <span class="hljs-attribute">height</span>: <span class="hljs-number">3px</span>;
      }
      <span class="hljs-comment">/* 右上角收缩停顿（5%时长） */</span>
      <span class="hljs-number">20%</span> {
        <span class="hljs-attribute">left</span>: <span class="hljs-built_in">calc</span>(<span class="hljs-number">100%</span> - <span class="hljs-number">3px</span>); <span class="hljs-comment">/* 容器右边缘 - 线条宽度 */</span>
        <span class="hljs-attribute">top</span>: <span class="hljs-number">0</span>;
        <span class="hljs-attribute">width</span>: <span class="hljs-number">3px</span>;
        <span class="hljs-attribute">height</span>: <span class="hljs-number">3px</span>;
      }
      <span class="hljs-number">25%</span> {
        <span class="hljs-attribute">left</span>: <span class="hljs-built_in">calc</span>(<span class="hljs-number">100%</span> - <span class="hljs-number">3px</span>);
        <span class="hljs-attribute">top</span>: <span class="hljs-number">0</span>;
        <span class="hljs-attribute">width</span>: <span class="hljs-number">3px</span>;
        <span class="hljs-attribute">height</span>: <span class="hljs-number">3px</span>;
      }
      <span class="hljs-comment">/* 右边框：上→下拉伸（宽度固定3px） */</span>
      <span class="hljs-number">40%</span> {
        <span class="hljs-attribute">left</span>: <span class="hljs-built_in">calc</span>(<span class="hljs-number">100%</span> - <span class="hljs-number">3px</span>);
        <span class="hljs-attribute">top</span>: <span class="hljs-number">0</span>;
        <span class="hljs-attribute">width</span>: <span class="hljs-number">3px</span>;
        <span class="hljs-attribute">height</span>: <span class="hljs-number">100%</span>; <span class="hljs-comment">/* 精准匹配容器高度 */</span>
      }
      <span class="hljs-comment">/* 右下角收缩停顿（5%时长） */</span>
      <span class="hljs-number">45%</span> {
        <span class="hljs-attribute">left</span>: <span class="hljs-built_in">calc</span>(<span class="hljs-number">100%</span> - <span class="hljs-number">3px</span>);
        <span class="hljs-attribute">top</span>: <span class="hljs-built_in">calc</span>(<span class="hljs-number">100%</span> - <span class="hljs-number">3px</span>); <span class="hljs-comment">/* 容器下边缘 - 线条宽度 */</span>
        <span class="hljs-attribute">width</span>: <span class="hljs-number">3px</span>;
        <span class="hljs-attribute">height</span>: <span class="hljs-number">3px</span>;
      }
      <span class="hljs-number">50%</span> {
        <span class="hljs-attribute">left</span>: <span class="hljs-built_in">calc</span>(<span class="hljs-number">100%</span> - <span class="hljs-number">3px</span>);
        <span class="hljs-attribute">top</span>: <span class="hljs-built_in">calc</span>(<span class="hljs-number">100%</span> - <span class="hljs-number">3px</span>);
        <span class="hljs-attribute">width</span>: <span class="hljs-number">3px</span>;
        <span class="hljs-attribute">height</span>: <span class="hljs-number">3px</span>;
      }
      <span class="hljs-comment">/* 下边框：右→左拉伸（高度固定3px） */</span>
      <span class="hljs-number">65%</span> {
        <span class="hljs-attribute">left</span>: <span class="hljs-number">0</span>;
        <span class="hljs-attribute">top</span>: <span class="hljs-built_in">calc</span>(<span class="hljs-number">100%</span> - <span class="hljs-number">3px</span>);
        <span class="hljs-attribute">width</span>: <span class="hljs-number">100%</span>;
        <span class="hljs-attribute">height</span>: <span class="hljs-number">3px</span>;
      }
      <span class="hljs-comment">/* 左下角收缩停顿（5%时长） */</span>
      <span class="hljs-number">70%</span> {
        <span class="hljs-attribute">left</span>: <span class="hljs-number">0</span>;
        <span class="hljs-attribute">top</span>: <span class="hljs-built_in">calc</span>(<span class="hljs-number">100%</span> - <span class="hljs-number">3px</span>);
        <span class="hljs-attribute">width</span>: <span class="hljs-number">3px</span>;
        <span class="hljs-attribute">height</span>: <span class="hljs-number">3px</span>;
      }
      <span class="hljs-number">75%</span> {
        <span class="hljs-attribute">left</span>: <span class="hljs-number">0</span>;
        <span class="hljs-attribute">top</span>: <span class="hljs-built_in">calc</span>(<span class="hljs-number">100%</span> - <span class="hljs-number">3px</span>);
        <span class="hljs-attribute">width</span>: <span class="hljs-number">3px</span>;
        <span class="hljs-attribute">height</span>: <span class="hljs-number">3px</span>;
      }
      <span class="hljs-comment">/* 左边框：下→上拉伸（宽度固定3px） */</span>
      <span class="hljs-number">85%</span> {
        <span class="hljs-attribute">left</span>: <span class="hljs-number">0</span>;
        <span class="hljs-attribute">top</span>: <span class="hljs-number">0</span>;
        <span class="hljs-attribute">width</span>: <span class="hljs-number">3px</span>;
        <span class="hljs-attribute">height</span>: <span class="hljs-number">100%</span>;
      }
      <span class="hljs-comment">/* 左上角收缩停顿（10%时长，闭环过渡） */</span>
      <span class="hljs-number">90%</span> {
        <span class="hljs-attribute">left</span>: <span class="hljs-number">0</span>;
        <span class="hljs-attribute">top</span>: <span class="hljs-number">0</span>;
        <span class="hljs-attribute">width</span>: <span class="hljs-number">3px</span>;
        <span class="hljs-attribute">height</span>: <span class="hljs-number">3px</span>;
      }
      <span class="hljs-number">100%</span> {
        <span class="hljs-attribute">left</span>: <span class="hljs-number">0</span>;
        <span class="hljs-attribute">top</span>: <span class="hljs-number">0</span>;
        <span class="hljs-attribute">width</span>: <span class="hljs-number">3px</span>;
        <span class="hljs-attribute">height</span>: <span class="hljs-number">3px</span>;
      }
    }

    <span class="hljs-comment">/* 呼吸发光动画：增强视觉冲击 */</span>
    <span class="hljs-keyword">@keyframes</span> glow {
      <span class="hljs-selector-tag">from</span> {
        <span class="hljs-attribute">box-shadow</span>:
          <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">15px</span> <span class="hljs-built_in">rgba</span>(<span class="hljs-number">0</span>, <span class="hljs-number">119</span>, <span class="hljs-number">182</span>, <span class="hljs-number">0.7</span>),
          <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">30px</span> <span class="hljs-built_in">rgba</span>(<span class="hljs-number">0</span>, <span class="hljs-number">150</span>, <span class="hljs-number">199</span>, <span class="hljs-number">0.5</span>),
          <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">45px</span> <span class="hljs-built_in">rgba</span>(<span class="hljs-number">0</span>, <span class="hljs-number">245</span>, <span class="hljs-number">255</span>, <span class="hljs-number">0.3</span>),
          inset <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">10px</span> <span class="hljs-built_in">rgba</span>(<span class="hljs-number">0</span>, <span class="hljs-number">119</span>, <span class="hljs-number">182</span>, <span class="hljs-number">0.4</span>);
      }
      <span class="hljs-selector-tag">to</span> {
        <span class="hljs-attribute">box-shadow</span>:
          <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">30px</span> <span class="hljs-built_in">rgba</span>(<span class="hljs-number">0</span>, <span class="hljs-number">119</span>, <span class="hljs-number">182</span>, <span class="hljs-number">0.9</span>),
          <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">60px</span> <span class="hljs-built_in">rgba</span>(<span class="hljs-number">0</span>, <span class="hljs-number">150</span>, <span class="hljs-number">199</span>, <span class="hljs-number">0.7</span>),
          <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">80px</span> <span class="hljs-built_in">rgba</span>(<span class="hljs-number">0</span>, <span class="hljs-number">245</span>, <span class="hljs-number">255</span>, <span class="hljs-number">0.5</span>),
          inset <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">20px</span> <span class="hljs-built_in">rgba</span>(<span class="hljs-number">0</span>, <span class="hljs-number">119</span>, <span class="hljs-number">182</span>, <span class="hljs-number">0.6</span>);
      }
    }
  </span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"container"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"box"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span>
</code></pre>
<h2 data-id="heading-2">关键实现逻辑解析</h2>
<h3 data-id="heading-3">1. 线条紧贴边框的核心设计</h3>
<ul>
<li>坐标定位：<code>top: 0</code> 和 <code>left: 0</code> 让线条从容器左上角边框开始，无任何偏移</li>
<li>尺寸计算：拉伸时使用 <code>width: 100%</code>/<code>height: 100%</code> 精准匹配容器尺寸，拐角处通过 <code>calc(100% - 3px)</code> 计算位置（容器边缘 - 线条宽度），确保完全贴合</li>
<li>层级控制：<code>z-index: 1</code> 让线条处于内容框下方，不遮挡内部内容</li>
</ul>
<h3 data-id="heading-4">2. 丝滑流动的动画设计</h3>
<ul>
<li>单维度拉伸：每个拉伸阶段只变化一个维度（要么宽、要么高），另一个维度固定 3px，避免同步变化导致的顿挫感</li>
<li>拐角停顿：每个拐角设置 5% 的停顿时长（如 20%-25%、45%-50%），让线条在拐角处 "站稳" 后再继续流动，过渡更自然</li>
<li>线性节奏：<code>linear</code> 动画 timing 函数确保全程速度均匀，无快慢波动</li>
</ul>
<h3 data-id="heading-5">3. 高亮效果的视觉优化</h3>
<ul>
<li>渐变底色：蓝紫渐变（<code>rgba(0,245,255,0.6)</code> 到 <code>rgba(110,0,255,0.6)</code>）增强科技感，透明度控制避免过于刺眼</li>
<li>多层阴影：外层阴影扩大发光范围，内层阴影增强线条本身亮度，形成立体发光效果</li>
<li>呼吸动画：<code>glow</code> 动画通过切换阴影强度，实现呼吸式发光，提升视觉层次感</li>
</ul>
<h2 data-id="heading-6">灵活适配指南</h2>
<h3 data-id="heading-7">1. 容器形态适配（正方形→长方形）</h3>
<ul>
<li>
<p>正方形：保持 <code>container</code> 的 <code>width</code> 和 <code>height</code> 相等（如 200px×200px），动画无需修改</p>
</li>
<li>
<p>长方形：修改 <code>container</code> 的宽高比例（如宽度 52%、高度 20%），动画会自动适配，线条始终紧贴边框</p>
</li>
<li>
<p>示例：如需适配屏幕高度 20%、宽度 52% 的容器，只需修改：</p>
<p>css</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-class">.container</span> {
  <span class="hljs-attribute">width</span>: <span class="hljs-number">52%</span>;
  <span class="hljs-attribute">height</span>: <span class="hljs-number">20vh</span>; <span class="hljs-comment">/* 屏幕高度的20% */</span>
}
</code></pre>
</li>
</ul>
<h3 data-id="heading-8">2. 样式自定义调整</h3>
<ul>
<li>
<p>线条宽度：修改 <code>.container::before</code> 中的 <code>width: 3px</code>（如 2px 更纤细，4px 更粗实）</p>
</li>
<li>
<p>颜色调整：修改 <code>background</code> 中的渐变色值（如纯蓝色 <code>rgba(0,200,255,0.7)</code>）</p>
</li>
<li>
<p>动画速度：</p>
<ul>
<li>流动速度：调整 <code>flow</code> 动画的 <code>6s</code>（数值越小越快，如 4s 更急促，8s 更舒缓）</li>
<li>呼吸速度：调整 <code>glow</code> 动画的 <code>3s</code></li>
</ul>
</li>
<li>
<p>发光强度：修改 <code>glow</code> 动画中的阴影数值（数值越大发光越强，反之则越柔和）</p>
</li>
</ul>
<h3 data-id="heading-9">3. 应用场景扩展</h3>
<ul>
<li>数据可视化大屏：搭配深色背景和数据组件，提升科技感</li>
<li>后台管理系统：用于卡片、面板边框，增强界面层次</li>
<li>展示型网站：用于重点内容区块边框，吸引用户注意力</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Elpis Webpack工程化·自我学习总结]]></title>    <link>https://juejin.cn/post/7582156410319454218</link>    <guid>https://juejin.cn/post/7582156410319454218</guid>    <pubDate>2025-12-11T04:16:09.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7582156410319454218" data-draft-id="7577256255084609545" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Elpis Webpack工程化·自我学习总结"/> <meta itemprop="keywords" content="Webpack,前端工程化"/> <meta itemprop="datePublished" content="2025-12-11T04:16:09.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="一念之间lq"/> <meta itemprop="url" content="https://juejin.cn/user/2541726616524583"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Elpis Webpack工程化·自我学习总结
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2541726616524583/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    一念之间lq
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-11T04:16:09.000Z" title="Thu Dec 11 2025 04:16:09 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-11
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读13分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#595959;font-size:15px;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(60,10,30,.04) 3%,transparent 0),linear-gradient(1turn,rgba(60,10,30,.04) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body p{color:#595959;font-size:15px;line-height:2;font-weight:400}.markdown-body p+p{margin-top:16px}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin:0;color:#135ce0}.markdown-body h1{position:relative;text-align:center;font-size:22px;margin:50px 0}.markdown-body h1:before{position:absolute;content:"";top:-10px;left:50%;width:32px;height:32px;transform:translateX(-50%);background-size:100% 100%;opacity:.36;background-repeat:no-repeat;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAABfVBMVEX///8Ad/8AgP8AgP8AgP8Aff8AgP8Af/8AgP8AVf8Af/8Af/8AgP8AgP8Af/8Afv8AAP8Afv8Afv8Aef8AgP8AdP8Afv8AgP8AgP8Acf8Ae/8AgP8Af/8AgP8Af/8Af/8AfP8Afv8AgP8Af/8Af/8Afv8Afv8AgP8Afv8AgP8Af/8Af/8AgP8AgP8Afv8AgP8Af/8AgP8AgP8AgP8Ae/8Afv8Af/8AgP8Af/8AgP8Af/8Af/8Aff8Af/8Abf8AgP8Af/8AgP8Af/8Af/8Afv8AgP8AgP8Afv8Afv8AgP8Af/8Aff8AgP8Afv8AgP8Aff8AgP8AfP8AgP8Ae/8AgP8Af/8AgP8AgP8AgP8Afv8AgP8AgP8AgP8Afv8AgP8AgP8AgP8AgP8AgP8Af/8AgP8Af/8Af/8Aev8Af/8AgP8Aff8Afv8AgP8AgP8AgP8Af/8AgP8Af/8Af/8AgP8Afv8AgP8AgP8AgP8AgP8Af/8AeP8Af/8Af/8Af//////rzEHnAAAAfXRSTlMAD7CCAivatxIDx5EMrP19AXdLEwgLR+6iCR/M0yLRzyFF7JupSXn8cw6v60Q0QeqzKtgeG237HMne850/6Qeq7QaZ+WdydHtj+OM3qENCMRYl1B3K2U7wnlWE/mhlirjkODa9FN/BF7/iNV/2kASNZpX1Wlf03C4stRGxgUPclqoAAAABYktHRACIBR1IAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH4gEaBzgZ4yeM3AAAAT9JREFUOMvNUldbwkAQvCAqsSBoABE7asSOBRUVVBQNNuy9996789+9cMFAMHnVebmdm+/bmdtbQv4dOFOW2UjPzgFyLfo6nweKfIMOBYWwFtmMPGz2Yj2pJI0JDq3udJW6VVbmKa9I192VQFV1ktXUAl5NB0cd4KpnORqsEO2ZIRpF9gJfE9Dckqq0KuZt7UAH5+8EPF3spjsRpCeQNO/tA/qDwIDA+OCQbBoKA8NOdjMySgcZGVM6jwcgRuUiSs0nlPFNSrEpJfU0jTLD6llqbvKxei7OzvkFNQohi0vAsj81+MoqsCaoPOQFgus/1LyxichW+hS2JWCHZ7VlF9jb187pIAYcHiViHAMnp5mTjJ8B5xeEXF4B1ze/fTh/C0h398DDI9HB07O8ci+vRBdvdGnfP4gBuM8vw7X/G3wDmFhFZEdxzjMAAAAldEVYdGRhdGU6Y3JlYXRlADIwMTgtMDEtMjZUMDc6NTY6MjUrMDE6MDA67pVWAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDE4LTAxLTI2VDA3OjU2OjI1KzAxOjAwS7Mt6gAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAAWdEVYdFRpdGxlAGp1ZWppbl9sb2dvIGNvcHlxapmKAAAAV3pUWHRSYXcgcHJvZmlsZSB0eXBlIGlwdGMAAHic4/IMCHFWKCjKT8vMSeVSAAMjCy5jCxMjE0uTFAMTIESANMNkAyOzVCDL2NTIxMzEHMQHy4BIoEouAOoXEXTyQjWVAAAAAElFTkSuQmCC)}.markdown-body h2{position:relative;font-size:20px;border-left:4px solid;padding:0 0 0 10px;margin:30px 0}.markdown-body h3{font-size:16px}.markdown-body ul{list-style:disc outside;margin-left:2em;margin-top:1em}.markdown-body li{line-height:2;color:#595959}.markdown-body img.loaded{margin:0 auto;display:block}.markdown-body blockquote{background:#fff9f9;margin:2em 0;padding:2px 20px;border-left:4px solid #b2aec5}.markdown-body blockquote p{color:#666;line-height:2}.markdown-body a{color:#036aca;border-bottom:1px solid rgba(3,106,202,.8);font-weight:400;text-decoration:none}.markdown-body em strong,.markdown-body strong{color:#036aca}.markdown-body hr{border-top:1px solid #135ce0}.markdown-body pre{overflow:auto}.markdown-body code,.markdown-body pre{overflow:auto;position:relative;line-height:1.75;font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body table{border-collapse:collapse;margin:1rem 0;overflow-x:auto}.markdown-body table td,.markdown-body table th{border:1px solid #dfe2e5;padding:.6em 1em}.markdown-body table tr{border-top:1px solid #dfe2e5}.markdown-body table tr:nth-child(2n){background-color:#f6f8fa}</style><style data-highlight="" data-highlight-key="agate">.markdown-body pre,.markdown-body pre&gt;code.hljs{background:#333;color:#fff}.hljs-name,.hljs-strong{font-weight:700}.hljs-code,.hljs-emphasis{font-style:italic}.hljs-tag{color:#62c8f3}.hljs-selector-class,.hljs-selector-id,.hljs-template-variable,.hljs-variable{color:#ade5fc}.hljs-bullet,.hljs-string{color:#a2fca2}.hljs-attribute,.hljs-built_in,.hljs-builtin-name,.hljs-quote,.hljs-section,.hljs-title,.hljs-type{color:#ffa}.hljs-bullet,.hljs-number,.hljs-symbol{color:#d36363}.hljs-keyword,.hljs-literal,.hljs-selector-tag{color:#fcc28c}.hljs-code,.hljs-comment,.hljs-deletion{color:#888}.hljs-link,.hljs-regexp{color:#c6b4f0}.hljs-meta{color:#fc9b9b}.hljs-deletion{background-color:#fc9b9b;color:#333}.hljs-addition{background-color:#a2fca2;color:#333}.hljs a{color:inherit}.hljs a:focus,.hljs a:hover{color:inherit;text-decoration:underline}</style><h2 data-id="heading-0">一.认识Webpack</h2>
<p>webpack是一个现代JavaScript应用程序的静态模块打包器。它主要用于将多个模块（包括JavaScript、CSS、图片等）打包成一个或多个bundle文件，以便在浏览器中高效加载。</p>
<p>webpack的作用：</p>
<ol>
<li>模块打包：将多个模块按照依赖关系打包成静态资源，减少HTTP请求次数。</li>
<li>编译转换：通过加载器（loader）将其他类型的文件（如TypeScript、CSS、图片、字体）转换成浏览器可识别的格式。</li>
<li>代码分割：将代码拆分成多个块，实现按需加载，提高首屏加载速度。</li>
<li>插件系统：通过插件（plugin）扩展功能，如优化、压缩、环境变量注入等。</li>
<li>开发服务器：提供热重载（hot reload）功能，提升开发效率。</li>
</ol>
<h2 data-id="heading-1">二.Webpack构建流程</h2>
<h3 data-id="heading-2">1.读取配置文件</h3>
<p>Webpack会读取命令行传入的参数以及项目中的配置文件(webpack.config.js),合并成最终配置。</p>
<h3 data-id="heading-3">2.创建 Compiler 对象</h3>
<p>根据上面的配置创建 Webpack 的核心对象 <code>Compiler</code>,并注册所有配置的插件,执行插件的 <code>apply</code>方法</p>
<h3 data-id="heading-4">3.解析Entry入口文件</h3>
<p>为每个Entry 入口文件创建Module对象,将入口模块添加到编译依赖图中</p>
<h3 data-id="heading-5">4.Loader模块转换</h3>
<p>根据模块文件类型(js,css,.vue,.ts)匹配对应的Loader,Loader从左到右(从上到下)顺序执行,将模块内容转化为JavaScript模块,Loader翻译完成后,Webpack将js代码转换成AST(抽象语法树)</p>
<h3 data-id="heading-6">5.分析依赖</h3>
<p>在中AST遍历寻找import,require等依赖,针对每个模块进行"Loader转换 -&gt; AST解析 -&gt; 分析依赖"</p>
<h3 data-id="heading-7">6.封装模块</h3>
<p>这里通过<code>seal()</code>所有模块编译完成，得到模块依赖图</p>
<blockquote>
<p>Tree Shaking 优化(标记未使用的导出,减少无用的依赖):Webpack 依靠ES6 Module 的静态结构,分析出那些export 没被引用,再下一步的Chunk代码中进行移除</p>
</blockquote>
<h3 data-id="heading-8">7.组装Chunk文件</h3>
<p>根据入口文件(Entry)和代码分割(splitChunks)规则,Webpack合并成一个或多个Chunk 代码块</p>
<h3 data-id="heading-9">8.输出文件</h3>
<p>Webpack 会根据配置的<code>output.path</code>,<code>output.feilname</code>,将文件写入磁盘中,一般生成一个新的<code>dist</code>文件夹</p>
<h2 data-id="heading-10">三.Webpack的核心概念</h2>
<h3 data-id="heading-11">1. 入口文件(Entry)</h3>
<p><code>Entry</code>是webpack构建过程的起点,从入口开始递归地构建成一个依赖图,将每个模块打包到一起,最终生成一个<code>xxxx.bundle.js</code>文件产物。入口可以配置单入口或多入口。</p>
<ul>
<li>单入口: 只有一个入口文件的引入,只生成一个对应的bundle.js文件</li>
<li>多入口: 拥有多个入口文件的引入,生成多个对应的bundle.js文件</li>
</ul>
<p>不管单入口还是多入口的文件最终产物生成的是<code>bundle.js</code>文件,只是生成数量的问题,最终我们是需要将引入到页面中进行业务的呈现。此时Webpack中使用<code>html-webpack-plugin</code>插件会将我们的<code>bundle.js</code>文件自动引入到我们指定的页面中。</p>
<pre><code class="hljs language-JavaScript" lang="JavaScript"><span class="hljs-comment">// html-webpack-plugin 使用逻辑</span>
<span class="hljs-comment">//动态构造 entry 入口对象和 html-webpack-plugin 插件实例</span>
<span class="hljs-keyword">const</span> <span class="hljs-title class_">HtmlWebpackPlugin</span> = <span class="hljs-built_in">require</span>(<span class="hljs-string">'html-webpack-plugin'</span>)

<span class="hljs-keyword">const</span> pageEntries = {}
<span class="hljs-keyword">const</span> htmlWebpackPluginList = []
<span class="hljs-comment">//自动加载app/pages目录下的入口文件</span>
<span class="hljs-keyword">const</span> entryList = glob.<span class="hljs-title function_">sync</span>(path.<span class="hljs-title function_">resolve</span>(process.<span class="hljs-title function_">cwd</span>(), <span class="hljs-string">'./app/pages/**/entry.*.js'</span>))
entryList.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">filePath</span>) =&gt;</span> {
  <span class="hljs-keyword">const</span> entryName = path.<span class="hljs-title function_">basename</span>(filePath, <span class="hljs-string">'.js'</span>)
  <span class="hljs-comment">//构造entry对象</span>
  pageEntries[entryName] = filePath
  <span class="hljs-comment">//构造最终渲染的页面文件</span>
  htmlWebpackPluginList.<span class="hljs-title function_">push</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">HtmlWebpackPlugin</span>({
    <span class="hljs-comment">//产物 (最终末班) 输出路径</span>
    <span class="hljs-attr">filename</span>: path.<span class="hljs-title function_">resolve</span>(process.<span class="hljs-title function_">cwd</span>(), <span class="hljs-string">'./app/public/dist/'</span>, <span class="hljs-string">`<span class="hljs-subst">${entryName}</span>.tpl`</span>),
    <span class="hljs-comment">//指定要使用的模板文件</span>
    <span class="hljs-attr">template</span>: path.<span class="hljs-title function_">resolve</span>(process.<span class="hljs-title function_">cwd</span>(), <span class="hljs-string">'./app/view/entry.tpl'</span>),
    <span class="hljs-comment">//要注入的代码块</span>
    <span class="hljs-attr">chunks</span>: [entryName],
  }))
})

<span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = {
   <span class="hljs-comment">//入口配置</span>
  <span class="hljs-attr">entry</span>: pageEntries,
  <span class="hljs-attr">plugins</span>:[
     ...htmlWebpackPluginList
  ]
}

</code></pre>
<blockquote>
<p>因为在多入口的配置过程中,我们需要将进行 <code>new HtmlWebpackPlugin</code> 该操作来将<code>bundle.js</code>自动注入页面模版中, 如果入口数量过多需要多次 <code>new HtmlWebpackPlugin</code> 操作,所以采用动态构建来完成js代码注入工作。当然项目是个单入口的配置时,按照Webpack的配置进行单独配置就行,没有多次编写的麻烦。</p>
</blockquote>
<h3 data-id="heading-12">2. 加载器(Loaders)</h3>
<p>将非 JavaScript 模块转换为 webpack 能够处理的模块，即 webpack 本身只支持 JavaScript，通过加载器可以将其他类型的资源（如 CSS、图片、TypeScript 等）转换为有效的模块。</p>
<p>常用Loaders:</p>
<ul>
<li>babel-loader:将ES 6转换为向后兼容的JS版本,解决不同浏览器之间的兼容性问题</li>
<li>css-loader: 解析 CSS 文件中的 @import 和 url(),主要是分析css中模块依赖关系</li>
<li>style-loader :将CSS注入页面中去,一般配合着<code>css-loader</code>一起使用</li>
<li>sass-loader/less-loader: 将sass/less 编译为为CSS.</li>
<li>file-loader :将文件复制到输出目录并返回 public URL</li>
<li>url-loader: 类似于 file-loader，但可以设置文件大小限制,将小文件转换为Base64编码的Data url</li>
<li>vue-loader :用来解析和转换(模版,脚本,样式)<code>.vue</code>文件</li>
</ul>
<p>如何实现一个Loader 加载器:</p>
<pre><code class="hljs language-JavaScript" lang="JavaScript"><span class="hljs-comment">// my-loader.js </span>
<span class="hljs-comment">// 自定义 loader: 去除.vue文件中所有的console.log 打印</span>
<span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params">source</span>) {
    <span class="hljs-comment">// source: 文件内容（字符串）</span>
    <span class="hljs-comment">// this: loader 上下文对象</span>
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">query</span>); <span class="hljs-comment">//接受 options 配置参数</span>
    <span class="hljs-keyword">const</span> closeConSource=source.<span class="hljs-title function_">replace</span>(<span class="hljs-regexp">/console\.log\(.+?\);/g</span>, <span class="hljs-string">''</span>)
    <span class="hljs-keyword">return</span> closeConSource
}

<span class="hljs-comment">//自定义loader 引入</span>
<span class="hljs-comment">//遵循由下往上的规则,先执行自定义的loader再去执行vue-loader</span>
{
   <span class="hljs-attr">test</span>: <span class="hljs-regexp">/\.vue$/</span>,
   <span class="hljs-attr">use</span>: [
     <span class="hljs-string">'vue-loader'</span>,
    {
      <span class="hljs-attr">loader</span>: path.<span class="hljs-title function_">resolve</span>(__dirname, <span class="hljs-string">'../loaders/my-loader.js'</span>),
      <span class="hljs-attr">options</span>: { <span class="hljs-attr">name</span>: <span class="hljs-string">'my-loader'</span> }
     }
   ]
}

</code></pre>
<p>在使用vue-loader 如何进行查找顺序(由近到远,优先到项目结构内查找,再到全局进行查找)：</p>
<ul>
<li><strong>项目本地的 node_modules</strong>​ (优先)</li>
<li><strong>上级目录的 node_modules</strong>​ (递归向上查找)</li>
<li><strong>全局安装的 node_modules</strong></li>
</ul>
<h3 data-id="heading-13">3. 插件(Plugins)</h3>
<p>插件是 Webpack 的扩展功能，拥有强大的能力。要使用一个插件，你只需要 <code>require()</code>它，然后把它添加到 <code>plugins</code>数组中。例如<strong>打包优化、资源管理、环境变量注入</strong>等都可以通过插件来完成,可以在Webpack 的整个编译生命周期中通过<code>hook</code>函数来处理各种复杂的任务。</p>
<p>常见的Plugins 插件:</p>
<ul>
<li>HtmlWebpackPlugin :将构建好的<code>bundle</code>,自动注入到页面模版文件中</li>
<li>CleanWebpackPlugin :每次构建前将上一次的构建产物删除</li>
<li>MiniCssExtractPlugin :将 CSS 从主 JS 文件中提取出来，成为一个独立的 CSS 文件（而不是嵌在 JS 里），利于浏览器缓存和并行加载。</li>
<li>CopyWebpackPlugin: 通常用于复制静态文件(图标,字体)到输出目录</li>
<li>DefinePlugin :可在代码中定义全局变量,用于在开发和生产不同环境下配置使用</li>
<li>HotModuleReplacementPlugin: Webpack中热模块替换(HMR)功能,在开发阶段能实时查看代码更新变化</li>
</ul>
<p>如何实现一个自定义的plugins</p>
<p>①.首先我们要了解在Webpack中，插件是一个具有<code>apply</code>方法的JavaScript对象。apply方法会被webpack compiler调用，并且在整个编译生命周期都可以访问compiler对象。</p>
<pre><code class="hljs language-JavaScript" lang="JavaScript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyCustomPlugin</span> {
  <span class="hljs-comment">// 构造函数，用于接收配置选项</span>
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">options = {}</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">options</span> = options;
  }
  <span class="hljs-comment">// apply 方法，Webpack 会自动调用并传入 compiler 对象</span>
  <span class="hljs-title function_">apply</span>(<span class="hljs-params">compiler</span>) {
    <span class="hljs-comment">// 在这里注册hook函数</span>
  }
}
<span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = <span class="hljs-title class_">MyCustomPlugin</span>;
</code></pre>
<p>②.了解webpack不同<code>Hook函数</code>的调用时期,这样确认我们编写的自定义plugins功能在对应的Hook函数下面进行,但是Hook函数的类型不同(同步/异步)我们注册事件的方式也不一样,例如常见的有 <code>tap</code>, <code>tapAsync</code>, <code>tapPromise</code>等,根据命名我就可以推断<code>tap</code>处理同步,<code>tapAsync</code>处理异步,以及在部分场景必须返回Promise时使用<code>tapPromise</code>。</p>













































<table><thead><tr><th>Hook 名称</th><th>类型</th><th>调用时机</th></tr></thead><tbody><tr><td><code>entryOption</code></td><td>SyncBailHook</td><td>在 webpack 选项中的 entry 被处理之后</td></tr><tr><td><code>compile</code></td><td>SyncHook</td><td>开始编译之前</td></tr><tr><td><code>compilation</code></td><td>SyncHook</td><td>编译创建之后</td></tr><tr><td><code>emit</code></td><td>AsyncSeriesHook</td><td>生成资源到 output 目录之前</td></tr><tr><td><code>afterEmit</code></td><td>AsyncSeriesHook</td><td>生成资源到 output 目录之后</td></tr><tr><td><code>done</code></td><td>SyncHook</td><td>编译完成</td></tr><tr><td><code>failed</code></td><td>SyncHook</td><td>编译失败</td></tr></tbody></table>
<p>③.来实现控制台打印输出打包构建时间、各个产物文件大小信息与携带新生成版本信息文件的plugins</p>
<pre><code class="hljs language-JavaScript" lang="JavaScript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyCustomPlugin</span> {
    <span class="hljs-comment">// 构造函数，用于接收配置选项</span>
    <span class="hljs-title function_">constructor</span>(<span class="hljs-params">options = {}</span>) {
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">options</span> = options
    }
    <span class="hljs-comment">// apply 方法，Webpack 会自动调用并传入 compiler 对象</span>
    <span class="hljs-title function_">apply</span>(<span class="hljs-params">compiler</span>) {
        <span class="hljs-comment">// 插件逻辑</span>
        <span class="hljs-comment">// 1. 在编译开始前执行</span>
        compiler.<span class="hljs-property">hooks</span>.<span class="hljs-property">beforeRun</span>.<span class="hljs-title function_">tap</span>(<span class="hljs-string">'MyCustomPlugin'</span>, <span class="hljs-function">(<span class="hljs-params">compilation</span>) =&gt;</span> {
            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`🚀 开始编译...`</span>);
        });
        <span class="hljs-comment">// 2. 在编译完成后执行</span>
        compiler.<span class="hljs-property">hooks</span>.<span class="hljs-property">done</span>.<span class="hljs-title function_">tap</span>(<span class="hljs-string">'MyCustomPlugin'</span>, <span class="hljs-function">(<span class="hljs-params">stats</span>) =&gt;</span> {
            <span class="hljs-keyword">const</span> compilation = stats.<span class="hljs-property">compilation</span>;
            <span class="hljs-keyword">const</span> endTime = stats.<span class="hljs-property">endTime</span>;
            <span class="hljs-keyword">const</span> startTime = stats.<span class="hljs-property">startTime</span>;
            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`✅ : 编译完成！`</span>);

            <span class="hljs-comment">//输出构建时间</span>
            <span class="hljs-keyword">const</span> buildTime = (endTime - startTime) / <span class="hljs-number">1000</span>;
            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`⏰ 构建时间: <span class="hljs-subst">${buildTime.toFixed(<span class="hljs-number">2</span>)}</span>s`</span>);

            <span class="hljs-comment">//输出资源大小信息</span>
            <span class="hljs-keyword">const</span> assets = compilation.<span class="hljs-property">assets</span>;
            <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">keys</span>(assets).<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">assetName</span> =&gt;</span> {
                <span class="hljs-keyword">const</span> size = assets[assetName].<span class="hljs-title function_">size</span>();
                <span class="hljs-keyword">const</span> sizeKb = (size / <span class="hljs-number">1024</span>).<span class="hljs-title function_">toFixed</span>(<span class="hljs-number">2</span>);
                <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`📦 <span class="hljs-subst">${assetName}</span>: <span class="hljs-subst">${sizeKb}</span> KB`</span>);
            });
        });
        <span class="hljs-comment">// 3. 在资源输出到目录前执行（可以修改输出内容）</span>
        compiler.<span class="hljs-property">hooks</span>.<span class="hljs-property">emit</span>.<span class="hljs-title function_">tapAsync</span>(<span class="hljs-string">'MyCustomPlugin'</span>, <span class="hljs-function">(<span class="hljs-params">compilation, callback</span>) =&gt;</span> {
            <span class="hljs-comment">// 创建一个版本信息文件</span>
            <span class="hljs-keyword">const</span> buildInfo = {
                <span class="hljs-attr">buildTime</span>: <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>().<span class="hljs-title function_">toLocaleString</span>(),
                <span class="hljs-attr">hash</span>: compilation.<span class="hljs-property">hash</span>,
                <span class="hljs-attr">version</span>: process.<span class="hljs-property">env</span>.<span class="hljs-property">package_version</span> || <span class="hljs-string">'1.0.0'</span>
            };
            <span class="hljs-comment">// 将信息添加到编译资源中</span>
            compilation.<span class="hljs-property">assets</span>[<span class="hljs-string">'build-info.json'</span>] = {
                <span class="hljs-attr">source</span>: <span class="hljs-keyword">function</span> (<span class="hljs-params"/>) {
                    <span class="hljs-keyword">return</span> <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(buildInfo, <span class="hljs-literal">null</span>, <span class="hljs-number">2</span>);
                },
                <span class="hljs-attr">size</span>: <span class="hljs-keyword">function</span> (<span class="hljs-params"/>) {
                    <span class="hljs-keyword">return</span> <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(buildInfo).<span class="hljs-property">length</span>;
                }
            };
            <span class="hljs-title function_">callback</span>();
        });
    }
}
<span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = <span class="hljs-title class_">MyCustomPlugin</span>;
</code></pre>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/acc02ed91bbe4f7d87fefb0dc51df58f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiA5b-15LmL6Ze0bHE=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766031369&amp;x-signature=q89G6QVoZrp%2BLEg1ATfbto6eqjo%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-14">4. 优化产物输出(Optimization)</h3>
<p>optimization配置项的主要目的是<strong>控制打包产物的优化行为</strong>。</p>
<p>它的核心目标可以归结为三点：</p>
<ol>
<li><strong>减小打包体积</strong> ：通过压缩、摇树、作用域提升等技术，移除无效代码，减小文件大小。</li>
<li><strong>提升运行性能</strong> ：通过代码分割等方式，实现按需加载，减少初始加载时间。</li>
<li><strong>优化缓存</strong> ：通过合理的哈希策略和代码分离，使得未更改的文件能够被浏览器有效缓存，提升二次加载速度。</li>
</ol>
<h4 data-id="heading-15">4.1 代码分割与分块</h4>
<ol>
<li>splitChunks :这是最核心的代码分割配置,它主动用于拆分公共模块与第三方。</li>
</ol>
<p><strong>工作原理</strong>：Webpack 会分析模块的引用情况，根据你设置的规则（如大小、被引用次数等）自动将符合条件的模块提取到独立的 chunk 中。</p>
<pre><code class="hljs language-JavaScript" lang="JavaScript"><span class="hljs-attr">optimization</span>: {
  <span class="hljs-attr">splitChunks</span>: {
    <span class="hljs-comment">//'async'（默认值）：只对异步加载（dynamic import）​ 的模块进行分割</span>
    <span class="hljs-comment">//'initial'：只对同步初始化的模块进行分割。</span>
    <span class="hljs-comment">//'all'：最常用、最彻底的优化。对所有模块（同步和异步）都应用分割规则。这能最有效地提取公共依赖。</span>
    <span class="hljs-attr">chunks</span>: <span class="hljs-string">'all'</span>,
    <span class="hljs-attr">maxAsyncRequests</span>: <span class="hljs-number">10</span>, <span class="hljs-comment">// 按需加载时的最大并行请求数。设置此值可以防止chunk过多导致网络请求爆炸。</span>
    <span class="hljs-attr">maxInitialRequests</span>: <span class="hljs-number">10</span>, <span class="hljs-comment">// 入口点的最大并行请求数</span>
    <span class="hljs-attr">cacheGroups</span>: {
      <span class="hljs-comment">// 1. 抽离第三方库（如react, lodash）</span>
      <span class="hljs-attr">vendor</span>: {
        <span class="hljs-attr">test</span>: <span class="hljs-regexp">/[\\/]node_modules[\\/]/</span>, <span class="hljs-comment">// 匹配node_modules下的文件</span>
        <span class="hljs-attr">name</span>: <span class="hljs-string">'vendors'</span>, <span class="hljs-comment">//  chunk 名称</span>
        <span class="hljs-attr">priority</span>: <span class="hljs-number">20</span>, <span class="hljs-comment">// 优先级，数字越大优先级越高</span>
        <span class="hljs-attr">reuseExistingChunk</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// 如果当前chunk包含的模块已经被抽出，则直接复用</span>
      },
      <span class="hljs-comment">// 2. 抽离公共工具函数或组件</span>
      <span class="hljs-attr">common</span>: {
        <span class="hljs-attr">name</span>: <span class="hljs-string">'common'</span>,
        <span class="hljs-attr">minChunks</span>: <span class="hljs-number">2</span>, <span class="hljs-comment">// 模块被至少2个chunk引用时才被抽离</span>
        <span class="hljs-attr">minSize</span>: <span class="hljs-number">0</span>, <span class="hljs-comment">// 生成的chunk最小大小（字节）</span>
        <span class="hljs-attr">priority</span>: <span class="hljs-number">10</span>,
        <span class="hljs-attr">reuseExistingChunk</span>: <span class="hljs-literal">true</span>,
      },
      <span class="hljs-comment">// 3. 单独抽离某个大型库，如echarts</span>
      <span class="hljs-attr">echarts</span>: {
        <span class="hljs-attr">test</span>: <span class="hljs-regexp">/[\\/]node_modules[\\/]echarts[\\/]/</span>,
        <span class="hljs-attr">name</span>: <span class="hljs-string">'chunk-echarts'</span>,
        <span class="hljs-attr">priority</span>: <span class="hljs-number">30</span>, <span class="hljs-comment">// 优先级高于vendor</span>
      },
    },
  },
}
</code></pre>
<ol start="2">
<li>runtimeChunk：将 Webpack 的<code>运行时(runtime)</code>代码提取到单独的文件中。</li>
</ol>
<p><strong>什么是运行时</strong>：Webpack 用来连接模块化应用程序所需的一系列辅助代码。它负责模块的加载和解析逻辑。</p>
<p><strong>为什么要提取</strong>：运行时代码虽然小，但会随着模块关系的变化而变化。如果不提取，即使你的业务代码没变，但只要模块ID等元信息变了，包含业务代码的vendor chunk的哈希值也会变，导致浏览器缓存失效。提取后，运行时代码单独成一个很小的文件，经常变动的只是它，而庞大的vendor chunk和业务chunk可以保持缓存。</p>
<pre><code class="hljs language-JavaScript" lang="JavaScript"><span class="hljs-attr">optimization</span>: {
  <span class="hljs-attr">runtimeChunk</span>: <span class="hljs-string">`single`</span>, <span class="hljs-comment">// 提取所有入口点的运行时代码到一个文件中，如 `runtime~main.js`</span>
  <span class="hljs-comment">// 或者</span>
  <span class="hljs-attr">runtimeChunk</span>: {
    <span class="hljs-attr">name</span>: <span class="hljs-function"><span class="hljs-params">entrypoint</span> =&gt;</span> <span class="hljs-string">`runtime-<span class="hljs-subst">${entrypoint.name}</span>`</span>, <span class="hljs-comment">// 为每个入口生成独立的runtime文件</span>
  },
}
</code></pre>
<h4 data-id="heading-16">4.2 代码压缩</h4>
<pre><code class="hljs language-JavaScript" lang="JavaScript"><span class="hljs-keyword">const</span> <span class="hljs-title class_">TerserWebpackPlugin</span> = <span class="hljs-built_in">require</span>(<span class="hljs-string">'terser-webpack-plugin'</span>);
<span class="hljs-keyword">const</span> cssMinimizerPlugin = <span class="hljs-built_in">require</span>(<span class="hljs-string">'css-minimizer-webpack-plugin'</span>);

<span class="hljs-attr">optimization</span>: {
        <span class="hljs-attr">minimize</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">//是否启用代码压缩</span>
        <span class="hljs-attr">minimizer</span>: [
            <span class="hljs-keyword">new</span> <span class="hljs-title function_">cssMinimizerPlugin</span>(),<span class="hljs-comment">//优化并压缩css资源</span>
            <span class="hljs-keyword">new</span> <span class="hljs-title class_">TerserWebpackPlugin</span>({
                <span class="hljs-attr">cache</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">//启用缓存来加速构建构建过程</span>
                <span class="hljs-attr">parallel</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">//利用多核cpu 优势加快压缩速度</span>
                <span class="hljs-attr">terserOptions</span>: {
                    <span class="hljs-attr">compress</span>: {
                        <span class="hljs-attr">drop_console</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">///去掉 console.log 等语句</span>
                    }
                }
            }),
        ],
}
</code></pre>
<h3 data-id="heading-17">四.环境模式</h3>
<p>通过<code>mode</code>配置项的参数来知道当前的Webpack的构建环境,并且会启动Webpack针对不同环境的内置优化。</p>
<p>三个可选值：</p>
<ul>
<li><code>'development'</code>- 开发模式</li>
<li><code>'production'</code>- 生产模式</li>
<li><code>'none'</code>- 无默认优化</li>
</ul>
<p>不管是<code>development</code>还是<code>production</code>模式,我们进行Webpack配置项编写时可通过基础通用的配置与两种不同环境下的配置文件进行<code>merge</code>合并,生成最终的配置文件。</p>
<p>因为我们在两种不同的环境中所要求目标不一样,通过划分配置文件来形成在两种不同环境下的需求目标:</p>

























<table><thead><tr><th>特性</th><th>开发模式 (development)</th><th>生产模式 (production)</th></tr></thead><tbody><tr><td><strong>主要目标</strong>​</td><td>开发体验和构建速度</td><td>代码优化和性能</td></tr><tr><td><strong>代码压缩</strong>​</td><td>❌ 不压缩，保持可读性</td><td>✅ 深度压缩和优化</td></tr><tr><td><strong>构建速度</strong>​</td><td>⚡ 快速构建和重载</td><td>⏳ 较慢，但只执行一次</td></tr></tbody></table>



































<table><thead><tr><th/><th>webpack.base.js</th><th>webpack.dev.js</th><th>webpack.prod.js</th></tr></thead><tbody><tr><td>主要功能</td><td>存放开发/生产公共配置</td><td>热更新开发配置</td><td>产物优化配置</td></tr><tr><td/><td>入口文件动态构建</td><td>dev-serveer 配置</td><td>代码分割</td></tr><tr><td/><td>基础loader处理加载</td><td>source-map 代码映射配置</td><td>代码压缩</td></tr><tr><td/><td>公共插件加载</td><td>热更新映射/模块更新配置</td><td>多线程加速打包</td></tr></tbody></table>
<h4 data-id="heading-18">1.1 webpack.base.js (基础配置)</h4>
<pre><code class="hljs language-JavaScript" lang="JavaScript"><span class="hljs-keyword">const</span> glob = <span class="hljs-built_in">require</span>(<span class="hljs-string">'glob'</span>)
<span class="hljs-keyword">const</span> path = <span class="hljs-built_in">require</span>(<span class="hljs-string">'path'</span>)
<span class="hljs-keyword">const</span> webpack = <span class="hljs-built_in">require</span>(<span class="hljs-string">'webpack'</span>)
<span class="hljs-keyword">const</span> { <span class="hljs-title class_">VueLoaderPlugin</span> } = <span class="hljs-built_in">require</span>(<span class="hljs-string">'vue-loader'</span>)
<span class="hljs-keyword">const</span> <span class="hljs-title class_">HtmlWebpackPlugin</span> = <span class="hljs-built_in">require</span>(<span class="hljs-string">'html-webpack-plugin'</span>)

<span class="hljs-comment">//动态构造 entry 入口对象和 html-webpack-plugin 插件实例</span>
<span class="hljs-keyword">const</span> pageEntries = {}
<span class="hljs-keyword">const</span> htmlWebpackPluginList = []
<span class="hljs-comment">//自动加载app/pages目录下的入口文件</span>
<span class="hljs-keyword">const</span> entryList = glob.<span class="hljs-title function_">sync</span>(path.<span class="hljs-title function_">resolve</span>(process.<span class="hljs-title function_">cwd</span>(), <span class="hljs-string">'./app/pages/**/entry.*.js'</span>))
entryList.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">filePath</span>) =&gt;</span> {
  <span class="hljs-keyword">const</span> entryName = path.<span class="hljs-title function_">basename</span>(filePath, <span class="hljs-string">'.js'</span>)
  <span class="hljs-comment">//构造entry对象</span>
  pageEntries[entryName] = filePath
  <span class="hljs-comment">//构造最终渲染的页面文件</span>
  htmlWebpackPluginList.<span class="hljs-title function_">push</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">HtmlWebpackPlugin</span>({
    <span class="hljs-comment">//产物 (最终末班) 输出路径</span>
    <span class="hljs-attr">filename</span>: path.<span class="hljs-title function_">resolve</span>(process.<span class="hljs-title function_">cwd</span>(), <span class="hljs-string">'./app/public/dist/'</span>, <span class="hljs-string">`<span class="hljs-subst">${entryName}</span>.tpl`</span>),
    <span class="hljs-comment">//指定要使用的模板文件</span>
    <span class="hljs-attr">template</span>: path.<span class="hljs-title function_">resolve</span>(process.<span class="hljs-title function_">cwd</span>(), <span class="hljs-string">'./app/view/entry.tpl'</span>),
    <span class="hljs-comment">//要注入的代码块</span>
    <span class="hljs-attr">chunks</span>: [entryName],
  }))
})

<span class="hljs-comment">/*
 * @Description: webpack基础配置
 */</span>
<span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = {
  <span class="hljs-comment">//入口配置</span>
  <span class="hljs-attr">entry</span>: pageEntries,
  <span class="hljs-comment">//模块解析配置(决定需要加载解析什么模块,以及用什么方式解析)</span>
  <span class="hljs-attr">module</span>: {
    <span class="hljs-attr">rules</span>: [
      {
        <span class="hljs-attr">test</span>: <span class="hljs-regexp">/\.vue$/</span>,
        <span class="hljs-attr">use</span>: { <span class="hljs-attr">loader</span>: <span class="hljs-string">'vue-loader'</span> }
      },
      {
        <span class="hljs-attr">test</span>: <span class="hljs-regexp">/\.js$/</span>,
        <span class="hljs-attr">include</span>: [
          <span class="hljs-comment">//只对业务代码进行vavel, 加快 webpack 打包速度</span>
          <span class="hljs-comment">//表示只对 app/pages 目录下的js文件进行 babel 转换</span>
          path.<span class="hljs-title function_">resolve</span>(process.<span class="hljs-title function_">cwd</span>(), <span class="hljs-string">'./app/pages'</span>),
        ],
        <span class="hljs-attr">use</span>: { <span class="hljs-attr">loader</span>: <span class="hljs-string">'babel-loader'</span> },
      },
      {
        <span class="hljs-attr">test</span>: <span class="hljs-regexp">/\.(png|jpg|jpeg|gif)(\?.+)?$/</span>,
        <span class="hljs-attr">use</span>: {
          <span class="hljs-attr">loader</span>: <span class="hljs-string">'url-loader'</span>,
          <span class="hljs-attr">options</span>: {
            <span class="hljs-attr">limit</span>: <span class="hljs-number">8192</span>,  <span class="hljs-comment">// 小于 8KB 的图片转为 base64</span>
            <span class="hljs-attr">name</span>: <span class="hljs-string">'[name].[ext]'</span>,
            <span class="hljs-attr">outputPath</span>: <span class="hljs-string">'images/'</span>,
            <span class="hljs-attr">esModule</span>: <span class="hljs-literal">false</span> <span class="hljs-comment">// 控制导出格式, true 导出为 esModule 模块, false 导出为 commonjs 模块</span>
          }
        }
      },
      {
        <span class="hljs-attr">test</span>: <span class="hljs-regexp">/\.css$/</span>,
        <span class="hljs-attr">use</span>: [<span class="hljs-string">'style-loader'</span>, <span class="hljs-string">'css-loader'</span>]
      },
      {
        <span class="hljs-attr">test</span>: <span class="hljs-regexp">/\.less$/</span>,
        <span class="hljs-attr">use</span>: [<span class="hljs-string">'style-loader'</span>, <span class="hljs-string">'css-loader'</span>, <span class="hljs-string">'less-loader'</span>]
      },
      {
        <span class="hljs-attr">test</span>: <span class="hljs-regexp">/\.(eot | svg |ttf |woff |woff2)(\?\S*)?$/</span>,
        <span class="hljs-attr">use</span>: <span class="hljs-string">'file-loader'</span>
      }
    ]
  },
  <span class="hljs-comment">//产物输出路径,因为开发和生产环境的输出路径不同,所以需要区分,各自环境中分别配置</span>
  <span class="hljs-attr">output</span>: {},
  <span class="hljs-comment">//配置模块解析的具体行为(定义 webpack 在打包时,如何找到具体模块并解析)</span>
  <span class="hljs-attr">resolve</span>: {
    <span class="hljs-attr">extensions</span>: [<span class="hljs-string">'.js'</span>, <span class="hljs-string">'.vue'</span>, <span class="hljs-string">'.less'</span>, <span class="hljs-string">'.css'</span>],<span class="hljs-comment">//配置解析的文件扩展名</span>
    <span class="hljs-attr">alias</span>: {
      <span class="hljs-comment">//配置别名,方便在代码中引入模块  </span>
      <span class="hljs-attr">$pages</span>: path.<span class="hljs-title function_">resolve</span>(process.<span class="hljs-title function_">cwd</span>(), <span class="hljs-string">'./app/pages'</span>),
      <span class="hljs-attr">$common</span>: path.<span class="hljs-title function_">resolve</span>(process.<span class="hljs-title function_">cwd</span>(), <span class="hljs-string">'./app/pages/common'</span>),
      <span class="hljs-attr">$widgets</span>: path.<span class="hljs-title function_">resolve</span>(process.<span class="hljs-title function_">cwd</span>(), <span class="hljs-string">'./app/pages/widgets'</span>),
      <span class="hljs-attr">$store</span>: path.<span class="hljs-title function_">resolve</span>(process.<span class="hljs-title function_">cwd</span>(), <span class="hljs-string">'./app/pages/store'</span>),
    },
  },
  <span class="hljs-comment">//配置webpack插件</span>
  <span class="hljs-attr">plugins</span>: [
    <span class="hljs-comment">//处理.vue文件,将自定义的其他规则复制并应用到 .vue 文件的解析中</span>
    <span class="hljs-keyword">new</span> <span class="hljs-title class_">VueLoaderPlugin</span>(),
    <span class="hljs-comment">//把第三方库暴露到 Window context下</span>
    <span class="hljs-keyword">new</span> webpack.<span class="hljs-title class_">ProvidePlugin</span>({
      <span class="hljs-title class_">Vue</span>: <span class="hljs-string">'vue'</span>,
      <span class="hljs-attr">axios</span>: <span class="hljs-string">'axios'</span>,
      <span class="hljs-attr">_</span>: <span class="hljs-string">'lodash'</span>,
    }),
    <span class="hljs-comment">//定义全局变量</span>
    <span class="hljs-keyword">new</span> webpack.<span class="hljs-title class_">DefinePlugin</span>({
      <span class="hljs-attr">__VUE_OPTIONS_API__</span>: <span class="hljs-string">'true'</span>, <span class="hljs-comment">//支持 vue 解析 options API</span>
      <span class="hljs-attr">__VUE_PROD_DEVTOOLS__</span>: <span class="hljs-string">'false'</span>, <span class="hljs-comment">//是否开启 vue 生产环境下的 devtools 功能</span>
      <span class="hljs-attr">__VUE_PROD_HYDRATION_MISMATCH_DETAILS__</span>: <span class="hljs-string">'false'</span>, <span class="hljs-comment">//是否开启 vue 生产环境下的 hydration  mismatch('水合') 详情功能</span>
    }),
    <span class="hljs-comment">//构建最终渲染的页面模板</span>
    ...htmlWebpackPluginList,
  ],
  <span class="hljs-comment">//配置打包输出优化(配置代码分割,模块合并,缓存,TreeShaing,压缩等优化策略)</span>
  <span class="hljs-attr">optimization</span>: {
    <span class="hljs-attr">splitChunks</span>: {
      <span class="hljs-attr">chunks</span>: <span class="hljs-string">'all'</span>, <span class="hljs-comment">//对同步和异步模块都进行分割</span>
      <span class="hljs-attr">maxAsyncRequests</span>: <span class="hljs-number">10</span>, <span class="hljs-comment">// 每次异步加载的最大并行请求数</span>
      <span class="hljs-attr">maxInitialRequests</span>: <span class="hljs-number">10</span>, <span class="hljs-comment">// 入口点的最大并行请求数</span>
      <span class="hljs-attr">cacheGroups</span>: {
        <span class="hljs-comment">//第三方库依赖库</span>
        <span class="hljs-attr">vendor</span>: {
          <span class="hljs-attr">test</span>: <span class="hljs-regexp">/[\\/]node_modules[\\/]/</span>, <span class="hljs-comment">//打包 node_modules 中的文件</span>
          <span class="hljs-attr">name</span>: <span class="hljs-string">'vendor'</span>,<span class="hljs-comment">//模块名称</span>
          <span class="hljs-attr">priority</span>: <span class="hljs-number">20</span>, <span class="hljs-comment">//优先级, 数值越大,优先级越高</span>
          <span class="hljs-attr">enforce</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">//强制分割, 不考虑 minSize, maxSize 等配置</span>
          <span class="hljs-attr">reuseExistingChunk</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">//复用已用的公共 chunk</span>
        },
        <span class="hljs-comment">//公共模块部分</span>
        <span class="hljs-attr">common</span>: {
          <span class="hljs-attr">name</span>: <span class="hljs-string">'common'</span>, <span class="hljs-comment">//模块名称</span>
          <span class="hljs-attr">minChunks</span>: <span class="hljs-number">2</span>, <span class="hljs-comment">//模块被引用次数超过 2 次,才会被分割</span>
          <span class="hljs-attr">minSize</span>: <span class="hljs-number">1</span>,
          <span class="hljs-attr">priority</span>: <span class="hljs-number">10</span>,
          <span class="hljs-attr">reuseExistingChunk</span>: <span class="hljs-literal">true</span>,
        },
      },
    },
    <span class="hljs-comment">//将 Webpack 的运行时（runtime）​ 代码提取到单独的文件中。</span>
    <span class="hljs-attr">runtimeChunk</span>: {
      <span class="hljs-attr">name</span>: <span class="hljs-string">'runtime'</span>,
    },
  },
}
</code></pre>
<h4 data-id="heading-19">1.2 webpack.prod.js (生产配置)</h4>
<pre><code class="hljs language-JavaScript" lang="JavaScript"><span class="hljs-keyword">const</span> merge = <span class="hljs-built_in">require</span>(<span class="hljs-string">'webpack-merge'</span>); <span class="hljs-comment">//webpack 配置合并插件</span>
<span class="hljs-keyword">const</span> path = <span class="hljs-built_in">require</span>(<span class="hljs-string">'path'</span>)
<span class="hljs-keyword">const</span> os = <span class="hljs-built_in">require</span>(<span class="hljs-string">'os'</span>)
<span class="hljs-keyword">const</span> <span class="hljs-title class_">HappyPack</span> = <span class="hljs-built_in">require</span>(<span class="hljs-string">'happypack'</span>)

<span class="hljs-keyword">const</span> miniCssExtractPlugin = <span class="hljs-built_in">require</span>(<span class="hljs-string">'mini-css-extract-plugin'</span>)
<span class="hljs-keyword">const</span> <span class="hljs-title class_">CleanWebpackPlugin</span> = <span class="hljs-built_in">require</span>(<span class="hljs-string">'clean-webpack-plugin'</span>);
<span class="hljs-keyword">const</span> cssMinimizerPlugin = <span class="hljs-built_in">require</span>(<span class="hljs-string">'css-minimizer-webpack-plugin'</span>);
<span class="hljs-keyword">const</span> <span class="hljs-title class_">HtmlWebpackInjectAttributesPlugin</span> = <span class="hljs-built_in">require</span>(<span class="hljs-string">'html-webpack-inject-attributes-plugin'</span>);
<span class="hljs-keyword">const</span> <span class="hljs-title class_">TerserWebpackPlugin</span> = <span class="hljs-built_in">require</span>(<span class="hljs-string">'terser-webpack-plugin'</span>);

<span class="hljs-comment">//基类配置</span>
<span class="hljs-keyword">const</span> baseConfig = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./webpack.base.js'</span>);
<span class="hljs-comment">//多线程 build 设置</span>
<span class="hljs-keyword">const</span> happypackCommonConfig = {
    <span class="hljs-attr">debug</span>: <span class="hljs-literal">false</span>,
    <span class="hljs-attr">threadPool</span>: <span class="hljs-title class_">HappyPack</span>.<span class="hljs-title class_">ThreadPool</span>({ <span class="hljs-attr">size</span>: os.<span class="hljs-title function_">cpus</span>().<span class="hljs-property">length</span> }),
}
<span class="hljs-comment">//生产环境 webpack 配置</span>
<span class="hljs-keyword">const</span> webpackConfig = merge.<span class="hljs-title function_">smart</span>(baseConfig, {
    <span class="hljs-comment">//指定生产环境</span>
    <span class="hljs-attr">mode</span>: <span class="hljs-string">'production'</span>,
    <span class="hljs-comment">//生产环境的 output 配置</span>
    <span class="hljs-attr">output</span>: {
        <span class="hljs-attr">filename</span>: <span class="hljs-string">'js/[name]_[chunkhash:8].bundle.js'</span>,
        <span class="hljs-attr">path</span>: path.<span class="hljs-title function_">join</span>(process.<span class="hljs-title function_">cwd</span>(), <span class="hljs-string">'./app/public/dist/prod'</span>),
        <span class="hljs-attr">publicPath</span>: <span class="hljs-string">'/dist/prod/'</span>,
        <span class="hljs-attr">crossOriginLoading</span>: <span class="hljs-string">'anonymous'</span>,<span class="hljs-comment">//跨域加载资源时,是否添加 crossorigin 属性</span>
    },
    <span class="hljs-comment">//生产环境的模块解析配置</span>
    <span class="hljs-attr">module</span>: {
        <span class="hljs-attr">rules</span>: [
            {
                <span class="hljs-attr">test</span>: <span class="hljs-regexp">/\.css$/</span>,
                <span class="hljs-attr">use</span>: [
                    miniCssExtractPlugin.<span class="hljs-property">loader</span>,
                    <span class="hljs-string">'happypack/loader?id=css'</span>,
                ]
            },
            {
                <span class="hljs-attr">test</span>: <span class="hljs-regexp">/\.js$/</span>,
                <span class="hljs-attr">include</span>: [
                    path.<span class="hljs-title function_">resolve</span>(process.<span class="hljs-title function_">cwd</span>(), <span class="hljs-string">'./app/pages'</span>),
                ],
                <span class="hljs-attr">use</span>: [<span class="hljs-string">'happypack/loader?id=js'</span>],
            },
        ]
    },
    <span class="hljs-comment">// webpack 不会有大量的 hints 信息 ,默认是 warning</span>
    <span class="hljs-attr">performance</span>: {
        <span class="hljs-attr">hints</span>: <span class="hljs-literal">false</span>,
    },
    <span class="hljs-attr">plugins</span>: [
        <span class="hljs-comment">//每次build 前,先删除上一次的 build 结果</span>
        <span class="hljs-keyword">new</span> <span class="hljs-title class_">CleanWebpackPlugin</span>([<span class="hljs-string">'public/dist'</span>], {
            <span class="hljs-attr">root</span>: path.<span class="hljs-title function_">resolve</span>(process.<span class="hljs-title function_">cwd</span>(), <span class="hljs-string">'./app/'</span>),
            <span class="hljs-attr">exclude</span>: [],
            <span class="hljs-attr">verbose</span>: <span class="hljs-literal">true</span>,
            <span class="hljs-attr">dry</span>: <span class="hljs-literal">false</span>,
        }),
        <span class="hljs-comment">//提取 css 的公共部分,有效利用缓存</span>
        <span class="hljs-keyword">new</span> <span class="hljs-title function_">miniCssExtractPlugin</span>({
            <span class="hljs-attr">chunkFilename</span>: <span class="hljs-string">'css/[name]_[contenthash:8].bundle.css'</span>,
            <span class="hljs-attr">filename</span>: <span class="hljs-string">'css/[name].[contenthash:8].bundle.css'</span> <span class="hljs-comment">// 输出到 单独 css 文件夹</span>
        }),
        <span class="hljs-comment">//多线程打包 js ,加快打包速度</span>
        <span class="hljs-keyword">new</span> <span class="hljs-title class_">HappyPack</span>({
            ...happypackCommonConfig,
            <span class="hljs-attr">id</span>: <span class="hljs-string">'js'</span>,
            <span class="hljs-attr">loaders</span>: [{
                <span class="hljs-attr">path</span>: <span class="hljs-string">'babel-loader'</span>,
                <span class="hljs-attr">options</span>: {
                    <span class="hljs-attr">presets</span>: [<span class="hljs-string">'@babel/preset-env'</span>],
                    <span class="hljs-attr">plugins</span>: [<span class="hljs-string">'@babel/plugin-transform-runtime'</span>]
                }
            }],
        }),
        <span class="hljs-comment">//多线程打包 css ,加快打包速度</span>
        <span class="hljs-keyword">new</span> <span class="hljs-title class_">HappyPack</span>({
            ...happypackCommonConfig,
            <span class="hljs-attr">id</span>: <span class="hljs-string">'css'</span>,
            <span class="hljs-attr">loaders</span>: [{
                <span class="hljs-attr">path</span>: <span class="hljs-string">'css-loader'</span>,
                <span class="hljs-attr">options</span>: {
                    <span class="hljs-attr">importLoaders</span>: <span class="hljs-number">1</span>,
                }
            }],
        }),
        <span class="hljs-comment">//浏览器在请求资源时,不发送用户的身份凭证</span>
        <span class="hljs-keyword">new</span> <span class="hljs-title class_">HtmlWebpackInjectAttributesPlugin</span>({
            <span class="hljs-attr">crossorigin</span>: <span class="hljs-string">'anonymous'</span>,
        }),
    ],
    <span class="hljs-attr">optimization</span>: {
        <span class="hljs-attr">minimize</span>: <span class="hljs-literal">true</span>,
        <span class="hljs-attr">minimizer</span>: [
            <span class="hljs-comment">//优化并压缩css资源</span>
            <span class="hljs-keyword">new</span> <span class="hljs-title function_">cssMinimizerPlugin</span>(),
            <span class="hljs-keyword">new</span> <span class="hljs-title class_">TerserWebpackPlugin</span>({
                <span class="hljs-attr">cache</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">//启用缓存来加速构建构建过程</span>
                <span class="hljs-attr">parallel</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">//利用多核cpu 优势加快压缩速度</span>
                <span class="hljs-attr">terserOptions</span>: {
                    <span class="hljs-attr">compress</span>: {
                        <span class="hljs-attr">drop_console</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">///去掉 console.log 等语句</span>
                    }
                }
            }),
        ],
        <span class="hljs-attr">splitChunks</span>: {
            <span class="hljs-attr">cacheGroups</span>: {
                <span class="hljs-attr">vue</span>: {
                    <span class="hljs-attr">test</span>: <span class="hljs-regexp">/[\\/]node_modules[\\/]vue/</span>, <span class="hljs-comment">// 匹配 node_modules 中的 Vue</span>
                    <span class="hljs-attr">name</span>: <span class="hljs-string">'vue'</span>, <span class="hljs-comment">// 输出文件名为 vue.[hash].js</span>
                    <span class="hljs-attr">chunks</span>: <span class="hljs-string">'all'</span>, <span class="hljs-comment">// 处理所有引入方式（同步/异步）</span>
                    <span class="hljs-attr">priority</span>: <span class="hljs-number">30</span>, <span class="hljs-comment">// 优先级高于 vendor（确保先拆分 Vue）</span>
                    <span class="hljs-attr">enforce</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// 强制拆分（忽略 minSize 限制，即使 Vue 很小也拆分）</span>
                },
            },
        },
    }
});

<span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = webpackConfig;
</code></pre>
<p>在Elpis 项目中我们是使用<code>HappyPack</code>来启用多线程加速打包的速度,我们也可以使用<code>thread-loader</code>来优化打包速度。</p>
<pre><code class="hljs language-JavaScript" lang="JavaScript"><span class="hljs-attr">module</span>: {
  <span class="hljs-attr">rules</span>: [
    {
      <span class="hljs-attr">test</span>: <span class="hljs-regexp">/.js$/</span>,
      <span class="hljs-attr">use</span>: [
        {
          <span class="hljs-attr">loader</span>: <span class="hljs-string">'thread-loader'</span>,
          <span class="hljs-attr">options</span>: {
            <span class="hljs-attr">workers</span>: <span class="hljs-number">2</span>, <span class="hljs-comment">// 线程数量,  使用 os.cpus().length 自动根据cpu核心生成线程数</span>
            <span class="hljs-attr">workerParallelJobs</span>: <span class="hljs-number">50</span>, <span class="hljs-comment">// 每个线程并行任务数</span>
            <span class="hljs-attr">poolTimeout</span>: <span class="hljs-number">2000</span> <span class="hljs-comment">// 超时时间</span>
          }
        },
        <span class="hljs-string">'babel-loader'</span>
      ]
    }
  ]
}
</code></pre>
<h4 data-id="heading-20">1.3 webpack.dev.js (开发配置)</h4>
<pre><code class="hljs language-JavaScript" lang="JavaScript"><span class="hljs-keyword">const</span> merge = <span class="hljs-built_in">require</span>(<span class="hljs-string">'webpack-merge'</span>); <span class="hljs-comment">//webpack 配置合并插件</span>
<span class="hljs-keyword">const</span> path = <span class="hljs-built_in">require</span>(<span class="hljs-string">'path'</span>)
<span class="hljs-keyword">const</span> webpack = <span class="hljs-built_in">require</span>(<span class="hljs-string">'webpack'</span>)
<span class="hljs-comment">//基类配置</span>
<span class="hljs-keyword">const</span> baseConfig = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./webpack.base.js'</span>);
<span class="hljs-comment">//dev-serveer 配置</span>
<span class="hljs-keyword">const</span> <span class="hljs-variable constant_">DEV_SERVER_CONFIG</span> = {
    <span class="hljs-attr">HOST</span>: <span class="hljs-string">'127.0.0.1'</span>,
    <span class="hljs-attr">PORT</span>: <span class="hljs-number">9002</span>,
    <span class="hljs-attr">HMR_PATH</span>: <span class="hljs-string">'__webpack_hmr'</span>, <span class="hljs-comment">//官方规定</span>
    <span class="hljs-attr">TIMEOUT</span>: <span class="hljs-number">20000</span>,
}
<span class="hljs-comment">//开发阶段的 entry 配置需要加入hmr</span>
<span class="hljs-title class_">Object</span>.<span class="hljs-title function_">keys</span>(baseConfig.<span class="hljs-property">entry</span>).<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">entryName</span>) =&gt;</span> {
    <span class="hljs-keyword">if</span> (entryName !== <span class="hljs-string">'vendor'</span>) {
        baseConfig.<span class="hljs-property">entry</span>[entryName] = [
            <span class="hljs-comment">//主入口文件</span>
            baseConfig.<span class="hljs-property">entry</span>[entryName],
            <span class="hljs-comment">//hmr 更新入口 ,官方指定的 hmr 路径</span>
            <span class="hljs-string">`webpack-hot-middleware/client?path=http://<span class="hljs-subst">${DEV_SERVER_CONFIG.HOST}</span>:<span class="hljs-subst">${DEV_SERVER_CONFIG.PORT}</span>/<span class="hljs-subst">${DEV_SERVER_CONFIG.HMR_PATH}</span>&amp;timeout=<span class="hljs-subst">${DEV_SERVER_CONFIG.TIMEOUT}</span>&amp;reload=true`</span>,
        ]
    }
})
<span class="hljs-comment">// 开发环境 webpack 配置</span>
<span class="hljs-keyword">const</span> webpackConfig = merge.<span class="hljs-title function_">smart</span>(baseConfig, {
    <span class="hljs-comment">//指定开发环境</span>
    <span class="hljs-attr">mode</span>: <span class="hljs-string">'development'</span>,
    <span class="hljs-comment">//source-map 配置,呈现代码的映射关系,便于观察代码</span>
    <span class="hljs-attr">devtool</span>: <span class="hljs-string">'eval-cheap-module-source-map'</span>,
    <span class="hljs-comment">//开发环境的 output 配置</span>
    <span class="hljs-attr">output</span>: {
        <span class="hljs-attr">filename</span>: <span class="hljs-string">'js/[name]_[chunkhash:8].bundle.js'</span>,
        <span class="hljs-attr">path</span>: path.<span class="hljs-title function_">resolve</span>(process.<span class="hljs-title function_">cwd</span>(), <span class="hljs-string">'./app/public/dist/dev/'</span>), <span class="hljs-comment">//输出文件存储路径</span>
        <span class="hljs-attr">publicPath</span>: <span class="hljs-string">`http://<span class="hljs-subst">${DEV_SERVER_CONFIG.HOST}</span>:<span class="hljs-subst">${DEV_SERVER_CONFIG.PORT}</span>/public/dist/dev/`</span>, <span class="hljs-comment">//外部资源公共路径</span>
        <span class="hljs-attr">globalObject</span>: <span class="hljs-string">'this'</span>,<span class="hljs-comment">//指定全局对象,默认是 window</span>
    },
    <span class="hljs-comment">//开发环境插件</span>
    <span class="hljs-attr">plugins</span>: [
        <span class="hljs-comment">// 热更新插件,模块热更新允许在应用运行时,替换、添加或删除模块,而无需刷新整个页面</span>
        <span class="hljs-keyword">new</span> webpack.<span class="hljs-title class_">HotModuleReplacementPlugin</span>({
            <span class="hljs-attr">multiStep</span>: <span class="hljs-literal">false</span>,
        }),
    ],
});
<span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = {
    webpackConfig, <span class="hljs-comment">//webpack 开发环境配置</span>
    <span class="hljs-variable constant_">DEV_SERVER_CONFIG</span>, <span class="hljs-comment">//dev-server 配置</span>
}
</code></pre>
<h4 data-id="heading-21">1.4 Source Map 配置选项总览</h4>
<p>该配置选项主要便利开发时快速定位代码错误位置</p>





































































































<table><thead><tr><th>配置值</th><th>构建速度</th><th>重建速度</th><th>质量</th><th>生产环境适用</th><th>特点</th></tr></thead><tbody><tr><td><code>false</code></td><td>最快</td><td>最快</td><td>无</td><td>✅</td><td>不生成 source map</td></tr><tr><td><code>eval</code></td><td>很快</td><td>最快</td><td>差</td><td>❌</td><td>每个模块用 eval 执行</td></tr><tr><td><code>eval-source-map</code></td><td>慢</td><td>一般</td><td>高</td><td>❌</td><td>每个模块生成 DataUrl 的 source map</td></tr><tr><td><code>eval-cheap-source-map</code></td><td>较快</td><td>快</td><td>中</td><td>❌</td><td>只映射行，不映射列</td></tr><tr><td><code>eval-cheap-module-source-map</code></td><td>一般</td><td>一般</td><td>中高</td><td>❌</td><td>包含 loader 转换前的代码</td></tr><tr><td><code>source-map</code></td><td>慢</td><td>慢</td><td>最高</td><td>✅</td><td>生成独立的 .map 文件</td></tr><tr><td><code>hidden-source-map</code></td><td>慢</td><td>慢</td><td>最高</td><td>✅</td><td>生成 .map 文件但不引用</td></tr><tr><td><code>inline-source-map</code></td><td>慢</td><td>慢</td><td>最高</td><td>❌</td><td>将 source map 内联到文件中</td></tr><tr><td><code>cheap-source-map</code></td><td>一般</td><td>一般</td><td>中</td><td>✅</td><td>只映射行，忽略 loader source map</td></tr><tr><td><code>cheap-module-source-map</code></td><td>一般</td><td>一般</td><td>中高</td><td>✅</td><td>包含 loader 转换前的代码</td></tr><tr><td><code>nosources-source-map</code></td><td>慢</td><td>慢</td><td>中</td><td>✅</td><td>生成 .map 但不包含源代码内容</td></tr></tbody></table>
<h4 data-id="heading-22">1.5 热更新(HMR)</h4>
<p>HMR 的核心思想是：<strong>在应用程序运行过程中，替换、添加或删除模块，而无需完全重新加载整个页面</strong>。</p>
<p>可以概括为以下几个步骤：</p>
<h5 data-id="heading-23">1. 启动阶段</h5>
<ol>
<li><strong>webpack 编译</strong>：首先，webpack 在启动开发服务器时，会对源代码进行编译，并生成 bundle 文件（文件<code>都在内存中</code>）。</li>
<li><strong>注入 HMR Runtime</strong>：在编译过程中，webpack 会向 bundle 中注入 HMR Runtime 代码。这段代码将在浏览器中运行，负责与开发服务器的 HMR 服务进行WebSocket通信，并处理更新逻辑。</li>
</ol>
<h5 data-id="heading-24">2. 文件监听与编译</h5>
<ol>
<li><strong>监听文件变化</strong>：webpack 通过文件系统监听来监测项目中的文件变化。</li>
<li><strong>增量编译</strong>：当文件发生变化时，webpack 会重新编译这些变化的模块。注意，这里<code>不是完全重新编译</code>，而是增量编译，只编译变化的模块和受影响的模块，以生成更新的模块代码。</li>
</ol>
<h5 data-id="heading-25">3. 生成更新包（Update）</h5>
<p>编译完成后，webpack 会生成一个更新包（update），这个包包含了变化的模块的代码以及更新信息（通常是一个 JSON 文件，描述了哪些模块发生了变化以及新的模块代码）。</p>
<h5 data-id="heading-26">4. 通知客户端</h5>
<ol>
<li><strong>WebSocket 推送</strong>：开发服务器通过 WebSocket 向浏览器发送一个消息，通知浏览器有更新可用。这个消息通常包含一个 hash 值（本次更新的标识）和更新包的 URL。</li>
<li><strong>下载更新包</strong>：浏览器端的 HMR Runtime 收到通知后，会通过 AJAX 请求更新包（通常是一个 JavaScript 文件，包含了更新的模块代码）。</li>
</ol>
<h5 data-id="heading-27">5. 应用更新</h5>
<ol>
<li><strong>检查更新是否可应用</strong>：HMR Runtime 会检查当前模块树中哪些模块需要更新。它根据更新包中的信息，找到需要更新的模块。</li>
<li><strong>模块替换</strong>：对于 JavaScript 模块，HMR Runtime 会移除旧的模块，并执行新的模块代码。如果模块支持 HMR（即模块代码中包含了 <code>module.hot.accept</code>等处理代码），那么会执行模块自身的更新逻辑（例如，重新执行模块代码，并调用回调函数）。对于样式模块，通常直接替换 style 标签即可。</li>
<li><strong>回调与错误处理</strong>：如果更新过程中有错误，HMR Runtime 会回退到完整页面刷新。如果更新成功，可能会触发一些回调函数（例如，<code>module.hot.accept</code>中注册的回调）。</li>
</ol>
<h5 data-id="heading-28">6.构建HMR热更新服务</h5>
<p>在前面的所讲的<code>webpack.dev.js</code>环境下的配置文件,已做了相关的HMR配置内容。通过<code>dev.js</code>来作为HMR开发的启动文件,<code>Express</code>框架作为搭建HMR服务,<code>webpack-dev-middleware</code>插件监听文件的改动完成增量编译,<code>webpack-hot-middleware</code>来实现与浏览器之间的通讯,最终实现HMR代码更新。</p>
<p><strong>dev.js</strong></p>
<pre><code class="hljs language-JavaScript" lang="JavaScript"><span class="hljs-comment">// 本地开发启动 devserber</span>
<span class="hljs-keyword">const</span> express = <span class="hljs-built_in">require</span>(<span class="hljs-string">'express'</span>);
<span class="hljs-keyword">const</span> path = <span class="hljs-built_in">require</span>(<span class="hljs-string">'path'</span>);
<span class="hljs-keyword">const</span> consoler = <span class="hljs-built_in">require</span>(<span class="hljs-string">'consoler'</span>);
<span class="hljs-keyword">const</span> webpack = <span class="hljs-built_in">require</span>(<span class="hljs-string">'webpack'</span>);
<span class="hljs-keyword">const</span> devMiddleware = <span class="hljs-built_in">require</span>(<span class="hljs-string">'webpack-dev-middleware'</span>);
<span class="hljs-keyword">const</span> hotMiddleware = <span class="hljs-built_in">require</span>(<span class="hljs-string">'webpack-hot-middleware'</span>);

<span class="hljs-comment">//从 webpack.dev.js 中引入 webpack 配置</span>
<span class="hljs-keyword">const</span> { webpackConfig, <span class="hljs-variable constant_">DEV_SERVER_CONFIG</span> } = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./config/webpack.dev.js'</span>);

<span class="hljs-keyword">const</span> app = <span class="hljs-title function_">express</span>();

<span class="hljs-keyword">const</span> compiler = <span class="hljs-title function_">webpack</span>(webpackConfig);
<span class="hljs-comment">//指定静态文件目录</span>
app.<span class="hljs-title function_">use</span>(express.<span class="hljs-title function_">static</span>(path.<span class="hljs-title function_">join</span>(process.<span class="hljs-title function_">cwd</span>(), <span class="hljs-string">'./app/public/dist/'</span>)));
<span class="hljs-comment">//引用 devMiddleware 中间件 监控文件改动</span>
app.<span class="hljs-title function_">use</span>(<span class="hljs-title function_">devMiddleware</span>(compiler, {
    <span class="hljs-comment">//落地文件</span>
    <span class="hljs-attr">writeToDisk</span>: <span class="hljs-function">(<span class="hljs-params">filePath</span>) =&gt;</span> filePath.<span class="hljs-title function_">endsWith</span>(<span class="hljs-string">'.tpl'</span>),
    <span class="hljs-comment">//资源路径</span>
    <span class="hljs-attr">publicPath</span>: webpackConfig.<span class="hljs-property">output</span>.<span class="hljs-property">publicPath</span>,
    <span class="hljs-comment">//head 信息</span>
    <span class="hljs-attr">headers</span>: {
        <span class="hljs-string">'Access-Control-Allow-Origin'</span>: <span class="hljs-string">'*'</span>,<span class="hljs-comment">// 允许所有域名跨域访问</span>
        <span class="hljs-string">'Access-Control-Allow-Methods'</span>: <span class="hljs-string">'GET, POST, PUT, DELETE, PATCH, OPTIONS'</span>,<span class="hljs-comment">// 允许的HTTP方法</span>
        <span class="hljs-string">'Access-Control-Allow-Headers'</span>: <span class="hljs-string">'X-Requested-With, content-type, Authorization'</span>,<span class="hljs-comment">// 允许的请求头</span>
    },
    <span class="hljs-attr">stats</span>: {
        <span class="hljs-attr">colors</span>: <span class="hljs-literal">true</span>,
    },
}));
<span class="hljs-comment">//引用 hotMiddleware 中间件 实现热更新通讯</span>
app.<span class="hljs-title function_">use</span>(<span class="hljs-title function_">hotMiddleware</span>(compiler, {
    <span class="hljs-attr">path</span>: <span class="hljs-string">`/<span class="hljs-subst">${DEV_SERVER_CONFIG.HMR_PATH}</span>`</span>,
    <span class="hljs-attr">log</span>: <span class="hljs-function">() =&gt;</span> { },
}));

consoler.<span class="hljs-title function_">info</span>(<span class="hljs-string">'请等待webpack初次构建完成提示....'</span>);

<span class="hljs-comment">//启动服务</span>
<span class="hljs-keyword">const</span> port = <span class="hljs-variable constant_">DEV_SERVER_CONFIG</span>.<span class="hljs-property">PORT</span>;
app.<span class="hljs-title function_">listen</span>(port, <span class="hljs-function">() =&gt;</span> {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`dev-server 启动成功, http://<span class="hljs-subst">${DEV_SERVER_CONFIG.HOST}</span>:<span class="hljs-subst">${port}</span>`</span>);
})
</code></pre>
<p>在<code>dedv.js</code>中<code>headers</code>配置项配置解释:</p>
<p>因为HMR可能涉及到<code>跨域请求</code>（例如，前端应用运行在另一个端口上，而开发服务器在另一个端口）。
所以在Webpack开发中间件中配置headers，主要是为了控制CORS（跨域资源共享）相关的行为，确保在开发过程中，前端应用能够正确地从开发服务器加载资源并进行HMR通信。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[破茧成蝶：Web 前端开发的三次革命与架构演进史]]></title>    <link>https://juejin.cn/post/7582118218649174042</link>    <guid>https://juejin.cn/post/7582118218649174042</guid>    <pubDate>2025-12-11T04:59:36.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7582118218649174042" data-draft-id="7582104240988176410" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="破茧成蝶：Web 前端开发的三次革命与架构演进史"/> <meta itemprop="keywords" content="JavaScript,ECMAScript 6,Vue.js"/> <meta itemprop="datePublished" content="2025-12-11T04:59:36.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="San30"/> <meta itemprop="url" content="https://juejin.cn/user/1766294768060816"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            破茧成蝶：Web 前端开发的三次革命与架构演进史
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1766294768060816/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    San30
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-11T04:59:36.000Z" title="Thu Dec 11 2025 04:59:36 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-11
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:14px;overflow-x:hidden;color:var(--cyanosis-base-color);transition:color .35s;--cyanosis-base-color:#353535;--cyanosis-title-color:#005bb7;--cyanosis-strong-color:#2196f3;--cyanosis-em-color:#4fc3f7;--cyanosis-del-color:#ccc;--cyanosis-link-color:#3da8f5;--cyanosis-linkh-color:#007fff;--cyanosis-border-color:#bedcff;--cyanosis-border-color-2:#ececec;--cyanosis-bg-color:#fff;--cyanosis-blockquote-color:#8c8c8c;--cyanosis-blockquote-bg-color:#f0fdff;--cyanosis-code-color:#c2185b;--cyanosis-code-bg-color:#fff4f4;--cyanosis-code-pre-color:#f8f8f8;--cyanosis-table-border-color:#c3e0fd;--cyanosis-table-th-color:#dff0ff;--cyanosis-table-tht-color:#005bb7;--cyanosis-table-tr-nc-color:#f7fbff;--cyanosis-table-trh-color:#e0edf7;--cyanosis-slct-title-color:#005bb7;--cyanosis-slct-titlebg-color:rgba(175,207,247,0.25);--cyanosis-slct-text-color:#c80000;--cyanosis-slct-bg-color:rgba(175,207,247,0.25);--cyanosis-slct-del-color:#999;--cyanosis-slct-elbg-color:#e8ebec;--cyanosis-slct-codebg-color:#ffeaeb;--cyanosis-slct-prebg-color:rgba(160,200,255,0.25)}.markdown-body.__dark{--cyanosis-base-color:#cacaca;--cyanosis-title-color:#ddd;--cyanosis-strong-color:#fe9900;--cyanosis-em-color:#ffd28e;--cyanosis-del-color:#ccc;--cyanosis-link-color:#ffb648;--cyanosis-linkh-color:#fe9900;--cyanosis-border-color:#ffe3ba;--cyanosis-border-color-2:#ffcb7b;--cyanosis-bg-color:#2f2f2f;--cyanosis-blockquote-color:#c7c7c7;--cyanosis-blockquote-bg-color:rgba(255,199,116,0.1);--cyanosis-code-color:#000;--cyanosis-code-bg-color:#ffcb7b;--cyanosis-code-pre-color:rgba(255,227,185,0.5);--cyanosis-table-border-color:#fe9900;--cyanosis-table-th-color:#ffb648;--cyanosis-table-tht-color:#000;--cyanosis-table-tr-nc-color:#6d5736;--cyanosis-table-trh-color:#947443;--cyanosis-slct-title-color:#000;--cyanosis-slct-titlebg-color:#fe9900;--cyanosis-slct-text-color:#00c888;--cyanosis-slct-bg-color:rgba(175,207,247,0.25);--cyanosis-slct-del-color:#999;--cyanosis-slct-elbg-color:#000;--cyanosis-slct-codebg-color:#ffcb7b;--cyanosis-slct-prebg-color:rgba(160,200,255,0.25)}.markdown-body h1{padding-bottom:4px;font-size:30px}.markdown-body h1,.markdown-body h2{margin-top:36px;margin-bottom:10px;line-height:1.5;color:var(--cyanosis-title-color);transition:color .35s}.markdown-body h2{position:relative;padding-left:10px;padding-right:10px;padding-bottom:10px;font-size:24px;border-bottom:1px solid var(--cyanosis-border-color-2)}.markdown-body h2:before{content:"「";position:absolute;top:-6px;left:-14px}.markdown-body h2:after{content:"」";position:relative;top:6px;right:auto}.markdown-body h3{position:relative;padding-bottom:0;margin-top:30px;margin-bottom:10px;font-size:20px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body h3:before{content:"»";padding-right:6px;color:var(--cyanosis-strong-color)}.markdown-body h4{margin-top:24px;font-size:16px}.markdown-body h4,.markdown-body h5{padding-bottom:0;margin-bottom:10px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body h5{margin-top:18px;font-size:14px}.markdown-body h6{padding-bottom:0;margin-top:12px;margin-bottom:10px;font-size:12px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body p{line-height:inherit;margin-top:16px;margin-bottom:16px}.markdown-body img{max-width:100%}.markdown-body hr{position:relative;width:98%;height:1px;margin-top:32px;margin-bottom:32px;background-image:linear-gradient(90deg,var(--cyanosis-link-color),rgba(255,0,0,.3),hsla(0,0%,100%,.1),rgba(255,0,0,.3),var(--cyanosis-link-color));border-width:0;overflow:visible}.markdown-body hr:after{content:"";position:absolute;margin:auto;left:0;right:0;bottom:0;top:0;display:inline-block;width:60px;height:20px;background-color:var(--cyanosis-bg-color);background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAgCAYAAABgrToAAAADoklEQVRYR82XTYgcRRTHf2933Q1RjAa9eFO8JHoJ8RQVBQ2iBwXBET0YEUTXNVmNQtTpmeqaWV0XNRq/o4KoECSCEPSg4CF+BYUkIIiCoCJCPIhC/Ihh2Z0nVV27VnZnenumW9i6ddV7//frV69fVQurfMgq56NawFTPAU6QyomqXrw6wIZeyhCPebA5buNR+akKyGoAjd6BshthnYdSjqNcRVuOlIUsD2j0SuA94IwuMHdh5ZUykOUBXfSGbmKI54EtAeYIHSZoy5dl4JxvNYBOKdW1KE8BQ8AkVk6WhasWsAiN0TX9gveXQaPP+Aytpc4u+bMI06JNohsYYYYOR2lJWtS3OKDRfcAtQfgDoI6Vo4UCGb0OmAEuDvZvYmVbEd/igC3dzDz7gQu8sPA9kJDK27mBmjqBeLjTg90PDFOjWawFFQd06kZHEfaj3LAIpTRpSXsZ5E06zEYP9sDimnAApYaV2SLZG/wjMeqAkijwW4xQJ5Gf/ZzRC8OW3hiBTGGlURRswW55Bh/Ssxljrwew8l1PQaM14GngvGDzBUKdDsMeTtgU5o8B92PFlUf3YXUrHa7Fys6lBqcCGnX15YQ2A18FyPd7Crd1A3M8C1wdbH4DD3hWeP6IEXbQkG97ajR1HPFnuPP5jFFq1OWX7hl8WM9l1AO648uNfwLk7tytMeogty+xeQ4rO3r6bdcx1nuwOGsHmaXGtPzae4uzGnLH1kQkvpdZGrHjssBZJrL+pqS05KWc8tgITAPXRzYvYOXe/C2OV43eDcRBDtIhoS2f9wzc0Cv8Wls+zoFzUC5zF0U241h5uZtPfptp6OUM8wbK+cH5GEpCS17P3fJei0Z3+npTxryJ8CPzbKMtn/ZyWbkPGl0PuFPkmkjkcb4h4R2ZLwRq1H0ALmvjkf2HwK1Y+T1PY2XABe/sHJ6MxN5lnoSpnC/UGbsTaI5phK2R7x6s3Ffk5YoDOrWm3onwJHBmEP86bPmBrsGaenNoIdnxCH+gPEhLXi0Cl1VBvyPVLSh7gEuC62yAfOIUqabWEaaiucMIk6RyqJ+Q/QM69V26jjW86Gvov/EaoyT8zRCn+Xq7PVrbx0nuYUaO9wM3WAbjCE1NEUw09Um4UV+2OKfYfu5/S19gsAzGKqm6LE5FrShbdS0ku465DjDwKA/oQht19ejqbaEVuRbiLhuHByYLjtUAZpDutzP7cYdHsPJXWbjyNVgFwQoa1WXwf4Jd9YD/Ap80+yE7+u9aAAAAAElFTkSuQmCC);background-repeat:no-repeat;background-size:auto 100%;background-position-x:center;transition:background-color .5s}.markdown-body code{padding:.065em .4em;font-size:.87em;color:var(--cyanosis-code-color);word-break:break-word;overflow-x:auto;background-color:var(--cyanosis-code-bg-color);border-radius:2px}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{display:block;padding:16px 12px;margin:0;font-size:12px;color:#333;word-break:normal;overflow-x:auto;background:var(--cyanosis-code-pre-color)}.markdown-body pre&gt;code::-webkit-scrollbar{width:4px;height:4px}.markdown-body pre&gt;code::-webkit-scrollbar-track{background-color:var(--cyanosis-border-color)}.markdown-body pre&gt;code::-webkit-scrollbar-thumb{background-color:var(--cyanosis-strong-color);border-radius:10px}.markdown-body a{position:relative;text-decoration:none;color:var(--cyanosis-link-color);border-bottom:1px solid var(--cyanosis-border-color)}.markdown-body a:hover{border-bottom-color:var(--cyanosis-linkh-color)}.markdown-body a:active,.markdown-body a:hover{color:var(--cyanosis-linkh-color)}.markdown-body a:after{position:absolute;content:"";top:100%;left:0;width:100%;opacity:0;border-bottom:1px solid var(--cyanosis-border-color);transition:top .3s,opacity .3s;transform:translateZ(0)}.markdown-body a:hover:after{top:0;opacity:1;border-bottom-color:var(--cyanosis-linkh-color)}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid var(--cyanosis-table-border-color);border-spacing:0;border-collapse:collapse}.markdown-body table thead{color:#000;text-align:left;font-size:14px;background:#f6f6f6}.markdown-body table tr:nth-child(2n){background-color:var(--cyanosis-table-tr-nc-color)}.markdown-body table tr:hover{background-color:var(--cyanosis-table-trh-color)}.markdown-body table td,.markdown-body table th{padding:12px 8px;line-height:24px;border:1px solid var(--cyanosis-table-border-color)}.markdown-body table th{color:var(--cyanosis-table-tht-color);background-color:var(--cyanosis-table-th-color)}.markdown-body table td{min-width:120px}.markdown-body blockquote{color:var(--cyanosis-blockquote-color);border-left:4px solid var(--cyanosis-strong-color);background-color:var(--cyanosis-blockquote-bg-color);padding:1px 20px;margin:22px 0;transition:color .35s}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body b,.markdown-body blockquote&gt;b,.markdown-body blockquote&gt;strong,.markdown-body strong{color:var(--cyanosis-strong-color)}.markdown-body em,.markdown-body i{color:var(--cyanosis-em-color)}.markdown-body del{color:var(--cyanosis-del-color)}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:4px}.markdown-body ol li{padding-left:6px}.markdown-body details&gt;summary{outline:none;color:var(--cyanosis-title-color);font-size:20px;font-weight:bolder;border-bottom:1px solid var(--cyanosis-border-color);cursor:pointer}.markdown-body details&gt;p{padding:10px 20px;margin:10px 0 0;color:#666;background-color:var(--cyanosis-blockquote-bg-color);border:2px dashed var(--cyanosis-strong-color)}.markdown-body h1::selection,.markdown-body h2::selection,.markdown-body h3::selection,.markdown-body h4::selection,.markdown-body h5::selection,.markdown-body h6::selection{color:var(--cyanosis-slct-title-color);background-color:var(--cyanosis-slct-titlebg-color)}.markdown-body ol li::selection,.markdown-body p::selection,.markdown-body ul li::selection{color:var(--cyanosis-slct-text-color);background-color:var(--cyanosis-slct-bg-color)}.markdown-body a::selection,.markdown-body b::selection,.markdown-body em::selection,.markdown-body i::selection,.markdown-body strong::selection{background-color:var(--cyanosis-slct-elbg-color)}.markdown-body del::selection{color:var(--cyanosis-slct-del-color);background-color:var(--cyanosis-slct-elbg-color)}.markdown-body table thead th::selection{background-color:transparent}.markdown-body table tbody td::selection{background-color:var(--cyanosis-slct-bg-color)}.markdown-body code::selection{background-color:var(--cyanosis-slct-codebg-color)}.markdown-body pre&gt;code::selection{background-color:var(--cyanosis-slct-prebg-color)}.markdown-body .contains-task-list{padding-left:14px;list-style:none}.markdown-body .contains-task-list input[type=checkbox]{position:relative}.markdown-body .contains-task-list input[type=checkbox]:before{content:"";position:absolute;top:0;left:0;right:0;bottom:0;width:inherit;height:inherit;background:#f0f8ff;border:1px solid #add6ff;border-radius:2px;box-sizing:border-box;z-index:1}.markdown-body .contains-task-list input[type=checkbox]:checked:after{content:"✓";position:absolute;top:-12px;left:0;right:0;bottom:0;width:0;height:0;color:#f55;font-size:20px;font-weight:700;z-index:2}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="atom-one-dark">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#abb2bf;background:#282c34}.hljs-comment,.hljs-quote{color:#5c6370;font-style:italic}.hljs-doctag,.hljs-formula,.hljs-keyword{color:#c678dd}.hljs-deletion,.hljs-name,.hljs-section,.hljs-selector-tag,.hljs-subst{color:#e06c75}.hljs-literal{color:#56b6c2}.hljs-addition,.hljs-attribute,.hljs-meta-string,.hljs-regexp,.hljs-string{color:#98c379}.hljs-built_in,.hljs-class .hljs-title{color:#e6c07b}.hljs-attr,.hljs-number,.hljs-selector-attr,.hljs-selector-class,.hljs-selector-pseudo,.hljs-template-variable,.hljs-type,.hljs-variable{color:#d19a66}.hljs-bullet,.hljs-link,.hljs-meta,.hljs-selector-id,.hljs-symbol,.hljs-title{color:#61aeee}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}.hljs-link{text-decoration:underline}</style><p>在计算机科学的宏大叙事中，Web 前端的发展速度令人咋舌。从最初简陋的文档展示，到如今能够承载复杂 3D 交互（如 Three.js）和即时通讯的富应用平台，前端技术栈经历了一次又一次的推倒重来。</p>
<p>这并非简单的工具更迭，而是开发模式与思维模型的根本性革命。通过对比同一功能的在不同时代的代码实现，我们可以清晰地看到这三次革命的轨迹。</p>
<h2 data-id="heading-0">第一次革命：混沌初开与后端主宰（MVC 时代）</h2>
<p>在 Web 发展的早期（约 1995-2005 年），并没有严格意义上的“前端工程师”。那是一个“后端套模板”的时代。</p>
<h3 data-id="heading-1">1.1 传统的 MVC 模式</h3>
<p>在这个阶段，浏览器仅被视为一个文档阅读器。所有的业务逻辑、数据处理甚至页面构建都发生在服务器端。</p>
<p>例如下面这段代码，这是典型的 Node.js 模拟早期后端渲染（SSR）的场景：</p>
<pre><code class="hljs language-JavaScript" lang="JavaScript"><span class="hljs-comment">// server.js - 典型的后端直出逻辑</span>
<span class="hljs-keyword">const</span> users = [...]; <span class="hljs-comment">// 数据库中的数据</span>

<span class="hljs-keyword">function</span> <span class="hljs-title function_">generateUserHTML</span>(<span class="hljs-params">users</span>) {
    <span class="hljs-comment">// 数据与 HTML 字符串强耦合</span>
    <span class="hljs-keyword">const</span> userRows = users.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">user</span> =&gt;</span> <span class="hljs-string">`
        &lt;tr&gt;
            &lt;td&gt;<span class="hljs-subst">${user.id}</span>&lt;/td&gt;
            &lt;td&gt;<span class="hljs-subst">${user.name}</span>&lt;/td&gt;
            &lt;td&gt;<span class="hljs-subst">${user.email}</span>&lt;/td&gt;
        &lt;/tr&gt;
    `</span>).<span class="hljs-title function_">join</span>(<span class="hljs-string">''</span>);

    <span class="hljs-keyword">return</span> <span class="hljs-string">`
    &lt;!DOCTYPE html&gt;
    ...
            &lt;tbody&gt;
                <span class="hljs-subst">${userRows}</span> &lt;/tbody&gt;
    ...
    `</span>;
}

<span class="hljs-keyword">const</span> server = http.<span class="hljs-title function_">createServer</span>(<span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> {
    <span class="hljs-comment">// 路由匹配，返回完整的 HTML 字符串</span>
    <span class="hljs-keyword">if</span> (parsedUrl.<span class="hljs-property">pathname</span> === <span class="hljs-string">'/users'</span>) {
        <span class="hljs-keyword">const</span> html = <span class="hljs-title function_">generateUserHTML</span>(users);
        res.<span class="hljs-title function_">end</span>(html);
    }
});
</code></pre>
<h3 data-id="heading-2">1.2 痛点与局限</h3>
<p>这种开发模式（如 PHP, JSP, ASP.NET）下，前端代码（HTML/CSS/JS）只是后端代码中的字符串。</p>
<ul>
<li><strong>强耦合</strong>：UI 逻辑与业务逻辑死死纠缠。改一个按钮的样式，可能需要重启后端服务。</li>
<li><strong>用户体验差</strong>：<code>req.url</code> 触发请求，<code>res.end</code> 返回页面。这意味着每一次极小的交互（比如翻页），都需要刷新整个页面，浏览器会出现瞬间白屏。</li>
<li><strong>分工混乱</strong>：后端开发人员被迫写 CSS，而前端人员（当时常被称为“切图仔”）无法独立调试。</li>
</ul>
<p>此时的核心关注点在于 <strong>Model（数据）</strong> -&gt; <strong>Controller（控制）</strong> -&gt; <strong>View（模板渲染）</strong> 的单向流。</p>
<h2 data-id="heading-3">第二次革命：觉醒与分离（AJAX 与 DOM 编程时代）</h2>
<p>2005 年左右，随着 AJAX 技术的普及（以 Gmail 和 Google Maps 为代表），Web 开始向“应用”转变。第二次革命的核心是 <strong>前后端分离</strong>。</p>
<h3 data-id="heading-4">2.1 浏览器成为应用平台</h3>
<p>在这个阶段，后端不再返回 HTML，而是返回纯粹的数据（JSON）。前端拥有了独立的项目结构，通过 JavaScript 主动拉取数据。</p>
<p>来看看如何实现：</p>
<pre><code class="hljs language-HTML" lang="HTML"><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">
    <span class="hljs-comment">// 1. 主动拉取数据</span>
    <span class="hljs-title function_">fetch</span>(<span class="hljs-string">'http://localhost:3000/users'</span>)
    .<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">res</span> =&gt;</span> res.<span class="hljs-title function_">json</span>())
    .<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">data</span> =&gt;</span> {
        <span class="hljs-comment">// 2. 获取 DOM 节点（非业务逻辑）</span>
        <span class="hljs-keyword">const</span> tbody = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelector</span>(<span class="hljs-string">'tbody'</span>);
        
        <span class="hljs-comment">// 3. 又是字符串拼接，但这次是在浏览器端</span>
        tbody.<span class="hljs-property">innerHTML</span> = data.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">user</span> =&gt;</span> <span class="hljs-string">`
        &lt;tr&gt;
            &lt;td&gt;<span class="hljs-subst">${user.id}</span>&lt;/td&gt;
            &lt;td&gt;<span class="hljs-subst">${user.name}</span>&lt;/td&gt;
            &lt;td&gt;<span class="hljs-subst">${user.email}</span>&lt;/td&gt;
        &lt;/tr&gt;
        `</span>).<span class="hljs-title function_">join</span>(<span class="hljs-string">''</span>);
    });
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
</code></pre>
<h3 data-id="heading-5">2.2 带来的改变与新的泥潭</h3>
<p>这一变革带来了巨大的优势：</p>
<ul>
<li><strong>解耦</strong>：后端专注于 API 接口（如 <code>:3000/users</code>）和高并发；前端专注于交互与体验。</li>
<li><strong>无刷新体验</strong>：页面的局部更新成为可能。</li>
</ul>
<p>然而，随着应用复杂度上升，前端陷入了 "DOM 操作的泥潭"。</p>
<p>在代码中，为了展示数据，我们必须先 querySelector 找到节点，然后操作 innerHTML。这带来了两个严重问题：</p>
<ol>
<li><strong>性能损耗</strong>：频繁的 DOM 操作是浏览器中最昂贵的开销。</li>
<li><strong>状态难以维护</strong>：当页面上有几十个地方需要根据同一个数据变化时，开发者需要手动去更新这几十个 DOM 节点。一旦漏掉一个，界面就会出现 Bug（数据与视图不一致）。</li>
</ol>
<p>这就好比你要指挥一个合唱团，在这一阶段，你需要走到每一个团员面前告诉他该唱什么，效率极低且容易出错。</p>
<h2 data-id="heading-6">第三次革命：现代化的声明式开发（数据驱动与组件化）</h2>
<p>2015 年前后，以 Vue、React 为代表的现代框架引发了第三次革命。这次革命的核心在于：<strong>数据驱动视图（Data-Driven）</strong> 与 <strong>声明式编程</strong>。</p>
<h3 data-id="heading-7">3.1 告别 DOM 操作</h3>
<p>开发者不再需要关心“怎么做”（How to update DOM），只需要关心“是什么”（What is the state）。</p>
<p>让我们看看 <code>app.vue</code> 是如何优雅地解决同一个问题的：</p>
<pre><code class="hljs language-JavaScript" lang="JavaScript">&lt;script setup&gt;
<span class="hljs-keyword">import</span> { ref, onMounted } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>;

<span class="hljs-comment">// 1. 定义响应式数据</span>
<span class="hljs-keyword">const</span> users = <span class="hljs-title function_">ref</span>([]);

<span class="hljs-title function_">onMounted</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-title function_">fetch</span>(<span class="hljs-string">'http://localhost:3000/users'</span>)
  .<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">res</span> =&gt;</span> res.<span class="hljs-title function_">json</span>())
  .<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">data</span> =&gt;</span> {
    <span class="hljs-comment">// 2. 仅仅修改数据，界面自动更新</span>
    users.<span class="hljs-property">value</span> = data;
  })
})

<span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
  users.<span class="hljs-property">value</span>.<span class="hljs-title function_">push</span>({
    <span class="hljs-attr">id</span>: <span class="hljs-number">4</span>,
    <span class="hljs-attr">name</span>: <span class="hljs-string">'赵六'</span>,
    <span class="hljs-attr">email</span>: <span class="hljs-string">'485@qq.com'</span>
  })
}, <span class="hljs-number">2000</span>)

&lt;/script&gt;

<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">tr</span> <span class="hljs-attr">v-for</span>=<span class="hljs-string">"user in users"</span> <span class="hljs-attr">:key</span>=<span class="hljs-string">"user.id"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>{{ user.id }}<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>{{ user.name }}<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>{{ user.email }}<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span></span>
</code></pre>
<h3 data-id="heading-8">3.2 核心理念解析</h3>
<p>这一阶段有几个关键特征：</p>
<ol>
<li>
<p>响应式数据（Reactivity）：</p>
<p><code>ref([])</code> 不仅仅是一个变量，它是一个被包装的代理对象。当<code> users.value</code> 发生变化时，Vue 的响应式系统会立刻感知，并通知视图进行更新。</p>
</li>
<li>
<p>声明式渲染（Declarative Rendering）：</p>
<p>我们不再手动写<code>document.createElement</code>或拼接字符串。我们使用<code>{{}}</code>和<code>v-for</code>这种模板语法，描述状态与 UI 的映射关系。</p>
<ul>
<li><em>后端套模板</em>：是字符串的替换，一次性的。</li>
<li><em>前端数据驱动</em>：是活的绑定，数据变，视图随之变。</li>
</ul>
</li>
<li>
<p>组件化与工程化：</p>
<p>早期的 JS 脚本散落在 HTML 中，维护灾难。而现在，通过 ESM（ECMAScript Modules）和构建工具（Vite/Webpack），我们将代码封装在 .vue 或 .jsx 文件中。JS 终于拥有了原生模块化能力（import/export），使得构建大型应用成为可能。</p>
</li>
</ol>
<h2 data-id="heading-9">结语：从“做页面”到“构建应用”</h2>
<p>回顾这三次革命：</p>
<ol>
<li><strong>后端 MVC 时代</strong>：解决了<strong>有无</strong>问题，实现了信息的发布。</li>
<li><strong>前后端分离时代</strong>：解决了<strong>分工</strong>问题，提升了用户体验，但带来了 DOM 维护成本。</li>
<li><strong>数据驱动时代</strong>：解决了<strong>效率与复杂度</strong>问题，让前端能承载复杂的业务逻辑（如 3D 编辑器、在线文档）。</li>
</ol>
<p>现在的开发者，不再是简单的“切图工”，而是软件工程师。我们利用 <code>ref</code> 管理状态，利用 Canvas/WebGL 渲染 3D 世界，利用工程化工具构建庞大的系统。</p>
<p>正如<code>app.vue</code>代码中演示的那样，一个 <code>setTimeout</code> 向数组<code>push</code>一条数据，表格自动增加一行。这看似简单的自动化背后，凝聚了前端社区二十年来对“关注点分离”的不懈追求——<strong>把繁琐留给框架，把创造力留给开发者</strong>。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[跨平台人脸识别 SDK 部署指南]]></title>    <link>https://juejin.cn/post/7582104240988373018</link>    <guid>https://juejin.cn/post/7582104240988373018</guid>    <pubDate>2025-12-11T05:35:02.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7582104240988373018" data-draft-id="7582104240988323866" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="跨平台人脸识别 SDK 部署指南"/> <meta itemprop="keywords" content="后端,代码规范,Linux"/> <meta itemprop="datePublished" content="2025-12-11T05:35:02.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="进击的丸子"/> <meta itemprop="url" content="https://juejin.cn/user/2506542243120680"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            跨平台人脸识别 SDK 部署指南
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2506542243120680/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    进击的丸子
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-11T05:35:02.000Z" title="Thu Dec 11 2025 05:35:02 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-11
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读8分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">跨平台人脸识别 SDK 部署指南</h2>
<p><strong>（Linux 本地环境 → 虚拟机 → Docker全流程清晰讲解）</strong></p>
<h2 data-id="heading-1">1. 部署背景与环境架构概述</h2>
<h3 data-id="heading-2">1.1 部署背景</h3>
<p>在开发跨平台人脸识别系统的过程中，一个常见的痛点是：</p>
<blockquote>
<p><strong>SDK 本地能跑，但移植到 Linux、Docker等环境就各种依赖缺失、GLIBC 不兼容。</strong></p>
</blockquote>
<p>笔者最近完成了<a href="https://link.juejin.cn?target=https%3A%2F%2Fai.arcsoft.com.cn%2F%3Futm_source%3Djuejin%26%26utm_medium%3Dchenying" target="_blank" title="https://ai.arcsoft.com.cn/?utm_source=juejin&amp;&amp;utm_medium=chenying" ref="nofollow noopener noreferrer">虹软人脸识别 SDK</a> 的 Spring Boot + Vue3 项目在 Linux 环境的部署。本文将带你从零开始梳理工程落地流程，帮助你在 <strong>Linux 实机/虚拟机 + Docker 容器</strong> 中顺利运行 Linux Pro SDK。</p>
<h3 data-id="heading-3">1.2 本地 / 虚拟机 / Docker 架构说明</h3>
<p>为了顺利部署项目，我们先明确几个关键概念：物理机、虚拟机、容器（Docker）分别是什么，其区别是什么。</p>
<h4 data-id="heading-4">1.2.1 本地物理机</h4>
<p>直接运行在计算机硬件上的系统，例如你的 Windows 或 Linux 主机。</p>
<p><strong>特点：</strong></p>

















<table><thead><tr><th>优点</th><th>缺点</th></tr></thead><tbody><tr><td>性能好、简单易用</td><td>环境不可复制、迁移困难</td></tr><tr><td>无虚拟层，速度最快</td><td>配置易污染、维护困难</td></tr></tbody></table>
<p>适合场景：</p>
<ul>
<li>本地开发</li>
<li>小规模测试</li>
</ul>
<h4 data-id="heading-5">1.2.2 虚拟机（VM）</h4>
<p>在 Windows 中通过 Hyper-V、VirtualBox、VMware 启动一个 <strong>完整的 Ubuntu 系统</strong>。</p>
<p><strong>特点：</strong></p>

















<table><thead><tr><th>优点</th><th>缺点</th></tr></thead><tbody><tr><td>隔离性完美</td><td>内存占用大、启动慢</td></tr><tr><td>能模拟真实生产环境</td><td>镜像大，不宜扩展</td></tr></tbody></table>
<p>适合：</p>
<ul>
<li>开发环境模拟生产环境</li>
<li>多系统测试（Windows 上跑 Linux）</li>
</ul>
<hr/>
<h4 data-id="heading-6">1.2.3 Docker 容器</h4>
<p>共享宿主机内核，无需每个实例都安装完整系统。</p>
<p><strong>容器 vs 虚拟机对比：</strong></p>

























<table><thead><tr><th>对比项</th><th>虚拟机</th><th>Docker</th></tr></thead><tbody><tr><td>启动速度</td><td>分钟级</td><td>秒级</td></tr><tr><td>占用资源</td><td>多（独立系统）</td><td>少（共享内核）</td></tr><tr><td>部署环境</td><td>难以复制</td><td>一致可复现</td></tr></tbody></table>
<p>适合：</p>
<ul>
<li>生产环境</li>
<li>微服务架构</li>
<li>DevOps、CI/CD 自动化</li>
</ul>
<p><strong>举例：</strong> 你可以把一个 Java Spring Boot 应用打包成一个 Docker 镜像，交给任何机器运行，不需要安装 JDK 或配置环境变量。</p>
<hr/>
<h2 data-id="heading-7">2. 环境依赖与版本检查</h2>
<p>本文涉及的三层环境（Host → VM → Docker）：</p>
<pre><code class="hljs">Windows 主机
 └── Ubuntu 虚拟机（VirtualBox）
      └── Docker 容器（运行 SDK Demo）
</code></pre>
<p>具体版本如下：</p>

























<table><thead><tr><th>环境</th><th>推荐版本</th></tr></thead><tbody><tr><td>Host OS</td><td>Windows 11</td></tr><tr><td>VM OS</td><td>Ubuntu 18.04</td></tr><tr><td>Docker Base</td><td>Ubuntu:18.04</td></tr><tr><td>SDK</td><td>ArcSoft_ArcFacePro_linuxPro</td></tr></tbody></table>
<h4 data-id="heading-8">Linux 环境必要依赖检查</h4>
<p>SDK 大多依赖特定版本的：</p>
<ul>
<li><strong>GLIBC</strong></li>
<li><strong>GLIBCXX（libstdc++）</strong></li>
<li><strong>GCC</strong></li>
</ul>
<p>推荐优先检查：</p>
<h5 data-id="heading-9">2.1 查看 GLIBC 版本</h5>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment">#  最低支持2.17</span>
strings /usr/lib/x86_64-linux-gnu/libstdc++.so.* | grep GLIBC_
</code></pre>
<p>输出结果示例：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5937468a172745fbac6d7378ab55de23~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-b5Ye755qE5Li45a2Q:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766036102&amp;x-signature=vE5KdXAYEvZBJrZHq4RPTciNQn4%3D" alt="image.png" loading="lazy"/></p>
<hr/>
<h5 data-id="heading-10">2.2 查看 GLIBCXX 版本</h5>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 最低支持3.4.21版本</span>
strings /usr/lib/x86_64-linux-gnu/libstdc++.so.* | grep GLIBCXX
</code></pre>
<p>输出结果示例：
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6498ed4a8d13409fb717d0df7b5dcc09~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-b5Ye755qE5Li45a2Q:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766036102&amp;x-signature=al0SvCy1B7fBQUKOsdqNAtGdjws%3D" alt="image.png" loading="lazy"/></p>
<h5 data-id="heading-11">2.3 查看编译器 GCC 版本</h5>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 最低支持4.8.2</span>
gcc --version
</code></pre>
<p>输出结果示例：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a916f7107d4e40f8bf390a64c0d28975~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-b5Ye755qE5Li45a2Q:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766036102&amp;x-signature=l4suSGmotbyLJcpAZwjXmpb%2FTQI%3D" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-12">3. SDK 部署流程</h2>
<p>在日常开发中，我们通常在 Windows 环境中进行项目调试与测试，而最终的生产部署多运行在 Linux 服务器上。 以虹软人脸识别 SDK 为例，其官方 Demo 是基于 <strong>Spring Boot + Vue3</strong> 实现的完整后端与前端系统。为了将该系统迁移至 Linux 服务器运行，我们需要完成以下任务：</p>
<ol start="0">
<li>在 Linux 系统（或 WSL Ubuntu 子系统）中搭建运行环境。</li>
<li>将项目打包成可执行 JAR 文件。</li>
<li>在服务器上运行并验证。</li>
<li>使用 Docker 容器化运行，方便部署与迁移。</li>
</ol>
<h3 data-id="heading-13">3.1 在 Linux 部署 JAR 服务（本地物理机部署 jar 包）</h3>
<ol start="0">
<li>由于虹软官方源码是java环境，所以我们运行该demo需要先配置java环境，可以先检查一下自己的系统里是否有安装（jdk推荐安装1.8版本）：</li>
</ol>

<pre><code class="hljs">java -version
</code></pre>
<p>输出示例：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1d804d4a58f44bdebd11e385c0daa143~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-b5Ye755qE5Li45a2Q:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766036102&amp;x-signature=aznHCzH6CVwsvyZzgHVgTtzLw0s%3D" alt="image.png" loading="lazy"/></p>
<ol start="2">
<li>可以看到linux环境（Ubuntu 18）里是没有安装Java的，这里我们根据提示安装，default-jre在Ubuntu 18系统里默认是11版本：</li>
</ol>

<pre><code class="hljs">sudo apt install openjdk-11-jre-headless
</code></pre>
<p>输出示例：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/be11734db1dc40f29d3a796aad9cf29f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-b5Ye755qE5Li45a2Q:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766036102&amp;x-signature=%2B5NfoQQXj1%2FF5NZdqAj23wdGP9o%3D" alt="image.png" loading="lazy"/></p>
<ol start="3">
<li>安装完成后可以再次查看java -version：</li>
</ol>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ed56954e240a45c98f3594c66dc69212~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-b5Ye755qE5Li45a2Q:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766036102&amp;x-signature=lKplpGgQUugyac6jtxlruYvb%2F8I%3D" alt="image.png" loading="lazy"/></p>

<ol start="4">
<li>出现11.0.19的字样就说明安装成功了，接下来我们可以在本地跑一下虹软的demo了，首先从官网下载server源码demo：</li>
</ol>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3e245bb9612d4ecb9ebcf24499e2fbca~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-b5Ye755qE5Li45a2Q:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766036102&amp;x-signature=u%2BUPJ5j9mtUBdHwwLb3Or6%2FDy3k%3D" alt="image.png" loading="lazy"/></p>

<ol start="5">
<li>下载后使用idea运行该项目，并修改<code>appid</code> 、<code>sdk-key</code>、 <code>active-key</code> ，用maven编译该demo的jar包：</li>
</ol>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6af47fd007034a398e28706841b96ead~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-b5Ye755qE5Li45a2Q:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766036102&amp;x-signature=2L2j3KYQtlSqPv%2BAujWAzA%2BKN5A%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9d195a654bcc4a0b830c731652a276ae~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-b5Ye755qE5Li45a2Q:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766036102&amp;x-signature=sdT4%2F23UEGn77FicP6%2Fr8vzwKs8%3D" alt="image.png" loading="lazy"/></p>

<ol start="6">
<li>为了方便运行，给这个jar包改名为face-demo.jar，并放到项目根目录下：</li>
</ol>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5cf94052d1994de49a16b4d21264f24d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-b5Ye755qE5Li45a2Q:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766036102&amp;x-signature=Bi1Y1W%2B%2FnW%2BGqaR3GhVrFEpJntA%3D" alt="image.png" loading="lazy"/></p>

<ol start="7">
<li>然后执行命令：</li>
</ol>

<pre><code class="hljs">java -jar face-demo.jar
</code></pre>
<p>输出示例：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/63563e1353ce4c249cdcda36cda6fa2a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-b5Ye755qE5Li45a2Q:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766036102&amp;x-signature=m%2FIc%2B1bDOlws0oJjrP%2BXOUrGaOo%3D" alt="image.png" loading="lazy"/></p>
<ol start="8">
<li>等待程序运行，运行成功会出现以下界面，点击访问默认访问地址则可以访问该网站：</li>
</ol>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0a53a552843446dfb4999620d6b9aca5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-b5Ye755qE5Li45a2Q:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766036102&amp;x-signature=bStMQ7gIG2XZz9LLDrUwBX6MRLE%3D" alt="image.png" loading="lazy"/></p>

<ol start="9">
<li>log中没有出现错误则表示运行成功，访问则可以看到下面的网页：</li>
</ol>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bd3a7c844cbf4006bd05aa0dc461d470~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-b5Ye755qE5Li45a2Q:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766036102&amp;x-signature=sMBz6zyRg8lnWFfM7aouAFT%2FihA%3D" alt="image.png" loading="lazy"/>
<strong>注意事项：</strong></p>
<p>如若访问失败，可以看下命令行log中有没有激活失败的问题，如果激活失败则更重复一下上述修改 <code>appid</code> 、<code>sdk-key</code>、</p>
<p><code>active-key</code> 的步骤，下图 <code>active-key</code> 被使用后则激活失败：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0ab2b2669a8841ea84aabbc78ad23014~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-b5Ye755qE5Li45a2Q:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766036102&amp;x-signature=4eMo339m4iMg8O3RW6ByivDRpyE%3D" alt="image-20251125170615420" loading="lazy"/></p>
<h3 data-id="heading-14">3.2 使用 Docker 部署 SDK（使用 Docker 容器部署 jar 包）</h3>
<h4 data-id="heading-15">3.2.1 准备 Docker 容器（安装 Docker）</h4>
<ol start="0">
<li>安装Docker，执行以下命令:</li>
</ol>

<pre><code class="hljs language-sql" lang="sql">sudo apt<span class="hljs-operator">-</span><span class="hljs-keyword">get</span> <span class="hljs-keyword">update</span>
sudo apt<span class="hljs-operator">-</span><span class="hljs-keyword">get</span> installapt<span class="hljs-operator">-</span>transport<span class="hljs-operator">-</span>httpsca<span class="hljs-operator">-</span>certificates
curl \
software<span class="hljs-operator">-</span>properties<span class="hljs-operator">-</span>commonlsb<span class="hljs-operator">-</span><span class="hljs-keyword">release</span>
gnupg2
</code></pre>
<p>2.  卸载旧版本（如果有）</p>

<pre><code class="hljs language-arduino" lang="arduino">sudo apt-get remove docker docker-engine docker.io containerd runc
</code></pre>
<p>3.  更新 apt</p>

<pre><code class="hljs language-sql" lang="sql">sudo apt <span class="hljs-keyword">update</span>
</code></pre>
<p>4.  安装依赖</p>

<pre><code class="hljs language-arduino" lang="arduino">sudo apt install ca-certificates curl gnupg lsb-release -y
</code></pre>
<p>5.  添加 Docker 官方 GPG Key</p>

<pre><code class="hljs language-arduino" lang="arduino">curl -fsSL https:<span class="hljs-comment">//download.docker.com/linux/ubuntu/gpg | sudo apt-key add -</span>
</code></pre>
<p>6.  添加 Docker 官方仓库</p>

<pre><code class="hljs language-bash" lang="bash">sudo add-apt-repository \
   <span class="hljs-string">"deb [arch=amd64] https://download.docker.com/linux/ubuntu \
   <span class="hljs-subst">$(lsb_release -cs)</span> \
   stable"</span>
</code></pre>
<p>7.  安装 Docker</p>

<pre><code class="hljs language-lua" lang="lua">sudo apt update
sudo apt install docker-ce docker-ce-cli containerd.<span class="hljs-built_in">io</span> -y
</code></pre>
<p>8.  验证</p>

<pre><code class="hljs language-arduino" lang="arduino">docker --version
sudo docker run hello-world
</code></pre>
<p>9.  安装成功示例如下：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/75ded122825f4bd3bdf699a052c68a8b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-b5Ye755qE5Li45a2Q:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766036102&amp;x-signature=AhcuhAkSOTUVJuZKVgUIRWjmkPo%3D" alt="image.png" loading="lazy"/></p>
<h4 data-id="heading-16">3.2.2 准备 JAR 包</h4>
<p>使用虹软官方demo构建jar包（face-demo-docker.jar），可以参考3.1中下载步骤，这里不再赘述</p>
<h4 data-id="heading-17">3.2.3 准备一个基础 Dockerfile</h4>
<p>我们需要了解一下什么是 Dockerfile，Dockerfile 就是一份 <strong>构建 Docker 镜像的“配方”</strong> 。只要写好 Dockerfile，执行 <code>docker build</code>，Docker 就能自动：</p>
<ul>
<li>拉镜像</li>
<li>复制文件</li>
<li>安装依赖</li>
<li>启动你的 SpringBoot Jar</li>
<li>打包成一个可运行的镜像</li>
</ul>
<p>接下来我们在项目根目录创建一个 <code>Dockerfile</code>：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 基于 JDK 11 镜像</span>
FROM eclipse-temurin:11-jdk-jammy
​
<span class="hljs-comment"># 工作目录</span>
WORKDIR /app
​
<span class="hljs-comment">#复制jar文件</span>
COPY face-demo-docker.jar /app/app.jar
​
<span class="hljs-comment"># 声明容器在运行时会监听的端口号，这里的端口号只是一个声明，不会真正打开端口，也不会影响容器运行</span>
<span class="hljs-comment"># 真正决定外部访问端口的是：docker run -p 宿主机端口:容器端口</span>
EXPOSE 8089
​
<span class="hljs-comment"># 容器启动命令</span>
ENTRYPOINT [<span class="hljs-string">"java"</span>, <span class="hljs-string">"-jar"</span>, <span class="hljs-string">"/app/app.jar"</span>]
</code></pre>
<h4 data-id="heading-18">3.2.4 构建镜像</h4>
<p>构建镜像：</p>
<pre><code class="hljs language-arduino" lang="arduino">docker build -t face-demo-image:v1 .
</code></pre>
<p><code>docker build</code>：构建镜像的命令。</p>
<p><code>-t face-demo-image:latest</code>：给生成的镜像打上一个标签（tag）。</p>
<ul>
<li><code>face-demo</code>-image 是镜像名称；</li>
<li><code>latest</code> 是标签（一般表示最新版，可自定义，比如 <code>v1</code>）。</li>
</ul>
<p><code>.</code>：表示构建上下文（context）为当前目录，也就是说它会在当前目录查找 <code>Dockerfile</code> 文件并打包所有内容。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/42267027d2824ea88c53f170f8f1a808~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-b5Ye755qE5Li45a2Q:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766036102&amp;x-signature=%2BFk2zLvoXZnFkwZPeIrlL1jvKX8%3D" alt="image.png" loading="lazy"/></p>
<p><strong>注意事项：</strong></p>
<p>docker相同镜像名 + 相同 tag（完全重复）→ 会被覆盖，none就是被覆盖的那个，建议build镜像前先检查一下已有的镜像</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/06b2abe2752043af84a7a580c647528a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-b5Ye755qE5Li45a2Q:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766036102&amp;x-signature=wvw66sV7kecjcva9CwtLoIWHXi8%3D" alt="image.png" loading="lazy"/>
相同镜像名+不同tag，则可以共存</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/eda3a6a46edb457db7d6952555df1044~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-b5Ye755qE5Li45a2Q:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766036102&amp;x-signature=7i5FdpV%2Fa2xT8ZKC4R8IrEOA0S0%3D" alt="image.png" loading="lazy"/>
删除相同镜像名+不同tag则要删除对应tag</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cbfa5c6cbff449a6b9dcf72c17052c5a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-b5Ye755qE5Li45a2Q:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766036102&amp;x-signature=2mJRtjpl%2BhqdUOFIX2Pov%2BinFIo%3D" alt="image.png" loading="lazy"/></p>
<h4 data-id="heading-19">3.2.5 运行容器</h4>
<pre><code class="hljs language-arduino" lang="arduino">docker run -it -p <span class="hljs-number">9000</span>:<span class="hljs-number">8089</span> --name arcface-container face-demo-image:v1
</code></pre>





























<table><thead><tr><th>参数</th><th>作用</th></tr></thead><tbody><tr><td><code>docker run</code></td><td>创建并运行一个新容器</td></tr><tr><td><code>-it</code></td><td>进入交互式终端（前台），后台运行使用-d</td></tr><tr><td><code>-p 9000:8089</code></td><td><strong>端口映射</strong>：将宿主机的 <code>9000</code> 端口映射到容器的 <code>8089</code> 端口(<strong>8089</strong>是jar包里面定义的端口号）</td></tr><tr><td><code>--name arcface-container</code></td><td>给容器取名为 <code>arcface</code>，方便后续管理</td></tr><tr><td><code>face-demo-image:v1</code></td><td>指定要运行的镜像名称和版本标签（你之前 build 的镜像）</td></tr></tbody></table>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e181168d0fb1476dbf434b3a08cd7700~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-b5Ye755qE5Li45a2Q:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766036102&amp;x-signature=dxKC1z%2FEH6rEZWg9M31P29CIifk%3D" alt="image.png" loading="lazy"/>
查看运行状态：</p>
<pre><code class="hljs">docker ps
</code></pre>
<p>输出示例</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0f8258fe974c43c58a7b4d26edad7c6e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-b5Ye755qE5Li45a2Q:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766036102&amp;x-signature=LCVljbM%2FYxXsyRyLTPciHlg1mgg%3D" alt="image.png" loading="lazy"/>
若容器状态为 <code>Up</code>，说明服务启动成功。 此时可以访问：</p>
<pre><code class="hljs language-xml" lang="xml">http://<span class="hljs-tag">&lt;<span class="hljs-name">你的服务器IP</span>&gt;</span>:<span class="hljs-tag">&lt;<span class="hljs-name">你的端口号</span>&gt;</span>
</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4c5530f66418428c89bce61b178a73fd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-b5Ye755qE5Li45a2Q:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766036102&amp;x-signature=T5cRdiVMVT9vlTm7bK6e0C%2Be9Kw%3D" alt="image.png" loading="lazy"/>
<strong>注意事项：</strong></p>
<ol start="0">
<li>容器名不能重复</li>
</ol>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bd77c4458d56429a9f30deb6cb539df8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-b5Ye755qE5Li45a2Q:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766036102&amp;x-signature=rPz%2B%2F6vch9H5o59y5LxX%2FP0NAKg%3D" alt="image.png" loading="lazy"/></p>

<ol start="2">
<li><strong>一个激活码只能用一个容器</strong>，容器重启后会导致原激活码失效</li>
</ol>
<h2 data-id="heading-20">4. 常见问题（FAQ）</h2>






























<table><thead><tr><th>问题</th><th>可能原因</th><th>解决方法</th></tr></thead><tbody><tr><td>访问不到服务</td><td>防火墙或端口未开放</td><td><code>sudo ufw allow &lt;你的端口&gt;</code> 开放端口</td></tr><tr><td>Docker 构建慢</td><td>网络镜像源未替换</td><td>可换为阿里云或中科大镜像源</td></tr><tr><td>Jar 启动失败</td><td>JDK 版本不匹配</td><td>使用 <code>java -version</code> 确认 JDK 与项目一致</td></tr><tr><td>项目路径权限问题</td><td>未赋执行权限</td><td>使用 <code>chmod +x face-demo.jar</code></td></tr></tbody></table>
<h2 data-id="heading-21">5. 总结</h2>
<p>本文围绕<a href="https://link.juejin.cn?target=https%3A%2F%2Fai.arcsoft.com.cn%2F%3Futm_source%3Djuejin%26%26utm_medium%3Dchenying" target="_blank" title="https://ai.arcsoft.com.cn/?utm_source=juejin&amp;&amp;utm_medium=chenying" ref="nofollow noopener noreferrer">虹软人脸识别 SDK</a>的跨平台部署，从 <strong>Windows 本地环境、Ubuntu 虚拟机到 Docker 容器化运行</strong>，完整梳理了实际项目在不同环境下的落地流程。通过逐步验证系统依赖、检查 glibc 与 libstdc++版本、配置 Java 运行环境、构建 Spring Boot Jar 包，再到最后使用 Docker 打包镜像并运行服务，整个过程展示了一个跨平台项目从开发环境过渡到生产环境的完整路径。希望能够帮助你在后续的工程中更加顺利地进行部署与上线。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[开源一个 Nuxt 4 导航站模板，功能完整，拿来即用！]]></title>    <link>https://juejin.cn/post/7582110969201197094</link>    <guid>https://juejin.cn/post/7582110969201197094</guid>    <pubDate>2025-12-11T05:06:37.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7582110969201197094" data-draft-id="7582118218649157658" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="开源一个 Nuxt 4 导航站模板，功能完整，拿来即用！"/> <meta itemprop="keywords" content="前端,开源"/> <meta itemprop="datePublished" content="2025-12-11T05:06:37.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Pub的知识花园"/> <meta itemprop="url" content="https://juejin.cn/user/1591748567524232"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            开源一个 Nuxt 4 导航站模板，功能完整，拿来即用！
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1591748567524232/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Pub的知识花园
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-11T05:06:37.000Z" title="Thu Dec 11 2025 05:06:37 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-11
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    8
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#595959;font-size:15px;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(60,10,30,.04) 3%,transparent 0),linear-gradient(1turn,rgba(60,10,30,.04) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body p{color:#595959;font-size:15px;line-height:2;font-weight:400}.markdown-body p+p{margin-top:16px}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin:0;color:#135ce0}.markdown-body h1{position:relative;text-align:center;font-size:22px;margin:50px 0}.markdown-body h1:before{position:absolute;content:"";top:-10px;left:50%;width:32px;height:32px;transform:translateX(-50%);background-size:100% 100%;opacity:.36;background-repeat:no-repeat;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAABfVBMVEX///8Ad/8AgP8AgP8AgP8Aff8AgP8Af/8AgP8AVf8Af/8Af/8AgP8AgP8Af/8Afv8AAP8Afv8Afv8Aef8AgP8AdP8Afv8AgP8AgP8Acf8Ae/8AgP8Af/8AgP8Af/8Af/8AfP8Afv8AgP8Af/8Af/8Afv8Afv8AgP8Afv8AgP8Af/8Af/8AgP8AgP8Afv8AgP8Af/8AgP8AgP8AgP8Ae/8Afv8Af/8AgP8Af/8AgP8Af/8Af/8Aff8Af/8Abf8AgP8Af/8AgP8Af/8Af/8Afv8AgP8AgP8Afv8Afv8AgP8Af/8Aff8AgP8Afv8AgP8Aff8AgP8AfP8AgP8Ae/8AgP8Af/8AgP8AgP8AgP8Afv8AgP8AgP8AgP8Afv8AgP8AgP8AgP8AgP8AgP8Af/8AgP8Af/8Af/8Aev8Af/8AgP8Aff8Afv8AgP8AgP8AgP8Af/8AgP8Af/8Af/8AgP8Afv8AgP8AgP8AgP8AgP8Af/8AeP8Af/8Af/8Af//////rzEHnAAAAfXRSTlMAD7CCAivatxIDx5EMrP19AXdLEwgLR+6iCR/M0yLRzyFF7JupSXn8cw6v60Q0QeqzKtgeG237HMne850/6Qeq7QaZ+WdydHtj+OM3qENCMRYl1B3K2U7wnlWE/mhlirjkODa9FN/BF7/iNV/2kASNZpX1Wlf03C4stRGxgUPclqoAAAABYktHRACIBR1IAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH4gEaBzgZ4yeM3AAAAT9JREFUOMvNUldbwkAQvCAqsSBoABE7asSOBRUVVBQNNuy9996789+9cMFAMHnVebmdm+/bmdtbQv4dOFOW2UjPzgFyLfo6nweKfIMOBYWwFtmMPGz2Yj2pJI0JDq3udJW6VVbmKa9I192VQFV1ktXUAl5NB0cd4KpnORqsEO2ZIRpF9gJfE9Dckqq0KuZt7UAH5+8EPF3spjsRpCeQNO/tA/qDwIDA+OCQbBoKA8NOdjMySgcZGVM6jwcgRuUiSs0nlPFNSrEpJfU0jTLD6llqbvKxei7OzvkFNQohi0vAsj81+MoqsCaoPOQFgus/1LyxichW+hS2JWCHZ7VlF9jb187pIAYcHiViHAMnp5mTjJ8B5xeEXF4B1ze/fTh/C0h398DDI9HB07O8ci+vRBdvdGnfP4gBuM8vw7X/G3wDmFhFZEdxzjMAAAAldEVYdGRhdGU6Y3JlYXRlADIwMTgtMDEtMjZUMDc6NTY6MjUrMDE6MDA67pVWAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDE4LTAxLTI2VDA3OjU2OjI1KzAxOjAwS7Mt6gAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAAWdEVYdFRpdGxlAGp1ZWppbl9sb2dvIGNvcHlxapmKAAAAV3pUWHRSYXcgcHJvZmlsZSB0eXBlIGlwdGMAAHic4/IMCHFWKCjKT8vMSeVSAAMjCy5jCxMjE0uTFAMTIESANMNkAyOzVCDL2NTIxMzEHMQHy4BIoEouAOoXEXTyQjWVAAAAAElFTkSuQmCC)}.markdown-body h2{position:relative;font-size:20px;border-left:4px solid;padding:0 0 0 10px;margin:30px 0}.markdown-body h3{font-size:16px}.markdown-body ul{list-style:disc outside;margin-left:2em;margin-top:1em}.markdown-body li{line-height:2;color:#595959}.markdown-body img.loaded{margin:0 auto;display:block}.markdown-body blockquote{background:#fff9f9;margin:2em 0;padding:2px 20px;border-left:4px solid #b2aec5}.markdown-body blockquote p{color:#666;line-height:2}.markdown-body a{color:#036aca;border-bottom:1px solid rgba(3,106,202,.8);font-weight:400;text-decoration:none}.markdown-body em strong,.markdown-body strong{color:#036aca}.markdown-body hr{border-top:1px solid #135ce0}.markdown-body pre{overflow:auto}.markdown-body code,.markdown-body pre{overflow:auto;position:relative;line-height:1.75;font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body table{border-collapse:collapse;margin:1rem 0;overflow-x:auto}.markdown-body table td,.markdown-body table th{border:1px solid #dfe2e5;padding:.6em 1em}.markdown-body table tr{border-top:1px solid #dfe2e5}.markdown-body table tr:nth-child(2n){background-color:#f6f8fa}</style><style data-highlight="" data-highlight-key="atom-one-dark">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#abb2bf;background:#282c34}.hljs-comment,.hljs-quote{color:#5c6370;font-style:italic}.hljs-doctag,.hljs-formula,.hljs-keyword{color:#c678dd}.hljs-deletion,.hljs-name,.hljs-section,.hljs-selector-tag,.hljs-subst{color:#e06c75}.hljs-literal{color:#56b6c2}.hljs-addition,.hljs-attribute,.hljs-meta-string,.hljs-regexp,.hljs-string{color:#98c379}.hljs-built_in,.hljs-class .hljs-title{color:#e6c07b}.hljs-attr,.hljs-number,.hljs-selector-attr,.hljs-selector-class,.hljs-selector-pseudo,.hljs-template-variable,.hljs-type,.hljs-variable{color:#d19a66}.hljs-bullet,.hljs-link,.hljs-meta,.hljs-selector-id,.hljs-symbol,.hljs-title{color:#61aeee}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}.hljs-link{text-decoration:underline}</style><h2 data-id="heading-0">开源一个 Nuxt 4 目录网站模板，功能完整，拿来即用！</h2>
<h3 data-id="heading-1">🎯 前言</h3>
<p>大家好，我是 Pub。</p>
<p>最近开源了一个项目 <strong>Nuxt Mkdirs</strong> —— 一个基于 <strong>Nuxt 4</strong> 构建的目录网站模板。</p>
<blockquote>
<p>🔗 GitHub: <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FPBHAHAHA%2FNuxt_Mkdirs" target="_blank" title="https://github.com/PBHAHAHA/Nuxt_Mkdirs" ref="nofollow noopener noreferrer">github.com/PBHAHAHA/Nu…</a></p>
<p>🌐 介绍页地址: <a href="https://link.juejin.cn?target=https%3A%2F%2Fnuxt-mkdirs.com" target="_blank" title="https://nuxt-mkdirs.com" ref="nofollow noopener noreferrer">nuxt-mkdirs.com</a></p>
</blockquote>
<p>这个项目之前是作为付费模板在卖，但效果不太理想，索性开源出来，希望能帮到有需要的同学。</p>
<p><strong>先放几张效果图：</strong></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/57eaa1e0b13b4eee8708137705896e43~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUHVi55qE55-l6K-G6Iqx5Zut:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766036256&amp;x-signature=6KzbdQkOfPqd25SdkVC7DpnM7YA%3D" alt="微信图片_20251211124406_30_54.png" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b6dfcebef8e0413493259063b7bc4c9f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUHVi55qE55-l6K-G6Iqx5Zut:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766036256&amp;x-signature=XYBBnhYht5pv%2B8RxulJpmwT1ET0%3D" alt="微信图片_20251211124432_31_54.png" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/deef3294275b41e5b8637b976ec5b187~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUHVi55qE55-l6K-G6Iqx5Zut:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766036256&amp;x-signature=OY0CDNCwcdGgYtDWDbc7unaSdBo%3D" alt="微信图片_20251211124443_32_54.png" loading="lazy"/></p>
<h3 data-id="heading-2">🤔 为什么做这个？</h3>
<p>目录网站（Directory Website）是一种很常见的网站类型：</p>
<ul>
<li>🤖 AI 工具导航站</li>
<li>💻 独立开发者产品目录</li>
<li>📦 SaaS 产品收录站</li>
<li>🎨 设计资源导航</li>
</ul>
<p>市面上的目录模板大多是 Next.js，<strong>Vue Nuxt 生态相对较少</strong>。</p>
<p>作为一个 Vue/Nuxt 开发者，我决定自己撸一个，顺便把常用的功能都集成进去。</p>
<h3 data-id="heading-3">🛠️ 技术栈</h3>





































<table><thead><tr><th>类别</th><th>技术</th></tr></thead><tbody><tr><td>框架</td><td><strong>Nuxt 4</strong> + Vue 3</td></tr><tr><td>样式</td><td><strong>TailwindCSS 4</strong> + Radix Vue</td></tr><tr><td>CMS</td><td><strong>Sanity</strong>（无头 CMS）</td></tr><tr><td>认证</td><td>Auth.js（Google/GitHub OAuth）</td></tr><tr><td>支付</td><td>Stripe + Creem</td></tr><tr><td>邮件</td><td>Resend</td></tr><tr><td>部署</td><td>NuxtHub（Cloudflare）</td></tr></tbody></table>
<h4 data-id="heading-4">为什么用 Sanity 而不是数据库？</h4>
<p>可能有同学会问：为什么不用 MySQL/PostgreSQL？</p>
<p><strong>Sanity 作为无头 CMS 的优势：</strong></p>
<ol>
<li>✅ <strong>零数据库配置</strong> - 不需要自己搭建和维护数据库</li>
<li>✅ <strong>可视化后台</strong> - Sanity Studio 开箱即用</li>
<li>✅ <strong>免费额度充足</strong> - 小型项目完全够用</li>
<li>✅ <strong>自带图片 CDN</strong> - 不用操心图片存储</li>
</ol>
<h3 data-id="heading-5">✨ 核心功能</h3>
<h4 data-id="heading-6">1️⃣ 三种首页布局</h4>
<p>提供了 3 种不同风格的首页，开箱即用：</p>
<pre><code class="hljs language-bash" lang="bash">/          <span class="hljs-comment"># 默认首页</span>
/home2     <span class="hljs-comment"># 布局二</span>
/home3     <span class="hljs-comment"># 布局三</span>
</code></pre>
<h4 data-id="heading-7">2️⃣ 完整的目录系统</h4>
<ul>
<li><strong>分类 (Category)</strong> - 支持分组展示</li>
<li><strong>标签 (Tag)</strong> - 多标签筛选</li>
<li><strong>集合 (Collection)</strong> - 自定义产品集合</li>
<li><strong>搜索</strong> - 全文搜索</li>
</ul>
<h4 data-id="heading-8">3️⃣ 用户系统</h4>
<ul>
<li>Google / GitHub OAuth 一键登录</li>
<li>用户 Dashboard</li>
<li>个人设置</li>
</ul>
<h4 data-id="heading-9">4️⃣ 内容提交 &amp; 审核流程</h4>
<pre><code class="hljs">用户提交 → 待审核 → 管理员审核 → 发布/拒绝
</code></pre>
<p>用户可以提交产品，管理员在 Sanity Studio 后台审核。</p>
<h4 data-id="heading-10">5️⃣ 双支付系统</h4>
<ul>
<li><strong>Stripe</strong> - 国际支付</li>
<li><strong>Creem</strong> - 🇨🇳 国内友好，支持大陆身份证注册</li>
</ul>
<blockquote>
<p>💡 对于国内开发者，强烈推荐 Creem，注册简单，不需要公司资质。</p>
</blockquote>
<h4 data-id="heading-11">6️⃣ 博客系统</h4>
<p>内置博客功能，支持 Markdown，可以用来做 SEO 引流。</p>
<h4 data-id="heading-12">7️⃣ Newsletter 订阅</h4>
<p>集成 Resend 邮件服务，支持：</p>
<ul>
<li>邮件订阅</li>
<li>一键退订</li>
<li>订阅者管理</li>
</ul>
<h4 data-id="heading-13">8️⃣ AI 集成（可选）</h4>
<p>支持接入：</p>
<ul>
<li>Google AI (Gemini)</li>
<li>DeepSeek</li>
<li>OpenAI</li>
</ul>
<p>可以用来自动生成产品描述、智能分类等。</p>
<h3 data-id="heading-14">📁 项目结构</h3>
<pre><code class="hljs language-csharp" lang="csharp">nuxt-mkdirs/
├── app/
│   ├── components/     <span class="hljs-meta"># 53+ 组件</span>
│   ├── composables/    <span class="hljs-meta"># 组合式函数</span>
│   ├── layouts/        <span class="hljs-meta"># 3 种布局</span>
│   ├── pages/          <span class="hljs-meta"># 30+ 页面</span>
│   └── config/         <span class="hljs-meta"># 站点配置</span>
├── server/
│   ├── api/            <span class="hljs-meta"># 38+ API 路由</span>
│   └── utils/          <span class="hljs-meta"># 服务端工具</span>
├── sanity/
│   └── schemas/        <span class="hljs-meta"># 16 个 Schema</span>
└── <span class="hljs-keyword">public</span>/             <span class="hljs-meta"># 静态资源</span>
</code></pre>
<h3 data-id="heading-15">🚀 快速开始</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 克隆项目</span>
git <span class="hljs-built_in">clone</span> https://github.com/PBHAHAHA/Nuxt_Mkdirs.git
<span class="hljs-built_in">cd</span> Nuxt_Mkdirs

<span class="hljs-comment"># 安装依赖</span>
pnpm install

<span class="hljs-comment"># 复制环境变量</span>
<span class="hljs-built_in">cp</span> .env.example .<span class="hljs-built_in">env</span>

<span class="hljs-comment"># 启动开发服务器</span>
pnpm dev
</code></pre>
<p>访问 <code>http://localhost:3000</code> 即可看到效果。</p>
<h3 data-id="heading-16">⚙️ 配置说明</h3>
<h4 data-id="heading-17">Sanity CMS（必需）</h4>
<pre><code class="hljs language-bash" lang="bash">NUXT_PUBLIC_SANITY_PROJECT_ID=your_project_id
NUXT_PUBLIC_SANITY_DATASET=production
NUXT_SANITY_API_TOKEN=your_api_token
</code></pre>
<h4 data-id="heading-18">OAuth 认证（可选）</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># Google</span>
NUXT_AUTH_GOOGLE_CLIENT_ID=xxx
NUXT_AUTH_GOOGLE_CLIENT_SECRET=xxx

<span class="hljs-comment"># GitHub</span>
NUXT_AUTH_GITHUB_CLIENT_ID=xxx
NUXT_AUTH_GITHUB_CLIENT_SECRET=xxx

<span class="hljs-comment"># Secret（用 openssl rand -base64 32 生成）</span>
NUXT_AUTH_SECRET=xxx
</code></pre>
<h4 data-id="heading-19">邮件服务（可选）</h4>
<pre><code class="hljs language-bash" lang="bash">NUXT_RESEND_API_KEY=re_xxxxx
NUXT_RESEND_EMAIL_FROM=noreply@yourdomain.com
</code></pre>
<h4 data-id="heading-20">支付（可选）</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># Stripe（国际）</span>
NUXT_STRIPE_SECRET_KEY=sk_xxxxx

<span class="hljs-comment"># Creem（国内推荐）</span>
NUXT_CREEM_API_KEY=xxxxx
</code></pre>
<h3 data-id="heading-21">🌐 一键部署</h3>
<p>推荐使用 <strong>NuxtHub</strong> 部署到 Cloudflare：</p>
<pre><code class="hljs language-bash" lang="bash">npx nuxthub deploy
</code></pre>
<p>也支持 Vercel、Netlify 等平台。</p>
<h3 data-id="heading-22">📄 开源协议</h3>
<p><strong>MIT</strong> 协议，可以自由使用、修改、商用。</p>
<h3 data-id="heading-23">🙏 写在最后</h3>
<p>这个项目前前后后花了不少时间，虽然作为付费模板没卖出去几份，但开源出来希望能帮到更多人。</p>
<p><strong>如果这个项目对你有帮助：</strong></p>
<ul>
<li>⭐ <strong>Star</strong> 一下支持作者</li>
<li>🐛 发现 Bug 欢迎提 <strong>Issue</strong></li>
<li>📢 分享给有需要的朋友</li>
<li>💬 有问题可以评论区交流</li>
</ul>
<blockquote>
<p>🔗 GitHub: <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FPBHAHAHA%2FNuxt_Mkdirs" target="_blank" title="https://github.com/PBHAHAHA/Nuxt_Mkdirs" ref="nofollow noopener noreferrer">github.com/PBHAHAHA/Nu…</a></p>
</blockquote>
<p>也可以加我微信交流：<strong>w314709923x</strong></p>
<p><em>如果觉得有帮助，别忘了点赞 👍 收藏 ⭐ 关注 ➕ 三连哦～</em></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[React Native 从零开始完整教程（环境配置 → 国内镜像加速 → 运行项目）]]></title>    <link>https://juejin.cn/post/7582118218649206810</link>    <guid>https://juejin.cn/post/7582118218649206810</guid>    <pubDate>2025-12-11T05:11:29.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7582118218649206810" data-draft-id="7582118218649190426" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="React Native 从零开始完整教程（环境配置 → 国内镜像加速 → 运行项目）"/> <meta itemprop="keywords" content="React Native"/> <meta itemprop="datePublished" content="2025-12-11T05:11:29.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="码农突围NO1"/> <meta itemprop="url" content="https://juejin.cn/user/1843250655412046"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            React Native 从零开始完整教程（环境配置 → 国内镜像加速 → 运行项目）
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1843250655412046/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    码农突围NO1
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-11T05:11:29.000Z" title="Thu Dec 11 2025 05:11:29 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-11
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0"><strong>React Native 从零开始完整教程（环境配置 → 国内镜像加速 → 运行项目）</strong></h2>
<p>本教程将从 <strong>环境配置</strong> 开始，到 <strong>国内镜像加速</strong>，最后成功运行 React Native 项目（Android/iOS），适合新手和遇到网络问题的开发者。</p>
<hr/>
<h3 data-id="heading-1"><strong>1. 环境配置</strong></h3>
<h4 data-id="heading-2"><strong>1.1 安装 Node.js 和 npm/yarn</strong></h4>
<p>React Native 需要 Node.js（建议 LTS 版本）：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 安装 Node.js（官网：https://nodejs.org/）</span>
<span class="hljs-comment"># 安装后检查版本</span>
node -v  <span class="hljs-comment"># 要求 &gt;= 16</span>
npm -v   <span class="hljs-comment"># 或 yarn -v（推荐 yarn）</span>
</code></pre>
<h4 data-id="heading-3"><strong>1.2 安装 Java JDK（Android 必需）</strong></h4>
<p>Android 构建需要 JDK 17：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># macOS（Homebrew）</span>
brew install openjdk@17

<span class="hljs-comment"># Linux（Debian/Ubuntu）</span>
sudo apt-get install openjdk-17-jdk

<span class="hljs-comment"># Windows（手动安装）</span>
<span class="hljs-comment"># 下载：https://adoptium.net/temurin/releases/</span>
</code></pre>
<p>验证安装：</p>
<pre><code class="hljs language-bash" lang="bash">java -version  <span class="hljs-comment"># 应显示 "openjdk 17.x.x"</span>
</code></pre>
<h4 data-id="heading-4"><strong>1.3 安装 Android Studio（Android 开发环境）</strong></h4>
<ol>
<li>下载 <a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.android.com%2Fstudio" target="_blank" title="https://developer.android.com/studio" ref="nofollow noopener noreferrer">Android Studio</a>。</li>
<li>安装时勾选：
<ul>
<li><strong>Android SDK</strong></li>
<li><strong>Android Emulator</strong></li>
<li><strong>Platform Tools</strong></li>
</ul>
</li>
<li>配置环境变量：
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># macOS/Linux：添加到 ~/.zshrc 或 ~/.bashrc</span>
<span class="hljs-built_in">export</span> ANDROID_HOME=<span class="hljs-variable">$HOME</span>/Library/Android/sdk
<span class="hljs-built_in">export</span> PATH=<span class="hljs-variable">$PATH</span>:<span class="hljs-variable">$ANDROID_HOME</span>/platform-tools
<span class="hljs-built_in">export</span> PATH=<span class="hljs-variable">$PATH</span>:<span class="hljs-variable">$ANDROID_HOME</span>/cmdline-tools/latest/bin

<span class="hljs-comment"># Windows：在系统环境变量中添加 ANDROID_HOME 和 Path</span>
 右键 此电脑 → 属性 → 高级系统设置 → 环境变量
 在 系统变量 中：
 1. 新建变量名 ANDROID_HOME，值为 SDK 路径
 （如 C:\Users\你的用户名\AppData\Local\Android\Sdk）
 2. 编辑 PATH，添加两条新值：
 %ANDROID_HOME%\platform-tools
 %ANDROID_HOME%\emulator
</code></pre>
</li>
<li>验证：
<pre><code class="hljs language-bash" lang="bash">adb --version  <span class="hljs-comment"># 应显示版本号</span>
</code></pre>
</li>
</ol>
<h4 data-id="heading-5"><strong>1.4 安装 Xcode（仅 macOS，iOS 开发）</strong></h4>
<ol>
<li>从 App Store 安装 <strong>Xcode</strong>。</li>
<li>安装命令行工具：
<pre><code class="hljs language-bash" lang="bash">xcode-select --install
sudo xcodebuild -license accept
</code></pre>
</li>
</ol>
<hr/>
<h3 data-id="heading-6"><strong>2. 创建 React Native 项目</strong></h3>
<h4 data-id="heading-7"><strong>2.1 使用官方模板初始化项目</strong></h4>
<pre><code class="hljs language-bash" lang="bash">npx @react-native-community/cli init MyProject
<span class="hljs-built_in">cd</span> MyProject
</code></pre>
<h4 data-id="heading-8"><strong>2.2 启动 Metro 开发服务器</strong></h4>
<pre><code class="hljs language-bash" lang="bash">npm start
<span class="hljs-comment"># 或</span>
yarn start
</code></pre>
<p>Metro 会启动一个本地服务（默认端口 8081），提供 JavaScript 代码的热更新。</p>
<h4 data-id="heading-9"><strong>Metro 是什么？</strong></h4>
<h5 data-id="heading-10"><strong>1. Metro 的核心作用</strong></h5>
<p>Metro 是 React Native <strong>专用的 JavaScript 打包工具</strong>，负责：</p>
<ul>
<li>实时将你的 React 代码和依赖打包成单个 <code>.bundle</code> 文件</li>
<li>支持开发时的<strong>热更新（Hot Reloading）</strong></li>
<li>提供错误提示和日志（终端中显示的红色错误框就是它的功劳）</li>
</ul>
<h5 data-id="heading-11"><strong>2. Metro 的工作流程</strong></h5>
<pre><code class="hljs language-mermaid" lang="mermaid">graph LR
  A[你的代码] --&gt; B(Metro 打包器)
  B --&gt; C{开发模式?}
  C --&gt;|是| D[生成可调试的 bundle]
  C --&gt;|否| E[生成优化的生产包]
  D --&gt; F[发送到手机/模拟器]
</code></pre>
<h5 data-id="heading-12"><strong>3. 你与 Metro 的交互场景</strong></h5>
<ul>
<li><strong>启动 Metro</strong>：运行 <code>npm start</code> 时，会看到终端显示：
<pre><code class="hljs language-bash" lang="bash">Metro Bundler ready on http://localhost:8081
</code></pre>
</li>
<li><strong>调试时</strong>：手机上的 JS 代码实际是通过 Metro 服务实时加载的（这就是为什么必须保持 <code>npm start</code> 运行）</li>
<li><strong>报错时</strong>：Metro 会在终端和手机红屏显示错误堆栈</li>
</ul>
<h5 data-id="heading-13"><strong>4. 常见 Metro 问题解决</strong></h5>
<ul>
<li><strong>问题</strong>：<code>Metro 无法启动（端口占用）</code><br/>
<strong>解决</strong>：
<pre><code class="hljs language-bash" lang="bash">lsof -i :8081    <span class="hljs-comment"># 查看占用进程</span>
<span class="hljs-built_in">kill</span> -9 &lt;PID&gt;    <span class="hljs-comment"># 强制结束进程</span>
</code></pre>
</li>
<li><strong>问题</strong>：<code>缓存导致代码不更新</code><br/>
<strong>解决</strong>：
<pre><code class="hljs language-bash" lang="bash">npm start -- --reset-cache
</code></pre>
</li>
</ul>
<hr/>
<h4 data-id="heading-14"><strong>总结对比表</strong></h4>




















<table><thead><tr><th>概念</th><th>作用</th><th>是否需要手动配置</th></tr></thead><tbody><tr><td><strong>环境变量</strong></td><td>告诉系统 Android 工具在哪</td><td>✔️ 必须配置</td></tr><tr><td><strong>Metro</strong></td><td>打包和运行 JS 代码</td><td>❌ 自动集成于 RN 项目</td></tr></tbody></table>
<hr/>
<h3 data-id="heading-15"><strong>3. 配置国内镜像加速</strong></h3>
<h4 data-id="heading-16"><strong>3.1 配置 npm/yarn 镜像（加速 JS 依赖下载）</strong></h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 使用淘宝镜像</span>
npm config <span class="hljs-built_in">set</span> registry https://registry.npmmirror.com
<span class="hljs-comment"># 或</span>
yarn config <span class="hljs-built_in">set</span> registry https://registry.npmmirror.com
</code></pre>
<h4 data-id="heading-17"><strong>3.2 配置 Gradle 镜像（加速 Android 依赖下载）</strong></h4>
<ol>
<li>修改 <code>android/build.gradle</code>：
<pre><code class="hljs language-gradle" lang="gradle">allprojects {
    repositories {
        // 阿里云镜像（优先）
        maven { url 'https://maven.aliyun.com/repository/public' }
        maven { url 'https://maven.aliyun.com/repository/google' }
        // 腾讯云镜像（备用）
        maven { url 'https://mirrors.cloud.tencent.com/nexus/repository/maven-public/' }
        // 默认仓库（确保兼容性）
        google()
        mavenCentral()
    }
}
</code></pre>
</li>
<li>修改 <code>android/gradle/wrapper/gradle-wrapper.properties</code>：
<pre><code class="hljs language-properties" lang="properties"># 替换为腾讯云镜像
distributionUrl=https\://mirrors.cloud.tencent.com/gradle/gradle-8.13-bin.zip
</code></pre>
</li>
</ol>
<h4 data-id="heading-18"><strong>3.3 配置 Maven 镜像（加速 Android 原生库下载）</strong></h4>
<p>在 <code>android/build.gradle</code> 的 <code>buildscript</code> 中添加：</p>
<pre><code class="hljs language-gradle" lang="gradle">buildscript {
    repositories {
        maven { url 'https://maven.aliyun.com/repository/public' }
        maven { url 'https://maven.aliyun.com/repository/google' }
        google()
        mavenCentral()
    }
}
</code></pre>
<hr/>
<h3 data-id="heading-19"><strong>4. 运行项目</strong></h3>
<h4 data-id="heading-20"><strong>4.1 运行 Android 版本</strong></h4>
<ol>
<li>启动 Android 模拟器（通过 Android Studio 或命令行）：
<pre><code class="hljs language-bash" lang="bash">emulator -list-avds  <span class="hljs-comment"># 列出可用模拟器</span>
emulator -avd Pixel_5_API_34  <span class="hljs-comment"># 启动模拟器</span>
</code></pre>
</li>
<li>编译并安装 APK：
<pre><code class="hljs language-bash" lang="bash">npx react-native run-android <span class="hljs-comment">#另起终端运行，和metro分开</span>
</code></pre>
<ul>
<li>如果首次运行，Gradle 会从国内镜像下载依赖。</li>
<li>成功后会自动安装 APK 并启动应用。</li>
</ul>
</li>
</ol>
<h4 data-id="heading-21"><strong>4.2 运行 iOS 版本（仅 macOS）</strong></h4>
<ol>
<li>启动 iOS 模拟器：
<pre><code class="hljs language-bash" lang="bash">npx react-native run-ios
</code></pre>
<ul>
<li>会自动编译并启动模拟器。</li>
</ul>
</li>
</ol>
<hr/>
<h3 data-id="heading-22"><strong>5. 常见问题解决</strong></h3>
<h4 data-id="heading-23"><strong>问题 1：Gradle 下载卡住或超时</strong></h4>
<ul>
<li><strong>原因</strong>：网络问题或缓存冲突。</li>
<li><strong>解决</strong>：
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">cd</span> android
./gradlew clean  <span class="hljs-comment"># 清理构建缓存</span>
<span class="hljs-built_in">rm</span> -rf ~/.gradle/caches/  <span class="hljs-comment"># 删除全局缓存</span>
</code></pre>
</li>
</ul>
<h4 data-id="heading-24"><strong>问题 2：<code>Could not resolve all dependencies</code></strong></h4>
<ul>
<li><strong>原因</strong>：某些库不在镜像中。</li>
<li><strong>解决</strong>：在 <code>build.gradle</code> 中保留 <code>google()</code> 和 <code>mavenCentral()</code>。</li>
</ul>
<h4 data-id="heading-25"><strong>问题 3：Metro 无法连接设备</strong></h4>
<ul>
<li><strong>解决</strong>：
<pre><code class="hljs language-bash" lang="bash">adb reverse tcp:8081 tcp:8081  <span class="hljs-comment"># 确保设备能访问 Metro</span>
</code></pre>
</li>
</ul>
<hr/></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[深入探索 Spring Boot3 中 Profiles 多环境配置]]></title>    <link>https://juejin.cn/post/7582131164728868904</link>    <guid>https://juejin.cn/post/7582131164728868904</guid>    <pubDate>2025-12-11T05:37:12.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7582131164728868904" data-draft-id="7582155513586057268" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="深入探索 Spring Boot3 中 Profiles 多环境配置"/> <meta itemprop="keywords" content="后端,Java,架构"/> <meta itemprop="datePublished" content="2025-12-11T05:37:12.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="程序员西西"/> <meta itemprop="url" content="https://juejin.cn/user/326976944214804"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            深入探索 Spring Boot3 中 Profiles 多环境配置
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/326976944214804/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    程序员西西
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-11T05:37:12.000Z" title="Thu Dec 11 2025 05:37:12 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-11
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">前言</h2>
<p>在当今复杂的软件开发领域，一个应用往往需要在开发、测试、生产等多个环境中运行，每个环境的配置需求大相径庭。想象一下，在开发环境中，你可能需要频繁调试，所以希望日志更加详细，数据库连接到本地易于修改的测试库；而在生产环境中，对性能和稳定性要求极高，日志级别需要调整，数据库要连接到高可用的正式数据库。Spring Boot 3 的 Profiles 特性就如同一位贴心的助手，为我们解决了不同环境配置管理的难题，提供了灵活且强大的多环境配置解决方案。接下来，让我们深入探索 Spring Boot3 中 Profiles 多环境配置的奥秘。</p>
<h2 data-id="heading-1">Profiles 是什么</h2>
<p>Profiles 是 Spring 框架提供的一种机制，它允许开发者针对不同的环境定义不同的配置。在 Spring Boot 应用里，借助激活特定的 Profile，能够实现条件化的 Bean 注册、配置属性加载等操作，从而使应用依据运行环境加载相应的配置。简单来说，它就像是为应用准备的不同 “装备包”，在不同的环境下，应用可以穿上合适的 “装备”，以最佳状态运行。</p>
<h2 data-id="heading-2">配置方式</h2>
<p><strong>（一）Properties 配置方式</strong></p>
<p>对于 application.properties 文件，我们可以创建多个以 application-{profile}.properties 命名的文件来定义不同环境的配置。其中，{profile} 就是环境标识，常见的如 dev（开发环境）、test（测试环境）、prod（生产环境）等。主配置文件 application.properties 通过 spring.profiles.active 属性来指定当前激活的环境。例如：</p>
<p>在主配置文件 application.properties 中设置：</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">spring.profiles.active</span>=dev
</code></pre>
<p>然后创建开发环境配置文件<br/>
application-dev.properties，里面可以定义开发环境特有的配置，如：</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">server.port</span>=<span class="hljs-number">8080</span>
<span class="hljs-attr">spring.datasource.url</span>=jdbc:mysql://localhost:<span class="hljs-number">3306</span>/devdb
<span class="hljs-attr">spring.datasource.username</span>=devuser
<span class="hljs-attr">spring.datasource.password</span>=devpassword
</code></pre>
<p>测试环境配置文件<br/>
application-test.properties 可如下设置：</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">server.port</span>=<span class="hljs-number">8081</span>
<span class="hljs-attr">spring.datasource.url</span>=jdbc:mysql://localhost:<span class="hljs-number">3306</span>/testdb
<span class="hljs-attr">spring.datasource.username</span>=testuser
<span class="hljs-attr">spring.datasource.password</span>=testpassword
</code></pre>
<p>生产环境配置文件<br/>
application-prod.properties 则可设置为：</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">server.port</span>=<span class="hljs-number">80</span>
<span class="hljs-attr">spring.datasource.url</span>=jdbc:mysql://prod-db:<span class="hljs-number">3306</span>/proddb
<span class="hljs-attr">spring.datasource.username</span>=produser
<span class="hljs-attr">spring.datasource.password</span>=prodpassword
</code></pre>
<p><strong>（二）YAML 配置方式</strong></p>
<p><strong>单文件配置</strong>：只有 YAML 支持用 “---” 分隔的语法。在 application.yml 文件中，可以通过多个文档块来定义不同环境的配置。每个文档块中，通过 spring.profiles 属性来指定当前文档块对应的环境。示例如下：</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-comment"># 默认配置</span>
<span class="hljs-attr">server:</span>
  <span class="hljs-attr">port:</span> <span class="hljs-number">8080</span>
<span class="hljs-attr">spring:</span>
  <span class="hljs-attr">datasource:</span>
    <span class="hljs-attr">url:</span> <span class="hljs-string">jdbc:mysql://default-db:3306/defaultdb</span>
    <span class="hljs-attr">username:</span> <span class="hljs-string">defaultuser</span>
    <span class="hljs-attr">password:</span> <span class="hljs-string">defaultpassword</span>

<span class="hljs-meta">---</span>
<span class="hljs-comment"># dev环境配置</span>
<span class="hljs-attr">spring:</span>
  <span class="hljs-attr">profiles:</span> <span class="hljs-string">dev</span>
<span class="hljs-attr">server:</span>
  <span class="hljs-attr">port:</span> <span class="hljs-number">8080</span>
<span class="hljs-attr">spring:</span>
  <span class="hljs-attr">datasource:</span>
    <span class="hljs-attr">url:</span> <span class="hljs-string">jdbc:mysql://localhost:3306/devdb</span>
    <span class="hljs-attr">username:</span> <span class="hljs-string">devuser</span>
    <span class="hljs-attr">password:</span> <span class="hljs-string">devpassword</span>

<span class="hljs-meta">---</span>
<span class="hljs-comment"># test环境配置</span>
<span class="hljs-attr">spring:</span>
  <span class="hljs-attr">profiles:</span> <span class="hljs-string">test</span>
<span class="hljs-attr">server:</span>
  <span class="hljs-attr">port:</span> <span class="hljs-number">8081</span>
<span class="hljs-attr">spring:</span>
  <span class="hljs-attr">datasource:</span>
    <span class="hljs-attr">url:</span> <span class="hljs-string">jdbc:mysql://localhost:3306/testdb</span>
    <span class="hljs-attr">username:</span> <span class="hljs-string">testuser</span>
    <span class="hljs-attr">password:</span> <span class="hljs-string">testpassword</span>

<span class="hljs-meta">---</span>
<span class="hljs-comment"># prod环境配置</span>
<span class="hljs-attr">spring:</span>
  <span class="hljs-attr">profiles:</span> <span class="hljs-string">prod</span>
<span class="hljs-attr">server:</span>
  <span class="hljs-attr">port:</span> <span class="hljs-number">80</span>
<span class="hljs-attr">spring:</span>
  <span class="hljs-attr">datasource:</span>
    <span class="hljs-attr">url:</span> <span class="hljs-string">jdbc:mysql://prod-db:3306/proddb</span>
    <span class="hljs-attr">username:</span> <span class="hljs-string">produser</span>
    <span class="hljs-attr">password:</span> <span class="hljs-string">prodpassword</span>
</code></pre>
<p><strong>多文件配置</strong>：文件命名遵循 application-{profile}.yml 的格式，其中 {profile} 为环境标识。主配置文件 application.yml 中，通常可指定默认激活的环境或包含一些公共配置。例如，主配置文件 application.yml：</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">spring:</span>
  <span class="hljs-attr">profiles:</span>
    <span class="hljs-attr">active:</span> <span class="hljs-string">dev</span> <span class="hljs-comment"># 默认激活开发环境，可按需修改</span>
</code></pre>
<p>开发环境配置文件 application-dev.yml：</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">server:</span>
  <span class="hljs-attr">port:</span> <span class="hljs-number">8080</span>
<span class="hljs-attr">spring:</span>
  <span class="hljs-attr">datasource:</span>
    <span class="hljs-attr">url:</span> <span class="hljs-string">jdbc:mysql://localhost:3306/devdb</span>
    <span class="hljs-attr">username:</span> <span class="hljs-string">devuser</span>
    <span class="hljs-attr">password:</span> <span class="hljs-string">devpassword</span>
</code></pre>
<p>测试环境配置文件 application-test.yml 和生产环境配置文件 application-prod.yml 结构类似，替换相应配置值即可。</p>
<h2 data-id="heading-3">激活方式</h2>
<p><strong>（一）在配置文件中指定</strong></p>
<p>在 application.properties 或 application.yml 文件中，通过 spring.profiles.active 属性指定，如在 application.yml 中：</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">spring:</span>
  <span class="hljs-attr">profiles:</span>
    <span class="hljs-attr">active:</span> <span class="hljs-string">dev</span>
</code></pre>
<p><strong>（二）通过命令行参数指定</strong></p>
<p>启动应用程序时，使用命令行参数–spring.profiles.active 来指定激活的环境。例如，要启动生产环境：</p>
<pre><code class="hljs language-ini" lang="ini">java -jar myapp.jar <span class="hljs-attr">--spring.profiles.active</span>=prod
</code></pre>
<p><strong>（三）通过环境变量指定</strong></p>
<p>设置环境变量 SPRING_PROFILES_ACTIVE 来指定激活的环境。在 Linux 或 Mac 系统中：</p>
<pre><code class="hljs language-ini" lang="ini">export <span class="hljs-attr">SPRING_PROFILES_ACTIVE</span>=prod
java -jar myapp.jar
</code></pre>
<p>在 Windows 系统中：</p>
<pre><code class="hljs language-ini" lang="ini">set <span class="hljs-attr">SPRING_PROFILES_ACTIVE</span>=prod
java -jar myapp.jar
</code></pre>
<p><strong>（四）在 IDE 中指定</strong></p>
<p>使用 IntelliJ IDEA 或 Eclipse 等 IDE 运行应用程序时，可在运行配置中指定激活的环境。以 IntelliJ IDEA 为例，在 “Run Configurations” 中，找到 “VM options” 或 “Program arguments”，添加 “–spring.profiles.active=dev”（这里以开发环境为例）。</p>
<h2 data-id="heading-4">打包</h2>
<p>使用 Maven 或 Gradle 等构建工具打包 Spring Boot 应用程序时，配置文件通常会自动包含在生成的 JAR 或 WAR 包中。若要为不同环境打包不同的配置文件，可利用 Maven 的 profiles 功能或 Gradle 的构建变体（build variants）。</p>
<p>以 Maven 为例，在 pom.xml 文件中定义不同的 profiles，并在每个 profile 中指定要包含的配置文件。在主配置文件 application.yml 中，使用占位符来指定当前激活的环境，如：</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">spring:</span>
  <span class="hljs-attr">datasource:</span>
    <span class="hljs-attr">url:</span> <span class="hljs-string">jdbc:mysql://${profiles.active}-db:3306/${profiles.active}db</span>
    <span class="hljs-attr">username:</span> <span class="hljs-string">${profiles.active}user</span>
    <span class="hljs-attr">password:</span> <span class="hljs-string">${profiles.active}password</span>
</code></pre>
<p>在 pom.xml 中配置多个环境：</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">profiles</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">profile</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">id</span>&gt;</span>dev<span class="hljs-tag">&lt;/<span class="hljs-name">id</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">activation</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">activeByDefault</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">activeByDefault</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">activation</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">properties</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">profiles.active</span>&gt;</span>dev<span class="hljs-tag">&lt;/<span class="hljs-name">profiles.active</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">properties</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">profile</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">profile</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">id</span>&gt;</span>test<span class="hljs-tag">&lt;/<span class="hljs-name">id</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">properties</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">profiles.active</span>&gt;</span>test<span class="hljs-tag">&lt;/<span class="hljs-name">profiles.active</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">properties</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">profile</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">profile</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">id</span>&gt;</span>prod<span class="hljs-tag">&lt;/<span class="hljs-name">id</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">properties</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">profiles.active</span>&gt;</span>prod<span class="hljs-tag">&lt;/<span class="hljs-name">profiles.active</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">properties</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">profile</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">profiles</span>&gt;</span>
</code></pre>
<p>为使 Maven 在打包时能替换主配置文件中的占位符，需在 pom.xml 中配置资源过滤：</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">build</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">resources</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">resource</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">directory</span>&gt;</span>src/main/resources<span class="hljs-tag">&lt;/<span class="hljs-name">directory</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">filtering</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">filtering</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">resource</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">resources</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">build</span>&gt;</span>
</code></pre>
<p>之后，使用 Maven 打包命令生成不同环境的构建产物。生成开发环境构建产物：</p>
<pre><code class="hljs language-go" lang="go">mvn clean <span class="hljs-keyword">package</span>
</code></pre>
<p>生成测试环境构建产物：</p>
<pre><code class="hljs language-bash" lang="bash">mvn clean package -P <span class="hljs-built_in">test</span>
</code></pre>
<p>生成生产环境构建产物：</p>
<pre><code class="hljs language-css" lang="css">mvn clean package -<span class="hljs-selector-tag">P</span> prod
</code></pre>
<h2 data-id="heading-5">最佳实践</h2>
<p><strong>避免硬编码</strong>：尽量不在代码中硬编码环境特定的值，而应使用配置属性和 Profile 来管理这些值。这样当环境变化时，无需修改代码，直接调整配置文件即可。</p>
<p><strong>精简 Profile 数量</strong>：虽然 Spring Boot 支持同时激活多个 Profiles，但为保持配置简洁，建议精简 Profile 的数量和复杂度。过多的 Profile 可能导致配置混乱，难以维护。</p>
<p><strong>使用 Profile-specific 配置文件</strong>：对于环境特定的配置，使用 Profile-specific 的配置文件（如 application-dev.yml），便于管理和维护。将不同环境的配置分开，清晰明了，减少出错概率。</p>
<p><strong>管理敏感信息</strong>：在生产环境中，配置文件可能包含敏感信息（如数据库密码、API 密钥等）。可使用环境变量存储敏感信息，然后在配置文件中引用；或使用 Spring Cloud Config 集中管理配置信息，并通过加密等方式保护敏感信息。</p>
<p><strong>配置文件的命名和组织</strong>：通用配置使用 application.yml 文件；不同环境配置使用 application-{profile}.yml 文件；若有多个模块或功能的配置，可创建相应的配置文件，如 module1-{profile}.yml、module2-{profile}.yml ，这样可以让配置文件的结构更加清晰，易于查找和维护。</p>
<p>Spring Boot 3 中的 Profiles 为我们提供了强大且灵活的多环境配置管理方式。通过合理运用 Profiles，能够显著提升配置的灵活性和应用的可维护性，让应用的开发、测试和部署更加高效、可控。随着 Spring Boot 3 的持续发展，利用 Profiles 优化应用配置依然是实现高质量微服务架构的关键策略之一，希望本文能帮助各位开发者更好地掌握和运用这一强大功能，在软件开发的道路上更加得心应手。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[js实现页面全屏展示]]></title>    <link>https://juejin.cn/post/7582156410319503370</link>    <guid>https://juejin.cn/post/7582156410319503370</guid>    <pubDate>2025-12-11T05:24:29.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7582156410319503370" data-draft-id="7582110969201246246" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="js实现页面全屏展示"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2025-12-11T05:24:29.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="小明记账簿_微信小程序"/> <meta itemprop="url" content="https://juejin.cn/user/1901536389893546"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            js实现页面全屏展示
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1901536389893546/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    小明记账簿_微信小程序
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-11T05:24:29.000Z" title="Thu Dec 11 2025 05:24:29 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-11
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";@keyframes spin{0%{transform:rotate(0)}to{transform:rotate(1turn)}}.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:15px;overflow-x:hidden;color:#36ace1;background-image:linear-gradient(90deg,rgba(217,234,251,.25) 3%,transparent 0),linear-gradient(1turn,rgba(217,234,251,.25) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{color:#36ace1}.markdown-body h1:before,.markdown-body h2:before,.markdown-body h3:before,.markdown-body h4:before,.markdown-body h5:before,.markdown-body h6:before{content:"";display:block;position:absolute;left:0;top:0;bottom:0;margin:auto;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABwAAAAcCAYAAAByDd+UAAAF8UlEQVRIS71Wa2wUVRT+7r0zu9t2t/RBaSioPCpYbIUfaEIQUogSAwZDAlUSGwgg/CBATExMCJH1D2hIfOEjFEUEhViCgBgIUCH44OkjPAMGBVqhpUCfW3Zn5z7MuQOE0hYxMdxJdmd25s53vnO+851leMCLPWA8/CfA2TsvL8n7q+nTFfNLG+4VqInHOeJLDQMzdz/3r4DGGDb9lxu+aPcE7U61JHDMDePcuv0O21ShugOefqDdtBie3Dk6K/O+Ab+qOjJiz7Ahv6c8hbDDwRiQlgYGDOcaWyEcjg8On+j71IpJndjGt9XO+jM7+pkywNvbazIfercieSdoJ4bE5sWjyZqMpDdeaQNXMNC34ME3LV8B56+1w3AOgk+EXe/Ub6uiLB6XdH/G/mYjeBCcFwnt3zQqWt4t4NjjnhzQ1CGkBhwOCMFAB71U0qsYgRlwBtQ1tiEJAy44OBdQUmFK3aWS06NLT+ukZAQoKCCjsfbDmk6p78RwX3ncWffmIj8U4kh6GpEwh+9rGy23LDU4GBrrm9DsuDYIGMAYIC/EUNQ7Cq1hn+WM2TI8f+jEyCmvjfn1FssuojHx6tDkyZOaCzr8TNpASzDAk8amlRIrEylcSGsYrcGIstIYWhgDDIM2BiGH3ywFkGAC1U9n38bpVqWGdk6r4HMWrZZaG1D5KLn0qYyBEAKnG1otAxLR8L7Z9nfP13CJHQ/ST4vK8sVHe8JsU0U6uO5hlexo8PI7vNDQomwoBRAwpSmtgJAAztS3QLsOsmBQlBtFJMQhlbbPUBBUR7o2hqHVddLbRsfCPQJ+u3TPw8uGl1yklAlHIJZKo3//XEhlLCtifPFyM7xwCI/lZ8IKTTBbS7pPLIggZZsSQ+zXbT4UYSsnet3UMM5HPT5LGbrDGYQroClyT2Jwnyj9aN949e8mDCwuRFoqKxRHUJ21BSDRELuQYGhvbMVV32Dp2RuxcfHSRBfAYTsbU9nJdFj5EiLkglHkRInC1xoxKbH9hQJIaTDvxxTCUddWl4wg0dCCtqSPDmoVx4Eitpxh64ZtsT6b5ie6pPRkfF90TllxOzEwmipMKRRgHODGgCuJkqIcvDdC2BZ5Y+tlHHMzkAKghbAxcQqQDiKrFBxhqg5MHTivS1tQ+sdsvaQl5Yd6yfdRXNQLsQwXnq/AQFLXEIIjzBSuNaaR0SuEtkQKl9IKjAsbJaWfzo1USDsM6zceDJfeVGgnhhN2N7YOyo5kJz1pa2AbgfrO1gRwXW6vSRQNtddR+EhvKGmseskgTtY2Q7kucYWWgToPHzyUyXry0iXfnBtfl5f/PaWPvPNW/zkOAQegJHltFE5dSaCskHqPVEnqpMAMEgkPtR1pKxyh/N0/vTToubtH1G3RmLjhM8ubKXfWB2mRa9ySOaWS2uT8lTZ0cI6I52Ngv7zAbW9mQVm1cpytu441P38XeXTlQu+e46nyh+bjLkMZRU0MCYTCJWZSG1y7cBWNURpxBlxqFBfEwGnGGhaYPSNwhpSv4DK+/vPynBk9MqRIiOWs8a2WJTm9a+cgh6SaMIMz9W1WjYHHMtv0wSmZdWB9gdsya/rcYVg7JoffCdqlD6ceTpiY59tM0PhJp5WNvra+BQkejCMyBarr8KKYDcZi8sDaCDKYFIGRk+FnSVXzyTO9JxBwF8DLc1dlLn65ooNEYN0fBsu21fTvL6PXnhxXlnLIqqhYYBian4lQ2Lk9ogiALsimiLC1QYfhlV1Hnxh7JfcMqxrpd7U2GFa5t9nOd7Kr+kg4uWvnCpromlJeXlq3Os3ZLOlrZBmNQf1ybVqpxhbA7mRIOCy1+esDOWhIyDv/+3Q7LRbsqH+rKRJ+nba+/+WW7II1s9vvVBuNr7KNF1WUM1bSt5f1Vq01jUVkKfnx8uoti3Or5rbd9782M61azJz/rFywYU/OyKqK1p5G2MS1Z18tGFDwTkvIxcK9RwaMP3a9/tbc62lPj/Nw5B9ey9Ehy/MY4oEqelgNleuyCgdXJlmc3fO5Ll56r5f+n/f+AWFf9jvBgaHpAAAAAElFTkSuQmCC);animation:spin 2s linear 1s infinite}.markdown-body h1{position:relative;font-size:30px;padding:12px 38px;margin:30px 0}.markdown-body h1:before{width:30px;height:30px;background-size:30px 30px}.markdown-body h2{position:relative;font-size:24px;padding:12px 36px;margin:28px 0}.markdown-body h2:before{width:28px;height:28px;background-size:28px 28px}.markdown-body h3{position:relative;font-size:18px;padding:4px 32px;margin:26px 0}.markdown-body h3:before{width:24px;height:24px;background-size:24px 24px}.markdown-body h4{position:relative;padding:4px 28px;font-size:16px;margin:22px 0}.markdown-body h4:before{width:20px;height:20px;background-size:20px 20px}.markdown-body h5{position:relative;padding:4px 26px;font-size:15px;margin:20px 0}.markdown-body h5:before{width:18px;height:18px;background-size:18px 18px}.markdown-body h6{position:relative;padding:4px 22px;font-size:14px;margin:16px 0}.markdown-body h6:before{width:16px;height:16px;background-size:16px 16px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{position:relative;width:98%;height:1px;border:none;margin-top:32px;margin-bottom:32px;background-image:linear-gradient(90deg,#36ace1,#dff0fe,#36ace1);overflow:visible}.markdown-body hr:after{content:"";position:absolute;margin:auto;left:0;right:0;bottom:0;top:0;display:inline-block;width:50px;height:24px;background:#fff;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABoAAAAaCAYAAACpSkzOAAAEgElEQVRIS72Va0xbZRjH/z2FcimbchEQFDYRCIRAAWFQ2MaCXBwmUxYDLGGEcRFkH9wmk04zG0Bo2dwNIisERANqhjqdEmhd4nRbuwpsXDYWLLoRgeG4Chu9QHvMOQ0dpTAKH3y/tDnv8/5/z/Oc//scBv6nxdgoJ14gVYPEuITHdTdHY12gRIH0T0KljlqwthqUFHGtzAEsxqwLtPvkdc+FeeI3BgMeAMEhdOqR1mM7xswBrgmKE8pfIUhtm7fbZsft/i7wc98MtrUFxmbU6ByYgFwxjtFp5Q+WpF1mCy9wajXoqqD4E91saOf603e+5B7t99xTkyZJEiKJAl2DE9Xio1HvrBS8IuhVwVUP503swdJ9QWAw1izaoDs6pQT/655BMS9yy3KYiUoM/7adu7NmtnQfx5zWm8Q8Ui3gyGcddyU8rv/STRNQouDGP5/mhTubX4dpPv3DMzh1qS9LwuPWr+i63WVyn5QYj/4d/i4bqmbpoQ+auvBlQYghX6PE4wTSOzV5EUYlb5Q4MDqLk9/3cMRF27spDSNQamUnWZ4ebNB+OKNCyYVeFCZ5wZ5tiePN/UiP2YoQL0cUX+iFt4sNUiLdcaVvHJLecQiWnKVE8s5LvxAXRWeYgHLre0hecgAN0sxr0XBZgbJUP6OiLnaM4ivZCBrzOWBZEIY9rY5E8pl2nM0KMzzLq5aPiXmRzgbQm2VyR8KGGK/ICAFB6IusbvsDwhRf+n/jtSHc/nsGgjR9V6/1TyLa1wGU+FtnO1CbHQTHTSzIFJOYJ1jwcGLTccMTcyhp7oW4KFJ/SV4/IScrc55kQj07WNuOn94Lpw8kCm/Qv3W5HLjbWxsyfuNUO1TzWjAJBloKt2FBS+Jz6ShiA12NupBdLWugQcmn28lPMkONNql3U5cTSD9Lq+qEUqPFt++G0aKL687wDAqb+pAU7IKCuK2493AOPQ9UCNpib6T1tkg+RZ9KKJcNn8sJc1vac8o16jklLWLuOiDqwvHUIKPw7vtTON+iCDKkl/Cx9FeSYET5um1mHt6jN0Dz9ftwYjORudNjTdaBmi7kxvvA1d6Gjs0X/Q5Sp3tMEMSHre9HnDEZAPFCWUNVdliGJVPvqEP1Hbh4yPj9LadSY6fu6gPsCX+B3mq7NYLv2od8fj4aoViMNQGFijos/XVMTXGavgUisQIle71hwVx9KFEutLVjw8GORTuxoEbeJS7iPrmQyy/sIj2hQpqYHO7ZGs95nnZS4y8K8Pfqrb58UZ+IlKqbqNgfQm8da+pC9xjLqo8foFkau2qaCeXSyvzXfA9SDrp1bxJ/DU/jSJKXEWdBR2J/9U0UpwXTFZ/+8S76h/71FvO4A8sTeuqQThDKalOiPLN3BbhiYlaNsm964elkCztrC4xMqeDqYIus2JdB3cbS5l4MTag44qJt9GxbF4gKThRKY59lW13+KCUQ1pZMEwHKviKx4pFSqXzxCn/X9Gr2NO+zw+cTiTbxmUyCqH3GlsWg2kRNhOnHmhlrFkIvHTZt1borWvMCmRnwH4usn58STiycAAAAAElFTkSuQmCC);background-repeat:no-repeat;background-size:auto 100%;background-position-x:center}.markdown-body del{color:#36ace1}.markdown-body code{font-family:Menlo,Monaco,Consolas,Courier New,monospace;word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#282c34;color:#4ec9b0;padding:.24em .46em;margin:0 4px}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-family:Menlo,Monaco,Consolas,Courier New,monospace;font-size:12px;border-radius:10px;padding:15px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#4ec9b0;background:#282c34}.markdown-body a{text-decoration:none;color:#409eff;border-bottom:1px solid #409eff}.markdown-body a:active,.markdown-body a:hover{color:#007bff;border-bottom:1px solid #007bff}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{position:relative;padding:8px 26px;background-color:rgba(54,172,225,.75);margin:16px 0;border-left:4px solid #409eff;border-radius:5px}.markdown-body blockquote:before{content:"❝";top:10px;left:8px;color:#409eff;font-size:20px;line-height:1;font-weight:700;position:absolute;opacity:.7}.markdown-body blockquote:after{content:"❞";font-size:20px;position:absolute;right:8px;bottom:0;color:#409eff;opacity:.7}.markdown-body blockquote&gt;p{color:#fff}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>最近做一个网页项目，用户要求可以全屏展示，进入系统后隐藏地址栏，于是乎，经过调研就选择了全屏<code>API</code>，即便如此还是遇到了一些问题，总结一下，写下此篇文章，以免以后再遇到相同的问题。</p>
</blockquote>
<p>在JavaScript中，实现页面全屏展示主要依赖于HTML5的Fullscreen API，这是一个相对较新的技术，因此在旧版本的浏览器上可能不受支持，现代浏览器支出如下。</p>
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0147412e26fb49b4aedaa6695523568b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP5piO6K6w6LSm57C_X-W-ruS_oeWwj-eoi-W6jw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766035469&amp;x-signature=DClrkrCIeCYdCMgWyQV8pzmdle8%3D" width="100%" loading="lazy"/>
<h3 data-id="heading-0">检查浏览器是否支持Fullscreen API</h3>
<p>在尝试使用Fullscreen API之前，最好先检查浏览器是否支持它。虽然现代浏览器普遍支持，但检查总是好的做法。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">if</span> (<span class="hljs-variable language_">document</span>.<span class="hljs-property">fullscreenEnabled</span> ||
    <span class="hljs-variable language_">document</span>.<span class="hljs-property">mozFullScreenEnabled</span> ||
    <span class="hljs-variable language_">document</span>.<span class="hljs-property">webkitFullscreenEnabled</span> ||
    <span class="hljs-variable language_">document</span>.<span class="hljs-property">msFullscreenEnabled</span>) {
    <span class="hljs-comment">// 支持全屏</span>
} <span class="hljs-keyword">else</span> {
    <span class="hljs-comment">// 不支持全屏</span>
}
</code></pre>
<h3 data-id="heading-1">全屏模式</h3>
<p>获取<code>Element</code>节点，然后使用<code>requestFullscreen</code>方法，可以使得这个节点全屏，全屏模式的具体实现可能因浏览器而异，所以要做不同浏览器处理。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> <span class="hljs-title function_">openFullScreen</span> = (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-keyword">const</span> full = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'fullscreen'</span>)
  <span class="hljs-keyword">if</span> (full.<span class="hljs-property">RequestFullScreen</span>) {
    full.<span class="hljs-title class_">RequestFullScreen</span>()
  } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (full.<span class="hljs-property">mozRequestFullScreen</span>) {
    full.<span class="hljs-title function_">mozRequestFullScreen</span>()
  } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (full.<span class="hljs-property">webkitRequestFullScreen</span>) {
    full.<span class="hljs-title function_">webkitRequestFullScreen</span>()
  } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (full.<span class="hljs-property">msRequestFullscreen</span>) {
    full.<span class="hljs-title function_">msRequestFullscreen</span>()
  }
}
</code></pre>
<h3 data-id="heading-2">退出全屏模式</h3>
<p>退出全屏模式可以通过调用<code>document.exitFullscreen()</code>方法实现。这个方法会尝试让当前处于全屏模式的元素退出全屏。用户手动按下<code>ESC</code>键，也可以退出全屏键。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> <span class="hljs-title function_">exitFullScreen</span> = (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">document</span>.<span class="hljs-property">exitFullScreen</span>) {
    <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">exitFullScreen</span>();
  } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">document</span>.<span class="hljs-property">mozCancelFullScreen</span>) {
    <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">mozCancelFullScreen</span>();
  } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">document</span>.<span class="hljs-property">webkitExitFullscreen</span>) {
    <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">webkitExitFullscreen</span>();
  } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">document</span>.<span class="hljs-property">msExitFullscreen</span>) {
    <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">msExitFullscreen</span>();
  }
}
</code></pre>
<h3 data-id="heading-3">获取全屏元素</h3>
<p><code>document.fullscreenElement</code>属性返回正处于全屏状态的<code>Element</code>节点，如果当前没有节点处于全屏状态，则返回null。可以通过此方法判断是否在全屏状态。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> fullscreenElement =
  <span class="hljs-variable language_">document</span>.<span class="hljs-property">fullscreenElement</span> ||
  <span class="hljs-variable language_">document</span>.<span class="hljs-property">mozFullScreenElement</span> ||
  <span class="hljs-variable language_">document</span>.<span class="hljs-property">webkitFullscreenElement</span>;
</code></pre>
<h3 data-id="heading-4">注意事项</h3>
<p>💥 想要全屏的元素都应该在这个<code>Element</code>节点下面，否则的话全屏时不会展示。如下图的html结构，点击<code>单开弹框</code>依然无法在全屏模式下看到弹窗，推出全屏时会看到弹窗已经出现。如果想避免这种莫名的问题，可以把<code>document.getElementById('fullscreen')</code> 改成<code>document.documentElement</code>，让整个<code>HTML</code>全屏。</p>
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b5007e702877469ab97c9bcdcfaf8668~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP5piO6K6w6LSm57C_X-W-ruS_oeWwj-eoi-W6jw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766035469&amp;x-signature=CVI2REEOc7%2FaBL%2Fc90h8MQK8Rmo%3D" width="100%" loading="lazy"/>
<p>💥 <code>requestFullscreen</code>方法只能是用户主动触发才可以，如果想在页面加载时通过<code>js</code>调用方法或者是触发<code>click</code>事件触发，我劝你还是放弃吧，在控制台出现如下警告：</p>
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ffcddf2389044911bcec8f75271fa9b3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP5piO6K6w6LSm57C_X-W-ruS_oeWwj-eoi-W6jw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766035469&amp;x-signature=YIky1bWwRIJr34FDjeQW%2BpSYyEs%3D" width="100%" loading="lazy"/>
<p>💥 刷新页面也会自动退出全屏模式；</p>
<p>💥 如果想改变全屏状态时的样式，首先可以在全屏时添加一个<code>calss</code>，此外也可以使用<code>:full-screen</code>伪类，大部分浏览器都支持，检查全屏时元素，也是有使用<code>:full-screen</code>伪类的。</p>
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2ebd1b2242fe4170b0595ce06b12fe7b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP5piO6K6w6LSm57C_X-W-ruS_oeWwj-eoi-W6jw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766035469&amp;x-signature=Ga5Ej%2Fqi1iBjqFD2U7C1DG%2FVhiI%3D" width="100%" loading="lazy"/></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[秒懂 Headless：为什么现在的软件都要“去头”？]]></title>    <link>https://juejin.cn/post/7582118218649288730</link>    <guid>https://juejin.cn/post/7582118218649288730</guid>    <pubDate>2025-12-11T05:39:51.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7582118218649288730" data-draft-id="7582156410319536138" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="秒懂 Headless：为什么现在的软件都要“去头”？"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2025-12-11T05:39:51.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="皮蛋小精灵"/> <meta itemprop="url" content="https://juejin.cn/user/219558056559278"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            秒懂 Headless：为什么现在的软件都要“去头”？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/219558056559278/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    皮蛋小精灵
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-11T05:39:51.000Z" title="Thu Dec 11 2025 05:39:51 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-11
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>简单来说， <strong>“Headless”（无头）</strong> 在软件开发中指的是：<strong>只有逻辑（后端/内核），没有预设界面（前端/GUI）</strong> 的软件架构模式。</p>
<p>这里的“Head（头）”比喻的是<strong>用户界面（UI/GUI）</strong> ，“Body（身体）”比喻的是<strong>核心业务逻辑或引擎</strong>。</p>
<p><strong>Headless = 砍掉自带的 UI，只给你提供 API 或核心逻辑，让你自己去画界面。</strong></p>
<hr/>
<h3 data-id="heading-0">1. 核心概念图解</h3>
<p>想象一下 <strong>“传统的软件”</strong>（比如 Word）：它像一家<strong>堂食餐厅</strong>。你有厨房（逻辑），也有固定的桌椅板凳和装修风格（UI）。你必须在它提供的环境里吃饭，无法改变装修。</p>
<p>而 <strong>“Headless 软件”</strong>：它像一个<strong>中央厨房（外卖工厂）</strong>。它只负责做饭（逻辑），不提供桌椅（UI）。</p>
<ul>
<li>你想把菜送到五星级酒店摆盘（Web 端高级定制 UI）？可以。</li>
<li>你想把菜送到路边摊（手机 App）？可以。</li>
<li>你想把菜送到自动售货机（小程序）？也可以。</li>
</ul>
<hr/>
<h3 data-id="heading-1">2. 具体例子</h3>
<h4 data-id="heading-2">A. 无头浏览器 (Headless Browser)</h4>
<ul>
<li>
<p><strong>传统的浏览器（如 Chrome）：</strong> 你打开它，能看到窗口、地址栏、渲染出来的网页，你能用鼠标点击。</p>
</li>
<li>
<p><strong>无头浏览器（如 Puppeteer, Playwright）：</strong></p>
<ul>
<li>
<p><strong>定义：</strong> 它是浏览器内核（Chrome/Webkit），但<strong>没有可视化的窗口</strong>。它在后台（命令行/服务器）运行。</p>
</li>
<li>
<p><strong>怎么用？</strong> 你写代码控制它：“打开百度 -&gt; 输入关键词 -&gt; 截图”。</p>
</li>
<li>
<p><strong>有什么用？</strong></p>
<ol>
<li><strong>自动化测试：</strong> 模拟用户点击，快速跑通几千个测试用例，不需要真的弹出一千个窗口。</li>
<li><strong>爬虫：</strong> 爬取那些需要 JS 渲染的复杂网页。</li>
<li><strong>生成截图/PDF：</strong> 在服务器端把网页渲染成图片或 PDF 报告。</li>
</ol>
</li>
</ul>
</li>
</ul>
<h4 data-id="heading-3">B. 无头编辑器 (Headless Editor)</h4>
<ul>
<li>
<p><strong>传统的编辑器（如 CKEditor 旧版, Quill）：</strong></p>
<ul>
<li>你引入它，它就自带一套“加粗、斜体、插入图片”的工具栏，自带一套 CSS 样式。</li>
<li><strong>缺点：</strong> 如果设计师说“把工具栏按钮变成圆形的，而且要悬浮在文字上方”，你就要疯狂覆盖它的默认 CSS，非常痛苦。</li>
</ul>
</li>
<li>
<p><strong>无头编辑器（如 Tiptap, Plate, Slate.js）：</strong></p>
<ul>
<li><strong>定义：</strong> 它只提供<strong>文字处理的核心逻辑</strong>（比如：选中文本、按下 Ctrl+B 变粗体、撤销重做逻辑）。它<strong>不提供任何 UI</strong>（没有工具栏，没有按钮）。</li>
<li><strong>怎么用？</strong> 你需要自己写一个 <code>&lt;button&gt;</code>，自己写样式，然后调用它的 API <code>editor.toggleBold()</code>。</li>
<li><strong>有什么用？</strong> 你可以完全自由地定制编辑器的长相。比如 Notion、飞书文档那种高度定制的 UI，必须用无头编辑器开发。</li>
</ul>
</li>
</ul>
<hr/>
<h3 data-id="heading-4">3. 还有哪些常见的 Headless？</h3>
<p>除了浏览器和编辑器，现在的开发趋势中还有：</p>
<h4 data-id="heading-5">C. 无头组件库 (Headless UI)</h4>
<ul>
<li><strong>例子：</strong> Radix UI, Headless UI, React Aria。</li>
<li><strong>解释：</strong> 以前我们用 Ant Design 或 Bootstrap，按钮长什么样是库定好的。Headless UI 库只提供<strong>交互逻辑</strong>（比如下拉菜单怎么打开，键盘怎么选，无障碍怎么读），<strong>不提供任何 CSS</strong>。</li>
<li><strong>好处：</strong> 完美配合 Tailwind CSS，长相由你完全控制。</li>
</ul>
<h4 data-id="heading-6">D. 无头 CMS (Headless CMS)</h4>
<ul>
<li><strong>例子：</strong> Strapi, Contentful。</li>
<li><strong>解释：</strong> 以前用 WordPress，后台管理内容，前台页面也是 WordPress 生成的（耦合）。Headless CMS 只提供<strong>后台管理</strong>和 <strong>API</strong>。</li>
<li><strong>好处：</strong> 你的一份内容（API）可以同时发给 网站、App、智能手表、甚至冰箱屏幕。</li>
</ul>
<hr/>
<h3 data-id="heading-7">总结：为什么现在流行 Headless？</h3>
<p>虽然 Headless 意味着开发者要写更多的代码（因为要自己画 UI），但它解决了现代开发最大的痛点：<strong>定制化</strong>。</p>






























<table><thead><tr><th><strong>维度</strong></th><th><strong>传统 (Coupled)</strong></th><th><strong>Headless (无头)</strong></th></tr></thead><tbody><tr><td><strong>上手难度</strong></td><td><strong>低</strong> (开箱即用)</td><td><strong>高</strong> (需要自己写 UI)</td></tr><tr><td><strong>自由度</strong></td><td><strong>低</strong> (改样式很难)</td><td><strong>极高</strong> (随心所欲)</td></tr><tr><td><strong>适用场景</strong></td><td>快速做个标准后台</td><td>像 Notion/Figma 这种需要极致体验的产品</td></tr><tr><td><strong>比喻</strong></td><td><strong>方便面</strong> (有面有调料包，味道固定)</td><td><strong>生鲜面条</strong> (只有面，想做炸酱面还是汤面随你)</td></tr></tbody></table>
<p><strong>一句话总结：Headless 就是把“业务逻辑”和“界面表现”彻底分家，让你拥有无限的 UI 定制权。</strong></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Linux读写苹果APFS系统文件]]></title>    <link>https://juejin.cn/post/7582110969201213478</link>    <guid>https://juejin.cn/post/7582110969201213478</guid>    <pubDate>2025-12-11T05:19:39.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7582110969201213478" data-draft-id="7582149417768648754" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Linux读写苹果APFS系统文件"/> <meta itemprop="keywords" content="操作系统"/> <meta itemprop="datePublished" content="2025-12-11T05:19:39.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="空x格"/> <meta itemprop="url" content="https://juejin.cn/user/8451823512701"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Linux读写苹果APFS系统文件
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/8451823512701/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    空x格
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-11T05:19:39.000Z" title="Thu Dec 11 2025 05:19:39 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-11
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">背景</h2>
<p>我是一个黑苹果折腾人员，目前使用的黑苹果机器配置如下图所示的这样，因为经常开会或者外出，而WiFi又是镁光的无线网卡走到那里都不方便连接网络。所以在这个电脑上安装了深度系统。</p>
<p>现在需要在深度系统上读写我的Mac文件，我使用 <code>apt list | grep apfs</code>找了一下没有发现相关的软件可以支持，就在github上找到了这个<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Flinux-apfs%2Flinux-apfs-rw.git" target="_blank" title="https://github.com/linux-apfs/linux-apfs-rw.git" ref="nofollow noopener noreferrer">APFS-RW项目</a>。
<img src="https://storage.deepin.org/thread/202512040433297675_image.png" alt="image.png" loading="lazy"/></p>
<p>当我在安装的时候发现，深度系统强制开启了内核模块签名功能，现在附上这个安装方法，希望官方能够添加到这个系统里面。</p>
<ul>
<li>先安装git用来克隆源码</li>
</ul>
<pre><code class="hljs">sudo apt install -y git
</code></pre>
<ul>
<li>确定好源码最新版本，比如现在的是0.3.17，然后克隆它</li>
</ul>
<pre><code class="hljs language-bash" lang="bash">git <span class="hljs-built_in">clone</span> https://github.com/linux-apfs/linux-apfs-rw.git /usr/src/apfs-0.3.17
</code></pre>
<ul>
<li>开始编译安装</li>
</ul>
<pre><code class="hljs language-bash" lang="bash">root@xxxx-PC:/usr/src<span class="hljs-comment"># dkms build -m apfs -v 0.3.17</span>

Sign <span class="hljs-built_in">command</span>: /lib/modules/6.12.43-amd64-desktop-rolling/build/scripts/sign-file
Signing key: /var/lib/dkms/mok.key
Public certificate (MOK): /var/lib/dkms/mok.pub
Creating symlink /var/lib/dkms/apfs/0.3.17/source -&gt; /usr/src/apfs-0.3.17

Running the pre_build script:

Cleaning build area... <span class="hljs-keyword">done</span>.
Building module(s)........ <span class="hljs-keyword">done</span>.
Signing module /var/lib/dkms/apfs/0.3.17/build/apfs.ko
Cleaning build area... <span class="hljs-keyword">done</span>.
</code></pre>
<ul>
<li>执行安装</li>
</ul>
<pre><code class="hljs language-ruby" lang="ruby">root<span class="hljs-variable">@xxxx</span>-<span class="hljs-variable constant_">PC</span><span class="hljs-symbol">:/usr/src/apfs-</span><span class="hljs-number">0.3</span>.<span class="hljs-number">17</span><span class="hljs-comment"># dkms install -m apfs -v 0.3.17</span>

<span class="hljs-title class_">An</span> original <span class="hljs-keyword">module</span> was already stored during a previous install
<span class="hljs-title class_">Installing</span> /lib/modules/<span class="hljs-number">6.12</span>.<span class="hljs-number">43</span>-amd64-desktop-rolling/extra/apfs.ko
<span class="hljs-title class_">Running</span> depmod.... done.
</code></pre>
<ul>
<li>添加开机加载模块</li>
</ul>
<pre><code class="hljs language-ruby" lang="ruby">root<span class="hljs-variable">@xxxx</span>-<span class="hljs-variable constant_">PC</span><span class="hljs-symbol">:/usr/src/apfs-</span><span class="hljs-number">0.3</span>.<span class="hljs-number">17</span><span class="hljs-comment"># cat /etc/modules-load.d/apfs.conf </span>
apfs
</code></pre>
<ul>
<li>设置文件系统开机挂载</li>
</ul>
<pre><code class="hljs language-bash" lang="bash">sudo apfs-label  /dev/nvme0n1p2 <span class="hljs-comment">#找到APFS磁盘分区设备，找到Data的分区号</span>
0       MacOS
1       Preboot
2       Recovery
3       VM
4       MacOS - Data
5       Update

<span class="hljs-comment">#创建挂载目录</span>
<span class="hljs-built_in">mkdir</span> /media/apfs

<span class="hljs-comment">#这里的uid、git是你的用户标识，如果不添加默认是0,0。普通用户不能读写</span>
<span class="hljs-built_in">cat</span> &lt;&lt;<span class="hljs-string">"EOF"</span> &gt;&gt; /etc/fstab 
<span class="hljs-comment"># For MacOS Data</span>
/dev/nvme0n1p2  /media/apfs     apfs cknodes,uid=1000,vol=4,gid=1000,readwrite 0 0
EOF
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[被 4.3 拒绝的那些上架，从机制误判到工程治理的完整分析]]></title>    <link>https://juejin.cn/post/7582152511538266153</link>    <guid>https://juejin.cn/post/7582152511538266153</guid>    <pubDate>2025-12-11T05:47:24.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7582152511538266153" data-draft-id="7582163781183733766" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="被 4.3 拒绝的那些上架，从机制误判到工程治理的完整分析"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2025-12-11T05:47:24.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="bcbnb"/> <meta itemprop="url" content="https://juejin.cn/user/895474073078377"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            被 4.3 拒绝的那些上架，从机制误判到工程治理的完整分析
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/895474073078377/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    bcbnb
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-11T05:47:24.000Z" title="Thu Dec 11 2025 05:47:24 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-11
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>苹果审核条款 4.3（“重复应用 / 重复内容 / 模板化应用”）几乎是开发者最担心收到的拒绝理由之一。与技术错误不同，4.3 的判断带有策略性，苹果主要审查应用是否存在大量相似内容、使用重复模板、或明显属于批量生成的 APP。许多团队在跨端框架、内部产品多版本共存、或同一业务线多应用分发时，极易触发误判。</p>
<p>相比一般审核问题，4.3 的挑战在于：
– <strong>它不直接告诉你错在哪里；</strong>
– <strong>这是结构性问题，不是单次构建错误；</strong>
– <strong>即便版本更新，也可能持续被拒；</strong>
– <strong>某些情况下需要从 Bundle ID 到构建内容全面排查。</strong></p>
<p>本文基于实际工程经验，从审核机制、结构性触发原因、技术环节的自检方式三方面拆解 4.3，同时讨论如何借助适当的工具在提交前减少触发概率，并构建一个更透明的上架检查流程。</p>
<hr/>
<h2 data-id="heading-0"><strong>一、4.3 的本质：苹果在管理“系统风险”，不是单个应用</strong></h2>
<p>许多开发者把 4.3 视为“内容审查问题”，但它背后的逻辑其实非常工程化：</p>
<h3 data-id="heading-1"><strong>苹果希望避免：</strong></h3>
<ol>
<li>大量相似应用进入 App Store</li>
<li>企业用模板系统批量提交应用</li>
<li>用马甲包绕过审核策略</li>
<li>内容、功能、界面极其接近的应用充斥市场</li>
</ol>
<p>因此，4.3 的判断会综合多个维度：</p>
<ul>
<li>Bundle ID 历史行为</li>
<li>账号下过往应用的模式</li>
<li>UI 模板重复度</li>
<li>IPA 内资源结构</li>
<li>上架信息的相似性</li>
<li>提交频率与后台行为</li>
</ul>
<p>也就是说，4.3 拒绝通常不是随机，而是系统模型检测出的 <strong>“相似度超标”</strong>。</p>
<hr/>
<h2 data-id="heading-2"><strong>二、哪些工程结构最容易触发 4.3？</strong></h2>
<p>以下几类情况是我在多个项目中观察到的高危项：</p>
<h3 data-id="heading-3"><strong>1. 多个应用使用同一套 H5/uni-app 模板，仅内容替换</strong></h3>
<p>苹果容易认为属于批量生成。</p>
<h3 data-id="heading-4"><strong>2. 同一账号下存在大量相似界面、相同导航结构</strong></h3>
<p>尤其是工具类、展示类、资讯类。</p>
<h3 data-id="heading-5"><strong>3. Bundle ID 与 Profile 映射关系异常</strong></h3>
<p>例如同一个 profile 绑定多个应用，系统会推测存在批量行为。</p>
<h3 data-id="heading-6"><strong>4. IPA 内资源目录高度一致</strong></h3>
<p>如图片命名方式、打包结构完全一致。</p>
<h3 data-id="heading-7"><strong>5. 上架截图、关键词、描述重复度高</strong></h3>
<p>尤其是短期内连续提交。</p>
<p>这些都是 4.3 的“结构触发点”，而非前端开发可见的问题。</p>
<hr/>
<h2 data-id="heading-8"><strong>三、技术侧能做什么？——从 IPA 到元数据做自检</strong></h2>
<p>工程团队并不能完全避免 4.3，但可以通过工具和流程减少触发概率。</p>
<h3 data-id="heading-9"><strong>1. 检查 IPA 内部资源结构</strong></h3>
<p>通常我会在提交前使用工具查看 IPA 内部：</p>
<ul>
<li>Info.plist</li>
<li>资源目录结构</li>
<li>嵌入的 mobileprovision</li>
<li>Framework 特征</li>
</ul>
<p>例如通过 <strong>Appuploader 的 IPA 内容查看功能</strong> 查看 plist 和资源结构，帮助确认是否存在过多重复内容或错误绑定的 profile。</p>
<h3 data-id="heading-10"><strong>2. 检查 Bundle ID 使用情况</strong></h3>
<p>使用 Appuploader 的 <strong>Bundle ID 管理功能</strong> 可以快速查看：</p>
<ul>
<li>账号内哪些 Bundle ID 已存在</li>
<li>是否有相同前缀或明显模板化命名</li>
<li>该 Bundle ID 是否与旧应用高度相似</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1afd8fd894e64b929a4e2ad679a2e29b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgYmNibmI=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766036844&amp;x-signature=KNhvjEJFhncM4gHpBaM%2BM41q7sQ%3D" alt="bid" loading="lazy"/></p>
<p>Bundle ID 体系混乱是常见触发因素。</p>
<h3 data-id="heading-11"><strong>3. 检查描述文件与证书关系</strong></h3>
<p>mobileprovision 内的信息可用于判断：</p>
<ul>
<li>是否绑定了正确证书</li>
<li>Team ID 是否使用一致</li>
<li>是否使用已废弃 profile</li>
</ul>
<p>这些信息同样可通过 Appuploader 解析 mobileprovision 得到。
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/de7813dd61344bba8e9522b188040f7d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgYmNibmI=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766036844&amp;x-signature=LTQk1yl4Nfa3OqhCXtnSWP%2FUUuo%3D" alt="查看" loading="lazy"/></p>
<h3 data-id="heading-12"><strong>4. 上传方式保持一致性与可追踪性</strong></h3>
<p>使用 <strong>Appuploader CLI 上传 IPA</strong>（跨平台）可以让团队在流程中统一处理上传行为，避免：</p>
<ul>
<li>不同成员上传不一致 IPA</li>
<li>多台机器生成多个“几乎相同”的产物</li>
<li>多次重复提交导致系统误判批量行为</li>
</ul>
<p>统一的上传链路能让提交数据更可控。
图形化界面：
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9f09eb9f5cce4e8fb8534877636df66c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgYmNibmI=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766036844&amp;x-signature=lCwj1fCbsT8HhxiauErhanHQLHU%3D" alt="ipa上传" loading="lazy"/></p>
<hr/>
<h2 data-id="heading-13"><strong>四、如何从工程治理角度降低 4.3 风险？</strong></h2>
<p>以下是我在项目中验证有效的策略，不涉及内容层面的建议，而关注工程侧可控的部分：</p>
<hr/>
<h3 data-id="heading-14"><strong>策略 1：避免模板工程直接复制，多项目使用差异化配置</strong></h3>
<p>包括：</p>
<ul>
<li>不同 Scheme</li>
<li>不同资源命名</li>
<li>不同页面结构</li>
<li>不同启动页</li>
<li>不同 WebView 配置</li>
</ul>
<p>系统模型主要看结构相似度，这部分越明显越容易触发 4.3。</p>
<hr/>
<h3 data-id="heading-15"><strong>策略 2：Bundle ID 管理规范化</strong></h3>
<p>要求：</p>
<ul>
<li>避免连续生成密集、相似的 Bundle ID</li>
<li>统一记录 Bundle ID 与业务关系</li>
<li>使用工具统一检查（如 Appuploader 的列表查看）</li>
</ul>
<p>Bundle ID 是系统判断“是否为同类模板”的入口，结构越清晰越不易误判。</p>
<hr/>
<h3 data-id="heading-16"><strong>策略 3：构建前检查 IPA 是否包含旧资源</strong></h3>
<p>许多 4.3 来自混入旧工程资源，包括：</p>
<ul>
<li>未更新的 icon</li>
<li>旧的引导页</li>
<li>不相关的 H5 资源</li>
</ul>
<p>我会通过 IPA 内容检查确认资源是否与工程一致。</p>
<hr/>
<h3 data-id="heading-17"><strong>策略 4：上传流程集中控制，避免短期多次提交</strong></h3>
<p>如果多个成员在不同平台提交多个版本，系统可能判定为批量应用。</p>
<p>统一使用 Appuploader CLI 上传的好处是：</p>
<ul>
<li>上传链路一致</li>
<li>日志可追踪</li>
<li>上传动作可脚本化</li>
<li>避免“重复上传 IPA 造成高频提交”现象</li>
</ul>
<p>这对减少 4.3 的系统误判非常关键。</p>
<hr/>
<h3 data-id="heading-18"><strong>策略 5：避免多个应用共享同一内部签名链路</strong></h3>
<p>如果 mobileprovision 或证书绑定多个应用，系统可能认为属于批量生成。</p>
<p>在提交前解析 mobileprovision（Appuploader 可查看）可以确认是否存在绑定混乱现象。</p>
<hr/>
<h2 data-id="heading-19"><strong>五、当应用被 4.3 拒绝后，工程侧可以做什么？</strong></h2>
<p>尽管最终解释权在苹果，但以下工程策略能提高重新提交成功率：</p>
<ol>
<li><strong>重新构建 IPA</strong>，确认资源、plist、描述文件均正确</li>
<li><strong>更换 Bundle ID（在允许范围内）</strong></li>
<li><strong>对资源结构做差异化调整</strong></li>
<li><strong>重新生成描述文件，使绑定关系更清晰</strong></li>
<li><strong>确保上传动作统一执行（避免多份构建提交）</strong></li>
</ol>
<p>工程团队所能做的，是从结构上降低模型的相似度评估。</p>
<hr/>
<h2 data-id="heading-20"><strong>4.3 不是技术问题，但技术可减少被误判的概率</strong></h2>
<p>条款 4.3 的核心在于 “结构性重复”。
许多团队并没有做错任何功能，却因资源结构、Bundle ID 体系、提交行为模式等工程因素触发审核。</p>
<p>而通过工具辅助，团队可以让整个流程更加透明、可控，也能在提交前发现潜在的结构性风险。</p>
<p>最终目标不是对抗审核，而是建立一个干净、可追踪、差异化明显的工程体系，避免被 4.3 系统模型误伤。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[构建现代化 iOS 调试体系，从代码行为到系统级诊断的多工具协同方法论]]></title>    <link>https://juejin.cn/post/7582155513586171956</link>    <guid>https://juejin.cn/post/7582155513586171956</guid>    <pubDate>2025-12-11T05:55:35.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7582155513586171956" data-draft-id="7582131164728950824" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="构建现代化 iOS 调试体系，从代码行为到系统级诊断的多工具协同方法论"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2025-12-11T05:55:35.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="疯狂的程序猴"/> <meta itemprop="url" content="https://juejin.cn/user/2760245749234147"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            构建现代化 iOS 调试体系，从代码行为到系统级诊断的多工具协同方法论
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2760245749234147/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    疯狂的程序猴
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-11T05:55:35.000Z" title="Thu Dec 11 2025 05:55:35 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-11
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>在 iOS 开发的整个工程链路中，<strong>调试（Debugging）</strong> 是最体现开发者功力的部分。随着 App 体量变大、跨端框架增多（Flutter、uni-app、RN、Hybrid）、系统限制不断强化，调试已经不再是“看日志 + 打断点”能解决的问题。</p>
<p>实际调试过程中，开发者需要处理的问题往往跨越多个维度：</p>
<ul>
<li>代码逻辑错误（传统 Bug）</li>
<li>UI 渲染异常</li>
<li>内存泄漏 / 内存增长</li>
<li>CPU 峰值导致卡顿</li>
<li>WebView 行为不确定</li>
<li>线程切换与锁竞争</li>
<li>网络链路异常</li>
<li>系统行为导致的终止（watchdog / jetsam）</li>
<li>固件、权限、沙盒限制行为</li>
</ul>
<p>要解决这些问题，必须将 <strong>“代码层调试 + 性能调试 + 系统行为调试 + 真机调试”</strong> 统一起来，这也是现代 iOS 调试体系的核心。</p>
<p>本文基于真实工程经验，将 <strong>LLDB、Xcode、Instruments、PerfDog、克魔（KeyMob）、Charles、Safari Inspector、DeviceConsole、MetricKit、Crashlytics</strong> 整合成一套完整的可落地的 iOS 调试方法论。</p>
<hr/>
<h2 data-id="heading-0">一、调试体系为何必须“多工具协同”？</h2>
<p>因为 iOS 的问题源头本身就分布于多个层级：</p>
<h3 data-id="heading-1"><strong>1. 代码层问题（逻辑错误）</strong></h3>
<ul>
<li>变量状态不符合预期</li>
<li>分支漏判</li>
<li>Delegate 未回调</li>
<li>异常被吞掉</li>
</ul>
<h3 data-id="heading-2"><strong>2. 线程与锁问题</strong></h3>
<ul>
<li>死锁</li>
<li>主线程阻塞</li>
<li>竞争条件（race condition）</li>
</ul>
<h3 data-id="heading-3"><strong>3. 性能相关问题</strong></h3>
<ul>
<li>CPU 阻塞</li>
<li>GPU 渲染超时</li>
<li>内存泄漏</li>
<li>WebView 占用膨胀</li>
</ul>
<h3 data-id="heading-4"><strong>4. 系统行为</strong></h3>
<ul>
<li>内存压力下被系统强制杀死（jetsam）</li>
<li>主线程长时间阻塞（watchdog）</li>
<li>WebKit 崩溃</li>
</ul>
<h3 data-id="heading-5"><strong>5. 网络问题</strong></h3>
<ul>
<li>超时</li>
<li>重试</li>
<li>大资源解析压力</li>
</ul>
<p>单一工具很难定位深层问题，因此调试必须体系化。</p>
<hr/>
<h2 data-id="heading-6">二、Xcode：调试的核心入口（断点 + 内存图 + 线程可视化）</h2>
<h3 data-id="heading-7"><strong>1. LLDB（逻辑调试核心）</strong></h3>
<p>可用于：</p>
<ul>
<li>打断点与条件断点</li>
<li>观察变量</li>
<li>修改运行时数据</li>
<li>动态注入代码验证行为</li>
</ul>
<h3 data-id="heading-8"><strong>2. Memory Graph Debugger（对象生命周期）</strong></h3>
<p>能快速发现：</p>
<ul>
<li>控制器未释放</li>
<li>Block 捕获对象</li>
<li>强引用循环</li>
</ul>
<p>这是定位“退出页面内存不下降”的利器。</p>
<h3 data-id="heading-9"><strong>3. Thread Debugger（线程调试）</strong></h3>
<p>可看到：</p>
<ul>
<li>主线程调用栈</li>
<li>是否出现死锁</li>
<li>线程数量是否过高</li>
</ul>
<p>常用于定位“卡顿原因”。</p>
<hr/>
<h2 data-id="heading-10">三、Instruments：深度调试复杂问题的底层工具</h2>
<p>Instruments 是 iOS 调试体系中的“显微镜”，适合定位底层行为。</p>
<h3 data-id="heading-11"><strong>1. Time Profiler（CPU 问题）</strong></h3>
<p>可定位：</p>
<ul>
<li>主线程阻塞</li>
<li>大量计算</li>
<li>布局耗时</li>
<li>图片解码</li>
</ul>
<p>适用于“卡顿”、“加载慢”等问题。</p>
<h3 data-id="heading-12"><strong>2. Allocations / Leaks（内存问题）</strong></h3>
<p>能发现：</p>
<ul>
<li>内存泄漏</li>
<li>对象增长趋势</li>
<li>图片大量创建</li>
<li>WebView 占用增加</li>
</ul>
<p>内存问题是调试中最难的部分之一。</p>
<h3 data-id="heading-13"><strong>3. Core Animation（渲染问题）</strong></h3>
<p>用于调试：</p>
<ul>
<li>离屏渲染</li>
<li>GPU 压力</li>
<li>层级过多</li>
<li>动画不流畅</li>
</ul>
<p>适合 UI 调试。</p>
<hr/>
<h2 data-id="heading-14">四、PerfDog：真机场景中的流畅度与压力调试</h2>
<p>PerfDog 在调试复杂 UI 时非常高效：</p>
<h3 data-id="heading-15">能抓取：</h3>
<ul>
<li>FPS 曲线</li>
<li>CPU/GPU 峰值</li>
<li>长时间运行性能变化</li>
<li>温度上升情况</li>
</ul>
<p>适用于调试：</p>
<ul>
<li>列表滑动卡顿</li>
<li>动画掉帧</li>
<li>视频播放压力</li>
<li>高交互页面性能</li>
</ul>
<p>真机调试阶段非常依赖 PerfDog 的趋势数据。</p>
<hr/>
<h2 data-id="heading-16">五、克魔（KeyMob）：调试系统行为问题的关键工具</h2>
<p>KeyMob 的价值在于提供“真实环境下的可观测性”，尤其是那些 Xcode 无法捕获的系统行为。</p>
<h3 data-id="heading-17"><strong>1. 真机日志（比 Xcode Console 更稳定）</strong></h3>
<p>可导出：</p>
<ul>
<li>应用日志</li>
<li>系统日志</li>
<li>关键字过滤</li>
<li>多进程日志</li>
</ul>
<p>适合定位偶发问题。</p>
<h3 data-id="heading-18"><strong>2. 系统行为日志（调试最需要的部分）</strong></h3>
<p>例如：</p>
<pre><code class="hljs language-vbnet" lang="vbnet"><span class="hljs-symbol">jetsam_event:</span> memory pressure high
<span class="hljs-symbol">watchdog:</span> main thread <span class="hljs-built_in">is</span> unresponsive
<span class="hljs-symbol">thermal:</span> device overheating
WebKit process terminated
sandbox deny: permission violation
</code></pre>
<p>这些日志常常是问题根因。</p>
<h3 data-id="heading-19"><strong>3. 配合性能监控进行调试</strong></h3>
<p>例如：</p>
<ul>
<li>CPU 峰值上升 → 系统日志出现 thermal 警告</li>
<li>内存上涨 → jetsam 日志出现</li>
<li>UI 卡顿 → 主线程阻塞日志出现</li>
</ul>
<p>这让调试变得“可观察、可推断”。</p>
<hr/>
<h2 data-id="heading-20">六、Charles：调试网络链路相关问题</h2>
<p>许多看似“UI Bug”，实际上是网络行为造成的。</p>
<h3 data-id="heading-21">可调试：</h3>
<ul>
<li>超时请求</li>
<li>重试行为</li>
<li>队列阻塞</li>
<li>大 JSON 解析时间</li>
<li>图片资源过大</li>
</ul>
<p>适用于：</p>
<ul>
<li>首屏加载慢</li>
<li>列表闪烁</li>
<li>弱网表现差</li>
</ul>
<p>网络是调试中最容易被忽略的层面。</p>
<hr/>
<h2 data-id="heading-22">七、Safari Inspector：调试 Hybrid / WebView 行为</h2>
<p>当问题出在 H5 页面或 uni-app 页面时，Safari Inspector 是核心工具。</p>
<h3 data-id="heading-23">可调试：</h3>
<ul>
<li>JS 长任务</li>
<li>DOM 更新频率</li>
<li>资源加载</li>
<li>WebKit 报错</li>
<li>JSBridge 交互</li>
</ul>
<p>常见问题：</p>
<ul>
<li>页面白屏</li>
<li>Hybrid 卡顿</li>
<li>WebView 崩溃</li>
<li>加载慢</li>
</ul>
<p>Safari Inspector 是 Web 调试的“唯一入口”。</p>
<hr/>
<h2 data-id="heading-24">八、MetricKit + Crashlytics：调试复杂线上问题的最后一环</h2>
<h3 data-id="heading-25"><strong>MetricKit 提供系统层调试信息：</strong></h3>
<ul>
<li>CPU 峰值</li>
<li>内存峰值</li>
<li>卡顿事件（hang diagnostics）</li>
<li>崩溃类型</li>
<li>WebKit 崩溃</li>
</ul>
<h3 data-id="heading-26"><strong>Crashlytics 提供：</strong></h3>
<ul>
<li>线程堆栈</li>
<li>锁竞争</li>
<li>死锁</li>
<li>异常行为</li>
<li>非崩溃类问题趋势</li>
</ul>
<p>适合调试上线后才出现的问题。</p>
<hr/>
<h2 data-id="heading-27">九、构建完整的 iOS 调试工具矩阵</h2>













































<table><thead><tr><th>调试维度</th><th>工具组合</th><th>可解决的问题</th></tr></thead><tbody><tr><td>逻辑调试</td><td>Xcode + LLDB</td><td>变量、分支、异常</td></tr><tr><td>内存调试</td><td>Instruments + Xcode Memory Graph + KeyMob</td><td>泄漏、增长</td></tr><tr><td>卡顿调试</td><td>PerfDog + Time Profiler + Core Animation</td><td>CPU/GPU</td></tr><tr><td>WebView 调试</td><td>Safari Inspector + KeyMob</td><td>JS/DOM/WebKit</td></tr><tr><td>网络调试</td><td>Charles</td><td>超时、数据过大</td></tr><tr><td>系统级调试</td><td>KeyMob + MetricKit</td><td>jetsam、watchdog</td></tr><tr><td>上线调试</td><td>Crashlytics + MetricKit</td><td>崩溃、异常趋势</td></tr></tbody></table>
<p>这是一个完整的工程化调试体系。</p>
<hr/>
<h2 data-id="heading-28">调试不是修问题，而是构建工程能力</h2>
<p>一个成熟的 iOS 调试体系必须做到：</p>
<p><strong>可观察 → 可定位 → 可验证 → 可回归 → 可监控</strong></p>
<p>要实现这些能力，需要：</p>
<ul>
<li>Xcode（逻辑）</li>
<li>Instruments（底层）</li>
<li>KeyMob（真机 &amp; 系统行为）</li>
<li>PerfDog（流畅度）</li>
<li>Charles（网络）</li>
<li>Safari Inspector（Web）</li>
<li>MetricKit / Crashlytics（线上）</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[保姆级教程：从0手写RAG智能问答系统，接入Qwen大模型｜Python实战]]></title>    <link>https://juejin.cn/post/7582136489770631178</link>    <guid>https://juejin.cn/post/7582136489770631178</guid>    <pubDate>2025-12-11T04:07:58.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7582136489770631178" data-draft-id="7582110969201115174" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="保姆级教程：从0手写RAG智能问答系统，接入Qwen大模型｜Python实战"/> <meta itemprop="keywords" content="LLM,Agent,程序员"/> <meta itemprop="datePublished" content="2025-12-11T04:07:58.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="大模型教程"/> <meta itemprop="url" content="https://juejin.cn/user/1145012233707299"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            保姆级教程：从0手写RAG智能问答系统，接入Qwen大模型｜Python实战
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1145012233707299/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    大模型教程
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-11T04:07:58.000Z" title="Thu Dec 11 2025 04:07:58 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-11
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#383838;font-size:15px;line-height:30px;letter-spacing:2px;word-break:break-word;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Open Sans,Helvetica Neue,sans-serif;scroll-behavior:smooth;background-image:linear-gradient(0deg,transparent 24%,rgba(201,195,195,.329) 25%,hsla(0,8%,80.4%,.05) 26%,transparent 27%,transparent 74%,hsla(0,5.2%,81%,.185) 75%,rgba(180,176,176,.05) 76%,transparent 77%,transparent),linear-gradient(90deg,transparent 24%,rgba(204,196,196,.226) 25%,hsla(0,4%,66.1%,.05) 26%,transparent 27%,transparent 74%,hsla(0,5.2%,81%,.185) 75%,rgba(180,176,176,.05) 76%,transparent 77%,transparent);background-color:#fff;background-size:50px 50px;padding-bottom:60px}.markdown-body ::selection{color:#fff;background-color:#a862ea}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{margin:24px 0 12px;color:#a862ea}.markdown-body h1{line-height:2;font-size:1.4em}.markdown-body h1~p:first-of-type:first-letter{color:#a862ea;float:left;font-size:2em;margin-right:.4em;font-weight:bolder}.markdown-body h2{font-size:1.2em}.markdown-body h3{font-size:1.1em}.markdown-body ol,.markdown-body ul{padding-left:2em}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;padding-left:.2em}.markdown-body ol li::marker,.markdown-body ul li::marker{color:#a862ea}.markdown-body ol li.task-list-item,.markdown-body ul li.task-list-item{list-style:none}.markdown-body ol li.task-list-item ol,.markdown-body ol li.task-list-item ul,.markdown-body ul li.task-list-item ol,.markdown-body ul li.task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:10px}.markdown-body a,.markdown-body code,.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6,.markdown-body li,.markdown-body p{opacity:.85;vertical-align:baseline;transition:all .1s ease}.markdown-body a:hover,.markdown-body code:hover,.markdown-body h1:hover,.markdown-body h2:hover,.markdown-body h3:hover,.markdown-body h4:hover,.markdown-body h5:hover,.markdown-body h6:hover,.markdown-body li:hover,.markdown-body p:hover{opacity:1}.markdown-body a{display:inline-block;color:#a862ea;cursor:pointer;text-decoration:none;position:relative}.markdown-body a:after{content:"";position:absolute;width:98%;height:1px;bottom:0;left:0;transform:scaleX(0);background-color:#a862ea;transform-origin:bottom right;transition:transform .3s ease-in-out}.markdown-body a:hover:after{transform:scaleX(1);transform-origin:bottom left}.markdown-body a:active,.markdown-body a:link{color:#a862ea}.markdown-body img{max-width:100%;user-select:none;margin:1em 0;transition:transform .2s ease 0s;background-color:#f8f5ff;box-shadow:0 0 10px #e7daff}.markdown-body img:hover{opacity:1;box-shadow:0 0 20px #e7daff;transform:translateY(-1px)}.markdown-body blockquote{padding:.5em 1em;margin:12px 0;border-top-left-radius:2px;border-bottom-left-radius:2px;border-left:3px solid #a862ea;background-color:#f8f5ff}.markdown-body blockquote&gt;p{margin:0}.markdown-body .math{font-style:italic;margin:12px 0;padding:.5em 1em;background-color:#f8f5ff}.markdown-body .math&gt;p{margin:0}.markdown-body code{padding:2px .4em;overflow-x:auto;color:#a862ea;font-weight:700;word-break:break-word;font-family:Operator Mono,Consolas,Monaco,Menlo,monospace;background-color:#f8f5ff}.markdown-body pre{margin:2em 0}.markdown-body pre&gt;code{display:block;padding:1.5em;word-break:normal;font-size:.9em;font-style:normal;font-weight:400;font-family:Operator Mono,Consolas,Monaco,Menlo,monospace;line-height:18px;color:#383838;border-radius:2px;scroll-behavior:smooth;box-shadow:0 0 10px #e7daff}.markdown-body pre&gt;code:hover{box-shadow:0 0 20px #e7daff}.markdown-body pre&gt;code::-webkit-scrollbar{height:6px;background-color:#f8f5ff}.markdown-body pre&gt;code::-webkit-scrollbar-thumb{background-color:#e7daff;border-bottom-left-radius:3px;border-bottom-right-radius:3px}.markdown-body hr{margin:2em 0;border-top:1px solid #a862ea}.markdown-body table{width:100%;font-size:12px;max-width:100%;overflow:auto;border-collapse:collapse}.markdown-body thead{color:#a862ea;background:#f8f5ff}.markdown-body td,.markdown-body th{padding:.5em;border:1px solid #e7daff}.markdown-body tr{background-color:#f8f5ff}@media (max-width:720px){.markdown-body{font-size:12px}}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>本文较长，建议点赞收藏。更多AI大模型应用开发学习视频及资料，在<a href="https://link.juejin.cn?target=https%3A%2F%2Fgitcode.com%2FEnjoyEDU%2FLLM" target="_blank" title="https://gitcode.com/EnjoyEDU/LLM" ref="nofollow noopener noreferrer">这里</a>。</p>
</blockquote>
<p>在大模型落地的众多路径中，RAG（检索增强生成）是几乎“最值得掌握”的一项技术。它将知识库与大模型结合，让模型不仅“知道”，还能“答得准、说得清”。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2663063de4944497b614f66b2c349f8f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766030878&amp;x-signature=9ajLnQ8JNV%2F16bQEko6Eh9H0oJk%3D" alt="" loading="lazy"/></p>
<p>在前两期课程中，我们基于Dify平台完成了RAG系统的快速搭建。适合初学者理解核心概念，快速体验模型效果。但平台封装程度高，细节难以修改，也难以服务真实业务。</p>
<p>本期课程借助RAG知识库优化电商智能问答，我们不再依赖平台，转向从0编写完整系统。不只是搭出来，而是理解每一个模块，控制每一层逻辑，真正做到“能用、好用、可扩展”。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2be8b20647f7483cbfc9c7d95743cd16~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766030878&amp;x-signature=suOOdS%2FFJ%2BHFso%2F6w6lNq%2F7R6l8%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-0">系统搭建核心：</h2>
<h2 data-id="heading-1">知识库、检索与生成的协同机制</h2>
<p>RAG系统的本质，是知识库与大模型之间的高效协同。为了实现这点，我们从三个关键模块入手：知识库构建 → 精准检索 → 智能生成，层层构建。</p>
<h3 data-id="heading-2">1、知识库构建</h3>
<p>这一阶段的核心，是让文档变成结构化、可检索的知识单元。课程围绕电商业务，从产品目录、营销政策、物流规则、FAQ、售后文档中构建知识源。</p>
<ul>
<li>通过文本规范化、去除噪声、结构化处理等步骤，清洗原始文档。</li>
<li>分块策略采用滑动窗口（chunk_size+overlap）机制，同时保留语义连贯性。</li>
<li>向量化阶段采用TF-IDF构建稀疏向量，后续也支持密集向量嵌入。</li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d6630384041c412b88388702ffeec773~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766030878&amp;x-signature=fFAeTuo0QQkBR1iKwxT8o7Qcvzo%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-3">2、检索模块</h3>
<p>本课程实现了一套混合检索策略。</p>
<ul>
<li>结合稀疏（BM25）与密集（向量）检索，通过权重融合提升匹配精准度。</li>
<li>相似度计算基于余弦相似度，支持top-k返回。</li>
<li>支持从TF-IDF向量空间与向量数据库中双向检索。</li>
</ul>
<p>此外，我们预留了Milvus/FAISS等持久化数据库的扩展口，也实现了增量更新能力，方便后期迭代。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b502f6c8f5c14438983f6413dddb7dc2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766030878&amp;x-signature=5xlphrMTbVhrn1CfzLyVzV%2BcW7Q%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-4">3、生成模块</h3>
<p>本系统采用Qwen3-4B作为生成模型，使用Hugging Face Transformers加载模型，并将模型加载到GPU上以加速推理。为提高生成质量做了一下设计与优化：</p>
<ul>
<li>Prompt模板结构清晰，包含已知信息+用户提问+回答指令，确保上下文关联与指令清晰。</li>
<li>通过Top-p采样、Beam Search等参数配置，优化生成质量与风格。</li>
<li>实现异常处理机制，保障模型在边界条件下稳定运行。</li>
</ul>
<p>同时，生成内容紧密依托检索结果，杜绝模型幻觉，提高可解释性与准确度。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/19f2f3da0b324bafadc832cf7a3fc172~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766030878&amp;x-signature=WuKpx1U6zxs3o6U5juBuTe5Gn4g%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-5">从原理到实践：</h2>
<h2 data-id="heading-6">搭建一套完整电商RAG系统</h2>
<p>理论学完，开始落地。课程的第二部分是企业级RAG系统的实战搭建。我们不再用平台点击，而是手写全部代码，从数据采集到模型问答，环环相扣，逐步构建。核心能力包括：</p>
<ul>
<li>电商知识文档的采集与格式转换</li>
<li>向量化策略、分块算法的定制实现</li>
<li>混合检索模块的组装与相似度排序</li>
<li>Qwen模型接入与Prompt编排</li>
<li>模块串联，形成端到端问答能力</li>
</ul>
<p>最终，你将完成一个具备真实问答能力、可持续扩展的 AI 应用系统。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/85ad673a32d0410cb5db6c0fe1500352~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766030878&amp;x-signature=1lQCya0%2F5EEhdgsAIlxOYqtog%2Fo%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-7">为什么手写代码</h2>
<h2 data-id="heading-8">而不继续用Dify？</h2>
<p>Dify 平台能跑通流程，也能快速实现效果。但系统封闭、可控性低，不适合应对业务复杂度高、定制化要求强的真实场景。</p>
<p>相对依靠平台，本课程手写代码搭建RAG系统的方式有三大优势：</p>
<p><strong>灵活</strong>：每个模块可自由替换、优化，比如Prompt模板、检索策略、解码方式。</p>
<p><strong>透明</strong>：了解每一步发生了什么，调试容易，便于维护和优化。</p>
<p><strong>可控</strong>：能将系统部署在企业私有云或本地，数据不出域，更安全。</p>
<p>通过这门课程，你将完整掌握构建企业级RAG系统的核心方法。它不仅带你理解RAG的底层逻辑，更带你走进真正可落地的AI应用场景。适合开发者、产品经理、技术负责人等，对AI应用落地有明确需求的人群。</p>
<h2 data-id="heading-9">学习资源推荐</h2>
<p>如果你想更深入地学习大模型，以下是一些非常有价值的学习资源，这些资源将帮助你从不同角度学习大模型，提升你的实践能力。</p>
<blockquote>
<p>本文较长，建议点赞收藏。更多AI大模型应用开发学习视频及资料，在<a href="https://link.juejin.cn?target=https%3A%2F%2Fgitcode.com%2FEnjoyEDU%2FLLM" target="_blank" title="https://gitcode.com/EnjoyEDU/LLM" ref="nofollow noopener noreferrer">这里</a>。</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[AI Agent开发入门：5 个关键步骤，帮你打通落地链路]]></title>    <link>https://juejin.cn/post/7582110969201098790</link>    <guid>https://juejin.cn/post/7582110969201098790</guid>    <pubDate>2025-12-11T04:05:06.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7582110969201098790" data-draft-id="7582110969201082406" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="AI Agent开发入门：5 个关键步骤，帮你打通落地链路"/> <meta itemprop="keywords" content="Agent,LLM,程序员"/> <meta itemprop="datePublished" content="2025-12-11T04:05:06.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="大模型教程"/> <meta itemprop="url" content="https://juejin.cn/user/1145012233707299"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            AI Agent开发入门：5 个关键步骤，帮你打通落地链路
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1145012233707299/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    大模型教程
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-11T04:05:06.000Z" title="Thu Dec 11 2025 04:05:06 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-11
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#383838;font-size:15px;line-height:30px;letter-spacing:2px;word-break:break-word;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Open Sans,Helvetica Neue,sans-serif;scroll-behavior:smooth;background-image:linear-gradient(0deg,transparent 24%,rgba(201,195,195,.329) 25%,hsla(0,8%,80.4%,.05) 26%,transparent 27%,transparent 74%,hsla(0,5.2%,81%,.185) 75%,rgba(180,176,176,.05) 76%,transparent 77%,transparent),linear-gradient(90deg,transparent 24%,rgba(204,196,196,.226) 25%,hsla(0,4%,66.1%,.05) 26%,transparent 27%,transparent 74%,hsla(0,5.2%,81%,.185) 75%,rgba(180,176,176,.05) 76%,transparent 77%,transparent);background-color:#fff;background-size:50px 50px;padding-bottom:60px}.markdown-body ::selection{color:#fff;background-color:#a862ea}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{margin:24px 0 12px;color:#a862ea}.markdown-body h1{line-height:2;font-size:1.4em}.markdown-body h1~p:first-of-type:first-letter{color:#a862ea;float:left;font-size:2em;margin-right:.4em;font-weight:bolder}.markdown-body h2{font-size:1.2em}.markdown-body h3{font-size:1.1em}.markdown-body ol,.markdown-body ul{padding-left:2em}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;padding-left:.2em}.markdown-body ol li::marker,.markdown-body ul li::marker{color:#a862ea}.markdown-body ol li.task-list-item,.markdown-body ul li.task-list-item{list-style:none}.markdown-body ol li.task-list-item ol,.markdown-body ol li.task-list-item ul,.markdown-body ul li.task-list-item ol,.markdown-body ul li.task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:10px}.markdown-body a,.markdown-body code,.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6,.markdown-body li,.markdown-body p{opacity:.85;vertical-align:baseline;transition:all .1s ease}.markdown-body a:hover,.markdown-body code:hover,.markdown-body h1:hover,.markdown-body h2:hover,.markdown-body h3:hover,.markdown-body h4:hover,.markdown-body h5:hover,.markdown-body h6:hover,.markdown-body li:hover,.markdown-body p:hover{opacity:1}.markdown-body a{display:inline-block;color:#a862ea;cursor:pointer;text-decoration:none;position:relative}.markdown-body a:after{content:"";position:absolute;width:98%;height:1px;bottom:0;left:0;transform:scaleX(0);background-color:#a862ea;transform-origin:bottom right;transition:transform .3s ease-in-out}.markdown-body a:hover:after{transform:scaleX(1);transform-origin:bottom left}.markdown-body a:active,.markdown-body a:link{color:#a862ea}.markdown-body img{max-width:100%;user-select:none;margin:1em 0;transition:transform .2s ease 0s;background-color:#f8f5ff;box-shadow:0 0 10px #e7daff}.markdown-body img:hover{opacity:1;box-shadow:0 0 20px #e7daff;transform:translateY(-1px)}.markdown-body blockquote{padding:.5em 1em;margin:12px 0;border-top-left-radius:2px;border-bottom-left-radius:2px;border-left:3px solid #a862ea;background-color:#f8f5ff}.markdown-body blockquote&gt;p{margin:0}.markdown-body .math{font-style:italic;margin:12px 0;padding:.5em 1em;background-color:#f8f5ff}.markdown-body .math&gt;p{margin:0}.markdown-body code{padding:2px .4em;overflow-x:auto;color:#a862ea;font-weight:700;word-break:break-word;font-family:Operator Mono,Consolas,Monaco,Menlo,monospace;background-color:#f8f5ff}.markdown-body pre{margin:2em 0}.markdown-body pre&gt;code{display:block;padding:1.5em;word-break:normal;font-size:.9em;font-style:normal;font-weight:400;font-family:Operator Mono,Consolas,Monaco,Menlo,monospace;line-height:18px;color:#383838;border-radius:2px;scroll-behavior:smooth;box-shadow:0 0 10px #e7daff}.markdown-body pre&gt;code:hover{box-shadow:0 0 20px #e7daff}.markdown-body pre&gt;code::-webkit-scrollbar{height:6px;background-color:#f8f5ff}.markdown-body pre&gt;code::-webkit-scrollbar-thumb{background-color:#e7daff;border-bottom-left-radius:3px;border-bottom-right-radius:3px}.markdown-body hr{margin:2em 0;border-top:1px solid #a862ea}.markdown-body table{width:100%;font-size:12px;max-width:100%;overflow:auto;border-collapse:collapse}.markdown-body thead{color:#a862ea;background:#f8f5ff}.markdown-body td,.markdown-body th{padding:.5em;border:1px solid #e7daff}.markdown-body tr{background-color:#f8f5ff}@media (max-width:720px){.markdown-body{font-size:12px}}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>本文较长，建议点赞收藏。更多AI大模型应用开发学习视频及资料，在<a href="https://link.juejin.cn?target=https%3A%2F%2Fgitcode.com%2FEnjoyEDU%2FLLM" target="_blank" title="https://gitcode.com/EnjoyEDU/LLM" ref="nofollow noopener noreferrer">这里</a>。</p>
</blockquote>
<p>在实践中，AI Agent的开发需要以“感知-决策-行动”的核心逻辑，根据技术架构和场景需求，分五步进行：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1a8d557803824135a74b93b7a4ece067~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766030705&amp;x-signature=UWWdeEyY0IrN4BWmld6X7uJL9sw%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-0">一、场景的明确和要求的界定</h2>
<p>首先，我们要找出特定的应用场景（如智能客服、自动化办公、工业巡检），明确 Agent 的核心目标与能力边界。例如，如果是客户服务，则以“回答用户问题、工单处理流程”为主进行设计；如果是工业巡检，那么重点应该放在“对设备数据的感知和故障的提前预警”上。同时，对信息的输入与输出方式也需要进行界定：在以文本交互为主的情况下，重点放在对文本信息的加工上；如果包括各种类型的信息（例如，需要道路状况的识别和声音的感知的无人驾驶），则用于图像和声音的数据的访问接口将被对接。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/49f6ca48f3bf47c7b0239c4b313efaec~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766030705&amp;x-signature=5wtEKndJwAfYJiwP1%2B6jtAIWXIQ%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-1">二、技术选择：架构与模式的匹配</h2>
<p>核心框架的选择：对于初学者，推荐使用LangChain（强大的模块化架构，提供了对工具的调用和内存的管理）；对于需要进行复杂的多Agent协助的情况，推荐使用MetaGPT（支持Agent之间的角色划分）或Swarm（侧重Agent之间的交接）；</p>
<p>大型模式选择：通用场景选择GPT3.5/4，ChatGLM-4，对于垂直的行业大型模式（比如医疗）可微调行业大模型；</p>
<p>工具层和存储层：工具层集成了API（比如天气和支付接口），代码解释器，记忆存储用RAG 构建外部知识库（解决幻觉问题），而长期记忆可以与Pinecone等向量数据库对接。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/985e5b9c95ac429cb5e2d8075cc65077~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766030705&amp;x-signature=sLAiHAAz9GA79oQMSWuLN7p1s%2Fs%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-2">三、构建核心组件</h2>
<p>感知模块：文本场景以提示的方式分析用户的需要，多种信息场景以 CLIP、Whisper等图像识别和语音识别的方式访问，以API方式访问传感器采集的实时数据；</p>
<p>知识库：集成了两个方面的知识，一个是用于大型建模的一般知识的预处理，另一个是由RAG提供的、需要经常进行更新以确保精度的企业手册和行业规范等领域数据的输入；</p>
<p>决策模块采用ReAct、CoT等框架进行推理，如客户服务系统的决策过程是“询问用户→获取知识库→给出答案”的递归过程，而对于比较复杂的任务（如工程计划）则采用Plan—and—Execute分解为多个子任务来完成；</p>
<p>执行部分：在虚拟情景中，API被调用（例如发送电子邮件、生成报告等），在实体情景中，API被对接到硬件界面（例如机械臂的控制命令等）。</p>
<h2 data-id="heading-3">四、研制、调试和优化</h2>
<p>利用LangChain和其他一些类似的框架，快速构建了该系统的原型，并着重研究了该系统的两个主要功能，即是否需要使用工具以及是否需要询问使用者，以及是否需要在多次会话中记得使用者的喜好，以及该系统的记忆一致性。针对实际问题的优化设计：利用RAG技术降低了模型的信息偏差性，利用精细调整提高了纵向决策的准确性，并降低了工具调用的响应时间；</p>
<h2 data-id="heading-4">五、系统的部署和迭代</h2>
<p>将Agent配置到诸如用于企业客户服务的微信应用或用于工业控制系统设备终端的目标平台上，或者可以借助诸如Coze和百度的AgentBuilder之类的零代码平台来实现快速发布。投入使用后，根据使用者的回馈，进行决策逻辑的优化、工具库的扩充、知识库的更新等一系列的迭代式工作，以逐渐提高系统的自主能力和适应能力。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/87396379552945388ff4f6f46a7ea362~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766030705&amp;x-signature=CwJkgHJJhZSgaZPIUeqM%2Fecbhe4%3D" alt="" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/820e2a83d69044639c946c15ad96f3fe~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766030705&amp;x-signature=FFQEUHjomoiZ3GlVyyOTif6oEwI%3D" alt="" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ecb3b79b82ed489abb28ce5f7fdc3668~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766030705&amp;x-signature=nxoijDU9PnnXEwRXln0oLhpWM%2Fo%3D" alt="" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/15d7059f84334d7f97b923e7257800ec~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766030705&amp;x-signature=vDgzUDXVg64anAPsgkh3E%2FLiJ1k%3D" alt="" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6513c1460c94469397a12c4f38215503~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766030705&amp;x-signature=hXHkkQr0FHh5%2BHg6zCXcE8vN1uM%3D" alt="" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/247f6b63f73841e4971a1e8c4e40bbbc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766030705&amp;x-signature=0U%2F1Pgp8jLAsXMbRG6TAzhskj1g%3D" alt="" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6fe10ebee1dd46849d9f0abf58e22efa~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766030705&amp;x-signature=BFYFrk6fzotB7Hw3opnzAF8hjuA%3D" alt="" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e4fc0fc2d3794636ac9486d1362467f1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766030705&amp;x-signature=W2%2BkecRBH6c1bttCbvaJG1%2B7SrU%3D" alt="" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0066b67a599543d0a08bd46d7e01d511~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766030705&amp;x-signature=kTrKpsK7G6EBbn9T5UwqAPuHsfE%3D" alt="" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f8574fcd11d34741af25de085a115829~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766030705&amp;x-signature=vgRlSbMVpij3%2BuQbOWan%2BiZqOxg%3D" alt="" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/40017b000c0a448c85dda81de463ed95~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766030705&amp;x-signature=sKf%2FvJiEkPoABudc1M%2FMmDEVO%2BA%3D" alt="" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2dad1f304d264213b9dc69b0123a4245~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766030705&amp;x-signature=rvjb8Ts2jCpI3IaFJmn88nw9HiE%3D" alt="" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7db980bd4e5e474bb050534407460d98~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766030705&amp;x-signature=hSIGp5bcHPzOW2GoPiKOQfrYowQ%3D" alt="" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/40f216422ce04964a08e6dc295900da8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766030705&amp;x-signature=Nrl%2BqFI8Pt6ynCh5clc%2BqgdU%2FbE%3D" alt="" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5c555ee6b1844b66b423189b2b39b493~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766030705&amp;x-signature=wTd8G9LIUwDwDdYQeCu9SZsCROM%3D" alt="" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/de673dc5995b4025893db8465ce3c525~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766030705&amp;x-signature=p3uYpTTuJJNmYYOAwMarUqmklf8%3D" alt="" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e6559bdb4f274bd6ba40a4153d0e6854~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766030705&amp;x-signature=%2F0SdzPwKmNMrNBbj7JSqBQ0hwnM%3D" alt="" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c529ef57e1444ccf8fa3120e111e5670~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766030705&amp;x-signature=nfZ8UoU26UoPqBWVHQb%2FhFMKpjQ%3D" alt="" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e29af9dff80c4dfe97fd0c4252d7ed58~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766030705&amp;x-signature=VVESer6B%2FlvFL4fdL7sIKSngZ3E%3D" alt="" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fe762fabde9f49429e10b8e25a1757aa~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766030705&amp;x-signature=kRJpXRvorVkaeZAQJc1rI2sGKB0%3D" alt="" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/797a65389a494e459a31f48d7629dc07~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766030705&amp;x-signature=slm6y%2Blfz%2FEDDTy0GcKXrVttyB0%3D" alt="" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f05ec6ac699348a6a181fdeed23fdb01~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766030705&amp;x-signature=WvcSzPUXWSK4i3l8JH1jaibLu6s%3D" alt="" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/12cb26edde8a40f4baca4059c9de245f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766030705&amp;x-signature=RKiR85RkWdexTYwOOTGtcWgaVAo%3D" alt="" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a259f1df39544e00bab2569e1a775e14~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766030705&amp;x-signature=8WRQpnaXIkajWrMULopfpt6RvjM%3D" alt="" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9c8cf2595ee44a278d6c037bcdc807c0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766030705&amp;x-signature=%2BOpzJO7kxE1%2BEwXvc5YdK10GRiM%3D" alt="" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6e3c97fed02f421db3429e0f1959f8c4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766030705&amp;x-signature=KALtZ7f49LGQLmY%2BClq3o6cogro%3D" alt="" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/64001f1a9bdd4958b240ae70b2d747bf~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766030705&amp;x-signature=mLOsJHe0gjewYKSMNk6ZEAukZUw%3D" alt="" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bc96dc4ce36d4cf58073e34b6ec9e414~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766030705&amp;x-signature=4iqTzaSu8ttqiSvyq1tl5uw4EBU%3D" alt="" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1042b53de917453f82074f394e41bbd1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766030705&amp;x-signature=J5hHXmIxxAtaZYjLBNq7ClLxEJE%3D" alt="" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/580cf2fcefac4edf8fcbc0a2a515d2f8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766030705&amp;x-signature=lAb4g48HofenIuFno40bD9tuvds%3D" alt="" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9be85a35d86f4d85896e8af00fca6c70~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766030705&amp;x-signature=Ny3vx%2FhE7pFSMKfhnMf7y57oSuc%3D" alt="" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3e11b8b100c24adcbf2d13834fc2013e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766030705&amp;x-signature=Fv9X7gBPzO%2Bq2kCilaeTbmylNf8%3D" alt="" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/64284f10b7b94229bfe3deef6a1bc3f2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766030705&amp;x-signature=XU5j35a1Cu7FYSMDQS3mv%2Fz%2FDpM%3D" alt="" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0fe66943b6434b248b8a9ddd7403f168~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766030705&amp;x-signature=r64favh043r7j1Zj8P8VnEGqZNw%3D" alt="" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9664de8eba9c4572a9b5087b34e73570~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766030705&amp;x-signature=I4eYQdYK7nJGfFkdW4nn0OKZ1uY%3D" alt="" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/32e6128fbe01424e9678e846c1ed0e17~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766030705&amp;x-signature=l3gjCMS6YQnQ2phUU%2Bzo1y0wAbo%3D" alt="" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/42b746185f3b4b96ba4b7b83aee9c017~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766030705&amp;x-signature=7lSZYM1fiJxRMTva1GPYuK%2Fpm4I%3D" alt="" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3434fd174a484903b0b78c71927024ae~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766030705&amp;x-signature=xlqFwzDyJw3Zmje2BbotkCx%2Fb9o%3D" alt="" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/13d7cd92a59c4c45af33c5e7ab0879ea~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766030705&amp;x-signature=gCuaqnbGn4kbNW9MyLLUg4j5JYk%3D" alt="" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9f1d3b1e3e1348379f827f874e1eded4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766030705&amp;x-signature=cR%2FYjESFmFtSniw626eqDTAFTxQ%3D" alt="" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/832f395cbdcd4bf3b86edbf7c54cac5b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766030705&amp;x-signature=mWvMs0TLs4toj%2BFDYe59Pwbn64w%3D" alt="" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4fae179137d04050bc3e74e89fb222e3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766030705&amp;x-signature=ngOOArnMVZdasnfKRZlBXNBUtrw%3D" alt="" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/33ad8b59d9d7427badff338a7619f183~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766030705&amp;x-signature=m1RSH%2By%2Fu5z%2BBtB1pxfm1iD5D%2F8%3D" alt="" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3e3a39cfecfa48d28d1152404ac04bf1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766030705&amp;x-signature=W%2FZWn7e%2Fmql7xb1aDuI3efLZiME%3D" alt="" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/765fb436c3384ad5820b8e2d938c653f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766030705&amp;x-signature=VmToOB0LqkVUuKPhcP5cGgcAEKg%3D" alt="" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/24bb458f4a9b4dfa90eb70a75b7cefed~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766030705&amp;x-signature=iY0U5lp1o1QczXKSa7%2BKiQc6DaA%3D" alt="" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e06fbcef32964b87a9356565e0fa9e0d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766030705&amp;x-signature=UyVN%2BDB9Pvu2jnzXw4N%2FYHbZ5ns%3D" alt="" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/208badbae88c4ccdb04c345fb1286429~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766030705&amp;x-signature=4UY3zJ8TWe1N9FqOjlS%2FrKmzSfI%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-5">学习资源推荐</h3>
<p>如果你想更深入地学习大模型，以下是一些非常有价值的学习资源，这些资源将帮助你从不同角度学习大模型，提升你的实践能力。</p>
<blockquote>
<p>本文较长，建议点赞收藏。更多AI大模型应用开发学习视频及资料，在<a href="https://link.juejin.cn?target=https%3A%2F%2Fgitcode.com%2FEnjoyEDU%2FLLM" target="_blank" title="https://gitcode.com/EnjoyEDU/LLM" ref="nofollow noopener noreferrer">这里</a>。</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Java并发编程避坑指南：这5个隐藏陷阱让你的性能暴跌50%！]]></title>    <link>https://juejin.cn/post/7582200865907474466</link>    <guid>https://juejin.cn/post/7582200865907474466</guid>    <pubDate>2025-12-11T04:16:40.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7582200865907474466" data-draft-id="7582155513585958964" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Java并发编程避坑指南：这5个隐藏陷阱让你的性能暴跌50%！"/> <meta itemprop="keywords" content="后端,前端,人工智能"/> <meta itemprop="datePublished" content="2025-12-11T04:16:40.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="阿橙的百宝箱"/> <meta itemprop="url" content="https://juejin.cn/user/1638743356481367"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Java并发编程避坑指南：这5个隐藏陷阱让你的性能暴跌50%！
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1638743356481367/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    阿橙的百宝箱
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-11T04:16:40.000Z" title="Thu Dec 11 2025 04:16:40 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-11
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0"><strong>Java并发编程避坑指南：这5个隐藏陷阱让你的性能暴跌50%！</strong></h2>
<h3 data-id="heading-1">引言</h3>
<p>Java并发编程是现代软件开发中不可或缺的一部分，尤其是在高并发、高性能的应用场景下。然而，并发编程的复杂性往往会导致一些隐蔽的问题，这些问题不仅难以发现，还可能对系统性能造成灾难性影响。本文将深入探讨Java并发编程中五个常见的隐藏陷阱，这些陷阱可能导致你的应用性能暴跌50%甚至更多。通过剖析这些问题的根源并提供解决方案，希望能帮助开发者避免这些“坑”。</p>
<h3 data-id="heading-2">主体</h3>
<h4 data-id="heading-3">1. <strong>过度同步：锁的滥用与性能瓶颈</strong></h4>
<p><strong>问题描述</strong>：
同步（Synchronization）是Java并发编程中最基础的机制之一，但过度使用<code>synchronized</code>关键字或显式锁（如<code>ReentrantLock</code>）会导致严重的性能问题。例如，将整个方法或代码块不加区分地加锁会限制并行性，导致线程阻塞时间过长。</p>
<p><strong>案例分析</strong>：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">synchronized</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">processData</span><span class="hljs-params">()</span> {
    <span class="hljs-comment">// 耗时操作</span>
}
</code></pre>
<p>如果<code>processData()</code>方法中包含耗时操作（如I/O或复杂计算），所有调用该方法的线程都会串行执行，完全丧失了多线程的优势。</p>
<p><strong>解决方案</strong>：</p>
<ul>
<li>缩小同步范围：只对共享数据的访问部分加锁。</li>
<li>使用更细粒度的锁：例如分段锁（如<code>ConcurrentHashMap</code>的实现）。</li>
<li>考虑无锁数据结构：如<code>AtomicInteger</code>、<code>LongAdder</code>等。</li>
</ul>
<h4 data-id="heading-4">2. <strong>虚假唤醒：为什么你的条件等待不靠谱？</strong></h4>
<p><strong>问题描述</strong>：
在使用<code>Object.wait()</code>或<code>Condition.await()</code>时，线程可能会因为“虚假唤醒”（Spurious Wakeup）而提前被唤醒，即使没有明确的信号通知。这种现象可能导致程序逻辑错误。</p>
<p><strong>案例分析</strong>：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">synchronized</span> (lock) {
    <span class="hljs-keyword">while</span> (!condition) {
        lock.wait(); <span class="hljs-comment">// 可能被虚假唤醒</span>
    }
}
</code></pre>
<p>如果未将<code>wait()</code>放在循环中检查条件，虚假唤醒可能导致程序继续执行而不满足业务条件。</p>
<p><strong>解决方案</strong>：</p>
<ul>
<li>始终在循环中检查条件：这是Java官方推荐的最佳实践。</li>
<li>使用更高层次的工具：如<code>CountDownLatch</code>、<code>CyclicBarrier</code>或<code>Semaphore</code>。</li>
</ul>
<h4 data-id="heading-5">3. <strong>线程池配置不当：资源耗尽与任务堆积</strong></h4>
<p><strong>问题描述</strong>：
线程池（如<code>ThreadPoolExecutor</code>）是管理多线程任务的利器，但错误的配置可能导致资源耗尽或任务堆积。例如：</p>
<ul>
<li>核心线程数过大：浪费资源。</li>
<li>队列无限增长：可能导致内存溢出。</li>
<li>拒绝策略不当：任务丢失或系统崩溃。</li>
</ul>
<p><strong>案例分析</strong>：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">ExecutorService</span> <span class="hljs-variable">executor</span> <span class="hljs-operator">=</span> Executors.newFixedThreadPool(<span class="hljs-number">100</span>); <span class="hljs-comment">// 固定100线程</span>
</code></pre>
<p>在高负载场景下，如果任务数量远超100且任务耗时较长，队列可能无限增长（默认使用无界队列），最终导致OOM。</p>
<p><strong>解决方案</strong>：</p>
<ul>
<li>根据实际需求配置参数：核心线程数、最大线程数、队列容量等。</li>
<li>选择合适的拒绝策略：如记录日志、降级处理等。</li>
<li>监控线程池状态：通过JMX或其他工具实时监控。</li>
</ul>
<h4 data-id="heading-6">4. <strong>内存可见性问题：volatile与happens-before原则</strong></h4>
<p><strong>问题描述</strong>：
在多线程环境下，变量的修改可能对其他线程不可见（由于CPU缓存一致性协议或指令重排序）。即使没有显式的同步操作，也可能出现数据不一致的问题。</p>
<p><strong>案例分析</strong>：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SharedData</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-type">boolean</span> <span class="hljs-variable">flag</span> <span class="hljs-operator">=</span> <span class="hljs-literal">false</span>; <span class="hljs-comment">// 非volatile</span>

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setFlag</span><span class="hljs-params">()</span> {
        flag = <span class="hljs-literal">true</span>;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">isFlag</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> flag;
    }
}
</code></pre>
<p>在上述代码中，一个线程调用<code>setFlag()</code>后，另一个线程调用<code>isFlag()</code>可能仍然读到旧值（false）。</p>
<p>*<em>解决方案</em>:</p>
<ul>
<li><code>volatile</code>:  保证变量的可见性和禁止指令重排序.</li>
<li><code>final</code>:  如果变量初始化后不再修改,  可以用 <code>final</code>.</li>
</ul>
<h2 data-id="heading-7">Happens-Before规则:  理解并利用 Java Memory Model (JMM)的规则.</h2>
<p>####5. <strong>死锁与活锁:  当多个Thread相互等待时</strong></p>
<p><strong>Problem Description</strong>:<br/>
Deadlock occurs when two or more threads wait indefinitely for locks held by each other.Livelock is a related problem where threads are actively trying to resolve a conflict but make no progress.</p>
<p><strong>Case Study</strong>:</p>
<pre><code class="hljs language-java" lang="java">Thread1: locks A, then tries to lock B  
Thread2: locks B, then tries to lock A  
</code></pre>
<p>Both threads will block forever unless interrupted.</p>
<p><strong>Solutions</strong>:</p>
<ul>
<li>Avoid nested locking: Acquire locks in a consistent global order.</li>
<li>Use timeout mechanisms: For example, <code>tryLock(long timeout, TimeUnit unit)</code> in <code>ReentrantLock</code>.</li>
<li>Deadlock detection tools: Use JVM tools like <code>jstack</code>.</li>
</ul>
<h3 data-id="heading-8">Conclusion</h3>
<p>Concurrent programming in Java is powerful but fraught with subtle pitfalls that can dramatically degrade performance—sometimes by more than50%. By understanding these five common traps—over-synchronization, spurious wakeups, misconfigured thread pools, memory visibility issues,and deadlocks—you can write more robust and efficient concurrent code.Remember,the key lies in careful design,proper synchronization,and continuous testing under realistic conditions.</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[外网下载内网部署:Yum离线升级Linux软件包]]></title>    <link>https://juejin.cn/post/7582200865907490850</link>    <guid>https://juejin.cn/post/7582200865907490850</guid>    <pubDate>2025-12-11T04:44:31.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7582200865907490850" data-draft-id="7582096212663631872" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="外网下载内网部署:Yum离线升级Linux软件包"/> <meta itemprop="keywords" content="Linux"/> <meta itemprop="datePublished" content="2025-12-11T04:44:31.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="修己xj"/> <meta itemprop="url" content="https://juejin.cn/user/2641475936724142"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            外网下载内网部署:Yum离线升级Linux软件包
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2641475936724142/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    修己xj
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-11T04:44:31.000Z" title="Thu Dec 11 2025 04:44:31 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-11
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>近期安全扫描发现我们的生产环境存在多个系统漏洞，需要紧急升级相关安装包。然而，生产服务器部署在内网隔离环境中，无法直接访问外部软件仓库。面对这一挑战，团队同事推荐了一个高效的解决方案：使用 <code>yum install --downloadonly</code> 命令进行离线包外下内部。今天，我将分享一种高效的方法：利用<code>yum install --downloadonly</code>功能在外网环境下载所需RPM包，然后在内网环境中进行安全部署。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/977e226bcee54cb2a189ab0e884521b5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5L-u5bexeGo=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766033071&amp;x-signature=sshxgKEdV0UFfjdcVDllHYMJ7PY%3D" alt="ScreenShot_2025-12-11_103952_066.png" loading="lazy"/></p>
<p>ScreenShot_2025-12-11_103952_066.png</p>
<h2 data-id="heading-0">🛠️downloadonly：离线包管理的利器</h2>
<ul>
<li>命令解析</li>
</ul>

<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># 基本语法</span>
yum install --downloadonly <span class="hljs-attr">--downloaddir</span>=/home/<span class="hljs-literal">off</span>line-packages   vsftpd -y

<span class="hljs-comment"># 参数说明</span>
--downloadonly    <span class="hljs-comment"># 仅下载，不安装</span>
--downloaddir     <span class="hljs-comment"># 指定下载目录</span>
-y <span class="hljs-comment"># 自动 yes</span>
</code></pre>
<h2 data-id="heading-1">⬇️ 离线包下载流程</h2>
<ul>
<li>单包下载</li>
</ul>

<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># 下载单个包及其依赖</span>
yum install --downloadonly <span class="hljs-attr">--downloaddir</span>=/home/<span class="hljs-literal">off</span>line-packages/ vsftpd  -y

<span class="hljs-comment"># 如果已安装，使用reinstall参数</span>
yum reinstall --downloadonly <span class="hljs-attr">--downloaddir</span>=/home/<span class="hljs-literal">off</span>line-packages/ vsftpd  -y
</code></pre>
<ul>
<li>批量下载多个包</li>
</ul>

<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 创建需要升级的包列表</span>
<span class="hljs-built_in">cat</span> &gt; package-list.txt &lt;&lt; <span class="hljs-string">EOF
openssl
openssh-server
kernel
vsftpd
EOF</span>

<span class="hljs-comment"># 批量下载</span>
<span class="hljs-keyword">while</span> <span class="hljs-built_in">read</span> pkg; <span class="hljs-keyword">do</span>
    yum install --downloadonly --downloaddir=/home/offline-packages/ <span class="hljs-variable">$pkg</span>  -y
<span class="hljs-keyword">done</span> &lt; package-list.txt 
</code></pre>
<ul>
<li>下载特定版本</li>
</ul>

<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># 下载指定版本的包</span>
yum install --downloadonly <span class="hljs-attr">--downloaddir</span>=/home/<span class="hljs-literal">off</span>line-packages/ vsftpd-<span class="hljs-number">3.0</span>.<span class="hljs-number">3</span>  -y
</code></pre>
<h2 data-id="heading-2">⏳依赖处理</h2>
<ul>
<li>检查下载完整性</li>
</ul>

<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 查看下载的包</span>
<span class="hljs-built_in">ls</span> -lh /home/offline-packages/*.rpm

<span class="hljs-comment"># 统计数量</span>
find /home/offline-packages/ -name <span class="hljs-string">"*.rpm"</span> | <span class="hljs-built_in">wc</span> -l

<span class="hljs-comment"># 生成包列表（用于审计）</span>
rpm -qip /home/offline-packages/*.rpm | grep -E <span class="hljs-string">"Name|Version|Release"</span> &gt; package-info.txt
</code></pre>
<h2 data-id="heading-3">💻内网部署</h2>
<ul>
<li>传输包到内网</li>
</ul>

<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 打包压缩</span>
tar -czf offline-packages.tar.gz -C /home/offline-packages/ .
<span class="hljs-comment"># 将此问文件通过介质传输到内网，在内网服务器操作</span>

<span class="hljs-comment"># 1. 创建本地仓库目录</span>
<span class="hljs-built_in">mkdir</span> -p /opt/local-repo

<span class="hljs-comment"># 2. 解压传输的包</span>
tar -xzf offline-packages.tar.gz -C /opt/local-repo/
</code></pre>
<ul>
<li>内网服务器使用rpm直接安装</li>
</ul>

<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 直接安装所有下载的rpm包</span>
rpm -Uvh /opt/local-repo/*.rpm

<span class="hljs-comment"># 或者按需安装</span>
rpm -Uvh /opt/local-repo/vsftpd*.rpm /opt/local-repo/openssl*.rpm
</code></pre>
<h2 data-id="heading-4">🚀总结</h2>
<p>通过<code>yum install --downloadonly</code>命令，我们可以轻松构将升级部署包在外网下载，然后传输到内网升级。这种方法不仅适用于安全升级，还可用于：</p>
<ul>
<li>新建内网服务器的快速部署</li>
<li>多服务器批量更新</li>
<li>特定版本软件的标准化部署</li>
<li>紧急漏洞的快速响应</li>
</ul>
<p>掌握这一技能，你将能够在内网环境中游刃有余地管理Linux服务器的软件包，既保证了安全性，又不失灵活性。</p>
<hr/>
<p>❗<strong>温馨提示</strong>：生产环境操作前，请务必在测试环境充分验证，并制定详细的回滚方案。安全无小事，谨慎每一步！</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[逛逛今天推荐 4 个 GitHub 开源项目，非常实用。]]></title>    <link>https://juejin.cn/post/7582156219059404863</link>    <guid>https://juejin.cn/post/7582156219059404863</guid>    <pubDate>2025-12-11T03:19:12.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7582156219059404863" data-draft-id="7582156219059306559" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="逛逛今天推荐 4 个 GitHub 开源项目，非常实用。"/> <meta itemprop="keywords" content="GitHub"/> <meta itemprop="datePublished" content="2025-12-11T03:19:12.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="逛逛GitHub"/> <meta itemprop="url" content="https://juejin.cn/user/1442202996186093"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            逛逛今天推荐 4 个 GitHub 开源项目，非常实用。
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1442202996186093/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    逛逛GitHub
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-11T03:19:12.000Z" title="Thu Dec 11 2025 03:19:12 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-11
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">01、年会抽奖开源项目</h2>
<p>推荐两个年会抽奖 GitHub 开源项目，年会能排上用场了。</p>
<p>第一个 log-lottery 支持 3D 标签云效果，所有参与者的名字会组成一个旋转的球体、螺旋或网格，科技感十足。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/11713b25fb04493c84bdd8939fee5a33~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YCb6YCbR2l0SHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766027952&amp;x-signature=fMpsCsPxgbM%2FBHY690RoUbx6sGw%3D" alt="图片" loading="lazy"/><img src="" alt="" loading="lazy"/></p>
<p>不需要懂代码，直接通过 Excel 导入人员名单，后台简单设置奖项即可。</p>
<p>而且还支持抽奖音乐播放，氛围感拉满，抽奖结果可直接导出 Excel。</p>
<p>另外一个叫 lottery 的开源项目也是一个基于 Express + Three.js的 3D 球体抽奖程序。高度可配置，奖品图片、文字、中奖概率、旋转速度、转动圈数啥的统统可以自定义。</p>
<pre><code class="hljs language-bash" lang="bash">开源地址：https://github.com/LOG1997/log-lottery开源地址：https://github.com/moshang-ax/lottery
</code></pre>
<h2 data-id="heading-1">02、Mac 录屏开源神器</h2>
<p>大家刷 B 站的时候，可能注意到过一种很流行的视频风格：<strong>丝滑的鼠标跟随、自动放大的特写镜头、美观的渐变背景</strong>。</p>
<p>这种高颜值的录屏视频会极大地提升产品演示的质感。</p>
<p>很多都是用 macOS 软件：<strong>Screen Studio 搞出来的，</strong> 它虽然极其好用，但价格也相当感人。</p>
<p>OpenScreen 是这个产品的开源替代，刚刚在 GitHub 上崭露头角。虽然是开源的，核心功能一点也不含糊。</p>
<p>它支持全屏录制，或指定单个应用窗口，避免无关内容干扰。而且还能手动添加缩放效果，还能调整深度、时长和位置，让重点内容更突出。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/325c486a391f4249a176cf1ad937c58d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YCb6YCbR2l0SHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766027952&amp;x-signature=whgPlN%2B1lp8g8GY2YHQY2psuWsA%3D" alt="图片" loading="lazy"/></p>
<p>还能设置壁纸、纯色、渐变背景，或上传自定义图片，告别单调黑边。自带运动模糊，让平移、缩放效果更丝滑，提升视频质感。</p>
<p>除此之外，还有标注工具：支持添加文字、箭头、图片标注，讲解重点一目了然。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3d5556f2820540c8a964c895421d34f7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YCb6YCbR2l0SHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766027952&amp;x-signature=kbsokPbAdiq2W5SbzfzhqPR7S7U%3D" alt="图片" loading="lazy"/></p>
<p>还能裁剪画面隐藏多余部分、修剪冗余片段，无需额外剪辑软件；多格式导出，支持不同宽高比和分辨率，适配抖音、B 站、公众号等多平台发布。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b15272618ec24e8fa782056759e135a8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YCb6YCbR2l0SHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766027952&amp;x-signature=PuDEW8vXSjQOjOYV6izLW2%2F7b2k%3D" alt="图片" loading="lazy"/><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/188f67b159074332b520ef738cd60ee2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YCb6YCbR2l0SHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766027952&amp;x-signature=THDHMknp4j911sX6JvHQ%2FjHGNNU%3D" alt="图片" loading="lazy"/></p>
<pre><code class="hljs language-arduino" lang="arduino">开源地址：https:<span class="hljs-comment">//github.com/siddharthvaddem/openscreen</span>
</code></pre>
<h2 data-id="heading-2">03、开源下载器</h2>
<p><strong>Motrix 这个 4 万多 Star 的开源项目</strong>绝对能让你眼前一亮。</p>
<p>它不仅<strong>颜值抗打</strong>，而且<strong>全能：</strong> HTTP、FTP、BT、磁力链全搞定，最重要的是<strong>完全免费、开源、无广告。</strong></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/de71f9cfab044ac6b0315f61a9f3c02d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YCb6YCbR2l0SHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766027952&amp;x-signature=nN4v1e84FCzDTd3Mmk9cx3yYSmI%3D" alt="图片" loading="lazy"/></p>
<p><strong>它的底层基于大名鼎鼎的下载引擎 Aria2。Motrix 相当于给 Aria2 穿上了一层精美的外衣，让你无需任何配置，开箱即用。</strong></p>
<p>支持最高 64 线程下载，榨干你的宽带潜能。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2982060a4e0b413aa2661922e9c708a9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YCb6YCbR2l0SHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766027952&amp;x-signature=TZJu0%2F5zRBWbABP8VDMxlhnm9cU%3D" alt="图片" loading="lazy"/><img src="" alt="" loading="lazy"/></p>
<p>支持普通链接（HTTP/HTTPS/FTP）、BitTorrent（种子文件）、Magnet（磁力链接）</p>
<p>还能 BT 选择性下载，下载种子里的文件时，你可以勾选只需要的那几集视频，不用把整个庞大的文件夹都拖下来。</p>
<p>实测在网络环境允许的情况下，Motrix 跑满带宽是常规操作，甚至在下载某些冷门资源时，通过其内置的 自动更新 Tracker 功能，也能获得比普通下载器更好的速度。</p>
<pre><code class="hljs language-arduino" lang="arduino">开源地址：https:<span class="hljs-comment">//github.com/agalwood/Motrix</span>
</code></pre>
<h2 data-id="heading-3">04、PDF 工具包</h2>
<p>没开源几天，在 GitHub 上就获得 6K 的 Star 了。</p>
<p>BentoPDF 像一个精致的便当盒（Bento），把你需要的所有 PDF 工具都打包在一起，开箱即用。</p>
<p>与传统的在线工具不同，虽然你在浏览器中使用它，但所有的文件处理逻辑都在你的本地电脑上完成，文件永远不会被上传到任何服务器。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/aa0db7aeb2cf4b4aac540fca3dbcb7ed~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YCb6YCbR2l0SHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766027952&amp;x-signature=r9dgbijug%2ByYIImoqvftjk7t1rE%3D" alt="图片" loading="lazy"/>这个开源项目提供的 PDF 处理的能力非常丰富，基本的 PDF 编辑、转换啥的都有，具体功能如下，可以瞧瞧。<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/04662e51909a488d80e3972eebfe8cd2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YCb6YCbR2l0SHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766027952&amp;x-signature=DRiIFHWH53VuPyRhQzs5nfaA6aI%3D" alt="图片" loading="lazy"/></p>
<pre><code class="hljs language-bash" lang="bash">开源地址：https://github.com/alam00000/bentopdf
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Android 存储目录<内部存储，外部存储app专属，外部存储公共>]]></title>    <link>https://juejin.cn/post/7582118538562060307</link>    <guid>https://juejin.cn/post/7582118538562060307</guid>    <pubDate>2025-12-11T02:48:57.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7582118538562060307" data-draft-id="7582067084841025590" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Android 存储目录&lt;内部存储，外部存储app专属，外部存储公共&gt;"/> <meta itemprop="keywords" content="Android,面试"/> <meta itemprop="datePublished" content="2025-12-11T02:48:57.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="byc"/> <meta itemprop="url" content="https://juejin.cn/user/3403743728773416"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Android 存储目录&lt;内部存储，外部存储app专属，外部存储公共&gt;
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3403743728773416/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    byc
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-11T02:48:57.000Z" title="Thu Dec 11 2025 02:48:57 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-11
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读11分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>首先，我们需要破除一个最大的误区： <strong>“内部存储”和“外部存储”并不是指“手机内置存储”和“SD卡”</strong> 。它们的本质区别在于<strong>安全性和可访问性</strong>。</p>
<p>你可以用下图快速建立整体认知：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/69236fad94fd4789b1095d9128fba1f2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgYnlj:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766026136&amp;x-signature=qnmKCRMHhtas5s%2BZ9mpwJDPX6TM%3D" alt="p1.png" loading="lazy"/></p>
<p>接下来，我们深入剖析图中的每一个核心概念。</p>
<h3 data-id="heading-0">内部存储 (Internal Storage)</h3>
<p>这是指 <code>/data/data//</code> 目录下的空间。</p>
<ul>
<li>
<p><strong>特点</strong>：</p>
<ul>
<li><strong>绝对私有</strong>：只有你的应用可以访问，其他应用（无Root）无法读写。用户也无法在文件管理器中直接看到。</li>
<li><strong>安全可靠</strong>：应用卸载时，系统会自动清除此目录下的所有文件。</li>
<li><strong>空间有限</strong>：与系统空间共享，通常较小。</li>
</ul>
</li>
<li>
<p><strong>主要子目录</strong>：</p>
<ul>
<li><code>files/</code>： 存放应用长期使用的文件。</li>
<li><code>cache/</code>： 存放临时缓存文件。系统可能在存储空间不足时清理此处（但不要依赖于此，应自行管理缓存大小）。</li>
</ul>
</li>
<li>
<p><strong>如何获取路径</strong>：</p>
</li>
</ul>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// 获取内部 files 目录</span>
<span class="hljs-keyword">val</span> internalFilesDir: File = context.filesDir
<span class="hljs-comment">// 获取内部 cache 目录</span>
<span class="hljs-keyword">val</span> internalCacheDir: File = context.cacheDir
</code></pre>
<h3 data-id="heading-1">外部存储 (External Storage)</h3>
<p>这是指可以被“共享”的存储空间，通常对应设备自带的“内置共享存储”（如 <code>/storage/emulated/0</code>）。它进一步分为两部分：</p>
<h4 data-id="heading-2">1. 外部存储 - App专属目录</h4>
<p>路径为：<code>/storage/emulated/0/Android/data//</code></p>
<ul>
<li>
<p><strong>特点</strong>：</p>
<ul>
<li><strong>外部但私有</strong>：虽然位于共享存储区，但在Android 4.4及以上系统，此目录对其他应用和用户默认<strong>不可见</strong>（无需任何权限）。应用卸载时，这里的内容也会被<strong>自动清除</strong>。</li>
<li><strong>空间较大</strong>：使用设备的“内置共享存储”空间，通常比内部存储大得多。</li>
<li><strong>用途</strong>：适合存放应用专属的、较大的媒体文件或缓存。</li>
</ul>
</li>
<li>
<p><strong>如何获取路径</strong>：</p>
</li>
</ul>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// 获取外部 App 专属 files 目录</span>
<span class="hljs-keyword">val</span> externalFilesDir: File? = context.getExternalFilesDir(<span class="hljs-literal">null</span>)
<span class="hljs-comment">// 获取外部 App 专属 cache 目录</span>
<span class="hljs-keyword">val</span> externalCacheDir: File? = context.externalCacheDir
<span class="hljs-comment">// 可以指定子目录类型，系统会妥善管理</span>
<span class="hljs-keyword">val</span> externalPicturesDir: File? = context.getExternalFilesDir(Environment.DIRECTORY_PICTURES)
</code></pre>
<h4 data-id="heading-3">2. 外部存储 - 公共目录</h4>
<p>即共享存储根目录下的标准文件夹，如 <code>Downloads</code>、<code>DCIM</code>、<code>Pictures</code>、<code>Movies</code>、<code>Music</code> 等。</p>
<ul>
<li>
<p><strong>特点</strong>：</p>
<ul>
<li><strong>完全共享</strong>：所有应用和用户均可访问。文件在应用卸载后<strong>会保留</strong>。</li>
<li><strong>需要权限</strong>：访问需要向用户申请存储权限。</li>
</ul>
</li>
<li>
<p><strong>⚠️ 系统版本带来的关键差异（重点）</strong> ：</p>
<ul>
<li>
<p><strong>Android 9 (API 28) 及以下</strong>：可以通过<code>Environment.getExternalStoragePublicDirectory(type)</code>直接获取路径，然后使用传统的<code>File API</code>进行读写。</p>
</li>
<li>
<p><strong>Android 10 (API 29) 及以上</strong>：引入了 <strong>Scoped Storage（分区存储）</strong> 。为了用户隐私和安全：</p>
<ol>
<li><strong>不能</strong>再直接使用<code>File</code>路径访问公共目录（<code>Environment.getExternalStoragePublicDirectory</code>已废弃）。</li>
<li>必须通过 <strong><code>MediaStore</code> API</strong> 来访问公共媒体文件（图片、视频、音频），或通过 <strong><code>Storage Access Framework (SAF)</code></strong>  系统文件选择器来访问文档和下载目录。</li>
</ol>
</li>
</ul>
</li>
<li>
<p><strong>如何获取路径/访问</strong>：</p>
</li>
</ul>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// 方法一：通过 MediaStore 插入一张图片到公共相册 (Android 10+推荐)</span>
<span class="hljs-keyword">val</span> values = ContentValues().apply {
    put(MediaStore.Images.Media.DISPLAY_NAME, &amp;#<span class="hljs-number">34</span>;my_image.jpg&amp;#<span class="hljs-number">34</span>;)
    put(MediaStore.Images.Media.MIME_TYPE, &amp;#<span class="hljs-number">34</span>;image/jpeg&amp;#<span class="hljs-number">34</span>;)
    put(MediaStore.Images.Media.RELATIVE_PATH, Environment.DIRECTORY_PICTURES + &amp;#<span class="hljs-number">34</span>;/MyApp/&amp;#<span class="hljs-number">34</span>;)
}
<span class="hljs-keyword">val</span> uri = context.contentResolver.insert(MediaStore.Images.Media.EXTERNAL_CONTENT_URI, values)
<span class="hljs-comment">// 然后通过 ContentResolver.openOutputStream(uri) 写入数据</span>

<span class="hljs-comment">// 方法二：使用 Storage Access Framework 让用户选择保存位置（适用于所有文件类型）</span>
<span class="hljs-keyword">val</span> intent = Intent(Intent.ACTION_CREATE_DOCUMENT).apply {
    addCategory(Intent.CATEGORY_OPENABLE)
    type = &amp;#<span class="hljs-number">34</span>;application/pdf&amp;#<span class="hljs-number">34</span>;
    putExtra(Intent.EXTRA_TITLE, &amp;#<span class="hljs-number">34</span>;my_document.pdf&amp;#<span class="hljs-number">34</span>;)
}
startActivityForResult(intent, CREATE_DOC_REQUEST_CODE)
</code></pre>
<h3 data-id="heading-4">总结与建议</h3>

































<table><thead><tr><th>目录类型</th><th>路径示例</th><th>特点</th><th>适用场景</th><th>版本适配要点</th></tr></thead><tbody><tr><td>内部存储</td><td>/data/data/包名/...</td><td>私有，卸载清除，空间小</td><td>敏感数据、小型数据库</td><td>基本无变化</td></tr><tr><td>外部-App专属</td><td>/storage/.../Android/data/包名/...</td><td>私有，卸载清除，空间大</td><td>应用专属的大文件、缓存</td><td>Android 4.4+ 行为一致，无需权限</td></tr><tr><td>外部-公共目录</td><td>/storage/.../Pictures/ 等</td><td>共享，卸载保留</td><td>用户希望共享的图片、文档</td><td>Android 10+必须用MediaStore或SAF</td></tr></tbody></table>
<p><strong>最佳实践</strong>：</p>
<ol>
<li><strong>首选内部存储</strong>存放敏感和小型数据。</li>
<li><strong>大文件、缓存优先放外部App专属目录</strong>，无需处理权限和版本兼容。</li>
<li><strong>只有在需要与其他应用共享、或让用户永久保留的文件</strong>，才考虑写入公共目录，并务必做好Android 10+的Scoped Storage适配。</li>
</ol>
<h3 data-id="heading-5">/data/user/0/包名/files 这个目录我可以在我手机上的文件管理里面找到？</h3>
<p><strong>不能直接通过普通文件管理器找到。</strong></p>
<p>你提到的 <code>/data/user/0/包名/files</code> 这个路径，其实就是 <strong>内部存储</strong> 的另一个等价表示。它和你之前了解的 <code>/data/data/包名/files</code> 指向的是同一个位置。</p>
<h3 data-id="heading-6"> 为什么普通文件管理器看不到？</h3>
<ol>
<li><strong>安全沙盒限制</strong>：这个目录位于Android系统的<strong>严格保护区域</strong>。默认情况下，没有Root权限的其他应用（包括你手机上的所有文件管理器App）都无法直接访问这个路径。</li>
<li><strong>用户数据隔离</strong>：路径中的 <code>user/0</code> 代表的是主用户（第一个用户），这是Android系统为了支持“多用户”或“工作资料”功能而设计的目录结构。它对普通用户是透明的。</li>
</ol>
<h3 data-id="heading-7">如何查看这个目录的内容？</h3>
<p>如果你想查看这个目录里的文件，有以下几个方法：</p>






























<table><thead><tr><th>方法</th><th>说明</th><th>适合谁</th></tr></thead><tbody><tr><td>1. 通过Android Studio的 Device File Explorer</td><td>在Android Studio中，可以无需Root直接查看、导出、导入App的内部存储文件。这是开发时最常用、最方便的方法。</td><td>开发者首选</td></tr><tr><td>2. 使用ADB命令</td><td>在电脑上连接手机，通过命令行访问：  <code>adb shell</code> 进入  <code>run-as 包名</code> 切换到应用上下文  <code>ls /data/data/包名/files</code></td><td>开发者、高级用户</td></tr><tr><td>3. 将文件写入外部存储后查看</td><td>获得系统最高权限后，任何文件管理器都可以访问 <code>/data</code> 目录。但这会<strong>使设备失去保修、带来安全风险</strong>，且绝大多数日常使用场景完全不需要。</td><td>临时调试</td></tr><tr><td>4. Root你的手机</td><td>在Android Studio中，可以无需Root直接查看、导出、导入App的内部存储文件。这是<strong>开发时最常用、最方便</strong>的方法。</td><td>极客、深度调试者</td></tr></tbody></table>
<h3 data-id="heading-8">核心结论</h3>
<ul>
<li><code>/data/user/0/包名/</code> 等同于 <code>/data/data/包名/</code>，都是<strong>内部存储</strong>，受系统严格保护。</li>
<li>作为普通用户，<strong>你不应该、通常也无法</strong>在文件管理器中直接看到它。这是Android系统为了保护你的应用数据和隐私而设计的。</li>
<li>作为开发者，你应该使用 <strong>Android Studio 的 Device File Explorer</strong> 来检查和操作这些文件。</li>
</ul>
<p>如果你想测试文件是否成功写入内部存储，最简单的办法是在代码中读取它，或者按上述方法3，将其复制到一个可访问的位置再查看。</p>
<h3 data-id="heading-9">三种的文件路径&lt;内部存储，外部app专属，外部公共，如果我需要通过微信分享其中的文件，我什么时候需androidx.core.content.FileProvider，什么时候不需要</h3>
<p>这是一个非常好的问题，直接关系到Android文件分享功能能否正常工作。是否需要使用 <code>FileProvider</code>，核心判断标准是：<strong>你的文件路径是否允许接收方应用直接访问</strong>。</p>
<p>下图清晰地展示了判断流程：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/aecb30919496427fb8c53a92e2f37ef2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgYnlj:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766026136&amp;x-signature=r5FoEq0dh8mFZVFpa1WtfdNuw0A%3D" alt="p2.png" loading="lazy"/></p>
<h3 data-id="heading-10"> 三种路径的详细分析</h3>
<h4 data-id="heading-11">1. 内部存储 与 外部App专属目录 (Android 11+)</h4>
<p><strong>必须使用 FileProvider。</strong></p>
<ul>
<li><strong>原因</strong>：这两个位置的路径（如 <code>/data/data/你的包名/...</code> 或 <code>/storage/emulated/0/Android/data/你的包名/...</code>）对于微信等其他应用来说是<strong>不可直接访问的</strong>。从Android 7.0 (Nougat) 开始，系统禁止直接通过 <code>file://</code> URI跨应用分享私有文件，否则会抛出 <code>FileUriExposedException</code>。</li>
<li><strong>作用</strong>：<code>FileProvider</code> 会为你的私有文件创建一个临时的、<strong>只读</strong>的 <code>content://</code> URI，并赋予接收方应用（如微信）临时的读取权限，从而安全地完成分享。</li>
</ul>
<h4 data-id="heading-12">2. 外部存储 - 公共目录</h4>
<p><strong>通常不需要 FileProvider，可以直接使用 <code>file://</code> URI。</strong></p>
<ul>
<li>
<p><strong>原因</strong>：位于标准公共目录（如 <code>Pictures/</code>, <code>Download/</code>, <code>DCIM/</code>）的文件默认对所有应用具有<strong>读取权限</strong>，因此可以直接访问。</p>
</li>
<li>
<p><strong>例外情况</strong>：</p>
<ul>
<li>如果你将文件保存在公共目录下<strong>你自己创建的非标准子目录</strong>里，为了保证最大兼容性（尤其在某些定制系统上），使用 <code>FileProvider</code> 是更稳妥的选择。</li>
<li>如果你需要<strong>更精细地控制权限</strong>（例如设置URI过期时间、只允许一次访问等），也可以使用 <code>FileProvider</code>。</li>
</ul>
</li>
</ul>
<h3 data-id="heading-13">使用 FileProvider 的步骤摘要</h3>
<h4 data-id="heading-14">1.如果你需要用它，以下是关键步骤：</h4>
<p><strong>在 <code>AndroidManifest.xml</code> 中声明</strong></p>
<pre><code class="hljs language-xml" lang="xml">
    ...
    
        
    

</code></pre>
<h4 data-id="heading-15">2.<strong>创建配置文件 <code>res/xml/file_paths.xml</code></strong></h4>
<p>这个文件定义了你想分享哪些目录下的文件。</p>
<pre><code class="hljs language-xml" lang="xml">

    
    
    
     --&gt;
    
    

</code></pre>
<h4 data-id="heading-16">3.<strong>在代码中生成 Content URI 并分享</strong></h4>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// 假设你的文件位于 外部App专属目录</span>
<span class="hljs-keyword">val</span> fileToShare = File(context.getExternalFilesDir(<span class="hljs-literal">null</span>), &amp;#<span class="hljs-number">34</span>;share_image.jpg&amp;#<span class="hljs-number">34</span>;)

<span class="hljs-keyword">val</span> contentUri: Uri = FileProvider.getUriForFile(
    context,
    &amp;#<span class="hljs-number">34</span>;${context.packageName}.fileprovider&amp;#<span class="hljs-number">34</span>;, <span class="hljs-comment">// 必须与manifest中authorities一致</span>
    fileToShare
)

<span class="hljs-keyword">val</span> shareIntent = Intent(Intent.ACTION_SEND).apply {
    type = &amp;#<span class="hljs-number">34</span>;image/jpeg&amp;#<span class="hljs-number">34</span>;
    putExtra(Intent.EXTRA_STREAM, contentUri) <span class="hljs-comment">// 使用 content:// URI</span>
    addFlags(Intent.FLAG_GRANT_READ_URI_PERMISSION) <span class="hljs-comment">// 授予临时读取权限</span>
}
startActivity(Intent.createChooser(shareIntent, &amp;#<span class="hljs-number">34</span>;分享图片&amp;#<span class="hljs-number">34</span>;))
</code></pre>
<h3 data-id="heading-17">总结与速查表</h3>





























<table><thead><tr><th>文件位置</th><th>是否需要 FileProvider</th><th>原因</th><th>URI 类型</th></tr></thead><tbody><tr><td><strong>内部存储</strong></td><td><strong>必须</strong>(android11+)</td><td>其他应用无任何访问权限</td><td>content://</td></tr><tr><td><strong>外部存储 - App专属目录</strong></td><td><strong>外部存储 - App专属目录</strong></td><td>其他应用默认无访问权限</td><td>content://</td></tr><tr><td><strong>外部存储 - 公共目录</strong></td><td><strong>通常不需要</strong></td><td>其他应用有读取权限</td><td>file://</td></tr></tbody></table>
<p><strong>最佳实践</strong>：如果分享功能对你很重要，且你不确定文件最终会保存在哪里，<strong>统一使用 <code>FileProvider</code> 是最安全、兼容性最好的做法</strong>，它几乎能处理所有情况。唯一的“缺点”是需要多写几步配置代码。</p>
<h3 data-id="heading-18">外部App专属目录和外部公共目录 (Android 11+) 这个android 11+ 有啥区别？</h3>
<p><strong>Android 11（API 30）对外部App专属目录的访问规则做出了一个重大变更</strong>，直接影响了是否需要使用 <code>FileProvider</code> 进行分享。</p>
<h2 data-id="heading-19">Android 11+ 的核心变化：强制执行“分区存储”</h2>
<p>在Android 10中，分区存储（Scoped Storage）是<strong>可选</strong>的（<code>requestLegacyExternalStorage</code>标志）。但从 <strong>Android 11 开始，它被强制启用</strong>，无法回退。</p>
<h3 data-id="heading-20">访问规则对比（关键区别）</h3>



































<table><thead><tr><th>访问场景</th><th>Android 10 及以下</th><th><strong>Android 11 及以上</strong></th></tr></thead><tbody><tr><td><strong>你的App访问自己的外部专属目录</strong></td><td><strong>始终可读写</strong></td><td><strong>始终可读写</strong>（无变化）</td></tr><tr><td><strong>其他App访问你的外部专属目录</strong></td><td><strong>默认可访问</strong>（有权限时）</td><td><strong>重大变化</strong></td></tr><tr><td/><td>只要其他App拥有 <code>READ_EXTERNAL_STORAGE</code> 权限，理论上就能扫描整个存储，包括你的 <code>Android/data/包名/</code> 目录。</td><td><strong>默认禁止访问</strong></td></tr><tr><td/><td/><td>其他App<strong>无法直接通过文件路径</strong>访问你的专属目录，即使它拥有存储权限。</td></tr><tr><td><strong>系统文件管理器访问</strong></td><td>通常可查看（需开启“显示隐藏文件”）</td><td><strong>仍可查看</strong>（用户操作层面）</td></tr></tbody></table>
<h3 data-id="heading-21">Android 11+ 下其他App如何访问（你分享文件时的影响）</h3>
<p>由于其他App默认无法进入你的专属目录，因此你<strong>必须</strong>通过 <code>FileProvider</code> 创建 <code>content://</code> URI 来分享文件。这个URI本质上是一个<strong>临时的、有访问令牌的通行证</strong>。</p>
<p><strong>具体机制</strong>：</p>
<ol>
<li>当你的App通过 <code>FileProvider.getUriForFile()</code> 生成URI时，系统会“解锁”这个特定文件。</li>
<li>你通过 <code>Intent.addFlags(Intent.FLAG_GRANT_READ_URI_PERMISSION)</code> 将这个“读取令牌”附加到URI上。</li>
<li>接收方App（如微信）在收到这个带有令牌的URI时，系统会临时允许它通过 <code>ContentResolver</code> 打开这个文件流，<strong>即使它根本不知道文件在 <code>Android/data/</code> 下的具体路径</strong>。</li>
<li>这个权限通常是<strong>一次性的</strong>，且仅对接收方App有效。</li>
</ol>
<h3 data-id="heading-22">实际影响与代码示例</h3>
<p>假设你要分享 <code>Android/data/com.yourapp/files/share_image.jpg</code>：</p>
<p><strong>错误做法（在 Android 11+ 上会失败）</strong> ：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">val</span> file = File(context.getExternalFilesDir(<span class="hljs-literal">null</span>), &amp;#<span class="hljs-number">34</span>;share_image.jpg&amp;#<span class="hljs-number">34</span>;)
<span class="hljs-comment">// 生成 file:// URI，其他App无权访问此路径</span>
<span class="hljs-keyword">val</span> fileUri = Uri.fromFile(file)
shareIntent.putExtra(Intent.EXTRA_STREAM, fileUri) <span class="hljs-comment">// 分享失败！</span>
</code></pre>
<p><strong>正确做法（所有版本通用，Android 11+ 必须）</strong> ：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">val</span> file = File(context.getExternalFilesDir(<span class="hljs-literal">null</span>), &amp;#<span class="hljs-number">34</span>;share_image.jpg&amp;#<span class="hljs-number">34</span>;)

<span class="hljs-comment">// 使用FileProvider生成安全的 content:// URI</span>
<span class="hljs-keyword">val</span> contentUri: Uri = FileProvider.getUriForFile(
    context,
    &amp;#<span class="hljs-number">34</span>;${context.packageName}.fileprovider&amp;#<span class="hljs-number">34</span>;,
    file
)

<span class="hljs-keyword">val</span> shareIntent = Intent(Intent.ACTION_SEND).apply {
    type = &amp;#<span class="hljs-number">34</span>;image/jpeg&amp;#<span class="hljs-number">34</span>;
    putExtra(Intent.EXTRA_STREAM, contentUri) <span class="hljs-comment">// 使用 content:// URI</span>
    addFlags(Intent.FLAG_GRANT_READ_URI_PERMISSION) <span class="hljs-comment">// 授予临时权限</span>
}
<span class="hljs-comment">// 分享成功！</span>
</code></pre>
<h3 data-id="heading-23">总结与建议</h3>
<ol>
<li>
<p><strong>简单结论</strong>：自 <strong>Android 11 起，你必须使用 <code>FileProvider</code> 来分享位于外部App专属目录中的任何文件</strong>，因为这是其他App能访问它们的唯一合法途径。</p>
</li>
<li>
<p><strong>向后兼容</strong>：即使你的 <code>targetSdkVersion</code> 低于30，只要用户在Android 11+的设备上运行你的App，系统就会强制执行此规则。</p>
</li>
<li>
<p><strong>最佳实践</strong>：</p>
<ul>
<li><strong>统一使用 <code>FileProvider</code></strong>：为了最简单的维护和最好的兼容性，无论文件在哪里（内部、外部专属目录），也无论你的 <code>minSdkVersion</code> 是多少，统一使用 <code>FileProvider</code> 进行分享。</li>
<li><strong>更新你的 <code>file_paths.xml</code></strong>：确保配置了正确的路径来暴露外部专属目录：</li>
</ul>
</li>
</ol>
<pre><code class="hljs language-xml" lang="xml">
    
    
    
    

</code></pre>
<p>所以，回答你最初的问题： <strong>“Android 11+” 的区别就在于，从此之后，外部App专属目录真正变得和内部存储一样“私有”了，分享时必须通过 <code>FileProvider</code> 这个“安全检查站”。</strong></p>
<h3 data-id="heading-24">android 10和11以后强制 使用的Scoped Storage（分区存储），到底是针对那个目录，是内部存储目录还是外部app专属目录，还是公共目录</h3>
<p>问到了核心！<strong>Scoped Storage（分区存储）主要针对的是“外部存储-公共目录”</strong> ，但它也<strong>间接影响和强化了“外部存储-App专属目录”的私有性</strong>。而<strong>内部存储完全不受影响</strong>。</p>
<p>让我用一个清晰的表格和对比图来帮你理解：</p>
<h3 data-id="heading-25">Scoped Storage 管控范围一览表</h3>





























<table><thead><tr><th>存储位置</th><th>中文常称</th><th>Scoped Storage 下是否受影响？</th><th>具体变化</th></tr></thead><tbody><tr><td><strong>Internal Storage</strong></td><td>内部存储</td><td><strong>完全不受影响</strong></td><td>始终私有，无需任何权限访问</td></tr><tr><td><strong>External Storage - App-specific</strong></td><td>外部App专属目录</td><td><strong>间接受影响</strong>（访问规则被强化）</td><td><strong>你的App</strong>：仍可自由访问。  <strong>其他App</strong>：<strong>默认无法访问</strong>（Android 11+强制）。分享必须用FileProvider。</td></tr><tr><td><strong>External Storage - Public Directories</strong></td><td>外部公共目录</td><td><strong>直接、最主要的管理目标</strong></td><td><strong>你的App</strong>：不能直接用<code>File</code>路径操作，必须通过<code>MediaStore</code>或SAF。  <strong>其他App</strong>：只能访问自己创建或系统授权的媒体文件。</td></tr></tbody></table>
<p>为了更直观地展示Scoped Storage如何改变了应用访问存储的“视野”，你可以参考下面的对比图：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7f1a6fb9d32543e5bb159f81a24be213~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgYnlj:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766026136&amp;x-signature=pCJTXmQYHp%2B8YpBhg0VAzidpDuQ%3D" alt="p3.png" loading="lazy"/></p>
<h3 data-id="heading-26">详细解读：变化在哪里？</h3>
<h4 data-id="heading-27">1. 外部存储 - 公共目录（<strong>主要改革区</strong>）</h4>
<ul>
<li>
<p><strong>以前</strong>：App只要申请了 <code>READ_EXTERNAL_STORAGE</code> 权限，就可以像文件管理器一样<strong>扫描、读取整个存储上所有其他App的公共文件</strong>（例如，一个图片编辑App能扫到你微信保存的所有图片），隐私风险大。</p>
</li>
<li>
<p><strong>现在</strong>：</p>
<ul>
<li>
<p><strong>禁止直接路径访问</strong>：你不能再使用 <code>new File(Environment.getExternalStoragePublicDirectory(...), ...)</code> 这种方式。</p>
</li>
<li>
<p><strong>必须使用“中介API”</strong> ：</p>
<ul>
<li><strong><code>MediaStore</code></strong>：用于访问/创建<strong>媒体文件</strong>（图片、视频、音频）。你只能看到自己创建的文件，以及系统相册等公共集合中的文件。插入新文件时，系统会自动将其归类到对应的媒体集合。</li>
<li><strong><code>Storage Access Framework (SAF)</code></strong> ：通过系统文件选择器（一个系统UI）让用户<strong>主动选择</strong>文件或目录，适合访问文档、下载目录等非媒体文件。</li>
</ul>
</li>
<li>
<p><strong>权限更精细</strong>：Android 11+引入了更细粒度的权限（如 <code>ACCESS_MEDIA_LOCATION</code>），而不是简单的“全部或没有”。</p>
</li>
</ul>
</li>
</ul>
<h4 data-id="heading-28">2. 外部存储 - App专属目录（<strong>间接受影响</strong>）</h4>
<ul>
<li>这个目录的<strong>设计初衷就是私有的</strong>，Scoped Storage 只是<strong>从系统层面彻底落实了这一设计</strong>。</li>
<li><strong>Android 11+的强制规定</strong>：其他App<strong>默认绝对无法访问</strong>你的专属目录，连扫描都扫不到。这使得它变得和内部存储一样安全，同时也意味着分享文件时必须通过 <code>FileProvider</code> “开门”。</li>
</ul>
<h4 data-id="heading-29">3. 内部存储（<strong>安全区，无变化</strong>）</h4>
<ul>
<li>完全不受Scoped Storage任何影响。它从一开始就是最私密、最安全的。</li>
</ul>
<h3 data-id="heading-30">给开发者的明确指南</h3>
<ol>
<li>
<p><strong>适配核心</strong>：你的主要适配工作（处理 <code>MediaStore</code>，废弃老的 <code>File</code> API）都集中在<strong>需要读写公共目录</strong>的功能上。</p>
</li>
<li>
<p><strong>首选存储位置</strong>：</p>
<ul>
<li>
<p><strong>私有数据</strong>：优先放在<strong>内部存储</strong>或<strong>外部App专属目录</strong>。这里不需要处理Scoped Storage的复杂规则。</p>
</li>
<li>
<p><strong>共享文件</strong>：</p>
<ul>
<li>如果是图片/视频/音频 → 使用 <strong><code>MediaStore</code></strong> 写入对应的公共媒体目录。</li>
<li>如果是PDF、文档等 → 使用 <strong><code>Storage Access Framework (SAF)</code></strong>  让用户选择保存位置。</li>
</ul>
</li>
</ul>
</li>
<li>
<p><strong>权限申请</strong>：</p>
<ul>
<li>访问自己的App专属目录：<strong>不需要任何权限</strong>。</li>
<li>在Android 10上，如果还需要临时以老方式访问公共目录，可以在Manifest中设置 <code>requestLegacyExternalStorage=true</code>（但Android 11+此标志无效）。</li>
<li>在Android 11+上，如果App需要频繁访问设备上的所有媒体文件（如文件管理器、杀毒软件），可以申请新的 <strong><code>MANAGE_EXTERNAL_STORAGE</code></strong> 特殊权限，但上架Google Play时需要声明。</li>
</ul>
</li>
</ol>
<p><strong>一句话总结</strong>：Scoped Storage 就像给每个App在公共存储区建立了“<strong>专属保险柜</strong>”（App专属目录），并设立了“<strong>公共展览馆</strong>”（公共目录），App不能随便翻别人的保险柜，往展览馆放东西或看东西也得通过规定的流程(<code>MediaStore</code>/<code>SAF</code>)。而你的内部存储，就是你的“<strong>私人卧室</strong>”，完全不变。</p>
<h3 data-id="heading-31">filepaths.xml配置介绍</h3>
<p><code>FileProvider</code> 的 `` 配置就是用来将你 App 的私有文件路径映射成 <code>content://</code> URI 的“路由表”。</p>
<p>以下是<strong>完整详尽的配置范例</strong>，覆盖了所有你可能用到的目录：</p>
<h2 data-id="heading-32">完整的 <code>file_paths.xml</code> 配置模板</h2>
<pre><code class="hljs language-xml" lang="xml">    

    
    
    
    
    
    
    
    
    
    

    
    
    
    
    
    
    
    
    
    
    
    

    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    

    
    
    
    
        
    
    
     --&gt;

</code></pre>
<h2 data-id="heading-33">配置详解与使用示例</h2>
<h3 data-id="heading-34">1. <strong>标签类型与路径对应关系（核心）</strong></h3>













































<table><thead><tr><th>XML标签</th><th>对应的<strong>基准路径</strong></th><th>典型场景</th></tr></thead><tbody><tr><td>\</td><td>/data/data//</td><td>内部存储的 <code>files</code> 目录</td></tr><tr><td>\</td><td>/data/data//cache/</td><td>内部缓存目录</td></tr><tr><td>\</td><td>/storage/emulated/0/</td><td><strong>最常用</strong>：外部存储根目录</td></tr><tr><td>\</td><td><code>Context.getExternalFilesDir()</code> 返回的路径</td><td>外部App专属目录的父目录</td></tr><tr><td>\</td><td><code>Context.getExternalCacheDir()</code> 返回的路径</td><td>外部缓存目录的父目录</td></tr><tr><td>\</td><td><code>Context.getExternalMediaDirs()</code> 返回的第一个路径</td><td>外部媒体目录（API 21+）</td></tr><tr><td>\</td><td><code>/</code> (设备的<strong>真实根目录</strong>)</td><td><strong>极度危险</strong>，几乎用不到</td></tr></tbody></table>
<h3 data-id="heading-35">2. <strong><code>path</code> 属性的写法</strong></h3>
<ul>
<li><code>&amp;#34;.&amp;#34;</code> 表示匹配基准路径本身</li>
<li><code>&amp;#34;subfolder/&amp;#34;</code> 表示匹配基准路径下的子目录（末尾的 <code>/</code> 可选但推荐）</li>
<li>不能包含 <code>..</code> 或 <code>//</code>，也不能是绝对路径</li>
</ul>
<h3 data-id="heading-36">3. <strong>在代码中的使用示例</strong></h3>
<pre><code class="hljs language-kotlin" lang="kotlin">    <span class="hljs-comment">// 分享内部存储 files 目录下的一个文件</span>
<span class="hljs-keyword">val</span> internalFile = File(context.filesDir, &amp;#<span class="hljs-number">34</span>;secret.txt&amp;#<span class="hljs-number">34</span>;)
<span class="hljs-keyword">val</span> internalUri = FileProvider.getUriForFile(
    context,
    &amp;#<span class="hljs-number">34</span>;${context.packageName}.fileprovider&amp;#<span class="hljs-number">34</span>;,
    internalFile
)
<span class="hljs-comment">// 系统会自动根据文件路径，匹配到 </span>

<span class="hljs-comment">// 分享外部App专属 Pictures 目录下的一张图片</span>
<span class="hljs-keyword">val</span> externalPicFile = File(context.getExternalFilesDir(Environment.DIRECTORY_PICTURES), &amp;#<span class="hljs-number">34</span>;photo.jpg&amp;#<span class="hljs-number">34</span>;)
<span class="hljs-keyword">val</span> externalPicUri = FileProvider.getUriForFile(
    context,
    &amp;#<span class="hljs-number">34</span>;${context.packageName}.fileprovider&amp;#<span class="hljs-number">34</span>;,
    externalPicFile
)
<span class="hljs-comment">// 系统会自动匹配到 </span>
</code></pre>
<h2 data-id="heading-37">重要提醒</h2>
<ol>
<li>
<p><strong>包名占位符</strong>：配置中的 <strong><code>你的应用包名</code></strong> 需要替换成你实际的包名（如 <code>com.example.myapp</code>），或者你可以用 <code>.</code> 表示当前目录，但显式写出包名更清晰。</p>
</li>
<li>
<p><strong>按需配置</strong>：你<strong>不需要</strong>列出所有路径。<strong>只配置你实际会通过 <code>FileProvider</code> 分享文件的目录</strong>即可。更少的配置意味着更小的攻击面。</p>
</li>
<li>
<p><strong>安全警告</strong>：</p>
<ul>
<li><strong>切勿使用 ``</strong> ，这将暴露设备根目录，极度危险。</li>
<li>对于公共目录的配置，虽然列出来了，但在Android 10+上，由于Scoped Storage，你通常不会直接操作这些路径，而是通过<code>MediaStore</code>。这些配置主要为了兼容旧版本或特殊场景。</li>
</ul>
</li>
<li>
<p><strong>Android 11+ 注意</strong>：即使你为外部App专属目录配置了路径映射，其他App<strong>仍然无法直接访问</strong>。这个配置只是为了让 <code>FileProvider</code> 能正确生成URI，系统仍会强制执行访问隔离。</p>
</li>
</ol>
<p><strong>最精简的常用配置</strong>（适合大多数App）：</p>
<pre><code class="hljs language-kotlin" lang="kotlin">

    
    
    
    

</code></pre>
<p>这个清单应该覆盖了你所有的使用场景。根据你的实际需求，选择必要的路径进行配置即可。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[iOS逆向-哔哩哔哩增加3倍速（1）-最大播放速度]]></title>    <link>https://juejin.cn/post/7582063437414285350</link>    <guid>https://juejin.cn/post/7582063437414285350</guid>    <pubDate>2025-12-11T00:02:07.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7582063437414285350" data-draft-id="7582063437413695526" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="iOS逆向-哔哩哔哩增加3倍速（1）-最大播放速度"/> <meta itemprop="keywords" content="iOS,逆向"/> <meta itemprop="datePublished" content="2025-12-11T00:02:07.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="TouchWorld"/> <meta itemprop="url" content="https://juejin.cn/user/2717648473557143"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            iOS逆向-哔哩哔哩增加3倍速（1）-最大播放速度
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2717648473557143/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    TouchWorld
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-11T00:02:07.000Z" title="Thu Dec 11 2025 00:02:07 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-11
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读10分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">前言</h2>
<p>作为一名 <strong>哔哩哔哩的重度用户</strong>，我一直期待官方推出 <strong>3 倍速播放</strong> 功能。然而等了许久，这个功能始终没有上线 😮‍💨。</p>
<p>修改前效果：
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ef8e2cfb37be457ba94d02fda26ef959~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVG91Y2hXb3JsZA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766016127&amp;x-signature=U975y6avDAAcG6dbMh1chcJMrmA%3D" alt="Screenshot 2025-12-11 at 07.26.05.png" loading="lazy"/></p>
<p>刚好我自己熟悉 <code>iOS</code> 逆向工程，于是决定 <strong>亲自动手，为 B 站加入 3 倍速播放</strong> 😆。</p>
<p>修改后效果：
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9d6a56e360904fecae8867827e9d4e18~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVG91Y2hXb3JsZA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766016127&amp;x-signature=7K%2BsKau2o8voS7iKaKPBOkp7IeQ%3D" alt="Screenshot 2025-12-11 at 07.22.57.png" loading="lazy"/></p>
<p>由于整个过程涉及 <strong>多处逻辑修改与多个模块的反汇编分析</strong>，为了让内容更加清晰易读，我将会分成多篇文章，逐步拆解 <strong>如何为 B 站增加 3 倍速播放能力</strong>。</p>
<h2 data-id="heading-1">场景</h2>
<p>哔哩哔哩的视频播放页面</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/336d8de5197740eb887a5df45ad144e3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVG91Y2hXb3JsZA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766016127&amp;x-signature=jNlBaGEGSgQ3LVSMEUVCVegwA%2B4%3D" alt="8C0CA5C5-C2D9-4E60-9BB0-0FF3B83A03DA-5346442.png" loading="lazy"/></p>
<h2 data-id="heading-2">开发环境</h2>
<ul>
<li>哔哩哔哩版本：<code>8.41.0</code></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FAloneMonkey%2FMonkeyDev" target="_blank" title="https://github.com/AloneMonkey/MonkeyDev" ref="nofollow noopener noreferrer">MonkeyDev</a></li>
<li><code>IDA Professional 9.0</code></li>
<li>安装IDA插件：<code>patching</code></li>
<li><code>Lookin</code></li>
</ul>
<h2 data-id="heading-3">目标</h2>
<p>视频最大播放速度改为<strong>4倍速</strong>播放</p>
<h2 data-id="heading-4">分析</h2>
<ul>
<li>我们知道哔哩哔哩开源了他们的视频播放器<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fbilibili%2Fijkplayer" target="_blank" title="https://github.com/bilibili/ijkplayer" ref="nofollow noopener noreferrer">ijkplayer</a>，我们可以从中了解到设置播放速度的方法,是<code>IJKFFMoviePlayerController</code>的<code>- (void)setPlaybackRate:(float)playbackRate</code></li>
</ul>
<pre><code class="hljs language-objc" lang="objc"><span class="hljs-class"><span class="hljs-keyword">@interface</span> <span class="hljs-title">IJKFFMoviePlayerController</span> : <span class="hljs-title">NSObject</span> </span>

<span class="hljs-keyword">@property</span> (<span class="hljs-keyword">nonatomic</span>) <span class="hljs-type">float</span> playbackRate;

<span class="hljs-keyword">@end</span>

</code></pre>
<ul>
<li>从<code>Mach-O</code>文件导出的<code>IJKFFMoviePlayerController</code>的<code>OC</code>头文件可以知道，它有一个<code>maxPlaybackRate</code>属性，应该是最大播放速度</li>
</ul>
<pre><code class="hljs language-objc" lang="objc"><span class="hljs-comment">// IJKFFMoviePlayerController.h</span>
<span class="hljs-class"><span class="hljs-keyword">@interface</span> <span class="hljs-title">IJKFFMoviePlayerController</span> : <span class="hljs-title">NSObject</span>  </span>{
    <span class="hljs-comment">/* instance variables */</span>
    <span class="hljs-type">id</span>  _player;
}

...
<span class="hljs-keyword">@property</span> (<span class="hljs-keyword">readonly</span>, <span class="hljs-keyword">nonatomic</span>) <span class="hljs-type">double</span> realCurrentPlaybackTime;
<span class="hljs-keyword">@property</span> (<span class="hljs-keyword">readonly</span>, <span class="hljs-keyword">nonatomic</span>) <span class="hljs-type">float</span> realPlaybackRate;
<span class="hljs-keyword">@property</span> (<span class="hljs-keyword">readonly</span>, <span class="hljs-keyword">nonatomic</span>) <span class="hljs-type">float</span> maxPlaybackRate;
<span class="hljs-keyword">@property</span> (<span class="hljs-keyword">readonly</span>, <span class="hljs-keyword">nonatomic</span>) IJKMediaPlayerItem *currentItem;
...
</code></pre>
<ul>
<li>我们<code>hook</code> <code>IJKFFMoviePlayerController</code>的<code>- (void)setPlaybackRate:(float)playbackRate</code>，添加断点并打印一些日志，其中就有打印<code>maxPlaybackRate</code>
<ul>
<li><code>inputPlaybackRate</code>：要设置的播放速度</li>
<li><code>changedPlaybackRate</code>：更改后的播放速度</li>
<li><code>realPlaybackRate</code>：真实播放速度</li>
<li><code>maxPlaybackRate</code>：最大播放速度</li>
</ul>
</li>
</ul>
<pre><code class="hljs language-objc" lang="objc">%hook IJKFFMoviePlayerController

- (<span class="hljs-type">void</span>)setPlaybackRate:(<span class="hljs-type">float</span>)playbackRate {
    %orig(playbackRate);
    <span class="hljs-built_in">NSLog</span>(@&amp;#<span class="hljs-number">34</span>;%@:%@-%p-%s-inputPlaybackRate:%lf-changedPlaybackRate:%lf-realPlaybackRate%lf-maxPlaybackRate:%lf&amp;#<span class="hljs-number">34</span>;, nj_logPrefix, <span class="hljs-built_in">NSStringFromClass</span>([(<span class="hljs-type">id</span>)<span class="hljs-keyword">self</span> <span class="hljs-keyword">class</span>]), <span class="hljs-keyword">self</span>, __FUNCTION__, playbackRate, <span class="hljs-keyword">self</span>.playbackRate, <span class="hljs-keyword">self</span>.realPlaybackRate, <span class="hljs-keyword">self</span>.maxPlaybackRate);
}

%end
</code></pre>
<ul>
<li>每次设置播放速度，<code>IJKFFMoviePlayerController</code>的<code>- (void)setPlaybackRate:(float)playbackRate</code>的断点都会触发，我们从日志中可以看到，<strong>最大播放速度为<code>3.0</code></strong></li>
</ul>
<pre><code class="hljs language-objc" lang="objc">cxzcxz:IJKFFMoviePlayerController<span class="hljs-number">-0x280519220</span>-_logos_method$App$IJKFFMoviePlayerController$setPlaybackRate$-inputPlaybackRate:<span class="hljs-number">1.500000</span>-changedPlaybackRate:<span class="hljs-number">1.500000</span>-realPlaybackRate0<span class="hljs-number">.000000</span>-maxPlaybackRate:<span class="hljs-number">3.000000</span>
</code></pre>
<ul>
<li>因为倍速面板无法选择超过<code>2.0</code>的速度，所以我们就设置，如果倍速面板选择的是<code>2.0</code>，我们就改成<code>4.0</code>，看是否会限制播放速度到<code>3.0</code></li>
</ul>
<pre><code class="hljs language-objc" lang="objc">%hook IJKFFMoviePlayerController

- (<span class="hljs-type">void</span>)setPlaybackRate:(<span class="hljs-type">float</span>)playbackRate {
    playbackRate = playbackRate == <span class="hljs-number">2.0</span> ? <span class="hljs-number">4.0</span> : playbackRate;
    %orig(playbackRate);
    <span class="hljs-built_in">NSLog</span>(@&amp;#<span class="hljs-number">34</span>;%@:%@-%p-%s-inputPlaybackRate:%lf-changedPlaybackRate:%lf-realPlaybackRate%lf-maxPlaybackRate:%lf&amp;#<span class="hljs-number">34</span>;, nj_logPrefix, <span class="hljs-built_in">NSStringFromClass</span>([(<span class="hljs-type">id</span>)<span class="hljs-keyword">self</span> <span class="hljs-keyword">class</span>]), <span class="hljs-keyword">self</span>, __FUNCTION__, playbackRate, <span class="hljs-keyword">self</span>.playbackRate, <span class="hljs-keyword">self</span>.realPlaybackRate, <span class="hljs-keyword">self</span>.maxPlaybackRate);
}

%end
</code></pre>
<ul>
<li>倍速面板选择<code>2.0</code>，从日志中可以看到，播放速度(<code>changedPlaybackRate</code>)改成了<code>3.0</code>而不是<code>4.0</code>，这也证明<code>maxPlaybackRate</code>就是最大播放速度</li>
</ul>
<pre><code class="hljs language-objc" lang="objc">cxzcxz:IJKFFMoviePlayerController<span class="hljs-number">-0x281304380</span>-_logos_method$App$IJKFFMoviePlayerController$setPlaybackRate$-inputPlaybackRate:<span class="hljs-number">4.000000</span>-changedPlaybackRate:<span class="hljs-number">3.000000</span>-realPlaybackRate0<span class="hljs-number">.000000</span>-maxPlaybackRate:<span class="hljs-number">3.000000</span>
</code></pre>
<ul>
<li>我们尝试<code>hook</code> <code>maxPlaybackRate</code>的<code>getter</code>方法，看能不能修改最大播放速度？</li>
</ul>
<pre><code class="hljs language-objc" lang="objc">%hook IJKFFMoviePlayerController

- (<span class="hljs-type">void</span>)setPlaybackRate:(<span class="hljs-type">float</span>)playbackRate {
    playbackRate = playbackRate == <span class="hljs-number">2.0</span> ? <span class="hljs-number">4.0</span> : playbackRate;
    %orig(playbackRate);
    <span class="hljs-built_in">NSLog</span>(@&amp;#<span class="hljs-number">34</span>;%@:%@-%p-%s-inputPlaybackRate:%lf-changedPlaybackRate:%lf-realPlaybackRate%lf-maxPlaybackRate:%lf&amp;#<span class="hljs-number">34</span>;, nj_logPrefix, <span class="hljs-built_in">NSStringFromClass</span>([(<span class="hljs-type">id</span>)<span class="hljs-keyword">self</span> <span class="hljs-keyword">class</span>]), <span class="hljs-keyword">self</span>, __FUNCTION__, playbackRate, <span class="hljs-keyword">self</span>.playbackRate, <span class="hljs-keyword">self</span>.realPlaybackRate, <span class="hljs-keyword">self</span>.maxPlaybackRate);
}

- (<span class="hljs-type">float</span>)maxPlaybackRate {
    <span class="hljs-keyword">return</span> <span class="hljs-number">4.0</span>;
}

%end
</code></pre>
<ul>
<li>从日志可以看到，虽然<code>maxPlaybackRate</code>的输出值改成了<code>4.0</code>，但是播放速度(<code>changedPlaybackRate</code>)还是<code>3.0</code>，所以修改无效</li>
</ul>
<pre><code class="hljs language-objc" lang="objc">cxzcxz:IJKFFMoviePlayerController<span class="hljs-number">-0x2808e2a40</span>-_logos_method$App$IJKFFMoviePlayerController$setPlaybackRate$-inputPlaybackRate:<span class="hljs-number">4.000000</span>-changedPlaybackRate:<span class="hljs-number">3.000000</span>-realPlaybackRate0<span class="hljs-number">.000000</span>-maxPlaybackRate:<span class="hljs-number">4.000000</span>
</code></pre>
<ul>
<li>我们从<code>IDA</code>中查看<code>IJKFFMoviePlayerController</code>的<code>- (void)setPlaybackRate:(float)playbackRate</code>伪代码实现，发现调用的是[<code>self-&gt;_player setPlaybackRate:]</code>方法</li>
</ul>
<pre><code class="hljs language-objc" lang="objc"><span class="hljs-type">void</span> __cdecl -[IJKFFMoviePlayerController setPlaybackRate:](IJKFFMoviePlayerController *<span class="hljs-keyword">self</span>, SEL a2, <span class="hljs-type">float</span> a3)
{
  -[IJKMediaPlayback setPlaybackRate:](<span class="hljs-keyword">self</span>-&gt;_player, &amp;#<span class="hljs-number">34</span>;setPlaybackRate:&amp;#<span class="hljs-number">34</span>;);
}
</code></pre>
<ul>
<li>我们给<code>IJKFFMoviePlayerController</code>的<code>- (void)setPlaybackRate:(float)playbackRate</code>，添加断点，看看<code>self-&gt;_player</code>的值是什么？</li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c1e3ddf7a869491c897445a834e70883~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVG91Y2hXb3JsZA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766016127&amp;x-signature=lV0Zf1%2BpySH2emeuEs0c0ith7qI%3D" alt="C72ACE3B-EA9B-4684-A7AB-71C162A27F1E.png" loading="lazy"/></p>
<ul>
<li>断点触发，发现<code>self-&gt;_player</code>的类型是<code>IJKFFMoviePlayerControllerFFPlay</code></li>
</ul>
<pre><code class="hljs language-objc" lang="objc">(lldb) po <span class="hljs-keyword">self</span>-&gt;_player

</code></pre>
<ul>
<li>从<code>Mach-O</code>文件导出的<code>IJKFFMoviePlayerControllerFFPlay</code>的<code>OC</code>头文件可以知道，<code>IJKFFMoviePlayerControllerFFPlay</code>是一个视频播放器，看来<code>IJKFFMoviePlayerController</code>是基于<code>IJKFFMoviePlayerControllerFFPlay</code>实现的</li>
</ul>
<pre><code class="hljs language-objc" lang="objc"><span class="hljs-class"><span class="hljs-keyword">@interface</span> <span class="hljs-title">IJKFFMoviePlayerControllerFFPlay</span> : <span class="hljs-title">NSObject</span>  </span>{
    <span class="hljs-comment">/* instance variables */</span>
    <span class="hljs-keyword">struct</span> IjkMediaPlayer * _mediaPlayer;
...
<span class="hljs-keyword">@property</span> (<span class="hljs-keyword">weak</span>, <span class="hljs-keyword">nonatomic</span>) IJKMediaPlayerItem *item;
<span class="hljs-keyword">@property</span> (<span class="hljs-keyword">retain</span>, <span class="hljs-keyword">nonatomic</span>) <span class="hljs-type">id</span>  fileOpenDelegate;
<span class="hljs-keyword">@property</span> (<span class="hljs-keyword">retain</span>, <span class="hljs-keyword">nonatomic</span>) <span class="hljs-type">id</span>  segmentOpenDelegate;
<span class="hljs-keyword">@property</span> (<span class="hljs-keyword">readonly</span>, <span class="hljs-keyword">nonatomic</span>) <span class="hljs-type">double</span> fpsInMeta;
<span class="hljs-keyword">@property</span> (<span class="hljs-keyword">readonly</span>, <span class="hljs-keyword">nonatomic</span>) <span class="hljs-type">double</span> fpsAtOutput;
<span class="hljs-keyword">@property</span> (<span class="hljs-keyword">nonatomic</span>) _Bool shouldShowHudView;
<span class="hljs-keyword">@property</span> (<span class="hljs-keyword">readonly</span>, <span class="hljs-keyword">nonatomic</span>) <span class="hljs-type">long</span> <span class="hljs-type">long</span> numberOfBytesTransferred;
<span class="hljs-keyword">@property</span> (<span class="hljs-keyword">nonatomic</span>) _Bool allowsMediaAirPlay;
<span class="hljs-keyword">@property</span> (<span class="hljs-keyword">nonatomic</span>) _Bool isDanmakuMediaAirPlay;
<span class="hljs-keyword">@property</span> (<span class="hljs-keyword">readonly</span>, <span class="hljs-keyword">nonatomic</span>) _Bool airPlayMediaActive;
<span class="hljs-keyword">@property</span> (<span class="hljs-keyword">readonly</span>, <span class="hljs-keyword">nonatomic</span>) <span class="hljs-type">int</span> isSeekBuffering;
<span class="hljs-keyword">@property</span> (<span class="hljs-keyword">readonly</span>, <span class="hljs-keyword">nonatomic</span>) <span class="hljs-type">int</span> isAudioSync;
<span class="hljs-keyword">@property</span> (<span class="hljs-keyword">readonly</span>, <span class="hljs-keyword">nonatomic</span>) <span class="hljs-type">int</span> isVideoSync;
<span class="hljs-keyword">@property</span> (<span class="hljs-keyword">readonly</span>, <span class="hljs-keyword">nonatomic</span>) <span class="hljs-type">int</span> currentVideoIdentifier;
<span class="hljs-keyword">@property</span> (<span class="hljs-keyword">readonly</span>, <span class="hljs-keyword">nonatomic</span>) <span class="hljs-type">int</span> currentAudioIdentifier;
<span class="hljs-keyword">@property</span> (<span class="hljs-keyword">readonly</span>, <span class="hljs-keyword">nonatomic</span>) <span class="hljs-type">double</span> realCurrentPlaybackTime;
<span class="hljs-keyword">@property</span> (<span class="hljs-keyword">readonly</span>, <span class="hljs-keyword">nonatomic</span>) <span class="hljs-type">float</span> realPlaybackRate;
<span class="hljs-keyword">@property</span> (<span class="hljs-keyword">readonly</span>, <span class="hljs-keyword">nonatomic</span>) <span class="hljs-type">float</span> maxPlaybackRate;
<span class="hljs-keyword">@property</span> (<span class="hljs-keyword">readonly</span>, <span class="hljs-keyword">nonatomic</span>) IJKMediaPlayerItem *currentItem;
...
</code></pre>
<ul>
<li>我们从<code>IDA</code>中查看<code>IJKFFMoviePlayerControllerFFPlay</code>的<code>- (void)setPlaybackRate:(float)playbackRate</code>伪代码实现，发现跟开源版本的<code>IJKFFMoviePlayerController</code>的<code>- (void)setPlaybackRate:(float)playbackRate</code>是一致的</li>
</ul>
<pre><code class="hljs language-objc" lang="objc"><span class="hljs-comment">// 哔哩哔哩版本</span>
<span class="hljs-type">void</span> __cdecl -[IJKFFMoviePlayerControllerFFPlay setPlaybackRate:](
        IJKFFMoviePlayerControllerFFPlay *<span class="hljs-keyword">self</span>,
        SEL a2,
        <span class="hljs-type">float</span> a3)
{
  sub_10F3F5768(
    <span class="hljs-number">0</span>LL,
    <span class="hljs-number">32</span>LL,
    &amp;#<span class="hljs-number">34</span>;IJKFFMoviePlayerControllerFFPlay: setPlaybackRate ts = %lld, playbackRate = %f\n&amp;#<span class="hljs-number">34</span>;,
    +[IJKFFUtils getIjkTickHR](&amp;OBJC_CLASS___IJKFFUtils, &amp;#<span class="hljs-number">34</span>;getIjkTickHR&amp;#<span class="hljs-number">34</span>;),
    a3);
  <span class="hljs-keyword">if</span> ( <span class="hljs-keyword">self</span>-&gt;_mediaPlayer )
    sub_10F0BAFD4(a3);
}
</code></pre>
<pre><code class="hljs language-objc" lang="objc"><span class="hljs-comment">// 开源版本</span>
- (<span class="hljs-type">void</span>)setPlaybackRate:(<span class="hljs-type">float</span>)playbackRate
{
    <span class="hljs-keyword">if</span> (!_mediaPlayer)
        <span class="hljs-keyword">return</span>;

    <span class="hljs-keyword">return</span> ijkmp_set_playback_rate(_mediaPlayer, playbackRate);
}
</code></pre>
<ul>
<li>我们从<code>IDA</code>中查看<code>sub_10F0BAFD4</code>的伪代码实现，发现跟开源版本的<code>ijkmp_set_playback_rate</code>的实现是一致的</li>
</ul>
<pre><code class="hljs language-objc" lang="objc"><span class="hljs-comment">// 哔哩哔哩版本</span>
__int64 __fastcall sub_10F0BAFD4(__int64 a1, <span class="hljs-type">float</span> a2)
{
  printf(&amp;#<span class="hljs-number">34</span>;%s(%f)\n&amp;#<span class="hljs-number">34</span>;, &amp;#<span class="hljs-number">34</span>;ijkmp_set_playback_rate&amp;#<span class="hljs-number">34</span>;, a2);
  pthread_mutex_lock((pthread_mutex_t *)(a1 + <span class="hljs-number">8</span>));
  sub_10F0A70B4(*(_QWORD *)(a1 + <span class="hljs-number">136</span>), a2);
  pthread_mutex_unlock((pthread_mutex_t *)(a1 + <span class="hljs-number">8</span>));
  <span class="hljs-keyword">return</span> printf(&amp;#<span class="hljs-number">34</span>;%s()=<span class="hljs-type">void</span>\n&amp;#<span class="hljs-number">34</span>;, &amp;#<span class="hljs-number">34</span>;ijkmp_set_playback_rate&amp;#<span class="hljs-number">34</span>;);
}
</code></pre>
<pre><code class="hljs language-objc" lang="objc"><span class="hljs-comment">// 开源版本</span>
<span class="hljs-type">void</span> ijkmp_set_playback_rate(IjkMediaPlayer *mp, <span class="hljs-type">float</span> rate)
{
    assert(mp);

    <span class="hljs-built_in">MPTRACE</span>(&amp;#<span class="hljs-number">34</span>;%s(%f)\n&amp;#<span class="hljs-number">34</span>;, __func__, rate);
    pthread_mutex_lock(&amp;mp-&gt;mutex);
    ffp_set_playback_rate(mp-&gt;ffplayer, rate);
    pthread_mutex_unlock(&amp;mp-&gt;mutex);
    <span class="hljs-built_in">MPTRACE</span>(&amp;#<span class="hljs-number">34</span>;%s()=<span class="hljs-type">void</span>\n&amp;#<span class="hljs-number">34</span>;, __func__);
}
</code></pre>
<ul>
<li>我们从<code>IDA</code>中查看<code>sub_10F0A70B4</code>的伪代码实现，可以知道是从<code>sub_10F101034</code>获取最大播放速度的</li>
</ul>
<pre><code class="hljs language-objc" lang="objc">__int64 __fastcall sub_10F0A70B4(__int64 result, <span class="hljs-type">float</span> a2)
{
  __int64 v3; <span class="hljs-comment">// x19</span>
  <span class="hljs-type">float</span> v4; <span class="hljs-comment">// s0</span>
  __int64 v5; <span class="hljs-comment">// x8</span>
  <span class="hljs-type">float</span> v6; <span class="hljs-comment">// s1</span>
  <span class="hljs-type">float</span> v7; <span class="hljs-comment">// [xsp+1Ch] [xbp-24h] BYREF</span>

  <span class="hljs-keyword">if</span> ( result )
  {
    v3 = result;
    v7 = <span class="hljs-number">0.0</span>;
    sub_10F101034(<span class="hljs-number">10</span>LL, &amp;v7, <span class="hljs-number">4</span>LL);
    <span class="hljs-keyword">if</span> ( v7 &lt; a2 )
    {
      sub_10F3F5768(<span class="hljs-number">0</span>LL, <span class="hljs-number">32</span>LL, &amp;#<span class="hljs-number">34</span>;%s: origin %f, new %f \n&amp;#<span class="hljs-number">34</span>;, &amp;#<span class="hljs-number">34</span>;adjust_playback_rate&amp;#<span class="hljs-number">34</span>;, a2, v7);
      a2 = v7;
    }
    sub_10F3F5768((__int64 *)v3, <span class="hljs-number">32</span>LL, &amp;#<span class="hljs-number">34</span>;Playback rate: %f\n&amp;#<span class="hljs-number">34</span>;, a2);
    <span class="hljs-keyword">if</span> ( a2 == <span class="hljs-number">0.0</span> )
      v4 = <span class="hljs-number">1.0</span>;
    <span class="hljs-keyword">else</span>
      v4 = a2;
    <span class="hljs-keyword">if</span> ( v4 != <span class="hljs-number">1.0</span> )
      *(_DWORD *)(v3 + <span class="hljs-number">884</span>) = <span class="hljs-number">1</span>;
    v5 = *(_QWORD *)(v3 + <span class="hljs-number">8</span>);
    <span class="hljs-keyword">if</span> ( v5 )
    {
      v6 = *(<span class="hljs-type">float</span> *)(v3 + <span class="hljs-number">876</span>);
      <span class="hljs-keyword">if</span> ( v6 != v4 )
        *(<span class="hljs-type">double</span> *)(v5 + <span class="hljs-number">8040</span>) = vabds_f32(v6, v4);
    }
    <span class="hljs-keyword">if</span> ( v4 &gt; *(<span class="hljs-type">float</span> *)(v3 + <span class="hljs-number">6724</span>) )
      *(<span class="hljs-type">float</span> *)(v3 + <span class="hljs-number">6724</span>) = v4;
    *(<span class="hljs-type">float</span> *)(v3 + <span class="hljs-number">876</span>) = v4;
    *(_DWORD *)(v3 + <span class="hljs-number">880</span>) = <span class="hljs-number">1</span>;
    <span class="hljs-keyword">return</span> sub_10F100F98(<span class="hljs-number">8</span>LL, v3 + <span class="hljs-number">9272</span>);
  }
  <span class="hljs-keyword">return</span> result;
}
</code></pre>
<ul>
<li>我们从<code>IDA</code>中查看<code>sub_10F101034</code>的伪代码实现，再根据<code>sub_10F101034(10LL, &amp;v7, 4LL)</code>; 知道参数<code>a1=10，a3=4</code>，将伪代码和参数交给<code>chatgpt</code>分析，得出下面几个结论:
<ul>
<li><code>sub_10F10449C(a9)</code> 计算最大播放速度</li>
<li>该函数内部会将计算结果放入某个寄存器（例如 <code>d0</code>）</li>
<li>解码器将其反编译成 <code>v14</code></li>
<li><code>LABEL_38 → v13 = v14</code></li>
<li>最终写入：<code>*(float*)a2 = v13</code></li>
</ul>
</li>
</ul>
<pre><code class="hljs language-objc" lang="objc"><span class="hljs-type">void</span> __fastcall sub_10F101034(
        <span class="hljs-type">int</span> a1,
        <span class="hljs-type">double</span> *a2,
        __int64 a3,
        __int64 a4,
        __int64 a5,
        __int64 a6,
        __int64 a7,
        __int64 a8,
        _QWORD *a9,
        __int64 a10,
        <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> a11,
        __int64 a12)
{
  <span class="hljs-type">float</span> v13; <span class="hljs-comment">// s0</span>
  <span class="hljs-type">double</span> v14; <span class="hljs-comment">// d0</span>
  __int64 v15; <span class="hljs-comment">// x20</span>
  <span class="hljs-type">int</span> v16; <span class="hljs-comment">// w0</span>
  __int64 *v17; <span class="hljs-comment">// [xsp+18h] [xbp-68h] BYREF</span>
  __int64 v18; <span class="hljs-comment">// [xsp+20h] [xbp-60h]</span>
  __int64 v19; <span class="hljs-comment">// [xsp+30h] [xbp-50h]</span>
  <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> *v20; <span class="hljs-comment">// [xsp+58h] [xbp-28h]</span>

  <span class="hljs-keyword">if</span> ( a2 &amp;&amp; a3 )
  {
    <span class="hljs-keyword">switch</span> ( a1 )
    {
...
      <span class="hljs-keyword">case</span> <span class="hljs-number">10</span>:
        <span class="hljs-keyword">if</span> ( a3 == <span class="hljs-number">4</span> )
        {
          v17 = &amp;a10;
          sub_10F10449C((<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)a9);
          <span class="hljs-keyword">goto</span> LABEL_38;
        }
        <span class="hljs-keyword">break</span>;
...
LABEL_38:
            v13 = v14;
          }
LABEL_44:
          *(<span class="hljs-type">float</span> *)a2 = v13;
        }
        <span class="hljs-keyword">break</span>;
...
</code></pre>
<ul>
<li>我们从<code>IDA</code>中查看<code>sub_10F10449C</code>的伪代码实现，发现有可能返回两个值，一个是<code>2.0</code>，一个是全局变量<code>qword_117084280</code>的值</li>
</ul>
<pre><code class="hljs language-objc" lang="objc"><span class="hljs-type">double</span> __fastcall sub_10F10449C(__int64 a1)
{
  __int64 v2; <span class="hljs-comment">// x0</span>
  <span class="hljs-type">double</span> result; <span class="hljs-comment">// d0</span>
  <span class="hljs-type">double</span> v4[<span class="hljs-number">6</span>]; <span class="hljs-comment">// [xsp+0h] [xbp-40h] BYREF</span>

  v2 = sub_10F104600();
  sub_10F104B7C(v4, v2, a1);
  result = <span class="hljs-number">2.0</span>;
  <span class="hljs-keyword">if</span> ( v4[<span class="hljs-number">0</span>] &lt; <span class="hljs-number">50.0</span> )
    <span class="hljs-keyword">return</span> *(<span class="hljs-type">double</span> *)&amp;qword_117084280;
  <span class="hljs-keyword">return</span> result;
}
</code></pre>
<ul>
<li>我们查看全局变量<code>qword_117084280</code>的值，发现是<code>3.0</code>，而<code>3.0</code>就是最大播放速度
<ul>
<li>
<p><code>qword_117084280</code>的<code>16</code>进制值</p>
<pre><code class="hljs language-objc" lang="objc"><span class="hljs-number">0000000117084280</span>  <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">08</span> <span class="hljs-number">40</span>  <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span>
</code></pre>
</li>
<li>
<p>关键是前 <code>8</code> 字节：</p>
<pre><code class="hljs language-objc" lang="objc"><span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">08</span> <span class="hljs-number">40</span>
</code></pre>
</li>
<li>
<p><code>ARM64</code>、<code>Mach-O</code> 中 <code>double</code> 存储方式都是 <code>little-endian</code>，所以按小端序解析：</p>
<pre><code class="hljs language-objc" lang="objc"><span class="hljs-number">40</span> <span class="hljs-number">08</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span>
</code></pre>
</li>
<li>
<p><code>IEEE-754</code> 双精度格式：</p>
<pre><code class="hljs language-objc" lang="objc"><span class="hljs-number">0x4008000000000000</span> → <span class="hljs-number">3.0</span>（<span class="hljs-type">double</span>）
</code></pre>
</li>
<li>
<p>所以<code>qword_117084280 = 3.0</code></p>
</li>
</ul>
</li>
<li>我们添加符号断点<code>sub_10F10449C</code>，看它的返回值多少</li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a7f11e045b4f4faeb513a779a5ec679e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVG91Y2hXb3JsZA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766016127&amp;x-signature=3BNwQ%2FlaWKjzjZzxuyN6R5hcX8g%3D" alt="C291B52E-537E-494A-A8C4-8332634DEC40.png" loading="lazy"/></p>
<ul>
<li><code>sub_10F10449C</code>断点触发，返回值发现是<code>3.0</code>，这样就验证了全局变量<code>qword_117084280</code>的值是<code>3.0</code></li>
</ul>
<pre><code class="hljs language-objc" lang="objc">(lldb) <span class="hljs-keyword">register</span> read d0
      d0 = <span class="hljs-number">3</span>
</code></pre>
<ul>
<li><strong>总结</strong>：哔哩哔哩的最大播放速度方法是<code>sub_10F10449C</code>，最大播放速度有可能是<code>2</code>倍速，也可能是<code>3</code>倍速，猜测跟视频有关。</li>
</ul>
<h2 data-id="heading-5">越狱解决方案</h2>
<p>我们<code>hook</code> <code>sub_10F10449C</code>，将最大值改为<code>4.0</code></p>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-comment">// 视频最大播放速度</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">let</span> maxPlaybackRateValue <span class="hljs-operator">=</span> <span class="hljs-number">4.0</span>

<span class="hljs-comment">// 声明原函数类型</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">typealias</span> orig_get_max_playback_rate_type <span class="hljs-operator">=</span> <span class="hljs-keyword">@convention(c)</span> (<span class="hljs-keyword">_</span> a1: <span class="hljs-type">Int64</span>) -&gt; <span class="hljs-type">Double</span>

<span class="hljs-comment">// 定义全局函数指针变量，并绑定一个 C 名字</span>
<span class="hljs-meta">@_silgen_name</span>(<span class="hljs-operator">&amp;</span>#<span class="hljs-number">34</span>;orig_get_max_playback_rate<span class="hljs-operator">&amp;</span>#<span class="hljs-number">34</span>;)
<span class="hljs-keyword">nonisolated</span>(unsafe) <span class="hljs-keyword">public</span> <span class="hljs-keyword">var</span> orig_get_max_playback_rate: orig_get_max_playback_rate_type<span class="hljs-operator">?</span> <span class="hljs-operator">=</span> <span class="hljs-literal">nil</span>

<span class="hljs-comment">// 获取最大播放速度方法</span>
<span class="hljs-meta">@_cdecl</span>(<span class="hljs-operator">&amp;</span>#<span class="hljs-number">34</span>;my_get_max_playback_rate<span class="hljs-operator">&amp;</span>#<span class="hljs-number">34</span>;)
<span class="hljs-keyword">func</span> <span class="hljs-title function_">my_get_max_playback_rate</span>(<span class="hljs-params">a1</span>: <span class="hljs-type">Int64</span>) -&gt; <span class="hljs-type">Double</span> {
    <span class="hljs-keyword">return</span> maxPlaybackRateValue
}
</code></pre>
<pre><code class="hljs language-objc" lang="objc"><span class="hljs-comment">// 获取最大播放速度方法</span>
<span class="hljs-type">long</span> <span class="hljs-type">long</span> get_max_playback_rate_address = g_slide+<span class="hljs-number">0x10F10449C</span>;
<span class="hljs-built_in">NSLog</span>(@&amp;#<span class="hljs-number">34</span>;[%@] cal func get_max_playback_rate address:<span class="hljs-number">0</span>x%llx&amp;#<span class="hljs-number">34</span>;, nj_logPrefix, get_max_playback_rate_address);
MSHookFunction((<span class="hljs-type">void</span> *)get_max_playback_rate_address,
			   (<span class="hljs-type">void</span>*)my_get_max_playback_rate,
			   (<span class="hljs-type">void</span>**)&amp;orig_get_max_playback_rate);
</code></pre>
<ul>
<li>我们再<code>hook</code> <code>IJKFFMoviePlayerControllerFFPlay</code>的<code>- (void)setPlaybackRate:(float)playbackRate</code>方法，用以打印日志</li>
</ul>
<pre><code class="hljs language-objc" lang="objc">%hook IJKFFMoviePlayerControllerFFPlay

- (<span class="hljs-type">void</span>)setPlaybackRate:(<span class="hljs-type">float</span>)playbackRate {
    playbackRate = playbackRate == <span class="hljs-number">2.0</span> ? <span class="hljs-number">4.0</span> : playbackRate;
    %orig(playbackRate);
    <span class="hljs-built_in">NSLog</span>(@&amp;#<span class="hljs-number">34</span>;%@:%@-%p-%s-inputPlaybackRate:%lf-changedPlaybackRate:%lf-realPlaybackRate%lf-maxPlaybackRate:%lf&amp;#<span class="hljs-number">34</span>;, nj_logPrefix, <span class="hljs-built_in">NSStringFromClass</span>([(<span class="hljs-type">id</span>)<span class="hljs-keyword">self</span> <span class="hljs-keyword">class</span>]), <span class="hljs-keyword">self</span>, __FUNCTION__, playbackRate, <span class="hljs-keyword">self</span>.playbackRate, <span class="hljs-keyword">self</span>.realPlaybackRate, <span class="hljs-keyword">self</span>.maxPlaybackRate);
}

%end
</code></pre>
<ul>
<li>倍速面板选择<code>2.0</code>，从日志中可以看到，最大播放速度<code>(maxPlaybackRate)改成了4.0</code>，播放速度(<code>changedPlaybackRate</code>)改成了<code>4.0</code>，👍</li>
</ul>
<pre><code class="hljs language-objc" lang="objc">cxzcxz:IJKFFMoviePlayerControllerFFPlay<span class="hljs-number">-0x136428000</span>-_logos_method$App$IJKFFMoviePlayerControllerFFPlay$setPlaybackRate$-inputPlaybackRate:<span class="hljs-number">4.000000</span>-changedPlaybackRate:<span class="hljs-number">4.000000</span>-realPlaybackRate0<span class="hljs-number">.000000</span>-maxPlaybackRate:<span class="hljs-number">4.000000</span>
</code></pre>
<h2 data-id="heading-6">非越狱解决方案</h2>
<p>修改<code>Mach-O</code>文件的汇编指令</p>
<ul>
<li>从<code>sub_10F10449C</code>方法的伪代码可知，<code>sub_10F10449C</code>方法返回的就是最大播放速度</li>
</ul>
<pre><code class="hljs language-objc" lang="objc"><span class="hljs-type">double</span> __fastcall sub_10F10449C(__int64 a1)
{
  __int64 v2; <span class="hljs-comment">// x0</span>
  <span class="hljs-type">double</span> result; <span class="hljs-comment">// d0</span>
  <span class="hljs-type">double</span> v4[<span class="hljs-number">6</span>]; <span class="hljs-comment">// [xsp+0h] [xbp-40h] BYREF</span>

  v2 = sub_10F104600();
  sub_10F104B7C(v4, v2, a1);
  result = <span class="hljs-number">2.0</span>;
  <span class="hljs-keyword">if</span> ( v4[<span class="hljs-number">0</span>] &lt; <span class="hljs-number">50.0</span> )
    <span class="hljs-keyword">return</span> *(<span class="hljs-type">double</span> *)&amp;qword_117084280;
  <span class="hljs-keyword">return</span> result;
}
</code></pre>
<ul>
<li>
<p>修改<code>sub_10F10449C</code>方法的实现，改为类似下面的伪代码</p>
<pre><code class="hljs language-objc" lang="objc"><span class="hljs-keyword">return</span> <span class="hljs-number">4.0</span>;
</code></pre>
<ul>
<li>
<p>对应的汇编指令就是</p>
<pre><code class="hljs language-objc" lang="objc">FMOV            D0, #<span class="hljs-number">4.0</span>
RET
</code></pre>
</li>
</ul>
</li>
<li>
<p>我们修改<code>sub_10F10449C</code>方法的前两条汇编指令，改为下面</p>
</li>
</ul>
<pre><code class="hljs language-objc" lang="objc">FMOV            D0, #<span class="hljs-number">4.0</span>
RET
</code></pre>
<ul>
<li>
<p>示例</p>
<p>修改第一条汇编指令</p>
<ul>
<li>
<p>鼠标点击<code>000000010F10449C</code></p>
<pre><code class="hljs language-objc" lang="objc">__text:<span class="hljs-number">000000010</span>F10449C                 SUB             SP, SP, #<span class="hljs-number">0x50</span>
</code></pre>
</li>
<li>
<p>右键选择<code>Assemble</code>
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/08e89803bd5042e5a0c9f06596a2a555~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVG91Y2hXb3JsZA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766016127&amp;x-signature=yJ7SvUJM%2FRYePgJifIIOkoRI38w%3D" alt="F5144010-91BD-48E8-8E73-75223FF2C980.png" loading="lazy"/></p>
</li>
<li>
<p>改成</p>
<pre><code class="hljs language-objc" lang="objc">FMOV    D0, #<span class="hljs-number">4.0</span>
</code></pre>
</li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1b2988ba4df94c7995f517da88816b19~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVG91Y2hXb3JsZA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766016127&amp;x-signature=i6CDpqvO5z%2FC%2BaroZUETHToGiqE%3D" alt="3428FB04-36CC-43E8-B362-89CF02D7FFC6.png" loading="lazy"/></p>
<ul>
<li>点击<code>enter</code></li>
</ul>
</li>
<li>
<p>全部修改结果</p>
</li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f1d49aa2bc904d819f567d3ba5da5754~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVG91Y2hXb3JsZA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766016127&amp;x-signature=P4YvcuCeVqSUQ8WBpscGzxQFa94%3D" alt="F808A0ED-9C78-4589-80A0-76BD2FCF1F8A.png" loading="lazy"/></p>
<ul>
<li>
<p>保存到<code>Mach-O</code>文件中</p>
<ul>
<li><code>IDA</code>-&gt;<code>Edit</code>-&gt;<code>Patch program</code>-&gt;<code>Apply patches to input file</code>-&gt;<code>Apply patches</code></li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/36d111ae3ef84ce1962f72a71977486b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVG91Y2hXb3JsZA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766016127&amp;x-signature=s6nCJCoLKFCQBV1JWsBwEFJo9Aw%3D" alt="542DF73E-FA15-41B7-A251-31E30F37EB38.png" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/73cddc9a6f0844d38e1f8555abdbb8f2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVG91Y2hXb3JsZA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766016127&amp;x-signature=lBcigVZQiZ31iIJx%2B%2BTtr0SjlKE%3D" alt="0D71933B-BB78-48A6-AEA2-A12AC7261586.png" loading="lazy"/></p>
</li>
<li>
<p>保存后，底部会显示<code>log</code>：</p>
</li>
</ul>
<pre><code class="hljs language-objc" lang="objc">Patch successful: /Users/touchworld/Documents/iOSDisassembler/hook/bilibili/IDA_max_0/bili-universal
</code></pre>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8e9022d75ea44c9bbb4d9c2f5cd635ce~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVG91Y2hXb3JsZA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766016127&amp;x-signature=z8L7MsN9kyLw%2B9vJg%2Fq0PpoupxA%3D" alt="F1E26F23-6F74-4DEC-B1CD-1256372F5FBE.png" loading="lazy"/></p>
<h2 data-id="heading-7">代码</h2>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FTouchFriend%2FBiliBiliMApp%2Fblob%2Fmain%2FBiliBiliMDDylib%2FLogos%2FDetail%2FNJPlaybackRate.xm" target="_blank" title="https://github.com/TouchFriend/BiliBiliMApp/blob/main/BiliBiliMDDylib/Logos/Detail/NJPlaybackRate.xm" ref="nofollow noopener noreferrer">BiliBiliMApp-NJPlaybackRate.xm</a></p>
<h2 data-id="heading-8">相关链接</h2>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fbilibili%2Fijkplayer" target="_blank" title="https://github.com/bilibili/ijkplayer" ref="nofollow noopener noreferrer">哔哩哔哩的视频播放器：ijkplayer</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[接口报 500 了，日志里却空空的？FastAPI 异常处理最佳实践]]></title>    <link>https://juejin.cn/post/7582041304655396910</link>    <guid>https://juejin.cn/post/7582041304655396910</guid>    <pubDate>2025-12-11T00:06:14.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7582041304655396910" data-draft-id="7582041304655380526" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="接口报 500 了，日志里却空空的？FastAPI 异常处理最佳实践"/> <meta itemprop="keywords" content="FastAPI,AI编程"/> <meta itemprop="datePublished" content="2025-12-11T00:06:14.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="lomocode"/> <meta itemprop="url" content="https://juejin.cn/user/2103792315926697"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            接口报 500 了，日志里却空空的？FastAPI 异常处理最佳实践
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2103792315926697/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    lomocode
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-11T00:06:14.000Z" title="Thu Dec 11 2025 00:06:14 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-11
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读7分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/21b149427bae46f8909515d281cf6281~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgbG9tb2NvZGU=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766016373&amp;x-signature=PhQ6QaXui8B47OnHp5W2O6O0bY0%3D" alt="在这里插入图片描述" loading="lazy"/></p>
<blockquote>
<p>聊聊 AI 后端那些事儿 · 第 2 篇 | 阅读大约需 10 分钟</p>
</blockquote>
<hr/>
<h2 data-id="heading-0">那个神秘的 500 错误</h2>
<p>周三下午，前端同事发来消息："小禾，生成图片的接口挂了，返回 500。"</p>
<p>小禾打开服务器日志：</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-number">2024-01-15 14:30:00</span> <span class="hljs-string">|</span> <span class="hljs-string">INFO</span> <span class="hljs-string">|</span> <span class="hljs-string">应用启动完成</span>
<span class="hljs-number">2024-01-15 14:30:05</span> <span class="hljs-string">|</span> <span class="hljs-string">INFO</span> <span class="hljs-string">|</span> <span class="hljs-string">收到请求:</span> <span class="hljs-string">POST</span> <span class="hljs-string">/api/generate</span>
<span class="hljs-string">...</span>
</code></pre>
<p>然后就没了。</p>
<p>没有错误信息，没有堆栈跟踪，什么都没有。</p>
<p>小禾本地跑了一遍，正常。</p>
<p>他又看了看前端控制台：</p>
<pre><code class="hljs language-less" lang="less"><span class="hljs-selector-tag">POST</span> /<span class="hljs-selector-tag">api</span>/<span class="hljs-selector-tag">generate</span> <span class="hljs-number">500</span> (Internal Server Error)
{<span class="hljs-selector-tag">&amp;</span><span class="hljs-selector-id">#34</span>;<span class="hljs-selector-tag">detail</span><span class="hljs-selector-tag">&amp;</span><span class="hljs-selector-id">#34</span>;: <span class="hljs-selector-tag">&amp;</span><span class="hljs-selector-id">#34</span>;<span class="hljs-selector-tag">Internal</span> <span class="hljs-selector-tag">Server</span> <span class="hljs-selector-tag">Error</span><span class="hljs-selector-tag">&amp;</span><span class="hljs-selector-id">#34</span>;}
</code></pre>
<p>就这么一行，没有任何有用的信息。</p>
<p>小禾开始漫长的排查之旅：</p>
<pre><code class="hljs language-makefile" lang="makefile"><span class="hljs-section">14:35 - 加了几个 print，重新部署</span>
<span class="hljs-section">14:50 - 发现 print 没输出，可能没走到那</span>
<span class="hljs-section">15:20 - 又加了几个 print，又部署</span>
<span class="hljs-section">15:45 - 终于发现是某个深层函数抛了异常</span>
<span class="hljs-section">16:00 - 定位到问题：一个变量是 None</span>
<span class="hljs-section">16:10 - 修复，部署，测试通过</span>
</code></pre>
<p>三个小时，就为了找一个空指针。</p>
<p>小禾越想越气：<strong>为什么异常没打日志？</strong></p>
<p>他翻了翻代码，找到了罪魁祸首：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">try</span>:
    result = some_function()
<span class="hljs-keyword">except</span> Exception:
    <span class="hljs-keyword">pass</span>  <span class="hljs-comment"># 就是这行！</span>
</code></pre>
<p>某位前人写的代码，捕获了所有异常，然后什么都不做。</p>
<p>异常就这么被吞掉了，悄无声息。</p>
<hr/>
<h2 data-id="heading-1">异常处理的三个层级</h2>
<p>痛定思痛，小禾决定重构整个异常处理体系。</p>
<p>他画了张架构图：</p>
<pre><code class="hljs language-mermaid" lang="mermaid">flowchart TB
    A[HTTP 请求] --&gt; B[Layer 1: 全局异常处理器]
    B --&gt; C[Layer 2: 业务异常处理]
    C --&gt; D[Layer 3: 端点级 try-except]
    D --&gt; E[业务逻辑]

    E --&gt;|抛出异常| F{异常类型?}
    F --&gt;|业务异常| C
    F --&gt;|未知异常| B

    C --&gt; G[返回友好错误提示]
    B --&gt; H[记录日志 + 返回通用错误]
</code></pre>
<p>三层防护，各司其职：</p>
<ol>
<li><strong>全局异常处理器</strong>：兜底所有未处理的异常，记录日志，返回统一格式</li>
<li><strong>业务异常处理</strong>：处理可预期的业务错误，返回友好提示</li>
<li><strong>端点级 try-except</strong>：处理特定接口的特定异常，做细粒度恢复</li>
</ol>
<hr/>
<h2 data-id="heading-2">定义业务异常类</h2>
<p>首先，定义一套业务异常类：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># app/core/exceptions.py</span>
<span class="hljs-keyword">from</span> typing <span class="hljs-keyword">import</span> <span class="hljs-type">Optional</span>, <span class="hljs-type">Any</span>

<span class="hljs-keyword">class</span> <span class="hljs-title class_">AppException</span>(<span class="hljs-title class_ inherited__">Exception</span>):
    &amp;<span class="hljs-comment">#34;&amp;#34;&amp;#34;应用异常基类&amp;#34;&amp;#34;&amp;#34;</span>

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">
        self,
        message: <span class="hljs-built_in">str</span>,
        code: <span class="hljs-built_in">str</span> = &amp;<span class="hljs-comment">#34;UNKNOWN_ERROR&amp;#34;,</span>
        status_code: <span class="hljs-built_in">int</span> = <span class="hljs-number">500</span>,
        details: <span class="hljs-type">Optional</span>[<span class="hljs-type">Any</span>] = <span class="hljs-literal">None</span>
    </span>):
        self.message = message
        self.code = code
        self.status_code = status_code
        self.details = details
        <span class="hljs-built_in">super</span>().__init__(message)


<span class="hljs-keyword">class</span> <span class="hljs-title class_">ValidationError</span>(<span class="hljs-title class_ inherited__">AppException</span>):
    &amp;<span class="hljs-comment">#34;&amp;#34;&amp;#34;数据验证错误&amp;#34;&amp;#34;&amp;#34;</span>
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, message: <span class="hljs-built_in">str</span>, details: <span class="hljs-type">Any</span> = <span class="hljs-literal">None</span></span>):
        <span class="hljs-built_in">super</span>().__init__(message, &amp;<span class="hljs-comment">#34;VALIDATION_ERROR&amp;#34;, 400, details)</span>


<span class="hljs-keyword">class</span> <span class="hljs-title class_">NotFoundError</span>(<span class="hljs-title class_ inherited__">AppException</span>):
    &amp;<span class="hljs-comment">#34;&amp;#34;&amp;#34;资源不存在&amp;#34;&amp;#34;&amp;#34;</span>
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, resource: <span class="hljs-built_in">str</span>, resource_id: <span class="hljs-built_in">str</span></span>):
        <span class="hljs-built_in">super</span>().__init__(
            f&amp;<span class="hljs-comment">#34;{resource} not found: {resource_id}&amp;#34;,</span>
            &amp;<span class="hljs-comment">#34;NOT_FOUND&amp;#34;,</span>
            <span class="hljs-number">404</span>,
            {&amp;<span class="hljs-comment">#34;resource&amp;#34;: resource, &amp;#34;id&amp;#34;: resource_id}</span>
        )


<span class="hljs-keyword">class</span> <span class="hljs-title class_">GenerationError</span>(<span class="hljs-title class_ inherited__">AppException</span>):
    &amp;<span class="hljs-comment">#34;&amp;#34;&amp;#34;AI 生成错误&amp;#34;&amp;#34;&amp;#34;</span>
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, message: <span class="hljs-built_in">str</span>, model: <span class="hljs-built_in">str</span> = <span class="hljs-literal">None</span></span>):
        <span class="hljs-built_in">super</span>().__init__(
            message,
            &amp;<span class="hljs-comment">#34;GENERATION_ERROR&amp;#34;,</span>
            <span class="hljs-number">500</span>,
            {&amp;<span class="hljs-comment">#34;model&amp;#34;: model}</span>
        )


<span class="hljs-keyword">class</span> <span class="hljs-title class_">ExternalServiceError</span>(<span class="hljs-title class_ inherited__">AppException</span>):
    &amp;<span class="hljs-comment">#34;&amp;#34;&amp;#34;外部服务错误&amp;#34;&amp;#34;&amp;#34;</span>
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, service: <span class="hljs-built_in">str</span>, message: <span class="hljs-built_in">str</span></span>):
        <span class="hljs-built_in">super</span>().__init__(
            f&amp;<span class="hljs-comment">#34;{service} error: {message}&amp;#34;,</span>
            &amp;<span class="hljs-comment">#34;EXTERNAL_SERVICE_ERROR&amp;#34;,</span>
            <span class="hljs-number">502</span>,
            {&amp;<span class="hljs-comment">#34;service&amp;#34;: service}</span>
        )
</code></pre>
<p>有了这套异常类，错误就有了明确的分类和结构。</p>
<hr/>
<h2 data-id="heading-3">全局异常处理器</h2>
<p>然后，在 FastAPI 应用中注册异常处理器：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># app/main.py</span>
<span class="hljs-keyword">from</span> fastapi <span class="hljs-keyword">import</span> FastAPI, Request
<span class="hljs-keyword">from</span> fastapi.responses <span class="hljs-keyword">import</span> JSONResponse
<span class="hljs-keyword">from</span> app.core.exceptions <span class="hljs-keyword">import</span> AppException
<span class="hljs-keyword">from</span> app.core.logger <span class="hljs-keyword">import</span> logger
<span class="hljs-keyword">import</span> traceback

app = FastAPI()

<span class="hljs-meta">@app.exception_handler(<span class="hljs-params">AppException</span>)</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">app_exception_handler</span>(<span class="hljs-params">request: Request, exc: AppException</span>):
    &amp;<span class="hljs-comment">#34;&amp;#34;&amp;#34;处理业务异常&amp;#34;&amp;#34;&amp;#34;</span>

    <span class="hljs-comment"># 业务异常用 warning 级别</span>
    logger.warning(
        f&amp;<span class="hljs-comment">#34;业务异常 [{exc.code}]: {exc.message}&amp;#34;,</span>
        extra={
            &amp;<span class="hljs-comment">#34;path&amp;#34;: request.url.path,</span>
            &amp;<span class="hljs-comment">#34;method&amp;#34;: request.method,</span>
            &amp;<span class="hljs-comment">#34;code&amp;#34;: exc.code,</span>
            &amp;<span class="hljs-comment">#34;details&amp;#34;: exc.details</span>
        }
    )

    <span class="hljs-keyword">return</span> JSONResponse(
        status_code=exc.status_code,
        content={
            &amp;<span class="hljs-comment">#34;success&amp;#34;: False,</span>
            &amp;<span class="hljs-comment">#34;error&amp;#34;: {</span>
                &amp;<span class="hljs-comment">#34;code&amp;#34;: exc.code,</span>
                &amp;<span class="hljs-comment">#34;message&amp;#34;: exc.message,</span>
                &amp;<span class="hljs-comment">#34;details&amp;#34;: exc.details</span>
            }
        }
    )


<span class="hljs-meta">@app.exception_handler(<span class="hljs-params">Exception</span>)</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">global_exception_handler</span>(<span class="hljs-params">request: Request, exc: Exception</span>):
    &amp;<span class="hljs-comment">#34;&amp;#34;&amp;#34;处理所有未捕获的异常&amp;#34;&amp;#34;&amp;#34;</span>

    <span class="hljs-comment"># 未知异常用 error 级别，记录完整堆栈</span>
    logger.error(
        f&amp;<span class="hljs-comment">#34;未处理的异常: {type(exc).__name__}: {str(exc)}&amp;#34;,</span>
        extra={
            &amp;<span class="hljs-comment">#34;path&amp;#34;: request.url.path,</span>
            &amp;<span class="hljs-comment">#34;method&amp;#34;: request.method,</span>
            &amp;<span class="hljs-comment">#34;traceback&amp;#34;: traceback.format_exc()  # 完整堆栈！</span>
        }
    )

    <span class="hljs-comment"># 生产环境不暴露内部错误细节</span>
    <span class="hljs-keyword">return</span> JSONResponse(
        status_code=<span class="hljs-number">500</span>,
        content={
            &amp;<span class="hljs-comment">#34;success&amp;#34;: False,</span>
            &amp;<span class="hljs-comment">#34;error&amp;#34;: {</span>
                &amp;<span class="hljs-comment">#34;code&amp;#34;: &amp;#34;INTERNAL_ERROR&amp;#34;,</span>
                &amp;<span class="hljs-comment">#34;message&amp;#34;: &amp;#34;An internal error occurred. Please try again later.&amp;#34;</span>
            }
        }
    )
</code></pre>
<p><strong>关键点</strong>：<code>traceback.format_exc()</code> 会记录完整的堆栈信息。</p>
<p>有了这个，再也不用加 print 去猜异常在哪了。</p>
<hr/>
<h2 data-id="heading-4">端点级异常处理</h2>
<p>对于特定接口，可以做更细粒度的处理：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># app/api/endpoints/generate.py</span>
<span class="hljs-keyword">from</span> app.core.exceptions <span class="hljs-keyword">import</span> GenerationError, ValidationError

<span class="hljs-meta">@router.post(<span class="hljs-params">&amp;<span class="hljs-comment">#34;/shot-image&amp;#34;)</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> generate_shot_image(<span class="hljs-params">request: GenerateShotImageRequest</span>):
    &amp;<span class="hljs-comment">#34;&amp;#34;&amp;#34;生成分镜图片&amp;#34;&amp;#34;&amp;#34;</span>

    <span class="hljs-comment"># 参数验证</span>
    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> request.prompt.strip(<span class="hljs-params"/>):
        <span class="hljs-keyword">raise</span> ValidationError(<span class="hljs-params">&amp;<span class="hljs-comment">#34;Prompt cannot be empty&amp;#34;)</span>

    <span class="hljs-keyword">try</span>:
        adapter = ImageGenerationAdapterFactory.get_current_adapter(<span class="hljs-params"/>)
        result = <span class="hljs-keyword">await</span> adapter.generate_shot_image(<span class="hljs-params">
            prompt=request.prompt,
            width=request.width,
            height=request.height
        </span>)

        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> result.get(<span class="hljs-params">&amp;<span class="hljs-comment">#34;success&amp;#34;):</span>
            <span class="hljs-keyword">raise</span> GenerationError(<span class="hljs-params">
                result.get(<span class="hljs-params">&amp;<span class="hljs-comment">#34;error&amp;#34;, &amp;#34;Unknown generation error&amp;#34;),</span>
                model=settings.IMAGE_MODEL
            </span>)

        <span class="hljs-keyword">return</span> {&amp;<span class="hljs-comment">#34;success&amp;#34;: True, &amp;#34;data&amp;#34;: result}</span>

    <span class="hljs-keyword">except</span> GenerationError:
        <span class="hljs-keyword">raise</span>  <span class="hljs-comment"># 已经是业务异常，直接抛出</span>

    <span class="hljs-keyword">except</span> torch.cuda.OutOfMemoryError:
        <span class="hljs-comment"># 特定异常转换为业务异常</span>
        <span class="hljs-keyword">raise</span> GenerationError(<span class="hljs-params">&amp;<span class="hljs-comment">#34;GPU out of memory. Please try a smaller image size.&amp;#34;)</span>

    <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:
        <span class="hljs-comment"># 未知异常，记录后转换为业务异常</span>
        logger.error(<span class="hljs-params">f&amp;<span class="hljs-comment">#34;Unexpected error in generate_shot_image: {e}&amp;#34;)</span>
        <span class="hljs-keyword">raise</span> GenerationError(<span class="hljs-params">f&amp;<span class="hljs-comment">#34;Generation failed: {str(e)}&amp;#34;)</span>
</span></span></span></span></span></span></span></span></code></pre>
<p>这样：</p>
<ul>
<li>参数错误返回 400</li>
<li>显存不足返回 500，但有友好提示</li>
<li>其他异常也会被捕获，不会"消失"</li>
</ul>
<hr/>
<h2 data-id="heading-5">日志配置</h2>
<p>小禾选用了 loguru，比标准库的 logging 好用太多：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># app/core/logger.py</span>
<span class="hljs-keyword">from</span> loguru <span class="hljs-keyword">import</span> logger
<span class="hljs-keyword">import</span> sys

<span class="hljs-comment"># 移除默认处理器</span>
logger.remove()

<span class="hljs-comment"># 控制台输出（开发环境）</span>
logger.add(
    sys.stdout,
    <span class="hljs-built_in">format</span>=&amp;<span class="hljs-comment">#34;{time:YYYY-MM-DD HH:mm:ss} | &amp;#34;</span>
           &amp;<span class="hljs-comment">#34;{level:  | &amp;#34;</span>
           &amp;<span class="hljs-comment">#34;{name}:{function}:{line} | &amp;#34;</span>
           &amp;<span class="hljs-comment">#34;{message}&amp;#34;,</span>
    level=&amp;<span class="hljs-comment">#34;DEBUG&amp;#34;</span>
)

<span class="hljs-comment"># 文件输出（生产环境）</span>
logger.add(
    &amp;<span class="hljs-comment">#34;logs/app_{time:YYYY-MM-DD}.log&amp;#34;,</span>
    <span class="hljs-built_in">format</span>=&amp;<span class="hljs-comment">#34;{time:YYYY-MM-DD HH:mm:ss} | {level:  {request.method} {request.url.path}&amp;#34;)</span>

    start = time.time()

    <span class="hljs-comment"># 处理请求</span>
    response = <span class="hljs-keyword">await</span> call_next(request)

    <span class="hljs-comment"># 计算耗时</span>
    duration = time.time() - start

    <span class="hljs-comment"># 记录请求完成</span>
    logger.info(f&amp;<span class="hljs-comment">#34;[{request_id}]  POST /api/generate/shot-image</span>
    <span class="hljs-number">2024</span>-01-<span class="hljs-number">15</span> <span class="hljs-number">14</span>:<span class="hljs-number">30</span>:<span class="hljs-number">12</span> | INFO | [a1b2c3d4]  业务 -\&gt; 端点    |
| 日志要完整   | 包含堆栈、请求信息           |
| 错误码标准化  | 定义业务异常枚举            |
| 开发/生产区分 | 开发环境暴露详情            |
| 请求可追踪   | 添加 request\_<span class="hljs-built_in">id</span>      |

***

<span class="hljs-comment">## 小禾的感悟</span>

    那三小时的排查，
    让我学会一个道理：

    异常不会消失，
    只会被藏起来。

    <span class="hljs-keyword">except</span> <span class="hljs-keyword">pass</span> 是懒惰，
    是给未来的自己挖坑。

    每个异常都有它的意义，
    要么处理它，
    要么记录它，
    要么抛出它。

    但绝不能忽视它。

    全局处理器是保险，
    业务异常是分类，
    日志是证据。

    有了这三样，
    再也不用三小时找 bug 了。

    下次有人说 <span class="hljs-number">500</span>，
    我只需要一分钟。

小禾看着清晰的日志输出，心情大好。

三小时的教训，换来了一套完善的异常处理体系。

值了。

***

**下一篇预告：前端传了个 null，后端直接炸了**

&gt; 防御性编程，让你的接口固若金汤。

敬请期待。
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[用 Spark Shell 做交互式数据分析从入门到自包含应用]]></title>    <link>https://juejin.cn/post/7582131164728361000</link>    <guid>https://juejin.cn/post/7582131164728361000</guid>    <pubDate>2025-12-11T02:59:50.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7582131164728361000" data-draft-id="7582096212663402496" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="用 Spark Shell 做交互式数据分析从入门到自包含应用"/> <meta itemprop="keywords" content="人工智能"/> <meta itemprop="datePublished" content="2025-12-11T02:59:50.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="HelloReader"/> <meta itemprop="url" content="https://juejin.cn/user/2601910535729322"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            用 Spark Shell 做交互式数据分析从入门到自包含应用
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2601910535729322/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    HelloReader
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-11T02:59:50.000Z" title="Thu Dec 11 2025 02:59:50 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-11
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#595959;font-size:15px;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(60,10,30,.04) 3%,transparent 0),linear-gradient(1turn,rgba(60,10,30,.04) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body p{color:#595959;font-size:15px;line-height:2;font-weight:400}.markdown-body p+p{margin-top:16px}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin:0;color:#135ce0}.markdown-body h1{position:relative;text-align:center;font-size:22px;margin:50px 0}.markdown-body h1:before{position:absolute;content:"";top:-10px;left:50%;width:32px;height:32px;transform:translateX(-50%);background-size:100% 100%;opacity:.36;background-repeat:no-repeat;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAABfVBMVEX///8Ad/8AgP8AgP8AgP8Aff8AgP8Af/8AgP8AVf8Af/8Af/8AgP8AgP8Af/8Afv8AAP8Afv8Afv8Aef8AgP8AdP8Afv8AgP8AgP8Acf8Ae/8AgP8Af/8AgP8Af/8Af/8AfP8Afv8AgP8Af/8Af/8Afv8Afv8AgP8Afv8AgP8Af/8Af/8AgP8AgP8Afv8AgP8Af/8AgP8AgP8AgP8Ae/8Afv8Af/8AgP8Af/8AgP8Af/8Af/8Aff8Af/8Abf8AgP8Af/8AgP8Af/8Af/8Afv8AgP8AgP8Afv8Afv8AgP8Af/8Aff8AgP8Afv8AgP8Aff8AgP8AfP8AgP8Ae/8AgP8Af/8AgP8AgP8AgP8Afv8AgP8AgP8AgP8Afv8AgP8AgP8AgP8AgP8AgP8Af/8AgP8Af/8Af/8Aev8Af/8AgP8Aff8Afv8AgP8AgP8AgP8Af/8AgP8Af/8Af/8AgP8Afv8AgP8AgP8AgP8AgP8Af/8AeP8Af/8Af/8Af//////rzEHnAAAAfXRSTlMAD7CCAivatxIDx5EMrP19AXdLEwgLR+6iCR/M0yLRzyFF7JupSXn8cw6v60Q0QeqzKtgeG237HMne850/6Qeq7QaZ+WdydHtj+OM3qENCMRYl1B3K2U7wnlWE/mhlirjkODa9FN/BF7/iNV/2kASNZpX1Wlf03C4stRGxgUPclqoAAAABYktHRACIBR1IAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH4gEaBzgZ4yeM3AAAAT9JREFUOMvNUldbwkAQvCAqsSBoABE7asSOBRUVVBQNNuy9996789+9cMFAMHnVebmdm+/bmdtbQv4dOFOW2UjPzgFyLfo6nweKfIMOBYWwFtmMPGz2Yj2pJI0JDq3udJW6VVbmKa9I192VQFV1ktXUAl5NB0cd4KpnORqsEO2ZIRpF9gJfE9Dckqq0KuZt7UAH5+8EPF3spjsRpCeQNO/tA/qDwIDA+OCQbBoKA8NOdjMySgcZGVM6jwcgRuUiSs0nlPFNSrEpJfU0jTLD6llqbvKxei7OzvkFNQohi0vAsj81+MoqsCaoPOQFgus/1LyxichW+hS2JWCHZ7VlF9jb187pIAYcHiViHAMnp5mTjJ8B5xeEXF4B1ze/fTh/C0h398DDI9HB07O8ci+vRBdvdGnfP4gBuM8vw7X/G3wDmFhFZEdxzjMAAAAldEVYdGRhdGU6Y3JlYXRlADIwMTgtMDEtMjZUMDc6NTY6MjUrMDE6MDA67pVWAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDE4LTAxLTI2VDA3OjU2OjI1KzAxOjAwS7Mt6gAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAAWdEVYdFRpdGxlAGp1ZWppbl9sb2dvIGNvcHlxapmKAAAAV3pUWHRSYXcgcHJvZmlsZSB0eXBlIGlwdGMAAHic4/IMCHFWKCjKT8vMSeVSAAMjCy5jCxMjE0uTFAMTIESANMNkAyOzVCDL2NTIxMzEHMQHy4BIoEouAOoXEXTyQjWVAAAAAElFTkSuQmCC)}.markdown-body h2{position:relative;font-size:20px;border-left:4px solid;padding:0 0 0 10px;margin:30px 0}.markdown-body h3{font-size:16px}.markdown-body ul{list-style:disc outside;margin-left:2em;margin-top:1em}.markdown-body li{line-height:2;color:#595959}.markdown-body img.loaded{margin:0 auto;display:block}.markdown-body blockquote{background:#fff9f9;margin:2em 0;padding:2px 20px;border-left:4px solid #b2aec5}.markdown-body blockquote p{color:#666;line-height:2}.markdown-body a{color:#036aca;border-bottom:1px solid rgba(3,106,202,.8);font-weight:400;text-decoration:none}.markdown-body em strong,.markdown-body strong{color:#036aca}.markdown-body hr{border-top:1px solid #135ce0}.markdown-body pre{overflow:auto}.markdown-body code,.markdown-body pre{overflow:auto;position:relative;line-height:1.75;font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body table{border-collapse:collapse;margin:1rem 0;overflow-x:auto}.markdown-body table td,.markdown-body table th{border:1px solid #dfe2e5;padding:.6em 1em}.markdown-body table tr{border-top:1px solid #dfe2e5}.markdown-body table tr:nth-child(2n){background-color:#f6f8fa}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">为什么用 Spark Shell？</h2>
<p>Spark Shell 既是<strong>学习 API 的最短路径</strong>，也是<strong>探索数据的强大交互工具</strong>。你可以在 Shell 里反复尝试、立即验证，然后把验证过的代码拷进正式作业或应用。</p>
<ul>
<li>支持 <strong>Scala</strong>（运行在 JVM，上手 Java 生态很方便）</li>
<li>支持 <strong>Python（PySpark）</strong>（语法简洁、数据科学生态友好）</li>
</ul>
<h2 data-id="heading-1">环境与启动方式</h2>
<h3 data-id="heading-2">方式 A：使用 Spark 自带脚本</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># Python</span>
./bin/pyspark

<span class="hljs-comment"># Scala</span>
./bin/spark-shell
</code></pre>
<h3 data-id="heading-3">方式 B：已通过 pip 安装 PySpark（推荐给数据科学/本地开发）</h3>
<pre><code class="hljs language-bash" lang="bash">pip install pyspark
pyspark
</code></pre>
<blockquote>
<p>小贴士：</p>
<ul>
<li>
<p>指定 Python 解释器：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">export</span> PYSPARK_PYTHON=python3
</code></pre>
</li>
<li>
<p>指定 Spark 路径（必要时）：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">export</span> SPARK_HOME=/path/to/spark
</code></pre>
</li>
</ul>
</blockquote>
<h2 data-id="heading-4">Spark 的核心抽象：Dataset / DataFrame</h2>
<ul>
<li><strong>Dataset</strong>：分布式元素集合。</li>
<li>在 <strong>Python</strong> 中，由于动态类型特性，实际使用的是 <strong><code>Dataset[Row]</code></strong>，通常直接称为 <strong>DataFrame</strong>（与 Pandas/R 的 DataFrame 概念一致）。</li>
</ul>
<h3 data-id="heading-5">读取文本为 DataFrame</h3>
<pre><code class="hljs language-python" lang="python">textFile = spark.read.text(&amp;<span class="hljs-comment">#34;README.md&amp;#34;)  # 每行一条记录，列名为 &amp;#34;value&amp;#34;</span>
</code></pre>
<h3 data-id="heading-6">常用 action</h3>
<pre><code class="hljs language-python" lang="python">textFile.count()   <span class="hljs-comment"># 行数</span>
textFile.first()   <span class="hljs-comment"># Row(value='...')</span>
</code></pre>
<h3 data-id="heading-7">过滤与链式调用</h3>
<pre><code class="hljs language-python" lang="python">linesWithSpark = textFile.<span class="hljs-built_in">filter</span>(textFile.value.contains(&amp;<span class="hljs-comment">#34;Spark&amp;#34;))</span>
linesWithSpark.count()  <span class="hljs-comment"># 例如 15</span>

<span class="hljs-comment"># 链式：过滤后直接计数</span>
textFile.<span class="hljs-built_in">filter</span>(textFile.value.contains(&amp;<span class="hljs-comment">#34;Spark&amp;#34;)).count()</span>
</code></pre>
<h2 data-id="heading-8">复杂一点：统计“每行最大词数”</h2>
<blockquote>
<p><strong>关键修正</strong>：在 <strong>PySpark</strong> 用 <code>.alias(&amp;#34;...&amp;#34;)</code>（而非 <code>.name(&amp;#34;...&amp;#34;)</code>），并使用<strong>原始字符串</strong>表达正则 <code>r&amp;#34;\s+&amp;#34;</code>，避免转义歧义。</p>
</blockquote>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> pyspark.sql <span class="hljs-keyword">import</span> functions <span class="hljs-keyword">as</span> F

result = (
    textFile
      .select(F.size(F.split(F.col(&amp;<span class="hljs-comment">#34;value&amp;#34;), r&amp;#34;\s+&amp;#34;)).alias(&amp;#34;numWords&amp;#34;))</span>
      .agg(F.<span class="hljs-built_in">max</span>(F.col(&amp;<span class="hljs-comment">#34;numWords&amp;#34;)).alias(&amp;#34;max_numWords&amp;#34;))</span>
      .collect()
)
result  <span class="hljs-comment"># [Row(max_numWords=15)]</span>
</code></pre>
<h2 data-id="heading-9">MapReduce 风格：做一次词频统计（Word Count）</h2>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> pyspark.sql <span class="hljs-keyword">import</span> functions <span class="hljs-keyword">as</span> F

wordCounts = (
    textFile
      .select(F.explode(F.split(F.col(&amp;<span class="hljs-comment">#34;value&amp;#34;), r&amp;#34;\s+&amp;#34;)).alias(&amp;#34;word&amp;#34;))</span>
      .where(F.col(&amp;<span class="hljs-comment">#34;word&amp;#34;) != &amp;#34;&amp;#34;)         # 可选：剔除空字符串</span>
      .groupBy(&amp;<span class="hljs-comment">#34;word&amp;#34;)</span>
      .count()
)

<span class="hljs-comment"># 看看 Top 20</span>
wordCounts.orderBy(F.col(&amp;<span class="hljs-comment">#34;count&amp;#34;).desc()).show(20, truncate=False)</span>

<span class="hljs-comment"># 也可以落到磁盘/HDFS</span>
<span class="hljs-comment"># wordCounts.write.mode(&amp;#34;overwrite&amp;#34;).csv(&amp;#34;/tmp/wordcounts&amp;#34;)</span>
</code></pre>
<h2 data-id="heading-10">缓存与性能：cache / persist</h2>
<p>当数据会被<strong>重复访问</strong>（比如小而热的数据集，或 PageRank 这类迭代算法），把它放进<strong>集群级内存缓存</strong>会极大提高效率。</p>
<pre><code class="hljs language-python" lang="python">linesWithSpark.cache()   <span class="hljs-comment"># 默认 MEMORY_ONLY</span>
linesWithSpark.count()   <span class="hljs-comment"># 触发计算并物化缓存</span>
linesWithSpark.count()   <span class="hljs-comment"># 再次访问会更快</span>

<span class="hljs-comment"># 指定存储级别（当数据较大时有用）</span>
<span class="hljs-keyword">from</span> pyspark.storagelevel <span class="hljs-keyword">import</span> StorageLevel
linesWithSpark.persist(StorageLevel.MEMORY_AND_DISK)
</code></pre>
<p>实用调试：</p>
<pre><code class="hljs language-python" lang="python">linesWithSpark.explain()              <span class="hljs-comment"># 物理/逻辑执行计划</span>
wordCounts.explain(&amp;<span class="hljs-comment">#34;formatted&amp;#34;)       # 更友好的格式（Spark 3+）</span>
</code></pre>
<h2 data-id="heading-11">自包含应用：用 PySpark 编写并运行</h2>
<p>如果你在做<strong>打包的 PySpark 应用/库</strong>，可以在 <code>setup.py</code> 里声明依赖：</p>
<pre><code class="hljs language-python" lang="python">install_requires = [
    &amp;<span class="hljs-comment">#34;pyspark==4.0.1&amp;#34;  # 按你的实际版本固定</span>
]
</code></pre>
<h3 data-id="heading-12">示例：<code>SimpleApp.py</code></h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># SimpleApp.py</span>
<span class="hljs-keyword">from</span> pyspark.sql <span class="hljs-keyword">import</span> SparkSession
<span class="hljs-keyword">from</span> pyspark.sql <span class="hljs-keyword">import</span> functions <span class="hljs-keyword">as</span> F

<span class="hljs-keyword">def</span> <span class="hljs-title function_">main</span>():
    logFile = &amp;<span class="hljs-comment">#34;YOUR_SPARK_HOME/README.md&amp;#34;  # 替换为实际文件路径</span>
    spark = SparkSession.builder.appName(&amp;<span class="hljs-comment">#34;SimpleApp&amp;#34;).getOrCreate()</span>

    df = spark.read.text(logFile).cache()

    numAs = df.<span class="hljs-built_in">filter</span>(F.col(&amp;<span class="hljs-comment">#34;value&amp;#34;).contains(&amp;#34;a&amp;#34;)).count()</span>
    numBs = df.<span class="hljs-built_in">filter</span>(F.col(&amp;<span class="hljs-comment">#34;value&amp;#34;).contains(&amp;#34;b&amp;#34;)).count()</span>

    <span class="hljs-built_in">print</span>(&amp;<span class="hljs-comment">#34;Lines with a: %i, lines with b: %i&amp;#34; % (numAs, numBs))</span>

    spark.stop()

<span class="hljs-keyword">if</span> __name__ == &amp;<span class="hljs-comment">#34;__main__&amp;#34;:</span>
    main()
</code></pre>
<h3 data-id="heading-13">运行方式</h3>
<p><strong>首选：<code>spark-submit</code></strong></p>
<pre><code class="hljs language-bash" lang="bash">$ <span class="hljs-variable">${SPARK_HOME}</span>/bin/spark-submit \
  --master &amp;<span class="hljs-comment">#34;local[4]&amp;#34; \</span>
  SimpleApp.py

<span class="hljs-comment"># 输出示例：</span>
<span class="hljs-comment"># Lines with a: 46, lines with b: 23</span>
</code></pre>
<p><strong>如果已用 pip 安装 PySpark</strong>（可直接用 Python 运行）：</p>
<pre><code class="hljs language-bash" lang="bash">$ python SimpleApp.py
<span class="hljs-comment"># Lines with a: 46, lines with b: 23</span>
</code></pre>
<blockquote>
<p>引入第三方代码/依赖时，可用 <code>--py-files</code> 传入 zip 包；引入连接器/JAR 时可用：</p>
<pre><code class="hljs language-bash" lang="bash">spark-submit --packages groupId:artifactId:version SimpleApp.py
</code></pre>
</blockquote>
<h2 data-id="heading-14">去哪里继续深入？</h2>
<ul>
<li>
<p><strong>RDD 编程指南</strong> 与 <strong>Spark SQL 编程指南</strong>：系统理解 API 与最佳实践</p>
</li>
<li>
<p><strong>部署指南</strong>：把应用跑在真实集群（Standalone / YARN / Kubernetes）</p>
</li>
<li>
<p><strong>examples 目录</strong> 含多语言示例：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># Python</span>
./bin/spark-submit examples/src/main/python/pi.py

<span class="hljs-comment"># Scala / Java</span>
./bin/run-example SparkPi

<span class="hljs-comment"># R</span>
./bin/spark-submit examples/src/main/r/dataframe.R
</code></pre>
</li>
</ul>
<h2 data-id="heading-15">常见坑与实战建议（强烈建议一读）</h2>
<ol>
<li><strong>PySpark 别用 <code>.name(...)</code></strong> → 用 <code>.alias(&amp;#34;...&amp;#34;)</code>。</li>
<li><strong>正则用原始字符串</strong> → <code>r&amp;#34;\s+&amp;#34;</code>，避免 <code>&amp;#34;\s&amp;#34;</code> 被当作普通 <code>s</code>。</li>
<li><strong>谨慎 <code>collect()</code></strong> → 仅用于小结果；大结果用 <code>show()</code>/<code>take(n)</code> 或直接写出到存储。</li>
<li><strong>只缓存“热数据”</strong> → 先 <code>explain()</code> 看执行计划、用 UI 观察 DAG 与缓存命中，不要“见谁 cache 谁”。</li>
<li><strong>路径要清晰</strong> → 本地绝对路径 vs HDFS/S3 URI（<code>hdfs://</code>、<code>s3a://</code>）。</li>
<li><strong>并行度与分区</strong> → <code>repartition(n)</code> 提升 shuffle 后并行度；小结果落盘可 <code>coalesce(1)</code> 合并为单文件（仅适用于小数据）。</li>
<li><strong>版本统一</strong> → PySpark 版本与集群 Spark 版本尽量匹配，避免协议/计划不兼容。</li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[用Trea来快速生成一个浏览器插件]]></title>    <link>https://juejin.cn/post/7582133314686582836</link>    <guid>https://juejin.cn/post/7582133314686582836</guid>    <pubDate>2025-12-11T03:05:26.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7582133314686582836" data-draft-id="7581999251366969396" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="用Trea来快速生成一个浏览器插件"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2025-12-11T03:05:26.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="曹卫平dudu"/> <meta itemprop="url" content="https://juejin.cn/user/3843548383544855"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            用Trea来快速生成一个浏览器插件
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3843548383544855/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    曹卫平dudu
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-11T03:05:26.000Z" title="Thu Dec 11 2025 03:05:26 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-11
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">用Trea来开发一个浏览器插件</h2>
<h3 data-id="heading-1">背景</h3>
<p>浏览网页的时候，总是外网的加载不出来，弄了梯子，有时候直连的又加载不出来，最近ZeroOmega也老是不好用，总有些资源加载不出来</p>
<h3 data-id="heading-2">Trea solo</h3>
<p>直接打开trea,新建任务，输入提示词：</p>
<pre><code class="hljs language-提示词" lang="提示词">帮我开发一个浏览器插件，主要功能是管理浏览器，默认浏览器直联，如果链接异常的网址通过vpn链接
</code></pre>
<p>打开plan开关，点击发送
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/85cc61cf78394b0ca838077e19d18d6c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pu55Y2r5bmzZHVkdQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766027126&amp;x-signature=nUirgJlCinEdrBQFxEBONRiOONc%3D" alt="image.png" loading="lazy"/>
Trea就吭哧吭哧一顿计划，会生成一个计划文档</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/66e0b81b67354782833ad594df1baff8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pu55Y2r5bmzZHVkdQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766027126&amp;x-signature=buRGdMSzARv4PlbIPMs28MSCDyM%3D" alt="image.png" loading="lazy"/>
非常的专业</p>
<h3 data-id="heading-3">点击执行计划</h3>
<p>很快的就会生成项目，给项目添加上对应的icon图片，就可以在浏览器里打开了</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c0ed9848f9d84e05a74078d98de746c3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pu55Y2r5bmzZHVkdQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766027126&amp;x-signature=RGzCXMZtWCkUF6BApBMswf0EmNA%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/823205fc395c4a408791dc7cfc142902~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pu55Y2r5bmzZHVkdQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766027126&amp;x-signature=LcZNizW9EJbocvIb67KktmtA05g%3D" alt="image.png" loading="lazy"/>
并且可以截图让他对对应的有问题的地方进行修改</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/67e2197c77354e9faf8f4a263287baff~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pu55Y2r5bmzZHVkdQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766027126&amp;x-signature=KlneZYzEHyCsKevTo3Szx3D08kM%3D" alt="image.png" loading="lazy"/>
截图改变按钮大小</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3956f9c279db481bb005197d6b930edb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pu55Y2r5bmzZHVkdQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766027126&amp;x-signature=fjUnh51FxB8p3%2BiJQ99r%2B2UYOFY%3D" alt="image.png" loading="lazy"/>
改完后的效果</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0e7194d13a724ed888bda33a01c66303~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pu55Y2r5bmzZHVkdQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766027126&amp;x-signature=VJ7jf9esIbyOYY3rwEsegavfzDQ%3D" alt="image.png" loading="lazy"/>
再微调微调，搞定</p>
<h3 data-id="heading-4">效果展示</h3>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0fc970ca876e458095c47b42b6927d0c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pu55Y2r5bmzZHVkdQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766027126&amp;x-signature=JdKsW0QNEfyjIdeU44ErF%2Fjwvm8%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4fbffcd4c97d47ee8eb2928f02796862~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pu55Y2r5bmzZHVkdQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766027126&amp;x-signature=o4fP9JnkAfkAom1Rw7%2BxEltCr%2BA%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6fd86ad5cd7b489abc2754f4f538d283~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pu55Y2r5bmzZHVkdQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766027126&amp;x-signature=pQWEH8Hq9tEpghpK6gDTlfY4PLY%3D" alt="image.png" loading="lazy"/>
简单实用，比较满意</p>
<h3 data-id="heading-5">不足之处</h3>
<p>很多网站的资源都不在同一个域名下，需要配置多个域名，如:tiktok.com的很多资源在tiktokv.com这个域名下，这就需要打开网站的调试工具，检查哪些资源无法加载的，把相应的域名添加到代理列表才可以。想让Trea solo根据标签页来判断是否需要代理，需要代理的整个标签页的所有请求都走代理，但是ai也没弄成。有大佬的可以指导指导。</p>
<pre><code class="hljs language-background.js" lang="background.js">// 浏览器代理管理器 - 背景脚本

// 初始化存储
async function initStorage() {
  const storage = await chrome.storage.local.get(['exceptionUrls', 'proxyConfig', 'isEnabled']);
  
  // 设置默认值
  const defaults = {
    exceptionUrls: [],
    proxyConfig: {
      host: '127.0.0.1',
      port: 1080,
      type: 'http'
    },
    isEnabled: true
  };
  
  // 合并默认值和现有值 - 只在值不存在时使用默认值
  const newStorage = {
    exceptionUrls: storage.exceptionUrls !== undefined ? storage.exceptionUrls : defaults.exceptionUrls,
    proxyConfig: storage.proxyConfig || defaults.proxyConfig,
    isEnabled: storage.isEnabled !== undefined ? storage.isEnabled : defaults.isEnabled
  };
  
  // 保存到存储
  await chrome.storage.local.set(newStorage);
  
  console.log('Storage initialized:', newStorage);
  
  // 更新规则
  await updateRules(newStorage.exceptionUrls);
}

// 更新网络请求规则
async function updateRules(exceptionUrls) {
  // 不再使用declarativeNetRequest，直接更新PAC脚本
  await initProxySettings();
}

// 配置代理函数已移除，改为使用PAC脚本处理代理逻辑

// 监听存储变化
chrome.storage.onChanged.addListener(async (changes, area) =&gt; {
  if (area === 'local') {
    if (changes.exceptionUrls) {
      await updateRules(changes.exceptionUrls.newValue);
    }
  }
});

// 初始化代理设置
async function initProxySettings() {
  const storage = await chrome.storage.local.get(['isEnabled', 'exceptionUrls', 'proxyConfig']);
  
  console.log('initProxySettings called with:', storage);
  
  if (storage.isEnabled) {
    // 配置代理
    const exceptionUrls = storage.exceptionUrls || [];
    const proxyConfig = storage.proxyConfig || { host: '127.0.0.1', port: 1080, type: 'http' };
    
    console.log('Enabling proxy with config:', proxyConfig);
    console.log('Exception URLs:', exceptionUrls);
    
    // 生成PAC脚本
    const pacScript = `function FindProxyForURL(url, host) {
      // Browser Proxy Manager - PAC Script
      const exceptionUrls = ${JSON.stringify(exceptionUrls)};
      const proxyConfig = ${JSON.stringify(proxyConfig)};
      
      // Check if URL is in proxy list
      const isException = exceptionUrls.some(proxyUrl =&gt; {
        return host === proxyUrl || host.endsWith(&amp;#34;.&amp;#34; + proxyUrl);
      });
      
      if (isException) {
        // Use proxy
        const proxyStr = 'PROXY ' + proxyConfig.host + ':' + proxyConfig.port + '; DIRECT';
        return proxyStr;
      } else {
        // Direct connection
        return 'DIRECT';
      }
    }`;
    
    try {
      await chrome.proxy.settings.set({
        value: {
          mode: 'pac_script',
          pacScript: {
            data: pacScript
          }
        },
        scope: 'regular'
      }, () =&gt; {
        if (chrome.runtime.lastError) {
          console.error('Error setting proxy:', chrome.runtime.lastError);
        } else {
          console.log('Proxy settings updated successfully');
        }
      });
    } catch (error) {
      console.error('Error setting proxy settings:', error);
    }
  } else {
    // 禁用代理
    console.log('Disabling proxy');
    try {
      await chrome.proxy.settings.set({
        value: {
          mode: 'direct'
        },
        scope: 'regular'
      });
    } catch (error) {
      console.error('Error disabling proxy:', error);
    }
  }
}

// 监听扩展安装或更新
chrome.runtime.onInstalled.addListener(async () =&gt; {
  await initStorage();
  await initProxySettings();
  // 初始化所有标签页的图标和徽章颜色
  const storage = await chrome.storage.local.get(['isEnabled']);
  await updateAllTabsIconAndColor(storage.isEnabled);
});

// 监听扩展启动
chrome.runtime.onStartup.addListener(async () =&gt; {
  await initProxySettings();
  // 初始化所有标签页的图标和徽章颜色
  const storage = await chrome.storage.local.get(['isEnabled']);
  await updateAllTabsIconAndColor(storage.isEnabled);
});

// 直连模式使用默认图标
const greenIcon = {
  &amp;#34;16&amp;#34;: &amp;#34;icons/icon16.png&amp;#34;,
  &amp;#34;48&amp;#34;: &amp;#34;icons/icon48.png&amp;#34;,
  &amp;#34;128&amp;#34;: &amp;#34;icons/icon128.png&amp;#34;
};

// 代理模式使用默认图标
const redIcon = {
  &amp;#34;16&amp;#34;: &amp;#34;icons/icon16.png&amp;#34;,
  &amp;#34;48&amp;#34;: &amp;#34;icons/icon48.png&amp;#34;,
  &amp;#34;128&amp;#34;: &amp;#34;icons/icon128.png&amp;#34;
};

// 根据连接状态更新标签页图标
async function updateTabIcon(tabId, url) {
  // 获取设置
  const storage = await chrome.storage.local.get(['exceptionUrls', 'isEnabled']);
  
  // 如果扩展未启用，显示默认图标和禁用状态
  if (!storage.isEnabled) {
    chrome.action.setBadgeText({ text: 'DISABLED', tabId: tabId });
    chrome.action.setBadgeBackgroundColor({ color: '#6c757d', tabId: tabId });
    return;
  }
  
  try {
    const urlObj = new URL(url);
    const hostname = urlObj.hostname;
    
    const isException = storage.exceptionUrls.some(proxyUrl =&gt; {
      return hostname === proxyUrl || hostname.endsWith(&amp;#34;.&amp;#34; + proxyUrl);
    });
    
    // 更新徽章文本和颜色
    if (isException) {
      // 代理模式 - 显示VPN徽章和红色背景
      chrome.action.setBadgeText({ text: 'VPN', tabId: tabId });
      chrome.action.setBadgeBackgroundColor({ color: '#dc3545', tabId: tabId });
    } else {
      // 直连模式 - 显示DIRECT徽章和绿色背景
      chrome.action.setBadgeText({ text: 'DIR', tabId: tabId });
      chrome.action.setBadgeBackgroundColor({ color: '#3fc944', tabId: tabId });
    }
  } catch (error) {
    // 对于无法解析的URL，显示直连状态
    chrome.action.setBadgeText({ text: 'DIR', tabId: tabId });
    chrome.action.setBadgeBackgroundColor({ color: '#3fc944', tabId: tabId });
  }
}

// 监听标签页更新
chrome.tabs.onUpdated.addListener(async (tabId, changeInfo, tab) =&gt; {
  if (changeInfo.status === 'complete' &amp;&amp; tab.url) {
    // 更新标签页图标
    await updateTabIcon(tabId, tab.url);
  }
});

// 监听标签页切换
chrome.tabs.onActivated.addListener(async (activeInfo) =&gt; {
  const tab = await new Promise(resolve =&gt; chrome.tabs.get(activeInfo.tabId, resolve));
  if (tab.url) {
    // 更新激活标签页的图标
    await updateTabIcon(activeInfo.tabId, tab.url);
  }
});

// 更新所有标签页的图标和徽章颜色
async function updateAllTabsIconAndColor(isEnabled) {
  const tabs = await new Promise(resolve =&gt; chrome.tabs.query({}, resolve));
  
  for (const tab of tabs) {
    if (tab.url) {
      await updateTabIcon(tab.id, tab.url);
    }
  }
}

// 初始化
initStorage();

// 更新所有标签页的徽章颜色
async function updateAllTabsBadgeColor(isEnabled) {
  const tabs = await new Promise(resolve =&gt; chrome.tabs.query({}, resolve));
  
  if (!isEnabled) {
    // 插件被禁用时，将所有标签页的徽章背景色设为灰色
    tabs.forEach(tab =&gt; {
      chrome.action.setBadgeBackgroundColor({ color: '#808080', tabId: tab.id });
    });
  } else {
    // 插件启用时，根据每个标签页的连接状态设置颜色
    const storage = await chrome.storage.local.get(['exceptionUrls']);
    
    tabs.forEach(tab =&gt; {
      if (tab.url) {
        try {
          const url = new URL(tab.url);
          const hostname = url.hostname;
          
          const isException = storage.exceptionUrls.some(proxyUrl =&gt; {
            return hostname === proxyUrl || hostname.endsWith(&amp;#34;.&amp;#34; + proxyUrl);
          });
          
          if (isException) {
            // 代理模式下设置为红色
            chrome.action.setBadgeBackgroundColor({ color: '#FF0000', tabId: tab.id });
          } else {
            // 直连模式下设置为绿色
            chrome.action.setBadgeBackgroundColor({ color: '#00FF00', tabId: tab.id });
          }
        } catch (e) {
          // 对于无法解析的URL，设置为默认颜色
          chrome.action.setBadgeBackgroundColor({ color: '#00FF00', tabId: tab.id });
        }
      }
    });
  }
}

// 监听消息
chrome.runtime.onMessage.addListener((message, sender, sendResponse) =&gt; {
  switch (message.action) {
    case 'getSettings':
      // 获取设置
      chrome.storage.local.get(['exceptionUrls', 'proxyConfig', 'isEnabled'], (result) =&gt; {
        sendResponse(result);
      });
      return true;
    
    case 'saveSettings':
      // 保存设置
      chrome.storage.local.set(message.data, async () =&gt; {
        const proxyUrls = message.data.exceptionUrls || [];
        console.log('Settings saved:', message.data);
        console.log('Proxy URLs:', proxyUrls);
        await updateRules(proxyUrls);
        await initProxySettings();
        // 更新所有标签页的图标
        await updateAllTabsIconAndColor(message.data.isEnabled !== false);
        sendResponse({ success: true });
      });
      return true;
    
    case 'toggleEnabled':
      // 切换启用状态
      chrome.storage.local.get('isEnabled', async (result) =&gt; {
        const newEnabled = !result.isEnabled;
        await chrome.storage.local.set({ isEnabled: newEnabled });
        await initProxySettings();
        // 更新所有标签页的图标和徽章颜色
        await updateAllTabsIconAndColor(newEnabled);
        sendResponse({ isEnabled: newEnabled });
      });
      return true;
    
    default:
      sendResponse({ error: 'Unknown action' });
      return true;
  }
});

</code></pre>
<h2 data-id="heading-6">结束语</h2>
<p>现在有了trea真的太方便了，做一个浏览器小插件2个小时不到就做出来了，真的是大大节省了我们开发工作量，必须点赞。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Onlyoffice Documentserver Docker 容器化部署指南]]></title>    <link>https://juejin.cn/post/7582104240987357210</link>    <guid>https://juejin.cn/post/7582104240987357210</guid>    <pubDate>2025-12-11T01:46:21.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7582104240987357210" data-draft-id="7582136489769779210" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Onlyoffice Documentserver Docker 容器化部署指南"/> <meta itemprop="keywords" content="开源,Docker"/> <meta itemprop="datePublished" content="2025-12-11T01:46:21.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="程序员老赵"/> <meta itemprop="url" content="https://juejin.cn/user/3208848015890347"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Onlyoffice Documentserver Docker 容器化部署指南
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3208848015890347/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    程序员老赵
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-11T01:46:21.000Z" title="Thu Dec 11 2025 01:46:21 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-11
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">概述</h2>
<p>DOCUMENTSERVER（镜像名称：onlyoffice/documentserver）是一款功能丰富的容器化在线办公套件，提供文本、电子表格和演示文稿的查看与编辑功能，完全兼容Office Open XML格式（.docx、.xlsx、.pptx），并支持实时协作编辑。作为ONLYOFFICE生态系统的核心组件，DOCUMENTSERVER可独立部署或与Community Server、Mail Server集成，实现文档存储、共享、权限管理等扩展功能。</p>
<p>通过Docker容器化部署DOCUMENTSERVER，能够显著简化安装流程、确保环境一致性，并便于版本管理和升级。本文将详细介绍DOCUMENTSERVER的Docker部署方案，包括环境准备、镜像拉取、容器配置、功能测试及生产环境优化建议。</p>
<h2 data-id="heading-1">环境准备</h2>
<h3 data-id="heading-2">Docker环境安装</h3>
<p>DOCUMENTSERVER基于Docker容器运行，需先确保服务器已安装Docker环境。推荐使用以下一键安装脚本快速部署最新版Docker：</p>
<pre><code class="hljs language-less" lang="less"><span class="hljs-selector-tag">bash</span> &lt;(wget -qO- <span class="hljs-attribute">https</span>:<span class="hljs-comment">//xuanyuan.cloud/docker.sh)</span>
</code></pre>
<p>脚本执行完成后，可通过<code>docker --version</code>命令验证安装是否成功，建议使用Docker 1.9.0或更高版本以获得最佳兼容性。</p>
<h2 data-id="heading-3">镜像准备</h2>
<h3 data-id="heading-4">拉取DOCUMENTSERVER镜像</h3>
<p>使用以下命令通过轩辕镜像加速地址拉取最新版本的DOCUMENTSERVER镜像：</p>
<pre><code class="hljs language-arduino" lang="arduino">docker pull xxx.xuanyuan.run/onlyoffice/documentserver:latest
</code></pre>
<p>拉取完成后，可通过<code>docker images</code>命令验证镜像是否成功下载：</p>
<pre><code class="hljs language-bash" lang="bash">docker images | grep onlyoffice/documentserver
</code></pre>
<p>若输出类似以下信息，说明镜像拉取成功：</p>
<pre><code class="hljs language-xml" lang="xml">xxx.xuanyuan.run/onlyoffice/documentserver   latest    <span class="hljs-tag">&lt;<span class="hljs-name">镜像ID</span>&gt;</span>   <span class="hljs-tag">&lt;<span class="hljs-name">创建时间</span>&gt;</span>   <span class="hljs-tag">&lt;<span class="hljs-name">大小</span>&gt;</span>
</code></pre>
<h2 data-id="heading-5">容器部署</h2>
<h3 data-id="heading-6">基础部署</h3>
<p>执行以下命令启动基础版DOCUMENTSERVER容器，映射容器80端口至主机80端口：</p>
<pre><code class="hljs language-arduino" lang="arduino">docker run -d \  --name documentserver \  -p <span class="hljs-number">80</span>:<span class="hljs-number">80</span> \  xxx.xuanyuan.run/onlyoffice/documentserver:latest
</code></pre>
<ul>
<li>• <code>-d</code>：后台运行容器</li>
<li>• <code>--name documentserver</code>：指定容器名称为documentserver，便于后续管理</li>
<li>• <code>-p 80:80</code>：将主机80端口映射至容器80端口（容器内Web服务默认端口）</li>
</ul>
<h3 data-id="heading-7">数据持久化部署</h3>
<p>为避免容器重启或升级导致数据丢失，建议挂载主机目录至容器数据卷，持久化存储日志和证书等关键数据：</p>
<pre><code class="hljs language-shell" lang="shell"><span class="hljs-meta prompt_"> # </span><span class="bash">创建本地数据目录<span class="hljs-built_in">mkdir</span> -p /app/onlyoffice/DocumentServer/logs /app/onlyoffice/DocumentServer/data<span class="hljs-comment"># 启动容器并挂载数据卷docker run -d \  --name documentserver \  -p 80:80 \  -v /app/onlyoffice/DocumentServer/logs:/var/log/onlyoffice \  -v /app/onlyoffice/DocumentServer/data:/var/www/onlyoffice/Data \  xxx.xuanyuan.run/onlyoffice/documentserver:latest</span></span>
</code></pre>
<ul>
<li>• <code>/var/log/onlyoffice</code>：容器内DOCUMENTSERVER日志存储路径</li>
<li>• <code>/var/www/onlyoffice/Data</code>：容器内证书及配置数据存储路径</li>
</ul>
<h3 data-id="heading-8">自定义端口部署</h3>
<p>若主机80端口已被占用，可通过<code>-p</code>参数指定自定义端口，例如使用8080端口对外提供服务：</p>
<pre><code class="hljs language-bash" lang="bash">docker run -d \  --name documentserver \  -p 8080:80 \  -v /app/onlyoffice/DocumentServer/logs:/var/log/onlyoffice \  -v /app/onlyoffice/DocumentServer/data:/var/www/onlyoffice/Data \  xxx.xuanyuan.run/onlyoffice/documentserver:latest
</code></pre>
<h3 data-id="heading-9">HTTPS安全部署</h3>
<p>为提升服务安全性，建议配置HTTPS加密访问。需先准备SSL证书（CA签发或自签名），然后通过数据卷挂载证书文件并映射443端口：</p>
<h4 data-id="heading-10">1. 生成自签名证书（若无可信任CA证书）</h4>
<pre><code class="hljs language-kotlin" lang="kotlin"># 创建证书目录mkdir -p /app/onlyoffice/DocumentServer/<span class="hljs-keyword">data</span>/certs# 生成私钥openssl genrsa -<span class="hljs-keyword">out</span> /app/onlyoffice/DocumentServer/<span class="hljs-keyword">data</span>/certs/onlyoffice.key <span class="hljs-number">2048</span># 生成证书签名请求（CSR）openssl req -new -key /app/onlyoffice/DocumentServer/<span class="hljs-keyword">data</span>/certs/onlyoffice.key -<span class="hljs-keyword">out</span> /app/onlyoffice/DocumentServer/<span class="hljs-keyword">data</span>/certs/onlyoffice.csr# 生成自签名证书（有效期<span class="hljs-number">365</span>天）openssl x509 -req -days <span class="hljs-number">365</span> -<span class="hljs-keyword">in</span> /app/onlyoffice/DocumentServer/<span class="hljs-keyword">data</span>/certs/onlyoffice.csr -signkey /app/onlyoffice/DocumentServer/<span class="hljs-keyword">data</span>/certs/onlyoffice.key -<span class="hljs-keyword">out</span> /app/onlyoffice/DocumentServer/<span class="hljs-keyword">data</span>/certs/onlyoffice.crt# 生成DH参数（增强安全性）openssl dhparam -<span class="hljs-keyword">out</span> /app/onlyoffice/DocumentServer/<span class="hljs-keyword">data</span>/certs/dhparam.pem <span class="hljs-number">2048</span># 设置证书权限（仅所有者可读）chmod <span class="hljs-number">400</span> /app/onlyoffice/DocumentServer/<span class="hljs-keyword">data</span>/certs/onlyoffice.key
</code></pre>
<h4 data-id="heading-11">2. 启动HTTPS服务</h4>
<pre><code class="hljs language-bash" lang="bash"> docker run -d \  --name documentserver \  -p 443:443 \  -v /app/onlyoffice/DocumentServer/logs:/var/log/onlyoffice \  -v /app/onlyoffice/DocumentServer/data:/var/www/onlyoffice/Data \  xxx.xuanyuan.run/onlyoffice/documentserver:latest
</code></pre>
<h3 data-id="heading-12">集成社区版部署（含Community Server和Mail Server）</h3>
<p>DOCUMENTSERVER可与ONLYOFFICE Community Server、Mail Server组成完整社区版套件，提供文档管理、邮件服务等综合功能。部署步骤如下：</p>
<h4 data-id="heading-13">1. 创建专用网络</h4>
<pre><code class="hljs language-lua" lang="lua">docker network <span class="hljs-built_in">create</span> <span class="hljs-comment">--driver bridge onlyoffice</span>
</code></pre>
<h4 data-id="heading-14">2. 部署DOCUMENTSERVER</h4>
<pre><code class="hljs language-ini" lang="ini">docker run -d \  --net onlyoffice \  --name onlyoffice-document-server \  <span class="hljs-attr">--restart</span>=always \  -v /app/<span class="hljs-literal">on</span>ly<span class="hljs-literal">off</span>ice/DocumentServer/logs:/var/log/<span class="hljs-literal">on</span>ly<span class="hljs-literal">off</span>ice \  -v /app/<span class="hljs-literal">on</span>ly<span class="hljs-literal">off</span>ice/DocumentServer/data:/var/www/<span class="hljs-literal">on</span>ly<span class="hljs-literal">off</span>ice/Data \  xxx.xuanyuan.run/<span class="hljs-literal">on</span>ly<span class="hljs-literal">off</span>ice/documentserver:latest
</code></pre>
<h4 data-id="heading-15">3. 部署Mail Server（替换yourdomain.com为实际域名）</h4>
<pre><code class="hljs language-bash" lang="bash">docker run -d \  --net onlyoffice \  --name onlyoffice-mail-server \  --restart=always \  --privileged \  -p 25:25 -p 143:143 -p 587:587 \  -v /app/onlyoffice/MailServer/data:/var/vmail \  -v /app/onlyoffice/MailServer/data/certs:/etc/pki/tls/mailserver \  -v /app/onlyoffice/MailServer/logs:/var/log \  -v /app/onlyoffice/MailServer/mysql:/var/lib/mysql \  -h yourdomain.com \  onlyoffice/mailserver
</code></pre>
<h4 data-id="heading-16">4. 部署Community Server</h4>
<pre><code class="hljs language-ini" lang="ini">docker run -d \  --net onlyoffice \  --name onlyoffice-community-server \  <span class="hljs-attr">--restart</span>=always \  -p <span class="hljs-number">80</span>:<span class="hljs-number">80</span> -p <span class="hljs-number">443</span>:<span class="hljs-number">443</span> -p <span class="hljs-number">5222</span>:<span class="hljs-number">5222</span> \  -v /app/<span class="hljs-literal">on</span>ly<span class="hljs-literal">off</span>ice/CommunityServer/data:/var/www/<span class="hljs-literal">on</span>ly<span class="hljs-literal">off</span>ice/Data \  -v /app/<span class="hljs-literal">on</span>ly<span class="hljs-literal">off</span>ice/CommunityServer/mysql:/var/lib/mysql \  -v /app/<span class="hljs-literal">on</span>ly<span class="hljs-literal">off</span>ice/CommunityServer/logs:/var/log/<span class="hljs-literal">on</span>ly<span class="hljs-literal">off</span>ice \  -v /app/<span class="hljs-literal">on</span>ly<span class="hljs-literal">off</span>ice/DocumentServer/data:/var/www/<span class="hljs-literal">on</span>ly<span class="hljs-literal">off</span>ice/DocumentServerData \  -e DOCUMENT_SERVER_PORT_80_TCP_ADDR=<span class="hljs-literal">on</span>ly<span class="hljs-literal">off</span>ice-document-server \  -e MAIL_SERVER_DB_HOST=<span class="hljs-literal">on</span>ly<span class="hljs-literal">off</span>ice-mail-server \  <span class="hljs-literal">on</span>ly<span class="hljs-literal">off</span>ice/communityserver
</code></pre>
<h2 data-id="heading-17">功能测试</h2>
<h3 data-id="heading-18">服务可用性测试</h3>
<p>容器启动后，等待约1-2分钟（首次启动需初始化服务），通过以下方式验证服务是否正常运行：</p>
<h4 data-id="heading-19">1. 访问Web界面</h4>
<p>在浏览器中访问<code>http://&lt;服务器IP&gt;</code>（基础部署）或<code>https://&lt;服务器IP&gt;</code>（HTTPS部署），若能看到DOCUMENTSERVER欢迎页面或编辑器界面，说明Web服务正常。</p>
<h4 data-id="heading-20">2. 命令行访问测试</h4>
<p>使用<code>curl</code>命令测试服务响应：</p>
<pre><code class="hljs language-arduino" lang="arduino">curl -I http:<span class="hljs-comment">//&lt;服务器IP&gt;</span>
</code></pre>
<p>若返回<code>200 OK</code>状态码，说明服务正常响应：</p>
<pre><code class="hljs language-arduino" lang="arduino">HTTP/<span class="hljs-number">1.1</span> <span class="hljs-number">200</span> OKServer: nginxDate: &lt;当前时间&gt;Content-Type: text/html; charset=utf<span class="hljs-number">-8.</span>..
</code></pre>
<h3 data-id="heading-21">日志验证</h3>
<p>通过容器日志确认服务启动状态：</p>
<pre><code class="hljs">docker logs documentserver
</code></pre>
<p>若日志中出现类似以下信息，说明服务初始化完成并正常运行：</p>
<pre><code class="hljs language-makefile" lang="makefile"><span class="hljs-section">onlyoffice-documentserver: started</span>
</code></pre>
<h3 data-id="heading-22">文档编辑测试</h3>
<p>在Web界面中创建或上传测试文档（如.docx、.xlsx文件），尝试进行编辑、保存操作，验证文档处理功能是否正常。</p>
<h2 data-id="heading-23">生产环境建议</h2>
<h3 data-id="heading-24">系统资源配置</h3>
<p>根据官方推荐，生产环境服务器应满足以下最低配置：</p>
<ul>
<li>• <strong>RAM</strong>：4 GB或更高（多用户并发编辑时建议8 GB以上）</li>
<li>• <strong>CPU</strong>：双核2 GHz或更高处理器（多用户场景建议4核及以上）</li>
<li>• <strong>Swap</strong>：至少2 GB（避免内存不足导致服务异常）</li>
<li>• <strong>HDD</strong>：至少2 GB空闲空间（根据文档存储需求增加）</li>
<li>• <strong>操作系统</strong>：64位Linux发行版（如Ubuntu、Debian、CentOS），内核版本3.8及以上</li>
</ul>
<h3 data-id="heading-25">安全加固</h3>
<ol>
<li>1. <strong>启用HTTPS</strong>：生产环境必须配置SSL/TLS加密，避免明文传输敏感数据</li>
<li>2. <strong>权限控制</strong>：限制主机挂载目录权限，例如设置<code>/app/onlyoffice</code>目录权限为<code>700</code></li>
<li>3. <strong>防火墙配置</strong>：仅开放必要端口（如80/443），通过<code>ufw</code>或<code>iptables</code>限制访问来源</li>
<li>4. <strong>定期更新</strong>：关注 轩辕镜像标签列表 <code>https://xuanyuan.cloud/r/onlyoffice/documentserver/tags</code> ，及时更新镜像以修复安全漏洞</li>
</ol>
<h3 data-id="heading-26">性能优化</h3>
<ol>
<li>
<p>1. <strong>资源限制</strong>：使用<code>--memory</code>和<code>--cpus</code>参数限制容器资源占用，避免影响其他服务：</p>
<pre><code class="hljs language-ini" lang="ini">docker run -d \  --name documentserver \  <span class="hljs-attr">--memory</span>=<span class="hljs-number">4</span>g \  --cpus=<span class="hljs-number">2</span> \  -p <span class="hljs-number">80</span>:<span class="hljs-number">80</span> \  -v /app/<span class="hljs-literal">on</span>ly<span class="hljs-literal">off</span>ice/DocumentServer/logs:/var/log/<span class="hljs-literal">on</span>ly<span class="hljs-literal">off</span>ice \  -v /app/<span class="hljs-literal">on</span>ly<span class="hljs-literal">off</span>ice/DocumentServer/data:/var/www/<span class="hljs-literal">on</span>ly<span class="hljs-literal">off</span>ice/Data \  xxx.xuanyuan.run/<span class="hljs-literal">on</span>ly<span class="hljs-literal">off</span>ice/documentserver:latest
</code></pre>
</li>
<li>
<p>2. <strong>日志轮转</strong>：配置日志轮转策略，避免日志文件过大占用磁盘空间，可通过<code>logrotate</code>工具管理<code>/app/onlyoffice/DocumentServer/logs</code>目录日志。</p>
</li>
<li>
<p>3. <strong>缓存优化</strong>：对于静态资源（如JS、CSS文件），可配置Nginx反向代理实现浏览器缓存，减少重复请求。</p>
</li>
</ol>
<h3 data-id="heading-27">高可用方案</h3>
<ol>
<li>
<p>1. <strong>容器自动重启</strong>：添加<code>--restart=always</code>参数，确保服务异常退出后自动恢复：</p>
<pre><code class="hljs language-ini" lang="ini">docker run -d \  --name documentserver \  <span class="hljs-attr">--restart</span>=always \  -p <span class="hljs-number">80</span>:<span class="hljs-number">80</span> \  -v /app/<span class="hljs-literal">on</span>ly<span class="hljs-literal">off</span>ice/DocumentServer/logs:/var/log/<span class="hljs-literal">on</span>ly<span class="hljs-literal">off</span>ice \  -v /app/<span class="hljs-literal">on</span>ly<span class="hljs-literal">off</span>ice/DocumentServer/data:/var/www/<span class="hljs-literal">on</span>ly<span class="hljs-literal">off</span>ice/Data \  xxx.xuanyuan.run/<span class="hljs-literal">on</span>ly<span class="hljs-literal">off</span>ice/documentserver:latest
</code></pre>
</li>
<li>
<p>2. <strong>数据备份</strong>：定期备份<code>/app/onlyoffice/DocumentServer/data</code>目录，可使用<code>rsync</code>或脚本自动化备份：</p>
<pre><code class="hljs language-shell" lang="shell"><span class="hljs-meta prompt_"># </span><span class="bash">示例：每日凌晨2点备份数据<span class="hljs-built_in">echo</span> &amp;<span class="hljs-comment">#34;0 2 * * * tar -zcvf /backup/onlyoffice_data_$(date +\%Y\%m\%d).tar.gz /app/onlyoffice/DocumentServer/data&amp;#34; &gt;&gt; /etc/crontab</span></span>
</code></pre>
</li>
<li>
<p>3. <strong>集群部署</strong>：对于高并发场景，可部署多实例DOCUMENTSERVER，结合负载均衡器（如Nginx、HAProxy）实现流量分发和故障转移。</p>
</li>
</ol>
<h2 data-id="heading-28">故障排查</h2>
<h3 data-id="heading-29">服务无法启动</h3>
<ol>
<li>
<p>1. <strong>端口冲突</strong>：检查主机端口是否被占用，使用<code>netstat</code>命令排查：</p>
<pre><code class="hljs language-perl" lang="perl">netstat -tulpn | <span class="hljs-keyword">grep</span> <span class="hljs-number">80</span>  <span class="hljs-comment"># 替换80为实际使用的端口</span>
</code></pre>
<p>若端口已被占用，需停止占用进程或更换映射端口。</p>
</li>
<li>
<p>2. <strong>目录权限问题</strong>：确保主机挂载目录权限正确，避免容器内进程无权限读写：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">chmod</span> -R 777 /app/onlyoffice/DocumentServer  <span class="hljs-comment"># 临时测试权限问题，生产环境需遵循最小权限原则</span>
</code></pre>
</li>
<li>
<p>3. <strong>SELinux限制</strong>：RHEL/CentOS等系统若启用SELinux，可能阻止容器进程访问主机目录，可临时禁用SELinux测试：</p>
<pre><code class="hljs">setenforce 0
</code></pre>
<p>若问题解决，可永久调整SELinux策略或切换至Ubuntu等发行版。</p>
</li>
</ol>
<h3 data-id="heading-30">文档编辑异常</h3>
<ol>
<li>
<p>1. <strong>内存不足</strong>：查看系统内存使用情况，若内存使用率过高，需增加服务器内存或优化资源配置：</p>
<pre><code class="hljs language-c" lang="c"><span class="hljs-built_in">free</span> -m
</code></pre>
</li>
<li>
<p>2. <strong>网络问题</strong>：检查客户端与服务器之间的网络连接，确保WebSocket通信正常（DOCUMENTSERVER依赖WebSocket实现实时协作）。</p>
</li>
<li>
<p>3. <strong>日志分析</strong>：查看容器详细日志定位问题：</p>
<pre><code class="hljs language-bash" lang="bash">docker logs -f documentserver  <span class="hljs-comment"># -f参数实时跟踪日志输出</span>
</code></pre>
</li>
</ol>
<h3 data-id="heading-31">Docker版本问题</h3>
<p>DOCUMENTSERVER对Docker版本有依赖，建议使用最新稳定版Docker。若使用旧版本Docker出现异常，可通过以下命令升级Docker：</p>
<pre><code class="hljs language-bash" lang="bash">bash &lt;(wget -qO- https://xuanyuan.cloud/docker.sh)  <span class="hljs-comment"># 重新执行一键安装脚本升级Docker</span>
</code></pre>
<h2 data-id="heading-32">参考资源</h2>
<ul>
<li>• DOCUMENTSERVER镜像文档（轩辕） <code>https://xuanyuan.cloud/r/onlyoffice/documentserver</code></li>
<li>• DOCUMENTSERVER镜像标签列表 <code>https://xuanyuan.cloud/r/onlyoffice/documentserver/tags</code></li>
<li>• Docker官方文档 <code>https://docs.docker.com</code></li>
<li>• ONLYOFFICE Document Server GitHub仓库 <code>https://github.com/ONLYOFFICE/DocumentServer</code></li>
<li>• SSL证书配置指南 <code>https://raymii.org/s/tutorials/Strong_SSL_Security_On_nginx.html</code></li>
</ul>
<h2 data-id="heading-33">总结</h2>
<p>本文详细介绍了DOCUMENTSERVER的Docker容器化部署方案，包括环境准备、镜像拉取、基础与持久化部署、HTTPS配置、集成社区版部署等多种场景，并提供了生产环境优化建议和故障排查方法。通过容器化部署，可快速搭建功能完善的在线办公协作平台，满足文档编辑、共享和协作需求。</p>
<p><strong>关键要点</strong>：</p>
<ul>
<li>• 使用轩辕镜像加速可提升DOCUMENTSERVER镜像拉取速度，优化部署效率</li>
<li>• 数据持久化部署需挂载日志和证书目录，避免容器升级导致数据丢失</li>
<li>• 生产环境必须配置HTTPS加密，并根据用户规模调整服务器资源配置</li>
<li>• 定期备份数据和更新镜像可提高系统安全性和稳定性</li>
</ul>
<p><strong>后续建议</strong>：</p>
<ul>
<li>• 深入学习DOCUMENTSERVER高级特性，如API集成、多语言支持等功能</li>
<li>• 根据实际业务需求，配置负载均衡和集群方案，提升服务可用性</li>
<li>• 关注官方文档和社区动态，及时了解新功能和安全更新</li>
<li>• 结合监控工具（如Prometheus、Grafana）实现服务状态实时监控，提前发现潜在问题</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[鸿蒙应用开发笔记：签名文件]]></title>    <link>https://juejin.cn/post/7582118538561339411</link>    <guid>https://juejin.cn/post/7582118538561339411</guid>    <pubDate>2025-12-11T01:24:01.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7582118538561339411" data-draft-id="7582102297481461802" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="鸿蒙应用开发笔记：签名文件"/> <meta itemprop="keywords" content="HarmonyOS"/> <meta itemprop="datePublished" content="2025-12-11T01:24:01.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="0x04"/> <meta itemprop="url" content="https://juejin.cn/user/4233576783285866"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            鸿蒙应用开发笔记：签名文件
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4233576783285866/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    0x04
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-11T01:24:01.000Z" title="Thu Dec 11 2025 01:24:01 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-11
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    2
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>关于 HarmonyOS 项目中签名文件的管理，以下是关键点说明：</p>
<hr/>
<p><strong>一、文件与项目的关联性</strong></p>
<ol>
<li>
<p><strong>核心文件的作用与归属</strong></p>
<ul>
<li><strong>.p12（密钥文件）</strong>：存储非对称加密的公钥和私钥，属于开发者自主生成的 <strong>通用文件</strong>，可跨项目复用（如搜索结果2、5所述）。</li>
<li><strong>.csr（证书请求文件）</strong>：用于向华为申请调试/发布证书，可跨项目共用（需确保密钥别名和密码一致）。</li>
<li><strong>.cer（证书文件）</strong>：由华为颁发，分为调试和发布证书12。 <strong>调试证书不可跨项目</strong>，发布证书可跨应用复用但需符合条件（如搜索结果2中的FAQ）。</li>
<li><strong>.p7b（Profile文件）</strong>：绑定具体项目的包名和权限， <strong>必须每个项目单独生成</strong>（如搜索结果4、5所述）。</li>
</ul>
</li>
<li>
<p><strong>项目独立性要求</strong></p>






























<table><thead><tr><th>文件类型</th><th>是否可跨项目共用</th><th>说明</th></tr></thead><tbody><tr><td>.p12</td><td>✅ 是</td><td>需统一密钥别名和密码</td></tr><tr><td>.csr</td><td>✅ 是</td><td>需基于相同密钥生成</td></tr><tr><td>.cer（发布）</td><td>✅ 是（有条件）</td><td>同一开发者账号下应用可复用</td></tr><tr><td>.p7b</td><td>❌ 否</td><td>必须每个项目单独申请</td></tr></tbody></table>
</li>
</ol>
<hr/>
<p><strong>二、文件存储管理建议</strong></p>
<ol>
<li>
<p><strong>工程目录存放规范</strong></p>
<ul>
<li><strong>推荐方式</strong>：在项目根目录创建 <code>signing/</code> 文件夹存放所有签名文件（如搜索结果8、10所述），例如：</li>
</ul>
<pre><code class="hljs language-bash" lang="bash">ProjectRoot/
├── signing/
│   ├── debug.p12      <span class="hljs-comment"># 调试密钥</span>
│   ├── release.p12    <span class="hljs-comment"># 发布密钥</span>
│   ├── app.cer        <span class="hljs-comment"># 发布证书</span>
│   └── app.p7b        <span class="hljs-comment"># Profile文件</span>
└── ...
</code></pre>
<ul>
<li><strong>路径引用</strong>：在 <code>build-profile.json5</code> 中配置相对路径（如 <code>../signing/release.p12</code>），避免绝对路径问题。</li>
</ul>
</li>
<li>
<p><strong>安全注意事项</strong></p>
<ul>
<li><strong>敏感文件隔离</strong>：<code>.p12</code> 文件包含私钥，需严格保密，禁止上传至代码仓库（需配置 <code>.gitignore</code>）。</li>
<li><strong>密码加密</strong>：在配置文件中使用 DevEco Studio 的加密功能（如 <code>encrypted:xxxx</code> 格式），避免明文存储密码（搜索结果10中提到）。</li>
</ul>
</li>
</ol>
<hr/>
<h3 data-id="heading-0">三、协作与版本控制策略</h3>
<ol>
<li>
<p><strong>团队协作场景</strong></p>
<ul>
<li>共享 <code>.p12</code> 和 <code>.csr</code> 文件给团队成员，确保签名一致性（搜索结果8中的多人协作建议）。</li>
<li><strong>Profile 文件独立</strong>：每个开发者需根据自身设备申请独立的调试 Profile（搜索结果4中的调试设备列表要求）。</li>
</ul>
</li>
<li>
<p><strong>发布场景操作</strong></p>
<ul>
<li>使用统一的发布证书和 Profile，确保应用更新时签名一致性（搜索结果2中强调证书删除对在架版本无影响，但更新必须一致）。</li>
</ul>
</li>
</ol>
<hr/>
<p><strong>四、跨项目复用示例</strong>
若需在多个项目中共用签名资源：</p>
<ol>
<li>创建公共签名目录（如 <code>CommonSign/</code>），存放可复用的 <code>.p12</code> 和 <code>.cer</code> 文件。</li>
<li>各项目通过相对路径引用公共目录中的文件：
<pre><code class="hljs language-json" lang="json"><span class="hljs-comment">// build-profile.json5</span>
signingConfigs<span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
  release<span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    storeFile<span class="hljs-punctuation">:</span> &amp;#<span class="hljs-number">34</span>;../CommonSign/release.p12&amp;#<span class="hljs-number">34</span>;<span class="hljs-punctuation">,</span>
    profileFile<span class="hljs-punctuation">:</span> &amp;#<span class="hljs-number">34</span>;signing/app.p7b&amp;#<span class="hljs-number">34</span>;  <span class="hljs-comment">// 每个项目独有</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
</li>
</ol>
<hr/>
<p>通过合理规划文件存储和引用方式，既能实现资源复用，又能确保项目签名的独立性与安全性。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item>  </channel></rss>